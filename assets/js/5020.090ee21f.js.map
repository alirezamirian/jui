{"version":3,"file":"assets/js/5020.090ee21f.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/recoil-utils.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/ensureArray.ts","webpack://website/../example-app/src/Project/persistence/persistentAtomEffect.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/EditorZeroState.tsx","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/Project/projectActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectViewContextMenu.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/HelpButton.tsx","webpack://website/../example-app/src/path-utils.ts","webpack://website/../example-app/src/Project/fs-operations.ts","webpack://website/../example-app/src/ProjectView/actions/deleteAction.tsx","webpack://website/../example-app/src/ProjectView/actions/copyAction.tsx","webpack://website/../example-app/src/ProjectView/actions/cutAction.tsx","webpack://website/../example-app/src/ProjectView/actions/pasteAction.tsx","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/Delayed.tsx","webpack://website/../example-app/src/VersionControl/Changes/Change.ts","webpack://website/../example-app/src/VersionControl/Changes/changes.state.ts","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/tree-utils/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/ChangeTreeNode.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodesResult.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesViewTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/refs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DateRange.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/vcs-logs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/readCommits.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useChangesViewActions.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewZeroState.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/TrackingBranchInfo.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/styled-components.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/commit-utils.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/commitChangesTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/getCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/Changes/detectRenames.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/RefLabel.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/CommitDetails.tsx","webpack://website/../example-app/src/useRedefineAction.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/VcsLogDetailsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogDropdown.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/BranchesFilterDropdown.tsx","webpack://website/../example-app/src/VersionControl/git-users.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableRow.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableViewOptionsMenuIconButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogCommitsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/branchTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/VcsBranchesView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/useCommitsTableActions.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindowZeroState.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.state.ts","webpack://website/../example-app/src/StatusBar/TasksPopup.tsx","webpack://website/../example-app/src/StatusBar/StatusBarTaskProgressBar.tsx","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/BranchPopupTrigger.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/VersionControl/gitAddCallback.tsx","webpack://website/../example-app/src/Project/actions/NewItemPopup.tsx","webpack://website/../example-app/src/Project/actions/createFileAction.tsx","webpack://website/../example-app/src/useCancelableAsyncCallback.ts","webpack://website/../example-app/src/Project/actions/createDirectoryAction.tsx","webpack://website/../example-app/src/Project/actions/copyFilename.tsx","webpack://website/../example-app/src/Project/actions/copyAbsolutePath.tsx","webpack://website/../example-app/src/VersionControl/actions/copyPathFromRepositoryRoot.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/createAction.tsx","webpack://website/../example-app/src/VersionControl/actions/gitAddAction.tsx","webpack://website/../example-app/src/VersionControl/actions/gitInitAction.tsx","webpack://website/../example-app/src/VersionControl/gitRememberedInputs.state.ts","webpack://website/../example-app/src/ProjectInitializer.tsx","webpack://website/../example-app/src/VersionControl/actions/gitCloneAction.tsx","webpack://website/../example-app/src/VersionControl/useClone.ts","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/Project/persistence/PersistentStateProvider.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editor.lineHighlightBorder\": \"none\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  const fontSize = 13;\n  return (\n    <StyledEditor\n      {...props}\n      options={{\n        minimap: { enabled: false },\n        lineHeight: 22,\n        showFoldingControls: \"always\",\n        renderIndentGuides: true,\n        overviewRulerBorder: false,\n        fontFamily: \"JetBrains Mono\",\n        fontSize,\n        scrollbar: {\n          verticalScrollbarSize: 14,\n          horizontalScrollbarSize: 8,\n          verticalSliderSize: 8,\n          horizontalSliderSize: 8,\n          horizontal: \"auto\",\n          vertical: \"visible\",\n          alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n        },\n        ...props.options,\n      }}\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\nimport { BFSCallback } from \"browserfs/dist/node/core/file_system\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { fs } from \"./fs\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\n/**\n * Similar to `fs.mkdir(dirPath, {recursive: true})`. `recursive` is not supported in the\n * currently used fs implementations.\n */\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n\n/**\n * A wrapper around stat which doesn't throw if nothing exists at the input pathname.\n * It provides a more ergonomic signature for use cases where it's required to know if\n * a file or directory exists on the pathname, distinguishing the two cases.\n */\nexport const stat = (pathname: string) =>\n  fs.promises.stat(pathname).catch(() => null);\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (\n  persistentFsPreference.get() === \"yes\"\n    ? createIndexedDBFS()\n    : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC<{ children?: React.ReactNode }> = ({\n  children,\n}) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import {\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { fs } from \"./fs\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\nimport { basename } from \"path\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  name: string;\n  path: string;\n  lastModification: number;\n  size: number;\n}\n\n/**\n * recoil atoms and selectors for keeping list and content of files in recoil state, for components that need on such\n * state.\n * NOTE: still not clear if we should be using atomFamily or selectorFamily for this. changing the current\n * implementation to atomFamily however is easy and side effect free.\n */\nexport const dirContentState = selectorFamily({\n  key: \"dirContents\",\n  get: (path: string) => async (): Promise<null | FsItem[]> => {\n    let fileNames: string[];\n    try {\n      fileNames = await fs.promises.readdir(path);\n    } catch (e) {\n      return null;\n    }\n    const stats = await Promise.all(\n      fileNames.map((fileName) => {\n        const filePath = `${path}/${fileName}`;\n        return fs.promises.stat(filePath).then((stat: Stats) => ({\n          ...stat,\n          type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n          filePath,\n        }));\n      })\n    );\n    return stats.map((stat) => ({\n      type: stat.type,\n      name: basename(stat.filePath),\n      path: stat.filePath,\n      lastModification: stat.mtimeMs,\n      size: stat.size,\n    }));\n  },\n});\n\n/**\n * recoil callback to refresh the file content recoil value of a give path.\n * The callback returns `true` the file exists and content is refreshed successfully, and `false otherwise.\n * @param set\n * @deprecated use reset(fileContent(path)) directly\n */\nexport const reloadFileFromDiskCallback =\n  ({ reset, refresh }: CallbackInterface) =>\n  async (path: string) => {\n    refresh(readFileContentSelector(path));\n    reset(fileContentState(path));\n  };\n\nconst readFileContentSelector = selectorFamily({\n  key: \"readFileContent\",\n  get: (filepath: string | undefined) => async (): Promise<string | null> => {\n    if (!filepath) {\n      return \"\";\n    }\n    const exists = await fs.promises.exists(filepath);\n    if (!exists) {\n      return null;\n    }\n    // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n    return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n  },\n});\n\n/**\n * **Note**: Still not quite clear if we should use atom and [synchronize with source of truth (FS)][recoil-atom-effects],\n * or if we should use selector and refresh it when needed. We probably need a proper [VFS][vfs] implementation at\n * some point, which would be capable of tracking modifications, and setting up listeners for it, and then atoms, can\n * hold the states like directory content, with effects which uses the listener API.\n * A few things to consider in that regard:\n * - if modifications to files are not directly synchronized to fs, using isomorphic-git for updating the file status\n *   can be tricky, unless an FS implementation is provided which uses the file content that is not yet synced with\n *   the actual local FS. Maybe something like Intellij's VFS, can be implemented as a BrowserFS backend impl.\n *\n * **Note**: currently, only text file is supported, for simplicity.\n *\n * [recoil-atom-effects]: https://recoiljs.org/docs/guides/atom-effects#write-through-cache-example\n * [vfs]: https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html\n **/\nexport const fileContentState = atomFamily<string | null, string | undefined>({\n  key: \"fileContent\",\n  default: readFileContentSelector,\n  effects: (filepath) => [\n    ({ onSet }) => {\n      onSet(async (content) => {\n        if (filepath && (await fs.promises.exists(filepath))) {\n          // Should a sync API be used here?\n          fs.promises\n            .writeFile(filepath, content ?? \"\", \"utf8\")\n            .catch((e: unknown) => {\n              console.error(\"failed to sync the file back to the fs\", e);\n            });\n        }\n      });\n    },\n  ],\n});\n\nexport const useReloadFromDisk = (path: string) => {\n  return useRecoilRefresher_UNSTABLE(dirContentState(path));\n};\n","import {\n  Loadable,\n  RecoilState,\n  RecoilValue,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { FocusEvent, useEffect, useRef, useState } from \"react\";\nimport { equals } from \"ramda\";\n\nexport type MaybeRecoilValue<T> = T | RecoilValue<T>;\n\nexport const createFocusBasedSetterHook = <T extends unknown, N extends T = T>(\n  state: RecoilState<T>,\n  nullValue: N\n) => {\n  let focusedElement: Element | null = null;\n  return (value: T, name: string = \"unknown\") => {\n    const setValue = useSetRecoilState(state);\n    const elementRef = useRef<Element>();\n    useEffect(() => {\n      if (focusedElement === elementRef.current) {\n        setValue((currentValue) =>\n          equals(value, currentValue) ? currentValue : value\n        );\n      }\n    }, [value]);\n    return {\n      onFocus: (e: FocusEvent) => {\n        elementRef.current = e.currentTarget;\n        focusedElement = e.currentTarget;\n        setValue(value);\n      },\n      onBlur: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container], [role=menu]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n      },\n    };\n  };\n};\n\n/**\n * Returns the latest value of a recoil value, or null, if the value is being loaded for the first time.\n * Useful for when stale data is ok, but may get synced soon.\n *\n * TODO: returning a tuple here is not the best API. Ideally we could have a fourth type of Lodable which would be\n *  similar to LoadingLoadale, but would hold a previous value as well. Then we could have a hook like similar to\n *  useRecoilValueLoadable, but returning that specific type of Loadable. The only difference with\n *  useRecoilValueLoadable would be calling getValue() would return the previous value if state is loading, making it\n *  easy to implement the common pattern of keeping the previous data plus a loading indicator, when new data is being\n *  loaded.\n */\nexport function useLatestRecoilValue<T>(\n  recoilValue: RecoilValue<T>\n): [T | null, Loadable<unknown>[\"state\"]] {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  return [\n    loadable.state === \"hasValue\" ? loadable.getValue() : state,\n    loadable.state,\n  ];\n}\n\n/**\n * Similar to {@link useLatestRecoilValue}, only that value is guaranteed\n * to be initialized. i.e. the first load of the recoil value will suspend\n * the rendering, but the subsequent updates will not, and the latest value\n * will be used, while a new value is being loaded.\n */\nexport function useExistingLatestRecoilValue<T>(\n  recoilValue: RecoilValue<T>\n): [T, Loadable<unknown>[\"state\"]] {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  const value = loadable.state === \"hasValue\" ? loadable.getValue() : state;\n\n  if (value === null) {\n    throw loadable.toPromise();\n  }\n  return [value, loadable.state];\n}\n\n/**\n * Refreshes recoil value on mount\n */\nexport function useRefreshRecoilValueOnMount<T>(value: RecoilValue<T>) {\n  const refresh = useRecoilRefresher_UNSTABLE(value);\n  useEffect(() => {\n    refresh();\n  }, []);\n}\n\nexport function useRecoilInitialValue<T>(recoilState: RecoilState<T>): T;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: Exclude<T, undefined | null>\n): Exclude<T, undefined | null>;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: T\n) {\n  return useRecoilCallback(\n    ({ snapshot }) =>\n      () =>\n        snapshot.getLoadable(recoilState).getValue() ?? defaultValue,\n    []\n  );\n}\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import path from \"path\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { createRef, MutableRefObject } from \"react\";\nimport {\n  AlertDialogApi,\n  PopupManagerAPI,\n  WindowManagerAPI,\n} from \"@intellij-platform/core\";\n\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { createFocusBasedSetterHook } from \"../recoil-utils\";\nimport { filterPath } from \"./project-utils\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const autoClonedRepo = {\n  path: \"/workspace/jui\",\n  url: \"https://github.com/alirezamirian/jui.git\",\n};\n\nexport const defaultProject = {\n  name: \"Workspace\",\n  path: \"/workspace\",\n};\nexport const currentProjectState = atom<Project>({\n  key: \"project\",\n  default: defaultProject,\n});\n\nexport const projectFilePath = selectorFamily({\n  key: \"projectFilePath\",\n  get:\n    (projectRelativePath: string) =>\n    ({ get }) =>\n      path.join(get(currentProjectState).path, projectRelativePath),\n});\n\nexport const currentProjectFilesState = selector({\n  key: \"project.current.files\",\n  get: async ({ get }): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectState);\n    return get(projectFilesState(project.path));\n  },\n});\n\nexport const projectFilesState = selectorFamily({\n  key: \"project.files\",\n  get:\n    (\n      projectPath: string /* could be changed to project id, when project entity is more mature */\n    ) =>\n    async ({ get }): Promise<ProjectFsItem[]> => {\n      const items = get(dirContentState(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = get(dirContentState(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      (items || []).forEach((item) => addItem(item));\n      return files;\n    },\n});\n\nexport const useRefreshCurrentProjectFiles = () =>\n  useRecoilRefresher_UNSTABLE(currentProjectFilesState);\n\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsState = atom<string[]>({\n  key: \"project.activePaths\",\n  default: [],\n});\n\nexport const activePathExistsState = selector({\n  key: \"project.activePaths.hasValue\",\n  get: ({ get }) => get(activePathsState).length > 0,\n});\n\n/**\n * Sets the value of {@link activePathsState} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsState,\n  []\n);\n\n/**\n * Ref to the popup manager of the current project. Used in actions that are created by a recoil selector.\n * TODO(multi-project): either:\n *  - introduce project-level recoil root, to keep such states per project. Downside is there are atoms that are\n *    not per-project, and recoil doesn't currently support multiple nested scopes of atoms, even though it does\n *    support nested RecoilRoots.\n *  - (better) add a feature to the action system, where ActionProvider can define additional contextual properties\n *    to be made available in `context` when calling `actionPerformed` method. The biggest challenge for a nice\n *    implementation of such feature is static type safety.\n */\nexport const projectPopupManagerRefState = atom<\n  MutableRefObject<PopupManagerAPI | null>\n>({\n  key: \"project.popupManager\",\n  default: createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const windowManagerRefState = atom<\n  MutableRefObject<WindowManagerAPI | null>\n>({\n  key: \"project.windowManager\",\n  default: createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const alertDialogRefState = atom<\n  MutableRefObject<AlertDialogApi | null>\n>({\n  key: \"project.alertDialog\",\n  default: createRef(),\n  dangerouslyAllowMutability: true,\n});\n","import { atom, CallbackInterface, selector, useRecoilValue } from \"recoil\";\nimport { descend, sortWith } from \"ramda\";\nimport { Position } from \"monaco-editor\";\n\nimport {\n  currentProjectFilesState,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Focusable } from \"../common-types\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n// settings.\nconst temporaryTabsDefaultValue = selector({\n  key: \"editor.tabs/Default\",\n  get: ({ get }) =>\n    sortWith(\n      [\n        // first README.md, then ts and js files.\n        descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n        descend((file) => file.path.endsWith(\".ts\")),\n        descend((file) => file.path.endsWith(\".js\")),\n      ],\n      get(currentProjectFilesState).filter((item) => item.type === \"file\")\n    )\n      .filter((file) => !file.path.includes(\".idea\"))\n      .slice(0, 12)\n      // map project file to editor state object\n      .map((file) => ({\n        filePath: file.path,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n      })),\n});\n\n// it should become something under \"project\" state later.\nexport const editorTabsState = atom<ReadonlyArray<EditorTabState>>({\n  key: \"editor.tabs\",\n  default: [],\n  effects: [\n    ({ getPromise, setSelf, trigger }) => {\n      // an effect is used to set the intial value instead of using the selector directly in default value,\n      // because otherwise the atom will be linked to the selector (and dynamically updated) until the state is set\n      // which can lead to inconsistent behavior based on whether anything in tabs state is changed or not.\n      if (trigger === \"get\") {\n        getPromise(temporaryTabsDefaultValue).then((tabs) => setSelf(tabs));\n      }\n    },\n  ],\n});\n\nconst activeEditorTabIndexState = atom<number>({\n  key: \"editor.activeTabIndex\",\n  default: 0,\n});\n\nexport const activeEditorTabState = selector<EditorTabState | null>({\n  key: \"editor.activeTab\",\n  get: ({ get }) => {\n    const tabs = get(editorTabsState);\n    return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n  },\n});\n\nexport const editorCursorPositionState = atom<Position>({\n  key: \"editor.cursorPosition\",\n  default: new Position(0, 0),\n});\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefState = atom<null | Focusable>({\n  key: \"editor.focusHandle\",\n  default: null,\n});\n\nexport interface EditorStateManager {\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOtherTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n  focus(): void;\n}\n\nconst openPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (filePath: string, shouldFocus = true) => {\n    const tabsState = snapshot.getLoadable(editorTabsState).getValue();\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    const select = (index: number) => {\n      set(activeEditorTabIndexState, index);\n    };\n    const focus = () => {\n      snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n    };\n    if (index > -1) {\n      select(index);\n    } else {\n      const newIndex = tabsState.length;\n      set(editorTabsState, (currentState) => [\n        ...currentState,\n        {\n          filePath,\n          editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n        },\n      ]);\n      select(newIndex);\n    }\n    if (shouldFocus) {\n      // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n      // event handler) is picked up by editor, adding unwanted new line.\n      setTimeout(focus);\n    }\n  };\n\nconst closeCallback =\n  ({ set }: CallbackInterface) =>\n  (index: number) =>\n    set(editorTabsState, (tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex !== index)\n    );\n\nconst closePathCallback =\n  (callbackInterface: CallbackInterface) => (filePath: string) => {\n    const { set, snapshot, transact_UNSTABLE } = callbackInterface;\n    const close = closeCallback(callbackInterface);\n    const index = snapshot\n      .getLoadable(editorTabsState)\n      .getValue()\n      .findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      transact_UNSTABLE(() => {\n        close(index);\n        set(activeEditorTabIndexState, Math.max(index - 1, 0));\n      });\n    }\n  };\n\nconst closeOtherTabsCallback =\n  ({ set }: CallbackInterface) =>\n  (index: number) => {\n    set(editorTabsState, (tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex === index)\n    );\n  };\nconst select =\n  ({ set, snapshot }: CallbackInterface) =>\n  (index: number) => {\n    const numTabs = snapshot.getLoadable(editorTabsState).getValue().length;\n    if (index >= 0 && index < numTabs) {\n      set(activeEditorTabIndexState, index);\n    }\n  };\n\nconst focus =\n  ({ snapshot }: CallbackInterface) =>\n  () => {\n    snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n  };\n\nexport const editorManagerState = selector<Omit<EditorStateManager, \"tabs\">>({\n  key: \"editor.manager\",\n  get: ({ getCallback }) => {\n    return {\n      // TODO: create an action for opening in editor (jump to source)\n      openPath: getCallback(openPathCallback),\n      closeTab: getCallback(closeCallback),\n      closePath: getCallback(closePathCallback),\n      closeOtherTabs: getCallback(closeOtherTabsCallback),\n      select: getCallback(select),\n      focus: getCallback(focus),\n    };\n  },\n});\n\n/**\n * Gives access to editor state manager, in React components. returns a stable editor manager object,\n * that won't cause re-rendering based on editor state changes.\n */\nexport const useEditorStateManager = (): EditorStateManager =>\n  useRecoilValue(editorManagerState);\n\n/**\n * Gives access to editor state and also the manager, as a tuple, analogous to how useState returns\n * a tuple for the state and the setter. Only the setter is an interface.\n */\nexport const useEditorState = () => {\n  return [\n    useRecoilValue(editorTabsState),\n    useRecoilValue(editorManagerState),\n  ] as const;\n};\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"Git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","export type MaybeArray<T> = Array<T> | T;\nexport const ensureArray = <T>(input: MaybeArray<T> | undefined): Array<T> =>\n  Array.isArray(input) ? input : input ? [input] : [];\n","import { Checker } from \"@recoiljs/refine\";\nimport { syncEffect } from \"recoil-sync\";\nimport { DefaultValue } from \"recoil\";\nimport { ensureArray, MaybeArray } from \"../../ensureArray\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nexport type PersistentAtomEffectArgs<A, C> = {\n  read: (componentState: C | undefined) => Promise<A> | A;\n  update: (value: A) => (componentState: C) => C;\n  refine: Checker<A>;\n  componentName: string;\n  itemKey?: string;\n  storageFile?: string;\n};\n\nexport function persistentAtomEffect<A, C>({\n  componentName,\n  refine,\n  read,\n  update,\n  storageFile = StorageFiles.WORKSPACE_FILE,\n  itemKey = [storageFile, componentName].join(\"|\"),\n}: PersistentAtomEffectArgs<A, C>) {\n  return syncEffect<A>({\n    storeKey: \"ProjectWorkspace\",\n    itemKey,\n    syncDefault: false,\n    read: async ({ read: readComponentState }) => {\n      return read((await readComponentState(itemKey)) as C);\n    },\n    write: async ({ write, read }, value) => {\n      // Note: currently, reading the recoil value for the first time also results in a call to write.\n      // It's maybe a bug in recoil-sync?\n      if (!(value instanceof DefaultValue)) {\n        write(itemKey, update(value));\n      }\n    },\n    refine,\n  });\n}\n\ninterface SettingComponentWithOptions<O> {\n  option?: MaybeArray<\n    {\n      \"@name\": string;\n    } & O\n  >;\n}\n\n/**\n * Wrapper around persistentAtomEffect to read/write from/to with a single\n * `option` tag in a component, based on the option `name` attribute.\n */\npersistentAtomEffect.option = <A, O>({\n  optionName,\n  read,\n  update,\n  ...args\n}: {\n  optionName: string;\n} & PersistentAtomEffectArgs<A, O>) =>\n  persistentAtomEffect<A, SettingComponentWithOptions<O>>({\n    ...args,\n    itemKey: [args.storageFile, args.componentName, optionName].join(\"|\"),\n    read: (settings) => {\n      return read(\n        ensureArray(settings?.option)?.find(\n          (item) => item[\"@name\"] === optionName\n        )\n      );\n    },\n    update:\n      (value) =>\n      (currentSettings): SettingComponentWithOptions<O> => {\n        return {\n          option: ensureArray(currentSettings?.option).map((option) => {\n            const updates = update(value)(option);\n            console.log(\n              `updating ${optionName}`,\n              \"currentSettings\",\n              currentSettings,\n              \"updates\",\n              updates\n            );\n\n            return option[\"@name\"] === optionName\n              ? {\n                  \"@name\": optionName,\n                  ...updates,\n                }\n              : option;\n          }),\n        };\n      },\n  });\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\nimport git, { findRoot, statusMatrix } from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport * as path from \"path\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { persistentAtomEffect } from \"../Project/persistence/persistentAtomEffect\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { ensureArray, MaybeArray } from \"../ensureArray\";\n\n/**\n * git.status function has an issue with newly added files. it returns \"*added\" for both of these cases:\n * - file is untracked, not yet staged (as the documentation says)\n * - file is staged, but modified in working directory (AM)\n * Here is where it seems to have wrong logic:\n * https://github.com/isomorphic-git/isomorphic-git/blob/d631f8e56a5504b10ffc1b35589b1a5b0b2f9e74/src/api/status.js#L135\n\n */\nconst status = async ({\n  filepath,\n  ...args\n}: Parameters<(typeof git)[\"status\"]>[0]) => {\n  return git\n    .statusMatrix({ ...args, filepaths: [filepath] })\n    .then((rows) => rows[0]);\n};\n\ninterface VcsDirectoryMappingStorage {\n  mapping?: MaybeArray<{ \"@directory\": string; \"@vcs\": \"Git\" }>;\n}\nconst vcsDirectoryMappingChecker = array(\n  object({\n    dir: string(),\n    vcs: union(literal(\"Git\")),\n  })\n);\n\nexport const vcsRootsState = atom<ReadonlyArray<VcsDirectoryMapping>>({\n  key: \"vcsRoots\",\n  effects: [\n    persistentAtomEffect<\n      ReadonlyArray<VcsDirectoryMapping>,\n      VcsDirectoryMappingStorage\n    >({\n      storageFile: \"vcs.xml\",\n      refine: vcsDirectoryMappingChecker,\n      componentName: \"VcsDirectoryMappings\",\n      // TODO: translate project dir to $PROJECT_DIR$\n      read: (gitSettings) => {\n        const mappings = ensureArray(gitSettings?.mapping)?.map((item) => ({\n          dir: item[\"@directory\"],\n          vcs: item[\"@vcs\"],\n        }));\n        return mappings.length > 0 ? mappings : TMP_findGitRoots();\n      },\n      update:\n        (value) =>\n        (currentValue): VcsDirectoryMappingStorage => ({\n          ...(currentValue || {}),\n          mapping: value.map(({ vcs, dir }) => ({\n            \"@directory\": dir,\n            \"@vcs\": vcs,\n          })),\n        }),\n    }),\n  ],\n});\n\nconst TMP_findGitRoots = () =>\n  Promise.all(\n    [\"/workspace/jui\", \"/workspace\"].map(async (dir) => {\n      const exists = await fs.promises.exists(dir);\n      if (exists) {\n        return git.findRoot({ fs, filepath: dir }).catch(() => null);\n      }\n    })\n  ).then((roots) => {\n    return [...new Set(roots.filter(notNull))].map<VcsDirectoryMapping>(\n      (dir) => ({\n        dir,\n        vcs: \"Git\",\n      })\n    );\n  });\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsRootForFile = selectorFamily<string | null, string>({\n  key: \"gitRootForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      // FIXME: use vcsRoots.\n      // return get(vcsRootsState).find(\n      //   (root) => root.vcs === \"Git\" && isParentPath(root.dir, filepath)\n      // )?.dir ?? null;\n      // function isParentPath(parent: string, dir: string) {\n      //   const relative = path.relative(parent, dir);\n      //   return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n      // }\n      return findRoot({ fs, filepath }).catch(() => null);\n    },\n});\n\ntype RepoStatus = {\n  [relativeFilePath: string]: FileStatus;\n};\n\nconst fetchRepoStatusFromFs = async (repoDir: string) => {\n  console.time(`statusMatrix ${repoDir}`);\n  const rows = await statusMatrix({ fs, dir: repoDir });\n  console.timeEnd(`statusMatrix ${repoDir}`);\n  const result: RepoStatus = {};\n  rows.forEach((row) => {\n    result[row[0]] = convertGitStatus(row);\n  });\n  return result;\n};\n\n/**\n * A mapping from relative file paths to file status, calculated efficiently for all files in a repo.\n * It's an atom to allow updating it for a single file, when status of a file is changed, instead of querying\n * the whole status matrix.\n * UPDATE: going from setting `default` to the selector that fetches the repo status from fs, and refreshing the atom's\n * state by calling `reset`/`refresh` on it, to having an empty object as default value, and updating it based on\n * the refreshed selector. That is to make sure repoStatusState will not block UI, since many pieces of state depend\n * on it, and if it's async, it will require lots of local loading handling, or Suspense boundaries, for something\n * that's usually not critical for the UX to be completely up-to-date. In cases that we do need to know if repo status\n * is being updated, a separate atom is created to hold that state. It's a little non-idiomatic use of Recoil, but\n * it seems justified for the use case. Also, it could perhaps be a feature to be supported first-class, to allow\n * atoms that can preserve the state stale, contain both the current/stale value and the loading state.\n */\nexport const repoStatusState = atomFamily<RepoStatus, string>({\n  key: \"vcs.repoStatus\",\n  effects: (repoDir: string) => [\n    ({ setSelf }) => {\n      setSelf(fetchRepoStatusFromFs(repoDir));\n    },\n  ],\n});\n\nexport const repoStatusUpdatingState = atom<boolean>({\n  key: \"vcs.repoStatus.updating\",\n  default: false,\n});\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n * NOTE: Do **not** use recoil `refresh` API to update file status, as it may update status for the whole repo (if\n * {@link repoStatusState} is not yet written into), which is not very efficient.\n * use {@link useRefreshFileStatus} or {@link refreshFileStatusCallback} to efficiently refresh\n * the status of a single file.\n */\nexport const fileStatusState = selectorFamily<FileStatus, string>({\n  key: \"vcs.fileStatus\",\n  /**\n   * using a selector for the default value allows for using standard recoil API like `reset`/`refresh` to update\n   * the status for a given file.\n   */\n  get:\n    (filepath: string) =>\n    async ({ get }) => {\n      const repoRoot = get(vcsRootForFile(filepath));\n      if (repoRoot) {\n        const relativePath = path.relative(repoRoot, filepath);\n        const repoStatus = get(repoStatusState(repoRoot));\n        if (!repoStatus[relativePath]) {\n          console.log(\n            \"file status missing in repo status state, fetching individually\",\n            filepath\n          );\n        }\n        return (\n          repoStatus[relativePath] ??\n          convertGitStatus(\n            await status({\n              fs,\n              dir: repoRoot,\n              filepath: relativePath,\n            })\n          )\n        );\n      }\n      return \"NOT_CHANGED\";\n    },\n});\n\nexport const refreshFileStatusCallback =\n  ({ set, snapshot }: CallbackInterface) =>\n  /**\n   * Adds a file or directory to git index\n   * @param fullPath\n   */\n  async (fullPath: string) => {\n    const repoRoot = snapshot.getLoadable(vcsRootForFile(fullPath)).getValue();\n    if (repoRoot) {\n      const relativePath = path.relative(repoRoot, fullPath);\n      const rows = await git.statusMatrix({\n        fs,\n        dir: repoRoot,\n        filepaths: [relativePath],\n      });\n      set(repoStatusState(repoRoot), (statusMap) => {\n        const newStatusMap = {\n          ...statusMap,\n        };\n        if (rows.length === 0) {\n          // if file is removed and doesn't exist in HEAD, it will not appear on the status matrix\n          delete newStatusMap[relativePath];\n        }\n        rows.forEach((row) => {\n          newStatusMap[row[0]] = convertGitStatus(row);\n        });\n        return newStatusMap;\n      });\n    }\n  };\n\nexport const useRefreshFileStatus = (): ((\n  absoluteFilepath: string\n) => Promise<void>) => useRecoilCallback(refreshFileStatusCallback);\n\nexport const useRefreshRepoStatuses = () =>\n  useRecoilCallback(\n    ({ snapshot, set }: CallbackInterface) =>\n      async () => {\n        set(repoStatusUpdatingState, true);\n        try {\n          const gitDirs = await snapshot.getPromise(vcsRootsState);\n          await Promise.all(\n            gitDirs?.map(({ dir, vcs }) =>\n              fetchRepoStatusFromFs(dir).then((repoStatus) => {\n                set(repoStatusState(dir), repoStatus);\n              })\n            )\n          );\n        } finally {\n          set(repoStatusUpdatingState, false);\n        }\n      },\n    []\n  );\n","import { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { useRecoilValue } from \"recoil\";\nimport { fileStatusState } from \"./file-status.state\";\nimport React from \"react\";\nimport { FileStatus } from \"./file-status\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const [fileStatus] = useLatestRecoilValue(fileStatusState(filepath));\n  return useStatusColor(fileStatus ?? \"NOT_CHANGED\");\n};\n\nexport const FileStatusColor: React.FC<{\n  filepath: string;\n  children?: React.ReactNode;\n}> = ({ children, filepath }) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{\n  status: FileStatus;\n  children?: React.ReactNode;\n}> = ({ children, status }) => {\n  const theme = useTheme() as Theme;\n  const color = theme.currentForegroundAware(useStatusColor(status));\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n * FIXME(multi-project): this should be scoped to project\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\n\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import React from \"react\";\nimport {\n  CommonActionId,\n  styled,\n  useAction,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nconst StyledContainer = styled.div.attrs({ tabIndex: -1 })`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n  justify-content: center;\n  padding: 0 25%;\n  font-size: 1rem;\n  outline: none;\n`;\n\nconst StyledLine = styled.div`\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n`;\n\nconst StyledShortcut = styled.div`\n  color: ${({ theme }) => theme.commonColors.linkForegroundEnabled};\n`;\n\nexport function EditorZeroState() {\n  return (\n    <StyledContainer>\n      <ActionTip actionId={CommonActionId.GO_TO_FILE} />\n      <ActionTip actionId={CommonActionId.GO_TO_ACTION} />\n    </StyledContainer>\n  );\n}\n\nfunction ActionTip({ actionId }: { actionId: string }) {\n  const getShortcut = useGetActionShortcut();\n  const action = useAction(actionId);\n  return (\n    <StyledLine>\n      {action?.title}\n      <StyledShortcut>{getShortcut(actionId)}</StyledShortcut>\n    </StyledLine>\n  );\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useAction,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useRef, useState } from \"react\";\nimport { selector, useSetRecoilState } from \"recoil\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { Editor } from \"./Editor\";\nimport {\n  activeEditorTabState,\n  editorCursorPositionState,\n  editorRefState,\n  useEditorState,\n} from \"./editor.state\";\nimport { fileContentState } from \"../fs/fs.state\";\nimport { useRefreshFileStatus } from \"../VersionControl/file-status.state\";\nimport * as path from \"path\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { useExistingLatestRecoilValue } from \"../recoil-utils\";\nimport { EditorZeroState } from \"./EditorZeroState\";\n\nconst editorFullState = selector({\n  key: \"editorState\",\n  get: ({ get }) => {\n    const activeEditorTab = get(activeEditorTabState);\n    return {\n      ...activeEditorTab,\n      content: get(fileContentState(activeEditorTab?.filePath)),\n    };\n  },\n});\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const [editorTabs, editorStateManager] = useEditorState();\n  const editorRef = useRef<editor.ICodeEditor>();\n  const [active, setActive] = useState(false);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetRecoilState(editorCursorPositionState);\n\n  const [{ content, filePath }, loadingState] =\n    useExistingLatestRecoilValue(editorFullState);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items)\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOtherTabs,\n  });\n\n  const setEditorRef = useSetRecoilState(editorRefState);\n\n  const setContent = useSetRecoilState(fileContentState(filePath));\n  const updateFileStatus = useRefreshFileStatus();\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (filePath) {\n      updateFileStatus(filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n\n  const activePathsProviderProps = useActivePathsProvider(\n    filePath ? [filePath] : []\n  );\n\n  return (\n    <StyledFileEditorContainer\n      {...mergeProps(activePathsProviderProps, {\n        onFocus: () => {\n          setActive(true);\n          setEditorRef({\n            focus: () => editorRef.current?.focus(),\n          });\n        },\n      })}\n    >\n      {editorTabs.length > 0 ? (\n        <>\n          <ContextMenuContainer\n            renderMenu={() => (\n              <Menu\n                // TODO: detect which tab was triggering context menu and handle the action accordingly\n                //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n                //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n                //  modified to pass the MouseEvent object, in renderMenu.\n                onAction={notImplemented}\n              >\n                <Item key=\"close\">Close</Item>\n                <Item key=\"closeOthers\">Close Other tabs</Item>\n                <Item key=\"closeAll\">Close all tabs</Item>\n                <Item key=\"closeLeft\">Close tabs to the left</Item>\n                <Item key=\"closeRight\">Close tabs to the right</Item>\n              </Menu>\n            )}\n          >\n            <EditorTabs\n              items={editorTabs}\n              active={active}\n              selectedKey={filePath}\n              onSelectionChange={(key) => {\n                editorStateManager.select(\n                  editorTabs.findIndex((tab) => tab.filePath === key)\n                );\n              }}\n              noBorders\n            >\n              {(tab) => {\n                const filename = path.basename(tab.filePath);\n                const icon = (\n                  <PlatformIcon icon={getIconForFile(tab.filePath)} />\n                );\n                return (\n                  <TabItem\n                    key={tab.filePath}\n                    textValue={filename}\n                    inOverflowMenu={\n                      <MenuItemLayout content={filename} icon={icon} />\n                    }\n                  >\n                    <TooltipTrigger\n                      tooltip={<ActionTooltip actionName={tab.filePath} />}\n                    >\n                      <EditorTabContent\n                        icon={icon}\n                        title={\n                          <FileStatusColor filepath={tab.filePath}>\n                            {filename}\n                          </FileStatusColor>\n                        }\n                        closeButton={\n                          <TooltipTrigger\n                            tooltip={\n                              <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                            }\n                          >\n                            <TabCloseButton\n                              onPress={(e) => {\n                                if (e.altKey) {\n                                  tabActionsRef.current.closeOthersTabs(\n                                    editorTabs.indexOf(tab)\n                                  );\n                                } else {\n                                  tabActionsRef.current.closePath(tab.filePath);\n                                }\n                              }}\n                            />\n                          </TooltipTrigger>\n                        }\n                        containerProps={{\n                          onDoubleClick: () => {\n                            hideAllAction?.perform();\n                          },\n                        }}\n                      />\n                    </TooltipTrigger>\n                  </TabItem>\n                );\n              }}\n            </EditorTabs>\n          </ContextMenuContainer>\n          {typeof content === \"string\" ? (\n            /**\n             * ## Note\n             * TLDR: Keeping the editor mounted when filePath changes is intentional and does matter.\n             *\n             * Whether the editor component is kept mounted as tabs change or not has nuances that can lead to minor\n             * focus issues. For example calling editorStateManager.focus() may do nothing if the editor is unmounted due\n             * to filePath being changed. focusing editor in createFile action is an example of such case. It also affects\n             * certain focus management code within the FileEditor. For example, focusing the editor on tab changes will\n             * be necessary if the editor remounts with each file change. Or autofocus behavior of the editor can be\n             * done on the onMount callback of the Editor component, if it's only mounted once. But the same code leads\n             * to focus issues if the editor is mounted on active tab changes, when they are not done via the tab UI,\n             * but as a side effect of another action like opening a file via Project tool window.\n             *\n             */\n            <Editor\n              height=\"100%\"\n              path={filePath}\n              onMount={(monacoEditor, monaco) => {\n                monacoEditor.focus();\n                enableJsx(monaco);\n                editorRef.current = monacoEditor;\n                monacoEditor.onDidChangeCursorPosition((e) => {\n                  setCursorPositionState(e.position);\n                });\n                monacoEditor.onDidChangeModel(() => {\n                  // TODO: set the editor tab state, and add an atom effect to persist whole editor state across loads\n                });\n              }}\n              onChange={updateContent}\n              value={content ?? \"\"}\n            />\n          ) : (\n            content && \"UNSUPPORTED CONTENT\"\n          )}\n        </>\n      ) : (\n        <EditorZeroState></EditorZeroState>\n      )}\n      {loadingState === \"loading\" && <FileEditorLoading />}\n    </StyledFileEditorContainer>\n  );\n};\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  CallbackInterface,\n  GetRecoilValue,\n  selector,\n  useRecoilCallback,\n} from \"recoil\";\nimport { currentProjectState, Project } from \"../Project/project.state\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport { vcsRootsState } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom({\n  key: \"projectView.foldersOnTop\",\n  default: true,\n});\n\nexport const expandedKeysState = atom({\n  key: \"projectView.expandedKeys\",\n  default: selector({\n    key: \"projectView.expandedKeys/default\",\n    get: ({ get }) =>\n      new Set<Key>(\n        get(vcsRootsState)\n          .flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n          .concat(get(currentProjectState).path)\n      ),\n  }),\n});\n\nexport const selectionState = atom<Selection>({\n  key: \"projectView.selection\",\n  default: new Set<Key>([]),\n});\n\nexport const selectedNodesState = selector<ReadonlyArray<ProjectTreeNode>>({\n  key: \"projectView.selectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectionState);\n    const nodesByKey = get(currentProjectTreeState).byKey;\n    const selectedKeys = selection === \"all\" ? nodesByKey.keys() : selection;\n    return [...selectedKeys]\n      .map((key) => nodesByKey.get(`${key}`))\n      .filter(notNull);\n  },\n});\n\nexport const projectViewTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"projectView.focusHandle\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const currentProjectTreeState = selector({\n  key: \"projectTree\",\n  get: ({ get }) => {\n    const project = get(currentProjectState);\n    return createProjectTree(project, get);\n  },\n});\n\ntype FilesTreeSort = \"name\"; // more to be added\n\n// TODO: add more sort options and add \"Tree Appearance\" option in Project tool window settings menu.\nexport const projectTreeSortState = atom<FilesTreeSort>({\n  key: \"project.tree.sort\",\n  default: \"name\",\n});\n\n/**\n * NOTE: using in-place native sort for performance.\n * See more https://www.measurethat.net/Benchmarks/Show/6698/0/ramda-sort-vs-js-native-sort\n */\nfunction sortProjectTreeNodes(items: FileTreeNode[]): void {\n  // TODO: add sortBy: FileTreeSort parameter\n  // TODO: add directoriesOnTop: boolean parameter\n  items.sort((item1, item2) => {\n    if (item1.name < item2.name) {\n      return -1;\n    }\n    if (item1.name > item2.name) {\n      return 1;\n    }\n    return 0;\n  });\n}\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: GetRecoilValue\n): Promise<{ root: ProjectTreeRoot; byKey: Map<string, ProjectTreeNode> }> {\n  const rootItems = get(dirContentState(project.path));\n  const byKey = new Map<string, ProjectTreeNode>();\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const node = {\n        ...item,\n        parent,\n      };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          const dirNode: FileTreeDirNode = { ...node, children: [] };\n          dirNode.children = (\n            await Promise.all(\n              (get(dirContentState(item.path)) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          sortProjectTreeNodes(dirNode.children);\n          byKey.set(dirNode.path, dirNode);\n          return dirNode;\n        }\n        return null;\n      }\n      byKey.set(node.path, node);\n      return node;\n    };\n\n  const children = (\n    await Promise.all((rootItems || []).map(mapItem(null)))\n  ).filter(notNull);\n  sortProjectTreeNodes(children);\n  const root: ProjectTreeNode = {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children,\n  };\n  byKey.set(root.path, root);\n  return { root, byKey };\n}\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for expanding to a certain path in project view.\n * @param snapshot\n * @param set\n */\nexport const expandToPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (path: string) => {\n    const expandedKeys = snapshot.getLoadable(expandedKeysState).valueOrThrow();\n    const keysToExpand = [\n      snapshot.getLoadable(currentProjectState).valueOrThrow().path,\n    ].concat(getParentPaths(path));\n    set(expandedKeysState, new Set([...expandedKeys, ...keysToExpand]));\n  };\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n * // TODO: open project view tool window if needed, when tool window state is also moved to recoil instead of local\n * //  state.\n */\nexport const selectKeyAndFocusCallback =\n  ({ snapshot }: CallbackInterface) =>\n  (key: Key) => {\n    const treeRef = snapshot\n      .getLoadable(projectViewTreeRefState)\n      .valueOrThrow()?.current;\n    treeRef?.replaceSelection(key);\n    treeRef?.focus(key);\n  };\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useRecoilCallback(expandToPathCallback, []);\n  const selectKeyAndFocus = useRecoilCallback(selectKeyAndFocusCallback, []);\n  return (path: string) => {\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","export const projectActionIds = {\n  NewElement: \"NewElement\",\n  NewFile: \"NewFile\",\n  NewDir: \"NewDir\",\n  CopyReferencePopupGroup: \"CopyReferencePopupGroup\",\n  CopyPaths: \"CopyPaths\",\n  CopyFileReference: \"CopyFileReference\",\n  CopyAbsolutePath: \"CopyAbsolutePath\",\n  CopySourceRootPath: \"CopySourceRootPath\",\n  CopyFileName: \"CopyFileName\",\n};\n","import {\n  ActionContext,\n  ActionsMenu,\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport React from \"react\";\nimport { projectActionIds } from \"../Project/projectActionIds\";\n\nexport function ProjectViewContextMenu({\n  getActionContext,\n}: {\n  getActionContext: () => ActionContext;\n}) {\n  return (\n    <ActionsMenu\n      aria-label=\"Project Tree actions\"\n      actionContext={getActionContext}\n      actions={[\n        {\n          ...useAction(projectActionIds.NewElement)!,\n          title: \"New\",\n          shortcut: undefined,\n        },\n        new DividerItem(),\n        useAction(CommonActionId.CUT),\n        useAction(CommonActionId.COPY),\n        useAction(projectActionIds.CopyReferencePopupGroup),\n        useAction(CommonActionId.PASTE),\n        new DividerItem(),\n        useAction(CommonActionId.DELETE),\n        new DividerItem(),\n      ].filter(notNull)}\n    />\n  );\n}\n","import {\n  ActionContext,\n  ContextMenuContainer,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectState,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeState,\n  expandedKeysState,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefState,\n  selectionState,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\nimport { ProjectViewContextMenu } from \"./ProjectViewContextMenu\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useRecoilValue(currentProjectState);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetRecoilState(projectViewTreeRefState);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const [treeState] = useLatestRecoilValue(currentProjectTreeState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectionState);\n  const foldersOnTop = useRecoilValue(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contextMenuTargetKey = useRef<string | undefined>();\n\n  /**\n   * A (temporary?) non-straightforward way to position popups (action groups with \"none\" menuPresentation\")\n   * relative to the tree node content.\n   * It's implemented like this because the context menu API at the moment is too generic and disconnected from\n   * components like Tree.\n   * At minimum, this logic here can be extracted into a wrapper like TreeContextMenuContainer for reusability.\n   */\n  const getActionContext = (): ActionContext => {\n    return {\n      element:\n        containerRef.current?.querySelector(\n          `[data-key=\"${contextMenuTargetKey.current}\"]`\n        ) ?? null,\n      event: null,\n    };\n  };\n\n  return (\n    <DefaultSuspense>\n      {treeState?.root && (\n        <ContextMenuContainer\n          ref={containerRef}\n          style={{ height: \"100%\" }}\n          onOpen={({ target }) =>\n            (contextMenuTargetKey.current =\n              target?.closest<HTMLElement>(\"[data-key]\")?.dataset.key)\n          }\n          renderMenu={() => {\n            return (\n              <ProjectViewContextMenu getActionContext={getActionContext} />\n            );\n          }}\n        >\n          <SpeedSearchTree\n            aria-label=\"Project structure tree\"\n            treeRef={treeRef}\n            {...activePathsProviderProps}\n            items={[treeState.root] as ProjectTreeNode[]}\n            onAction={(path) => {\n              editor.openPath(`${path}`);\n            }}\n            fillAvailableSpace\n            autoFocus\n            selectionMode=\"multiple\"\n            selectedKeys={selectedKeys}\n            onSelectionChange={setSelectedKeys}\n            expandedKeys={expandedKeys}\n            onExpandedChange={setExpandedKeys}\n          >\n            {(item) => (\n              <Item\n                key={item.path}\n                textValue={item.name}\n                childItems={\n                  \"children\" in item ? sortItems(item.children) : undefined\n                }\n              >\n                <ItemLayout>\n                  {<ProjectViewNodeIcon node={item} />}\n                  {item.type === \"project\" ? (\n                    <>\n                      <b>\n                        <HighlightedTextValue />\n                      </b>\n                      <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                    </>\n                  ) : (\n                    <FileTreeNodeText node={item} />\n                  )}\n                  {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n                </ItemLayout>\n              </Item>\n            )}\n          </SpeedSearchTree>\n        </ContextMenuContainer>\n      )}\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","import React from \"react\";\nimport {\n  Button,\n  ButtonProps,\n  HelpTooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nexport function HelpButton({\n  tooltip = \"Show help contents\",\n  ...props\n}: Omit<ButtonProps, \"variant\" | \"children\"> & { tooltip?: string }) {\n  return (\n    <TooltipTrigger tooltip={<HelpTooltip helpText={tooltip} />}>\n      <Button\n        variant=\"icon\"\n        aria-label=\"Help\"\n        aria-description=\"Show help contents\"\n        {...props}\n      >\n        <span style={{ fontSize: 18 }}>?</span>\n      </Button>\n    </TooltipTrigger>\n  );\n}\n","import path from \"path\";\nimport { identity } from \"ramda\";\n\nexport function isParentPath(parent: string, dir: string) {\n  return dir.startsWith(parent + path.sep); // is this good enough, or do we need the code below?\n  // const relative = path.relative(parent, dir);\n  // return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n}\n\n/**\n * Given a list of paths, returns a subset of them, where nested paths are removed.\n * @example findRoots(['/a/b/c/x.txt', '/a/b', '/a/b/c', '/a/b/y.ts']); // ['/a/b']\n * @example findRoots([{p: '/a/b'}, {p: '/a'}]); // [{p: '/a'}]\n */\nexport function findRootPaths(paths: readonly string[]): string[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string\n): T[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string = identity as (obj: T) => string\n): T[] {\n  return objects.filter((obj) => {\n    const thePath = getPath(obj);\n    return !objects.find(\n      (anObject) => anObject !== obj && isParentPath(getPath(anObject), thePath)\n    );\n  });\n}\n","import { CallbackInterface } from \"recoil\";\nimport {\n  refreshFileStatusCallback,\n  vcsRootForFile,\n} from \"../VersionControl/file-status.state\";\nimport { editorManagerState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\nimport git from \"isomorphic-git\";\nimport path from \"path\";\nimport { dirContentState, fileContentState } from \"../fs/fs.state\";\nimport { ensureDir } from \"../fs/fs-utils\";\n\nexport const deleteFileCallback =\n  (callbackInterface: CallbackInterface) => async (filepath: string) => {\n    const { refresh, reset, snapshot } = callbackInterface;\n    const refreshFileStatus = refreshFileStatusCallback(callbackInterface);\n    const releaseSnapshot = snapshot.retain();\n    try {\n      try {\n        await fs.promises.unlink(filepath);\n        const repoDir = await snapshot.getPromise(vcsRootForFile(filepath));\n        if (repoDir) {\n          await git.remove({\n            fs,\n            dir: repoDir,\n            filepath: path.relative(repoDir, filepath),\n          });\n          await refreshFileStatus(filepath); // TODO(fs.watch): better done separately using fs.watch\n        }\n      } catch (e) {\n        console.error(`error in deleting file ${filepath}`, e);\n      } finally {\n        const editor = await snapshot.getPromise(editorManagerState);\n        editor.closePath(filepath); // TODO(fs.watch): better done as an effect on editorState, using fs.watch. But fs.watch is not available at the moment.\n        refresh(dirContentState(path.dirname(filepath))); // TODO(fs.watch): better done separately using fs.watch\n        reset(fileContentState(filepath)); // TODO(fs.watch): better done separately using fs.watch\n      }\n    } finally {\n      releaseSnapshot();\n    }\n  };\n\nexport const deleteFilesCallback =\n  (callbackInterface: CallbackInterface) => async (filePaths: string[]) => {\n    // TODO: use task API\n    // An attempt to make this transactional failed, since it requires passing `set` and `reset` from transact function\n    // to deleteFileCallback, and {...callbackInterface, set, reset} didn't work , since callbackInterface is a proxy object\n    const deleteFile = deleteFileCallback(callbackInterface);\n    return Promise.all(filePaths.map(deleteFile));\n  };\n\nexport const deleteDirCallback =\n  (callbackInterface: CallbackInterface) => async (dir: string) => {\n    // TODO: use task API\n    const { refresh, reset, snapshot } = callbackInterface;\n    const deleteFile = deleteFileCallback(callbackInterface);\n    const releaseSnapshot = snapshot.retain();\n    const recursivelyDeleteDir = async (dirname: string) => {\n      const pathnames = await fs.promises.readdir(dirname);\n      await Promise.all(\n        pathnames.map(async (pathname) => {\n          const fullpath = path.resolve(dirname, pathname);\n          const stat = await fs.promises.stat(fullpath);\n          if (stat.isFile()) {\n            // potential improvement: refreshing dir content could wait until all files are deleted.\n            await deleteFile(fullpath);\n          } else if (stat.isDirectory()) {\n            await recursivelyDeleteDir(fullpath);\n          }\n        })\n      );\n      await fs.promises.rmdir(dirname);\n      refresh(dirContentState(dir));\n    };\n    try {\n      try {\n        await recursivelyDeleteDir(dir);\n      } catch (e) {\n        console.error(`error in deleting directory ${dir}`, e);\n      } finally {\n        refresh(dirContentState(path.dirname(dir))); // TODO(fs.watch): better done separately using fs.watch\n      }\n    } finally {\n      releaseSnapshot();\n    }\n  };\n\nexport const createFileCallback = (callbackInterface: CallbackInterface) => {\n  const refreshFileStatus = refreshFileStatusCallback(callbackInterface);\n  return async (destinationDir: string, filename: string) => {\n    const filePath = path.join(destinationDir, filename);\n    const { snapshot, refresh, reset } = callbackInterface;\n    const releaseSnapshot = snapshot.retain();\n    try {\n      await ensureDir(fs.promises, path.dirname(filePath));\n      if (await fs.promises.exists(filePath)) {\n        throw new Error(`File ${filePath} already exists`);\n      }\n      await fs.promises.writeFile(filePath, \"\", \"utf-8\");\n      reset(fileContentState(filePath)); // TODO(fs.watch): better done in an atom effect\n      (await snapshot.getPromise(editorManagerState)).openPath(filePath);\n      await refreshFileStatus(filePath);\n      refresh(dirContentState(destinationDir));\n    } finally {\n      releaseSnapshot();\n    }\n  };\n};\n\nexport const createDirectoryCallback = (\n  callbackInterface: CallbackInterface\n) => {\n  return async (destination: string, dirPath: string) => {\n    const { snapshot, refresh, reset } = callbackInterface;\n    const releaseSnapshot = snapshot.retain();\n    const fullpath = path.join(destination, dirPath);\n    try {\n      if (await fs.promises.exists(fullpath)) {\n        throw new Error(`File ${fullpath} already exists`);\n      }\n      await ensureDir(fs.promises, fullpath);\n      refresh(dirContentState(destination));\n    } finally {\n      releaseSnapshot();\n    }\n  };\n};\n","import path from \"path\";\nimport { selector } from \"recoil\";\nimport React from \"react\";\n\nimport {\n  ActionDefinition,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ModalWindow,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { HelpButton } from \"../../HelpButton\";\nimport {\n  activePathExistsState,\n  alertDialogRefState,\n  windowManagerRefState,\n} from \"../../Project/project.state\";\nimport { selectedNodesState } from \"../ProjectView.state\";\nimport { findRootPaths } from \"../../path-utils\";\nimport {\n  deleteDirCallback,\n  deleteFilesCallback,\n} from \"../../Project/fs-operations\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nconst dirCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 directory}\n    other {# directories}\n  }`,\n  \"en-US\"\n);\n\nexport const deleteActionState = selector({\n  key: `action.${CommonActionId.DELETE}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.DELETE,\n    title: \"Delete\",\n    description: \"Delete selected item\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      const deleteDir = getCallback(deleteDirCallback);\n      const deleteFiles = getCallback(deleteFilesCallback);\n      const selectedNodes = snapshot.getLoadable(selectedNodesState).getValue();\n      const windowManager = snapshot\n        .getLoadable(windowManagerRefState)\n        .getValue().current;\n      const alertDialog = snapshot\n        .getLoadable(alertDialogRefState)\n        .getValue().current;\n      if (selectedNodes.length === 0) {\n        return;\n      }\n      const nodesToDelete = findRootPaths(selectedNodes, (node) => node.path);\n      const filePaths = nodesToDelete\n        .filter((node) => node.type === \"file\")\n        .map((node) => node.path);\n      const directories = nodesToDelete\n        .filter((node) => node.type === \"project\" || node.type === \"dir\")\n        .map((node) => node.path);\n\n      if (directories.length > 0) {\n        const singleDirName =\n          directories.length === 1 && filePaths.length === 0\n            ? path.basename(directories[0])\n            : null;\n\n        const confirmed = await alertDialog?.confirm({\n          title: \"Delete\",\n          okText: \"Delete\",\n          message: (\n            <div style={{ width: 354 }}>\n              Delete{\" \"}\n              {singleDirName\n                ? `\"${singleDirName}\"`\n                : [\n                    { count: directories.length, message: dirCountMsg },\n                    { count: filePaths.length, message: fileCountMsg },\n                  ]\n                    .filter(({ count }) => count > 0)\n                    .map(({ message, count }) => message.format({ count }))\n                    .join(\" and \")}\n              ?\n              <br />\n              All files and subdirectories in\n              {singleDirName\n                ? ` \"${singleDirName}\" `\n                : \" the selected directories \"}\n              will be deleted. <br />\n              You might not be able to fully undo this operation!\n            </div>\n          ),\n        });\n        if (confirmed) {\n          directories.forEach((pathname) => deleteDir(pathname));\n          deleteFiles(filePaths);\n        }\n      } else {\n        windowManager\n          ?.open<boolean>(({ close }) => (\n            <DeleteFilesConfirmationDialog\n              filePaths={filePaths}\n              close={close}\n            />\n          ))\n          .then((confirmed) => {\n            if (confirmed) {\n              requestAnimationFrame(() => {\n                // It's important that the focus is restored to the previously focused item, which typically is the\n                // file in project view, that's being deleted.\n                // If the file is deleted before the focus is restored, the DOM element that was going to be focused\n                // will be removed by the time focus restoration logic runs.\n                // Even though `windowManager.open()` was changed to return a promise which is supposed to be resolved\n                // **after** the modal window is closed,\n                // in the CI environment the focus is not properly restored.\n                // In lack of a better solution, the deletion is done async with a setTimeout.\n                deleteFiles(filePaths);\n              });\n            }\n          });\n      }\n    }),\n  }),\n});\n\nfunction DeleteFilesConfirmationDialog({\n  close,\n  filePaths,\n}: {\n  close: (confirmed?: true) => void;\n  filePaths: string[];\n}) {\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Delete\"\n        content={\n          <form\n            id=\"delete_dialog_form\"\n            onSubmit={(e) => {\n              e.preventDefault();\n            }}\n            style={{\n              padding: \"0.75rem 1rem\",\n            }}\n          >\n            <div style={{ marginBottom: \".5rem\" }}>\n              {filePaths.length === 1\n                ? `Delete file \"${path.basename(filePaths[0])}\"`\n                : `Delete ${filePaths.length} files`}\n              ?\n            </div>\n            <div\n              style={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                gap: \"0.25rem\",\n              }}\n            >\n              <Checkbox isDisabled>Safe delete (with usage search)</Checkbox>\n              <div style={{ display: \"flex\", gap: \"1rem\" }}>\n                <Checkbox isDisabled>Search in comments and strings</Checkbox>\n                <Checkbox isDisabled>Search for text occurrences</Checkbox>\n              </div>\n            </div>\n          </form>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<HelpButton onPress={() => notImplemented()}></HelpButton>}\n            right={\n              <>\n                <Button onPress={() => close()}>Cancel</Button>\n                <Button\n                  autoFocus\n                  type=\"submit\"\n                  form=\"delete_dialog_form\" // Using form in absence of built-in support for default button\n                  variant=\"default\"\n                  onPress={() => {\n                    close(true);\n                  }}\n                >\n                  Ok\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport { selector } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsState } from \"../../Project/project.state\";\n\nexport const copyActionState = selector({\n  key: `action.${CommonActionId.COPY}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.COPY,\n    title: \"Copy\",\n    description: \"Copy to clipboard\",\n    icon: <PlatformIcon icon=\"actions/copy\" />,\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n    }),\n  }),\n});\n","import React from \"react\";\nimport { selector } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsState } from \"../../Project/project.state\";\n\nexport const cutActionState = selector({\n  key: `action.${CommonActionId.CUT}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.CUT,\n    title: \"Cut\",\n    description: \"Cut to clipboard\",\n    icon: <PlatformIcon icon=\"actions/menu-cut\" />,\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n    }),\n  }),\n});\n","import React from \"react\";\nimport { selector } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsState } from \"../../Project/project.state\";\n\nexport const pasteActionState = selector({\n  key: `action.${CommonActionId.PASTE}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.PASTE,\n    title: \"Paste\",\n    description: \"Paste from clipboard\",\n    icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n    }),\n  }),\n});\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport {\n  projectViewTreeRefState,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\nimport { deleteActionState } from \"./actions/deleteAction\";\nimport { copyActionState } from \"./actions/copyAction\";\nimport { cutActionState } from \"./actions/cutAction\";\nimport { pasteActionState } from \"./actions/pasteAction\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useRecoilValue(projectViewTreeRefState);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useRecoilValue(activeEditorTabState);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n    useRecoilValue(deleteActionState), // could have been on project level, if it could handle delete in editor as well\n    useRecoilValue(cutActionState),\n    useRecoilValue(copyActionState),\n    useRecoilValue(pasteActionState),\n  ].filter(notNull);\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React, { ReactNode, useEffect, useState } from \"react\";\n\nconst DEFAULT_LOADING_DELAY_MS = 500; // To be shared later in more places.\nexport function Delayed({ children }: { children: ReactNode }) {\n  const [waitedEnough, setWaitedEnough] = useState(false);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setWaitedEnough(true);\n    }, DEFAULT_LOADING_DELAY_MS);\n    return () => clearTimeout(timer);\n  }, []);\n  if (waitedEnough) {\n    return <>{children}</>;\n  }\n  return null;\n}\n","import { FileStatus } from \"../file-status\";\nimport { dirname } from \"path\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n  hash?: string;\n  content(): Promise<string>;\n};\n\ndeclare const __tag: unique symbol;\n\ntype ChangeVariant<T extends { type: string }> = T & {\n  /**\n   * A non-exported tag is used to make opaque types that can only be created by Change function, following\n   * \"parse, don't validate\" rule, enforcing certain rules that defines the change type based on the\n   * presence and properties of the before and after revisions.\n   */\n  readonly [__tag]: any;\n};\n\n/**\n * Represents a file being moved from one directory to another, which may or may not have been renamed too.\n */\nexport type MoveChange = ChangeVariant<{\n  type: \"MOVED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being renamed withing the same directory.\n */\nexport type RenameChange = ChangeVariant<{\n  type: \"RENAMED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being changed, but not moved or renamed.\n */\nexport type ModificationChange = ChangeVariant<{\n  type: \"MODIFIED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a path being deleted.\n */\nexport type DeletionChange = ChangeVariant<{\n  type: \"DELETED\";\n  before: Revision;\n}>;\n\n/**\n * Represents a new file\n */\nexport type AdditionChange = ChangeVariant<{\n  type: \"ADDED\";\n  after: Revision;\n}>;\n\n/**\n * Represents an unversioned (new) file. In git terms, a file that doesn't exist in index or HEAD.\n */\nexport type UnversionedChange = ChangeVariant<{\n  type: \"UNVERSIONED\";\n  after: Revision;\n}>;\n\nexport type AnyChange =\n  | AdditionChange\n  | MoveChange\n  | RenameChange\n  | ModificationChange\n  | DeletionChange\n  | UnversionedChange;\n\nconst Tagged = <T>(change: T): T & { [__tag]: any } =>\n  change as T & { [__tag]: any };\n\n/**\n * Creates change objects from before and after revisions. It creates the right type of change\n * depending on the presence and properties of `before` and `after` revisions.\n * Note: Use Change.Unversioned(revision) to create unversioned changes.\n */\nexport function Change(before: null, after: Revision): Readonly<AdditionChange>;\nexport function Change(before: Revision, after: null): Readonly<DeletionChange>;\nexport function Change(\n  before: Revision,\n  after: Revision\n): Readonly<ModificationChange | RenameChange | MoveChange>;\nexport function Change(\n  before: Revision | null,\n  after: Revision | null\n): AnyChange {\n  if (after) {\n    if (!before) {\n      return Tagged({\n        type: \"ADDED\",\n        after,\n      });\n    }\n    if (before.path !== after.path) {\n      if (dirname(before.path) === dirname(after.path)) {\n        return Tagged({\n          type: \"RENAMED\",\n          before,\n          after,\n        });\n      } else {\n        return Tagged({\n          type: \"MOVED\",\n          before,\n          after,\n        });\n      }\n    }\n    return Tagged({\n      type: \"MODIFIED\",\n      before,\n      after,\n    });\n  } else {\n    return Tagged({\n      type: \"DELETED\",\n      before: before!, // \"!\" because typescript has an issue recognizing after and before can't be null simultaneously\n    });\n  }\n}\n\n/**\n * Creates an unversioned change object\n */\nChange.Unversioned = (revision: Revision): UnversionedChange => {\n  return Tagged({\n    type: \"UNVERSIONED\",\n    after: revision,\n  });\n};\n\nconst changeToFileStatus: Record<AnyChange[\"type\"], FileStatus> = {\n  ADDED: \"ADDED\",\n  DELETED: \"DELETED\",\n  MOVED: \"MODIFIED\",\n  RENAMED: \"MODIFIED\",\n  MODIFIED: \"MODIFIED\",\n  UNVERSIONED: \"UNKNOWN\",\n};\n\n/**\n * @returns {@link FileStatus} corresponding to the change type\n */\nChange.fileStatus = function (change: AnyChange): FileStatus {\n  return changeToFileStatus[change.type] ?? \"NOT_CHANGED\";\n};\n\n/**\n * @returns the `after` path if the change is not a deletion, and `before` path, otherwise.\n */\nChange.path = function (change: AnyChange): string {\n  return Change.revision(change).path;\n};\n\nChange.content = function (change: AnyChange): Promise<string> {\n  if (\"after\" in change) {\n    return change.after.content();\n  }\n  if (\"before\" in change) {\n    return change.before.content();\n  }\n  return Promise.resolve(\"\");\n};\n\n/**\n * type-guard returning filter for addition change\n */\nChange.isAddition = function (change: AnyChange): change is AdditionChange {\n  return change.type === \"ADDED\";\n};\n\n/**\n * type-guard returning filter for deletion change\n */\nChange.isDeletion = function (change: AnyChange): change is DeletionChange {\n  return change.type === \"DELETED\";\n};\n\n/**\n * type-guard returning filter for rename change\n */\nChange.isRename = function (change: AnyChange): change is RenameChange {\n  return change.type === \"RENAMED\";\n};\n\n/**\n * type-guard returning filter for move change\n */\nChange.isMove = function (change: AnyChange): change is MoveChange {\n  return change.type === \"MOVED\";\n};\n\n/**\n * type-guard returning filter for modification change.\n */\nChange.isModified = function (change: AnyChange): change is ModificationChange {\n  return change.type === \"MODIFIED\";\n};\n\n/**\n * type-guard returning filter for unversioned change.\n */\nChange.isUnversioned = function (\n  change: AnyChange\n): change is UnversionedChange {\n  return change.type === \"UNVERSIONED\";\n};\n\n/**\n * @returns the `after` revision if the change is not a deletion, and `before` revision, otherwise.\n */\nChange.revision = function (change: AnyChange): Revision {\n  return \"after\" in change ? change.after : change.before;\n};\n\nChange.equals = function (a: AnyChange, b: AnyChange): boolean {\n  const sameBefore =\n    \"before\" in a && \"before\" in b\n      ? revisionEquals(a.before, b.before)\n      : \"before\" in a === \"before\" in b;\n  const sameAfter =\n    \"after\" in a && \"after\" in b\n      ? revisionEquals(a.after, b.after)\n      : \"after\" in a === \"after\" in b;\n  return sameBefore && sameAfter;\n};\n\nfunction revisionEquals(a: Revision, b: Revision) {\n  return a?.path === b?.path && a.isDir === b.isDir;\n}\n","import { selector, selectorFamily, useRecoilCallback } from \"recoil\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport git, { checkout, resetIndex } from \"isomorphic-git\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { fs } from \"../../fs/fs\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { editorManagerState } from \"../../Editor/editor.state\";\nimport {\n  repoStatusState,\n  useRefreshFileStatus,\n  vcsRootForFile,\n  vcsRootsState,\n} from \"../file-status.state\";\nimport { AnyChange, Change } from \"./Change\";\n\nconst repoChangesState = selectorFamily<AnyChange[], string>({\n  key: \"vcs.repoChanges\",\n  get:\n    (repoDir: string) =>\n    ({ get }) =>\n      Object.entries(get(repoStatusState(repoDir)))\n        .map<AnyChange | null>(([filename, status]) => {\n          const revision = {\n            path: path.join(repoDir, filename),\n            isDir: false,\n            content(): Promise<string> {\n              throw new Error(\"Not implemented\");\n            },\n          };\n          if (status === \"ADDED\") {\n            return Change(null, revision);\n          } else if (status === \"MODIFIED\") {\n            return Change(revision, revision);\n          } else if (status === \"DELETED\") {\n            return Change(revision, null);\n          } else if (status === \"UNKNOWN\") {\n            return Change.Unversioned(revision);\n          } else {\n            return null;\n          }\n        })\n        .filter(notNull),\n});\n\nexport const allChangesState = selector<ReadonlyArray<AnyChange>>({\n  key: \"vcs.allChanges\",\n  get: ({ get }) => {\n    return get(vcsRootsState)\n      .map(({ dir }) => get(repoChangesState(dir)))\n      .flat();\n  },\n});\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  const updateFileStatus = useRefreshFileStatus();\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (changes: readonly AnyChange[], deleteAddedFiles?: boolean) => {\n        const { snapshot, refresh } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n\n        const changesWithRepoRoots = (\n          await Promise.all(\n            changes\n              .filter((change) => !Change.revision(change).isDir)\n              .map(async (change) => {\n                const repoRoot = await snapshot.getPromise(\n                  vcsRootForFile(Change.path(change))\n                );\n                if (repoRoot) {\n                  return {\n                    repoRoot,\n                    change,\n                    relativePath: path.relative(repoRoot, Change.path(change)),\n                  };\n                }\n              })\n          )\n        ).filter(notNull);\n        const groupedChanges = groupBy(\n          ({ repoRoot }) => repoRoot,\n          changesWithRepoRoots\n        );\n        await Promise.all(\n          Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n            const { toReset = [], toCheckout = [] } = groupBy(\n              ({ change: { type } }) =>\n                type !== \"ADDED\" || deleteAddedFiles ? \"toCheckout\" : \"toReset\",\n              items\n            );\n            await Promise.allSettled(\n              toReset.map(({ relativePath }) =>\n                resetIndex({\n                  fs,\n                  dir: repoRoot,\n                  filepath: relativePath,\n                })\n              )\n            );\n            if (toCheckout.length > 0) {\n              const resolvedHead = await git\n                .resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" })\n                .catch(() => null);\n              if (resolvedHead) {\n                await checkout({\n                  fs,\n                  dir: repoRoot,\n                  force: true,\n                  filepaths: toCheckout.map(\n                    ({ relativePath, change: { type } }) => relativePath\n                  ),\n                });\n              } else {\n                // if the repository is just created, HEAD is not resolved, and checkout() throws, so we delete files\n                // manually in that case.\n                // TODO: another use case is detached HEAD, and it may need to be handled for non-addition changes?\n                await Promise.all(\n                  toCheckout\n                    .filter(({ change }) => change.type === \"ADDED\")\n                    .map(({ change }) => {\n                      const fullPath = Change.path(change);\n                      return fs.promises.unlink(fullPath);\n                    })\n                );\n              }\n            }\n            if (deleteAddedFiles) {\n              const editor = await snapshot.getPromise(editorManagerState);\n              changes.filter(Change.isAddition).forEach((change) => {\n                editor.closePath(Change.path(change)); // FIXME(fs.watch)\n              });\n            }\n\n            // FIXME(fs.watch)\n            const changedDirectories = findRootPaths(\n              items.flatMap(({ change }) => {\n                if (change.type === \"MODIFIED\") {\n                  // minor optimization\n                  return [];\n                }\n                if (change.type === \"MOVED\") {\n                  return [change.before.path, change.after.path];\n                }\n                return Change.path(change);\n              })\n            ).map(path.dirname);\n            changedDirectories.forEach((pathToRefresh) =>\n              refresh(dirContentState(pathToRefresh))\n            );\n\n            await Promise.allSettled(\n              items.map(async ({ relativePath, change }) => {\n                const fullPath = Change.path(change);\n                await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n                await resetIndex({ fs, dir: repoRoot, filepath: relativePath });\n                await updateFileStatus(fullPath);\n              })\n            );\n          })\n        );\n      },\n    []\n  );\n};\n","import {\n  atom,\n  selector,\n  useRecoilCallback,\n  useRecoilValue,\n  useSetRecoilState,\n} from \"recoil\";\nimport { useEffect } from \"react\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { allChangesState } from \"./changes.state\";\nimport { AnyChange, Change, UnversionedChange } from \"./Change\";\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: ReadonlyArray<AnyChange>;\n}\n\nexport const changeListsState = atom<ChangeListObj[]>({\n  key: \"changelists.lists\",\n  default: [\n    {\n      id: \"some-UUID\",\n      name: \"Changes\",\n      comment: \"last modified commit message\",\n      changes: [],\n      active: true,\n    },\n    {\n      id: \"some-other-UUID\",\n      name: \"Some other changelist\",\n      comment: \"Some empty changelist for testing\",\n      changes: [],\n      active: false,\n    },\n  ],\n});\n\nexport const activeChangeListState = selector<ChangeListObj | null>({\n  key: \"changelists.lists/default\",\n  get: ({ get }) =>\n    get(changeListsState).find((changeList) => changeList.active) ?? null,\n});\n\nexport const unversionedChangesState = selector<UnversionedChange[]>({\n  key: \"changelists.lists/unversioned\",\n  get: ({ get }) => get(allChangesState).filter(Change.isUnversioned),\n});\n\nexport const useSetActiveChangeList = () =>\n  useRecoilCallback(\n    ({ set, snapshot }) =>\n      (changeListId) => {\n        const changeLists = snapshot.getLoadable(changeListsState).getValue();\n        const targetChangeList = changeLists.find(\n          ({ id }) => id === changeListId\n        );\n        if (targetChangeList) {\n          set(\n            changeListsState,\n            changeLists.map((changeList) => ({\n              ...changeList,\n              active: changeList === targetChangeList,\n            }))\n          );\n        }\n        // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n      },\n    []\n  );\n\n/**\n * Helper component that keeps change lists state up-to-date with respect to changes.\n * It must be rendered at top level. Reasons for the unconventional implementation as a component\n * that must be rendered in top level:\n * - The *effects* API in recoil doesn't allow for this use case where one atom needs to be kept valid/up-to-date\n *   based on another atom. Changes here is the source of truth. Any removed changes should be removed from\n *   changelist(s) too, and any new change should be added to the active changelist\n * - The state of change lists is **not** just a 1:1 function of changes. So it can't be a selector. How changes are\n *   grouped in different lists is something that must have its own source of truth, but it needs validation,\n *   every time changes are added/removed.\n */\nexport function SyncChangeListsState() {\n  const changes = useRecoilValue(allChangesState);\n  const setChangeLists = useSetRecoilState(changeListsState);\n  useEffect(() => {\n    setChangeLists((changeLists) => {\n      const trackedChanges = changes.filter(\n        (change) => !Change.isUnversioned(change)\n      );\n      const updatedChangeLists = changeLists.map((changeList) => {\n        return {\n          ...changeList,\n          changes: changeList.changes\n            .map((change) =>\n              trackedChanges.find((aChange) => Change.equals(aChange, change))\n            )\n            .filter(notNull),\n        };\n      });\n      const existingChanges = updatedChangeLists.flatMap(\n        ({ changes }) => changes\n      );\n      const newChanges = trackedChanges.filter(\n        (change) =>\n          !existingChanges.find((anExistingChange) =>\n            Change.equals(change, anExistingChange)\n          )\n      );\n      const activeChangeList =\n        updatedChangeLists.find(({ active }) => active) ??\n        updatedChangeLists[0];\n      activeChangeList.changes.push(...newChanges);\n      return updatedChangeLists;\n    });\n  }, [changes]);\n  return null;\n}\n","import { identity, uniq } from \"ramda\";\nimport { getParentPaths } from \"../file-utils\";\n\nexport interface DirectoryNode {\n  type: \"directory\";\n  dirPath: string;\n  parentNodePath: string;\n  children: ReadonlyArray<any>;\n}\n\ntype GroupByDirectorAdapter<T, D extends DirectoryNode> = {\n  shouldCollapseDirectories?: boolean;\n  getPath: (node: T) => string;\n  /**\n   * Maps each processed node. E.g. can be used to enrich nodes with grouping metadata.\n   * @example\n   * ```\n   * mapNode: (node) => ({...node, isGroupedByDirectory: true})\n   * ```\n   */\n  mapNode?: (node: T) => T;\n  createDirectoryNode?: (dirNode: DirectoryNode) => D;\n};\n/**\n * Exported only for tests.\n * @internal\n */\nexport const createGroupByDirectory =\n  <T, D extends DirectoryNode>({\n    getPath,\n    mapNode = identity,\n    createDirectoryNode = (i) => i as D,\n    shouldCollapseDirectories = false,\n  }: GroupByDirectorAdapter<T, D>) =>\n  (nodes: ReadonlyArray<T>): readonly D[] => {\n    const pathToNodeCache: Record<string, D> = {};\n    const rootDirNodes = nodes.map(mapNode).map((node) => {\n      const filepath = getPath(node);\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(\n        filepath.startsWith(\"/\") ? filepath : `/${filepath}`\n      ).reduce((prevNode: D | T, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = createDirectoryNode({\n            type: \"directory\",\n            dirPath,\n            parentNodePath: \"\",\n            children: [],\n          });\n        }\n        if (isDirectoryNode(prevNode)) {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      }, node) as D; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const directoryNodes = uniq(rootDirNodes);\n    return shouldCollapseDirectories\n      ? directoryNodes.map((node) =>\n          collapseDirectories(createDirectoryNode, node)\n        )\n      : directoryNodes;\n  };\n\nfunction isDirectoryNode<T, D extends DirectoryNode>(node: D | T): node is D {\n  return \"type\" in node && node.type === \"directory\";\n}\n\nfunction collapseDirectories<T, D extends DirectoryNode>(\n  createDirectorNode: Required<\n    GroupByDirectorAdapter<T, any>\n  >[\"createDirectoryNode\"],\n  dirNode: D\n): D {\n  let { children, dirPath, parentNodePath } = dirNode;\n  if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n    dirPath = dirNode.children[0].dirPath;\n    children = dirNode.children[0].children.map((child: D | T) =>\n      isDirectoryNode<T, D>(child)\n        ? collapseDirectories<T, D>(createDirectorNode, {\n            ...child,\n            parentNodePath: dirPath,\n          })\n        : child\n    );\n    return collapseDirectories<T, D>(\n      createDirectorNode,\n      createDirectorNode({\n        type: \"directory\",\n        dirPath,\n        parentNodePath,\n        children,\n      })\n    );\n  }\n  return {\n    ...dirNode,\n    children: children.map((child) =>\n      isDirectoryNode(child)\n        ? collapseDirectories<T, D>(createDirectorNode, child)\n        : child\n    ),\n  };\n}\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { AnyChange, Change } from \"../Change\";\n\nexport interface ChangesTreeNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface ChangesTreeGroupNode<\n  T extends string,\n  C extends ChangesTreeNode<any> = ChangesTreeNode<T>\n> extends ChangesTreeNode<T> {\n  children: ReadonlyArray<C>;\n}\n\nexport type GroupNodes<T extends ChangesTreeNode<any>> = Extract<\n  T,\n  ChangesTreeGroupNode<any>\n>;\n\nexport interface ChangeNode extends ChangesTreeNode<\"change\"> {\n  change: AnyChange;\n  /**\n   * Whether to show the file path in front of the file name (in muted UI)\n   */\n  showPath?: boolean;\n}\n\nexport interface DirectoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"directory\", C> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"repo\", C> {\n  repository: VcsDirectoryMapping;\n}\n\n/**\n * Extends the type of changes tree nodes with additional (group) node types.\n */\nexport type ExtendedChangesTreeNode<G extends ChangesTreeGroupNode<any>> =\n  | ChangeNode\n  | RepositoryNode<G>\n  | DirectoryNode<G>\n  | G;\n\nexport type DefaultChangesTreeNode = ExtendedChangesTreeNode<never>;\nexport const changesTreeNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\n\nexport const getNodeKeyForChange = (change: AnyChange) =>\n  changesTreeNodeKey(\"change\", Change.path(change));\nexport const changeNode = (change: AnyChange, showPath = true): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n  showPath,\n});\nexport const directoryNode = <G extends ChangesTreeNode<any>>(\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly G[] = [],\n  keyPrefix: string = \"\"\n): DirectoryNode<G> => ({\n  type: \"directory\",\n  key: keyPrefix + changesTreeNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = <G extends ChangesTreeNode<any>>(\n  repository: VcsDirectoryMapping,\n  children: G[] = []\n): RepositoryNode<G> => ({\n  type: \"repo\",\n  key: changesTreeNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = <T extends ChangesTreeNode<any>>(\n  node: T\n): node is GroupNodes<T> => \"children\" in node;\nexport const isChangeNode = (node: ChangesTreeNode<any>): node is ChangeNode =>\n  node.type === \"change\";\nexport const isDirectoryNode = <G extends ChangesTreeNode<any>>(\n  node: ChangesTreeNode<any>\n): node is DirectoryNode<G> => node.type === \"directory\";\n\nexport const getChildren = <\n  T extends ChangesTreeNode<any> = DefaultChangesTreeNode\n>(\n  node: T\n): null | GroupNodes<T>[\"children\"] =>\n  isGroupNode(node) ? node.children : null;\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  ADD_UNVERSIONED: \"ChangesView.AddUnversioned\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n  GROUP_BY_DIRECTORY: \"ChangesView.GroupBy.Directory\",\n  GIT_ADD: \"Git.Add\",\n  GIT_INIT: \"Git.Init\",\n  GIT_CLONE: \"Git.Clone\",\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n\n  GIT_LOG_HIDE_BRANCHES: \"Git.Log.Hide.Branches\",\n  GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH:\n    \"Git.Log.Branches.Navigate.Log.To.Selected.Branch\",\n  GIT_UPDATE_SELECTED: \"Git.Update.Selected\",\n\n  FOCUS_TEXT_FILTER: \"Vcs.Log.FocusTextFilter\",\n  MATCH_CASE: \"Vcs.Log.MatchCaseAction\",\n  REG_EXP: \"Vcs.Log.EnableFilterByRegexAction\",\n  COPY_REVISION_NUMBER: \"Vcs.CopyRevisionNumberAction\",\n  LOG_REFRESH: \"Vcs.Log.Refresh\",\n  SHOW_DETAILS: \"Vcs.Log.ShowDetailsAction\",\n  SHOW_DIFF_PREVIEW: \"Vcs.Log.ShowDiffPreview\",\n  PRESENTATION_SETTINGS: \"Vcs.PresentationSettings\",\n  FILE_HISTORY_PRESENTATION_SETTINGS: \"Vcs.FileHistory.PresentationSettings\",\n\n  CopyPathFromRepositoryRootProvider: \"CopyPathFromRepositoryRootProvider\",\n};\n","import { GetRecoilValue, isRecoilValue, selector } from \"recoil\";\n\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { createGroupByDirectory } from \"../../../tree-utils/groupByDirectory\";\nimport { Change } from \"../Change\";\nimport {\n  changeNode,\n  ChangeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  directoryNode,\n  DirectoryNode,\n  isChangeNode,\n  isGroupNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./ChangeTreeNode\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { MaybeRecoilValue } from \"../../../recoil-utils\";\n\nexport type GroupFn<T extends ChangesTreeGroupNode<any>> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<\n  T extends ChangesTreeGroupNode<any>,\n  I = string\n> {\n  id: I;\n  title: string;\n  isAvailable: MaybeRecoilValue<boolean>;\n  useShortcutOf?: string;\n  groupFn: MaybeRecoilValue<GroupFn<T>>;\n}\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: selector({\n    key: \"repositoryGrouping/isAvailable\",\n    get: ({ get }) => get(vcsRootsState).length > 1,\n  }),\n  groupFn: selector({\n    key: \"repositoryGrouping/groupFn\",\n    get:\n      ({ get }: { get: GetRecoilValue }) =>\n      (nodes: ReadonlyArray<ChangeNode>) => {\n        const repos = get(vcsRootsState);\n        return repos.map(\n          (repository): RepositoryNode =>\n            repositoryNode(\n              repository,\n              nodes.filter((node) =>\n                Change.path(node.change)?.startsWith(repository.dir)\n              )\n            )\n        );\n      },\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: true,\n  useShortcutOf: VcsActionIds.GROUP_BY_DIRECTORY,\n  groupFn: createGroupByDirectory<ChangeNode, DirectoryNode>({\n    shouldCollapseDirectories: true,\n    createDirectoryNode: ({ dirPath, parentNodePath, children }) =>\n      directoryNode(dirPath, parentNodePath, children),\n    mapNode: (node) => changeNode(node.change, false),\n    getPath: (node) => Change.path(node.change),\n  }),\n};\n\nexport const defaultChangeGroupings: ReadonlyArray<\n  ChangeGrouping<DirectoryNode | RepositoryNode, \"directory\" | \"repository\">\n> = [repositoryGrouping, directoryGrouping];\n\nexport const defaultChangeGroupingsState = selector<\n  ReadonlyArray<Omit<typeof defaultChangeGroupings[number], \"isAvailable\">>\n>({\n  key: \"changes.availableGroupings\",\n  get: ({ get }) =>\n    defaultChangeGroupings.filter((grouping) =>\n      isRecoilValue(grouping.isAvailable)\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    ),\n});\n\nexport const recursiveGrouping = <T extends ChangesTreeNode<any>>(\n  groupingFns: Array<GroupFn<any>> /* Typing could be improved? */,\n  nodes: ReadonlyArray<ChangeNode>\n): ReadonlyArray<T> | ReadonlyArray<ChangeNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes;\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n\n  const changeNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isChangeNode\n  );\n  const groupNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isGroupNode\n  );\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\n/**\n * returns a function that accepts a `keyPrefix` and creates change grouping function based on the\n * passed {@param groupings}, in a way that the key of each grouping node is prefixed with the `keyPrefix`.\n * Useful for grouping changes under some root nodes with potentially overlapping groups. E.g. the same\n * folder or repository node may appear under different changeLists.\n */\nexport const getPrefixedChangesGroupFn =\n  <G extends ChangesTreeGroupNode<any>>({\n    get,\n    isActive,\n    groupings,\n  }: {\n    get: GetRecoilValue;\n    isActive: (groupingId: string) => MaybeRecoilValue<boolean>;\n    groupings: ReadonlyArray<ChangeGrouping<G, any>>;\n  }) =>\n  (keyPrefix: string) => {\n    const resolve = <T>(value: MaybeRecoilValue<T>): T =>\n      isRecoilValue(value) ? get(value) : value;\n    const groupFns = groupings\n      .filter(\n        ({ id, isAvailable }) => resolve(isAvailable) && resolve(isActive(id))\n      )\n      .map(({ groupFn }) => {\n        return resolve(groupFn);\n      })\n      .map<GroupFn<any>>((groupFn) =>\n        keyPrefix\n          ? (...args) =>\n              groupFn(...args).map((group) => ({\n                ...group,\n                key: `${keyPrefix}:${group.key}`,\n              }))\n          : groupFn\n      );\n    return (changes: readonly ChangeNode[]) =>\n      recursiveGrouping<G>(groupFns, changes);\n  };\n\nexport const getChangesGroupFn = (\n  ...args: Parameters<typeof getPrefixedChangesGroupFn>\n) => getPrefixedChangesGroupFn(...args)(\"\");\n","import { atom, selector } from \"recoil\";\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { AnyChange } from \"../Change\";\n\nconst isOpen = atom<boolean>({\n  key: \"rollbackView.isOpen\",\n  default: false,\n});\nconst windowBounds = atom<Partial<Bounds>>({\n  key: \"rollbackView.windowBounds\",\n  default: { height: 500 },\n});\nconst initiallyIncludedChanges = atom<ReadonlyArray<AnyChange>>({\n  key: \"rollbackView.initiallySelectedChanges\",\n  default: [],\n});\nconst rootNodes = selector({\n  key: \"rollbackView.includedRootNodes\",\n  get: ({ get }) => {\n    const selectedChanges = get(initiallyIncludedChanges);\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedRootNodes = rootNodes.filter(\n      (node) =>\n        node.type === \"changelist\" &&\n        selectedChanges.some((change) =>\n          node.changeList.changes.includes(change)\n        )\n    );\n    if (includedRootNodes.length === 0) {\n      return rootNodes.filter(\n        (node) => node.type === \"changelist\" && node.changeList.active\n      );\n    }\n    return includedRootNodes;\n  },\n});\nconst initiallyExpandedKeys = selector({\n  key: \"rollbackView.initiallyExpandedKeys\",\n  get: ({ get }) => {\n    const includedChanges = get(initiallyIncludedChanges);\n    const nodes = get(rootNodes);\n    const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n      (node) => (isGroupNode(node) ? node.children : null),\n      (node) => node.key,\n      nodes,\n      includedChanges.map(getNodeKeyForChange)\n    );\n    return new Set(\n      expandedKeys.length\n        ? expandedKeys\n        : getExpandAllKeys<ChangesViewTreeNode>(\n            (node) => (isGroupNode(node) ? node.children : null),\n            (node) => node.key,\n            nodes\n          )\n    );\n  },\n});\n\nexport const rollbackViewState = {\n  isOpen,\n  windowBounds,\n  initiallyExpandedKeys,\n  initiallyIncludedChanges,\n  rootNodes,\n};\n","import { Key } from \"react\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { ChangesTreeNode, getChildren } from \"./ChangeTreeNode\";\n\nexport function changesTreeNodesResult<\n  T extends ReadonlyArray<ChangesTreeNode<any>>\n>(\n  rootNodes: T\n): {\n  rootNodes: ReadonlyArray<T[number]>;\n  byKey: Map<Key, T[number]>;\n  expandAllKeys: Set<Key>;\n  fileCountsMap: Map<Key, number>;\n} {\n  const fileCountsMap = new Map();\n  const byKey = new Map();\n  const expandAllKeys = new Set<Key>();\n\n  dfsVisit<ChangesTreeNode<any>, number>(\n    getChildren,\n    (node, childrenFileCount) => {\n      byKey.set(node.key, node);\n      if (\"children\" in node) {\n        expandAllKeys.add(node.key);\n      }\n      if (!childrenFileCount) {\n        return 1;\n      }\n      const fileCount = childrenFileCount.reduce(\n        (total, count) => total + count,\n        0\n      );\n      fileCountsMap.set(node.key, fileCount);\n      return fileCount;\n    },\n    rootNodes\n  );\n  return { rootNodes, fileCountsMap, byKey, expandAllKeys };\n}\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { atom, atomFamily, CallbackInterface, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  ChangeListObj,\n  changeListsState,\n  unversionedChangesState,\n} from \"../change-lists.state\";\nimport {\n  defaultChangeGroupings,\n  defaultChangeGroupingsState,\n  getPrefixedChangesGroupFn,\n  GroupFn,\n} from \"../ChangesTree/changesGroupings\";\nimport {\n  bfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsState } from \"../../../Project/project.state\";\nimport {\n  ChangeNode,\n  changeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n  getNodeKeyForChange,\n  GroupNodes,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { Task } from \"../../../tasks\";\nimport { AnyChange, Change } from \"../Change\";\nimport { changesTreeNodesResult } from \"../ChangesTree/changesTreeNodesResult\";\nimport { allChangesState } from \"../changes.state\";\n\nexport interface ChangeListNode<\n  C extends ChangesTreeNode<any> = ChangesViewTreeNode\n> extends ChangesTreeGroupNode<\"changelist\", C> {\n  changeList: ChangeListObj;\n}\nexport interface UnversionedChangesNode<\n  C extends ChangesTreeNode<any> = ChangeNode\n> extends ChangesTreeGroupNode<\"unversioned\", C> {}\n\nexport type ChangesViewTreeNode = ExtendedChangesTreeNode<\n  ChangeListNode | UnversionedChangesNode\n>;\n\nexport const changeListNode = (\n  changeList: ChangeListObj\n): ChangeListNode<ChangeNode> => ({\n  type: \"changelist\",\n  key: changesTreeNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: changeList.changes.map((change) => changeNode(change)),\n});\n\nexport const showIgnoredFilesState = atom({\n  key: \"changesView/showIgnoredFiles\",\n  default: false,\n});\n\nexport const showRelatedFilesState = atom({\n  key: \"changesView/showRelatedFiles\",\n  default: false,\n});\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = typeof defaultChangeGroupings[number][\"id\"];\n\nexport const changesGroupingActiveState = atomFamily<boolean, string>({\n  key: \"changesView/isGroupingActive\",\n  default: true, // it's false in IntelliJ\n});\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysState = atom<Selection>({\n  key: \"changesView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\n/**\n * Same as {@link selectedKeysState}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysState = selector<Set<Key>>({\n  key: \"changesView.resolvedSelectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectedKeysState);\n    if (selection === \"all\") {\n      const { rootNodes } = get(changesTreeNodesState);\n      return new Set(\n        bfsVisit<ChangesViewTreeNode, ChangesViewTreeNode[]>(\n          (node) => (\"children\" in node ? node.children : []),\n          (node, parentValue) => {\n            const nodes = parentValue ?? [];\n            nodes.push(node);\n            return nodes;\n          },\n          rootNodes\n        )\n          .flat()\n          .map((node) => node.key)\n      );\n    }\n    return selection;\n  },\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysState}\n */\nconst selectedNodesState = selector<ReadonlySet<ChangesViewTreeNode>>({\n  key: \"changesView.selectedNodes\",\n  get: ({ get }) => {\n    const selectedKeys = get(resolvedSelectedKeysState);\n    const { byKey } = get(changesTreeNodesState);\n    return new Set(\n      [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n    );\n  },\n});\n\nexport const changesUnderSelectedKeys = selector<ReadonlySet<AnyChange>>({\n  key: \"changesView.selectedKeys.changes\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChanges: Set<AnyChange> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  },\n});\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = selector<ReadonlySet<ChangeListObj>>({\n  key: \"changesView.selectedChangeLists\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChangeLists = get(changeListsState);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  },\n});\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysState = atom<Set<string>>({\n  key: \"changesView.includedChangeKeys\",\n  default: new Set<string>([]),\n});\n\nexport const includedChangesState = selector<ReadonlyArray<AnyChange>>({\n  key: \"changesView.includedChanges\",\n  get: ({ get }) => {\n    const includedChangeKeys = get(includedChangeKeysState);\n    const allChanges = get(allChangesState);\n    return allChanges.filter((change) =>\n      includedChangeKeys.has(getNodeKeyForChange(change))\n    );\n  },\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelection = selector<\n  NestedSelectionState<ChangesViewTreeNode>\n>({\n  key: \"changesView.selectedChanges.nestedSelectionState\",\n  get: ({ get, getCallback }) => {\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedChangeKeys = get(includedChangeKeysState);\n    const setSelectedKeys = getCallback(\n      ({ set }) =>\n        (setValue: (currentValue: Set<string>) => Set<string>) =>\n          set(includedChangeKeysState, setValue)\n    );\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface(setSelectedKeys),\n      },\n      {\n        rootNodes,\n        getChildren: (item: ChangesViewTreeNode) =>\n          isGroupNode<ChangesViewTreeNode>(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n});\n\nexport const expandedKeysState = atom<Selection>({\n  key: \"changesView.expandedKeys\",\n  default: selector({\n    key: \"changesView.expandedKeys/temporaryDefault\",\n    get: ({ get }) => {\n      return new Set<Key>(\n        get(changesTreeNodesState)\n          .rootNodes.map((node) => [\n            node.key,\n            ...node.children.map((child) => child.key),\n          ])\n          .flat()\n      );\n    },\n  }),\n});\n\nexport const changesViewGroupingsState = selector({\n  key: \"changes.groupings\",\n  get: ({ get, getCallback }) =>\n    get(defaultChangeGroupingsState).map((grouping) => ({\n      ...grouping,\n      isActive: get(changesGroupingActiveState(grouping.id)),\n    })),\n});\n\nconst groupChildren = <\n  T extends ChangesTreeGroupNode<any, ChangeNode>,\n  G extends ChangesTreeNode<any>\n>(\n  node: T,\n  groupFn: (\n    nodes: ReadonlyArray<ChangeNode>\n  ) => ReturnType<GroupFn<GroupNodes<G>>> | ReadonlyArray<ChangeNode>\n) => ({\n  ...node,\n  children: groupFn(node.children),\n});\n\nexport const changesTreeNodesState = selector<{\n  rootNodes: ReadonlyArray<ChangeListNode | UnversionedChangesNode>;\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, ChangesViewTreeNode>;\n}>({\n  key: \"changesView.treeNodes\",\n  get: ({ get }) => {\n    const changeListNodes = sortBy(\n      ({ active }) => !active,\n      get(changeListsState)\n    ).map(changeListNode);\n    const prefixedGroupFn = getPrefixedChangesGroupFn({\n      get,\n      groupings: defaultChangeGroupings,\n      isActive: changesGroupingActiveState,\n    });\n    const unversionedChanges = get(unversionedChangesState);\n    const rootNodes: Array<ChangeListNode | UnversionedChangesNode> =\n      changeListNodes.map((changeListNode) =>\n        groupChildren(changeListNode, prefixedGroupFn(changeListNode.key))\n      );\n    if (unversionedChanges.length > 0) {\n      const unversionedChangesNode: UnversionedChangesNode = {\n        key: \"unversioned\",\n        type: \"unversioned\",\n        children: unversionedChanges.map((change) => changeNode(change)),\n      };\n      rootNodes.push(\n        groupChildren(unversionedChangesNode, prefixedGroupFn(\"unversioned\"))\n      );\n    }\n    return changesTreeNodesResult(rootNodes);\n  },\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily<\n  number,\n  \"horizontal\" | \"vertical\"\n>({\n  key: \"changesView/splitter/commitMessageSize\",\n  default: (orientation) => (orientation === \"horizontal\" ? 0.4 : 0.3),\n});\n/**\n * Whether --amend should be used for commit.\n */\nexport const amendCommitState = atom({\n  key: \"changesView/amendCommit\",\n  default: false,\n  // TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n  // it should add a record to the commit message history and switch the message. When toggled to false,\n  // last entry in history should be back again. There is currently no history :D\n});\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageState = atom({\n  key: \"changesView/commitMessage\",\n  default: \"\",\n});\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageState = atom({\n  key: \"changesView/commitErrorMessage\",\n  default: \"\",\n});\n\nexport const commitTaskIdState = atom<Task[\"id\"] | null>({\n  key: \"changesView/commitTaskId\",\n  default: null,\n});\n\nexport const changesFromActivePathsState = selector({\n  key: \"changesView/changesFromActivePaths\",\n  get: ({ get }) => {\n    const activePaths = get(activePathsState);\n    return get(allChangesState).filter((change) =>\n      activePaths.some((activePath) =>\n        Change.path(change).startsWith(activePath)\n      )\n    );\n  },\n});\n\n/**\n * Recoil callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = ({ set, snapshot }: CallbackInterface) => {\n  /**\n   * @param paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  return (paths?: string[]) => {\n    const changes = paths\n      ? snapshot\n          .getLoadable(allChangesState)\n          .getValue()\n          .filter((change) =>\n            paths.some((activePath) =>\n              Change.path(change).startsWith(activePath)\n            )\n          )\n      : snapshot.getLoadable(changesFromActivePathsState).getValue();\n\n    const includedChangeKeys = changes.map(getNodeKeyForChange);\n    set(includedChangeKeysState, new Set(includedChangeKeys));\n    if (includedChangeKeys.length > 0) {\n      const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n        (node) =>\n          isGroupNode<ChangesViewTreeNode>(node) ? node.children : null,\n        (node) => node.key,\n        snapshot.getLoadable(changesTreeNodesState).getValue().rootNodes,\n        includedChangeKeys\n      );\n      set(expandedKeysState, (currentExpandedKeys) => {\n        return new Set([\n          ...(currentExpandedKeys !== \"all\"\n            ? currentExpandedKeys\n            : new Set<Key>()),\n          ...expandedKeys,\n        ]);\n      });\n      set(selectedKeysState, new Set([includedChangeKeys[0]]));\n    }\n  };\n};\n\nexport const openRollbackWindowForSelectionCallback = ({\n  set,\n  snapshot,\n}: CallbackInterface) => {\n  /**\n   * If contextual is true, changes related to {@link activePathsState} will be preselected.\n   */\n  return (contextual = true) => {\n    const activePaths = snapshot.getLoadable(activePathsState).getValue();\n    const changesUnderSelection = snapshot\n      .getLoadable(changesUnderSelectedKeys)\n      .getValue();\n    const changesBasedOnActivePaths =\n      contextual && activePaths.length > 0\n        ? snapshot.getLoadable(changesFromActivePathsState).getValue()\n        : null;\n    set(\n      rollbackViewState.initiallyIncludedChanges,\n      changesBasedOnActivePaths ?? [...changesUnderSelection]\n    );\n    set(rollbackViewState.isOpen, true);\n  };\n};\n","import { useRecoilValue } from \"recoil\";\nimport { selectedKeysState } from \"./ChangesView.state\";\nimport {\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Changes actions\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(CommonActionId.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: readonly T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { equals, groupBy } from \"ramda\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilValue,\n} from \"recoil\";\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\n\nimport { fs } from \"../../fs/fs\";\nimport { vcsRootForFile, vcsRootsState } from \"../file-status.state\";\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsState } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { persistentAtomEffect } from \"../../Project/persistence/persistentAtomEffect\";\nimport { ensureArray, MaybeArray } from \"../../ensureArray\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\nexport type BranchType = \"LOCAL\" | \"REMOTE\";\n\nexport type BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesState = selectorFamily<LocalBranch[], string>({\n  key: \"vcs/repoLocalBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({}) => {\n      const branches = await git.listBranches({ fs, dir: repoRoot });\n      return Promise.all(\n        branches.map(async (branch) => ({\n          name: branch,\n          trackingBranch: await getTrackingBranch({\n            fs,\n            dir: repoRoot,\n            localBranchName: branch,\n          }),\n        }))\n      );\n    },\n});\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesState = selectorFamily({\n  key: \"vcs/repoRemoteBranches\",\n  get: (repoRoot: string) => async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  },\n});\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesState = selectorFamily<RepoBranches, string>({\n  key: \"vcs/repoBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({ get }) => {\n      const currentBranchName = get(repoCurrentBranchNameState(repoRoot));\n      let localBranches = get(repoLocalBranchesState(repoRoot));\n      if (localBranches.length === 0 && currentBranchName) {\n        // When a repo is initialized and before the first commit, no branch is returned when listing branches.\n        // See more: https://github.com/isomorphic-git/isomorphic-git/issues/1650\n        localBranches = localBranches.concat({\n          name: currentBranchName,\n          trackingBranch: null,\n        });\n      }\n      return {\n        repoRoot,\n        currentBranch:\n          localBranches.find((branch) => branch.name === currentBranchName) ||\n          null,\n        localBranches: localBranches,\n        remoteBranches: get(repoRemoteBranchesState(repoRoot)),\n      };\n    },\n});\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameState = selectorFamily({\n  key: \"vcs/repoCurrentBranch\",\n  get: (repoRoot: string) => () => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  },\n});\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesState = selector<RepoBranches[]>({\n  key: \"vcs/allBranches\",\n  get: ({ get }) => {\n    const repoRoots = get(vcsRootsState);\n    return repoRoots.map(({ dir: repoRoot }) =>\n      get(repoBranchesState(repoRoot))\n    );\n  },\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathState = selectorFamily<string | null, string>({\n  key: \"gitBranchForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      const root = get(vcsRootForFile(filepath));\n      console.log(\n        `repo root for ${filepath}`,\n        root,\n        root && get(repoBranchesState(root))\n      );\n      return root\n        ? get(repoBranchesState(root)).currentBranch?.name || null\n        : null;\n    },\n});\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\ninterface BranchStorage {\n  map: MaybeArray<{\n    entry: {\n      \"@type\": \"LOCAL\" | \"REMOTE\";\n      value: {\n        list: MaybeArray<{\n          \"branch-info\": {\n            \"@repo\": string;\n            \"@source\": string;\n          };\n        }>;\n      };\n    };\n  }>;\n}\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\ninterface GitSettingsStorage {\n  \"favorite-branches\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n  \"exclude-from-favorite\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n}\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    ensureArray(branchStorage?.map).flatMap<BranchInfo>((entry) =>\n      ensureArray(entry?.entry.value.list).map(\n        ({ \"branch-info\": { \"@source\": branchName, \"@repo\": repoRoot } }) => ({\n          branchType: entry?.entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction toBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      entry: {\n        \"@type\": branchType as BranchType,\n        value: {\n          list: branches.map((branch) => ({\n            \"branch-info\": {\n              \"@repo\": branch.repoRoot,\n              \"@source\": branch.branchName,\n            },\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: entries,\n  };\n}\n\nconst branchInfoArrayChecker = array(\n  object({\n    branchType: union(literal(\"LOCAL\"), literal(\"REMOTE\")),\n    branchName: string(),\n    repoRoot: string(),\n  })\n);\n\nconst favoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"favorite-branches\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nexport const isFavoriteBranchState = selectorFamily({\n  key: \"vcs/branches/isFavorite\",\n  get:\n    (branchInfo: BranchInfo) =>\n    ({ get }) => {\n      return isFavorite(\n        get(favoriteBranchesState),\n        get(excludedFromFavoriteBranchesState),\n        branchInfo\n      );\n    },\n});\n\nconst excludedFromFavoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite-excluded\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"exclude-from-favorite\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      (\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          snapshot.getLoadable(favoriteBranchesState).getValue(),\n          snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesState, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesState, add);\n          }\n        } else {\n          set(favoriteBranchesState, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesState, add);\n          }\n        }\n      },\n    []\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useRecoilValue(favoriteBranchesState);\n  const excludedFromFavoriteBranches = useRecoilValue(\n    excludedFromFavoriteBranchesState\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string, checkout: boolean = true) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            refresh(repoBranchesState(repoRoot));\n          }\n        );\n      },\n    []\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useRecoilCallback(\n    ({ refresh, snapshot }) =>\n      async (repoRoot: string, branchName: string, newBranchName: string) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            snapshot.getLoadable(favoriteBranchesState).getValue(),\n            snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n    []\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (repoRoot: string, branchName: string, remote?: string) => {\n        const { refresh, snapshot, set } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        refresh(dirContentState(repoRoot));\n        const openedFiles = snapshot.getLoadable(editorTabsState).getValue();\n        const existingOpenedFile = await asyncFilter(async ({ filePath }) => {\n          const exists = await fs.promises.exists(filePath); // should it be fs directly?\n          // the file content for files not open in the editor also need to be updated. TODO(fs.watch)\n          if (exists) {\n            await reloadFileFromDisk(filePath);\n          }\n          return exists;\n        }, openedFiles);\n        set(editorTabsState, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n    []\n  );\n}\n\nexport function useDeleteBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string) => {\n        return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n          refresh(repoBranchesState(repoRoot));\n        });\n      },\n    []\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathState } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useRecoilValue(branchForPathState(repo.dir));\n  return <>{branch}</>;\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React, { ForwardedRef, HTMLAttributes } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.2rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useRecoilValue(vcsRootsState).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = React.forwardRef(\n  (\n    {\n      rootPath,\n      ...props\n    }: {\n      rootPath: string;\n    } & HTMLAttributes<HTMLSpanElement>,\n    ref: ForwardedRef<HTMLElement>\n  ) => (\n    <StyledRepoColorSquare\n      ref={ref}\n      {...props}\n      style={{ ...props.style, backgroundColor: useRepoRootColor(rootPath) }}\n    />\n  )\n);\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(\n      // FIXME: color-mix algorithm used here seems to be different from how colors are mixed in the reference impl.\n      `color-mix(in srgb, ${theme.color(\n        \"VersionControl.Log.Commit.currentBranchBackground\",\n        theme.dark ? \"rgb(63, 71, 73)\" : \"rgb(228, 250, 255)\"\n      )}, ${theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )} ${\n        (theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08) * 100\n      }%)`\n    )};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport path from \"path\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { RepoColorIcon } from \"../StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"../StyledCurrentBranchTag\";\nimport { Change } from \"../Change\";\nimport {\n  ChangeNode,\n  ChangesTreeNode,\n  DefaultChangesTreeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./ChangeTreeNode\";\nimport { StatusColor } from \"../../FileStatusColor\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\nexport type NodeRenderer<T extends ChangesTreeNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nexport function formatFileCount(fileCount: number) {\n  return fileCountMsg.format({ fileCount });\n}\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeRenderer: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  return (\n    <ItemLayout.Hint>\n      {node.showPath && path.dirname(Change.path(node.change))}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeRenderer: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(Change.path(node.change)),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(Change.path(node.change))} />\n      <StatusColor status={Change.fileStatus(node.change)}>\n        <HighlightedTextValue />\n      </StatusColor>\n      {Change.isRename(node.change)\n        ? ` - renamed from ${path.basename(node.change.before.path)}`\n        : Change.isMove(node.change) &&\n          ` - moved from ${path\n            .relative(\n              path.dirname(node.change.after.path),\n              path.dirname(node.change.before.path)\n            )\n            .replace(/(\\.\\.\\/){2,}[!.]/g, \"..\")}/`}\n\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\ntype NodeRenderersMap<T extends ChangesTreeNode<any>> = {\n  [type in T[\"type\"]]: NodeRenderer<T & { type: type }>;\n};\n\nconst defaultNodeRenderers: NodeRenderersMap<DefaultChangesTreeNode> = {\n  repo: repoNodeRenderer,\n  directory: directoryNodeRenderer,\n  change: changeNodeRenderer,\n};\n\nexport const simpleGroupingRenderer =\n  <T extends ChangesTreeNode<any>>(\n    getText: (node: T) => string\n  ): NodeRenderer<T> =>\n  (node, { fileCount }) => ({\n    textValue: getText(node),\n    rendered: (\n      <ItemLayout>\n        <HighlightedTextValue />\n        <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      </ItemLayout>\n    ),\n  });\n\nexport const createChangesTreeNodeRenderer = <T extends ChangesTreeNode<any>>(\n  renderers: Omit<\n    NodeRenderersMap<T>,\n    keyof NodeRenderersMap<DefaultChangesTreeNode>\n  >,\n  /**\n   * Not so nice signature, but couldn't make it work with a single argument in a way that:\n   * - allows for optionally overriding the default renderers\n   * - infers the type of the resulting renderer based on additional keys passed in `renderers`\n   */\n  defaultRendererOverrides?: Partial<NodeRenderersMap<DefaultChangesTreeNode>>\n) => {\n  const nodeRenderers: NodeRenderersMap<T> = {\n    ...defaultNodeRenderers,\n    ...defaultRendererOverrides,\n    ...renderers,\n  };\n  const getItemProps = ({\n    node,\n    fileCountsMap,\n  }: {\n    node: T;\n    fileCountsMap: Map<Key, number>;\n  }): ItemProps<T> & { key: Key } => {\n    // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n    // to node types\n    const nodeRenderer: NodeRenderer<T> =\n      nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n    const { textValue, rendered } = nodeRenderer(node, {\n      fileCount: fileCountsMap.get(node.key) || 0,\n      dirCount: 0, // It seems it's only used for ignored files subtree\n    });\n    return {\n      key: node.key,\n      childItems: isGroupNode(node) ? (node.children as T[]) : [],\n      hasChildItems: isGroupNode(node) && node.children?.length > 0,\n      textValue,\n      children: rendered,\n    };\n  };\n  return {\n    getItemProps,\n    getTextValue: (\n      node: T,\n      { fileCountsMap }: { fileCountsMap: Map<Key, number> }\n    ) => {\n      const nodeRenderer: NodeRenderer<T> =\n        nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n      return nodeRenderer(node, {\n        fileCount: fileCountsMap.get(node.key) || 0,\n        dirCount: 0, // It seems it's only used for ignored files subtree\n      }).textValue;\n    },\n    itemRenderer:\n      ({ fileCountsMap }: { fileCountsMap: Map<Key, number> }) =>\n      (node: T) =>\n        <Item {...getItemProps({ node, fileCountsMap })} />,\n  };\n};\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n} from \"../ChangesTree/changesTreeNodeRenderers\";\nimport { repoStatusUpdatingState } from \"../../file-status.state\";\nimport { Delayed } from \"../../../Delayed\";\nimport {\n  ChangeListNode,\n  ChangesViewTreeNode,\n  UnversionedChangesNode,\n} from \"./ChangesView.state\";\n\nconst changeListNodeRenderer: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nconst unversionedChangesNodeRenderer: NodeRenderer<UnversionedChangesNode> = (\n  _node,\n  { fileCount }\n) => ({\n  textValue: \"Unversioned Files\",\n  rendered: (\n    <ItemLayout>\n      <HighlightedTextValue />\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nfunction LoadingText() {\n  const loading = useRecoilValue(repoStatusUpdatingState);\n  return <>{loading && <Delayed>, updating...</Delayed>}</>;\n}\n\nexport const changesViewTreeNodeRenderer =\n  createChangesTreeNodeRenderer<ChangesViewTreeNode>({\n    changelist: changeListNodeRenderer,\n    unversioned: unversionedChangesNodeRenderer,\n  });\n","import React, { Key, RefObject } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n  expandedKeysState,\n  includedChangesNestedSelection,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { Change } from \"../Change\";\nimport { isGroupNode } from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"./changesViewTreeNodeRenderer\";\n\nfunction findPathsUnderNode(node: ChangesViewTreeNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [Change.path(node.change)];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } = useRecoilValue(\n    changesTreeNodesState\n  );\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const nestedSelection = useRecoilValue(includedChangesNestedSelection);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useRecoilCallback(\n    ({ snapshot }) =>\n      (key: Key) => {\n        const changeNode = snapshot\n          .getLoadable(changesTreeNodesState)\n          .getValue()\n          .byKey.get(key);\n        if (changeNode?.type === \"change\") {\n          openPath(Change.path(changeNode.change));\n        }\n        return changeNode;\n      },\n    []\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        aria-label=\"Commit changes tree\" // no aria-label in the reference impl\n        treeRef={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = changesViewTreeNodeRenderer.getItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionsMenu,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu actions={actions}>\n          {(actionMenuProps) => (\n            <SpeedSearchMenu {...menuProps} {...actionMenuProps} />\n          )}\n        </ActionsMenu>\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionTooltip,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\ninterface Grouping<K extends string> {\n  id: K;\n  title: string;\n  isActive: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function GroupByActionButton<K extends string>({\n  groupings,\n  onToggle,\n}: {\n  groupings: Array<Grouping<K>>;\n  onToggle: (id: K) => void;\n}) {\n  //  TODO: Generalize and make action\n  if (groupings.length === 1 && groupings[0].icon) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={`Group By ${groupings[0].title}`} />\n        }\n      >\n        <IconButton\n          isPressed={groupings[0].isActive}\n          onPress={() => onToggle(groupings[0].id)}\n        >\n          {groupings[0].icon}\n        </IconButton>\n      </TooltipTrigger>\n    );\n  }\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            <Menu\n              {...menuProps}\n              selectedKeys={groupings\n                .filter(({ isActive }) => isActive)\n                .map(({ id }) => id)}\n              onAction={(key) => {\n                const id = groupings.find(({ id }) => id === key)?.id;\n                if (id) {\n                  onToggle(id);\n                }\n              }}\n            >\n              <Section title=\"Group By\">\n                {groupings.map(({ id, title }) => (\n                  <Item key={id}>{title}</Item>\n                ))}\n              </Section>\n            </Menu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../../GroupByActionButton\";\nimport {\n  changesViewGroupingsState,\n  changesGroupingActiveState,\n  GroupingIds,\n} from \"../ChangesView.state\";\n\nexport const ChangesGroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const groupings = useRecoilValue(changesViewGroupingsState);\n\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: GroupingIds) => {\n        set(changesGroupingActiveState(id), (value) => !value);\n      },\n    []\n  );\n\n  return <GroupByActionButton groupings={groupings} onToggle={toggleGroup} />;\n};\n","import React from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport {\n  showIgnoredFilesState,\n  showRelatedFilesState,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useRecoilState(\n    showRelatedFilesState\n  );\n  const [showIgnoredFiles, setShowIgnoredFiles] = useRecoilState(\n    showIgnoredFilesState\n  );\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { ChangesGroupByActionButton } from \"./ActionButtons/ChangesGroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\nimport React from \"react\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar border=\"bottom\">\n      <ActionButton actionId={CommonActionId.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <ChangesGroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { atom, selector, useRecoilCallback, useSetRecoilState } from \"recoil\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksState = atom<Task[]>({\n  key: \"tasks.list\",\n  default: [],\n});\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskState = selector<Task | null>({\n  key: \"tasks.first\",\n  get: ({ get }) => get(tasksState)[0],\n});\n\n/**\n * Optimized recoil value to get the number of tasks, if the tasks are not needed.\n */\nexport const taskCountState = selector<number>({\n  key: \"tasks.count\",\n  get: ({ get }) => get(tasksState).length,\n});\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetRecoilState(tasksState);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useRecoilCallback(({ snapshot }) => (id: Task[\"id\"]) => {\n    const task = snapshot\n      .getLoadable(tasksState)\n      .getValue()\n      .find((task) => task.id === id);\n    if (task) {\n      task.abortController.abort();\n    }\n  });\n","import { selectorFamily } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport const resolvedRefState = selectorFamily<\n  string,\n  { repoRoot: string; ref: string }\n>({\n  key: \"vcs/resolved-branche-ref\",\n  get:\n    ({ repoRoot, ref }: { repoRoot: string; ref: string }) =>\n    () => {\n      return git.resolveRef({ fs, dir: repoRoot, ref, depth: 3 });\n    },\n});\n","export type DateRange = { from?: Date; to?: Date };\nexport const dateToString = (date: Date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date\n    .getFullYear()\n    .toString()\n    .slice(-2)}`;\n};\nexport const dateRangeToString = (dateRange: DateRange): string => {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n};\n","import { mapObjIndexed } from \"ramda\";\nimport {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  RecoilState,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\n\nimport { DateRange, dateRangeToString } from \"./DateRange\";\n\nexport const vcsTabKeysState = atom<string[]>({\n  key: \"vcs/log/tabs/keys\",\n  default: [\"MAIN\"],\n});\n\nexport const vcsActiveTabKeyState = atom<string>({\n  key: \"vcs/log/tabs/activeKey\",\n  default: \"MAIN\",\n});\n\n/**\n * The title of a VCS log tab\n */\nexport const vcsTabTitleState = selectorFamily({\n  key: \"vcs/logs/tab/title\",\n  get:\n    (key: string) =>\n    ({ get }) => {\n      const searchQuery = get(vcsLogFilter.searchQuery(key));\n      const user = get(vcsLogFilter.user(key));\n      const date = get(vcsLogFilter.date(key));\n      const branches = get(vcsLogFilter.branch(key));\n      const parts: { short: string; long: string }[] = [];\n\n      if (branches?.length > 0) {\n        parts.push({\n          short: branches.join(\", \"),\n          long: `on ${branches.join(\", \")}`,\n        });\n      }\n      if (date) {\n        parts.push({\n          short: dateRangeToString(date),\n          long: `made ${dateRangeToString(date)}`,\n        });\n      }\n      if (searchQuery) {\n        parts.push({\n          short: `'${searchQuery}'`,\n          long: `containing '${searchQuery}'`,\n        });\n      }\n      if (user) {\n        parts.push({\n          short: user,\n          long: `by ${user}`,\n        });\n      }\n\n      return `Log${parts.length > 0 ? \": \" : \"\"}${\n        parts.length === 1\n          ? parts[0].short\n          : parts.map((part) => part.long).join(\" \")\n      }`;\n    },\n});\n\nconst tabStats: Array<(tabKey: string) => RecoilState<unknown>> = [];\n\n/**\n * marks a recoil state as a piece of state for VCS log tabs, so that it's cleaned up when the tab is closed.\n * @param someAtomFamily\n */\nexport const vcsLogTabState = <T extends (tabKey: string) => RecoilState<any>>(\n  someAtomFamily: T\n): T => {\n  tabStats.push(someAtomFamily);\n  return someAtomFamily;\n};\n\n/**\n * Whether branches filter is visible for a VCS log tab\n */\nexport const vcsLogTabShowBranchesState = vcsLogTabState(\n  atomFamily<boolean, string>({\n    key: \"vcs/logs/filter/showBranches\",\n    default: false,\n  })\n);\n\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsState = vcsLogTabState(\n  atomFamily<boolean, string>({\n    key: \"vcs/logs/showCommitDetails\",\n    default: true,\n  })\n);\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsInCurrentTabState = selector({\n  key: \"vcs/logs/showCommitDetails/currentTab\",\n  get: ({ get }) =>\n    get(vcsLogTabShowCommitDetailsState(get(vcsActiveTabKeyState))),\n});\n\nexport const CURRENT_USER_FILTER_VALUE = \"*\";\nexport const vcsLogFilter = {\n  /**\n   * The state of search query, for a VCS log tab\n   */\n  searchQuery: vcsLogTabState(\n    atomFamily<string, string>({\n      key: \"vcs/logs/filter/searchQuery\",\n      default: \"\",\n    })\n  ),\n  /**\n   * The state of whether \"match case\" is on the search query, for a VCS log tab\n   */\n  matchCase: vcsLogTabState(\n    atomFamily<boolean, string>({\n      key: \"vcs/logs/filter/matchCase\",\n      default: false,\n    })\n  ),\n  /**\n   * The state of whether \"regexp\" is on the search query, for a VCS log tab\n   */\n  regExp: vcsLogTabState(\n    atomFamily<boolean, string>({\n      key: \"vcs/logs/filter/regExp\",\n      default: false,\n    })\n  ),\n  /**\n   * The state of user filter, for a VCS log tab\n   */\n  user: vcsLogTabState(\n    atomFamily<string | null, string>({\n      key: \"vcs/logs/filter/user\",\n      default: null,\n    })\n  ),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  date: atomFamily<DateRange | null, string>({\n    key: \"vcs/logs/filter/date\",\n    default: null,\n  }),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  branch: vcsLogTabState(\n    atomFamily<string[], string>({\n      key: \"vcs/logs/filter/branch\",\n      default: [],\n    })\n  ),\n};\n\ntype FamilyToAtom<F> = F extends (param: any) => RecoilState<infer S>\n  ? RecoilState<S>\n  : never;\n\ntype VcsLogFilter = typeof vcsLogFilter;\n\nexport const vcsLogFilterCurrentTab = mapObjIndexed((atomFamily, key) => {\n  return selector({\n    key: `vcs/logs/currentTabFilter/${key}`,\n    get: ({ get }) =>\n      get(atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>),\n    set: ({ set, get }, newValue) => {\n      set(\n        atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>,\n        newValue\n      );\n    },\n  });\n}, vcsLogFilter) as {\n  [key in keyof VcsLogFilter]: FamilyToAtom<VcsLogFilter[key]>;\n};\n\nexport const useResetFilters = () =>\n  useRecoilCallback(\n    ({ reset }) =>\n      (tabKey: string) => {\n        Object.values(vcsLogFilter)\n          .map((state) => state(tabKey))\n          .forEach(reset);\n      },\n    []\n  );\n\nconst closeTabCallback =\n  ({ set, snapshot, reset }: CallbackInterface) =>\n  (tabKey: string) => {\n    const tabs = snapshot.getLoadable(vcsTabKeysState).getValue();\n    const currentActiveTabKey = snapshot\n      .getLoadable(vcsActiveTabKeyState)\n      .getValue();\n    if (currentActiveTabKey === tabKey) {\n      // make sure the active tab key remains valid, by switching to previous tab. In the reference implementation\n      // the previously activated tab will be activated instead of the previous one index-wise, but it's a\n      // negligible and easy-to-fix difference.\n      set(\n        vcsActiveTabKeyState,\n        tabs[tabs.findIndex((key) => key === tabKey) - 1] || tabs[0]\n      );\n    }\n    set(vcsTabKeysState, (keys) => keys.filter((key) => key !== tabKey));\n    tabStats.forEach((state) => reset(state(tabKey)));\n  };\n\nexport function useCloseVcsTab() {\n  return useRecoilCallback(closeTabCallback, []);\n}\n","import git, { ReadCommitResult } from \"isomorphic-git\";\nimport { sort } from \"ramda\";\n\ntype Fs = Parameters<typeof git[\"readCommit\"]>[0][\"fs\"];\n\nconst cache = {};\nexport const commitDateComparator = (\n  a: ReadCommitResult,\n  b: ReadCommitResult\n) => b.commit.committer.timestamp - a.commit.committer.timestamp;\n\ntype CommitWithMeta = {\n  repoPath: string;\n  /**\n   * refs this commit contains in\n   */\n  containingRefs: Set<string>;\n  readCommitResult: ReadCommitResult;\n};\n\ntype RepoDescriptor = {\n  repoPath: string;\n  isBare?: boolean;\n};\n/**\n * Similar to git.log(...), but:\n * - supports multiple repos and multiple refs per repo.\n * - for each commit, includes the list of refs the commit is a part of\n * Commits are sorted by commit time, from new to old.\n */\nexport async function readCommits(\n  fs: Fs,\n  ...sources: Array<\n    RepoDescriptor & {\n      refs: string[];\n    }\n  >\n) {\n  const allCommits: Array<CommitWithMeta> = [];\n  const commitsMap: Record<string, CommitWithMeta> = {};\n  let commitsToProcess: Array<CommitWithMeta & RepoDescriptor> = [];\n\n  commitsToProcess.forEach((item) => {\n    commitsMap[item.readCommitResult.oid] = item;\n  });\n  const initialCommits = await Promise.all(\n    sources.flatMap(({ refs, repoPath, isBare }) =>\n      refs.map(async (ref) => {\n        const commit = await git\n          .resolveRef({\n            ...getCommonArgs({ repoPath, isBare }),\n            ref,\n            depth: 3,\n          })\n          .then((oid) =>\n            git.readCommit({\n              ...getCommonArgs({ repoPath, isBare }),\n              oid,\n            })\n          );\n        return { repoPath, isBare, commit, refs: new Set([ref]) };\n      })\n    )\n  );\n\n  sort(\n    ({ commit: c1 }, { commit: c2 }) => commitDateComparator(c1, c2),\n    initialCommits\n  ).forEach(({ commit, refs, repoPath, isBare }) =>\n    addCommit({ repoPath, isBare }, commit, -1, refs)\n  );\n\n  while (commitsToProcess.length > 0) {\n    const {\n      readCommitResult: latestCommit,\n      repoPath,\n      isBare,\n      containingRefs,\n    } = commitsToProcess.shift()!; // non-null assertion because of length>0;\n    allCommits.push({\n      repoPath,\n      readCommitResult: latestCommit,\n      containingRefs: containingRefs,\n    });\n    const parentCommits = await Promise.all(\n      latestCommit.commit.parent.map((oid) =>\n        git.readCommit({\n          ...getCommonArgs({ repoPath, isBare }),\n          oid,\n        })\n      )\n    );\n    // insert new parents in the right place so that commitsToProcess remains sorted.\n    parentCommits.forEach((commit) => {\n      const index = commitsToProcess.findIndex(\n        ({ readCommitResult: aCommit }) =>\n          commitDateComparator(aCommit, commit) > 0\n      );\n      addCommit({ repoPath, isBare }, commit, index, containingRefs);\n    });\n  }\n  return allCommits;\n\n  function addCommit(\n    { repoPath, isBare }: RepoDescriptor,\n    commit: ReadCommitResult,\n    index: number,\n    refs: Set<string>\n  ) {\n    if (commitsMap[commit.oid]) {\n      commitsMap[commit.oid].containingRefs = new Set([\n        ...commitsMap[commit.oid].containingRefs,\n        ...refs,\n      ]);\n    } else {\n      const entry: CommitWithMeta & RepoDescriptor = {\n        readCommitResult: commit,\n        containingRefs: commitsMap[commit.oid]\n          ? new Set([...commitsMap[commit.oid].containingRefs, ...refs])\n          : refs,\n        repoPath,\n        isBare,\n      };\n      commitsMap[commit.oid] = entry;\n      commitsToProcess.splice(\n        index >= 0 ? index : commitsToProcess.length,\n        0,\n        entry\n      );\n    }\n  }\n  function getCommonArgs({\n    repoPath,\n    isBare,\n  }: {\n    repoPath: string;\n    isBare?: boolean;\n  }) {\n    return {\n      fs,\n      cache,\n      [isBare ? \"gitdir\" : \"dir\"]: repoPath,\n    };\n  }\n}\n","import { ReadCommitResult } from \"isomorphic-git\";\nimport { atom, atomFamily, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { allBranchesState } from \"../../Branches/branches.state\";\nimport { resolvedRefState } from \"../../refs.state\";\nimport { readCommits } from \"./readCommits\";\nimport { GitRef } from \"../GitRef\";\nimport { indexBy } from \"ramda\";\n\nfunction match(\n  input: string,\n  query: string,\n  flags: { matchCase?: boolean; regExp?: boolean } = {}\n) {\n  if (flags.regExp) {\n    return new RegExp(query, flags.matchCase ? \"\" : \"i\").test(input);\n  }\n  if (!flags.matchCase) {\n    return input.toLowerCase().includes(query.toLowerCase());\n  }\n  return input.includes(query);\n}\n\ntype CommitLogItem = {\n  readCommitResult: ReadCommitResult;\n  containingRefs: Set<string>;\n  repoPath: string;\n};\n\nexport const allCommitsState = selector<Array<CommitLogItem>>({\n  key: \"vcs/allRepoCommits\",\n  get: ({ get }) =>\n    // TODO: readCommit can take too long. Suspending anything that depends on it leads to poor UX. would be nicer\n    //  to have the state updated (like an atom instead of selector) when commits are read, instead of query inside\n    //  the selector. But the challenge is that it does depend on another piece of state, allBranchesState\n    readCommits(\n      fs,\n      ...get(allBranchesState).map(\n        ({ repoRoot, localBranches, remoteBranches }) => ({\n          repoPath: repoRoot,\n          refs: [\"HEAD\"]\n            .concat(localBranches.map((branch) => branch.name))\n            .concat(\n              remoteBranches.map((branch) => `${branch.remote}/${branch.name}`)\n            ),\n        })\n      )\n    ),\n});\n\nexport const commitsTableRowsState = selector({\n  key: \"vcs/log/rows\",\n  get: ({ get }) => {\n    const searchQuery = get(vcsLogFilterCurrentTab.searchQuery);\n    const branches = get(vcsLogFilterCurrentTab.branch);\n    const flags = {\n      matchCase: get(vcsLogFilterCurrentTab.matchCase),\n      regExp: get(vcsLogFilterCurrentTab.regExp),\n    };\n    const dateFilter = get(vcsLogFilterCurrentTab.date);\n\n    const rows = get(allCommitsState)\n      .filter(\n        ({ containingRefs }) =>\n          !branches?.length ||\n          branches.some((branch) => containingRefs.has(branch))\n      )\n      .filter(\n        ({ readCommitResult: { commit } }) =>\n          (!dateFilter?.from ||\n            commit.author.timestamp * 1000 > dateFilter.from.getTime()) &&\n          (!dateFilter?.to ||\n            commit.author.timestamp * 1000 < dateFilter.to.getTime())\n      )\n      .filter(\n        ({ readCommitResult: { commit } }) =>\n          !searchQuery ||\n          match(commit.message, searchQuery, flags) ||\n          match(commit.tree, searchQuery, { matchCase: false })\n      );\n    return {\n      rows,\n      byOid: indexBy(({ readCommitResult: commit }) => commit.oid, rows),\n    };\n  },\n});\n\nexport const allResolvedRefsState = selector({\n  key: \"vcs/logs/all-refs\",\n  get: ({ get }) => {\n    const repoBranches = get(allBranchesState);\n    const refs: Record<string, GitRef[]> = {};\n    const addRef = (ref: string, value: GitRef) => {\n      refs[ref] = refs[ref] || [];\n      refs[ref].push(value);\n    };\n    repoBranches.forEach(({ repoRoot }) => {\n      addRef(get(resolvedRefState({ repoRoot, ref: \"HEAD\" })), {\n        type: \"head\",\n        name: \"HEAD\",\n      });\n    });\n    repoBranches.forEach(({ repoRoot, localBranches, currentBranch }) => {\n      localBranches.forEach((branch) => {\n        addRef(get(resolvedRefState({ repoRoot, ref: branch.name })), {\n          type: \"localBranch\",\n          name: branch.name,\n          isCurrent: currentBranch?.name === branch.name,\n          trackingBranch: branch.trackingBranch,\n        });\n      });\n    });\n    repoBranches.forEach(({ repoRoot, remoteBranches }) =>\n      remoteBranches.forEach((branch) => {\n        const branchName = `${branch.remote}/${branch.name}`;\n        addRef(get(resolvedRefState({ repoRoot, ref: branchName })), {\n          type: \"remoteBranch\",\n          name: branchName,\n        });\n      })\n    );\n    return refs;\n  },\n});\n\n/**\n * selection state of the commits table\n * TODO: make it per-tab\n */\nexport const commitsSelectionState = atom<Selection>({\n  key: \"vcs/log/commits/selection\",\n  default: new Set([]),\n});\n\n/**\n * OIDs of the selected commits in commits table.\n */\nexport const selectedCommitOids = selector({\n  key: `${commitsSelectionState.key}/keys`,\n  get: ({ get }) => {\n    const selection = get(commitsSelectionState);\n    if (selection === \"all\") {\n      return get(commitsTableRowsState).rows.map(\n        ({ readCommitResult: { oid } }) => oid\n      );\n    }\n    return [...selection].map((i) => `${i}`);\n  },\n});\n\nexport const selectedCommitsState = selector({\n  key: `${commitsSelectionState.key}/items`,\n  get: ({ get }) =>\n    get(selectedCommitOids).map((oid) => get(commitsTableRowsState).byOid[oid]),\n});\n\n/**\n * Selected commit in the commits table. The first row, if multiple rows are selected\n */\nexport const selectedCommitState = selector({\n  key: \"vcs/log/details/selectedCommit\",\n  get: ({ get }) => {\n    const oid = get(selectedCommitOids)[0];\n    return (oid && get(commitsTableRowsState).byOid[oid]) || null;\n  },\n});\n\nexport const vcsTableShowCommitTimestampState = atom<boolean>({\n  key: \"vcs/log/commits/showCommitTimestamp\",\n  default: false,\n});\n\nexport const vcsTableReferencesOnTheLeftState = atom<boolean>({\n  key: \"vcs/log/commits/referencesOnTheLeft\",\n  default: false,\n});\n\nexport const vcsTableHighlightMyCommitsState = atom<boolean>({\n  key: \"vcs/log/commits/highlightMyCommits\",\n  default: false,\n});\n\nexport const authorColumn = {\n  id: \"Default.Author\",\n  name: \"Author\",\n};\nexport const hashColumn = {\n  id: \"Default.Hash\",\n  name: \"Hash\",\n};\n\nexport const dateColumn = {\n  id: \"Date.Date\",\n  name: \"Date\",\n};\n\nconst defaultVisibleColumns = [authorColumn.id, dateColumn.id];\nexport const vcsTableColumnsVisibilityState = atomFamily<boolean, string>({\n  key: \"vcs/log/commits/highlightMyCommits\",\n  default: (id) => defaultVisibleColumns.includes(id),\n});\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useRecoilCallback } from \"recoil\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport React from \"react\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useRefreshRepoStatuses,\n  vcsRootForFile,\n} from \"../../file-status.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdState } from \"./ChangesView.state\";\nimport { AnyChange, Change } from \"../Change\";\nimport { resolvedRefState } from \"../../refs.state\";\nimport { repoCurrentBranchNameState } from \"../../Branches/branches.state\";\nimport { allCommitsState } from \"../../VersionControlToolWindow/CommitsView/CommitsTable.state\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshFileStatus = useRefreshRepoStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useRecoilCallback(\n    ({ snapshot, set, refresh }) =>\n      (changes: readonly AnyChange[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = Change.path(change);\n                      const repoRoot = snapshot\n                        .getLoadable(vcsRootForFile(filePath))\n                        .getValue();\n                      const content = (await fs.promises.exists(filePath))\n                        ? await fs.promises.readFile(filePath)\n                        : null;\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array | null;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                    const currentBranch = await snapshot.getPromise(\n                      repoCurrentBranchNameState(repoRoot)\n                    );\n                    if (currentBranch) {\n                      refresh(\n                        resolvedRefState({\n                          repoRoot,\n                          ref: currentBranch,\n                        })\n                      );\n                    }\n                    refresh(resolvedRefState({ repoRoot, ref: \"HEAD\" }));\n                  }\n                )\n              ).then(\n                () => {\n                  refresh(allCommitsState); // maybe a more efficient way to update only the newly added commit, when\n                  // allCommitsState is refactored to allow that\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdState, null);\n            },\n          }\n        );\n        set(commitTaskIdState, taskId);\n      },\n    []\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n */\nexport async function commitFiles({\n  updates,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  /**\n   * A mapping from file paths to either:\n   * - the new content of the file that should be committed, in form of a Uint8Array blob\n   * - null, indicating the files should be removed\n   */\n  updates: { [filePath: string]: Uint8Array | null };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  let containsChange = false;\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(updates).map(async ([filePath, blob]) => {\n      const index = entries.findIndex(({ path }) => path === filePath);\n      if (blob == null) {\n        // null indicates removed file\n        if (index > -1) {\n          containsChange = true;\n          entries.splice(index, 1);\n        }\n        return;\n      }\n      const entry = entries[index];\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n      containsChange = true;\n    })\n  );\n\n  if (!containsChange) {\n    throw new Error(\"Nothing to commit!\");\n  }\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(updates).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitState,\n  commitErrorMessageState,\n  commitMessageState,\n  commitTaskIdState,\n  includedChangesState,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useRecoilState(commitMessageState);\n  const commit = useCommitChanges();\n  const amend = useRecoilValue(amendCommitState);\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useRecoilState(\n    commitErrorMessageState\n  );\n  const commitTaskId = useRecoilValue(commitTaskIdState);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useRecoilCallback(({ snapshot }) => {\n    const includedChanges = snapshot\n      .getLoadable(includedChangesState)\n      .getValue();\n    const commitMessage = snapshot.getLoadable(commitMessageState).getValue();\n    return () => {\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (snapshot.getLoadable(amendCommitState).getValue()) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    };\n  }, []);\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n          mnemonic=\"i\"\n        >\n          {amend ? \"Amend Commit\" : \"Commit\"}\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented} mnemonic=\"P\">\n          {amend ? \"Amend Commit and Push...\" : \"Commit and Push...\"}\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { StatusColor } from \"../FileStatusColor\";\nimport { AnyChange, Change } from \"./Change\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<AnyChange>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => Change.fileStatus(change) === \"MODIFIED\"\n  ).length;\n  const addedCount = changes.filter(Change.isAddition).length;\n  const deletedCount = changes.filter(Change.isDeletion).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitState, includedChangesState } from \"./ChangesView.state\";\nimport { focusCommitMessage } from \"./ChangesViewSplitter\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useRecoilValue(includedChangesState);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useRecoilState(amendCommitState);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={(value) => {\n                setAmend(value);\n                // TODO: alternate commit message between the latest commit message and the last edited message.\n                focusCommitMessage();\n              }}\n              preventFocus\n              mnemonic=\"m\"\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport { selector, useRecoilValue } from \"recoil\";\nimport {\n  changeListsUnderSelection,\n  changesUnderSelectedKeys,\n} from \"./ChangesView.state\";\nimport { useSetActiveChangeList } from \"../change-lists.state\";\nimport { useRefreshRepoStatuses } from \"../../file-status.state\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport React from \"react\";\nimport { alertDialogRefState } from \"../../../Project/project.state\";\nimport { Change } from \"../Change\";\nimport { deleteFilesCallback } from \"../../../Project/fs-operations\";\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\n\nconst selectedFilesCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 selected file}\n    other {# selected files}\n  }`,\n  \"en-US\"\n);\n\nconst deletablePathsUnderChangesTreeSelectionState = selector({\n  key: \"changesView.selectedKeys.deletablePaths\",\n  get: ({ get }) =>\n    [...get(changesUnderSelectedKeys).values()]\n      .filter((change) => change.type !== \"DELETED\")\n      .map(Change.path),\n});\n\nconst deleteActionState = selector({\n  key: `vcs.changesView.action.${CommonActionId.DELETE}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.DELETE,\n    title: \"Delete\",\n    description: \"Delete selected item\",\n    isDisabled: get(deletablePathsUnderChangesTreeSelectionState).length === 0,\n    actionPerformed: getCallback((callbackInterface) => async () => {\n      const { snapshot } = callbackInterface;\n      const deletePaths = deleteFilesCallback(callbackInterface);\n      const pathsToDelete = snapshot\n        .getLoadable(deletablePathsUnderChangesTreeSelectionState)\n        .getValue();\n\n      const alertDialog = snapshot\n        .getLoadable(alertDialogRefState)\n        .getValue().current;\n      if (pathsToDelete.length === 0) {\n        return;\n      }\n      const confirmed = await alertDialog?.confirm({\n        title: \"Delete\",\n        okText: \"Delete\",\n        message: (\n          <div\n            style={{ width: 354 }}\n          >{`Are you sure you want to delete ${selectedFilesCountMsg.format({\n            count: pathsToDelete.length,\n          })}?`}</div>\n        ),\n      });\n      if (confirmed) {\n        console.log(`deleting ${pathsToDelete}`);\n        await deletePaths(pathsToDelete);\n      }\n    }),\n  }),\n});\n\nexport function useChangesViewActions() {\n  const selectedChangeLists = useRecoilValue(changeListsUnderSelection);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  const actions: ActionDefinition[] = [\n    {\n      id: CommonActionId.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    useRecoilValue(deleteActionState),\n  ];\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    // FIXME: action should be scoped to change lists tree\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  return actions;\n}\n","import React, { useRef } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { repoStatusUpdatingState } from \"../../file-status.state\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\nimport { useChangesViewActions } from \"./useChangesViewActions\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n  position: relative;\n`;\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  right: 0.125rem;\n  top: 0.125rem;\n  z-index: 1;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const updating = useRecoilValue(repoStatusUpdatingState);\n  const [commitMessageSize, setCommitMessageSize] = useRecoilState(\n    commitMessageSizeState(orientation)\n  );\n  const changesViewActions = useChangesViewActions();\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={[...treeActions, ...changesViewActions]}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                {updating && (\n                  <Delayed>\n                    <StyledLoadingWrapper>\n                      <LoadingGif />\n                    </StyledLoadingWrapper>\n                  </Delayed>\n                )}\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function ChangesViewZeroState() {\n  const performAction = usePerformAction();\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To commit changes,{\" \"}\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        For recent changes, see{\" \"}\n        <Link onPress={notImplemented}>Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useRecoilValue } from \"recoil\";\nimport { ChangesViewZeroState } from \"./ChangesViewZeroState\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const vcsRoots = useRecoilValue(vcsRootsState);\n  return (\n    <StyledContainer>\n      {vcsRoots.length > 0 ? <ChangesViewSplitter /> : <ChangesViewZeroState />}\n    </StyledContainer>\n  );\n};\n","import path from \"path\";\nimport React from \"react\";\n\nimport { LocalBranch } from \"./Branches/branches.state\";\n\nexport function TrackingBranchInfo({\n  branches,\n}: {\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n}) {\n  return (\n    <table style={{ borderSpacing: 0 }}>\n      {branches.map(({ branch, repoRoot }) => {\n        const mapping = branch.trackingBranch\n          ? `${branch.name}  ${branch.trackingBranch}`\n          : branches.length > 1\n          ? `${branch.name} (no tracking branch)`\n          : \"No tracking branch\";\n\n        return branches.length > 1 ? (\n          <tr key={repoRoot}>\n            <td>{path.basename(repoRoot)}: &nbsp;</td>\n            <td>{mapping}</td>\n          </tr>\n        ) : (\n          <tr key={repoRoot}>\n            <td>{mapping}</td>\n          </tr>\n        );\n      })}\n    </table>\n  );\n}\n","import React from \"react\";\nimport { selector, useRecoilValue } from \"recoil\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { vcsRootForFile } from \"./file-status.state\";\nimport { LocalBranch, repoBranchesState } from \"./Branches/branches.state\";\nimport { changesGroupingActiveState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { TrackingBranchInfo } from \"./TrackingBranchInfo\";\nimport { Change } from \"./Changes/Change\";\nimport { allChangesState } from \"./Changes/changes.state\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesState = selector({\n  key: \"vcs/commitToolWindow/changedRepos\",\n  get: ({ get }): Array<{ repoRoot: string; branch: LocalBranch }> => {\n    const changesRepoRoots = get(allChangesState)\n      .map((change) => get(vcsRootForFile(Change.path(change))))\n      .filter(notNull);\n\n    return changesRepoRoots\n      .map((repoRoot) => {\n        const branch = get(repoBranchesState(repoRoot)).currentBranch;\n        return branch\n          ? {\n              repoRoot,\n              branch,\n            }\n          : null;\n      })\n      .filter(notNull);\n  },\n});\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useRecoilValue(\n    changesGroupingActiveState(\"repository\")\n  );\n  const changesBranches = useRecoilValue(changesBranchesState);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={changesBranches} />}\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledHeader = styled.div`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  height: 2.0625rem;\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n  flex-shrink: 0;\n`;\nexport const StyledSpacer = styled.div`\n  flex-grow: 1;\n`;\nexport const StyledPlaceholderContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n  align-items: center;\n  gap: 0.25rem;\n  min-height: 37%;\n  overflow: hidden;\n`;\n","import React from \"react\";\n\nexport const parseCommitMessage = (commitMessage: string) => {\n  const lines = commitMessage.split(\"\\n\");\n  const bodyLines = lines.slice(1);\n  return {\n    subject: lines[0],\n    bodyAsString: bodyLines.join(\"\\n\"),\n    body: (\n      <>\n        {bodyLines.map((line, index) => (\n          <React.Fragment key={index}>\n            {index > 0 && <br />}\n            {line}\n          </React.Fragment>\n        ))}\n      </>\n    ),\n  };\n};\n\nexport function shortenOid(oid: string) {\n  return oid.slice(0, 8);\n}\n\nconst commitDateTimeFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitTimeFormatter = new Intl.DateTimeFormat([], {\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitDateFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n});\n\nexport function formatCommitDateTime(date: Date | number) {\n  return commitDateTimeFormatter.format(date).replace(\" \", \"\");\n}\n\nexport function formatCommitDate(date: Date | number) {\n  return commitDateFormatter.format(date);\n}\n\nexport function formatCommitTime(date: Date | number) {\n  return commitTimeFormatter.format(date).replace(\" \", \"\");\n}\n","import path from \"path\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n  simpleGroupingRenderer,\n} from \"../../Changes/ChangesTree/changesTreeNodeRenderers\";\nimport { RepositoryNode } from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { shortenOid } from \"../commit-utils\";\nimport {\n  CommitChangesTreeNode,\n  CommitParentChangeTreeNode,\n} from \"./CommitsChangedFiles.state\";\n\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst commitParentNodeRenderer = simpleGroupingRenderer(\n  (node: CommitParentChangeTreeNode) =>\n    `Changes to ${shortenOid(path.basename(node.oid))} ${node.subject.slice(\n      0,\n      50\n    )}`\n);\nexport const commitChangesTreeNodeRenderer =\n  createChangesTreeNodeRenderer<CommitChangesTreeNode>(\n    {\n      commitParent: commitParentNodeRenderer,\n    },\n    {\n      repo: repoNodeRenderer,\n    }\n  );\n","import git from \"isomorphic-git\";\nimport path from \"path\";\n\nimport { AnyChange, Change, Revision } from \"../../Changes/Change\";\n\nconst cache = {}; // FIXME: find a better caching strategy. Per project?\nexport async function getCommitChanges({\n  fromRef,\n  toRef,\n  ...params\n}: {\n  dir?: string;\n  gitdir?: string;\n  fromRef: string;\n  toRef: string;\n} & Pick<Parameters<typeof git[\"walk\"]>[0], \"fs\" | \"dir\" | \"gitdir\">): Promise<\n  AnyChange[]\n> {\n  let items: AnyChange[] = await git.walk({\n    ...params,\n    cache,\n    trees: [git.TREE({ ref: fromRef }), git.TREE({ ref: toRef })],\n    map: async function map(\n      filepath,\n      [before, after]\n    ): Promise<null | boolean | AnyChange> {\n      const afterOid = await after?.oid();\n      const beforeOid = await before?.oid();\n      const afterType = await after?.type();\n      const beforeType = await before?.type();\n      if (afterOid === beforeOid) {\n        return null;\n      }\n      const afterRevision: Revision | null = afterOid\n        ? {\n            hash: afterOid,\n            path: path.join(params.dir || \"\", filepath),\n            isDir: afterType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await after?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const beforeRevision: Revision | null = beforeOid\n        ? {\n            hash: beforeOid,\n            path: path.join(params.dir || \"\" || \"\", filepath),\n            isDir: beforeType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await before?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const change: AnyChange | null =\n        afterRevision || beforeRevision\n          ? // @ts-expect-error ts can't tell that the signature matches\n            Change(beforeRevision, afterRevision)\n          : null;\n      return change && !Change.revision(change).isDir\n        ? change\n        : // returning null will cause the git.walk not to continue traversing the tree\n          false;\n    },\n  });\n\n  return (items || []).filter((item: boolean | AnyChange) => item);\n}\n","import { diffLines } from \"diff\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { AdditionChange, AnyChange, Change, DeletionChange } from \"./Change\";\n\n// Read more: https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage\nconst DEFAULT_SIMILARITY_INDEX = 50;\n\n/**\n * Given a list of changes, detects renames based on the change in the content of changes where only `before` or\n * `after` is present, and consolidates them into one change, making it count as a rename.\n * @param changes\n */\nexport async function detectRenames(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  return detectRenamesBasedOnContent(detectRenamesBasedOnHash(changes));\n}\n\nfunction detectRenamesBasedOnHash(\n  changes: ReadonlyArray<AnyChange>\n): AnyChange[] {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  return mergeRenames(\n    new Map<DeletionChange, { to: AdditionChange }>(\n      deletions\n        .map((deletion) => {\n          const match = additions.find(\n            ({ after: { hash } }) => hash === deletion.before.hash\n          );\n          if (match) {\n            return [deletion, { to: match }] as const;\n          }\n          return null;\n        })\n        .filter(notNull)\n    ),\n    changes\n  );\n}\n\nasync function detectRenamesBasedOnContent(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  const contents = new Map<AnyChange, string>();\n  const getContent = async (change: AnyChange): Promise<string> => {\n    if (!contents.get(change)) {\n      contents.set(change, await Change.content(change));\n    }\n    return contents.get(change) ?? \"\";\n  };\n  const renameMapping = new Map<\n    DeletionChange,\n    { similarity: number; to: AdditionChange }\n  >();\n  await Promise.all(\n    deletions.map(async (deletion) => {\n      return Promise.all(\n        additions.map(async (addition) => {\n          const similarity = await computeSimilarity(\n            await getContent(deletion),\n            await getContent(addition)\n          );\n          const currentCandidate = renameMapping.get(deletion);\n          if (\n            similarity >= DEFAULT_SIMILARITY_INDEX &&\n            (!currentCandidate || similarity > currentCandidate.similarity)\n          ) {\n            renameMapping.set(deletion, { similarity, to: addition });\n          }\n        })\n      );\n    })\n  );\n  return mergeRenames(renameMapping, changes);\n}\n\nfunction mergeRenames(\n  renameMapping: Map<DeletionChange, { to: AdditionChange }>,\n  changes: ReadonlyArray<AnyChange>\n) {\n  const renamedChanges: AnyChange[] = [...renameMapping.values()].map(\n    (rename) => rename.to\n  );\n  return changes\n    .map((change) => {\n      if (Change.isDeletion(change)) {\n        const candidate = renameMapping.get(change);\n        if (candidate) {\n          return Change(change.before, candidate?.to.after);\n        }\n      }\n      return change;\n    })\n    .filter((change) => !renamedChanges.includes(change));\n}\n\n/**\n * Computes similarity to two strings (typically file contents), and returns a similarity score,\n * similar to [git's similarity index](https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage)\n * based on diff computed on a line basis.\n *\n * Note on performance:\n * diff computation can be quite heavy, so it's at least made async not to block the main thread. Further improvement\n * could be moving it to a worker thread.\n * Several alternatives are tested with no luck:\n * - fast-diff: It turned out to be much slower than diff\n * - fast-myers-diff: doesn't seem to support line diffing, or maybe it does but it wasn't straightforward, so skipped it.\n * - detect-rename: too slow!\n */\nasync function computeSimilarity(file1Content: string, file2Content: string) {\n  return new Promise<number>((resolve, reject) => {\n    diffLines(file1Content, file2Content, (err, value = []) => {\n      if (err) {\n        return reject(err);\n      }\n      const { unchanged, total } = value.reduce(\n        ({ total, unchanged }, change) => {\n          const count = change.count ?? 0;\n\n          return {\n            total: total + count,\n            unchanged:\n              unchanged + (!change.added && !change.removed ? count : 0),\n          };\n        },\n        { total: 0, unchanged: 0 }\n      );\n      resolve(100 * (unchanged / total));\n    });\n  });\n}\n","import React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  atomFamily,\n  GetRecoilValue,\n  selector,\n  selectorFamily,\n} from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport { sortTreeNodesInPlace } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport {\n  defaultChangeGroupings,\n  directoryGrouping,\n  getChangesGroupFn,\n} from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changeNode,\n  ChangesTreeGroupNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n} from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { changesTreeNodesResult } from \"../../Changes/ChangesTree/changesTreeNodesResult\";\nimport { ChangeListObj } from \"../../Changes/change-lists.state\";\nimport {\n  commitsTableRowsState,\n  selectedCommitsState,\n} from \"../CommitsView/CommitsTable.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\nimport { getCommitChanges } from \"./getCommitChanges\";\nimport { detectRenames } from \"../../Changes/detectRenames\";\n\nexport const changesGroupingActiveState = atomFamily<boolean, string>({\n  key: \"vcs/log/commits/changes/isGroupingActive\",\n  default: (id) => id === directoryGrouping.id,\n});\n\nexport const commitChangesTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"vcs/log/commits/changes/treeRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const expandedKeysState = atom<Set<Key>>({\n  key: \"vcs/log/commits/changes/expandedKeys\",\n  default: new Set(),\n});\n\nexport const selectionState = atom<Selection>({\n  key: \"vcs/log/commits/changes/selectedKeys\",\n  default: new Set(),\n});\n\nconst COMMIT_PARENT_ID = \"commitParent\";\n\nexport type CommitChangesTreeNode =\n  ExtendedChangesTreeNode<CommitParentChangeTreeNode>;\nexport interface CommitParentChangeTreeNode\n  extends ChangesTreeGroupNode<typeof COMMIT_PARENT_ID, CommitChangesTreeNode> {\n  changeList: ChangeListObj;\n  oid: string;\n  subject: string;\n}\n\ntype CommitDiffParams = Pick<\n  Parameters<typeof getCommitChanges>[0],\n  \"fromRef\" | \"toRef\" | \"dir\"\n>;\nconst commitsDiffWithoutRenamesState = selectorFamily({\n  key: \"vcs/log/commits/diffWithoutRenamesState\",\n  get: (params: CommitDiffParams) => () =>\n    getCommitChanges({\n      fs,\n      ...params,\n    }),\n});\n\nconst commitsDiffState = selectorFamily({\n  key: \"vcs/log/commits/diffState\",\n  get:\n    (params: CommitDiffParams) =>\n    ({ get }) =>\n      detectRenames(get(commitsDiffWithoutRenamesState(params))),\n});\n\nconst getChangedFilesState =\n  (state: typeof commitsDiffState) =>\n  async ({ get }: { get: GetRecoilValue }) => {\n    const selectedCommits = get(selectedCommitsState);\n    const commitLogItem = selectedCommits[0]; // FIXME: take all selected commits into account\n    const { byOid } = get(commitsTableRowsState);\n    const toRef = commitLogItem?.readCommitResult?.oid;\n    const parents = commitLogItem?.readCommitResult.commit.parent;\n    if (toRef && parents) {\n      const groupFn = getChangesGroupFn({\n        get,\n        groupings: defaultChangeGroupings,\n        isActive: changesGroupingActiveState,\n      });\n      const rootNodes = parents?.map(\n        (parent) =>\n          ({\n            type: COMMIT_PARENT_ID,\n            key: changesTreeNodeKey(COMMIT_PARENT_ID, parent),\n            oid: parent,\n            subject: byOid[parent]?.readCommitResult.commit.message || \"\",\n            children: groupFn(\n              [\n                ...get(\n                  state({\n                    toRef,\n                    fromRef: parent,\n                    dir: commitLogItem.repoPath,\n                  })\n                ),\n              ].map((node) => changeNode(node))\n            ),\n          } as CommitParentChangeTreeNode)\n      );\n\n      const { expandAllKeys, fileCountsMap, ...result } =\n        changesTreeNodesResult(\n          rootNodes.length === 1\n            ? rootNodes[0].children\n            : rootNodes.filter(({ children }) => children.length > 0)\n        );\n\n      type Writeable<T> = { -readonly [P in keyof T]: T[P] };\n      sortTreeNodesInPlace(\n        (node) =>\n          (node.type === \"directory\" ? \"a_\" : \"b_\") +\n          commitChangesTreeNodeRenderer\n            .getTextValue(node, { fileCountsMap })\n            .toLowerCase(),\n        {\n          // cheating with the types by removing readonly constraints to use the inplace sort tree util.\n          // it should be ok, since the ReadonlyArray is only a compile-time thing.\n          roots: result.rootNodes as Writeable<typeof result.rootNodes>,\n          getChildren: (node) =>\n            \"children\" in node\n              ? (node.children as Writeable<typeof node.children>)\n              : null,\n        }\n      );\n\n      return {\n        ...result,\n        fileCountsMap,\n        expandAllKeys: new Set(\n          [...expandAllKeys].filter(\n            (key) => !`${key}`.startsWith(COMMIT_PARENT_ID)\n          )\n        ),\n      };\n    }\n    return null;\n  };\n\n/**\n * Changes corresponding to the currently selected commits, before rename detection, which can be slow.\n */\nexport const changedFilesWithoutRenamesState = selector({\n  key: \"vcs/log/commits/selection/changesWithoutRename\",\n  get: getChangedFilesState(commitsDiffWithoutRenamesState),\n});\n\n/**\n * Changes corresponding to the currently selected commits.\n */\nexport const changedFilesState = selector({\n  key: \"vcs/log/commits/selection/changes\",\n  get: getChangedFilesState(commitsDiffState),\n});\n","import React, { HTMLAttributes, useEffect } from \"react\";\nimport {\n  RecoilValue,\n  useRecoilState,\n  useRecoilValue,\n  useRecoilValueLoadable,\n} from \"recoil\";\n\nimport {\n  HelpTooltip,\n  PlatformIcon,\n  PositionedTooltipTrigger,\n  SpeedSearchTree,\n  styled,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { selectedCommitsState } from \"../CommitsView/CommitsTable.state\";\nimport {\n  changedFilesState,\n  changedFilesWithoutRenamesState,\n  commitChangesTreeRefState,\n  expandedKeysState,\n  selectionState,\n} from \"./CommitsChangedFiles.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  inset: 0;\n  gap: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nfunction useFastestValueLoadable<T>(states: RecoilValue<T>[]) {\n  const loadables = states.map((state) => useRecoilValueLoadable(state));\n  return (\n    loadables.find(({ state }) => state === \"hasValue\") ||\n    loadables.slice(-1)[0]\n  );\n}\n/**\n * TODO: handle multiple selected commits (check Changes.ShowChangesFromParents https://github.com/JetBrains/intellij-community/blob/ac57611a0612bd65ba2a19c841a4f95b40591134/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/frame/VcsLogChangesBrowser.java#L255-L254)\n */\nexport function CommitChangedFiles({\n  treeShortcutHandlerProps,\n}: {\n  treeShortcutHandlerProps: HTMLAttributes<HTMLElement>;\n}) {\n  const [selectedCommits] = useLatestRecoilValue(selectedCommitsState);\n  const treeRef = useRecoilValue(commitChangesTreeRefState);\n  const nothingSelected = !selectedCommits?.length;\n\n  const stateLoadable = useFastestValueLoadable([\n    changedFilesState,\n    changedFilesWithoutRenamesState,\n  ]);\n  const state = stateLoadable.valueMaybe();\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selection, setSelection] = useRecoilState(selectionState);\n\n  useEffect(() => {\n    // TODO: expanded keys are supposed to be set based on selected keys\n    setExpandedKeys(state?.expandAllKeys ?? new Set());\n    setSelection(new Set());\n    // FIXME: with this being in an effect here, closing and reopening the toolwindow will\n    //  reset the selection, making selection state be effectively like a local state.\n  }, [stateLoadable.state]);\n\n  if (nothingSelected) {\n    return (\n      <StyledPlaceholderContainer>\n        Select commits to to view changes\n      </StyledPlaceholderContainer>\n    );\n  }\n  return (\n    <div\n      {...treeShortcutHandlerProps}\n      style={{\n        height: \"-webkit-fill-available\",\n        position: \"relative\",\n      }}\n    >\n      {stateLoadable.state === \"loading\" && (\n        <Delayed>\n          <StyledLoadingWrapper>\n            <LoadingGif style={{ width: \"1.5rem\" }} />\n            Loading...\n          </StyledLoadingWrapper>\n        </Delayed>\n      )}\n      {state && (\n        <SpeedSearchTree\n          aria-label=\"Commit changes\"\n          treeRef={treeRef}\n          items={state.rootNodes}\n          selectionMode=\"multiple\"\n          expandedKeys={expandedKeys}\n          onExpandedChange={setExpandedKeys}\n          selectedKeys={selection}\n          onSelectionChange={setSelection}\n          style={{ paddingBottom: \"1rem\" }}\n          fillAvailableSpace\n        >\n          {commitChangesTreeNodeRenderer.itemRenderer({\n            fileCountsMap: state.fileCountsMap,\n          })}\n        </SpeedSearchTree>\n      )}\n      {selectedCommits.length > 1 && (\n        <PositionedTooltipTrigger\n          placement=\"top\"\n          tooltip={\n            <HelpTooltip\n              helpText={\n                <>\n                  Showing diff for more than one commit is not currently\n                  supported. Only the first selected commit is taken into\n                  account.\n                </>\n              }\n            ></HelpTooltip>\n          }\n        >\n          {(props) => (\n            <span\n              {...props}\n              style={{\n                position: \"absolute\",\n                right: \"0.5rem\",\n                bottom: \"0.5rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/warning\" />\n            </span>\n          )}\n        </PositionedTooltipTrigger>\n      )}\n    </div>\n  );\n}\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { StyledCurrentBranchTag } from \"../Changes/StyledCurrentBranchTag\";\nimport { GitRef } from \"./GitRef\";\n\nconst labelIcon = (\n  <path\n    fill=\"currentColor\"\n    d=\"M4.2 4.8 C4.8627 4.8 5.4 5.3373 5.4 6 C5.4 6.6627 4.8627 7.2 4.2 7.2 C3.5373 7.2 3 6.6627 3 6 C3 5.3373 3.5373 4.8 4.2 4.8 ZM0.6 2.4 L0.6 7.2 L7.8 14.4 L12.6 9.6 L5.4 2.4 Z\"\n  />\n);\nconst vcsLogStandardColors = {\n  TIP: { light: \"#ffd100\", dark: \"#e1c731\" },\n  LEAF: { light: \"#8a2d6b\", dark: \"#c31e8c\" },\n  BRANCH: { light: \"#3cb45c\", dark: \"#3cb45c\" },\n  BRANCH_REF: { light: \"#9f79b5\", dark: \"#9f79b5\" },\n  TAG: { light: \"#7a7a7a\", dark: \"#999999\" },\n};\nconst gitLogColors: Record<GitRef[\"type\"], (args: { theme: Theme }) => string> =\n  {\n    head: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.headIconColor\",\n        vcsLogStandardColors.TIP\n      ),\n    localBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.localBranchIconColor\",\n        vcsLogStandardColors.BRANCH\n      ),\n    remoteBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.remoteBranchIconColor\",\n        vcsLogStandardColors.BRANCH_REF\n      ),\n    tag: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.tagIconColor\",\n        vcsLogStandardColors.TAG\n      ),\n  };\n\nconst StyledRef = styled(StyledCurrentBranchTag)`\n  border-radius: 3px;\n  align-items: stretch;\n  font-size: 0.75rem;\n`;\n\nconst StyledLabelSvg = styled.svg.attrs({ viewBox: \"0 0 14.5 14.5\" })<{\n  type: GitRef[\"type\"];\n}>`\n  width: 1rem;\n  height: 1rem;\n  stroke: rgba(0, 0, 0, 0.25);\n  stroke-width: 0.5px;\n  color: ${({ type, theme }) => gitLogColors[type]({ theme })};\n  z-index: 1; // for the right vertical order of grouped labels\n  &:not(:first-child) {\n    margin-right: -11px;\n  }\n`;\n\nconst StyledRefIconGroup = styled.span`\n  display: inline-flex;\n  flex-direction: row-reverse;\n`;\n\nconst StyledLabelText = styled.span`\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\n\nexport function RefIcon({ type }: { type: GitRef[\"type\"] }) {\n  return <StyledLabelSvg type={type}>{labelIcon}</StyledLabelSvg>;\n}\n\nexport function RefIconGroup({ types }: { types: Array<GitRef[\"type\"]> }) {\n  return (\n    <StyledRefIconGroup>\n      {types.map((type, index) => (\n        <StyledLabelSvg key={index} type={type}>\n          {labelIcon}\n        </StyledLabelSvg>\n      ))}\n    </StyledRefIconGroup>\n  );\n}\nexport function RefLabel({\n  types,\n  children,\n}: {\n  types: Array<GitRef[\"type\"]>;\n  children: React.ReactNode;\n}) {\n  return (\n    <StyledRef>\n      <RefIconGroup types={types} />\n      <StyledLabelText>{children}</StyledLabelText>\n    </StyledRef>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport { useRecoilValue } from \"recoil\";\nimport React, { ReactNode } from \"react\";\n\nimport { Link, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport {\n  formatCommitDate,\n  formatCommitTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\nimport {\n  allResolvedRefsState,\n  selectedCommitState,\n} from \"../CommitsView/CommitsTable.state\";\nimport { RefIconGroup } from \"../RefLabel\";\nimport { GitRef } from \"../GitRef\";\n\nconst StyledContainer = styled.div`\n  padding: 0.875rem;\n  cursor: default;\n`;\nconst StyledCommitMessage = styled.div`\n  font-family: \"JetBrains Mono\", monospace;\n  line-height: 1.125rem;\n  margin-bottom: 1.25rem;\n  margin-right: 1.1875rem;\n`;\n\nconst StyledCommitMessageHeader = styled.div`\n  font-weight: bold;\n`;\nconst StyledCommitterInfo = styled.div`\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n`;\n\nconst StyledCommitInfoRow = styled.div`\n  line-height: 1.2;\n  display: flex;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\nconst StyledRepoColorIcon = styled(RepoColorIcon)`\n  align-self: start;\n`;\n\nconst StyledRefsContainer = styled.span`\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\n\nexport function CommitDetails() {\n  const [firstSelectedCommit] = useLatestRecoilValue(selectedCommitState);\n  const [allResolvedRefs] = useLatestRecoilValue(allResolvedRefsState);\n  const isMultiRepo = useRecoilValue(vcsRootsState).length > 0;\n  if (!firstSelectedCommit) {\n    return (\n      <StyledPlaceholderContainer>\n        No commits selected\n      </StyledPlaceholderContainer>\n    );\n  }\n\n  const {\n    readCommitResult: { commit, oid },\n    containingRefs,\n    repoPath,\n  } = firstSelectedCommit;\n  const { subject, body } = parseCommitMessage(commit.message);\n  const committerInfo: ReactNode[] = [];\n  if (commit.committer.name !== commit.author.name) {\n    committerInfo.push(\n      <React.Fragment key={commit.committer.email}>\n        by {commit.committer.name} <EmailLink email={commit.committer.email} />\n      </React.Fragment>\n    );\n  }\n  if (commit.committer.timestamp !== commit.author.timestamp) {\n    committerInfo.push(formatDateAndTime(commit.committer.timestamp * 1000));\n  }\n  const refs = allResolvedRefs?.[oid] || [];\n  const refsByType = groupBy((ref) => ref.type, refs);\n  return (\n    <StyledContainer>\n      <StyledCommitMessage>\n        <StyledCommitMessageHeader>{subject}</StyledCommitMessageHeader>\n        {body}\n      </StyledCommitMessage>\n      <StyledCommitInfoRow>\n        {isMultiRepo && (\n          <TooltipTrigger tooltip={<Tooltip>{repoPath}</Tooltip>}>\n            {(props) => <StyledRepoColorIcon {...props} rootPath={repoPath} />}\n          </TooltipTrigger>\n        )}\n        <div>\n          {`${shortenOid(oid)} ${commit.author.name} `}\n          <EmailLink email={commit.author.email} />{\" \"}\n          {`${formatDateAndTime(new Date(commit.author.timestamp * 1000))}`}\n          {committerInfo.length > 0 && (\n            <StyledCommitterInfo>committed {committerInfo}</StyledCommitterInfo>\n          )}\n        </div>\n      </StyledCommitInfoRow>\n      {refs.length > 0 && (\n        <StyledRefsContainer>\n          <RefGroup refs={refsByType.head} />\n          <RefGroup refs={refsByType.localBranch} />\n          <RefGroup refs={refsByType.remoteBranch} />\n          <RefGroup refs={refsByType.tag} />\n        </StyledRefsContainer>\n      )}\n      <div>\n        {/*TODO: collapsing and \"Show more\"*/}\n        In {containingRefs.size} branches: {[...containingRefs].join(\", \")}\n      </div>\n    </StyledContainer>\n  );\n}\n\nconst StyledRefWithIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n`;\nfunction RefGroup({ refs }: { refs: undefined | GitRef[] }) {\n  return refs?.length ? (\n    <>\n      {refs.map((ref, index) => {\n        const name = `${ref.name}${index === refs.length - 1 ? \"\" : \",\"}`;\n        return index === 0 ? (\n          <StyledRefWithIcon>\n            <RefIconGroup types={refs.map(({ type }) => type).slice(0, 2)} />\n            {name}\n          </StyledRefWithIcon>\n        ) : (\n          // span is needed for the right flex-wrap behavior\n          <span>{name}</span>\n        );\n      })}\n    </>\n  ) : null;\n}\n\nfunction EmailLink({ email }: { email: string }) {\n  return (\n    <a href={`mailto:${email}`} style={{ all: \"unset\" }}>\n      <Link>{`<${email}>`}</Link>\n    </a>\n  );\n}\n\nfunction formatDateAndTime(date: Date | number) {\n  return `on ${formatCommitDate(date)} at ${formatCommitTime(date)}`;\n}\n","import { useMemo } from \"react\";\nimport { ActionDefinition, useActions } from \"@intellij-platform/core\";\n\n/**\n * Currently, action groups are expected to **define** the child actions, instead of just referencing already defined\n * actions. In such model, where groups are not just a grouping of existing actions, this hook allows for redefining\n * existing actions to be used within a group. Kind of a temporary solution while action system evolves.\n */\nexport function useRedefineAction(\n  actionId: string,\n  newId: string\n): ActionDefinition | null {\n  const actions = useActions();\n  const action = actions.find(({ id }) => id === actionId);\n\n  return useMemo(() => {\n    if (!action) {\n      return null;\n    }\n    const { perform, id, ...commonProperties } = action;\n    return {\n      ...commonProperties,\n      id: newId,\n      useShortcutsOf: id,\n      isSearchable: false,\n      actionPerformed: (context) => {\n        perform(context);\n      },\n    };\n  }, [action]);\n}\n","import React, { HTMLAttributes } from \"react\";\nimport {\n  atom,\n  isRecoilValue,\n  RecoilValue,\n  selector,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionButton,\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  CommonActionId,\n  IconButton,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  styled,\n  ThreeViewSplitter,\n  Toolbar,\n  TooltipTrigger,\n  useActionGroup,\n  useCreateDefaultActionGroup,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { CommitChangedFiles } from \"../CommitChanges/CommitsChangedFiles\";\nimport { CommitDetails } from \"./CommitDetails\";\nimport { defaultChangeGroupings } from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changesGroupingActiveState,\n  commitChangesTreeRefState,\n} from \"../CommitChanges/CommitsChangedFiles.state\";\nimport {\n  vcsLogTabShowCommitDetailsInCurrentTabState,\n  vcsLogTabShowCommitDetailsState,\n} from \"../vcs-logs.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { useRedefineAction } from \"../../../useRedefineAction\";\n\nconst splitViewSizeState = atom({\n  key: \"vcs/toolwindow/splitViewSize\",\n  default: 0.5,\n});\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst groupingState = selector({\n  key: \"vcs/log/commits/changes/groupingState\",\n  get: ({ get }) => {\n    const groupings = defaultChangeGroupings.filter((grouping) =>\n      isRecoilValue(grouping.isAvailable)\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    );\n    return groupings.map((grouping) => ({\n      ...grouping,\n      key: `groupBy:${grouping.id}`,\n      isActive: get(changesGroupingActiveState(grouping.id)),\n    }));\n  },\n});\n\nconst GROUP_BY_ACTION_GROUP_ID = \"Vcs.log.detailsView.groupBy\";\nconst LAYOUT_ACTION_GROUP_ID = \"Vcs.log.detailsView.layout\";\nconst VIEW_OPTIONS_ACTION_GROUP_ID = \"Vcs.log.detailsView.viewOptions\";\nconst SHOW_DETAILS_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DETAILS}`;\nconst SHOW_DIFF_PREVIEW_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DIFF_PREVIEW}`;\n\nconst groupingActionId = (grouping: { id: string }) => {\n  return `Vcs.log.detailsView.groupBy.${grouping.id}`;\n};\n\nexport function VcsLogDetailsView({ tabKey }: { tabKey: string }) {\n  const [splitViewSize, setSplitViewSize] = useRecoilState(splitViewSizeState);\n  const isDetailsVisible = useRecoilValue(\n    vcsLogTabShowCommitDetailsState(tabKey)\n  );\n  const toggleGroupBy = useRecoilCallback(({ set }) => (id: string) => {\n    set(changesGroupingActiveState(id), (currentValue) => !currentValue);\n  });\n  const createActionGroup = useCreateDefaultActionGroup();\n  const availableGroupings = useRecoilValue(groupingState);\n\n  const treeRef = useRecoilValue(commitChangesTreeRefState);\n  const actions = [\n    createActionGroup({\n      id: VIEW_OPTIONS_ACTION_GROUP_ID,\n      title: \"View Options\",\n      icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n      children: [\n        createActionGroup({\n          id: GROUP_BY_ACTION_GROUP_ID,\n          title: \"Group By\",\n          menuPresentation: \"titledSection\",\n          icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n          children: availableGroupings.map((grouping) => ({\n            id: groupingActionId(grouping),\n            useShortcutsOf: grouping.useShortcutOf,\n            title: grouping.title,\n            actionPerformed: () => {\n              toggleGroupBy(grouping.id);\n            },\n          })),\n        }),\n        createActionGroup({\n          id: LAYOUT_ACTION_GROUP_ID,\n          menuPresentation: \"titledSection\",\n          title: \"Layout\",\n          children: [\n            useRedefineAction(\n              VcsActionIds.SHOW_DETAILS,\n              SHOW_DETAILS_ACTION_ID\n            ),\n            useRedefineAction(\n              VcsActionIds.SHOW_DIFF_PREVIEW,\n              SHOW_DIFF_PREVIEW_ACTION_ID\n            ),\n          ].filter(notNull),\n        }),\n      ],\n    }),\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer>\n          <StyledHeader>\n            <Toolbar>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Show Diff\" shortcut=\"D\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon={\"actions/diff.svg\"} />\n                </IconButton>\n              </TooltipTrigger>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Revert Selected Changes\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon=\"actions/rollback.svg\" />\n                </IconButton>\n              </TooltipTrigger>\n              <IconButtonWithMenu\n                renderMenu={({ menuProps }) => {\n                  return (\n                    <VcsLogsDetailsViewOptionsMenu menuProps={menuProps} />\n                  );\n                }}\n              >\n                <PlatformIcon icon=\"actions/groupBy.svg\" />\n              </IconButtonWithMenu>\n            </Toolbar>\n            <StyledSpacer />\n            <Toolbar style={{ flexShrink: 0 }}>\n              <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n              <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n            </Toolbar>\n          </StyledHeader>\n          <div style={{ flex: 1, minHeight: 0 }}>\n            {isDetailsVisible ? (\n              <ThreeViewSplitter\n                orientation=\"vertical\"\n                firstSize={splitViewSize}\n                onFirstResize={setSplitViewSize}\n                firstViewMinSize={10}\n                firstView={\n                  <CommitChangedFiles\n                    treeShortcutHandlerProps={shortcutHandlerProps}\n                  />\n                }\n                innerView={<CommitDetails />}\n              />\n            ) : (\n              <CommitChangedFiles\n                treeShortcutHandlerProps={shortcutHandlerProps}\n              />\n            )}\n          </div>\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst toggleActionsState: { [actionId: string]: RecoilValue<boolean> } = {\n  [SHOW_DETAILS_ACTION_ID]: vcsLogTabShowCommitDetailsInCurrentTabState,\n  ...Object.fromEntries(\n    defaultChangeGroupings.map((grouping) => [\n      groupingActionId(grouping),\n      changesGroupingActiveState(grouping.id),\n    ])\n  ),\n};\nconst selectedKeysState = selector({\n  key: \"vcs/log/commits/detailsView/viewOptionsSelectedKeys\",\n  get: ({ get }) =>\n    Object.entries(toggleActionsState)\n      .filter(([, state]) => get(state))\n      .map(([actionId]) => actionId),\n});\n\nfunction VcsLogsDetailsViewOptionsMenu({\n  menuProps,\n}: {\n  menuProps: Omit<HTMLAttributes<HTMLDivElement>, \"autoFocus\">;\n}) {\n  const group = useActionGroup(VIEW_OPTIONS_ACTION_GROUP_ID);\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  return (\n    group && (\n      <ActionGroupMenu actionGroup={group}>\n        {(actionMenuProps) => (\n          <SpeedSearchMenu\n            {...menuProps}\n            {...actionMenuProps}\n            selectedKeys={selectedKeys}\n          />\n        )}\n      </ActionGroupMenu>\n    )\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  BareButton,\n  MenuTrigger,\n  MenuTriggerProps,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledDropdownButton = styled.button`\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding-left: 0.25rem;\n  cursor: pointer;\n  background: transparent;\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n\n  line-height: 1.5;\n  border-radius: 0.25rem;\n  white-space: nowrap;\n  border: 2px solid transparent;\n  &:hover {\n    color: ${({ theme }) => theme.color(\"*.foreground\")};\n  }\n  &:focus-visible {\n    border-color: ${({ theme }) =>\n      theme.commonColors.focusRing({ focused: true })};\n  }\n`;\n\nconst StyledDropdownIcon = styled.span`\n  margin-left: -1px;\n  line-height: 1.2;\n`;\n\nconst StyledValue = styled.span`\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  max-width: 8.25rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst FocusableAutoHoverPlatformIcon = styled(AutoHoverPlatformIcon)`\n  &:focus-visible {\n    outline: 2px solid\n      ${({ theme }) => theme.commonColors.focusRing({ focused: true })};\n    outline-offset: -2px;\n  }\n`;\nexport function VcsFilterDropdown({\n  label,\n  value,\n  onClear,\n  ...menuTriggerProps\n}: Omit<MenuTriggerProps, \"children\"> & {\n  label: React.ReactNode;\n  value?: React.ReactNode;\n  onClear?: () => void;\n}) {\n  return (\n    <MenuTrigger {...menuTriggerProps}>\n      {(props, ref) => (\n        <StyledDropdownButton {...props} ref={ref}>\n          {label}\n          {value ? (\n            <>\n              : <StyledValue>{value}</StyledValue>\n              <BareButton onPress={onClear}>\n                <FocusableAutoHoverPlatformIcon\n                  icon=\"actions/close\"\n                  hoverIcon=\"actions/closeHovered\"\n                />\n              </BareButton>\n            </>\n          ) : (\n            <StyledDropdownIcon>\n              <PlatformIcon icon=\"general/arrowDownSmall.svg\" />\n            </StyledDropdownIcon>\n          )}\n        </StyledDropdownButton>\n      )}\n    </MenuTrigger>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport React, { HTMLAttributes, useEffect, useState } from \"react\";\nimport { selector, useRecoilState, useResetRecoilState } from \"recoil\";\nimport {\n  Divider,\n  Item,\n  MenuItemLayout,\n  SpeedSearchMenu,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  allBranchesState,\n  BranchType,\n  useFavoriteBranches,\n} from \"../../Branches/branches.state\";\nimport { BranchFavoriteButton } from \"../../Branches/BranchFavoriteButton\";\nimport { vcsLogFilter } from \"../vcs-logs.state\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\n\nexport function BranchesFilterDropdown({ tabKey }: { tabKey: string }) {\n  const [selectedBranches, setSelectedBranches] = useRecoilState(\n    vcsLogFilter.branch(tabKey)\n  );\n  const resetBranches = useResetRecoilState(vcsLogFilter.branch(tabKey));\n\n  return (\n    <VcsFilterDropdown\n      value={selectedBranches.length > 0 ? selectedBranches.join(\"|\") : null}\n      onClear={resetBranches}\n      renderMenu={({ menuProps }) => (\n        <BranchesFilterMenu\n          menuProps={menuProps}\n          onBranchesSelected={setSelectedBranches}\n        />\n      )}\n      label=\"Branch\"\n    />\n  );\n}\n\nconst groupRepoRoots = (\n  branches: Array<{ branchName: string; repoRoot: string }>\n) =>\n  Object.entries(groupBy(({ branchName }) => branchName, branches)).map(\n    ([branchName, items]) => ({\n      branchName,\n      repoRoots: items.map((item) => item.repoRoot),\n    })\n  );\n/**\n * Unique list of all local and remote branches of all repositories.\n * Each branch has a list of repos which indicates the list of repository roots the branch appears in.\n */\nconst repoGroupedAllBranchesState = selector({\n  key: \"vcs/allBranchesRepoConsolidated\",\n  get: ({ get }) => {\n    const allBranches = get(allBranchesState);\n    const allRemoteBranches = allBranches.flatMap(\n      ({ remoteBranches, repoRoot }) =>\n        remoteBranches.map((branch) => ({\n          repoRoot,\n          branchName: `${branch.remote}/${branch.name}`,\n        }))\n    );\n    const allLocalBranches = allBranches.flatMap(\n      ({ localBranches, repoRoot }) =>\n        localBranches.map((branch) => ({\n          repoRoot,\n          branchName: branch.name,\n        }))\n    );\n    return {\n      localBranches: groupRepoRoots(allLocalBranches),\n      remoteBranches: groupRepoRoots(allRemoteBranches),\n    };\n  },\n});\n\ntype BranchMenuItem = {\n  branchType: BranchType;\n  branchName: string;\n  repoRoots: string[];\n};\n\nfunction BranchesFilterMenu({\n  menuProps,\n  onBranchesSelected,\n}: {\n  onBranchesSelected: (branches: string[]) => void;\n  menuProps: Omit<HTMLAttributes<HTMLElement>, \"autoFocus\">;\n}) {\n  const [favoriteBranches, setFavoriteBranches] = useState<BranchMenuItem[]>(\n    []\n  );\n  const { toggleFavorite, isFavorite } = useFavoriteBranches();\n  const [repoGroupedAllBranches] = useLatestRecoilValue(\n    repoGroupedAllBranchesState\n  );\n  const { localBranches = [], remoteBranches = [] } =\n    repoGroupedAllBranches || {};\n\n  const remoteBranchesByRemote = groupBy(\n    ({ branchName }) => branchName.split(\"/\")[0],\n    remoteBranches\n  );\n\n  // The list of favorite branches is calculated on render, and is intentionally not updated. This behavior is copied\n  // from the reference implementation. Probably in order to not have items jump in and out of the menu, when branches\n  // are marked/unmarked as favorite. One improvement (?) here is that isFavorite state is always correct, as opposed\n  // to the reference implementation where (at least currently) the state of favorite icon is not kept up-to-date.\n  useEffect(() => {\n    const createLocalBranchItems = (\n      branchType: BranchType,\n      branches: Array<{ branchName: string; repoRoots: string[] }>\n    ): BranchMenuItem[] => {\n      return branches\n        .filter(({ branchName, repoRoots }) =>\n          repoRoots.some((repoRoot) =>\n            isFavorite({ branchType, branchName, repoRoot })\n          )\n        )\n        .map(({ branchName, repoRoots }) => ({\n          branchType,\n          branchName,\n          repoRoots,\n        }));\n    };\n\n    setFavoriteBranches(\n      [\n        {\n          branchType: \"LOCAL\",\n          branchName: \"HEAD\",\n          repoRoots: [],\n        } as BranchMenuItem,\n      ]\n        .concat(createLocalBranchItems(\"LOCAL\", localBranches))\n        .concat(createLocalBranchItems(\"REMOTE\", remoteBranches))\n    );\n  }, []);\n\n  const renderBranchItem = ({\n    branchName,\n    branchType,\n    repoRoots,\n  }: BranchMenuItem) => (\n    <Item key={`branch:${branchName}`} textValue={branchName}>\n      <MenuItemLayout\n        content={branchName}\n        icon={\n          <BranchFavoriteButton\n            isFavorite={\n              branchName === \"HEAD\" ||\n              repoRoots.some((repoRoot) =>\n                isFavorite({\n                  branchType,\n                  repoRoot,\n                  branchName,\n                })\n              )\n            }\n            onClick={() => {\n              if (branchName !== \"HEAD\") {\n                repoRoots.forEach((repoRoot) => {\n                  toggleFavorite({\n                    branchType,\n                    repoRoot,\n                    branchName,\n                  });\n                });\n              }\n            }}\n          />\n        }\n      />\n    </Item>\n  );\n  return (\n    <SpeedSearchMenu\n      {...menuProps}\n      submenuBehavior=\"toggleOnPress\"\n      autoFocus=\"first\"\n      minWidth={250}\n      onAction={(key) => {\n        const [type, value] = `${key}`.split(\":\");\n        if (type === \"branch\" && value) {\n          onBranchesSelected([value]);\n        } else if (type === \"favorites\") {\n          onBranchesSelected(\n            favoriteBranches.map(({ branchName }) => branchName)\n            // we could have filtered the ones that are actually favorite at this point, but not doing so to follow\n            // the original implementation, even though it's a little questionable.\n          );\n        } else if (type === \"select\") {\n          notImplemented(); // TODO\n        }\n      }}\n    >\n      {[\n        <Item key=\"select\">Select...</Item>,\n        <Item key=\"favorites\">Favorites</Item>,\n        ...favoriteBranches.map(renderBranchItem),\n        <Divider />,\n        <Item key=\"local\" title=\"Local\">\n          {localBranches.map(({ branchName, repoRoots }) =>\n            renderBranchItem({ branchType: \"LOCAL\", branchName, repoRoots })\n          )}\n        </Item>,\n        ...Object.entries(remoteBranchesByRemote).map(([origin, branches]) => (\n          <Item key={`remote:${origin}`} title={`${origin}/...`}>\n            {branches.map(({ branchName, repoRoots }) =>\n              renderBranchItem({ branchType: \"REMOTE\", branchName, repoRoots })\n            )}\n          </Item>\n        )),\n      ]}\n    </SpeedSearchMenu>\n  );\n}\n","import { selectorFamily } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport type GitUser = { name: string; email: string };\n\nexport function areUsersEqual(\n  user1: GitUser | null | undefined,\n  user2: GitUser | null | undefined\n): boolean {\n  return (\n    Boolean(user1) &&\n    user1?.email === user2?.email &&\n    user1?.name === user2?.name\n  );\n}\nexport function areSamePerson(user1: GitUser, user2: GitUser): boolean {\n  return (\n    getNameInStandardForm(user1.name) === getNameInStandardForm(user2.name)\n  );\n}\nconst NAME_PATTERN = \"(\\\\w+)[\\\\p{Punct}\\\\s](\\\\w+)\";\n\nfunction getNameInStandardForm(name: string) {\n  const firstAndLastName = getFirstAndLastName(name);\n  if (firstAndLastName != null) {\n    const [firstName, lastName] = firstAndLastName;\n    return firstName.toLowerCase() + \" \" + lastName.toLowerCase(); // synonyms detection is currently english-only\n  }\n  return nameToLowerCase(name);\n}\n\nconst PRINTABLE_ASCII_PATTERN = \"[ -~]*\";\nfunction nameToLowerCase(name: string) {\n  if (!name.match(PRINTABLE_ASCII_PATTERN)) return name;\n  return name.toLowerCase();\n}\nfunction getFirstAndLastName(name: string) {\n  const matches = name.match(NAME_PATTERN);\n  if (matches) {\n    return [matches[1], matches[2]];\n  }\n  return null;\n}\nexport const gitRepoUserState = selectorFamily<GitUser, string>({\n  key: \"vcs/repo-user\",\n  get: (repoRoot: string) => async () => {\n    const name = await git.getConfig({ fs, dir: repoRoot, path: \"user.name\" });\n    const email = await git.getConfig({\n      fs,\n      dir: repoRoot,\n      path: \"user.email\",\n    });\n    return {\n      name: name ?? \"\",\n      email: email ?? \"\",\n    };\n  },\n});\n","import React, { CSSProperties, RefObject, useMemo } from \"react\";\nimport { css, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { ReadCommitResult } from \"isomorphic-git\";\n\nimport { GitRef } from \"../GitRef\";\nimport { RefLabel, RefIcon } from \"../RefLabel\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityState,\n  vcsTableHighlightMyCommitsState,\n  vcsTableReferencesOnTheLeftState,\n  vcsTableShowCommitTimestampState,\n} from \"./CommitsTable.state\";\nimport {\n  areSamePerson,\n  gitRepoUserState,\n  GitUser,\n} from \"../../git-users.state\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsLogFilterCurrentTab,\n} from \"../vcs-logs.state\";\nimport {\n  formatCommitDateTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\n\nconst StyledCommitRow = styled.div`\n  display: flex;\n  height: 1.5rem;\n  align-items: center;\n  width: 100%;\n  --column-width-1: 130px;\n  --column-width-2: 130px;\n  --column-width-3: 70px;\n`;\nconst StyledCommitCell = styled.div`\n  overflow: hidden;\n  padding-left: 0.25rem;\n`;\n\nconst StyledRefsContainer = styled.div<{ asOverlay?: boolean }>`\n  ${({ asOverlay }) =>\n    !asOverlay\n      ? css`\n          position: absolute;\n          right: 0;\n          top: 1px;\n          max-width: calc(100% - 100px);\n        `\n      : css`\n          flex-shrink: 0;\n        `};\n\n  display: flex;\n  gap: 0.25rem;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(theme.color(\"List.background\"))};\n`;\nconst StyledMessageContainer = styled.div`\n  position: relative;\n  display: flex;\n  gap: 0.25rem;\n`;\n\nconst StyledRefTooltipRow = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0.25rem;\n  font-size: 0.75rem;\n`;\nconst useCurrentUserHighlightStyle = ({\n  repoRoot,\n  author,\n}: {\n  repoRoot: string;\n  author: GitUser;\n}): CSSProperties => {\n  const currentUser = useRecoilValue(gitRepoUserState(repoRoot));\n  const shouldHighlightCurrentUserCommits = useRecoilValue(\n    vcsTableHighlightMyCommitsState\n  );\n  // for now assuming only a single table can be visible, and that's current tab's.\n  const userFilter = useRecoilValue(vcsLogFilterCurrentTab.user);\n  // single user case is not considered a special case, like it is in the original impl\n  const shouldHighlight =\n    shouldHighlightCurrentUserCommits &&\n    userFilter !== CURRENT_USER_FILTER_VALUE &&\n    areSamePerson(currentUser, author);\n\n  return { fontWeight: shouldHighlight ? \"bold\" : undefined };\n};\n\nexport function CommitsTableRow({\n  refs,\n  readCommitResult: {\n    oid,\n    commit: { author, committer, message },\n  },\n  repoRoot,\n}: {\n  repoRoot: string;\n  readCommitResult: ReadCommitResult;\n  refs: GitRef[] | undefined;\n}) {\n  const showCommitTimestamp = useRecoilValue(vcsTableShowCommitTimestampState);\n  const referencesOnTheLeft = useRecoilValue(vcsTableReferencesOnTheLeftState);\n  const isAuthorVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(authorColumn.id)\n  );\n  const isDateVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(dateColumn.id)\n  );\n  const isHashVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(hashColumn.id)\n  );\n\n  const highlightStyles = useCurrentUserHighlightStyle({ author, repoRoot });\n  return (\n    <StyledCommitRow>\n      <StyledCommitCell style={{ flexBasis: \"0%\", flexGrow: 1, flexShrink: 1 }}>\n        <StyledMessageContainer>\n          {refs && <CommitRefs onLeft={referencesOnTheLeft} refs={refs} />}\n          <span style={highlightStyles}>\n            {parseCommitMessage(message).subject}\n          </span>\n        </StyledMessageContainer>\n      </StyledCommitCell>\n      {isAuthorVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-1)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {author.name}\n          {committer.name !== author.name && \"*\"}\n        </StyledCommitCell>\n      )}\n      {isDateVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-2)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {formatCommitDateTime(\n            (showCommitTimestamp ? committer : author).timestamp * 1000\n          )}\n        </StyledCommitCell>\n      )}\n      {isHashVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-3)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {shortenOid(oid)}\n        </StyledCommitCell>\n      )}\n    </StyledCommitRow>\n  );\n}\n\nfunction refKey(ref: GitRef) {\n  return `${ref.type}${ref.name}`;\n}\n\nfunction CommitRefs({ refs, onLeft }: { refs: GitRef[]; onLeft?: boolean }) {\n  const { filteredRefs } = useMemo(() => {\n    const headIsOnABranch = refs.some(\n      (ref) => ref.type === \"localBranch\" && ref.isCurrent\n    );\n    return {\n      filteredRefs: refs.filter(\n        (ref) =>\n          !(\n            (ref.type === \"head\" && headIsOnABranch) ||\n            (ref.type === \"remoteBranch\" &&\n              refs.find(\n                (aBranch) =>\n                  aBranch.type === \"localBranch\" &&\n                  aBranch.trackingBranch === ref.name\n              ))\n          )\n      ),\n    };\n  }, [refs]);\n\n  return (\n    <TooltipTrigger\n      placement=\"bottom\"\n      delay={800}\n      isDisabled={refs.length < 2}\n      tooltip={\n        <Tooltip withPointer>\n          {refs.map((ref) => (\n            <StyledRefTooltipRow key={refKey(ref)}>\n              <RefIcon type={ref.type} />\n              {ref.name}\n            </StyledRefTooltipRow>\n          ))}\n        </Tooltip>\n      }\n    >\n      {({ ref, ...tooltipTriggerProps }) => (\n        <StyledRefsContainer\n          ref={ref as RefObject<HTMLDivElement>}\n          asOverlay={onLeft}\n          {...tooltipTriggerProps}\n        >\n          {filteredRefs\n            .filter(\n              (ref) =>\n                ref.type !== \"remoteBranch\" ||\n                !refs.find(\n                  (aBranch) =>\n                    aBranch.type === \"localBranch\" &&\n                    aBranch.trackingBranch === ref.name\n                )\n            )\n            .map((ref) => {\n              let name = ref.name;\n              const types: GitRef[\"type\"][] = [ref.type];\n              if (ref.type === \"localBranch\" && ref.trackingBranch) {\n                types.unshift(\"remoteBranch\");\n                name = `${ref.trackingBranch.split(\"/\")[0]} & ${ref.name}`;\n              }\n              if (ref.type === \"localBranch\" && ref.isCurrent) {\n                types.push(\"head\");\n              }\n              return (\n                <RefLabel key={refKey(ref)} types={types}>\n                  {name}\n                </RefLabel>\n              );\n            })}\n        </StyledRefsContainer>\n      )}\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { Item, Link, List, ProgressBar, styled } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { useResetFilters, vcsActiveTabKeyState } from \"../vcs-logs.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport { CommitsTableRow } from \"./CommitsTableRow\";\nimport { GitRef } from \"../GitRef\";\nimport {\n  allResolvedRefsState,\n  commitsSelectionState,\n  commitsTableRowsState,\n} from \"./CommitsTable.state\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\n\n// const StyledList = styled(List)`\n//   display: grid;\n//   grid-template-columns: repeat(3, auto); /* Define 3 columns */\n//\n//   ${StyledListItem} {\n//     display: contents;\n//   }\n// ` as typeof List;\n\nconst StyledProgressBar = styled(ProgressBar)`\n  position: absolute;\n  width: 100%;\n  z-index: 1;\n`;\nconst StyledContainer = styled.div`\n  position: relative;\n  min-height: 0;\n  flex: 1;\n  ${StyledListItem} {\n    // the default \"min-width: min-content\", which is necessary for sizing overlays (e.g. Popup) containing list/tree,\n    // results in horizontally scrollable table. Probably not an issue when a proper Table component is implemented.\n    min-width: unset;\n  }\n`;\n\nconst ResolvedRefsContext = React.createContext<Record<string, GitRef[]>>({});\nexport function CommitsTable() {\n  const currentTabKey = useRecoilValue(vcsActiveTabKeyState);\n  const resetFilters = useResetFilters();\n\n  const [result, commitRowsState] = useLatestRecoilValue(commitsTableRowsState);\n  const rows = result?.rows;\n  const [allResolvedRefs] = useLatestRecoilValue(allResolvedRefsState);\n  const [selectedCommits, setSelectedCommits] = useRecoilState(\n    commitsSelectionState\n  );\n\n  return (\n    <ResolvedRefsContext.Provider value={allResolvedRefs ?? {}}>\n      <StyledContainer>\n        {commitRowsState === \"loading\" && (\n          <StyledProgressBar aria-label=\"Loading commits\" isIndeterminate />\n        )}\n        {rows && rows.length > 0 && (\n          <List\n            aria-label=\"Commits list\"\n            items={rows}\n            fillAvailableSpace\n            selectionMode=\"multiple\"\n            selectedKeys={selectedCommits}\n            onSelectionChange={setSelectedCommits}\n            estimatedItemHeight={24}\n          >\n            {({ readCommitResult, repoPath }) => (\n              <Item\n                key={readCommitResult.oid}\n                textValue={readCommitResult.commit.message}\n              >\n                {/* Using context here due to rendering optimizations of collection API */}\n                <ResolvedRefsContext.Consumer>\n                  {(refs) => (\n                    <CommitsTableRow\n                      readCommitResult={readCommitResult}\n                      repoRoot={repoPath}\n                      refs={refs[readCommitResult.oid]}\n                    />\n                  )}\n                </ResolvedRefsContext.Consumer>\n              </Item>\n            )}\n          </List>\n        )}\n        {commitRowsState === \"hasValue\" && rows && rows.length === 0 && (\n          <StyledPlaceholderContainer>\n            No commits matching filters\n            <Link onPress={() => resetFilters(currentTabKey)}>\n              Reset filters\n            </Link>\n          </StyledPlaceholderContainer>\n        )}\n      </StyledContainer>\n    </ResolvedRefsContext.Provider>\n  );\n}\n","import React from \"react\";\nimport { RecoilState, useRecoilState } from \"recoil\";\nimport {\n  ActionTooltip,\n  IconButtonWithMenu,\n  Item,\n  PlatformIcon,\n  Section,\n  SpeedSearchMenu,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityState,\n  vcsTableHighlightMyCommitsState,\n  vcsTableReferencesOnTheLeftState,\n  vcsTableShowCommitTimestampState,\n} from \"./CommitsTable.state\";\n\ntype ToggleDef = {\n  name: string;\n  state: RecoilState<boolean>;\n};\nconst showToggleDefs = [\n  { name: \"Commit Timestamp\", state: vcsTableShowCommitTimestampState },\n  { name: \"References on the Left\", state: vcsTableReferencesOnTheLeftState },\n];\nconst highlightToggleDefs = [\n  { name: \"My Commits\", state: vcsTableHighlightMyCommitsState },\n];\nconst columnToggleDefs = [authorColumn, hashColumn, dateColumn].map(\n  ({ name, id }) => ({\n    name,\n    state: vcsTableColumnsVisibilityState(id),\n  })\n);\nconst useToggleDef = (item: ToggleDef) => {\n  const [value, set] = useRecoilState(item.state);\n  return { ...item, key: item.state.key.replace(/\"/g, \"_\"), value, set };\n};\n\nexport function CommitsTableViewOptionsMenuIconButton() {\n  const showToggles = showToggleDefs.map(useToggleDef);\n  const highlightToggles = highlightToggleDefs.map(useToggleDef);\n  const columnToggles = columnToggleDefs.map(useToggleDef);\n\n  const allToggles = showToggles.concat(highlightToggles).concat(columnToggles);\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            // TODO: keep menu open when (certain) items are toggled. Search for closeOnSelect TODO in menu\n            <SpeedSearchMenu\n              {...menuProps}\n              selectedKeys={allToggles\n                .filter(({ value }) => value)\n                .map(({ key }) => key)}\n              onAction={(key) => {\n                const toggle = allToggles.find(\n                  ({ key: toggleKey }) => toggleKey === key\n                );\n                if (toggle) {\n                  toggle.set((value) => !value);\n                } else {\n                  notImplemented();\n                }\n              }}\n            >\n              <Section title=\"Show\">\n                <Item>Compact References View</Item>\n                <Item>Tag Names</Item>\n                <Item>Long Edges</Item>\n                {\n                  showToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item title=\"Columns\">\n                  {\n                    columnToggles.map(({ name, key }) => (\n                      <Item key={key}>{name}</Item>\n                    )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                  }\n                </Item>\n              </Section>\n              <Section title=\"Highlight\">\n                {\n                  highlightToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item>Merge Commits</Item>\n                <Item>Current Branch</Item>\n                <Item>Not Cherry-Picked Commits</Item>\n              </Section>\n            </SpeedSearchMenu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { v4 as uuid } from \"uuid\";\nimport React, { useEffect, useState } from \"react\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  IconButton,\n  Item,\n  Menu,\n  PlatformIcon,\n  SearchInput,\n  styled,\n  StyledHoverContainer,\n  Toolbar,\n  ToolbarSeparator,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport {\n  atom,\n  RecoilState,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n  useResetRecoilState,\n} from \"recoil\";\nimport { searchInputRefState } from \"../VersionControlToolWindow\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsTabKeysState,\n} from \"../vcs-logs.state\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { DateRange, dateToString } from \"../DateRange\";\nimport { BranchesFilterDropdown } from \"./BranchesFilterDropdown\";\nimport { CommitsTable } from \"./CommitsTable\";\nimport { CommitsTableViewOptionsMenuIconButton } from \"./CommitsTableViewOptionsMenuIconButton\";\n\nconst StyledSearchInput = styled(SearchInput)`\n  border-radius: 2px;\n  width: 219px;\n  margin-right: 0.0625rem;\n  margin-left: 0.2rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst searchHistoryState = atom<string[]>({\n  key: \"vcs/toolwindow/searchHistory\",\n  default: [], // TODO: add an effect to persist it under application level other.xml file under\n  // PropertyService component's \"Vcs.Log.Text.Filter.History\" property\n});\n\nexport function VcsLogCommitsView({ tabKey }: { tabKey: string }) {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const [searchQuery, setSearchQuery] = useRecoilState(\n    vcsLogFilter.searchQuery(tabKey)\n  );\n  const [user, setUser] = useRecoilState(vcsLogFilter.user(tabKey));\n  const resetUser = useResetRecoilState(vcsLogFilter.user(tabKey));\n  const [dateFilter, setDateFilter] = useRecoilState(vcsLogFilter.date(tabKey));\n  const resetDate = useResetRecoilState(vcsLogFilter.date(tabKey));\n  const [searchHistory, setSearchHistory] = useRecoilState(searchHistoryState);\n  const [searchInputValue, setSearchInputValue] = useState(searchQuery);\n  const getActionShortcut = useGetActionShortcut();\n  const isRegExpOn = useRecoilValue(vcsLogFilter.regExp(tabKey));\n  const isMatchCaseOn = useRecoilValue(vcsLogFilter.matchCase(tabKey));\n  const submitSearchQuery = (value = searchInputValue) => {\n    setSearchQuery(value);\n    if (value && !searchHistory.includes(value)) {\n      setSearchHistory((searchHistory) => [\n        value,\n        ...searchHistory.filter((item) => item !== value),\n      ]);\n    }\n  };\n\n  useEffect(() => {\n    setSearchInputValue(searchQuery);\n  }, [searchQuery]);\n\n  const createNewTab = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        const newTabId = uuid();\n        set(vcsTabKeysState, (value) => [...value, newTabId]);\n        Object.values(vcsLogFilter).forEach(\n          (filterState: (tabKey: string) => RecoilState<any>) => {\n            set(\n              filterState(newTabId),\n              snapshot\n                .getLoadable(\n                  filterState(\n                    snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n                  )\n                )\n                .getValue()\n            );\n          }\n        );\n        set(vcsActiveTabKeyState, newTabId);\n      },\n    []\n  );\n  const today = new Date();\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(today.getDate() - 7);\n  const yesterday = new Date();\n  yesterday.setDate(today.getDate() - 1);\n  const predefinedDateRanges = [\n    {\n      name: \"Last 24 hours\",\n      value: { from: yesterday },\n    },\n    {\n      name: \"Last 7 days\",\n      value: { from: sevenDaysAgo },\n    },\n  ];\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName=\"Text or Hash Filter\"\n              shortcut={getActionShortcut(VcsActionIds.FOCUS_TEXT_FILTER)}\n            />\n          }\n        >\n          <StyledSearchInput\n            inputRef={textFilterRef}\n            value={searchInputValue}\n            onChange={setSearchInputValue}\n            onSubmit={submitSearchQuery}\n            onBlur={() => submitSearchQuery()}\n            onClear={() => submitSearchQuery(\"\")}\n            searchHistory={searchHistory}\n            addonAfter={\n              <>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.REG_EXP}\n                >\n                  <AutoHoverPlatformIcon\n                    icon={\n                      isRegExpOn ? \"actions/regexSelected\" : \"actions/regex\"\n                    }\n                    hoverIcon={\n                      isRegExpOn\n                        ? \"actions/regexSelected\"\n                        : \"actions/regexHovered\"\n                    }\n                  />\n                </StyledHoverContainer>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.MATCH_CASE}\n                >\n                  {isMatchCaseOn ? (\n                    <PlatformIcon icon=\"actions/matchCaseSelected\" />\n                  ) : (\n                    <AutoHoverPlatformIcon\n                      icon=\"actions/matchCase\"\n                      hoverIcon=\"actions/matchCaseHovered\"\n                    />\n                  )}\n                </StyledHoverContainer>\n              </>\n            }\n          />\n        </TooltipTrigger>\n        <Toolbar>\n          <BranchesFilterDropdown tabKey={tabKey} />\n          <VcsFilterDropdown\n            value={user === CURRENT_USER_FILTER_VALUE ? \"me\" : user}\n            onClear={resetUser}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  if (key === \"select\") {\n                    return notImplemented();\n                  }\n                  setUser(`${key}`);\n                }}\n              >\n                <Item key=\"select\">Select...</Item>\n                <Item key={CURRENT_USER_FILTER_VALUE}>me</Item>\n              </Menu>\n            )}\n            label=\"User\"\n          />\n          <VcsFilterDropdown\n            value={dateFilter && dateRangeToString(dateFilter)}\n            onClear={resetDate}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  const predefinedDateRange = predefinedDateRanges.find(\n                    ({ name }) => name === key\n                  );\n                  if (predefinedDateRange) {\n                    setDateFilter(predefinedDateRange.value);\n                  } else {\n                    notImplemented();\n                  }\n                }}\n              >\n                {[\n                  <Item key=\"select\">Select...</Item>,\n                  ...predefinedDateRanges.map(({ name }) => (\n                    <Item key={name}>{name}</Item>\n                  )),\n                ]}\n              </Menu>\n            )}\n            label=\"Date\"\n          />\n          <VcsFilterDropdown\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Select in...</Item>\n                <Item>Select in Tree...</Item>\n              </Menu>\n            )}\n            label=\"Paths\"\n          />\n          <ToolbarSeparator />\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Open New Git Log Tab\" />}\n          >\n            <IconButton aria-label=\"Checkout\" onPress={createNewTab}>\n              <PlatformIcon icon=\"actions/openNewTab.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <ActionButton actionId={VcsActionIds.LOG_REFRESH} />\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Cherry-Pick\" />}>\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/cherryPick.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <CommitsTableViewOptionsMenuIconButton />\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip actionName=\"Go To Hash/Branch/Tag\" shortcut=\"F\" />\n            }\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/find\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n      </StyledHeader>\n      <CommitsTable />\n    </StyledContainer>\n  );\n}\n\nfunction dateRangeToString(dateRange: DateRange): string {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n}\n","import { basename } from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, atomFamily, isRecoilValue, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { PlatformIcon, TreeRefValue } from \"@intellij-platform/core\";\n\nimport {\n  allBranchesState,\n  BranchType,\n  isFavoriteBranchState,\n  LocalBranch,\n  RemoteBranch,\n  RepoBranches,\n} from \"../../Branches/branches.state\";\nimport {\n  DirectoryNode,\n  createGroupByDirectory,\n} from \"../../../tree-utils/groupByDirectory\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { vcsLogTabState } from \"../vcs-logs.state\";\n\ntype LocalBranchNode = {\n  type: \"localBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is current branch in at least one repo\n   */\n  isCurrent: boolean;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n};\ntype RemoteBranchNode = {\n  type: \"remoteBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n  branches: Array<{ repoRoot: string; branch: RemoteBranch }>;\n};\ntype BranchDirectoryNode = DirectoryNode & {\n  children: readonly AnyBranchTreeNode[];\n};\ntype RepositoryNode = {\n  type: \"repository\";\n  key: string;\n  repoRoot: string;\n  children: ReadonlyArray<LocalBranchNode | RemoteBranchNode | DirectoryNode>;\n};\nexport type AnyBranchTreeNode =\n  | {\n      type: \"head\";\n    }\n  | {\n      type: \"branchType\";\n      branchType: BranchType;\n      children: readonly AnyBranchTreeNode[];\n    }\n  | RepositoryNode\n  | BranchDirectoryNode\n  | LocalBranchNode\n  | RemoteBranchNode;\n\nfunction getLocalBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allLocalBranches = repoBranches.flatMap(\n    ({ repoRoot, localBranches, currentBranch }) =>\n      localBranches.map((branch) => ({\n        repoRoot,\n        isCurrent: currentBranch?.name === branch.name,\n        branch,\n      }))\n  );\n  const localBranchNodes = Object.entries(\n    groupBy(({ branch }) => branch.name, allLocalBranches)\n  ).map<LocalBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"localBranch\",\n      key: `localBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"LOCAL\",\n          branchName: branch.name,\n        })\n      ),\n      isCurrent: branches.some(({ isCurrent }) => isCurrent),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(localBranchNodes);\n  }\n  return localBranchNodes;\n}\n\nfunction getRemoteBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allRemoteBranches = repoBranches.flatMap(\n    ({ repoRoot, remoteBranches }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branch,\n      }))\n  );\n  const remoteBranchNodes = Object.entries(\n    groupBy(\n      ({ branch }) => `${branch.remote}/${branch.name}`,\n      allRemoteBranches\n    )\n  ).map<RemoteBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"remoteBranch\",\n      key: `remoteBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"REMOTE\",\n          branchName: branch.name,\n        })\n      ),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(remoteBranchNodes);\n  }\n  return remoteBranchNodes;\n}\n\nexport const branchesTreeNodeState = selector({\n  key: \"vcs/logs/branchesTree/nodes\",\n  get: ({ get }): AnyBranchTreeNode[] => {\n    // TODO: sorting. favorite should be on top. Others should be alphabetical\n    const repoBranches = get(allBranchesState);\n    const shouldGroupByDirectory = get(branchTreeGroupingState(\"directory\"));\n    const shouldGroupByRepository =\n      get(isGroupByRepositoryAvailableState) &&\n      get(branchTreeGroupingState(\"repository\"));\n\n    return [\n      { type: \"head\" },\n      {\n        type: \"branchType\",\n        branchType: \"LOCAL\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `LOCAL:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getLocalBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getLocalBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n      {\n        type: \"branchType\",\n        branchType: \"REMOTE\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `REMOTE:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getRemoteBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getRemoteBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n    ];\n  },\n});\nconst groupNodesByDirectory = createGroupByDirectory<\n  LocalBranchNode | RemoteBranchNode,\n  BranchDirectoryNode\n>({\n  shouldCollapseDirectories: false,\n  getPath: (node) => node.name,\n});\nexport const branchTreeGroupingState = atomFamily<\n  boolean,\n  \"directory\" | \"repository\"\n>({\n  key: \"vcs/logs/branchesTree/grouping\",\n  default: true,\n});\nexport const isGroupByRepositoryAvailableState = selector<boolean>({\n  key: \"vcs/logs/branchesTree/grouping/repo/available\",\n  get: ({ get }) => get(vcsRootsState).length > 1,\n});\nexport const branchesTreeRefState = vcsLogTabState(\n  atomFamily<RefObject<TreeRefValue>, string>({\n    key: \"vcs/logs/branchesTree/ref\",\n    default: React.createRef(),\n    dangerouslyAllowMutability: true,\n  })\n);\nexport const selectedKeysState = vcsLogTabState(\n  atomFamily<Selection, string>({\n    key: \"vcs/logs/branchesTree/selectedKeys\",\n    default: new Set(),\n  })\n);\nexport const expandedKeysState = vcsLogTabState(\n  atomFamily<Set<Key>, string>({\n    key: \"vcs/logs/branchesTree/expandedKeys\",\n    default: new Set(),\n  })\n);\n\nexport const searchInputState = vcsLogTabState(\n  atomFamily<string, string>({\n    key: \"vcs/logs/branchesTree/searchInput\",\n    default: \"\",\n  })\n);\n\nconst groupings = [\n  {\n    id: \"directory\" as const,\n    title: \"Directory\",\n    icon: <PlatformIcon icon=\"actions/GroupByPackage.svg\" />,\n    isActive: branchTreeGroupingState(\"directory\"),\n    isAvailable: true,\n  },\n  {\n    id: \"repository\" as const,\n    title: \"Repository\",\n    isActive: branchTreeGroupingState(\"repository\"),\n    isAvailable: isGroupByRepositoryAvailableState,\n  },\n];\nexport const availableGroupingsState = selector({\n  key: \"vcs/logs/branchesTree/availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        ...grouping,\n        isActive: get(branchTreeGroupingState(grouping.id)),\n      })),\n});\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../GroupByActionButton\";\nimport {\n  availableGroupingsState,\n  branchTreeGroupingState,\n} from \"./BranchesTree.state\";\n\nexport function BranchesGroupByActionButton() {\n  //  TODO: Generalize and convert to actions\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: \"directory\" | \"repository\") => {\n        set(branchTreeGroupingState(id), (value) => !value);\n      },\n    []\n  );\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n}\n","import { basename } from \"path\";\nimport React from \"react\";\nimport { ItemElement } from \"@react-types/shared/src/collections\";\nimport {\n  ActionTooltip,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { TrackingBranchInfo } from \"../../TrackingBranchInfo\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { AnyBranchTreeNode } from \"./BranchesTree.state\";\n\nexport const branchTreeNodeRenderers: {\n  [nodeType in AnyBranchTreeNode[\"type\"]]: (\n    node: AnyBranchTreeNode & { type: nodeType }\n  ) => ItemElement<AnyBranchTreeNode>;\n} = {\n  branchType: (node) => {\n    return (\n      <Item\n        key={`${node.type}:${node.branchType}`}\n        textValue={wordCase(node.branchType)}\n        childItems={node.children}\n      >\n        <HighlightedTextValue />\n      </Item>\n    );\n  },\n  localBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={node.branches} />}\n              ></ActionTooltip>\n            }\n          >\n            {(props) => (\n              <ItemLayout.Group {...props}>\n                {node.isCurrent ? (\n                  <TooltipTrigger\n                    tooltip={\n                      <Tooltip>\n                        Current {node.isFavorite && \"favorite \"}branch\n                      </Tooltip>\n                    }\n                  >\n                    {(props) => (\n                      <ItemLayout.Group {...props}>\n                        <PlatformIcon\n                          icon={\n                            node.isFavorite\n                              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n                              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n                          }\n                        />\n                      </ItemLayout.Group>\n                    )}\n                  </TooltipTrigger>\n                ) : (\n                  <PlatformIcon icon=\"vcs/branchNode\" />\n                )}\n                <HighlightedTextValue />\n                {node.repos && (\n                  <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n                )}\n              </ItemLayout.Group>\n            )}\n          </TooltipTrigger>\n        </ItemLayout>\n      </Item>\n    );\n  },\n  remoteBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <PlatformIcon\n            icon={node.isFavorite ? \"nodes/favorite.svg\" : \"vcs/branchNode\"}\n          />\n          <HighlightedTextValue />\n          {node.repos && (\n            <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n          )}\n        </ItemLayout>\n      </Item>\n    );\n  },\n  repository: (node) => (\n    <Item\n      key={`${node.key}`}\n      textValue={basename(node.repoRoot)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <RepoColorIcon rootPath={node.repoRoot} />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  directory: (node) => (\n    <Item\n      key={`${node.type}_${node.parentNodePath}${node.dirPath}`}\n      textValue={basename(node.dirPath)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <PlatformIcon icon=\"nodes/folder.svg\" />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  head: (node) => (\n    <Item key={`${node.type}`} textValue=\"HEAD (Current Branch)\">\n      <HighlightedTextValue />\n    </Item>\n  ),\n};\n\nfunction wordCase(input: string): string {\n  return input[0].toUpperCase() + input.slice(1).toLowerCase();\n}\n\nexport const keyToBranch = (key: string): string | null => {\n  const [type, _repo, branchName] = key.split(\":\");\n  if (type === \"head\") {\n    return \"HEAD\";\n  }\n  if (type === \"localBranch\" || type === \"remoteBranch\") {\n    return branchName ?? null;\n  }\n  return null;\n};\n","import React, { useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport {\n  PlatformIcon,\n  SpeedSearchTree,\n  styled,\n  useCollectionSearchInput,\n} from \"@intellij-platform/core\";\n\nimport {\n  branchTreeNodeRenderers,\n  keyToBranch,\n} from \"./branchTreeNodeRenderers\";\nimport {\n  branchesTreeNodeState,\n  branchesTreeRefState,\n  expandedKeysState,\n  searchInputState,\n  selectedKeysState,\n} from \"./BranchesTree.state\";\nimport { StyledHeader } from \"../styled-components\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\n\nconst StyledSearchInput = styled.input`\n  all: unset;\n  flex: 1;\n  align-self: stretch;\n`;\nconst StyledContainer = styled.div`\n  min-width: 0; // don't outgrow the container\n  flex-grow: 1; // fill the available space\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledSearchIconContainer = styled.span`\n  display: inline-flex;\n  margin-top: -0.0625rem;\n  margin-left: 0.7rem;\n  margin-right: 0.25rem;\n  cursor: text;\n`;\n\nexport function BranchesTree({ tabKey }: { tabKey: string }) {\n  const [branchesTreeNodes] = useLatestRecoilValue(branchesTreeNodeState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(\n    selectedKeysState(tabKey)\n  );\n  const [expandedKeys, setExpandedKeys] = useRecoilState(\n    expandedKeysState(tabKey)\n  );\n  const [searchTerm, setSearchTerm] = useRecoilState(searchInputState(tabKey));\n  const treeRef = useRecoilValue(branchesTreeRefState(tabKey));\n  const ref = useRef<HTMLDivElement>(null);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const selectionManagerRef = useRef<TreeSelectionManager>(null);\n  const [isInputFocused, setInputFocused] = useState(false);\n  const setBranchFilter = useSetRecoilState(vcsLogFilterCurrentTab.branch);\n  const onAction = (key: React.Key) => {\n    const branch = keyToBranch(`${key}`);\n    if (branch) {\n      setBranchFilter([branch]);\n    }\n  };\n\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef: ref,\n    selectionManager: selectionManagerRef.current,\n    onAction,\n  });\n  /**\n   * TODO: remaining from search:\n   * - Make the search input red when there is no match\n   * - filter non-matching tree nodes out\n   * - search in the whole tree, not just nodes that are currently visible based on expandedKeys\n   *   - update expanded keys to show matches, as a side effect, every time matches are updated.\n   * The above items are postponed to think more about flexibility of SpeedSearchTree API.\n   * Some rough thoughts about different approaches:\n   * - Provide generic tree utilities to search in the whole tree. In SpeedSearchTree allow for full control over\n   * `matches`. It will be in usage side that matches are calculated based on search input value, and passed to\n   * SpeedSearchTree as an input.\n   * - In SpeedSearchTree, allow for passing a custom search function, which would accept the tree collection object,\n   *   the search query, and the default match function (minusculeMatch).\n   * - Make Tree more flexible or introduce a more flexible base component, so that speed search for tree can be\n   *   implementated in a more composable way. Tree (or TreeBase) would accept props for intercepting `state` creation,\n   *   and it would also allow passing additional props to the tree container. Then a more generic CollectionSpeedSearch\n   *   component would offer options on how to control and customize speed search, and would return props to be passed\n   *   to collection components.\n   */\n\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <StyledSearchIconContainer>\n          <PlatformIcon icon=\"actions/search\" />\n        </StyledSearchIconContainer>\n        {/* FIXME: tabIndex -1 is a workaround to not get the input focused when the toolwindow opens. Not ideal.*/}\n        <StyledSearchInput\n          ref={searchInputRef}\n          tabIndex={-1}\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          {...mergeProps(collectionSearchInputProps, {\n            onFocus: () => {\n              setInputFocused(true);\n            },\n            onBlur: () => {\n              setInputFocused(false);\n            },\n          })}\n        />\n      </StyledHeader>\n      <SpeedSearchTree\n        ref={ref}\n        treeRef={treeRef}\n        selectionManagerRef={selectionManagerRef}\n        items={branchesTreeNodes ?? []}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onAction={onAction}\n        fillAvailableSpace\n        // speed search related props\n        showAsFocused={isInputFocused}\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        keepSearchActiveOnBlur\n        hideSpeedSearchPopup\n        isSearchActive\n      >\n        {(node) => {\n          // @ts-expect-error we need to somehow infer the type of `node.type`\n          return branchTreeNodeRenderers[node.type](node);\n        }}\n      </SpeedSearchTree>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  PlatformIcon,\n  Toolbar,\n  ToolbarSeparator,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { BranchesGroupByActionButton } from \"./BranchesGroupByActionButton\";\nimport { BranchesTree } from \"./BranchesTree\";\nimport { branchesTreeRefState } from \"./BranchesTree.state\";\n\nconst DELETE_BRANCH_ACTION_ID = \"Git.DeleteBranch\";\nconst SHOW_BRANCH_DIFF_ACTION_ID = \"Git.Compare.With.Current\";\nconst SHOW_MY_BRANCHES_ACTION_ID = \"Git.Show.My.Branches\";\nconst FETCH_ACTION_ID = \"Git.Fetch\";\nconst TOGGLE_FAVORITE_ACTION_ID = \"Git.Toggle.Favorite\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  height: 100%;\n`;\n\nexport function VcsBranchesView({ tabKey }: { tabKey: string }) {\n  const treeRef = useRecoilValue(branchesTreeRefState(tabKey));\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.GIT_UPDATE_SELECTED,\n      title: \"Update Selected\",\n      icon: <PlatformIcon icon=\"actions/checkOut\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: DELETE_BRANCH_ACTION_ID,\n      title: \"Delete branch\",\n      icon: <PlatformIcon icon=\"actions/gc\" />,\n      useShortcutsOf: \"SafeDelete\",\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_BRANCH_DIFF_ACTION_ID,\n      title: \"Compare with current\",\n      icon: <PlatformIcon icon=\"actions/diff\" />,\n      useShortcutsOf: VcsActionIds.SHOW_DIFF,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_MY_BRANCHES_ACTION_ID,\n      title: \"Show My Branches\",\n      icon: <PlatformIcon icon=\"actions/find\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: FETCH_ACTION_ID,\n      title: \"Fetch All Remotes\",\n      icon: <PlatformIcon icon=\"vcs/fetch\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: TOGGLE_FAVORITE_ACTION_ID,\n      title: \"Mark/Unmark as Favorite\",\n      icon: <PlatformIcon icon=\"nodes/favorite\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer {...shortcutHandlerProps}>\n          <VcsLogBranchesViewToolbar />\n          <BranchesTree tabKey={tabKey} />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst StyledToolbar = styled(Toolbar)`\n  height: 100%;\n  flex-shrink: 0;\n`;\n\nfunction VcsLogBranchesViewToolbar() {\n  return (\n    <StyledToolbar border=\"right\" orientation=\"vertical\">\n      <ActionButton actionId={VcsActionIds.GIT_LOG_HIDE_BRANCHES} />\n      <ToolbarSeparator />\n      {/*FIXME: replace this with a separate \"new branch from\" action*/}\n      <ActionButton actionId={VcsActionIds.GIT_CREATE_NEW_BRANCH} />\n      <ActionButton actionId={VcsActionIds.GIT_UPDATE_SELECTED} />\n      <ActionButton actionId={DELETE_BRANCH_ACTION_ID} />\n      <ActionButton actionId={SHOW_BRANCH_DIFF_ACTION_ID} />\n      <ActionButton actionId={SHOW_MY_BRANCHES_ACTION_ID} />\n      <ActionButton actionId={FETCH_ACTION_ID} />\n      <ActionButton actionId={TOGGLE_FAVORITE_ACTION_ID} />\n      <ActionButton\n        actionId={VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH}\n      />\n      <ToolbarSeparator />\n      <BranchesGroupByActionButton />\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </StyledToolbar>\n  );\n}\n","import { useRecoilCallback } from \"recoil\";\nimport React from \"react\";\nimport copyToClipboard from \"clipboard-copy\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  allCommitsState,\n  commitsSelectionState,\n  selectedCommitOids,\n} from \"./CommitsTable.state\";\n\nexport const useCommitsTableActions = (): ActionDefinition[] => {\n  const copyRevisionNumber = useRecoilCallback(\n    ({ snapshot }) =>\n      () => {\n        const selectedCommits = snapshot\n          .getLoadable(selectedCommitOids)\n          .getValue();\n        copyToClipboard(selectedCommits.join(\" \")).catch(console.error);\n      },\n    []\n  );\n\n  const refreshLog = useRecoilCallback(\n    ({ refresh }) =>\n      () => {\n        refresh(allCommitsState);\n      },\n    []\n  );\n\n  return [\n    {\n      id: VcsActionIds.COPY_REVISION_NUMBER,\n      title: \"Copy Revision Number\",\n      icon: <PlatformIcon icon=\"actions/copy.svg\" />,\n      useShortcutsOf: CommonActionId.COPY_REFERENCE,\n      actionPerformed: copyRevisionNumber,\n    },\n    {\n      id: VcsActionIds.LOG_REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      useShortcutsOf: CommonActionId.REFRESH,\n      actionPerformed: () => {\n        refreshLog();\n      },\n    },\n  ];\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function VersionControlToolWindowZeroState() {\n  const performAction = usePerformAction();\n\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To track changes to code:\n        <br />\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        <Link onPress={notImplemented}>Use Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React, { RefObject } from \"react\";\nimport {\n  atom,\n  RecoilState,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionTooltip,\n  DefaultToolWindow,\n  MultiViewToolWindow,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n  TooltipTrigger,\n  ToolWindowTabContent,\n} from \"@intellij-platform/core\";\n\nimport { VcsLogDetailsView } from \"./DetailsView/VcsLogDetailsView\";\nimport { VcsLogCommitsView } from \"./CommitsView/VcsLogCommitsView\";\nimport { VcsBranchesView } from \"./BranchesView/VcsBranchesView\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  useCloseVcsTab,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsLogTabShowBranchesState,\n  vcsLogTabShowCommitDetailsState,\n  vcsTabKeysState,\n  vcsTabTitleState,\n} from \"./vcs-logs.state\";\nimport { useCommitsTableActions } from \"./CommitsView/useCommitsTableActions\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { vcsRootsState } from \"../file-status.state\";\nimport { VersionControlToolWindowZeroState } from \"./VersionControlToolWindowZeroState\";\n\nexport const VERSION_CONTROL_TOOLWINDOW_ID = \"Version Control\";\n\nconst firstViewSizeState = atom({\n  key: \"vcs/toolwindow/firstViewSize\",\n  default: 0.25,\n});\nconst lastViewSizeState = atom({\n  key: \"vcs/toolwindow/lastViewSize\",\n  default: 0.35,\n});\n\nconst StyledToolWindowHeader = styled.span`\n  margin: 0 0.5rem 0 0.125rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  :focus-visible {\n    outline: none;\n  }\n`;\n\nexport const searchInputRefState = atom<RefObject<HTMLInputElement>>({\n  key: \"vcs/toolWindow/searchInputRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const VersionControlToolWindow = () => {\n  const tabKeys = useRecoilValue(vcsTabKeysState);\n  const [activeTabKey, setActiveTabKey] = useRecoilState(vcsActiveTabKeyState);\n  const repos = useRecoilValue(vcsRootsState);\n\n  return repos.length > 0 ? (\n    <MultiViewToolWindow\n      headerContent={<StyledToolWindowHeader>Git:</StyledToolWindowHeader>}\n      activeKey={activeTabKey}\n      onActiveKeyChange={(key) => setActiveTabKey(`${key}`)}\n    >\n      {tabKeys.map((key) => (\n        <MultiViewToolWindow.View\n          tabContent={<VcsToolWindowTabTitle tabKey={key} />}\n          key={key}\n        >\n          <VcsTab tabKey={key} />\n        </MultiViewToolWindow.View>\n      ))}\n    </MultiViewToolWindow>\n  ) : (\n    <DefaultToolWindow headerContent=\"Version Control\">\n      <VersionControlToolWindowZeroState />\n    </DefaultToolWindow>\n  );\n};\n\nconst StyledExpandStripeButton = styled.button.attrs({ tabIndex: -1 })`\n  box-sizing: border-box;\n  all: unset;\n  width: 1.71875rem;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.625rem;\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  :disabled {\n    color: ${({ theme }) => theme.color(\"Button.disabledText\")};\n  }\n  &:hover {\n    background: ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Button.hoverBackground\",\n        theme.dark ? \"#0f0f0f28\" : \"#55555528\"\n      )};\n  }\n`;\nconst StyledShowBranchesButton = styled(StyledExpandStripeButton)`\n  border-right: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nconst StyledShowBranchesButtonText = styled.span`\n  writing-mode: vertical-lr;\n  transform: rotateZ(180deg);\n  font-size: 0.6875rem;\n`;\n\nfunction ShowBranchesButton({ onPress }: { onPress: () => void }) {\n  return (\n    <StyledShowBranchesButton onClick={onPress}>\n      <PlatformIcon icon=\"actions/arrowExpand\" />\n      <StyledShowBranchesButtonText>Branches</StyledShowBranchesButtonText>\n    </StyledShowBranchesButton>\n  );\n}\n\nfunction VcsTab({ tabKey }: { tabKey: string }) {\n  const [firstViewSize, setFirstViewSize] = useRecoilState(firstViewSizeState);\n  const [lastViewSize, setLastViewSize] = useRecoilState(lastViewSizeState);\n\n  const actions = useVcsLogsToolWindowActions();\n  const [showBranches, setShowBranches] = useRecoilState(\n    vcsLogTabShowBranchesState(tabKey)\n  );\n\n  const firstViewProps: Partial<ThreeViewSplitterProps> = showBranches\n    ? {\n        firstView: <VcsBranchesView tabKey={tabKey} />,\n        firstSize: firstViewSize,\n        onFirstResize: setFirstViewSize,\n        firstViewMinSize: 85,\n      }\n    : {};\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        // tabIndex is added to make the whole container focusable, which means the focus can go away from the currently\n        // focused element, when background is clicked. This is to follow the original implementation.\n        <StyledContainer\n          {...shortcutHandlerProps}\n          tabIndex={showBranches ? -1 : 0}\n        >\n          {!showBranches && (\n            <ShowBranchesButton onPress={() => setShowBranches(true)} />\n          )}\n          <ThreeViewSplitter\n            {...firstViewProps}\n            innerView={<VcsLogCommitsView tabKey={tabKey} />}\n            innerViewMinSize={200}\n            lastView={<VcsLogDetailsView tabKey={tabKey} />}\n            lastSize={lastViewSize}\n            onLastResize={setLastViewSize}\n            lastViewMinSize={40}\n          />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nfunction useToggleCurrentTabSettings(\n  toggleState: (activeTab: string) => RecoilState<boolean>\n) {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          toggleState(snapshot.getLoadable(vcsActiveTabKeyState).getValue()),\n          (value) => !value\n        );\n      },\n    []\n  );\n}\n\nfunction useVcsLogsToolWindowActions() {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const hideBranches = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          vcsLogTabShowBranchesState(\n            snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n          ),\n          // Would be nicer to have the action toggle, but prioritized matching the reference impl here.\n          false\n        );\n      },\n    []\n  );\n\n  const toggleMatchCase = useToggleCurrentTabSettings(vcsLogFilter.matchCase);\n  const toggleRegExp = useToggleCurrentTabSettings(vcsLogFilter.regExp);\n  const toggleDetails = useToggleCurrentTabSettings(\n    vcsLogTabShowCommitDetailsState\n  );\n\n  const actions: ActionDefinition[] = [\n    ...useCommitsTableActions(),\n    {\n      id: VcsActionIds.FOCUS_TEXT_FILTER,\n      title: \"Focus Text Filter\",\n      actionPerformed: () => {\n        textFilterRef.current?.focus();\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_HIDE_BRANCHES,\n      title: \"Hide Git Branches\",\n      icon: <PlatformIcon icon=\"actions/arrowCollapse\" />,\n      actionPerformed: hideBranches,\n    },\n    {\n      id: VcsActionIds.MATCH_CASE,\n      title: \"Match Case\",\n      icon: <PlatformIcon icon=\"actions/matchCase.svg\" />,\n      actionPerformed: toggleMatchCase,\n    },\n    {\n      id: VcsActionIds.REG_EXP,\n      title: \"Regex\",\n      icon: <PlatformIcon icon=\"actions/regex\" />,\n      actionPerformed: toggleRegExp,\n    },\n    {\n      id: VcsActionIds.SHOW_DETAILS,\n      title: \"Show Details\",\n      description: \"Display details panel\",\n      actionPerformed: toggleDetails,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF_PREVIEW,\n      title: \"Show Diff Preview\",\n      description: \"Show Diff Preview Panel\",\n      actionPerformed: () => notImplemented(),\n    },\n  ];\n  return actions;\n}\n\nfunction VcsToolWindowTabTitle({ tabKey }: { tabKey: string }) {\n  const closeTab = useCloseVcsTab();\n  return (\n    <ToolWindowTabContent\n      title={useRecoilValue(vcsTabTitleState(tabKey))}\n      closeButton={\n        tabKey !== \"MAIN\" && (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Close Tab\" />}>\n            <TabCloseButton onPress={() => closeTab(tabKey)} />\n          </TooltipTrigger>\n        )\n      }\n    />\n  );\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\n\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\nimport {\n  VERSION_CONTROL_TOOLWINDOW_ID,\n  VersionControlToolWindow,\n} from \"../VersionControl/VersionControlToolWindow/VersionControlToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  showStripeButton?: boolean;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"left\",\n      isSplit: true, // Default is false in the original impl.\n      isVisible: false,\n    }),\n  },\n  {\n    id: VERSION_CONTROL_TOOLWINDOW_ID,\n    title: \"Version Control\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowChanges\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <VersionControlToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"bottom\",\n      weight: 0.35,\n    }),\n  },\n];\n","import { atom } from \"recoil\";\nimport { Bounds } from \"@intellij-platform/core\";\n\nexport const showProgressPanelState = atom({\n  key: \"ide.statusbar.showProgressPanel\",\n  default: false,\n});\nexport const tasksPopupBoundsState = atom<Bounds | null>({\n  key: \"ide.statusbar.tasksPopup\",\n  default: null,\n});\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport {\n  IconButton,\n  PlatformIcon,\n  Popup,\n  ProgressBar,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { tasksState, useCancelTask } from \"../tasks\";\nimport {\n  showProgressPanelState,\n  tasksPopupBoundsState,\n} from \"./IdeStatusBar.state\";\n\nconst StyledPopupTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport function TasksPopup() {\n  const setShowProgressPanel = useSetRecoilState(showProgressPanelState);\n  const tasks = useRecoilValue(tasksState);\n  const cancel = useCancelTask();\n  const [bounds, setBounds] = useRecoilState(tasksPopupBoundsState);\n\n  return (\n    <Popup\n      bounds={\n        // Maybe it would be a nicer UX to not fix height, and let it be based on content, but tried to mimic the\n        // original impl, where the height is fixed. The only improvement over the original impl is that the default\n        // height (in case of no persisted bounds), would depend on the content, and it will remain based on content,\n        // as long as the bounds is not changed manually by the user.\n        bounds || {\n          width: 300,\n          // TODO: allow for positioning based on right and/or bottom\n          left: window.innerWidth - 300 - /* distance to right edge */ 150,\n          top:\n            window.innerHeight -\n            tasks.length * 80 - // progress bars\n            30 - // header\n            100, // distance to bottom edge,\n        }\n      }\n      onBoundsChange={(bounds) => {\n        setBounds(bounds);\n      }}\n      minHeight={100}\n      minWidth={300}\n      nonDismissable\n      interactions=\"all\"\n    >\n      <Popup.Layout\n        header={\n          <Popup.Header hasControls>\n            <StyledPopupTitle>Background Tasks</StyledPopupTitle>\n            <TooltipTrigger tooltip={<Tooltip>Hide</Tooltip>}>\n              <IconButton\n                preventFocusOnPress\n                excludeFromTabOrder\n                onPress={() => setShowProgressPanel(false)}\n              >\n                <PlatformIcon icon=\"general/hideToolWindow\" />\n              </IconButton>\n            </TooltipTrigger>\n          </Popup.Header>\n        }\n        content={\n          <>\n            {tasks.map((task, index) => (\n              <React.Fragment key={task.id}>\n                <ProgressBar\n                  style={{ margin: \".5rem 0.75rem\" }}\n                  name={task.title}\n                  isIndeterminate={task.progress.isIndeterminate}\n                  aria-label={`Progress of ${task.title}`}\n                  details={\n                    task.progress.text ||\n                    (task.progress.secondaryText ? <>&nbsp;</> : undefined)\n                  }\n                  secondaryDetails={task.progress.secondaryText}\n                  value={task.progress.fraction}\n                  maxValue={1}\n                  button={\n                    task.isCancelable && (\n                      <ProgressBarStopButton onPress={() => cancel(task.id)} />\n                    )\n                  }\n                />\n                {tasks[index + 1] && <StyledVerticalSeparator />}\n              </React.Fragment>\n            ))}\n          </>\n        }\n      />\n    </Popup>\n  );\n}\n","import styled from \"styled-components\";\nimport {\n  BareButton,\n  Link,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { firstTaskState, taskCountState, useCancelTask } from \"../tasks\";\nimport { showProgressPanelState } from \"./IdeStatusBar.state\";\nimport React, { useEffect } from \"react\";\nimport { TasksPopup } from \"./TasksPopup\";\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\nconst StyledProgressBarButton = styled.span`\n  cursor: pointer;\n\n  ${ProgressBar.Container} {\n    cursor: unset;\n  }\n`;\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nexport const StatusBarTaskProgressBar = () => {\n  const firstTask = useRecoilValue(firstTaskState);\n  const tasksCount = useRecoilValue(taskCountState);\n  const cancel = useCancelTask();\n  const [showProgressPanel, setShowProgressPanel] = useRecoilState(\n    showProgressPanelState\n  );\n\n  // When there is no tasks, switch back to not showing the panel.\n  useEffect(() => {\n    if (tasksCount === 0) {\n      setShowProgressPanel(false);\n    }\n  }, [tasksCount]);\n\n  return (\n    <>\n      {firstTask && !showProgressPanel && (\n        <TooltipTrigger\n          tooltip={\n            <Tooltip>{`${firstTask.title}. Click to see all running background tasks.`}</Tooltip>\n          }\n        >\n          <BareButton\n            preventFocusOnPress\n            excludeFromTabOrder\n            onPress={() => {\n              setShowProgressPanel(true);\n            }}\n          >\n            <StyledProgressBarButton>\n              <StatusBarProgress\n                name={firstTask.progress.text || firstTask.title}\n                isIndeterminate={firstTask.progress.isIndeterminate}\n                value={firstTask.progress.fraction}\n                maxValue={1}\n                button={\n                  <>\n                    {/*  {task.canPause && (\n                      <ProgressBarPauseButton\n                        small\n                        paused={false}\n                        onPausedChange={() => {}}\n                      />\n                    )}*/}\n                    {firstTask.isCancelable && (\n                      <TooltipTrigger tooltip={<Tooltip>Cancel</Tooltip>}>\n                        <ProgressBarStopButton\n                          small\n                          onPress={() => cancel(firstTask.id)}\n                        />\n                      </TooltipTrigger>\n                    )}\n                  </>\n                }\n              />\n            </StyledProgressBarButton>\n          </BareButton>\n        </TooltipTrigger>\n      )}\n      {(tasksCount > 1 || showProgressPanel) && (\n        <>\n          <Spacer />\n          <Link\n            onPress={() =>\n              setShowProgressPanel((currentValue) => !currentValue)\n            }\n          >\n            {showProgressPanel ? \"Hide processes\" : \"Show all\"} ({tasksCount})\n          </Link>\n        </>\n      )}\n      {showProgressPanel && tasksCount > 0 && <TasksPopup />}\n    </>\n  );\n};\n","import { resolveRef } from \"isomorphic-git\";\nimport { selector } from \"recoil\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsRootForFile, vcsRootsState } from \"./file-status.state\";\nimport {\n  branchForPathState,\n  RepoBranches,\n  repoBranchesState,\n} from \"./Branches/branches.state\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootState = selector({\n  key: \"vcs/activeFileRepo\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    const activeFileRepo = activeFile && get(vcsRootForFile(activeFile));\n    return activeFileRepo ?? get(vcsRootsState)[0]?.dir;\n  },\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesState = selector<RepoBranches>({\n  key: \"vcs/activeFileRepoBranches\",\n  get: ({ get }) => {\n    const activeFileRepoRoot = get(activeFileRepoRootState);\n    return get(repoBranchesState(activeFileRepoRoot));\n  },\n});\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchState = selector({\n  key: \"vcs/activeFileCurrentBranch\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    return activeFile ? branchForPathState(activeFile) : null;\n  },\n});\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadState = selector({\n  key: \"vcs/activeFileRepoHead\",\n  get: async ({ get }) => {\n    const branch = get(activeFileCurrentBranchState);\n    if (branch) {\n      return {\n        detached: false,\n        head: branch,\n      };\n    }\n    const repoRoot = get(activeFileRepoRootState);\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  },\n});\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport { repoBranchesState, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useRecoilValue(repoBranchesState(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"error\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                validationMessage={\n                  error && validationState === \"error\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  IconButton,\n  Toolbar,\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport {\n  allBranchesState,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useRecoilState } from \"recoil\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>({\n  key: \"branchesPopup.bounds\",\n  default: undefined,\n});\n\nexport function BranchesPopup({ close }: { close: () => void }) {\n  const [repoBranches] = useLatestRecoilValue(allBranchesState);\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] =\n    useRecoilState(branchesPopupSizeState);\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  // useRefreshRecoilValueOnMount(allBranchesState);\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      close();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={close}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"./file-status.state\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const vcsRoots = useRecoilValue(vcsRootsState);\n  const performAction = usePerformAction();\n\n  return useRecoilCallback(\n    ({ reset }) =>\n      async () => {\n        if (vcsRoots.length < 2 && !notified) {\n          notified = true;\n          balloonManager.showSticky({\n            title: \"Clone another repository\",\n            icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n            body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n            actions: (\n              <>\n                <BalloonActionLink\n                  onPress={() => {\n                    performAction(\"ExampleApp.cloneExampleRepo\");\n                  }}\n                >\n                  Clone another repo\n                </BalloonActionLink>\n              </>\n            ),\n          });\n        }\n      },\n    []\n  );\n};\n","import {\n  ActionTooltip,\n  PlatformIcon,\n  PopupTrigger,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { activeFileRepoHeadState } from \"../VersionControl/active-file.state\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\n\nexport function BranchPopupTrigger() {\n  const [gitRepoHead] = useLatestRecoilValue(activeFileRepoHeadState);\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    gitRepoHead && (\n      <PopupTrigger\n        placement=\"top\"\n        onOpenChange={(isOpen) => {\n          if (!isOpen) {\n            setTimeout(maybeShowGitCloneTip, 500);\n          }\n        }}\n        popup={({ close }) => <BranchesPopup close={close} />}\n      >\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={\n                gitRepoHead.detached\n                  ? \"Git: Detached HEAD doesn't point to any branch\"\n                  : `Git Branch: ${gitRepoHead.head}`\n              }\n            />\n          }\n        >\n          <StatusBarWidget\n            icon={\n              <PlatformIcon\n                icon={\n                  gitRepoHead.detached\n                    ? \"general/warning.svg\"\n                    : \"vcs/branch.svg\"\n                }\n              />\n            }\n            label={gitRepoHead.head.slice(\n              0,\n              gitRepoHead.detached ? 8 : undefined\n            )}\n          />\n        </TooltipTrigger>\n      </PopupTrigger>\n    )\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\n\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { StatusBarTaskProgressBar } from \"./StatusBarTaskProgressBar\";\nimport { BranchPopupTrigger } from \"./BranchPopupTrigger\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\nexport const IdeStatusBar = () => {\n  const cursorPosition = useRecoilValue(editorCursorPositionState);\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarTaskProgressBar />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <BranchPopupTrigger />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  IconButton,\n  IconButtonWithMenu,\n  ActionsProvider,\n  Toolbar,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n  ActionButton,\n} from \"@intellij-platform/core\";\n\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { defaultChangeGroupings } from \"../ChangesTree/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"../ChangesView/changesViewTreeNodeRenderer\";\nimport { Change } from \"../Change\";\nimport { allChangesState, useRollbackChanges } from \"../changes.state\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  &:not(:empty) {\n    line-height: 1.5;\n    padding-left: 0.375rem;\n    margin-bottom: 0.75rem;\n  }\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useRecoilValue(\n    rollbackViewState.initiallyExpandedKeys\n  );\n  const initiallyIncludedChangeKeys = useRecoilValue(\n    rollbackViewState.initiallyIncludedChanges\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [windowBounds, setWindowBounds] = useRecoilState(\n    rollbackViewState.windowBounds\n  );\n  const rootNodes = useRecoilValue(rollbackViewState.rootNodes);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<ChangesViewTreeNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetRecoilState(rollbackViewState.isOpen);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n  const [deleteAddedFiles, setDeleteAddedFiles] = useState(false);\n\n  const atLeastOneNewFileSelected = includedChanges.some(\n    (change) => change.type === \"ADDED\"\n  );\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              defaultChangeGroupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      treeRef={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = changesViewTreeNodeRenderer.getItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \".5rem 0.75rem 0\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox\n                isDisabled={!atLeastOneNewFileSelected}\n                isSelected={deleteAddedFiles}\n                onChange={setDeleteAddedFiles}\n                mnemonic=\"D\"\n              >\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close} mnemonic=\"C\">\n                    Close\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    mnemonic=\"R\"\n                    isDisabled={includedChanges.length === 0}\n                    onPress={() => {\n                      rollbackChanges(includedChanges, deleteAddedFiles)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"recoil\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsState = atom({\n  key: \"toolWindows\",\n  default: new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    ),\n    {\n      removedFromSideBarIds: toolWindows\n        .filter(({ showStripeButton }) => showStripeButton === false)\n        .map(({ id }) => id),\n    }\n  ),\n});\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom, atomFamily } from \"recoil\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom({\n    key: \"search.everywhere.isOpen\",\n    default: false,\n  }),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>({\n    key: \"search.everywhere.tab\",\n    default: \"All\",\n  }),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element>({\n    key: \"search.everywhere.contextElement\",\n    default: undefined,\n  }),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily<string, string>({\n    key: \"search.everywhere.initialQuery\",\n    default: \"\",\n  }),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>({\n    key: \"search.everywhere.bounds\",\n    default: null,\n  }),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { RecoilState, useSetRecoilState } from \"recoil\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsState,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of a recoil state.\n   */\n  persistedBoundsState: RecoilState<Partial<Bounds> | null>;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetRecoilState(persistedBoundsState);\n  const getInitBounds = useRecoilInitialValue(persistedBoundsState, {\n    top: 150,\n    height: Math.max(200, window.innerHeight - 300),\n  });\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(getInitBounds);\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 0.9375rem;\n  margin-right: 0.25rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useRecoilValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = file.name;\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback } from \"recoil\";\nimport {\n  currentProjectFilesState,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const getProjectFiles = useRecoilCallback(\n      ({ snapshot }) =>\n        () =>\n          snapshot.getLoadable(currentProjectFilesState).getValue(),\n      []\n    );\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        getProjectFiles()\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useCollectionSearchInput,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetRecoilState(searchEverywhereState.isOpen);\n  const [tab, setTab] = useRecoilState(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useRecoilInitialValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetRecoilState(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const collectionRef = useRef<HTMLDivElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const onAction = (key: React.Key) => {\n    if (key === LOAD_MORE_ITEM_KEY) {\n      setSearchResultLimit((limit) => limit + SEARCH_RESULT_LIMIT);\n      const nextItem = searchResult[visibleSearchResult.length + 1];\n      if (nextItem) {\n        // nextItem is expected to always have value\n\n        // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n        // if we want to avoid setTimeout\n        setTimeout(() => {\n          setSelectedKeys(new Set([nextItem.key]));\n          selectionManagerRef.current?.setFocusedKey(nextItem.key);\n        });\n      }\n    } else {\n      close();\n      // Making sure the popup is fully closed before the new action is performed. One edge case that can\n      // make a difference is actions like FindAction that open the same popup. By performing an action\n      // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n      // won't get any feedback when choosing such actions.\n      setTimeout(() => {\n        const itemWrapper = searchResult.find((item) => item.key === key);\n        itemWrapper?.contributor.processSelectedItem(itemWrapper.item);\n        /**\n         * The 50ms timeout is a workaround for an issue in FocusScope:\n         * restoreFocus only works if the previously focused element is in the dom, when the focus\n         * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n         * window, which has a focus scope, when the window is opened, the currently focused\n         * element (which will be the one to restore focus to), is search everywhere dialog, which\n         * is immediately closed. So when the modal window is closed, it tries to move focus back\n         * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n         * track a chain of nodes to restore focus to.\n         * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n         * is closed, and then the actions is performed, for focus restoration to work.\n         */\n      }, 50);\n    }\n  };\n\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef,\n    onAction,\n    selectionManager: selectionManagerRef.current,\n  });\n\n  const tips = useTips();\n  return (\n    <ContentAwarePopup\n      persistedBoundsState={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        {...collectionSearchInputProps}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        ref={collectionRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        showAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={onAction}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          const itemText = contributor.getItemText(item);\n                          return (\n                            <Item\n                              key={key}\n                              textValue={itemText}\n                              aria-label={itemText}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import { CallbackInterface } from \"recoil\";\nimport { refreshFileStatusCallback } from \"./file-status.state\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport path from \"path\";\n\nexport const gitAddCallback =\n  (callbackInterface: CallbackInterface) => async (filepath: string) => {\n    const refreshFileStatus = refreshFileStatusCallback(callbackInterface);\n    const dir = await git.findRoot({ fs, filepath });\n    await git.add({ fs, dir, filepath: path.relative(dir, filepath) });\n    await refreshFileStatus(filepath);\n  };\n","import {\n  Input,\n  Popup,\n  PopupLayout,\n  PositionedTooltipTrigger,\n  styled,\n  ValidationTooltip,\n} from \"@intellij-platform/core\";\nimport React, { ChangeEvent, useState } from \"react\";\n\nconst StyledInput = styled(Input)`\n  width: 20.5rem;\n  /**\n     * To have the validation box shadow not clipped by the popup.\n     * Maybe it should be an option on input to make sure margin is always in sync with the box-shadow thickness\n     */\n  margin: 3px;\n\n  input {\n    padding-top: 1px;\n    padding-bottom: 1px;\n  }\n`;\nconst StyledHeader = styled(Popup.Header)`\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.border()};\n`;\n\n/**\n * A simple Popup with an input, used in actions such as create file, or create directory\n */\nexport function NewItemPopup({\n  title,\n  inputName = \"Name\",\n  onSubmit,\n  validationMessage,\n  validationType = \"error\",\n  value,\n  onChange,\n}: {\n  inputName?: string;\n  title: React.ReactNode;\n  onSubmit: () => void;\n  value: string;\n  onChange: (newValue: string) => void;\n  validationMessage?: string;\n  validationType?: \"error\" | \"warning\";\n}) {\n  const [hideMessage, setHideMessage] = useState(false);\n  return (\n    <Popup>\n      <PopupLayout\n        header={<StyledHeader>{title}</StyledHeader>}\n        content={\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              onSubmit();\n            }}\n            onMouseDown={() => {\n              setHideMessage(true);\n            }}\n          >\n            <PositionedTooltipTrigger\n              isOpen={Boolean(validationMessage) && !hideMessage}\n              placement=\"top start\"\n              offset={6}\n              crossOffset={-6}\n              tooltip={\n                <ValidationTooltip type={validationType}>\n                  {validationMessage}\n                </ValidationTooltip>\n              }\n            >\n              <StyledInput\n                appearance=\"embedded\"\n                validationState={validationMessage ? validationType : undefined}\n                placeholder={inputName}\n                value={value}\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                  setHideMessage(false);\n                  onChange(e.target.value);\n                }}\n              />\n            </PositionedTooltipTrigger>\n          </form>\n        }\n      />\n    </Popup>\n  );\n}\n","import path from \"path\";\nimport { selector, useRecoilCallback } from \"recoil\";\nimport React, { useState } from \"react\";\nimport {\n  ActionDefinition,\n  Button,\n  Checkbox,\n  ModalWindow,\n  PlatformIcon,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { editorManagerState } from \"../../Editor/editor.state\";\nimport {\n  activePathExistsState,\n  activePathsState,\n  projectPopupManagerRefState,\n  windowManagerRefState,\n} from \"../project.state\";\nimport { vcsRootForFile } from \"../../VersionControl/file-status.state\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { createFileCallback } from \"../fs-operations\";\nimport { gitAddCallback } from \"../../VersionControl/gitAddCallback\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\n\n// TODO: expand to and select the new file in the project tree, if the action is initiated from projects view.\nexport const createFileActionState = selector({\n  key: `action.${projectActionIds.NewFile}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.NewFile,\n    icon: <PlatformIcon icon=\"fileTypes/text\" />,\n    title: \"File\",\n    description: \"Create new file\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot, refresh }) => async () => {\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n      const popupManager = snapshot\n        .getLoadable(projectPopupManagerRefState)\n        .getValue().current;\n\n      // TODO: open a dialog and let the user choose the destination if, multiple paths are active\n      const destinationDir = (\n        await fs.promises.stat(activePaths[0])\n      ).isDirectory()\n        ? activePaths[0]\n        : path.dirname(activePaths[0]);\n\n      if (!popupManager) {\n        throw new Error(\"Could not find popup manager\");\n      }\n\n      popupManager.show(({ close }) => (\n        <NewFilePopup close={close} destinationDir={destinationDir} />\n      ));\n    }),\n  }),\n});\n\nfunction NewFilePopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createFile = useRecoilCallback(\n    (callbackInterface) => {\n      const createFile = createFileCallback(callbackInterface);\n      return async (destination: string, filename: string) => {\n        const fullpath = path.join(destinationDir, filename);\n        const { snapshot } = callbackInterface;\n        const editorManager = snapshot\n          .getLoadable(editorManagerState)\n          .getValue();\n        const windowManager = snapshot\n          .getLoadable(windowManagerRefState)\n          .getValue().current;\n        const repoDir = await snapshot.getPromise(vcsRootForFile(fullpath));\n        await createFile(destinationDir, filename);\n        // TODO: select it in the Project tool window, if it was created from the Project tool window\n        close();\n        editorManager.focus();\n        // Hacky approach to fix an edge case where the editor is not rendered already (no open tabs), and\n        // so will be focused with a little delay. For the focus to go back to the editor after AddFileToGitWindow\n        // is closed, without any extra focus management, we need to make sure the editor is focused before the\n        // modal window is opened, so it restores to the editor.\n        await waitUntil(\n          () => document.activeElement instanceof HTMLTextAreaElement\n        );\n        if (repoDir) {\n          windowManager?.open(({ close }) => (\n            <AddFileToGitWindow filepath={fullpath} close={close} />\n          ));\n        }\n      };\n    },\n    [close]\n  );\n  const [filename, setFilename] = useState(\"\");\n  const [validationMessage, setValidationMessage] = useState(\"\");\n  const submit = async () => {\n    const fullPath = path.join(destinationDir, filename);\n    const stats = await stat(fullPath);\n    if (stats?.isFile()) {\n      setValidationMessage(\n        `A file with the name '${path.basename(filename)}' already exists`\n      );\n    } else if (stats?.isDirectory()) {\n      setValidationMessage(\n        `A directory with the name '${path.basename(filename)}' already exists`\n      );\n    } else {\n      await createFile(destinationDir, filename);\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New File\"\n      onSubmit={() => {\n        if (filename) {\n          submit(); // error handling?\n        }\n      }}\n      value={filename}\n      onChange={(newValue) => {\n        setValidationMessage(\"\");\n        setFilename(newValue);\n      }}\n      validationMessage={validationMessage}\n    />\n  );\n}\n\nfunction useAddToGit() {\n  return useRecoilCallback(gitAddCallback, []);\n}\n\nfunction AddFileToGitWindow({\n  close,\n  filepath,\n}: {\n  close: () => void;\n  filepath: string;\n}) {\n  const addToGit = useAddToGit();\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Add File to Git\"\n        content={\n          <>\n            <div\n              style={{\n                display: \"flex\",\n                gap: \"1rem\",\n                padding: \"0.75rem 0.75rem 0rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/questionDialog.svg\" size={32} />\n              <div>\n                Do you want to add the following file to Git?\n                <br />\n                {filepath}\n                <br />\n                <br />\n                If you choose Cancel, you can still add it later manually.\n              </div>\n            </div>\n          </>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<Checkbox isDisabled>Don't ask again</Checkbox>}\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  autoFocus\n                  variant=\"default\"\n                  onPress={() => {\n                    addToGit(filepath).then(close);\n                  }}\n                >\n                  Add\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function waitUntil(criteria: () => boolean, timeoutInMs = 2000) {\n  if (criteria() || timeoutInMs < 0) {\n    return;\n  }\n  await new Promise((resolve) => setTimeout(resolve, 50));\n  await waitUntil(criteria, timeoutInMs - 50);\n}\n","import { useRef } from \"react\";\n// @ts-expect-error caf package doesn't come with typing, and @types/caf doesn't exist at the moment\nimport { CAF } from \"caf\";\n\n/**\n * A utility to avoid race condition in async flows that should be triggered based on some user interaction.\n * Accepts a generator function representing a cancelable async flow. Each `yield` expression is a potential point of\n * cancellation, and the last invocation always cancels previous in progress invocations (if any).\n * Based on [Cancelable Async Flows](https://github.com/getify/CAF#cancelable-async-flows-caf)\n */\nexport const useCancelableAsyncCallback = <A extends any[]>(\n  asyncCallback: (...args: A) => Generator\n) => {\n  const cancelToken = useRef<null | { abort: () => void; signal: unknown }>(\n    null\n  );\n\n  const callbackRef = useRef(asyncCallback);\n  callbackRef.current = asyncCallback;\n\n  return (...args: any[]) => {\n    cancelToken.current?.abort();\n    cancelToken.current = new CAF.cancelToken();\n\n    CAF(function (signal: unknown, ...args: A): unknown {\n      return callbackRef.current(...args);\n    })(cancelToken.current, ...args);\n  };\n};\n","import path from \"path\";\nimport { selector, useRecoilCallback } from \"recoil\";\nimport React, { useEffect, useState } from \"react\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { createDirectoryCallback } from \"../fs-operations\";\nimport { useCancelableAsyncCallback } from \"../../useCancelableAsyncCallback\";\nimport {\n  activePathExistsState,\n  activePathsState,\n  projectPopupManagerRefState,\n} from \"../project.state\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\n\n// TODO: expand to and select the new directory in the project tree\nexport const createDirectoryActionState = selector({\n  key: `action.${projectActionIds.NewDir}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.NewDir,\n    icon: <PlatformIcon icon={DIR_ICON} />,\n    title: \"Directory\",\n    description: \"Create new directory\",\n    isDisabled: !get(activePathExistsState), // TODO: disable action when multiple paths are selected and none of them are directories\n    actionPerformed: getCallback(({ snapshot, refresh }) => async () => {\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n      const popupManager = snapshot\n        .getLoadable(projectPopupManagerRefState)\n        .getValue().current;\n\n      // TODO: open a dialog and let the user choose the destination if, multiple dirs are active\n      const destinationDir = (\n        await fs.promises.stat(activePaths[0])\n      ).isDirectory()\n        ? activePaths[0]\n        : path.dirname(activePaths[0]);\n\n      if (!popupManager) {\n        throw new Error(\"Could not find popup manager\");\n      }\n\n      popupManager.show(({ close }) => (\n        <NewDirectoryPopup close={close} destinationDir={destinationDir} />\n      ));\n    }),\n  }),\n});\n\nfunction NewDirectoryPopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createDirectory = useRecoilCallback(createDirectoryCallback, []);\n\n  const [dirName, setDirName] = useState(\"\");\n\n  const [validationResult, setValidationResult] = useState<{\n    type: \"error\" | \"warning\";\n    message: string;\n  } | null>(null);\n\n  const updateValidation = useCancelableAsyncCallback(function* (\n    destinationDir: string,\n    dirName: string\n  ) {\n    setValidationResult(\n      (yield validate(destinationDir, dirName)) as Awaited<\n        ReturnType<typeof validate>\n      >\n    );\n  });\n  useEffect(() => {\n    updateValidation(destinationDir, dirName);\n  }, [destinationDir, dirName]);\n\n  const submit = async () => {\n    const error = await validate(destinationDir, dirName);\n    if (error == null) {\n      await createDirectory(destinationDir, dirName);\n      close();\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New Directory\"\n      onSubmit={() => {\n        if (dirName) {\n          submit(); // error handling?\n        }\n      }}\n      value={dirName}\n      onChange={setDirName}\n      validationMessage={validationResult?.message}\n      validationType={validationResult?.type}\n    />\n  );\n}\n\nconst validate = async function (\n  destinationDir: string,\n  dirName: string\n): Promise<{ type: \"error\" | \"warning\"; message: string } | null> {\n  const fullPath = path.join(destinationDir, dirName);\n  if (!dirName) {\n    return null;\n  }\n  if (dirName.includes(\".\")) {\n    return {\n      type: \"warning\",\n      message: `Note: \".\" in the name is treated as a regular character. Use \"/\" instead if you mean to create nested directories`,\n    };\n  }\n  let stats = await stat(fullPath);\n  if (stats?.isFile()) {\n    return {\n      type: \"error\",\n      message: `A file with the name '${dirName}' already exists`,\n    };\n  } else if (stats?.isDirectory()) {\n    return {\n      type: \"error\",\n      message: `A directory with the name '${dirName}' already exists`,\n    };\n  }\n  return null;\n};\n","import { selector } from \"recoil\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\n\nimport { activePathExistsState, activePathsState } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\n\nexport const copyFilenameActionState = selector({\n  key: `action.${projectActionIds.CopyFileName}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.CopyFileName,\n    title: \"File Name\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n    }),\n  }),\n});\n","import { selector } from \"recoil\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\n\nimport { activePathExistsState, activePathsState } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\n\nexport const copyAbsolutePathActionState = selector({\n  key: `action.${projectActionIds.CopyAbsolutePath}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.CopyAbsolutePath,\n    title: \"Absolute Path\",\n    isDisabled: !get(activePathExistsState),\n    useShortcutsOf: \"CopyPaths\",\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n    }),\n  }),\n});\n","import { selector } from \"recoil\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\n\nimport {\n  activePathExistsState,\n  activePathsState,\n} from \"../../Project/project.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\n\nexport const copyPathFromRepositoryRootActionState = selector({\n  key: `action.${VcsActionIds.CopyPathFromRepositoryRootProvider}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: VcsActionIds.CopyPathFromRepositoryRootProvider,\n    title: \"Path From Repository Root\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot, refresh }) => async () => {\n      notImplemented();\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n    }),\n  }),\n});\n","import { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\n\nimport { createFileActionState } from \"./actions/createFileAction\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { createDirectoryActionState } from \"./actions/createDirectoryAction\";\nimport { projectActionIds } from \"./projectActionIds\";\nimport { copyFilenameActionState } from \"./actions/copyFilename\";\nimport { copyAbsolutePathActionState } from \"./actions/copyAbsolutePath\";\nimport { copyPathFromRepositoryRootActionState } from \"../VersionControl/actions/copyPathFromRepositoryRoot\";\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useRecoilCallback(\n    ({ set }) =>\n      ({ element }: ActionContext, tab: string) => {\n        if (element) {\n          set(searchEverywhereState.isOpen, true);\n          set(searchEverywhereState.tab, tab);\n          set(searchEverywhereState.contextElement, element);\n        }\n      },\n    []\n  );\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const newFileAction = useRecoilValue(createFileActionState);\n  const newDirectoryAction = useRecoilValue(createDirectoryActionState);\n  const newElementActionGroup = createDefaultActionGroup({\n    id: \"NewElement\",\n    title: \"New...\",\n    description: \"Create new class, interface, file or directory\",\n    isSearchable: true,\n    children: [newFileAction, newDirectoryAction],\n  });\n\n  const copyReferencePopupGroup = createDefaultActionGroup({\n    id: projectActionIds.CopyReferencePopupGroup,\n    title: \"Copy Path/Reference...\",\n    menuPresentation: \"none\",\n    children: [\n      // TODO: CopyFileReferences action group popup is not the default popup, it shows the copyable value as a hint\n      //  segment in each menu item. A custom actionPerformed should be implemented.\n      createDefaultActionGroup({\n        id: projectActionIds.CopyFileReference,\n        title: \"Copy File Reference\", // in the original impl, there is no title\n        isSearchable: false,\n        menuPresentation: \"section\",\n        children: [\n          // FIXME: actions are not triggered via UI\n          useRecoilValue(copyAbsolutePathActionState),\n          useRecoilValue(copyFilenameActionState),\n          // FIXME: should be able to define divider here\n          // new Divider(),\n          useRecoilValue(copyPathFromRepositoryRootActionState),\n        ],\n      }),\n    ],\n  });\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n    newElementActionGroup,\n    copyReferencePopupGroup,\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport path from \"path\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changesTreeNodesState,\n  changesUnderSelectedKeys,\n  ChangesViewTreeNode,\n  expandedKeysState,\n  includedChangeKeysState,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysState,\n} from \"./ChangesView/ChangesView.state\";\nimport { allChangesState } from \"./changes.state\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsState,\n  currentProjectFilesState,\n} from \"../../Project/project.state\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport { getNodeKeyForChange, isGroupNode } from \"./ChangesTree/ChangeTreeNode\";\nimport { Change } from \"./Change\";\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { useRefreshRepoStatuses } from \"../file-status.state\";\nimport { activeChangeListState } from \"./change-lists.state\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useRecoilCallback(\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh VCS Changes\",\n      description: \"Refresh VCS Changes\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useRecoilCallback(queueCheckInCallback, []);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useRecoilValue(activePathsState);\n  const [projectFiles] = useLatestRecoilValue(currentProjectFilesState);\n  const roots = findRootPaths(activePaths);\n\n  const allChanges = useRecoilValue(allChangesState);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, Change.path(change)))\n  );\n\n  // The logic here is a little better than the reference impl, which itself is inconsistent in project view\n  // and in Changes view (aka commit view).\n  const isDirectory = (path: string) =>\n    projectFiles?.some((item) => item.type === \"dir\" && item.path === path);\n  const selectedPathsAreDirectories = roots.every(isDirectory);\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: selectedPathsAreDirectories\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useRecoilCallback(\n    ({ snapshot, set }) =>\n      () => {\n        const includedChangesKeys = snapshot\n          .getLoadable(includedChangeKeysState)\n          .getValue();\n        let keyToSelect = includedChangesKeys.values().next().value;\n        if (includedChangesKeys.size === 0) {\n          const allKeys = snapshot\n            .getLoadable(activeChangeListState)\n            .getValue()\n            ?.changes.map(getNodeKeyForChange);\n          set(includedChangeKeysState, new Set(allKeys));\n          keyToSelect = allKeys?.[0];\n        }\n        if (keyToSelect) {\n          const { rootNodes } = snapshot\n            .getLoadable(changesTreeNodesState)\n            .getValue();\n          set(\n            expandedKeysState,\n            new Set([\n              ...snapshot.getLoadable(expandedKeysState).getValue(),\n              ...getExpandedToNodesKeys(\n                (node) => (isGroupNode(node) ? node.children : null),\n                (node) => node.key,\n                rootNodes as ChangesViewTreeNode[],\n                [keyToSelect]\n              ),\n            ])\n          );\n          set(selectedKeysState, new Set([keyToSelect]));\n        }\n      },\n    []\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        const changePath = Change.path(change);\n        if (!changePath) {\n          editorStateManager.openPath(changePath, index === arr.length - 1);\n        }\n      });\n    },\n  };\n}\n\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n  if (selectedChanges.size > 0) {\n    // FIXME: should use active paths, not selection\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { activeFileRepoBranchesState } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport { Errors } from \"isomorphic-git\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useRecoilValue(activeFileRepoBranchesState);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"error\" : \"valid\";\n\n  const create = () => {\n    if (isValid) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              validationMessage={\n                validationState === \"error\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"error\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { ActionContext, ActionDefinition } from \"@intellij-platform/core\";\nimport { CallbackInterface, isRecoilValue, selector } from \"recoil\";\nimport { MaybeRecoilValue } from \"./recoil-utils\";\n\n/**\n * Creates an action based on a recoil state and callbacks.\n * The action is created as a recoil selector, which means it only\n * updates when recoil values used in properties like isDisabled\n * are changed.\n */\nexport const createAction = <T,>({\n  isSearchable,\n  isDisabled,\n  actionPerformed,\n  ...params\n}: Omit<ActionDefinition, \"actionPerformed\" | \"isDisabled\" | \"isSearchable\"> & {\n  actionPerformed: (\n    callbackInterface: CallbackInterface\n  ) => (context: ActionContext) => T;\n  isDisabled?: MaybeRecoilValue<boolean>;\n  isSearchable?: MaybeRecoilValue<boolean>;\n}) =>\n  selector<ActionDefinition>({\n    key: `action.${params.id}`,\n    get: ({ get, getCallback }): ActionDefinition => {\n      const resolve = <T,>(value: MaybeRecoilValue<T>): T =>\n        isRecoilValue(value) ? get(value) : value;\n      return {\n        ...params,\n        isDisabled: resolve(isDisabled),\n        isSearchable: resolve(isSearchable),\n        actionPerformed: getCallback(actionPerformed),\n      };\n    },\n  });\n","import { selector } from \"recoil\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { fileStatusState, vcsRootForFile } from \"../file-status.state\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport path from \"path\";\nimport { activePathsState } from \"../../Project/project.state\";\nimport { createAction } from \"../../createAction\";\nimport { PlatformIcon } from \"@intellij-platform/core\";\nimport { gitAddCallback } from \"../gitAddCallback\";\nimport React from \"react\";\n\nconst pathsToAddState = selector<string[]>({\n  key: `vcs.action.${VcsActionIds.GIT_ADD}.pathsToAdd`,\n  get: async ({ get }) => {\n    return asyncFilter(async (activePath): Promise<boolean> => {\n      const repoDir = get(vcsRootForFile(activePath));\n      if (repoDir) {\n        const isIgnored = await git.isIgnored({\n          fs,\n          dir: repoDir,\n          filepath: path.relative(repoDir, activePath),\n        });\n        const isFile = await fs.promises\n          .stat(activePath)\n          .then((stat) => stat.isFile())\n          .catch(() => false);\n        const isUnchangedFile =\n          isFile && get(fileStatusState(activePath)) === \"NOT_CHANGED\";\n        return !isIgnored && !isUnchangedFile; // logic checked with the behavior of the reference impl\n      }\n      return false;\n    }, get(activePathsState));\n  },\n});\n\nconst gitAddDisabledState = selector<boolean>({\n  key: `vcs.action.${VcsActionIds.GIT_ADD}.disabled`,\n  get: ({ get }) => get(pathsToAddState).length === 0,\n});\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status, though.\n * TODO: task API can be used to make this a task.\n */\nexport const gitAddActionSelector = createAction({\n  id: VcsActionIds.GIT_ADD,\n  title: \"Add\",\n  icon: <PlatformIcon icon=\"general/add.svg\" />,\n  useShortcutsOf: VcsActionIds.ADD_UNVERSIONED,\n  isDisabled: gitAddDisabledState,\n  actionPerformed: (callbackInterface) => async () => {\n    const addToGit = gitAddCallback(callbackInterface);\n    const { snapshot } = callbackInterface;\n    const pathsToAdd = await snapshot.getPromise(pathsToAddState);\n    return Promise.all(pathsToAdd.map(addToGit));\n  },\n});\n","import git from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport { createAction } from \"../../createAction\";\nimport { currentProjectState } from \"../../Project/project.state\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { vcsRootsState } from \"../file-status.state\";\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status.\n * TODO: task API can be used to make this a task.\n */\nexport const gitInitActionSelector = createAction({\n  id: VcsActionIds.GIT_INIT,\n  title: \"Create Git Repository...\",\n  actionPerformed:\n    ({ snapshot, set }) =>\n    async () => {\n      // TODO: open a path selector to select the path where the git repo should be initialized\n      const project = await snapshot.getPromise(currentProjectState);\n      const dir = project.path;\n      await git.init({ fs, dir });\n      set(vcsRootsState, (roots) =>\n        roots\n          .filter((root) => root.dir !== dir)\n          .concat({\n            vcs: \"Git\",\n            dir,\n          })\n      );\n    },\n});\n","import { atom } from \"recoil\";\nimport { persistentAtomEffect } from \"../Project/persistence/persistentAtomEffect\";\nimport { array, object, string } from \"@recoiljs/refine\";\nimport { ensureArray, MaybeArray } from \"../ensureArray\";\n\n/**\n * The shape of the <option> tag in the persistence xml file.\n */\ntype VisitedUrlsOption = {\n  list: {\n    UrlAndUserName: MaybeArray<{\n      option: [\n        { \"@name\": \"url\"; \"@value\": string },\n        { \"@name\": \"userName\"; \"@value\": string }\n      ];\n    }>;\n  };\n};\n\ninterface VisitedUrl {\n  url: string;\n  username?: string;\n}\n\nconst visitedUrlsChecker = array(\n  object({\n    url: string(),\n    username: string(),\n  })\n);\n\nexport const gitVisitedUrlsState = atom<ReadonlyArray<VisitedUrl>>({\n  key: \"git.rememberedInputs.visitedUrls\",\n  default: [],\n  effects: [\n    persistentAtomEffect.option<ReadonlyArray<VisitedUrl>, VisitedUrlsOption>({\n      storageFile: \"vcs.xml\", // GitRememberedInputs is user-level configuration, kept here temporarily\n      componentName: \"GitRememberedInputs\",\n      optionName: \"visitedUrls\",\n      refine: visitedUrlsChecker,\n      read: (option) => {\n        return ensureArray(option?.list?.UrlAndUserName)\n          .map(({ option }) => ({\n            url: ensureArray(option).find(\n              (option) => option[\"@name\"] === \"url\"\n            )?.[\"@value\"]!,\n            username: ensureArray(option).find(\n              (option) => option[\"@name\"] === \"userName\"\n            )?.[\"@value\"],\n          }))\n          .filter((i) => i.url);\n      },\n      update: (value) => (option) => {\n        return {\n          ...option,\n          list: {\n            UrlAndUserName: value.map(({ url, username }) => ({\n              option: [\n                { \"@name\": \"url\", \"@value\": url },\n                { \"@name\": \"userName\", \"@value\": username ?? \"\" },\n              ],\n            })),\n          },\n        };\n      },\n    }),\n  ],\n});\n\nexport const cloneParentDirState = atom<string>({\n  key: \"git.rememberedInputs.cloneParentDir\",\n  default: \"\",\n  effects: [\n    persistentAtomEffect.option<string, { \"@value\": string }>({\n      storageFile: \"vcs.xml\", // GitRememberedInputs is user-level configuration, kept here temporarily\n      componentName: \"GitRememberedInputs\",\n      optionName: \"cloneParentDir\",\n      refine: string(),\n      read: (option) => {\n        return option?.[\"@value\"] ?? \"\";\n      },\n      update: (value) => (option) => {\n        return {\n          ...option,\n          \"@value\": value,\n        };\n      },\n    }),\n  ],\n});\n","import React, { useEffect, useState } from \"react\";\nimport path from \"path\";\nimport git, { clone, GitProgressEvent } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport { defaultProject, autoClonedRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { ensureDir } from \"./fs/fs-utils\";\nimport {\n  AlertDialog,\n  Button,\n  Popup,\n  ProgressBar,\n  styled,\n} from \"@intellij-platform/core\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/Popup\";\n\nconst defaultWorkspaceFiles = {\n  \".idea/vcs.xml\": `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"GitRememberedInputs\">\n    <option name=\"visitedUrls\">\n      <list>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/alirezamirian/jui.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/thurwitz/example-branches.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n      </list>\n    </option>\n    <option name=\"cloneParentDir\" value=\"/workspace\"></option>\n  </component>\n  <component name=\"VcsDirectoryMappings\"></component>\n</project>\n\n`,\n};\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nconst defaultInitializer = async () => {\n  await ensureDir(fs.promises, defaultProject.path);\n  await Promise.all(\n    Object.entries(defaultWorkspaceFiles).map(async ([filename, content]) => {\n      const fullPath = path.join(defaultProject.path, filename);\n      if (await fs.promises.exists(fullPath)) {\n        return;\n      }\n      await ensureDir(fs.promises, path.dirname(fullPath));\n      await fs.promises.writeFile(fullPath, content, \"utf-8\");\n    })\n  );\n};\n\n/**\n * Used instead of Popup to have it not be fixed positioned, since this popup\n * is auto rendered in website's homepage, and example-app is rendered inline\n * there.\n */\nconst InlinePopup = styled(StyledPopupContainer)<{ minWidth?: number }>`\n  min-width: ${({ minWidth }) => (minWidth ? `${minWidth}px` : \"\")};\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nexport const ProjectInitializer = ({\n  children,\n  autoCloneSampleRepo = false,\n}: {\n  autoCloneSampleRepo?: boolean;\n  children?: React.ReactNode;\n}) => {\n  const [cloneProgress, setCloneProgress] = useState<GitProgressEvent | null>(\n    null\n  );\n\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function ensureSampleRepo(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl, onProgress: setCloneProgress });\n      }\n    }\n    // noinspection JSIgnoredPromiseFromCall: error handling done in the function\n    init();\n    async function init() {\n      const initializer =\n        (window as any).INITIALIZE_APP ?? // Giving a chance for external fs initialization. Used in e2e tests\n        defaultInitializer;\n      try {\n        await initializer({\n          fs,\n          git,\n          path,\n          projectDir: defaultProject.path,\n        });\n        if (autoCloneSampleRepo) {\n          await ensureSampleRepo(autoClonedRepo.path, autoClonedRepo.url);\n        }\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      } catch (e) {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      }\n    }\n  }, []);\n\n  const fraction = cloneProgress?.total\n    ? cloneProgress.loaded / cloneProgress.total\n    : 0;\n\n  switch (state) {\n    case \"uninitialized\":\n      return null;\n    case \"initialized\":\n      return <>{children}</>;\n    case \"cloning\":\n      return (\n        <InlinePopup minWidth={450}>\n          <Popup.Layout\n            header=\"Cloning sample git repository\"\n            content={\n              <div style={{ padding: \"1rem\" }}>\n                <ProgressBar\n                  name={`Cloning repository ${autoClonedRepo.url}`}\n                  isIndeterminate={!cloneProgress}\n                  details={\n                    fraction\n                      ? `${cloneProgress?.phase}: ${Math.round(\n                          fraction * 100\n                        )}% ${cloneProgress?.loaded}/${cloneProgress?.total}`\n                      : cloneProgress?.phase\n                  }\n                  aria-label={`Progress of cloning sample repo`}\n                  value={\n                    cloneProgress\n                      ? cloneProgress.loaded / cloneProgress.total\n                      : 0\n                  }\n                  maxValue={1}\n                />\n              </div>\n            }\n          />\n        </InlinePopup>\n      );\n    case \"error\":\n      return (\n        <AlertDialog\n          type=\"error\"\n          heading=\"Something went wrong!\"\n          body=\"Could not initialize example app\"\n          buttons={\n            <Button\n              variant=\"default\"\n              onPress={() => {\n                window.location.reload();\n              }}\n            >\n              Reload\n            </Button>\n          }\n        />\n      );\n  }\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","import { createAction } from \"../../createAction\";\nimport { windowManagerRefState } from \"../../Project/project.state\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  Button,\n  ComboBox,\n  InputField,\n  Item,\n  LabeledControlsAlignmentProvider,\n  ModalWindow,\n  styled,\n  TooltipTrigger,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { useRef, useState } from \"react\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport {\n  cloneParentDirState,\n  gitVisitedUrlsState,\n} from \"../gitRememberedInputs.state\";\nimport path from \"path\";\nimport { useClone } from \"../useClone\";\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\n\nexport const gitCloneActionSelector = createAction({\n  id: VcsActionIds.GIT_CLONE,\n  title: \"Clone...\",\n  actionPerformed:\n    ({ snapshot }) =>\n    async () => {\n      const windowManager = await snapshot.getPromise(windowManagerRefState);\n      windowManager.current?.open(({ close }) => (\n        <GitCloneWindow close={close} />\n      ));\n    },\n});\n\nexport const cloneAnotherRepoActionSelector = createAction({\n  id: \"ExampleApp.cloneExampleRepo\",\n  title: \"Clone another repository...\",\n  isSearchable: false,\n  actionPerformed:\n    ({ snapshot }) =>\n    async () => {\n      const windowManager = await snapshot.getPromise(windowManagerRefState);\n      windowManager.current?.open(({ close }) => (\n        <GitCloneWindow\n          close={close}\n          url=\"https://github.com/thurwitz/example-branches.git\"\n        />\n      ));\n    },\n});\n\nconst StyledContainer = styled.div`\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.75rem;\n`;\n\nfunction GitCloneWindow({\n  close,\n  url: urlProp,\n}: {\n  close: () => void;\n  url?: string;\n}) {\n  const [url, setUrl] = useState(urlProp ?? \"\");\n  const parentDir = useRecoilValue(cloneParentDirState);\n  const [directory, setDirectory] = useState(getAutoFillDir(url));\n  const [autoFillDirectory, setAutoFillDirectory] = useState(true);\n  const [showValidationErrors, setShowValidationErrors] = useState(false);\n  const setCloneParentDirState = useSetRecoilState(cloneParentDirState);\n  const [visitedUrls, setVisitedUrls] = useRecoilState(gitVisitedUrlsState);\n  const urlInputRef = useRef<HTMLInputElement>(null);\n  const dirInputRef = useRef<HTMLInputElement>(null);\n  const urlError = validateRepoUrl(url);\n  const [dirError, setDirError] = useState(\"\");\n\n  const clone = useClone();\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setShowValidationErrors(true);\n    // Note: in the reference impl, validation is live, here it's upon submission.\n    // Error is cleared upon change, like in NewFilePopup.\n    const dirValidationError = await validateCloneDirectory(directory);\n    if (dirValidationError) {\n      setDirError(dirValidationError);\n      dirInputRef.current?.focus();\n      return;\n    }\n    if (urlError) {\n      urlInputRef.current?.focus();\n      return;\n    }\n    setCloneParentDirState(path.dirname(directory));\n    setVisitedUrls((urls) =>\n      urls.find((visitedUrl) => visitedUrl.url === url)\n        ? urls\n        : urls.concat({ url })\n    );\n    clone({\n      url,\n      dir: directory,\n      onSuccess: () => {\n        setVisitedUrls((visitedUrls) =>\n          visitedUrls.map(({ url }) => url).includes(url)\n            ? visitedUrls\n            : [...visitedUrls, { url, username: \"\" }]\n        );\n      },\n    });\n    close();\n  };\n\n  function getAutoFillDir(value: string) {\n    const repoName =\n      value\n        .split(/\\/{1,2}/)\n        .pop()\n        ?.replace(/\\.git$/, \"\") ?? \"\";\n    return repoName ? path.join(parentDir, repoName) : parentDir;\n  }\n\n  return (\n    <ModalWindow minWidth={600}>\n      <WindowLayout\n        header=\"Get from Version Control\"\n        content={\n          <LabeledControlsAlignmentProvider>\n            <form id=\"clone_form\" onSubmit={onSubmit}>\n              <StyledContainer>\n                <ComboBox\n                  inputRef={urlInputRef}\n                  autoFocus\n                  label=\"URL:\"\n                  value={url}\n                  validationState={\n                    urlError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && urlError}\n                  onValueChange={(value) => {\n                    setUrl(value);\n                    if (autoFillDirectory) {\n                      setDirectory(getAutoFillDir(value));\n                    }\n                  }}\n                  items={visitedUrls}\n                >\n                  {({ url }) => <Item key={url}>{url}</Item>}\n                </ComboBox>\n                <InputField\n                  inputRef={dirInputRef}\n                  label=\"Directory:\"\n                  value={directory}\n                  validationState={\n                    dirError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && dirError}\n                  addonAfter={\n                    <TooltipTrigger\n                      tooltip={<ActionTooltip actionName=\"Browse... ()\" />}\n                    >\n                      {(props) => (\n                        <AutoHoverPlatformIcon\n                          {...props}\n                          style={{ marginRight: \".2rem\" }}\n                          role=\"button\"\n                          onClick={notImplemented}\n                          icon=\"general/openDisk.svg\"\n                        />\n                      )}\n                    </TooltipTrigger>\n                  }\n                  onChange={(value) => {\n                    setDirectory(value);\n                    setAutoFillDirectory(false);\n                    setDirError(\"\");\n                  }}\n                />\n              </StyledContainer>\n            </form>\n          </LabeledControlsAlignmentProvider>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  isDisabled={!directory || !url}\n                  type=\"submit\"\n                  form=\"clone_form\"\n                >\n                  Clone\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function validateCloneDirectory(directory: string) {\n  const stats = await stat(directory);\n  if (!stats) {\n    return null;\n  }\n  if (!stats.isDirectory()) {\n    return \"Destination is not a directory\";\n  }\n  const entries = await fs.promises.readdir(directory);\n  return entries.length > 0\n    ? \"The directory already exists and is not empty\"\n    : null;\n}\nconst SSH_URL_PATTERN = new RegExp(`^git@[\\\\w.-]+:[\\\\w./-]+\\\\.git$`);\nfunction validateRepoUrl(url: string): string | null {\n  url = sanitizeCloneUrl(url);\n  try {\n    new URL(url);\n    return null;\n  } catch (e) {\n    if (SSH_URL_PATTERN.test(url)) {\n      return null;\n    }\n  }\n  return \"Repository URL is a malformed URL\";\n}\n\nfunction sanitizeCloneUrl(url: string): string {\n  return removePrefix(removePrefix(url.trim(), \"git clone\"), \"hg clone\");\n}\n\nfunction removePrefix(str: string, prefix: string): string {\n  if (str.startsWith(prefix)) {\n    return str.slice(prefix.length);\n  }\n  return str;\n}\n","import { useRunTask } from \"../tasks\";\nimport { useRefreshCurrentProjectFiles } from \"../Project/project.state\";\nimport { vcsRootsState } from \"./file-status.state\";\nimport { useCallback } from \"react\";\nimport { cloneRepo } from \"../ProjectInitializer\";\nimport { _balloonManagerRef } from \"../Project/notImplemented\";\nimport { useSetRecoilState } from \"recoil\";\n\nexport function useClone() {\n  const runTask = useRunTask();\n  const refreshProjectFiles = useRefreshCurrentProjectFiles();\n  const setVcsRoots = useSetRecoilState(vcsRootsState);\n\n  return useCallback(\n    ({\n      url,\n      dir,\n      onSuccess,\n    }: {\n      url: string;\n      dir: string;\n      onSuccess?: () => void;\n    }) => {\n      runTask(\n        {\n          title: `Cloning source repository ${url}`,\n        },\n        {\n          onFinished: onSuccess,\n          run: async ({ setIndeterminate, setFraction, setSecondaryText }) => {\n            await cloneRepo({\n              dir: dir,\n              url,\n              // TODO: handle onAuthFailure, onAuth, and maybe onMessage\n              onProgress: (progress) => {\n                if (progress.total) {\n                  const fraction = progress.loaded / progress.total;\n                  setFraction(fraction);\n                  setSecondaryText(\n                    `${progress.phase}: ${Math.round(fraction * 100)}% ${\n                      progress.loaded\n                    }/${progress.total}`\n                  );\n                } else {\n                  setSecondaryText(progress.phase);\n                  setIndeterminate(true);\n                }\n              },\n            }).then(\n              () => {\n                setVcsRoots((roots) =>\n                  roots.find((root) => root.dir === dir)\n                    ? roots\n                    : roots.concat({ vcs: \"Git\", dir })\n                );\n                refreshProjectFiles(); // FIXME: flashes the whole page\n              },\n              (e) => {\n                console.log(\"e\", e);\n                // FIXME: using useBalloonManager doesn't work here, because of how BalloonManager is rendered inside WindowManager\n                _balloonManagerRef.value?.show({\n                  icon: \"Error\",\n                  title: \"Clone failed\",\n                  body: `Failed to clone git repo \"${url} into ${dir}: ${e}\"`,\n                });\n              }\n            );\n          },\n        }\n      );\n    },\n    []\n  );\n}\n","import React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\nimport { useExistingLatestRecoilValue } from \"../recoil-utils\";\nimport { gitAddActionSelector } from \"./actions/gitAddAction\";\nimport { gitInitActionSelector } from \"./actions/gitInitAction\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"./file-status.state\";\nimport {\n  cloneAnotherRepoActionSelector,\n  gitCloneActionSelector,\n} from \"./actions/gitCloneAction\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n  const [gitAddAction] = useExistingLatestRecoilValue(gitAddActionSelector);\n  const [gitInitAction] = useExistingLatestRecoilValue(gitInitActionSelector);\n  const [gitCloneAction] = useExistingLatestRecoilValue(gitCloneActionSelector);\n  const [cloneAnotherRepoAction] = useExistingLatestRecoilValue(\n    cloneAnotherRepoActionSelector\n  );\n  return [\n    ...useChangesViewActionDefinitions(),\n    gitAddAction,\n    gitCloneAction,\n    cloneAnotherRepoAction,\n    // not including git init action if there is at least one git root, because the action is not fully implemented\n    // and doesn't allow selecting the directory to initialize as a git repository. FIXME\n    ...(useRecoilValue(vcsRootsState).length === 0 ? [gitInitAction] : []),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup close={close} />);\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH,\n      title: \"Navigate Log to Selected Branch Head\",\n      useShortcutsOf: \"SelectIn\",\n      icon: <PlatformIcon icon=\"general/locate.svg\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n  ];\n}\n","import {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { useEffect, useRef } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { RecoilSync } from \"recoil-sync\";\n\nimport { fs } from \"../../fs/fs\";\nimport { ensureDir } from \"../../fs/fs-utils\";\nimport { currentProjectState } from \"../project.state\";\nimport { StorageFiles } from \"./persistentAtomEffect\";\nimport { ensureArray } from \"../../ensureArray\";\n\ntype ComponentState = { [key: string]: unknown; \"@name\": string };\ntype WorkspaceState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\n\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\n\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nasync function readWorkspace(\n  storageFile: string\n): Promise<null | WorkspaceState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const workspaceFileExists = await fs.promises.exists(storageFile);\n  if (!workspaceFileExists) {\n    return null;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = xmlParser.parse(xmlData);\n  workspace.project = workspace.project || {};\n  workspace.project.component = ensureArray(workspace.project.component);\n  return workspace;\n}\nasync function writeWorkspace(\n  storageFile: string,\n  workspaceState: WorkspaceState\n): Promise<void> {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n\n  const xmlString = xmlBuilder.build(workspaceState);\n  await ensureDir(fs.promises, path.dirname(storageFile));\n  await fs.promises.writeFile(storageFile, xmlString);\n}\n\nconst storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n\nexport function PersistentStateProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const containerDirectory = path.join(\n    useRecoilValue(currentProjectState).path,\n    \".idea\"\n  );\n\n  const resolveStorageFile = (storageFile: string) =>\n    path.join(\n      containerDirectory,\n      storageFileMapping[storageFile] || storageFile\n    );\n\n  const getWorkspace = (storageFile: string) => {\n    // FIXME: caching the first read can cause issues when multiple writes happen, where they override each other.\n    const resolvedStorageFile = resolveStorageFile(storageFile);\n    return readWorkspace(resolvedStorageFile);\n  };\n\n  // preload common storage files\n  useEffect(() => {\n    getWorkspace(StorageFiles.WORKSPACE_FILE);\n  }, []);\n\n  return (\n    <RecoilSync\n      storeKey=\"ProjectWorkspace\"\n      read={async (key: string) => {\n        const [storageFile, componentName] = key.split(\"|\");\n        const workspace = await getWorkspace(storageFile);\n        return workspace?.project.component.find(\n          ({ \"@name\": name }) => name === componentName\n        );\n      }}\n      write={async ({ diff }) => {\n        const changesByFile = groupBy(\n          ({ storageFile }) => storageFile,\n          [...diff.entries()].map(([key, value]) => {\n            const [storageFile, componentName] = key.split(\"|\");\n            return {\n              storageFile,\n              componentName,\n              value,\n            };\n          })\n        );\n\n        for (const storageFile in changesByFile) {\n          const changes = changesByFile[storageFile];\n          const workspace: WorkspaceState = (await readWorkspace(\n            resolveStorageFile(storageFile)\n          )) || {\n            \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n            project: { \"@version\": \"4\", component: [] },\n          };\n          for (const { value, componentName } of changes) {\n            const components = workspace.project.component;\n            const index = components.findIndex(\n              ({ \"@name\": name }) => name === componentName\n            );\n            const componentState =\n              typeof value === \"function\"\n                ? value(components[index] || null)\n                : (value as object);\n            components.splice(index, index >= 0 ? 1 : 0, {\n              \"@name\": componentName,\n              ...componentState,\n            });\n          }\n          await writeWorkspace(resolveStorageFile(storageFile), workspace);\n        }\n      }}\n    >\n      {children}\n    </RecoilSync>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + Math.round(num / 20) + 1;\n}\n","import React, { CSSProperties, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionsProviderProps,\n  BalloonManager,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useAlertDialog,\n  useBalloonManager,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { toolWindows } from \"./toolWindows\";\nimport { SyncChangeListsState } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsState } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { PersistentStateProvider } from \"./persistence/PersistentStateProvider\";\nimport { useTestActions } from \"../testActions/useTestActions\";\nimport { ToolWindowsRefContext } from \"./useToolWindowManager\";\nimport {\n  projectPopupManagerRefState,\n  windowManagerRefState,\n  alertDialogRefState,\n} from \"./project.state\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({ height }: { height: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  const [state, setState] = useRecoilState(toolWindowsState);\n  const isRollbackWindowOpen = useRecoilValue(rollbackViewState.isOpen);\n  const isSearchEveryWhereOpen = useRecoilValue(searchEverywhereState.isOpen);\n\n  useRecoilValue(projectPopupManagerRefState).current = usePopupManager();\n  useRecoilValue(windowManagerRefState).current = useWindowManager();\n  useRecoilValue(alertDialogRefState).current = useAlertDialog();\n\n  return (\n    <PersistentStateProvider>\n      <SyncChangeListsState />\n      <BalloonManager disablePortal>\n        <SetBalloonManagerRef />\n        <UsePersistentFsNotification />\n        {/* disablePortal to make example app more portable*/}\n        <ToolWindowsRefContext.Provider value={toolWindowRef}>\n          <StyledWindowFrame style={{ height }}>\n            <ProjectActionProvider>\n              {({ shortcutHandlerProps }) => (\n                <>\n                  <DefaultToolWindows\n                    ref={toolWindowRef}\n                    toolWindowsState={state}\n                    onToolWindowStateChange={(newState) => {\n                      setState(newState);\n                    }}\n                    windows={toolWindows}\n                    containerProps={shortcutHandlerProps}\n                  >\n                    <FileEditor />\n                  </DefaultToolWindows>\n                  <IdeStatusBar />\n                </>\n              )}\n            </ProjectActionProvider>\n            {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n            {isRollbackWindowOpen && <RollbackWindow />}\n          </StyledWindowFrame>\n        </ToolWindowsRefContext.Provider>\n      </BalloonManager>\n    </PersistentStateProvider>\n  );\n};\n\nfunction ProjectActionProvider(\n  props: Omit<ActionsProviderProps, \"actions\" | \"useCapture\">\n) {\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n  return (\n    <ActionsProvider\n      {...props}\n      actions={allActions}\n      useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n    />\n  );\n}\n\nfunction SetBalloonManagerRef() {\n  _balloonManagerRef.value = useBalloonManager();\n  return null;\n}\n\nfunction UsePersistentFsNotification() {\n  usePersistenceFsNotification();\n  return null;\n}\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateVersionControlWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit9\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n  [VcsActionIds.ADD_UNVERSIONED]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [VcsActionIds.FOCUS_TEXT_FILTER]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyL\",\n      },\n    },\n  ],\n  [VcsActionIds.GROUP_BY_DIRECTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Control\"],\n        code: \"KeyP\",\n      },\n    },\n  ],\n  SafeDelete: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  CopyPaths: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  NewElement: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n};\n","import * as path from \"path\";\nimport React, { CSSProperties } from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  KeymapProvider,\n  PopupManager,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { ProjectInitializer } from \"./ProjectInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport \"./jetbrains-mono-font.css\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({\n  height,\n  autoCloneSampleRepo,\n}: {\n  height?: CSSProperties[\"height\"];\n  autoCloneSampleRepo?: boolean;\n}) => {\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <ProjectInitializer autoCloneSampleRepo={autoCloneSampleRepo}>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <RecoilRoot>\n              <WindowManager>\n                <PopupManager>\n                  <Project height={height} />\n                </PopupManager>\n              </WindowManager>\n            </RecoilRoot>\n          </KeymapProvider>\n        </ProjectInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n"],"names":["LoadingGif","props","React","Img","_extends","src","darkSrc","__docgenInfo","Loading","styled","withConfig","displayName","componentId","DefaultSuspense","_ref","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","darculaColorSchemeTokenRules","vsCodeTheme","flatMap","scope","settings","map","token","values","Object","keys","forEach","key","value","StyledEditor","MonacoEditor","Editor","editorTheme","useEditorTheme","monaco","useMonaco","theme","useTheme","themeName","setThemeName","useState","dark","useLayoutEffect","name","replace","editor","defineTheme","base","inherit","colors","rules","options","minimap","enabled","lineHeight","showFoldingControls","renderIndentGuides","overviewRulerBorder","fontFamily","fontSize","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","IndexedDB","Create","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","pathname","persistentFsPreference","get","localStorage","getItem","set","setItem","switchToPersistentFS","_temp","log","getRootFS","InMemory","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","read","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentState","selectorFamily","fileNames","stats","all","fileName","type","basename","lastModification","mtimeMs","size","reloadFileFromDiskCallback","reset","refresh","readFileContentSelector","fileContentState","encoding","atomFamily","default","effects","_ref2","onSet","error","useLatestRecoilValue","recoilValue","state","setState","loadable","useRecoilValueLoadable","useEffect","contents","getValue","useExistingLatestRecoilValue","toPromise","useRecoilInitialValue","recoilState","defaultValue","useRecoilCallback","snapshot","getLoadable","filterPath","includes","autoClonedRepo","defaultProject","currentProjectState","atom","projectFilePath","projectRelativePath","currentProjectFilesState","selector","project","projectFilesState","projectPath","_ref3","files","addItem","item","childItems","push","relativePath","useRefreshCurrentProjectFiles","useRecoilRefresher_UNSTABLE","activePathsState","activePathExistsState","_ref4","length","useActivePathsProvider","createFocusBasedSetterHook","nullValue","focusedElement","setValue","useSetRecoilState","elementRef","useRef","current","currentValue","equals","onFocus","currentTarget","onBlur","relatedTarget","Element","closest","projectPopupManagerRefState","createRef","dangerouslyAllowMutability","windowManagerRefState","alertDialogRefState","temporaryTabsDefaultValue","sortWith","descend","file","endsWith","filter","slice","editorState","cursorPos","lineNumber","column","editorTabsState","getPromise","setSelf","trigger","tabs","activeEditorTabIndexState","activeEditorTabState","editorCursorPositionState","Position","editorRefState","openPathCallback","shouldFocus","tabsState","index","findIndex","tab","select","focus","valueOrThrow","newIndex","currentState","setTimeout","closeCallback","_ref5","_","tabIndex","closePathCallback","callbackInterface","transact_UNSTABLE","close","Math","max","closeOtherTabsCallback","_ref6","_ref7","numTabs","_ref8","editorManagerState","_ref9","getCallback","openPath","closeTab","closePath","closeOtherTabs","useEditorStateManager","useRecoilValue","convertGitStatus","Array","isArray","ensureArray","input","StorageFiles","persistentAtomEffect","componentName","refine","update","storageFile","WORKSPACE_FILE","itemKey","join","syncEffect","storeKey","syncDefault","readComponentState","write","DefaultValue","option","optionName","args","find","currentSettings","updates","vcsDirectoryMappingChecker","array","object","dir","string","vcs","union","literal","vcsRootsState","gitSettings","mappings","mapping","TMP_findGitRoots","git","roots","Set","notNull","vcsRootForFile","findRoot","fetchRepoStatusFromFs","repoDir","rows","statusMatrix","result","row","repoStatusState","repoStatusUpdatingState","fileStatusState","repoRoot","repoStatus","filepaths","refreshFileStatusCallback","statusMap","newStatusMap","useRefreshFileStatus","useRefreshRepoStatuses","gitDirs","useStatusColor","FileStatusColor","color","fileStatus","useFileStatusColor","style","StatusColor","currentForegroundAware","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","StyledContainer","div","attrs","StyledLine","StyledShortcut","commonColors","linkForegroundEnabled","EditorZeroState","ActionTip","actionId","CommonActionId","GO_TO_FILE","GO_TO_ACTION","getShortcut","useGetActionShortcut","action","useAction","editorFullState","activeEditorTab","FileEditor","editorTabs","editorStateManager","editorRef","active","setActive","hideAllAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","loadingState","tabActionsRef","useLatest","closeOthersTabs","setEditorRef","setContent","updateFileStatus","activePathsProviderProps","StyledFileEditorContainer","mergeProps","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","PlatformIcon","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","onMount","monacoEditor","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","JsxEmit","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","onChange","newContent","FileEditorLoading","isUnderDarcula","panelBackground","StyledXterm","XTerm","Terminal","setInput","xtermRef","useMemo","background","selection","letterSpacing","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","ref","onData","data","charCodeAt","foldersOnTopState","expandedKeysState","selectionState","selectedNodesState","nodesByKey","currentProjectTreeState","byKey","projectViewTreeRefState","rootItems","Map","mapItem","parent","node","dirNode","sortProjectTreeNodes","root","createProjectTree","sort","item1","item2","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","projectActionIds","NewElement","NewFile","NewDir","CopyReferencePopupGroup","CopyPaths","CopyFileReference","CopyAbsolutePath","CopySourceRootPath","CopyFileName","ProjectViewContextMenu","getActionContext","ActionsMenu","actionContext","shortcut","undefined","DividerItem","CUT","COPY","PASTE","DELETE","ProjectViewPane","setProjectViewTreeRef","treeState","setExpandedKeys","useRecoilState","selectedKeys","setSelectedKeys","sortItems","sortBy","a","identity","selectedKeysArray","i","containerRef","contextMenuTargetKey","element","querySelector","event","onOpen","dataset","SpeedSearchTree","fillAvailableSpace","autoFocus","selectionMode","onExpandedChange","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","Hint","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","HelpButton","HelpTooltip","helpText","Button","variant","findRootPaths","objects","getPath","obj","thePath","anObject","startsWith","deleteFileCallback","refreshFileStatus","releaseSnapshot","retain","unlink","deleteFilesCallback","deleteFile","filePaths","deleteDirCallback","recursivelyDeleteDir","pathnames","fullpath","rmdir","createDirectoryCallback","destination","fileCountMsg","IntlMessageFormat","dirCountMsg","deleteActionState","id","description","isDisabled","actionPerformed","deleteDir","deleteFiles","selectedNodes","windowManager","alertDialog","nodesToDelete","directories","singleDirName","confirm","okText","message","width","count","format","open","DeleteFilesConfirmationDialog","confirmed","requestAnimationFrame","ModalWindow","minWidth","minHeight","WindowLayout","header","onSubmit","preventDefault","padding","marginBottom","display","flexDirection","gap","Checkbox","footer","Footer","left","right","form","copyActionState","cutActionState","pasteActionState","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","activeTab","selectPathInProjectView","selectOpenedFile","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","EXPAND_ALL","COLLAPSE_ALL","DEFAULT_LOADING_DELAY_MS","Delayed","waitedEnough","setWaitedEnough","timer","clearTimeout","Tagged","change","Change","before","after","Unversioned","revision","changeToFileStatus","ADDED","DELETED","MOVED","RENAMED","MODIFIED","UNVERSIONED","revisionEquals","b","isDir","isAddition","isDeletion","isRename","isMove","isModified","isUnversioned","sameBefore","sameAfter","repoChangesState","entries","allChangesState","flat","changeListsState","comment","changes","activeChangeListState","changeList","unversionedChangesState","SyncChangeListsState","setChangeLists","changeLists","trackedChanges","updatedChangeLists","aChange","existingChanges","newChanges","anExistingChange","createGroupByDirectory","mapNode","createDirectoryNode","shouldCollapseDirectories","nodes","pathToNodeCache","rootDirNodes","reduce","prevNode","parentNodePath","isDirectoryNode","directoryNodes","uniq","collapseDirectories","createDirectorNode","child","changesTreeNodeKey","getNodeKeyForChange","changeNode","showPath","isGroupNode","isChangeNode","getChildren","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","ADD_UNVERSIONED","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","EDIT_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GROUP_BY_DIRECTORY","GIT_ADD","GIT_INIT","GIT_CLONE","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","GIT_LOG_HIDE_BRANCHES","GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH","GIT_UPDATE_SELECTED","FOCUS_TEXT_FILTER","MATCH_CASE","REG_EXP","COPY_REVISION_NUMBER","LOG_REFRESH","SHOW_DETAILS","SHOW_DIFF_PREVIEW","PRESENTATION_SETTINGS","FILE_HISTORY_PRESENTATION_SETTINGS","CopyPathFromRepositoryRootProvider","repositoryGrouping","isAvailable","groupFn","repository","repositoryNode","directoryGrouping","useShortcutOf","keyPrefix","directoryNode","defaultChangeGroupings","defaultChangeGroupingsState","grouping","isRecoilValue","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","getPrefixedChangesGroupFn","isActive","groupings","groupFns","arguments","isOpen","windowBounds","initiallyIncludedChanges","rootNodes","selectedChanges","changesTreeNodesState","includedRootNodes","some","rollbackViewState","initiallyExpandedKeys","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","changesTreeNodesResult","fileCountsMap","expandAllKeys","dfsVisit","childrenFileCount","add","fileCount","total","changeListNode","showIgnoredFilesState","showRelatedFilesState","changesGroupingActiveState","selectedKeysState","resolvedSelectedKeysState","bfsVisit","parentValue","changesUnderSelectedKeys","allChanges","processNode","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysState","includedChangesState","includedChangeKeys","has","includedChangesNestedSelection","NestedSelection","createSetInterface","getKey","changesViewGroupingsState","groupChildren","_ref10","changeListNodes","_ref11","prefixedGroupFn","unversionedChanges","unversionedChangesNode","commitMessageSizeState","orientation","amendCommitState","commitMessageState","commitErrorMessageState","commitTaskIdState","changesFromActivePathsState","_ref12","activePaths","activePath","queueCheckInCallback","_ref13","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","_ref14","contextual","changesUnderSelection","changesBasedOnActivePaths","ChangesViewTreeContextMenu","asyncFilter","predicate","predicateResult","getTrackingBranch","localBranchName","mergeRef","remote","repoLocalBranchesState","branches","branch","trackingBranch","repoRemoteBranchesState","remotes","repoBranchesState","currentBranchName","repoCurrentBranchNameState","localBranches","currentBranch","remoteBranches","fullname","allBranchesState","branchForPathState","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","readBranchStorage","branchStorage","entry","list","toBranchStorage","branchesByType","groupBy","branchInfoArrayChecker","favoriteBranchesState","isFavoriteBranchState","branchInfo","isFavorite","excludedFromFavoriteBranchesState","isPredefinedAsFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","StyledRepoColorSquare","span","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","currentBackgroundAware","formatFileCount","ChangeNodeHint","defaultNodeRenderers","repoNodeRenderer","rendered","directory","directoryNodeRenderer","createChangesTreeNodeRenderer","renderers","defaultRendererOverrides","nodeRenderers","getItemProps","nodeRenderer","dirCount","hasChildItems","getTextValue","itemRenderer","LoadingText","loading","changesViewTreeNodeRenderer","changelist","changeListNodeRenderer","fontWeight","unversioned","unversionedChangesNodeRenderer","_node","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","menuProps","actionMenuProps","SpeedSearchMenu","GroupByActionButton","IconButton","isPressed","Section","ChangesGroupByActionButton","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","border","ToolbarSeparator","tasksState","firstTaskState","taskCountState","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","cancelToken","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","finally","onFinished","useCancelTask","abort","resolvedRefState","depth","dateToString","date","getMonth","getDate","getFullYear","toString","dateRangeToString","dateRange","from","to","vcsTabKeysState","vcsActiveTabKeyState","vcsTabTitleState","searchQuery","vcsLogFilter","user","parts","short","long","part","tabStats","vcsLogTabState","someAtomFamily","vcsLogTabShowBranchesState","vcsLogTabShowCommitDetailsState","vcsLogTabShowCommitDetailsInCurrentTabState","CURRENT_USER_FILTER_VALUE","matchCase","regExp","vcsLogFilterCurrentTab","mapObjIndexed","newValue","useResetFilters","tabKey","closeTabCallback","cache","commitDateComparator","commit","committer","timestamp","match","query","flags","RegExp","test","toLowerCase","allCommitsState","allCommits","commitsMap","commitsToProcess","readCommitResult","oid","_len","sources","_key","initialCommits","refs","repoPath","isBare","getCommonArgs","c1","c2","addCommit","latestCommit","containingRefs","shift","aCommit","splice","commitsTableRowsState","dateFilter","author","getTime","tree","byOid","indexBy","allResolvedRefsState","repoBranches","addRef","isCurrent","commitsSelectionState","selectedCommitOids","selectedCommitsState","selectedCommitState","_ref15","vcsTableShowCommitTimestampState","vcsTableReferencesOnTheLeftState","vcsTableHighlightMyCommitsState","authorColumn","hashColumn","dateColumn","defaultVisibleColumns","vcsTableColumnsVisibilityState","commitSuccessfulMessage","useCommitChanges","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","containsChange","blob","mode","newTreeOid","commitRef","commitFiles","email","StyledCommitMessageContainer","StyledCommitMessageTextArea","textarea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","amend","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","placeholder","preventFocusOnPress","mnemonic","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","setAmend","ActionHelpTooltip","focusCommitMessage","preventFocus","deleteChangeListMsg","selectedFilesCountMsg","deletablePathsUnderChangesTreeSelectionState","deletePaths","pathsToDelete","useChangesViewActions","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","StyledTreeViewWrapper","StyledLoadingWrapper","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","updating","commitMessageSize","setCommitMessageSize","changesViewActions","treeActions","ThreeViewSplitter","innerView","ActionsProvider","shortcutHandlerProps","innerViewMinSize","lastView","lastSize","onLastResize","inactiveTextColor","ChangesViewZeroState","performAction","usePerformAction","textAlign","verticalAlign","ChangesViewPane","vcsRoots","TrackingBranchInfo","borderSpacing","COMMIT_TOOLWINDOW_ID","changesBranchesState","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","View","tabContent","UNSAFE_FocusRestoringSuspense","document","activeElement","HTMLElement","isConnected","StyledHeader","borderColor","StyledSpacer","StyledPlaceholderContainer","parseCommitMessage","lines","bodyLines","subject","bodyAsString","line","shortenOid","commitDateTimeFormatter","Intl","DateTimeFormat","day","month","year","hour","minute","hour12","commitTimeFormatter","commitDateFormatter","getText","commitChangesTreeNodeRenderer","commitParent","DEFAULT_SIMILARITY_INDEX","detectRenames","deletions","additions","getContent","renameMapping","similarity","file1Content","file2Content","diffLines","unchanged","added","removed","computeSimilarity","deletion","addition","currentCandidate","mergeRenames","detectRenamesBasedOnContent","hash","detectRenamesBasedOnHash","renamedChanges","rename","candidate","commitChangesTreeRefState","COMMIT_PARENT_ID","commitsDiffWithoutRenamesState","fromRef","toRef","trees","afterOid","beforeOid","afterType","beforeType","afterRevision","TextDecoder","decode","Uint8Array","beforeRevision","getCommitChanges","commitsDiffState","getChangedFilesState","commitLogItem","parents","getChangesGroupFn","sortTreeNodesInPlace","changedFilesWithoutRenamesState","changedFilesState","CommitChangedFiles","treeShortcutHandlerProps","selectedCommits","nothingSelected","stateLoadable","states","loadables","useFastestValueLoadable","valueMaybe","setSelection","paddingBottom","PositionedTooltipTrigger","placement","bottom","labelIcon","fill","d","vcsLogStandardColors","light","gitLogColors","head","localBranch","remoteBranch","tag","StyledRef","StyledLabelSvg","svg","viewBox","StyledRefIconGroup","StyledLabelText","RefIcon","RefIconGroup","types","RefLabel","StyledCommitMessage","StyledCommitMessageHeader","StyledCommitterInfo","label","disabled","StyledCommitInfoRow","StyledRepoColorIcon","StyledRefsContainer","CommitDetails","firstSelectedCommit","allResolvedRefs","isMultiRepo","committerInfo","EmailLink","formatDateAndTime","refsByType","Tooltip","Date","RefGroup","StyledRefWithIcon","href","formatCommitDate","formatCommitTime","useRedefineAction","newId","useActions","commonProperties","useShortcutsOf","isSearchable","context","splitViewSizeState","groupingState","GROUP_BY_ACTION_GROUP_ID","LAYOUT_ACTION_GROUP_ID","VIEW_OPTIONS_ACTION_GROUP_ID","SHOW_DETAILS_ACTION_ID","SHOW_DIFF_PREVIEW_ACTION_ID","groupingActionId","VcsLogDetailsView","splitViewSize","setSplitViewSize","isDetailsVisible","toggleGroupBy","createActionGroup","useCreateDefaultActionGroup","availableGroupings","menuPresentation","VcsLogsDetailsViewOptionsMenu","flexShrink","flex","firstSize","onFirstResize","firstViewMinSize","firstView","toggleActionsState","fromEntries","useActionGroup","ActionGroupMenu","actionGroup","StyledDropdownButton","button","focusRing","focused","StyledDropdownIcon","StyledValue","FocusableAutoHoverPlatformIcon","AutoHoverPlatformIcon","VcsFilterDropdown","onClear","menuTriggerProps","MenuTrigger","BareButton","hoverIcon","StyledMenuIconButton","role","BranchFavoriteButton","onClick","onPointerUp","stopPropagation","hoverContainerSelector","BranchesFilterDropdown","selectedBranches","setSelectedBranches","resetBranches","useResetRecoilState","BranchesFilterMenu","onBranchesSelected","groupRepoRoots","repoRoots","repoGroupedAllBranchesState","allBranches","allRemoteBranches","allLocalBranches","setFavoriteBranches","repoGroupedAllBranches","remoteBranchesByRemote","createLocalBranchItems","renderBranchItem","submenuBehavior","Divider","origin","_ref16","NAME_PATTERN","getNameInStandardForm","firstAndLastName","matches","getFirstAndLastName","firstName","lastName","PRINTABLE_ASCII_PATTERN","nameToLowerCase","gitRepoUserState","StyledCommitRow","StyledCommitCell","asOverlay","StyledMessageContainer","StyledRefTooltipRow","useCurrentUserHighlightStyle","currentUser","shouldHighlightCurrentUserCommits","userFilter","user2","CommitsTableRow","showCommitTimestamp","referencesOnTheLeft","isAuthorVisible","isDateVisible","isHashVisible","highlightStyles","flexBasis","flexGrow","CommitRefs","onLeft","refKey","filteredRefs","headIsOnABranch","aBranch","delay","withPointer","tooltipTriggerProps","unshift","StyledProgressBar","ProgressBar","StyledListItem","ResolvedRefsContext","CommitsTable","currentTabKey","resetFilters","commitRowsState","setSelectedCommits","Provider","List","estimatedItemHeight","Consumer","showToggleDefs","highlightToggleDefs","columnToggleDefs","useToggleDef","CommitsTableViewOptionsMenuIconButton","showToggles","highlightToggles","columnToggles","allToggles","toggleKey","StyledSearchInput","SearchInput","searchHistoryState","VcsLogCommitsView","textFilterRef","searchInputRefState","setSearchQuery","setUser","resetUser","setDateFilter","resetDate","searchHistory","setSearchHistory","searchInputValue","setSearchInputValue","getActionShortcut","isRegExpOn","isMatchCaseOn","submitSearchQuery","createNewTab","newTabId","uuid","filterState","today","sevenDaysAgo","setDate","yesterday","predefinedDateRanges","inputRef","addonAfter","StyledHoverContainer","excludeFromTabOrder","predefinedDateRange","getLocalBranchNodes","shouldGroupByDirectory","localBranchNodes","repos","groupNodesByDirectory","getRemoteBranchNodes","remoteBranchNodes","branchesTreeNodeState","branchTreeGroupingState","shouldGroupByRepository","isGroupByRepositoryAvailableState","branchesTreeRefState","searchInputState","availableGroupingsState","BranchesGroupByActionButton","branchTreeNodeRenderers","toUpperCase","Group","keyToBranch","_repo","StyledSearchIconContainer","BranchesTree","branchesTreeNodes","searchTerm","setSearchTerm","searchInputRef","selectionManagerRef","isInputFocused","setInputFocused","setBranchFilter","collectionSearchInputProps","useCollectionSearchInput","collectionRef","selectionManager","showAsFocused","onSearchTermChange","keepSearchActiveOnBlur","hideSpeedSearchPopup","isSearchActive","DELETE_BRANCH_ACTION_ID","SHOW_BRANCH_DIFF_ACTION_ID","SHOW_MY_BRANCHES_ACTION_ID","FETCH_ACTION_ID","TOGGLE_FAVORITE_ACTION_ID","VcsBranchesView","VcsLogBranchesViewToolbar","StyledToolbar","useCommitsTableActions","copyRevisionNumber","copyToClipboard","refreshLog","COPY_REFERENCE","VersionControlToolWindowZeroState","firstViewSizeState","lastViewSizeState","StyledToolWindowHeader","VersionControlToolWindow","tabKeys","activeTabKey","setActiveTabKey","activeKey","onActiveKeyChange","VcsToolWindowTabTitle","VcsTab","StyledExpandStripeButton","StyledShowBranchesButton","StyledShowBranchesButtonText","ShowBranchesButton","firstViewSize","setFirstViewSize","lastViewSize","setLastViewSize","hideBranches","toggleMatchCase","useToggleCurrentTabSettings","toggleRegExp","toggleDetails","useVcsLogsToolWindowActions","showBranches","setShowBranches","firstViewProps","lastViewMinSize","toggleState","ToolWindowTabContent","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","isSplit","showProgressPanelState","tasksPopupBoundsState","StyledPopupTitle","TasksPopup","setShowProgressPanel","cancel","bounds","setBounds","Popup","innerWidth","top","innerHeight","onBoundsChange","nonDismissable","interactions","Layout","Header","hasControls","margin","details","secondaryDetails","maxValue","ProgressBarStopButton","StyledVerticalSeparator","StatusBarProgress","dense","namePosition","Spacer","StyledProgressBarButton","Container","StatusBarTaskProgressBar","firstTask","tasksCount","showProgressPanel","small","activeFileRepoRootState","activeFile","activeFileRepoBranchesState","activeFileRepoRoot","activeFileCurrentBranchState","activeFileRepoHeadState","detached","resolveRef","validateBranchName","newBranchName","ILLEGAL_CHARS_PATTERN","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","labelPlacement","validationMessage","Boolean","StyledTitle","branchesPopupSizeState","BranchesPopup","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","useWindowManager","checkoutBranch","reloadFileFromDisk","checkout","openedFiles","existingOpenedFile","interactionType","PopupLayout","currentBounds","disabledKeys","operation","tryCheckout","Errors","CheckoutConflictError","BalloonActionLink","aRepoRoot","checkoutRemoteBranch","onClose","getSectionLabel","compareActions","mergeActions","favoriteBranchArgs","notified","BranchPopupTrigger","gitRepoHead","maybeShowGitCloneTip","useShowGitTipIfNeeded","showSticky","PopupTrigger","onOpenChange","popup","StatusBarWidget","StyledLastMessage","IdeStatusBar","cursorPosition","StatusBar","RollbackTreeContextMenu","StyledFrame","contrastBorder","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","useRollbackChanges","deleteAddedFiles","changesWithRepoRoots","groupedChanges","toReset","toCheckout","allSettled","resetIndex","pathToRefresh","balloons","setOpen","setDeleteAddedFiles","atLeastOneNewFileSelected","toolWindowsState","ToolWindowsState","removedFromSideBarIds","showStripeButton","tips","EXPAND_SELECTION","SHRINK_SELECTION","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsState","noContentHeight","otherProps","persistBounds","getInitBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","ActionItem","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","SHOW_INTENTION_ACTIONS","search","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","getItemText","renderItem","FileItem","dirMatches","filenameMatches","splitWhen","titleMatches","filesSearchContributor","getProjectFiles","SearchEverywhereActionIds","StyledTab","selected","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","hr","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","setFocusedKey","localActions","currentContributorIndex","contributorActions","limit","nextItem","itemWrapper","_ref17","Tabs","TabComponent","TabsComponent","FocusScope","contain","newPattern","newPatternContainsPrevious","onPatternChanged","shouldFocusWrap","_ref18","itemText","gitAddCallback","StyledInput","NewItemPopup","inputName","validationType","hideMessage","setHideMessage","onMouseDown","offset","crossOffset","ValidationTooltip","appearance","createFileActionState","popupManager","destinationDir","NewFilePopup","createFile","createFileCallback","editorManager","waitUntil","HTMLTextAreaElement","AddFileToGitWindow","setFilename","setValidationMessage","submit","addToGit","criteria","timeoutInMs","createDirectoryActionState","NewDirectoryPopup","createDirectory","dirName","setDirName","validationResult","setValidationResult","updateValidation","asyncCallback","callbackRef","_len2","_key2","useCancelableAsyncCallback","validate","copyFilenameActionState","copyAbsolutePathActionState","copyPathFromRepositoryRootActionState","useProjectActions","openSearchEverywhere","createDefaultActionGroup","newElementActionGroup","copyReferencePopupGroup","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","projectFiles","relative","isPathInside","selectedPathsAreDirectories","every","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","changePath","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","AlreadyExistsError","autoSelect","createAction","pathsToAddState","isIgnored","isUnchangedFile","gitAddDisabledState","gitAddActionSelector","pathsToAdd","gitInitActionSelector","visitedUrlsChecker","url","username","gitVisitedUrlsState","UrlAndUserName","cloneParentDirState","defaultWorkspaceFiles","defaultInitializer","InlinePopup","StyledPopupContainer","ProjectInitializer","autoCloneSampleRepo","cloneProgress","setCloneProgress","ensureSampleRepo","repoUrl","info","isSuccessfullyCloned","cloneRepo","onProgress","initializer","INITIALIZE_APP","projectDir","loaded","phase","round","AlertDialog","heading","buttons","location","reload","clone","http","corsProxy","singleBranch","gitCloneActionSelector","GitCloneWindow","cloneAnotherRepoActionSelector","urlProp","setUrl","parentDir","setDirectory","getAutoFillDir","autoFillDirectory","setAutoFillDirectory","showValidationErrors","setShowValidationErrors","setCloneParentDirState","visitedUrls","setVisitedUrls","urlInputRef","dirInputRef","urlError","removePrefix","trim","sanitizeCloneUrl","URL","SSH_URL_PATTERN","validateRepoUrl","dirError","setDirError","refreshProjectFiles","setVcsRoots","useCallback","onSuccess","useClone","repoName","LabeledControlsAlignmentProvider","dirValidationError","validateCloneDirectory","urls","visitedUrl","ComboBox","onValueChange","str","prefix","useVcsActions","usePopupManager","gitAddAction","gitInitAction","gitCloneAction","cloneAnotherRepoAction","WORKSPACE_XML_PARSE_OPTIONS","attributeNamePrefix","ignoreAttributes","tagName","jPath","WORKSPACE_XML_BUILD_OPTIONS","readWorkspace","xmlParser","XMLParser","xmlData","workspace","parse","component","writeWorkspace","workspaceState","xmlString","XMLBuilder","build","storageFileMapping","PersistentStateProvider","containerDirectory","resolveStorageFile","getWorkspace","RecoilSync","diff","changesByFile","components","componentState","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","useAlertDialog","BalloonManager","disablePortal","SetBalloonManagerRef","UsePersistentFsNotification","ProjectActionProvider","DefaultToolWindows","onToolWindowStateChange","newState","windows","useCapture","timeoutId","usePersistenceFsNotification","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateVersionControlWindow","ActivateTerminalWindow","SafeDelete","App","KeymapProvider","RecoilRoot","WindowManager","PopupManager"],"sourceRoot":""}