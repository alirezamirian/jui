{"version":3,"file":"assets/js/2.cc045e32.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/atom-utils/atomWithRefresh.ts","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/atom-utils/focus-based-atom-utils.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/atom-utils/useStableSetAtom.ts","webpack://website/../example-app/src/persistence/atomWithPersistence.ts","webpack://website/../example-app/src/persistence/schema-utils.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/EditorZeroState.tsx","webpack://website/../example-app/src/appActionIds.ts","webpack://website/../example-app/src/Editor/editorActionIds.ts","webpack://website/../example-app/src/Editor/useEditorActionGroup.tsx","webpack://website/../example-app/src/atom-utils/atomWithGetCallback.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/atom-utils/unwrapLatestWithLoading.ts","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/Project/projectActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectViewContextMenu.tsx","webpack://website/../example-app/src/atom-utils/unwrapLatest.ts","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/HelpButton.tsx","webpack://website/../example-app/src/path-utils.ts","webpack://website/../example-app/src/Project/fs-operations.ts","webpack://website/../example-app/src/atom-utils/isAtom.ts","webpack://website/../example-app/src/actionAtom.ts","webpack://website/../example-app/src/ProjectView/actions/deleteAction.tsx","webpack://website/../example-app/src/ProjectView/actions/copyAction.tsx","webpack://website/../example-app/src/ProjectView/actions/cutAction.tsx","webpack://website/../example-app/src/ProjectView/actions/pasteAction.tsx","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/Delayed.tsx","webpack://website/../example-app/src/VersionControl/Changes/Change.ts","webpack://website/../example-app/src/VersionControl/Changes/changes.state.ts","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/tree-utils/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/ChangeTreeNode.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodesResult.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesViewTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/refs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DateRange.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/vcs-logs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/readCommits.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useChangesViewActions.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewZeroState.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/TrackingBranchInfo.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/styled-components.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/commit-utils.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/commitChangesTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/getCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/Changes/detectRenames.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/RefLabel.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/CommitDetails.tsx","webpack://website/../example-app/src/useRedefineAction.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/VcsLogDetailsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogDropdown.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/BranchesFilterDropdown.tsx","webpack://website/../example-app/src/VersionControl/git-users.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableRow.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableViewOptionsMenuIconButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogCommitsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/branchTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/VcsBranchesView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/useCommitsTableActions.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindowZeroState.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.state.ts","webpack://website/../example-app/src/StatusBar/TasksPopup.tsx","webpack://website/../example-app/src/StatusBar/StatusBarTaskProgressBar.tsx","webpack://website/../example-app/src/atom-utils/latestDefinedValue.ts","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/BranchPopupTrigger.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/VersionControl/gitAddCallback.tsx","webpack://website/../example-app/src/Project/actions/NewItemPopup.tsx","webpack://website/../example-app/src/Project/actions/createFileAction.tsx","webpack://website/../example-app/src/useCancelableAsyncCallback.ts","webpack://website/../example-app/src/Project/actions/createDirectoryAction.tsx","webpack://website/../example-app/src/Project/actions/copyFilename.tsx","webpack://website/../example-app/src/Project/actions/copyAbsolutePath.tsx","webpack://website/../example-app/src/VersionControl/actions/copyPathFromRepositoryRoot.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/actions/gitAddAction.tsx","webpack://website/../example-app/src/VersionControl/actions/gitInitAction.tsx","webpack://website/../example-app/src/VersionControl/gitRememberedInputs.state.ts","webpack://website/../example-app/src/ProjectInitializer.tsx","webpack://website/../example-app/src/VersionControl/actions/getInputCursorOffset.ts","webpack://website/../example-app/src/VersionControl/actions/PathInputField.tsx","webpack://website/../example-app/src/VersionControl/actions/gitCloneAction.tsx","webpack://website/../example-app/src/VersionControl/useClone.ts","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx","webpack://website/../jui/src/ActionSystem/ActionGroup.tsx","webpack://website/../jui/src/ActionSystem/ActionShortcut.tsx","webpack://website/../jui/src/ActionSystem/useShortcut.ts","webpack://website/../jui/src/ActionSystem/ActionsProvider.tsx","webpack://website/../jui/src/ActionSystem/CommonActionIds.ts","webpack://website/../jui/src/ActionSystem/KeymapProvider.tsx","webpack://website/../jui/src/ActionSystem/Shortcut.ts","webpack://website/../jui/src/ActionSystem/components/ActionButton.tsx","webpack://website/../jui/src/ActionSystem/components/ActionGroupMenu.tsx","webpack://website/../jui/src/ActionSystem/components/ActionsMenu.tsx","webpack://website/../jui/src/ActionSystem/components/useCreateDefaultActionGroup.tsx","webpack://website/../jui/src/ActionSystem/defaultKeymap.tsx","webpack://website/../jui/src/ActionSystem/shortcutToString.ts","webpack://website/../jui/src/ActionSystem/useActionGroup.tsx","webpack://website/../jui/src/AlertDialog/AlertDialog.tsx","webpack://website/../jui/src/AlertDialog/useAlertDialog.tsx","webpack://website/../jui/src/Balloon/Balloon.styled.tsx","webpack://website/../jui/src/Balloon/Balloon.tsx","webpack://website/../jui/src/Balloon/BalloonManager.tsx","webpack://website/../jui/src/Balloon/StyledBalloonsStack.tsx","webpack://website/../jui/src/Button/BareButton.tsx","webpack://website/../jui/src/Button/StyledButton.tsx","webpack://website/../jui/src/Button/Button.tsx","webpack://website/../jui/src/ButtonGroup/ButtonGroup.tsx","webpack://website/../jui/src/Checkbox/Checkbox.tsx","webpack://website/../jui/src/Checkbox/CheckboxIcon.tsx","webpack://website/../jui/src/CollectionSpeedSearch/CollectionSpeedSearchContext.tsx","webpack://website/../jui/src/CollectionSpeedSearch/HighlightedTextValue.tsx","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearchResult.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchSelectionManager.ts","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearch.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchKeyboardDelegate.ts","webpack://website/../jui/src/Collections/Divider.ts","webpack://website/../jui/src/Collections/Item.ts","webpack://website/../jui/src/Collections/ItemLayout.tsx","webpack://website/../jui/src/Collections/ItemStateContext.tsx","webpack://website/../jui/src/Collections/useCollectionAutoScroll.ts","webpack://website/../jui/src/Collections/useCollectionFocusProxy.ts","webpack://website/../jui/src/Dropdown/ComboBox.tsx","webpack://website/../jui/src/Dropdown/ListBox.tsx","webpack://website/../jui/src/Dropdown/StatelessListBox.tsx","webpack://website/../jui/src/Dropdown/StyledContainer.tsx","webpack://website/../jui/src/Dropdown/StyledDropdownArrowIcon.tsx","webpack://website/../jui/src/Field/ContextHelp.tsx","webpack://website/../jui/src/Field/Label.tsx","webpack://website/../jui/src/Icon/AutoHoverPlatformIcon.tsx","webpack://website/../jui/src/Icon/LafIcon.tsx","webpack://website/../jui/src/Icon/PlatformIcon.tsx","webpack://website/../jui/src/Icon/StyledIconWrapper.tsx","webpack://website/../jui/src/Icon/useSvgIcon.tsx","webpack://website/../jui/src/IconButton/IconButton.tsx","webpack://website/../jui/src/IconButtonWithMenu/IconButtonWithMenu.tsx","webpack://website/../jui/src/Img.tsx","webpack://website/../jui/src/InputField/Input.tsx","webpack://website/../jui/src/InputField/InputField.tsx","webpack://website/../jui/src/Link/StyledLink.tsx","webpack://website/../jui/src/Link/Link.tsx","webpack://website/../jui/src/List/List.tsx","webpack://website/../jui/src/List/ListContext.tsx","webpack://website/../jui/src/List/ListDivider.tsx","webpack://website/../jui/src/List/ListItem.tsx","webpack://website/../jui/src/List/StyledList.tsx","webpack://website/../jui/src/List/StyledListItem.tsx","webpack://website/../jui/src/List/useList.ts","webpack://website/../jui/src/List/useSelectableList.ts","webpack://website/../jui/src/List/useListState.ts","webpack://website/../jui/src/Collections/useCollectionRef.ts","webpack://website/../jui/src/List/StyledListSectionHeader.tsx","webpack://website/../jui/src/List/renderWrapper.tsx","webpack://website/../jui/src/List/useListVirtualizer.tsx","webpack://website/../jui/src/Menu/ContextMenuContainer.tsx","webpack://website/../jui/src/Menu/useContextMenu.tsx","webpack://website/../jui/src/Collections/patchCollectionProps.tsx","webpack://website/../jui/src/Menu/Menu.tsx","webpack://website/../jui/src/Menu/MenuItem.tsx","webpack://website/../jui/src/Menu/MenuItemLayout.tsx","webpack://website/../jui/src/Menu/MenuOverlay.tsx","webpack://website/../jui/src/Menu/useOverlayPositionFromOrigin.tsx","webpack://website/../jui/src/Menu/MenuOverlayFromOrigin.tsx","webpack://website/../jui/src/Menu/MenuTrigger.tsx","webpack://website/../jui/src/Menu/SpeedSearchMenu.tsx","webpack://website/../jui/src/Menu/StyledMenu.tsx","webpack://website/../jui/src/Menu/StyledMenuItem.tsx","webpack://website/../jui/src/Menu/Submenu.tsx","webpack://website/../jui/src/Menu/_useSubmenu.ts","webpack://website/../jui/src/Menu/_useSubmenuState.tsx","webpack://website/../jui/src/Menu/MenuSection.tsx","webpack://website/../jui/src/Menu/renderMenuNodes.tsx","webpack://website/../jui/src/Mnemonic/MnemonicTrigger.tsx","webpack://website/../jui/src/Overlay/UNSAFE_React17SuspenseFix.tsx","webpack://website/../jui/src/ModalWindow/ModalWindow.tsx","webpack://website/../jui/src/ModalWindow/WindowContext.ts","webpack://website/../jui/src/ModalWindow/WindowFooter.tsx","webpack://website/../jui/src/ModalWindow/WindowHeader.tsx","webpack://website/../jui/src/ModalWindow/WindowLayout.tsx","webpack://website/../jui/src/ModalWindow/WindowManager.tsx","webpack://website/../jui/src/Overlay/Overlay.tsx","webpack://website/../jui/src/Overlay/OverlayInteractionHandler.tsx","webpack://website/../jui/src/Overlay/OverlayMoveHandle.tsx","webpack://website/../jui/src/Overlay/OverlayResizeHandles.tsx","webpack://website/../jui/src/Overlay/Popover.tsx","webpack://website/../jui/src/Overlay/bounds-helpers.tsx","webpack://website/../jui/src/utils/useDebounce.ts","webpack://website/../jui/src/Overlay/useContentSize.tsx","webpack://website/../jui/src/Overlay/useResizableMovableOverlay.tsx","webpack://website/../jui/src/Popup/Popup.tsx","webpack://website/../jui/src/Popup/_useDialog.ts","webpack://website/../jui/src/utils/mergeNonNullProps.tsx","webpack://website/../jui/src/Popup/PopupContext.tsx","webpack://website/../jui/src/Popup/PopupHeader.tsx","webpack://website/../jui/src/Popup/PopupLayout.tsx","webpack://website/../jui/src/Popup/PopupManager.tsx","webpack://website/../jui/src/Popup/PopupTrigger.tsx","webpack://website/../jui/src/Popup/StyledPopupContainer.tsx","webpack://website/../jui/src/Popup/StyledPopupHint.tsx","webpack://website/../jui/src/ProgressBar/ProgressBar.tsx","webpack://website/../jui/src/ProgressBar/ProgressBarStopButton.tsx","webpack://website/../jui/src/ResizableView.tsx","webpack://website/../jui/src/Resizer/BottomResizer.tsx","webpack://website/../jui/src/Resizer/HorizontalResizer.tsx","webpack://website/../jui/src/Resizer/LeftResizer.tsx","webpack://website/../jui/src/Resizer/RightResizer.tsx","webpack://website/../jui/src/Resizer/TopResizer.tsx","webpack://website/../jui/src/Resizer/VerticalResizer.tsx","webpack://website/../jui/src/Resizer/useResizer.ts","webpack://website/../jui/src/SearchInput/SearchInput.tsx","webpack://website/../jui/src/SpeedSearch/SpeedSearchInput.tsx","webpack://website/../jui/src/SpeedSearch/SpeedSearchPopup.tsx","webpack://website/../jui/src/SpeedSearch/useGhostInput.tsx","webpack://website/../jui/src/SpeedSearch/useSpeedSearch.tsx","webpack://website/../jui/src/StatusBar/StatusBar.tsx","webpack://website/../jui/src/StatusBar/StatusBarWidget.tsx","webpack://website/../jui/src/StyledSeparator.tsx","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabContent.tsx","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTab.ts","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTabs.ts","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabs.tsx","webpack://website/../jui/src/Tabs/StyledDefaultTab.ts","webpack://website/../jui/src/Tabs/StyledDefaultTabs.ts","webpack://website/../jui/src/Tabs/TabCloseButton.tsx","webpack://website/../jui/src/Tabs/TabContentLayout.tsx","webpack://website/../jui/src/Tabs/TabItem.tsx","webpack://website/../jui/src/Tabs/TabTheme.ts","webpack://website/../jui/src/Tabs/StyledHorizontalOverflowShadows.tsx","webpack://website/../jui/src/Tabs/Tab.tsx","webpack://website/../jui/src/Tabs/Tabs.tsx","webpack://website/../jui/src/Tabs/useHasOverflow.tsx","webpack://website/../jui/src/Tabs/TabsOverflowMenu.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabContent.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTab.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTabs.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabs.tsx","webpack://website/../jui/src/TextRange.ts","webpack://website/../jui/src/TextWithHighlights/TextWithHighlights.tsx","webpack://website/../jui/src/Theme/parseColorString.ts","webpack://website/../jui/src/Theme/Color.ts","webpack://website/../jui/src/ThreeViewSplitter/ThreeViewSplitter.tsx","webpack://website/../jui/src/ToolWindows/FloatView.tsx","webpack://website/../jui/src/ToolWindows/FloatToolWindows.tsx","webpack://website/../jui/src/ToolWindows/MovableToolWindowStripeProvider.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowOuterLayout.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsLayoutState.ts","webpack://website/../jui/src/ToolWindows/createGetDropPosition.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripeButton.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/useElementMove.tsx","webpack://website/../jui/src/ToolWindows/findEffectiveBackgroundColor.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/UndockSide.tsx","webpack://website/../jui/src/ToolWindows/ToolWindows.tsx","webpack://website/../jui/src/ToolWindows/useOnFocusLost.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowStateProvider.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsState.ts","webpack://website/../jui/src/ToolWindows/utils.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowSettingsIconMenu.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowHeader.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowToolbarButton.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindows.tsx","webpack://website/../jui/src/ToolWindowsImpl/MultiViewToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowActionIds.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowActions.tsx","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowsActions.tsx","webpack://website/../jui/src/Toolbar/Toolbar.tsx","webpack://website/../jui/src/Tooltip/ActionHelpTooltip.tsx","webpack://website/../jui/src/Tooltip/ActionTooltip.tsx","webpack://website/../jui/src/Tooltip/HelpTooltip.tsx","webpack://website/../jui/src/Tooltip/PositionedTooltipTrigger.tsx","webpack://website/../jui/src/Tooltip/Tooltip.tsx","webpack://website/../jui/src/Tooltip/TooltipContext.tsx","webpack://website/../jui/src/Tooltip/TooltipPointer.tsx","webpack://website/../jui/src/utils/useMouseEventOverlayPosition.tsx","webpack://website/../jui/src/Tooltip/TooltipTrigger.tsx","webpack://website/../jui/src/Tooltip/TooltipTriggerAndOverlay.tsx","webpack://website/../jui/src/Tooltip/ValidationTooltip.tsx","webpack://website/../jui/src/Tooltip/tooltip-styles.ts","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTreeNode.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTree.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/useSpeedSearchTree.ts","webpack://website/../jui/src/Tree/StyledTree.tsx","webpack://website/../jui/src/Tree/TreeContext.tsx","webpack://website/../jui/src/Tree/TreeKeyboardDelegate.tsx","webpack://website/../jui/src/Tree/TreeNodeIcon.tsx","webpack://website/../jui/src/Tree/useTreeNodeToggleButton.tsx","webpack://website/../jui/src/Tree/StyledTreeNode.tsx","webpack://website/../jui/src/Tree/TreeNode.tsx","webpack://website/../jui/src/Tree/useTreeNode.tsx","webpack://website/../jui/src/Tree/useSelectableTree.tsx","webpack://website/../jui/src/Collections/useCollectionCacheInvalidation.ts","webpack://website/../jui/src/Tree/__copied__TreeCollection.ts","webpack://website/../jui/src/Tree/getSingleChildrenKeys.ts","webpack://website/../jui/src/Tree/TreeSelectionManager.ts","webpack://website/../jui/src/Tree/useTreeState.ts","webpack://website/../jui/src/Tree/useTreeRef.tsx","webpack://website/../jui/src/Tree/useTreeVirtualizer.tsx","webpack://website/../jui/src/TreeActions/useTreeActions.tsx","webpack://website/../jui/src/TreeCheckboxes/NestedSelection.ts","webpack://website/../jui/src/TreeCheckboxes/SpeedSearchTreeWithCheckboxes.tsx","webpack://website/../jui/src/TreeCheckboxes/TreeNodeCheckbox.tsx","webpack://website/../jui/src/TreeCheckboxes/useNestedSelectionState.ts","webpack://website/../jui/src/VariableWidthListLayout.tsx","webpack://website/../jui/src/utils/string-utils.ts","webpack://website/../jui/src/minusculeMatch.ts","webpack://website/../jui/src/selection/useSelectableCollection.ts","webpack://website/../jui/src/selection/useSelectableItem.tsx","webpack://website/../jui/src/style-constants.ts","webpack://website/../jui/src/utils/FocusScope.tsx","webpack://website/../jui/src/utils/array-utils.ts","webpack://website/../jui/src/utils/interaction-utils/textSelection.ts","webpack://website/../jui/src/utils/interaction-utils/useMove.tsx","webpack://website/../jui/src/utils/keyboard-utils.ts","webpack://website/../jui/src/utils/overflow-utils/OverflowObserver.ts","webpack://website/../jui/src/utils/overflow-utils/useOverflowObserver.tsx","webpack://website/../jui/src/utils/tree-utils.ts","webpack://website/../jui/src/utils/useContextOrThrow.tsx","webpack://website/../jui/src/utils/useEventCallback.ts","webpack://website/../jui/src/utils/useFocusForwarder.ts","webpack://website/../jui/src/utils/useForwardedRef.ts","webpack://website/../jui/src/utils/useLatest.ts","webpack://website/../jui/src/utils/usePrevious.ts","webpack://website/../jui/src/utils/immutableSet.ts","webpack://website/../jui/src/utils/useSet.ts","webpack://website/../../node_modules/monaco-editor/esm/vs/base/common/worker/ lazy ^.*$ namespace object","webpack://website/../../node_modules/monaco-editor/esm/vs/editor/common/services/ lazy ^.*$ namespace object"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { atom, type WritableAtom } from \"jotai\";\n\ntype Read<Value, Args extends unknown[], Result> = WritableAtom<\n  Value,\n  Args,\n  Result\n>[\"read\"];\ntype Write<Value, Args extends unknown[], Result> = WritableAtom<\n  Value,\n  Args,\n  Result\n>[\"write\"];\n\n/**\n * A mapping from atom values to their refreshable atom dependencies used to recursively refresh\n * upstream atoms when refreshing an atom.\n */\nconst refreshDepsMap = new WeakMap<{}, Set<WritableAtom<unknown, [], void>>>();\n/**\n * The set of refreshable atoms, used to recognize refreshable dependencies of each refreshable atom.\n */\nconst refreshableAtoms = new WeakSet();\n\n/**\n * Similar to {@link https://jotai.org/docs/utilities/resettable#atomwithrefresh atomWithRefresh}\n * but acting like recoil's selector refresh functionality.\n * In recoil refreshing a selector not only refreshes selectors that depend on it but also\n * all upstream dependencies (i.e., selectors used within the refreshed selector).\n *\n * @see https://github.com/facebookexperimental/Recoil/issues/1677\n */\nexport function atomWithRefresh<Value, Args extends unknown[], Result>(\n  read: Read<Value, Args, Result>,\n  write: Write<Value, Args, Result>\n): WritableAtom<Value, Args | [], Result | void>;\n\nexport function atomWithRefresh<Value>(\n  read: Read<Value, [], void>\n): WritableAtom<Value, [], void>;\n\nexport function atomWithRefresh<Value, Args extends unknown[], Result>(\n  read: Read<Value, Args, Result>,\n  write?: Write<Value, Args, Result>\n) {\n  const refreshAtom = atom(0);\n  const refreshableAtom = atom(\n    (get, options) => {\n      get(refreshAtom);\n      const deps = new Set<WritableAtom<unknown, [], void>>();\n\n      const value = read((...args) => {\n        const atom = args[0];\n        if (refreshableAtoms.has(atom)) {\n          deps.add(atom as WritableAtom<unknown, [], void>);\n        }\n        return get(...args);\n      }, options as never);\n      refreshDepsMap.set(value, deps);\n      return value;\n    },\n    (get, set, ...args: Args) => {\n      if (args.length === 0) {\n        const currentValue = get(refreshableAtom);\n        for (const dep of refreshDepsMap.get(currentValue) ?? []) {\n          set(dep); // refreshing refreshable dependencies first\n        }\n        set(refreshAtom, (c) => c + 1);\n      } else if (write) {\n        return write(get, set, ...args);\n      }\n    }\n  );\n  refreshableAtoms.add(refreshableAtom);\n  return refreshableAtom;\n}\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\nimport { BFSCallback } from \"browserfs/dist/node/core/file_system\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { fs } from \"./fs\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\n/**\n * Similar to `fs.mkdir(dirPath, {recursive: true})`. `recursive` is not supported in the\n * currently used fs implementations.\n */\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n\n/**\n * A wrapper around stat which doesn't throw if nothing exists at the input pathname.\n * It provides a more ergonomic signature for use cases where it's required to know if\n * a file or directory exists on the pathname, distinguishing the two cases.\n */\nexport const stat = (pathname: string) =>\n  fs.promises.stat(pathname).catch(() => null);\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (\n  persistentFsPreference.get() === \"yes\"\n    ? createIndexedDBFS()\n    : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC<{ children?: React.ReactNode }> = ({\n  children,\n}) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import { basename } from \"path\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\nimport { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, atomWithLazy } from \"jotai/utils\";\nimport { atomWithRefresh } from \"../atom-utils/atomWithRefresh\";\nimport { fs } from \"./fs\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  name: string;\n  path: string;\n  lastModification: number;\n  size: number;\n}\n\nconst getDirContent = async (path: string): Promise<null | FsItem[]> => {\n  let fileNames: string[];\n  try {\n    fileNames = await fs.promises.readdir(path);\n  } catch (e) {\n    return null;\n  }\n  const stats = await Promise.all(\n    fileNames.map((fileName) => {\n      const filePath = `${path}/${fileName}`;\n      return fs.promises.stat(filePath).then((stat: Stats) => ({\n        ...stat,\n        type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n        filePath,\n      }));\n    })\n  );\n  return stats.map((stat) => ({\n    type: stat.type,\n    name: basename(stat.filePath),\n    path: stat.filePath,\n    lastModification: stat.mtimeMs,\n    size: stat.size,\n  }));\n};\n\n/**\n * List files and directories in a given directory.\n */\nexport const dirContentAtom = atomFamily((path: string) => {\n  const atom = atomWithRefresh(() => {\n    return getDirContent(path);\n  });\n  atom.debugLabel = `DirContent(${path})`;\n  return atom;\n});\n\n/**\n * atom callback to refresh the file content atom value of a give path.\n * The callback returns `true` the file exists, and content is refreshed successfully, and `false otherwise.\n * @deprecated use set(fileContent(path)) directly\n */\nexport const reloadFileFromDiskCallback =\n  (_get: Getter, set: Setter) => async (path: string) => {\n    await set(fileContentAtom(path));\n  };\n\n/**\n * **Note**: currently, only text files are supported, for simplicity.\n **/\nexport const fileContentAtom = atomFamily((filepath: string | null) => {\n  const readFile = async (): Promise<string | null> => {\n    if (!filepath) {\n      return \"\";\n    }\n    const exists = await fs.promises.exists(filepath);\n    if (!exists) {\n      return null;\n    }\n    // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n    return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n  };\n  const fileContentAtom = atomWithLazy(readFile);\n  return atom(\n    async (get): Promise<string | null> => get(fileContentAtom),\n    async (_get, set, ...args: [string | undefined | null] | []) => {\n      const content = args[0] ?? \"\";\n      if (args.length === 0) {\n        // refresh\n        return set(fileContentAtom, readFile());\n      }\n      set(fileContentAtom, Promise.resolve(content));\n      // TODO: check if the file content was changed externally,\n      //  keep track of it in a state\n      //  (so a dialog can be shown to confirm actions such as \"Overwrite\" or \"Reload from disk\"\n      //  and add an `overwrite` argument here to be used when overwrite is used.\n      if (filepath) {\n        // this could also be an effect on fileContentAtom, avoiding this write function (and the wrapper atom),\n        // but:\n        // A: something similar to Recoil's onSet() didn't seem straightforward with jotai-effect\n        // B: we want to support refreshing when content is not passed (similar to how atomWithRefresh works)\n        await fs.promises\n          .writeFile(filepath, content ?? \"\", \"utf8\")\n          .catch((e: unknown) => {\n            // TODO: what to do if writing file fails? undo setting atom content?\n            console.error(\"failed to sync the file back to the fs\", e);\n          });\n      }\n    }\n  );\n});\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"Git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","import { DOMAttributes, FocusEvent, useEffect, useRef } from \"react\";\nimport { PrimitiveAtom } from \"jotai\";\nimport { equals } from \"ramda\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\n\nimport { useStableSetAtom } from \"./useStableSetAtom\";\n\nexport const createFocusBasedSetterHook = <T extends unknown, N extends T = T>(\n  atom: PrimitiveAtom<T>,\n  nullValue: N\n) => {\n  let focusedElement: Element | null = null;\n  return (value: T, name: string = \"unknown\") => {\n    const setValue = useStableSetAtom(atom);\n    const elementRef = useRef<Element>();\n    useEffect(() => {\n      if (focusedElement === elementRef.current) {\n        setValue((currentValue) => {\n          return equals(value, currentValue) ? currentValue : value;\n        });\n      }\n    }, [value]);\n    return useFocusWithin({\n      onFocusWithin: (e: FocusEvent) => {\n        elementRef.current = e.currentTarget;\n        focusedElement = e.currentTarget;\n        setValue(value);\n      },\n      onBlurWithin: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container], [role=menu]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n      },\n    }).focusWithinProps as Pick<DOMAttributes<Element>, \"onFocus\" | \"onBlur\">;\n  };\n};\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { createRef, MutableRefObject } from \"react\";\nimport {\n  AlertDialogApi,\n  PopupManagerAPI,\n  WindowManagerAPI,\n} from \"@intellij-platform/core\";\n\nimport { dirContentAtom, FsItem } from \"../fs/fs.state\";\nimport { createFocusBasedSetterHook } from \"../atom-utils/focus-based-atom-utils\";\nimport { filterPath } from \"./project-utils\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const autoClonedRepo = {\n  path: \"/workspace/jui\",\n  url: \"https://github.com/alirezamirian/jui.git\",\n};\n\nexport const defaultProject = {\n  name: \"Workspace\",\n  path: \"/workspace\",\n};\nexport const currentProjectAtom = atom<Project>(defaultProject);\n\nexport const projectFilePath = atomFamily((projectRelativePath: string) =>\n  atom((get) => path.join(get(currentProjectAtom).path, projectRelativePath))\n);\n\nexport const currentProjectFilesAtom = atom(\n  async (get): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectAtom);\n    return get(projectFilesAtom(project.path));\n  }\n);\n\nconst projectFilesAtom = atomFamily(\n  (\n    projectPath: string /* could be changed to project id, when project entity is more mature */\n  ) =>\n    atom(async (get): Promise<ProjectFsItem[]> => {\n      const items = await get(dirContentAtom(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = async (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = await get(dirContentAtom(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      await Promise.all((items || []).map((item) => addItem(item)));\n      return files;\n    })\n);\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsAtom = atom<string[]>([]);\n\nexport const activePathExistsAtom = atom(\n  (get) => get(activePathsAtom).length > 0\n);\n\n/**\n * Sets the value of {@link activePathsAtom} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsAtom,\n  []\n);\n\n/**\n * Ref to the popup manager of the current project.\n * TODO(multi-project): either:\n *  - introduce project-level store provider, to keep such states per project.\n *  - maybe better, add a feature to the action system, where ActionProvider can define additional contextual properties\n *    to be made available in `context` when calling `actionPerformed` method. The biggest challenge for a nice\n *    implementation of such feature is static type safety.\n */\nexport const projectPopupManagerRefAtom = atom<\n  MutableRefObject<PopupManagerAPI | null>\n>(createRef<PopupManagerAPI | null>());\n\nexport const windowManagerRefAtom = atom<\n  MutableRefObject<WindowManagerAPI | null>\n>(createRef<WindowManagerAPI | null>());\n\nexport const alertDialogRefAtom = atom<MutableRefObject<AlertDialogApi | null>>(\n  createRef<AlertDialogApi | null>()\n);\n","import { PrimitiveAtom, useSetAtom, useStore } from \"jotai\";\nimport { useCallback } from \"react\";\n\ntype Options = Parameters<typeof useStore>[0];\ntype SetAtom<Args extends unknown[], Result> = (...args: Args) => Result;\n\n/**\n * unlike recoil, and unlike React state setter, jotai's state setter returned from\n * useSetAtom always causes a rerender even if the current value is returned\n * from the updater function passed to the setter.\n * That can cause infinite rerender.\n * useStableSetAtom is a drop-in replacement for useSetAtom for primitive atoms,\n * which doesn't set state if the new value is the same as the old value.\n */\nexport function useStableSetAtom<T>(\n  atom: PrimitiveAtom<T>,\n  options?: Options\n): SetAtom<[T | ((currentValue: T) => T)], void> {\n  const store = useStore(options);\n  const setAtom = useSetAtom<PrimitiveAtom<T>>(atom);\n\n  return useCallback(\n    (value) => {\n      const currentValue = store.get(atom);\n      const newValue =\n        typeof value === \"function\"\n          ? (value as (currentValue: T) => T)(currentValue) // why is casting needed?\n          : value;\n      if (newValue !== currentValue) {\n        setAtom(newValue);\n      }\n      return newValue;\n    },\n    [useSetAtom, store]\n  );\n}\n","import { atom, SetStateAction, WritableAtom } from \"jotai\";\nimport { atomEffect } from \"jotai-effect\";\nimport { atomFamily } from \"jotai/utils\";\nimport {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { identity } from \"ramda\";\nimport { z, ZodType } from \"zod\";\nimport { fs } from \"../fs/fs\";\nimport { currentProjectAtom } from \"../Project/project.state\";\nimport { fileContentAtom } from \"../fs/fs.state\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nconst storagePaths = atomFamily((storageFile: string) =>\n  atom((get) => {\n    const storageFileDir = path.join(get(currentProjectAtom).path, \".idea\");\n\n    return path.join(\n      storageFileDir,\n      storageFileMapping[storageFile] || storageFile\n    );\n  })\n);\n\nconst PERSISTENCE_WRITE_TIMEOUT = 1000;\n\nconst persistentStateStoreAtoms = atomFamily((storageFile: string) => {\n  const cacheAtom = atom<PersistedState | null>(null);\n  const storageContentAtom = atom((get) =>\n    readStorageFile(get(storagePaths(storageFile)))\n  );\n  let fsWriteTimer: ReturnType<(typeof window)[\"setTimeout\"]> | null = null;\n  return atom(\n    (get): Promise<PersistedState> | PersistedState =>\n      get(cacheAtom) ?? get(storageContentAtom),\n    async (get, set, update: (state: PersistedState) => PersistedState) => {\n      const storageFilepath = get(storagePaths(storageFile));\n      const state: PersistedState =\n        get(cacheAtom) ?? (await get(storageContentAtom));\n      set(cacheAtom, (currentState) => update(currentState ?? state));\n\n      // basic throttling\n      if (fsWriteTimer !== null) {\n        clearTimeout(fsWriteTimer);\n      }\n      fsWriteTimer = setTimeout(() => {\n        set(fileContentAtom(storageFilepath), serializeState(get(cacheAtom)!));\n      }, PERSISTENCE_WRITE_TIMEOUT);\n    }\n  );\n});\n\ntype PersistedStateAtom<Value> = WritableAtom<\n  Promise<Value | undefined>,\n  [{ type: \"update\"; value: Value }],\n  Promise<void>\n>;\n\ntype WithOptionalArrays<T> = T extends {}\n  ? {\n      [K in keyof T]: T[K] extends Array<infer Item>\n        ? WithOptionalArrays<T[K]> | WithOptionalArrays<Item>\n        : WithOptionalArrays<T[K]>;\n    }\n  : T extends Array<infer I>\n  ? T | I\n  : T;\n\nfunction createPersistedStateAtom<\n  Schema extends ZodType<any, any, WithOptionalArrays<any>>,\n  Value extends object\n>({\n  storageFile = StorageFiles.WORKSPACE_FILE,\n  componentName,\n  schema,\n  ...args\n}: {\n  componentName: string;\n  schema: Schema extends ZodType<infer Output, any, infer Input>\n    ? WithOptionalArrays<Output> extends Input\n      ? Schema\n      : `⚠️⚠️ If you see this error, it means the schema produces an array somewhere but doesn't expect singular value in the input. Look for usages of z.array() and replace them with maybeArray() utility ⚠️⚠️`\n    : never;\n  storageFile?: string;\n} & (\n  | {}\n  | {\n      read: (\n        componentState: Schema[\"_output\"] | undefined\n      ) => Value | Promise<Value> | undefined;\n      write: (\n        value: Value,\n        componentState: Schema[\"_output\"]\n      ) => Schema[\"_output\"];\n    }\n)): PersistedStateAtom<Value> {\n  const write = \"write\" in args ? args.write : (v: Value) => v;\n  const read = \"read\" in args ? args.read : identity;\n\n  return atom(\n    async (get): Promise<Value | undefined> => {\n      const state = await get(persistentStateStoreAtoms(storageFile));\n      const componentState = state?.project.component.find(\n        (component): component is Schema[\"_output\"] & ComponentState =>\n          component[\"@name\"] === componentName\n      );\n      const output = schema.safeParse(componentState);\n      if (output.error) {\n        console.error(\n          `Error parsing persisted state for component ${componentName} in file ${storageFile}:`,\n          output.error\n        );\n      }\n      return (await read(output.data)) ?? undefined;\n    },\n    async (get, set, action: { type: \"update\"; value: Value }) => {\n      if (action.type === \"update\") {\n        return set(persistentStateStoreAtoms(storageFile), (state) => {\n          const { value } = action;\n          const components = [...state.project.component];\n          const index = components.findIndex(\n            (component) => component[\"@name\"] === componentName\n          );\n          components.splice(index, index >= 0 ? 1 : 0, {\n            \"@name\": componentName,\n            ...write(value as Value, components[index]),\n          });\n          return {\n            ...state,\n            project: {\n              ...state.project,\n              component: components,\n            },\n          };\n        });\n      }\n    }\n  );\n}\n\nexport function atomWithPersistence<\n  Schema extends ZodType<any, any, WithOptionalArrays<any>>,\n  Value extends object\n>(\n  initialValue: Value,\n  config: Parameters<typeof createPersistedStateAtom<Schema, Value>>[0]\n) {\n  const baseAtom = atom<Value>(initialValue);\n\n  const persistenceAtom = createPersistedStateAtom<Schema, Value>(config);\n  const syncEffect = atomEffect((get, set) => {\n    get.peek(persistenceAtom).then((persistedValue) => {\n      if (persistedValue !== undefined) {\n        set(baseAtom, persistedValue);\n      }\n    });\n  });\n  return atom<Value, [SetStateAction<Value>], Promise<void>>(\n    (get) => {\n      get(syncEffect);\n      return get(baseAtom);\n    },\n    async (get, set, action: SetStateAction<Value>) => {\n      const newValue =\n        typeof action === \"function\"\n          ? (action as (currentValue: Value) => Value)(await get(baseAtom))\n          : action;\n      set(baseAtom, newValue);\n      await set(persistenceAtom, { type: \"update\", value: newValue });\n    }\n  );\n}\n\n// TODO: make a test suite for persistent atoms using the examples like the ones below\n//  to cover:\n//  - read/write working as expected\n//  - Atoms rendering expectations.\n//    updating state of a component should not rerender the other persisted in the same file\n//  - ideally the expected type errors in read/write and type arguments\nexport const testAtom = atomWithPersistence(\n  { x: 2 },\n  {\n    componentName: \"test\",\n    storageFile: \"test.xml\",\n    schema: z.object({ whatever: z.number() }).optional(),\n    read: (s) => ({ x: s?.whatever ?? 2 }),\n    write: (v, s) => ({ ...s, whatever: v.x }),\n  }\n);\n\nexport const testAtom2 = atomWithPersistence(\n  { y: 3 },\n  {\n    componentName: \"test2\",\n    storageFile: \"test.xml\",\n    schema: z.object({ y: z.number() }).optional(),\n  }\n);\n\nexport type ComponentState = { \"@name\": string };\nexport type PersistedState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nconst EMPTY_STORAGE_STATE = {\n  \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n  project: { \"@version\": \"4\", component: [] as ComponentState[] },\n} as const;\n\nexport async function readStorageFile(\n  storageFile: string\n): Promise<PersistedState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const storageFileExists = await fs.promises.exists(storageFile);\n  if (!storageFileExists) {\n    return EMPTY_STORAGE_STATE;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = Object.assign(\n    { ...EMPTY_STORAGE_STATE },\n    xmlParser.parse(xmlData)\n  );\n  workspace.project.component = workspace.project.component ?? [];\n  return workspace;\n}\n\nfunction serializeState(state: PersistedState): string {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n  return xmlBuilder.build(state);\n}\n\nexport const storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n","import { z, ZodEnum, ZodString, ZodType } from \"zod\";\n\nexport const maybeArray = <T extends ZodType>(type: T) =>\n  z\n    .union([type, type.array()])\n    .transform((value): T[\"_output\"][] =>\n      Array.isArray(value) ? value : [value]\n    );\n\n/**\n * schema for map objects persisted in intellij IDE setting files.\n */\nexport const map = <K extends ZodString | ZodEnum<any>, V extends ZodType>(\n  keyAttribute: K,\n  value: V\n) =>\n  z.object({\n    entry: maybeArray(\n      z.object({\n        \"@type\": keyAttribute,\n        value,\n      })\n    ),\n  });\n\n/**\n * schema for list objects persisted in intellij IDE setting files.\n */\nexport const list = <T extends ZodType, K extends string>(\n  item: T,\n  itemTagName: K\n) => {\n  const itemSchema = maybeArray(item);\n  return z.object({\n    [itemTagName]: itemSchema,\n  } as { [KK in K]: typeof itemSchema });\n};\n","import { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, useAtomCallback } from \"jotai/utils\";\nimport { withAtomEffect } from \"jotai-effect\";\nimport git, { findRoot, statusMatrix } from \"isomorphic-git\";\nimport { z } from \"zod\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport * as path from \"path\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { atomWithRefresh } from \"../atom-utils/atomWithRefresh\";\nimport { atomWithPersistence } from \"../persistence/atomWithPersistence\";\nimport { maybeArray } from \"../persistence/schema-utils\";\n\n/**\n * git.status function has an issue with newly added files. it returns \"*added\" for both of these cases:\n * - file is untracked, not yet staged (as the documentation says)\n * - file is staged, but modified in working directory (AM)\n * Here is where it seems to have wrong logic:\n * https://github.com/isomorphic-git/isomorphic-git/blob/d631f8e56a5504b10ffc1b35589b1a5b0b2f9e74/src/api/status.js#L135\n\n */\nconst status = async ({\n  filepath,\n  ...args\n}: Parameters<(typeof git)[\"status\"]>[0]) => {\n  return git\n    .statusMatrix({ ...args, filepaths: [filepath] })\n    .then((rows) => rows[0]);\n};\n\nconst TMP_findGitRoots = () =>\n  Promise.all(\n    [\"/workspace/jui\", \"/workspace\"].map(async (dir) => {\n      const exists = await fs.promises.exists(dir);\n      if (exists) {\n        return git.findRoot({ fs, filepath: dir }).catch(() => null);\n      }\n    })\n  ).then((roots) => {\n    return [...new Set(roots.filter(notNull))].map<VcsDirectoryMapping>(\n      (dir) => ({\n        dir,\n        vcs: \"Git\",\n      })\n    );\n  });\n\nconst vcsDirectoryMappingsSchema = z\n  .object({\n    mapping: maybeArray(\n      z.object({\n        \"@directory\": z.string(),\n        \"@vcs\": z.enum([\"Git\"]),\n      })\n    ).optional(),\n  })\n  .optional();\ntype VcsDirectoryMappingStorage =\n  (typeof vcsDirectoryMappingsSchema)[\"_output\"];\n\nexport const vcsRootsAtom = atomWithPersistence(\n  [] as ReadonlyArray<VcsDirectoryMapping>,\n  {\n    componentName: \"VcsDirectoryMappings\",\n    schema: vcsDirectoryMappingsSchema,\n    storageFile: \"vcs.xml\",\n    read: (state) => {\n      // TODO: translate project dir to $PROJECT_DIR$\n      return (\n        state?.mapping?.map((item) => ({\n          dir: item[\"@directory\"],\n          vcs: item[\"@vcs\"],\n        })) ?? TMP_findGitRoots()\n      );\n    },\n    write: (value, state): VcsDirectoryMappingStorage => ({\n      ...(state || {}),\n      mapping:\n        value?.map(({ vcs, dir }) => ({\n          \"@directory\": dir,\n          \"@vcs\": vcs,\n        })) ?? [],\n    }),\n  }\n);\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsFootForFileAtom = atomFamily((filepath: string) =>\n  atom(() => {\n    // FIXME: use vcsRoots.\n    // return get(vcsRootsState).find(\n    //   (root) => root.vcs === \"Git\" && isParentPath(root.dir, filepath)\n    // )?.dir ?? null;\n    // function isParentPath(parent: string, dir: string) {\n    //   const relative = path.relative(parent, dir);\n    //   return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n    // }\n    return findRoot({ fs, filepath }).catch(() => null);\n  })\n);\n\ntype RepoStatus = {\n  [relativeFilePath: string]: FileStatus;\n};\n\nconst fetchRepoStatusFromFs = async (repoDir: string) => {\n  console.time(`statusMatrix ${repoDir}`);\n  const rows = await statusMatrix({ fs, dir: repoDir });\n  console.timeEnd(`statusMatrix ${repoDir}`);\n  const result: RepoStatus = {};\n  rows.forEach((row) => {\n    result[row[0]] = convertGitStatus(row);\n  });\n  return result;\n};\n\n/**\n * A mapping from relative file paths to file status, calculated efficiently for all files in a repo.\n * It's a writable sync atom to allow updating it for a single file when the status of a file is changed.\n * It could have been an async atom wrapped by {@link unwrapLatestWithLoading}, which would simplify\n * keeping the loading state per repo while the latest sync value is always available, but note that\n * we want it to be writable as well, since in many scenarios a single file changes and the repo\n * status can be patched with that single change, instead of being fully recalculated.\n */\nexport const repoStatusAtoms = atomFamily((repoDir: string) => {\n  const targetAtom = atom<RepoStatus>({});\n  return withAtomEffect(targetAtom, (_get, set) => {\n    fetchRepoStatusFromFs(repoDir).then((repoStatus) => {\n      set(targetAtom, repoStatus);\n    });\n  });\n});\n\nexport const isRepoStatusUpdatingAtom = atomFamily((_repoRoot: string) =>\n  atom(false)\n);\n\nexport const isAnyRepoStatusUpdatingAtom = atom<boolean>((get) =>\n  get(vcsRootsAtom).some(({ dir }) => get(isRepoStatusUpdatingAtom(dir)))\n);\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n * NOTE: Do **not** refresh `fileStatusAtom`s directly to update file status, as it may update status for\n * the entire repo (if {@link repoStatusAtoms} is not yet written into), which is not very efficient.\n * use {@link useRefreshFileStatus} or {@link refreshFileStatusCallback} to efficiently refresh\n * the status of a single file.\n */\nexport const fileStatusAtoms = atomFamily((filepath: string) =>\n  atomWithRefresh(async (get): Promise<FileStatus> => {\n    const repoRoot = await get(vcsFootForFileAtom(filepath));\n    if (repoRoot) {\n      const relativePath = path.relative(repoRoot, filepath);\n      const repoStatus = get(repoStatusAtoms(repoRoot));\n      if (!repoStatus[relativePath]) {\n        console.log(\n          \"file status missing in repo status state, fetching individually\",\n          filepath\n        );\n      }\n      return (\n        repoStatus[relativePath] ??\n        // TODO(jotai): files that are initially shown in project view all hit this individual status checking code\n        //  It gets pretty slow when multiple calls to status are made simultaneously.\n        //  the entire file status state could use some refactoring to improve such cases.\n        convertGitStatus(\n          await status({\n            fs,\n            dir: repoRoot,\n            filepath: relativePath,\n          })\n        )\n      );\n    }\n    return \"NOT_CHANGED\";\n  })\n);\n\n/**\n * Adds a file or directory to git index\n */\nexport const refreshFileStatusCallback = async (\n  get: Getter,\n  set: Setter,\n  fullPath: string\n) => {\n  const repoRoot = await get(vcsFootForFileAtom(fullPath));\n  if (repoRoot) {\n    const relativePath = path.relative(repoRoot, fullPath);\n    const rows = await git.statusMatrix({\n      fs,\n      dir: repoRoot,\n      filepaths: [relativePath],\n    });\n    set(repoStatusAtoms(repoRoot), (statusMap) => {\n      const newStatusMap = {\n        ...statusMap,\n      };\n      if (rows.length === 0) {\n        // if file is removed and doesn't exist in HEAD, it will not appear on the status matrix\n        delete newStatusMap[relativePath];\n      }\n      rows.forEach((row) => {\n        newStatusMap[row[0]] = convertGitStatus(row);\n      });\n      return newStatusMap;\n    });\n  }\n};\n\nexport const useRefreshFileStatus = (): ((\n  absoluteFilepath: string\n) => Promise<void>) => useAtomCallback(refreshFileStatusCallback);\n\nexport const refreshRepoStatusesCallback = async (get: Getter, set: Setter) => {\n  get(vcsRootsAtom)?.forEach(({ dir }) => {\n    set(isRepoStatusUpdatingAtom(dir), true);\n    fetchRepoStatusFromFs(dir)\n      .then((repoStatus) => {\n        console.log(\"setting repo status for git dirs:\", dir, repoStatus);\n        set(repoStatusAtoms(dir), repoStatus);\n      })\n      .finally(() => {\n        set(isRepoStatusUpdatingAtom(dir), false);\n      });\n  });\n};\nexport const useRefreshRepoStatuses = () =>\n  useAtomCallback(refreshRepoStatusesCallback);\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { fileStatusAtoms } from \"./file-status.state\";\nimport { FileStatus } from \"./file-status\";\nimport { unwrap } from \"jotai/utils\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const fileStatus = useAtomValue(unwrap(fileStatusAtoms(filepath)));\n  return useStatusColor(fileStatus ?? \"NOT_CHANGED\");\n};\n\nexport const FileStatusColor: React.FC<{\n  filepath: string;\n  children?: React.ReactNode;\n}> = ({ children, filepath }) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{\n  status: FileStatus;\n  children?: React.ReactNode;\n}> = ({ children, status }) => {\n  const theme = useTheme() as Theme;\n  const color = theme.currentForegroundAware(useStatusColor(status));\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n * FIXME(multi-project): this should be scoped to project\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\n\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import React from \"react\";\nimport {\n  CommonActionId,\n  styled,\n  useAction,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nconst StyledContainer = styled.div.attrs({ tabIndex: -1 })`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n  justify-content: center;\n  padding: 0 25%;\n  font-size: 1rem;\n  outline: none;\n`;\n\nconst StyledLine = styled.div`\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n`;\n\nconst StyledShortcut = styled.div`\n  color: ${({ theme }) => theme.commonColors.linkForegroundEnabled};\n`;\n\nexport function EditorZeroState() {\n  return (\n    <StyledContainer>\n      <ActionTip actionId={CommonActionId.GO_TO_FILE} />\n      <ActionTip actionId={CommonActionId.GO_TO_ACTION} />\n    </StyledContainer>\n  );\n}\n\nfunction ActionTip({ actionId }: { actionId: string }) {\n  const getShortcut = useGetActionShortcut();\n  const action = useAction(actionId);\n  return (\n    <StyledLine>\n      {action?.title}\n      <StyledShortcut>{getShortcut(actionId)}</StyledShortcut>\n    </StyledLine>\n  );\n}\n","export const AppActionIds = {\n  PASTE_MULTIPLE: \"PasteMultiple\",\n  GENERATE: \"Generate\",\n};\n","export const editorActionIds = {\n  EXPAND_REGION: \"ExpandRegion\",\n  EXPAND_REGION_RECURSIVELY: \"ExpandRegionRecursively\",\n  EXPAND_ALL_REGIONS: \"ExpandAllRegions\",\n  EXPAND_ALL_TO_LEVEL: \"ExpandToLevel\",\n  EXPAND_ALL_TO_LEVEL1: \"ExpandToLevel1\",\n  EXPAND_ALL_TO_LEVEL2: \"ExpandToLevel2\",\n  EXPAND_ALL_TO_LEVEL3: \"ExpandToLevel3\",\n  EXPAND_ALL_TO_LEVEL4: \"ExpandToLevel4\",\n  EXPAND_ALL_TO_LEVEL5: \"ExpandToLevel5\",\n  COLLAPSE_REGION: \"CollapseRegion\",\n  COLLAPSE_REGION_RECURSIVELY: \"CollapseRegionRecursively\",\n  COLLAPSE_ALL_REGIONS: \"CollapseAllRegions\",\n  COLLAPSE_DOC_COMMENTS: \"CollapseDocComments\",\n  TOGGLE_FOLDING: \"ToggleFolding\",\n  EDITOR_LANG_POPUP_MENU: \"EditorLangPopupMenu\",\n  CompareClipboardWithSelection: \"CompareClipboardWithSelection\",\n};\n","import React, { MutableRefObject } from \"react\";\nimport copyToClipboard from \"clipboard-copy\";\nimport { editor } from \"monaco-editor\";\nimport {\n  ActionContext,\n  ActionGroupDefinition,\n  CommonActionId,\n  PlatformIcon,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { AppActionIds } from \"../appActionIds\";\nimport { editorActionIds } from \"./editorActionIds\";\n\nexport function useEditorActionGroup(\n  editorRef: MutableRefObject<editor.ICodeEditor | undefined>\n): ActionGroupDefinition {\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const editor = editorRef.current;\n  const selection = editor?.getSelection();\n\n  const selectedText = selection // FIXME: needs to become reactive\n    ? editor?.getModel()?.getValueInRange(selection)\n    : \"\";\n\n  return createDefaultActionGroup({\n    id: \"EditorPopupMenu\",\n    title: \"Editor Popup Menu\",\n    description: \"Editor Popup Menu\",\n    children: (\n      [\n        createDefaultActionGroup({\n          id: \"ShowIntentionsGroup\",\n          title: \"Show Intentions Group\",\n          isSearchable: false,\n          menuPresentation: \"section\",\n          children: [\n            {\n              id: \"ShowIntentionActions\",\n              title: \"Show Context Actions\",\n              icon: <PlatformIcon icon=\"actions/intentionBulbGrey.svg\" />,\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        selectedText\n          ? {\n              id: CommonActionId.COPY,\n              title: \"Copy\",\n              icon: <PlatformIcon icon=\"actions/copy\" />,\n              actionPerformed: () => {\n                const selection = editor?.getSelection();\n                const selectedText = selection\n                  ? editor?.getModel()?.getValueInRange(selection)\n                  : \"\";\n                if (selectedText) {\n                  copyToClipboard(selectedText);\n                }\n              },\n            }\n          : null,\n        {\n          id: CommonActionId.PASTE,\n          title: \"Paste\",\n          icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n          actionPerformed: () => {\n            // Note: There doesn't seem to be a way to trigger the default paste action\n            // (without prompting for clipboard API), from a menu UI.\n            // So, selecting \"Paste\" menu item will ask for clipboard permission, and\n            // that's the same in the default Monaco context menu as well.\n            // The difference here is that pasting with ctrl+V works without permission\n            // by default, but because we are handling ctrl+V through the keymap,\n            // even pasting by the shortcut will require permission now.\n            editor?.focus();\n            editor?.trigger(\n              \"keyboard\",\n              \"editor.action.clipboardPasteAction\",\n              {}\n            );\n          },\n        },\n        createDefaultActionGroup({\n          id: \"Copy.Paste.Special\",\n          title: \"Copy / Paste Special\",\n          description: \"Copy / Paste Special Editor Actions\",\n          menuPresentation: \"submenu\",\n          children: [\n            {\n              id: CommonActionId.COPY_REFERENCE,\n              title: \"Copy Reference\",\n              description:\n                \"Copy reference to selected class, method or function, or a relative path to selected file\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n            {\n              // TODO: this action should be scoped to the entire app.\n              //  move it when referencing actions in groups is possible\n              id: AppActionIds.PASTE_MULTIPLE,\n              title: \"Paste from history\",\n              description: \"Paste from recent clipboards\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        \"divider\",\n        createDefaultActionGroup({\n          id: \"FoldingGroup\",\n          title: \"Folding\",\n          menuPresentation: \"submenu\",\n          children: [\n            {\n              id: editorActionIds.EXPAND_REGION,\n              title: \"Expand\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfold\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.EXPAND_REGION_RECURSIVELY,\n              title: \"Expand Recursively\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfoldRecursively\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.EXPAND_ALL_REGIONS,\n              title: \"Expand All\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfoldAll\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            {\n              id: editorActionIds.COLLAPSE_REGION,\n              title: \"Collapse\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(source(context), \"editor.fold\", {});\n              },\n            },\n            {\n              id: editorActionIds.COLLAPSE_REGION_RECURSIVELY,\n              title: \"Collapse Recursively\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldRecursively\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.COLLAPSE_ALL_REGIONS,\n              title: \"Collapse All\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldAll\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            createDefaultActionGroup({\n              id: editorActionIds.EXPAND_ALL_TO_LEVEL,\n              title: \"Expand all to level\",\n              menuPresentation: \"submenu\",\n              children: ([1, 2, 3, 4, 5] as const).map((level) => ({\n                id: editorActionIds[`EXPAND_ALL_TO_LEVEL${level}`],\n                title: `${level}`,\n                actionPerformed: (context) => {\n                  editorRef.current?.trigger(\n                    source(context),\n                    `editor.foldLevel${level}`,\n                    {}\n                  );\n                },\n              })),\n            }),\n            \"divider\",\n            {\n              id: editorActionIds.COLLAPSE_DOC_COMMENTS,\n              title: \"Collapse Doc Comments\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldAllBlockComments\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            {\n              id: editorActionIds.TOGGLE_FOLDING,\n              title: \"Toggle Folding\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.toggleFold\",\n                  {}\n                );\n              },\n            },\n          ],\n        }),\n        createDefaultActionGroup({\n          id: \"EditorLangPopupMenu\",\n          title: \"EditorLangPopupMenu\",\n          menuPresentation: \"section\",\n          children: [\n            {\n              id: AppActionIds.GENERATE,\n              title: \"Generate...\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        \"divider\",\n        {\n          id: editorActionIds.CompareClipboardWithSelection,\n          title: \"Compare with Clipboard\",\n          description: \"Compare current selection with clipboard\",\n          icon: <PlatformIcon icon=\"actions/diffWithClipboard.svg\" />,\n          actionPerformed: () => {\n            notImplemented();\n          },\n        },\n      ] as const\n    ).filter(notNull),\n  });\n}\n\nfunction source(context: ActionContext): \"keyboard\" | \"mouse\" | \"\" {\n  if (!context.event) {\n    return \"\";\n  }\n  return context.event?.type?.includes(\"key\") ? \"keyboard\" : \"mouse\";\n}\n","import { atom, Getter, Setter } from \"jotai\";\n\ntype GetCallback = <Args extends unknown[], Result>(\n  callback: (get: Getter, set: Setter, ...args: Args) => Result\n) => (...args: Args) => Result;\ntype ReadWithGetCallback<Value, SetSelf = never> = (\n  get: Getter,\n  options: {\n    readonly signal: AbortSignal;\n    readonly setSelf: SetSelf;\n    readonly getCallback: GetCallback;\n  }\n) => Value;\n\nconst getCallbackAtom = atom<GetCallback, [], { get: Getter; set: Setter }>(\n  (_get, { setSelf }) => {\n    return (callback) => {\n      return (...args) => {\n        const { get, set } = setSelf();\n        return callback(get, set, ...args);\n      };\n    };\n  },\n  (get, set) => ({ get, set })\n);\n\nexport const atomWithGetCallback = <Value>(\n  read: ReadWithGetCallback<Value>\n) => {\n  return atom((get, options) => {\n    const getCallback = get(getCallbackAtom);\n    return read(\n      get,\n      Object.assign(options, {\n        getCallback,\n      }) /* spreading over options calls getter for setSelf and signal, so we fall back to mutating the passed option */\n    );\n  });\n};\n","import { atom, Getter, Setter, useAtomValue } from \"jotai\";\nimport { withAtomEffect } from \"jotai-effect\";\nimport { descend, sortWith } from \"ramda\";\nimport { Position } from \"monaco-editor\";\n\nimport {\n  currentProjectFilesAtom,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Focusable } from \"../common-types\";\nimport { atomWithGetCallback } from \"../atom-utils/atomWithGetCallback\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// it should become something under \"project\" state later.\nexport const editorTabsAtom = withAtomEffect(\n  atom<ReadonlyArray<EditorTabState>>([]),\n  (get, set) => {\n    // in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n    // settings.\n    // an effect is used to set the intial value instead of using the selector directly in default value,\n    // because otherwise the atom will be linked to the selector (and dynamically updated) until the state is set\n    // which can lead to inconsistent behavior based on whether anything in tabs state is changed or not.\n    get.peek(currentProjectFilesAtom).then((currentProjectFiles) => {\n      set(\n        editorTabsAtom,\n        sortWith(\n          [\n            // first README.md, then ts and js files.\n            descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n            descend((file) => file.path.endsWith(\".ts\")),\n            descend((file) => file.path.endsWith(\".js\")),\n          ],\n          currentProjectFiles.filter((item) => item.type === \"file\")\n        )\n          .filter((file) => !file.path.includes(\".idea\"))\n          .slice(0, 12)\n          // map project file to editor state object\n          .map((file) => ({\n            filePath: file.path,\n            editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n          }))\n      );\n    });\n  }\n);\n\nconst activeEditorTabIndexState = atom<number>(0);\n\nexport const activeEditorTabAtom = atom<EditorTabState | null>((get) => {\n  const tabs = get(editorTabsAtom);\n  return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n});\n\nexport const editorCursorPositionState = atom<Position>(new Position(0, 0));\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefAtom = atom<null | Focusable>(null);\n\nexport interface EditorStateManager {\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOtherTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n  focus(): void;\n}\n\nconst openPathCallback = (\n  get: Getter,\n  set: Setter,\n  filePath: string,\n  shouldFocus = true\n) => {\n  const tabsState = get(editorTabsAtom);\n  const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n  const select = (index: number) => {\n    set(activeEditorTabIndexState, index);\n  };\n  const focus = () => {\n    get(editorRefAtom)?.focus();\n  };\n  if (index > -1) {\n    select(index);\n  } else {\n    const newIndex = tabsState.length;\n    set(editorTabsAtom, (currentState) => [\n      ...currentState,\n      {\n        filePath,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n      },\n    ]);\n    select(newIndex);\n  }\n  if (shouldFocus) {\n    // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n    // event handler) is picked up by editor, adding unwanted new line.\n    setTimeout(focus);\n  }\n};\n\nconst closeCallback = (_get: Getter, set: Setter, index: number) =>\n  set(editorTabsAtom, (tabsState) =>\n    tabsState.filter((_, tabIndex) => tabIndex !== index)\n  );\n\nconst closePathCallback = (get: Getter, set: Setter, filePath: string) => {\n  const index = get(editorTabsAtom).findIndex(\n    (tab) => tab.filePath === filePath\n  );\n  if (index > -1) {\n    closeCallback(get, set, index);\n    set(activeEditorTabIndexState, Math.max(index - 1, 0));\n  }\n};\n\nconst closeOtherTabsCallback = (get: Getter, set: Setter, index: number) => {\n  set(editorTabsAtom, (tabsState) =>\n    tabsState.filter((_, tabIndex) => tabIndex === index)\n  );\n};\n\nconst selectTabCallback = (get: Getter, set: Setter, index: number) => {\n  const numTabs = get(editorTabsAtom).length;\n  if (index >= 0 && index < numTabs) {\n    set(activeEditorTabIndexState, index);\n  }\n};\n\nconst focusTabCallback = (get: Getter, set: Setter) => {\n  get(editorRefAtom)?.focus();\n};\n\nexport const editorManagerAtom = atomWithGetCallback(\n  (_get, { getCallback }): EditorStateManager => {\n    // TODO: create an action for opening in editor (jump to source)\n    return {\n      openPath: getCallback(openPathCallback),\n      closeTab: getCallback(closeCallback),\n      select: getCallback(selectTabCallback),\n      focus: getCallback(focusTabCallback),\n      closeOtherTabs: getCallback(closeOtherTabsCallback),\n      closePath: getCallback(closePathCallback),\n    };\n  }\n);\n\n/**\n * Gives access to editor state manager, in React components. returns a stable editor manager object,\n * that won't cause re-rendering based on editor state changes.\n */\nexport const useEditorStateManager = (): EditorStateManager =>\n  useAtomValue(editorManagerAtom);\n\n/**\n * Gives access to editor state and also the manager, as a tuple, analogous to how useState returns\n * a tuple for the state and the setter. Only the setter is an interface.\n */\nexport const useEditorState = (): readonly [\n  readonly EditorTabState[],\n  EditorStateManager\n] => {\n  return [\n    useAtomValue(editorTabsAtom),\n    useAtomValue(editorManagerAtom),\n  ] as const;\n};\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      const bracketColor = theme.dark ? \"#dcdcdc\" : \"#000\";\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n              \"editorBracketHighlight.foreground1\": bracketColor,\n              \"editorBracketHighlight.foreground2\": bracketColor,\n              \"editorBracketHighlight.foreground3\": bracketColor,\n              \"editorBracketHighlight.foreground4\": bracketColor,\n              \"editorBracketMatch.background\": \"#43454b\", // in new UI\n              \"editorBracketMatch.border\": \"#00000000\", // in new UI\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  const fontSize = 13;\n  return (\n    <StyledEditor\n      {...props}\n      options={\n        {\n          minimap: { enabled: false },\n          lineHeight: 22,\n          showFoldingControls: \"always\",\n          guides: {\n            indentation: true,\n          },\n          overviewRulerBorder: false,\n          fontFamily: \"JetBrains Mono\",\n          fontSize,\n          scrollbar: {\n            verticalScrollbarSize: 14,\n            horizontalScrollbarSize: 8,\n            verticalSliderSize: 8,\n            horizontalSliderSize: 8,\n            horizontal: \"auto\",\n            vertical: \"visible\",\n            alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n          },\n          ...props.options,\n        } as EditorProps[\"options\"]\n      }\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","import { atom, Atom } from \"jotai\";\nimport { unwrap } from \"jotai/utils\";\nimport { Primitive } from \"zod\";\n\ntype WithLoading<T> = { value: T; isLoading: boolean };\n\nfunction getCached<T, K = object | Primitive>(\n  c: () => T,\n  m: K extends object ? WeakMap<K, T> : Map<K, T>,\n  k: K\n): T {\n  return (m.has(k) ? m : m.set(k, c())).get(k) as T;\n}\n\nconst cache1 = new WeakMap();\nconst memo2 = <T>(\n  create: () => T,\n  dep1: object,\n  dep2: object | Primitive\n): T => {\n  const cache2 = getCached(\n    () => (typeof dep2 === \"object\" ? new WeakMap() : new Map()),\n    cache1,\n    dep1\n  );\n  return getCached(create, cache2, dep2);\n};\nconst nullObj = {};\n\nexport function unwrapLatestWithLoading<T>(\n  anAtom: Atom<Promise<T>>\n): Atom<WithLoading<T> | Promise<WithLoading<T>>>;\nexport function unwrapLatestWithLoading<T>(\n  anAtom: Atom<Promise<T>>,\n  defaultValue: Exclude<Awaited<T>, undefined>\n): Atom<WithLoading<T>>;\nexport function unwrapLatestWithLoading<T>(\n  anAtom: Atom<Promise<T>>,\n  defaultValue?: Awaited<T>\n): Atom<WithLoading<T> | Promise<WithLoading<T>>> {\n  return memo2(\n    () => {\n      const freshAtom = atom(async (get) => ({\n        value: await get(anAtom),\n        isLoading: false,\n      }));\n      const unwrappedAtom = unwrap(freshAtom, (prev) => {\n        const fallback = prev === undefined ? defaultValue : prev.value;\n        return fallback !== undefined\n          ? { value: fallback, isLoading: true }\n          : undefined;\n      });\n      return atom((get) => get(unwrappedAtom) ?? get(freshAtom));\n    },\n    anAtom,\n    defaultValue ?? nullObj\n  );\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuOverlayFromOrigin,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useAction,\n  useActionGroup,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useRef, useState } from \"react\";\nimport { atom, useAtomValue, useSetAtom } from \"jotai\";\nimport * as path from \"path\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { fileContentAtom } from \"../fs/fs.state\";\nimport { useRefreshFileStatus } from \"../VersionControl/file-status.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { EditorZeroState } from \"./EditorZeroState\";\nimport { useEditorActionGroup } from \"./useEditorActionGroup\";\nimport {\n  activeEditorTabAtom,\n  editorCursorPositionState,\n  editorRefAtom,\n  useEditorState,\n} from \"./editor.state\";\nimport { Editor } from \"./Editor\";\nimport { unwrapLatestWithLoading } from \"../atom-utils/unwrapLatestWithLoading\";\n\nconst editorFullStateAtom = unwrapLatestWithLoading(\n  atom(async (get) => {\n    const activeEditorTab = get(activeEditorTabAtom);\n    return {\n      ...activeEditorTab,\n      content: await get(fileContentAtom(activeEditorTab?.filePath ?? null)),\n    };\n  })\n);\n\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const [editorTabs, editorStateManager] = useEditorState();\n  const editorRef = useRef<editor.ICodeEditor>();\n  const [active, setActive] = useState(false);\n  const [contextMenu, setContextMenu] =\n    useState<editor.IEditorMouseEvent | null>(null);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetAtom(editorCursorPositionState);\n\n  const {\n    value: { content, filePath },\n    isLoading: isContentLoading,\n  } = useAtomValue(editorFullStateAtom);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items)\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOtherTabs,\n  });\n\n  const setEditorRef = useSetAtom(editorRefAtom);\n\n  const setContent = useSetAtom(fileContentAtom(filePath ?? null));\n  const updateFileStatus = useRefreshFileStatus();\n\n  const editorActionGroupDefinition = useEditorActionGroup(editorRef);\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (filePath) {\n      updateFileStatus(filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n\n  const activePathsProviderProps = useActivePathsProvider(\n    filePath ? [filePath] : []\n  );\n\n  return (\n    <ActionsProvider actions={[editorActionGroupDefinition]}>\n      {({ shortcutHandlerProps }) => (\n        <StyledFileEditorContainer\n          {...mergeProps(activePathsProviderProps, shortcutHandlerProps, {\n            onFocus: () => {\n              setActive(true);\n              setEditorRef({\n                focus: () => editorRef.current?.focus(),\n              });\n            },\n          })}\n        >\n          {editorTabs.length > 0 ? (\n            <>\n              <ContextMenuContainer\n                renderMenu={() => (\n                  <Menu\n                    // TODO: detect which tab was triggering context menu and handle the action accordingly\n                    //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n                    //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n                    //  modified to pass the MouseEvent object, in renderMenu.\n                    onAction={notImplemented}\n                  >\n                    <Item key=\"close\">Close</Item>\n                    <Item key=\"closeOthers\">Close Other tabs</Item>\n                    <Item key=\"closeAll\">Close all tabs</Item>\n                    <Item key=\"closeLeft\">Close tabs to the left</Item>\n                    <Item key=\"closeRight\">Close tabs to the right</Item>\n                  </Menu>\n                )}\n              >\n                <EditorTabs\n                  items={editorTabs}\n                  active={active}\n                  selectedKey={filePath}\n                  onSelectionChange={(key) => {\n                    editorStateManager.select(\n                      editorTabs.findIndex((tab) => tab.filePath === key)\n                    );\n                  }}\n                  noBorders\n                >\n                  {(tab) => {\n                    const filename = path.basename(tab.filePath);\n                    const icon = (\n                      <PlatformIcon icon={getIconForFile(tab.filePath)} />\n                    );\n                    return (\n                      <TabItem\n                        key={tab.filePath}\n                        textValue={filename}\n                        inOverflowMenu={\n                          <MenuItemLayout content={filename} icon={icon} />\n                        }\n                      >\n                        <TooltipTrigger\n                          tooltip={<ActionTooltip actionName={tab.filePath} />}\n                        >\n                          <EditorTabContent\n                            icon={icon}\n                            title={\n                              <FileStatusColor filepath={tab.filePath}>\n                                {filename}\n                              </FileStatusColor>\n                            }\n                            closeButton={\n                              <TooltipTrigger\n                                tooltip={\n                                  <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                                }\n                              >\n                                <TabCloseButton\n                                  onPress={(e) => {\n                                    if (e.altKey) {\n                                      tabActionsRef.current.closeOthersTabs(\n                                        editorTabs.indexOf(tab)\n                                      );\n                                    } else {\n                                      tabActionsRef.current.closePath(\n                                        tab.filePath\n                                      );\n                                    }\n                                  }}\n                                />\n                              </TooltipTrigger>\n                            }\n                            containerProps={{\n                              onDoubleClick: () => {\n                                hideAllAction?.perform();\n                              },\n                            }}\n                          />\n                        </TooltipTrigger>\n                      </TabItem>\n                    );\n                  }}\n                </EditorTabs>\n              </ContextMenuContainer>\n              {typeof content === \"string\" ? (\n                /**\n                 * ## Note\n                 * TLDR: Keeping the editor mounted when filePath changes is intentional and does matter.\n                 *\n                 * Whether the editor component is kept mounted as tabs change or not has nuances that can lead to minor\n                 * focus issues. For example calling editorStateManager.focus() may do nothing if the editor is unmounted due\n                 * to filePath being changed. focusing editor in createFile action is an example of such case. It also affects\n                 * certain focus management code within the FileEditor. For example, focusing the editor on tab changes will\n                 * be necessary if the editor remounts with each file change. Or autofocus behavior of the editor can be\n                 * done on the onMount callback of the Editor component, if it's only mounted once. But the same code leads\n                 * to focus issues if the editor is mounted on active tab changes, when they are not done via the tab UI,\n                 * but as a side effect of another action like opening a file via Project tool window.\n                 *\n                 */\n                <Editor\n                  height=\"100%\"\n                  path={filePath}\n                  options={{ contextmenu: false }}\n                  onMount={(monacoEditor, monaco) => {\n                    monacoEditor.focus();\n                    monacoEditor.onContextMenu((c) => {\n                      c.event.preventDefault();\n                      // opening contextmenu async, because otherwise the editor takes the focus back\n                      // from the menu, right after it's opened.\n                      Promise.resolve().then(() => {\n                        setContextMenu(c);\n                      });\n                    });\n                    monacoEditor.onDidScrollChange(() => {\n                      // It doesn't seem easy to disable scroll on Monaco editor, so just closing the context menu on\n                      // scroll, just like the default Monaco context menu.\n                      setContextMenu(null);\n                    });\n                    enableJsx(monaco);\n                    editorRef.current = monacoEditor;\n                    monacoEditor.onDidChangeCursorPosition((e) => {\n                      setCursorPositionState(e.position);\n                    });\n                    monacoEditor.onDidChangeModel(() => {\n                      // TODO: set the editor tab state, and add an atom effect to persist whole editor state across loads\n                    });\n                  }}\n                  onChange={updateContent}\n                  value={content ?? \"\"}\n                />\n              ) : (\n                content && \"UNSUPPORTED CONTENT\"\n              )}\n            </>\n          ) : (\n            <EditorZeroState />\n          )}\n          {isContentLoading && <FileEditorLoading />}\n          {contextMenu && (\n            <MenuOverlayFromOrigin\n              origin={contextMenu.event.browserEvent}\n              onClose={() => setContextMenu(null)}\n            >\n              <EditorActionGroupMenu />\n            </MenuOverlayFromOrigin>\n          )}\n        </StyledFileEditorContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n\nfunction EditorActionGroupMenu() {\n  const actionGroup = useActionGroup(\"EditorPopupMenu\");\n  if (!actionGroup) {\n    return null; // Replace with a placeholder \"Nothing to show\" menu\n  }\n  return (\n    <ActionGroupMenu actionGroup={actionGroup}>\n      {(menuProps) => (\n        <Menu\n          autoFocus={\n            // To avoid autofocusing the first item.\n            true\n          }\n          {...menuProps}\n        />\n      )}\n    </ActionGroupMenu>\n  );\n}\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, Getter, Setter } from \"jotai\";\nimport { atomWithDefault, useAtomCallback } from \"jotai/utils\";\nimport { currentProjectAtom, Project } from \"../Project/project.state\";\nimport { dirContentAtom, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport { vcsRootsAtom } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom(true);\n\nexport const expandedKeysAtom = atomWithDefault(\n  (get) =>\n    new Set<Key>(\n      get(vcsRootsAtom)\n        .flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n        .concat(get(currentProjectAtom).path)\n    )\n);\n\nexport const selectionAtom = atom<Selection>(new Set<Key>([]));\n\nexport const selectedNodesAtom = atom(\n  async (get): Promise<ReadonlyArray<ProjectTreeNode>> => {\n    const selection = get(selectionAtom);\n    const nodesByKey = (await get(currentProjectTreeAtom)).byKey;\n    const selectedKeys = selection === \"all\" ? nodesByKey.keys() : selection;\n    return [...selectedKeys]\n      .map((key) => nodesByKey.get(`${key}`))\n      .filter(notNull);\n  }\n);\n\nexport const projectViewTreeRefAtom = atom<RefObject<TreeRefValue>>(\n  React.createRef<TreeRefValue>()\n);\n\nexport const currentProjectTreeAtom = atom((get) => {\n  const project = get(currentProjectAtom);\n  return createProjectTree(project, get);\n});\n\ntype FilesTreeSort = \"name\"; // more to be added\n\n// TODO: add more sort options and add \"Tree Appearance\" option in Project tool window settings menu.\nexport const projectTreeSortAtom = atom<FilesTreeSort>(\"name\");\n\n/**\n * NOTE: using in-place native sort for performance.\n * See more https://www.measurethat.net/Benchmarks/Show/6698/0/ramda-sort-vs-js-native-sort\n */\nfunction sortProjectTreeNodes(items: FileTreeNode[]): void {\n  // TODO: add sortBy: FileTreeSort parameter\n  // TODO: add directoriesOnTop: boolean parameter\n  items.sort((item1, item2) => {\n    if (item1.name < item2.name) {\n      return -1;\n    }\n    if (item1.name > item2.name) {\n      return 1;\n    }\n    return 0;\n  });\n}\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: Getter\n): Promise<{ root: ProjectTreeRoot; byKey: Map<string, ProjectTreeNode> }> {\n  const rootItems = await get(dirContentAtom(project.path));\n  const byKey = new Map<string, ProjectTreeNode>();\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const node = {\n        ...item,\n        parent,\n      };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          const dirNode: FileTreeDirNode = { ...node, children: [] };\n          dirNode.children = (\n            await Promise.all(\n              ((await get(dirContentAtom(item.path))) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          sortProjectTreeNodes(dirNode.children);\n          byKey.set(dirNode.path, dirNode);\n          return dirNode;\n        }\n        return null;\n      }\n      byKey.set(node.path, node);\n      return node;\n    };\n\n  const children = (\n    await Promise.all((rootItems || []).map(mapItem(null)))\n  ).filter(notNull);\n  sortProjectTreeNodes(children);\n  const root: ProjectTreeNode = {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children,\n  };\n  byKey.set(root.path, root);\n  return { root, byKey };\n}\n\n/**\n * atom callback for expanding to a certain path in project view.\n */\nexport const expandToPathCallback = (\n  get: Getter,\n  set: Setter,\n  path: string\n) => {\n  const expandedKeys = get(expandedKeysAtom);\n  const keysToExpand = [get(currentProjectAtom).path].concat(\n    getParentPaths(path)\n  );\n  set(expandedKeysAtom, new Set([...expandedKeys, ...keysToExpand]));\n};\n\n/**\n * a function to be passed to useAtomCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n */\nexport const selectKeyAndFocusCallback = (\n  get: Getter,\n  set: Setter,\n  key: Key\n) => {\n  const treeRef = get(projectViewTreeRefAtom)?.current;\n  treeRef?.replaceSelection(key);\n  treeRef?.focus(key);\n};\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useAtomCallback(expandToPathCallback);\n  const selectKeyAndFocus = useAtomCallback(selectKeyAndFocusCallback);\n  return (path: string) => {\n    // TODO: open project view tool window if needed\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","export const projectActionIds = {\n  NewElement: \"NewElement\",\n  NewFile: \"NewFile\",\n  NewDir: \"NewDir\",\n  CopyReferencePopupGroup: \"CopyReferencePopupGroup\",\n  CopyPaths: \"CopyPaths\",\n  CopyFileReference: \"CopyFileReference\",\n  CopyAbsolutePath: \"CopyAbsolutePath\",\n  CopySourceRootPath: \"CopySourceRootPath\",\n  CopyFileName: \"CopyFileName\",\n};\n","import {\n  ActionContext,\n  ActionsMenu,\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport React from \"react\";\nimport { projectActionIds } from \"../Project/projectActionIds\";\n\nexport function ProjectViewContextMenu({\n  getActionContext,\n}: {\n  getActionContext: () => ActionContext;\n}) {\n  return (\n    <ActionsMenu\n      aria-label=\"Project Tree actions\"\n      actionContext={getActionContext}\n      actions={[\n        {\n          ...useAction(projectActionIds.NewElement)!,\n          title: \"New\",\n          shortcut: undefined,\n        },\n        new DividerItem(),\n        useAction(CommonActionId.CUT),\n        useAction(CommonActionId.COPY),\n        useAction(projectActionIds.CopyReferencePopupGroup),\n        useAction(CommonActionId.PASTE),\n        new DividerItem(),\n        useAction(CommonActionId.DELETE),\n        new DividerItem(),\n      ].filter(notNull)}\n    />\n  );\n}\n","import { atom, Atom } from \"jotai\";\nimport { unwrap } from \"jotai/utils\";\n\n/**\n * Returns a memoized version of the input function based on it's single argument.\n * Useful for making an atom wrapper pure (by caching the output based on input),\n * to make it usable directly inside components without useMemo.\n * @param fn\n */\nconst memoized = <Fn extends (...args: any[]) => any>(fn: Fn): Fn => {\n  const _cache = new WeakMap<Parameters<Fn>[0], ReturnType<Fn>>();\n  return ((arg1: Parameters<Fn>[0]) => {\n    let result = _cache.get(arg1);\n    if (result === undefined) {\n      result = fn(arg1);\n      _cache.set(arg1, result!);\n    }\n    return result;\n  }) as Fn;\n};\n/**\n * Creates an atom that suspends rendering only the first time `anAtom` is\n * being resolved.\n * In subsequent resolutions of `anAtom`, the resulting atom will unwrap to the\n * latest resolved value.\n */\nexport const unwrapLatest = memoized(\n  <T>(anAtom: Atom<Promise<T>>): Atom<T | Promise<T>> => {\n    const unwrappedAtom = unwrap(anAtom, (prev) => prev);\n    return atom((get) => get(unwrappedAtom) ?? get(anAtom));\n  }\n);\n/**\n * Creates an atom that unwraps an async atom to its latest resolved value,\n * or `null` when the value is being resolved for the first time.\n */\nexport const unwrapLatestOrNull = memoized(\n  <T>(anAtom: Atom<Promise<T>>): Atom<T | null> =>\n    unwrap(anAtom, (prev) => prev ?? null)\n);\n","import {\n  ActionContext,\n  ContextMenuContainer,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectAtom,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeAtom,\n  expandedKeysAtom,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefAtom,\n  selectionAtom,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { ProjectViewContextMenu } from \"./ProjectViewContextMenu\";\n\nimport { unwrapLatest } from \"../atom-utils/unwrapLatest\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useAtomValue(currentProjectAtom);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetAtom(projectViewTreeRefAtom);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const treeState = useAtomValue(unwrapLatest(currentProjectTreeAtom));\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtom);\n  const [selectedKeys, setSelectedKeys] = useAtom(selectionAtom);\n  const foldersOnTop = useAtom(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contextMenuTargetKey = useRef<string | undefined>();\n\n  /**\n   * A (temporary?) non-straightforward way to position popups (action groups with \"none\" menuPresentation\")\n   * relative to the tree node content.\n   * It's implemented like this because the context menu API at the moment is too generic and disconnected from\n   * components like Tree.\n   * At minimum, this logic here can be extracted into a wrapper like TreeContextMenuContainer for reusability.\n   */\n  const getActionContext = (): ActionContext => {\n    return {\n      element:\n        containerRef.current?.querySelector(\n          `[data-key=\"${contextMenuTargetKey.current}\"]`\n        ) ?? null,\n      event: null,\n    };\n  };\n\n  return (\n    <DefaultSuspense>\n      {treeState.root && (\n        <ContextMenuContainer\n          ref={containerRef}\n          style={{ height: \"100%\" }}\n          onOpen={({ target }) =>\n            (contextMenuTargetKey.current =\n              target?.closest<HTMLElement>(\"[data-key]\")?.dataset.key)\n          }\n          renderMenu={() => {\n            return (\n              <ProjectViewContextMenu getActionContext={getActionContext} />\n            );\n          }}\n        >\n          <SpeedSearchTree\n            aria-label=\"Project structure tree\"\n            treeRef={treeRef}\n            {...activePathsProviderProps}\n            items={[treeState.root] as ProjectTreeNode[]}\n            onAction={(path) => {\n              editor.openPath(`${path}`);\n            }}\n            fillAvailableSpace\n            autoFocus\n            selectionMode=\"multiple\"\n            selectedKeys={selectedKeys}\n            onSelectionChange={setSelectedKeys}\n            expandedKeys={expandedKeys}\n            onExpandedChange={setExpandedKeys}\n          >\n            {(item) => (\n              <Item\n                key={item.path}\n                textValue={item.name}\n                childItems={\n                  \"children\" in item ? sortItems(item.children) : undefined\n                }\n              >\n                <ItemLayout>\n                  {<ProjectViewNodeIcon node={item} />}\n                  {item.type === \"project\" ? (\n                    <>\n                      <b>\n                        <HighlightedTextValue />\n                      </b>\n                      <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                    </>\n                  ) : (\n                    <FileTreeNodeText node={item} />\n                  )}\n                  {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n                </ItemLayout>\n              </Item>\n            )}\n          </SpeedSearchTree>\n        </ContextMenuContainer>\n      )}\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","import React from \"react\";\nimport {\n  Button,\n  ButtonProps,\n  HelpTooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nexport function HelpButton({\n  tooltip = \"Show help contents\",\n  ...props\n}: Omit<ButtonProps, \"variant\" | \"children\"> & { tooltip?: string }) {\n  return (\n    <TooltipTrigger tooltip={<HelpTooltip helpText={tooltip} />}>\n      <Button\n        variant=\"icon\"\n        aria-label=\"Help\"\n        aria-description=\"Show help contents\"\n        {...props}\n      >\n        <span style={{ fontSize: 18 }}>?</span>\n      </Button>\n    </TooltipTrigger>\n  );\n}\n","import path from \"path\";\nimport { identity } from \"ramda\";\n\nexport function isParentPath(parent: string, dir: string) {\n  return dir.startsWith(parent + path.sep); // is this good enough, or do we need the code below?\n  // const relative = path.relative(parent, dir);\n  // return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n}\n\n/**\n * Given a list of paths, returns a subset of them, where nested paths are removed.\n * @example findRoots(['/a/b/c/x.txt', '/a/b', '/a/b/c', '/a/b/y.ts']); // ['/a/b']\n * @example findRoots([{p: '/a/b'}, {p: '/a'}]); // [{p: '/a'}]\n */\nexport function findRootPaths(paths: readonly string[]): string[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string\n): T[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string = identity as (obj: T) => string\n): T[] {\n  return objects.filter((obj) => {\n    const thePath = getPath(obj);\n    return !objects.find(\n      (anObject) => anObject !== obj && isParentPath(getPath(anObject), thePath)\n    );\n  });\n}\n","import { Getter, Setter } from \"jotai\";\nimport {\n  refreshFileStatusCallback,\n  vcsFootForFileAtom,\n} from \"../VersionControl/file-status.state\";\nimport { editorManagerAtom } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\nimport git from \"isomorphic-git\";\nimport path from \"path\";\nimport { dirContentAtom, fileContentAtom } from \"../fs/fs.state\";\nimport { ensureDir } from \"../fs/fs-utils\";\n\nexport const deleteFileCallback = async (\n  get: Getter,\n  set: Setter,\n  filepath: string\n) => {\n  try {\n    await fs.promises.unlink(filepath);\n    const repoDir = await get(vcsFootForFileAtom(filepath));\n    if (repoDir) {\n      await git.remove({\n        fs,\n        dir: repoDir,\n        filepath: path.relative(repoDir, filepath),\n      });\n      await refreshFileStatusCallback(get, set, filepath); // TODO(fs.watch): better done separately using fs.watch\n    }\n  } catch (e) {\n    console.error(`error in deleting file ${filepath}`, e);\n  } finally {\n    const editor = get(editorManagerAtom);\n    editor.closePath(filepath); // TODO(fs.watch): better done as an effect on editorState, using fs.watch. But fs.watch is not available at the moment.\n    set(dirContentAtom(path.dirname(filepath))); // TODO(fs.watch): better done separately using fs.watch\n    set(fileContentAtom(filepath)); // TODO(fs.watch): better done separately using fs.watch\n  }\n};\n\nexport const deleteFilesCallback = async (\n  get: Getter,\n  set: Setter,\n  filePaths: string[]\n) => {\n  // TODO: use task API\n  // An attempt to make this transactional failed, since it requires passing `set` and `reset` from transact function\n  // to deleteFileCallback, and {...callbackInterface, set, reset} didn't work , since callbackInterface is a proxy object\n  return Promise.all(\n    filePaths.map((filePath) => deleteFileCallback(get, set, filePath))\n  );\n};\n\nexport const deleteDirCallback = async (\n  get: Getter,\n  set: Setter,\n  dir: string\n) => {\n  // TODO: use task API\n  const recursivelyDeleteDir = async (dirname: string) => {\n    const pathnames = await fs.promises.readdir(dirname);\n    await Promise.all(\n      pathnames.map(async (pathname) => {\n        const fullpath = path.resolve(dirname, pathname);\n        const stat = await fs.promises.stat(fullpath);\n        if (stat.isFile()) {\n          // potential improvement: refreshing dir content could wait until all files are deleted.\n          await deleteFileCallback(get, set, fullpath);\n        } else if (stat.isDirectory()) {\n          await recursivelyDeleteDir(fullpath);\n        }\n      })\n    );\n    await fs.promises.rmdir(dirname);\n    set(dirContentAtom(dir));\n  };\n  try {\n    await recursivelyDeleteDir(dir);\n  } catch (e) {\n    console.error(`error in deleting directory ${dir}`, e);\n  } finally {\n    set(dirContentAtom(path.dirname(dir))); // TODO(fs.watch): better done separately using fs.watch\n  }\n};\n\nexport const createFileCallback = async (\n  get: Getter,\n  set: Setter,\n  destinationDir: string,\n  filename: string\n) => {\n  const filePath = path.join(destinationDir, filename);\n  await ensureDir(fs.promises, path.dirname(filePath));\n  if (await fs.promises.exists(filePath)) {\n    throw new Error(`File ${filePath} already exists`);\n  }\n  await fs.promises.writeFile(filePath, \"\", \"utf-8\");\n  set(fileContentAtom(filePath)); // TODO(fs.watch): better done in an atom effect\n  get(editorManagerAtom).openPath(filePath);\n  await refreshFileStatusCallback(get, set, filePath);\n  set(dirContentAtom(destinationDir));\n};\n\nexport const createDirectoryCallback = async (\n  _get: Getter,\n  set: Setter,\n  destination: string,\n  dirPath: string\n) => {\n  const fullpath = path.join(destination, dirPath);\n  if (await fs.promises.exists(fullpath)) {\n    throw new Error(`File ${fullpath} already exists`);\n  }\n  await ensureDir(fs.promises, fullpath);\n  set(dirContentAtom(destination));\n};\n","import { Atom } from \"jotai\";\n\nexport type MaybeAtom<T> = T | Atom<T>;\nexport type MaybeAtomAsync<T> = T | Atom<T | Promise<T>>;\n\nexport const isAtom = <T>(value: MaybeAtom<T>): value is Atom<T> =>\n  typeof value === \"object\" && value !== null && \"read\" in value;\n","import { atom, Getter, Setter, WritableAtom } from \"jotai\";\nimport { unwrap } from \"jotai/utils\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { isAtom, MaybeAtom, MaybeAtomAsync } from \"./atom-utils/isAtom\";\n\ntype PerformActionArgs = Parameters<ActionDefinition[\"actionPerformed\"]>;\n/**\n *\n */\nexport const actionAtom = <T>({\n  isSearchable: isSearchableValue,\n  isDisabled: isDisabledValue,\n  actionPerformed,\n  ...params\n}: Omit<ActionDefinition, \"actionPerformed\" | \"isDisabled\" | \"isSearchable\"> & {\n  actionPerformed: (\n    state: { get: Getter; set: Setter },\n    ...args: PerformActionArgs\n  ) => void | Promise<void>;\n  isDisabled?: MaybeAtomAsync<boolean>;\n  isSearchable?: MaybeAtomAsync<boolean>;\n}): WritableAtom<ActionDefinition, PerformActionArgs, Promise<void>> => {\n  const isDisabled = isAtom(isDisabledValue)\n    ? unwrap(isDisabledValue, () => true)\n    : isDisabledValue;\n  const isSearchable = isAtom(isSearchableValue)\n    ? unwrap(isSearchableValue, () => false)\n    : isSearchableValue;\n\n  return atom(\n    (get, { setSelf }): ActionDefinition => {\n      const resolve = <T>(maybeAtom: MaybeAtom<T> | undefined) => {\n        return isAtom(maybeAtom) ? get(maybeAtom) : maybeAtom;\n      };\n\n      return {\n        ...params,\n        isDisabled: resolve(isDisabled),\n        isSearchable: resolve(isSearchable),\n        actionPerformed: setSelf,\n      };\n    },\n    async (get, set, ...args: PerformActionArgs) => {\n      return actionPerformed({ get, set }, ...args);\n    }\n  );\n};\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport React from \"react\";\n\nimport {\n  Button,\n  Checkbox,\n  CommonActionId,\n  ModalWindow,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { HelpButton } from \"../../HelpButton\";\nimport {\n  activePathExistsAtom,\n  alertDialogRefAtom,\n  windowManagerRefAtom,\n} from \"../../Project/project.state\";\nimport { selectedNodesAtom } from \"../ProjectView.state\";\nimport { findRootPaths } from \"../../path-utils\";\nimport {\n  deleteDirCallback,\n  deleteFilesCallback,\n} from \"../../Project/fs-operations\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { actionAtom } from \"../../actionAtom\";\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nconst dirCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 directory}\n    other {# directories}\n  }`,\n  \"en-US\"\n);\n\nexport const deleteActionAtom = actionAtom({\n  id: CommonActionId.DELETE,\n  title: \"Delete\",\n  description: \"Delete selected item\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get, set }) => {\n    const selectedNodes = await get(selectedNodesAtom);\n    const windowManager = get(windowManagerRefAtom).current;\n    const alertDialog = get(alertDialogRefAtom).current;\n    if (selectedNodes.length === 0) {\n      return;\n    }\n    const nodesToDelete = findRootPaths(selectedNodes, (node) => node.path);\n    const filePaths = nodesToDelete\n      .filter((node) => node.type === \"file\")\n      .map((node) => node.path);\n    const directories = nodesToDelete\n      .filter((node) => node.type === \"project\" || node.type === \"dir\")\n      .map((node) => node.path);\n\n    if (directories.length > 0) {\n      const singleDirName =\n        directories.length === 1 && filePaths.length === 0\n          ? path.basename(directories[0])\n          : null;\n\n      const confirmed = await alertDialog?.confirm({\n        title: \"Delete\",\n        okText: \"Delete\",\n        message: (\n          <div style={{ width: 354 }}>\n            Delete{\" \"}\n            {singleDirName\n              ? `\"${singleDirName}\"`\n              : [\n                  { count: directories.length, message: dirCountMsg },\n                  { count: filePaths.length, message: fileCountMsg },\n                ]\n                  .filter(({ count }) => count > 0)\n                  .map(({ message, count }) => message.format({ count }))\n                  .join(\" and \")}\n            ?\n            <br />\n            All files and subdirectories in\n            {singleDirName\n              ? ` \"${singleDirName}\" `\n              : \" the selected directories \"}\n            will be deleted. <br />\n            You might not be able to fully undo this operation!\n          </div>\n        ),\n      });\n      if (confirmed) {\n        await Promise.all([\n          ...directories.map((pathname) =>\n            deleteDirCallback(get, set, pathname)\n          ),\n          deleteFilesCallback(get, set, filePaths),\n        ]);\n      }\n    } else {\n      windowManager\n        ?.open<boolean>(({ close }) => (\n          <DeleteFilesConfirmationDialog filePaths={filePaths} close={close} />\n        ))\n        .then((confirmed) => {\n          if (confirmed) {\n            requestAnimationFrame(() => {\n              // It's important that the focus is restored to the previously focused item, which typically is the\n              // file in project view, that's being deleted.\n              // If the file is deleted before the focus is restored, the DOM element that was going to be focused\n              // will be removed by the time focus restoration logic runs.\n              // Even though `windowManager.open()` was changed to return a promise which is supposed to be resolved\n              // **after** the modal window is closed,\n              // in the CI environment the focus is not properly restored.\n              // In lack of a better solution, the deletion is done async with a setTimeout.\n              deleteFilesCallback(get, set, filePaths);\n            });\n          }\n        });\n    }\n  },\n});\n\nfunction DeleteFilesConfirmationDialog({\n  close,\n  filePaths,\n}: {\n  close: (confirmed?: true) => void;\n  filePaths: string[];\n}) {\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Delete\"\n        content={\n          <form\n            id=\"delete_dialog_form\"\n            onSubmit={(e) => {\n              e.preventDefault();\n            }}\n            style={{\n              padding: \"0.75rem 1rem\",\n            }}\n          >\n            <div style={{ marginBottom: \".5rem\" }}>\n              {filePaths.length === 1\n                ? `Delete file \"${path.basename(filePaths[0])}\"`\n                : `Delete ${filePaths.length} files`}\n              ?\n            </div>\n            <div\n              style={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                gap: \"0.25rem\",\n              }}\n            >\n              <Checkbox isDisabled>Safe delete (with usage search)</Checkbox>\n              <div style={{ display: \"flex\", gap: \"1rem\" }}>\n                <Checkbox isDisabled>Search in comments and strings</Checkbox>\n                <Checkbox isDisabled>Search for text occurrences</Checkbox>\n              </div>\n            </div>\n          </form>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<HelpButton onPress={() => notImplemented()}></HelpButton>}\n            right={\n              <>\n                <Button onPress={() => close()}>Cancel</Button>\n                <Button\n                  autoFocus\n                  type=\"submit\"\n                  form=\"delete_dialog_form\" // Using form in absence of built-in support for default button\n                  variant=\"default\"\n                  onPress={() => {\n                    close(true);\n                  }}\n                >\n                  Ok\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport { atom } from \"jotai\";\nimport { CommonActionId, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsAtom } from \"../../Project/project.state\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyActionAtom = actionAtom({\n  id: CommonActionId.COPY,\n  title: \"Copy\",\n  description: \"Copy to clipboard\",\n  icon: <PlatformIcon icon=\"actions/copy\" />,\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async () => {\n    notImplemented();\n  },\n});\n","import React from \"react\";\nimport { atom } from \"jotai\";\nimport { CommonActionId, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsAtom } from \"../../Project/project.state\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const cutActionAtom = actionAtom({\n  id: CommonActionId.CUT,\n  title: \"Cut\",\n  description: \"Cut to clipboard\",\n  icon: <PlatformIcon icon=\"actions/menu-cut\" />,\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async () => {\n    notImplemented();\n  },\n});\n","import React from \"react\";\nimport { atom } from \"jotai\";\nimport { CommonActionId, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsAtom } from \"../../Project/project.state\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const pasteActionAtom = actionAtom({\n  id: CommonActionId.PASTE,\n  title: \"Paste\",\n  description: \"Paste from clipboard\",\n  icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async () => {\n    notImplemented();\n  },\n});\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\n\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport {\n  projectViewTreeRefAtom,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabAtom } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\nimport { deleteActionAtom } from \"./actions/deleteAction\";\nimport { copyActionAtom } from \"./actions/copyAction\";\nimport { cutActionAtom } from \"./actions/cutAction\";\nimport { pasteActionAtom } from \"./actions/pasteAction\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useAtomValue(projectViewTreeRefAtom);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useAtomValue(activeEditorTabAtom);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n    useAtomValue(deleteActionAtom), // could have been on project level, if it could handle delete in editor as well\n    useAtomValue(cutActionAtom),\n    useAtomValue(copyActionAtom),\n    useAtomValue(pasteActionAtom),\n  ].filter(notNull);\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React, { ReactNode, useEffect, useState } from \"react\";\n\nconst DEFAULT_LOADING_DELAY_MS = 500; // To be shared later in more places.\nexport function Delayed({ children }: { children: ReactNode }) {\n  const [waitedEnough, setWaitedEnough] = useState(false);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setWaitedEnough(true);\n    }, DEFAULT_LOADING_DELAY_MS);\n    return () => clearTimeout(timer);\n  }, []);\n  if (waitedEnough) {\n    return <>{children}</>;\n  }\n  return null;\n}\n","import { FileStatus } from \"../file-status\";\nimport { dirname } from \"path\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n  hash?: string;\n  content(): Promise<string>;\n};\n\ndeclare const __tag: unique symbol;\n\ntype ChangeVariant<T extends { type: string }> = T & {\n  /**\n   * A non-exported tag is used to make opaque types that can only be created by Change function, following\n   * \"parse, don't validate\" rule, enforcing certain rules that defines the change type based on the\n   * presence and properties of the before and after revisions.\n   */\n  readonly [__tag]: any;\n};\n\n/**\n * Represents a file being moved from one directory to another, which may or may not have been renamed too.\n */\nexport type MoveChange = ChangeVariant<{\n  type: \"MOVED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being renamed withing the same directory.\n */\nexport type RenameChange = ChangeVariant<{\n  type: \"RENAMED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being changed, but not moved or renamed.\n */\nexport type ModificationChange = ChangeVariant<{\n  type: \"MODIFIED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a path being deleted.\n */\nexport type DeletionChange = ChangeVariant<{\n  type: \"DELETED\";\n  before: Revision;\n}>;\n\n/**\n * Represents a new file\n */\nexport type AdditionChange = ChangeVariant<{\n  type: \"ADDED\";\n  after: Revision;\n}>;\n\n/**\n * Represents an unversioned (new) file. In git terms, a file that doesn't exist in index or HEAD.\n */\nexport type UnversionedChange = ChangeVariant<{\n  type: \"UNVERSIONED\";\n  after: Revision;\n}>;\n\nexport type AnyChange =\n  | AdditionChange\n  | MoveChange\n  | RenameChange\n  | ModificationChange\n  | DeletionChange\n  | UnversionedChange;\n\nconst Tagged = <T>(change: T): T & { [__tag]: any } =>\n  change as T & { [__tag]: any };\n\n/**\n * Creates change objects from before and after revisions. It creates the right type of change\n * depending on the presence and properties of `before` and `after` revisions.\n * Note: Use Change.Unversioned(revision) to create unversioned changes.\n */\nexport function Change(before: null, after: Revision): Readonly<AdditionChange>;\nexport function Change(before: Revision, after: null): Readonly<DeletionChange>;\nexport function Change(\n  before: Revision,\n  after: Revision\n): Readonly<ModificationChange | RenameChange | MoveChange>;\nexport function Change(\n  before: Revision | null,\n  after: Revision | null\n): AnyChange {\n  if (after) {\n    if (!before) {\n      return Tagged({\n        type: \"ADDED\",\n        after,\n      });\n    }\n    if (before.path !== after.path) {\n      if (dirname(before.path) === dirname(after.path)) {\n        return Tagged({\n          type: \"RENAMED\",\n          before,\n          after,\n        });\n      } else {\n        return Tagged({\n          type: \"MOVED\",\n          before,\n          after,\n        });\n      }\n    }\n    return Tagged({\n      type: \"MODIFIED\",\n      before,\n      after,\n    });\n  } else {\n    return Tagged({\n      type: \"DELETED\",\n      before: before!, // \"!\" because typescript has an issue recognizing after and before can't be null simultaneously\n    });\n  }\n}\n\n/**\n * Creates an unversioned change object\n */\nChange.Unversioned = (revision: Revision): UnversionedChange => {\n  return Tagged({\n    type: \"UNVERSIONED\",\n    after: revision,\n  });\n};\n\nconst changeToFileStatus: Record<AnyChange[\"type\"], FileStatus> = {\n  ADDED: \"ADDED\",\n  DELETED: \"DELETED\",\n  MOVED: \"MODIFIED\",\n  RENAMED: \"MODIFIED\",\n  MODIFIED: \"MODIFIED\",\n  UNVERSIONED: \"UNKNOWN\",\n};\n\n/**\n * @returns {@link FileStatus} corresponding to the change type\n */\nChange.fileStatus = function (change: AnyChange): FileStatus {\n  return changeToFileStatus[change.type] ?? \"NOT_CHANGED\";\n};\n\n/**\n * @returns the `after` path if the change is not a deletion, and `before` path, otherwise.\n */\nChange.path = function (change: AnyChange): string {\n  return Change.revision(change).path;\n};\n\nChange.content = function (change: AnyChange): Promise<string> {\n  if (\"after\" in change) {\n    return change.after.content();\n  }\n  if (\"before\" in change) {\n    return change.before.content();\n  }\n  return Promise.resolve(\"\");\n};\n\n/**\n * type-guard returning filter for addition change\n */\nChange.isAddition = function (change: AnyChange): change is AdditionChange {\n  return change.type === \"ADDED\";\n};\n\n/**\n * type-guard returning filter for deletion change\n */\nChange.isDeletion = function (change: AnyChange): change is DeletionChange {\n  return change.type === \"DELETED\";\n};\n\n/**\n * type-guard returning filter for rename change\n */\nChange.isRename = function (change: AnyChange): change is RenameChange {\n  return change.type === \"RENAMED\";\n};\n\n/**\n * type-guard returning filter for move change\n */\nChange.isMove = function (change: AnyChange): change is MoveChange {\n  return change.type === \"MOVED\";\n};\n\n/**\n * type-guard returning filter for modification change.\n */\nChange.isModified = function (change: AnyChange): change is ModificationChange {\n  return change.type === \"MODIFIED\";\n};\n\n/**\n * type-guard returning filter for unversioned change.\n */\nChange.isUnversioned = function (\n  change: AnyChange\n): change is UnversionedChange {\n  return change.type === \"UNVERSIONED\";\n};\n\n/**\n * @returns the `after` revision if the change is not a deletion, and `before` revision, otherwise.\n */\nChange.revision = function (change: AnyChange): Revision {\n  return \"after\" in change ? change.after : change.before;\n};\n\nChange.equals = function (a: AnyChange, b: AnyChange): boolean {\n  const sameBefore =\n    \"before\" in a && \"before\" in b\n      ? revisionEquals(a.before, b.before)\n      : \"before\" in a === \"before\" in b;\n  const sameAfter =\n    \"after\" in a && \"after\" in b\n      ? revisionEquals(a.after, b.after)\n      : \"after\" in a === \"after\" in b;\n  return sameBefore && sameAfter;\n};\n\nfunction revisionEquals(a: Revision, b: Revision) {\n  return a?.path === b?.path && a.isDir === b.isDir;\n}\n","import { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, useAtomCallback } from \"jotai/utils\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport git, { checkout, resetIndex } from \"isomorphic-git\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { dirContentAtom, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { fs } from \"../../fs/fs\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { editorManagerAtom } from \"../../Editor/editor.state\";\nimport {\n  refreshFileStatusCallback,\n  repoStatusAtoms,\n  vcsFootForFileAtom,\n  vcsRootsAtom,\n} from \"../file-status.state\";\nimport { AnyChange, Change } from \"./Change\";\n\nconst repoChangesAtoms = atomFamily((repoDir: string) =>\n  atom((get): AnyChange[] =>\n    Object.entries(get(repoStatusAtoms(repoDir)))\n      .map<AnyChange | null>(([filename, status]) => {\n        const revision = {\n          path: path.join(repoDir, filename),\n          isDir: false,\n          content(): Promise<string> {\n            throw new Error(\"Not implemented\");\n          },\n        };\n        if (status === \"ADDED\") {\n          return Change(null, revision);\n        } else if (status === \"MODIFIED\") {\n          return Change(revision, revision);\n        } else if (status === \"DELETED\") {\n          return Change(revision, null);\n        } else if (status === \"UNKNOWN\") {\n          return Change.Unversioned(revision);\n        } else {\n          return null;\n        }\n      })\n      .filter(notNull)\n  )\n);\n\nexport const allChangesAtom = atom<ReadonlyArray<AnyChange>>((get) => {\n  return get(vcsRootsAtom)\n    .map(({ dir }) => get(repoChangesAtoms(dir)))\n    .flat();\n});\n\nconst rollbackChangesCallback = async (\n  get: Getter,\n  set: Setter,\n  changes: readonly AnyChange[],\n  deleteAddedFiles?: boolean\n) => {\n  const reloadFileFromDisk = reloadFileFromDiskCallback(get, set);\n\n  const changesWithRepoRoots = (\n    await Promise.all(\n      changes\n        .filter((change) => !Change.revision(change).isDir)\n        .map(async (change) => {\n          const repoRoot = await get(vcsFootForFileAtom(Change.path(change)));\n          if (repoRoot) {\n            return {\n              repoRoot,\n              change,\n              relativePath: path.relative(repoRoot, Change.path(change)),\n            };\n          }\n        })\n    )\n  ).filter(notNull);\n  const groupedChanges = groupBy(\n    ({ repoRoot }) => repoRoot,\n    changesWithRepoRoots\n  );\n  await Promise.all(\n    Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n      const { toReset = [], toCheckout = [] } = groupBy(\n        ({ change: { type } }) =>\n          type !== \"ADDED\" || deleteAddedFiles ? \"toCheckout\" : \"toReset\",\n        items\n      );\n      await Promise.allSettled(\n        toReset.map(({ relativePath }) =>\n          resetIndex({\n            fs,\n            dir: repoRoot,\n            filepath: relativePath,\n          })\n        )\n      );\n      if (toCheckout.length > 0) {\n        const resolvedHead = await git\n          .resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" })\n          .catch(() => null);\n        if (resolvedHead) {\n          await checkout({\n            fs,\n            dir: repoRoot,\n            force: true,\n            filepaths: toCheckout.map(\n              ({ relativePath, change: { type } }) => relativePath\n            ),\n          });\n        } else {\n          // if the repository is just created, HEAD is not resolved, and checkout() throws, so we delete files\n          // manually in that case.\n          // TODO: another use case is detached HEAD, and it may need to be handled for non-addition changes?\n          await Promise.all(\n            toCheckout\n              .filter(({ change }) => change.type === \"ADDED\")\n              .map(({ change }) => {\n                const fullPath = Change.path(change);\n                return fs.promises.unlink(fullPath);\n              })\n          );\n        }\n      }\n      if (deleteAddedFiles) {\n        const editor = get(editorManagerAtom);\n        changes.filter(Change.isAddition).forEach((change) => {\n          editor.closePath(Change.path(change)); // FIXME(fs.watch)\n        });\n      }\n\n      // FIXME(fs.watch)\n      const changedDirectories = findRootPaths(\n        items.flatMap(({ change }) => {\n          if (change.type === \"MODIFIED\") {\n            // minor optimization\n            return [];\n          }\n          if (change.type === \"MOVED\") {\n            return [change.before.path, change.after.path];\n          }\n          return Change.path(change);\n        })\n      ).map(path.dirname);\n      changedDirectories.forEach((pathToRefresh) =>\n        set(dirContentAtom(pathToRefresh))\n      );\n\n      await Promise.allSettled(\n        items.map(async ({ relativePath, change }) => {\n          const fullPath = Change.path(change);\n          await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n          await resetIndex({\n            fs,\n            dir: repoRoot,\n            filepath: relativePath,\n          });\n          await refreshFileStatusCallback(get, set, fullPath);\n        })\n      );\n    })\n  );\n};\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  return useAtomCallback(rollbackChangesCallback);\n};\n","import { atom as jotaiAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { useCallback, useEffect } from \"react\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { allChangesAtom } from \"./changes.state\";\nimport { AnyChange, Change, UnversionedChange } from \"./Change\";\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: ReadonlyArray<AnyChange>;\n}\n\nexport const changeListsAtom = jotaiAtom<ChangeListObj[]>([\n  {\n    id: \"some-UUID\",\n    name: \"Changes\",\n    comment: \"last modified commit message\",\n    changes: [],\n    active: true,\n  },\n  {\n    id: \"some-other-UUID\",\n    name: \"Some other changelist\",\n    comment: \"Some empty changelist for testing\",\n    changes: [],\n    active: false,\n  },\n]);\n\nexport const activeChangeListState = jotaiAtom<ChangeListObj | null>(\n  (get) => get(changeListsAtom).find((changeList) => changeList.active) ?? null\n);\n\nexport const unversionedChangesAtom = jotaiAtom<UnversionedChange[]>((get) =>\n  get(allChangesAtom).filter(Change.isUnversioned)\n);\n\nexport const useSetActiveChangeList = () =>\n  useAtomCallback(\n    useCallback((get, set, changeListId: string) => {\n      const changeLists = get(changeListsAtom);\n      const targetChangeList = changeLists.find(\n        ({ id }) => id === changeListId\n      );\n      if (targetChangeList) {\n        set(\n          changeListsAtom,\n          changeLists.map((changeList) => ({\n            ...changeList,\n            active: changeList === targetChangeList,\n          }))\n        );\n      }\n      // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n    }, [])\n  );\n\n/**\n * Helper component that keeps change lists state up-to-date with respect to changes.\n * It must be rendered at top level. Reasons for the unconventional implementation as a component\n * that must be rendered in top level:\n * - The *effects* API in recoil doesn't allow for this use case where one atom needs to be kept valid/up-to-date\n *   based on another atom. Changes here is the source of truth. Any removed changes should be removed from\n *   changelist(s) too, and any new change should be added to the active changelist\n * - The state of change lists is **not** just a 1:1 function of changes. So it can't be a selector. How changes are\n *   grouped in different lists is something that must have its own source of truth, but it needs validation,\n *   every time changes are added/removed.\n *   TODO(jotai): The limitation mentioned above doesn't exist in Jotai. Refactor.\n */\nexport function SyncChangeListsState() {\n  const changes = useAtomValue(allChangesAtom);\n  const setChangeLists = useSetAtom(changeListsAtom);\n  useEffect(() => {\n    setChangeLists((changeLists) => {\n      const trackedChanges = changes.filter(\n        (change) => !Change.isUnversioned(change)\n      );\n      const updatedChangeLists = changeLists.map((changeList) => {\n        return {\n          ...changeList,\n          changes: changeList.changes\n            .map((change) =>\n              trackedChanges.find((aChange) => Change.equals(aChange, change))\n            )\n            .filter(notNull),\n        };\n      });\n      const existingChanges = updatedChangeLists.flatMap(\n        ({ changes }) => changes\n      );\n      const newChanges = trackedChanges.filter(\n        (change) =>\n          !existingChanges.find((anExistingChange) =>\n            Change.equals(change, anExistingChange)\n          )\n      );\n      const activeChangeList =\n        updatedChangeLists.find(({ active }) => active) ??\n        updatedChangeLists[0];\n      activeChangeList.changes.push(...newChanges);\n      return updatedChangeLists;\n    });\n  }, [changes]);\n  return null;\n}\n","import { identity, uniq } from \"ramda\";\nimport { getParentPaths } from \"../file-utils\";\n\nexport interface DirectoryNode {\n  type: \"directory\";\n  dirPath: string;\n  parentNodePath: string;\n  children: ReadonlyArray<any>;\n}\n\ntype GroupByDirectorAdapter<T, D extends DirectoryNode> = {\n  shouldCollapseDirectories?: boolean;\n  getPath: (node: T) => string;\n  /**\n   * Maps each processed node. E.g. can be used to enrich nodes with grouping metadata.\n   * @example\n   * ```\n   * mapNode: (node) => ({...node, isGroupedByDirectory: true})\n   * ```\n   */\n  mapNode?: (node: T) => T;\n  createDirectoryNode?: (dirNode: DirectoryNode) => D;\n};\n/**\n * Exported only for tests.\n * @internal\n */\nexport const createGroupByDirectory =\n  <T, D extends DirectoryNode>({\n    getPath,\n    mapNode = identity,\n    createDirectoryNode = (i) => i as D,\n    shouldCollapseDirectories = false,\n  }: GroupByDirectorAdapter<T, D>) =>\n  (nodes: ReadonlyArray<T>): readonly D[] => {\n    const pathToNodeCache: Record<string, D> = {};\n    const rootDirNodes = nodes.map(mapNode).map((node) => {\n      const filepath = getPath(node);\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(\n        filepath.startsWith(\"/\") ? filepath : `/${filepath}`\n      ).reduce((prevNode: D | T, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = createDirectoryNode({\n            type: \"directory\",\n            dirPath,\n            parentNodePath: \"\",\n            children: [],\n          });\n        }\n        if (isDirectoryNode(prevNode)) {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      }, node) as D; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const directoryNodes = uniq(rootDirNodes);\n    return shouldCollapseDirectories\n      ? directoryNodes.map((node) =>\n          collapseDirectories(createDirectoryNode, node)\n        )\n      : directoryNodes;\n  };\n\nfunction isDirectoryNode<T, D extends DirectoryNode>(node: D | T): node is D {\n  return \"type\" in node && node.type === \"directory\";\n}\n\nfunction collapseDirectories<T, D extends DirectoryNode>(\n  createDirectorNode: Required<\n    GroupByDirectorAdapter<T, any>\n  >[\"createDirectoryNode\"],\n  dirNode: D\n): D {\n  let { children, dirPath, parentNodePath } = dirNode;\n  if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n    dirPath = dirNode.children[0].dirPath;\n    children = dirNode.children[0].children.map((child: D | T) =>\n      isDirectoryNode<T, D>(child)\n        ? collapseDirectories<T, D>(createDirectorNode, {\n            ...child,\n            parentNodePath: dirPath,\n          })\n        : child\n    );\n    return collapseDirectories<T, D>(\n      createDirectorNode,\n      createDirectorNode({\n        type: \"directory\",\n        dirPath,\n        parentNodePath,\n        children,\n      })\n    );\n  }\n  return {\n    ...dirNode,\n    children: children.map((child) =>\n      isDirectoryNode(child)\n        ? collapseDirectories<T, D>(createDirectorNode, child)\n        : child\n    ),\n  };\n}\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  ADD_UNVERSIONED: \"ChangesView.AddUnversioned\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n  GROUP_BY_DIRECTORY: \"ChangesView.GroupBy.Directory\",\n  GIT_ADD: \"Git.Add\",\n  GIT_INIT: \"Git.Init\",\n  GIT_CLONE: \"Git.Clone\",\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n\n  GIT_LOG_HIDE_BRANCHES: \"Git.Log.Hide.Branches\",\n  GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH:\n    \"Git.Log.Branches.Navigate.Log.To.Selected.Branch\",\n  GIT_UPDATE_SELECTED: \"Git.Update.Selected\",\n\n  FOCUS_TEXT_FILTER: \"Vcs.Log.FocusTextFilter\",\n  MATCH_CASE: \"Vcs.Log.MatchCaseAction\",\n  REG_EXP: \"Vcs.Log.EnableFilterByRegexAction\",\n  COPY_REVISION_NUMBER: \"Vcs.CopyRevisionNumberAction\",\n  LOG_REFRESH: \"Vcs.Log.Refresh\",\n  SHOW_DETAILS: \"Vcs.Log.ShowDetailsAction\",\n  SHOW_DIFF_PREVIEW: \"Vcs.Log.ShowDiffPreview\",\n  PRESENTATION_SETTINGS: \"Vcs.PresentationSettings\",\n  FILE_HISTORY_PRESENTATION_SETTINGS: \"Vcs.FileHistory.PresentationSettings\",\n\n  CopyPathFromRepositoryRootProvider: \"CopyPathFromRepositoryRootProvider\",\n};\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { AnyChange, Change } from \"../Change\";\n\nexport interface ChangesTreeNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface ChangesTreeGroupNode<\n  T extends string,\n  C extends ChangesTreeNode<any> = ChangesTreeNode<T>\n> extends ChangesTreeNode<T> {\n  children: ReadonlyArray<C>;\n}\n\nexport type GroupNodes<T extends ChangesTreeNode<any>> = Extract<\n  T,\n  ChangesTreeGroupNode<any>\n>;\n\nexport interface ChangeNode extends ChangesTreeNode<\"change\"> {\n  change: AnyChange;\n  /**\n   * Whether to show the file path in front of the file name (in muted UI)\n   */\n  showPath?: boolean;\n}\n\nexport interface DirectoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"directory\", C> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"repo\", C> {\n  repository: VcsDirectoryMapping;\n}\n\n/**\n * Extends the type of changes tree nodes with additional (group) node types.\n */\nexport type ExtendedChangesTreeNode<G extends ChangesTreeGroupNode<any>> =\n  | ChangeNode\n  | RepositoryNode<G>\n  | DirectoryNode<G>\n  | G;\n\nexport type DefaultChangesTreeNode = ExtendedChangesTreeNode<never>;\nexport const changesTreeNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\n\nexport const getNodeKeyForChange = (change: AnyChange) =>\n  changesTreeNodeKey(\"change\", Change.path(change));\nexport const changeNode = (change: AnyChange, showPath = true): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n  showPath,\n});\nexport const directoryNode = <G extends ChangesTreeNode<any>>(\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly G[] = [],\n  keyPrefix: string = \"\"\n): DirectoryNode<G> => ({\n  type: \"directory\",\n  key: keyPrefix + changesTreeNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = <G extends ChangesTreeNode<any>>(\n  repository: VcsDirectoryMapping,\n  children: G[] = []\n): RepositoryNode<G> => ({\n  type: \"repo\",\n  key: changesTreeNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = <T extends ChangesTreeNode<any>>(\n  node: T\n): node is GroupNodes<T> => \"children\" in node;\nexport const isChangeNode = (node: ChangesTreeNode<any>): node is ChangeNode =>\n  node.type === \"change\";\nexport const isDirectoryNode = <G extends ChangesTreeNode<any>>(\n  node: ChangesTreeNode<any>\n): node is DirectoryNode<G> => node.type === \"directory\";\n\nexport const getChildren = <\n  T extends ChangesTreeNode<any> = DefaultChangesTreeNode\n>(\n  node: T\n): null | GroupNodes<T>[\"children\"] =>\n  isGroupNode(node) ? node.children : null;\n","import { atom, Atom, Getter } from \"jotai\";\n\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport { createGroupByDirectory } from \"../../../tree-utils/groupByDirectory\";\nimport { isAtom, MaybeAtom } from \"../../../atom-utils/isAtom\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { Change } from \"../Change\";\nimport {\n  changeNode,\n  ChangeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  directoryNode,\n  DirectoryNode,\n  isChangeNode,\n  isGroupNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./ChangeTreeNode\";\n\nexport type GroupFn<T extends ChangesTreeGroupNode<any>> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<\n  T extends ChangesTreeGroupNode<any>,\n  I = string\n> {\n  id: I;\n  title: string;\n  isAvailable: MaybeAtom<boolean>;\n  useShortcutOf?: string;\n  groupFn: MaybeAtom<GroupFn<T>>;\n}\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: atom((get) => get(vcsRootsAtom).length > 1),\n  groupFn: atom((get) => (nodes: ReadonlyArray<ChangeNode>) => {\n    const repos = get(vcsRootsAtom);\n    return repos.map(\n      (repository): RepositoryNode =>\n        repositoryNode(\n          repository,\n          nodes.filter((node) =>\n            Change.path(node.change)?.startsWith(repository.dir)\n          )\n        )\n    );\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: true,\n  useShortcutOf: VcsActionIds.GROUP_BY_DIRECTORY,\n  groupFn: createGroupByDirectory<ChangeNode, DirectoryNode>({\n    shouldCollapseDirectories: true,\n    createDirectoryNode: ({ dirPath, parentNodePath, children }) =>\n      directoryNode(dirPath, parentNodePath, children),\n    mapNode: (node) => changeNode(node.change, false),\n    getPath: (node) => Change.path(node.change),\n  }),\n};\n\nexport const defaultChangeGroupings: ReadonlyArray<\n  ChangeGrouping<DirectoryNode | RepositoryNode, \"directory\" | \"repository\">\n> = [repositoryGrouping, directoryGrouping];\n\nexport const defaultChangeGroupingsAtom = atom<\n  ReadonlyArray<Omit<(typeof defaultChangeGroupings)[number], \"isAvailable\">>\n>((get) =>\n  defaultChangeGroupings.filter((grouping) =>\n    isAtom(grouping.isAvailable)\n      ? get(grouping.isAvailable)\n      : grouping.isAvailable\n  )\n);\n\nexport const recursiveGrouping = <T extends ChangesTreeNode<any>>(\n  groupingFns: Array<GroupFn<any>> /* Typing could be improved? */,\n  nodes: ReadonlyArray<ChangeNode>\n): ReadonlyArray<T> | ReadonlyArray<ChangeNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes;\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n\n  const changeNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isChangeNode\n  );\n  const groupNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isGroupNode\n  );\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\n/**\n * returns a function that accepts a `keyPrefix` and creates change grouping function based on the\n * passed {@param groupings}, in a way that the key of each grouping node is prefixed with the `keyPrefix`.\n * Useful for grouping changes under some root nodes with potentially overlapping groups. E.g. the same\n * folder or repository node may appear under different changeLists.\n */\nexport const getPrefixedChangesGroupFn =\n  <G extends ChangesTreeGroupNode<any>>({\n    get,\n    isActive,\n    groupings,\n  }: {\n    get: Getter;\n    isActive: (groupingId: string) => MaybeAtom<boolean>;\n    groupings: ReadonlyArray<ChangeGrouping<G, any>>;\n  }) =>\n  (keyPrefix: string) => {\n    const resolve = <T>(value: Atom<T> | T): T =>\n      isAtom(value) ? get(value) : value;\n    const groupFns = groupings\n      .filter(\n        ({ id, isAvailable }) => resolve(isAvailable) && resolve(isActive(id))\n      )\n      .map(({ groupFn }) => {\n        return resolve(groupFn);\n      })\n      .map<GroupFn<any>>((groupFn) =>\n        keyPrefix\n          ? (...args) =>\n              groupFn(...args).map((group) => ({\n                ...group,\n                key: `${keyPrefix}:${group.key}`,\n              }))\n          : groupFn\n      );\n    return (changes: readonly ChangeNode[]) =>\n      recursiveGrouping<G>(groupFns, changes);\n  };\n\nexport const getChangesGroupFn = (\n  ...args: Parameters<typeof getPrefixedChangesGroupFn>\n) => getPrefixedChangesGroupFn(...args)(\"\");\n","import { atom } from \"jotai\";\nimport {\n  changesTreeNodesAtom,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { AnyChange } from \"../Change\";\n\nconst isOpenAtom = atom<boolean>(false);\nconst windowBoundsAtom = atom<Partial<Bounds>>({ height: 500 });\nconst initiallyIncludedChangesAtom = atom<ReadonlyArray<AnyChange>>([]);\nconst rootNodesAtom = atom((get) => {\n  const selectedChanges = get(initiallyIncludedChangesAtom);\n  const { rootNodes } = get(changesTreeNodesAtom);\n  const includedRootNodes = rootNodes.filter(\n    (node) =>\n      node.type === \"changelist\" &&\n      selectedChanges.some((change) => node.changeList.changes.includes(change))\n  );\n  if (includedRootNodes.length === 0) {\n    return rootNodes.filter(\n      (node) => node.type === \"changelist\" && node.changeList.active\n    );\n  }\n  return includedRootNodes;\n});\n\nconst initiallyExpandedKeysAtom = atom((get) => {\n  const includedChanges = get(initiallyIncludedChangesAtom);\n  const nodes = get(rootNodesAtom);\n  const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n    (node) => (isGroupNode(node) ? node.children : null),\n    (node) => node.key,\n    nodes,\n    includedChanges.map(getNodeKeyForChange)\n  );\n  return new Set(\n    expandedKeys.length\n      ? expandedKeys\n      : getExpandAllKeys<ChangesViewTreeNode>(\n          (node) => (isGroupNode(node) ? node.children : null),\n          (node) => node.key,\n          nodes\n        )\n  );\n});\n\nexport const rollbackViewState = {\n  isOpenAtom,\n  windowBoundsAtom,\n  initiallyExpandedKeysAtom,\n  initiallyIncludedChangesAtom,\n  rootNodesAtom,\n};\n","import { Key } from \"react\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { ChangesTreeNode, getChildren } from \"./ChangeTreeNode\";\n\nexport function changesTreeNodesResult<\n  T extends ReadonlyArray<ChangesTreeNode<any>>\n>(\n  rootNodes: T\n): {\n  rootNodes: ReadonlyArray<T[number]>;\n  byKey: Map<Key, T[number]>;\n  expandAllKeys: Set<Key>;\n  fileCountsMap: Map<Key, number>;\n} {\n  const fileCountsMap = new Map();\n  const byKey = new Map();\n  const expandAllKeys = new Set<Key>();\n\n  dfsVisit<ChangesTreeNode<any>, number>(\n    getChildren,\n    (node, childrenFileCount) => {\n      byKey.set(node.key, node);\n      if (\"children\" in node) {\n        expandAllKeys.add(node.key);\n      }\n      if (!childrenFileCount) {\n        return 1;\n      }\n      const fileCount = childrenFileCount.reduce(\n        (total, count) => total + count,\n        0\n      );\n      fileCountsMap.set(node.key, fileCount);\n      return fileCount;\n    },\n    rootNodes\n  );\n  return { rootNodes, fileCountsMap, byKey, expandAllKeys };\n}\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, atomWithDefault } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  ChangeListObj,\n  changeListsAtom,\n  unversionedChangesAtom,\n} from \"../change-lists.state\";\nimport {\n  defaultChangeGroupings,\n  defaultChangeGroupingsAtom,\n  getPrefixedChangesGroupFn,\n  GroupFn,\n} from \"../ChangesTree/changesGroupings\";\nimport {\n  bfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsAtom } from \"../../../Project/project.state\";\nimport {\n  ChangeNode,\n  changeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n  getNodeKeyForChange,\n  GroupNodes,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { Task } from \"../../../tasks\";\nimport { AnyChange, Change } from \"../Change\";\nimport { changesTreeNodesResult } from \"../ChangesTree/changesTreeNodesResult\";\nimport { allChangesAtom } from \"../changes.state\";\nimport { withAtomEffect } from \"jotai-effect\";\n\nexport interface ChangeListNode<\n  C extends ChangesTreeNode<any> = ChangesViewTreeNode\n> extends ChangesTreeGroupNode<\"changelist\", C> {\n  changeList: ChangeListObj;\n}\nexport interface UnversionedChangesNode<\n  C extends ChangesTreeNode<any> = ChangeNode\n> extends ChangesTreeGroupNode<\"unversioned\", C> {}\n\nexport type ChangesViewTreeNode = ExtendedChangesTreeNode<\n  ChangeListNode | UnversionedChangesNode\n>;\n\nexport const changeListNode = (\n  changeList: ChangeListObj\n): ChangeListNode<ChangeNode> => ({\n  type: \"changelist\",\n  key: changesTreeNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: changeList.changes.map((change) => changeNode(change)),\n});\n\nexport const showIgnoredFilesAtom = atom(false);\n\nexport const showRelatedFilesAtom = atom(false);\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = (typeof defaultChangeGroupings)[number][\"id\"];\n\nexport const changesGroupingActiveState = atomFamily(\n  (name: string) => atom(true) // it's false in IntelliJ\n);\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysAtom = atom<Selection>(new Set<Key>([]));\n\n/**\n * Same as {@link selectedKeysAtom}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysAtom = atom<Set<Key>>((get) => {\n  const selection = get(selectedKeysAtom);\n  if (selection === \"all\") {\n    const { rootNodes } = get(changesTreeNodesAtom);\n    return new Set(\n      bfsVisit<ChangesViewTreeNode, ChangesViewTreeNode[]>(\n        (node) => (\"children\" in node ? node.children : []),\n        (node, parentValue) => {\n          const nodes = parentValue ?? [];\n          nodes.push(node);\n          return nodes;\n        },\n        rootNodes\n      )\n        .flat()\n        .map((node) => node.key)\n    );\n  }\n  return selection;\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysAtom}\n */\nconst selectedNodesAtom = atom<ReadonlySet<ChangesViewTreeNode>>((get) => {\n  const selectedKeys = get(resolvedSelectedKeysAtom);\n  const { byKey } = get(changesTreeNodesAtom);\n  return new Set(\n    [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n  );\n});\n\nexport const changesUnderSelectedKeysAtom = atom<ReadonlySet<AnyChange>>(\n  (get) => {\n    const selectedNodes = get(selectedNodesAtom);\n    const allChanges: Set<AnyChange> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  }\n);\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = atom<ReadonlySet<ChangeListObj>>(\n  (get) => {\n    const selectedNodes = get(selectedNodesAtom);\n    const allChangeLists = get(changeListsAtom);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  }\n);\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysAtom = atom<Set<string>>(new Set<string>([]));\n\nexport const includedChangesAtom = atom<ReadonlyArray<AnyChange>>((get) => {\n  const includedChangeKeys = get(includedChangeKeysAtom);\n  const allChanges = get(allChangesAtom);\n  return allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelectionAtom = atom<\n  NestedSelectionState<ChangesViewTreeNode>,\n  [(currentValue: Set<string>) => Set<string>],\n  void\n>(\n  (get, { setSelf }) => {\n    const { rootNodes } = get(changesTreeNodesAtom);\n    const includedChangeKeys = get(includedChangeKeysAtom);\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface<string>(setSelf),\n      },\n      {\n        rootNodes,\n        getChildren: (item: ChangesViewTreeNode) =>\n          isGroupNode<ChangesViewTreeNode>(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n  (_get, set, updater: (currentValue: Set<string>) => Set<string>) => {\n    set(includedChangeKeysAtom, updater);\n  }\n);\n\nexport const expandedKeysAtom = atomWithDefault(\n  (get) =>\n    new Set<Key>(\n      get(changesTreeNodesAtom)\n        .rootNodes.map((node) => [\n          node.key,\n          ...node.children.map((child) => child.key),\n        ])\n        .flat()\n    )\n);\n\nexport const changesViewGroupingsState = atom((get) =>\n  get(defaultChangeGroupingsAtom).map((grouping) => ({\n    ...grouping,\n    isActive: get(changesGroupingActiveState(grouping.id)),\n  }))\n);\n\nconst groupChildren = <\n  T extends ChangesTreeGroupNode<any, ChangeNode>,\n  G extends ChangesTreeNode<any>\n>(\n  node: T,\n  groupFn: (\n    nodes: ReadonlyArray<ChangeNode>\n  ) => ReturnType<GroupFn<GroupNodes<G>>> | ReadonlyArray<ChangeNode>\n) => ({\n  ...node,\n  children: groupFn(node.children),\n});\n\nexport const changesTreeNodesAtom = atom<{\n  rootNodes: ReadonlyArray<ChangeListNode | UnversionedChangesNode>;\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, ChangesViewTreeNode>;\n}>((get) => {\n  const changeListNodes = sortBy(\n    ({ active }) => !active,\n    get(changeListsAtom)\n  ).map(changeListNode);\n  const prefixedGroupFn = getPrefixedChangesGroupFn({\n    get,\n    groupings: defaultChangeGroupings,\n    isActive: changesGroupingActiveState,\n  });\n  const unversionedChanges = get(unversionedChangesAtom);\n  const rootNodes: Array<ChangeListNode | UnversionedChangesNode> =\n    changeListNodes.map((changeListNode) =>\n      groupChildren(changeListNode, prefixedGroupFn(changeListNode.key))\n    );\n  if (unversionedChanges.length > 0) {\n    const unversionedChangesNode: UnversionedChangesNode = {\n      key: \"unversioned\",\n      type: \"unversioned\",\n      children: unversionedChanges.map((change) => changeNode(change)),\n    };\n    rootNodes.push(\n      groupChildren(unversionedChangesNode, prefixedGroupFn(\"unversioned\"))\n    );\n  }\n  return changesTreeNodesResult(rootNodes);\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily(\n  (orientation: \"horizontal\" | \"vertical\") =>\n    atom(orientation === \"horizontal\" ? 0.4 : 0.3)\n);\n/**\n * Whether --amend should be used for commit.\n */\n// TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n// it should add a record to the commit message history and switch the message. When toggled to false,\n// last entry in history should be back again. There is currently no history :D\nexport const amendCommitAtom = atom(false);\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageAtom = atom(\"\");\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageAtom = atom(\"\");\n\nexport const commitTaskIdAtom = atom<Task[\"id\"] | null>(null);\n\nexport const changesFromActivePathsAtom = atom((get) => {\n  const activePaths = get(activePathsAtom);\n  return get(allChangesAtom).filter((change) =>\n    activePaths.some((activePath) => Change.path(change).startsWith(activePath))\n  );\n});\n/**\n * Atom callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = (\n  get: Getter,\n  set: Setter,\n  /**\n   * paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  paths?: string[]\n) => {\n  const changes = paths\n    ? get(allChangesAtom).filter((change) =>\n        paths.some((activePath) => Change.path(change).startsWith(activePath))\n      )\n    : get(changesFromActivePathsAtom);\n\n  const includedChangeKeys = changes.map(getNodeKeyForChange);\n  set(includedChangeKeysAtom, new Set(includedChangeKeys));\n  if (includedChangeKeys.length > 0) {\n    const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n      (node) => (isGroupNode<ChangesViewTreeNode>(node) ? node.children : null),\n      (node) => node.key,\n      get(changesTreeNodesAtom).rootNodes,\n      includedChangeKeys\n    );\n    set(expandedKeysAtom, (currentExpandedKeys) => {\n      return new Set([\n        ...(currentExpandedKeys ?? new Set<Key>()),\n        ...expandedKeys,\n      ]);\n    });\n    set(selectedKeysAtom, new Set([includedChangeKeys[0]]));\n  }\n};\n\n/**\n * If contextual is true, changes related to {@link activePathsAtom} will be preselected.\n */\nexport const openRollbackWindowForSelectionCallback = (\n  get: Getter,\n  set: Setter,\n  contextual = true\n) => {\n  const activePaths = get(activePathsAtom);\n  const changesUnderSelection = get(changesUnderSelectedKeysAtom);\n  const changesBasedOnActivePaths =\n    contextual && activePaths.length > 0\n      ? get(changesFromActivePathsAtom)\n      : null;\n  set(\n    rollbackViewState.initiallyIncludedChangesAtom,\n    changesBasedOnActivePaths ?? [...changesUnderSelection]\n  );\n  set(rollbackViewState.isOpenAtom, true);\n};\n","import { useAtomValue } from \"jotai\";\nimport { selectedKeysAtom } from \"./ChangesView.state\";\nimport {\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useAtomValue(selectedKeysAtom);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Changes actions\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(CommonActionId.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: readonly T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { equals, groupBy } from \"ramda\";\nimport { useCallback } from \"react\";\nimport { atomFamily, useAtomCallback } from \"jotai/utils\";\nimport { atom, Getter, Setter, useAtomValue } from \"jotai\";\nimport { focusAtom } from \"jotai-optics\";\n\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\nimport { z } from \"zod\";\n\nimport { fs } from \"../../fs/fs\";\nimport { atomWithRefresh } from \"../../atom-utils/atomWithRefresh\";\nimport { vcsFootForFileAtom, vcsRootsAtom } from \"../file-status.state\";\nimport { dirContentAtom, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsAtom } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { atomWithPersistence } from \"../../persistence/atomWithPersistence\";\nimport { list, map } from \"../../persistence/schema-utils\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\nexport type BranchType = \"LOCAL\" | \"REMOTE\";\n\nexport type BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesAtom = atomFamily((repoRoot: string) =>\n  atomWithRefresh(async ({}): Promise<LocalBranch[]> => {\n    const branches = await git.listBranches({ fs, dir: repoRoot });\n    return Promise.all(\n      branches.map(async (branch) => ({\n        name: branch,\n        trackingBranch: await getTrackingBranch({\n          fs,\n          dir: repoRoot,\n          localBranchName: branch,\n        }),\n      }))\n    );\n  })\n);\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesAtoms = atomFamily((repoRoot: string) =>\n  atomWithRefresh(async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  })\n);\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesAtom = atomFamily((repoRoot: string) =>\n  atomWithRefresh(async (get) => {\n    const currentBranchName = await get(repoCurrentBranchNameAtom(repoRoot));\n    let localBranches = await get(repoLocalBranchesAtom(repoRoot));\n    if (localBranches.length === 0 && currentBranchName) {\n      // When a repo is initialized and before the first commit, no branch is returned when listing branches.\n      // See more: https://github.com/isomorphic-git/isomorphic-git/issues/1650\n      localBranches = localBranches.concat({\n        name: currentBranchName,\n        trackingBranch: null,\n      });\n    }\n    return {\n      repoRoot,\n      currentBranch:\n        localBranches.find((branch) => branch.name === currentBranchName) ||\n        null,\n      localBranches: localBranches,\n      remoteBranches: await get(repoRemoteBranchesAtoms(repoRoot)),\n    };\n  })\n);\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameAtom = atomFamily((repoRoot: string) =>\n  atomWithRefresh(() => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  })\n);\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesAtom = atom(async (get): Promise<RepoBranches[]> => {\n  const repoRoots = get(vcsRootsAtom);\n  return Promise.all(\n    repoRoots.map(({ dir: repoRoot }) => get(repoBranchesAtom(repoRoot)))\n  );\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathAtoms = atomFamily((filepath: string) =>\n  atom(async (get): Promise<string | null> => {\n    const root = await get(vcsFootForFileAtom(filepath));\n    const repoRoot = root ? await get(repoBranchesAtom(root)) : null;\n    console.log(`repo root for ${filepath}`, root, root && repoRoot);\n    return root ? repoRoot?.currentBranch?.name || null : null;\n  })\n);\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    branchStorage?.map.entry.flatMap<BranchInfo>((entry) =>\n      entry?.value.list[\"branch-info\"].map(\n        ({ \"@source\": branchName, \"@repo\": repoRoot }) => ({\n          branchType: entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction writeBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      \"@type\": branchType as BranchType,\n      value: {\n        list: {\n          \"branch-info\": branches.map((branch) => ({\n            \"@repo\": branch.repoRoot,\n            \"@source\": branch.branchName,\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: {\n      entry: entries,\n    },\n  };\n}\n\nconst branchStorage = z.object({\n  \"branch-storage\": z.object({\n    map: map(\n      z.enum([\"LOCAL\", \"REMOTE\"]),\n      z.object({\n        list: list(\n          z.object({\n            \"@repo\": z.string(),\n            \"@source\": z.string(),\n          }),\n          \"branch-info\"\n        ),\n      })\n    ),\n  }),\n});\n\ntype BranchStorage = (typeof branchStorage)[\"_output\"][\"branch-storage\"];\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\nexport const gitSettingsSchema = z\n  .object({\n    \"favorite-branches\": branchStorage.optional(),\n    \"exclude-from-favorite\": branchStorage.optional(),\n  })\n  .optional();\n\ntype GitSettings = {\n  branches: ReadonlyArray<BranchInfo>;\n  excludedBranches: ReadonlyArray<BranchInfo>;\n};\n\nconst gitSettingsAtom = atomWithPersistence(\n  { branches: [], excludedBranches: [] },\n  {\n    schema: gitSettingsSchema,\n    componentName: \"Git.Settings\",\n    read: (componentState): GitSettings => {\n      return {\n        branches: readBranchStorage(\n          componentState?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        ),\n        excludedBranches: readBranchStorage(\n          componentState?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        ),\n      };\n    },\n    write: (value, state) => {\n      const newState = {\n        ...state,\n      };\n      // empty objects or arrays convert into empty tag, which then gets deserialized as string\n      // it's not convenient to make sure empty objects are not included, and it's not even type safe\n      // so maybe a better solution would be to handle deserialization from empty string too, with a custom\n      // object() (similar to maybeArray utility), that would be able to deserialize from empty string,\n      // and would used instead of z.object().\n      // Type safety could also be implemented the same way it's done for maybeArray, to make sure everywhere that\n      // an object with all-optional properties exist, empty string is also allowed in the input type.\n      if (value.branches.length > 0) {\n        newState[\"favorite-branches\"] = {\n          \"branch-storage\": writeBranchStorage(value.branches),\n        };\n      } else {\n        delete newState[\"favorite-branches\"];\n      }\n      if (value.excludedBranches.length > 0) {\n        newState[\"exclude-from-favorite\"] = {\n          \"branch-storage\": writeBranchStorage(value.excludedBranches),\n        };\n      } else {\n        delete newState[\"exclude-from-favorite\"];\n      }\n      return newState;\n    },\n  }\n);\n\nconst favoriteBranchesAtom = focusAtom(gitSettingsAtom, (optic) =>\n  optic.prop(\"branches\")\n);\n\nconst excludedFromFavoriteBranchesAtom = focusAtom(gitSettingsAtom, (optic) =>\n  optic.prop(\"excludedBranches\")\n);\n\nexport const isFavoriteBranchAtoms = atomFamily(\n  (branchInfo: BranchInfo) =>\n    atom((get) => {\n      return isFavorite(\n        get(favoriteBranchesAtom),\n        get(excludedFromFavoriteBranchesAtom),\n        branchInfo\n      );\n    }),\n  equals\n);\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useAtomCallback(\n    useCallback(\n      (\n        get,\n        set,\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          get(favoriteBranchesAtom),\n          get(excludedFromFavoriteBranchesAtom),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesAtom, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesAtom, add);\n          }\n        } else {\n          set(favoriteBranchesAtom, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesAtom, add);\n          }\n        }\n      },\n      []\n    )\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useAtomValue(favoriteBranchesAtom);\n  const excludedFromFavoriteBranches = useAtomValue(\n    excludedFromFavoriteBranchesAtom\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useAtomCallback(\n    useCallback(\n      (\n        _get,\n        set,\n        repoRoot: string,\n        branchName: string,\n        checkout: boolean = true\n      ) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            set(repoBranchesAtom(repoRoot));\n          }\n        );\n      },\n      []\n    )\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useAtomCallback(\n    useCallback(\n      async (\n        get,\n        set,\n        repoRoot: string,\n        branchName: string,\n        newBranchName: string\n      ) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        set(repoBranchesAtom(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            get(favoriteBranchesAtom),\n            get(excludedFromFavoriteBranchesAtom),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n      []\n    )\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useAtomCallback(\n    useCallback(\n      async (\n        get: Getter,\n        set: Setter,\n        repoRoot: string,\n        branchName: string,\n        remote?: string\n      ) => {\n        const reloadFileFromDisk = reloadFileFromDiskCallback(get, set);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        console.log(`checked out branch ${branchName}`);\n        set(repoBranchesAtom(repoRoot));\n        set(dirContentAtom(repoRoot));\n        const openedFiles = get(editorTabsAtom);\n        const existingOpenedFile = await asyncFilter(async ({ filePath }) => {\n          const exists = await fs.promises.exists(filePath); // should it be fs directly?\n          // the file content for files not open in the editor also need to be updated. TODO(fs.watch)\n          console.log(`updating the content of the file ${filePath}`, exists);\n          if (exists) {\n            await reloadFileFromDisk(filePath);\n          }\n          return exists;\n        }, openedFiles);\n        set(editorTabsAtom, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n      []\n    )\n  );\n}\n\nexport function useDeleteBranch() {\n  return useAtomCallback(\n    useCallback((_get, set, repoRoot: string, branchName: string) => {\n      return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n        set(repoBranchesAtom(repoRoot));\n      });\n    }, [])\n  );\n}\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathAtoms } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useAtomValue(branchForPathAtoms(repo.dir));\n  return <>{branch}</>;\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React, { ForwardedRef, HTMLAttributes } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { vcsRootsAtom } from \"../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.2rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useAtomValue(vcsRootsAtom).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = React.forwardRef(\n  (\n    {\n      rootPath,\n      ...props\n    }: {\n      rootPath: string;\n    } & HTMLAttributes<HTMLSpanElement>,\n    ref: ForwardedRef<HTMLElement>\n  ) => (\n    <StyledRepoColorSquare\n      ref={ref}\n      {...props}\n      style={{ ...props.style, backgroundColor: useRepoRootColor(rootPath) }}\n    />\n  )\n);\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(\n      // FIXME: color-mix algorithm used here seems to be different from how colors are mixed in the reference impl.\n      `color-mix(in srgb, ${theme.color(\n        \"VersionControl.Log.Commit.currentBranchBackground\",\n        theme.dark ? \"rgb(63, 71, 73)\" : \"rgb(228, 250, 255)\"\n      )}, ${theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )} ${\n        (theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08) * 100\n      }%)`\n    )};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport path from \"path\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { RepoColorIcon } from \"../StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"../StyledCurrentBranchTag\";\nimport { Change } from \"../Change\";\nimport {\n  ChangeNode,\n  ChangesTreeNode,\n  DefaultChangesTreeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./ChangeTreeNode\";\nimport { StatusColor } from \"../../FileStatusColor\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\nexport type NodeRenderer<T extends ChangesTreeNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nexport function formatFileCount(fileCount: number) {\n  return fileCountMsg.format({ fileCount });\n}\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeRenderer: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  return (\n    <ItemLayout.Hint>\n      {node.showPath && path.dirname(Change.path(node.change))}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeRenderer: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(Change.path(node.change)),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(Change.path(node.change))} />\n      <StatusColor status={Change.fileStatus(node.change)}>\n        <HighlightedTextValue />\n      </StatusColor>\n      {Change.isRename(node.change)\n        ? ` - renamed from ${path.basename(node.change.before.path)}`\n        : Change.isMove(node.change) &&\n          ` - moved from ${path\n            .relative(\n              path.dirname(node.change.after.path),\n              path.dirname(node.change.before.path)\n            )\n            .replace(/(\\.\\.\\/){2,}[!.]/g, \"..\")}/`}\n\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\ntype NodeRenderersMap<T extends ChangesTreeNode<any>> = {\n  [type in T[\"type\"]]: NodeRenderer<T & { type: type }>;\n};\n\nconst defaultNodeRenderers: NodeRenderersMap<DefaultChangesTreeNode> = {\n  repo: repoNodeRenderer,\n  directory: directoryNodeRenderer,\n  change: changeNodeRenderer,\n};\n\nexport const simpleGroupingRenderer =\n  <T extends ChangesTreeNode<any>>(\n    getText: (node: T) => string\n  ): NodeRenderer<T> =>\n  (node, { fileCount }) => ({\n    textValue: getText(node),\n    rendered: (\n      <ItemLayout>\n        <HighlightedTextValue />\n        <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      </ItemLayout>\n    ),\n  });\n\nexport const createChangesTreeNodeRenderer = <T extends ChangesTreeNode<any>>(\n  renderers: Omit<\n    NodeRenderersMap<T>,\n    keyof NodeRenderersMap<DefaultChangesTreeNode>\n  >,\n  /**\n   * Not so nice signature, but couldn't make it work with a single argument in a way that:\n   * - allows for optionally overriding the default renderers\n   * - infers the type of the resulting renderer based on additional keys passed in `renderers`\n   */\n  defaultRendererOverrides?: Partial<NodeRenderersMap<DefaultChangesTreeNode>>\n) => {\n  const nodeRenderers: NodeRenderersMap<T> = {\n    ...defaultNodeRenderers,\n    ...defaultRendererOverrides,\n    ...renderers,\n  };\n  const getItemProps = ({\n    node,\n    fileCountsMap,\n  }: {\n    node: T;\n    fileCountsMap: Map<Key, number>;\n  }): ItemProps<T> & { key: Key } => {\n    // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n    // to node types\n    const nodeRenderer: NodeRenderer<T> =\n      nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n    const { textValue, rendered } = nodeRenderer(node, {\n      fileCount: fileCountsMap.get(node.key) || 0,\n      dirCount: 0, // It seems it's only used for ignored files subtree\n    });\n    return {\n      key: node.key,\n      childItems: isGroupNode(node) ? (node.children as T[]) : [],\n      hasChildItems: isGroupNode(node) && node.children?.length > 0,\n      textValue,\n      children: rendered,\n    };\n  };\n  return {\n    getItemProps,\n    getTextValue: (\n      node: T,\n      { fileCountsMap }: { fileCountsMap: Map<Key, number> }\n    ) => {\n      const nodeRenderer: NodeRenderer<T> =\n        nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n      return nodeRenderer(node, {\n        fileCount: fileCountsMap.get(node.key) || 0,\n        dirCount: 0, // It seems it's only used for ignored files subtree\n      }).textValue;\n    },\n    itemRenderer:\n      ({ fileCountsMap }: { fileCountsMap: Map<Key, number> }) =>\n      (node: T) =>\n        <Item {...getItemProps({ node, fileCountsMap })} />,\n  };\n};\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n} from \"../ChangesTree/changesTreeNodeRenderers\";\nimport { isAnyRepoStatusUpdatingAtom } from \"../../file-status.state\";\nimport { Delayed } from \"../../../Delayed\";\nimport {\n  ChangeListNode,\n  ChangesViewTreeNode,\n  UnversionedChangesNode,\n} from \"./ChangesView.state\";\n\nconst changeListNodeRenderer: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nconst unversionedChangesNodeRenderer: NodeRenderer<UnversionedChangesNode> = (\n  _node,\n  { fileCount }\n) => ({\n  textValue: \"Unversioned Files\",\n  rendered: (\n    <ItemLayout>\n      <HighlightedTextValue />\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nfunction LoadingText() {\n  const loading = useAtomValue(isAnyRepoStatusUpdatingAtom);\n  return <>{loading && <Delayed>, updating...</Delayed>}</>;\n}\n\nexport const changesViewTreeNodeRenderer =\n  createChangesTreeNodeRenderer<ChangesViewTreeNode>({\n    changelist: changeListNodeRenderer,\n    unversioned: unversionedChangesNodeRenderer,\n  });\n","import React, { Key, RefObject, useCallback } from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesAtom,\n  ChangesViewTreeNode,\n  expandedKeysAtom,\n  includedChangesNestedSelectionAtom,\n  selectedKeysAtom,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { Change } from \"../Change\";\nimport { isGroupNode } from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"./changesViewTreeNodeRenderer\";\n\nfunction findPathsUnderNode(node: ChangesViewTreeNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [Change.path(node.change)];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } =\n    useAtomValue(changesTreeNodesAtom);\n  const [selectedKeys, setSelectedKeys] = useAtom(selectedKeysAtom);\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtom);\n  const nestedSelection = useAtomValue(includedChangesNestedSelectionAtom);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useAtomCallback(\n    useCallback((get, _set, key: Key) => {\n      const changeNode = get(changesTreeNodesAtom).byKey.get(key);\n      if (changeNode?.type === \"change\") {\n        openPath(Change.path(changeNode.change));\n      }\n      return changeNode;\n    }, [])\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        aria-label=\"Commit changes tree\" // no aria-label in the reference impl\n        treeRef={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = changesViewTreeNodeRenderer.getItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionsMenu,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu actions={actions}>\n          {(actionMenuProps) => (\n            <SpeedSearchMenu {...menuProps} {...actionMenuProps} />\n          )}\n        </ActionsMenu>\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionTooltip,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\ninterface Grouping<K extends string> {\n  id: K;\n  title: string;\n  isActive: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function GroupByActionButton<K extends string>({\n  groupings,\n  onToggle,\n}: {\n  groupings: Array<Grouping<K>>;\n  onToggle: (id: K) => void;\n}) {\n  //  TODO: Generalize and make action\n  if (groupings.length === 1 && groupings[0].icon) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={`Group By ${groupings[0].title}`} />\n        }\n      >\n        <IconButton\n          isPressed={groupings[0].isActive}\n          onPress={() => onToggle(groupings[0].id)}\n        >\n          {groupings[0].icon}\n        </IconButton>\n      </TooltipTrigger>\n    );\n  }\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            <Menu\n              {...menuProps}\n              selectedKeys={groupings\n                .filter(({ isActive }) => isActive)\n                .map(({ id }) => id)}\n              onAction={(key) => {\n                const id = groupings.find(({ id }) => id === key)?.id;\n                if (id) {\n                  onToggle(id);\n                }\n              }}\n            >\n              <Section title=\"Group By\">\n                {groupings.map(({ id, title }) => (\n                  <Item key={id}>{title}</Item>\n                ))}\n              </Section>\n            </Menu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport React, { useCallback } from \"react\";\n\nimport { GroupByActionButton } from \"../../../../GroupByActionButton\";\nimport {\n  changesGroupingActiveState,\n  changesViewGroupingsState,\n  GroupingIds,\n} from \"../ChangesView.state\";\n\nexport const ChangesGroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const groupings = useAtomValue(changesViewGroupingsState);\n\n  const toggleGroup = useAtomCallback(\n    useCallback((_get, set, id: GroupingIds) => {\n      set(changesGroupingActiveState(id), (value) => !value);\n    }, [])\n  );\n\n  return <GroupByActionButton groupings={groupings} onToggle={toggleGroup} />;\n};\n","import React from \"react\";\nimport { useAtom } from \"jotai\";\nimport {\n  showIgnoredFilesAtom,\n  showRelatedFilesAtom,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useAtom(showRelatedFilesAtom);\n  const [showIgnoredFiles, setShowIgnoredFiles] = useAtom(showIgnoredFilesAtom);\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { ChangesGroupByActionButton } from \"./ActionButtons/ChangesGroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar border=\"bottom\">\n      <ActionButton actionId={CommonActionId.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <ChangesGroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { atom, useSetAtom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { useCallback } from \"react\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksAtom = atom<Task[]>([]);\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskAtom = atom<Task | null>((get) => get(tasksAtom)[0]);\n\n/**\n * Optimized state of the number of tasks, if the tasks are not needed.\n */\nexport const taskCountAtom = atom<number>((get) => get(tasksAtom).length);\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetAtom(tasksAtom);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useAtomCallback(\n    useCallback((get, _set, id: Task[\"id\"]) => {\n      const task = get(tasksAtom).find((task) => task.id === id);\n      if (task) {\n        task.abortController.abort();\n      }\n    }, [])\n  );\n","import { atomFamily } from \"jotai/utils\";\nimport git from \"isomorphic-git\";\nimport { equals } from \"ramda\";\nimport { atomWithRefresh } from \"../atom-utils/atomWithRefresh\";\nimport { fs } from \"../fs/fs\";\n\nexport const resolvedRefAtoms = atomFamily(\n  ({ repoRoot, ref }: { repoRoot: string; ref: string }) =>\n    atomWithRefresh(() => {\n      return git.resolveRef({ fs, dir: repoRoot, ref, depth: 3 });\n    }),\n  equals\n);\n","export type DateRange = { from?: Date; to?: Date };\nexport const dateToString = (date: Date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date\n    .getFullYear()\n    .toString()\n    .slice(-2)}`;\n};\nexport const dateRangeToString = (dateRange: DateRange): string => {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n};\n","import { mapObjIndexed } from \"ramda\";\nimport { Atom, atom, Getter, Setter, WritableAtom } from \"jotai\";\nimport { atomFamily, atomWithReset, RESET, useAtomCallback } from \"jotai/utils\";\nimport { useCallback } from \"react\";\nimport { DateRange, dateRangeToString } from \"./DateRange\";\n\nexport const vcsTabKeysAtom = atom<string[]>([\"MAIN\"]);\n\nexport const vcsActiveTabKeyAtom = atom<string>(\"MAIN\");\n\n/**\n * The title of a VCS log tab\n */\nexport const vcsTabTitleAtoms = atomFamily((key: string) =>\n  atom((get) => {\n    const searchQuery = get(vcsLogFilter.searchQuery(key));\n    const user = get(vcsLogFilter.user(key));\n    const date = get(vcsLogFilter.date(key));\n    const branches = get(vcsLogFilter.branch(key));\n    const parts: { short: string; long: string }[] = [];\n\n    if (branches?.length > 0) {\n      parts.push({\n        short: branches.join(\", \"),\n        long: `on ${branches.join(\", \")}`,\n      });\n    }\n    if (date) {\n      parts.push({\n        short: dateRangeToString(date),\n        long: `made ${dateRangeToString(date)}`,\n      });\n    }\n    if (searchQuery) {\n      parts.push({\n        short: `'${searchQuery}'`,\n        long: `containing '${searchQuery}'`,\n      });\n    }\n    if (user) {\n      parts.push({\n        short: user,\n        long: `by ${user}`,\n      });\n    }\n\n    return `Log${parts.length > 0 ? \": \" : \"\"}${\n      parts.length === 1\n        ? parts[0].short\n        : parts.map((part) => part.long).join(\" \")\n    }`;\n  })\n);\n\nconst tabAtomFamilies: Array<\n  ReturnType<typeof atomFamily<string, Atom<unknown>>>\n> = [];\n\n/**\n * creates an atomFamily to keep a piece of state for VCS log tabs.\n * It keeps track of all pieces of state for each tab to be cleaned up when the tab is closed.\n */\nexport const vcsLogAtomFamily = <T>(defaultValue: T) => {\n  const result = atomFamily((_tab: string) => atomWithReset<T>(defaultValue));\n  tabAtomFamilies.push(result);\n  return result;\n};\n\n/**\n * Whether branches filter is visible for a VCS log tab\n */\nexport const vcsLogTabShowBranchesAtoms = vcsLogAtomFamily(false);\n\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsAtoms = vcsLogAtomFamily(true);\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsInCurrentTabAtom = atom((get) =>\n  get(vcsLogTabShowCommitDetailsAtoms(get(vcsActiveTabKeyAtom)))\n);\n\nexport const CURRENT_USER_FILTER_VALUE = \"*\";\nexport const vcsLogFilter = {\n  /**\n   * The state of search query, for a VCS log tab\n   */\n  searchQuery: vcsLogAtomFamily(\"\"),\n  /**\n   * The state of whether \"match case\" is on the search query, for a VCS log tab\n   */\n  matchCase: vcsLogAtomFamily(false),\n  /**\n   * The state of whether \"regexp\" is on the search query, for a VCS log tab\n   */\n  regExp: vcsLogAtomFamily(false),\n  /**\n   * The state of user filter, for a VCS log tab\n   */\n  user: vcsLogAtomFamily<string | null>(null),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  date: vcsLogAtomFamily<DateRange | null>(null),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  branch: vcsLogAtomFamily<string[]>([]),\n};\n\nexport const vcsLogFilterCurrentTab = mapObjIndexed((atomFamily, key) => {\n  return atom(\n    (get) => get(atomFamily(get(vcsActiveTabKeyAtom)) as Atom<unknown>),\n    (get, set, newValue) => {\n      set(\n        atomFamily(get(vcsActiveTabKeyAtom)) as WritableAtom<\n          unknown,\n          unknown[],\n          unknown\n        >,\n        newValue\n      );\n    }\n  );\n}, vcsLogFilter) as {\n  [key in keyof typeof vcsLogFilter]: ReturnType<(typeof vcsLogFilter)[key]>;\n};\n\nexport const useResetFilters = () =>\n  useAtomCallback(\n    useCallback((get, set, tabKey: string) => {\n      Object.values(vcsLogFilter)\n        .map((getAtom) => getAtom(tabKey))\n        .forEach((atom) =>\n          set(atom as WritableAtom<unknown, [typeof RESET], unknown>, RESET)\n        );\n    }, [])\n  );\n\nconst closeTabCallback = (get: Getter, set: Setter, tabKey: string) => {\n  const tabs = get(vcsTabKeysAtom);\n  const currentActiveTabKey = get(vcsActiveTabKeyAtom);\n  if (currentActiveTabKey === tabKey) {\n    // make sure the active tab key remains valid, by switching to previous tab. In the reference implementation\n    // the previously activated tab will be activated instead of the previous one index-wise, but it's a\n    // negligible and easy-to-fix difference.\n    set(\n      vcsActiveTabKeyAtom,\n      tabs[tabs.findIndex((key) => key === tabKey) - 1] || tabs[0]\n    );\n  }\n  set(vcsTabKeysAtom, (keys) => keys.filter((key) => key !== tabKey));\n  tabAtomFamilies.forEach((atomFamily) => atomFamily.remove(tabKey));\n};\n\nexport function useCloseVcsTab() {\n  return useAtomCallback(closeTabCallback);\n}\n","import git, { ReadCommitResult } from \"isomorphic-git\";\nimport { sort } from \"ramda\";\n\ntype Fs = Parameters<typeof git[\"readCommit\"]>[0][\"fs\"];\n\nconst cache = {};\nexport const commitDateComparator = (\n  a: ReadCommitResult,\n  b: ReadCommitResult\n) => b.commit.committer.timestamp - a.commit.committer.timestamp;\n\ntype CommitWithMeta = {\n  repoPath: string;\n  /**\n   * refs this commit contains in\n   */\n  containingRefs: Set<string>;\n  readCommitResult: ReadCommitResult;\n};\n\ntype RepoDescriptor = {\n  repoPath: string;\n  isBare?: boolean;\n};\n/**\n * Similar to git.log(...), but:\n * - supports multiple repos and multiple refs per repo.\n * - for each commit, includes the list of refs the commit is a part of\n * Commits are sorted by commit time, from new to old.\n */\nexport async function readCommits(\n  fs: Fs,\n  ...sources: Array<\n    RepoDescriptor & {\n      refs: string[];\n    }\n  >\n) {\n  const allCommits: Array<CommitWithMeta> = [];\n  const commitsMap: Record<string, CommitWithMeta> = {};\n  let commitsToProcess: Array<CommitWithMeta & RepoDescriptor> = [];\n\n  commitsToProcess.forEach((item) => {\n    commitsMap[item.readCommitResult.oid] = item;\n  });\n  const initialCommits = await Promise.all(\n    sources.flatMap(({ refs, repoPath, isBare }) =>\n      refs.map(async (ref) => {\n        const commit = await git\n          .resolveRef({\n            ...getCommonArgs({ repoPath, isBare }),\n            ref,\n            depth: 3,\n          })\n          .then((oid) =>\n            git.readCommit({\n              ...getCommonArgs({ repoPath, isBare }),\n              oid,\n            })\n          );\n        return { repoPath, isBare, commit, refs: new Set([ref]) };\n      })\n    )\n  );\n\n  sort(\n    ({ commit: c1 }, { commit: c2 }) => commitDateComparator(c1, c2),\n    initialCommits\n  ).forEach(({ commit, refs, repoPath, isBare }) =>\n    addCommit({ repoPath, isBare }, commit, -1, refs)\n  );\n\n  while (commitsToProcess.length > 0) {\n    const {\n      readCommitResult: latestCommit,\n      repoPath,\n      isBare,\n      containingRefs,\n    } = commitsToProcess.shift()!; // non-null assertion because of length>0;\n    allCommits.push({\n      repoPath,\n      readCommitResult: latestCommit,\n      containingRefs: containingRefs,\n    });\n    const parentCommits = await Promise.all(\n      latestCommit.commit.parent.map((oid) =>\n        git.readCommit({\n          ...getCommonArgs({ repoPath, isBare }),\n          oid,\n        })\n      )\n    );\n    // insert new parents in the right place so that commitsToProcess remains sorted.\n    parentCommits.forEach((commit) => {\n      const index = commitsToProcess.findIndex(\n        ({ readCommitResult: aCommit }) =>\n          commitDateComparator(aCommit, commit) > 0\n      );\n      addCommit({ repoPath, isBare }, commit, index, containingRefs);\n    });\n  }\n  return allCommits;\n\n  function addCommit(\n    { repoPath, isBare }: RepoDescriptor,\n    commit: ReadCommitResult,\n    index: number,\n    refs: Set<string>\n  ) {\n    if (commitsMap[commit.oid]) {\n      commitsMap[commit.oid].containingRefs = new Set([\n        ...commitsMap[commit.oid].containingRefs,\n        ...refs,\n      ]);\n    } else {\n      const entry: CommitWithMeta & RepoDescriptor = {\n        readCommitResult: commit,\n        containingRefs: commitsMap[commit.oid]\n          ? new Set([...commitsMap[commit.oid].containingRefs, ...refs])\n          : refs,\n        repoPath,\n        isBare,\n      };\n      commitsMap[commit.oid] = entry;\n      commitsToProcess.splice(\n        index >= 0 ? index : commitsToProcess.length,\n        0,\n        entry\n      );\n    }\n  }\n  function getCommonArgs({\n    repoPath,\n    isBare,\n  }: {\n    repoPath: string;\n    isBare?: boolean;\n  }) {\n    return {\n      fs,\n      cache,\n      [isBare ? \"gitdir\" : \"dir\"]: repoPath,\n    };\n  }\n}\n","import { ReadCommitResult } from \"isomorphic-git\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\nimport { indexBy } from \"ramda\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { atomWithRefresh } from \"../../../atom-utils/atomWithRefresh\";\nimport { allBranchesAtom } from \"../../Branches/branches.state\";\nimport { resolvedRefAtoms } from \"../../refs.state\";\nimport { GitRef } from \"../GitRef\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { readCommits } from \"./readCommits\";\n\nfunction match(\n  input: string,\n  query: string,\n  flags: { matchCase?: boolean; regExp?: boolean } = {}\n) {\n  if (flags.regExp) {\n    return new RegExp(query, flags.matchCase ? \"\" : \"i\").test(input);\n  }\n  if (!flags.matchCase) {\n    return input.toLowerCase().includes(query.toLowerCase());\n  }\n  return input.includes(query);\n}\n\ntype CommitLogItem = {\n  readCommitResult: ReadCommitResult;\n  containingRefs: Set<string>;\n  repoPath: string;\n};\n\nexport const allCommitsAtom = atomWithRefresh<Promise<Array<CommitLogItem>>>(\n  async (get) => {\n    // TODO: readCommit can take too long. Suspending anything that depends on it leads to poor UX. would be nicer\n    //  to have the state updated (like an atom instead of selector) when commits are read, instead of query inside\n    //  the selector. But the challenge is that it does depend on another piece of state, allBranchesState\n    return readCommits(\n      fs,\n      ...(await get(allBranchesAtom)).map(\n        ({ repoRoot, localBranches, remoteBranches }) => ({\n          repoPath: repoRoot,\n          refs: [\"HEAD\"]\n            .concat(localBranches.map((branch) => branch.name))\n            .concat(\n              remoteBranches.map((branch) => `${branch.remote}/${branch.name}`)\n            ),\n        })\n      )\n    );\n  }\n);\n\nexport const commitsTableRowsAtom = atom(async (get) => {\n  const searchQuery = get(vcsLogFilterCurrentTab.searchQuery);\n  const branches = get(vcsLogFilterCurrentTab.branch);\n  const flags = {\n    matchCase: get(vcsLogFilterCurrentTab.matchCase),\n    regExp: get(vcsLogFilterCurrentTab.regExp),\n  };\n  const dateFilter = get(vcsLogFilterCurrentTab.date);\n\n  const rows = (await get(allCommitsAtom))\n    .filter(\n      ({ containingRefs }) =>\n        !branches?.length ||\n        branches.some((branch) => containingRefs.has(branch))\n    )\n    .filter(\n      ({ readCommitResult: { commit } }) =>\n        (!dateFilter?.from ||\n          commit.author.timestamp * 1000 > dateFilter.from.getTime()) &&\n        (!dateFilter?.to ||\n          commit.author.timestamp * 1000 < dateFilter.to.getTime())\n    )\n    .filter(\n      ({ readCommitResult: { commit } }) =>\n        !searchQuery ||\n        match(commit.message, searchQuery, flags) ||\n        match(commit.tree, searchQuery, { matchCase: false })\n    );\n\n  return {\n    rows,\n    byOid: indexBy(({ readCommitResult: commit }) => commit.oid, rows),\n  };\n});\n\nexport const allResolvedRefsAtom = atom(async (get) => {\n  const repoBranches = await get(allBranchesAtom);\n  const refs: Record<string, GitRef[]> = {};\n  const addRef = (ref: string, value: GitRef) => {\n    refs[ref] = refs[ref] || [];\n    refs[ref].push(value);\n  };\n  (\n    await Promise.all(\n      repoBranches.map(({ repoRoot }) =>\n        get(resolvedRefAtoms({ repoRoot, ref: \"HEAD\" }))\n      )\n    )\n  ).forEach((resolvedRef) => {\n    addRef(resolvedRef, {\n      type: \"head\",\n      name: \"HEAD\",\n    });\n  });\n  for (const { repoRoot, localBranches, currentBranch } of repoBranches) {\n    for (const branch of localBranches) {\n      addRef(await get(resolvedRefAtoms({ repoRoot, ref: branch.name })), {\n        type: \"localBranch\",\n        name: branch.name,\n        isCurrent: currentBranch?.name === branch.name,\n        trackingBranch: branch.trackingBranch,\n      });\n    }\n  }\n  for (const { repoRoot, remoteBranches } of repoBranches) {\n    for (const branch of remoteBranches) {\n      const branchName = `${branch.remote}/${branch.name}`;\n      addRef(await get(resolvedRefAtoms({ repoRoot, ref: branchName })), {\n        type: \"remoteBranch\",\n        name: branchName,\n      });\n    }\n  }\n  return refs;\n});\n\n/**\n * selection state of the commits table\n * TODO: make it per-tab\n */\nexport const commitsSelectionAtom = atom<Selection>(new Set([]));\n\n/**\n * OIDs of the selected commits in commits table.\n */\nexport const selectedCommitOids = atom(async (get) => {\n  const selection = get(commitsSelectionAtom);\n  if (selection === \"all\") {\n    return (await get(commitsTableRowsAtom)).rows.map(\n      ({ readCommitResult: { oid } }) => oid\n    );\n  }\n  return [...selection].map((i) => `${i}`);\n});\n\nexport const selectedCommitsAtom = atom(async (get) =>\n  Promise.all(\n    (await get(selectedCommitOids)).map(\n      async (oid) => (await get(commitsTableRowsAtom)).byOid[oid]\n    )\n  )\n);\n\n/**\n * Selected commit in the commits table. The first row, if multiple rows are selected\n */\nexport const selectedCommitAtom = atom(async (get) => {\n  const oid = (await get(selectedCommitOids))[0];\n  return (oid && (await get(commitsTableRowsAtom)).byOid[oid]) || null;\n});\n\nexport const vcsTableShowCommitTimestampAtom = atom<boolean>(false);\n\nexport const vcsTableReferencesOnTheLeftAtom = atom<boolean>(false);\n\nexport const vcsTableHighlightMyCommitsAtom = atom<boolean>(false);\n\nexport const authorColumn = {\n  id: \"Default.Author\",\n  name: \"Author\",\n};\nexport const hashColumn = {\n  id: \"Default.Hash\",\n  name: \"Hash\",\n};\n\nexport const dateColumn = {\n  id: \"Date.Date\",\n  name: \"Date\",\n};\n\nconst defaultVisibleColumns = [authorColumn.id, dateColumn.id];\nexport const vcsTableColumnsVisibilityAtoms = atomFamily((id: string) =>\n  atom<boolean>(defaultVisibleColumns.includes(id))\n);\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useCallback } from \"react\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useRefreshRepoStatuses,\n  vcsFootForFileAtom,\n} from \"../../file-status.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdAtom } from \"./ChangesView.state\";\nimport { AnyChange, Change } from \"../Change\";\nimport { resolvedRefAtoms } from \"../../refs.state\";\nimport { repoCurrentBranchNameAtom } from \"../../Branches/branches.state\";\nimport { allCommitsAtom } from \"../../VersionControlToolWindow/CommitsView/CommitsTable.state\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshFileStatus = useRefreshRepoStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useAtomCallback(\n    useCallback(\n      (get, set, changes: readonly AnyChange[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = Change.path(change);\n                      const repoRoot = await get(vcsFootForFileAtom(filePath));\n                      const content = (await fs.promises.exists(filePath))\n                        ? await fs.promises.readFile(filePath)\n                        : null;\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array | null;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                    const currentBranch = await get(\n                      repoCurrentBranchNameAtom(repoRoot)\n                    );\n                    if (currentBranch) {\n                      set(\n                        resolvedRefAtoms({\n                          repoRoot,\n                          ref: currentBranch,\n                        })\n                      );\n                    }\n                    set(resolvedRefAtoms({ repoRoot, ref: \"HEAD\" }));\n                  }\n                )\n              ).then(\n                () => {\n                  set(allCommitsAtom); // maybe a more efficient way to update only the newly added commit, when\n                  // allCommitsState is refactored to allow that\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdAtom, null);\n            },\n          }\n        );\n        set(commitTaskIdAtom, taskId);\n      },\n      []\n    )\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n */\nexport async function commitFiles({\n  updates,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  /**\n   * A mapping from file paths to either:\n   * - the new content of the file that should be committed, in form of a Uint8Array blob\n   * - null, indicating the files should be removed\n   */\n  updates: { [filePath: string]: Uint8Array | null };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  let containsChange = false;\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(updates).map(async ([filePath, blob]) => {\n      const index = entries.findIndex(({ path }) => path === filePath);\n      if (blob == null) {\n        // null indicates removed file\n        if (index > -1) {\n          containsChange = true;\n          entries.splice(index, 1);\n        }\n        return;\n      }\n      const entry = entries[index];\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n      containsChange = true;\n    })\n  );\n\n  if (!containsChange) {\n    throw new Error(\"Nothing to commit!\");\n  }\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(updates).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n} from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitAtom,\n  commitErrorMessageAtom,\n  commitMessageAtom,\n  commitTaskIdAtom,\n  includedChangesAtom,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useAtom(commitMessageAtom);\n  const commit = useCommitChanges();\n  const amend = useAtomValue(amendCommitAtom);\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useAtom(commitErrorMessageAtom);\n  const commitTaskId = useAtomValue(commitTaskIdAtom);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useAtomCallback(\n    useCallback((get) => {\n      const includedChanges = get(includedChangesAtom);\n      const commitMessage = get(commitMessageAtom);\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (get(amendCommitAtom)) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    }, [])\n  );\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n          mnemonic=\"i\"\n        >\n          {amend ? \"Amend Commit\" : \"Commit\"}\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented} mnemonic=\"P\">\n          {amend ? \"Amend Commit and Push...\" : \"Commit and Push...\"}\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { StatusColor } from \"../FileStatusColor\";\nimport { AnyChange, Change } from \"./Change\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<AnyChange>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => Change.fileStatus(change) === \"MODIFIED\"\n  ).length;\n  const addedCount = changes.filter(Change.isAddition).length;\n  const deletedCount = changes.filter(Change.isDeletion).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitAtom, includedChangesAtom } from \"./ChangesView.state\";\nimport { focusCommitMessage } from \"./ChangesViewSplitter\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useAtomValue(includedChangesAtom);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useAtom(amendCommitAtom);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={(value) => {\n                setAmend(value);\n                // TODO: alternate commit message between the latest commit message and the last edited message.\n                focusCommitMessage();\n              }}\n              preventFocus\n              mnemonic=\"m\"\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React from \"react\";\nimport { atom, useAtomValue } from \"jotai\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { useRefreshRepoStatuses } from \"../../file-status.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { actionAtom } from \"../../../actionAtom\";\nimport { alertDialogRefAtom } from \"../../../Project/project.state\";\nimport { deleteFilesCallback } from \"../../../Project/fs-operations\";\nimport { Change } from \"../Change\";\nimport { useSetActiveChangeList } from \"../change-lists.state\";\nimport {\n  changeListsUnderSelection,\n  changesUnderSelectedKeysAtom,\n} from \"./ChangesView.state\";\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\n\nconst selectedFilesCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 selected file}\n    other {# selected files}\n  }`,\n  \"en-US\"\n);\n\nconst deletablePathsUnderChangesTreeSelectionState = atom((get) =>\n  [...get(changesUnderSelectedKeysAtom).values()]\n    .filter((change) => change.type !== \"DELETED\")\n    .map(Change.path)\n);\n\nconst deleteActionAtom = actionAtom({\n  id: CommonActionId.DELETE,\n  title: \"Delete\",\n  description: \"Delete selected item\",\n  isDisabled: atom(\n    (get) => get(deletablePathsUnderChangesTreeSelectionState).length === 0\n  ),\n  actionPerformed: async ({ get, set }) => {\n    const pathsToDelete = get(deletablePathsUnderChangesTreeSelectionState);\n\n    const alertDialog = get(alertDialogRefAtom).current;\n    if (pathsToDelete.length === 0) {\n      return;\n    }\n    const confirmed = await alertDialog?.confirm({\n      title: \"Delete\",\n      okText: \"Delete\",\n      message: (\n        <div\n          style={{ width: 354 }}\n        >{`Are you sure you want to delete ${selectedFilesCountMsg.format({\n          count: pathsToDelete.length,\n        })}?`}</div>\n      ),\n    });\n    if (confirmed) {\n      console.log(`deleting ${pathsToDelete}`);\n      await deleteFilesCallback(get, set, pathsToDelete);\n    }\n  },\n});\n\nexport function useChangesViewActions() {\n  const selectedChangeLists = useAtomValue(changeListsUnderSelection);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  const actions: ActionDefinition[] = [\n    {\n      id: CommonActionId.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    useAtomValue(deleteActionAtom),\n  ];\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    // FIXME: action should be scoped to change lists tree\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  return actions;\n}\n","import React, { useRef } from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { isAnyRepoStatusUpdatingAtom } from \"../../file-status.state\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\nimport { useChangesViewActions } from \"./useChangesViewActions\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n  position: relative;\n`;\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  right: 0.125rem;\n  top: 0.125rem;\n  z-index: 1;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const updating = useAtomValue(isAnyRepoStatusUpdatingAtom);\n  const [commitMessageSize, setCommitMessageSize] = useAtom(\n    commitMessageSizeState(orientation)\n  );\n  const changesViewActions = useChangesViewActions();\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={[...treeActions, ...changesViewActions]}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                {updating && (\n                  <Delayed>\n                    <StyledLoadingWrapper>\n                      <LoadingGif />\n                    </StyledLoadingWrapper>\n                  </Delayed>\n                )}\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function ChangesViewZeroState() {\n  const performAction = usePerformAction();\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To commit changes,{\" \"}\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        For recent changes, see{\" \"}\n        <Link onPress={notImplemented}>Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useAtomValue } from \"jotai\";\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { ChangesViewZeroState } from \"./ChangesViewZeroState\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const vcsRoots = useAtomValue(vcsRootsAtom);\n  return (\n    <StyledContainer>\n      {vcsRoots.length > 0 ? <ChangesViewSplitter /> : <ChangesViewZeroState />}\n    </StyledContainer>\n  );\n};\n","import path from \"path\";\nimport React from \"react\";\n\nimport { LocalBranch } from \"./Branches/branches.state\";\n\nexport function TrackingBranchInfo({\n  branches,\n}: {\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n}) {\n  return (\n    <table style={{ borderSpacing: 0 }}>\n      {branches.map(({ branch, repoRoot }) => {\n        const mapping = branch.trackingBranch\n          ? `${branch.name} → ${branch.trackingBranch}`\n          : branches.length > 1\n          ? `${branch.name} (no tracking branch)`\n          : \"No tracking branch\";\n\n        return branches.length > 1 ? (\n          <tr key={repoRoot}>\n            <td>{path.basename(repoRoot)}: &nbsp;</td>\n            <td>{mapping}</td>\n          </tr>\n        ) : (\n          <tr key={repoRoot}>\n            <td>{mapping}</td>\n          </tr>\n        );\n      })}\n    </table>\n  );\n}\n","import React from \"react\";\nimport { atom, useAtomValue } from \"jotai\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { vcsFootForFileAtom } from \"./file-status.state\";\nimport { LocalBranch, repoBranchesAtom } from \"./Branches/branches.state\";\nimport { changesGroupingActiveState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { TrackingBranchInfo } from \"./TrackingBranchInfo\";\nimport { Change } from \"./Changes/Change\";\nimport { allChangesAtom } from \"./Changes/changes.state\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesAtom = atom(\n  async (get): Promise<Array<{ repoRoot: string; branch: LocalBranch }>> => {\n    const changesRepoRoots = (\n      await Promise.all(\n        get(allChangesAtom).map((change) =>\n          get(vcsFootForFileAtom(Change.path(change)))\n        )\n      )\n    ).filter(notNull);\n\n    return (\n      await Promise.all(\n        changesRepoRoots.map(async (repoRoot) => {\n          const branch = (await get(repoBranchesAtom(repoRoot))).currentBranch;\n          return branch\n            ? {\n                repoRoot,\n                branch,\n              }\n            : null;\n        })\n      )\n    ).filter(notNull);\n  }\n);\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useAtomValue(\n    changesGroupingActiveState(\"repository\")\n  );\n  const changesBranches = useAtomValue(changesBranchesAtom);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={changesBranches} />}\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledHeader = styled.div`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  height: 2.0625rem;\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n  flex-shrink: 0;\n`;\nexport const StyledSpacer = styled.div`\n  flex-grow: 1;\n`;\nexport const StyledPlaceholderContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n  align-items: center;\n  gap: 0.25rem;\n  min-height: 37%;\n  overflow: hidden;\n`;\n","import React from \"react\";\n\nexport const parseCommitMessage = (commitMessage: string) => {\n  const lines = commitMessage.split(\"\\n\");\n  const bodyLines = lines.slice(1);\n  return {\n    subject: lines[0],\n    bodyAsString: bodyLines.join(\"\\n\"),\n    body: (\n      <>\n        {bodyLines.map((line, index) => (\n          <React.Fragment key={index}>\n            {index > 0 && <br />}\n            {line}\n          </React.Fragment>\n        ))}\n      </>\n    ),\n  };\n};\n\nexport function shortenOid(oid: string) {\n  return oid.slice(0, 8);\n}\n\nconst commitDateTimeFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitTimeFormatter = new Intl.DateTimeFormat([], {\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitDateFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n});\n\nexport function formatCommitDateTime(date: Date | number) {\n  return commitDateTimeFormatter.format(date).replace(\" \", \" \");\n}\n\nexport function formatCommitDate(date: Date | number) {\n  return commitDateFormatter.format(date);\n}\n\nexport function formatCommitTime(date: Date | number) {\n  return commitTimeFormatter.format(date).replace(\" \", \" \");\n}\n","import path from \"path\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n  simpleGroupingRenderer,\n} from \"../../Changes/ChangesTree/changesTreeNodeRenderers\";\nimport { RepositoryNode } from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { shortenOid } from \"../commit-utils\";\nimport {\n  CommitChangesTreeNode,\n  CommitParentChangeTreeNode,\n} from \"./CommitsChangedFiles.state\";\n\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst commitParentNodeRenderer = simpleGroupingRenderer(\n  (node: CommitParentChangeTreeNode) =>\n    `Changes to ${shortenOid(path.basename(node.oid))} ${node.subject.slice(\n      0,\n      50\n    )}`\n);\nexport const commitChangesTreeNodeRenderer =\n  createChangesTreeNodeRenderer<CommitChangesTreeNode>(\n    {\n      commitParent: commitParentNodeRenderer,\n    },\n    {\n      repo: repoNodeRenderer,\n    }\n  );\n","import git from \"isomorphic-git\";\nimport path from \"path\";\n\nimport { AnyChange, Change, Revision } from \"../../Changes/Change\";\n\nconst cache = {}; // FIXME: find a better caching strategy. Per project?\nexport async function getCommitChanges({\n  fromRef,\n  toRef,\n  ...params\n}: {\n  dir?: string;\n  gitdir?: string;\n  fromRef: string;\n  toRef: string;\n} & Pick<Parameters<typeof git[\"walk\"]>[0], \"fs\" | \"dir\" | \"gitdir\">): Promise<\n  AnyChange[]\n> {\n  let items: AnyChange[] = await git.walk({\n    ...params,\n    cache,\n    trees: [git.TREE({ ref: fromRef }), git.TREE({ ref: toRef })],\n    map: async function map(\n      filepath,\n      [before, after]\n    ): Promise<null | boolean | AnyChange> {\n      const afterOid = await after?.oid();\n      const beforeOid = await before?.oid();\n      const afterType = await after?.type();\n      const beforeType = await before?.type();\n      if (afterOid === beforeOid) {\n        return null;\n      }\n      const afterRevision: Revision | null = afterOid\n        ? {\n            hash: afterOid,\n            path: path.join(params.dir || \"\", filepath),\n            isDir: afterType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await after?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const beforeRevision: Revision | null = beforeOid\n        ? {\n            hash: beforeOid,\n            path: path.join(params.dir || \"\" || \"\", filepath),\n            isDir: beforeType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await before?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const change: AnyChange | null =\n        afterRevision || beforeRevision\n          ? // @ts-expect-error ts can't tell that the signature matches\n            Change(beforeRevision, afterRevision)\n          : null;\n      return change && !Change.revision(change).isDir\n        ? change\n        : // returning null will cause the git.walk not to continue traversing the tree\n          false;\n    },\n  });\n\n  return (items || []).filter((item: boolean | AnyChange) => item);\n}\n","import { diffLines } from \"diff\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { AdditionChange, AnyChange, Change, DeletionChange } from \"./Change\";\n\n// Read more: https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage\nconst DEFAULT_SIMILARITY_INDEX = 50;\n\n/**\n * Given a list of changes, detects renames based on the change in the content of changes where only `before` or\n * `after` is present, and consolidates them into one change, making it count as a rename.\n * @param changes\n */\nexport async function detectRenames(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  return detectRenamesBasedOnContent(detectRenamesBasedOnHash(changes));\n}\n\nfunction detectRenamesBasedOnHash(\n  changes: ReadonlyArray<AnyChange>\n): AnyChange[] {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  return mergeRenames(\n    new Map<DeletionChange, { to: AdditionChange }>(\n      deletions\n        .map((deletion) => {\n          const match = additions.find(\n            ({ after: { hash } }) => hash === deletion.before.hash\n          );\n          if (match) {\n            return [deletion, { to: match }] as const;\n          }\n          return null;\n        })\n        .filter(notNull)\n    ),\n    changes\n  );\n}\n\nasync function detectRenamesBasedOnContent(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  const contents = new Map<AnyChange, string>();\n  const getContent = async (change: AnyChange): Promise<string> => {\n    if (!contents.get(change)) {\n      contents.set(change, await Change.content(change));\n    }\n    return contents.get(change) ?? \"\";\n  };\n  const renameMapping = new Map<\n    DeletionChange,\n    { similarity: number; to: AdditionChange }\n  >();\n  await Promise.all(\n    deletions.map(async (deletion) => {\n      return Promise.all(\n        additions.map(async (addition) => {\n          const similarity = await computeSimilarity(\n            await getContent(deletion),\n            await getContent(addition)\n          );\n          const currentCandidate = renameMapping.get(deletion);\n          if (\n            similarity >= DEFAULT_SIMILARITY_INDEX &&\n            (!currentCandidate || similarity > currentCandidate.similarity)\n          ) {\n            renameMapping.set(deletion, { similarity, to: addition });\n          }\n        })\n      );\n    })\n  );\n  return mergeRenames(renameMapping, changes);\n}\n\nfunction mergeRenames(\n  renameMapping: Map<DeletionChange, { to: AdditionChange }>,\n  changes: ReadonlyArray<AnyChange>\n) {\n  const renamedChanges: AnyChange[] = [...renameMapping.values()].map(\n    (rename) => rename.to\n  );\n  return changes\n    .map((change) => {\n      if (Change.isDeletion(change)) {\n        const candidate = renameMapping.get(change);\n        if (candidate) {\n          return Change(change.before, candidate?.to.after);\n        }\n      }\n      return change;\n    })\n    .filter((change) => !renamedChanges.includes(change));\n}\n\n/**\n * Computes similarity to two strings (typically file contents), and returns a similarity score,\n * similar to [git's similarity index](https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage)\n * based on diff computed on a line basis.\n *\n * Note on performance:\n * diff computation can be quite heavy, so it's at least made async not to block the main thread. Further improvement\n * could be moving it to a worker thread.\n * Several alternatives are tested with no luck:\n * - fast-diff: It turned out to be much slower than diff\n * - fast-myers-diff: doesn't seem to support line diffing, or maybe it does but it wasn't straightforward, so skipped it.\n * - detect-rename: too slow!\n */\nasync function computeSimilarity(file1Content: string, file2Content: string) {\n  return new Promise<number>((resolve, reject) => {\n    diffLines(file1Content, file2Content, (err, value = []) => {\n      if (err) {\n        return reject(err);\n      }\n      const { unchanged, total } = value.reduce(\n        ({ total, unchanged }, change) => {\n          const count = change.count ?? 0;\n\n          return {\n            total: total + count,\n            unchanged:\n              unchanged + (!change.added && !change.removed ? count : 0),\n          };\n        },\n        { total: 0, unchanged: 0 }\n      );\n      resolve(100 * (unchanged / total));\n    });\n  });\n}\n","import React, { Key, RefObject } from \"react\";\nimport { atom, Getter } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport { sortTreeNodesInPlace } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport {\n  defaultChangeGroupings,\n  directoryGrouping,\n  getChangesGroupFn,\n} from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changeNode,\n  ChangesTreeGroupNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n} from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { changesTreeNodesResult } from \"../../Changes/ChangesTree/changesTreeNodesResult\";\nimport { ChangeListObj } from \"../../Changes/change-lists.state\";\nimport {\n  commitsTableRowsAtom,\n  selectedCommitsAtom,\n} from \"../CommitsView/CommitsTable.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\nimport { getCommitChanges } from \"./getCommitChanges\";\nimport { detectRenames } from \"../../Changes/detectRenames\";\nimport { equals } from \"ramda\";\n\nexport const changesGroupingActiveAtoms = atomFamily((id: string) =>\n  atom(id === directoryGrouping.id)\n);\n\nexport const commitChangesTreeRefAtom = atom<RefObject<TreeRefValue>>(\n  React.createRef<TreeRefValue>()\n);\n\nexport const expandedKeysAtom = atom<Set<Key>>(new Set<Key>());\n\nexport const selectionAtom = atom<Selection>(new Set<Key>());\n\nconst COMMIT_PARENT_ID = \"commitParent\";\n\nexport type CommitChangesTreeNode =\n  ExtendedChangesTreeNode<CommitParentChangeTreeNode>;\nexport interface CommitParentChangeTreeNode\n  extends ChangesTreeGroupNode<typeof COMMIT_PARENT_ID, CommitChangesTreeNode> {\n  changeList: ChangeListObj;\n  oid: string;\n  subject: string;\n}\n\ntype CommitDiffParams = Pick<\n  Parameters<typeof getCommitChanges>[0],\n  \"fromRef\" | \"toRef\" | \"dir\"\n>;\nconst commitsDiffWithoutRenamesAtoms = atomFamily(\n  (params: CommitDiffParams) =>\n    atom(() =>\n      getCommitChanges({\n        fs,\n        ...params,\n      })\n    ),\n  equals\n);\n\nconst commitsDiffAtoms = atomFamily(\n  (params: CommitDiffParams) =>\n    atom(async (get) =>\n      detectRenames(await get(commitsDiffWithoutRenamesAtoms(params)))\n    ),\n  equals\n);\n\nconst getChangedFilesAtom =\n  (atomForCommitsDiff: typeof commitsDiffAtoms) => async (get: Getter) => {\n    const selectedCommits = await get(selectedCommitsAtom);\n    const commitLogItem = selectedCommits[0]; // FIXME: take all selected commits into account\n    const { byOid } = await get(commitsTableRowsAtom);\n    const toRef = commitLogItem?.readCommitResult?.oid;\n    const parents = commitLogItem?.readCommitResult.commit.parent;\n    if (toRef && parents) {\n      const groupFn = getChangesGroupFn({\n        get,\n        groupings: defaultChangeGroupings,\n        isActive: changesGroupingActiveAtoms,\n      });\n      const rootNodes = await Promise.all(\n        parents?.map(\n          async (parent) =>\n            ({\n              type: COMMIT_PARENT_ID,\n              key: changesTreeNodeKey(COMMIT_PARENT_ID, parent),\n              oid: parent,\n              subject: byOid[parent]?.readCommitResult.commit.message || \"\",\n              children: groupFn(\n                [\n                  ...(await get(\n                    atomForCommitsDiff({\n                      toRef,\n                      fromRef: parent,\n                      dir: commitLogItem.repoPath,\n                    })\n                  )),\n                ].map((node) => changeNode(node))\n              ),\n            } as CommitParentChangeTreeNode)\n        )\n      );\n\n      const { expandAllKeys, fileCountsMap, ...result } =\n        changesTreeNodesResult(\n          rootNodes.length === 1\n            ? rootNodes[0].children\n            : rootNodes.filter(({ children }) => children.length > 0)\n        );\n\n      type Writeable<T> = { -readonly [P in keyof T]: T[P] };\n      sortTreeNodesInPlace(\n        (node) =>\n          (node.type === \"directory\" ? \"a_\" : \"b_\") +\n          commitChangesTreeNodeRenderer\n            .getTextValue(node, { fileCountsMap })\n            .toLowerCase(),\n        {\n          // cheating with the types by removing readonly constraints to use the inplace sort tree util.\n          // it should be ok, since the ReadonlyArray is only a compile-time thing.\n          roots: result.rootNodes as Writeable<typeof result.rootNodes>,\n          getChildren: (node) =>\n            \"children\" in node\n              ? (node.children as Writeable<typeof node.children>)\n              : null,\n        }\n      );\n\n      return {\n        ...result,\n        fileCountsMap,\n        expandAllKeys: new Set(\n          [...expandAllKeys].filter(\n            (key) => !`${key}`.startsWith(COMMIT_PARENT_ID)\n          )\n        ),\n      };\n    }\n    return null;\n  };\n\n/**\n * Changes corresponding to the currently selected commits, before rename detection, which can be slow.\n */\nexport const changedFilesWithoutRenamesAtom = atom(\n  getChangedFilesAtom(commitsDiffWithoutRenamesAtoms)\n);\n\n/**\n * Changes corresponding to the currently selected commits.\n */\nexport const changedFilesAtom = atom(getChangedFilesAtom(commitsDiffAtoms));\n","import React, { HTMLAttributes, useEffect } from \"react\";\nimport { atom, Atom, useAtom, useAtomValue } from \"jotai\";\nimport { loadable } from \"jotai/utils\";\n\nimport {\n  HelpTooltip,\n  PlatformIcon,\n  PositionedTooltipTrigger,\n  SpeedSearchTree,\n  styled,\n} from \"@intellij-platform/core\";\n\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { selectedCommitsAtom } from \"../CommitsView/CommitsTable.state\";\nimport {\n  changedFilesAtom,\n  changedFilesWithoutRenamesAtom,\n  commitChangesTreeRefAtom,\n  expandedKeysAtom,\n  selectionAtom,\n} from \"./CommitsChangedFiles.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  inset: 0;\n  gap: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst loadableChangedFilesAtom = [\n  changedFilesAtom,\n  changedFilesWithoutRenamesAtom,\n].map(loadable);\n\nconst changedFilesLoadableAtom = atom((get) => {\n  return get(\n    loadableChangedFilesAtom.find((atom) => get(atom).state === \"hasData\") ??\n      loadableChangedFilesAtom.slice(-1)[0]\n  );\n});\n\n/**\n * TODO: handle multiple selected commits (check Changes.ShowChangesFromParents https://github.com/JetBrains/intellij-community/blob/ac57611a0612bd65ba2a19c841a4f95b40591134/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/frame/VcsLogChangesBrowser.java#L255-L254)\n */\nexport function CommitChangedFiles({\n  treeShortcutHandlerProps,\n}: {\n  treeShortcutHandlerProps: HTMLAttributes<HTMLElement>;\n}) {\n  const selectedCommits = useAtomValue(unwrapLatestOrNull(selectedCommitsAtom));\n  const treeRef = useAtomValue(commitChangesTreeRefAtom);\n  const nothingSelected = !selectedCommits?.length;\n\n  const stateLoadable = useAtomValue(changedFilesLoadableAtom);\n  const state = stateLoadable.state === \"hasData\" ? stateLoadable.data : null;\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtom);\n  const [selection, setSelection] = useAtom(selectionAtom);\n\n  useEffect(() => {\n    // TODO: expanded keys are supposed to be set based on selected keys\n    setExpandedKeys(state?.expandAllKeys ?? new Set());\n    setSelection(new Set());\n    // FIXME: with this being in an effect here, closing and reopening the toolwindow will\n    //  reset the selection, making selection state be effectively like a local state.\n  }, [stateLoadable.state]);\n\n  if (nothingSelected) {\n    return (\n      <StyledPlaceholderContainer>\n        Select commits to to view changes\n      </StyledPlaceholderContainer>\n    );\n  }\n  return (\n    <div\n      {...treeShortcutHandlerProps}\n      style={{\n        height: \"-webkit-fill-available\",\n        position: \"relative\",\n      }}\n    >\n      {stateLoadable.state === \"loading\" && (\n        <Delayed>\n          <StyledLoadingWrapper>\n            <LoadingGif style={{ width: \"1.5rem\" }} />\n            Loading...\n          </StyledLoadingWrapper>\n        </Delayed>\n      )}\n      {state && (\n        <SpeedSearchTree\n          aria-label=\"Commit changes\"\n          treeRef={treeRef}\n          items={state.rootNodes}\n          selectionMode=\"multiple\"\n          expandedKeys={expandedKeys}\n          onExpandedChange={setExpandedKeys}\n          selectedKeys={selection}\n          onSelectionChange={setSelection}\n          style={{ paddingBottom: \"1rem\" }}\n          fillAvailableSpace\n        >\n          {commitChangesTreeNodeRenderer.itemRenderer({\n            fileCountsMap: state.fileCountsMap,\n          })}\n        </SpeedSearchTree>\n      )}\n      {selectedCommits.length > 1 && (\n        <PositionedTooltipTrigger\n          placement=\"top\"\n          tooltip={\n            <HelpTooltip\n              helpText={\n                <>\n                  Showing diff for more than one commit is not currently\n                  supported. Only the first selected commit is taken into\n                  account.\n                </>\n              }\n            ></HelpTooltip>\n          }\n        >\n          {(props) => (\n            <span\n              {...props}\n              style={{\n                position: \"absolute\",\n                right: \"0.5rem\",\n                bottom: \"0.5rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/warning\" />\n            </span>\n          )}\n        </PositionedTooltipTrigger>\n      )}\n    </div>\n  );\n}\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { StyledCurrentBranchTag } from \"../Changes/StyledCurrentBranchTag\";\nimport { GitRef } from \"./GitRef\";\n\nconst labelIcon = (\n  <path\n    fill=\"currentColor\"\n    d=\"M4.2 4.8 C4.8627 4.8 5.4 5.3373 5.4 6 C5.4 6.6627 4.8627 7.2 4.2 7.2 C3.5373 7.2 3 6.6627 3 6 C3 5.3373 3.5373 4.8 4.2 4.8 ZM0.6 2.4 L0.6 7.2 L7.8 14.4 L12.6 9.6 L5.4 2.4 Z\"\n  />\n);\nconst vcsLogStandardColors = {\n  TIP: { light: \"#ffd100\", dark: \"#e1c731\" },\n  LEAF: { light: \"#8a2d6b\", dark: \"#c31e8c\" },\n  BRANCH: { light: \"#3cb45c\", dark: \"#3cb45c\" },\n  BRANCH_REF: { light: \"#9f79b5\", dark: \"#9f79b5\" },\n  TAG: { light: \"#7a7a7a\", dark: \"#999999\" },\n};\nconst gitLogColors: Record<GitRef[\"type\"], (args: { theme: Theme }) => string> =\n  {\n    head: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.headIconColor\",\n        vcsLogStandardColors.TIP\n      ),\n    localBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.localBranchIconColor\",\n        vcsLogStandardColors.BRANCH\n      ),\n    remoteBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.remoteBranchIconColor\",\n        vcsLogStandardColors.BRANCH_REF\n      ),\n    tag: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.tagIconColor\",\n        vcsLogStandardColors.TAG\n      ),\n  };\n\nconst StyledRef = styled(StyledCurrentBranchTag)`\n  border-radius: 3px;\n  align-items: stretch;\n  font-size: 0.75rem;\n`;\n\nconst StyledLabelSvg = styled.svg.attrs({ viewBox: \"0 0 14.5 14.5\" })<{\n  type: GitRef[\"type\"];\n}>`\n  width: 1rem;\n  height: 1rem;\n  stroke: rgba(0, 0, 0, 0.25);\n  stroke-width: 0.5px;\n  color: ${({ type, theme }) => gitLogColors[type]({ theme })};\n  z-index: 1; // for the right vertical order of grouped labels\n  &:not(:first-child) {\n    margin-right: -11px;\n  }\n`;\n\nconst StyledRefIconGroup = styled.span`\n  display: inline-flex;\n  flex-direction: row-reverse;\n`;\n\nconst StyledLabelText = styled.span`\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\n\nexport function RefIcon({ type }: { type: GitRef[\"type\"] }) {\n  return <StyledLabelSvg type={type}>{labelIcon}</StyledLabelSvg>;\n}\n\nexport function RefIconGroup({ types }: { types: Array<GitRef[\"type\"]> }) {\n  return (\n    <StyledRefIconGroup>\n      {types.map((type, index) => (\n        <StyledLabelSvg key={index} type={type}>\n          {labelIcon}\n        </StyledLabelSvg>\n      ))}\n    </StyledRefIconGroup>\n  );\n}\nexport function RefLabel({\n  types,\n  children,\n}: {\n  types: Array<GitRef[\"type\"]>;\n  children: React.ReactNode;\n}) {\n  return (\n    <StyledRef>\n      <RefIconGroup types={types} />\n      <StyledLabelText>{children}</StyledLabelText>\n    </StyledRef>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport { useAtomValue } from \"jotai\";\nimport React, { ReactNode } from \"react\";\n\nimport { Link, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport {\n  formatCommitDate,\n  formatCommitTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\nimport {\n  allResolvedRefsAtom,\n  selectedCommitAtom,\n} from \"../CommitsView/CommitsTable.state\";\nimport { RefIconGroup } from \"../RefLabel\";\nimport { GitRef } from \"../GitRef\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nconst StyledContainer = styled.div`\n  padding: 0.875rem;\n  cursor: default;\n`;\nconst StyledCommitMessage = styled.div`\n  font-family: \"JetBrains Mono\", monospace;\n  line-height: 1.125rem;\n  margin-bottom: 1.25rem;\n  margin-right: 1.1875rem;\n`;\n\nconst StyledCommitMessageHeader = styled.div`\n  font-weight: bold;\n`;\nconst StyledCommitterInfo = styled.div`\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n`;\n\nconst StyledCommitInfoRow = styled.div`\n  line-height: 1.2;\n  display: flex;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\nconst StyledRepoColorIcon = styled(RepoColorIcon)`\n  align-self: start;\n`;\n\nconst StyledRefsContainer = styled.span`\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\n\nexport function CommitDetails() {\n  const firstSelectedCommit = useAtomValue(\n    unwrapLatestOrNull(selectedCommitAtom)\n  );\n  const allResolvedRefs = useAtomValue(unwrapLatestOrNull(allResolvedRefsAtom));\n  const isMultiRepo = useAtomValue(vcsRootsAtom).length > 0;\n  if (!firstSelectedCommit) {\n    return (\n      <StyledPlaceholderContainer>\n        No commits selected\n      </StyledPlaceholderContainer>\n    );\n  }\n\n  const {\n    readCommitResult: { commit, oid },\n    containingRefs,\n    repoPath,\n  } = firstSelectedCommit;\n  const { subject, body } = parseCommitMessage(commit.message);\n  const committerInfo: ReactNode[] = [];\n  if (commit.committer.name !== commit.author.name) {\n    committerInfo.push(\n      <React.Fragment key={commit.committer.email}>\n        by {commit.committer.name} <EmailLink email={commit.committer.email} />\n      </React.Fragment>\n    );\n  }\n  if (commit.committer.timestamp !== commit.author.timestamp) {\n    committerInfo.push(formatDateAndTime(commit.committer.timestamp * 1000));\n  }\n  const refs = allResolvedRefs?.[oid] || [];\n  const refsByType = groupBy((ref) => ref.type, refs);\n  return (\n    <StyledContainer>\n      <StyledCommitMessage>\n        <StyledCommitMessageHeader>{subject}</StyledCommitMessageHeader>\n        {body}\n      </StyledCommitMessage>\n      <StyledCommitInfoRow>\n        {isMultiRepo && (\n          <TooltipTrigger tooltip={<Tooltip>{repoPath}</Tooltip>}>\n            {(props) => <StyledRepoColorIcon {...props} rootPath={repoPath} />}\n          </TooltipTrigger>\n        )}\n        <div>\n          {`${shortenOid(oid)} ${commit.author.name} `}\n          <EmailLink email={commit.author.email} />{\" \"}\n          {`${formatDateAndTime(new Date(commit.author.timestamp * 1000))}`}\n          {committerInfo.length > 0 && (\n            <StyledCommitterInfo>committed {committerInfo}</StyledCommitterInfo>\n          )}\n        </div>\n      </StyledCommitInfoRow>\n      {refs.length > 0 && (\n        <StyledRefsContainer>\n          <RefGroup refs={refsByType.head} />\n          <RefGroup refs={refsByType.localBranch} />\n          <RefGroup refs={refsByType.remoteBranch} />\n          <RefGroup refs={refsByType.tag} />\n        </StyledRefsContainer>\n      )}\n      <div>\n        {/*TODO: collapsing and \"Show more\"*/}\n        In {containingRefs.size} branches: {[...containingRefs].join(\", \")}\n      </div>\n    </StyledContainer>\n  );\n}\n\nconst StyledRefWithIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n`;\nfunction RefGroup({ refs }: { refs: undefined | GitRef[] }) {\n  return refs?.length ? (\n    <>\n      {refs.map((ref, index) => {\n        const name = `${ref.name}${index === refs.length - 1 ? \"\" : \",\"}`;\n        return index === 0 ? (\n          <StyledRefWithIcon>\n            <RefIconGroup types={refs.map(({ type }) => type).slice(0, 2)} />\n            {name}\n          </StyledRefWithIcon>\n        ) : (\n          // span is needed for the right flex-wrap behavior\n          <span>{name}</span>\n        );\n      })}\n    </>\n  ) : null;\n}\n\nfunction EmailLink({ email }: { email: string }) {\n  return (\n    <a href={`mailto:${email}`} style={{ all: \"unset\" }}>\n      <Link>{`<${email}>`}</Link>\n    </a>\n  );\n}\n\nfunction formatDateAndTime(date: Date | number) {\n  return `on ${formatCommitDate(date)} at ${formatCommitTime(date)}`;\n}\n","import { useMemo } from \"react\";\nimport { ActionDefinition, useActions } from \"@intellij-platform/core\";\n\n/**\n * Currently, action groups are expected to **define** the child actions, instead of just referencing already defined\n * actions. In such model, where groups are not just a grouping of existing actions, this hook allows for redefining\n * existing actions to be used within a group. Kind of a temporary solution while action system evolves.\n */\nexport function useRedefineAction(\n  actionId: string,\n  newId: string\n): ActionDefinition | null {\n  const actions = useActions();\n  const action = actions.find(({ id }) => id === actionId);\n\n  return useMemo(() => {\n    if (!action) {\n      return null;\n    }\n    const { perform, id, ...commonProperties } = action;\n    return {\n      ...commonProperties,\n      id: newId,\n      useShortcutsOf: id,\n      isSearchable: false,\n      actionPerformed: (context) => {\n        perform(context);\n      },\n    };\n  }, [action]);\n}\n","import React, { HTMLAttributes, useCallback } from \"react\";\nimport { Atom, atom, useAtom, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\n\nimport {\n  ActionButton,\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  CommonActionId,\n  IconButton,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  styled,\n  ThreeViewSplitter,\n  Toolbar,\n  TooltipTrigger,\n  useActionGroup,\n  useCreateDefaultActionGroup,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { CommitChangedFiles } from \"../CommitChanges/CommitsChangedFiles\";\nimport { CommitDetails } from \"./CommitDetails\";\nimport { defaultChangeGroupings } from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changesGroupingActiveAtoms,\n  commitChangesTreeRefAtom,\n} from \"../CommitChanges/CommitsChangedFiles.state\";\nimport {\n  vcsLogTabShowCommitDetailsInCurrentTabAtom,\n  vcsLogTabShowCommitDetailsAtoms,\n} from \"../vcs-logs.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { useRedefineAction } from \"../../../useRedefineAction\";\n\nimport { isAtom } from \"../../../atom-utils/isAtom\";\n\nconst splitViewSizeState = atom(0.5);\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst groupingAtom = atom((get) => {\n  const groupings = defaultChangeGroupings.filter((grouping) =>\n    isAtom(grouping.isAvailable)\n      ? get(grouping.isAvailable)\n      : grouping.isAvailable\n  );\n  return groupings.map((grouping) => ({\n    ...grouping,\n    key: `groupBy:${grouping.id}`,\n    isActive: get(changesGroupingActiveAtoms(grouping.id)),\n  }));\n});\n\nconst GROUP_BY_ACTION_GROUP_ID = \"Vcs.log.detailsView.groupBy\";\nconst LAYOUT_ACTION_GROUP_ID = \"Vcs.log.detailsView.layout\";\nconst VIEW_OPTIONS_ACTION_GROUP_ID = \"Vcs.log.detailsView.viewOptions\";\nconst SHOW_DETAILS_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DETAILS}`;\nconst SHOW_DIFF_PREVIEW_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DIFF_PREVIEW}`;\n\nconst groupingActionId = (grouping: { id: string }) => {\n  return `Vcs.log.detailsView.groupBy.${grouping.id}`;\n};\n\nexport function VcsLogDetailsView({ tabKey }: { tabKey: string }) {\n  const [splitViewSize, setSplitViewSize] = useAtom(splitViewSizeState);\n  const isDetailsVisible = useAtomValue(\n    vcsLogTabShowCommitDetailsAtoms(tabKey)\n  );\n  const toggleGroupBy = useAtomCallback(\n    useCallback((get, set, id: string) => {\n      set(changesGroupingActiveAtoms(id), (currentValue) => !currentValue);\n    }, [])\n  );\n  const createActionGroup = useCreateDefaultActionGroup();\n  const availableGroupings = useAtomValue(groupingAtom);\n\n  const treeRef = useAtomValue(commitChangesTreeRefAtom);\n  const actions = [\n    createActionGroup({\n      id: VIEW_OPTIONS_ACTION_GROUP_ID,\n      title: \"View Options\",\n      icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n      children: [\n        createActionGroup({\n          id: GROUP_BY_ACTION_GROUP_ID,\n          title: \"Group By\",\n          menuPresentation: \"titledSection\",\n          icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n\n          children: availableGroupings.map((grouping) => ({\n            id: groupingActionId(grouping),\n            useShortcutsOf: grouping.useShortcutOf,\n            title: grouping.title,\n            actionPerformed: () => {\n              toggleGroupBy(grouping.id);\n            },\n          })),\n        }),\n        createActionGroup({\n          id: LAYOUT_ACTION_GROUP_ID,\n          menuPresentation: \"titledSection\",\n          title: \"Layout\",\n          children: [\n            useRedefineAction(\n              VcsActionIds.SHOW_DETAILS,\n              SHOW_DETAILS_ACTION_ID\n            ),\n            useRedefineAction(\n              VcsActionIds.SHOW_DIFF_PREVIEW,\n              SHOW_DIFF_PREVIEW_ACTION_ID\n            ),\n          ].filter(notNull),\n        }),\n      ],\n    }),\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer>\n          <StyledHeader>\n            <Toolbar>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Show Diff\" shortcut=\"⌘D\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon={\"actions/diff.svg\"} />\n                </IconButton>\n              </TooltipTrigger>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Revert Selected Changes\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon=\"actions/rollback.svg\" />\n                </IconButton>\n              </TooltipTrigger>\n              <IconButtonWithMenu\n                renderMenu={({ menuProps }) => {\n                  return (\n                    <VcsLogsDetailsViewOptionsMenu menuProps={menuProps} />\n                  );\n                }}\n              >\n                <PlatformIcon icon=\"actions/groupBy.svg\" />\n              </IconButtonWithMenu>\n            </Toolbar>\n            <StyledSpacer />\n            <Toolbar style={{ flexShrink: 0 }}>\n              <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n              <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n            </Toolbar>\n          </StyledHeader>\n          <div style={{ flex: 1, minHeight: 0 }}>\n            {isDetailsVisible ? (\n              <ThreeViewSplitter\n                orientation=\"vertical\"\n                firstSize={splitViewSize}\n                onFirstResize={setSplitViewSize}\n                firstViewMinSize={10}\n                firstView={\n                  <CommitChangedFiles\n                    treeShortcutHandlerProps={shortcutHandlerProps}\n                  />\n                }\n                innerView={<CommitDetails />}\n              />\n            ) : (\n              <CommitChangedFiles\n                treeShortcutHandlerProps={shortcutHandlerProps}\n              />\n            )}\n          </div>\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst toggleActionAtoms: { [actionId: string]: Atom<boolean> } = {\n  [SHOW_DETAILS_ACTION_ID]: vcsLogTabShowCommitDetailsInCurrentTabAtom,\n  ...Object.fromEntries(\n    defaultChangeGroupings.map((grouping) => [\n      groupingActionId(grouping),\n      changesGroupingActiveAtoms(grouping.id),\n    ])\n  ),\n};\n\nconst selectedKeysAtom = atom((get) =>\n  Object.entries(toggleActionAtoms)\n    .filter(([, state]) => get(state))\n    .map(([actionId]) => actionId)\n);\n\nfunction VcsLogsDetailsViewOptionsMenu({\n  menuProps,\n}: {\n  menuProps: Omit<HTMLAttributes<HTMLDivElement>, \"autoFocus\">;\n}) {\n  const group = useActionGroup(VIEW_OPTIONS_ACTION_GROUP_ID);\n  const selectedKeys = useAtomValue(selectedKeysAtom);\n  return (\n    group && (\n      <ActionGroupMenu actionGroup={group}>\n        {(actionMenuProps) => (\n          <SpeedSearchMenu\n            {...menuProps}\n            {...actionMenuProps}\n            selectedKeys={selectedKeys}\n          />\n        )}\n      </ActionGroupMenu>\n    )\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  BareButton,\n  MenuTrigger,\n  MenuTriggerProps,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledDropdownButton = styled.button`\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding-left: 0.25rem;\n  cursor: pointer;\n  background: transparent;\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n\n  line-height: 1.5;\n  border-radius: 0.25rem;\n  white-space: nowrap;\n  border: 2px solid transparent;\n  &:hover {\n    color: ${({ theme }) => theme.color(\"*.foreground\")};\n  }\n  &:focus-visible {\n    border-color: ${({ theme }) =>\n      theme.commonColors.focusRing({ focused: true })};\n  }\n`;\n\nconst StyledDropdownIcon = styled.span`\n  margin-left: -1px;\n  line-height: 1.2;\n`;\n\nconst StyledValue = styled.span`\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  max-width: 8.25rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst FocusableAutoHoverPlatformIcon = styled(AutoHoverPlatformIcon)`\n  &:focus-visible {\n    outline: 2px solid\n      ${({ theme }) => theme.commonColors.focusRing({ focused: true })};\n    outline-offset: -2px;\n  }\n`;\nexport function VcsFilterDropdown({\n  label,\n  value,\n  onClear,\n  ...menuTriggerProps\n}: Omit<MenuTriggerProps, \"children\"> & {\n  label: React.ReactNode;\n  value?: React.ReactNode;\n  onClear?: () => void;\n}) {\n  return (\n    <MenuTrigger {...menuTriggerProps}>\n      {(props, ref) => (\n        <StyledDropdownButton {...props} ref={ref}>\n          {label}\n          {value ? (\n            <>\n              : <StyledValue>{value}</StyledValue>\n              <BareButton onPress={onClear}>\n                <FocusableAutoHoverPlatformIcon\n                  icon=\"actions/close\"\n                  hoverIcon=\"actions/closeHovered\"\n                />\n              </BareButton>\n            </>\n          ) : (\n            <StyledDropdownIcon>\n              <PlatformIcon icon=\"general/arrowDownSmall.svg\" />\n            </StyledDropdownIcon>\n          )}\n        </StyledDropdownButton>\n      )}\n    </MenuTrigger>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport React, { HTMLAttributes, useEffect, useState } from \"react\";\nimport { atom, useAtom, useAtomValue } from \"jotai\";\nimport { useResetAtom } from \"jotai/utils\";\nimport {\n  Divider,\n  Item,\n  MenuItemLayout,\n  SpeedSearchMenu,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  allBranchesAtom,\n  BranchType,\n  useFavoriteBranches,\n} from \"../../Branches/branches.state\";\nimport { BranchFavoriteButton } from \"../../Branches/BranchFavoriteButton\";\nimport { vcsLogFilter } from \"../vcs-logs.state\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nexport function BranchesFilterDropdown({ tabKey }: { tabKey: string }) {\n  const [selectedBranches, setSelectedBranches] = useAtom(\n    vcsLogFilter.branch(tabKey)\n  );\n  const resetBranches = useResetAtom(vcsLogFilter.branch(tabKey));\n\n  return (\n    <VcsFilterDropdown\n      value={selectedBranches.length > 0 ? selectedBranches.join(\"|\") : null}\n      onClear={resetBranches}\n      renderMenu={({ menuProps }) => (\n        <BranchesFilterMenu\n          menuProps={menuProps}\n          onBranchesSelected={setSelectedBranches}\n        />\n      )}\n      label=\"Branch\"\n    />\n  );\n}\n\nconst groupRepoRoots = (\n  branches: Array<{ branchName: string; repoRoot: string }>\n) =>\n  Object.entries(groupBy(({ branchName }) => branchName, branches)).map(\n    ([branchName, items]) => ({\n      branchName,\n      repoRoots: items.map((item) => item.repoRoot),\n    })\n  );\n/**\n * Unique list of all local and remote branches of all repositories.\n * Each branch has a list of repos which indicates the list of repository roots the branch appears in.\n */\nconst repoGroupedAllBranchesState = atom(async (get) => {\n  const allBranches = await get(allBranchesAtom);\n  const allRemoteBranches = allBranches.flatMap(\n    ({ remoteBranches, repoRoot }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branchName: `${branch.remote}/${branch.name}`,\n      }))\n  );\n  const allLocalBranches = allBranches.flatMap(({ localBranches, repoRoot }) =>\n    localBranches.map((branch) => ({\n      repoRoot,\n      branchName: branch.name,\n    }))\n  );\n  return {\n    localBranches: groupRepoRoots(allLocalBranches),\n    remoteBranches: groupRepoRoots(allRemoteBranches),\n  };\n});\n\ntype BranchMenuItem = {\n  branchType: BranchType;\n  branchName: string;\n  repoRoots: string[];\n};\n\nfunction BranchesFilterMenu({\n  menuProps,\n  onBranchesSelected,\n}: {\n  onBranchesSelected: (branches: string[]) => void;\n  menuProps: Omit<HTMLAttributes<HTMLElement>, \"autoFocus\">;\n}) {\n  const [favoriteBranches, setFavoriteBranches] = useState<BranchMenuItem[]>(\n    []\n  );\n  const { toggleFavorite, isFavorite } = useFavoriteBranches();\n  const repoGroupedAllBranches = useAtomValue(\n    unwrapLatestOrNull(repoGroupedAllBranchesState)\n  );\n  const { localBranches = [], remoteBranches = [] } =\n    repoGroupedAllBranches || {};\n\n  const remoteBranchesByRemote = groupBy(\n    ({ branchName }) => branchName.split(\"/\")[0],\n    remoteBranches\n  );\n\n  // The list of favorite branches is calculated on render, and is intentionally not updated. This behavior is copied\n  // from the reference implementation. Probably in order to not have items jump in and out of the menu, when branches\n  // are marked/unmarked as favorite. One improvement (?) here is that isFavorite state is always correct, as opposed\n  // to the reference implementation where (at least currently) the state of favorite icon is not kept up-to-date.\n  useEffect(() => {\n    const createLocalBranchItems = (\n      branchType: BranchType,\n      branches: Array<{ branchName: string; repoRoots: string[] }>\n    ): BranchMenuItem[] => {\n      return branches\n        .filter(({ branchName, repoRoots }) =>\n          repoRoots.some((repoRoot) =>\n            isFavorite({ branchType, branchName, repoRoot })\n          )\n        )\n        .map(({ branchName, repoRoots }) => ({\n          branchType,\n          branchName,\n          repoRoots,\n        }));\n    };\n\n    setFavoriteBranches(\n      [\n        {\n          branchType: \"LOCAL\",\n          branchName: \"HEAD\",\n          repoRoots: [],\n        } as BranchMenuItem,\n      ]\n        .concat(createLocalBranchItems(\"LOCAL\", localBranches))\n        .concat(createLocalBranchItems(\"REMOTE\", remoteBranches))\n    );\n  }, []);\n\n  const renderBranchItem = ({\n    branchName,\n    branchType,\n    repoRoots,\n  }: BranchMenuItem) => (\n    <Item key={`branch:${branchName}`} textValue={branchName}>\n      <MenuItemLayout\n        content={branchName}\n        icon={\n          <BranchFavoriteButton\n            isFavorite={\n              branchName === \"HEAD\" ||\n              repoRoots.some((repoRoot) =>\n                isFavorite({\n                  branchType,\n                  repoRoot,\n                  branchName,\n                })\n              )\n            }\n            onClick={() => {\n              if (branchName !== \"HEAD\") {\n                repoRoots.forEach((repoRoot) => {\n                  toggleFavorite({\n                    branchType,\n                    repoRoot,\n                    branchName,\n                  });\n                });\n              }\n            }}\n          />\n        }\n      />\n    </Item>\n  );\n  return (\n    <SpeedSearchMenu\n      {...menuProps}\n      submenuBehavior=\"toggleOnPress\"\n      autoFocus=\"first\"\n      minWidth={250}\n      onAction={(key) => {\n        const [type, value] = `${key}`.split(\":\");\n        if (type === \"branch\" && value) {\n          onBranchesSelected([value]);\n        } else if (type === \"favorites\") {\n          onBranchesSelected(\n            favoriteBranches.map(({ branchName }) => branchName)\n            // we could have filtered the ones that are actually favorite at this point, but not doing so to follow\n            // the original implementation, even though it's a little questionable.\n          );\n        } else if (type === \"select\") {\n          notImplemented(); // TODO\n        }\n      }}\n    >\n      {[\n        <Item key=\"select\">Select...</Item>,\n        <Item key=\"favorites\">Favorites</Item>,\n        ...favoriteBranches.map(renderBranchItem),\n        <Divider />,\n        <Item key=\"local\" title=\"Local\">\n          {localBranches.map(({ branchName, repoRoots }) =>\n            renderBranchItem({ branchType: \"LOCAL\", branchName, repoRoots })\n          )}\n        </Item>,\n        ...Object.entries(remoteBranchesByRemote).map(([origin, branches]) => (\n          <Item key={`remote:${origin}`} title={`${origin}/...`}>\n            {branches.map(({ branchName, repoRoots }) =>\n              renderBranchItem({ branchType: \"REMOTE\", branchName, repoRoots })\n            )}\n          </Item>\n        )),\n      ]}\n    </SpeedSearchMenu>\n  );\n}\n","import { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport type GitUser = { name: string; email: string };\n\nexport function areUsersEqual(\n  user1: GitUser | null | undefined,\n  user2: GitUser | null | undefined\n): boolean {\n  return (\n    Boolean(user1) &&\n    user1?.email === user2?.email &&\n    user1?.name === user2?.name\n  );\n}\nexport function areSamePerson(user1: GitUser, user2: GitUser): boolean {\n  return (\n    getNameInStandardForm(user1.name) === getNameInStandardForm(user2.name)\n  );\n}\nconst NAME_PATTERN = \"(\\\\w+)[\\\\p{Punct}\\\\s](\\\\w+)\";\n\nfunction getNameInStandardForm(name: string) {\n  const firstAndLastName = getFirstAndLastName(name);\n  if (firstAndLastName != null) {\n    const [firstName, lastName] = firstAndLastName;\n    return firstName.toLowerCase() + \" \" + lastName.toLowerCase(); // synonyms detection is currently english-only\n  }\n  return nameToLowerCase(name);\n}\n\nconst PRINTABLE_ASCII_PATTERN = \"[ -~]*\";\nfunction nameToLowerCase(name: string) {\n  if (!name.match(PRINTABLE_ASCII_PATTERN)) return name;\n  return name.toLowerCase();\n}\nfunction getFirstAndLastName(name: string) {\n  const matches = name.match(NAME_PATTERN);\n  if (matches) {\n    return [matches[1], matches[2]];\n  }\n  return null;\n}\nexport const gitRepoUserAtoms = atomFamily((repoRoot: string) =>\n  atom<Promise<GitUser>>(async () => {\n    const name = await git.getConfig({ fs, dir: repoRoot, path: \"user.name\" });\n    const email = await git.getConfig({\n      fs,\n      dir: repoRoot,\n      path: \"user.email\",\n    });\n    return {\n      name: name ?? \"\",\n      email: email ?? \"\",\n    };\n  })\n);\n","import React, { CSSProperties, RefObject, useMemo } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { css, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\n\nimport { ReadCommitResult } from \"isomorphic-git\";\nimport { GitRef } from \"../GitRef\";\nimport { RefIcon, RefLabel } from \"../RefLabel\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityAtoms,\n  vcsTableHighlightMyCommitsAtom,\n  vcsTableReferencesOnTheLeftAtom,\n  vcsTableShowCommitTimestampAtom,\n} from \"./CommitsTable.state\";\nimport {\n  areSamePerson,\n  gitRepoUserAtoms,\n  GitUser,\n} from \"../../git-users.state\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsLogFilterCurrentTab,\n} from \"../vcs-logs.state\";\nimport {\n  formatCommitDateTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\n\nconst StyledCommitRow = styled.div`\n  display: flex;\n  height: 1.5rem;\n  align-items: center;\n  width: 100%;\n  --column-width-1: 130px;\n  --column-width-2: 130px;\n  --column-width-3: 70px;\n`;\nconst StyledCommitCell = styled.div`\n  overflow: hidden;\n  padding-left: 0.25rem;\n`;\n\nconst StyledRefsContainer = styled.div<{ asOverlay?: boolean }>`\n  ${({ asOverlay }) =>\n    !asOverlay\n      ? css`\n          position: absolute;\n          right: 0;\n          top: 1px;\n          max-width: calc(100% - 100px);\n        `\n      : css`\n          flex-shrink: 0;\n        `};\n\n  display: flex;\n  gap: 0.25rem;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(theme.color(\"List.background\"))};\n`;\nconst StyledMessageContainer = styled.div`\n  position: relative;\n  display: flex;\n  gap: 0.25rem;\n`;\n\nconst StyledRefTooltipRow = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0.25rem;\n  font-size: 0.75rem;\n`;\nconst useCurrentUserHighlightStyle = ({\n  repoRoot,\n  author,\n}: {\n  repoRoot: string;\n  author: GitUser;\n}): CSSProperties => {\n  const currentUser = useAtomValue(gitRepoUserAtoms(repoRoot));\n  const shouldHighlightCurrentUserCommits = useAtomValue(\n    vcsTableHighlightMyCommitsAtom\n  );\n  // for now assuming only a single table can be visible, and that's current tab's.\n  const userFilter = useAtomValue(vcsLogFilterCurrentTab.user);\n  // single user case is not considered a special case, like it is in the original impl\n  const shouldHighlight =\n    shouldHighlightCurrentUserCommits &&\n    userFilter !== CURRENT_USER_FILTER_VALUE &&\n    areSamePerson(currentUser, author);\n\n  return { fontWeight: shouldHighlight ? \"bold\" : undefined };\n};\n\nexport function CommitsTableRow({\n  refs,\n  readCommitResult: {\n    oid,\n    commit: { author, committer, message },\n  },\n  repoRoot,\n}: {\n  repoRoot: string;\n  readCommitResult: ReadCommitResult;\n  refs: GitRef[] | undefined;\n}) {\n  const showCommitTimestamp = useAtomValue(vcsTableShowCommitTimestampAtom);\n  const referencesOnTheLeft = useAtomValue(vcsTableReferencesOnTheLeftAtom);\n  const isAuthorVisible = useAtomValue(\n    vcsTableColumnsVisibilityAtoms(authorColumn.id)\n  );\n  const isDateVisible = useAtomValue(\n    vcsTableColumnsVisibilityAtoms(dateColumn.id)\n  );\n  const isHashVisible = useAtomValue(\n    vcsTableColumnsVisibilityAtoms(hashColumn.id)\n  );\n\n  const highlightStyles = useCurrentUserHighlightStyle({ author, repoRoot });\n  return (\n    <StyledCommitRow>\n      <StyledCommitCell style={{ flexBasis: \"0%\", flexGrow: 1, flexShrink: 1 }}>\n        <StyledMessageContainer>\n          {refs && <CommitRefs onLeft={referencesOnTheLeft} refs={refs} />}\n          <span style={highlightStyles}>\n            {parseCommitMessage(message).subject}\n          </span>\n        </StyledMessageContainer>\n      </StyledCommitCell>\n      {isAuthorVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-1)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {author.name}\n          {committer.name !== author.name && \"*\"}\n        </StyledCommitCell>\n      )}\n      {isDateVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-2)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {formatCommitDateTime(\n            (showCommitTimestamp ? committer : author).timestamp * 1000\n          )}\n        </StyledCommitCell>\n      )}\n      {isHashVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-3)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {shortenOid(oid)}\n        </StyledCommitCell>\n      )}\n    </StyledCommitRow>\n  );\n}\n\nfunction refKey(ref: GitRef) {\n  return `${ref.type}${ref.name}`;\n}\n\nfunction CommitRefs({ refs, onLeft }: { refs: GitRef[]; onLeft?: boolean }) {\n  const { filteredRefs } = useMemo(() => {\n    const headIsOnABranch = refs.some(\n      (ref) => ref.type === \"localBranch\" && ref.isCurrent\n    );\n    return {\n      filteredRefs: refs.filter(\n        (ref) =>\n          !(\n            (ref.type === \"head\" && headIsOnABranch) ||\n            (ref.type === \"remoteBranch\" &&\n              refs.find(\n                (aBranch) =>\n                  aBranch.type === \"localBranch\" &&\n                  aBranch.trackingBranch === ref.name\n              ))\n          )\n      ),\n    };\n  }, [refs]);\n\n  return (\n    <TooltipTrigger\n      placement=\"bottom\"\n      delay={800}\n      isDisabled={refs.length < 2}\n      tooltip={\n        <Tooltip withPointer>\n          {refs.map((ref) => (\n            <StyledRefTooltipRow key={refKey(ref)}>\n              <RefIcon type={ref.type} />\n              {ref.name}\n            </StyledRefTooltipRow>\n          ))}\n        </Tooltip>\n      }\n    >\n      {({ ref, ...tooltipTriggerProps }) => (\n        <StyledRefsContainer\n          ref={ref as RefObject<HTMLDivElement>}\n          asOverlay={onLeft}\n          {...tooltipTriggerProps}\n        >\n          {filteredRefs\n            .filter(\n              (ref) =>\n                ref.type !== \"remoteBranch\" ||\n                !refs.find(\n                  (aBranch) =>\n                    aBranch.type === \"localBranch\" &&\n                    aBranch.trackingBranch === ref.name\n                )\n            )\n            .map((ref) => {\n              let name = ref.name;\n              const types: GitRef[\"type\"][] = [ref.type];\n              if (ref.type === \"localBranch\" && ref.trackingBranch) {\n                types.unshift(\"remoteBranch\");\n                name = `${ref.trackingBranch.split(\"/\")[0]} & ${ref.name}`;\n              }\n              if (ref.type === \"localBranch\" && ref.isCurrent) {\n                types.push(\"head\");\n              }\n              return (\n                <RefLabel key={refKey(ref)} types={types}>\n                  {name}\n                </RefLabel>\n              );\n            })}\n        </StyledRefsContainer>\n      )}\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { Item, Link, List, ProgressBar, styled } from \"@intellij-platform/core\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { useResetFilters, vcsActiveTabKeyAtom } from \"../vcs-logs.state\";\nimport { GitRef } from \"../GitRef\";\nimport { CommitsTableRow } from \"./CommitsTableRow\";\nimport {\n  allResolvedRefsAtom,\n  commitsSelectionAtom,\n  commitsTableRowsAtom,\n} from \"./CommitsTable.state\";\nimport { unwrapLatestWithLoading } from \"../../../atom-utils/unwrapLatestWithLoading\";\n\n// const StyledList = styled(List)`\n//   display: grid;\n//   grid-template-columns: repeat(3, auto); /* Define 3 columns */\n//\n//   ${StyledListItem} {\n//     display: contents;\n//   }\n// ` as typeof List;\n\nconst StyledProgressBar = styled(ProgressBar)`\n  position: absolute;\n  width: 100%;\n  z-index: 1;\n`;\nconst StyledContainer = styled.div`\n  position: relative;\n  min-height: 0;\n  flex: 1;\n  ${StyledListItem} {\n    // the default \"min-width: min-content\", which is necessary for sizing overlays (e.g. Popup) containing list/tree,\n    // results in horizontally scrollable table. Probably not an issue when a proper Table component is implemented.\n    min-width: unset;\n  }\n`;\nconst ResolvedRefsContext = React.createContext<Record<string, GitRef[]>>({});\nexport function CommitsTable() {\n  const currentTabKey = useAtomValue(vcsActiveTabKeyAtom);\n  const resetFilters = useResetFilters();\n\n  const { value: result, isLoading } = useAtomValue(\n    unwrapLatestWithLoading(commitsTableRowsAtom, null)\n  );\n\n  const rows = result?.rows;\n  const allResolvedRefs = useAtomValue(unwrapLatestOrNull(allResolvedRefsAtom));\n  const [selectedCommits, setSelectedCommits] = useAtom(commitsSelectionAtom);\n\n  return (\n    <ResolvedRefsContext.Provider value={allResolvedRefs ?? {}}>\n      <StyledContainer>\n        {isLoading && (\n          <StyledProgressBar aria-label=\"Loading commits\" isIndeterminate />\n        )}\n        {rows && rows.length > 0 && (\n          <List\n            aria-label=\"Commits list\"\n            items={rows}\n            fillAvailableSpace\n            selectionMode=\"multiple\"\n            selectedKeys={selectedCommits}\n            onSelectionChange={setSelectedCommits}\n            estimatedItemHeight={24}\n          >\n            {({ readCommitResult, repoPath }) => (\n              <Item\n                key={readCommitResult.oid}\n                textValue={readCommitResult.commit.message}\n              >\n                {/* Using context here due to rendering optimizations of collection API */}\n                <ResolvedRefsContext.Consumer>\n                  {(refs) => (\n                    <CommitsTableRow\n                      readCommitResult={readCommitResult}\n                      repoRoot={repoPath}\n                      refs={refs[readCommitResult.oid]}\n                    />\n                  )}\n                </ResolvedRefsContext.Consumer>\n              </Item>\n            )}\n          </List>\n        )}\n        {rows && rows.length === 0 && (\n          <StyledPlaceholderContainer>\n            No commits matching filters\n            <Link onPress={() => resetFilters(currentTabKey)}>\n              Reset filters\n            </Link>\n          </StyledPlaceholderContainer>\n        )}\n      </StyledContainer>\n    </ResolvedRefsContext.Provider>\n  );\n}\n","import React from \"react\";\nimport { PrimitiveAtom, useAtom } from \"jotai\";\nimport {\n  ActionTooltip,\n  IconButtonWithMenu,\n  Item,\n  PlatformIcon,\n  Section,\n  SpeedSearchMenu,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityAtoms,\n  vcsTableHighlightMyCommitsAtom,\n  vcsTableReferencesOnTheLeftAtom,\n  vcsTableShowCommitTimestampAtom,\n} from \"./CommitsTable.state\";\n\ntype ToggleDef = {\n  name: string;\n  key: string;\n  atom: PrimitiveAtom<boolean>;\n};\nconst showToggleDefs = [\n  {\n    key: \"commitTimestamp\",\n    name: \"Commit Timestamp\",\n    atom: vcsTableShowCommitTimestampAtom,\n  },\n  {\n    key: \"referencesOnLeft\",\n    name: \"References on the Left\",\n    atom: vcsTableReferencesOnTheLeftAtom,\n  },\n];\n\nconst highlightToggleDefs = [\n  {\n    key: \"myCommits\",\n    name: \"My Commits\",\n    atom: vcsTableHighlightMyCommitsAtom,\n  },\n];\nconst columnToggleDefs = [authorColumn, hashColumn, dateColumn].map(\n  ({ name, id }) => ({\n    name,\n    key: id,\n    atom: vcsTableColumnsVisibilityAtoms(id),\n  })\n);\nconst useToggleDef = (item: ToggleDef) => {\n  const [value, set] = useAtom(item.atom);\n  return { ...item, value, set };\n};\n\nexport function CommitsTableViewOptionsMenuIconButton() {\n  const showToggles = showToggleDefs.map(useToggleDef);\n  const highlightToggles = highlightToggleDefs.map(useToggleDef);\n  const columnToggles = columnToggleDefs.map(useToggleDef);\n\n  const allToggles = showToggles.concat(highlightToggles).concat(columnToggles);\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            // TODO: keep menu open when (certain) items are toggled. Search for closeOnSelect TODO in menu\n            <SpeedSearchMenu\n              {...menuProps}\n              selectedKeys={allToggles\n                .filter(({ value }) => value)\n                .map(({ name }) => name)}\n              onAction={(key) => {\n                const toggle = allToggles.find(\n                  ({ name: toggleKey }) => toggleKey === key\n                );\n                if (toggle) {\n                  toggle.set((value) => !value);\n                } else {\n                  notImplemented();\n                }\n              }}\n            >\n              <Section title=\"Show\">\n                <Item>Compact References View</Item>\n                <Item>Tag Names</Item>\n                <Item>Long Edges</Item>\n                {\n                  showToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item title=\"Columns\">\n                  {\n                    columnToggles.map(({ name, key }) => (\n                      <Item key={key}>{name}</Item>\n                    )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                  }\n                </Item>\n              </Section>\n              <Section title=\"Highlight\">\n                {\n                  highlightToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item>Merge Commits</Item>\n                <Item>Current Branch</Item>\n                <Item>Not Cherry-Picked Commits</Item>\n              </Section>\n            </SpeedSearchMenu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { v4 as uuid } from \"uuid\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  IconButton,\n  Item,\n  Menu,\n  PlatformIcon,\n  SearchInput,\n  styled,\n  StyledHoverContainer,\n  Toolbar,\n  ToolbarSeparator,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport { atom, useAtom, useAtomValue, WritableAtom } from \"jotai\";\nimport { useAtomCallback, useResetAtom } from \"jotai/utils\";\nimport { searchInputRefAtom } from \"../VersionControlToolWindow\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsActiveTabKeyAtom,\n  vcsLogFilter,\n  vcsTabKeysAtom,\n} from \"../vcs-logs.state\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { DateRange, dateToString } from \"../DateRange\";\nimport { BranchesFilterDropdown } from \"./BranchesFilterDropdown\";\nimport { CommitsTable } from \"./CommitsTable\";\nimport { CommitsTableViewOptionsMenuIconButton } from \"./CommitsTableViewOptionsMenuIconButton\";\n\nconst StyledSearchInput = styled(SearchInput)`\n  border-radius: 2px;\n  width: 219px;\n  margin-right: 0.0625rem;\n  margin-left: 0.2rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\n// TODO: add an effect to persist it under application level other.xml file under\n// PropertyService component's \"Vcs.Log.Text.Filter.History\" property\nconst searchHistoryState = atom<string[]>([]);\n\nexport function VcsLogCommitsView({ tabKey }: { tabKey: string }) {\n  const textFilterRef = useAtomValue(searchInputRefAtom);\n  const [searchQuery, setSearchQuery] = useAtom(\n    vcsLogFilter.searchQuery(tabKey)\n  );\n  const [user, setUser] = useAtom(vcsLogFilter.user(tabKey));\n  const resetUser = useResetAtom(vcsLogFilter.user(tabKey));\n  const [dateFilter, setDateFilter] = useAtom(vcsLogFilter.date(tabKey));\n  const resetDate = useResetAtom(vcsLogFilter.date(tabKey));\n  const [searchHistory, setSearchHistory] = useAtom(searchHistoryState);\n  const [searchInputValue, setSearchInputValue] = useState(searchQuery);\n  const getActionShortcut = useGetActionShortcut();\n  const isRegExpOn = useAtomValue(vcsLogFilter.regExp(tabKey));\n  const isMatchCaseOn = useAtomValue(vcsLogFilter.matchCase(tabKey));\n  const submitSearchQuery = (value = searchInputValue) => {\n    setSearchQuery(value);\n    if (value && !searchHistory.includes(value)) {\n      setSearchHistory((searchHistory) => [\n        value,\n        ...searchHistory.filter((item) => item !== value),\n      ]);\n    }\n  };\n\n  useEffect(() => {\n    setSearchInputValue(searchQuery);\n  }, [searchQuery]);\n\n  const createNewTab = useAtomCallback(\n    useCallback((get, set) => {\n      const newTabId = uuid();\n      set(vcsTabKeysAtom, (value) => [...value, newTabId]);\n      Object.values(vcsLogFilter).forEach(\n        (\n          getTabFilterAtom: (tabKey: string) => WritableAtom<any, any, void>\n        ) => {\n          // TODO(jotai): using jotai utils like [split](https://jotai.org/docs/utilities/split) might simplify vcs log tabs state management\n          set(\n            getTabFilterAtom(newTabId),\n            get(getTabFilterAtom(get(vcsActiveTabKeyAtom)))\n          );\n        }\n      );\n      set(vcsActiveTabKeyAtom, newTabId);\n    }, [])\n  );\n  const today = new Date();\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(today.getDate() - 7);\n  const yesterday = new Date();\n  yesterday.setDate(today.getDate() - 1);\n  const predefinedDateRanges = [\n    {\n      name: \"Last 24 hours\",\n      value: { from: yesterday },\n    },\n    {\n      name: \"Last 7 days\",\n      value: { from: sevenDaysAgo },\n    },\n  ];\n\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName=\"Text or Hash Filter\"\n              shortcut={getActionShortcut(VcsActionIds.FOCUS_TEXT_FILTER)}\n            />\n          }\n        >\n          <StyledSearchInput\n            inputRef={textFilterRef}\n            value={searchInputValue}\n            onChange={setSearchInputValue}\n            onSubmit={submitSearchQuery}\n            onBlur={() => submitSearchQuery()}\n            onClear={() => submitSearchQuery(\"\")}\n            searchHistory={searchHistory}\n            addonAfter={\n              <>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.REG_EXP}\n                >\n                  <AutoHoverPlatformIcon\n                    icon={\n                      isRegExpOn ? \"actions/regexSelected\" : \"actions/regex\"\n                    }\n                    hoverIcon={\n                      isRegExpOn\n                        ? \"actions/regexSelected\"\n                        : \"actions/regexHovered\"\n                    }\n                  />\n                </StyledHoverContainer>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.MATCH_CASE}\n                >\n                  {isMatchCaseOn ? (\n                    <PlatformIcon icon=\"actions/matchCaseSelected\" />\n                  ) : (\n                    <AutoHoverPlatformIcon\n                      icon=\"actions/matchCase\"\n                      hoverIcon=\"actions/matchCaseHovered\"\n                    />\n                  )}\n                </StyledHoverContainer>\n              </>\n            }\n          />\n        </TooltipTrigger>\n        <Toolbar>\n          <BranchesFilterDropdown tabKey={tabKey} />\n          <VcsFilterDropdown\n            value={user === CURRENT_USER_FILTER_VALUE ? \"me\" : user}\n            onClear={resetUser}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  if (key === \"select\") {\n                    return notImplemented();\n                  }\n                  setUser(`${key}`);\n                }}\n              >\n                <Item key=\"select\">Select...</Item>\n                <Item key={CURRENT_USER_FILTER_VALUE}>me</Item>\n              </Menu>\n            )}\n            label=\"User\"\n          />\n          <VcsFilterDropdown\n            value={dateFilter && dateRangeToString(dateFilter)}\n            onClear={resetDate}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  const predefinedDateRange = predefinedDateRanges.find(\n                    ({ name }) => name === key\n                  );\n                  if (predefinedDateRange) {\n                    setDateFilter(predefinedDateRange.value);\n                  } else {\n                    notImplemented();\n                  }\n                }}\n              >\n                {[\n                  <Item key=\"select\">Select...</Item>,\n                  ...predefinedDateRanges.map(({ name }) => (\n                    <Item key={name}>{name}</Item>\n                  )),\n                ]}\n              </Menu>\n            )}\n            label=\"Date\"\n          />\n          <VcsFilterDropdown\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Select in...</Item>\n                <Item>Select in Tree...</Item>\n              </Menu>\n            )}\n            label=\"Paths\"\n          />\n          <ToolbarSeparator />\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Open New Git Log Tab\" />}\n          >\n            <IconButton aria-label=\"Checkout\" onPress={createNewTab}>\n              <PlatformIcon icon=\"actions/openNewTab.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <ActionButton actionId={VcsActionIds.LOG_REFRESH} />\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Cherry-Pick\" />}>\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/cherryPick.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <CommitsTableViewOptionsMenuIconButton />\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip actionName=\"Go To Hash/Branch/Tag\" shortcut=\"⌘F\" />\n            }\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/find\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n      </StyledHeader>\n      <CommitsTable />\n    </StyledContainer>\n  );\n}\n\nfunction dateRangeToString(dateRange: DateRange): string {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n}\n","import { basename } from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\nimport { PlatformIcon, TreeRefValue } from \"@intellij-platform/core\";\n\nimport {\n  allBranchesAtom,\n  BranchType,\n  isFavoriteBranchAtoms,\n  LocalBranch,\n  RemoteBranch,\n  RepoBranches,\n} from \"../../Branches/branches.state\";\nimport {\n  createGroupByDirectory,\n  DirectoryNode,\n} from \"../../../tree-utils/groupByDirectory\";\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport { vcsLogAtomFamily } from \"../vcs-logs.state\";\n\ntype LocalBranchNode = {\n  type: \"localBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is current branch in at least one repo\n   */\n  isCurrent: boolean;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n};\ntype RemoteBranchNode = {\n  type: \"remoteBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n  branches: Array<{ repoRoot: string; branch: RemoteBranch }>;\n};\ntype BranchDirectoryNode = DirectoryNode & {\n  children: readonly AnyBranchTreeNode[];\n};\ntype RepositoryNode = {\n  type: \"repository\";\n  key: string;\n  repoRoot: string;\n  children: ReadonlyArray<LocalBranchNode | RemoteBranchNode | DirectoryNode>;\n};\nexport type AnyBranchTreeNode =\n  | {\n      type: \"head\";\n    }\n  | {\n      type: \"branchType\";\n      branchType: BranchType;\n      children: readonly AnyBranchTreeNode[];\n    }\n  | RepositoryNode\n  | BranchDirectoryNode\n  | LocalBranchNode\n  | RemoteBranchNode;\n\nfunction getLocalBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allLocalBranches = repoBranches.flatMap(\n    ({ repoRoot, localBranches, currentBranch }) =>\n      localBranches.map((branch) => ({\n        repoRoot,\n        isCurrent: currentBranch?.name === branch.name,\n        branch,\n      }))\n  );\n  const localBranchNodes = Object.entries(\n    groupBy(({ branch }) => branch.name, allLocalBranches)\n  ).map<LocalBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"localBranch\",\n      key: `localBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchAtoms({\n          repoRoot,\n          branchType: \"LOCAL\",\n          branchName: branch.name,\n        })\n      ),\n      isCurrent: branches.some(({ isCurrent }) => isCurrent),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(localBranchNodes);\n  }\n  return localBranchNodes;\n}\n\nfunction getRemoteBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allRemoteBranches = repoBranches.flatMap(\n    ({ repoRoot, remoteBranches }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branch,\n      }))\n  );\n  const remoteBranchNodes = Object.entries(\n    groupBy(\n      ({ branch }) => `${branch.remote}/${branch.name}`,\n      allRemoteBranches\n    )\n  ).map<RemoteBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"remoteBranch\",\n      key: `remoteBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchAtoms({\n          repoRoot,\n          branchType: \"REMOTE\",\n          branchName: branch.name,\n        })\n      ),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(remoteBranchNodes);\n  }\n  return remoteBranchNodes;\n}\n\nexport const branchesTreeNodeAtom = atom(\n  async (get): Promise<AnyBranchTreeNode[]> => {\n    // TODO: sorting. favorite should be on top. Others should be alphabetical\n    const repoBranches = await get(allBranchesAtom);\n    const shouldGroupByDirectory = get(branchTreeGroupingAtoms(\"directory\"));\n    const shouldGroupByRepository =\n      get(isGroupByRepositoryAvailableAtom) &&\n      get(branchTreeGroupingAtoms(\"repository\"));\n\n    return [\n      { type: \"head\" },\n      {\n        type: \"branchType\",\n        branchType: \"LOCAL\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `LOCAL:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getLocalBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getLocalBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n      {\n        type: \"branchType\",\n        branchType: \"REMOTE\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `REMOTE:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getRemoteBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getRemoteBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n    ];\n  }\n);\nconst groupNodesByDirectory = createGroupByDirectory<\n  LocalBranchNode | RemoteBranchNode,\n  BranchDirectoryNode\n>({\n  shouldCollapseDirectories: false,\n  getPath: (node) => node.name,\n});\n\nexport const branchTreeGroupingAtoms = atomFamily(\n  (_param: \"directory\" | \"repository\") => atom(false)\n);\n\nexport const isGroupByRepositoryAvailableAtom = atom<boolean>(\n  (get) => get(vcsRootsAtom).length > 1\n);\n\nexport const branchesTreeRefAtoms = vcsLogAtomFamily(\n  React.createRef<TreeRefValue>()\n);\n\nexport const selectedKeysAtoms = vcsLogAtomFamily<Selection>(new Set<Key>());\n\nexport const expandedKeysAtoms = vcsLogAtomFamily(new Set<Key>());\n\nexport const searchInputAtoms = vcsLogAtomFamily(\"\");\n\nconst groupings = [\n  {\n    id: \"directory\" as const,\n    title: \"Directory\",\n    icon: <PlatformIcon icon=\"actions/GroupByPackage.svg\" />,\n    isActive: branchTreeGroupingAtoms(\"directory\"),\n    isAvailable: true,\n  },\n  {\n    id: \"repository\" as const,\n    title: \"Repository\",\n    isActive: branchTreeGroupingAtoms(\"repository\"),\n    isAvailable: isGroupByRepositoryAvailableAtom,\n  },\n];\n\nexport const availableGroupingsAtom = atom((get) =>\n  groupings\n    .filter((grouping) =>\n      typeof grouping.isAvailable !== \"boolean\"\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    )\n    .map((grouping) => ({\n      ...grouping,\n      isActive: get(branchTreeGroupingAtoms(grouping.id)),\n    }))\n);\n","import React, { useCallback } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\n\nimport { GroupByActionButton } from \"../../../GroupByActionButton\";\nimport {\n  availableGroupingsAtom,\n  branchTreeGroupingAtoms,\n} from \"./BranchesTree.state\";\n\nexport function BranchesGroupByActionButton() {\n  //  TODO: Generalize and convert to actions\n  const toggleGroup = useAtomCallback(\n    useCallback(\n      (get, set) => (id: \"directory\" | \"repository\") => {\n        set(branchTreeGroupingAtoms(id), (value) => !value);\n      },\n      []\n    )\n  );\n  const availableGroupings = useAtomValue(availableGroupingsAtom);\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n}\n","import { basename } from \"path\";\nimport React from \"react\";\nimport { ItemElement } from \"@react-types/shared/src/collections\";\nimport {\n  ActionTooltip,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { TrackingBranchInfo } from \"../../TrackingBranchInfo\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { AnyBranchTreeNode } from \"./BranchesTree.state\";\n\nexport const branchTreeNodeRenderers: {\n  [nodeType in AnyBranchTreeNode[\"type\"]]: (\n    node: AnyBranchTreeNode & { type: nodeType }\n  ) => ItemElement<AnyBranchTreeNode>;\n} = {\n  branchType: (node) => {\n    return (\n      <Item\n        key={`${node.type}:${node.branchType}`}\n        textValue={wordCase(node.branchType)}\n        childItems={node.children}\n      >\n        <HighlightedTextValue />\n      </Item>\n    );\n  },\n  localBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={node.branches} />}\n              ></ActionTooltip>\n            }\n          >\n            {(props) => (\n              <ItemLayout.Group {...props}>\n                {node.isCurrent ? (\n                  <TooltipTrigger\n                    tooltip={\n                      <Tooltip>\n                        Current {node.isFavorite && \"favorite \"}branch\n                      </Tooltip>\n                    }\n                  >\n                    {(props) => (\n                      <ItemLayout.Group {...props}>\n                        <PlatformIcon\n                          icon={\n                            node.isFavorite\n                              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n                              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n                          }\n                        />\n                      </ItemLayout.Group>\n                    )}\n                  </TooltipTrigger>\n                ) : (\n                  <PlatformIcon icon=\"vcs/branchNode\" />\n                )}\n                <HighlightedTextValue />\n                {node.repos && (\n                  <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n                )}\n              </ItemLayout.Group>\n            )}\n          </TooltipTrigger>\n        </ItemLayout>\n      </Item>\n    );\n  },\n  remoteBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <PlatformIcon\n            icon={node.isFavorite ? \"nodes/favorite.svg\" : \"vcs/branchNode\"}\n          />\n          <HighlightedTextValue />\n          {node.repos && (\n            <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n          )}\n        </ItemLayout>\n      </Item>\n    );\n  },\n  repository: (node) => (\n    <Item\n      key={`${node.key}`}\n      textValue={basename(node.repoRoot)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <RepoColorIcon rootPath={node.repoRoot} />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  directory: (node) => (\n    <Item\n      key={`${node.type}_${node.parentNodePath}${node.dirPath}`}\n      textValue={basename(node.dirPath)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <PlatformIcon icon=\"nodes/folder.svg\" />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  head: (node) => (\n    <Item key={`${node.type}`} textValue=\"HEAD (Current Branch)\">\n      <HighlightedTextValue />\n    </Item>\n  ),\n};\n\nfunction wordCase(input: string): string {\n  return input[0].toUpperCase() + input.slice(1).toLowerCase();\n}\n\nexport const keyToBranch = (key: string): string | null => {\n  const [type, _repo, branchName] = key.split(\":\");\n  if (type === \"head\") {\n    return \"HEAD\";\n  }\n  if (type === \"localBranch\" || type === \"remoteBranch\") {\n    return branchName ?? null;\n  }\n  return null;\n};\n","import React, { useRef, useState } from \"react\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { PlatformIcon, SpeedSearchTree, styled } from \"@intellij-platform/core\";\n\nimport {\n  branchTreeNodeRenderers,\n  keyToBranch,\n} from \"./branchTreeNodeRenderers\";\nimport {\n  branchesTreeNodeAtom,\n  branchesTreeRefAtoms,\n  expandedKeysAtoms,\n  searchInputAtoms,\n  selectedKeysAtoms,\n} from \"./BranchesTree.state\";\nimport { StyledHeader } from \"../styled-components\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nconst StyledSearchInput = styled.input`\n  all: unset;\n  flex: 1;\n  align-self: stretch;\n`;\nconst StyledContainer = styled.div`\n  min-width: 0; // don't outgrow the container\n  flex-grow: 1; // fill the available space\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledSearchIconContainer = styled.span`\n  display: inline-flex;\n  margin-top: -0.0625rem;\n  margin-left: 0.7rem;\n  margin-right: 0.25rem;\n  cursor: text;\n`;\n\nexport function BranchesTree({ tabKey }: { tabKey: string }) {\n  const branchesTreeNodes = useAtomValue(\n    unwrapLatestOrNull(branchesTreeNodeAtom)\n  );\n  const [selectedKeys, setSelectedKeys] = useAtom(selectedKeysAtoms(tabKey));\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtoms(tabKey));\n  const [searchTerm, setSearchTerm] = useAtom(searchInputAtoms(tabKey));\n  const treeRef = useAtomValue(branchesTreeRefAtoms(tabKey));\n  const ref = useRef<HTMLDivElement>(null);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setInputFocused] = useState(false);\n  const setBranchFilter = useSetAtom(vcsLogFilterCurrentTab.branch);\n  const onAction = (key: React.Key) => {\n    const branch = keyToBranch(`${key}`);\n    if (branch) {\n      setBranchFilter([branch]);\n    }\n  };\n\n  /**\n   * TODO: remaining from search:\n   * - Make the search input red when there is no match\n   * - filter non-matching tree nodes out\n   * - search in the whole tree, not just nodes that are currently visible based on expandedKeys\n   *   - update expanded keys to show matches, as a side effect, every time matches are updated.\n   * The above items are postponed to think more about flexibility of SpeedSearchTree API.\n   * Some rough thoughts about different approaches:\n   * - Provide generic tree utilities to search in the whole tree. In SpeedSearchTree allow for full control over\n   * `matches`. It will be in usage side that matches are calculated based on search input value, and passed to\n   * SpeedSearchTree as an input.\n   * - In SpeedSearchTree, allow for passing a custom search function, which would accept the tree collection object,\n   *   the search query, and the default match function (minusculeMatch).\n   * - Make Tree more flexible or introduce a more flexible base component, so that speed search for tree can be\n   *   implementated in a more composable way. Tree (or TreeBase) would accept props for intercepting `state` creation,\n   *   and it would also allow passing additional props to the tree container. Then a more generic CollectionSpeedSearch\n   *   component would offer options on how to control and customize speed search, and would return props to be passed\n   *   to collection components.\n   */\n\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <StyledSearchIconContainer>\n          <PlatformIcon icon=\"actions/search\" />\n        </StyledSearchIconContainer>\n        {/* FIXME: tabIndex -1 is a workaround to not get the input focused when the toolwindow opens. Not ideal.*/}\n        <StyledSearchInput\n          ref={searchInputRef}\n          tabIndex={-1}\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          onFocus={() => {\n            setInputFocused(true);\n          }}\n          onBlur={() => {\n            setInputFocused(false);\n          }}\n        />\n      </StyledHeader>\n      <SpeedSearchTree\n        ref={ref}\n        treeRef={treeRef}\n        focusProxyRef={searchInputRef}\n        items={branchesTreeNodes ?? []}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onAction={onAction}\n        fillAvailableSpace\n        // speed search related props\n        showAsFocused={isInputFocused}\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        keepSearchActiveOnBlur\n        hideSpeedSearchPopup\n        isSearchActive\n      >\n        {(node) => {\n          // @ts-expect-error we need to somehow infer the type of `node.type`\n          return branchTreeNodeRenderers[node.type](node);\n        }}\n      </SpeedSearchTree>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  PlatformIcon,\n  Toolbar,\n  ToolbarSeparator,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { BranchesGroupByActionButton } from \"./BranchesGroupByActionButton\";\nimport { BranchesTree } from \"./BranchesTree\";\nimport { branchesTreeRefAtoms } from \"./BranchesTree.state\";\n\nconst DELETE_BRANCH_ACTION_ID = \"Git.DeleteBranch\";\nconst SHOW_BRANCH_DIFF_ACTION_ID = \"Git.Compare.With.Current\";\nconst SHOW_MY_BRANCHES_ACTION_ID = \"Git.Show.My.Branches\";\nconst FETCH_ACTION_ID = \"Git.Fetch\";\nconst TOGGLE_FAVORITE_ACTION_ID = \"Git.Toggle.Favorite\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  height: 100%;\n`;\n\nexport function VcsBranchesView({ tabKey }: { tabKey: string }) {\n  const treeRef = useAtomValue(branchesTreeRefAtoms(tabKey));\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.GIT_UPDATE_SELECTED,\n      title: \"Update Selected\",\n      icon: <PlatformIcon icon=\"actions/checkOut\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: DELETE_BRANCH_ACTION_ID,\n      title: \"Delete branch\",\n      icon: <PlatformIcon icon=\"actions/gc\" />,\n      useShortcutsOf: \"SafeDelete\",\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_BRANCH_DIFF_ACTION_ID,\n      title: \"Compare with current\",\n      icon: <PlatformIcon icon=\"actions/diff\" />,\n      useShortcutsOf: VcsActionIds.SHOW_DIFF,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_MY_BRANCHES_ACTION_ID,\n      title: \"Show My Branches\",\n      icon: <PlatformIcon icon=\"actions/find\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: FETCH_ACTION_ID,\n      title: \"Fetch All Remotes\",\n      icon: <PlatformIcon icon=\"vcs/fetch\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: TOGGLE_FAVORITE_ACTION_ID,\n      title: \"Mark/Unmark as Favorite\",\n      icon: <PlatformIcon icon=\"nodes/favorite\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer {...shortcutHandlerProps}>\n          <VcsLogBranchesViewToolbar />\n          <BranchesTree tabKey={tabKey} />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst StyledToolbar = styled(Toolbar)`\n  height: 100%;\n  flex-shrink: 0;\n`;\n\nfunction VcsLogBranchesViewToolbar() {\n  return (\n    <StyledToolbar border=\"right\" orientation=\"vertical\">\n      <ActionButton actionId={VcsActionIds.GIT_LOG_HIDE_BRANCHES} />\n      <ToolbarSeparator />\n      {/*FIXME: replace this with a separate \"new branch from\" action*/}\n      <ActionButton actionId={VcsActionIds.GIT_CREATE_NEW_BRANCH} />\n      <ActionButton actionId={VcsActionIds.GIT_UPDATE_SELECTED} />\n      <ActionButton actionId={DELETE_BRANCH_ACTION_ID} />\n      <ActionButton actionId={SHOW_BRANCH_DIFF_ACTION_ID} />\n      <ActionButton actionId={SHOW_MY_BRANCHES_ACTION_ID} />\n      <ActionButton actionId={FETCH_ACTION_ID} />\n      <ActionButton actionId={TOGGLE_FAVORITE_ACTION_ID} />\n      <ActionButton\n        actionId={VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH}\n      />\n      <ToolbarSeparator />\n      <BranchesGroupByActionButton />\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </StyledToolbar>\n  );\n}\n","import copyToClipboard from \"clipboard-copy\";\nimport { useAtomValue } from \"jotai\";\nimport React from \"react\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { allCommitsAtom, selectedCommitOids } from \"./CommitsTable.state\";\nimport { actionAtom } from \"../../../actionAtom\";\n\nconst refreshLogAction = actionAtom({\n  id: VcsActionIds.LOG_REFRESH,\n  title: \"Refresh\",\n  icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n  useShortcutsOf: CommonActionId.REFRESH,\n  actionPerformed: ({ set }) => {\n    set(allCommitsAtom);\n  },\n});\n\nconst copyRevisionNumberAction = actionAtom({\n  id: VcsActionIds.COPY_REVISION_NUMBER,\n  title: \"Copy Revision Number\",\n  icon: <PlatformIcon icon=\"actions/copy.svg\" />,\n  useShortcutsOf: CommonActionId.COPY_REFERENCE,\n  actionPerformed: async ({ get }) => {\n    const selectedCommits = await get(selectedCommitOids);\n    copyToClipboard(selectedCommits.join(\" \")).catch(console.error);\n  },\n});\n\nexport const useCommitsTableActions = (): ActionDefinition[] => {\n  return [\n    useAtomValue(copyRevisionNumberAction),\n    useAtomValue(refreshLogAction),\n  ];\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function VersionControlToolWindowZeroState() {\n  const performAction = usePerformAction();\n\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To track changes to code:\n        <br />\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        <Link onPress={notImplemented}>Use Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React, { RefObject } from \"react\";\nimport { atom, useAtom, useAtomValue } from \"jotai\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionTooltip,\n  DefaultToolWindow,\n  MultiViewToolWindow,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n  TooltipTrigger,\n  ToolWindowTabContent,\n} from \"@intellij-platform/core\";\n\nimport { VcsLogDetailsView } from \"./DetailsView/VcsLogDetailsView\";\nimport { VcsLogCommitsView } from \"./CommitsView/VcsLogCommitsView\";\nimport { VcsBranchesView } from \"./BranchesView/VcsBranchesView\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  useCloseVcsTab,\n  vcsActiveTabKeyAtom,\n  vcsLogFilter,\n  vcsLogTabShowBranchesAtoms,\n  vcsLogTabShowCommitDetailsAtoms,\n  vcsTabKeysAtom,\n  vcsTabTitleAtoms,\n} from \"./vcs-logs.state\";\nimport { useCommitsTableActions } from \"./CommitsView/useCommitsTableActions\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { vcsRootsAtom } from \"../file-status.state\";\nimport { VersionControlToolWindowZeroState } from \"./VersionControlToolWindowZeroState\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const VERSION_CONTROL_TOOLWINDOW_ID = \"Version Control\";\n\nconst firstViewSizeState = atom(0.25);\nconst lastViewSizeState = atom(0.35);\n\nconst StyledToolWindowHeader = styled.span`\n  margin: 0 0.5rem 0 0.125rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  :focus-visible {\n    outline: none;\n  }\n`;\n\nexport const searchInputRefAtom = atom<RefObject<HTMLInputElement>>(\n  React.createRef<HTMLInputElement>()\n);\n\nexport const VersionControlToolWindow = () => {\n  const tabKeys = useAtomValue(vcsTabKeysAtom);\n  const [activeTabKey, setActiveTabKey] = useAtom(vcsActiveTabKeyAtom);\n  const repos = useAtomValue(vcsRootsAtom);\n\n  return repos.length > 0 ? (\n    <MultiViewToolWindow\n      headerContent={<StyledToolWindowHeader>Git:</StyledToolWindowHeader>}\n      activeKey={activeTabKey}\n      onActiveKeyChange={(key) => setActiveTabKey(`${key}`)}\n    >\n      {tabKeys.map((key) => (\n        <MultiViewToolWindow.View\n          tabContent={<VcsToolWindowTabTitle tabKey={key} />}\n          key={key}\n        >\n          <VcsTab tabKey={key} />\n        </MultiViewToolWindow.View>\n      ))}\n    </MultiViewToolWindow>\n  ) : (\n    <DefaultToolWindow headerContent=\"Version Control\">\n      <VersionControlToolWindowZeroState />\n    </DefaultToolWindow>\n  );\n};\n\nconst StyledExpandStripeButton = styled.button.attrs({ tabIndex: -1 })`\n  box-sizing: border-box;\n  all: unset;\n  width: 1.71875rem;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.625rem;\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  :disabled {\n    color: ${({ theme }) => theme.color(\"Button.disabledText\")};\n  }\n  &:hover {\n    background: ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Button.hoverBackground\",\n        theme.dark ? \"#0f0f0f28\" : \"#55555528\"\n      )};\n  }\n`;\nconst StyledShowBranchesButton = styled(StyledExpandStripeButton)`\n  border-right: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nconst StyledShowBranchesButtonText = styled.span`\n  writing-mode: vertical-lr;\n  transform: rotateZ(180deg);\n  font-size: 0.6875rem;\n`;\n\nfunction ShowBranchesButton({ onPress }: { onPress: () => void }) {\n  return (\n    <StyledShowBranchesButton onClick={onPress}>\n      <PlatformIcon icon=\"actions/arrowExpand\" />\n      <StyledShowBranchesButtonText>Branches</StyledShowBranchesButtonText>\n    </StyledShowBranchesButton>\n  );\n}\n\nfunction VcsTab({ tabKey }: { tabKey: string }) {\n  const [firstViewSize, setFirstViewSize] = useAtom(firstViewSizeState);\n  const [lastViewSize, setLastViewSize] = useAtom(lastViewSizeState);\n\n  const actions = useVcsLogsToolWindowActions();\n  const [showBranches, setShowBranches] = useAtom(\n    vcsLogTabShowBranchesAtoms(tabKey)\n  );\n\n  const firstViewProps: Partial<ThreeViewSplitterProps> = showBranches\n    ? {\n        firstView: <VcsBranchesView tabKey={tabKey} />,\n        firstSize: firstViewSize,\n        onFirstResize: setFirstViewSize,\n        firstViewMinSize: 85,\n      }\n    : {};\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        // tabIndex is added to make the whole container focusable, which means the focus can go away from the currently\n        // focused element, when background is clicked. This is to follow the original implementation.\n        <StyledContainer\n          {...shortcutHandlerProps}\n          tabIndex={showBranches ? -1 : 0}\n        >\n          {!showBranches && (\n            <ShowBranchesButton onPress={() => setShowBranches(true)} />\n          )}\n          <ThreeViewSplitter\n            {...firstViewProps}\n            innerView={<VcsLogCommitsView tabKey={tabKey} />}\n            innerViewMinSize={200}\n            lastView={<VcsLogDetailsView tabKey={tabKey} />}\n            lastSize={lastViewSize}\n            onLastResize={setLastViewSize}\n            lastViewMinSize={40}\n          />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst toggleMatchCaseAction = actionAtom({\n  id: VcsActionIds.MATCH_CASE,\n  title: \"Match Case\",\n  icon: <PlatformIcon icon=\"actions/matchCase.svg\" />,\n  actionPerformed: ({ get, set }) => {\n    set(vcsLogFilter.matchCase(get(vcsActiveTabKeyAtom)), (value) => !value);\n  },\n});\n\nconst hideBranchesAction = actionAtom({\n  id: VcsActionIds.GIT_LOG_HIDE_BRANCHES,\n  title: \"Hide Git Branches\",\n  icon: <PlatformIcon icon=\"actions/arrowCollapse\" />,\n  actionPerformed: ({ get, set }) => {\n    set(\n      vcsLogTabShowBranchesAtoms(get(vcsActiveTabKeyAtom)),\n      // Would be nicer to have the action toggle, but prioritized matching the reference impl here.\n      false\n    );\n  },\n});\n\nconst toggleRegExpAction = actionAtom({\n  id: VcsActionIds.REG_EXP,\n  title: \"Regex\",\n  icon: <PlatformIcon icon=\"actions/regex\" />,\n  actionPerformed: ({ get, set }) => {\n    set(vcsLogFilter.regExp(get(vcsActiveTabKeyAtom)), (value) => !value);\n  },\n});\n\nconst toggleDetailsAction = actionAtom({\n  id: VcsActionIds.SHOW_DETAILS,\n  title: \"Show Details\",\n  description: \"Display details panel\",\n  actionPerformed: ({ get, set }) => {\n    set(\n      vcsLogTabShowCommitDetailsAtoms(get(vcsActiveTabKeyAtom)),\n      (value) => !value\n    );\n  },\n});\n\nconst focusTextFilterAction = actionAtom({\n  id: VcsActionIds.FOCUS_TEXT_FILTER,\n  title: \"Focus Text Filter\",\n  actionPerformed: ({ get }) => {\n    get(searchInputRefAtom).current?.focus();\n  },\n});\n\nconst showDiffPreviewAction = {\n  id: VcsActionIds.SHOW_DIFF_PREVIEW,\n  title: \"Show Diff Preview\",\n  description: \"Show Diff Preview Panel\",\n  actionPerformed: () => notImplemented(),\n};\n\nfunction useVcsLogsToolWindowActions() {\n  const actions: ActionDefinition[] = [\n    ...useCommitsTableActions(),\n    useAtomValue(focusTextFilterAction),\n    useAtomValue(hideBranchesAction),\n    useAtomValue(toggleMatchCaseAction),\n    useAtomValue(toggleRegExpAction),\n    useAtomValue(toggleDetailsAction),\n    showDiffPreviewAction,\n  ];\n  return actions;\n}\n\nfunction VcsToolWindowTabTitle({ tabKey }: { tabKey: string }) {\n  const closeTab = useCloseVcsTab();\n  return (\n    <ToolWindowTabContent\n      title={useAtomValue(vcsTabTitleAtoms(tabKey))}\n      closeButton={\n        tabKey !== \"MAIN\" && (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Close Tab\" />}>\n            <TabCloseButton onPress={() => closeTab(tabKey)} />\n          </TooltipTrigger>\n        )\n      }\n    />\n  );\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\n\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\nimport {\n  VERSION_CONTROL_TOOLWINDOW_ID,\n  VersionControlToolWindow,\n} from \"../VersionControl/VersionControlToolWindow/VersionControlToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  showStripeButton?: boolean;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"left\",\n      isSplit: true, // Default is false in the original impl.\n      isVisible: false,\n    }),\n  },\n  {\n    id: VERSION_CONTROL_TOOLWINDOW_ID,\n    title: \"Version Control\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowChanges\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <VersionControlToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"bottom\",\n      weight: 0.35,\n    }),\n  },\n];\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom } from \"jotai\";\n\nexport const showProgressPanelAtom = atom(false);\nexport const tasksPopupBoundsAtom = atom<Bounds | null>(null);\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport {\n  IconButton,\n  PlatformIcon,\n  Popup,\n  ProgressBar,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { tasksAtom, useCancelTask } from \"../tasks\";\nimport {\n  showProgressPanelAtom,\n  tasksPopupBoundsAtom,\n} from \"./IdeStatusBar.state\";\n\nconst StyledPopupTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport function TasksPopup() {\n  const setShowProgressPanel = useSetAtom(showProgressPanelAtom);\n  const tasks = useAtomValue(tasksAtom);\n  const cancel = useCancelTask();\n  const [bounds, setBounds] = useAtom(tasksPopupBoundsAtom);\n\n  return (\n    <Popup\n      bounds={\n        // Maybe it would be a nicer UX to not fix height, and let it be based on content, but tried to mimic the\n        // original impl, where the height is fixed. The only improvement over the original impl is that the default\n        // height (in case of no persisted bounds), would depend on the content, and it will remain based on content,\n        // as long as the bounds is not changed manually by the user.\n        bounds || {\n          width: 300,\n          // TODO: allow for positioning based on right and/or bottom\n          left: window.innerWidth - 300 - /* distance to right edge */ 150,\n          top:\n            window.innerHeight -\n            tasks.length * 80 - // progress bars\n            30 - // header\n            100, // distance to bottom edge,\n        }\n      }\n      onBoundsChange={(bounds) => {\n        setBounds(bounds);\n      }}\n      minHeight={100}\n      minWidth={300}\n      nonDismissable\n      interactions=\"all\"\n    >\n      <Popup.Layout\n        header={\n          <Popup.Header hasControls>\n            <StyledPopupTitle>Background Tasks</StyledPopupTitle>\n            <TooltipTrigger tooltip={<Tooltip>Hide</Tooltip>}>\n              <IconButton\n                preventFocusOnPress\n                excludeFromTabOrder\n                onPress={() => setShowProgressPanel(false)}\n              >\n                <PlatformIcon icon=\"general/hideToolWindow\" />\n              </IconButton>\n            </TooltipTrigger>\n          </Popup.Header>\n        }\n        content={\n          <>\n            {tasks.map((task, index) => (\n              <React.Fragment key={task.id}>\n                <ProgressBar\n                  style={{ margin: \".5rem 0.75rem\" }}\n                  name={task.title}\n                  isIndeterminate={task.progress.isIndeterminate}\n                  aria-label={`Progress of ${task.title}`}\n                  details={\n                    task.progress.text ||\n                    (task.progress.secondaryText ? <>&nbsp;</> : undefined)\n                  }\n                  secondaryDetails={task.progress.secondaryText}\n                  value={task.progress.fraction}\n                  maxValue={1}\n                  button={\n                    task.isCancelable && (\n                      <ProgressBarStopButton onPress={() => cancel(task.id)} />\n                    )\n                  }\n                />\n                {tasks[index + 1] && <StyledVerticalSeparator />}\n              </React.Fragment>\n            ))}\n          </>\n        }\n      />\n    </Popup>\n  );\n}\n","import styled from \"styled-components\";\nimport {\n  BareButton,\n  Link,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { firstTaskAtom, taskCountAtom, useCancelTask } from \"../tasks\";\nimport { showProgressPanelAtom } from \"./IdeStatusBar.state\";\nimport React, { useEffect } from \"react\";\nimport { TasksPopup } from \"./TasksPopup\";\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\nconst StyledProgressBarButton = styled.span`\n  cursor: pointer;\n\n  ${ProgressBar.Container} {\n    cursor: unset;\n  }\n`;\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nexport const StatusBarTaskProgressBar = () => {\n  const firstTask = useAtomValue(firstTaskAtom);\n  const tasksCount = useAtomValue(taskCountAtom);\n  const cancel = useCancelTask();\n  const [showProgressPanel, setShowProgressPanel] = useAtom(\n    showProgressPanelAtom\n  );\n\n  // When there is no tasks, switch back to not showing the panel.\n  useEffect(() => {\n    if (tasksCount === 0) {\n      setShowProgressPanel(false);\n    }\n  }, [tasksCount]);\n\n  return (\n    <>\n      {firstTask && !showProgressPanel && (\n        <TooltipTrigger\n          tooltip={\n            <Tooltip>{`${firstTask.title}. Click to see all running background tasks.`}</Tooltip>\n          }\n        >\n          <BareButton\n            preventFocusOnPress\n            excludeFromTabOrder\n            onPress={() => {\n              setShowProgressPanel(true);\n            }}\n          >\n            <StyledProgressBarButton>\n              <StatusBarProgress\n                name={firstTask.progress.text || firstTask.title}\n                isIndeterminate={firstTask.progress.isIndeterminate}\n                value={firstTask.progress.fraction}\n                maxValue={1}\n                button={\n                  <>\n                    {/*  {task.canPause && (\n                      <ProgressBarPauseButton\n                        small\n                        paused={false}\n                        onPausedChange={() => {}}\n                      />\n                    )}*/}\n                    {firstTask.isCancelable && (\n                      <TooltipTrigger tooltip={<Tooltip>Cancel</Tooltip>}>\n                        <ProgressBarStopButton\n                          small\n                          onPress={() => cancel(firstTask.id)}\n                        />\n                      </TooltipTrigger>\n                    )}\n                  </>\n                }\n              />\n            </StyledProgressBarButton>\n          </BareButton>\n        </TooltipTrigger>\n      )}\n      {(tasksCount > 1 || showProgressPanel) && (\n        <>\n          <Spacer />\n          <Link\n            onPress={() =>\n              setShowProgressPanel((currentValue) => !currentValue)\n            }\n          >\n            {showProgressPanel ? \"Hide processes\" : \"Show all\"} ({tasksCount})\n          </Link>\n        </>\n      )}\n      {showProgressPanel && tasksCount > 0 && <TasksPopup />}\n    </>\n  );\n};\n","import { Atom } from \"jotai\";\nimport { selectAtom } from \"jotai/utils\";\n\n/**\n * Returns an atom that holds the latest defined (not `null` or `undefined`)\n * value of the input atom.\n * Useful for when the value can change to null/undefined and the previous\n * non-null value should still be used.\n * For example, the git branches widget shows the current branch of the file\n * that's currently opened in the editor.\n * But when all editor tabs are closed,\n * or when the currently opened tab is not a file from any repo,\n * the git branches trigger keeps showing the branches of the repository\n * from which a file was last opened.\n */\nexport const latestDefinedValue = <V>(atom: Atom<V>) =>\n  selectAtom<V, V>(atom, (value, prevValue) => {\n    return value instanceof Promise\n      ? (Promise.all([value, prevValue]).then(\n          ([value, prevValue]) => value ?? prevValue ?? value\n        ) as V & Promise<unknown>)\n      : value ?? prevValue ?? value;\n  });\n","import { resolveRef } from \"isomorphic-git\";\nimport { atom } from \"jotai\";\n\nimport { activeEditorTabAtom } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsFootForFileAtom, vcsRootsAtom } from \"./file-status.state\";\nimport {\n  branchForPathAtoms,\n  RepoBranches,\n  repoBranchesAtom,\n} from \"./Branches/branches.state\";\n\nimport { latestDefinedValue } from \"../atom-utils/latestDefinedValue\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootAtom = atom((get) => {\n  const activeFile = get(activeEditorTabAtom)?.filePath;\n  const activeFileRepo = activeFile && get(vcsFootForFileAtom(activeFile));\n  return activeFileRepo ?? get(vcsRootsAtom)[0]?.dir;\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesAtom = atom<Promise<RepoBranches | null>>(\n  async (get) => {\n    const activeFileRepoRoot = await get(activeFileRepoRootAtom);\n    return activeFileRepoRoot\n      ? get(repoBranchesAtom(activeFileRepoRoot))\n      : null;\n  }\n);\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchAtom = latestDefinedValue(\n  atom(async (get) => {\n    const activeFile = get(activeEditorTabAtom)?.filePath;\n    return activeFile ? get(branchForPathAtoms(activeFile)) : null;\n  })\n);\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadAtom = atom(async (get) => {\n  const branch = await get(activeFileCurrentBranchAtom);\n  if (branch) {\n    return {\n      detached: false,\n      head: branch,\n    };\n  }\n  const repoRoot = await get(activeFileRepoRootAtom);\n  if (repoRoot) {\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  }\n  return null;\n});\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches | null,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches?.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches?.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { repoBranchesAtom, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useAtomValue(repoBranchesAtom(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"error\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                validationMessage={\n                  error && validationState === \"error\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  IconButton,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  Toolbar,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport {\n  allBranchesAtom,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useAtom, useAtomValue } from \"jotai\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nimport { unwrapLatestOrNull } from \"../../atom-utils/unwrapLatest\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>(undefined);\n\nexport function BranchesPopup({ close }: { close: () => void }) {\n  const repoBranches = useAtomValue(unwrapLatestOrNull(allBranchesAtom));\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] = useAtom(\n    branchesPopupSizeState\n  );\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      close();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={close}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { vcsRootsAtom } from \"./file-status.state\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const vcsRoots = useAtomValue(vcsRootsAtom);\n  const performAction = usePerformAction();\n\n  return async () => {\n    if (vcsRoots.length < 2 && !notified) {\n      notified = true;\n      balloonManager.showSticky({\n        title: \"Clone another repository\",\n        icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n        body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n        actions: (\n          <>\n            <BalloonActionLink\n              onPress={() => {\n                performAction(\"ExampleApp.cloneExampleRepo\");\n              }}\n            >\n              Clone another repo\n            </BalloonActionLink>\n          </>\n        ),\n      });\n    }\n  };\n};\n","import { useAtomValue } from \"jotai\";\nimport React from \"react\";\n\nimport {\n  ActionTooltip,\n  PlatformIcon,\n  PopupTrigger,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { activeFileRepoHeadAtom } from \"../VersionControl/active-file.state\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\n\nimport { unwrapLatestOrNull } from \"../atom-utils/unwrapLatest\";\n\nexport function BranchPopupTrigger() {\n  const gitRepoHead = useAtomValue(unwrapLatestOrNull(activeFileRepoHeadAtom));\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    gitRepoHead && (\n      <PopupTrigger\n        placement=\"top\"\n        onOpenChange={(isOpen) => {\n          if (!isOpen) {\n            setTimeout(maybeShowGitCloneTip, 500);\n          }\n        }}\n        popup={({ close }) => <BranchesPopup close={close} />}\n      >\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={\n                gitRepoHead.detached\n                  ? \"Git: Detached HEAD doesn't point to any branch\"\n                  : `Git Branch: ${gitRepoHead.head}`\n              }\n            />\n          }\n        >\n          <StatusBarWidget\n            icon={\n              <PlatformIcon\n                icon={\n                  gitRepoHead.detached\n                    ? \"general/warning.svg\"\n                    : \"vcs/branch.svg\"\n                }\n              />\n            }\n            label={gitRepoHead.head.slice(\n              0,\n              gitRepoHead.detached ? 8 : undefined\n            )}\n          />\n        </TooltipTrigger>\n      </PopupTrigger>\n    )\n  );\n}\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport styled from \"styled-components\";\nimport {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\n\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { StatusBarTaskProgressBar } from \"./StatusBarTaskProgressBar\";\nimport { BranchPopupTrigger } from \"./BranchPopupTrigger\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\nexport const IdeStatusBar = () => {\n  const cursorPosition = useAtomValue(editorCursorPositionState);\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarTaskProgressBar />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <BranchPopupTrigger />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  ActionButton,\n  ActionsProvider,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  Toolbar,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport {\n  changesTreeNodesAtom,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { defaultChangeGroupings } from \"../ChangesTree/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"../ChangesView/changesViewTreeNodeRenderer\";\nimport { allChangesAtom, useRollbackChanges } from \"../changes.state\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  &:not(:empty) {\n    line-height: 1.5;\n    padding-left: 0.375rem;\n    margin-bottom: 0.75rem;\n  }\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useAtomValue(\n    rollbackViewState.initiallyExpandedKeysAtom\n  );\n  const initiallyIncludedChangeKeys = useAtomValue(\n    rollbackViewState.initiallyIncludedChangesAtom\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useAtomValue(changesTreeNodesAtom);\n  const [windowBounds, setWindowBounds] = useAtom(\n    rollbackViewState.windowBoundsAtom\n  );\n  const rootNodes = useAtomValue(rollbackViewState.rootNodesAtom);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<ChangesViewTreeNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useAtomValue(allChangesAtom);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetAtom(rollbackViewState.isOpenAtom);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n  const [deleteAddedFiles, setDeleteAddedFiles] = useState(false);\n\n  const atLeastOneNewFileSelected = includedChanges.some(\n    (change) => change.type === \"ADDED\"\n  );\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              defaultChangeGroupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      treeRef={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = changesViewTreeNodeRenderer.getItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \".5rem 0.75rem 0\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox\n                isDisabled={!atLeastOneNewFileSelected}\n                isSelected={deleteAddedFiles}\n                onChange={setDeleteAddedFiles}\n                mnemonic=\"D\"\n              >\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close} mnemonic=\"C\">\n                    Close\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    mnemonic=\"R\"\n                    isDisabled={includedChanges.length === 0}\n                    onPress={() => {\n                      rollbackChanges(includedChanges, deleteAddedFiles)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"jotai\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsStateAtom = atom(\n  new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    ),\n    {\n      removedFromSideBarIds: toolWindows\n        .filter(({ showStripeButton }) => showStripeButton === false)\n        .map(({ id }) => id),\n    }\n  )\n);\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom(false),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>(\"All\"),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element | null>(null),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily((tab: string) => atom(\"\")),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>(null),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useAtomValue, useSetAtom, WritableAtom } from \"jotai\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsAtom,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of an atom.\n   */\n  persistedBoundsAtom: WritableAtom<\n    Partial<Bounds> | null,\n    [Partial<Bounds> | null],\n    void\n  >;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetAtom(persistedBoundsAtom);\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(\n    useAtomValue(persistedBoundsAtom) ?? {\n      top: 150,\n      height: Math.max(200, window.innerHeight - 300),\n    }\n  );\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 0.9375rem;\n  margin-right: 0.25rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useAtomValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = file.name;\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React, { useEffect, useRef } from \"react\";\nimport { Atom, useAtomValue, useStore } from \"jotai\";\nimport {\n  currentProjectFilesAtom,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const projectFiles =\n      useAtomValue(unwrapLatestOrNull(currentProjectFilesAtom)) ?? [];\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        projectFiles\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useAtom, useSetAtom, useAtomValue } from \"jotai\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetAtom(searchEverywhereState.isOpen);\n  const [tab, setTab] = useAtom(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useAtomValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetAtom(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const onAction = (key: React.Key) => {\n    if (key === LOAD_MORE_ITEM_KEY) {\n      setSearchResultLimit((limit) => limit + SEARCH_RESULT_LIMIT);\n      const nextItem = searchResult[visibleSearchResult.length + 1];\n      if (nextItem) {\n        // nextItem is expected to always have value\n\n        // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n        // if we want to avoid setTimeout\n        setTimeout(() => {\n          setSelectedKeys(new Set([nextItem.key]));\n          selectionManagerRef.current?.setFocusedKey(nextItem.key);\n        });\n      }\n    } else {\n      close();\n      // Making sure the popup is fully closed before the new action is performed. One edge case that can\n      // make a difference is actions like FindAction that open the same popup. By performing an action\n      // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n      // won't get any feedback when choosing such actions.\n      setTimeout(() => {\n        const itemWrapper = searchResult.find((item) => item.key === key);\n        itemWrapper?.contributor.processSelectedItem(itemWrapper.item);\n        /**\n         * The 50ms timeout is a workaround for an issue in FocusScope:\n         * restoreFocus only works if the previously focused element is in the dom, when the focus\n         * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n         * window, which has a focus scope, when the window is opened, the currently focused\n         * element (which will be the one to restore focus to), is search everywhere dialog, which\n         * is immediately closed. So when the modal window is closed, it tries to move focus back\n         * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n         * track a chain of nodes to restore focus to.\n         * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n         * is closed, and then the actions is performed, for focus restoration to work.\n         */\n      }, 50);\n    }\n  };\n\n  const tips = useTips();\n  return (\n    <ContentAwarePopup\n      persistedBoundsAtom={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        ref={searchInputRef}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        focusProxyRef={searchInputRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        showAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={onAction}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          const itemText = contributor.getItemText(item);\n                          return (\n                            <Item\n                              key={key}\n                              textValue={itemText}\n                              aria-label={itemText}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import git from \"isomorphic-git\";\nimport { Getter, Setter } from \"jotai\";\nimport path from \"path\";\nimport { fs } from \"../fs/fs\";\nimport { refreshFileStatusCallback } from \"./file-status.state\";\n\nexport const gitAddCallback = async (\n  get: Getter,\n  set: Setter,\n  filepath: string\n) => {\n  const dir = await git.findRoot({ fs, filepath });\n  await git.add({ fs, dir, filepath: path.relative(dir, filepath) });\n  await refreshFileStatusCallback(get, set, filepath);\n};\n","import {\n  Input,\n  Popup,\n  PopupLayout,\n  PositionedTooltipTrigger,\n  styled,\n  ValidationTooltip,\n} from \"@intellij-platform/core\";\nimport React, { ChangeEvent, useState } from \"react\";\n\nconst StyledInput = styled(Input)`\n  width: 20.5rem;\n  /**\n     * To have the validation box shadow not clipped by the popup.\n     * Maybe it should be an option on input to make sure margin is always in sync with the box-shadow thickness\n     */\n  margin: 3px;\n\n  input {\n    padding-top: 1px;\n    padding-bottom: 1px;\n  }\n`;\nconst StyledHeader = styled(Popup.Header)`\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.border()};\n`;\n\n/**\n * A simple Popup with an input, used in actions such as create file, or create directory\n */\nexport function NewItemPopup({\n  title,\n  inputName = \"Name\",\n  onSubmit,\n  validationMessage,\n  validationType = \"error\",\n  value,\n  onChange,\n}: {\n  inputName?: string;\n  title: React.ReactNode;\n  onSubmit: () => void;\n  value: string;\n  onChange: (newValue: string) => void;\n  validationMessage?: string;\n  validationType?: \"error\" | \"warning\";\n}) {\n  const [hideMessage, setHideMessage] = useState(false);\n  return (\n    <Popup>\n      <PopupLayout\n        header={<StyledHeader>{title}</StyledHeader>}\n        content={\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              onSubmit();\n            }}\n            onMouseDown={() => {\n              setHideMessage(true);\n            }}\n          >\n            <PositionedTooltipTrigger\n              isOpen={Boolean(validationMessage) && !hideMessage}\n              placement=\"top start\"\n              offset={6}\n              crossOffset={-6}\n              tooltip={\n                <ValidationTooltip type={validationType}>\n                  {validationMessage}\n                </ValidationTooltip>\n              }\n            >\n              <StyledInput\n                appearance=\"embedded\"\n                validationState={validationMessage ? validationType : undefined}\n                placeholder={inputName}\n                value={value}\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                  setHideMessage(false);\n                  onChange(e.target.value);\n                }}\n              />\n            </PositionedTooltipTrigger>\n          </form>\n        }\n      />\n    </Popup>\n  );\n}\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport React, { useCallback, useState } from \"react\";\nimport {\n  ActionDefinition,\n  Button,\n  Checkbox,\n  ModalWindow,\n  PlatformIcon,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { editorManagerAtom } from \"../../Editor/editor.state\";\nimport {\n  activePathExistsAtom,\n  activePathsAtom,\n  projectPopupManagerRefAtom,\n  windowManagerRefAtom,\n} from \"../project.state\";\nimport { vcsFootForFileAtom } from \"../../VersionControl/file-status.state\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { createFileCallback } from \"../fs-operations\";\nimport { gitAddCallback } from \"../../VersionControl/gitAddCallback\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { actionAtom } from \"../../actionAtom\";\n\n// TODO: expand to and select the new file in the project tree, if the action is initiated from projects view.\nexport const createFileActionAtom = actionAtom({\n  id: projectActionIds.NewFile,\n  icon: <PlatformIcon icon=\"fileTypes/text\" />,\n  title: \"File\",\n  description: \"Create new file\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get }) => {\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n    const popupManager = get(projectPopupManagerRefAtom).current;\n\n    // TODO: open a dialog and let the user choose the destination if, multiple paths are active\n    const destinationDir = (\n      await fs.promises.stat(activePaths[0])\n    ).isDirectory()\n      ? activePaths[0]\n      : path.dirname(activePaths[0]);\n\n    if (!popupManager) {\n      throw new Error(\"Could not find popup manager\");\n    }\n\n    popupManager.show(({ close }) => (\n      <NewFilePopup close={close} destinationDir={destinationDir} />\n    ));\n  },\n});\n\nfunction NewFilePopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createFile = useAtomCallback(\n    useCallback(\n      async (get, set, destination: string, filename: string) => {\n        const fullpath = path.join(destination, filename);\n        const editorManager = get(editorManagerAtom);\n        const windowManager = get(windowManagerRefAtom).current;\n        const repoDir = await get(vcsFootForFileAtom(fullpath));\n        await createFileCallback(get, set, destination, filename);\n        // TODO: select it in the Project tool window, if it was created from the Project tool window\n        close();\n        editorManager.focus();\n        // Hacky approach to fix an edge case where the editor is not rendered already (no open tabs), and\n        // so will be focused with a little delay. For the focus to go back to the editor after AddFileToGitWindow\n        // is closed, without any extra focus management, we need to make sure the editor is focused before the\n        // modal window is opened, so it restores to the editor.\n        await waitUntil(\n          () => document.activeElement instanceof HTMLTextAreaElement\n        );\n        if (repoDir) {\n          windowManager?.open(({ close }) => (\n            <AddFileToGitWindow filepath={fullpath} close={close} />\n          ));\n        }\n      },\n      [close]\n    )\n  );\n  const [filename, setFilename] = useState(\"\");\n  const [validationMessage, setValidationMessage] = useState(\"\");\n  const submit = async () => {\n    const fullPath = path.join(destinationDir, filename);\n    const stats = await stat(fullPath);\n    if (stats?.isFile()) {\n      setValidationMessage(\n        `A file with the name '${path.basename(filename)}' already exists`\n      );\n    } else if (stats?.isDirectory()) {\n      setValidationMessage(\n        `A directory with the name '${path.basename(filename)}' already exists`\n      );\n    } else {\n      await createFile(destinationDir, filename);\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New File\"\n      onSubmit={() => {\n        if (filename) {\n          submit(); // error handling?\n        }\n      }}\n      value={filename}\n      onChange={(newValue) => {\n        setValidationMessage(\"\");\n        setFilename(newValue);\n      }}\n      validationMessage={validationMessage}\n    />\n  );\n}\n\nfunction AddFileToGitWindow({\n  close,\n  filepath,\n}: {\n  close: () => void;\n  filepath: string;\n}) {\n  const addToGit = useAtomCallback(gitAddCallback);\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Add File to Git\"\n        content={\n          <>\n            <div\n              style={{\n                display: \"flex\",\n                gap: \"1rem\",\n                padding: \"0.75rem 0.75rem 0rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/questionDialog.svg\" size={32} />\n              <div>\n                Do you want to add the following file to Git?\n                <br />\n                {filepath}\n                <br />\n                <br />\n                If you choose Cancel, you can still add it later manually.\n              </div>\n            </div>\n          </>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<Checkbox isDisabled>Don't ask again</Checkbox>}\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  autoFocus\n                  variant=\"default\"\n                  onPress={() => {\n                    addToGit(filepath).then(close);\n                  }}\n                >\n                  Add\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function waitUntil(criteria: () => boolean, timeoutInMs = 2000) {\n  if (criteria() || timeoutInMs < 0) {\n    return;\n  }\n  await new Promise((resolve) => setTimeout(resolve, 50));\n  await waitUntil(criteria, timeoutInMs - 50);\n}\n","import { useRef } from \"react\";\n// @ts-expect-error caf package doesn't come with typing, and @types/caf doesn't exist at the moment\nimport { CAF } from \"caf\";\n\n/**\n * A utility to avoid race condition in async flows that should be triggered based on some user interaction.\n * Accepts a generator function representing a cancelable async flow. Each `yield` expression is a potential point of\n * cancellation, and the last invocation always cancels previous in progress invocations (if any).\n * Based on [Cancelable Async Flows](https://github.com/getify/CAF#cancelable-async-flows-caf)\n */\nexport const useCancelableAsyncCallback = <A extends any[]>(\n  asyncCallback: (...args: A) => Generator\n) => {\n  const cancelToken = useRef<null | { abort: () => void; signal: unknown }>(\n    null\n  );\n\n  const callbackRef = useRef(asyncCallback);\n  callbackRef.current = asyncCallback;\n\n  return (...args: any[]) => {\n    cancelToken.current?.abort();\n    cancelToken.current = new CAF.cancelToken();\n\n    CAF(function (signal: unknown, ...args: A): unknown {\n      return callbackRef.current(...args);\n    })(cancelToken.current, ...args);\n  };\n};\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport React, { useEffect, useState } from \"react\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { useCancelableAsyncCallback } from \"../../useCancelableAsyncCallback\";\nimport {\n  activePathExistsAtom,\n  activePathsAtom,\n  projectPopupManagerRefAtom,\n} from \"../project.state\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { createDirectoryCallback } from \"../fs-operations\";\nimport { actionAtom } from \"../../actionAtom\";\n\n// TODO: expand to and select the new directory in the project tree\nexport const createDirectoryActionAtom = actionAtom({\n  id: projectActionIds.NewDir,\n  icon: <PlatformIcon icon={DIR_ICON} />,\n  title: \"Directory\",\n  description: \"Create new directory\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)), // TODO: disable action when multiple paths are selected and none of them are directories\n  actionPerformed: async ({ get }) => {\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n    const popupManager = get(projectPopupManagerRefAtom).current;\n\n    // TODO: open a dialog and let the user choose the destination if, multiple dirs are active\n    const destinationDir = (\n      await fs.promises.stat(activePaths[0])\n    ).isDirectory()\n      ? activePaths[0]\n      : path.dirname(activePaths[0]);\n\n    if (!popupManager) {\n      throw new Error(\"Could not find popup manager\");\n    }\n\n    popupManager.show(({ close }) => (\n      <NewDirectoryPopup close={close} destinationDir={destinationDir} />\n    ));\n  },\n});\n\nfunction NewDirectoryPopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createDirectory = useAtomCallback(createDirectoryCallback);\n\n  const [dirName, setDirName] = useState(\"\");\n\n  const [validationResult, setValidationResult] = useState<{\n    type: \"error\" | \"warning\";\n    message: string;\n  } | null>(null);\n\n  const updateValidation = useCancelableAsyncCallback(function* (\n    destinationDir: string,\n    dirName: string\n  ) {\n    setValidationResult(\n      (yield validate(destinationDir, dirName)) as Awaited<\n        ReturnType<typeof validate>\n      >\n    );\n  });\n  useEffect(() => {\n    updateValidation(destinationDir, dirName);\n  }, [destinationDir, dirName]);\n\n  const submit = async () => {\n    const error = await validate(destinationDir, dirName);\n    if (error == null) {\n      await createDirectory(destinationDir, dirName);\n      close();\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New Directory\"\n      onSubmit={() => {\n        if (dirName) {\n          submit(); // error handling?\n        }\n      }}\n      value={dirName}\n      onChange={setDirName}\n      validationMessage={validationResult?.message}\n      validationType={validationResult?.type}\n    />\n  );\n}\n\nconst validate = async function (\n  destinationDir: string,\n  dirName: string\n): Promise<{ type: \"error\" | \"warning\"; message: string } | null> {\n  const fullPath = path.join(destinationDir, dirName);\n  if (!dirName) {\n    return null;\n  }\n  if (dirName.includes(\".\")) {\n    return {\n      type: \"warning\",\n      message: `Note: \".\" in the name is treated as a regular character. Use \"/\" instead if you mean to create nested directories`,\n    };\n  }\n  let stats = await stat(fullPath);\n  if (stats?.isFile()) {\n    return {\n      type: \"error\",\n      message: `A file with the name '${dirName}' already exists`,\n    };\n  } else if (stats?.isDirectory()) {\n    return {\n      type: \"error\",\n      message: `A directory with the name '${dirName}' already exists`,\n    };\n  }\n  return null;\n};\n","import { atom } from \"jotai\";\n\nimport { activePathExistsAtom, activePathsAtom } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyFilenameActionAtom = actionAtom({\n  id: projectActionIds.CopyFileName,\n  title: \"File Name\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get }) => {\n    notImplemented();\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n  },\n});\n","import { atom } from \"jotai\";\nimport { activePathExistsAtom, activePathsAtom } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyAbsolutePathActionAtom = actionAtom({\n  id: projectActionIds.CopyAbsolutePath,\n  title: \"Absolute Path\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  useShortcutsOf: \"CopyPaths\",\n  actionPerformed: async ({ get }) => {\n    notImplemented();\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n  },\n});\n","import { atom } from \"jotai\";\n\nimport {\n  activePathExistsAtom,\n  activePathsAtom,\n} from \"../../Project/project.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyPathFromRepositoryRootActionAtom = actionAtom({\n  id: VcsActionIds.CopyPathFromRepositoryRootProvider,\n  title: \"Path From Repository Root\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get }) => {\n    notImplemented();\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n  },\n});\n","import { Getter, Setter, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\n\nimport { createFileActionAtom } from \"./actions/createFileAction\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { createDirectoryActionAtom } from \"./actions/createDirectoryAction\";\nimport { projectActionIds } from \"./projectActionIds\";\nimport { copyFilenameActionAtom } from \"./actions/copyFilename\";\nimport { copyAbsolutePathActionAtom } from \"./actions/copyAbsolutePath\";\nimport { copyPathFromRepositoryRootActionAtom } from \"../VersionControl/actions/copyPathFromRepositoryRoot\";\n\nconst openSearchEverywhereCallback = (\n  _get: Getter,\n  set: Setter,\n  { element }: ActionContext,\n  tab: string\n) => {\n  if (element) {\n    set(searchEverywhereState.isOpen, true);\n    set(searchEverywhereState.tab, tab);\n    set(searchEverywhereState.contextElement, element);\n  }\n};\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useAtomCallback(openSearchEverywhereCallback);\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const newFileAction = useAtomValue(createFileActionAtom);\n  const newDirectoryAction = useAtomValue(createDirectoryActionAtom);\n  const newElementActionGroup = createDefaultActionGroup({\n    id: projectActionIds.NewElement,\n    title: \"New...\",\n    description: \"Create new class, interface, file or directory\",\n    isSearchable: true,\n    children: [newFileAction, newDirectoryAction],\n  });\n\n  const copyReferencePopupGroup = createDefaultActionGroup({\n    id: projectActionIds.CopyReferencePopupGroup,\n    title: \"Copy Path/Reference...\",\n    menuPresentation: \"none\",\n    children: [\n      // TODO: CopyFileReferences action group popup is not the default popup, it shows the copyable value as a hint\n      //  segment in each menu item. A custom actionPerformed should be implemented.\n      createDefaultActionGroup({\n        id: projectActionIds.CopyFileReference,\n        title: \"Copy File Reference\", // in the original impl, there is no title\n        isSearchable: false,\n        menuPresentation: \"section\",\n        children: [\n          // FIXME: actions are not triggered via UI\n          useAtomValue(copyAbsolutePathActionAtom),\n          useAtomValue(copyFilenameActionAtom),\n          // FIXME: should be able to define divider here\n          // new Divider(),\n          useAtomValue(copyPathFromRepositoryRootActionAtom),\n        ],\n      }),\n    ],\n  });\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n    newElementActionGroup,\n    copyReferencePopupGroup,\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React, { useCallback } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport path from \"path\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changesTreeNodesAtom,\n  changesUnderSelectedKeysAtom,\n  ChangesViewTreeNode,\n  expandedKeysAtom,\n  includedChangeKeysAtom,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysAtom,\n} from \"./ChangesView/ChangesView.state\";\nimport { allChangesAtom } from \"./changes.state\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsAtom,\n  currentProjectFilesAtom,\n} from \"../../Project/project.state\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport { getNodeKeyForChange, isGroupNode } from \"./ChangesTree/ChangeTreeNode\";\nimport { Change } from \"./Change\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { useRefreshRepoStatuses } from \"../file-status.state\";\nimport { activeChangeListState } from \"./change-lists.state\";\n\nimport { unwrapLatestOrNull } from \"../../atom-utils/unwrapLatest\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useAtomCallback(\n    openRollbackWindowForSelectionCallback\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh VCS Changes\",\n      description: \"Refresh VCS Changes\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useAtomCallback(queueCheckInCallback);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useAtomValue(activePathsAtom);\n  const projectFiles = useAtomValue(\n    unwrapLatestOrNull(currentProjectFilesAtom)\n  );\n  const roots = findRootPaths(activePaths);\n\n  const allChanges = useAtomValue(allChangesAtom);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, Change.path(change)))\n  );\n\n  // The logic here is a little better than the reference impl, which itself is inconsistent in project view\n  // and in Changes view (aka commit view).\n  const isDirectory = (path: string) =>\n    projectFiles?.some((item) => item.type === \"dir\" && item.path === path);\n  const selectedPathsAreDirectories = roots.every(isDirectory);\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: selectedPathsAreDirectories\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useAtomCallback(\n    useCallback((get, set) => {\n      const includedChangesKeys = get(includedChangeKeysAtom);\n      let keyToSelect = includedChangesKeys.values().next().value;\n      if (includedChangesKeys.size === 0) {\n        const allKeys = get(activeChangeListState)?.changes.map(\n          getNodeKeyForChange\n        );\n        set(includedChangeKeysAtom, new Set(allKeys));\n        keyToSelect = allKeys?.[0];\n      }\n      if (keyToSelect) {\n        const { rootNodes } = get(changesTreeNodesAtom);\n        set(\n          expandedKeysAtom,\n          new Set([\n            ...get(expandedKeysAtom),\n            ...getExpandedToNodesKeys(\n              (node) => (isGroupNode(node) ? node.children : null),\n              (node) => node.key,\n              rootNodes as ChangesViewTreeNode[],\n              [keyToSelect]\n            ),\n          ])\n        );\n        set(selectedKeysAtom, new Set([keyToSelect]));\n      }\n    }, [])\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useAtomValue(changesUnderSelectedKeysAtom);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        const changePath = Change.path(change);\n        if (!changePath) {\n          editorStateManager.openPath(changePath, index === arr.length - 1);\n        }\n      });\n    },\n  };\n}\n\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChanges = useAtomValue(changesUnderSelectedKeysAtom);\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n  if (selectedChanges.size > 0) {\n    // FIXME: should use active paths, not selection\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { Errors } from \"isomorphic-git\";\nimport { activeFileRepoBranchesAtom } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useAtomValue(activeFileRepoBranchesAtom);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches?.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"error\" : \"valid\";\n\n  const create = () => {\n    if (isValid && branches?.repoRoot) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              validationMessage={\n                validationState === \"error\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"error\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"jotai\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport git from \"isomorphic-git\";\nimport { PlatformIcon } from \"@intellij-platform/core\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { fileStatusAtoms, vcsFootForFileAtom } from \"../file-status.state\";\nimport { fs } from \"../../fs/fs\";\nimport path from \"path\";\nimport { activePathsAtom } from \"../../Project/project.state\";\nimport { gitAddCallback } from \"../gitAddCallback\";\nimport { actionAtom } from \"../../actionAtom\";\n\nconst pathsToAddAtom = atom<Promise<string[]>>(async (get) => {\n  return asyncFilter(async (activePath): Promise<boolean> => {\n    const repoDir = await get(vcsFootForFileAtom(activePath));\n    if (repoDir) {\n      const isIgnored = await git.isIgnored({\n        fs,\n        dir: repoDir,\n        filepath: path.relative(repoDir, activePath),\n      });\n      const isFile = await fs.promises\n        .stat(activePath)\n        .then((stat) => stat.isFile())\n        .catch(() => false);\n      const isUnchangedFile =\n        isFile && (await get(fileStatusAtoms(activePath))) === \"NOT_CHANGED\";\n      return !isIgnored && !isUnchangedFile; // logic checked with the behavior of the reference impl\n    }\n    return false;\n  }, get(activePathsAtom));\n});\n\nconst gitAddDisabledAtom = atom(\n  async (get) => (await get(pathsToAddAtom)).length === 0\n);\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status, though.\n * TODO: task API can be used to make this a task.\n */\nexport const gitAddActionAtom = actionAtom({\n  id: VcsActionIds.GIT_ADD,\n  title: \"Add\",\n  icon: <PlatformIcon icon=\"general/add.svg\" />,\n  useShortcutsOf: VcsActionIds.ADD_UNVERSIONED,\n  isDisabled: gitAddDisabledAtom,\n  actionPerformed: async ({ get, set }) => {\n    const pathsToAdd = await get(pathsToAddAtom);\n    await Promise.all(\n      pathsToAdd.map((aPath) => gitAddCallback(get, set, aPath))\n    );\n  },\n});\n","import git from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport {\n  activePathsAtom,\n  currentProjectAtom,\n} from \"../../Project/project.state\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  refreshRepoStatusesCallback,\n  vcsRootsAtom,\n} from \"../file-status.state\";\nimport { actionAtom } from \"../../actionAtom\";\nimport { stat } from \"../../fs/fs-utils\";\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status.\n * TODO: task API can be used to make this a task.\n */\nexport const gitInitActionAtom = actionAtom({\n  id: VcsActionIds.GIT_INIT,\n  title: \"Create Git Repository...\",\n  actionPerformed: async ({ get, set }) => {\n    // TODO: open a path selector to select the path where the git repo should be initialized\n    const project = get(currentProjectAtom);\n    const activePath = get(activePathsAtom)[0];\n    const stats = await stat(activePath);\n    const dir = stats?.isDirectory() ? activePath : project.path;\n    await git.init({ fs, dir });\n    set(vcsRootsAtom, (roots) =>\n      roots\n        .filter((root) => root.dir !== dir)\n        .concat({\n          vcs: \"Git\",\n          dir,\n        })\n    );\n    await refreshRepoStatusesCallback(get, set);\n  },\n});\n","import { z } from \"zod\";\nimport { atomWithPersistence } from \"../persistence/atomWithPersistence\";\nimport { list, maybeArray } from \"../persistence/schema-utils\";\nimport { focusAtom } from \"jotai-optics\";\n\ninterface VisitedUrl {\n  url: string;\n  username?: string;\n}\n\nconst visitedUrlsSchema = z.object({\n  \"@name\": z.enum([\"visitedUrls\"]),\n  list: list(\n    z.object({\n      option: maybeArray(\n        z.union([\n          z.object({\n            \"@name\": z.enum([\"url\"]),\n            \"@value\": z.string(),\n          }),\n          z.object({\n            \"@name\": z.enum([\"userName\"]),\n            \"@value\": z.string(),\n          }),\n        ])\n      ),\n    }),\n    \"UrlAndUserName\"\n  ),\n});\nconst cloneParentDirSchema = z.object({\n  \"@name\": z.enum([\"cloneParentDir\"]),\n  \"@value\": z.string(),\n});\nconst gitRememberedInputsSchema = z.object({\n  option: maybeArray(z.union([visitedUrlsSchema, cloneParentDirSchema])),\n});\n\ntype VisitedUrlsOption = (typeof visitedUrlsSchema)[\"_output\"];\ntype CloneParentDirOption = (typeof cloneParentDirSchema)[\"_output\"];\n\nconst gitRememberedInputsAtom = atomWithPersistence(\n  {\n    visitedUrls: [],\n    cloneParentDir: \"\",\n  },\n  {\n    storageFile: \"vcs.xml\", // GitRememberedInputs is user-level configuration, kept here temporarily\n    componentName: \"GitRememberedInputs\",\n    schema: gitRememberedInputsSchema,\n    read: ({ option: options } = { option: [] }) => {\n      return {\n        visitedUrls:\n          options\n            ?.find(\n              (option): option is VisitedUrlsOption =>\n                option[\"@name\"] === \"visitedUrls\"\n            )\n            ?.list.UrlAndUserName.map(\n              ({ option }): { url: string; username?: string | undefined } => ({\n                url: option.find((option) => option[\"@name\"] === \"url\")?.[\n                  \"@value\"\n                ]!,\n                username: option.find(\n                  (option) => option[\"@name\"] === \"userName\"\n                )?.[\"@value\"],\n              })\n            )\n            .filter((i) => i.url) ?? [],\n        cloneParentDir:\n          options?.find(\n            (option): option is CloneParentDirOption =>\n              option[\"@name\"] === \"cloneParentDir\"\n          )?.[\"@value\"] ?? \"\",\n      };\n    },\n    write: (value, state): (typeof gitRememberedInputsSchema)[\"_output\"] => {\n      return {\n        ...state,\n        option:\n          state.option?.map((option) => {\n            if (option[\"@name\"] === \"cloneParentDir\" && value.cloneParentDir) {\n              return {\n                \"@name\": \"cloneParentDir\",\n                \"@value\": value.cloneParentDir,\n              };\n            }\n            if (option[\"@name\"] === \"visitedUrls\" && value.visitedUrls) {\n              return {\n                \"@name\": \"visitedUrls\",\n                list: {\n                  UrlAndUserName: value.visitedUrls.map(\n                    ({ url, username }) => ({\n                      option: [\n                        { \"@name\": \"url\", \"@value\": url },\n                        { \"@name\": \"userName\", \"@value\": username ?? \"\" },\n                      ],\n                    })\n                  ),\n                },\n              };\n            }\n            return option;\n          }) ?? [],\n      };\n    },\n  }\n);\n\nexport const gitVisitedUrlsAtom = focusAtom(gitRememberedInputsAtom, (optic) =>\n  optic.path(\"visitedUrls\")\n);\n\nexport const cloneParentDirAtom = focusAtom(gitRememberedInputsAtom, (optic) =>\n  optic.path(\"cloneParentDir\")\n);\n","import React, { useEffect, useState } from \"react\";\nimport path from \"path\";\nimport git, { clone, GitProgressEvent } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport { defaultProject, autoClonedRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { ensureDir } from \"./fs/fs-utils\";\nimport {\n  AlertDialog,\n  Button,\n  Popup,\n  ProgressBar,\n  styled,\n} from \"@intellij-platform/core\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\nconst defaultWorkspaceFiles = {\n  \".idea/vcs.xml\": `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"GitRememberedInputs\">\n    <option name=\"visitedUrls\">\n      <list>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/alirezamirian/jui.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/thurwitz/example-branches.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n      </list>\n    </option>\n    <option name=\"cloneParentDir\" value=\"/workspace\"></option>\n  </component>\n  <component name=\"VcsDirectoryMappings\"></component>\n</project>\n\n`,\n};\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nconst defaultInitializer = async () => {\n  await ensureDir(fs.promises, defaultProject.path);\n  await Promise.all(\n    Object.entries(defaultWorkspaceFiles).map(async ([filename, content]) => {\n      const fullPath = path.join(defaultProject.path, filename);\n      if (await fs.promises.exists(fullPath)) {\n        return;\n      }\n      await ensureDir(fs.promises, path.dirname(fullPath));\n      await fs.promises.writeFile(fullPath, content, \"utf-8\");\n    })\n  );\n};\n\n/**\n * Used instead of Popup to have it not be fixed positioned, since this popup\n * is auto rendered in website's homepage, and example-app is rendered inline\n * there.\n */\nconst InlinePopup = styled(StyledPopupContainer)<{ minWidth?: number }>`\n  min-width: ${({ minWidth }) => (minWidth ? `${minWidth}px` : \"\")};\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nexport const ProjectInitializer = ({\n  children,\n  autoCloneSampleRepo = false,\n}: {\n  autoCloneSampleRepo?: boolean;\n  children?: React.ReactNode;\n}) => {\n  const [cloneProgress, setCloneProgress] = useState<GitProgressEvent | null>(\n    null\n  );\n\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function ensureSampleRepo(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl, onProgress: setCloneProgress });\n      }\n    }\n    // noinspection JSIgnoredPromiseFromCall: error handling done in the function\n    init();\n    async function init() {\n      const initializer =\n        (window as any).INITIALIZE_APP ?? // Giving a chance for external fs initialization. Used in e2e tests\n        defaultInitializer;\n      try {\n        await initializer({\n          fs,\n          git,\n          path,\n          projectDir: defaultProject.path,\n        });\n        if (autoCloneSampleRepo) {\n          await ensureSampleRepo(autoClonedRepo.path, autoClonedRepo.url);\n        }\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      } catch (e) {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      }\n    }\n  }, []);\n\n  const fraction = cloneProgress?.total\n    ? cloneProgress.loaded / cloneProgress.total\n    : 0;\n\n  switch (state) {\n    case \"uninitialized\":\n      return null;\n    case \"initialized\":\n      return <>{children}</>;\n    case \"cloning\":\n      return (\n        <InlinePopup minWidth={450}>\n          <Popup.Layout\n            header=\"Cloning sample git repository\"\n            content={\n              <div style={{ padding: \"1rem\" }}>\n                <ProgressBar\n                  name={`Cloning repository ${autoClonedRepo.url}`}\n                  isIndeterminate={!cloneProgress}\n                  details={\n                    fraction\n                      ? `${cloneProgress?.phase}: ${Math.round(\n                          fraction * 100\n                        )}% ${cloneProgress?.loaded}/${cloneProgress?.total}`\n                      : cloneProgress?.phase\n                  }\n                  aria-label={`Progress of cloning sample repo`}\n                  value={\n                    cloneProgress\n                      ? cloneProgress.loaded / cloneProgress.total\n                      : 0\n                  }\n                  maxValue={1}\n                />\n              </div>\n            }\n          />\n        </InlinePopup>\n      );\n    case \"error\":\n      return (\n        <AlertDialog\n          type=\"error\"\n          heading=\"Something went wrong!\"\n          body=\"Could not initialize example app\"\n          buttons={\n            <Button\n              variant=\"default\"\n              onPress={() => {\n                window.location.reload();\n              }}\n            >\n              Reload\n            </Button>\n          }\n        />\n      );\n  }\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","export function getInputCursorOffset(input: HTMLInputElement): number {\n  const caretIndex = input.selectionStart ?? input.value.length;\n  const inputStyle = window.getComputedStyle(input);\n\n  // Create and style a hidden span to mirror the input\n  const hiddenSpan = document.createElement(\"span\");\n  hiddenSpan.style.position = \"absolute\";\n  hiddenSpan.style.visibility = \"hidden\";\n  hiddenSpan.style.whiteSpace = \"pre-wrap\"; // Preserve spaces and line breaks\n  hiddenSpan.style.font = inputStyle.font;\n  hiddenSpan.style.fontSize = inputStyle.fontSize;\n  hiddenSpan.style.fontWeight = inputStyle.fontWeight;\n  hiddenSpan.style.fontFamily = inputStyle.fontFamily;\n  hiddenSpan.style.letterSpacing = inputStyle.letterSpacing;\n  hiddenSpan.style.border = inputStyle.border;\n  hiddenSpan.style.paddingLeft = inputStyle.paddingLeft;\n\n  // Set span content to text before the caret\n  hiddenSpan.textContent = input.value.substring(0, caretIndex);\n  document.body.appendChild(hiddenSpan);\n\n  // Measure the width of the hidden span to get the caret offset\n  const caretOffset = hiddenSpan.offsetWidth;\n\n  // Clean up the hidden span\n  document.body.removeChild(hiddenSpan);\n  return caretOffset;\n}\n","import path from \"path\";\nimport React, { ComponentProps, useEffect, useRef, useState } from \"react\";\nimport { mergeProps, mergeRefs } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  ActionsProvider,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  CommonActionId,\n  InputField,\n  Item,\n  ItemLayout,\n  ListBox,\n  MenuOverlayFromOrigin,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  WINDOW_SHADOW,\n} from \"@intellij-platform/core\";\nimport { MENU_VERTICAL_PADDING } from \"@intellij-platform/core/Menu/StyledMenu\";\nimport { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { fs } from \"../../fs/fs\";\nimport { getInputCursorOffset } from \"./getInputCursorOffset\";\n\nconst StyledPopover = styled.div`\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\nconst ListBoxStyledAsMenu: typeof ListBox /* https://github.com/styled-components/styled-components/issues/1803#issuecomment-2177525252 */ = styled(\n  ListBox\n)`\n  min-width: 120px;\n  margin: ${MENU_VERTICAL_PADDING}px 0;\n`;\n\nasync function getChildDirectories(searchDirectory: string) {\n  return fs.promises.readdir(searchDirectory).then(async (fileNames) => {\n    const childItems = await Promise.all(\n      fileNames.map(async (fileName) => {\n        const fullPath = path.join(searchDirectory, fileName);\n        return {\n          fullPath,\n          stat: await fs.promises.stat(fullPath),\n        };\n      })\n    );\n    return childItems\n      .filter(({ stat }) => stat.isDirectory())\n      .map(({ fullPath }) => fullPath);\n  });\n}\n\nexport function PathInputField({\n  value: valueProp,\n  onChange: onChangeProp,\n  defaultValue: defaultValueProp,\n  ...props\n}: Omit<ComponentProps<typeof InputField>, \"value\" | \"defaultValue\"> & {\n  value?: string;\n  defaultValue?: string;\n}) {\n  const [value, setValue] = useControlledState(\n    valueProp,\n    defaultValueProp ?? \"\",\n    onChangeProp\n  );\n  const [isAutocompleteVisible, setAutocompleteVisible] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const collectionRef = useRef<HTMLDivElement>(null);\n  const onAutocompleteSuggestionSelected = (key: React.Key) => {\n    setValue(path.join(`${key}`, path.sep)); // TODO: handle completion with tab\n  };\n  // Path search query is kept in a separate state because it needs to be updated when autocomplete action triggers.\n  // Otherwise, it could be a computed value based on `isAutocompleteVisible` and `directory`\n  const [pathSearchQuery, setPathSearchQuery] = useState(\"\");\n  const [pathSuggestions, setPathSuggestions] = useState<\n    Array<{ fullPath: string; textValue: string }>\n  >([]);\n  const updatePathAutocompletion = () => {\n    setMenuOrigin({\n      clientX:\n        (inputClientRect?.x ?? 0) + getInputCursorOffset(inputRef.current!),\n      clientY: (inputClientRect?.y ?? 0) + (inputClientRect?.height ?? 0) + 2,\n    });\n    setPathSearchQuery(\n      value.slice(0, inputRef.current?.selectionStart ?? undefined)\n    );\n  };\n  useEffect(() => {\n    if (isAutocompleteVisible) {\n      updatePathAutocompletion();\n    }\n  }, [isAutocompleteVisible, value]);\n\n  const wasAutocompleteVisible = usePrevious(isAutocompleteVisible);\n\n  useEffect(() => {\n    const pathParts = pathSearchQuery.split(path.sep);\n    const searchDirectory = pathParts.slice(0, -1).join(path.sep) || \"/\";\n    const query = pathParts.length > 1 ? pathParts.slice(-1)[0] : \"\";\n    let canceled = false;\n    getChildDirectories(searchDirectory).then((suggestions) => {\n      if (canceled) {\n        return;\n      }\n      // TODO: handle \"No suggestions\"\n      const matchedSuggestions = suggestions\n        .map((fullPath) => {\n          const dirname = path.basename(fullPath);\n          return { fullPath, textValue: dirname };\n        })\n        .filter(\n          ({ textValue }) =>\n            !query || textValue.toLowerCase().includes(query.toLowerCase())\n        );\n      setPathSuggestions(matchedSuggestions);\n      // TODO: set \"Use {0} to keep tail of the path\" tip if caret position is not at the end.\n      if (\n        matchedSuggestions.length > 0 &&\n        /* Note that wasAutocompleteVisible is a captured closure and it's intentionally not in effect's dependencies */\n        !wasAutocompleteVisible &&\n        inputRef.current?.value.indexOf(pathSearchQuery) === 0\n      ) {\n        inputRef.current.setSelectionRange(\n          pathSearchQuery.length,\n          inputRef.current.value.length,\n          \"backward\"\n        );\n      }\n    });\n    return () => {\n      canceled = true;\n    };\n  }, [pathSearchQuery]);\n\n  const [menuOrigin, setMenuOrigin] = useState({ clientX: 0, clientY: 0 });\n\n  const inputClientRect = inputRef.current?.getBoundingClientRect();\n\n  return (\n    <>\n      <ActionsProvider\n        actions={[\n          {\n            id: CommonActionId.CODE_COMPLETION,\n            title: \"Autocomplete path\",\n            actionPerformed: () => {\n              updatePathAutocompletion();\n              setAutocompleteVisible(true);\n            },\n          },\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <InputField\n            {...props}\n            value={value}\n            onChange={setValue}\n            inputRef={mergeRefs(inputRef, props.inputRef)}\n            inputProps={mergeProps(\n              props.inputProps ?? {},\n              shortcutHandlerProps,\n              {\n                onKeyDown: (e: React.KeyboardEvent) => {\n                  if (e.key === \"Escape\") {\n                    setAutocompleteVisible(false);\n                  }\n                },\n                onBlur: () => {\n                  setAutocompleteVisible(false);\n                },\n              }\n            )}\n            addonAfter={\n              <>\n                {props.addonAfter}\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Browse... (⇧⏎)\" />}\n                >\n                  {(props) => (\n                    <AutoHoverPlatformIcon\n                      {...props}\n                      style={{ marginRight: \".2rem\" }}\n                      role=\"button\"\n                      onClick={notImplemented}\n                      icon=\"general/openDisk.svg\"\n                    />\n                  )}\n                </TooltipTrigger>\n              </>\n            }\n          />\n        )}\n      </ActionsProvider>\n      {isAutocompleteVisible && (\n        <MenuOverlayFromOrigin\n          onClose={() => {\n            setAutocompleteVisible(false);\n          }}\n          origin={menuOrigin}\n        >\n          <StyledPopover>\n            <ListBoxStyledAsMenu\n              ref={collectionRef}\n              focusProxyRef={inputRef}\n              aria-label=\"Directories\"\n              shouldFocusOnHover\n              shouldUseVirtualFocus\n              autoFocus=\"first\"\n              onAction={onAutocompleteSuggestionSelected}\n              items={pathSuggestions}\n            >\n              {({ fullPath }) => (\n                <Item key={fullPath} textValue={fullPath}>\n                  <ItemLayout>\n                    <PlatformIcon icon={DIR_ICON} />\n                    {path.basename(fullPath)}\n                  </ItemLayout>\n                </Item>\n              )}\n            </ListBoxStyledAsMenu>\n          </StyledPopover>\n        </MenuOverlayFromOrigin>\n      )}\n    </>\n  );\n}\n","import path from \"path\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useAtom } from \"jotai\";\nimport {\n  Button,\n  ComboBox,\n  Item,\n  LabeledControlsAlignmentProvider,\n  ModalWindow,\n  styled,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport { windowManagerRefAtom } from \"../../Project/project.state\";\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  cloneParentDirAtom,\n  gitVisitedUrlsAtom,\n} from \"../gitRememberedInputs.state\";\nimport { useClone } from \"../useClone\";\nimport { PathInputField } from \"./PathInputField\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const gitCloneActionAtom = actionAtom({\n  id: VcsActionIds.GIT_CLONE,\n  title: \"Clone...\",\n  actionPerformed: async ({ get }) => {\n    const windowManager = get(windowManagerRefAtom);\n    windowManager.current?.open(({ close }) => (\n      <GitCloneWindow close={close} />\n    ));\n  },\n});\n\nexport const cloneAnotherRepoActionAtom = actionAtom({\n  id: \"ExampleApp.cloneExampleRepo\",\n  title: \"Clone another repository...\",\n  isSearchable: false,\n  actionPerformed: ({ get }) => {\n    const windowManager = get(windowManagerRefAtom);\n    windowManager.current?.open(({ close }) => (\n      <GitCloneWindow\n        close={close}\n        url=\"https://github.com/thurwitz/example-branches.git\"\n      />\n    ));\n  },\n});\n\nconst StyledContainer = styled.div`\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.75rem;\n`;\n\nfunction GitCloneWindow({\n  close,\n  url: urlProp,\n}: {\n  close: () => void;\n  url?: string;\n}) {\n  const [url, setUrl] = useState(urlProp ?? \"\");\n  const [parentDir, setCloneParentDirState] = useAtom(cloneParentDirAtom);\n  const [visitedUrls, setVisitedUrls] = useAtom(gitVisitedUrlsAtom);\n  const [directory, setDirectory] = useState(\"\");\n  const [autoFillDirectory, setAutoFillDirectory] = useState(true);\n  const [showValidationErrors, setShowValidationErrors] = useState(false);\n  const urlInputRef = useRef<HTMLInputElement>(null);\n  const dirInputRef = useRef<HTMLInputElement>(null);\n  const urlError = validateRepoUrl(url);\n  const [dirError, setDirError] = useState(\"\");\n\n  const clone = useClone();\n\n  useEffect(() => {\n    if (autoFillDirectory) {\n      const repoName =\n        url\n          .split(/\\/{1,2}/)\n          .pop()\n          ?.replace(/\\.git$/, \"\") ?? \"\";\n      setDirectory(repoName ? path.join(parentDir, repoName) : parentDir);\n    }\n  }, [parentDir, url, autoFillDirectory]);\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setShowValidationErrors(true);\n    // Note: in the reference impl, validation is live, here it's upon submission.\n    // Error is cleared upon change, like in NewFilePopup.\n    const dirValidationError = await validateCloneDirectory(directory);\n    if (dirValidationError) {\n      setDirError(dirValidationError);\n      dirInputRef.current?.focus();\n      return;\n    }\n    if (urlError) {\n      urlInputRef.current?.focus();\n      return;\n    }\n    setCloneParentDirState(path.dirname(directory));\n    setVisitedUrls((urls) =>\n      urls.find((visitedUrl) => visitedUrl.url === url)\n        ? urls\n        : urls.concat({ url })\n    );\n    clone({\n      url,\n      dir: directory,\n      onSuccess: () => {\n        setVisitedUrls((visitedUrls) =>\n          visitedUrls.map(({ url }) => url).includes(url)\n            ? visitedUrls\n            : [...visitedUrls, { url, username: \"\" }]\n        );\n      },\n    });\n    close();\n  };\n\n  return (\n    <ModalWindow minWidth={600} minHeight=\"content\">\n      <WindowLayout\n        header=\"Get from Version Control\"\n        content={\n          <LabeledControlsAlignmentProvider>\n            <form id=\"clone_form\" onSubmit={onSubmit}>\n              <StyledContainer>\n                <ComboBox\n                  inputRef={urlInputRef}\n                  autoFocus\n                  label=\"URL:\"\n                  value={url}\n                  validationState={\n                    urlError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && urlError}\n                  onValueChange={(value) => {\n                    setUrl(value);\n                  }}\n                  items={visitedUrls}\n                >\n                  {({ url }) => <Item key={url}>{url}</Item>}\n                </ComboBox>\n                <PathInputField\n                  inputRef={dirInputRef}\n                  label=\"Directory:\"\n                  value={directory}\n                  validationState={\n                    dirError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && dirError}\n                  onChange={(value) => {\n                    setDirectory(value);\n                    setAutoFillDirectory(false);\n                    setDirError(\"\");\n                  }}\n                />\n              </StyledContainer>\n            </form>\n          </LabeledControlsAlignmentProvider>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  isDisabled={!directory || !url}\n                  type=\"submit\"\n                  form=\"clone_form\"\n                >\n                  Clone\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function validateCloneDirectory(directory: string) {\n  const stats = await stat(directory);\n  if (!stats) {\n    return null;\n  }\n  if (!stats.isDirectory()) {\n    return \"Destination is not a directory\";\n  }\n  const entries = await fs.promises.readdir(directory);\n  return entries.length > 0\n    ? \"The directory already exists and is not empty\"\n    : null;\n}\nconst SSH_URL_PATTERN = new RegExp(`^git@[\\\\w.-]+:[\\\\w./-]+\\\\.git$`);\nfunction validateRepoUrl(url: string): string | null {\n  url = sanitizeCloneUrl(url);\n  try {\n    new URL(url);\n    return null;\n  } catch (e) {\n    if (SSH_URL_PATTERN.test(url)) {\n      return null;\n    }\n  }\n  return \"Repository URL is a malformed URL\";\n}\n\nfunction sanitizeCloneUrl(url: string): string {\n  return removePrefix(removePrefix(url.trim(), \"git clone\"), \"hg clone\");\n}\n\nfunction removePrefix(str: string, prefix: string): string {\n  if (str.startsWith(prefix)) {\n    return str.slice(prefix.length);\n  }\n  return str;\n}\n","import path from \"path\";\nimport { useCallback } from \"react\";\nimport { useSetAtom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { useRunTask } from \"../tasks\";\nimport { cloneRepo } from \"../ProjectInitializer\";\nimport { _balloonManagerRef } from \"../Project/notImplemented\";\nimport { dirContentAtom } from \"../fs/fs.state\";\nimport { vcsRootsAtom } from \"./file-status.state\";\n\nexport function useClone() {\n  const runTask = useRunTask();\n  const setVcsRoots = useSetAtom(vcsRootsAtom);\n\n  return useAtomCallback(\n    useCallback(\n      (\n        _get,\n        set,\n        {\n          url,\n          dir,\n          onSuccess,\n        }: {\n          url: string;\n          dir: string;\n          onSuccess?: () => void;\n        }\n      ) => {\n        runTask(\n          {\n            title: `Cloning source repository ${url}`,\n          },\n          {\n            onFinished: onSuccess,\n            run: async ({\n              setIndeterminate,\n              setFraction,\n              setSecondaryText,\n            }) => {\n              await cloneRepo({\n                dir,\n                url,\n                // TODO: handle onAuthFailure, onAuth, and maybe onMessage\n                onProgress: (progress) => {\n                  if (progress.total) {\n                    const fraction = progress.loaded / progress.total;\n                    setFraction(fraction);\n                    setSecondaryText(\n                      `${progress.phase}: ${Math.round(fraction * 100)}% ${\n                        progress.loaded\n                      }/${progress.total}`\n                    );\n                  } else {\n                    setSecondaryText(progress.phase);\n                    setIndeterminate(true);\n                  }\n                },\n              }).then(\n                () => {\n                  setVcsRoots((roots) =>\n                    roots.find((root) => root.dir === dir)\n                      ? roots\n                      : roots.concat({ vcs: \"Git\", dir })\n                  );\n                  // TODO: other directories within parent don't need a refresh.\n                  //  add an optimized way to refresh a single directory inside a directory\n                  set(dirContentAtom(path.resolve(dir, \"..\")));\n                },\n                (e) => {\n                  console.log(\"e\", e);\n                  // FIXME: using useBalloonManager doesn't work here, because of how BalloonManager is rendered inside WindowManager\n                  _balloonManagerRef.value?.show({\n                    icon: \"Error\",\n                    title: \"Clone failed\",\n                    body: `Failed to clone git repo \"${url} into ${dir}: ${e}\"`,\n                  });\n                }\n              );\n            },\n          }\n        );\n      },\n      []\n    )\n  );\n}\n","import { useAtomValue } from \"jotai\";\nimport React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\nimport { gitAddActionAtom } from \"./actions/gitAddAction\";\nimport { gitInitActionAtom } from \"./actions/gitInitAction\";\nimport { vcsRootsAtom } from \"./file-status.state\";\nimport {\n  cloneAnotherRepoActionAtom,\n  gitCloneActionAtom,\n} from \"./actions/gitCloneAction\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n  const gitAddAction = useAtomValue(gitAddActionAtom);\n  const gitInitAction = useAtomValue(gitInitActionAtom);\n  const gitCloneAction = useAtomValue(gitCloneActionAtom);\n  const cloneAnotherRepoAction = useAtomValue(cloneAnotherRepoActionAtom);\n  return [\n    ...useChangesViewActionDefinitions(),\n    gitAddAction,\n    gitCloneAction,\n    cloneAnotherRepoAction,\n    // not including git init action if there is at least one git root, because the action is not fully implemented\n    // and doesn't allow selecting the directory to initialize as a git repository. FIXME\n    ...(useAtomValue(vcsRootsAtom).length === 0 ? [gitInitAction] : []),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup close={close} />);\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH,\n      title: \"Navigate Log to Selected Branch Head\",\n      useShortcutsOf: \"SelectIn\",\n      icon: <PlatformIcon icon=\"general/locate.svg\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n  ];\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + Math.round(num / 20) + 1;\n}\n","import React, { CSSProperties, useRef } from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionsProviderProps,\n  BalloonManager,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useAlertDialog,\n  useBalloonManager,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { toolWindows } from \"./toolWindows\";\nimport { SyncChangeListsState } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsStateAtom } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { useTestActions } from \"../testActions/useTestActions\";\nimport { ToolWindowsRefContext } from \"./useToolWindowManager\";\nimport {\n  alertDialogRefAtom,\n  projectPopupManagerRefAtom,\n  windowManagerRefAtom,\n} from \"./project.state\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({ height }: { height: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  const [state, setState] = useAtom(toolWindowsStateAtom);\n  const isRollbackWindowOpen = useAtomValue(rollbackViewState.isOpenAtom);\n  const isSearchEveryWhereOpen = useAtomValue(searchEverywhereState.isOpen);\n\n  useAtomValue(projectPopupManagerRefAtom).current = usePopupManager();\n  useAtomValue(windowManagerRefAtom).current = useWindowManager();\n  useAtomValue(alertDialogRefAtom).current = useAlertDialog();\n\n  return (\n    <>\n      <SyncChangeListsState />\n      <BalloonManager disablePortal>\n        <SetBalloonManagerRef />\n        <UsePersistentFsNotification />\n        {/* disablePortal to make example app more portable*/}\n        <ToolWindowsRefContext.Provider value={toolWindowRef}>\n          <StyledWindowFrame style={{ height }}>\n            <ProjectActionProvider>\n              {({ shortcutHandlerProps }) => (\n                <>\n                  <DefaultToolWindows\n                    ref={toolWindowRef}\n                    toolWindowsState={state}\n                    onToolWindowStateChange={(newState) => {\n                      setState(newState);\n                    }}\n                    windows={toolWindows}\n                    containerProps={shortcutHandlerProps}\n                  >\n                    <FileEditor />\n                  </DefaultToolWindows>\n                  <IdeStatusBar />\n                </>\n              )}\n            </ProjectActionProvider>\n            {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n            {isRollbackWindowOpen && <RollbackWindow />}\n          </StyledWindowFrame>\n        </ToolWindowsRefContext.Provider>\n      </BalloonManager>\n    </>\n  );\n};\n\nfunction ProjectActionProvider(\n  props: Omit<ActionsProviderProps, \"actions\" | \"useCapture\">\n) {\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n  return (\n    <ActionsProvider\n      {...props}\n      actions={allActions}\n      useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n    />\n  );\n}\n\nfunction SetBalloonManagerRef() {\n  _balloonManagerRef.value = useBalloonManager();\n  return null;\n}\n\nfunction UsePersistentFsNotification() {\n  usePersistenceFsNotification();\n  return null;\n}\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\nimport { AppActionIds } from \"./appActionIds\";\nimport { editorActionIds } from \"./Editor/editorActionIds\";\nimport { projectActionIds } from \"./Project/projectActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateVersionControlWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit9\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n  [VcsActionIds.ADD_UNVERSIONED]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [VcsActionIds.FOCUS_TEXT_FILTER]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyL\",\n      },\n    },\n  ],\n  [VcsActionIds.GROUP_BY_DIRECTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Control\"],\n        code: \"KeyP\",\n      },\n    },\n  ],\n  SafeDelete: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  CopyPaths: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [AppActionIds.PASTE_MULTIPLE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyV\",\n      },\n    },\n  ],\n  [projectActionIds.NewElement]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n  [AppActionIds.GENERATE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_REGION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_REGION_RECURSIVELY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_ALL_REGIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  ...([1, 2, 3, 4, 5] as const).reduce((result, level) => {\n    result[editorActionIds[`EXPAND_ALL_TO_LEVEL${level}`]] = [\n      {\n        type: \"keyboard\",\n        firstKeyStroke: {\n          modifiers: [\"Alt\", \"Meta\"],\n          code: \"Multiply\",\n        },\n        secondKeyStroke: {\n          code: `Digit${level}`,\n        },\n      },\n      {\n        type: \"keyboard\",\n        firstKeyStroke: {\n          modifiers: [\"Alt\", \"Meta\"],\n          code: \"Multiply\",\n        },\n        secondKeyStroke: {\n          code: `Numpad${level}`,\n        },\n      },\n    ];\n    return result;\n  }, {} as Keymap),\n  [editorActionIds.COLLAPSE_REGION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [editorActionIds.COLLAPSE_REGION_RECURSIVELY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [editorActionIds.COLLAPSE_ALL_REGIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n};\n","import * as path from \"path\";\nimport React, { CSSProperties } from \"react\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  KeymapProvider,\n  PopupManager,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { ProjectInitializer } from \"./ProjectInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport \"./jetbrains-mono-font.css\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({\n  height,\n  autoCloneSampleRepo,\n}: {\n  height?: CSSProperties[\"height\"];\n  autoCloneSampleRepo?: boolean;\n}) => {\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <ProjectInitializer autoCloneSampleRepo={autoCloneSampleRepo}>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <WindowManager>\n              <PopupManager>\n                <Project height={height} />\n              </PopupManager>\n            </WindowManager>\n          </KeymapProvider>\n        </ProjectInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n","import {\n  Action,\n  ActionDefinition,\n} from \"@intellij-platform/core/ActionSystem/Action\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\n\nexport type ActionInResolvedGroup = Action & { parent: ResolvedActionGroup };\n\n/**\n * Different ways to show a group of actions in a menu.\n * - `submenu`: renders children as submenu (corresponding, in the reference impl, to `isPopup` property of ActionGroup\n *   being set to `true` and 'SUPPRESS_SUBMENU' clientProperty not being set)\n * - `none`: renders the action group as a simple menu item, not rendering its children at all.\n *   The action group will be performed, which typically opens a popup (see {@link useCreateDefaultActionGroup}),\n *   showing the children.\n *   (corresponding, in the reference impl, to `isPopup` property and 'SUPPRESS_SUBMENU' clientProperty being set\n *   to true on the ActionGroup)\n * - `section`: renders children in a section with divider, but without section title\n * - `titledSection`: renders children in a section with divider and title.\n */\ntype ActionGroupMenuPresentation =\n  | \"section\"\n  | \"titledSection\"\n  | \"none\"\n  | \"submenu\";\n\nexport interface MutableActionGroup extends Action {\n  children: Array<Action | DividerItem>;\n  /**\n   * Whether the action group is searchable. See {@link getAvailableActionsFor}.\n   */\n  isSearchable?: boolean;\n  /**\n   * How the action group should be rendered, in menus.\n   */\n  menuPresentation?: ActionGroupMenuPresentation;\n}\nexport type ActionGroup = Readonly<MutableActionGroup>;\n\nexport interface ResolvedActionGroup extends ActionGroup {\n  parent: ResolvedActionGroup | null;\n  children: ActionInResolvedGroup[];\n}\nexport interface ActionGroupDefinition extends ActionDefinition {\n  children: Array<ActionDefinition | \"divider\">;\n  /**\n   * Defines how the action group should be represented in menus.\n   * @default 'submenu'\n   * @see ActionGroupMenuPresentation\n   */\n  menuPresentation?: ActionGroupMenuPresentation;\n}\n\nexport function isInResolvedActionGroup(\n  action: Action\n): action is ActionInResolvedGroup {\n  return \"parent\" in action;\n}\nexport function isActionGroup(action: Action): action is ActionGroup {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n\nexport function isResolvedActionGroup<T extends Action>(\n  action: Action\n): action is ResolvedActionGroup {\n  return \"children\" in action && \"parent\" in action; // probably better to use a discriminator field like `type`\n}\n\nexport function isActionGroupDefinition(\n  action: ActionDefinition\n): action is ActionGroupDefinition {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n","import React from \"react\";\nimport { useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\n\n/**\n * Renders the first keyboard shortcut for the action specified by {@param actionId}, based on the keymap context.\n * if {@param children} is provided, treats it as a render function that receives the shortcut string.\n */\nexport const ActionShortcut = ({\n  actionId,\n  children,\n}: {\n  actionId: string;\n  children?: (shortcut: string) => React.ReactNode;\n}) => {\n  const getShortcut = useGetActionShortcut();\n  const shortcutString = getShortcut(actionId);\n  return (\n    <>\n      {shortcutString && (children ? children(shortcutString) : shortcutString)}\n    </>\n  );\n};\n\n/**\n * Returns a function that gets first keyboard shortcut for the action specified by `actionId`, based on the\n * keymap context.\n */\nexport const useGetActionShortcut = (): ((actionId: string) => string) => {\n  const keymap = useKeymap();\n  return (actionId: string) => {\n    const keyboardShortcut = keymap?.[actionId]?.find(\n      ({ type }) => type === \"keyboard\"\n    );\n    return keyboardShortcut ? shortcutToString(keyboardShortcut) : \"\";\n  };\n};\n","import React, { KeyboardEventHandler, useRef } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  isKeyboardShortcut,\n  KeyboardShortcut,\n  KeyStroke,\n  Shortcut,\n  supportedModifiers,\n} from \"./Shortcut\";\n\nexport function useShortcuts(\n  shortcuts: { [actionId: string]: ReadonlyArray<Shortcut> },\n  onAction: (\n    actionId: string,\n    args: {\n      event: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>;\n    }\n  ) => void | boolean,\n  {\n    useCapture = false,\n  }: {\n    /**\n     * Experimental option to determine if event handling should be done on capture phase. Useful for cases where\n     * a descendant element handles events in capture phase, and that conflicts with an action.\n     */\n    useCapture?: boolean;\n  } = {}\n) {\n  const firstKeyActivatedShortcutsRef = useRef<\n    Array<{ actionId: string; shortcut: KeyboardShortcut }>\n  >([]);\n  const secondStrokeResetTimerIdRef = useRef<number | null>(null);\n  const onKeyDown: KeyboardEventHandler<HTMLElement> = useEventCallback((e) => {\n    // TODO: repeated key downs can trigger an action repeatedly, in the original impl. Example: expand/shrink selection\n    if (isModifierOnly(e.nativeEvent) || e.repeat) {\n      return;\n    }\n    // firstKeyActivatedShortcutsRef will be re-adjusted in any case. Cleaning whatever scheduled reset\n    if (secondStrokeResetTimerIdRef.current !== null) {\n      window.clearTimeout(secondStrokeResetTimerIdRef.current);\n    }\n\n    function triggerAction(actionId: string) {\n      const result = onAction(actionId, { event: e });\n      if (result !== false) {\n        // TODO: make sure about how propagation should be stopped and/or controlled\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }\n    // If there are keyboard shortcuts that are half way handled (first keystroke triggered already, and we are within\n    // the valid wait for the second keystroke), they should be prioritized over first keystroke matching.\n    if (firstKeyActivatedShortcutsRef.current.length > 0) {\n      firstKeyActivatedShortcutsRef.current.some(({ shortcut, actionId }) => {\n        if (isKeyMatch(shortcut.secondKeyStroke, e, true)) {\n          triggerAction(actionId);\n          return true;\n        }\n      });\n      firstKeyActivatedShortcutsRef.current = [];\n    } else {\n      const firstKeyMatches = Object.entries(shortcuts)\n        .flatMap(([actionId, shortcuts]) =>\n          shortcuts.map((shortcut) => ({ actionId, shortcut }))\n        )\n        .filter(\n          (\n            input\n          ): input is {\n            actionId: string;\n            shortcut: KeyboardShortcut;\n          } => isKeyboardShortcut(input.shortcut)\n        )\n        .filter(({ shortcut }) => isKeyMatch(shortcut.firstKeyStroke, e));\n\n      firstKeyActivatedShortcutsRef.current = firstKeyMatches.filter(\n        ({ shortcut, actionId }) => shortcut.secondKeyStroke\n      );\n\n      if (firstKeyActivatedShortcutsRef.current.length > 0) {\n        secondStrokeResetTimerIdRef.current = window.setTimeout(() => {\n          firstKeyActivatedShortcutsRef.current = [];\n        }, 2000);\n        document.addEventListener(\n          \"keydown\",\n          () => {\n            document.addEventListener(\n              \"keyup\",\n              () => {\n                firstKeyActivatedShortcutsRef.current = [];\n              },\n              { once: true }\n            );\n          },\n          //  by passing capture: true, we skip the current keydown event, since it's already passed capture phase\n          { once: true, capture: true }\n        );\n      } else if (firstKeyMatches.length > 0) {\n        triggerAction(firstKeyMatches[0].actionId);\n      }\n    }\n  });\n  const shortcutHandlerProps = {\n    /**\n     * by setting onKeyDownCapture is set instead of onKeyDown, we can prioritize action event handler over\n     * component-specific handlers. That might be useful for some components that aggressively stop propagation of\n     * events they handle, if the action is considered of higher priority compared to the conflicting component-internal\n     * functionality. So maybe an option would be in order to define whether the shortcut's event handling should be done\n     * in capture or bubbling phase.\n     * Another thing to get clarified as action system is more used, is to decide if action handler should stop\n     * propagation or not. Or should it be an option?\n     * UPDATE: Added an option to determine whether event handling should be done in capture phase. The use case is\n     * \"Find in files\" action with Cmd+Shift+O shortcut, which overlaps with some action in Monaco editor (only in .ts\n     * files). Monaco uses capture phase, and stops propagation, so unless we use capture phase, useShortcut's event\n     * handler is never called.\n     * An apposite use case is in SpeedSearchTree in tool windows, where we want Escape to be handled by speed search,\n     * and propagation stopped, if speed search is currently active. The second Escape keystroke should move focus to\n     * the editor. That wouldn't work if we unconditionally handle events in capture phase.\n     */\n    [useCapture ? \"onKeyDownCapture\" : \"onKeyDown\"]: onKeyDown,\n  };\n  return { shortcutHandlerProps };\n}\n\nconst isKeyMatch = (\n  keyStroke: KeyStroke | undefined,\n  e: React.KeyboardEvent,\n  loose?: boolean\n) =>\n  e.code === keyStroke?.code &&\n  (loose ? keyStroke.modifiers || [] : supportedModifiers).every(\n    (modifier) =>\n      e.getModifierState(modifier) ===\n      Boolean(keyStroke.modifiers?.includes(modifier))\n  );\n\nfunction isModifierOnly(event: KeyboardEvent) {\n  return event.location === 1 || event.location === 2;\n}\n","import { sortBy } from \"ramda\";\nimport React, { HTMLAttributes, useContext, useEffect, useState } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { Keymap, useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\nimport { useShortcuts } from \"./useShortcut\";\nimport {\n  ActionGroup,\n  ActionInResolvedGroup,\n  isActionGroup,\n  isActionGroupDefinition,\n  MutableActionGroup,\n} from \"./ActionGroup\";\nimport {\n  Action,\n  ActionContext,\n  ActionDefinition,\n  MutableAction,\n} from \"./Action\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\n\n/**\n * Represents the properties required for the ActionsProvider component.\n */\nexport interface ActionsProviderProps {\n  /**\n   * A collection of action definitions.\n   */\n  actions: ActionDefinition[];\n  children: (args: {\n    shortcutHandlerProps: HTMLAttributes<HTMLElement>;\n  }) => React.ReactElement;\n\n  /**\n   * Experimental option to determine if event handling should be done on capture phase. Useful for cases where\n   * a descendant element handles events in capture phase, and that conflicts with an action.\n   */\n  useCapture?: boolean;\n}\n\nconst ActionsContext = React.createContext<Action[]>([]);\n\nfunction generateId() {\n  return `jui-${Math.floor(Math.random() * 10000000)}`;\n}\n\nconst ACTION_PROVIDER_ID_ATTRIBUTE = \"data-action-provider\";\nconst ACTION_PROVIDER_ID_DATA_PREFIX = \"action_provider_id_\";\nconst actionProvidersMap = new Map<string, Action[]>();\n\n/**\n * Provides a set of actions for the wrapped UI. Uses the currently provided keymap to find the shortcuts\n * for each action, and passes the necessary event handlers for the shortcuts, to the `children` render function.\n *\n * @param {Array<Action>} props.actions - The actions to be provided.\n * @param {boolean} [props.useCapture] - Specifies whether to use capture phase for event handling.\n * @param {Function} props.children - Render function that accepts shortcutHandlerProps as argument.\n */\nexport function ActionsProvider(props: ActionsProviderProps): JSX.Element {\n  const parentContext = useContext(ActionsContext);\n  const keymap = useKeymap();\n  const actions: Action[] = [];\n  dfsVisit(\n    (action: Action | DividerItem | null) =>\n      action && !(action instanceof DividerItem) && isActionGroup(action)\n        ? action.children\n        : null,\n    (action) => {\n      if (action && !(action instanceof DividerItem)) {\n        actions.push(action);\n      }\n    },\n    recursivelyCreateActions(keymap, props.actions)\n  );\n\n  const shortcuts = Object.fromEntries(\n    actions.map((action) => [action.id, action.shortcuts || []])\n  );\n  const [actionProviderId] = useState(generateId);\n\n  const { shortcutHandlerProps } = useShortcuts(\n    shortcuts,\n    (actionId, { event }) => {\n      actions\n        .find((action) => action.id === actionId)\n        ?.perform({\n          event,\n          // it's important to use target and not currentTarget\n          element: event.target instanceof Element ? event.target : null,\n        });\n    },\n    { useCapture: props.useCapture }\n  );\n\n  const allActions = [...parentContext, ...actions]; // Maybe warn overrides?\n\n  // @ts-expect-error: not sure why data-* attribute is not accepted.\n  shortcutHandlerProps[ACTION_PROVIDER_ID_ATTRIBUTE] = actionProviderId;\n  // @ts-expect-error: not sure why data-* attribute is not accepted.\n  shortcutHandlerProps[\n    `data-${ACTION_PROVIDER_ID_DATA_PREFIX}${actionProviderId}`\n  ] = \"\";\n\n  useEffect(() => {\n    actionProvidersMap.set(actionProviderId, allActions);\n  });\n  useEffect(() => {\n    return () => {\n      actionProvidersMap.delete(actionProviderId);\n    };\n  }, []);\n  return (\n    <ActionsContext.Provider value={allActions}>\n      {props.children({ shortcutHandlerProps })}\n    </ActionsContext.Provider>\n  );\n}\n\nfunction isMutableActionGroup(\n  action: MutableAction\n): action is MutableActionGroup {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: Array<ActionDefinition | DividerItem>,\n  parent: ActionGroup\n): Array<ActionInResolvedGroup | DividerItem>;\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: Array<ActionDefinition | DividerItem>\n): Array<Action | ActionGroup | DividerItem>;\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: Array<ActionDefinition | DividerItem>,\n  parent?: ActionGroup\n): Array<Action | ActionInResolvedGroup | ActionGroup | DividerItem> {\n  return actionDefinitions.map(\n    (\n      actionDefinition: ActionDefinition | DividerItem\n    ): Action | DividerItem => {\n      if (actionDefinition instanceof DividerItem) {\n        return actionDefinition;\n      }\n      const shortcuts =\n        keymap?.[actionDefinition.id] ??\n        (actionDefinition.useShortcutsOf\n          ? keymap?.[actionDefinition.useShortcutsOf]\n          : undefined);\n      const firstShortcut = shortcuts?.[0];\n      const action: MutableAction | ActionInResolvedGroup = {\n        ...actionDefinition,\n        ...(isActionGroupDefinition(actionDefinition)\n          ? { parent: parent ?? null }\n          : {}),\n        shortcuts,\n        shortcut: firstShortcut ? shortcutToString(firstShortcut) : undefined, // Maybe it should be all shortcuts?\n        perform: (context) => {\n          if (!action.isDisabled) {\n            actionDefinition.actionPerformed(\n              context || { event: null, element: null }\n            );\n          }\n        },\n      };\n      if (\n        isMutableActionGroup(action) &&\n        isActionGroupDefinition(actionDefinition)\n      ) {\n        action.children = recursivelyCreateActions(\n          keymap,\n          actionDefinition.children.map((child) =>\n            child === \"divider\" ? new DividerItem() : child\n          ),\n          action\n        );\n      }\n      return action;\n    }\n  );\n}\n\n/**\n * Experimental function to get list of all actions available from a given html elements. Useful for implementing\n * action search UI.\n * @experimental\n */\nexport function getAvailableActionsFor(element: Element): Action[] {\n  const closestActionProvider = element.closest(\n    `[${ACTION_PROVIDER_ID_ATTRIBUTE}]`\n  );\n  if (closestActionProvider instanceof HTMLElement) {\n    /**\n     * NOTE: initially, only one data attribute was used to hold the action provider id. Although simpler, that approach\n     * is subject to bug in some edge cases, where multiple nested action providers are rendered, but `actionProviderProps`\n     * is merged on a single dom element. In such cases, it's important that the props from the innermost action provider\n     * is merged last, overwriting other values for data-action-provider-id.\n     * Because that's error-prone, we keep unique data attributes (`data-action_provider_id_...`} for each action\n     * provider id, and to simplify querying part, we also add a constant data attribute (data-action-provider).\n     * This way we can read all action providers applied on the same dom element. Since action providers inherit actions\n     * from parent action providers, we can reliably pick the actions from the one with the highest number of actions.\n     */\n    const actionSets = Object.keys(closestActionProvider.dataset)\n      .filter((dataKey) => dataKey.startsWith(ACTION_PROVIDER_ID_DATA_PREFIX))\n      .map((dataKey) => {\n        const id = dataKey?.replace(ACTION_PROVIDER_ID_DATA_PREFIX, \"\");\n        const actions = id && actionProvidersMap.get(id);\n        // noinspection PointlessBooleanExpressionJS\n        return actions\n          ? Object.values(actions).filter(\n              ({ isSearchable }) => isSearchable !== false\n            )\n          : [];\n      })\n      .concat();\n    return sortBy((actionSet) => -actionSet.length, actionSets)[0] || [];\n  }\n  return [];\n}\n\nexport function useActions(): Action[] {\n  return useContext(ActionsContext);\n}\n\nexport const useAction = (actionId: string): Action | null => {\n  return useActions().find(({ id }) => id === actionId) ?? null;\n};\n\nexport const usePerformAction = (): ((\n  actionId: string,\n  context?: ActionContext\n) => void) => {\n  const actions = useActions();\n  return useEventCallback((actionId: string, context?: ActionContext) => {\n    const action = actions.find(({ id }) => id === actionId);\n    if (action) {\n      action.perform(context);\n    } else {\n      console.error(\n        `An attempt to perform action with id ${actionId} failed because action was not found`\n      );\n    }\n  });\n};\n","export const CommonActionId = {\n  EXPAND_ALL: \"ExpandAll\",\n  COLLAPSE_ALL: \"CollapseAll\",\n  EXPAND_SELECTION: \"EditorSelectWord\",\n  SHRINK_SELECTION: \"EditorUnSelectWord\",\n  GO_TO_ACTION: \"GotoAction\",\n  GO_TO_FILE: \"GotoFile\",\n  SHOW_INTENTION_ACTIONS: \"ShowIntentionActions\",\n  EDIT_SOURCE: \"Documentation.EditSource\",\n  SHOW_SEARCH_HISTORY: \"ShowSearchHistory\",\n  COPY_REFERENCE: \"CopyReference\",\n  REFRESH: \"Refresh\",\n  COPY: \"$Copy\",\n  CUT: \"$Cut\",\n  PASTE: \"$Paste\",\n  DELETE: \"$Delete\",\n  CODE_COMPLETION: \"CodeCompletion\",\n};\n","import React, { useContext } from \"react\";\nimport { Shortcut } from \"./Shortcut\";\nimport { defaultKeymap } from \"./defaultKeymap\";\n\nexport interface Keymap {\n  [actionId: string]: ReadonlyArray<Shortcut>;\n}\n\nexport const KeymapContext = React.createContext<Keymap | null>(defaultKeymap);\n\nexport const KeymapProvider: React.FC<{\n  keymap: Keymap;\n  children?: React.ReactNode;\n}> = ({ keymap: keymapProp, children }) => {\n  const parentKeyMap = useContext(KeymapContext);\n  const keymap = Object.assign(Object.create(parentKeyMap), keymapProp);\n  return (\n    <KeymapContext.Provider value={keymap}>{children}</KeymapContext.Provider>\n  );\n};\n\nexport const useKeymap = () => useContext(KeymapContext);\n","type ShortcutType = \"mouse\" | \"keyboard\";\nexport type KeyStrokeModifier = \"Alt\" | \"Shift\" | \"Meta\" | \"Control\";\n\nexport interface KeyStroke {\n  /**\n   * {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key}\n   */\n  code: string;\n  modifiers?: Array<KeyStrokeModifier>;\n}\n\ninterface ShortcutBase {\n  type: ShortcutType;\n}\n\ninterface MouseShortcut extends ShortcutBase {\n  type: \"mouse\";\n}\n\nexport interface KeyboardShortcut extends ShortcutBase {\n  type: \"keyboard\";\n  firstKeyStroke: KeyStroke;\n  secondKeyStroke?: KeyStroke;\n}\n\nexport type Shortcut = MouseShortcut | KeyboardShortcut;\n\nexport const isKeyboardShortcut = (\n  shortcut: Shortcut\n): shortcut is KeyboardShortcut => shortcut.type === \"keyboard\";\n\nexport const supportedModifiers: KeyStrokeModifier[] = [\n  \"Alt\",\n  \"Meta\",\n  \"Shift\",\n  \"Control\",\n];\n","import React from \"react\";\nimport { useAction } from \"@intellij-platform/core/ActionSystem/ActionsProvider\";\nimport {\n  IconButton,\n  IconButtonProps,\n} from \"@intellij-platform/core/IconButton\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport const ActionButton = ({\n  actionId,\n  children,\n  ...otherProps\n}: {\n  actionId: string;\n  /**\n   * Content to show instead of `action.icon`.\n   */\n  children?: React.ReactNode;\n} & IconButtonProps): JSX.Element => {\n  const action = useAction(actionId);\n  if (!action) {\n    return <></>;\n  }\n  const actionButton = (\n    <IconButton\n      isDisabled={action.isDisabled}\n      aria-label={action.title}\n      {...otherProps}\n      onPress={(e) => {\n        action?.perform();\n        otherProps.onPress?.(e);\n      }}\n    >\n      {children || action.icon}\n    </IconButton>\n  );\n  if (action.title) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={action.title} shortcut={action.shortcut} />\n        }\n      >\n        {actionButton}\n      </TooltipTrigger>\n    );\n  }\n  return actionButton;\n};\n","import React from \"react\";\nimport { type ActionGroup } from \"@intellij-platform/core/ActionSystem/ActionGroup\";\nimport { type ActionMenuProps, ActionsMenu } from \"./ActionsMenu\";\n\nexport type ActionGroupMenuProps = Omit<ActionMenuProps, \"actions\"> & {\n  actionGroup: ActionGroup;\n};\n/**\n * Renders children of an action group as a menu.\n */\nexport const ActionGroupMenu = ({\n  actionGroup,\n  ...props\n}: ActionGroupMenuProps) => {\n  return (\n    <ActionsMenu\n      aria-label={actionGroup.title}\n      actions={actionGroup.children}\n      {...props}\n    />\n  );\n};\n","import React from \"react\";\nimport { flatten } from \"ramda\";\nimport { Menu, MenuItemLayout, MenuProps } from \"@intellij-platform/core/Menu\";\nimport { Divider, Item, Section } from \"@intellij-platform/core/Collections\";\nimport { DividerItem } from \"@intellij-platform/core/Collections/Divider\"; // Importing from /Collections breaks the build for some reason\nimport { type ActionGroup } from \"@intellij-platform/core/ActionSystem/ActionGroup\";\nimport {\n  type Action,\n  ActionContext,\n} from \"@intellij-platform/core/ActionSystem/Action\";\n\ntype ActionGroupAsMenuItem = Pick<\n  ActionGroup,\n  \"id\" | \"icon\" | \"title\" | \"isDisabled\" | \"children\" | \"menuPresentation\"\n>;\nexport type ActionItem = ActionGroupAsMenuItem | Action | DividerItem;\n\nfunction isAction(item: ActionItem): item is Action {\n  return \"perform\" in item;\n}\n\ntype ControlledMenuProps = Pick<\n  MenuProps<ActionItem>,\n  \"onAction\" | \"disabledKeys\" | \"items\" | \"children\"\n>;\ntype RenderMenu = (props: ControlledMenuProps) => React.ReactNode;\nexport type ActionMenuProps = {\n  actions: Array<ActionItem>;\n\n  /**\n   * Context with which actions should be performed.\n   * Usually the context by which the ActionsMenu itself is opened.\n   * Pass a function for lazy evaluation when the action is selected from the menu.\n   */\n  actionContext?: ActionContext | (() => ActionContext);\n  /**\n   * Allows for rendering a custom menu component, e.g. {@link SpeedSearchMenu}.\n   * If not provided, {@link Menu} is rendered, receiving additional props that\n   * are passed to `ActionsMenu`.\n   * If it is provided, additional {@link Menu} props are not allowed, and they\n   * can be passed directly to the returned menu element.\n   */\n  children?: RenderMenu;\n} & (\n  | {\n      children: RenderMenu;\n    }\n  | (Omit<MenuProps<ActionItem>, keyof ControlledMenuProps> & {\n      children?: never;\n    })\n);\n/**\n * Given a nested list of resolved actions, renders a menu corresponding to them.\n */\nexport function ActionsMenu({\n  actions,\n  actionContext,\n  children = (actionMenuProps) => <Menu {...actionMenuProps} />,\n  ...otherProps\n}: ActionMenuProps) {\n  const allActions = getAllActions(actions);\n  const disabledKeys = allActions\n    .filter(({ isDisabled }) => isDisabled)\n    .map(({ id }) => id);\n\n  return (\n    <>\n      {children({\n        ...otherProps,\n        onAction: (key) => {\n          const action = allActions.find(({ id }) => id === key);\n          if (action && isAction(action)) {\n            action.perform(\n              typeof actionContext === \"function\"\n                ? actionContext?.()\n                : actionContext\n            );\n          }\n        },\n        disabledKeys,\n        // FIXME: keep isSelected on actions (toggle action) and control selectedKeys too?\n        items: actions,\n        children: (action) => {\n          if (action instanceof DividerItem) {\n            return <Divider />;\n          }\n          return renderActionAsMenuItem(action);\n        },\n      })}\n    </>\n  );\n}\n\ntype ActionAsMenuItem = Omit<Action, \"perform\" | \"shortcuts\">;\n\nexport function renderActionAsMenuItem(\n  action: ActionAsMenuItem | ActionGroupAsMenuItem | DividerItem\n) {\n  const isGroup = \"children\" in action;\n  if (\n    isGroup &&\n    (action.menuPresentation === \"section\" ||\n      action.menuPresentation === \"titledSection\")\n  ) {\n    return (\n      <Section\n        key={action.id}\n        // @ts-expect-error: hasDivider is not yet made a public API.\n        hasDivider\n        aria-label={\n          action.menuPresentation === \"section\" ? action.title : undefined\n        }\n        title={\n          action.menuPresentation === \"titledSection\" ? action.title : undefined\n        }\n        items={action.children}\n      >\n        {renderActionAsMenuItem}\n      </Section>\n    );\n  }\n  if (action instanceof DividerItem) {\n    return <Divider />;\n  }\n  return (\n    <Item\n      key={action.id}\n      textValue={action.title}\n      aria-label={action.title}\n      childItems={\n        isGroup && action.menuPresentation === \"submenu\"\n          ? action.children\n          : undefined\n      }\n    >\n      <MenuItemLayout\n        content={action.title}\n        icon={action.icon}\n        shortcut={\"shortcut\" in action ? action.shortcut : undefined}\n      />\n    </Item>\n  );\n}\n\nfunction getAllActions(items: ActionItem[]): Action[] {\n  return flatten(\n    items.map((item) =>\n      [item].concat(\"children\" in item ? getAllActions(item.children) : [])\n    )\n  ).filter(isAction);\n}\n","import { flatten } from \"ramda\";\nimport React from \"react\";\nimport { Popup, usePopupManager } from \"@intellij-platform/core/Popup\";\nimport { SpeedSearchMenu } from \"@intellij-platform/core/Menu\";\nimport { MENU_POSITION_TARGET_DATA_ATTRIBUTE } from \"@intellij-platform/core/Menu/ContextMenuContainer\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  type ActionGroupDefinition,\n  isActionGroupDefinition,\n  useGetActionShortcut,\n} from \"@intellij-platform/core/ActionSystem\";\n\nimport { renderActionAsMenuItem } from \"./ActionsMenu\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\n\nexport const useCreateDefaultActionGroup = () => {\n  const { show } = usePopupManager();\n  const getActionShortcut = useGetActionShortcut();\n  const openActionsInPopup = useEventCallback(\n    (\n      { children, title }: Pick<ActionGroupDefinition, \"children\" | \"title\">,\n      context: ActionContext\n    ) => {\n      show(({ close }) => (\n        <Popup\n          // Maybe an option to conditionally use context-based positioning?\n          positioning={\n            context.element instanceof HTMLElement\n              ? {\n                  targetRef: {\n                    current:\n                      context.element.querySelector(\n                        `[${MENU_POSITION_TARGET_DATA_ATTRIBUTE}]`\n                      ) ?? context.element,\n                  },\n                  placement: \"bottom\",\n                }\n              : undefined\n          }\n        >\n          <Popup.Layout\n            content={\n              /**\n               * NOTE: It would be much nicer to use {@link ActionGroupMenu} component here. But the action group is not\n               * yet provided when the group definition is being created. It seems like a sign of bad design that needs\n               * to get addressed.\n               */\n              <SpeedSearchMenu\n                aria-label={title}\n                items={children.map((item) =>\n                  item === \"divider\" ? new DividerItem() : item\n                )}\n                onAction={(key) => {\n                  // The need for calculating `allActions` is a consequence of the issue explained in the note above.\n                  const allActions = flatten(\n                    children.map((item) =>\n                      item !== \"divider\" && isActionGroupDefinition(item)\n                        ? item.children\n                        : item\n                    )\n                  );\n                  const action = allActions.find(\n                    (action): action is ActionDefinition =>\n                      typeof action === \"object\" && action.id === key\n                  );\n                  if (action && !action.isDisabled) {\n                    action.actionPerformed(context);\n                  }\n                }}\n                onClose={close}\n                autoFocus=\"first\"\n              >\n                {(item) =>\n                  renderActionAsMenuItem(\n                    item instanceof DividerItem\n                      ? item\n                      : {\n                          ...item,\n                          // a consequence of the issue explained in the note above.\n                          shortcut: getActionShortcut(item.id),\n                        }\n                  )\n                }\n              </SpeedSearchMenu>\n            }\n            header={title}\n          />\n        </Popup>\n      ));\n    }\n  );\n\n  return (\n    groupDefinition: Omit<ActionGroupDefinition, \"actionPerformed\">\n  ): ActionGroupDefinition => {\n    return {\n      menuPresentation: \"submenu\",\n      ...groupDefinition,\n      actionPerformed: (context) =>\n        openActionsInPopup(groupDefinition, context),\n    };\n  };\n};\n","import {\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  // For some reason importing from shorter paths doesn't work as expected in cypress ¯\\_(ツ)_/¯\n  // Weirdly, `import *` works in that case.\n} from \"@intellij-platform/core/ToolWindowsImpl/ToolWindowActionIds\";\n\nimport { Keymap } from \"./KeymapProvider\";\nimport { CommonActionId } from \"./CommonActionIds\";\n\n// TODO: OS specific defaults\n// TODO: extract and export action ids\n// NOTE: defaultKeymap doesn't belong to ActionSystem semantically. Would be something to be moved to a separate module\n/**\n * Default Intellij Idea keymapping for common action ids, including tool window actions.\n * @see CommonActionId\n */\nexport const defaultKeymap: Keymap = {\n  [RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowRight\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_LEFT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowLeft\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_TOP_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowUp\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowDown\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [MAXIMIZE_TOOL_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Quote\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [FOCUS_EDITOR_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n      },\n    },\n  ],\n  [HIDE_ACTIVE_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n        modifiers: [\"Shift\"],\n      },\n    },\n  ],\n  [HIDE_ALL_WINDOWS_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [JUMP_TO_LAST_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowUp\",\n      },\n    },\n  ],\n  [CommonActionId.SHRINK_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n  ],\n  [CommonActionId.COLLAPSE_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [CommonActionId.GO_TO_ACTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [CommonActionId.SHOW_INTENTION_ACTIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"Enter\",\n      },\n    },\n  ],\n  [CommonActionId.GO_TO_FILE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyO\",\n      },\n    },\n  ],\n  [CommonActionId.EDIT_SOURCE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"ArrowDown\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F4\",\n      },\n    },\n  ],\n  [CommonActionId.SHOW_SEARCH_HISTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n  [CommonActionId.COPY_REFERENCE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\", \"Alt\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [CommonActionId.REFRESH]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyR\",\n      },\n    },\n  ],\n  [CommonActionId.DELETE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\",\n      },\n    },\n  ],\n  [CommonActionId.COPY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [CommonActionId.CUT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyX\",\n      },\n    },\n  ],\n  [CommonActionId.PASTE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyV\",\n      },\n    },\n  ],\n  [CommonActionId.CODE_COMPLETION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Control\"],\n        code: \"Space\",\n      },\n    },\n  ],\n};\n","import { fromPairs } from \"ramda\";\nimport { isMac } from \"@react-aria/utils\";\nimport {\n  isKeyboardShortcut,\n  KeyStroke,\n  KeyStrokeModifier,\n  Shortcut,\n} from \"./Shortcut\";\nimport {\n  KeyboardEventKey,\n  LinuxDeadKeys,\n  NumericKeypadKeys,\n  UpperAlpha,\n} from \"./KeyboardEventKey\";\n\nconst defaultKeyToStr: {\n  [key in Exclude<\n    KeyStrokeModifier | KeyboardEventKey,\n    LinuxDeadKeys | UpperAlpha | NumericKeypadKeys\n  >]: string;\n} = {\n  Control: \"Ctrl\",\n  \" \": \"Space\",\n  ArrowDown: \"↓\",\n  ArrowUp: \"↑\",\n  ArrowLeft: \"←\",\n  ArrowRight: \"→\",\n  Enter: \"⏎\",\n  Quote: \"'\",\n  Minus: \"-\",\n  Subtract: \"-\",\n  NumpadAdd: \"+\",\n  Multiply: \"*\",\n  NumpadMultiply: \"*\",\n  Equal: \"+\",\n  Backspace: \"⌫\",\n  // lowercase to uppercase map\n  ...fromPairs(\n    Array.from(Array(26))\n      .map((e, i) => i + \"a\".charCodeAt(0))\n      .map((x) => String.fromCharCode(x))\n      .map((a) => [a, a.toUpperCase()])\n  ),\n};\nconst KeystrokeToString: {\n  separator: string;\n  codeToStr: Record<KeyStrokeModifier | KeyboardEventKey, string>;\n} = isMac()\n  ? {\n      separator: \"\",\n      codeToStr: {\n        ...defaultKeyToStr,\n        Alt: \"⌥\",\n        Shift: \"⇧\",\n        Meta: \"⌘\",\n        Control: \"^\",\n        Escape: \"⎋\",\n      },\n    }\n  : {\n      separator: \"+\",\n      codeToStr: defaultKeyToStr,\n    };\n\nconst modifiersOrder: KeyStrokeModifier[] = [\"Control\", \"Alt\", \"Shift\", \"Meta\"];\nexport const keystrokeToString = (keystroke: KeyStroke) => {\n  return [\n    ...(keystroke.modifiers || []).sort(\n      (a, b) => modifiersOrder.indexOf(a) - modifiersOrder.indexOf(b)\n    ),\n    keystroke.code,\n  ]\n    .map((code) => KeystrokeToString.codeToStr[code] || code)\n    .map((code) => code.replace(/^(Key|Digit|Numpad)(.)$/, \"$2\"))\n    .join(KeystrokeToString.separator);\n};\nexport const shortcutToString = (shortcut: Shortcut) => {\n  if (isKeyboardShortcut(shortcut)) {\n    return [shortcut.firstKeyStroke, shortcut.secondKeyStroke]\n      .filter((i): i is KeyStroke => i != undefined)\n      .map(keystrokeToString)\n      .join(\", \");\n  }\n  throw new Error(\"Not implemented yet\");\n};\n","import { useAction } from \"./ActionsProvider\";\nimport { isResolvedActionGroup, ResolvedActionGroup } from \"./ActionGroup\";\n\nexport const useActionGroup = (\n  actionGroupId: string\n): ResolvedActionGroup | null => {\n  const action = useAction(actionGroupId);\n  if (action) {\n    if (isResolvedActionGroup(action)) {\n      return action;\n    }\n    throw new Error(`Action with id ${actionGroupId} is not a group`);\n  }\n  return null;\n};\n","import React from \"react\";\nimport {\n  ModalWindow,\n  ModalWindowProps,\n} from \"@intellij-platform/core/ModalWindow\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\nimport { styled } from \"../styled\";\nimport { StyledWindowContainer } from \"@intellij-platform/core/ModalWindow/ModalWindow\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { ButtonGroup } from \"@intellij-platform/core/ButtonGroup\";\nimport { isEventOnEmptySpaces } from \"@intellij-platform/core/utils/interaction-utils/useMove\";\n\nexport interface AlertDialogProps\n  extends Pick<ModalWindowProps, \"minWidth\" | \"id\" | \"onClose\"> {\n  /**\n   * Content slot for the heading, aka. title of the dialog. Typically plain text.\n   */\n  heading?: React.ReactNode;\n  /**\n   * Content slot for the body, aka. message of the dialog. Typically plain text.\n   */\n  body?: React.ReactNode;\n  /**\n   * Content slot for the checkbox (\"Do not ask again\").\n   * @example\n   * ```jsx\n   * <AlertDialog checkbox={<Checkbox>Do not ask again</Checkbox>} />\n   * ```\n   * @see Checkbox\n   */\n  checkbox?: React.ReactNode;\n\n  /**\n   * Type of the alert dialog. The icon is set based on type.\n   */\n  type?: \"error\" | \"warning\" | \"information\" | \"question\";\n\n  /**\n   * Content slot for buttons.\n   * @example\n   * ```jsx\n   * <AlertDialog\n   *   buttons={\n   *     <>\n   *       <Button>Cancel</Button>\n   *       <Button variant=\"default\">Ok</Button>\n   *     </>\n   *   }\n   * />\n   * ```\n   * @see Button\n   */\n  buttons?: React.ReactNode;\n\n  /**\n   * Content slot for help icon button in the footer.\n   * @example\n   * ```jsx\n   * <AlertDialog\n   *   helpButton={\n   *     <TooltipTrigger tooltip={<HelpTooltip helpText=\"Show Help Contents\" />}>\n   *       <Button variant=\"icon\">\n   *         <PlatformIcon icon=\"actions/help\"></PlatformIcon>\n   *       </Button>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   * @see Button\n   */\n  helpButton?: React.ReactNode;\n}\n\nconst StyledModalWindow = styled(ModalWindow)`\n  ${StyledWindowContainer} {\n    border-radius: 0;\n    outline: 0.5px solid rgba(0, 0, 0, 0.85); // FIXME\n  }\n`;\n\nconst StyledContainer = styled.div`\n  padding: 1.25rem;\n  display: grid;\n  grid-template-columns: auto 1fr;\n  grid-template-rows: auto auto;\n  align-items: center;\n  gap: 0.875rem;\n`;\n\nconst StyledHeading = styled.h2`\n  margin: 0;\n  font-size: 0.875rem;\n  line-height: 1.25rem;\n  font-weight: bold;\n`;\n\nconst StyledBody = styled.div`\n  line-height: 1.2;\n`;\n\nconst StyledContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  cursor: default;\n`;\n\nconst StyledCheckbox = styled.div`\n  padding: 0.375rem 0;\n  // to align the checkbox with the content, since the box has a padding. Maybe Checkbox should not have any padding.\n  margin-left: -0.25rem;\n`;\n\nconst StyledButtons = styled(ButtonGroup)`\n  display: flex;\n  justify-self: end;\n  gap: 1rem;\n`;\n\nconst StyledIcon = styled.span`\n  align-self: start;\n`;\n\nconst StyledHelpIcon = styled.div`\n  justify-self: center;\n`;\n\n/**\n * A modal dialog implementing [Alert](https://jetbrains.github.io/ui/controls/alert), which is the\n * [notification](https://jetbrains.github.io/ui/controls/notifications/) pattern for use cases where\n * immediate user action is required.\n * Since the use cases are quite specific, and the component is expected to be used with pretty specific\n * content items, the layout is not implemented as a separate component, the way it is in components like\n * {@link ModalWindow} or {@link Menu}\n *\n *\n */\nexport const AlertDialog = ({\n  type = \"question\",\n  heading,\n  body,\n  checkbox,\n  helpButton,\n  buttons,\n  minWidth = 370,\n  ...otherProps\n}: AlertDialogProps): JSX.Element => {\n  return (\n    <StyledModalWindow\n      role=\"alertdialog\"\n      interactions=\"move\"\n      minWidth={minWidth}\n      defaultBounds={{\n        top: window.innerHeight / 4,\n      }}\n      // Reacting to content size, to make sure the content will be visible, considering the window is not resizable.\n      observeContentResize\n      {...otherProps}\n    >\n      <OverlayMoveHandle dragThreshold={6} canMoveStart={isEventOnEmptySpaces}>\n        {({ moveHandleProps }) => (\n          <StyledContainer {...moveHandleProps}>\n            <StyledIcon>\n              {/* Icon name is theme-able in the reference impl via OptionPane[`${icon}Icon`] */}\n              <PlatformIcon size={32} icon={`general/${type}Dialog`} />\n            </StyledIcon>\n            <StyledContent>\n              <StyledHeading>{heading}</StyledHeading>\n              <StyledBody>{body}</StyledBody>\n              {checkbox && <StyledCheckbox>{checkbox}</StyledCheckbox>}\n            </StyledContent>\n            <StyledHelpIcon>{helpButton}</StyledHelpIcon>\n            <StyledButtons>{buttons}</StyledButtons>\n          </StyledContainer>\n        )}\n      </OverlayMoveHandle>\n    </StyledModalWindow>\n  );\n};\n","import React, { ReactNode } from \"react\";\nimport { useWindowManager } from \"@intellij-platform/core/ModalWindow\";\nimport { Button } from \"@intellij-platform/core/Button\";\n\nimport { AlertDialog } from \"./AlertDialog\";\n\nexport interface AlertDialogApi {\n  confirm(options: {\n    title: ReactNode;\n    message: ReactNode;\n    okText?: string;\n    cancelText?: string;\n  }): Promise<boolean>;\n}\n\n/**\n * Similar to com.intellij.openapi.ui.Messages class in the reference impl, provides helper functions\n * to show different types of Alert dialog. The helper functions return a Promise of the selected option,\n * which makes it easy to use it imperatively, in a flow of statements, regardless of how the UI of the\n * alert dialog is handled.\n * {@link useAlertDialog} depends on {@link WindowManager}, to imperatively open modal windows.\n * @experimental\n */\nexport function useAlertDialog(): AlertDialogApi {\n  const { open } = useWindowManager();\n  return {\n    confirm: ({ title, message, okText = \"Ok\", cancelText = \"Cancel\" }) =>\n      new Promise((resolve) => {\n        open(({ close }) => (\n          <AlertDialog\n            type=\"question\"\n            body={message}\n            heading={title}\n            buttons={\n              <>\n                <Button onPress={close}>{cancelText}</Button>\n                <Button\n                  variant=\"default\"\n                  onPress={() => {\n                    resolve(true);\n                    close();\n                  }}\n                >\n                  {okText}\n                </Button>\n              </>\n            }\n            onClose={() => resolve(false)}\n          />\n        ));\n      }),\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nconst CORNER_RADIUS = 12; // it used to be 8. After introduction of Notifications tool window, it's 12\n\nconst bgColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\n    \"Notification.background\",\n    !theme.dark ? \"rgb(242,242,242)\" : \"#4E5052\"\n  );\n\nexport const StyledHeaderActions = styled.div`\n  position: absolute;\n  right: 0;\n  top: 0;\n  background: inherit;\n  padding: 0.375rem 0.5rem 0;\n  &::before {\n    content: \"\";\n    position: absolute;\n    right: 100%;\n    background: linear-gradient(90deg, transparent, ${bgColor});\n    width: 20px;\n    height: 100%;\n    z-index: 1;\n    top: 0;\n  }\n`;\n\nexport const StyledBalloonContainer = styled.div`\n  line-height: 1.2;\n  box-sizing: border-box;\n  overflow: hidden; // header actions overflows a little at the top right rounded corner\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); // shadow doesn't seem to be themed\n  padding: 0.5rem 0;\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"Notification.borderColor\",\n        !theme.dark ? \"#B2B2B2CD\" : \"#565A5CCD\"\n      )};\n  border-radius: ${({ theme }) =>\n    `${\n      (theme.value<number>(\n        \"Notification.arc\" as UnknownThemeProp<\"Notification.arc\">\n      ) ?? CORNER_RADIUS) / 2\n    }px`};\n  //display: inline-flex;\n  width: 23.3125rem;\n  position: relative;\n  background-color: ${bgColor};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Notification.foreground\",\n      !theme.dark ? \"#000\" : \"rgb(191,191,191)\"\n    )};\n\n  ${StyledHeaderActions} {\n    display: none;\n  }\n  &:hover ${StyledHeaderActions} {\n    display: initial;\n  }\n`;\n\nexport const StyledIconContainer = styled.span`\n  position: absolute;\n  left: 0.75rem;\n  top: 0.5rem;\n`;\n\nexport const StyledBalloonHeader = styled.div`\n  line-height: 1rem;\n  font-weight: bold;\n  margin: 0 2.125rem 0.25rem;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis; // this is not the case in original impl, but it's a clear improvement\n`;\n\nexport const StyledBalloonBody = styled.div<{\n  lineClamp: number | false;\n}>`\n  margin: 0 2.125rem 0 2.125rem;\n  line-height: 1rem;\n  display: inline;\n  -webkit-line-clamp: ${({ lineClamp }) => lineClamp};\n  word-break: ${({ lineClamp }) => lineClamp === 1 && \"break-all\"};\n  text-overflow: ellipsis;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  word-wrap: break-word;\n`;\n\nexport const StyledBalloonFooter = styled.div`\n  margin: 0.375rem 1.875rem 0 2.125rem;\n  display: inline-flex;\n  white-space: nowrap;\n  overflow: hidden;\n  gap: 1rem;\n\n  // could be -webkit-fill-available too, if it has good support. Probably it doesn't tho\n  max-width: calc(100% - 3.5rem);\n`;\n\nexport const StyledToggleIconContainer = styled.span`\n  display: inline-flex;\n  position: absolute;\n  right: 0.5rem;\n  bottom: 0;\n  background-color: ${bgColor};\n  padding-left: 0.5rem;\n`;\n\nexport const StyledToggleExpandButtonContainer = styled.span`\n  display: block;\n  position: relative; // for icon absolute positioning\n  cursor: pointer;\n  flex: 1;\n`;\n\nexport const StyledToggleExpandButtonFooterContainer = styled(\n  StyledToggleExpandButtonContainer\n)`\n  min-height: 1.5rem;\n  margin: -0.5rem 0;\n  position: relative;\n  z-index: 1;\n  ${StyledToggleIconContainer} {\n    bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter} {\n    margin-top: 0.875rem;\n    margin-bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter}:hover + * .icon[data-hover] {\n    display: none;\n  }\n  ${StyledBalloonFooter}:hover + * .icon {\n    display: unset;\n  }\n`;\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\nimport { IconProps } from \"@intellij-platform/core/Icon/IconProps\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  StyledBalloonBody,\n  StyledBalloonContainer,\n  StyledBalloonFooter,\n  StyledBalloonHeader,\n  StyledHeaderActions,\n  StyledIconContainer,\n  StyledToggleExpandButtonContainer,\n  StyledToggleExpandButtonFooterContainer,\n  StyledToggleIconContainer,\n} from \"@intellij-platform/core/Balloon/Balloon.styled\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { Link } from \"@intellij-platform/core/Link\";\n\nexport type BalloonProps = ControlledStateProps<{ expanded: boolean }> &\n  DOMProps & {\n    /**\n     * Icon rendered in the top left\n     */\n    icon?: \"Info\" | \"Warning\" | \"Error\" | React.ReactElement<IconProps>;\n    /**\n     * Rendered beside close button. Can be used for rendering a \"notification settings\" icon button.\n     */\n    headerActions?: React.ReactNode;\n    /**\n     * Called when the close button is clicked. If not passed, close button will not be rendered.\n     */\n    onClose?: () => void;\n    /**\n     * Actions rendered in the footer.\n     */\n    actions?: React.ReactNode;\n  } & (\n    | {\n        title?: React.ReactNode;\n        body: React.ReactNode;\n      }\n    | {\n        title: React.ReactNode;\n        body?: React.ReactNode;\n      }\n  );\n\ntype BalloonContextObj = {\n  onClose?: () => void;\n};\nconst BalloonContext = React.createContext<BalloonContextObj | null>(null);\n\n/**\n * A tiny wrapper around {@link Link} component, to be used for actions in Balloon.\n * It closes the balloon when pressed.\n */\nexport const BalloonActionLink: typeof Link = React.forwardRef(\n  ({ onPress, ...props }, ref) => {\n    const context = useContext(BalloonContext);\n    if (context === null) {\n      throw new Error(\n        \"BalloonActionLink should only be rendered inside Balloon notifications\"\n      );\n    }\n    return (\n      <Link\n        ref={ref}\n        {...props}\n        onPress={(...args) => {\n          context?.onClose?.();\n          return onPress?.(...args);\n        }}\n      />\n    );\n  }\n);\n/**\n * [Balloon notification](https://jetbrains.github.io/ui/controls/balloon/) UI.\n *\n * Notes and TODO:\n * - Add support for \"error\" variant: https://github.com/JetBrains/intellij-community/blob/48c024fcd38bd8d1eccdada05489a8952a494270/platform/platform-impl/src/com/intellij/diagnostic/IdeMessagePanel.java#L215\n * - Add support for timeout. Although if the auto close behaviour is only timeout-based, maybe there is not much value in adding a prop for it and calling onClose on timeout.\n * - BalloonActions component to be used for rendering a bunch of links in the actions. It should encapsulate the\n *   behaviour of moving actions into a menu when there is not enough room.\n */\nexport const Balloon = ({\n  icon: iconProp = \"Info\",\n  expanded: expandedProp,\n  defaultExpanded = false,\n  onExpandedChange,\n  title,\n  headerActions,\n  onClose,\n  body,\n  actions,\n  ...containerProps\n}: BalloonProps): React.ReactElement => {\n  const bodyRef = useRef<HTMLDivElement>(null);\n  const [expandable, setExpandable] = useState(false);\n  const [expanded, setExpanded] = useControlledState(\n    expandedProp!,\n    defaultExpanded,\n    onExpandedChange!\n  );\n  const maxLinesWhenNotExpanded = 1 + (title ? 0 : 1) + (actions ? 0 : 1);\n\n  useEffect(() => {\n    const bodyElem = bodyRef.current;\n    if (bodyElem) {\n      setExpandable(\n        expanded\n          ? getNumLines(bodyElem) > maxLinesWhenNotExpanded\n          : bodyElem.scrollHeight > bodyElem.clientHeight\n      );\n    } else {\n      setExpandable(false);\n    }\n  }, [expanded]);\n  const validIconTypes = [\"Error\", \"Warning\", \"Info\"] as const;\n  const icon =\n    typeof iconProp === \"string\" ? (\n      <PlatformIcon\n        icon={`general/notification${validIconTypes.find(\n          (iconType, index, arr) =>\n            iconType === iconProp || index === arr.length - 1\n        )}.svg`}\n      />\n    ) : (\n      iconProp\n    );\n  // @ts-expect-error support for callback updater is removed from useControlledState. https://github.com/adobe/react-spectrum/issues/2320\n  const toggle = () => setExpanded((expanded) => !expanded);\n\n  const effectiveExpanded = expanded && Boolean(body);\n\n  return (\n    <BalloonContext.Provider value={{ onClose }}>\n      <StyledBalloonContainer data-testid=\"balloon\" {...containerProps}>\n        <StyledIconContainer>{icon}</StyledIconContainer>\n        {title && <StyledBalloonHeader>{title}</StyledBalloonHeader>}\n        <StyledHeaderActions>\n          {headerActions}\n          {onClose && (\n            <AutoHoverPlatformIcon\n              icon=\"ide/notification/close.svg\"\n              onClick={onClose}\n              role=\"button\"\n              data-testid=\"close-btn\"\n              style={{ marginLeft: \"0.75rem\" }}\n            />\n          )}\n        </StyledHeaderActions>\n        {body && (\n          <ToggleWrapper\n            expanded={effectiveExpanded}\n            enabled={expandable && !effectiveExpanded}\n            onToggle={toggle}\n          >\n            <StyledBalloonBody\n              lineClamp={!effectiveExpanded && maxLinesWhenNotExpanded}\n              ref={bodyRef}\n            >\n              {body}\n            </StyledBalloonBody>\n          </ToggleWrapper>\n        )}\n        <ToggleWrapper\n          expanded={effectiveExpanded}\n          enabled={expandable && effectiveExpanded}\n          onToggle={toggle}\n          Component={StyledToggleExpandButtonFooterContainer}\n        >\n          {actions && (\n            <StyledBalloonFooter onClick={(e) => e.stopPropagation()}>\n              {actions}\n            </StyledBalloonFooter>\n          )}\n        </ToggleWrapper>\n      </StyledBalloonContainer>\n    </BalloonContext.Provider>\n  );\n};\n\n/**\n * If enabled wraps its children in a clickable area (with the expand/collapse arrow),f for toggling expanded state.\n */\nconst ToggleWrapper: React.FC<{\n  children?: React.ReactNode;\n  enabled: boolean;\n  expanded: boolean;\n  Component?: typeof StyledToggleExpandButtonContainer;\n  onToggle: () => void;\n}> = ({\n  children,\n  onToggle,\n  expanded,\n  enabled,\n  Component = StyledToggleExpandButtonContainer,\n}) => {\n  const iconName = expanded ? \"collapse\" : \"expand\";\n  const toggleIcon = (\n    <StyledToggleIconContainer>\n      <AutoHoverPlatformIcon\n        hoverContainerSelector={`${Component}`}\n        icon={`ide/notification/${iconName}.svg`}\n        className=\"icon\"\n      />\n    </StyledToggleIconContainer>\n  );\n\n  return enabled ? (\n    <Component\n      onClick={onToggle}\n      role=\"button\"\n      data-testid={`${expanded ? \"collapse\" : \"expand\"}-btn`}\n    >\n      {children}\n      {toggleIcon}\n    </Component>\n  ) : (\n    <>{children}</>\n  );\n};\n\n/**\n * Based on the computed line-height and clientHeight of the element, returns the number of lines of the content.\n */\nfunction getNumLines(bodyElem: Element) {\n  return (\n    bodyElem.clientHeight / parseFloat(getComputedStyle(bodyElem).lineHeight)\n  );\n}\n","import React, {\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Balloon, BalloonProps } from \"./Balloon\";\nimport { StyledBalloonsStack } from \"./StyledBalloonsStack\";\n\ntype ShowProps = Pick<\n  BalloonProps,\n  \"title\" | \"icon\" | \"body\" | \"actions\" | \"headerActions\"\n>;\n\nexport interface BalloonManagerAPI {\n  /**\n   * Shows a Balloon notification on the bottom left of the screen.\n   * @param props: Props to pass to the Balloon component\n   * @param [autoHideTimeout=10_000] timeout in ms for hiding the balloon notification.\n   * @returns hide function, in case the notification can expire for some reason.\n   */\n  show(props: ShowProps, autoHideTimeout?: number): () => void;\n  showSticky(props: ShowProps): () => void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\"You must render a BalloonManager...\");\n};\n\nconst BalloonsContext = React.createContext<BalloonManagerAPI>({\n  show: NotImplementedFn,\n  showSticky: NotImplementedFn,\n});\n\nexport const useBalloonManager = (): BalloonManagerAPI =>\n  useContext(BalloonsContext);\n\ntype BalloonElement = ReactElement<BalloonProps, typeof Balloon>;\n\nexport interface BalloonManagerProps {\n  disablePortal?: boolean;\n  BalloonsContainer?: React.ElementType;\n  children?: React.ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link useBalloonManager}) for showing Balloon notifications on the bottom right of the screen.\n * It renders notifications in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n * @param disablePortal: if `true`, the container for notifications will not be rendered in a portal\n * @param BalloonsContainer: container component for the notifications. It's {@link StyledBalloonsStack} by default.\n *\n * TODO: fade in/out transition. Notes:\n *  - Doesn't seem fade-in is needed. Tho it's much easier than fade-out, as it can be achieved with a css animation.\n *  - Fade out should happen only when the balloon is being hidden by timeout.\n * TODO: Support for maximum number of notifications and showing \"x more notification(s)\" button if the limit exceeds\n */\n\nexport const BalloonManager: React.FC<BalloonManagerProps> = ({\n  children,\n  disablePortal,\n  BalloonsContainer = StyledBalloonsStack,\n}) => {\n  const [balloons, setBalloons] = useState<Array<BalloonElement>>([]);\n  const timeoutIdsRef = useRef<number[]>([]);\n  const lastIdRef = useRef<number>(0);\n\n  const api = useMemo<BalloonManagerAPI>(() => {\n    const show: BalloonManagerAPI[\"show\"] = (props, timeout = 10_000) => {\n      lastIdRef.current++;\n      const onClose = () => {\n        setBalloons((balloons) =>\n          balloons.filter((aBalloon) => aBalloon !== balloon)\n        );\n      };\n      const balloon = (\n        <Balloon\n          key={lastIdRef.current}\n          {...props}\n          title={props.title} // TS acts unreasonable without this\n          onClose={onClose}\n        />\n      );\n      setBalloons((balloons) => {\n        if (timeout > 0) {\n          const timeoutId = window.setTimeout(() => {\n            onClose();\n            timeoutIdsRef.current = timeoutIdsRef.current.filter(\n              (aTimeoutId) => aTimeoutId !== timeoutId\n            );\n          }, timeout);\n          timeoutIdsRef.current = [...timeoutIdsRef.current, timeoutId];\n        }\n        return balloons.concat(balloon);\n      });\n      return onClose;\n    };\n    return {\n      show,\n      showSticky: (props) => show(props, 0),\n    };\n  }, []);\n\n  // clear timeouts when unmounted\n  useEffect(() => {\n    return () => {\n      timeoutIdsRef.current.forEach((id) => {\n        window.clearTimeout(id);\n      });\n    };\n  }, []);\n\n  const notificationsStack = (\n    <BalloonsContainer\n      style={{ position: disablePortal ? \"absolute\" : undefined }}\n    >\n      {balloons}\n    </BalloonsContainer>\n  );\n\n  return (\n    <BalloonsContext.Provider value={api}>\n      {children}\n      {disablePortal\n        ? notificationsStack\n        : ReactDOM.createPortal(notificationsStack, document.body)}\n    </BalloonsContext.Provider>\n  );\n};\n","import styled from \"styled-components\";\nimport { StyledBalloonContainer } from \"@intellij-platform/core/Balloon/Balloon.styled\";\n\n/**\n * Container component for stacking a number of Balloons in an overlay placed on the bottom right of where it's rendered.\n */\nexport const StyledBalloonsStack = styled.div`\n  position: fixed;\n  z-index: 1;\n  bottom: 42px;\n  right: 26px;\n  ${StyledBalloonContainer} {\n    margin-bottom: 12px;\n  }\n`;\n","import React, { ForwardedRef, JSXElementConstructor } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  AriaBaseButtonProps,\n  AriaButtonProps,\n  ButtonProps,\n} from \"@react-types/button\";\n\nexport interface BareButtonProps extends AriaBaseButtonProps, ButtonProps {\n  children: React.ReactElement;\n  elementType?: AriaButtonProps[\"elementType\"];\n\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n}\n\n/**\n * A component to make arbitrary content an accessible button which is also able to be a tooltip trigger.\n */\nexport const BareButton = React.forwardRef(function BareButton(\n  { elementType: elementTypeProp, ...props }: BareButtonProps,\n  forwardedRef: ForwardedRef<HTMLElement>\n) {\n  const elementType =\n    elementTypeProp ||\n    (React.isValidElement(props.children) &&\n    typeof props.children.type === \"string\"\n      ? (props.children.type as unknown as JSXElementConstructor<unknown>)\n      : undefined) ||\n    \"button\";\n  const ref = useObjectRef(forwardedRef);\n  const { buttonProps } = useButton(\n    {\n      elementType,\n      ...props,\n    },\n    ref\n  );\n  const domProps = filterDOMProps(props);\n  const { autoFocus } = props;\n\n  return React.cloneElement(\n    props.children,\n    mergeProps(domProps, buttonProps, { autoFocus, ref })\n  );\n});\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport const StyledButton = styled.button<{ disabled?: boolean }>`\n  box-sizing: border-box;\n  min-width: 4.5rem; // https://jetbrains.github.io/ui/controls/button/#28\n  padding: 0 0.875rem; // https://jetbrains.github.io/ui/controls/button/#28\n  height: 1.5rem;\n  font-family: inherit;\n  background-color: ${({ theme, disabled }) =>\n    disabled ? \"transparent\" : theme.color(\"Button.startBackground\")};\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"Button.disabledText\")\n      : theme.color(\n          \"Button.foreground\" as UnknownThemeProp<\"Button.foreground\">\n        )};\n  border: 1px solid\n    ${({ theme, disabled }) =>\n      disabled\n        ? theme.color(\"Button.disabledBorderColor\")\n        : theme.color(\"Button.startBorderColor\")};\n  border-radius: ${({ theme }) =>\n    (theme.value<number>(\"Button.arc\") ?? 6) / 2}px;\n  box-shadow: ${({ theme }) =>\n    theme.value(\"Button.paintShadow\")\n      ? `0 0 0 ${theme.value(\"Button.shadowWidth\") ?? 2}px ${\n          theme.color(\"Button.shadowColor\") ?? // Button.darcula.shadowColor default is skipped.\n          (theme.dark ? \"#36363680\" : \"#a6a6a633\")\n        }`\n      : \"\"};\n  white-space: nowrap; // https://jetbrains.github.io/ui/controls/button/#29\n\n  flex-shrink: 0; // button should not shrink when rendered in a flex container\n\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.focusedBorderColor\", \"#87afda\")};\n    outline: none;\n    box-shadow: ${({ theme }) =>\n      `0 0 0 2px ${\n        // NOTE: by not using the second argument for default value, we prioritize *.focusColor over the rest.\n        theme.color(\"Component.focusColor\") ??\n        theme.color(\n          \"Focus.borderColor\" as UnknownThemeProp<\"Focus.borderColor\">,\n          \"#8ab2eb\"\n        )\n      }`};\n  }\n`;\nexport const StyledDefaultButton = styled(StyledButton)`\n  background-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBackground\", \"#384f6b\")};\n  color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.foreground\")};\n  border-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBorderColor\", \"#BFBFBF\")};\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.default.focusedBorderColor\", \"#87afda\")};\n  }\n`;\n\nexport const StyledIconButton = styled(StyledButton)`\n  border-radius: 1000px;\n  padding: 0;\n  line-height: 0;\n  min-width: 0;\n  height: 1.5rem;\n  width: 1.5rem;\n`;\n","import React, {\n  ButtonHTMLAttributes,\n  CSSProperties,\n  ForwardedRef,\n} from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { AriaButtonProps } from \"@react-types/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  StyledButton,\n  StyledDefaultButton,\n  StyledIconButton,\n} from \"@intellij-platform/core/Button/StyledButton\";\nimport { MnemonicTrigger } from \"@intellij-platform/core/Mnemonic\";\nimport { PressEvent } from \"@react-types/shared/src/events\";\n\ntype ButtonVariant = \"default\" | \"icon\";\nexport interface ButtonProps extends AriaButtonProps {\n  variant?: ButtonVariant; // can allow for custom (styled) component too if needed.\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  // Should this be become true by default? Maybe an context-based API to set defaults like this for a section?\n  preventFocusOnPress?: boolean;\n\n  form?: ButtonHTMLAttributes<HTMLButtonElement>[\"form\"];\n  style?: CSSProperties;\n  /**\n   * A character to be used as {@link https://jetbrains.design/intellij/principles/mnemonics/ mnemonic} for the button\n   * It will be shown as underlined in button text, when mnemonic is activated (by pressing Alt)\n   * Note: if you use mnemonic, and the direct child of the button is not a string, you should use `MnemonicText`\n   * to render the button text, to have the underlining behavior.\n   */\n  mnemonic?: string;\n  className?: string;\n\n  /**\n   * Called when the button is pressed, or triggered via mnemonic. If mnemonic is used, there won't be any event\n   * passed to onPress callback.\n   */\n  onPress?: (e?: PressEvent) => void;\n}\n\nconst variants: { [key in ButtonVariant]: typeof StyledButton } = {\n  default: StyledDefaultButton,\n  icon: StyledIconButton,\n};\n\n/**\n * https://jetbrains.github.io/ui/controls/button/\n *\n * TODO:\n * - Support for \"default\" button behaviour. it's kind of similar to a <button type=\"submit\" /> in html, but textarea\n * behaviour is different from what is explained here: https://jetbrains.github.io/ui/controls/button/#16\n * Cmd+Enter should always trigger onPress. Plus, maybe it should work independent of \"form\" being used? or maybe it's\n * not a big deal to expect an ancestor \"form\" element, when variant is \"default\"?\n * - \"Default\" style differences in Windows.\n * - Gradient colors (low hanging fruit, but negligible added value).\n *\n * Known issues:\n * - In the original impl, default button looks the same as normal button, when focus is not within the same area that\n * the button is. For example in the commit tool window, \"Commit\" button which is default, is not blue, unless the\n * \"Commit\" tool window is focused. This particular case can easily be achieved by conditionally setting variant to,\n * \"default\" based on tool window focus state, which is accessible via useDefaultToolWindowContext(), if\n * DefaultToolWindow is used. But we need to see if the same requirement exists in various places.\n * NOTE: this item is related to the first item in the to-do list above. There can be a container kind of component,\n * which enables \"default\" behaviour and look. Maybe it can be FocusScope or at least related to FocusScope.\n * - In the original impl, there is no visual clue for pressed state, which is poor accessibility. For now, the same\n * behaviour is followed here too. But we may reconsider deviating from the original impl for an improvement here.\n *\n */\nexport const Button: React.FC<ButtonProps> = React.forwardRef(function Button(\n  { variant, style, className, mnemonic, ...props }: ButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const { buttonProps } = useButton(props, ref);\n  const domProps = filterDOMProps(props);\n  const { autoFocus, form } = props;\n\n  const Component = (variant && variants[variant]) || StyledButton;\n  return (\n    <Component\n      {...mergeProps(domProps, buttonProps, { autoFocus, form })}\n      style={style}\n      className={className}\n      ref={ref}\n    >\n      {mnemonic ? (\n        <MnemonicTrigger\n          mnemonic={mnemonic}\n          isDisabled={props.isDisabled}\n          onTriggered={props.onPress}\n        >\n          {props.children}\n        </MnemonicTrigger>\n      ) : (\n        props.children\n      )}\n    </Component>\n  );\n});\n","import React, { CSSProperties, ReactNode } from \"react\";\nimport { DOMAttributes, FocusableElement } from \"@react-types/shared\";\nimport { FocusScope, useFocusManager } from \"@react-aria/focus\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport interface ButtonGroupProps {\n  children: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n}\n\nconst StyledButtonGroup = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 0.75rem;\n`;\n\n/**\n * `ButtonGroup` should be used as a wrapper around related {@link Button Buttons}, in places such as the\n * footer of a dialog. It does two things:\n * - allows for moving the focus between the buttons with left/right arrow keys.\n * - applies the right spacing between the buttons\n *\n * @see Button\n */\nexport function ButtonGroup(props: ButtonGroupProps) {\n  return (\n    <FocusScope>\n      <HorizontalArrowKeyNavigation>\n        {(arrowKeyNavigationProps) => (\n          <StyledButtonGroup {...mergeProps(props, arrowKeyNavigationProps)} />\n        )}\n      </HorizontalArrowKeyNavigation>\n    </FocusScope>\n  );\n}\n\nfunction HorizontalArrowKeyNavigation({\n  children,\n}: {\n  children: (props: DOMAttributes<FocusableElement>) => ReactNode;\n}) {\n  const focusManager = useFocusManager();\n  const { keyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (!hasAnyModifier(e)) {\n        if (e.key === \"ArrowLeft\") {\n          return focusManager?.focusPrevious({ wrap: true });\n        } else if (e.key === \"ArrowRight\") {\n          return focusManager?.focusNext({ wrap: true });\n        }\n      }\n      e.continuePropagation();\n    },\n  });\n\n  return <>{children(keyboardProps)}</>;\n}\n","import React, { HTMLProps, ReactNode } from \"react\";\nimport { useToggleState } from \"@react-stately/toggle\";\nimport { useCheckbox } from \"@react-aria/checkbox\";\nimport {\n  AriaLabelingProps,\n  FocusableDOMProps,\n  FocusableProps,\n  InputBase,\n} from \"@react-types/shared\";\nimport { useFocusRing } from \"@react-aria/focus\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { CheckboxIcon } from \"./CheckboxIcon\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { MnemonicTrigger } from \"@intellij-platform/core/Mnemonic\";\n\nexport interface CheckboxProps\n  extends InputBase,\n    FocusableDOMProps,\n    AriaLabelingProps,\n    FocusableProps {\n  /**\n   * If set to true, the checkbox won't be focusable.\n   * Common use cases:\n   * - When checkbox is rendered in a focusable container, like a list item where the focus should not be taken away\n   *   from that container.\n   * - \"Amend\" checkbox in \"Commit\" tool window. The focus is kept in the commit message or changes tree, perhaps, for\n   *   a questionably better UX.\n   * Note: Passing {@link excludeFromTabOrder} will still let the checkbox be focusable, while `preventFocus`, doesn't\n   * let the component get focused at all.\n   * TODO(potential): it might be nicer to have a `preventFocusOnPress` prop consistent with IconButton, instead.\n   *  In that case preventing focus completely would be achieved with `preventFocusOnPres` and `excludeFromTabOrder`.\n   */\n  preventFocus?: boolean;\n\n  /**\n   * By default, focus ring is always shown when the checkbox is focused, independent of the interaction method.\n   * if set to false, the focus will be only visible if the interaction is done via keyboard or screen readers.\n   * Similar to how [:focus-visible](https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible) works.\n   */\n  disableFocusAlwaysVisible?: boolean;\n\n  /**\n   * Indeterminism is presentational only.\n   * The indeterminate visual representation remains regardless of user interaction.\n   */\n  isIndeterminate?: boolean;\n\n  /**\n   * The label for the element.\n   */\n  children?: ReactNode;\n\n  /**\n   * Whether the element should be selected (uncontrolled).\n   */\n  defaultSelected?: boolean;\n  /**\n   * Whether the element should be selected (controlled).\n   */\n  isSelected?: boolean;\n  /**\n   * Handler that is called when the element's selection state changes.\n   */\n  onChange?: (isSelected: boolean) => void;\n  /**\n   * The value of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefvalue).\n   */\n  value?: string;\n  /**\n   * The name of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefname).\n   */\n  name?: string;\n\n  className?: string; // to support styled-components\n\n  /**\n   * A character to be used as {@link https://jetbrains.design/intellij/principles/mnemonics/ mnemonic} for the button\n   * It will be shown as underlined in button text, when mnemonic is activated (by pressing Alt)\n   * Note: if you use mnemonic, and the direct child of the button is not a string, you should use `Mnemonic.Text`\n   * to render the button text, to have the underlining behavior.\n   */\n  mnemonic?: string;\n}\n\nconst StyledWrapperLabel = styled.label`\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst StyledCheckboxLabelText = styled.span<{\n  isDisabled: boolean | undefined;\n}>`\n  margin-left: 0.25rem;\n  color: ${({ theme, isDisabled }) =>\n    isDisabled\n      ? theme.color(\n          \"CheckBox.disabledText\" as UnknownThemeProp<\"CheckBox.disabledText\">,\n          \"#808080\" /* this default value was a bit tricky. Still not clear from where it comes in darcular \n          theme when there is no clue of Checkbox.disabledText or *.disabledText. Note that using \n          CheckBox.disabledForeground is not a good option, because it's something other than #808080 for darcula */\n        )\n      : theme.color(\"*.foreground\")};\n`;\n\nconst StyledInput = styled.input`\n  opacity: 0.0001;\n  position: absolute;\n  z-index: 1;\n  inset: 0;\n  cursor: default;\n  &:disabled {\n    cursor: default;\n  }\n`;\n\n/**\n * Checkbox component to be used with or without a label.\n *\n * While the checkbox without the label + preventFocus makes it usable in tree/list, it might be more optimized to\n * use a more lightweight component like ListItemCheckbox, which uses CheckboxIcon with a simple press handle. Without\n * any input, state, etc.\n */\nexport const Checkbox = ({\n  preventFocus,\n  className,\n  disableFocusAlwaysVisible,\n  mnemonic,\n  ...props\n}: CheckboxProps) => {\n  const state = useToggleState(props);\n  const ref = React.useRef<HTMLInputElement>(null);\n  const { inputProps } = useCheckbox(props, state, ref);\n\n  const { isFocusVisible, isFocused, focusProps } = useFocusRing({\n    autoFocus: props.autoFocus,\n  });\n\n  const focusDisabledProps: Pick<\n    HTMLProps<HTMLInputElement>,\n    \"onFocusCapture\" | \"tabIndex\"\n  > = preventFocus\n    ? {\n        onFocusCapture: (event) => {\n          event.stopPropagation();\n          event.preventDefault();\n          if (event.relatedTarget instanceof HTMLElement) {\n            event.relatedTarget.focus();\n          } else {\n            event.target.blur();\n          }\n        },\n        tabIndex: -1,\n      }\n    : {};\n\n  return (\n    <StyledWrapperLabel className={className}>\n      <StyledInput\n        {...mergeProps(inputProps, focusProps, focusDisabledProps)}\n        ref={ref}\n      />\n      <CheckboxIcon\n        isIndeterminate={props.isIndeterminate}\n        isFocused={disableFocusAlwaysVisible ? isFocusVisible : isFocused}\n        isSelected={props.isIndeterminate || state.isSelected}\n        isDisabled={props.isDisabled}\n        aria-hidden=\"true\"\n        style={{\n          pointerEvents: \"none\",\n        }}\n      />\n      {props.children && (\n        <StyledCheckboxLabelText isDisabled={props.isDisabled}>\n          {mnemonic ? (\n            <MnemonicTrigger\n              mnemonic={mnemonic}\n              isDisabled={props.isDisabled}\n              onTriggered={state.toggle}\n            >\n              {props.children}\n            </MnemonicTrigger>\n          ) : (\n            props.children\n          )}\n        </StyledCheckboxLabelText>\n      )}\n    </StyledWrapperLabel>\n  );\n};\n","import React, { ComponentProps } from \"react\";\nimport { LafIcon } from \"@intellij-platform/core/Icon\";\n\n/**\n * Renders checkbox UI in different states (focused, selected, indeterminate, etc.), without having anything to do\n * with the interactions\n */\nexport const CheckboxIcon = ({\n  isDisabled,\n  isFocused,\n  isIndeterminate,\n  isSelected,\n  ...otherProps\n}: Omit<ComponentProps<typeof LafIcon>, \"size\" | \"icon\"> & {\n  isIndeterminate: boolean | undefined;\n  isFocused: boolean;\n  isDisabled: boolean | undefined;\n  isSelected: boolean;\n}) => {\n  return (\n    <LafIcon\n      {...otherProps}\n      size={20}\n      icon={{\n        name: isIndeterminate ? \"checkBoxIndeterminate\" : \"checkBox\",\n        modifiers: {\n          Disabled: isDisabled,\n          Selected: isSelected || isIndeterminate,\n          Focused: isFocused,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { CollectionSpeedSearchMatches } from \"./useCollectionSpeedSearchResult\";\n\nexport type CollectionSpeedSearchContextValue = {\n  matches: CollectionSpeedSearchMatches;\n  collection: Collection<Node<unknown>>;\n};\n\nexport const CollectionSpeedSearchContext =\n  React.createContext<CollectionSpeedSearchContextValue | null>(null);\n","import React, { Key, useContext } from \"react\";\nimport { TextWithHighlights } from \"@intellij-platform/core/TextWithHighlights/TextWithHighlights\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch/CollectionSpeedSearchContext\";\n\ntype CollectionSpeedSearchItemContextValue = {\n  text: string;\n  highlightedRanges: null | TextRange[];\n};\n\nconst CollectionSpeedSearchItemContext =\n  React.createContext<null | CollectionSpeedSearchItemContextValue>(null);\n\nexport const SpeedSearchItemHighlightsProvider: React.FC<{\n  children?: React.ReactNode;\n  itemKey: Key;\n}> = ({ children, itemKey }) => {\n  const context = useContext(CollectionSpeedSearchContext);\n  if (!context) {\n    throw new Error(\n      `SpeedSearchItemProvider is only meant to be rendered by collection components with speed search. \n      CollectionSpeedSearchContext is expected to be rendered as a wrapper around all items.`\n    );\n  }\n  const item = context.collection.getItem(itemKey);\n  const text = item?.textValue ?? \"\";\n  if (!text && item?.props.textValue === undefined) {\n    console.warn(\n      \"no textValue specified on Item. When using SpeedSearch, you need to specify textValue for item, which will be the basis for search\"\n    );\n  }\n  return (\n    <CollectionSpeedSearchItemContext.Provider\n      value={{\n        highlightedRanges: context.matches.get(itemKey) || null,\n        text: text,\n      }}\n    >\n      {children}\n    </CollectionSpeedSearchItemContext.Provider>\n  );\n};\n\n/**\n * Used inside Item content, to render the textValue of the Item, potentially with highlighted ranges if it's a match\n * in current search.\n */\nexport const HighlightedTextValue = function ({\n  Component = \"span\",\n}: {\n  /**\n   * When rendering in a flex parent (which is the case for tree or list), rendering a container is necessary to have\n   * the right spacing around highlights, when the highlighter span is immediately followed or proceeded by a white\n   * space. By default, a \"span\" is rendered.\n   */\n  Component?: React.ElementType;\n}) {\n  const speedSearchContext = React.useContext(CollectionSpeedSearchItemContext);\n  if (!speedSearchContext) {\n    throw new Error(\n      \"HighlightedTextValue should be rendered only in items of a speed search enabled collection component\"\n    );\n  }\n  const { highlightedRanges, text } = speedSearchContext;\n  return (\n    <Component>\n      {highlightedRanges ? (\n        <TextWithHighlights highlights={highlightedRanges}>\n          {text}\n        </TextWithHighlights>\n      ) : (\n        text\n      )}\n    </Component>\n  );\n};\n","import { Key, useEffect, useMemo } from \"react\";\nimport { minusculeMatch } from \"../minusculeMatch\";\nimport { SpeedSearchState } from \"../SpeedSearch/useSpeedSearch\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { createSpeedSearchSelectionManager } from \"./createSpeedSearchSelectionManager\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nexport type CollectionSpeedSearchMatches = Map<Key, TextRange[]>;\n\nexport function useCollectionSpeedSearchResult<T>({\n  collection,\n  selectionManager: inputSelectionManager,\n  speedSearch,\n  focusBestMatch = false,\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  speedSearch: SpeedSearchState;\n  /**\n   * If true, focusing the best match (the longest \"start-with\" match) will be preferred.\n   * By default, the focus is moved to the first match that comes after the currently focused item, if currently\n   * focused item itself is not a match.\n   * A typical use case would be collections that filter out non-match items.\n   * @default false\n   */\n  focusBestMatch?: boolean;\n}) {\n  const { searchTerm, active } = speedSearch;\n\n  /**\n   * Note: when a component is implemented using react-aria's useCollection, any re-render of that component causes\n   * a new collection. That's because prop.children is normally an inline function, and therefore the collection is\n   * re-created: https://github.com/adobe/react-spectrum/blob/4a1cff846018e449487ccf54d7474bdfa4d4f57c/packages/@react-stately/collections/src/useCollection.ts#L29\n   * This means we will unnecessarily perform the search in such cases. it might be a non-issue, but if it turned out\n   * to be an issue, a sub-optimum improvement would be to use `collection.size` as a dependency instead of `collection`,\n   * assuming that searchable text in collections won't change, and assuming that the important changes (search-wise)\n   * will usually involve a size change in the collection.\n   */\n  const { matches } = useMemo(() => {\n    const matches: CollectionSpeedSearchMatches = new Map(); // maybe make it nullable makes more sense\n    if (speedSearch.active) {\n      // it's important not to iterate on items, since they can be nested.\n      [...collection.getKeys()]\n        .map((key) => collection.getItem(key)!)\n        .filter(({ type }) => type === \"item\")\n        .forEach((item) => {\n          const matchedRanges = minusculeMatch(item.textValue, searchTerm);\n          if (matchedRanges) {\n            matches.set(item.key, matchedRanges);\n          }\n        });\n    }\n\n    return {\n      matches,\n    };\n  }, [searchTerm, collection, active]);\n\n  const selectionManager = createSpeedSearchSelectionManager(\n    inputSelectionManager,\n    active ? matches : null\n  );\n  const latestValues = useLatest({\n    matches,\n    selectionManager,\n    collection,\n    focusBestMatch,\n  });\n\n  // On every query change, if the current selection doesn't include any of the matched items, move selection to the\n  // first matched item.\n  useEffect(() => {\n    const { selectionManager, matches, collection } = latestValues.current;\n    const matchedKeys = [...matches.keys()];\n    const noneOfTheMatchesAreSelected = !matchedKeys.some((matchedKey) =>\n      selectionManager.isSelected(matchedKey)\n    );\n    let keyToFocus: Key | undefined;\n    if (latestValues.current.focusBestMatch) {\n      keyToFocus = getLongestCommonPrefixMatch(matches);\n    }\n    if (!keyToFocus && matchedKeys.length > 0 && noneOfTheMatchesAreSelected) {\n      keyToFocus = getMatchToSelect({\n        collection,\n        selectionManager,\n        matchedKeys,\n      });\n    }\n    if (keyToFocus) {\n      selectionManager.setFocusedKey(keyToFocus);\n      selectionManager.replaceSelection(keyToFocus);\n    }\n  }, [\n    searchTerm,\n    latestValues /*it's a ref object, so no harm in listing it here to comply with rules of hooks*/,\n  ]);\n  return {\n    matches,\n    selectionManager,\n  };\n}\n\n/**\n * given a non-empty array of matched keys, returns the one that should be selected\n */\nfunction getMatchToSelect({\n  collection,\n  selectionManager,\n  matchedKeys,\n}: {\n  collection: Collection<Node<unknown>>;\n  selectionManager: SelectionManager;\n  matchedKeys: Key[];\n}): Key {\n  let passedFirstSelection = false;\n  for (const key of collection.getKeys()) {\n    if (key === selectionManager.firstSelectedKey) {\n      passedFirstSelection = true;\n    }\n    if (passedFirstSelection && matchedKeys.includes(key)) {\n      return key;\n    }\n  }\n  return matchedKeys[0];\n}\n\n/**\n * Returns the longest match from the beginning, if exists.\n */\nfunction getLongestCommonPrefixMatch(matches: CollectionSpeedSearchMatches) {\n  return [...matches.entries()]\n    .filter(([, [firstRange]]) => firstRange?.from === 0)\n    .sort(\n      ([, [rangeA]], [, [rangeB]]) =>\n        rangeB.to - rangeB.from - rangeA.to - rangeA.from\n    )?.[0]?.[0];\n}\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { Key } from \"react\";\n\nexport function createSpeedSearchSelectionManager(\n  wrappedSelectionManager: SelectionManager,\n  matches: Map<Key, unknown /* We don't care what a match is here */> | null\n): SelectionManager {\n  return Object.create(wrappedSelectionManager, {\n    selectAll: {\n      value: () => {\n        if (matches) {\n          // @ts-expect-error: state is private and there is no API on SelectionManager for bulk\n          // setting selected keys (which would ideally check for not selecting disabled keys internally).\n          const state = wrappedSelectionManager.state;\n          state.setSelectedKeys(\n            new Set(\n              [...matches.keys()].filter((key) => !state.disabledKeys.has(key))\n            )\n          );\n        } else {\n          wrappedSelectionManager.selectAll();\n        }\n      },\n    },\n  });\n}\n","import { HTMLAttributes, RefObject, useMemo } from \"react\";\nimport { Collection, KeyboardDelegate, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport {\n  SpeedSearchPopupProps,\n  SpeedSearchProps,\n} from \"@intellij-platform/core/SpeedSearch\";\nimport {\n  SpeedSearchState,\n  SpeedSearchStateProps,\n  useSpeedSearch,\n  useSpeedSearchState,\n} from \"../SpeedSearch/useSpeedSearch\";\nimport { CollectionSpeedSearchContextValue } from \"./CollectionSpeedSearchContext\";\nimport {\n  CollectionSpeedSearchMatches,\n  useCollectionSpeedSearchResult,\n} from \"./useCollectionSpeedSearchResult\";\nimport { createSpeedSearchKeyboardDelegate } from \"./createSpeedSearchKeyboardDelegate\";\n\nexport interface CollectionSpeedSearch {\n  containerProps: HTMLAttributes<HTMLElement>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  speedSearch: SpeedSearchState & { matches: CollectionSpeedSearchMatches };\n  searchPopupProps: SpeedSearchPopupProps;\n  speedSearchContextValue: CollectionSpeedSearchContextValue;\n}\n\n/**\n * Given a `collection`, a `selectionManager` and a `keyboardDelegate`, it returns:\n * - `speedSearch`: search term, if speed search is active or not, and the matched keys\n * - `matches`: A Set of matched keys, or `null` if speed search is not active\n * - `containerProps`: The props you need to pass to the collection container element to enable\n * speedSearch on it.\n * - `selectionManager`: a selection manager in which select all is overridden to only select\n * matched items if speed search is active.\n * - `keyboardDelegate`: a keyboard delegate in which limits navigation to matched items, when\n * speed search is active.\n *\n * Speed search options, including the ones for optionally controlling the state of the speed search\n * are also accepted in inputs.\n */\nexport function useCollectionSpeedSearch<T>({\n  collection,\n  selectionManager,\n  keepSearchActiveOnBlur,\n  keyboardDelegate,\n  focusBestMatch,\n  ref,\n  ...speedSearchStateProps\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  ref: RefObject<HTMLElement>;\n  focusBestMatch?: boolean;\n} & SpeedSearchStateProps &\n  Pick<SpeedSearchProps, \"keepSearchActiveOnBlur\">): CollectionSpeedSearch {\n  const speedSearch = useSpeedSearchState(speedSearchStateProps);\n\n  const { matches, selectionManager: speedSearchSelectionManager } =\n    useCollectionSpeedSearchResult({\n      collection,\n      selectionManager,\n      speedSearch,\n      focusBestMatch,\n    });\n  const { containerProps } = useSpeedSearch(\n    { keepSearchActiveOnBlur },\n    speedSearch,\n    ref\n  );\n  const speedSearchKeyboardDelegate = useMemo(\n    () =>\n      createSpeedSearchKeyboardDelegate(\n        keyboardDelegate,\n        speedSearch.active ? matches : null\n      ),\n    [speedSearch.active, keyboardDelegate, matches]\n  );\n\n  // Doesn't seem necessary to wrap with useMemo, but can be rethink-ed\n  const speedSearchContextValue = { matches, collection };\n\n  return {\n    containerProps,\n    selectionManager: speedSearchSelectionManager,\n    keyboardDelegate: speedSearchKeyboardDelegate,\n    speedSearch: {\n      ...speedSearch,\n      matches,\n    },\n    searchPopupProps: {\n      active: speedSearch.active,\n      match: matches.size > 0,\n      children: speedSearch.searchTerm,\n    },\n    speedSearchContextValue,\n  };\n}\n","import React, { Key } from \"react\";\nimport { KeyboardDelegate } from \"@react-types/shared\";\n\n/**\n * Creates a new KeyboardDelegate in which keyKeyBelow and getKeyAbove are overridden in a way that\n * navigation is limited to matched items.\n * Note: select all action is not handled in KeyboardDelegate.\n * Note: when virtualization is added, this probably need to change, like how it's handled\n * in `useListBoxLayout` in react spectrum.\n */\nexport function createSpeedSearchKeyboardDelegate(\n  wrappedKeyboardDelegate: KeyboardDelegate,\n  matches: Map<Key, unknown /*We don't care what a match is, here*/> | null\n): KeyboardDelegate {\n  // TODO: page up and down deactivate speed search. If we want that, we can pass the speedSearch\n  //  object too. but doesn't seem like the best way to do it, even it the same behavior is expected\n  const findFirstMatch = <T extends React.Key | undefined, K>(\n    fromKey: React.Key | undefined | null,\n    direction: \"up\" | \"down\"\n  ) => {\n    let currentKey: React.Key | undefined | null = fromKey;\n    while (currentKey != null) {\n      if (!matches || matches.has(currentKey)) {\n        return currentKey;\n      }\n      currentKey =\n        direction === \"up\"\n          ? wrappedKeyboardDelegate.getKeyAbove?.(currentKey)\n          : wrappedKeyboardDelegate.getKeyBelow?.(currentKey);\n    }\n    return currentKey ?? undefined;\n  };\n  return Object.create(wrappedKeyboardDelegate, {\n    getKeyBelow: {\n      value: (key) =>\n        findFirstMatch(wrappedKeyboardDelegate.getKeyBelow?.(key), \"down\"),\n    },\n    getKeyAbove: {\n      value: (key) =>\n        findFirstMatch(wrappedKeyboardDelegate.getKeyAbove?.(key), \"up\"),\n    },\n    getFirstKey: {\n      value: (key?: React.Key, global?: boolean): React.Key | null => {\n        const firstKey = findFirstMatch(\n          wrappedKeyboardDelegate.getFirstKey?.(key, global),\n          \"down\"\n        );\n        return firstKey == null ? matches?.values().next().value : firstKey;\n      },\n    },\n    getLastKey: {\n      value: (key?: React.Key, global?: boolean): React.Key | null => {\n        const lastKey = findFirstMatch(\n          wrappedKeyboardDelegate.getLastKey?.(key, global),\n          \"down\"\n        );\n        return lastKey == null\n          ? [...(matches?.keys() || [])].pop() ?? null\n          : lastKey;\n      },\n    },\n  } as { [key in keyof KeyboardDelegate]: { value: KeyboardDelegate[key] } });\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { PartialNode } from \"@react-stately/collections\";\n\ninterface DividerProps {}\n\n/**\n * To be used in dynamic collections, just to provide a key and make it easy to check in the render\n * function to figure out what to render (an Item or a Divider)\n */\nexport class DividerItem {\n  private static seq = 0;\n  key = \"divider_\" + DividerItem.seq++;\n  get id() {\n    return this.key;\n  }\n}\n\nfunction Divider({}: DividerProps): ReactElement {\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  return null as any;\n}\n// We don't want getCollectionNode to show up in the type definition\nlet _Divider = Divider as (props: DividerProps) => JSX.Element;\nexport { _Divider as Divider };\n\nDivider.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>\n): Generator<PartialNode<T>> {\n  let rendered = null;\n\n  yield {\n    type: \"divider\",\n    element: null as any, // to prevent check on key, which is not necessary for divider\n    props: props,\n    rendered,\n    hasChildNodes: false,\n  };\n};\n","import React, { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { Item as StatelyItem, PartialNode } from \"@react-stately/collections\";\n\n// noinspection JSUnusedLocalSymbols\n/**\n * Item for collection components, which by default disables caching, unless `invalidated` prop is set to false on the\n * context passed to useCollection. Control over cache invalidation policy can be enabled by using\n * `useCollectionCacheInvalidation` for creating such context object.\n */\nfunction Item<T>(props: ItemProps<T>): ReactElement {\n  return null as any as React.ReactElement;\n}\n\nexport type CacheInvalidationContext = { invalidated?: boolean };\n\n// We don't want getCollectionNode to show up in the type definition\nlet _Item = Item as <T>(props: ItemProps<T>) => JSX.Element;\nexport { _Item as Item };\n\n/**\n * @private @preapproved\n */\nItem.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: CacheInvalidationContext\n): Generator<PartialNode<T>> {\n  const itemGenerator: Generator<PartialNode<T>> = (\n    StatelyItem as any\n  ).getCollectionNode(props, context);\n  const result = itemGenerator.next().value;\n  const originalShouldInvalidate = result.shouldInvalidate;\n  result.shouldInvalidate = (context: CacheInvalidationContext) =>\n    originalShouldInvalidate?.(context) || context.invalidated;\n  yield result;\n};\n","import React from \"react\";\nimport { styled } from \"../styled\";\nimport { DOMAttributes } from \"@react-types/shared\";\nimport { MENU_POSITION_TARGET_DATA_ATTRIBUTE } from \"@intellij-platform/core/Menu/ContextMenuContainer\";\n\nconst GAP = \"0.1875rem\";\nconst StyledItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  padding-right: 0.25rem;\n  gap: ${GAP};\n`;\n\nconst StyledHint = styled.span<{ small?: boolean }>`\n  display: inline-flex;\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n  padding-left: 0.1rem;\n  font-size: ${({ small }) => small && \"0.9em\"};\n`;\n\nconst StyledGroup = styled.span.attrs({\n  role: \"presentation\" as string,\n})`\n  display: inline-flex;\n  display: flex;\n  align-items: center;\n  gap: ${GAP};\n`;\n/**\n * Generic layout component capturing common use cases of tree or list items.\n * It handles the spacing between parts, and provides styled components for parts that need specific styling.\n * For more flexibility over the order of various pieces of content in list/tree items, there is no specific props\n * for parts. Different parts should just be rendered in children.\n *\n * @example\n * ```tsx\n * <ItemLayout>\n *   <PlatformIcon icon=\"nodes/folder\" />\n *   <HighlightedTextValue />\n *   <ItemLayout.Hint>~/workspace/jui</ItemLayout.Hint>\n * </ItemLayout>\n * ```\n * @beta\n */\nexport const ItemLayout = (\n  props: { children: React.ReactNode } & DOMAttributes\n) => {\n  return (\n    <StyledItemLayout\n      {...{ [MENU_POSITION_TARGET_DATA_ATTRIBUTE]: true }}\n      {...props}\n    />\n  );\n};\n\n/**\n * A more subtle text usually rendered next to the main text in the item.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Hint = StyledHint;\n\n/**\n * Useful when a number of items need to be grouped by a wrapper, e.g. to have a tooltip.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Group = StyledGroup;\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Generic state of items in collections, provided via a context.\n * To be used in Menu, Tree, or anything that deals with a collection of items for which the common states like\n * **disabled** or **selected** is applicable.\n */\nexport interface ItemStateContextType {\n  node: Node<unknown>;\n  isSelected: boolean;\n  isContainerFocused: boolean;\n  isDisabled: boolean;\n}\n\nexport const ItemStateContext =\n  React.createContext<ItemStateContextType | null>(null);\n","import { RefObject, useEffect } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { scrollIntoView } from \"@react-aria/utils\";\n\ntype CollectionAutoScrollProps = {\n  isVirtualized?: boolean;\n  selectionManager: SelectionManager;\n};\n\nexport function useCollectionAutoScroll(\n  { isVirtualized, selectionManager }: CollectionAutoScrollProps,\n  ref: RefObject<HTMLElement>\n) {\n  // If not virtualized, scroll the focused element into view when the focusedKey changes.\n  // When virtualized, Virtualizer handles this internally.\n  useEffect(() => {\n    if (!isVirtualized && selectionManager.focusedKey && ref?.current) {\n      let element = ref.current.querySelector(\n        `[data-key=\"${selectionManager.focusedKey}\"]`\n      ) as HTMLElement;\n      if (element) {\n        scrollIntoView(ref.current, element);\n      }\n    }\n  }, [isVirtualized, ref, selectionManager.focusedKey]);\n}\n","import { Key, RefObject, useEffect } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\n\n/**\n * interface to be extended by the props of collection components that support focus proxy.\n */\nexport interface CollectionFocusProxyProps {\n  /**\n   * ref to an element (typically HTMLInputElement) that should act as a focus\n   * proxy that handles ArrowUp, ArrowDown, and Enter keys to allow for\n   * navigating the collection and selecting items.\n   * Useful for implementing\n   * autocompletion or search input connected to a collection element.\n   */\n  focusProxyRef?: RefObject<HTMLElement>;\n}\n\n/**\n * A solution for connecting a collection to a search input so that the collection can still be navigated by keyboard\n * while the input is focused. It works by replaying certain keyboard events on the collection container and focused\n * item. An alternative approach (which is used in react-aria's useCombobox) is to use useSelectableCollection\n * separately for the input, but the biggest issue with that approach is that it's limiting in the following ways:\n * - Rendering input should be a part of the same component that renders the collection. Having specific components\n *   for use cases that require a search input is not flexible enough. For example, one may want to use SpeedSearchList\n *   or List connected to an input. Also, the input and the collection may need to be in different layouts in different\n *   use cases. Decoupling the rendering of the input and collection is a more flexible solution.\n * - The same options used for collection should be passed to the input field for behavior consistency, and that is\n *   prone to error.\n *   Some of these options, like `keyboardDelegate` can even have a default value in hooks like\n *   `useSelectableList`.\n *   It means making sure the same value is passed to the useSelectableCollection for input\n *   would require not using the default value, since the same value can't be accessed.\n *\n * With this event-forwarding approach, it's an arrow up or down event would behave exactly like it was triggered on\n * the collection itself, leaving no room for behavior discrepancies. But it has a few drawbacks:\n * - Although small, there is still some coupling between this code and implementation of the collection component.\n *   More specifically, this implementation assumes the following things:\n *   - \"Enter\" keys (selection or action) are handled on items, but arrow keys are handled on the collection element.\n *   - \"[data-key] attribute is set on items. That is used to find the element for the focused item (which, of course,\n *     is not actually focused while the input is).\n *\n * Note: there has been some addition to react-aria useSelectableCollection and useSelectableItem hooks\n * based on CustomEvent and a similar event reply mechanism in useAutocomplete.\n * It may be possible to replace this hook with built-in functionality in react-aria at some point.\n * But at the moment, it seems like that implementation is too coupled with the autocompletion use case, while\n * what is supported here is more generic and allows for the connected search input use case too.\n */\n\nexport const useCollectionFocusProxy = <T>({\n  state,\n  focusProxyRef,\n  collectionRef,\n  onAction,\n}: {\n  focusProxyRef: RefObject<HTMLElement> | undefined;\n  collectionRef: RefObject<HTMLElement>;\n  state: {\n    /** A collection of items in the list. */\n    collection: Collection<Node<T>>;\n    /** A selection manager to read and update multiple selection state. */\n    selectionManager: SelectionManager;\n  };\n  onAction: ((key: Key) => void) | undefined;\n}) => {\n  // TODO: focus/blur events should probably be handled as well, to keep the\n  //  isFocused state of the collection in sync.\n  useEffect(\n    () => {\n      const proxy = focusProxyRef?.current;\n      if (proxy) {\n        const onKeyDown = (event: KeyboardEvent) => {\n          if (event.key === \"ArrowUp\" || event.key === \"ArrowDown\") {\n            event.preventDefault();\n            event.stopPropagation();\n\n            collectionRef.current?.dispatchEvent(\n              new KeyboardEvent(event.type, event)\n            );\n          } else if (\n            event.key === \"Enter\" &&\n            state.selectionManager?.focusedKey != null\n          ) {\n            event.preventDefault(); // in forms, pressing Enter on input submits the form\n            (event.currentTarget as HTMLElement)?.addEventListener(\n              \"keyup\",\n              (event: KeyboardEvent) => {\n                console.log(\n                  \"Keyup\",\n                  event.key,\n                  state.selectionManager.focusedKey,\n                  \"onAction\",\n                  onAction\n                );\n                if (\n                  event.key === \"Enter\" &&\n                  state.selectionManager.focusedKey != null\n                ) {\n                  onAction?.(state.selectionManager.focusedKey);\n                }\n              },\n              { once: true, capture: true }\n            );\n          }\n        };\n        proxy.addEventListener(\"keydown\", onKeyDown);\n        return () => {\n          proxy.removeEventListener(\"keydown\", onKeyDown);\n        };\n      }\n    } /* with no dependency here, event listeners are reattached on each render, but that's the case when unmemoized\n    event handlers are passed to elements too (e.g., when using any react-aria hook) */\n  );\n};\n","import React, {\n  CSSProperties,\n  ForwardedRef,\n  forwardRef,\n  HTMLProps,\n  Ref,\n  useRef,\n} from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { AriaComboBoxProps, useComboBox } from \"@react-aria/combobox\";\nimport { useComboBoxState } from \"@react-stately/combobox\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { BareButton } from \"@intellij-platform/core/Button\";\nimport { Popover } from \"@intellij-platform/core/Overlay\";\nimport { StatelessListBox } from \"./StatelessListBox\";\nimport { StyledContainer } from \"./StyledContainer\";\nimport { LabelPlacement, WithLabel } from \"../Field/Label\";\nimport { StyledDropdownArrowIcon } from \"./StyledDropdownArrowIcon\";\nimport {\n  PositionedTooltipTrigger,\n  ValidationTooltip,\n} from \"@intellij-platform/core/Tooltip\";\nimport {\n  ContextHelpProps,\n  WithInlineContextHelp,\n} from \"@intellij-platform/core/Field/ContextHelp\";\n\ntype AriaProps<T> = {\n  [K in keyof T as K extends `aria-${string}` ? K : never]: T[K];\n};\n\nexport interface ComboBoxProps<T extends object>\n  extends Pick<\n      AriaComboBoxProps<T>,\n      | \"disabledKeys\"\n      | \"defaultSelectedKey\"\n      | \"selectedKey\"\n      | \"isDisabled\"\n      | \"children\"\n      | \"items\"\n      | \"label\"\n      | \"autoFocus\"\n      | \"menuTrigger\"\n      | \"placeholder\"\n      | \"onFocus\"\n      | \"onBlur\"\n      | \"onKeyDown\"\n      | \"onKeyUp\"\n      | \"onOpenChange\"\n      | \"onFocusChange\"\n      | \"onSelectionChange\"\n    >,\n    AriaProps<AriaComboBoxProps<T>>,\n    ControlledStateProps<{\n      value: string;\n    }>,\n    ContextHelpProps {\n  labelPlacement?: LabelPlacement;\n  className?: string;\n  style?: CSSProperties;\n\n  validationState?: \"valid\" | \"error\" | \"warning\";\n\n  /**\n   * Validation message shown as a {@link ValidationTooltip} above the component.\n   * {@link ValidationTooltipProps#type} is defined based on `validationState`.\n   */\n  validationMessage?: React.ReactNode;\n\n  /**\n   * props to apply on input, excluding value that's controlled by the component\n   */\n  inputProps?: Omit<\n    HTMLProps<HTMLInputElement>,\n    \"value\" | \"defaultValue\" | \"as\"\n  >;\n  inputRef?: Ref<HTMLInputElement>;\n}\n\nconst StyledComboBoxContainer = styled(StyledContainer)`\n  padding: 0;\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\n          \"TextField.disabledForeground\" as UnknownThemeProp<\"TextField.disabledForeground\">\n        )\n      : theme.color(\n          \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n        )};\n`;\nconst StyledComboBoxInput = styled.input`\n  flex: 1;\n  background: none;\n  border: none;\n  outline: none;\n  color: inherit;\n  padding: ${({ theme }) =>\n    theme.inset(\"ComboBox.padding\") ?? \"1px 6px 1px 6px\"};\n  height: 100%;\n`;\n\nconst StyledDropdownButton = styled.button`\n  // Resetting default styles\n  appearance: none;\n  border: none;\n  background: ${({ theme }) => theme.color(\"ComboBox.ArrowButton.background\")};\n  outline: none;\n  font: inherit;\n  padding: 0;\n\n  // Custom styles\n  border-left: 1px solid ${({ theme }) => theme.commonColors.border()};\n  height: 100%;\n  aspect-ratio: 1;\n  /**\n   * In the reference impl, the clickable area exceeds the left border by a\n   * few pixels. The following trick implements that\n   */\n  position: relative;\n  ::before {\n    content: \"\";\n    position: absolute;\n    left: -4px;\n    top: 0;\n    bottom: 0;\n    width: 4px;\n  }\n`;\n\n/**\n * [Combobox](https://plugins.jetbrains.com/docs/intellij/combo-box.html) implementation.\n * Known differences with the reference impl:\n * - selected key doesn't focus when opened the dropdown manually.\n *   Opening the dropdown by pressing ArrowDown does focus the previously selected item.\n */\nexport const ComboBox = forwardRef(\n  <T extends object>(\n    {\n      labelPlacement,\n      style,\n      className,\n      value,\n      defaultValue,\n      onValueChange,\n      validationState,\n      validationMessage,\n      contextHelp,\n      contextHelpPlacement,\n      inputProps,\n      inputRef: inputRefProp,\n      ...props\n    }: ComboBoxProps<T>,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ): React.JSX.Element => {\n    const ref = useObjectRef(forwardedRef);\n    const buttonRef = useRef<HTMLButtonElement>(null);\n    const inputRef = useObjectRef(inputRefProp);\n    const dropdownContainerRef = useRef<HTMLDivElement>(null);\n    const popoverRef = useRef<HTMLDivElement>(null);\n    const listBoxRef = useRef<HTMLDivElement>(null);\n    const isInvalid = Boolean(validationState) && validationState !== \"valid\";\n\n    const state = useComboBoxState({\n      // defaultFilter not provided based on how ComboBoxes don't filter based on input in Intellij Platform\n      // filtering can still be implemented by controlling `value` and `items`.\n      menuTrigger: \"manual\", // overridable via props\n      allowsCustomValue: true,\n      inputValue: value,\n      defaultInputValue: defaultValue,\n      onInputChange: onValueChange,\n      isInvalid,\n      ...props,\n    });\n    const {\n      descriptionProps,\n      errorMessageProps,\n      labelProps,\n      inputProps: comboboxInputProps,\n      listBoxProps,\n      buttonProps,\n    } = useComboBox(\n      {\n        ...props,\n        allowsCustomValue: true,\n        buttonRef,\n        inputRef,\n        popoverRef,\n        listBoxRef,\n      },\n      state\n    );\n\n    // minWidth is not kept in the state, assuming it's unnecessary, considering the width is expected to be\n    // stable when the popover opens.\n    const minWidth = dropdownContainerRef.current\n      ? dropdownContainerRef.current?.offsetWidth + 2 /* for box shadow*/\n      : undefined;\n    return (\n      <>\n        <WithLabel\n          ref={ref}\n          isDisabled={props.isDisabled}\n          label={props.label}\n          labelPlacement={labelPlacement}\n          labelProps={labelProps}\n          className={className}\n          style={style}\n        >\n          {/* probably no need for HiddenSelect as autofilling doesn't seem relevant for applications using this library */}\n          <WithInlineContextHelp\n            contextHelp={contextHelp}\n            contextHelpPlacement={contextHelpPlacement}\n            descriptionProps={descriptionProps}\n          >\n            <StyledComboBoxContainer\n              ref={dropdownContainerRef}\n              validationState={validationState}\n              disabled={props.isDisabled}\n              className={state.isFocused ? \"is-focus\" : \"\"}\n            >\n              {/* FIXME: tooltip comes and goes on mouse enter/leave, which is especially weird when trying to open options */}\n              <PositionedTooltipTrigger\n                placement=\"top\"\n                showOnFocus\n                isDisabled={!validationMessage}\n                triggerRef={inputRef}\n                tooltip={\n                  <ValidationTooltip\n                    type={\n                      validationState !== \"valid\" ? validationState : undefined\n                    }\n                  >\n                    <div {...errorMessageProps}>{validationMessage}</div>\n                  </ValidationTooltip>\n                }\n                delay={0}\n              >\n                {(tooltipTriggerProps) => (\n                  <StyledComboBoxInput\n                    {...mergeProps(\n                      comboboxInputProps,\n                      inputProps,\n                      tooltipTriggerProps\n                    )}\n                  />\n                )}\n              </PositionedTooltipTrigger>\n\n              <BareButton {...buttonProps} ref={buttonRef}>\n                <StyledDropdownButton>\n                  <StyledDropdownArrowIcon\n                    disabled={props.isDisabled}\n                    size={20}\n                    icon=\"general/arrowDown.svg\"\n                  />\n                </StyledDropdownButton>\n              </BareButton>\n            </StyledComboBoxContainer>\n          </WithInlineContextHelp>\n        </WithLabel>\n        {state.isOpen && (\n          <Popover\n            ref={popoverRef}\n            state={state}\n            triggerRef={dropdownContainerRef}\n            placement=\"bottom start\"\n            containerPadding={0}\n            offset={2}\n            crossOffset={-1}\n          >\n            <StatelessListBox\n              {...listBoxProps}\n              ref={listBoxRef}\n              state={state}\n              style={{ minWidth }}\n            />\n          </Popover>\n        )}\n      </>\n    );\n  }\n);\n","import React, { ForwardedRef } from \"react\";\nimport { AriaListBoxOptions, AriaListBoxProps } from \"@react-aria/listbox\";\nimport { useListState } from \"@react-stately/list\";\nimport { StatelessListBox } from \"@intellij-platform/core/Dropdown/StatelessListBox\";\nimport { CollectionFocusProxyProps } from \"@intellij-platform/core/Collections\";\n\nexport interface ListBoxProps<T extends object>\n  extends AriaListBoxProps<T>,\n    CollectionFocusProxyProps,\n    Pick<\n      AriaListBoxOptions<T>,\n      \"shouldFocusOnHover\" | \"shouldUseVirtualFocus\"\n    > {\n  minWidth?: number;\n}\n\nexport const ListBox = React.forwardRef(function ListBox<T extends object>(\n  { minWidth, ...props }: ListBoxProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const state = useListState({\n    selectionBehavior: \"toggle\",\n    selectionMode: \"single\",\n    ...props,\n  });\n\n  return <StatelessListBox state={state} ref={forwardedRef} {...props} />;\n});\n","import React, { CSSProperties, ForwardedRef } from \"react\";\nimport {\n  AriaListBoxOptions,\n  useListBox,\n  useListBoxSection,\n  useOption,\n} from \"@react-aria/listbox\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { ListState } from \"@react-stately/list\";\nimport { Node } from \"@react-types/shared\";\n\nimport {\n  CollectionFocusProxyProps,\n  ItemStateContext,\n  useCollectionFocusProxy,\n} from \"@intellij-platform/core/Collections\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { StyledList } from \"@intellij-platform/core/List/StyledList\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\ninterface StatelessListBoxProps<T extends object>\n  extends AriaListBoxOptions<T>,\n    CollectionFocusProxyProps {\n  state: ListState<T>;\n  style?: CSSProperties;\n  className?: string;\n}\n\nexport const StatelessListBox = React.forwardRef(function StatelessListBox<\n  T extends object\n>(\n  {\n    state,\n    style,\n    className,\n    focusProxyRef,\n    ...props\n  }: StatelessListBoxProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const { listBoxProps, labelProps } = useListBox(props, state, ref);\n\n  useCollectionFocusProxy({\n    state,\n    collectionRef: ref,\n    focusProxyRef,\n    onAction: props.onAction,\n  });\n\n  return (\n    <>\n      <div {...labelProps}>{props.label}</div>\n      <StyledList\n        {...listBoxProps}\n        ref={ref}\n        style={style}\n        className={className}\n      >\n        {[...state.collection].map((item) =>\n          item.type === \"section\" ? (\n            <ListBoxSection key={item.key} section={item} state={state} />\n          ) : (\n            <Option key={item.key} item={item} state={state} />\n          )\n        )}\n      </StyledList>\n    </>\n  );\n});\nfunction Option<T extends object>({\n  item,\n  state,\n}: {\n  item: Node<T>;\n  state: ListState<T>;\n}) {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { optionProps } = useOption({ key: item.key }, state, ref);\n\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isSelected = state.selectionManager.focusedKey === item.key;\n  return (\n    <ItemStateContext.Provider\n      value={{\n        isDisabled,\n        isContainerFocused: state.selectionManager.isFocused,\n        isSelected,\n        node: item,\n      }}\n    >\n      <StyledListItem\n        {...optionProps}\n        ref={ref}\n        disabled={isDisabled}\n        selected={isSelected}\n        containerFocused\n      >\n        {item.rendered}\n      </StyledListItem>\n    </ItemStateContext.Provider>\n  );\n}\n\nconst StyledSectionHeading = styled.div`\n  font-size: 0.6875rem;\n  padding: 0 0.5rem;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor}; // not verified\n`;\n\nconst StyledSection = styled.div`\n  padding: 0;\n  margin: 0;\n  list-style: none;\n`;\n\nfunction ListBoxSection<T extends object>({\n  section,\n  state,\n}: {\n  section: Node<T>;\n  state: ListState<T>;\n}) {\n  let { itemProps, headingProps, groupProps } = useListBoxSection({\n    heading: section.rendered,\n    \"aria-label\": section[\"aria-label\"],\n  });\n\n  // If the section is not the first, add a separator element to provide visual separation.\n  // The heading is rendered inside an <li> element, which contains\n  // a <ul> with the child items.\n  return (\n    <>\n      {section.key !== state.collection.getFirstKey() && (\n        <StyledVerticalSeparator role=\"presentation\" />\n      )}\n      <li {...itemProps}>\n        {section.rendered && (\n          <StyledSectionHeading {...headingProps}>\n            {section.rendered}\n          </StyledSectionHeading>\n        )}\n        <StyledSection {...groupProps}>\n          {[\n            ...(state.collection.getChildren?.(section.key) ??\n              section.childNodes),\n          ].map((node) => (\n            <Option key={node.key} item={node} state={state} />\n          ))}\n        </StyledSection>\n      </li>\n    </>\n  );\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport const StyledContainer = styled.div<{\n  disabled?: boolean;\n  validationState?: \"valid\" | \"error\" | \"warning\";\n}>`\n  box-sizing: border-box;\n  display: flex;\n  width: 100%;\n  align-items: center;\n  height: 1.5rem;\n  background: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"ComboBox.disabledBackground\")\n      : theme.color(\"ComboBox.background\")};\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"ComboBox.disabledForeground\")\n      : theme.color(\n          \"ComboBox.foreground\" as UnknownThemeProp<\"ComboBox.foreground\">\n        )};\n  border: 1px solid\n    ${({ theme, disabled, validationState }) =>\n      theme.commonColors.border({\n        disabled,\n        validationState,\n      })};\n  // The focus style is applied unconditionally in the reference impl, so no use of focus-visible or js-based focus visible detection\n\n  box-shadow: 0 0 0 0.125rem\n    ${({ theme, validationState }) =>\n      theme.commonColors.focusRing({\n        validationState,\n        focused: false,\n      })};\n  &:focus,\n  &.is-focus {\n    border-color: ${({ theme, validationState }) =>\n      theme.commonColors.border({\n        focused: true,\n        validationState,\n      })};\n    outline: none;\n    box-shadow: 0 0 0 0.125rem\n      ${({ theme, validationState }) =>\n        theme.commonColors.focusRing({\n          validationState,\n          focused: true,\n        })};\n  }\n\n  border-radius: ${({ theme }) => theme.borderRadius.default}px;\n`;\n","import { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport const StyledDropdownArrowIcon = styled(PlatformIcon).attrs<{\n  disabled?: boolean;\n}>({\n  \"aria-hidden\": \"true\",\n})`\n  // NOTE: \"ArrowButton.nonEditableBackground\" theme key is used in the reference impl, but it doesn't seem necessary to allow\n  // for a separate arrow background in Dropdown (aka non-editable combobox), since the arrow is not really a\n  // separate button, but a visual indicator for the whole trigger. Also there is no mention of it in designs\n  // There is also separate theme properties for color and disabled color, but inheriting it (via currentColor)\n  // makes more sense\n\n  * {\n    fill: ${({ theme, disabled }) =>\n      disabled\n        ? theme.color(\"ComboBox.ArrowButton.disabledIconColor\")\n        : theme.color(\"ComboBox.ArrowButton.iconColor\")};\n  }\n`;\n","import { css, styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { DOMAttributes, DOMProps } from \"@react-types/shared\";\n\n/**\n * Interface to inherit in props of components that support rendering context help.\n */\nexport interface ContextHelpProps {\n  /**\n   * Context help, shown below the input.\n   * A typical use case is\n   * [to provide example values](https://jetbrains.github.io/ui/principles/context_help/#07).\n   */\n  contextHelp?: React.ReactNode; // TODO: implement\n  /**\n   * Placement of the contextHelp text with respect to the control.\n   * See more: https://plugins.jetbrains.com/docs/intellij/inline-help-text.html#placement\n   */\n  contextHelpPlacement?: \"below\" | \"after\";\n}\n\nconst StyledContextHelp = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n`;\n\nconst StyledContextHelpWrapper = styled.div<{\n  placement: ContextHelpProps[\"contextHelpPlacement\"];\n}>`\n  font-size: 0.75rem; // 12px, in new UI. It's 11px in the old UI.\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n  gap: 0.25rem; /* Not checked with the reference impl */\n  ${({ placement }) =>\n    placement === \"after\" &&\n    css`\n      flex-direction: row;\n      align-items: center;\n      gap: 1rem; /* Not checked with the reference impl */\n    `}\n  flex-grow: 1; /* Needed for when the control is inside a flex layout */\n`;\n\n/**\n * Implements [inline context help](https://plugins.jetbrains.com/docs/intellij/inline-help-text.html),\n * for its children.\n */\nexport const WithInlineContextHelp = ({\n  children,\n  descriptionProps,\n  contextHelpPlacement,\n  contextHelp,\n}: {\n  children: React.ReactNode;\n  /**\n   * Props to apply on the context help wrapper, to make the connected control\n   * described by the context help.\n   */\n  descriptionProps: DOMAttributes;\n} & ContextHelpProps) => {\n  return (\n    <StyledContextHelpWrapper placement={contextHelpPlacement}>\n      {children}\n      {contextHelp && (\n        <StyledContextHelp {...descriptionProps}>\n          {contextHelp}\n        </StyledContextHelp>\n      )}\n    </StyledContextHelpWrapper>\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, {\n  ForwardedRef,\n  forwardRef,\n  RefObject,\n  useContext,\n  useEffect,\n  useLayoutEffect,\n} from \"react\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\nexport type LabelPlacement = \"above\" | \"before\";\n\nconst StyledLabelContainer = styled.div<{\n  labelPlacement?: LabelPlacement;\n}>`\n  display: inline-flex;\n  flex-direction: ${({ labelPlacement }) =>\n    labelPlacement === \"above\" ? \"column\" : \"row\"};\n  align-items: start;\n  gap: 0.375rem;\n`;\n\nconst StyledLabel = styled.label<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled: disabled }) =>\n    theme.commonColors.label({ disabled })};\n  margin-top: 0.25rem;\n  line-height: 1.2;\n`;\n\n/**\n * Implements [label](https://jetbrains.github.io/ui/controls/input_field/#label),\n * for elements like Input, Dropdown, etc.\n */\nexport const WithLabel = forwardRef(function WithLabel(\n  {\n    label,\n    labelPlacement,\n    labelProps,\n    children,\n    isDisabled,\n    ...props\n  }: {\n    isDisabled: boolean | undefined;\n    label: React.ReactNode;\n    labelPlacement: LabelPlacement | undefined /* intentionally not optional */;\n    labelProps?: DOMAttributes;\n  } & DOMAttributes,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const labelRef = React.useRef<HTMLLabelElement>(null);\n  useAlignedLabels({ ref: labelRef, enabled: labelPlacement !== \"above\" });\n  return (\n    <StyledLabelContainer\n      {...props}\n      labelPlacement={labelPlacement}\n      ref={forwardedRef}\n    >\n      {label && (\n        <StyledLabel {...labelProps} isDisabled={isDisabled} ref={labelRef}>\n          {label}\n        </StyledLabel>\n      )}\n      {children}\n    </StyledLabelContainer>\n  );\n});\n\nfunction useAlignedLabels({\n  ref,\n  enabled,\n}: {\n  ref: RefObject<HTMLElement>;\n  enabled?: boolean;\n}) {\n  const { applyLabelWidth, commonWidth } = useContext(LabelAlignmentContext);\n  useLayoutEffect(() => {\n    const apply = (): boolean => {\n      const width = ref.current?.offsetWidth;\n      if (width) {\n        applyLabelWidth(width);\n        return true;\n      }\n      return false;\n    };\n    // In some situations, the width is zero in the first render.\n    if (!apply()) {\n      setTimeout(apply, 0);\n    }\n  });\n\n  useEffect(() => {\n    if (ref.current) {\n      ref.current.style.width =\n        commonWidth && enabled ? `${commonWidth}px` : \"\";\n    }\n  }, [commonWidth, enabled]);\n}\n\nconst LabelAlignmentContext = React.createContext<{\n  commonWidth: number | null;\n  applyLabelWidth: (width: number) => void;\n}>({ commonWidth: null, applyLabelWidth: () => {} });\n\n/**\n * Provides a context for\n * [labeled input controls](https://jetbrains.github.io/ui/principles/layout/#labeled-input-controls)\n * with side-positioned labels to have their input boxes aligned.\n * It doesn't render anything in DOM and only provides a context used\n * by labeled controls to set a common width on labels so that the input boxes\n * align.\n * Labeled input controls are:\n * - {@link InputField}\n * - {@link ComboBox}\n * - {@link Dropdown}\n */\nexport function LabeledControlsAlignmentProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const [commonWidth, setCommonWidth] = React.useState<null | number>(null);\n\n  const applyLabelWidth = (width: number) => {\n    setCommonWidth((currentWidth) =>\n      width > (currentWidth ?? 0)\n        ? width + 1 /* without 1px it wraps in some cases ¯\\_(ツ)_/¯ */\n        : currentWidth\n    );\n  };\n  return (\n    <LabelAlignmentContext.Provider value={{ commonWidth, applyLabelWidth }}>\n      {children}\n    </LabelAlignmentContext.Provider>\n  );\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, { ForwardedRef } from \"react\";\nimport { amendName, PlatformIcon, PlatformIconProps } from \"./PlatformIcon\";\n\nexport const StyledHoverContainer = styled.span<{\n  hoverContainerSelector?: string;\n}>`\n  ${({ hoverContainerSelector }) =>\n    hoverContainerSelector\n      ? `${hoverContainerSelector} &`\n      : \"\"} .icon[data-hover] {\n    display: none;\n  }\n\n  ${({ hoverContainerSelector }) =>\n    hoverContainerSelector ? `${hoverContainerSelector}:hover &` : \"&:hover\"} {\n    .icon {\n      display: none;\n    }\n\n    .icon[data-hover] {\n      display: inline-flex;\n    }\n  }\n`;\n\nconst StyledIconHoverContainer = styled(StyledHoverContainer)`\n  display: inline-flex;\n`;\n\n/**\n * A common use case for PlatformIcons is to have a default icon and a hover icon.\n * This component captures that simple use case, by rendering both icons, and hiding one based on a hover selector.\n *\n * ### Parent hover container\n *\n * If the hover-able element is a parent of the icon, and not the icon itself (i.e., the icon should change if the\n * that parent is hovered), you can use `StyledHoverContainer` to define that parent element:\n *\n * ```tsx\n * const SomeParent = styled(StyledHoverContainer)`...`;\n * <SomeParent><AutoHoverPlatformIcon icon=\"...\" /></SomeParent>\n * ```\n *\n * If the hover-able element is a parent of the icon, with a known selector, you can pass `hoverContainerSelector`,\n * instead of using `StyledHoverContainer`:\n *\n * ```tsx\n * <AutoHoverPlatformIcon icon=\"...\" hoverContainerSelector=\"[role=menuitem]\" />\n * ```\n *\n * If the hover container is a styled component, you can have it converted to selector like this:\n *\n * ```tsx\n * <AutoHoverPlatformIcon icon=\"...\" hoverContainerSelector={`${MyStyledHoverContainer}`} />\n * ```\n *\n * In all examples above, the hover icon is shown when the parent is hovered, instead of the icon itself.\n *\n */\nexport const AutoHoverPlatformIcon = React.forwardRef(\n  function AutoHoverPlatformIcon(\n    {\n      hoverIcon,\n      hoverContainerSelector,\n      ...props\n    }: PlatformIconProps & {\n      /**\n       * The icon to be used when hovered. If not provided, it will be the \"somethingHovered\" where \"something\" is the `icon`\n       */\n      hoverIcon?: string;\n      hoverContainerSelector?: string;\n    },\n    ref: ForwardedRef<HTMLSpanElement>\n  ) {\n    const className = `icon ${props.className || \"\"}`;\n    return (\n      <StyledIconHoverContainer\n        ref={ref}\n        hoverContainerSelector={hoverContainerSelector}\n      >\n        <PlatformIcon {...props} className={className} />\n        <PlatformIcon\n          {...props}\n          className={className}\n          icon={hoverIcon ?? amendName(props.icon, \"Hover\")}\n          data-hover\n        />\n      </StyledIconHoverContainer>\n    );\n  }\n);\n","import useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport React, { ForwardedRef } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\ninterface IconModifiers {\n  Selected?: boolean;\n  Focused?: boolean;\n  Disabled?: boolean;\n  Editable?: boolean;\n  Pressed?: boolean;\n}\n\nexport interface ThemeIconProps extends IconProps {\n  /**\n   * Icon which will be resolved against the default icon location based on theme type\n   */\n  icon: string | { name: string; modifiers: IconModifiers };\n\n  /**\n   * A theme key that can optionally override the icon.\n   */\n  themePath?: string;\n}\n\nconst ICONS_DIR_PREFIX = \"com/intellij/ide/ui/laf/icons/\";\n\n// Similar to LafIconLookup\nfunction findIconPath(\n  theme: Theme,\n  name: string,\n  modifiers: IconModifiers = {}\n) {\n  const basePath = `${ICONS_DIR_PREFIX}${\n    theme.isUnderDarcula() ? \"darcula/\" : \"intellij/\"\n  }`;\n  const suffix = (\n    [\"Editable\", \"Selected\", \"Pressed\", \"Focused\", \"Disabled\"] as Array<\n      keyof typeof modifiers\n    >\n  )\n    .filter((modifier) =>\n      // Focused or Pressed can't coexist with Disabled\n      modifiers.Disabled ? ![\"Focused\", \"Pressed\"].includes(modifier) : true\n    )\n    .reduce(\n      (soFar, modifier) => soFar + (modifiers[modifier] ? modifier : \"\"),\n      \"\"\n    );\n  return `${basePath}${name}${suffix}.svg`;\n}\n\nfunction useIconPath(\n  iconDescriptor: string | { name: string; modifiers?: IconModifiers },\n  themePath?: string\n) {\n  const theme = useTheme() as Theme; // TODO: investigate why useTheme is typed like this\n  const resolvedValue = themePath && theme.value(themePath);\n  if (resolvedValue) {\n    return resolvedValue;\n  }\n  const { modifiers = {}, name } =\n    typeof iconDescriptor === \"string\"\n      ? { name: iconDescriptor }\n      : iconDescriptor;\n  return findIconPath(theme, name, modifiers);\n}\n\nexport const LafIcon = React.forwardRef(\n  (\n    { themePath, icon, size, ...props }: ThemeIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const resolvedIconPath = useIconPath(icon, themePath);\n\n    const ref = useForwardedRef(forwardedRef);\n    useSvgIcon({ path: `platform/platform-impl/src/${resolvedIconPath}` }, ref);\n    return <StyledIconWrapper {...props} ref={ref} size={size} />;\n  }\n);\n","import React, { ForwardedRef } from \"react\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\nexport interface PlatformIconProps extends IconProps {\n  /**\n   * Icon path in intellij platform repo.\n   * If starts with \"/\", the path will be from the repo root. Otherwise, it's relative to \"platform/icons/src\".\n   * \".svg\" extension is optional.\n   */\n  icon: string;\n  /**\n   * Similar to icon, but for dark themes.\n   */\n  darkIcon?: string;\n}\n\nexport const amendName = (iconNameOrPath: string, amendment: string) => {\n  const [name, ext] = iconNameOrPath.split(\".\");\n  return `${name}${amendment}${ext ? `.${ext}` : \"\"}`;\n};\n\nexport const getDarkPath = (path: string, darkPath?: string) => {\n  const [name, ext] = path.split(\".\");\n  return darkPath || `${name}_dark${ext ? `.${ext}` : \"\"}`;\n};\n\nconst getPlatformIconPath = (relativePath: string) =>\n  relativePath.startsWith(\"/\")\n    ? relativePath.slice(1)\n    : `platform/icons/src/${relativePath}`;\n\n/**\n * Renders an icon from the predefined list of platform icons.\n * icon name must follow the directory structure in platform icons.\n * @example <PlatformIcon icon=\"general/hideToolWindow\" />\n * @example <PlatformIcon icon=\"toolbar/pin\" />\n * @example <PlatformIcon icon=\"toolbar/pin.svg\" />\n * @example <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\" />\n */\nexport const PlatformIcon = React.forwardRef(\n  (\n    { icon, darkIcon, ...props }: PlatformIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const ref = useForwardedRef(forwardedRef);\n    const theme = useTheme();\n    const iconName = theme.dark ? getDarkPath(icon, darkIcon) : icon;\n    useSvgIcon(\n      {\n        path: getPlatformIconPath(iconName),\n        fallbackPath: getPlatformIconPath(icon),\n      },\n      ref\n    );\n\n    return <StyledIconWrapper {...props} ref={ref} />;\n  }\n);\n","import { styled } from \"../styled\";\nimport { IconSize } from \"@intellij-platform/core/Icon/IconProps\";\n\nconst DEFAULT_ICON_SIZE: IconSize = 16;\n\nexport const StyledIconWrapper = styled.span<{\n  size?: IconSize;\n  useCurrentColor?: boolean;\n  role?: string;\n}>`\n  box-sizing: border-box;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 0;\n  width: ${({ size = DEFAULT_ICON_SIZE }) => `${size}px`};\n  height: ${({ size = DEFAULT_ICON_SIZE }) => `${size}px`};\n  position: relative; // to allow absolute positioned indicators and overlays on icon\n  cursor: ${({ role }) => (role === \"button\" ? \"pointer\" : undefined)};\n`;\n","import { RefObject, useContext, useEffect } from \"react\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\n\nexport function useSvgIcon(\n  { path, fallbackPath }: { path: string; fallbackPath?: string },\n  /**\n   * ref to the icon wrapper element in which the svg should be injected.\n   * This hook used to return svg string, and that svg was set as dangerouslySetInnerHTML. But now it injects the svg.\n   * by direct DOM manipulation. That's to eliminate the need for using dangerouslySetInnerHTML, so that we can allow\n   * arbitrary children (like LiveIndicator) as overlays on top of icons.\n   */\n  ref: RefObject<HTMLElement>\n) {\n  const theme = useTheme();\n  const itemState = useContext(ItemStateContext);\n  const selected = itemState?.isSelected || itemState?.isContainerFocused;\n  useEffect(() => {\n    let canceled = false;\n    const fetchIcon = async () => {\n      if (!path) {\n        console.error(\"icon path is empty\");\n        return;\n      }\n      if (ref.current) {\n        // For querying for icons that are not loaded yet. Especially useful for visual testing\n        ref.current.ariaBusy = \"true\";\n      }\n      const svg = await theme\n        .getSvgIcon(path, selected)\n        .catch((e) => {\n          if (fallbackPath) {\n            return theme.getSvgIcon(fallbackPath, selected);\n          }\n          throw e;\n        })\n        .finally(() => {\n          if (ref?.current && !canceled) {\n            ref.current.ariaBusy = \"false\";\n          }\n        });\n      if (svg) {\n        const element = ref?.current;\n        if (!canceled && element) {\n          element.querySelector(\"svg\")?.remove();\n          const svgElement = document.createElement(\"svg\");\n          element.appendChild(svgElement);\n          svgElement.outerHTML = makeIdsUnique(svg); // UNSAFE! Would require sanitization, or icon sources must be trusted.\n        }\n      } else {\n        console.error(\"Could not resolve icon:\", path);\n      }\n    };\n    fetchIcon().catch(console.error);\n    return () => {\n      canceled = true;\n    };\n  }, [path, selected]);\n}\n\n/**\n * If multiple instance of the same icon is rendered at the same time, and the SVG includes\n * url(#...) references to locally defined ids, in some cases the icon is not rendered properly.\n * because of ids colliding. We make sure the ids are unique in each rendered icon.\n */\nfunction makeIdsUnique(svg: string): string {\n  const randomPostfix = (Math.random() * 1000).toFixed(0);\n  const idMatches = svg.matchAll(/id=\"(.*?)\"/g);\n  return [...idMatches].reduce((modifiedSvg, [_, id]) => {\n    const newId = `${id}-${randomPostfix}`;\n    return replaceAll(\n      `id=\"${id}\"`,\n      `id=\"${newId}\"`,\n      replaceAll(`url(#${id})`, `url(#${newId})`, modifiedSvg)\n    );\n  }, svg);\n}\n\nfunction replaceAll(theOld: string, theNew: string, str: string): string {\n  const replaced = str.replace(theOld, theNew);\n  const replacedAgain = replaced.replace(theOld, theNew);\n  if (replaced === replacedAgain) {\n    return replaced;\n  }\n  return replaceAll(theOld, theNew, replacedAgain);\n}\n","import { PressProps, usePress } from \"@react-aria/interactions\";\nimport React, { ForwardedRef, HTMLProps } from \"react\";\nimport { styled } from \"../styled\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface IconButtonProps\n  extends PressProps,\n    // Maybe we should allow any arbitrary HTMLProps<HTMLButtonElement> props, instead of whitelisting?\n    Pick<\n      HTMLProps<HTMLButtonElement>,\n      \"onFocus\" | \"onBlur\" | \"style\" | \"className\"\n    > {\n  children?: React.ReactNode;\n  /**\n   * The minimum width/height of the button.\n   */\n  minSize?: number;\n  /**\n   * Whether the button should be focusable by pressing tab. The default is true for icon buttons (aka. action buttons),\n   * which means they are not included in the tab order.\n   */\n  excludeFromTabOrder?: boolean;\n}\n\nexport const DEFAULT_MINIMUM_BUTTON_SIZE = 22;\nexport const NAVBAR_MINIMUM_BUTTON_SIZE = 20;\n\nexport const StyledIconButton = styled.button<{ minSize: number }>`\n  position: relative; // to allow absolutely positioned overlays like an dropdown icon at the bottom right corner\n  background: none;\n  color: inherit;\n  border: 1px solid transparent;\n  border-radius: 3px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-height: ${({ minSize }) => `${minSize}px`};\n  min-width: ${({ minSize }) => `${minSize}px`};\n  padding: 0;\n  margin: 0;\n  &:disabled {\n    opacity: 0.25; // not quite accurate implementation. There might be better ways to style disabled state.\n  }\n  &:hover:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBackground\", \"#DFDFDF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBorderColor\", \"#DFDFDF\")};\n  }\n  &:focus-visible:not(:disabled) {\n    outline: none;\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\n        \"ActionButton.focusedBorderColor\",\n        theme.dark ? \"#5eacd0\" : \"#62b8de\"\n      )};\n  }\n  &:active:not(:disabled),\n  &.active:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBorderColor\", \"#CFCFCF\")};\n  }\n`;\n\n/**\n * Icon button, aka Action Button, in the reference implementation.\n * @see https://jetbrains.github.io/ui/controls/icon_button/\n */\nexport const IconButton = React.forwardRef(function IconButton(\n  {\n    minSize = DEFAULT_MINIMUM_BUTTON_SIZE,\n    preventFocusOnPress = true,\n    excludeFromTabOrder = true,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    ...otherProps\n  }: IconButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  // FIXME: use useButton\n\n  const ref = useObjectRef(forwardedRef);\n  const { focusableProps } = useFocusable({ isDisabled }, ref);\n  const { pressProps, isPressed } = usePress({\n    ref,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    preventFocusOnPress,\n  });\n\n  return (\n    <StyledIconButton\n      className={isPressed ? \"active\" : \"\"}\n      disabled={isDisabled}\n      {...mergeProps(pressProps, otherProps, focusableProps)}\n      minSize={minSize}\n      tabIndex={excludeFromTabOrder && !isDisabled ? -1 : undefined}\n      ref={ref}\n    />\n  );\n});\n","import React, { useRef } from \"react\";\nimport styled from \"styled-components\";\nimport {\n  IconButton,\n  IconButtonProps,\n} from \"@intellij-platform/core/IconButton\";\nimport { MenuTrigger, MenuTriggerProps } from \"@intellij-platform/core/Menu\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst ArrowIcon = styled(PlatformIcon)`\n  position: absolute;\n  right: 1px;\n  bottom: 1px;\n`;\n\ntype IconButtonWithMenuProps = IconButtonProps &\n  Pick<MenuTriggerProps, \"renderMenu\"> & {\n    /**\n     * whether the default arrow should be removed or not. false by default.\n     */\n    noArrow?: boolean;\n  };\n/**\n * Renders an IconButton which opens a menu. by default a down arrow icon is shown as an overlay on the rendered\n * icon, but it can be disabled by passing `noArrow`. It also restores the focus to the previously focused element,\n * when the menu is closed.\n * @param renderMenu: render prop for rendering the menu\n * @param children: the content of the icon button\n * @param noArrow: whether the default arrow should be removed or not. false by default.\n * @param buttonProps: the rest of the props that will be passed down to IconButton\n *\n * TODO: Add story and write test for focus restoration, noArrow, and basic functionality.\n */\nexport const IconButtonWithMenu = ({\n  renderMenu,\n  children,\n  noArrow = false,\n  ...buttonProps\n}: IconButtonWithMenuProps) => {\n  const previouslyFocusedElementRef = useRef<HTMLElement>();\n  return (\n    <MenuTrigger\n      renderMenu={renderMenu}\n      onOpenChange={(open) => {\n        if (!open && previouslyFocusedElementRef.current) {\n          previouslyFocusedElementRef.current.focus();\n        }\n      }}\n    >\n      {(props, ref) => (\n        <IconButton\n          {...mergeProps(buttonProps, props, {\n            onFocus: (e: FocusEvent) => {\n              if (e.relatedTarget && e.relatedTarget instanceof HTMLElement) {\n                previouslyFocusedElementRef.current = e.relatedTarget;\n              }\n            },\n          })}\n          ref={ref}\n        >\n          {children}\n          {!noArrow && <ArrowIcon icon=\"general/dropdown.svg\" />}\n        </IconButton>\n      )}\n    </MenuTrigger>\n  );\n};\n","import React, { ComponentProps, HTMLAttributes, HTMLProps } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"./Theme/Theme\";\n\ninterface Props extends React.ImgHTMLAttributes<HTMLImageElement> {\n  /**\n   * src for when a dark theme is active. if `darkSrc` doesn't have a non-empty string value, src will be used both\n   * for dark and light themes.\n   */\n  darkSrc?: string;\n}\n/**\n * Same as default `img`, but theme aware. Meaning that you can specify different sources for normal and dark mode.\n */\nexport const Img: React.FC<Props> = ({ darkSrc, ...props }) => {\n  const theme = useTheme() as Theme;\n  if (theme.dark) {\n    return <img {...props} src={darkSrc || props.src} />;\n  }\n  return <img {...props} />;\n};\n","import React, {\n  ForwardedRef,\n  InputHTMLAttributes,\n  useEffect,\n  useState,\n} from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { FocusableOptions, useFocusable } from \"@react-aria/focus\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled, css } from \"@intellij-platform/core/styled\";\n\nconst StyledInputBox = styled.div<{\n  disabled?: boolean;\n  focused?: boolean;\n  validationState: InputProps[\"validationState\"];\n  appearance: InputProps[\"appearance\"];\n}>`\n  box-sizing: border-box;\n  display: inline-flex;\n  min-width: 4rem; // https://jetbrains.github.io/ui/controls/input_field/#28\n  background: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"TextField.disabledBackground\")\n      : theme.color(\"TextField.background\")};\n  border: 1px solid\n    ${({ theme, focused, disabled, validationState }) =>\n      theme.commonColors.border({\n        focused,\n        disabled,\n        validationState,\n      })};\n  box-shadow: 0 0 0 0.125rem\n    ${({ theme, focused = false, validationState, disabled }) =>\n      disabled\n        ? \"transparent\"\n        : theme.commonColors.focusRing({\n            validationState,\n            focused: focused,\n          })};\n  border-radius: 1px;\n  cursor: text; // the whole box moves focus to the input\n  overflow: hidden;\n  ${({ appearance, validationState, disabled }) =>\n    appearance === \"embedded\" &&\n    css`\n      border-color: ${validationState !== \"error\" && \"transparent\"};\n      box-shadow: ${validationState !== \"error\" && \"none\"};\n      background: ${!disabled && \"transparent\"};\n    `};\n`;\n\nconst StyledInput = styled.input<{ disabled?: boolean }>`\n  all: unset;\n  padding: 0.1875rem 0.375rem;\n  flex: 1; // fill in the available space within the input box\n  min-width: 0;\n  line-height: 1rem;\n  color: ${({ theme }) =>\n    theme.color(\n      \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n    )};\n  color: ${({ theme, disabled }) =>\n    disabled &&\n    theme.color(\n      \"TextField.inactiveForeground\" as UnknownThemeProp<\"TextField.inactiveForeground\">\n    )};\n\n  caret-color: ${({ theme }) =>\n    theme.color(\n      \"TextField.caretForeground\" as UnknownThemeProp<\"TextField.caretForeground\">\n    )};\n  &::selection {\n    background: ${({ theme }) =>\n      theme.color(\n        \"*.selectionBackground\"\n      )}; // Not checked with the reference impl\n    color: ${({ theme }) =>\n      theme.color(\n        \"*.selectionForeground\"\n      )}; // Not checked with the reference impl\n  }\n  &::placeholder {\n    color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  }\n`;\n\nconst StyledAddons = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem; /* TODO: check */\n  padding: 1px 0;\n`;\nconst StyledRightAddons = styled(StyledAddons)`\n  margin-right: 0.125rem; /* TODO: check */\n`;\n\nconst StyledLeftAddons = styled(StyledAddons)`\n  margin-left: 0.375rem; /* TODO: check */\n`;\n\nexport interface InputProps extends InputHTMLAttributes<HTMLInputElement> {\n  validationState?: \"valid\" | \"error\" | \"warning\";\n  /**\n   * Whether to auto select the value initially\n   */\n  autoSelect?: boolean;\n\n  /**\n   * Rendered inside the input box and after the input element.\n   * Used to render [Built-in buttons](https://jetbrains.github.io/ui/controls/built_in_button/).\n   */\n  addonAfter?: React.ReactNode;\n  /**\n   * Rendered inside the input box and before the input element.\n   */\n  addonBefore?: React.ReactNode;\n\n  /**\n   * Ref to the underlying input element\n   */\n  inputRef?: React.Ref<HTMLInputElement>;\n\n  /**\n   * Appearance of the input.\n   * - \"ghost\": Without the border and shadow in valid state.\n   * - \"boxed\" With the border and shadow.\n   * @default \"box\"\n   */\n  appearance?: \"embedded\" | \"box\";\n}\n\n/**\n * Bare input, themed, and with a few extra features:\n * - Support for \"error\" and \"warning\" state ({@param validationState}\n * - Support for autoSelect.\n * - Disables spell check by default. It can be overwritten.\n * Use {@link InputField} for more features like an associated label, error message and context help.\n */\nexport const Input = React.forwardRef(function Input(\n  {\n    validationState,\n    autoSelect,\n    addonBefore,\n    addonAfter,\n    style,\n    className,\n    inputRef: inputRefProp,\n    onFocus,\n    onBlur,\n    autoFocus,\n    appearance,\n    ...props\n  }: InputProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const inputRef = useObjectRef(inputRefProp);\n  const { focusableProps } = useFocusable(\n    {\n      isDisabled: props.disabled,\n      autoFocus,\n      onFocus,\n      onBlur,\n    } as FocusableOptions,\n    inputRef\n  );\n  const [isFocused, setIsFocused] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setIsFocused,\n  });\n\n  useEffect(() => {\n    if (autoSelect) {\n      inputRef.current?.select();\n    }\n  }, [autoSelect]);\n\n  return (\n    <StyledInputBox\n      ref={ref}\n      spellCheck={false}\n      appearance={appearance}\n      {...mergeProps(focusWithinProps, {\n        className,\n        style,\n        onMouseDown: (event: MouseEvent) => {\n          if (event.target !== inputRef.current) {\n            event.preventDefault();\n            inputRef.current?.focus();\n          }\n        },\n      })}\n      focused={isFocused}\n      validationState={validationState}\n      disabled={props.disabled}\n    >\n      {addonBefore && <StyledLeftAddons>{addonBefore}</StyledLeftAddons>}\n      <StyledInput ref={inputRef} {...mergeProps(props, focusableProps)} />\n      {addonAfter && <StyledRightAddons>{addonAfter}</StyledRightAddons>}\n    </StyledInputBox>\n  );\n});\n","import React, {\n  ChangeEvent,\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n} from \"react\";\nimport { AriaFieldProps, useField } from \"@react-aria/label\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { FocusableProps } from \"@react-types/shared\";\nimport {\n  PositionedTooltipTrigger,\n  ValidationTooltip,\n} from \"@intellij-platform/core/Tooltip\";\nimport { Input, InputProps } from \"@intellij-platform/core/InputField/Input\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  ContextHelpProps,\n  WithInlineContextHelp,\n} from \"@intellij-platform/core/Field/ContextHelp\";\nimport { LabelPlacement, WithLabel } from \"@intellij-platform/core/Field/Label\";\n\nexport interface InputFieldProps\n  extends Omit<\n      AriaFieldProps,\n      \"labelElementType\" | \"validationState\" | \"errorMessage\" | \"isInvalid\"\n    >,\n    FocusableProps,\n    Pick<\n      InputProps,\n      \"addonBefore\" | \"addonAfter\" | \"inputRef\" | \"validationState\"\n    >,\n    ContextHelpProps {\n  /**\n   * className applied on the field's wrapper div.\n   */\n  className?: string;\n  /**\n   * style applied on the field's wrapper div.\n   */\n  style?: CSSProperties;\n  /**\n   * Label to be associated with the input.\n   */\n  label?: React.ReactNode;\n  /**\n   * Placement of the label with respect to the input box.\n   */\n  labelPlacement?: LabelPlacement;\n\n  /**\n   * Whether the input is disabled. Use this prop\n   */\n  isDisabled?: boolean;\n\n  /**\n   * Convenient prop to be used instead of inputProps.placeholder\n   **/\n  placeholder?: string;\n  /**\n   * Convenient prop to be used instead of inputProps.value\n   **/\n  value?: HTMLProps<HTMLInputElement>[\"value\"];\n  /**\n   * Convenient prop to be used instead of inputProps.defaultValue\n   **/\n  defaultValue?: HTMLProps<HTMLInputElement>[\"defaultValue\"];\n  /**\n   * Convenient prop to be used instead of inputProps.onChange. It also calls the passed callback with the\n   * change value instead of input.\n   **/\n  onChange?: (newValue: string) => void;\n  /**\n   * Props to be passed to the underlying input element.\n   **/\n  inputProps?: Omit<\n    HTMLProps<HTMLInputElement>,\n    \"as\" | \"ref\" | \"disabled\" //isDisabled should be used\n  >;\n  /**\n   * Whether to auto select the value initially\n   */\n  autoSelect?: boolean;\n\n  /**\n   * Validation message shown as a {@link ValidationTooltip} above the field.\n   * {@link ValidationTooltipProps#type} is defined based on `validationState`.\n   */\n  validationMessage?: React.ReactNode;\n}\n\nconst StyledInput = styled(Input)`\n  width: 100%;\n`;\n\n/**\n * An input box with an associated label, error message, and context help.\n */\nexport const InputField = React.forwardRef(function InputField(\n  {\n    validationState,\n    validationMessage,\n    className,\n    style,\n    labelPlacement = \"before\",\n    contextHelp,\n    contextHelpPlacement,\n    inputProps = {},\n    addonBefore,\n    addonAfter,\n    inputRef,\n    ...props\n  }: InputFieldProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref = useObjectRef(forwardedRef);\n  const { fieldProps, errorMessageProps, labelProps, descriptionProps } =\n    useField({\n      ...props,\n      errorMessage: validationMessage,\n      validationState:\n        validationState === \"error\" || validationState === \"warning\"\n          ? \"invalid\"\n          : \"valid\",\n    });\n\n  return (\n    <WithLabel\n      ref={ref}\n      label={props.label}\n      labelPlacement={labelPlacement}\n      isDisabled={props.isDisabled}\n      labelProps={labelProps}\n      className={className}\n      style={style}\n    >\n      <WithInlineContextHelp\n        contextHelp={contextHelp}\n        contextHelpPlacement={contextHelpPlacement}\n        descriptionProps={descriptionProps}\n      >\n        <PositionedTooltipTrigger\n          placement=\"top start\"\n          crossOffset={36}\n          showOnFocus\n          isDisabled={!validationMessage}\n          tooltip={\n            <ValidationTooltip\n              type={validationState !== \"valid\" ? validationState : undefined}\n            >\n              <div {...errorMessageProps}>{validationMessage}</div>\n            </ValidationTooltip>\n          }\n          delay={0}\n        >\n          <StyledInput\n            inputRef={inputRef}\n            placeholder={props.placeholder}\n            disabled={props.isDisabled}\n            validationState={validationState}\n            autoSelect={props.autoSelect}\n            autoFocus={props.autoFocus}\n            addonAfter={addonAfter}\n            addonBefore={addonBefore}\n            {...mergeProps(fieldProps, inputProps, {\n              value: props.value,\n              defaultValue: props.defaultValue,\n              onChange: (e: ChangeEvent<HTMLInputElement>) =>\n                props.onChange?.(e.target.value),\n            })}\n          />\n        </PositionedTooltipTrigger>\n      </WithInlineContextHelp>\n    </WithLabel>\n  );\n});\n","import { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nconst getDefaultLinkColor = ({ theme }: { theme: Theme }) =>\n  theme.commonColors.linkForegroundEnabled;\n\nexport const StyledLink = styled.a`\n  cursor: pointer;\n  text-decoration: none;\n  outline: none;\n  // &:focus-visible didn't work as expected, so FocusRing is used\n  &.focus-visible {\n    outline: 1px solid\n      ${({ theme }) =>\n        theme.color(\n          \"Link.focusedBorderColor\" as UnknownThemeProp<\"Link.focusedBorderColor\">,\n          theme.commonColors.focusBorderColor\n        )};\n    border-radius: 2px; // Registry.intValue(\"ide.link.button.focus.round.arc\", 4)\n  }\n  color: ${getDefaultLinkColor};\n\n  &:hover,\n  &.hover /* for testing purposes*/ {\n    text-decoration: underline;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.hoverForeground\",\n        theme.color(\n          \"link.hover.foreground\" as UnknownThemeProp<\"link.hover.foreground\">,\n          \"\" /*FIXME: check*/\n        )\n      )};\n  }\n  &:active,\n  &.active {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.pressedForeground\",\n        theme.color(\n          \"link.pressed.foreground\" as UnknownThemeProp<\"link.pressed.foreground\">,\n          !theme.dark ? \"#F00000\" : \"#BA6F25\"\n        )\n      )};\n  }\n  &:disabled,\n  &.disabled {\n    cursor: default;\n    text-decoration: none;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.disabledForeground\" as UnknownThemeProp<\"Link.disabledForeground\">,\n        theme.color(\n          \"Label.disabledForeground\",\n          theme.color(\"Label.disabledText\", \"#999\")\n        )\n      )};\n  }\n  // We may need to refine this to allow passing visited as a prop for links that don't have href, and not apply the\n  // styles in that case, since it seems no href is considered visited by default. Although, in all main themes\n  // Link.visitedForeground is set to the default link color.\n  &:visited,\n  &.visited {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.visitedForeground\",\n        theme.color(\n          \"link.visited.foreground\" as UnknownThemeProp<\"link.visited.foreground\">,\n          !theme.dark ? \"#800080\" : \"#9776A9\"\n        )\n      )};\n  }\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { AriaLinkProps } from \"@react-types/link\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { FocusRing, useFocusable } from \"@react-aria/focus\";\nimport { StyledLink } from \"@intellij-platform/core/Link/StyledLink\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\n\nexport type LinkProps = AriaLinkProps & {\n  isDisabled?: boolean;\n  className?: string;\n  children: React.ReactNode;\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n  excludeFromTabOrder?: boolean;\n};\n\n/**\n * A focusable span in style of [Link](https://jetbrains.github.io/ui/controls/link/) and with accessibility role of link.\n *\n * TODO and known issues:\n * - in the reference impl, Space presses the link, Enter doesn't. It's vice versa here, because of how usePress is implemented.\n * - Support for External links\n * - Support for Anchor elements?\n *\n * Unknowns:\n * - What are ActionLink and DefaultLinkButtonUI?\n * - What is HyperLinkLabel compared to LabelLink (which was looked into in implementation of this component)?\n */\nexport const Link = React.forwardRef(\n  (\n    props: LinkProps,\n    forwardedRef: ForwardedRef<HTMLAnchorElement>\n  ): React.ReactElement => {\n    const ref = useForwardedRef(forwardedRef);\n\n    const { focusableProps } = useFocusable(props, ref);\n    const { pressProps, isPressed } = usePress({ ...props, ref });\n    const domProps = filterDOMProps(props, { labelable: true });\n    const interactionHandlers = mergeProps(focusableProps, pressProps);\n\n    return (\n      <FocusRing focusRingClass=\"focus-visible\">\n        <StyledLink\n          {...mergeProps(focusableProps, interactionHandlers, domProps)}\n          as=\"span\"\n          role=\"link\"\n          ref={ref}\n          // maybe use clsx\n          className={`${props.isDisabled ? \"disabled\" : \"\"} ${\n            isPressed ? \"active\" : \"\"\n          } ${props.className || \"\"}`}\n          aria-disabled={props.isDisabled || undefined}\n          tabIndex={\n            !props.isDisabled ? (props.excludeFromTabOrder ? -1 : 0) : undefined\n          }\n        >\n          {props.children}\n        </StyledLink>\n      </FocusRing>\n    );\n  }\n);\n","import { AriaListBoxProps } from \"@react-types/listbox\";\nimport { AsyncLoadable, Node } from \"@react-types/shared\";\nimport React, { ForwardedRef, Key } from \"react\";\nimport { useList } from \"./useList\";\nimport { ListItem } from \"./ListItem\";\nimport { StyledList } from \"./StyledList\";\nimport { useListState } from \"./useListState\";\nimport { filterDOMProps, useObjectRef } from \"@react-aria/utils\";\n\nimport { CollectionRefProps } from \"@intellij-platform/core/Collections/useCollectionRef\";\nimport { Virtualizer } from \"@react-aria/virtualizer\";\nimport { useListVirtualizer } from \"@intellij-platform/core/List/useListVirtualizer\";\nimport { ListContext } from \"@intellij-platform/core/List/ListContext\";\nimport { CollectionFocusProxyProps } from \"@intellij-platform/core/Collections\";\n\nexport type ListProps<T extends object> = Omit<\n  Omit<AriaListBoxProps<T>, \"disallowEmptySelection\">,\n  keyof AsyncLoadable\n> &\n  CollectionRefProps &\n  CollectionFocusProxyProps & {\n    /**\n     * fills the available horizontal or vertical space, when rendered in a flex container.\n     */\n    fillAvailableSpace?: boolean;\n    /**\n     * When true, shows the list in focused style, even when it's not focused. A common use case is when the list\n     * is virtually focused. i.e. the focus is physically on some other element (like a search input) which handles\n     * keyboard events as if the list was focused.\n     * Another (maybe questionable) use case is master detail views, where the master view is shown as focused, even\n     * when the details view has physical focus.\n     */\n    showAsFocused?: boolean;\n    allowEmptySelection?: boolean;\n    /**\n     * Called when the action for the item should be triggered, which can be by double click or pressing Enter.\n     * Enter not implemented yet :D\n     */\n    onAction?: (key: Key) => void;\n\n    /**\n     * Useful when list items have a custom height, to hint layout calculation logic about the item height which\n     * increases rendering efficiency and also prevents flash of items with wrong height.\n     */\n    estimatedItemHeight?: number;\n\n    className?: string;\n  };\n\n/**\n * List view\n */\nexport const List = React.forwardRef(function List<T extends object>(\n  {\n    allowEmptySelection = false,\n    fillAvailableSpace = false,\n    estimatedItemHeight,\n    className,\n    ...inputProps\n  }: ListProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const props: AriaListBoxProps<T> & CollectionRefProps = {\n    ...inputProps,\n    disallowEmptySelection: !allowEmptySelection,\n  };\n  const ref = useObjectRef(forwardedRef);\n  const state = useListState(props);\n  const { listProps, listContext } = useList(\n    {\n      ...props,\n      isVirtualized: true,\n    },\n    state,\n    ref\n  );\n\n  const {\n    virtualizerProps: { children: renderNode, ...virtualizerProps },\n  } = useListVirtualizer({\n    state,\n    estimatedItemHeight,\n    renderItem: (item) => <ListItem key={item.key} item={item} />,\n  });\n\n  return (\n    <ListContext.Provider value={listContext}>\n      <StyledList\n        as={Virtualizer<Node<any>, any>}\n        {...virtualizerProps}\n        {...listProps}\n        {...filterDOMProps(props, { labelable: true })}\n        fillAvailableSpace={fillAvailableSpace}\n        className={className}\n        ref={ref}\n      >\n        {renderNode}\n      </StyledList>\n    </ListContext.Provider>\n  );\n});\n","import React, { Key } from \"react\";\nimport { ListState } from \"@react-stately/list\";\n\nexport type ListContextType<T> = {\n  state: ListState<T>;\n  focused: boolean;\n  onAction: ((key: Key) => void) | undefined;\n};\n\nexport const ListContext = React.createContext<ListContextType<any> | null>(\n  null\n);\n","import React from \"react\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { useSeparator } from \"@react-aria/separator\";\n\nexport const ListDivider: React.FC = () => {\n  return (\n    <StyledVerticalSeparator\n      as={\"li\"}\n      {...useSeparator({ elementType: \"li\", orientation: \"vertical\" })\n        .separatorProps}\n    />\n  );\n};\n","import React, { useContext } from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport { StyledListItem } from \"./StyledListItem\";\nimport { ListContext } from \"@intellij-platform/core/List/ListContext\";\n\nexport interface ListItemProps<T> {\n  item: Node<T>;\n  children?: React.ReactNode;\n}\n\nexport function ListItem<T>({ item, children }: ListItemProps<T>) {\n  const { state, focused: listFocused, onAction } = useContext(ListContext)!;\n  const ref = React.useRef(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isSelected = state.selectionManager.isSelected(item.key);\n\n  const { itemProps } = useSelectableItem({\n    key: item.key,\n    ref,\n    onAction: () => onAction?.(item.key),\n    selectionManager: state.selectionManager,\n  });\n\n  return (\n    <StyledListItem\n      containerFocused={listFocused}\n      selected={isSelected}\n      disabled={isDisabled}\n      aria-disabled={isDisabled}\n      aria-selected={isSelected}\n      aria-label={item[\"aria-label\"]}\n      {...itemProps}\n      ref={ref}\n    >\n      <ItemStateContext.Provider\n        value={{\n          isDisabled,\n          isSelected,\n          isContainerFocused: listFocused,\n          node: item,\n        }}\n      >\n        {children || item.rendered}\n      </ItemStateContext.Provider>\n    </StyledListItem>\n  );\n}\n","import { css } from \"styled-components\";\nimport { styled } from \"../styled\";\n\ntype StyledListProps = {\n  fillAvailableSpace?: boolean;\n};\nexport const StyledList = styled.div\n  .attrs<StyledListProps>((props) => ({ role: props.role || \"list\" }))\n  .withConfig<StyledListProps>({\n    shouldForwardProp: (prop) => prop !== \"fillAvailableSpace\",\n  })<StyledListProps>`\n  padding: 0;\n  margin: 0;\n  list-style: none;\n  max-height: 100%;\n  overflow: auto;\n  color: ${({ theme }) => theme.color(\"*.textForeground\")};\n  outline: none;\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      height: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n    `}\n  background: ${({ theme }) => theme.color(\"List.background\")};\n`;\n","import { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"../styled\";\n\nexport type StyledListItemProps = {\n  containerFocused: boolean;\n  selected: boolean;\n  disabled: boolean;\n};\n\nexport const StyledListItem = styled.div.attrs<StyledListItemProps>(\n  (props) => ({\n    role: props.role || \"listitem\",\n  })\n)<StyledListItemProps>`\n  ${({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"List.foreground\" as UnknownThemeProp<\"List.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color = theme.asCurrentForeground(\n          theme.color(\n            \"List.selectionForeground\" as UnknownThemeProp<\"List.selectionForeground\">\n          ) || theme.commonColors.labelSelectedForeground\n        ) /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"List.selectionBackground\" as UnknownThemeProp<\"List.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"List.selectionInactiveForeground\" as UnknownThemeProp<\"List.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"List.selectionBackgroundInactive\" as UnknownThemeProp<\"List.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor: theme.asCurrentBackground(backgroundColor),\n      color,\n    };\n  }};\n  position: relative;\n  display: flex;\n  white-space: nowrap;\n  padding: 0 0.5rem; // themed?\n  line-height: 1.25rem;\n  outline: none;\n  cursor: default;\n  min-width: min-content; // Needed for content sizing for when list/tree is used inside popup or modal window\n`;\n","import { AriaSelectableListOptions } from \"@react-aria/selection\";\nimport { ListState } from \"@react-stately/list\";\nimport React, { Key, useEffect, useMemo, useState } from \"react\";\nimport { useSelectableList } from \"./useSelectableList\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { CollectionRefProps } from \"@intellij-platform/core/Collections/useCollectionRef\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { ListContextType } from \"@intellij-platform/core/List/ListContext\";\nimport {\n  CollectionFocusProxyProps,\n  useCollectionFocusProxy,\n} from \"@intellij-platform/core/Collections\";\n\nexport interface ListProps\n  extends Omit<\n      AriaSelectableListOptions,\n      | \"disallowEmptySelection\"\n      | \"selectOnFocus\"\n      | \"selectionManager\" // Grouped as state, the second argument, like in useListBox\n      | \"collection\" // Grouped as state, the second argument, like in useListBox\n      | \"disabledKeys\" // Grouped as state, the second argument, like in useListBox\n      | \"ref\" // Third argument\n    >,\n    CollectionFocusProxyProps,\n    CollectionRefProps {\n  allowEmptySelection?: boolean;\n  /**\n   * Called when the action for the item should be triggered, which can be by double click or pressing Enter.\n   * Enter not implemented yet :D\n   */\n  onAction?: (key: Key) => void;\n  showAsFocused?: boolean;\n  id?: string;\n}\n// import { useSelectableList } from \"@react-aria/selection\";\n\nexport function useList<T>(\n  { onAction, showAsFocused, focusProxyRef, ...props }: ListProps,\n  state: ListState<T>,\n  ref: React.RefObject<HTMLElement>\n) {\n  const {\n    listProps: { onMouseDown, ...listProps },\n  } = useSelectableList({\n    ...props,\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    collection: state.collection,\n    disabledKeys: state.disabledKeys,\n    // if selectOnFocus is going to be an option (which is not in intellij UI), we should also conditionally show outline on items\n    selectOnFocus: true,\n  });\n\n  useCollectionFocusProxy({\n    focusProxyRef,\n    onAction,\n    state,\n    collectionRef: ref,\n  });\n\n  const [focused, setFocused] = useState(false);\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  // auto select the first item, if selection is empty and allowEmptySelection is false.\n  useEffect(() => {\n    const firstKey = state.collection.getFirstKey();\n    if (\n      !props.allowEmptySelection &&\n      state.selectionManager.isEmpty &&\n      firstKey\n    ) {\n      state.selectionManager.setFocusedKey(firstKey);\n      state.selectionManager.select(firstKey);\n    }\n  }, [!props.allowEmptySelection]);\n\n  const onActionCallback = useEventCallback(onAction ?? (() => {}));\n  const listContext: ListContextType<T> = useMemo(\n    () => ({\n      state,\n      focused: Boolean(focused || showAsFocused),\n      onAction: onActionCallback,\n    }),\n    [state, focused, showAsFocused]\n  );\n\n  return {\n    listProps: mergeProps(listProps, focusWithinProps),\n    listContext,\n    focused,\n  };\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {\n  Collection,\n  FocusStrategy,\n  KeyboardDelegate,\n  Node,\n} from \"@react-types/shared\";\nimport { HTMLAttributes, Key, RefObject, useMemo } from \"react\";\nimport { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport {\n  MultipleSelectionManager,\n  SelectionManager,\n} from \"@react-stately/selection\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { useCollectionAutoScroll } from \"@intellij-platform/core/Collections/useCollectionAutoScroll\";\n\ninterface SelectableListOptions {\n  /**\n   * An interface for reading and updating multiple selection state.\n   */\n  selectionManager: MultipleSelectionManager;\n  /**\n   * State of the collection.\n   */\n  collection: Collection<Node<unknown>>;\n  /**\n   * The item keys that are disabled. These items cannot be selected, focused, or otherwise\n   * interacted with.\n   */\n  disabledKeys: Set<Key>;\n  /**\n   * A ref to the item.\n   */\n  ref: RefObject<HTMLElement>;\n  /**\n   * A delegate that returns collection item keys with respect to visual layout.\n   */\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Whether the collection or one of its items should be automatically focused upon render.\n   * @default false\n   */\n  autoFocus?: boolean | FocusStrategy;\n  /**\n   * Whether focus should wrap around when the end/start is reached.\n   * @default false\n   */\n  shouldFocusWrap?: boolean;\n  /**\n   * Whether the option is contained in a virtual scroller.\n   */\n  isVirtualized?: boolean;\n  /**\n   * Whether the collection allows empty selection.\n   * @default false\n   */\n  disallowEmptySelection?: boolean;\n  /**\n   * Whether selection should occur automatically on focus.\n   * @default false\n   */\n  selectOnFocus?: boolean;\n  /**\n   * Whether typeahead is disabled.\n   * @default false\n   */\n  disallowTypeAhead?: boolean;\n  /**\n   * Whether the collection items should use virtual focus instead of being focused directly.\n   */\n  shouldUseVirtualFocus?: boolean;\n  /**\n   * Whether navigation through tab key is enabled.\n   */\n  allowsTabNavigation?: boolean;\n}\n\ninterface SelectableListAria {\n  /**\n   * Props for the option element.\n   */\n  listProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles interactions with a selectable list.\n */\nexport function useSelectableList(\n  props: SelectableListOptions\n): SelectableListAria {\n  let {\n    selectionManager,\n    collection,\n    disabledKeys,\n    ref,\n    keyboardDelegate,\n    autoFocus,\n    shouldFocusWrap,\n    isVirtualized,\n    disallowEmptySelection,\n    selectOnFocus = false,\n    disallowTypeAhead,\n    shouldUseVirtualFocus,\n    allowsTabNavigation,\n  } = props;\n\n  // By default, a KeyboardDelegate is provided which uses the DOM to query layout information (e.g. for page up/page down).\n  // When virtualized, the layout object will be passed in as a prop and override this.\n  let collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n  let delegate = useMemo(\n    () =>\n      keyboardDelegate ||\n      new ListKeyboardDelegate(collection, disabledKeys, ref, collator),\n    [keyboardDelegate, collection, disabledKeys, ref, collator]\n  );\n  useCollectionAutoScroll(\n    { isVirtualized, selectionManager: selectionManager as SelectionManager },\n    ref\n  );\n\n  let { collectionProps } = useSelectableCollection({\n    ref,\n    selectionManager,\n    keyboardDelegate: delegate,\n    autoFocus,\n    shouldFocusWrap,\n    disallowEmptySelection,\n    selectOnFocus,\n    disallowTypeAhead,\n    shouldUseVirtualFocus,\n    allowsTabNavigation,\n  });\n\n  return {\n    listProps: collectionProps,\n  };\n}\n","import {\n  ListProps,\n  ListState,\n  useListState as originalUseListState,\n} from \"@react-stately/list\";\nimport {\n  CollectionRefProps,\n  useCollectionRef,\n} from \"@intellij-platform/core/Collections/useCollectionRef\";\n\nexport function useListState<T extends object>(\n  props: ListProps<T> & CollectionRefProps\n): ListState<T> {\n  const state = originalUseListState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  useCollectionRef(props, state);\n  return state;\n}\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { RefObject, useImperativeHandle } from \"react\";\n\nexport type CollectionRefProps = {\n  /**\n   * Gives imperative access to selection manager.\n   */\n  selectionManagerRef?: RefObject<SelectionManager>;\n};\n\n/**\n * Common imperative API for collections. Used in Lists at the moment. Tree components implement a different imperative\n * API that can be refactored later for more consistency.\n */\nexport function useCollectionRef(\n  { selectionManagerRef }: CollectionRefProps,\n  state: { selectionManager: SelectionManager }\n) {\n  useImperativeHandle(selectionManagerRef, () => state.selectionManager);\n}\n","import { styled } from \"../styled\";\n\nexport const StyledListSectionHeader = styled.div(({ theme }) => ({\n  paddingLeft: 8,\n  fontWeight: \"bold\",\n  lineHeight: \"20px\",\n  outline: \"none\",\n  cursor: \"default\",\n  color: theme.color(\"*.textForeground\", theme.color(\"*.foreground\")),\n}));\n","import { ReusableView } from \"@react-stately/virtualizer\";\nimport { Node } from \"@react-types/shared\";\nimport React, { ReactNode, useRef } from \"react\";\nimport {\n  layoutInfoToStyle,\n  useVirtualizerItem,\n  VirtualizerItem,\n  VirtualizerProps,\n} from \"@react-aria/virtualizer\";\nimport { StyledListSectionHeader } from \"@intellij-platform/core/List/StyledListSectionHeader\";\n\ninterface SectionProps<T> {\n  reusableView: ReusableView<Node<T>, unknown>;\n  header: ReusableView<Node<T>, unknown>;\n  children?: ReactNode;\n}\n\nfunction ListSection<T extends object>({\n  reusableView,\n  header,\n  children,\n}: SectionProps<T>) {\n  const headerRef = useRef<HTMLDivElement>(null);\n  useVirtualizerItem({\n    reusableView: header,\n    ref: headerRef,\n  });\n  return (\n    <>\n      <StyledListSectionHeader\n        role=\"presentation\"\n        ref={headerRef}\n        style={layoutInfoToStyle(header.layoutInfo!, \"ltr\")}\n      >\n        {reusableView.content.rendered}\n      </StyledListSectionHeader>\n      <div\n        key={reusableView.key}\n        style={layoutInfoToStyle(reusableView.layoutInfo!, \"ltr\")}\n      >\n        {children}\n      </div>\n    </>\n  );\n}\n\nexport const renderWrapper: VirtualizerProps<\n  Node<any>,\n  unknown\n>[\"renderWrapper\"] = (parent, reusableView, children, renderChildren) => {\n  if (reusableView.viewType === \"section\") {\n    return (\n      <ListSection\n        key={reusableView.key}\n        reusableView={reusableView}\n        header={children.find((c) => c.viewType === \"header\")!}\n      >\n        {renderChildren(children.filter((c) => c.viewType === \"item\"))}\n      </ListSection>\n    );\n  }\n  return (\n    <VirtualizerItem\n      key={reusableView.key}\n      reusableView={reusableView}\n      parent={parent ?? undefined}\n    />\n  );\n};\n","import React, { HTMLAttributes, useMemo } from \"react\";\nimport { VirtualizerProps } from \"@react-aria/virtualizer\";\nimport { VariableWidthListLayout } from \"@intellij-platform/core/VariableWidthListLayout\";\nimport { ListState } from \"@react-stately/list\";\nimport { Node } from \"@react-types/shared\";\nimport { renderWrapper } from \"./renderWrapper\";\nimport { ListDivider } from \"@intellij-platform/core/List/ListDivider\";\n\ninterface ItemNode<T> extends Node<T> {\n  type: \"item\";\n}\nexport const useListVirtualizer = <T extends object>({\n  renderItem,\n  estimatedItemHeight = 20,\n  state,\n}: {\n  renderItem: (item: ItemNode<T>) => React.ReactNode;\n  estimatedItemHeight?: number;\n  state: ListState<T>;\n}): {\n  virtualizerProps: Omit<\n    VirtualizerProps<Node<T>, unknown>,\n    keyof HTMLAttributes<HTMLElement>\n  > & { children: (type: string, content: Node<T>) => React.ReactNode };\n} => {\n  const layout = useMemo(\n    () =>\n      new VariableWidthListLayout<T>({\n        /**\n         * there is currently no documentation available for these fields, but setting `rowHeight` enforces it, which\n         * wouldn't be good for custom tree UI with a different row height.\n         * wrong estimatedRowHeight seems to only affect small scrollbar position inaccuracy, which is a minor issue\n         * and not even noticeable in most cases. Also, it seems it slightly improves the performance if it exactly\n         * matches the real row height. But not even sure.\n         */\n        estimatedRowHeight: estimatedItemHeight,\n        estimatedHeadingHeight: 20,\n        dividerHeight: 2,\n      }),\n    []\n  );\n  layout.collection = state.collection;\n  layout.disabledKeys = state.disabledKeys;\n\n  return {\n    virtualizerProps: {\n      focusedKey: state.selectionManager.focusedKey,\n      collection: state.collection,\n      layout,\n      // Not clear how this sizeToFit is supposed to work, due to lack of documentation, but don't be tempted to\n      // think it solves the problem VariableWidthListLayout is trying to solve, because it doesn't :D\n      // Also, note that setting this to \"width\" prevents re-layout when container width is increased, which\n      // causes issues.\n      sizeToFit: \"height\",\n      scrollToItem: (key) => {\n        return layout.virtualizer.scrollToItem(key, {\n          shouldScrollX: false,\n          duration: 0,\n        });\n      },\n      children: (type, item) => {\n        if (type === \"item\") {\n          return renderItem(item as ItemNode<T>);\n        }\n        if (type === \"divider\") {\n          return <ListDivider key={item.key} />;\n        }\n      },\n      renderWrapper,\n\n      scrollDirection: \"both\",\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLAttributes, HTMLProps } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { OverlayTriggerProps } from \"@react-types/overlays\";\n\nimport { useContextMenu, UseContextMenuProps } from \"./useContextMenu\";\nimport { MenuOverlayFromOrigin } from \"@intellij-platform/core/Menu/MenuOverlayFromOrigin\";\n\ninterface ContextMenuContainerProps\n  extends Omit<HTMLProps<HTMLDivElement>, \"children\">,\n    UseContextMenuProps {\n  /**\n   * Will be called to return the Menu when context menu is triggered. Use {@link Menu} component to render a menu.\n   */\n  renderMenu: () => React.ReactNode;\n  /**\n   * If children is a function, context menu props is passed to it, to be passed to the underlying element.\n   * Otherwise, a div container will be rendered.\n   */\n  children:\n    | React.ReactNode\n    | ((props: HTMLAttributes<HTMLElement>) => React.ReactNode);\n}\n\n/**\n * A generic container for context menu. It's the same as a normal div, only with an additional `renderMenu` prop,\n * to be used to render context menu, when it's triggered.\n * Closes the menu when a menu action is triggered.\n */\nexport const ContextMenuContainer = React.forwardRef(\n  (\n    {\n      children,\n      renderMenu,\n      onOpen,\n      isDisabled,\n      ...props\n    }: ContextMenuContainerProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    const state = useMenuTriggerState({} as OverlayTriggerProps);\n\n    const { positionOrigin, containerProps, overlayRef } = useContextMenu(\n      { onOpen, isDisabled },\n      state\n    );\n    const allProps = mergeProps(props, containerProps);\n    return (\n      <>\n        {typeof children === \"function\" ? (\n          children(allProps)\n        ) : (\n          <div {...allProps} ref={ref}>\n            {children}\n          </div>\n        )}\n        {state.isOpen && (\n          <MenuOverlayFromOrigin\n            onClose={state.close}\n            ref={overlayRef}\n            origin={positionOrigin}\n            /**\n             * Context menus don't autofocus the first item in the reference impl.\n             * Note that this just defines the default value, and can always be controlled per case on the rendered Menu\n             */\n            defaultAutoFocus={true}\n          >\n            {renderMenu()}\n          </MenuOverlayFromOrigin>\n        )}\n      </>\n    );\n  }\n);\n\n/**\n * Data attribute name to be used to mark an element as the reference for positioning a contextual menu.\n */\nexport const MENU_POSITION_TARGET_DATA_ATTRIBUTE =\n  \"data-context-menu-position-target\";\n","import React, { useRef, useState } from \"react\";\nimport { MenuTriggerState } from \"@react-stately/menu\";\n\nexport type UseContextMenuProps = {\n  /**\n   * Whether opening contextmenu is disabled.\n   */\n  isDisabled?: boolean;\n  /**\n   * Called when contextmenu is opened.\n   * @param args\n   */\n  onOpen?: (args: {\n    /**\n     * The target element on which contextmenu event was triggered.\n     */\n    target: Element;\n  }) => void;\n};\n/**\n * Functionality and accessibility of context menu.\n */\nexport const useContextMenu = (\n  { isDisabled = false, onOpen }: UseContextMenuProps,\n  state: MenuTriggerState\n) => {\n  const [positionOrigin, setPositionOrigin] = useState<React.MouseEvent>();\n  /**\n   * NOTE: not using useMenuTrigger because:\n   * - There is no option to have a trigger like this: \"right click + long press only by touch\" which seems to be the\n   *   reasonable trigger for context menu. If we want to use it just for long press, we could disable it if it's not\n   *   a touch device, but that would be suboptimal, since both touch and mouse can be available, and it should depend\n   *   not on availability of touch, but on the triggered event type. Plus, isDisabled is broken in v<3.5.0\n   * - It's not quite clear at the moment, if the aria attributes that useMenuTrigger sets would be applicable to\n   *   this context menu component too. The trigger is not the container. For example, if there is a list rendered\n   *   inside, the selected item would be the trigger. Maybe even this component, as a container for context menu\n   *   is not the best way to allow for context menu, when it comes to a11y concerns. For now, we skip a11y props of the\n   *   trigger. A11y props of the menu itself (e.g. aria-label) would also be up to the usage of this component.\n   *\n   *   TODO: add support for long touch\n   */\n  const onContextMenu = (e: React.MouseEvent<HTMLElement>) => {\n    if (!(e.target instanceof Element)) {\n      return;\n    }\n    setPositionOrigin(e);\n    onOpen?.({ target: e.target });\n    e.preventDefault();\n    // NOTE: we can't use offsetX/offsetY, because it would depend on the exact target that was clicked.\n    if (state.isOpen) {\n      /**\n       * If the context menu is already open, closing and reopening makes sure the menu properly gains the focus.\n       * Otherwise, the focus may go back to the background.\n       * It also better matches the reference impl.\n       */\n      state.close();\n      setTimeout(() => {\n        state.open(null);\n      });\n    } else {\n      state.open(null);\n    }\n  };\n\n  const overlayRef = useRef(null);\n\n  const containerProps: React.HTMLAttributes<HTMLElement> = isDisabled\n    ? {}\n    : {\n        onContextMenu,\n      };\n  return {\n    /**\n     * props to be applied on the container element which is supposed to have the context menu\n     */\n    containerProps,\n    /**\n     * The ref to be applied on the menu overlay wrapper. It's usually an input instead of an output in similar\n     * react-aria hooks, but it seemed unnecessary here.\n     */\n    overlayRef,\n\n    positionOrigin,\n  };\n};\n","import { Item, PartialNode, Section } from \"@react-stately/collections\";\nimport { Item as Item2 } from \"./Item\";\nimport {\n  CollectionBase,\n  CollectionElement,\n  ItemProps,\n  SectionProps,\n} from \"@react-types/shared\";\nimport React from \"react\";\n\nfunction* patchCollectionItem<T>(nodes: Generator<PartialNode<T>>) {\n  for (const partialNode of nodes)\n    yield {\n      ...partialNode,\n      *childNodes() {\n        const result2 = partialNode.childNodes?.();\n        if (result2) {\n          for (const partialChildNode of result2) {\n            const { type, ...partialChildNodeWithoutType } = partialChildNode;\n            yield partialChildNodeWithoutType;\n          }\n        }\n      },\n    };\n}\n\nconst PatchedItem = Item.bind(null);\n\n// @ts-expect-error: getCollectionNode is not public\nPatchedItem.getCollectionNode = function getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: any\n): Generator<PartialNode<T>> {\n  // @ts-expect-error getCollectionNode is not public API\n  return patchCollectionItem(Item.getCollectionNode(props, context));\n};\n\nconst PatchedSection = Section.bind(null);\n\n// @ts-expect-error: getCollectionNode is not public\nPatchedSection.getCollectionNode = function getCollectionNode<T>(\n  props: SectionProps<T>,\n  context: any\n): Generator<PartialNode<T>> {\n  // @ts-expect-error getCollectionNode is not public API\n  return patchCollectionItem(Section.getCollectionNode(props, context));\n};\nfunction convertCollectionElement<T>(\n  result: CollectionElement<T> | React.ReactNode\n): CollectionElement<T> {\n  if (\n    React.isValidElement(result) &&\n    (result.type === Item || result.type === Item2)\n  ) {\n    return React.createElement(\n      PatchedItem,\n      {\n        key: result.key != null ? result.key : undefined,\n        ...(result.props as ItemProps<T>),\n      },\n      convertChildren(result.props.children)\n    ) as CollectionElement<T>;\n  }\n  if (React.isValidElement(result) && result.type === Section) {\n    return React.createElement(\n      PatchedSection,\n      {\n        key: result.key != null ? result.key : undefined,\n        ...(result.props as SectionProps<T>),\n      } as any,\n      convertChildren((result.props as any).children)\n    ) as CollectionElement<T>;\n  }\n  return result as CollectionElement<T>;\n}\n\nfunction convertChildren<T>(children: React.ReactNode): React.ReactNode {\n  return Array.isArray(children)\n    ? // NOTE: We intentionally avoid using React.Children.map as it messes with keys.\n      children.map(convertChildren)\n    : convertCollectionElement(children);\n}\n\n/**\n * CollectionBuilder expects child type to be the same as parent type, which is weird in the first place:\n * https://github.com/adobe/react-spectrum/blob/cae83ff95f2f709b761c70d47ace96d6346ed873/packages/%40react-stately/collections/src/CollectionBuilder.ts#L148\n * On the other hand, the default Item components sets the `type` to item, for all child PartialNode objects:\n * https://github.com/adobe/react-spectrum/blob/c49d9819adc2cb63377f39557352440c72072caf/packages/%40react-stately/collections/src/Item.ts#L40-L54\n * Which is also a little unexpected, as in many nested collections, an item can have all types of children.\n * This function patches that, replacing Item elements with PatchedItem element which doesn't set type on children\n * PartialNodes.\n */\nexport function patchCollectionProps<T>({\n  children,\n  ...props\n}: Partial<CollectionBase<T>>): CollectionBase<T> {\n  return {\n    ...props,\n    children:\n      typeof children === \"function\"\n        ? (node: T) => convertChildren(children(node)) as CollectionElement<T>\n        : (convertChildren(children) as CollectionElement<T>),\n  };\n}\n","import React, { CSSProperties, Key, RefObject, useContext } from \"react\";\nimport { AriaMenuOptions, useMenu as useMenuAria } from \"@react-aria/menu\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { AriaMenuProps } from \"@react-types/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { patchCollectionProps } from \"@intellij-platform/core/Collections/patchCollectionProps\";\nimport { TreeProps, useTreeState } from \"../Tree/useTreeState\"; // shared dependency between tree and menu, that could be lifted up import {Submenu} from '@intellij-platform/core/Menu/Submenu'\nimport { renderMenuNodes } from \"./renderMenuNodes\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { SubmenuProps } from \"./Submenu\"; // internal export\n\nexport interface MenuProps<T>\n  extends Omit<\n    AriaMenuProps<T>,\n    // selection is not properly supported for nested menus. Plus, it's not even that meaningful for a nested menu\n    // at least the way it's implemented now.\n    | \"onSelectionChange\"\n    | \"defaultSelectedKeys\"\n    | \"selectionMode\"\n    | \"disallowEmptySelection\"\n  > {\n  /**\n   * Indicates currently expanded menu item (controlled).\n   */\n  expandedKey?: Key; // FIXME: should be keys\n  /**\n   * Called when expanded menu item is changed by user interaction, which can be either hovering over the menu item\n   */\n  onExpandedKeyChange?: (expandedKey: Key) => void; // FIXME: should be keys\n  defaultExpandedKey?: Key; // FIXME: should be keys\n  /**\n   * @deprecated\n   */\n  expandOn?: \"hover\" | \"press\"; // hover delay doesn't seem to be needed as an option\n\n  /**\n   * Defines the press behaviour (either by mouse or by pressing Enter when focused) on menu items with submenu.\n   * By default (undefined), pressing or hovering over a menu item with submenu, opens the submenu.\n   * When set to \"toggle\", pressing a menu item with submenu will toggle the submenu. Hovering over such items will\n   * no longer open the submenu.\n   * When set to \"action\", pressing a menu item with submenu will call onAction for that item, and closes the menu.\n   * Hovering over such items will no longer open the submenu.\n   *\n   * In all cases, pressing the right arrow will always open the submenu.\n   */\n  submenuBehavior?: \"default\" | \"toggleOnPress\" | \"actionOnPress\";\n\n  /**\n   * fills the available horizontal or vertical space, when rendered in a flex container.\n   */\n  fillAvailableSpace?: boolean;\n\n  /**\n   * Minimum width of the menu\n   * @default: 120px\n   */\n  minWidth?: CSSProperties[\"minWidth\"];\n}\n\n/**\n * Can be provided by the overlay where the menu is rendered in. If provided, menu will call the provided close function\n * on actions. Note that there is no `closeOnSelect` option as of now, on this context, since no use case seems to exist\n * for keeping the menu overlay open after a menu item is selected.\n * **Update**: there are use cases where the menu is not closed after an item is clicked. Most of the toggle-able\n * actions (the ones with a checkmark) seem to be like this.\n * TODO: Make \"close on selection\" more flexible. Some ideas:\n *  - instead of calling close, pass it to `onAction` handler. Then on each action, one would need to call close if\n *    needed.\n *  - Offer a `MenuItem` component to be used instead of generic `Item`, where it accepts `closeOnSelect` boolean, which\n *    is true by default.\n *  - pass a `keepOpen` function to `onAction`.\n *  - Allow signaling whether the menu should kept open, via the returned value of onAction. e.g. return false means keep open.\n *  Last two suggestions are based on the assumption that most of the menu items are not selectable.\n *  Note that MenuOverlayContext could be used directly in action handlers too, but baking it into the menu makes it\n *  much more convenient, which seems more important than breaking the nice separation between Menu and MenuTrigger.\n */\nexport const MenuOverlayContext = React.createContext<{\n  close: () => void;\n  defaultAutoFocus: MenuProps<unknown>[\"autoFocus\"];\n}>({\n  close: () => {},\n  defaultAutoFocus: undefined,\n});\nexport const MenuContext = React.createContext<\n  Pick<\n    MenuProps<unknown>,\n    \"onClose\" | \"onAction\" | \"submenuBehavior\" | \"autoFocus\"\n  > & {\n    itemWrapper?: (\n      renderedItem: React.ReactNode,\n      item: Node<unknown>\n    ) => React.ReactNode;\n    renderSubmenu?: (props: SubmenuProps<unknown>) => React.ReactNode;\n  }\n>({});\n\nexport function useMenu<T>(\n  {\n    onAction: onActionProp,\n    submenuBehavior = \"default\",\n    ...props\n  }: MenuProps<T> & AriaMenuOptions<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const { close, defaultAutoFocus } = useContext(MenuOverlayContext);\n  const autoFocus = props.autoFocus ?? defaultAutoFocus;\n  const onClose = () => {\n    props.onClose?.();\n    close();\n  };\n  const onAction = (key: Key) => {\n    if (\n      // The following check should have been in useMenu, but it's not currently. Probably because they haven't yet\n      // covered nested menus.\n      !state.collection.getItem(key)?.hasChildNodes\n    ) {\n      return onActionProp?.(key);\n    } else if (submenuBehavior === \"actionOnPress\") {\n      onClose();\n      return onActionProp?.(key);\n    }\n  };\n  const menuContextValue: React.ContextType<typeof MenuContext> = {\n    submenuBehavior,\n    autoFocus,\n    onAction,\n    onClose,\n  };\n  const { menuProps } = useMenuAria(\n    { ...props, onAction, onClose, autoFocus },\n    state,\n    ref\n  );\n\n  return {\n    menuProps,\n    menuContextValue,\n  };\n}\n\nexport function useMenuState<T extends object>(\n  props: TreeProps<T> &\n    Pick<\n      MenuProps<T>,\n      \"expandedKey\" | \"defaultExpandedKey\" | \"onExpandedKeyChange\"\n    >\n) {\n  props = patchCollectionProps(props);\n  return useTreeState({\n    ...props,\n    childExpansionBehaviour: \"single\",\n    expandedKeys: props.expandedKey ? [props.expandedKey] : undefined,\n    onExpandedChange: ([firstKey]) => props?.onExpandedKeyChange?.(firstKey),\n    defaultExpandedKeys: props.defaultExpandedKey\n      ? [props.defaultExpandedKey]\n      : undefined,\n  });\n}\n\n/**\n * UI for menus which are normally shown in a popover. Being rendered as an overlay is not handled here.\n * Also, there is no coupling with any higher level entity like \"Action\", since this is just for the UI layer.\n * Something like ActionMenu which creates a menu out of a list of actions can be implemented on top of this.\n *\n * @example\n *  <Menu>\n *    <Item>Item one</Item>\n *    <Item>\n *      <MenuItemLayout\n *        icon={<PlatformIcon icon={\"actions/copy\"} />}\n *        content=\"Copy\"\n *        shortcut={\"⌘C\"} />\n *    </Item>\n *  </Menu>\n *\n *  Current issues and limitations:\n *  - Divider in sub-menu's is not supported. because of a constraint in @react-stately/collections, which results in\n *    this error: Unsupported type <Divider> in <Item>. Only <Item> is supported. Maybe supporting section would\n *    be a workaround for it.\n *  - when a parent menu item which has an open submenu is hovered, it gets focus.\n */\nexport function Menu<T extends object>({ minWidth, ...props }: MenuProps<T>) {\n  const ref = React.useRef<HTMLUListElement>(null);\n  const state = useMenuState(props);\n  const { menuContextValue, menuProps } = useMenu(props, state, ref);\n\n  return (\n    /**\n     * MenuContext is used to pass onAction and onClose to be passed to useMenu in submenus.\n     * That's needed because in useMenuItem onAction and onClose are read off a WeakMap which has the menu state\n     * (TreeState) as key. So we have to pass onAction and onClose everytime we call useMenu in submenus, to let the\n     * menu items in that submenu access the right value of onAction and onClose. To avoid drilling these props down,\n     * we keep it in a context.\n     */\n    <MenuContext.Provider value={menuContextValue}>\n      <StyledMenu\n        {...menuProps}\n        ref={ref}\n        style={{ minWidth }}\n        fillAvailableSpace={props.fillAvailableSpace}\n      >\n        {renderMenuNodes(state, [...state.collection])}\n      </StyledMenu>\n    </MenuContext.Provider>\n  );\n}\n","import React, { HTMLAttributes, ReactNode, RefObject, useContext } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { isFocusVisible, useHover, usePress } from \"@react-aria/interactions\";\nimport {\n  AriaMenuItemProps,\n  MenuItemAria,\n  useMenuItem as useMenuItemAria,\n} from \"@react-aria/menu\";\nimport { useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { FocusableElement, Node } from \"@react-types/shared\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\nimport { Overlay } from \"@intellij-platform/core/Overlay\";\n\nimport { LafIcon, PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\nimport { MenuContext, MenuProps } from \"./Menu\";\nimport { MENU_BORDER_WIDTH, MENU_VERTICAL_PADDING } from \"./StyledMenu\";\nimport {\n  StyledMenuItem,\n  StyledMenuItemIcon,\n  StyledNestedArrow,\n} from \"./StyledMenuItem\";\nimport { Submenu, SubmenuProps } from \"@intellij-platform/core/Menu/Submenu\";\n\nexport interface MenuItemProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  onSubmenuClose?: () => void;\n}\n\nconst StyledMenuItemText = styled.span`\n  flex: 1;\n`;\n\nconst StyledMenuItemPlatformIcon = styled(PlatformIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nconst StyledMenuItemLafIcon = styled(LafIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nfunction useMenuItem<T extends unknown>(\n  {\n    submenuBehavior,\n    ...props\n  }: AriaMenuItemProps & { submenuBehavior: MenuProps<T>[\"submenuBehavior\"] },\n  state: TreeState<T>,\n  ref: RefObject<FocusableElement>\n): MenuItemAria {\n  const item = state.collection.getItem(props.key!)!;\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const hasSubmenu = item.hasChildNodes;\n  const { menuItemProps: ariaMenuItemProps, ...result } = useMenuItemAria(\n    {\n      key: item.key,\n      // hack to prevent react-aria to call onClose when nested items are selected, which is incorrect, and because\n      // react-aria doesn't officially support nested menus at the moment\n      onClose: hasSubmenu ? () => {} : undefined,\n    },\n    state,\n    ref\n  );\n\n  // useMenuItem in react aria utilizes useHover to focus item on hover. The logic there conflicts with nested menus\n  // requirements (at least based on how nested menu is implemented here currently). Also, submenuBehavior requires\n  // some more customization. So we delete the handlers set by useHover in useMenuItem, and add a custom useHover.\n  delete ariaMenuItemProps.onMouseEnter;\n  delete ariaMenuItemProps.onPointerEnter;\n\n  if (submenuBehavior === \"default\" && isExpanded) {\n    // When menu item has its submenu opened, clicking it should not move focus or do anything.\n    delete ariaMenuItemProps.onPointerDown;\n  }\n\n  const { hoverProps } = useHover({\n    isDisabled: isDisabled,\n    onHoverStart: () => {\n      const isAnySubmenuOpen = [...state.expandedKeys].some(\n        (expandedKey) =>\n          state.collection.getItem(expandedKey)?.parentKey === item.parentKey\n      );\n\n      if (submenuBehavior === \"default\" && !isExpanded) {\n        state.toggleKey(item.key);\n      }\n\n      if (!isFocusVisible()) {\n        const shouldFocus =\n          submenuBehavior === \"default\" ? !isExpanded : !isAnySubmenuOpen;\n        if (shouldFocus) {\n          state.selectionManager.setFocused(true);\n        }\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  const keyboardProps = {\n    onKeyDown: (e: React.KeyboardEvent) => {\n      if (\n        ((e.key === \"Enter\" || e.key === \" \") &&\n          submenuBehavior !== \"actionOnPress\") ||\n        \"ArrowRight\" === e.key\n      ) {\n        state.toggleKey(item.key);\n        e.stopPropagation();\n        return;\n      }\n    },\n  };\n\n  const { pressProps: togglePressProps } = usePress({\n    isDisabled: isDisabled,\n    onPressUp: () => {\n      state.toggleKey(item.key);\n      if (isExpanded) {\n        // submenu was expanded and is closed now. moving focus back to the parent item\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  return {\n    ...result,\n    menuItemProps: mergeProps(\n      hasSubmenu\n        ? {\n            \"aria-expanded\": isExpanded,\n            \"aria-haspopup\": \"menu\",\n          }\n        : {},\n      ariaMenuItemProps,\n      hoverProps,\n      keyboardProps,\n      submenuBehavior === \"toggleOnPress\" ? togglePressProps : {}\n    ),\n  };\n}\n\nconst MenuItemContext = React.createContext<{\n  labelProps: HTMLAttributes<HTMLElement>;\n  descriptionProps: HTMLAttributes<HTMLElement>;\n  keyboardShortcutProps: HTMLAttributes<HTMLElement>;\n}>({ descriptionProps: {}, labelProps: {}, keyboardShortcutProps: {} });\n\nexport const useMenuItemLayout = () => {\n  return useContext(MenuItemContext);\n};\n\nexport function MenuItem<T>({ item, state }: MenuItemProps<T>) {\n  // Get props for the menu item element\n  const ref = React.useRef<HTMLLIElement>(null);\n  const nestedMenuRef = React.useRef<HTMLDivElement>(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const isSelected = state.selectionManager.selectedKeys.has(item.key);\n  const isFocused = state.selectionManager.focusedKey === item.key;\n  const {\n    onClose,\n    submenuBehavior,\n    renderSubmenu = (props: SubmenuProps<T>) => <Submenu {...props} />,\n    itemWrapper = (i: React.ReactNode) => i,\n  } = useContext(MenuContext);\n\n  const { menuItemProps, labelProps, descriptionProps, keyboardShortcutProps } =\n    useMenuItem(\n      {\n        submenuBehavior,\n        key: item.key,\n      },\n      state,\n      ref\n    );\n\n  const { pressProps: togglePressProps } = usePress({\n    isDisabled: isDisabled,\n    onPressUp: () => {\n      state.toggleKey(item.key);\n      if (isExpanded) {\n        // submenu was expanded and is closed now. moving focus back to the parent item\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  let { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: ref,\n    overlayRef: nestedMenuRef,\n    placement: \"right top\",\n    shouldFlip: true,\n    onClose,\n    offset: 0,\n    crossOffset: -(MENU_VERTICAL_PADDING + MENU_BORDER_WIDTH),\n    isOpen: isExpanded,\n  });\n\n  const arrowProps: HTMLAttributes<HTMLElement> =\n    submenuBehavior !== \"default\"\n      ? {\n          role: \"button\",\n          \"aria-label\": \"Open\",\n          ...mergeProps(togglePressProps, {\n            // to prevent pointer up event handler on the item, which would trigger action.\n            onPointerUp: (e: React.PointerEvent) => e.stopPropagation(),\n          }),\n        }\n      : {};\n  return (\n    <>\n      <StyledMenuItem\n        {...menuItemProps}\n        isDisabled={isDisabled}\n        isActive={isFocused}\n        ref={ref}\n      >\n        {isSelected && (\n          <StyledMenuItemIcon>\n            <StyledMenuItemLafIcon\n              icon={{\n                name: \"checkmark\",\n                modifiers: { Selected: isFocused },\n              }}\n            />\n          </StyledMenuItemIcon>\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isContainerFocused: state.selectionManager.isFocused,\n            isSelected,\n            node: item,\n          }}\n        >\n          <MenuItemContext.Provider\n            value={{ labelProps, descriptionProps, keyboardShortcutProps }}\n          >\n            {itemWrapper(\n              typeof item.rendered === \"string\" ? (\n                <StyledMenuItemText {...labelProps}>\n                  {item.rendered}\n                </StyledMenuItemText>\n              ) : (\n                item.rendered\n              ),\n              item\n            )}\n          </MenuItemContext.Provider>\n        </ItemStateContext.Provider>\n        {item.hasChildNodes && (\n          <StyledNestedArrow {...arrowProps}>\n            <StyledMenuItemPlatformIcon icon=\"icons/ide/menuArrow\" />\n          </StyledNestedArrow>\n        )}\n      </StyledMenuItem>\n      {isExpanded && (\n        /**\n         * A note about using Overlay:\n         * If sub-menu is not rendered in a portal, useOverlayPosition doesn't work properly and the submenu may\n         * be rendered offscreen. Worse, it may introduce scroll in body (or some scrollable ancestor), which will\n         * trigger a scroll event which closes the menu if the menu is rendered in an overlay (like in MenuTrigger),\n         * which is almost always the case.\n         *\n         */\n        <Overlay\n          OverlayComponent={\n            /**\n             *  The FocusScope included in the default Overlay, messes with a particular expected behavior. So we use\n             *  SimpleOverlay, which just renders its children as a portal. There may be a better solution for that\n             *  problem, which would eliminate the need for the funky `OverlayComponent` prop on our `Overlay`\n             *  component. Something to look into in the future.\n             */\n            SimpleOverlay\n          }\n        >\n          <div ref={nestedMenuRef} {...positionProps}>\n            {renderSubmenu({ parentState: state, rootKey: item.key })}\n          </div>\n        </Overlay>\n      )}\n    </>\n  );\n}\n\n/**\n * A replacement for react-aria Overlay, which doesn't render FocusScope\n */\nfunction SimpleOverlay({\n  children,\n  portalContainer = document.body,\n}: {\n  children: ReactNode;\n  portalContainer?: Element | undefined;\n}) {\n  return ReactDOM.createPortal(children, portalContainer);\n}\n","import React from \"react\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { useContextOrThrow } from \"@intellij-platform/core/utils/useContextOrThrow\";\n\nimport { useMenuItemLayout } from \"./MenuItem\";\nimport { StyledMenuItemIcon } from \"./StyledMenuItem\";\n\ninterface MenuItemLayoutProps {\n  icon?: React.ReactNode;\n  content: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\nconst StyledMenuItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  flex: 1; // to make sure it takes as much space as available in the menu item row, so that the suffix (shortcut) is pushed to the right\n`;\nconst Content = styled.span`\n  flex: 1;\n`;\n\nconst Shortcut = styled.kbd`\n  font-family: system-ui, sans-serif;\n  margin-left: 30px;\n  margin-right: -0.625rem;\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"MenuItem.acceleratorForeground\")\n    )};\n`;\n\nexport const MenuItemLayout = ({\n  content,\n  shortcut,\n  icon,\n}: MenuItemLayoutProps) => {\n  const { isSelected } = useContextOrThrow(\n    ItemStateContext,\n    \"MenuItemLayout is meant to be rendered in Item component in Menus\"\n  );\n  const { labelProps, keyboardShortcutProps } = useMenuItemLayout();\n  const allowedIcon = !isSelected && icon;\n  return (\n    <StyledMenuItemLayout>\n      {allowedIcon && <StyledMenuItemIcon>{allowedIcon}</StyledMenuItemIcon>}\n      <Content {...labelProps}>{content}</Content>\n      {shortcut && <Shortcut {...keyboardShortcutProps}>{shortcut}</Shortcut>}\n    </StyledMenuItemLayout>\n  );\n};\n","import React, { HTMLProps, useEffect } from \"react\";\nimport { FocusScope } from \"@intellij-platform/core/utils/FocusScope\";\nimport {\n  MenuOverlayContext,\n  MenuProps,\n} from \"@intellij-platform/core/Menu/Menu\";\nimport { areInNestedOverlays, Overlay } from \"@intellij-platform/core/Overlay\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useOverlay, usePreventScroll } from \"@react-aria/overlays\";\n\nexport interface MenuOverlayProps {\n  children: React.ReactNode;\n  restoreFocus?: boolean;\n  overlayProps: HTMLProps<HTMLDivElement>;\n  overlayRef?: React.Ref<HTMLDivElement>;\n  /**\n   * Sets the default value of {@link Menu}'s {@link MenuProps#autoFocus} prop.\n   */\n  defaultAutoFocus?: MenuProps<unknown>[\"autoFocus\"];\n  onClose: () => void;\n}\n\n/**\n * Overlay container for Menu.\n * Positioning is not implemented at this layer.\n * {@link MenuOverlayProps#overlayProps} should be used for positioning.\n */\nexport function MenuOverlay({\n  children,\n  restoreFocus,\n  overlayProps: otherOverlayProps,\n  overlayRef: inputOverlayRef,\n  defaultAutoFocus,\n  onClose,\n}: MenuOverlayProps) {\n  const overlayRef = useObjectRef(inputOverlayRef);\n  const { overlayProps } = useOverlay(\n    {\n      onClose,\n      shouldCloseOnBlur: false,\n      isOpen: true,\n      isKeyboardDismissDisabled: false,\n      isDismissable: true,\n      shouldCloseOnInteractOutside: (element) => {\n        // FIXME: this is kind of hacky and should be removed when nested menu is properly supported\n        return !areInNestedOverlays(overlayRef.current, element);\n      },\n    },\n    overlayRef\n  );\n\n  usePreventScroll();\n\n  /**\n   * right clicks outside are not currently captured as \"outside interaction\" by react-aria's useOverlay hook.\n   * so we set up a global listener to close the context menu when contextmenu event is triggered outside the\n   * context menu container.\n   * NOTE: event handler is set up for the `capture` phase, to have it run before the handler for context menu\n   * when the menu is used as a context menu\n   */\n  useEffect(() => {\n    const onOutsideContextMenu = () => {\n      onClose();\n    };\n    document.addEventListener(\"contextmenu\", onOutsideContextMenu, {\n      capture: true,\n    });\n    return () =>\n      document.removeEventListener(\"contextmenu\", onOutsideContextMenu);\n  }, []);\n\n  return (\n    <Overlay>\n      <FocusScope restoreFocus={restoreFocus} autoFocus>\n        <MenuOverlayContext.Provider\n          value={{\n            close: onClose,\n            defaultAutoFocus,\n          }}\n        >\n          <div\n            {...mergeProps(overlayProps, otherOverlayProps)}\n            ref={overlayRef}\n          >\n            {children}\n          </div>\n        </MenuOverlayContext.Provider>\n      </FocusScope>\n    </Overlay>\n  );\n}\n","import React, { RefObject, useLayoutEffect, useState } from \"react\";\n\n/**\n * Similar to {@link import('@react-aria/overlays').useOverlayPosition useOverlayPosition},\n * but for positioning an overlay relative to a point, typically coordinates of a mouse event.\n * It's less advanced than useOverlayPosition, not taking into account many edge cases that\n * `useOverlayPosition` does.\n * Most importantly:\n * - Window resize is not taken into account\n * - Overlay resize is not taken into account.\n *   Positioning only happens when the origin changes.\n * - There are no options for positioning options like placement, offset or crossOffset\n *\n * @see https://github.com/adobe/react-spectrum/discussions/7267\n */\nexport function useOverlayPositionFromOrigin({\n  overlayRef,\n  origin,\n  containerPadding,\n}: {\n  overlayRef: RefObject<HTMLElement>;\n  containerPadding?: number | { x: number; y: number };\n  origin: Pick<React.MouseEvent, \"clientX\" | \"clientY\"> | undefined;\n}) {\n  const [position, setPosition] = useState<{ left?: number; top?: number }>({});\n\n  useLayoutEffect(() => {\n    const overlayElement = overlayRef.current;\n    setPosition(\n      origin && overlayElement\n        ? calculatePosition({\n            clientX:\n              origin.clientX +\n              1.5 /* a tiny offset is added to avoid menu items getting hovered upon open. 1px doesn't consistently work. */,\n            clientY: origin.clientY,\n            containerPadding,\n            overlayWidth: overlayElement.offsetWidth,\n            overlayHeight: overlayElement.offsetHeight,\n          })\n        : {}\n    );\n  }, [origin?.clientX, origin?.clientY]);\n  return {\n    positionProps: {\n      style: { position: \"fixed\", zIndex: 100000, ...position } as const,\n    },\n  };\n}\n\nfunction calculatePosition({\n  clientX,\n  clientY,\n  overlayWidth,\n  overlayHeight,\n  containerPadding = 0,\n}: {\n  clientX: number;\n  clientY: number;\n  overlayWidth: number;\n  overlayHeight: number;\n  containerPadding?: number | { x: number; y: number };\n}) {\n  const totalWidth =\n    document.documentElement.clientWidth -\n    (typeof containerPadding === \"object\"\n      ? containerPadding.x\n      : containerPadding);\n  const totalHeight =\n    document.documentElement.clientHeight -\n    (typeof containerPadding === \"object\"\n      ? containerPadding.y\n      : containerPadding);\n\n  let top = clientY;\n  let left = clientX;\n\n  if (left + overlayWidth > totalWidth) {\n    left = totalWidth - overlayWidth;\n  }\n\n  if (top + overlayHeight > totalHeight) {\n    top = totalHeight - overlayHeight;\n  }\n\n  top = Math.max(0, top);\n  left = Math.max(0, left);\n\n  return { top, left };\n}\n","import React, { ForwardedRef, useEffect, useMemo } from \"react\";\nimport {\n  MenuOverlay,\n  MenuOverlayProps,\n} from \"@intellij-platform/core/Menu/MenuOverlay\";\nimport { useOverlayPositionFromOrigin } from \"@intellij-platform/core/Menu/useOverlayPositionFromOrigin\";\nimport { getScrollParent, isScrollable, useObjectRef } from \"@react-aria/utils\";\nimport { createGlobalStyle } from \"styled-components\";\n\ninterface MenuOverlayFromOriginProps\n  extends Pick<MenuOverlayProps, \"onClose\" | \"defaultAutoFocus\"> {\n  /**\n   * Origin point within the viewport, based on which the menu overlay should be positioned.\n   * Any pointer/mouse event, or a plain object with clientX and clientY can be passed.\n   */\n  origin:\n    | {\n        /**\n         * Horizontal coordinate of the origin point within the viewport.\n         * See {@link MouseEvent.clientX}\n         */\n        clientX: number;\n        /**\n         * Vertical coordinate of the origin point within the viewport.\n         * See {@link MouseEvent.clientX}\n         */\n        clientY: number;\n\n        /**\n         * Origin's target element.\n         * Used to find the scrollable parent and disable scrolling while\n         * the overlay is rendered.\n         */\n        target?: EventTarget | HTMLElement | null;\n      }\n    | undefined;\n  children: React.ReactNode;\n}\n\nconst DisableScrollStyles = createGlobalStyle`\n  .disable-scroll {\n      overflow: hidden !important;\n  }\n`;\n\n/**\n * Menu overlay position based on an origin point on the screen.\n * Useful when the menu is opened by a pointer event.\n */\nexport const MenuOverlayFromOrigin = React.forwardRef(\n  function MenuOverlayFromOrigin(\n    { children, origin, ...otherProps }: MenuOverlayFromOriginProps,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) {\n    const overlayRef = useObjectRef(forwardedRef);\n    const { positionProps } = useOverlayPositionFromOrigin({\n      overlayRef,\n      origin,\n      containerPadding: { x: 0, y: 4 },\n    });\n\n    const scrollParent: null | Element = useMemo(() => {\n      if (!(origin?.target instanceof HTMLElement)) {\n        return null;\n      }\n      return isScrollable(origin.target)\n        ? origin.target\n        : getScrollParent(origin.target);\n    }, [origin?.target]);\n\n    useEffect(() => {\n      // Known issue: closing contextmenu causes a jump in scroll (see project view in example app)\n      // It's an issue that existed before the change to disable scroll when the contextmenu is open,\n      // so it should not have anythign to do with changing overflow hidden when the menu is open.\n      scrollParent?.classList?.add(\"disable-scroll\");\n      return () => {\n        scrollParent?.classList?.remove(\"disable-scroll\");\n      };\n    }, []);\n\n    return (\n      <>\n        <DisableScrollStyles />\n        {Boolean(origin) && (\n          <MenuOverlay\n            overlayProps={positionProps}\n            overlayRef={overlayRef}\n            restoreFocus\n            {...otherProps}\n          >\n            {children}\n          </MenuOverlay>\n        )}\n      </>\n    );\n  }\n);\n","import React, { HTMLAttributes, RefObject } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { AriaMenuOptions, useMenuTrigger } from \"@react-aria/menu\";\nimport { useOverlayPosition } from \"@react-aria/overlays\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { MenuTriggerProps as AriaMenuTriggerProps } from \"@react-types/menu\";\n\nimport { MenuOverlay } from \"./MenuOverlay\";\nimport { AriaButtonProps } from \"@react-types/button\";\nimport { Alignment } from \"@react-types/shared\";\n\nexport interface MenuTriggerProps\n  extends Omit<AriaMenuTriggerProps, \"closeOnSelect\"> {\n  restoreFocus?: boolean;\n  // TODO: replace render function children with normal children, and utilize PressResponder. Add a story for the\n  //  edge case of custom trigger, using PressResponder\n  children: (\n    props: HTMLAttributes<HTMLButtonElement>,\n    ref: RefObject<any> // Using a generic didn't seem to work for some reason\n  ) => React.ReactNode;\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean;\n  /**\n   * By default, the menu is positioned relative to the trigger. `positioningTargetRef` can be used to have the menu\n   * positioned to another element. An example use case is when the menu trigger is a button inside some list item or\n   * text box, but the menu semantically belongs to the container list item or text box.\n   */\n  positioningTargetRef?: React.RefObject<HTMLElement>;\n  renderMenu: (props: {\n    // AriaMenuOptions contains more properties than needed\n    menuProps: Pick<\n      AriaMenuOptions<unknown>,\n      \"id\" | \"aria-labelledby\" | \"autoFocus\" | \"onClose\"\n    >;\n  }) => React.ReactNode;\n\n  /**\n   * Alignment of the menu relative to the trigger.\n   * @default 'start'\n   */\n  align?: Alignment;\n  /**\n   * Where the Menu opens relative to its trigger.\n   * @default 'bottom'\n   */\n  direction?: \"bottom\" | \"top\" | \"left\" | \"right\" | \"start\" | \"end\";\n  /**\n   * Whether the menu should automatically flip direction when space is limited.\n   * @default true\n   */\n  shouldFlip?: boolean;\n}\n\n// FIXME: Escape doesn't close the menu\n// FIXME: Focus is not restored if nested menu are opened. It may be solved by using useOverlay and closing submenu in click outside.\n// FIXME: use PressResponder and replace render prop children with a normal react dom children. Issues with current impl:\n//  disabled trigger doesn't work as expected. props passed to children fn is html props, which is limiting for button\n//  components that don't accept arbitrary dom props.\n/**\n * Makes its children a trigger for a menu, rendered via {@link MenuTriggerProps#renderMenu} prop.\n * Closes the menu when a menu action is triggered.\n */\nexport const MenuTrigger: React.FC<MenuTriggerProps> = ({\n  children,\n  renderMenu,\n  direction = \"bottom\",\n  align = \"start\",\n  shouldFlip = true,\n  restoreFocus = true,\n  preventFocusOnPress = true,\n  positioningTargetRef,\n  ...otherProps\n}) => {\n  const state = useMenuTriggerState(otherProps);\n  const triggerRef = React.useRef(null);\n  const overlayRef = React.useRef(null);\n  // FIXME: Menu props is not used, but it's just about labelBy and id. Only needed for accessibility, but it would\n  //  require a `renderMenu` prop, instead of `menu`.\n  const { menuTriggerProps: triggerProps, menuProps } = useMenuTrigger(\n    { type: \"menu\" },\n    state,\n    triggerRef\n  );\n  const ariaButtonProps: AriaButtonProps<\"button\"> = {\n    ...triggerProps,\n    // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n    preventFocusOnPress,\n  };\n  const { buttonProps } = useButton(ariaButtonProps, triggerRef);\n\n  const { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: positioningTargetRef ?? triggerRef,\n    overlayRef,\n    placement: getPlacement(direction, align),\n    shouldFlip,\n    offset: 0,\n    containerPadding: 0,\n    onClose: () => state.close(),\n    isOpen: state.isOpen,\n  });\n\n  return (\n    <>\n      {children(buttonProps, triggerRef)}\n      {state.isOpen && (\n        <MenuOverlay\n          overlayProps={positionProps}\n          overlayRef={overlayRef}\n          onClose={state.close}\n          restoreFocus={restoreFocus}\n        >\n          {renderMenu({ menuProps })}\n        </MenuOverlay>\n      )}\n    </>\n  );\n};\n\nfunction getPlacement(\n  direction: Required<MenuTriggerProps>[\"direction\"],\n  align: Required<MenuTriggerProps>[\"align\"]\n) {\n  switch (direction) {\n    case \"left\":\n    case \"right\":\n    case \"start\":\n    case \"end\":\n      return `${direction} ${align === \"end\" ? \"bottom\" : \"top\"}` as const;\n    case \"bottom\":\n    case \"top\":\n    default:\n      return `${direction} ${align}` as const;\n  }\n}\n","import React, {\n  HTMLAttributes,\n  RefObject,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport {\n  mergeProps,\n  useLayoutEffect,\n  useResizeObserver,\n} from \"@react-aria/utils\";\nimport { focusSafely } from \"@react-aria/focus\";\nimport { ListCollection } from \"@react-stately/list\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  useCollectionSpeedSearch,\n  CollectionSpeedSearchMatches,\n} from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport {\n  SpeedSearchInput,\n  SpeedSearchPopupProps,\n  SpeedSearchState,\n} from \"@intellij-platform/core/SpeedSearch\";\n\nimport { StyledMenu } from \"./StyledMenu\";\nimport { MenuContext, MenuProps, useMenu, useMenuState } from \"./Menu\";\nimport { renderMenuNodes } from \"./renderMenuNodes\";\nimport { SubmenuProps, useSubmenu } from \"./Submenu\";\nimport { useSubmenuState } from \"./_useSubmenuState\";\nimport { MenuKeyboardDelegate } from \"./_useSubmenu\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\n\nexport interface SpeedSearchMenuProps<T>\n  extends Omit<MenuProps<T>, \"submenuBehavior\"> {\n  submenuBehavior?: Exclude<MenuProps<T>[\"submenuBehavior\"], \"default\">;\n  /**\n   * Text to show when the filtering is active but no match is found for the current query.\n   * @default \"Nothing to show\"\n   */\n  emptyText?: React.ReactNode;\n}\n\nconst StyledItemsContainer = styled.ul`\n  all: unset;\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledSearchFieldWrapper = styled.div`\n  flex-shrink: 0;\n  padding: 0 0.2rem 0.3rem;\n`;\n\nconst StyledSpeedSearchMenu = styled(StyledMenu)`\n  --jui-menu-item-padding: 1.25rem;\n  ${StyledVerticalSeparator} {\n    margin: 0 3px; // FIXME: probably use theme\n  }\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) =>\n    // Ref: StatusText => DEFAULT_ATTRIBUTES => SimpleTextAttributes.GRAYED_ATTRIBUTES\n    theme.color(\n      \"Component.infoForeground\",\n      theme.dark ? \"#787878\" : \"#999999\"\n    )};\n\n  // center positioning. Intentionally different from reference impl.\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n\n  white-space: nowrap;\n`;\n\nfunction useSpeedSearchMenu<T>(\n  state: TreeState<T>,\n  rootKey: React.Key | null,\n  ref: React.RefObject<HTMLUListElement>,\n  containerRef: React.RefObject<HTMLDivElement>\n) {\n  const {\n    speedSearch,\n    selectionManager,\n    keyboardDelegate,\n    containerProps: speedSearchContainerProps,\n    searchPopupProps,\n  } = useCollectionSpeedSearch({\n    collection: useMemo(\n      () =>\n        new ListCollection(\n          rootKey\n            ? state.collection.getItem(rootKey)?.childNodes ?? []\n            : state.collection\n        ),\n      [rootKey, state.collection]\n    ),\n    selectionManager: state.selectionManager,\n    keyboardDelegate: new MenuKeyboardDelegate(\n      rootKey,\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    keepSearchActiveOnBlur: true,\n    focusBestMatch: true,\n    ref,\n  });\n\n  // When a menu item which was focused is filtered out, the focus goes to body.\n  // We manually move focus back to the container.\n  useEffect(() => {\n    const element = ref.current;\n    if (\n      element &&\n      state.selectionManager.isFocused &&\n      !element?.contains(document.activeElement)\n    ) {\n      focusSafely(element);\n    }\n  });\n\n  const lastSize = useRef<{ width: number; height: number } | null>(null);\n  const [size, setSize] = useState<{ width: number; height: number } | null>(\n    null\n  );\n  const measureSize = () => {\n    const { offsetWidth = 0, offsetHeight = 0 } = containerRef.current || {};\n    if (offsetWidth > 0 && offsetHeight > 0) {\n      lastSize.current = {\n        width: offsetWidth,\n        height: offsetHeight,\n      };\n    }\n  };\n  const isSearchActive =\n    speedSearch.active && speedSearch.searchTerm.length > 0;\n  useResizeObserver({\n    ref: containerRef,\n    onResize: useEventCallback(() => {\n      if (!isSearchActive) {\n        measureSize();\n      }\n    }),\n  });\n  useLayoutEffect(() => {\n    if (isSearchActive) {\n      if (lastSize.current) {\n        setSize(lastSize.current);\n      }\n    } else {\n      if (!lastSize.current) {\n        measureSize();\n      }\n      setSize(null);\n    }\n  }, [isSearchActive]);\n\n  const sizeStyleProps: HTMLAttributes<HTMLElement> = size\n    ? {\n        style: {\n          ...size,\n          minHeight: size.height,\n          maxHeight: size.height,\n        },\n      }\n    : {};\n  return {\n    speedSearch,\n    keyboardDelegate,\n    selectionManager,\n    speedSearchContainerProps: mergeProps<HTMLAttributes<HTMLElement>[]>(\n      speedSearchContainerProps,\n      sizeStyleProps,\n      {\n        onMouseDown: (e: React.MouseEvent) => {\n          // Until SearchInput and connecting that to a selectable list is implemented, we should prevent menu from\n          // losing focus when the fake search input is clicked\n          e.preventDefault();\n        },\n      }\n    ),\n    searchPopupProps,\n  };\n}\n\n/**\n * Drop-in replacement for Menu, which implements SpeedSearch.\n *\n *\n */\nexport const SpeedSearchMenu = <T extends object>({\n  submenuBehavior = \"toggleOnPress\",\n  autoFocus = \"first\",\n  emptyText = \"Nothing to show\",\n  minWidth,\n  ...props\n}: SpeedSearchMenuProps<T>) => {\n  const onAction = (key: React.Key) => {\n    props.onAction?.(key);\n    speedSearch.clear();\n  };\n  const ref = React.useRef<HTMLUListElement>(null);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const state = useMenuState({ ...props });\n  const {\n    speedSearch,\n    speedSearchContainerProps,\n    searchPopupProps,\n    keyboardDelegate,\n  } = useSpeedSearchMenu(state, null, ref, containerRef);\n  const { menuContextValue, menuProps } = useMenu(\n    {\n      ...props,\n      autoFocus,\n      onAction,\n      keyboardDelegate,\n      submenuBehavior,\n    },\n    state,\n    ref\n  );\n\n  return (\n    <MenuContext.Provider\n      value={{\n        ...menuContextValue,\n        renderSubmenu: (props) => (\n          <SpeedSearchSubmenu emptyText={emptyText} {...props} />\n        ),\n      }}\n    >\n      <StyledSpeedSearchMenu\n        as=\"div\"\n        ref={containerRef}\n        style={{ minWidth }}\n        {...speedSearchContainerProps}\n        fillAvailableSpace={props.fillAvailableSpace}\n      >\n        <SpeedSearchMenuContent\n          items={[...state.collection]}\n          emptyText={emptyText}\n          speedSearch={speedSearch}\n          searchPopupProps={searchPopupProps}\n          state={state}\n          menuProps={menuProps}\n          menuRef={ref}\n        />\n      </StyledSpeedSearchMenu>\n    </MenuContext.Provider>\n  );\n};\n\nfunction SpeedSearchMenuContent<T>({\n  items,\n  state,\n  speedSearch,\n  searchPopupProps,\n  menuProps,\n  menuRef,\n  emptyText,\n}: {\n  state: TreeState<T>;\n  items: Node<T>[];\n  speedSearch: SpeedSearchState & { matches: CollectionSpeedSearchMatches };\n  searchPopupProps: SpeedSearchPopupProps;\n  menuProps: HTMLAttributes<HTMLElement>;\n  menuRef: RefObject<HTMLUListElement>;\n  emptyText: React.ReactNode;\n}) {\n  const filter = speedSearch.active\n    ? ({ key, type }: Node<T>) =>\n        type !== \"item\" || speedSearch.matches.has(key)\n    : undefined;\n  return (\n    <>\n      {searchPopupProps.children && (\n        <StyledSearchFieldWrapper\n          onClick={(e) => {\n            e.preventDefault();\n          }}\n        >\n          <SpeedSearchInput {...searchPopupProps} clear={speedSearch.clear} />\n        </StyledSearchFieldWrapper>\n      )}\n      <StyledItemsContainer {...menuProps} ref={menuRef}>\n        {renderMenuNodes(state, items, filter)}\n        {speedSearch.active && speedSearch.matches.size === 0 && (\n          <StyledPlaceholder>{emptyText}</StyledPlaceholder>\n        )}\n      </StyledItemsContainer>\n    </>\n  );\n}\n\nfunction SpeedSearchSubmenu<T>({\n  parentState,\n  rootKey,\n  emptyText,\n}: SubmenuProps<T> & { emptyText: React.ReactNode }) {\n  const ref = useRef<HTMLUListElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const state = useSubmenuState(parentState);\n  const rootItem = state.collection.getItem(rootKey);\n\n  const {\n    speedSearch,\n    speedSearchContainerProps,\n    searchPopupProps,\n    keyboardDelegate,\n  } = useSpeedSearchMenu(state, rootKey, ref, containerRef);\n  const { submenuProps } = useSubmenu(\n    { rootKey, parentState, keyboardDelegate },\n    state,\n    ref\n  );\n\n  return (\n    <StyledSpeedSearchMenu\n      {...speedSearchContainerProps}\n      as=\"div\"\n      ref={containerRef}\n    >\n      <SpeedSearchMenuContent\n        items={[...(rootItem?.childNodes || [])]}\n        speedSearch={speedSearch}\n        searchPopupProps={searchPopupProps}\n        state={state}\n        menuProps={submenuProps}\n        menuRef={ref}\n        emptyText={emptyText}\n      />\n    </StyledSpeedSearchMenu>\n  );\n}\n","import { css } from \"styled-components\";\n\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { UnknownThemeProp } from \"../Theme/Theme\";\n\nimport { StyledMenuItem, StyledMenuItemIcon } from \"./StyledMenuItem\";\n\nexport const MENU_VERTICAL_PADDING = 5;\nexport const MENU_BORDER_WIDTH = 1;\n\n// noinspection CssInvalidPropertyValue\nexport const StyledMenu = styled.ul<{ fillAvailableSpace?: boolean }>`\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  font-size: 0.8rem;\n  margin: 0;\n  padding: ${MENU_VERTICAL_PADDING}px 0;\n  outline: none;\n  list-style: none;\n  width: fit-content;\n  min-width: 120px;\n  overflow: auto;\n  // Border doesn't seem to be painted in the original impl. IdeaPopupMenuUI.isUnderPopup(c) seemed to return false\n  // in all cases. More info: https://github.com/JetBrains/intellij-community/blob/c5ece483811a3ab546fc3880225efb02cc8b94dd/platform/platform-impl/src/com/intellij/ide/ui/laf/darcula/ui/DarculaPopupMenuBorder.java#L24\n  /*  border: ${MENU_BORDER_WIDTH}px solid\n    ${({ theme }) =>\n    theme.color(\"Menu.borderColor\", !theme.dark ? \"#CDCDCD\" : \"#515151\")};*/\n  ${WINDOW_SHADOW};\n  background: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.background\" as UnknownThemeProp<\"PopupMenu.background\">\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.foreground\" as UnknownThemeProp<\"PopupMenu.foreground\">\n    )};\n\n  ${StyledVerticalSeparator}:first-child,\n  ${StyledVerticalSeparator}:last-child, \n  ${StyledVerticalSeparator} + ${StyledVerticalSeparator} {\n    display: none;\n  }\n  ${StyledVerticalSeparator} {\n    background-color: ${({ theme }) => theme.color(\"Menu.separatorColor\")};\n    height: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.height\") ?? 3}px`};\n    padding: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.stripeIndent\") ?? 1}px 0`};\n    margin: ${({ theme }) =>\n      `0 ${theme.value(\"PopupMenuSeparator.withToEdge\") ?? 1}px`};\n  }\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      width: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n      height: fill-available;\n    `}\n\n  --jui-menu-item-padding: 1rem;\n  --jui-menu-item-icon-width: 1rem;\n  --jui-menu-item-icon-spacing: 0.3125rem;\n\n  ${StyledMenuItem} {\n    // NOTE: The left margin seems not to be consistent in all menus.\n    padding-left: var(--jui-menu-item-padding);\n  }\n  &:has(${StyledMenuItemIcon}) {\n    // Adjusting item padding for menus with icon to be slightly smaller. Based on observations on the reference impl.\n    // Could be handled by a negative margin on icons as well.\n    --jui-menu-item-padding: 0.75rem;\n\n    // CSS-only solution to conditionally add left margin to menu items without icon, if there is at least one menu item\n    // with icon, in the current menu. To have text in all menu items aligned. The extra margin is avoided if there is no\n    // menu item with icon. It relies on :has() css pseudo-class which is not supported in FF at the moment.\n    ${StyledMenuItem}:not(:has(${StyledMenuItemIcon})) {\n      padding-left: calc(\n        var(--jui-menu-item-padding) + var(--jui-menu-item-icon-width) +\n          var(--jui-menu-item-icon-spacing)\n      );\n    }\n  }\n  ${StyledMenuItemIcon} {\n    width: var(--jui-menu-item-icon-width);\n    margin-right: var(--jui-menu-item-icon-spacing);\n  }\n`;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nexport const StyledMenuItemIcon = styled.span`\n  display: inline-flex; // prevents unwanted increased height\n`;\n\nexport const StyledNestedArrow = styled.span`\n  display: inline-flex; // to make it not take more height than the icon\n  margin-right: -0.75rem;\n  margin-left: 0.75rem;\n`;\n\nconst highlightedStyle = css`\n  color: ${({ theme }) =>\n    theme.asCurrentForeground(\n      theme.color(\n        \"MenuItem.selectionForeground\" as UnknownThemeProp<\"MenuItem.selectionForeground\">\n      )\n    )};\n  background: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.selectionBackground\" as UnknownThemeProp<\"MenuItem.selectionBackground\">\n    )};\n`;\nconst defaultStyle = css`\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.foreground\" as UnknownThemeProp<\"MenuItem.foreground\">\n    )};\n  background: unset;\n`;\nconst disabledStyle = css`\n  color: ${({ theme }) =>\n    theme.color(\"MenuItem.disabledForeground\") + \"!important\"};\n  background: unset !important;\n`;\nexport const StyledMenuItem = styled.li<{\n  isDisabled: boolean;\n  isActive: boolean;\n}>`\n  position: relative; // for being able to position arrow icon absolutely\n  outline: none;\n  cursor: default;\n  white-space: nowrap;\n\n  // bg/fg style for different states. Order is based on how they should override each other\n  ${defaultStyle};\n  ${({ isActive }) => isActive && highlightedStyle};\n  ${({ isDisabled }) => isDisabled && disabledStyle};\n\n  padding-right: 1.25rem;\n  line-height: 1.3125rem; // to make the item have the right height\n  display: flex;\n  align-items: center;\n`;\n","import React, { useContext, useEffect, useRef } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { AriaMenuOptions, useMenu } from \"@react-aria/menu\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport {\n  MenuKeyboardDelegate,\n  useSubmenu as useSubmenuAria,\n} from \"./_useSubmenu\";\nimport { useSubmenuState } from \"./_useSubmenuState\";\nimport { MenuContext } from \"./Menu\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { renderMenuNodes } from \"./renderMenuNodes\";\n\nexport function useSubmenu<T>(\n  {\n    rootKey,\n    parentState,\n    keyboardDelegate,\n  }: { rootKey: React.Key; parentState: TreeState<T> } & Pick<\n    AriaMenuOptions<T>,\n    \"keyboardDelegate\"\n  >,\n  state: TreeState<T>,\n  ref: React.RefObject<HTMLElement>\n) {\n  const rootItem = state.collection.getItem(rootKey);\n  const {\n    submenuBehavior,\n    autoFocus = true,\n    onClose,\n    onAction,\n  } = useContext(MenuContext);\n  let { menuProps } = useMenu(\n    {\n      \"aria-label\": rootItem?.[\"aria-label\"] || rootItem?.textValue,\n      onAction,\n      onClose,\n      selectedKeys: state.selectionManager.selectedKeys,\n      keyboardDelegate:\n        keyboardDelegate ||\n        new MenuKeyboardDelegate(\n          rootKey,\n          state.collection,\n          state.disabledKeys,\n          ref\n        ),\n      autoFocus,\n    },\n    state,\n    ref\n  );\n  const { submenuProps } = useSubmenuAria({ rootKey }, parentState, ref);\n\n  const submenuBehaviorProps = {\n    onKeyDown: (e: React.KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        // Close the menu and submenu root node.\n        state.toggleKey(rootKey);\n        state.selectionManager.setFocusedKey(rootKey);\n        parentState.selectionManager.setFocused(true);\n        if (submenuBehavior !== \"default\") {\n          e.stopPropagation();\n        }\n        return;\n      }\n    },\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      // we need this hack until the nested menu is properly supported. That's because when the element is hovered\n      // it sets the focus key, which will move focus to that item.\n      // noinspection PointlessBooleanExpressionJS seems to be false positive. autoFocus can be \"first\" or \"last\"\n      if (autoFocus === true) {\n        ref.current?.focus();\n      }\n    });\n  }, []);\n\n  return {\n    submenuProps: mergeProps(menuProps, submenuProps, submenuBehaviorProps),\n  };\n}\n\nexport interface SubmenuProps<T> {\n  parentState: TreeState<T>;\n  rootKey: React.Key;\n}\n\nexport function Submenu<T>({ parentState, rootKey }: SubmenuProps<T>) {\n  const ref = useRef<HTMLUListElement>(null);\n  const state = useSubmenuState(parentState);\n  const rootItem = state.collection.getItem(rootKey);\n\n  const { submenuProps } = useSubmenu({ rootKey, parentState }, state, ref);\n\n  return (\n    <StyledMenu {...submenuProps} ref={ref}>\n      {renderMenuNodes(state, [...(rootItem?.childNodes || [])])}\n    </StyledMenu>\n  );\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport React, { Key, RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { ListKeyboardDelegate } from \"@react-aria/selection\";\n\nexport class MenuKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  private keys: React.Key[];\n  constructor(\n    rootKey: Key | null,\n    private collection: Collection<Node<T>>,\n    disabledKeys: Set<React.Key>,\n    ref: React.RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super(collection, disabledKeys, ref, collator);\n    this.keys = [...collection.getKeys()]\n      .map((key) => collection.getItem(key))\n      .flatMap((item) => {\n        if (item && item.parentKey == rootKey) {\n          if (item.type === \"item\") {\n            return [item.key];\n          } else if (item.type === \"section\") {\n            return [...item.childNodes].map(({ key }) => key);\n          }\n        }\n        return [];\n      });\n  }\n\n  getFirstKey(): React.Key {\n    return this.keys[0];\n  }\n  getLastKey(): React.Key {\n    return this.keys.slice(-1)[0];\n  }\n\n  getKeyBelow(key: React.Key): React.Key {\n    const keyBelow = super.getKeyBelow(key);\n    // @ts-expect-error: getKeyBelow should be allowed to return null, but typing is currently inaccurate in react-aria\n    return this.keys.includes(keyBelow) ? keyBelow : null;\n  }\n  getKeyAbove(key: React.Key): React.Key {\n    const keyAbove = super.getKeyAbove(key);\n    // @ts-expect-error: getKeyBelow should be allowed to return null, but typing is currently inaccurate in react-aria\n    return this.keys.includes(keyAbove) ? keyAbove : null;\n  }\n}\n\n/**\n * Behavior accessibility of submenus:\n * - Closing submenu on ArrowLeft key press.\n *   Note that it can't be implemented in useMenuItem, because the focus might be on no the submenu itself and not any\n *   of its items\n * @param rootKey: Key of the root node, the submenu is created from its children\n * @param state\n * @param ref\n */\nexport function useSubmenu<T>(\n  { rootKey }: { rootKey: Key },\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const { keyboardProps: submenuProps } = useKeyboard({\n    onKeyDown: (e) => {\n      // Keyboard events bubble through portals. Don't handle keyboard events\n      // for elements outside the collection (e.g. menus).\n      if (!ref.current?.contains(e.target as Element)) {\n        e.continuePropagation();\n        return;\n      }\n      const root = state.collection.getItem(rootKey);\n      if (e.key === \"ArrowLeft\" && root && state.expandedKeys.has(root.key)) {\n        state.toggleKey(root.key);\n        state.selectionManager.setFocused(true);\n        return;\n      }\n      e.continuePropagation();\n    },\n  });\n\n  return {\n    submenuProps,\n  };\n}\n","import { TreeState } from \"@react-stately/tree\";\nimport { Key, useRef, useState } from \"react\";\nimport {\n  MultipleSelectionState,\n  SelectionManager,\n} from \"@react-stately/selection\";\n\n/**\n * Creates a TreeState corresponding to the submenu, from the state of a parent (sub)menu.\n * The collection and everything is the same, and the only difference from the parent state is selection manager\n * having a separate focused state to keep the focused state of each menu container separately, as the submenus\n * are usually rendered in separate overlays.\n */\nexport function useSubmenuState<T>(parentState: TreeState<T>) {\n  // We want synchronous updates to `isFocused` and `focusedKey` after their setters are called.\n  // But we also need to trigger a re-render. So, we have both a ref (sync) and state (async).\n  const [, setFocused] = useState(false);\n  const [, setFocusedKey] = useState<Key | null>(null);\n  const isFocusedRef = useRef(false);\n  const focusedKeyRef = useRef<Key | null>(null);\n\n  const state: MultipleSelectionState = {\n    // @ts-expect-error state is private\n    ...parentState.selectionManager.state,\n    setFocused: (isFocused: boolean) => {\n      isFocusedRef.current = isFocused;\n      setFocused(isFocused);\n    },\n    setFocusedKey(key: Key) {\n      focusedKeyRef.current = key;\n      setFocusedKey(key);\n    },\n  };\n  Object.defineProperties(state, {\n    isFocused: {\n      get() {\n        return isFocusedRef.current;\n      },\n    },\n    focusedKey: {\n      get() {\n        return focusedKeyRef.current!;\n      },\n    },\n  });\n\n  return {\n    ...parentState,\n    selectionManager: new SelectionManager(parentState.collection, state),\n  };\n}\n","import React from \"react\";\nimport { useMenuSection } from \"@react-aria/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { renderMenuNodes } from \"./renderMenuNodes\";\n\nexport interface MenuSectionProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  filter?: (node: Node<T>) => boolean;\n}\n\nconst StyledMenuHeading = styled.div`\n  cursor: default;\n  padding: 2px 0 2px 12px;\n  font-weight: bold;\n  font-size: 0.8125rem;\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.disabledForeground\"\n    )}; // TODO: make sure about it. It's probably not correct color\n`;\n\nconst StyledMenuSectionItemsContainer = styled.ul`\n  padding: 0;\n  margin: 0;\n`;\n\nexport const MenuSection = <T extends unknown>({\n  item,\n  state,\n  filter = () => true,\n}: MenuSectionProps<T>): React.ReactElement => {\n  let { itemProps, headingProps, groupProps } = useMenuSection({\n    heading: item.rendered,\n    \"aria-label\": item[\"aria-label\"],\n  });\n\n  const nodes = [...item.childNodes].filter(filter);\n  if (nodes.filter(({ type }) => type === \"item\").length === 0) {\n    return <></>;\n  }\n  return (\n    <>\n      <li {...itemProps}>\n        {item.rendered && (\n          <StyledMenuHeading {...headingProps}>\n            {item.rendered}\n          </StyledMenuHeading>\n        )}\n        <StyledMenuSectionItemsContainer {...groupProps}>\n          {renderMenuNodes(state, nodes)}\n        </StyledMenuSectionItemsContainer>\n      </li>\n    </>\n  );\n};\n","import React from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { Node } from \"@react-types/shared\";\nimport { ListDivider } from \"@intellij-platform/core/List/ListDivider\"; // private import\n\nimport { MenuItem } from \"./MenuItem\";\nimport { MenuSection } from \"./MenuSection\";\n\nexport function renderMenuNodes<T>(\n  state: TreeState<T>,\n  nodes: Node<T>[],\n  filter: (node: Node<T>) => boolean = () => true\n) {\n  return nodes.filter(filter).map((node) => {\n    switch (node.type) {\n      case \"item\":\n        return <MenuItem key={node.key} item={node} state={state} />;\n      case \"section\":\n        return (\n          <>\n            {node.props.hasDivider && (\n              <ListDivider key={node.key + \"-divider1\"} />\n            )}\n            <MenuSection\n              key={node.key}\n              item={node}\n              state={state}\n              filter={filter}\n            />\n            {node.props.hasDivider && (\n              <ListDivider key={node.key + \"-divider2\"} />\n            )}\n          </>\n        );\n      case \"divider\":\n        return <ListDivider key={node.key} />;\n    }\n  });\n}\n","import React, {\n  createContext,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\nexport interface MnemonicProps {\n  children: React.ReactNode;\n  /**\n   * Character to be used as {@link https://jetbrains.design/intellij/principles/mnemonics/ mnemonic}.\n   */\n  mnemonic: string;\n  /**\n   * Called when mnemonic key is pressed with the activator key\n   */\n  onTriggered?: () => void;\n\n  /**\n   * Whether the mnemonic is disabled. Useful when setting mnemonic on disable-able components, to just pass\n   * isDisabled prop down to MnemonicTrigger\n   */\n  isDisabled?: boolean;\n}\n\nconst MnemonicContext = createContext<{\n  character: string | null;\n  rendered: () => void;\n  /**\n   * Called when mnemonic is found in the text of the trigger component and rendered underlined, so the user\n   * can have a chance to know how to trigger the component's action via mnemonic.\n   */\n  active: boolean;\n}>({ character: null, active: false, rendered: () => {} });\n\nexport const MnemonicTrigger = ({\n  children,\n  mnemonic,\n  isDisabled,\n  onTriggered: onTriggeredProp = () => {},\n}: MnemonicProps): JSX.Element => {\n  const ref = useRef<HTMLElement>(null);\n  const onTriggered = useEventCallback(onTriggeredProp);\n  const [active, setActive] = useState(false);\n  const keydownListener = useEventCallback((e: KeyboardEvent) => {\n    if (isDisabled) {\n      return;\n    }\n    if (active && !e.repeat) {\n      const character = e.code.match(/Key([A-Z])/)?.[1];\n      if (character && character.toLowerCase() === mnemonic.toLowerCase()) {\n        onTriggered();\n      }\n    }\n    if (e.key === \"Alt\" && ref.current && isAccessible(ref.current)) {\n      setActive(true);\n    }\n  });\n\n  useEffect(() => {\n    // calling addEventListener with already registered listener is no-op.\n    document.addEventListener(\"keydown\", keydownListener);\n    document.addEventListener(\"keyup\", keyupListener);\n    window.addEventListener(\"blur\", onBlur);\n    function onBlur() {\n      setActive(false);\n    }\n    function keyupListener(e: KeyboardEvent) {\n      if (e.key === \"Alt\") {\n        setActive(false);\n      }\n    }\n    return () => {\n      document.removeEventListener(\"keydown\", keydownListener);\n      document.removeEventListener(\"keyup\", keyupListener);\n      window.removeEventListener(\"blur\", onBlur);\n    };\n  }, []);\n\n  const renderedMnemonicRef = useRef<string>(\"\");\n  useEffect(() => {\n    const timerId = setTimeout(() => {\n      if (renderedMnemonicRef.current !== mnemonic) {\n        console.warn(\n          `Mnemonic ${mnemonic} was set but not rendered to the user. \nMake sure the specified character is rendered directly in MnemonicTrigger, or wrapped by MnemonicText inside MnemonicTrigger children. \nElement:`,\n          ref.current?.parentElement\n        );\n      }\n    });\n    return () => {\n      clearTimeout(timerId);\n    };\n  }, [mnemonic]);\n  return (\n    <MnemonicContext.Provider\n      value={{\n        character: mnemonic,\n        active,\n        rendered: () => {\n          renderedMnemonicRef.current = mnemonic;\n        },\n      }}\n    >\n      <span hidden ref={ref} />\n      {typeof children === \"string\" ? (\n        <MnemonicText>{children}</MnemonicText>\n      ) : (\n        children\n      )}\n    </MnemonicContext.Provider>\n  );\n};\n\n/**\n * Checks if a\n * See more in ./design-decisions.md\n */\nfunction isAccessible(element: Element): boolean {\n  return (\n    !element.closest(\"[aria-hidden]\") &&\n    element.parentElement !== null &&\n    isVisible(element.parentElement)\n  );\n}\nfunction isVisible(e: HTMLElement) {\n  return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length);\n}\n/**\n * Used inside MnemonicTrigger children, when the direct child can't be a string.\n * @example\n * ```tsx\n * <MnemonicTrigger mnemonic=\"D\">\n *    <>\n *      <MnemonicText>Disconnect</MnemonicText>\n *    </>\n * </MnemonicTrigger>\n * ```\n */\nexport function MnemonicText({ children }: { children: string }) {\n  const { character, active, rendered } = useContext(MnemonicContext);\n  if (character) {\n    const index = children.toLowerCase().indexOf(character.toLowerCase());\n    const found = index > -1;\n    if (found) {\n      rendered();\n    }\n    if (found && active) {\n      return (\n        <>\n          {children.slice(0, index)}\n          <u>{children.slice(index, index + 1)}</u>\n          {children.slice(index + 1)}\n        </>\n      );\n    }\n  }\n  return <>{children}</>;\n}\n","import { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport React, { useEffect } from \"react\";\n\n/**\n * A workaround for an issue in measuring overlay size, caused by a limitation/bug in how React 17 runs effects when\n * children suspend rendering: https://github.com/facebook/react/issues/21510\n *\n * Here is a simplified demonstration of the issue:\n * Expected behavior (React 18): https://codesandbox.io/s/parent-effects-suspense-v18-38m8p7?file=/src/App.tsx\n * Broken behavior (React 17): https://codesandbox.io/s/parent-effects-suspense-v17-h39g4g\n *\n * The overlay content size measuring runs in an effect, and that effect won't run when the content is rendered after\n * suspense.\n */\nexport function UNSAFE_React17SuspenseFix({\n  measureContentSize,\n  children,\n}: {\n  measureContentSize: () => void;\n  children: React.ReactNode;\n}) {\n  if (React.version.startsWith(\"17\")) {\n    return (\n      <React.Suspense\n        fallback={\n          <NullSuspenseFallback afterUnsuspended={measureContentSize} />\n        }\n      >\n        {children}\n      </React.Suspense>\n    );\n  }\n  return <>{children}</>;\n}\n\nfunction NullSuspenseFallback({\n  afterSuspended: afterSuspendedProp = () => {},\n  afterUnsuspended: afterUnsuspendedProp = () => {},\n}: {\n  afterUnsuspended?: () => void;\n  afterSuspended?: () => void;\n}) {\n  const afterSuspended = useEventCallback(afterSuspendedProp);\n  const afterUnsuspended = useEventCallback(afterUnsuspendedProp);\n  useEffect(() => {\n    afterSuspended?.();\n    return () => {\n      afterUnsuspended?.();\n    };\n  }, []);\n  return null;\n}\n","import React, { FocusEventHandler, useContext, useRef } from \"react\";\nimport { useOverlayTriggerState } from \"@react-stately/overlays\";\nimport { useModalOverlay, usePreventScroll } from \"@react-aria/overlays\";\nimport { focusSafely, FocusScope } from \"@react-aria/focus\";\nimport { useDialog } from \"@react-aria/dialog\";\nimport { AriaDialogProps } from \"@react-types/dialog\"; // temporary phantom dependency\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport {\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  ResizableMovableOverlayOptions,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { WindowContext } from \"@intellij-platform/core/ModalWindow/WindowContext\";\nimport { UNSAFE_React17SuspenseFix } from \"@intellij-platform/core/Overlay/UNSAFE_React17SuspenseFix\";\n\nexport interface ModalWindowProps\n  extends AriaDialogProps,\n    ResizableMovableOverlayOptions {\n  children: React.ReactNode;\n  className?: string;\n  onClose?: () => void;\n}\n\nconst StyledWindowUnderlay = styled.div`\n  position: fixed;\n  z-index: 1000; // FIXME: z-index should not be hard-coded like this\n  inset: 0;\n`;\n\nexport const StyledWindowContainer = styled.div`\n  position: fixed;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  border-radius: 8px;\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n  outline: 1px solid #555; // FIXME\n`;\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledWindowInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const DEFAULT_WINDOW_MIN_WIDTH = 50;\nexport const DEFAULT_WINDOW_MIN_HEIGHT = 24;\n\nexport const WindowControllerContext = React.createContext<\n  Partial<Pick<ModalWindowProps, \"onClose\">>\n>({});\n\n/**\n * A movable/resizable modal window. The window header which holds the title, can be used to drag the window around.\n * In the reference impl, modal windows are os-native, and contain os-level buttons for minimize/close/maximise, which\n * are not relevant here since they wouldn't be os-native windows. A close button is still relevant (and kind of\n * necessary) and will be added in next iterations.\n *\n * The content container doesn't come with any padding. Other related components should be used for common layouts in\n * modal windows.\n * Example use cases: Window for git operations such as push, update, revert, new branch, etc.\n *\n * ![img.png](https://user-images.githubusercontent.com/3150694/181095858-968c5c66-2ae7-4e40-84e3-e6df43cd4aa4.png)\n *\n * NOTE: The part regarding rendering OverlayInteractionHandler, and rendering as a dialog with a focus scope, in an\n * overlay container could be extracted into a component which is then used to create custom resizable/movable overlay\n * dialogs, like \"Branches\", or \"Search Everywhere\".\n *\n * TODO: show close button (maybe os-aware styles?)\n *\n */\nexport const ModalWindow = ({\n  interactions = \"all\",\n  minWidth = DEFAULT_WINDOW_MIN_WIDTH,\n  minHeight = DEFAULT_WINDOW_MIN_HEIGHT,\n  className,\n  ...props\n}: ModalWindowProps): React.ReactElement => {\n  const { children } = props;\n  const propsContext = useContext(WindowControllerContext);\n  const onClose = () => {\n    propsContext.onClose?.();\n    props.onClose?.();\n  };\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { modalProps, underlayProps } = useModalOverlay(\n    {\n      isDismissable: false,\n      isKeyboardDismissDisabled: false,\n    },\n    // useModalOverlay doesn't really need the full `OverlayTriggerState` interface.\n    // It only requires `isOpen` and `close`.\n    // However, it's currently typed like this, so useOverlayTriggerState is used,\n    // just to comply with the required type, and in the unlikely case where a future minor version starts to use\n    // other properties from `OverlayTriggerState`\n    useOverlayTriggerState({\n      isOpen: true,\n      onOpenChange: (isOpen) => {\n        if (!isOpen) {\n          onClose();\n        }\n      },\n    }),\n    ref\n  );\n  usePreventScroll();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  const {\n    bounds: style,\n    overlayInteractionHandlerProps,\n    UNSAFE_measureContentSize,\n  } = useResizableMovableOverlay(ref, { ...props, minHeight, minWidth });\n\n  const { focusContainmentFixProps } = useFocusContainmentFix();\n\n  return (\n    <StyledWindowUnderlay {...underlayProps} className={className}>\n      <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n        <FocusScope contain restoreFocus autoFocus>\n          <StyledWindowContainer\n            {...mergeProps(dialogProps, modalProps, focusContainmentFixProps, {\n              style,\n            })}\n            ref={ref}\n          >\n            <StyledWindowInnerContainer>\n              <WindowContext.Provider\n                value={{\n                  isActive: true, // because it's modal. WindowContext would be used for non-modal windows too, in future\n                  titleProps,\n                  movable: interactions !== \"none\",\n                }}\n              >\n                <UNSAFE_React17SuspenseFix\n                  measureContentSize={UNSAFE_measureContentSize}\n                >\n                  {children}\n                </UNSAFE_React17SuspenseFix>\n              </WindowContext.Provider>\n            </StyledWindowInnerContainer>\n            {interactions === \"all\" && <OverlayResizeHandles />}\n          </StyledWindowContainer>\n        </FocusScope>\n      </OverlayInteractionHandler>\n    </StyledWindowUnderlay>\n  );\n};\n\n/**\n * The way FocusScope is implemented at the moment, it's possible for another focus scope to steal the focus,\n * right after the modal window is opened. The issue is not tracked down to the root cause. But with this hook,\n * we make sure there is no way for focus to go out of the modal window, when it's mounted.\n */\nfunction useFocusContainmentFix<T extends HTMLElement>() {\n  const lastFocusedElementRef = useRef<HTMLElement | null>(null);\n  const onFocus: FocusEventHandler<T> = (e) => {\n    lastFocusedElementRef.current = e.target;\n  };\n  const onBlur: FocusEventHandler = (e) => {\n    const probablyFocusedElement = e.relatedTarget;\n    if (\n      !probablyFocusedElement ||\n      (probablyFocusedElement instanceof Element &&\n        !e.currentTarget.contains(probablyFocusedElement) &&\n        // The following condition is added to exclude cases where the focus\n        // is going to an overlay that is opened from within the modal window.\n        // The condition is suboptimal as there is no check on whether the\n        // overlay is a logical child of the modal or not.\n        // However, it seems justified since the entire hook is a temporary hack,\n        // and also it doesn't seem likely for an overlay outside the modal\n        // to grab the focus.\n        !probablyFocusedElement.closest(\"[data-overlay-root]\"))\n    ) {\n      const elementToFocus = lastFocusedElementRef.current;\n      if (elementToFocus) {\n        focusSafely(elementToFocus);\n      }\n    }\n  };\n  return {\n    focusContainmentFixProps: {\n      onFocus,\n      onBlur,\n    },\n  };\n}\n","import React from \"react\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\nexport const WindowContext = React.createContext<{\n  isActive: boolean;\n  movable: boolean;\n  titleProps: DOMAttributes;\n}>({ isActive: false, movable: true, titleProps: {} });\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { ButtonGroup } from \"@intellij-platform/core/ButtonGroup\";\n\nconst StyledFooter = styled.div<{ hasBorder?: boolean }>`\n  padding: 0.625rem 0.875rem;\n  display: flex;\n  gap: 0.5rem;\n  justify-content: space-between;\n  align-items: center;\n  border-top: 1px solid transparent;\n  border-color: ${({ hasBorder, theme }) =>\n    hasBorder && theme.commonColors.contrastBorder};\n`;\nconst StyledFooterSide = styled.div`\n  display: flex;\n  gap: 0.75rem;\n`;\n\n/**\n * Implements the common layout for window footer, to be used in {@link ModalWindowProps#footer}.\n * Footer has a left and a right side. There is a standard gap between the children of each side.\n */\nexport function WindowFooter({\n  left,\n  right,\n  hasBorder,\n}: {\n  /**\n   * The content to go to the left side the footer. A help icon button is very common on the left side.\n   */\n  left?: React.ReactNode;\n  /**\n   * The content to go to the right side the footer.\n   * {@link Button}s are usually used inside the right content.\n   * A {@link ButtonGroup} is rendered around the content to allow for keyboard navigation with arrow keys.\n   */\n  right?: React.ReactNode;\n  /**\n   * Whether to show top border for footer or not\n   */\n  hasBorder?: boolean;\n}) {\n  return (\n    <StyledFooter hasBorder={hasBorder}>\n      <StyledFooterSide>{left}</StyledFooterSide>\n      <StyledFooterSide>\n        <ButtonGroup>{right}</ButtonGroup>\n      </StyledFooterSide>\n    </StyledFooter>\n  );\n}\n","import React, { HTMLAttributes, useContext } from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\n\nimport { WindowContext } from \"./WindowContext\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst StyledWindowTitle = styled.h1`\n  margin: 0;\n  text-align: center;\n  font-size: 13px; // not rem! intentional\n  line-height: 24px; // Double check\n  cursor: default;\n  user-select: none;\n  padding: 0 8px;\n`;\n\n/**\n * Implements appearance of Window header, and also acts as a handle for moving the window.\n * Expected to be used with {@link WindowLayout}:\n *\n * @example\n * ```tsx\n * <ModalWindow>\n *    <WindowLayout header={<WindowHeader>header</WindowHeader>} />\n * </ModalWindow>\n * ```\n */\nexport const WindowHeader = ({ children }: { children?: React.ReactNode }) => {\n  const { movable, titleProps } = useContext(WindowContext);\n  const renderTitle = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledWindowTitle {...mergeProps(titleProps, otherProps)}>\n      {children || <>&nbsp;</>}\n    </StyledWindowTitle>\n  );\n  return movable ? (\n    <OverlayMoveHandle>\n      {({ moveHandleProps }) => renderTitle(moveHandleProps)}\n    </OverlayMoveHandle>\n  ) : (\n    renderTitle()\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { WindowHeader } from \"./WindowHeader\";\nimport { WindowFooter } from \"@intellij-platform/core/ModalWindow/WindowFooter\";\n\nconst StyledWindowFooter = styled.div`\n  min-height: min-content;\n`;\n\nconst StyledWindowContentWrapper = styled.div`\n  overflow: auto;\n  flex: 1;\n`;\n\n/**\n * Window content layout, supporting fixed `header` and `footer` sections, and a scrollable `content` area.\n */\nexport function WindowLayout({\n  header,\n  footer,\n  content,\n}: {\n  /**\n   * Fixed position header of the window at the top. Use {@link WindowLayout.Header} for the default window header,\n   * which also acts as a move handle for the window. If a string is passed, it will be wrapped by\n   * {@link WindowLayout.Header} automatically.\n   */\n  header: React.ReactNode;\n  /**\n   * Scrollable content of the window.\n   */\n  content: React.ReactNode;\n  /**\n   * An area at the bottom of the window which is not scrolled as opposed to `content`. Use {@link WindowLayout.Footer}\n   * for rendering the common layout of a window footer.\n   */\n  footer?: React.ReactNode;\n}) {\n  return (\n    <>\n      {header &&\n        (typeof header === \"string\" ? (\n          <WindowHeader>{header}</WindowHeader>\n        ) : (\n          header\n        ))}\n      <StyledWindowContentWrapper>{content}</StyledWindowContentWrapper>\n      {footer && <StyledWindowFooter>{footer}</StyledWindowFooter>}\n    </>\n  );\n}\n\n// Just for improved discoverability. Might as well export WindowFooter and WindowHeader instead.\nWindowLayout.Footer = WindowFooter;\nWindowLayout.Header = WindowHeader;\n","import React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  ModalWindow,\n  ModalWindowProps,\n  WindowControllerContext,\n} from \"./ModalWindow\";\n\nexport interface WindowManagerAPI {\n  /**\n   * Shows a modal window within the stack of windows managed by {@link WindowManager}.\n   * The opened windows will be closed when `onClose` interactions happen.\n   * Returns a Promise which is resolved when the modal window is closed.\n   *\n   * Modal window element, or a function that returns the modal window element can\n   * be passed.\n   * If a function is passed, it will receive a close function in its object argument,\n   * which can be used to resolve the returned promise with.\n   *\n   * @example\n   *\n   * ```\n   * const windowManager = useWindowManager();\n   *\n   * const showWindow = () => {\n   *   windowManager\n   *     .open<boolean>(({ close }) => (\n   *       <ModalWindow>\n   *         <WindowLayout\n   *           header=\"...\"\n   *           content={<>...</>}\n   *           footer={\n   *             <WindowLayout.Footer\n   *               right={\n   *                 <>\n   *                   <Button onPress={close}>Cancel</Button>\n   *                   <Button onPress={() => close(true)}>Ok</Button>\n   *                 </>\n   *               }\n   *             />\n   *           }\n   *         />\n   *       </ModalWindow>\n   *     ))\n   *     .then((confirmed) => alert(`confirmed: ${confirmed ?? false}`));\n   * };\n   * ```\n   */\n  open<T>(\n    props:\n      | React.ReactElement<ModalWindowProps, typeof ModalWindow>\n      | ((args: {\n          close: (result?: T) => void;\n        }) => React.ReactElement<ModalWindowProps, typeof ModalWindow>)\n  ): Promise<T | undefined>;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\n    \"WindowManager not found. Wrap your application with WindowManager to be able to open windows imperatively\"\n  );\n};\n\nconst WindowsContext = React.createContext<WindowManagerAPI>({\n  open: NotImplementedFn,\n});\n\n/**\n * Returns imperative API for showing windows.\n *\n */\nexport const useWindowManager = (): WindowManagerAPI =>\n  useContext(WindowsContext);\n\ntype WindowElement = ReactElement<ModalWindowProps, typeof ModalWindow>;\n\nexport interface WindowManagerProps {\n  children?: ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link useWindowManager}) for opening windows.\n * It renders windows in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n */\nexport const WindowManager: React.FC<WindowManagerProps> = ({ children }) => {\n  const [windows, setWindows] = useState<Array<WindowElement>>([]);\n  const newKeyRef = useRef<number>(0);\n\n  const api = useMemo<WindowManagerAPI>(() => {\n    return {\n      open: function <T>(content: Parameters<WindowManagerAPI[\"open\"]>[0]) {\n        return new Promise<T | undefined>((resolve) => {\n          newKeyRef.current++;\n          const close = (result?: T) => {\n            setWindows((currentWindows) =>\n              currentWindows.filter((aWindow) => aWindow !== window)\n            );\n            // Make sure (?) to resolve the promise after the dialog is closed,\n            // for the focus to be restored to the previous element before the\n            // potential further actions take place.\n            requestAnimationFrame(() => {\n              resolve(result);\n            });\n          };\n          const window = (\n            <WindowControllerContext.Provider\n              value={{\n                onClose: () => {\n                  close();\n                },\n              }}\n              key={newKeyRef.current}\n            >\n              {typeof content === \"function\"\n                ? // @ts-expect-error close signature is not correctly inferred\n                  content({ close })\n                : content}\n            </WindowControllerContext.Provider>\n          );\n          setWindows((currentWindows) => currentWindows.concat(window));\n        });\n      },\n    };\n  }, []);\n\n  return (\n    <WindowsContext.Provider value={api}>\n      {children}\n      {windows}\n    </WindowsContext.Provider>\n  );\n};\n","import React, { useContext, useRef } from \"react\";\nimport { Overlay as AriaOverlay, OverlayProps } from \"@react-aria/overlays\";\n\nconst ParentOverlayContext = React.createContext<HTMLElement | null>(null);\n\n/**\n * A (drop-in replacement) wrapper around Overlay, which makes sure overlays created in nested\n * react components will be ported to the same top level container. This is especially useful to detect\n * \"outside clicks\" when overlays are nested. The most common example would be nested menu in popup.\n *\n */\nexport function Overlay({\n  children,\n  OverlayComponent = AriaOverlay,\n}: {\n  children: React.ReactNode;\n  OverlayComponent?: React.ComponentType<OverlayProps>;\n}) {\n  const root = useContext(ParentOverlayContext);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  if (root) {\n    return (\n      <OverlayComponent portalContainer={root}>{children}</OverlayComponent>\n    );\n  }\n  return (\n    <ParentOverlayContext.Provider value={containerRef.current}>\n      <OverlayComponent>\n        <div ref={containerRef} data-overlay-root=\"\">\n          {children}\n        </div>\n      </OverlayComponent>\n    </ParentOverlayContext.Provider>\n  );\n}\n\n/**\n * Returns true, if element1 and element2 are in nested overlays. \"Nested\" being in terms of React component tree.\n * Useful for detecting \"outside click\" when overlay components are nested in each other.\n */\nexport function areInNestedOverlays(\n  element1: Element | null,\n  element2: Element | null\n) {\n  const overlayRoot1 = element1?.closest(\"[data-overlay-root]\");\n  const overlayRoot2 = element2?.closest(\"[data-overlay-root]\");\n  return Boolean(overlayRoot1) && overlayRoot1 === overlayRoot2;\n}\n","import React, { useContext } from \"react\";\n\nexport type Bounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * TODO(docs): add a few words about this abstraction and it's use.\n */\nexport type OverlayInteractionHandlerProps = {\n  /**\n   * Signals start of a UI interaction like resize or move, in which overlay bounds change.\n   */\n  startInteraction: (type: \"move\" | \"resize\") => Bounds;\n  /**\n   * Used to update bounds state during a UI interaction.\n   */\n  updateBounds: (bounds: Bounds) => void;\n  /**\n   * Signals end of a UI interaction.\n   */\n  finishInteraction: () => void;\n\n  minWidth?: number;\n  minHeight?: number;\n};\n\nconst OverlayInteractionHandlerContext =\n  React.createContext<OverlayInteractionHandlerProps | null>(null);\n\n/**\n * Provides the context used by components like {@link OverlayMoveHandle} and {@link OverlayResizeHandles} that provide\n * user interactions that change the boundary of the overlay they are rendered in.\n * Use {@link useResizableMovableOverlay} which implements an efficient state management for overlay bounds and returns\n * props to be passed to `OverlayInteractionHandler`:\n *\n * @example\n *\n * const {\n *    bounds, // Bounds to be applied to the overlay element.\n *    overlayInteractionHandlerProps,\n *  } = useResizableMovableOverlay(props);\n *\n * return (\n *   <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n *     <div style={bounds}>...</div>\n *   </OverlayInteractionHandler>\n * );\n *\n * @see useResizableMovableOverlay\n */\nexport const OverlayInteractionHandler = ({\n  children,\n  ...props\n}: OverlayInteractionHandlerProps & { children: React.ReactNode }) => {\n  return (\n    <OverlayInteractionHandlerContext.Provider value={props}>\n      {children}\n    </OverlayInteractionHandlerContext.Provider>\n  );\n};\n\nexport const useOverlayInteractionHandler = () =>\n  useContext(OverlayInteractionHandlerContext);\n","import { useMove, UseMoveOptions } from \"../utils/interaction-utils/useMove\";\nimport { useOverlayInteractionHandler } from \"./OverlayInteractionHandler\";\nimport React from \"react\";\n\nexport type UseOverlayMoveHandleOptions = Omit<\n  UseMoveOptions<unknown>,\n  \"onMoveStart\" | \"onMove\" | \"onMoveEnd\"\n>;\n/**\n * Used for making a dom element a move handle for the overlay it's being rendered in.\n * It uses the context provided by {@link OverlayInteractionHandler}, and returns props to be applied on a dom element to\n * make it a move handle for the overlay it's being rendered in.\n *\n * @see OverlayMoveHandle\n */\nexport function useOverlayMoveHandle(options?: UseOverlayMoveHandleOptions) {\n  const interactionHandler = useOverlayInteractionHandler();\n  if (!interactionHandler) {\n    return { moveHandleProps: {} };\n  }\n  const { finishInteraction, startInteraction, updateBounds } =\n    interactionHandler;\n\n  const moveProps = useMove({\n    ...options,\n    onMoveStart: () => {\n      return startInteraction(\"move\");\n    },\n    onMove: ({ startState, movement }) => {\n      updateBounds({\n        ...startState,\n        top: startState.top + movement.y,\n        left: startState.left + movement.x,\n      });\n    },\n    onMoveEnd: () => {\n      finishInteraction();\n    },\n  });\n  return { moveHandleProps: moveProps || {} };\n}\n\n/**\n * Used for making a dom element a move handle for the overlay it's being rendered in.\n * It uses the context provided by {@link OverlayInteractionHandler}. A render function is expected as `children`. It's\n * passed the event handlers that need to be applied on a dom element to make it a move handle for the overlay it's\n * being rendered in.\n */\nexport const OverlayMoveHandle = ({\n  children,\n  ...props\n}: {\n  children: (\n    props: ReturnType<typeof useOverlayMoveHandle>\n  ) => React.ReactElement;\n} & UseOverlayMoveHandleOptions) => {\n  return children(useOverlayMoveHandle(props));\n};\n","import React, { useRef } from \"react\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport {\n  HorizontalResizerProps,\n  VerticalResizerProps,\n} from \"../Resizer/ResizerProps\";\nimport {\n  Bounds,\n  useOverlayInteractionHandler,\n} from \"./OverlayInteractionHandler\";\n\ntype OverlayResizeHandlesProps = {\n  minWidth?: number;\n  minHeight?: number;\n};\n\n/**\n * Renders invisible resize handles at the edges of the overlay it's rendered in. It uses the context provided by\n * {@link OverlayInteractionHandler} to resize the overlay when the handles are used.\n */\nexport function OverlayResizeHandles(props: OverlayResizeHandlesProps) {\n  const overlayResizer = useOverlayResizer(props);\n  return (\n    overlayResizer && (\n      <>\n        <RightResizer {...overlayResizer.getResizerProps(\"right\")} />\n        <LeftResizer {...overlayResizer.getResizerProps(\"left\")} />\n        <TopResizer {...overlayResizer.getResizerProps(\"top\")} />\n        <BottomResizer {...overlayResizer.getResizerProps(\"bottom\")} />\n      </>\n    )\n  );\n}\n\n/**\n * overlay resizing logic and state. When resizing is in progress, the source of truth is a local state, for performance\n * reasons. When the resize is done (e.g. by mouse being released), `onBoundsChange` is called with the new bounds.\n */\nfunction useOverlayResizer(props: OverlayResizeHandlesProps = {}) {\n  const initialBoundsRef = useRef<Bounds>({\n    top: 0,\n    height: 0,\n    width: 0,\n    left: 0,\n  });\n  const interactionHandler = useOverlayInteractionHandler();\n  const {\n    minWidth = interactionHandler?.minWidth ?? 1,\n    minHeight = interactionHandler?.minHeight ?? 1,\n  } = props;\n  if (!interactionHandler) {\n    return null;\n  }\n  const { finishInteraction, startInteraction, updateBounds } =\n    interactionHandler;\n\n  const onResize = {\n    right: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        width: Math.max(minWidth, initialBoundsRef.current.width + size),\n      }),\n    bottom: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        height: Math.max(minHeight, initialBoundsRef.current.height + size),\n      }),\n    left: (size: number) => {\n      const newWidth = Math.max(\n        minWidth,\n        initialBoundsRef.current.width + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        left: initialBounds.left + initialBounds.width - newWidth,\n        width: newWidth,\n      });\n    },\n    top: (size: number) => {\n      const newHeight = Math.max(\n        minHeight,\n        initialBoundsRef.current.height + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        top: initialBounds.top + initialBounds.height - newHeight,\n        height: newHeight,\n      });\n    },\n  };\n\n  function getResizerProps(side: \"left\" | \"right\"): HorizontalResizerProps;\n  function getResizerProps(side: \"top\" | \"bottom\"): VerticalResizerProps;\n  function getResizerProps(\n    side: \"left\" | \"right\" | \"top\" | \"bottom\"\n  ): HorizontalResizerProps | VerticalResizerProps {\n    const horizontal = side === \"left\" || side === \"right\";\n    return {\n      size: 1,\n      cursor: horizontal ? \"ew\" : \"ns\",\n      onResizeStarted: () => {\n        initialBoundsRef.current = startInteraction(\"resize\");\n      },\n      onResize: onResize[side],\n      onResizeEnd: finishInteraction,\n      style: { position: \"absolute\", [side]: 0 },\n    };\n  }\n\n  return {\n    getResizerProps,\n  };\n}\n","import React, { ForwardedRef } from \"react\";\nimport {\n  AriaPopoverProps,\n  DismissButton,\n  Overlay,\n  usePopover,\n} from \"@react-aria/overlays\";\nimport { OverlayTriggerState } from \"@react-stately/overlays\";\n\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\n\nimport { styled } from \"../styled\";\nimport { useObjectRef } from \"@react-aria/utils\";\n\nexport interface PopoverProps extends Omit<AriaPopoverProps, \"popoverRef\"> {\n  children: React.ReactNode;\n  state: OverlayTriggerState;\n}\n\nconst StyledPopover = styled.div`\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\nexport const Popover = React.forwardRef(function Popover(\n  { children, state, offset = 8, ...props }: PopoverProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const popoverRef = useObjectRef(forwardedRef);\n  const { popoverProps } = usePopover(\n    {\n      ...props,\n      offset,\n      popoverRef,\n    },\n    state\n  );\n\n  return (\n    <Overlay>\n      {/* Rendering underlay doesn't seem necessary based on the reference impl */}\n      <StyledPopover {...popoverProps} ref={popoverRef}>\n        <DismissButton onDismiss={state.close} />\n        {children}\n        <DismissButton onDismiss={state.close} />\n      </StyledPopover>\n    </Overlay>\n  );\n});\n","import { Bounds } from \"@intellij-platform/core/Overlay/OverlayInteractionHandler\";\nimport { clamp } from \"ramda\";\nimport { ResizableMovableOverlayOptions } from \"@intellij-platform/core/Overlay/useResizableMovableOverlay\";\n\nexport const withMinSize =\n  ({ width: minWidth, height: minHeight }: { width: number; height: number }) =>\n  (bounds: Bounds) => {\n    const width = Math.max(minWidth, bounds.width);\n    const height = Math.max(minHeight, bounds.height);\n    if (bounds.width != width || bounds.height != height) {\n      return { ...bounds, width, height };\n    }\n    return bounds;\n  };\n\nexport function getCenteredBounds(width: number, height: number): Bounds {\n  return {\n    left: (window.innerWidth - width) / 2,\n    top: (window.innerHeight - height) / 2,\n    width,\n    height,\n  };\n}\n\n/**\n * A helper function to create interaction interceptor which ensures bounds are contained within a container.\n *\n * @example\n * const ensureInViewPort = containedWithin({left: 0, top: 0, width: window.innerWidth, height: window.innerHeight})\n *\n * useResizableMovableOverlay({ onBoundsChanging: ensureInViewPort});\n */\nexport const containedWithin =\n  (\n    containerBounds: Bounds\n  ): ResizableMovableOverlayOptions[\"onBoundsChanging\"] =>\n  (bounds, interactionType) => {\n    if (interactionType === \"move\") {\n      const left = clamp(\n        containerBounds.left,\n        containerBounds.left + containerBounds.width - bounds.width,\n        bounds.left\n      );\n      const top = clamp(\n        containerBounds.top,\n        containerBounds.top + containerBounds.height - bounds.height,\n        bounds.top\n      );\n      return {\n        ...bounds,\n        left,\n        top,\n      };\n    } else if (interactionType === \"resize\") {\n      const left = Math.max(containerBounds.left, bounds.left);\n      const top = Math.max(containerBounds.top, bounds.top);\n      // the logic here seems unnecessarily complicated\n      return {\n        left,\n        top,\n        width:\n          bounds.width -\n          Math.max(\n            0,\n            bounds.left +\n              bounds.width -\n              (containerBounds.left + containerBounds.width)\n          ) -\n          (left - bounds.left),\n        height:\n          bounds.height -\n          Math.max(\n            0,\n            bounds.top +\n              bounds.height -\n              (containerBounds.top + containerBounds.height)\n          ) -\n          (top - bounds.top),\n      };\n    }\n    return bounds;\n  };\nexport const position =\n  ({\n    targetElement,\n    placement = \"bottom\",\n  }: {\n    placement?: \"bottom\" | \"top\";\n    targetElement: HTMLElement;\n  }) =>\n  ({ height, width }: Bounds): Bounds => {\n    const targetBounds = targetElement.getBoundingClientRect();\n    return {\n      left: targetBounds.left,\n      top:\n        placement === \"bottom\"\n          ? targetBounds.top + targetBounds.height\n          : targetBounds.top - height,\n      width,\n      height,\n    };\n  };\n\nexport function ensureInViewport(\n  bounds: Bounds,\n  { gap = 0 }: { gap?: number } = {}\n): Bounds {\n  const viewportWidth = window.innerWidth - gap;\n  const viewportHeight = window.innerHeight - gap;\n  const left = clamp(gap, viewportWidth - bounds.width, bounds.left);\n  const top = clamp(gap, viewportHeight - bounds.height, bounds.top);\n  if (left !== bounds.left || top !== bounds.top) {\n    return {\n      left,\n      top,\n      width: bounds.width,\n      height: bounds.height,\n    };\n  }\n  return bounds;\n}\n","import { useCallback, useEffect, useLayoutEffect, useRef } from \"react\";\n\nexport const useDebouncedCallback = (\n  fn: () => void,\n  { timeout = 100 } = {}\n) => {\n  const fnRef = useRef(fn);\n  const currentTimeoutId = useRef<number | null>(null);\n  useLayoutEffect(() => {\n    fnRef.current = fn;\n  });\n  useEffect(() => {\n    return () => {\n      if (currentTimeoutId.current !== null) {\n        clearTimeout(currentTimeoutId.current);\n      }\n    };\n  }, []);\n  return useCallback(() => {\n    if (currentTimeoutId.current !== null) {\n      clearTimeout(currentTimeoutId.current);\n    }\n    currentTimeoutId.current = window.setTimeout(fnRef.current, timeout);\n  }, []);\n};\n","import { RefObject, useEffect, useLayoutEffect, useState } from \"react\";\nimport { useDebouncedCallback } from \"@intellij-platform/core/utils/useDebounce\";\n\n/**\n * Clones the element, applies the temporary styles, and calls {@param fn} on the clone.\n * Previously, we applied the temporary styles on the element itself, run fn, and then revert to previous styles,\n * but that can mess with the scroll bar in the content. If there is a scrollable part in some nested element,\n * applying temporary style (in our case width: fit-content, height: fit-content) can cause scroll to jump which is not\n * restored after the style reversion. Now the approach is changed to apply the temporary styles on a temporary clone\n * of the element. It's certainly not as efficient and some optimization may be needed.\n * @param style: temporary styles to apply before fn is invoked, and revert after.\n * @param fn the function to compute something on the element with temporary styles\n */\nconst withTemporaryStyle =\n  <T extends any>(\n    style: Partial<CSSStyleDeclaration>,\n    fn: (element: HTMLElement) => T\n  ) =>\n  (element: HTMLElement): T => {\n    const clone = element.cloneNode(true) as HTMLElement;\n    clone.style.position = \"absolute\";\n    clone.style.left = \"-9999px\";\n    document.body.appendChild(clone);\n\n    Object.assign(clone.style, style);\n    const returnValue = fn(clone);\n\n    document.body.removeChild(clone);\n    return returnValue;\n  };\n\n/**\n * FIXME: withTemporaryStyle is not side-effect free and can cause scroll jumps. It creates awfully hard-to-debug\n *  issues.\n */\nexport const getContentSize = withTemporaryStyle(\n  {\n    width: \"\",\n    minWidth: \"fit-content\", // Shouldn't it be min-content? :-?\n    height: \"\",\n    minHeight: \"fit-content\",\n  },\n  (element) => ({\n    width: Math.ceil(parseFloat(getComputedStyle(element).width)),\n    height: Math.ceil(parseFloat(getComputedStyle(element).height)),\n  })\n);\n\nexport const useContentSize = (\n  ref: RefObject<HTMLElement>,\n  {\n    observe = false,\n  }: {\n    /**\n     * if false, the content size is measured only initially. If true, the dom changes are observed, and content size\n     * is updated accordingly.\n     * @default false\n     */\n    observe?: boolean;\n  } = {}\n) => {\n  const [measuredSizes, setMeasuredSizes] = useState<Size[]>([]);\n  useLayoutEffect(() => {\n    const element = ref.current;\n    if (!element || measuredSizes.length > 5) {\n      return;\n    }\n    const size = getContentSize(element);\n\n    const lastMeasuredSize = measuredSizes.at(-1);\n    if (!lastMeasuredSize || !Size.isEqual(lastMeasuredSize, size)) {\n      setMeasuredSizes([size]);\n    }\n    const id = window.requestAnimationFrame(() => {\n      const newSize = getContentSize(element);\n      if (!Size.isEqual(newSize, size)) {\n        setMeasuredSizes([...measuredSizes, newSize]);\n      }\n    });\n    return () => {\n      window.cancelAnimationFrame(id);\n    };\n  }, [\n    measuredSizes,\n    // ref value shouldn't normally be an effect's dependency, but for some reason, ref value is null in the first call\n    // when built for website. Interestingly, it doesn't happen in storybook. So maybe something to investigate further\n    ref.current,\n  ]);\n  const measure = () => {\n    const lastMeasuredSize = measuredSizes.at(-1);\n    if (ref.current && lastMeasuredSize) {\n      const currentSize = getContentSize(ref.current);\n      if (\n        currentSize.height !== lastMeasuredSize.height ||\n        currentSize.width !== lastMeasuredSize.width\n      ) {\n        setMeasuredSizes(\n          measuredSizes.map((aSize) =>\n            aSize === lastMeasuredSize ? currentSize : aSize\n          )\n        );\n      }\n    }\n  };\n  const debouncedMeasure = useDebouncedCallback(measure);\n\n  useEffect(() => {\n    const element = ref.current;\n    if (observe && element) {\n      const mutationObserver = new MutationObserver(() => {\n        debouncedMeasure();\n      });\n      mutationObserver.observe(element, {\n        subtree: true,\n        childList: true,\n      });\n      return () => {\n        mutationObserver.disconnect();\n      };\n    }\n  }, [\n    observe,\n    // ref value shouldn't normally be an effect's dependency, but for some reason, ref value is null in the first call\n    // when built for website. Interestingly, it doesn't happen in storybook. So maybe something to investigate further\n    ref.current,\n  ]);\n  return [measuredSizes.at(-1) || { width: 0, height: 0 }, measure] as const;\n};\n\ninterface Size {\n  width: number;\n  height: number;\n}\n// eslint-disable-next-line @typescript-eslint/no-redeclare\nexport const Size = {\n  isEqual: (\n    { width, height }: Size,\n    { width: width2, height: height2 }: { width: number; height: number }\n  ) => width === width2 && height === height2,\n};\n","import { RefObject, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  Bounds,\n  OverlayInteractionHandler,\n  OverlayInteractionHandlerProps,\n} from \"./OverlayInteractionHandler\";\nimport { clamp, filter } from \"ramda\";\nimport { useContentSize } from \"@intellij-platform/core/Overlay/useContentSize\";\nimport {\n  getCenteredBounds,\n  withMinSize,\n} from \"@intellij-platform/core/Overlay/bounds-helpers\";\n\n/**\n * Common props for resizable and movable overlays such as Windows or Popups.\n * There is currently no corresponding component/hook, and this is just a type helper.\n */\nexport interface ResizableMovableOverlayOptions {\n  onBoundsChange?: (bounds: Bounds, interactionType: \"move\" | \"resize\") => void;\n  /**\n   * For performance reason, overlay bounds is kept in a local state during a resize or move interaction, and\n   * `onBoundsChange` is called once at the end of interaction. `onBoundsChanging` gives a chance of rectifying\n   * bounds changes during an interaction to for example apply custom size/placement constraints.\n   */\n  onBoundsChanging?: (\n    newBounds: Bounds,\n    /**\n     * Whether the interaction is a \"move\" or \"resize\" considering the initial bounds when interaction was started.\n     */\n    interactionType: \"move\" | \"resize\"\n  ) => Bounds;\n  /**\n   * Controlled bounds. Can be a partially specified bounds.\n   * - If `top` not specified, the returned bounds will be centered vertically.\n   * - If `left` not specified, the returned bounds will be centered horizontally.\n   * - If `width` not specified, the width of the bounds will be based on content width.\n   * - If `height` not specified, the height of the bounds will be based on content height.\n   * Note that regardless of `bounds`, `onBoundsChange` always receives a full `bounds` object which is solely\n   * based on the bounds of the overlay, at the end of an interaction.\n   */\n  bounds?: Partial<Bounds>;\n  /**\n   * Default bounds in uncontrolled mode. Can be a partially specified bounds.\n   * - If `top` not specified, the returned bounds will be centered vertically.\n   * - If `left` not specified, the returned bounds will be centered horizontally.\n   * - If `width` not specified, the width of the bounds will be based on content width.\n   * - If `height` not specified, the height of the bounds will be based on content height.\n   * Note that regardless of `defaultBounds`, `onBoundsChange` always receives a full `bounds` object which is solely\n   * based on the bounds of the overlay, at the end of an interaction.\n   */\n  defaultBounds?: Partial<Bounds>;\n  minWidth?: number | \"content\"; // TODO: support function, receiving measured size, for more flexibility\n  minHeight?: number | \"content\"; // TODO: support function, receiving measured size, for more flexibility\n\n  /**\n   * Allowed interactions:\n   * - \"all\": both resizable and movable\n   * - \"move\": movable, but not resizable\n   * - \"none\": fixed size and position\n   * The reason there are no `resizable` and `movable` boolean props is that resizable=true,movable=false doesn't make\n   * sense from UX perspective.\n   * @default \"all\"\n   */\n  interactions?: \"all\" | \"move\" | \"none\"; // FIXME: it's not used in useResizableMovableOverlay, maybe separate props?\n\n  /**\n   * When the size is not specified by `bounds` or `defaultBounds` props, the content size is measured and used in the\n   * returned bounds. By default, the content size is measured initially. If `observeContentSize` is true, the DOM\n   * mutations will be observed and the content is re-measured as changes are observed.\n   */\n  observeContentResize?: boolean;\n}\n/**\n *\n * TODO: rename to something better? :D\n * TODO: maybe an option like ensureInViewport that would move the final bound into the viewport (if necessary), when\n *  calling onBoundsChange at the end of an interaction. That's important because if move handle(s) (usually rendered\n *  at the top of the overlay) are out of reach, there would be no way back.\n * TODO: description\n * Assumptions:\n * - The overlay is rendered in a portal, and with position \"fixed\".\n * - The returned bounds should be used to style the overlay.\n *   - There shouldn't be other style affecting the positioning, such as margin, or transform.\n *   - If the overlay has border, box-sizing should be \"border-box\"\n */\nexport function useResizableMovableOverlay(\n  overlayRef: RefObject<HTMLElement>,\n  {\n    bounds: inputBounds,\n    defaultBounds,\n    onBoundsChange,\n    onBoundsChanging = (i) => i,\n    minWidth,\n    minHeight,\n    observeContentResize,\n  }: ResizableMovableOverlayOptions\n): {\n  /**\n   * The bounds to be applied as `style` on the overlay, to position it. Even if the input `bounds` or `defaultBounds`\n   * is not defined, returned `bounds` is always a full bounds object. This eliminates any other need for styling,\n   * if the input bounds doesn't define size or position.\n   * NOTE: even when the size is not specified as input, and is to be based on content, the returned `bounds` include\n   * explicit, size, measured **after the first render**. This is because overlays such as windows are not expected to\n   * be resized without user interaction, and just based on the content size change. So we make sure even when the\n   * sizing is based on content, it's stable. If imperative re-measure of the size is needed, or even dynamic resizing\n   * based on content is needed in some cases, it is feasible to add it as an option.\n   */\n  bounds: Bounds;\n  /**\n   * `true` if the returned bounds has explicit position. `false` if it's centered as a fallback.\n   */\n  positioned: boolean;\n  /**\n   * `true` if the returned bounds has explicit size. `false` if it's measured based on content.\n   */\n  sized: boolean;\n  /**\n   * Props to be passed to {@link OverlayInteractionHandler}\n   */\n  overlayInteractionHandlerProps: OverlayInteractionHandlerProps;\n\n  /**\n   * Allow for remeasuring content size imperatively, when needed. Currently only used to work around\n   * an issue related to Suspense in React 17.\n   */\n  UNSAFE_measureContentSize: () => void;\n} {\n  const [bounds, setBounds] = useControlledState<Partial<Bounds> | undefined>(\n    inputBounds,\n    defaultBounds!,\n    // onBoundsChange is called with Bounds object. Not Partial<Bounds>, and not undefined.\n    onBoundsChange as (\n      value: Partial<Bounds> | undefined,\n      reason: \"resize\" | \"move\"\n    ) => void\n  );\n  const [contentSize, measureContentSize] = useContentSize(overlayRef, {\n    observe: observeContentResize,\n  });\n  // local state of bounds for when the overlay is in a UI interaction, like movement or resize with mouse.\n  // We don't want to update the state in the higher levels repeatedly in such transactions, and we just want to\n  // trigger on update when the UI interaction is done.\n  // It's maintained during a UI interaction and then reset to null.\n  const [currentInteraction, setCurrentInteraction] = useState<null | {\n    type: \"move\" | \"resize\";\n    bounds: Bounds;\n  }>(null);\n\n  const effectiveMinWidth =\n    minWidth === \"content\" ? contentSize.width : minWidth || 0;\n  const effectiveMinHeight =\n    minHeight === \"content\" ? contentSize.height : minHeight || 0;\n  const applyMinSize = withMinSize({\n    width: effectiveMinWidth,\n    height: effectiveMinHeight,\n  });\n  const overlayInteractionHandlerProps: OverlayInteractionHandlerProps = {\n    startInteraction: (type: \"move\" | \"resize\") => {\n      if (!overlayRef.current) {\n        throw new Error(\n          \"overlayRef value is not set. Make sure to have the ref passed to the resizable/movable overlay\"\n        );\n      }\n      const bounds = getBounds(overlayRef.current);\n      setCurrentInteraction({ bounds, type });\n      return bounds;\n    },\n    updateBounds: (updatedBounds) => {\n      setCurrentInteraction((currentInteraction) => {\n        if (currentInteraction) {\n          const { type } = currentInteraction;\n          return {\n            type,\n            bounds: onBoundsChanging(updatedBounds, type) || updatedBounds,\n          };\n        }\n        return currentInteraction;\n      });\n    },\n    finishInteraction: () => {\n      if (currentInteraction && overlayRef.current) {\n        // @ts-expect-error https://github.com/adobe/react-spectrum/issues/6784\n        setBounds(getBounds(overlayRef.current), currentInteraction.type);\n      }\n      setCurrentInteraction(null);\n    },\n    minWidth: effectiveMinWidth,\n    minHeight: effectiveMinHeight,\n  };\n\n  const partialBounds = currentInteraction?.bounds ?? bounds;\n  const centeredContentBounds = getCenteredBounds(\n    clamp(\n      effectiveMinWidth,\n      window.innerWidth,\n      bounds?.width ?? contentSize.width\n    ),\n    clamp(\n      effectiveMinHeight,\n      window.innerHeight,\n      bounds?.height ?? contentSize.height\n    )\n  );\n  return {\n    positioned:\n      partialBounds?.left != undefined && partialBounds?.top != undefined,\n    sized:\n      partialBounds?.width != undefined && partialBounds?.height != undefined,\n    bounds: applyMinSize({\n      /**\n       * Since input bounds may be partial (e.g. only specifying size), we create a full bounds object as a fallback,\n       * based on the measured size, positioned in center. We can introduce a \"loose\" mode, where the returned bound\n       * is not \"filled\" with default properties.\n       */\n      ...centeredContentBounds,\n      ...(partialBounds && filter((value) => value != null, partialBounds)),\n    }),\n    UNSAFE_measureContentSize: measureContentSize,\n    overlayInteractionHandlerProps,\n  };\n}\n\nfunction getBounds(element: HTMLElement) {\n  const { left, top, width, height } = element.getBoundingClientRect();\n  return { left, top, width, height };\n}\n","import React, { ForwardedRef, RefObject, useContext, useState } from \"react\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { useFocusWithin, useInteractOutside } from \"@react-aria/interactions\";\nimport { FocusScope, useFocusable } from \"@react-aria/focus\";\nimport { useOverlay, usePreventScroll } from \"@react-aria/overlays\";\nimport { filterDOMProps, useObjectRef } from \"@react-aria/utils\";\nimport { pipe } from \"ramda\";\n\nimport {\n  areInNestedOverlays,\n  ensureInViewport,\n  Overlay,\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  position,\n  ResizableMovableOverlayOptions,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { mergeNonNullProps } from \"@intellij-platform/core/utils/mergeNonNullProps\";\nimport { useFocusForwarder } from \"@intellij-platform/core/utils/useFocusForwarder\";\n\nimport { useDialog } from \"./_useDialog\";\nimport { PopupHeader } from \"./PopupHeader\";\nimport { PopupContext, PopupControllerContext } from \"./PopupContext\";\nimport { PopupLayout } from \"./PopupLayout\";\nimport { StyledPopupHint } from \"./StyledPopupHint\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n`;\nexport interface PopupProps extends ResizableMovableOverlayOptions, DOMProps {\n  children: React.ReactNode;\n  onClose?: () => void;\n\n  nonDismissable?: boolean;\n\n  /**\n   * By default, Popup prevents scrolling on the scrollable ancestor, if popup is positioned relative to a target\n   * element. Allowing or disallowing scroll can be forced by passing boolean value.\n   */\n  allowScroll?: \"auto\" | boolean;\n\n  /**\n   * Used to position the popup relative to a target element, if there is no positioning information in the input\n   * `bounds`/`defaultBounds`.\n   */\n  positioning?: {\n    targetRef: RefObject<HTMLElement>;\n    placement?: \"bottom\" | \"top\";\n  };\n}\n\nexport const DEFAULT_POPUP_MIN_WIDTH = 50;\nexport const DEFAULT_POPUP_MIN_HEIGHT = 50;\n\n/**\n * [Popup](https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-%28Community%29?node-id=75426%3A16881&t=vzpRGV2y2cDw5a6Z-0)\n * component, rendered as a draggable overlay which is positioned either in the center of the viewport or relative to a trigger element.\n * If there is a trigger element, use {@link PopupTrigger} instead.\n */\nexport const _Popup = (\n  // NOTE: export is only for __docgenInfo to be emitted for this.\n  {\n    interactions = \"move\",\n    nonDismissable = false,\n    allowScroll = \"auto\",\n    minWidth = DEFAULT_POPUP_MIN_WIDTH,\n    minHeight = DEFAULT_POPUP_MIN_HEIGHT,\n    positioning: positioningProp,\n    onClose: onCloseProp,\n    ...props\n  }: PopupProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element => {\n  const propsContext = useContext(PopupControllerContext);\n  const positioning = positioningProp || propsContext.positioning;\n  const onClose = () => {\n    onCloseProp?.();\n    propsContext.onClose?.();\n  };\n  const ref = useObjectRef<HTMLDivElement>(forwardedRef);\n  const shouldCloseOnInteractOutside = (element: Element) => {\n    return (\n      !positioning?.targetRef.current?.contains(element) &&\n      !areInNestedOverlays(ref.current, element)\n    );\n  };\n  const { overlayProps } = useOverlay(\n    {\n      isOpen: true, // FIXME?\n      onClose,\n      shouldCloseOnBlur: !nonDismissable,\n      shouldCloseOnInteractOutside,\n    },\n    ref\n  );\n  // Passing isDismissable to useOverlay also utilizes useInteractOutside and closes the overlay, but it calls\n  // preventDefault() and stopPropagation() on the event, which prevents focus from going to elements outside the popup.\n  // Not sure why they do this in react-aria, but it seems we are better off not using that option and using\n  // useInteractOutside directly here like this:\n  useInteractOutside({\n    ref,\n    onInteractOutsideStart: (e) => {\n      if (\n        !nonDismissable &&\n        shouldCloseOnInteractOutside(e.target as Element)\n      ) {\n        onClose();\n      }\n    },\n    // onInteractOutsideStart will not be called if onInteractOutside is not passed!\n    onInteractOutside: () => {},\n  });\n\n  usePreventScroll({\n    isDisabled: allowScroll === \"auto\" ? !positioning : allowScroll,\n  });\n\n  const { bounds, positioned, overlayInteractionHandlerProps } =\n    useResizableMovableOverlay(ref, {\n      ...props,\n      minWidth,\n      minHeight,\n      observeContentResize: true,\n    });\n  const positionedBounds =\n    positioning?.targetRef.current && !positioned\n      ? pipe(\n          position({\n            targetElement: positioning.targetRef.current,\n            placement: positioning.placement,\n          }),\n          ensureInViewport\n        )(bounds)\n      : bounds;\n\n  const [isActive, setActive] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setActive,\n  });\n  const { focusableProps } = useFocusable(\n    {\n      excludeFromTabOrder: true,\n    },\n    ref\n  );\n  const { focusForwarderProps } = useFocusForwarder();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  /**\n   * A hook like useOverlayStack or useOverlayZIndex can be introduced which would handle focus/blur, and return/set\n   * the right z-index so that only the overlay holding the focus would have a higher z-index than others.\n   */\n  const zIndex = isActive ? 1 : 0;\n\n  return (\n    <Overlay>\n      <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n        {/* TODO: FocusScope is redundant. Test focus restoration without it (in status bar progress), and remove it if unnecessary */}\n        <FocusScope restoreFocus>\n          <StyledPopupContainer\n            ref={ref}\n            style={{\n              ...positionedBounds,\n              zIndex,\n            }}\n            tabIndex={-1}\n            {...mergeNonNullProps(\n              focusWithinProps,\n              focusableProps,\n              focusForwarderProps,\n              overlayProps,\n              propsContext.overlayProps || {},\n              dialogProps,\n              filterDOMProps(props)\n            )}\n          >\n            <PopupContext.Provider\n              value={{\n                isActive,\n                movable: interactions !== \"none\",\n                titleProps,\n              }}\n            >\n              <StyledInnerContainer>{props.children}</StyledInnerContainer>\n              {interactions === \"all\" && <OverlayResizeHandles />}\n            </PopupContext.Provider>\n          </StyledPopupContainer>\n        </FocusScope>\n      </OverlayInteractionHandler>\n    </Overlay>\n  );\n};\n\nexport const Popup = Object.assign(React.forwardRef(_Popup), {\n  Header: PopupHeader,\n  Layout: PopupLayout,\n  Hint: StyledPopupHint,\n});\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { AriaDialogProps } from \"@react-types/dialog\";\nimport { FocusableElement } from \"@react-types/shared\";\nimport { filterDOMProps, useSlotId } from \"@react-aria/utils\";\nimport { focusSafely } from \"@react-aria/focus\";\nimport { RefObject, useEffect } from \"react\";\nimport { useOverlayFocusContain } from \"@react-aria/overlays\";\nimport { DialogAria } from \"@react-aria/dialog\";\n\n////////////////// NOTE //////////////////////////\n// This is a copy of useDialog from react-aria, with a little part removed from the useEffect call.\n// In the original code, inside the effect, there is a hack to fix an issue in Safari, which involves\n// blurring and refocusing the element. Even though there is a comment about an attempt to make it work\n// nice when used with `shouldCloseOnBlur` option of `useOverlay`, it didn't work and the refocusing causes\n// the popup to close. Probably because in our case useOverlay and useDialog are used in the same level, but\n// in what they've tested on in react-aria, useDialog is used in something nested in the component that uses\n// useDialog.\n// TODO: replace with original useDialog, if the issue explained above got fixed in some version of react-aria.\n//////////////////////////////////////////////////\n/**\n * Provides the behavior and accessibility implementation for a dialog component.\n * A dialog is an overlay shown above other content in an application.\n */\nexport function useDialog(\n  props: AriaDialogProps,\n  ref: RefObject<FocusableElement>\n): DialogAria {\n  let { role = \"dialog\" } = props;\n  let titleId: string | undefined = useSlotId();\n  titleId = props[\"aria-label\"] ? undefined : titleId;\n\n  // Focus the dialog itself on mount, unless a child element is already focused.\n  useEffect(() => {\n    if (ref.current && !ref.current.contains(document.activeElement)) {\n      focusSafely(ref.current);\n    }\n  }, [ref]);\n\n  useOverlayFocusContain();\n\n  return {\n    dialogProps: {\n      ...filterDOMProps(props, { labelable: true }),\n      role,\n      tabIndex: -1,\n      \"aria-labelledby\": props[\"aria-labelledby\"] || titleId,\n    },\n    titleProps: {\n      id: titleId,\n    },\n  };\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport { filter } from \"ramda\";\n\n/**\n * Like mergeProps, but doesn't merge props where value is null or undefined. That's needed because useFocusable (and\n * maybe some other react-aria hooks as well) return props like onFocus, with value set to null or undefined, which\n * overrides the same prop from other sources.\n */\n// @ts-expect-error not sure why!\nexport const mergeNonNullProps: typeof mergeProps = (...propsArray) => {\n  return mergeProps(\n    ...propsArray.map((props): typeof props =>\n      filter((value) => value != undefined, props ?? [])\n    )\n  );\n};\n","import { DOMAttributes } from \"@react-types/shared\";\nimport { createContext } from \"react\";\nimport { PopupProps } from \"./Popup\";\n\nexport const PopupContext = createContext<{\n  isActive: boolean;\n  movable: boolean;\n  titleProps: DOMAttributes;\n}>({ isActive: false, movable: true, titleProps: {} });\n\n/**\n * A context to provide some props that are necessary for PopupTrigger or PopupManager.\n * Passing those props via context helps with providing a nice API in those components.\n */\nexport const PopupControllerContext = createContext<\n  {\n    overlayProps?: DOMAttributes;\n  } & Partial<Pick<PopupProps, \"positioning\" | \"onClose\">>\n>({});\n","import React, { CSSProperties, HTMLAttributes, useContext } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\n\nimport { PopupContext } from \"./PopupContext\";\n\nconst StyledPopupHeader = styled.div<{\n  active?: boolean;\n  hasControls?: boolean;\n}>`\n  box-sizing: border-box;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 1.5rem;\n  min-height: ${({ hasControls }) => hasControls && \"1.75rem\"};\n  cursor: default;\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"Popup.Header.activeForeground\" as UnknownThemeProp<\"Popup.Header.activeForeground\">,\n          theme.commonColors.labelForeground\n        )\n      : theme.color(\n          \"Popup.Header.inactiveForeground\" as UnknownThemeProp<\"Popup.Header.inactiveForeground\">,\n          theme.commonColors.labelDisabledForeground\n        )};\n  background-color: ${({ theme, active }) =>\n    active\n      ? theme.color(\"Popup.Header.activeBackground\", \"#e6e6e6\")\n      : theme.color(\"Popup.Header.inactiveBackground\", `#ededed`)};\n`;\n/**\n * Implements appearance of\n * [Popup Header](https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-%28Community%29?node-id=75455%3A26566&t=Hzwse5j5R6iCEzVW-4),\n * and also acts as a handle for moving the panel.\n * Expected to be used with {@link Popup#Layout}:\n *\n * @example\n * ```tsx\n * <Popup>\n *    <Popup.Layout header={<Popup.Header>header</Popup.Header>} />\n * </Popup>\n * ```\n */\nexport const PopupHeader = ({\n  children,\n  hasControls,\n  className,\n  style,\n}: {\n  children?: React.ReactNode;\n  hasControls?: boolean;\n  className?: string;\n  style?: CSSProperties;\n}) => {\n  const { isActive, movable, titleProps } = useContext(PopupContext);\n  const renderHeader = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledPopupHeader\n      active={isActive}\n      hasControls={hasControls}\n      className={className}\n      style={style}\n      {...mergeProps(titleProps, otherProps)}\n    >\n      {children}\n    </StyledPopupHeader>\n  );\n  return movable ? (\n    <OverlayMoveHandle>\n      {({ moveHandleProps }) => renderHeader(moveHandleProps)}\n    </OverlayMoveHandle>\n  ) : (\n    renderHeader()\n  );\n};\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { Popup } from \"./Popup\";\nimport { PopupHeader } from \"./PopupHeader\";\nimport { StyledPopupHint } from \"@intellij-platform/core/Popup/StyledPopupHint\";\n\nconst StyledPopupLayout = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n`;\nconst StyledPopupLayoutHeader = styled.div`\n  flex-shrink: 0;\n`;\nconst StyledPopupLayoutContent = styled.div`\n  flex: 1;\n  overflow: auto;\n  // Not sure about making the content area a vertical flex container, but it seemed it makes sense as default.\n  // The use case at hand where this was added was \"Branches\" popup, which would of course be implementable without this\n  // too, with an extra flex container around the menu.\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledPopupLayoutFooter = styled.div`\n  flex-shrink: 0;\n`;\n\n/**\n * Popup content layout, supporting fixed `header` and `footer` sections, and a scrollable `content` area.\n */\nexport function PopupLayout({\n  header,\n  footer,\n  content,\n}: {\n  /**\n   * Fixed position header of the popup at the top. {@link Popup.Header} can be used for the content.\n   */\n  header?: React.ReactNode;\n  /**\n   * Scrollable content of the popup.\n   */\n  content: React.ReactNode;\n  /**\n   * Fixed position footer of the popup at the bottom. {@link Popup.Hint} can be used for the content.\n   */\n  footer?: React.ReactNode;\n}) {\n  return (\n    <StyledPopupLayout>\n      {header && (\n        <StyledPopupLayoutHeader>\n          {typeof header === \"string\" ? (\n            <PopupHeader>{header}</PopupHeader>\n          ) : (\n            header\n          )}\n        </StyledPopupLayoutHeader>\n      )}\n      <StyledPopupLayoutContent>{content}</StyledPopupLayoutContent>\n      {footer && (\n        <StyledPopupLayoutFooter>\n          {typeof footer === \"string\" ? (\n            <StyledPopupHint>{footer}</StyledPopupHint>\n          ) : (\n            footer\n          )}\n        </StyledPopupLayoutFooter>\n      )}\n    </StyledPopupLayout>\n  );\n}\n","import React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { Popup, PopupProps } from \"./Popup\";\nimport { PopupControllerContext } from \"@intellij-platform/core/Popup/PopupContext\";\n\nexport interface PopupManagerAPI {\n  /**\n   * Shows a popup within the stack of popups managed by {@link PopupManager}.\n   * The opened popup will be closed when `onClose` interactions happen.\n   */\n  show(\n    popup:\n      | React.ReactElement<PopupProps, typeof Popup>\n      | ((args: {\n          close: () => void;\n        }) => React.ReactElement<PopupProps, typeof Popup>)\n  ): void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\n    \"PopupManager not found. Wrap your application with PopupManager to be able to open popups imperatively\"\n  );\n};\n\nconst PopupsContext = React.createContext<PopupManagerAPI>({\n  show: NotImplementedFn,\n});\n\n/**\n * Returns imperative API for showing popups.\n */\nexport const usePopupManager = (): PopupManagerAPI => useContext(PopupsContext);\n\ntype PopupElement = ReactElement<PopupProps, typeof Popup>;\n\nexport interface PopupManagerProps {\n  children?: ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link usePopupManager}) for showing Popups.\n * It renders popups in a portal appended to `body`, unless `disablePortal` is `true`.\n */\nexport const PopupManager: React.FC<PopupManagerProps> = ({ children }) => {\n  const [popups, setPopups] = useState<Array<PopupElement>>([]);\n  const newKeyRef = useRef<number>(0);\n\n  const api = useMemo<PopupManagerAPI>(() => {\n    const show: PopupManagerAPI[\"show\"] = (popup) => {\n      newKeyRef.current++;\n      const close = () => {\n        setPopups((currentPopups) =>\n          currentPopups.filter((aPopup) => aPopup !== wrappedPopup)\n        );\n      };\n      const wrappedPopup = (\n        <PopupControllerContext.Provider\n          key={newKeyRef.current}\n          value={{ onClose: close }}\n        >\n          {typeof popup === \"function\" ? popup({ close }) : popup}\n        </PopupControllerContext.Provider>\n      );\n      setPopups((currentPopups) => currentPopups.concat(wrappedPopup));\n    };\n    return {\n      show,\n    };\n  }, []);\n\n  return (\n    <PopupsContext.Provider value={api}>\n      {children}\n      {popups}\n    </PopupsContext.Provider>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { OverlayTriggerProps, useOverlayTrigger } from \"@react-aria/overlays\";\nimport { PressResponder } from \"@react-aria/interactions\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport {\n  OverlayTriggerProps as OverlayTriggerStateProps,\n  useOverlayTriggerState,\n} from \"@react-stately/overlays\";\n\nimport { PopupProps } from \"./Popup\";\nimport { PopupControllerContext } from \"./PopupContext\";\n\nexport interface PopupTriggerProps\n  extends Partial<OverlayTriggerProps>,\n    OverlayTriggerStateProps {\n  placement?: Required<PopupProps>[\"positioning\"][\"placement\"];\n  popup:\n    | React.ReactElement\n    | (({ close }: { close: () => void }) => React.ReactNode);\n  children: React.ReactElement;\n}\n\n/**\n * Popup opened by a trigger. `trigger` can be an element of any pressable component (such as {@link Button} or\n * {@link IconButton}), and is rendered in place. Similar to {@link Popup component}, `children` defines the content\n * of Popup.\n */\nexport const PopupTrigger = React.forwardRef(function PopupTrigger(\n  { placement, children, popup, ...props }: PopupTriggerProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  const state = useOverlayTriggerState(props);\n  const triggerRef = useObjectRef(forwardedRef);\n  const { overlayProps, triggerProps } = useOverlayTrigger(\n    { type: props.type || \"menu\" },\n    state,\n    triggerRef\n  );\n  return (\n    <>\n      <PressResponder ref={triggerRef} {...triggerProps}>\n        {children}\n      </PressResponder>\n      {state.isOpen && (\n        <PopupControllerContext.Provider\n          value={{\n            overlayProps,\n            positioning: {\n              targetRef: triggerRef,\n              placement,\n            },\n            onClose: state.close,\n          }}\n        >\n          {typeof popup === \"function\" ? popup({ close: state.close }) : popup}\n        </PopupControllerContext.Provider>\n      )}\n    </>\n  );\n});\n","import { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport const StyledPopupContainer = styled.div`\n  position: fixed;\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\n\n/**\n * Hint component (aka Advertiser) used in Popup's footer.\n * {@see Popup.Layout}\n */\nexport const StyledPopupHint = styled.div`\n  // NOTE: Following the reference implementation, would require to set fallback colors non-prior to\n  // *.(background|foreground) colors (by not passing the fallback color as the second argument to theme.color).\n  // It's only in BigPopup that the fallback colors are prioritized over *-fallback. But in Figma designs, this is\n  // simplified, and hint always has the muted color (like in BigPopup), instead of the default foreground.\n  // So we are intentionally deviating from the reference implementation here.\n  background: ${({ theme }) =>\n    theme.color(\n      \"Popup.Advertiser.background\",\n      theme.color(\"SearchEverywhere.Advertiser.background\")\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Popup.Advertiser.foreground\",\n      theme.color(\"SearchEverywhere.Advertiser.foreground\")\n    )};\n  padding: 0.3125rem 0.9375rem 0.3125rem 0.625rem;\n  font-size: 0.875em;\n  line-height: normal;\n  user-select: none;\n  cursor: default;\n  // NOTE: white-space is intentionally not set as nowrap.\n`;\n","import React, {\n  CSSProperties,\n  HTMLAttributes,\n  Ref,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { keyframes } from \"styled-components\";\nimport { useProgressBar } from \"@react-aria/progress\";\nimport { AriaProgressBarProps } from \"@react-types/progress\";\nimport { PressProps, useHover } from \"@react-aria/interactions\";\nimport { useButton } from \"@react-aria/button\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\n\nexport interface ProgressBarProps extends Omit<AriaProgressBarProps, \"label\"> {\n  /**\n   * Process name, shown above or to the left of the progress bar. Placement is controlled by {@link namePosition}.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-name\n   */\n  name?: React.ReactNode;\n\n  /**\n   * Process name position with respect to the progress bar.\n   * If `namePosition` is \"side\", {@link name} is **not** automatically appended with a colon.\n   * @default \"top\"\n   */\n  namePosition?: \"side\" | \"top\";\n\n  /**\n   * Process details, placed bellow the progress bar, with a de-emphasized color.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-details\n   */\n  details?: React.ReactNode;\n\n  /**\n   * A second line of details. Not an officially documented feature, but it's supported in the reference impl.\n   */\n  secondaryDetails?: React.ReactNode;\n\n  /**\n   * Placed next to and aligned with the progress bar, used for\n   * [process control](https://jetbrains.github.io/ui/controls/progress_bar/#process-control) buttons.\n   */\n  button?: React.ReactNode;\n\n  /**\n   * Progress bar track width.\n   */\n  width?: CSSProperties[\"width\"];\n\n  /**\n   * Not supported in [the official specs](https://jetbrains.github.io/ui/controls/progress_bar/#25), but the progress\n   * bar in status bar has a denser spacing. It still won't be a pixel perfect match with the progress bar in the\n   * status bar.\n   */\n  dense?: boolean;\n\n  /** Whether the value's label is displayed. True by default if there's a label, false by default if not. */\n  showValueLabel?: boolean;\n\n  style?: HTMLAttributes<unknown>[\"style\"];\n  className?: HTMLAttributes<unknown>[\"className\"];\n}\n\ninterface ProgressBarContextObj {\n  setForcedDetails: (details: string | null) => void;\n  setTooltip: (tooltip: string | null) => void;\n}\n\n/**\n * @see https://jetbrains.github.io/ui/controls/progress_bar/\n * @see https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/platform-api/src/com/intellij/openapi/ui/panel/ProgressPanelBuilder.java\n *\n * Known issues:\n * There are a couple of UI issues because of the current layout (which can be improved probably):\n * - max-width of the label and details, it's not necessarily aligned with the the progressbar track, because they don't\n *   share the same container\n * - when label is on the side, details is aligned with the label, instead of the progressbar track.\n */\nexport const ProgressBar = ({\n  value = 0,\n  maxValue = 100,\n  minValue = 0,\n  name,\n  namePosition = \"top\",\n  details,\n  secondaryDetails,\n  button,\n  width,\n  dense,\n  className,\n  style,\n  valueLabel,\n  showValueLabel = Boolean(valueLabel),\n  ...props\n}: ProgressBarProps): React.ReactElement => {\n  const { progressBarProps, labelProps } = useProgressBar({\n    ...props,\n    label: name,\n    value,\n    valueLabel,\n    maxValue,\n    minValue,\n  });\n  const percentage = (100 * (value / maxValue)).toFixed(0);\n  const [forcedDetails, setForcedDetails] = useState<null | string>(\"\");\n  const [tooltip, setTooltip] = useState<null | string>(\"\");\n\n  const contextValue: ProgressBarContextObj = useMemo(\n    () => ({\n      setForcedDetails,\n      setTooltip,\n    }),\n    []\n  );\n  const label = (\n    <StyledProgressBarLabel {...labelProps}>{name}</StyledProgressBarLabel>\n  );\n  const effectiveDetails = details ? tooltip || forcedDetails || details : null;\n  return (\n    <StyledProgressBarContainer style={style} className={className}>\n      {namePosition === \"top\" && label}\n      <StyledProgressBarLineContainer\n        dense={dense}\n        hasTopMargin={Boolean(name) && namePosition === \"top\"}\n        hasBottomMargin={Boolean(effectiveDetails)}\n      >\n        {namePosition === \"side\" && label}\n        <StyledProgressBarTrack\n          style={{ width }}\n          {...progressBarProps}\n          indeterminate={props.isIndeterminate}\n        >\n          {!props.isIndeterminate && (\n            <StyledProgressBarProgress style={{ width: `${percentage}%` }} />\n          )}\n        </StyledProgressBarTrack>\n        {showValueLabel && <span>{valueLabel ?? `${percentage}%`}</span>}\n        <ProgressBarContext.Provider value={contextValue}>\n          {button}\n        </ProgressBarContext.Provider>\n      </StyledProgressBarLineContainer>\n      <StyledProgressBarDetails>{effectiveDetails}</StyledProgressBarDetails>\n      <StyledProgressBarDetails>{secondaryDetails}</StyledProgressBarDetails>\n    </StyledProgressBarContainer>\n  );\n};\n\nconst ProgressBarContext = React.createContext<null | ProgressBarContextObj>(\n  null\n);\n\nconst StyledProgressBarContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.labelForeground /* TODO: check*/};\n  cursor: default; // prevent cursor on text\n`;\n\nconst StyledProgressBarLineContainer = styled.div<{\n  dense?: boolean;\n  hasTopMargin?: boolean;\n  hasBottomMargin?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  gap: ${({ dense }) => (dense ? \"0.5rem\" : \"0.625rem\")};\n  height: 4px;\n  // spacing is based on the reference impl and figma designs. top and bottom spacing is inverted in the spec document\n  // figma: https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-(Community)?node-id=75426%3A16650\n  // spec document: https://jetbrains.github.io/ui/controls/progress_bar/#25\n  margin-top: ${({ hasTopMargin }) => hasTopMargin && \"0.375rem\"};\n  margin-bottom: ${({ hasBottomMargin }) => hasBottomMargin && \"0.25rem\"};\n`;\n\nconst StyledProgressBarLabel = styled.div`\n  white-space: nowrap;\n  max-width: calc(100% - 2rem);\n  overflow: hidden;\n`;\n\nconst StyledProgressBarDetails = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n  font-size: 0.82em;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 2rem); // not the best way\n`;\n\nconst StyledProgressBarTrack = styled.div<{ indeterminate?: boolean }>`\n  height: inherit;\n  border-radius: 2px;\n  overflow: hidden;\n  display: flex;\n\n  // In case used in flex layout\n  min-width: 0;\n  flex: 1;\n\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.trackColor\",\n      theme.dark ? \"rgb(85,85,85)\" : \"rgb(196,196,196)\"\n    )};\n  ${({ indeterminate }) =>\n    indeterminate &&\n    css`\n      background: linear-gradient(\n        90deg,\n        ${getIndeterminateStartColor} 0%,\n        ${getIndeterminateEndColor} 50%,\n        ${getIndeterminateStartColor} 100%\n      );\n      background-size: 96px auto;\n      animation: 800ms ${indeterminateBackgroundAnimation} linear infinite;\n    `}\n`;\n\nconst getIndeterminateStartColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateStartColor\");\nconst getIndeterminateEndColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateEndColor\");\n\nconst indeterminateBackgroundAnimation = keyframes`\n  0% {\n    background-position: 0;\n  }\n  100% {\n    background-position: 96px;\n  }\n`;\n\nconst StyledProgressBarProgress = styled.div`\n  height: 100%;\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.progressColor\",\n      theme.dark ? \"rgb(160,160,160)\" : \"rgb(128,128,128)\"\n    )};\n`;\n\ntype ProgressBarIconButtonProps = Pick<PressProps, \"onPress\"> & {\n  hoverTooltip: string;\n};\n\n/**\n * Accessibility and functionality of progress bar icon buttons\n * @private maybe?\n */\nexport function useProgressBarIconButton(\n  { onPress, hoverTooltip }: ProgressBarIconButtonProps,\n  ref: Ref<HTMLElement>\n) {\n  const { buttonProps } = useButton(\n    {\n      onPress,\n      elementType: \"span\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: it works, but it's intentionally excluded from the type.\n      preventFocusOnPress: true,\n    },\n    ref\n  );\n  const context = useContext(ProgressBarContext);\n  const { hoverProps, isHovered } = useHover({});\n  useEffect(() => {\n    context?.setTooltip(isHovered ? hoverTooltip : null);\n  }, [hoverTooltip, isHovered]);\n  return {\n    buttonProps: mergeProps(buttonProps, hoverProps),\n  };\n}\n\n/**\n * @private maybe?\n * */\nexport function useProgressBarPauseIconButton(\n  { paused, ...props }: ProgressBarIconButtonProps & { paused: boolean },\n  ref: Ref<HTMLElement>\n) {\n  const context = useContext(ProgressBarContext);\n  useEffect(() => {\n    context?.setForcedDetails(paused ? \"Paused\" : null);\n  }, [paused]);\n  return useProgressBarIconButton(props, ref);\n}\n\n/**\n * Experimenting with an idea of exposing parts on each component, to maximize styling customizability, similar to\n * [classes](https://mui.com/joy-ui/api/button/#classes) API in MUI components. But instead of passing classes prop,\n * one would be able to create custom versions of a component by doing something like this:\n * const CustomComponent = styled(Component)`\n *   ${Component.part1} {\n *     // custom style here\n *   }\n * `;\n * The question is if this type of customizability is actually a good thing in the balance between flexibility for\n * catering for different use cases and not stepping out of the design system boundaries.\n * Another potential downside is that the public API expands to the anatomy of the component.\n */\nProgressBar.Container = StyledProgressBarContainer;\nProgressBar.Label = StyledProgressBarLabel;\nProgressBar.LineContainer = StyledProgressBarLineContainer;\nProgressBar.Track = StyledProgressBarTrack;\nProgressBar.Progress = StyledProgressBarProgress;\nProgressBar.Details = StyledProgressBarDetails;\n","import React, { useRef } from \"react\";\nimport { AutoHoverPlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { useProgressBarIconButton } from \"./ProgressBar\";\n\ninterface ProgressBarCancelButtonProps {\n  /**\n   * whether small icon should be used.\n   */\n  small?: boolean;\n  onPress: () => void;\n}\n\n/**\n * Stop (cancel) icon button for progress bar, to be used in {@link ProgressBarProps#button}.\n */\nexport const ProgressBarStopButton = ({\n  small,\n  onPress,\n}: ProgressBarCancelButtonProps) => {\n  const ref = useRef<HTMLSpanElement>(null);\n  const { buttonProps } = useProgressBarIconButton(\n    { onPress, hoverTooltip: \"Cancel\" },\n    ref\n  );\n  return (\n    <AutoHoverPlatformIcon\n      ref={ref}\n      {...buttonProps}\n      icon={`process/stop${small ? \"Small\" : \"\"}.svg`}\n      hoverIcon={`process/stop${small ? \"Small\" : \"\"}Hovered.svg`}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n} from \"./ThreeViewSplitter/ThreeViewSplitter\";\n\ntype ResizableViewProps = Omit<\n  ThreeViewSplitterProps,\n  | \"innerView\"\n  | \"firstView\"\n  | \"firstSize\"\n  | \"onFirstResize\"\n  | \"lastView\"\n  | \"lastSize\"\n  | \"onLastResize\"\n> & {\n  children: React.ReactNode;\n  onResize: ThreeViewSplitterProps[\"onFirstResize\"];\n  size: ThreeViewSplitterProps[\"firstSize\"];\n  /**\n   * Whether the resizer should be placed at before or after the resizable view.\n   */\n  resizerPlacement?: \"before\" | \"after\";\n};\n/**\n * A single resizable view, built on top of {@link ThreeViewSplitter}, just to provide better prop interface.\n * Like `ThreeViewSplitter` it supports \"horizontal\" or \"vertical orientations. There is an extra `resizerPlacement`\n * prop which determines where the resizer should be placed in relation with the view. When set to \"before\" the view\n * will be resizable from the start (\"left\" or \"top\"). When set to \"after\" the view will be resizable from end (\"right\"\n * or \"bottom\"). Default is \"after\"\n */\nexport const ResizableView = ({\n  children,\n  size,\n  onResize,\n  resizerPlacement = \"after\",\n  ...props\n}: ResizableViewProps) => (\n  <ThreeViewSplitter\n    {...(resizerPlacement === \"after\"\n      ? { firstView: children, firstSize: size, onFirstResize: onResize }\n      : { lastView: children, lastSize: size, onLastResize: onResize })}\n    {...props}\n  />\n);\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useBottomResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will increase/decrease the height\n */\nexport const BottomResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useBottomResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype HorizontalResizerViewProps = ResizerViewProps<\"horizontal\">;\n\nconst StyledHorizontalResizer = styled.div`\n  top: 0;\n  height: 100%;\n  width: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledHorizontalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: HorizontalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  width: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  height: 100%;\n  left: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a horizontal layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const HorizontalResizer: React.FC<HorizontalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"col\",\n  children,\n  style = {},\n  resizerProps,\n}) => {\n  return (\n    <StyledHorizontalResizer\n      {...resizerProps}\n      style={{ ...style, background, width: size }}\n    >\n      {children}\n      <StyledHorizontalResizerArea handleSize={outerPadding} cursor={cursor} />\n    </StyledHorizontalResizer>\n  );\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useLeftResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the left side of the resizable view. i.e.\n * moving mouse to right/left will decrease/increase the width\n */\nexport const LeftResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useLeftResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useRightResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the right side of the resizable view. i.e.\n * moving mouse to right/left will increase/decrease the width\n */\nexport const RightResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useRightResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useTopResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will decrease/increase the height\n */\nexport const TopResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useTopResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype VerticalResizerViewProps = ResizerViewProps<\"vertical\">;\n\nconst StyledVerticalResizer = styled.div`\n  width: 100%;\n  height: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledVerticalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: VerticalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  height: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  width: 100%;\n  top: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a vertical layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const VerticalResizer: React.FC<VerticalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"row\",\n  resizerProps,\n  children,\n  style = {},\n}) => (\n  <StyledVerticalResizer\n    {...resizerProps}\n    style={{ ...style, background, height: size }}\n  >\n    {children}\n    <StyledVerticalResizerArea handleSize={outerPadding} cursor={cursor} />\n  </StyledVerticalResizer>\n);\n","import { useMove } from \"../utils/interaction-utils/useMove\";\nimport { ResizerProps } from \"./ResizerProps\";\n\ntype UseResizerProps = Pick<\n  ResizerProps,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n>;\n\nexport type ResizerViewProps<O = \"horizontal\" | \"vertical\"> = Omit<\n  ResizerProps<O>,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n> &\n  ReturnType<typeof useResizer>;\n\nconst useResizer = (\n  orientation: \"horizontal\" | \"vertical\",\n  invert: boolean,\n  { onResizeStarted, onResize, onResizeEnd }: UseResizerProps\n) => {\n  const props = useMove({\n    dragThreshold: 0,\n    onMoveStart: () => onResizeStarted() || 0,\n    onMoveEnd: () => onResizeEnd?.(),\n    onMove: ({ movement, startState }) =>\n      onResize(\n        startState +\n          (invert ? -1 : +1) *\n            movement[orientation === \"horizontal\" ? \"x\" : \"y\"]\n      ),\n  });\n  return {\n    resizerProps: props,\n  };\n};\n\nexport const useLeftResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", true, props);\n};\n\nexport const useRightResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", false, props);\n};\n\nexport const useTopResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", true, props);\n};\n\nexport const useBottomResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", false, props);\n};\n","import React, { ComponentProps, useState } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\n\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  useGetActionShortcut,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { Input, InputProps } from \"@intellij-platform/core/InputField\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { Item } from \"@intellij-platform/core/Collections\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport interface SearchInputProps\n  extends Omit<InputProps, \"onSubmit\" | \"onChange\"> {\n  /**\n   * Search history to be shown as a menu when the search icon is pressed.\n   */\n  searchHistory?: Array<string>;\n  /**\n   * The content of \"show history\" button tooltip, and the corresponding action title.\n   * @default \"Recent Search\"\n   */\n  historyButtonTitle?: string;\n  /**\n   * Called when the search input is cleared by either clear button or `Escape` key.\n   * `onChange` is also called with an empty string, whenever the input is cleared,\n   * so there is no need for updating the state using `onClear`, when the value is controlled.\n   *\n   * @param clearedValue the value before clearing.\n   */\n  onClear?: (clearedValue: string) => void;\n  /**\n   * Called when the search is submitted by pressing `Enter`\n   * @param value submitted text\n   */\n  onSubmit?: (value: string) => void;\n  /**\n   * Controlled value of the search input\n   */\n  value?: string;\n  /**\n   * Default value of the search input, used for initialization when value is uncontrolled.\n   */\n  defaultValue?: string;\n  /**\n   * Called when the value is changed.\n   */\n  onChange?: (value: string) => void;\n  /**\n   * Called when a history item is selected. `onChange` is called with the selected text, so\n   * there is no need for updating the state using `onHistoryItemSelected`, when the value is controlled.\n   *\n   * @param value text selected from history.\n   * @param previousValue the value of the input before the history item was selected.\n   */\n  onHistoryItemSelected?: (value: string, previousValue: string) => void;\n}\n\nconst StyledInput = styled(Input)`\n  input[type=\"search\"] {\n    -webkit-appearance: none;\n    &::-webkit-search-cancel-button {\n      -webkit-appearance: none;\n    }\n    &::-webkit-search-decoration {\n      -webkit-appearance: none;\n    }\n  }\n`;\n\n/**\n * A wrapper around {@link Input} with a few additions:\n * - A Search icon, added as an {@link InputProps#addonBefore addonBefore}.\n * - A clear button, added as an {@link InputProps#addonAfter addonAfter}, when the input has value.\n *   {@link SearchInputProps#onClear onClear} is called when the clear button is clicked.\n * - A list of search queries shown as a menu, when the search icon is clicked,\n *   if {@link SearchInputProps#searchHistory searchHistory} is provided.\n * - An action provided on the input element, to open the search history via\n *   {@link CommonActionId.SHOW_SEARCH_HISTORY} shortcut.\n * - Search submission callback ({@link SearchInputProps#onSubmit onSubmit}) called when search is submitted by pressing Enter\n *\n * {@link InputProps#onChange onChange} and {@link InputProps#onSubmit onSubmit} props are also different in SearchInput, compared to\n * the corresponding props of the native input.\n *\n * Caveat: If the width is not set (either explicitly or via the entailing layout), the width of the input will change when clear button shows/hides.\n *\n * @see Input\n * @see InputField\n */\nexport const SearchInput = React.forwardRef(function SearchInput(\n  {\n    addonBefore,\n    addonAfter,\n    searchHistory,\n    onClear,\n    onSubmit,\n    onHistoryItemSelected,\n    historyButtonTitle = \"Recent Search\",\n    value: valueProp,\n    defaultValue = \"\",\n    onChange,\n    type = \"search\",\n    inputRef: inputRefProp,\n    ...props\n  }: SearchInputProps,\n  forwardedRef: React.Ref<HTMLDivElement>\n) {\n  const [value, setValue] = useControlledState(\n    valueProp!,\n    defaultValue,\n    onChange!\n  );\n  const inputContainerRef = useObjectRef(forwardedRef);\n  const inputRef = useObjectRef(inputRefProp);\n  const [isSearchHistoryOpen, setSearchHistoryOpen] = useState(false);\n  const showSearchHistoryAction: ActionDefinition = {\n    id: CommonActionId.SHOW_SEARCH_HISTORY,\n    title: historyButtonTitle,\n    actionPerformed: () => {\n      setSearchHistoryOpen(true);\n    },\n  };\n  // TODO: rename HelpTooltip, ActionTooltip, etc. to Tooltip.Action Tooltip.Help, then add ActionTooltip in action\n  //  components, and use that instead of the more low-level API used here.\n  const getShortcut = useGetActionShortcut();\n  const searchIcon = searchHistory ? (\n    <MenuTrigger\n      isOpen={isSearchHistoryOpen}\n      onOpenChange={setSearchHistoryOpen}\n      positioningTargetRef={inputContainerRef}\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          autoFocus=\"first\"\n          onAction={(key) => {\n            const historyItemText =\n              searchHistory[parseInt(`${key}`.split(\"_\")[0])];\n            if (historyItemText !== undefined) {\n              setValue(historyItemText);\n              onHistoryItemSelected?.(historyItemText, value);\n              inputRef.current?.focus();\n            }\n          }}\n        >\n          {searchHistory.map((historyItem, index) => (\n            <Item key={`${index}_${historyItem}`}>{historyItem}</Item>\n          ))}\n        </Menu>\n      )}\n    >\n      {(menuTriggerProps, ref) => (\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={historyButtonTitle}\n              shortcut={getShortcut(CommonActionId.SHOW_SEARCH_HISTORY)}\n            />\n          }\n        >\n          {(tooltipTriggerProps) => (\n            <PlatformIcon\n              {...mergeProps(tooltipTriggerProps, menuTriggerProps)}\n              ref={ref}\n              icon=\"actions/searchWithHistory.svg\"\n              role=\"button\"\n              aria-label={historyButtonTitle}\n            />\n          )}\n        </TooltipTrigger>\n      )}\n    </MenuTrigger>\n  ) : (\n    <PlatformIcon icon=\"actions/search.svg\" />\n  );\n  const clear = () => {\n    setValue(\"\");\n    onClear?.(value);\n  };\n  const inputProps = mergeProps<ComponentProps<typeof Input>[]>(props, {\n    ref: inputContainerRef,\n    inputRef,\n    value,\n    type,\n    onChange: (event) => {\n      setValue(event.target.value);\n    },\n    addonBefore: (\n      <>\n        {searchIcon}\n        {addonBefore}\n      </>\n    ),\n    addonAfter: (\n      <>\n        {value && (\n          <AutoHoverPlatformIcon\n            onClick={clear}\n            role=\"button\"\n            aria-label=\"Clear search\"\n            icon=\"actions/close\"\n            hoverIcon=\"actions/closeHovered\"\n          />\n        )}\n        {addonAfter}\n      </>\n    ),\n    onKeyDown: (event) => {\n      if (event.repeat) {\n        return;\n      }\n      if (event.key === \"Enter\") {\n        onSubmit?.(event.currentTarget.value);\n      } else if (event.key === \"Escape\") {\n        clear();\n      }\n    },\n  });\n  if (searchHistory) {\n    return (\n      <ActionsProvider actions={[showSearchHistoryAction]}>\n        {({ shortcutHandlerProps }) => (\n          <StyledInput {...mergeProps(inputProps, shortcutHandlerProps)} />\n        )}\n      </ActionsProvider>\n    );\n  }\n  return <StyledInput {...inputProps} />;\n});\n","import React, { useRef } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface SpeedSearchInputProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n  clear: () => void;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 0.25rem;\n`;\n\nconst StyledSpeedSearchInput = styled.span<{ noMatch?: boolean }>`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  background: ${({ theme, noMatch }) =>\n    noMatch\n      ? theme.color(\n          \"SearchField.errorBackground\",\n          theme.dark ? \"#743A3A\" : \"#ffcccc\"\n        )\n      : theme.color(\n          \"TextField.background\"\n        )}; // fallback logic not checked with the ref impl\n  color: ${({ theme }) =>\n    theme.color(\n      \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n    )}; // fallback logic not checked with the ref impl\n  height: 1.5rem; // 24px, JBTextField COMPACT_HEIGHT\n  padding: 0.125rem 0.375rem;\n  border: 1px solid ${({ theme }) => theme.getOutlineColor(true, false)};\n  border-radius: ${({ theme }) =>\n    ((theme.value(\"Component.arc\") as number) ?? 5) / 2}px;\n`;\nconst StyledSearchText = styled.span`\n  flex: 1;\n  font-size: 0.91em; // RelativeFont.SMALL\n`;\n\n/**\n * An input field to be rendered to show the filter value in speed search in menus and similar speedSearch-enabled\n * components.\n * @see SpeedSearchPopup\n */\nexport const SpeedSearchInput = React.forwardRef<\n  HTMLElement,\n  SpeedSearchInputProps\n>(({ active, match, children, clear }, ref) => {\n  const clearButtonRef = useRef<HTMLElement>(null);\n  const { buttonProps } = useButton(\n    {\n      elementType: \"span\",\n      \"aria-label\": \"Clear search\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n      preventFocusOnPress: true,\n      onPress: clear,\n    },\n    clearButtonRef\n  );\n\n  // Temporary styled components until SearchInput is implemented\n  return active ? (\n    <StyledSpeedSearchInput ref={ref} noMatch={!match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      <StyledSearchText>\n        {(children || \"\").replace(/ /g, \"\\u00A0\")}\n      </StyledSearchText>\n      {children && (\n        <AutoHoverPlatformIcon\n          {...buttonProps}\n          ref={clearButtonRef}\n          icon=\"actions/close\"\n          hoverIcon=\"actions/closeHovered\"\n        />\n      )}\n    </StyledSpeedSearchInput>\n  ) : null;\n});\n","import { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React from \"react\";\nimport { styled } from \"../styled\";\n\nexport interface SpeedSearchPopupProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 10px;\n  vertical-align: middle;\n`;\n\n/**\n * The little popup view shown in the top left corner of list, tree, etc., which shows the search\n * query.\n * @see SpeedSearchInput\n */\nexport const SpeedSearchPopup = React.forwardRef<\n  HTMLElement,\n  SpeedSearchPopupProps\n>(({ active, match, children }, ref) =>\n  active ? (\n    <StyledSpeedSearchPopup ref={ref} noMatch={!match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      {(children || \"\").replace(/ /g, \"\\u00A0\")}\n    </StyledSpeedSearchPopup>\n  ) : null\n);\n\nconst StyledSpeedSearchPopup = styled.span<{ noMatch?: boolean }>`\n  // ref: https://github.com/JetBrains/intellij-community/blob/e3c7d96daba1d5d84d5650bde6c220aed225bfda/platform/platform-impl/src/com/intellij/ui/SpeedSearchBase.java#L53-L53\n  box-sizing: border-box;\n  position: absolute;\n  background: ${({ theme }) =>\n    theme.color(\n      \"SpeedSearch.background\",\n      theme.dark ? \"rgb(111,111,111)\" : \"#fff\"\n    )};\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"SpeedSearch.borderColor\",\n        theme.dark ? \"rgb(64, 64, 64)\" : \"rgb(192, 192, 192)\"\n      )};\n  color: ${({ noMatch, theme }) =>\n    noMatch\n      ? theme.color(\"SpeedSearch.errorForeground\", theme.commonColors.red)\n      : theme.color(\n          \"SpeedSearch.foreground\",\n          theme.commonColors.tooltipForeground\n        )};\n  z-index: 1;\n  padding: 3px 7px;\n  height: 25px;\n  line-height: 1.2;\n  transform: translateY(-100%);\n`;\n","import React, { useRef } from \"react\";\n\nfunction isTypeableElement(elem: HTMLElement): boolean {\n  const nonTypeableInputTypes: Array<HTMLInputElement[\"type\"]> = [\n    \"checkbox\",\n    \"radio\",\n    \"button\",\n  ];\n  return (\n    elem.isContentEditable ||\n    (elem instanceof HTMLInputElement &&\n      !nonTypeableInputTypes.includes(elem.type)) ||\n    elem instanceof HTMLTextAreaElement\n  );\n}\n\n/**\n * Main use case is for a list of item, which can have keyboard focus, be filterable and capture\n * typing if the corresponding keyboard events are not happening on an inner element (like an input)\n * that already handles typing.\n * @param value\n * @param onChange\n * TODO: add support for removing word by word by alt+backspace like native text fields.\n * TODO: add support for removing the whole content by command/ctrl+backspace.\n */\nexport function useGhostInput({\n  value,\n  onChange,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n}) {\n  const valueRef = useRef(value);\n  valueRef.current = value;\n  const onKeyDown = (event: React.KeyboardEvent | KeyboardEvent) => {\n    if (\n      !event.ctrlKey &&\n      !event.altKey &&\n      !event.metaKey &&\n      (!(event.target instanceof HTMLElement) ||\n        !isTypeableElement(event.target))\n    ) {\n      if (event.key.length === 1) {\n        // Seems reasonable to prevent default here generally, but the specific case this is added for is the space key,\n        // scrolling the page.\n        event.preventDefault();\n        return onChange(`${valueRef.current}${event.key}`);\n      }\n      if (event.key === \"Backspace\") {\n        const sliceEnd = event.metaKey ? 0 : -1;\n        onChange(valueRef.current.slice(0, sliceEnd));\n      }\n    }\n  };\n  return { onKeyDown } as const;\n}\n","import { useGhostInput } from \"./useGhostInput\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport React, { RefObject } from \"react\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\nexport interface SpeedSearchState {\n  /**\n   * Whether speed search is active. Speed search becomes active when the user starts to type and becomes inactive\n   * when Escape is pressed, or when the speed search container is blurred and `keepSearchActiveOnBlur` is false.\n   * Whenever speed search becomes inactive, search text is also cleared.\n   * Note that speed search can be active while search term is empty.\n   */\n  active: boolean;\n  setActive: (value: boolean) => void;\n  searchTerm: string;\n  setSearchTerm: (value: string) => void;\n  /**\n   * clears search term and sets active to false\n   */\n  clear: () => void;\n}\n\nexport interface SpeedSearchStateProps\n  extends ControlledStateProps<{\n    searchTerm: string;\n    isSearchActive: boolean;\n  }> {}\n\nexport function useSpeedSearchState(\n  props: SpeedSearchStateProps\n): SpeedSearchState {\n  const [active, setActive] = useControlledState(\n    props.isSearchActive!,\n    props.defaultIsSearchActive ?? false,\n    props.onIsSearchActiveChange!\n  );\n  const [searchTerm, setSearchTerm] = useControlledState(\n    props.searchTerm!,\n    props.defaultSearchTerm || \"\",\n    props.onSearchTermChange!\n  );\n\n  return {\n    active,\n    searchTerm,\n    setActive,\n    setSearchTerm,\n    clear: () => {\n      setSearchTerm(\"\");\n      setActive(false);\n    },\n  };\n}\n\nexport interface SpeedSearchProps {\n  keepSearchActiveOnBlur?: boolean | ((e: React.FocusEvent) => boolean);\n}\n\n/**\n * TODO: description\n * IMPORTANT: making the container element focusable is not a part of this hook. But it's a prerequisite for it to work.\n * Previously, a tabIndex:-1 was passed as a container prop, but it turns out it's not that simple. For collections for\n * example we usually want tab index to be 0 once it's not focused and then when an item is focused, we want it to be\n * -1, and such kind of logics are handled in their respective hooks. So, making the container focusable and how to do\n * it is NOT this hook's responsibility anymore.\n */\nexport function useSpeedSearch(\n  { keepSearchActiveOnBlur }: SpeedSearchProps,\n  { searchTerm, active, setActive, setSearchTerm }: SpeedSearchState,\n  ref: RefObject<HTMLElement>\n) {\n  const { onKeyDown: ghostInputKeydown } = useGhostInput({\n    value: searchTerm,\n    onChange: (value) => {\n      const trimmedValue = value.trimStart();\n      setSearchTerm(trimmedValue);\n      if (!active && trimmedValue !== \"\") {\n        setActive(true);\n      }\n    },\n  });\n  const clear = () => {\n    setSearchTerm(\"\");\n    setActive(false);\n  };\n\n  const {\n    keyboardProps: { onKeyDown, onKeyUp },\n  } = useKeyboard({\n    onKeyDown: (e) => {\n      if (!ref.current?.contains(e.target as HTMLElement)) {\n        // In case events are propagated through portals\n        return;\n      }\n      if (e.key === \"a\" && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n      }\n      if (e.key === \"Escape\") {\n        clear();\n      } else {\n        ghostInputKeydown(e);\n      }\n      /**\n       * In the reference impl, at least some action shortcuts are allowed\n       * while the search is active. But actions with some other shortcuts\n       * (like Delete) are not triggered while the speed search is active\n       * the current condition below is not 100% matching the reference impl,\n       * but seems to be good enough for now.\n       */\n      if (!active || hasAnyModifier(e)) {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  const {\n    focusWithinProps: { onFocus, onBlur },\n  } = useFocusWithin({\n    onBlurWithin: (event) => {\n      if (\n        !(typeof keepSearchActiveOnBlur === \"function\"\n          ? keepSearchActiveOnBlur(event)\n          : keepSearchActiveOnBlur)\n      ) {\n        clear();\n      }\n    },\n  });\n\n  return {\n    containerProps: {\n      onFocus,\n      onBlur,\n      onKeyDown,\n      onKeyUp,\n    },\n  };\n}\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface StatusBarProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n}\n\n/**\n * Status bar rendered at the bottom of the main window. In the reference implementation, there are three slots for\n * content: left, right and center. It doesn't seem center is really necessary, so only left and right are supported\n * for now.\n * @param left content on the left side of the status bar.\n * @param right content on the right side of the status bar. Typically, a bunch of {@link StatusBarWidget}s\n */\nexport const StatusBar = ({\n  left,\n  right,\n}: StatusBarProps): React.ReactElement => {\n  return (\n    <StyledStatusBar\n      onMouseDown={(e) => {\n        // stop focus from going out of the currently focused element, when status bar is clicked\n        // might be too intrusive to prevent default unconditionally :-? Also, it may make sense for it to be an option\n        e.preventDefault();\n      }}\n    >\n      <StyledStatusBarLeft>{left}</StyledStatusBarLeft>\n      <StyledStatusBarRight>{right}</StyledStatusBarRight>\n    </StyledStatusBar>\n  );\n};\n\nconst StyledStatusBar = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.25rem;\n  display: flex;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between; // because there is left and right sides\n  background-color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.background\" as UnknownThemeProp<\"StatusBar.background\">,\n      theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)\n    ) || \"#fff\"};\n  color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.Widget.foreground\" as UnknownThemeProp<\"StatusBar.Widget.foreground\">,\n      theme.commonColors.labelForeground\n    )};\n  border-top: 1px solid\n    ${({ theme }) => theme.color(\"StatusBar.borderColor\", \"rgb(145, 145, 145)\")};\n  height: calc(1.25rem + 1px /* border*/);\n  line-height: 1.25rem;\n  font-size: 0.656rem; // not verified\n  cursor: default;\n`;\n\nconst StyledStatusBarSection = styled.div`\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n`;\n\nconst StyledStatusBarRight = styled(StyledStatusBarSection)`\n  flex-shrink: 0;\n`;\nconst StyledStatusBarLeft = styled(StyledStatusBarSection)`\n  flex-shrink: 1;\n  min-width: 0;\n  overflow: hidden;\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { PressProps, usePress } from \"@react-aria/interactions\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface StatusBarWidgetProps extends PressProps {\n  label?: React.ReactNode;\n  icon?: React.ReactNode;\n}\n\n/**\n * Status bar button (aka widget), with the right hover and pressed appearance.\n * It doesn't get focused when pressed, and is excluded from tab order.\n * Disabled style is not couldn't be found, so it's skipped at the moment.\n */\nexport const StatusBarWidget = React.forwardRef(function StatusBarWidget(\n  props: StatusBarWidgetProps,\n  forwardedRef: ForwardedRef<HTMLSpanElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // Maybe it's better for a11y to use useButton, or at least use button element?\n  const { pressProps, isPressed } = usePress({\n    ref,\n    ...props,\n    preventFocusOnPress: true,\n  });\n  const { focusableProps } = useFocusable({ excludeFromTabOrder: true }, ref);\n\n  const StyledWrapper = props.label\n    ? StyledStatusBarWidget\n    : StyledStatusBarIconWidget;\n  return (\n    <StyledWrapper\n      {...mergeProps(pressProps, focusableProps)}\n      className={isPressed ? \"pressed\" : \"\"}\n      ref={ref}\n    >\n      {props.icon}\n      {props.icon && props.label && (\n        <>&nbsp;</> //not the nicest way to handle spacing!\n      )}\n      {props.label}\n    </StyledWrapper>\n  );\n});\n\nconst StyledStatusBarWidget = styled.span`\n  display: inline-flex;\n  align-items: center;\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.375rem\"};\n  height: 1.125rem;\n  white-space: nowrap;\n  &:hover {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverBackground\" as UnknownThemeProp<\"StatusBar.Widget.hoverBackground\">,\n        theme.color(\"ActionButton.hoverBackground\", \"#dfdfdf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverForeground\" as UnknownThemeProp<\"StatusBar.Widget.hoverForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n  &.pressed {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedBackground\" as UnknownThemeProp<\"StatusBar.Widget.pressedBackground\">,\n        theme.color(\"ActionButton.pressedBackground\", \"#cfcfcf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedForeground\" as UnknownThemeProp<\"StatusBar.Widget.pressedForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n`;\n\nconst StyledStatusBarIconWidget = styled(StyledStatusBarWidget)`\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.25rem\"};\n`;\n","import React from \"react\";\nimport { styled } from \"./styled\";\n\ntype SeparatorUI = {\n  STRIPE_INDENT: number;\n  STRIPE_WIDTH: number;\n};\n\n// based on implementation in com.intellij.ide.ui.laf.darcula.ui.DarculaSeparatorUI, which seems to be used for all themes\nconst DarculaSeparatorUI: SeparatorUI = {\n  STRIPE_INDENT: 1,\n  STRIPE_WIDTH: 1,\n};\n\nconst defaultSize =\n  2 * DarculaSeparatorUI.STRIPE_INDENT + DarculaSeparatorUI.STRIPE_WIDTH;\n\nexport const StyledSeparator = styled.hr(({ theme }) => ({\n  backgroundColor: theme.color(\n    \"Separator.separatorColor\",\n    theme.dark ? \"#cdcdcd\" : \"#515151\"\n  ),\n  backgroundClip: \"content-box\",\n  boxSizing: \"border-box\",\n  margin: 0,\n  border: \"none\",\n  flexShrink: 0,\n}));\n\nexport const StyledHorizontalSeparator = styled(StyledSeparator)`\n  height: inherit; // should it be auto?\n  padding: 0 ${DarculaSeparatorUI.STRIPE_INDENT}px;\n  width: ${defaultSize}px;\n`;\nexport const StyledVerticalSeparator = styled(StyledSeparator)`\n  width: auto;\n  padding: ${DarculaSeparatorUI.STRIPE_INDENT}px 0;\n  height: ${defaultSize}px;\n`;\n","import React from \"react\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport {\n  TabContentLayout,\n  TabItemLayoutProps,\n} from \"@intellij-platform/core/Tabs/TabContentLayout\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { BareButton } from \"@intellij-platform/core/Button\";\n\ninterface EditorTabContentProps {\n  icon: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button, shown in place of \"pin\" button if not pinned. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <EditorTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^⇧F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactElement;\n  onUnpin?: () => void;\n  pinned?: boolean;\n  containerProps?: TabItemLayoutProps[\"containerProps\"];\n}\n/**\n * For rendering the content of Editor tabs. supports for file icon which is shown on the left and close or unpin\n * button shown on the right.\n */\nexport const EditorTabContent = ({\n  icon,\n  title,\n  closeButton,\n  onUnpin,\n  pinned,\n  containerProps,\n}: EditorTabContentProps) => {\n  return (\n    <TabContentLayout\n      startIcon={icon}\n      title={title}\n      containerProps={containerProps}\n      endIcon={\n        pinned ? (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Unpin Tab\" />}>\n            <BareButton\n              onPress={onUnpin}\n              excludeFromTabOrder\n              preventFocusOnPress\n            >\n              <PlatformIcon icon=\"actions/pinTab\" />\n            </BareButton>\n          </TooltipTrigger>\n        ) : (\n          closeButton\n        )\n      }\n    />\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const editorTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"EditorTabs.borderColor\"),\n  underlineHeight: theme.value<number>(\"EditorTabs.underlineHeight\"),\n  background: theme.color(\"EditorTabs.background\"),\n  underlinedTabInactiveBackground: theme.color(\n    \"EditorTabs.underlinedTabBackground\" // that's correctly not underlinedTabInactiveBackground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabBackground: theme.color(\"EditorTabs.underlinedTabBackground\"), // TODO: use EditorColorsScheme when available\n  hoverInactiveBackground: theme.color(\n    \"EditorTabs.hoverInactiveBackground\" as UnknownThemeProp<\"EditorTabs.hoverInactiveBackground\">\n  ),\n  hoverBackground: theme.color(\"EditorTabs.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\"EditorTabs.inactiveUnderlineColor\"), // TODO: use EditorColorsScheme when available\n  underlineColor: theme.color(\"EditorTabs.underlineColor\"), // TODO: use EditorColorsScheme when available\n\n  underlinedTabInactiveForeground: theme.color(\n    \"EditorTabs.underlinedTabForeground\" // that's correctly not underlinedTabInactiveForeground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabForeground: theme.color(\"EditorTabs.underlinedTabForeground\"), // TODO: use EditorColorsScheme when available\n});\nexport const StyledEditorTab = styled(StyledDefaultTab)`\n  font-size: 0.7rem;\n  ${({ theme }) => getTabThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { editorTabTheme } from \"./StyledEditorTab\";\n\nexport const StyledEditorTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledEditorTab } from \"./StyledEditorTab\";\nimport { StyledEditorTabs } from \"./StyledEditorTabs\";\nimport React from \"react\";\n\nexport type EditorTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const EditorTabs = <T extends object>(props: EditorTabsProps<T>) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledEditorTab}\n    TabsComponent={StyledEditorTabs}\n    focusable={false}\n  />\n);\n","import { getTabThemeStyles } from \"./TabTheme\";\nimport { styled } from \"../styled\";\nimport { Theme, UnknownThemeProp } from \"../Theme\";\n\nexport type StyledTabProps = {\n  selected?: boolean;\n  disabled?: boolean;\n  active?: boolean;\n};\n\nconst defaultTabTheme = ({ theme }: { theme: Theme }) =>\n  getTabThemeStyles({\n    underlineHeight: theme.value<number>(\"DefaultTabs.underlineHeight\") ?? 3,\n    inactiveUnderlineColor: theme.color(\n      \"DefaultTabs.inactiveUnderlineColor\",\n      theme.dark ? \"#747a80\" : \"#9ca7b8\"\n    ),\n    underlineColor: theme.color(\n      \"DefaultTabs.underlineColor\",\n      theme.dark ? \"#4A88C7\" : \"#4083C9\"\n    ),\n\n    underlinedTabInactiveForeground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveForeground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveForeground\">\n    ),\n    underlinedTabForeground: theme.color(\"DefaultTabs.underlinedTabForeground\"),\n\n    background: theme.color(\n      \"DefaultTabs.background\",\n      theme.dark ? \"#3C3F41\" : \"#ECECEC\"\n    ),\n    underlinedTabInactiveBackground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveBackground\">\n    ),\n    underlinedTabBackground: theme.color(\n      \"DefaultTabs.underlinedTabBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabBackground\">\n    ),\n    hoverInactiveBackground: theme.color(\n      \"DefaultTabs.hoverInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.hoverInactiveBackground\">,\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n    hoverBackground: theme.color(\n      \"DefaultTabs.hoverBackground\",\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n  });\n\nexport const StyledDefaultTab = styled.div<StyledTabProps>`\n  box-sizing: border-box;\n  display: inline-flex;\n  letter-spacing: 0.015rem;\n  font-size: 0.85rem;\n  cursor: default;\n  white-space: nowrap;\n\n  // spacing\n  padding: 0 0.5rem;\n  line-height: 1.7rem; // vertical spacing handled by line-height\n\n  // disabled state doesn't seem to be supported in Intellij Platform at all.\n  opacity: ${({ disabled }) => (disabled ? \".5\" : \"1\")};\n  color: ${({ theme }) =>\n    theme.color(\n      \"DefaultTabs.foreground\" as UnknownThemeProp<\"DefaultTabs.foreground\">\n    )};\n\n  position: relative;\n  &::after {\n    content: \"\";\n    position: absolute;\n    width: 100%;\n    left: 0;\n    bottom: 0;\n  }\n\n  ${defaultTabTheme};\n`;\n","import { Theme } from \"../Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"./TabTheme\";\n\nconst defaultTabsTheme = ({ theme }: { theme: Theme }) =>\n  getTabsThemeStyles({\n    borderColor: theme.color(\n      \"DefaultTabs.borderColor\",\n      theme.commonColors.contrastBorder\n    ),\n    background: theme.color(\"DefaultTabs.background\"),\n  });\n\nexport const StyledDefaultTabs = styled.div<{ noBorders?: boolean }>`\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  border-style: solid;\n  border-width: ${({ noBorders }) => (noBorders ? \"0\" : \"1px 0\")};\n\n  ${defaultTabsTheme};\n`;\n","import React from \"react\";\nimport { BareButton, BareButtonProps } from \"@intellij-platform/core/Button\";\nimport { PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\n\nconst StyledIconWrapper = styled.span`\n  display: inherit;\n  .icon.hover {\n    display: none;\n  }\n  &:hover {\n    .icon {\n      display: none;\n    }\n    .icon.hover {\n      display: unset;\n    }\n  }\n`;\n/**\n * Close button for Tab\n */\nexport const TabCloseButton = (props: Omit<BareButtonProps, \"children\">) => {\n  // using useHover proved to be unstable.\n  return (\n    <BareButton {...props} excludeFromTabOrder preventFocusOnPress>\n      <StyledIconWrapper>\n        <PlatformIcon icon={\"actions/closeHovered\"} className=\"icon hover\" />\n        <PlatformIcon icon={\"actions/close\"} className=\"icon\" />\n      </StyledIconWrapper>\n    </BareButton>\n  );\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { css, styled } from \"../styled\";\nimport { useFocusable } from \"@react-aria/focus\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\n\nconst StyledTabItemLayout = styled.div`\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst iconStyle = css`\n  display: inline-flex; // without this, the wrapper takes the full height, causing icon to be placed on top\n  margin-top: -0.1rem; // seems necessary for pixel perfect match with the original impl\n`;\n\nconst StyledStartIconWrapper = styled.span`\n  ${iconStyle};\n  margin-right: 0.25rem;\n`;\n\nconst StyledEndIconWrapper = styled.span`\n  ${iconStyle};\n  margin-left: 0.25rem;\n  margin-right: -0.25rem; // default padding of the tab should be a little reduced when close icon is there.\n  border-radius: 16px;\n`;\n\nexport interface TabItemLayoutProps {\n  /**\n   * the icon placed before the text.\n   */\n  startIcon?: React.ReactNode;\n  /**\n   * title of the tab. Normally just a string\n   */\n  title?: React.ReactNode;\n  /**\n   * the icon placed after the text. Typical use cases: close or pin icon.\n   */\n  endIcon?: React.ReactNode;\n\n  /**\n   * Generic HTML props passed to the container div.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n}\n\n/**\n * Helper component for rendering the common layout of tab content.\n */\nexport const TabContentLayout = React.forwardRef(\n  (\n    { startIcon, title, endIcon, containerProps = {} }: TabItemLayoutProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    // To allow tooltip be used easily. TooltipTrigger passes props via FocusableContext.\n    const { focusableProps } = useFocusable({}, useObjectRef(ref));\n    return (\n      <StyledTabItemLayout\n        {...mergeProps(focusableProps, containerProps)}\n        ref={ref}\n      >\n        {startIcon && (\n          <StyledStartIconWrapper>{startIcon}</StyledStartIconWrapper>\n        )}\n        {title}\n        {endIcon && <StyledEndIconWrapper>{endIcon}</StyledEndIconWrapper>}\n      </StyledTabItemLayout>\n    );\n  }\n);\n","import { ItemProps } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport React from \"react\";\n\nexport interface TabItemProps extends ItemProps<never> {\n  /**\n   * Determines how the tab item should look when rendered as a menu item in overflow menu.\n   * If not passed, `textValue` will be used.\n   * @example\n   * <TabItem\n   *   key={tab.id}\n   *   textValue={tab.title}\n   *   inOverflowMenu={\n   *     <MenuItemLayout content={tab.title} icon={icon} />\n   *   }\n   *  >\n   *   <TabContentLayout startIcon={icon} title={tab.title} />\n   * </TabItem>\n   */\n  inOverflowMenu?: React.ReactNode;\n}\n\n/**\n * Same as {@link Item}, but allows for specifying the tab content for when it's rendered in the overflow menu item.\n */\nexport const TabItem: (props: TabItemProps) => React.ReactElement = Item;\n","import { css } from \"@intellij-platform/core/styled\";\nimport { StyledTabProps } from \"./StyledDefaultTab\";\n\n/**\n * Describes theme-able properties of a tab, which can then be passed to {@link getTabThemeStyles}\n */\nexport interface TabTheme {\n  underlineHeight?: number;\n\n  borderColor?: string;\n\n  inactiveUnderlineColor?: string;\n  underlineColor?: string;\n\n  underlinedTabInactiveForeground?: string;\n  underlinedTabForeground?: string;\n\n  background?: string;\n  underlinedTabBackground?: string;\n  underlinedTabInactiveBackground?: string;\n  hoverInactiveBackground?: string;\n  hoverBackground?: string;\n  inactiveColoredTabBackground?: string; // not used for now\n}\n\nexport const getTabsThemeStyles = ({\n  background,\n  borderColor,\n}: Pick<TabTheme, \"background\" | \"borderColor\">) => css`\n  border-color: ${borderColor};\n  background: ${background};\n`;\n\n/**\n * Converts tab theme properties to a chunk of style that can be dropped in a styled version of StyledDefaultTab\n *\n * @example\n * ```ts\n * const StyledCustomTab = styled(StyledDefaultTab)`\n *   ${getTabThemeStyles({background: 'red'})}\n * `\n * ```\n */\nexport const getTabThemeStyles = ({\n  underlineHeight,\n\n  background,\n  underlinedTabBackground,\n  underlinedTabInactiveBackground,\n  hoverInactiveBackground,\n  hoverBackground,\n\n  underlinedTabForeground,\n  underlinedTabInactiveForeground,\n\n  inactiveUnderlineColor,\n  underlineColor,\n}: TabTheme) =>\n  css<StyledTabProps>`\n    // active indicator\n    &::after {\n      height: ${underlineHeight != null ? `${underlineHeight}px` : undefined};\n      background-color: ${({ selected }) => selected && inactiveUnderlineColor};\n      background-color: ${({ selected, active }) =>\n        selected && active && underlineColor};\n    }\n\n    // foreground rules\n    color: ${({ selected }) => selected && underlinedTabInactiveForeground};\n    color: ${({ selected, active }) =>\n      selected && active && underlinedTabForeground};\n\n    //  background rules\n    background: ${background};\n    background: ${({ selected }) =>\n      selected && underlinedTabInactiveBackground};\n    background: ${({ selected, active }) =>\n      selected && active && underlinedTabBackground};\n\n    ${({ disabled, active }) =>\n      !disabled &&\n      css`\n        &:hover,\n        &.hover /* for testing purposes */ {\n          background: ${hoverInactiveBackground};\n          background: ${active && hoverBackground};\n        }\n      `}\n  `;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\ninterface Props {\n  hasOverflowAtStart: boolean;\n  hasOverflowAtEnd: boolean;\n}\n\nconst horizontalOverflowIndicatorStyles = css`\n  content: \"\";\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 10px;\n  z-index: 1;\n`;\nexport const StyledHorizontalOverflowShadows = styled.div<Props>`\n  position: relative; // for overflow indicator (pseudo-)elements to be positioned absolute\n\n  /* FIXME: find out what color, width and gradient parameters are used in the original implementation */\n  ${({ hasOverflowAtStart }) =>\n    hasOverflowAtStart &&\n    css`\n      ::before {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        left: 0;\n      }\n    `};\n  ${({ hasOverflowAtEnd }) =>\n    hasOverflowAtEnd &&\n    css`\n      ::after {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          -90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        right: 0;\n      }\n    `};\n`;\n","import { useTab } from \"@react-aria/tabs\";\nimport { TabListState } from \"@react-stately/tabs\";\nimport { Node } from \"@react-types/shared\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport React, { ForwardedRef, forwardRef, RefObject, useEffect } from \"react\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\n\ntype TabProps<T extends object> = {\n  state: TabListState<object>;\n  item: Node<T>;\n  /**\n   * {@see TabsProps#focusable}\n   */\n  focusable?: boolean;\n  /**\n   * {@see TabsProps#active}\n   */\n  active?: boolean;\n  shouldSelectOnPressUp?: boolean;\n  Component?: typeof StyledDefaultTab;\n};\n\nexport const Tab = forwardRef(function Tab<T extends object>(\n  {\n    state,\n    item,\n    focusable,\n    active,\n    shouldSelectOnPressUp,\n    Component = StyledDefaultTab,\n  }: TabProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): React.ReactElement {\n  const { key, rendered } = item;\n  const ref = useForwardedRef(forwardedRef);\n  const {\n    tabProps: {\n      /**\n       * by extracting out tabIndex, all keyboard support of the tabs is disabled, since we prevent the tab from being\n       * focusable.\n       */\n      tabIndex,\n      ...tabProps\n    },\n  } = useTab(\n    {\n      key,\n      shouldSelectOnPressUp,\n    },\n    state,\n    ref\n  );\n  const isSelected = state.selectedKey === key;\n  const isDisabled = state.disabledKeys.has(key);\n\n  return (\n    <Component\n      {...tabProps}\n      tabIndex={focusable ? tabIndex : undefined}\n      ref={ref}\n      active={active}\n      selected={isSelected}\n      disabled={isDisabled}\n    >\n      {rendered}\n    </Component>\n  );\n});\n","import React, { Key, useEffect } from \"react\";\nimport { useTabList } from \"@react-aria/tabs\";\nimport { filterDOMProps, mergeProps, scrollIntoView } from \"@react-aria/utils\";\nimport { useTabListState } from \"@react-stately/tabs\";\nimport { AriaTabListProps } from \"@react-types/tabs\";\nimport { StyledHorizontalOverflowShadows } from \"./StyledHorizontalOverflowShadows\";\nimport { TabsOverflowMenu } from \"./TabsOverflowMenu\";\nimport { useOverflowObserver } from \"../utils/overflow-utils/useOverflowObserver\";\nimport { useHasOverflow } from \"./useHasOverflow\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport { StyledDefaultTabs } from \"./StyledDefaultTabs\";\nimport { Tab } from \"./Tab\";\n\nexport type TabsProps<T> = Omit<\n  AriaTabListProps<T>,\n  \"orientation\" | \"isDisabled\" | \"\"\n> & {\n  /**\n   * Whether tabs should be focusable or not. By default, following the Intellij Platform implementation, tabs are\n   * not focusable and therefore lack the keyboard accessibility support specified in WAI-ARIA.\n   * You can change this default behaviour and make the tabs keyboard accessible by passing `focusable`.\n   * focus styles are not perfect at the moment, since it's not considered an important feature.\n   * @default false\n   */\n  focusable?: boolean;\n\n  /**\n   * Whether selected tab should change on press up instead of press down.\n   * @default false.\n   */\n  shouldSelectOnPressUp?: boolean;\n\n  /**\n   * Enables \"active\" style on tabs. Is usually related to a container having focus.\n   */\n  active?: boolean;\n\n  /**\n   * If set to true, tabs will be wrapped into multiple rows if needed.\n   * NOTE: In the original implementation, in multi row mode, rows are separated by a border. It's not easy to achieve\n   * this when we are implementing this feature with a simple `flex-wrap: wrap` css rule. It doesn't seem that\n   * important, but we can achieve something similar by some css tricks like the ones suggested here:\n   * https://stackoverflow.com/questions/36128333/row-lines-for-flex-container-css\n   * @default false\n   */\n  multiRow?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * If set to true and multiRow is not true, it will prevent horizontal scroll of tabs. Depending on the value of\n   * In this case:\n   * - if {@link noOverflowMenu} is not set to true, tabs that can't be fitted into the available space will be\n   *   accessible via an overflow menu.\n   * - if {@link noOverflowMenu} is set to true, the tabs will be fitted into the available space, and they will\n   *   be shrunk when needed.\n   *\n   * @todo: not implemented yet.\n   * @default false\n   */\n  noScroll?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * When set to true, tabs that couldn't be fitted into the available space, are either shrunk (if {@link noScroll}\n   * is set to true), or are just accessible by scroll.\n   */\n  noOverflowMenu?: boolean;\n\n  /**\n   * Removes the top and bottom border when passed.\n   * It's still not clear whether such option makes sense or not, but\n   * at least in common use cases like in tool windows, it seems borders are already there and there should be a way\n   * of removing tab borders. On the other hand, when Tabs is used without any assumption about the surrounding UI,\n   * it kind of makes sense to have the top and bottom borders by default. So that's why this is made an option for\n   * now, maybe until things are clearer.\n   *\n   * @default false\n   */\n  noBorders?: boolean;\n\n  TabsComponent?: typeof StyledDefaultTabs;\n  /**\n   *\n   */\n  TabComponent?: typeof StyledDefaultTab;\n};\n\nconst scrollBarDisabledStyle = css`\n  -ms-overflow-style: none; /* for Internet Explorer, Edge */\n  scrollbar-width: none; /* for Firefox */\n  &::-webkit-scrollbar {\n    /* for Chrome/Safari/Webkit */\n    display: none;\n  }\n`;\n\nconst StyledTabList = styled.div<{ multiRow?: boolean }>`\n  display: flex;\n  flex-wrap: ${({ multiRow }) => (multiRow ? \"wrap\" : \"nowrap\")};\n  overflow: auto;\n\n  ${scrollBarDisabledStyle};\n`;\n\n/**\n *\n * TODO: add support for overflow:\n *  - have vertical scroll also scroll tabs\n *  - add support for re-reordering tabs.\n *  - FIX: When a tab that was not selected is removed, selection should not change. It now changes to the tab before the removed one.\n */\nexport const Tabs = <T extends object>({\n  focusable,\n  shouldSelectOnPressUp,\n  active,\n  TabComponent,\n  TabsComponent = StyledDefaultTabs,\n  multiRow,\n  noOverflowMenu,\n  noScroll,\n  noBorders,\n  ...props\n}: TabsProps<T>): React.ReactElement => {\n  const state = useTabListState(props);\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { tabListProps } = useTabList(props, state, ref);\n\n  const { scrolledIndicatorProps, hasOverflow } = useHasOverflow({ ref });\n  const { overflowedElements } = useOverflowObserver(ref);\n  const overflowedKeys = new Set(\n    overflowedElements\n      .map((element) =>\n        element instanceof HTMLElement ? element.dataset[\"key\"] : null\n      )\n      .filter(notNull)\n  );\n\n  useEffect(() => {\n    if (!noScroll) {\n      const scrollableContainer = ref.current;\n      const selectedTabElement = scrollableContainer?.querySelector(\n        `[data-key=\"${state.selectedKey}\"]`\n      ) as HTMLElement;\n      if (scrollableContainer && selectedTabElement) {\n        scrollIntoView(scrollableContainer, selectedTabElement);\n      }\n    } else {\n      // TODO maybe? sample use case: project tool window tabs, when not grouped.\n    }\n  }, [state.selectedKey]);\n  const onOverflowMenuItemSelected = (key: Key) => {\n    state.setSelectedKey(key);\n  };\n  if (noScroll) {\n    throw new Error(\"noScroll is not supported yet.\");\n  }\n  return (\n    <TabsComponent noBorders={noBorders} {...filterDOMProps(props)}>\n      <StyledHorizontalOverflowShadows\n        hasOverflowAtStart={hasOverflow.left}\n        hasOverflowAtEnd={hasOverflow.right}\n        style={{ minWidth: 0 }}\n      >\n        <StyledTabList\n          {...mergeProps(tabListProps, scrolledIndicatorProps)}\n          multiRow={multiRow}\n          ref={ref}\n        >\n          {[...state.collection].map((item) => (\n            <Tab\n              key={item.key}\n              item={item}\n              state={state}\n              focusable={focusable}\n              shouldSelectOnPressUp={shouldSelectOnPressUp}\n              active={active}\n              Component={TabComponent}\n            />\n          ))}\n        </StyledTabList>\n      </StyledHorizontalOverflowShadows>\n      {!noOverflowMenu && (\n        <TabsOverflowMenu\n          collection={state.collection}\n          overflowedKeys={overflowedKeys}\n          onSelect={onOverflowMenuItemSelected}\n        />\n      )}\n    </TabsComponent>\n  );\n};\n","import { RefObject, UIEventHandler, useEffect, useState } from \"react\";\n\nexport function useHasOverflow<T extends HTMLElement>({\n  threshold = 5,\n  ref,\n}: {\n  threshold?: number;\n  ref: RefObject<T>;\n}) {\n  const [hasOverflow, setHasOverflow] = useState({\n    left: false,\n    right: false,\n    top: false,\n    bottom: false,\n  });\n\n  const update = () => {\n    const element = ref.current;\n    if (element) {\n      const offsetLeft = element.scrollLeft;\n      const offsetRight =\n        element.scrollWidth - (element.offsetWidth + element.scrollLeft);\n      const offsetTop = element.scrollTop;\n      const offsetBottom =\n        element.scrollHeight - (element.offsetHeight + element.scrollTop);\n      const newHasOverflow = {\n        top: offsetTop > threshold,\n        bottom: offsetBottom > threshold,\n        left: offsetLeft > threshold,\n        right: offsetRight > threshold,\n      };\n      if (\n        hasOverflow.top !== newHasOverflow.top ||\n        hasOverflow.bottom !== newHasOverflow.bottom ||\n        hasOverflow.left !== newHasOverflow.left ||\n        hasOverflow.right !== newHasOverflow.right\n      ) {\n        setHasOverflow(newHasOverflow);\n      }\n    }\n  };\n  useEffect(update);\n\n  return {\n    scrolledIndicatorProps: {\n      onScroll: update as UIEventHandler<T>,\n    },\n    hasOverflow,\n  };\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { IconButton } from \"@intellij-platform/core/IconButton\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React, { Key } from \"react\";\n\nexport const TabsOverflowMenu = <T extends unknown>({\n  collection,\n  overflowedKeys,\n  onSelect,\n}: {\n  collection: Collection<Node<T>>;\n  overflowedKeys: Set<Key>;\n  onSelect: (key: Key) => void;\n}) => (\n  <>\n    {overflowedKeys.size > 0 && (\n      <MenuTrigger\n        align=\"end\"\n        renderMenu={({ menuProps }) => {\n          const items: Iterable<Node<unknown>> = [...collection].filter(\n            (menuItem) => overflowedKeys.has(menuItem.key)\n          );\n          return (\n            <Menu\n              {...menuProps}\n              onAction={(key) => {\n                onSelect(key);\n              }}\n              items={items}\n            >\n              {(item) => (\n                <Item key={item.key} textValue={item.textValue}>\n                  {item.props.inOverflowMenu || item.textValue}\n                </Item>\n              )}\n            </Menu>\n          );\n        }}\n      >\n        {(props, ref) => (\n          <IconButton {...props} ref={ref}>\n            <PlatformIcon icon=\"actions/findAndShowNextMatches\" />\n          </IconButton>\n        )}\n      </MenuTrigger>\n    )}\n  </>\n);\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport { TabContentLayout } from \"@intellij-platform/core/Tabs/TabContentLayout\";\n\ntype ToolWindowTabContentProps = {\n  icon?: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button for the tab. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <ToolWindowTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^⇧F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactNode;\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n};\n\nexport const ToolWindowTabContent = React.forwardRef(\n  (\n    { icon, title, closeButton, containerProps }: ToolWindowTabContentProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    return (\n      <TabContentLayout\n        containerProps={containerProps}\n        ref={ref}\n        startIcon={icon}\n        title={title}\n        endIcon={closeButton}\n      />\n    );\n  }\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const toolWindowTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"ToolWindow.HeaderTab.borderColor\"),\n  underlineHeight: theme.value<number>(\"ToolWindow.HeaderTab.underlineHeight\"),\n  background: \"transparent\",\n  underlinedTabInactiveBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabInactiveBackground\"\n  ),\n  underlinedTabBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabBackground\"\n  ),\n  hoverInactiveBackground:\n    theme.color(\"ToolWindow.HeaderTab.hoverInactiveBackground\") ??\n    theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  hoverBackground: theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\n    \"ToolWindow.HeaderTab.inactiveUnderlineColor\"\n  ),\n  underlineColor: theme.color(\"ToolWindow.HeaderTab.underlineColor\"),\n\n  underlinedTabInactiveForeground:\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabInactiveForeground\") ??\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabForeground\"),\n  underlinedTabForeground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabForeground\"\n  ),\n});\nexport const StyledToolWindowTab = styled(StyledDefaultTab)`\n  padding: 0 0.7rem;\n  ${({ theme }) => getTabThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { toolWindowTabTheme } from \"./StyledToolWindowTab\";\n\nexport const StyledToolWindowTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import React from \"react\";\nimport { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledToolWindowTab } from \"./StyledToolWindowTab\";\nimport { StyledToolWindowTabs } from \"./StyledToolWindowTabs\";\n\ntype ToolWindowTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const ToolWindowTabs = <T extends object>(\n  props: ToolWindowTabsProps<T>\n) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledToolWindowTab}\n    TabsComponent={StyledToolWindowTabs}\n    focusable={false}\n    shouldSelectOnPressUp\n  />\n);\n","export type TextRange = { from: number; to: number };\n\nexport function isEmptyRange(range: TextRange) {\n  return range.from > range.to;\n}\n\nexport function getAllRanges(\n  ranges: TextRange[],\n  length: number\n): Array<[TextRange, boolean]> {\n  const result: Array<[TextRange, boolean]> = [];\n  if (!ranges?.length) {\n    return [[{ from: 0, to: length - 1 }, false]];\n  }\n  if (ranges[0].from > 0) {\n    result.push([{ from: 0, to: ranges[0].from - 1 }, false]);\n  }\n  ranges.forEach(({ from, to }, index) => {\n    result.push([{ from, to }, true]);\n    const gapRange: TextRange = ranges[index + 1]\n      ? { from: to + 1, to: ranges[index + 1].from - 1 }\n      : { from: to + 1, to: length - 1 };\n    if (!isEmptyRange(gapRange)) {\n      result.push([gapRange, false]);\n    }\n  });\n  return result;\n}\n\nexport function createRangesFromIndices(indices: number[]): TextRange[] {\n  return indices.reduce((ranges, index) => {\n    const lastRange = ranges.slice(-1)[0];\n    if (lastRange?.to === index - 1) {\n      return [...ranges.slice(0, -1), { from: lastRange.from, to: index }];\n    }\n    return [...ranges, { from: index, to: index }];\n  }, [] as TextRange[]);\n}\n","import React from \"react\";\nimport { getAllRanges, TextRange } from \"../TextRange\";\nimport { styled } from \"../styled\";\n\nconst HighlightedMatch = styled.span`\n  background: ${({ theme }) =>\n    `linear-gradient(${theme.color(\n      \"SearchMatch.startBackground\",\n      \"#ffeaa2b3\"\n    )}, ${theme.color(\"SearchMatch.endBackground\", \"#ffd042b3\")})`};\n  color: #000;\n  border-radius: 3px;\n`;\n\n/**\n * Renders the children (which must be a string), with highlights wrapped in spans with the highlight style.\n * Note: this component doesn't render a container. It just highlights the specified ranges.\n */\nexport function TextWithHighlights({\n  children,\n  highlights,\n}: {\n  children: string;\n  highlights: TextRange[] | null;\n}): React.ReactElement {\n  const parts: Array<[TextRange, boolean]> = highlights\n    ? getAllRanges(highlights, children.length)\n    : [[{ from: 0, to: children.length }, false]];\n  return (\n    <>\n      {parts.map(([{ from, to }, highlighted]) => {\n        const text = children.slice(from, to + 1);\n        return (\n          // TODO: key\n          <React.Fragment key={`${from}_${to}`}>\n            {highlighted ? <HighlightedMatch>{text}</HighlightedMatch> : text}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n","// language=JSRegexp\nconst numberPattern = \"[0-9]{0,3}.?[0-9]*\";\n\nconst parseComponent = (componentStr: string, index: number) =>\n  componentStr\n    ? index < 3\n      ? parseInt(componentStr)\n      : Math.round(Math.min(parseFloat(componentStr), 1) * 255)\n    : undefined;\n\nconst parseHexRgba = (str: string) =>\n  str\n    .match(/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})?$/i)\n    ?.slice(1, 5)\n    .map((i) => (i ? parseInt(i, 16) : undefined));\nconst parseShorthandHex = (str: string) =>\n  str\n    .match(/^#?([0-9A-F])([0-9A-F])([0-9A-F])$/i)\n    ?.slice(1, 4)\n    .map((i) => (i ? parseInt(i + i, 16) : undefined));\nconst parseRgb = (str: string) =>\n  str\n    .match(\n      new RegExp(\n        `^rgb\\\\(\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern}\\\\s*)\\\\)$`\n      )\n    )\n    ?.slice(1, 5)\n    .map(parseComponent);\nconst parseRgba = (str: string) =>\n  str\n    .match(\n      new RegExp(\n        `^rgba\\\\(\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern}\\\\s*)\\\\)$`\n      )\n    )\n    ?.slice(1, 5)\n    .map(parseComponent);\n\n/**\n * parses a color string into rgba components.\n * @param str\n */\nexport const parseColorString = (\n  str: string\n): [number, number, number, number?] | null => {\n  const result = [parseHexRgba, parseShorthandHex, parseRgb, parseRgba].reduce<\n    (number | undefined)[] | undefined\n  >((result, parse) => result || parse(str), undefined);\n  return Array.isArray(result) &&\n    result.slice(0, 3).every((c) => Number.isInteger(c))\n    ? (result as [number, number, number, number?])\n    : null;\n};\n","import { parseColorString } from \"./parseColorString\";\n\n/**\n * A Color class resembling AWT Color\n */\nexport class Color {\n  public readonly r: number;\n  public readonly g: number;\n  public readonly b: number;\n  public readonly a: number;\n\n  private static readonly FACTOR = 0.7;\n\n  constructor(r: number, g: number, b: number, a?: number);\n  constructor(rgba: string);\n  constructor(rgba: Color);\n  constructor(\n    rgba: string | number | Color,\n    g?: number,\n    b?: number,\n    a: number = 255\n  ) {\n    let r: number;\n    if (typeof rgba === \"string\") {\n      [r = NaN, g = NaN, b = NaN, a = 255] = parseColorString(rgba) || [];\n    } else if (rgba instanceof Color) {\n      [r, g, b, a] = [rgba.r, rgba.g, rgba.b, rgba.a];\n    } else {\n      r = rgba;\n    }\n    this.r = r;\n    this.g = g!;\n    this.b = b!;\n    this.a = a < 1 ? Math.round(a * 255) : a;\n  }\n\n  isValid() {\n    return (\n      Number.isInteger(this.r) &&\n      Number.isInteger(this.g) &&\n      Number.isInteger(this.b) &&\n      Number.isInteger(this.a)\n    );\n  }\n\n  /**\n   * Extra method for changing transparency\n   */\n  withTransparency(alpha: number) {\n    return new Color(this.r, this.g, this.b, alpha);\n  }\n\n  brighter() {\n    let { r, g, b, a: alpha } = this;\n    const int = Math.floor,\n      FACTOR = Color.FACTOR;\n    // The rest is copy paste of java.awt.Color (only `int i` is changed to `let i` :D)\n    let i = int(1.0 / (1.0 - FACTOR));\n    if (r == 0 && g == 0 && b == 0) {\n      return new Color(i, i, i, alpha);\n    }\n    if (r > 0 && r < i) r = i;\n    if (g > 0 && g < i) g = i;\n    if (b > 0 && b < i) b = i;\n\n    return new Color(\n      Math.min(int(r / FACTOR), 255),\n      Math.min(int(g / FACTOR), 255),\n      Math.min(int(b / FACTOR), 255),\n      alpha\n    );\n  }\n\n  darker() {\n    const FACTOR = Color.FACTOR;\n    const int = Math.floor;\n\n    return new Color(\n      Math.max(int(this.r * FACTOR), 0),\n      Math.max(int(this.g * FACTOR), 0),\n      Math.max(int(this.b * FACTOR), 0),\n      this.a\n    );\n  }\n\n  static brighter(color: string): string {\n    // note: we can't type args simply with ConstructorParameters<typeof Color>.\n    // see more: https://github.com/microsoft/TypeScript/issues/37079\n    return new Color(color).brighter().toString();\n  }\n\n  blend(colorOrColorString: Color | string) {\n    const color =\n      typeof colorOrColorString === \"string\"\n        ? new Color(colorOrColorString)\n        : colorOrColorString;\n    const getBlendedValue = (component: \"r\" | \"g\" | \"b\") =>\n      Math.round(\n        (color.a / 255) * color[component] +\n          (this.a / 255) * (1 - color.a / 255) * this[component]\n      );\n    return new Color(\n      getBlendedValue(\"r\"),\n      getBlendedValue(\"g\"),\n      getBlendedValue(\"b\")\n    );\n  }\n\n  toString() {\n    const toString = (component: number) =>\n      Number.isNaN(component) ? \"\" : component.toString(16).padStart(2, \"0\");\n    const r = toString(this.r);\n    const g = toString(this.g);\n    const b = toString(this.b);\n    const a = this.a === 255 ? \"\" : toString(this.a);\n    return `#${r}${g}${b}${a}`;\n  }\n}\n","import React, { CSSProperties, useRef, useState } from \"react\";\nimport styled, { useTheme } from \"styled-components\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport { ResizerProps } from \"../Resizer/ResizerProps\";\nimport { Theme } from \"../Theme/Theme\";\n\n/**\n * Props are named mostly based on ThreeComponentsSplitter in Intellij Platform.\n */\nexport interface ThreeViewSplitterProps {\n  orientation?: \"horizontal\" | \"vertical\";\n  resizerProps?: Partial<\n    Omit<ResizerProps, \"onResize\" | \"onResizeStarted\" | \"onResizeEnd\">\n  >;\n  innerView?: React.ReactNode;\n  innerViewMinSize?: number;\n  firstView?: React.ReactNode;\n  firstSize?: number | null;\n  firstViewMinSize?: number;\n  lastView?: React.ReactNode;\n  lastSize?: number | null;\n  lastViewMinSize?: number;\n  onFirstResize?: (size: number) => void;\n  onLastResize?: (size: number) => void;\n  style?: CSSProperties;\n  className?: string;\n}\n\nconst StyledSplitterContainer = styled.div<{\n  orientation: \"horizontal\" | \"vertical\";\n}>`\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  flex-direction: ${({ orientation }) =>\n    orientation === \"vertical\" ? \"column\" : \"row\"};\n`;\n\nconst StyledView = styled.div`\n  // The default overflow visible should be changed obviously. Not sure if there is any layout implication\n  // in using 'auto' instead of hidden, to provide scroll behaviour by default, but even if we realize later\n  // that we need to set overflow to hidden here, we can have scrollable content inside the inner view via an\n  // intermediate element inside the inner view, with overflow set to auto and width set to 100%.\n  overflow: auto;\n`;\n\nconst StyledSplitterInnerView = styled(StyledView)`\n  flex: 1;\n`;\n\n/**\n * Corresponding to\n * [ThreeComponentsSplitter](https://github.com/JetBrains/intellij-community/blob/58dbd93e9ea527987466072fa0bfbf70864cd35f/platform/platform-api/src/com/intellij/openapi/ui/ThreeComponentsSplitter.java#L40-L40)\n * `firstView` and `lastView` are optional, and if not provided, the corresponding resizer is not rendered.\n * innerView is supposed to fill the remaining space, while firstView and lastView have specific sizes.\n * size changes in a resize interaction is not reported and is handled by local state in the component. That's\n * to prevent frequent state updates in a higher level which can be expensive. It's also based on this assumption\n * that in the usage side there is no need for any control over resizing or even knowing the intermediate state.\n * Maybe a minSize and maxSize would be the extent of the required control over resizing. But anyway, this model\n * of keeping the size as a local state during a resize session is something that can be changed if needed.\n *\n * Features:\n * - Relative sizing (fraction of the container)\n * - Default size by content\n * - Change handling only when resize is done.\n *\n * TODO: max and min size not implemented\n * TODO: add support for uncontrolled version\n */\nexport const ThreeViewSplitter: React.FC<ThreeViewSplitterProps> = ({\n  orientation = \"horizontal\",\n  firstView,\n  firstSize,\n  lastView,\n  lastSize,\n  onFirstResize,\n  onLastResize,\n  resizerProps: resizerPropsOverrides = {},\n  innerView,\n  firstViewMinSize,\n  lastViewMinSize,\n  innerViewMinSize,\n  ...containerProps\n}: ThreeViewSplitterProps): React.ReactElement => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const firstViewRef = useRef<HTMLDivElement>(null);\n  const lastViewRef = useRef<HTMLDivElement>(null);\n  const [firstSizeState, setFirstSizeState] = useState<number | null>(null);\n  const [lastSizeState, setLastSizeState] = useState<number | null>(null);\n  const theme = useTheme() as Theme;\n\n  const value = <T1, T2>(horizontalValue: T1, verticalValue: T2) =>\n    orientation === \"horizontal\" ? horizontalValue : verticalValue;\n\n  const FirstResizer: React.ComponentType<ResizerProps> = value(\n    RightResizer,\n    BottomResizer\n  );\n  const SecondResizer: React.ComponentType<ResizerProps> = value(\n    LeftResizer,\n    TopResizer\n  );\n  const sizeStyleProp = value(\"width\", \"height\");\n  const minSizeStyleProp = value(\"minWidth\", \"minHeight\");\n\n  const resizerProps: ThreeViewSplitterProps[\"resizerProps\"] = {\n    background: theme.commonColors.contrastBorder,\n    size: 1,\n    ...resizerPropsOverrides,\n  };\n\n  const isFractionSize = (size: number) => size < 1;\n\n  const normalizeSize = (\n    size: number | undefined | null\n  ): CSSProperties[\"width\" | \"height\"] =>\n    size != null\n      ? isFractionSize(size)\n        ? `${size * 100}%`\n        : Math.round(size)\n      : undefined;\n\n  const getSize = (elem: HTMLElement): number =>\n    value(elem.offsetWidth, elem.offsetHeight);\n\n  const getNewSize = (currentSize: number, newSize: number) => {\n    if (currentSize != null && isFractionSize(currentSize)) {\n      if (!containerRef.current) {\n        throw new Error(\n          \"ThreeViewSplitter: Could not locate container to calculate fraction size\"\n        );\n      }\n      const containerSize = value(\n        containerRef.current.offsetWidth,\n        containerRef.current.offsetHeight\n      );\n      const newFractionSize = newSize / containerSize;\n      return newFractionSize < 1 ? newFractionSize : currentSize;\n    } else {\n      return Math.max(newSize, 1);\n    }\n  };\n\n  const getActualSize = (viewElem: HTMLElement | null): number | null => {\n    if (!containerRef.current || !viewElem) {\n      return null;\n    }\n    const actualSize = getSize(viewElem);\n    if (viewElem.style[sizeStyleProp]?.includes(\"%\")) {\n      return actualSize / getSize(containerRef.current);\n    }\n    return actualSize;\n  };\n\n  const currentLastSize = normalizeSize(lastSizeState ?? lastSize);\n  const currentFirstSize = normalizeSize(firstSizeState ?? firstSize);\n  return (\n    <StyledSplitterContainer\n      ref={containerRef}\n      orientation={orientation}\n      {...containerProps}\n    >\n      {firstView && (\n        <>\n          <StyledView\n            ref={firstViewRef}\n            style={{\n              [sizeStyleProp]: currentFirstSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                (lastSizeState !== null ? currentFirstSize : undefined) ??\n                firstViewMinSize,\n            }}\n          >\n            {firstView}\n          </StyledView>\n          <FirstResizer\n            onResizeStarted={() => {\n              const size = firstViewRef.current\n                ? getSize(firstViewRef.current)\n                : 0;\n              setFirstSizeState(firstSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (firstSizeState != null) {\n                setFirstSizeState(getNewSize(firstSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(firstViewRef.current);\n              if (actualSize !== null) {\n                onFirstResize?.(actualSize);\n              }\n              setFirstSizeState(null);\n            }}\n            {...resizerProps}\n          />\n        </>\n      )}\n      {innerView && (\n        <StyledSplitterInnerView\n          style={{\n            [minSizeStyleProp]: innerViewMinSize,\n          }}\n        >\n          {innerView}\n        </StyledSplitterInnerView>\n      )}\n      {lastView && (\n        <>\n          <SecondResizer\n            onResizeStarted={() => {\n              const size = getSize(lastViewRef.current!);\n              setLastSizeState(lastSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (lastSizeState != null) {\n                setLastSizeState(getNewSize(lastSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(lastViewRef.current);\n              if (actualSize !== null) {\n                onLastResize?.(actualSize);\n              }\n              setLastSizeState(null);\n            }}\n            {...resizerProps}\n          />\n          <StyledView\n            ref={lastViewRef}\n            style={{\n              [sizeStyleProp]: currentLastSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                (firstSizeState !== null ? currentLastSize : undefined) ??\n                lastViewMinSize,\n            }}\n          >\n            {lastView}\n          </StyledView>\n        </>\n      )}\n    </StyledSplitterContainer>\n  );\n};\n","import { isMac } from \"@react-aria/utils\";\nimport React, { HTMLProps, useRef } from \"react\";\nimport { css } from \"styled-components\";\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { Theme } from \"../Theme/Theme\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\nimport {\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { Overlay } from \"@react-aria/overlays\";\n\nconst FLOAT_WINDOW_MIN_WIDTH = 100;\nconst FLOAT_WINDOW_MIN_HEIGHT = 40; // in Intellij Platform it's zero but there is window frame which doesn't exist here\n\nconst StyledFloatView = styled.div`\n  box-sizing: border-box;\n  position: fixed;\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  // border color doesn't seem to be correct and needs more investigation. might be even os-specific and outside\n  // theme colors.\n  border: ${({ theme }) => `1px solid ${theme.color(\"Component.borderColor\")}`};\n  ${WINDOW_SHADOW};\n  ${isMac() &&\n  css<{ theme: Theme }>`\n    border-radius: 8px;\n  `}\n  z-index: 2;\n`;\n\n/**\n * Container for tool windows in float view mode. It handles some visual aspects like the border and shadow, as well as\n * UI interactions for changing the floatingBound of the tool window.\n */\nexport const FloatView: React.FC<\n  {\n    state: FloatWindowState;\n    onBoundsChange: (bounds: WindowBounds) => void;\n  } & Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">\n> = ({ children, state: { bounds }, onBoundsChange, ...otherProps }) => {\n  const ref = useRef(null);\n  const { bounds: boundsStyle, overlayInteractionHandlerProps } =\n    useResizableMovableOverlay(ref, {\n      bounds,\n      onBoundsChange,\n    });\n\n  return (\n    <Overlay>\n      <StyledFloatView\n        {...otherProps}\n        ref={ref}\n        style={{ ...otherProps.style, ...boundsStyle }}\n      >\n        <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n          <OverlayResizeHandles\n            minWidth={FLOAT_WINDOW_MIN_WIDTH}\n            minHeight={FLOAT_WINDOW_MIN_HEIGHT}\n          />\n          {children}\n        </OverlayInteractionHandler>\n      </StyledFloatView>\n    </Overlay>\n  );\n};\n","import { move } from \"ramda\";\nimport React, { HTMLProps, Key, useState } from \"react\";\nimport { FloatView } from \"./FloatView\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\n\n// NOTE: useStackedLayersState and useStackedLayers are generic but kept here since there is no other use case at the\n// moment. They should be moved to their own file(s) when/if other use case came up.\n\ninterface StackedLayersState<T> {\n  /**\n   * Sorted list of items representing layers.\n   */\n  sorted: T[];\n  /**\n   * A function to be used when the layer should be brought to front, typically based on some UI interaction.\n   */\n  bringToFront: (index: number) => void;\n}\n\n/**\n * State management for a stacked list of layers with **bring to front** functionality.\n */\nfunction useStackedLayersState<T, K = React.Key>(\n  /**\n   * A list of arbitrary items representing stacked layers.\n   */\n  items: T[],\n  /**\n   * A function for converting each item into a key which consistently identifies each item, in subsequent renders.\n   * It's used to maintain current sorting state. Although it can be of any type, it's usually a string or number.\n   */\n  getKey: (item: T) => K\n): StackedLayersState<T> {\n  // Local state for now, but can easily change to controllable if needed.\n  const [sortedKeys, setSortedKeys] = useState<K[]>([]);\n  const sorted = items.sort(\n    (a, b) => sortedKeys.indexOf(getKey(a)) - sortedKeys.indexOf(getKey(b))\n  );\n  return {\n    sorted,\n    bringToFront: (index: number) => {\n      setSortedKeys(move(index, -1, sorted).map(getKey));\n    },\n  };\n}\n\n/**\n * Given the state of a stacked list of layers, returns DOM props to be applied to each layer for interaction-based\n * \"bring to front\" behaviour.\n */\nfunction useStackedLayers<T>(state: StackedLayersState<T>): {\n  layersProps: Array<HTMLProps<HTMLElement>>;\n} {\n  return {\n    layersProps: state.sorted.map((_, index) => ({\n      onFocus: () => {\n        state.bringToFront(index);\n      },\n    })),\n  };\n}\n\n/**\n * Renders float tool windows.\n * - handles resize and move actions for float windows.\n * - handles layering of float tool windows.\n */\nexport function FloatToolWindows({\n  floatWindows = [],\n  onBoundsChange,\n  renderToolWindow,\n}: {\n  floatWindows: FloatWindowState[] | undefined;\n  onBoundsChange: (key: Key, bounds: WindowBounds) => void;\n  renderToolWindow: (key: Key) => React.ReactNode;\n}) {\n  const stackedFloatWindows = useStackedLayersState(\n    floatWindows,\n    ({ key }) => key\n  );\n  const { layersProps } = useStackedLayers(stackedFloatWindows);\n  // sorted list is used to render layers. We could as well use z-index and always render with the same order, but\n  // it doesn't really matter as long as key is set.\n  return (\n    <>\n      {stackedFloatWindows.sorted.map((toolWindow, index) => (\n        <FloatView\n          key={toolWindow.key}\n          state={toolWindow}\n          {...layersProps[index]}\n          onBoundsChange={(bounds) => onBoundsChange(toolWindow.key, bounds)}\n        >\n          {renderToolWindow(toolWindow.key)}\n        </FloatView>\n      ))}\n    </>\n  );\n}\n","import React, {\n  Key,\n  MutableRefObject,\n  RefObject,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"../utils/useLatest\";\nimport { DropPosition } from \"./createGetDropPosition\";\nimport { UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor } from \"./utils\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\ntype StripeLocation<T extends unknown> = {\n  index: number;\n  anchor: Anchor;\n  isSplit: boolean;\n};\ntype MovableStripeProps<T> = {\n  stripeElRef: React.RefObject<HTMLElement>;\n  getKey: (item: T) => Key;\n  anchor: Anchor;\n  mainItems: T[];\n  splitItems: T[];\n  createGetDropPosition: (\n    key: Key\n  ) => (draggedRect: Rect) => DropPosition | null;\n};\n\ntype MovableToolWindowStripeContextType<T> = {\n  addStripe: <T>(\n    id: string,\n    propsRef: MutableRefObject<MovableStripeProps<T>>\n  ) => () => void;\n  startMove: (id: string, args: { from: Rect; key: Key }) => void;\n  move: (args: { to: Rect }) => void;\n  endMove: () => void;\n  dropPosition: null | { id: string; dropPosition: DropPosition };\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n};\n\nexport type MovableToolWindowStripeProviderProps<T = unknown> = {\n  children: React.ReactNode;\n  onMove: (args: { from: StripeLocation<T>; to: StripeLocation<T> }) => void;\n};\n\nconst MovableToolWindowStripeContext =\n  React.createContext<MovableToolWindowStripeContextType<any> | null>(null);\n\n/**\n * A wrapper component to render around `ToolWindowStripe`s to make their button movable. Stripe buttons then become\n * draggable and can be moved either within the same `ToolWindowStripe` or across different ones.\n * @param onMove: called when a stripe button is moved from one anchor to another.\n * @param children: child element tree, containing one or more ToolWindowStripe elements. No need to be direct children.\n */\nexport const MovableToolWindowStripeProvider = <T extends unknown>({\n  onMove,\n  children,\n}: MovableToolWindowStripeProviderProps<T>) => {\n  const stripes = useRef<{\n    [id: string]: RefObject<MovableStripeProps<T>>;\n  }>({});\n  const [draggingRect, setDraggingRect] = useState<Rect | null>(null);\n  const [draggingKey, setDraggingKey] = useState<Key | null>(null);\n  const [dropPosition, setDropPosition] = useState<{\n    id: string;\n    dropPosition: DropPosition;\n  } | null>(null);\n  const getDropPositionRef = useRef<\n    (to: Rect) => {\n      id: string;\n      dropPosition: DropPosition;\n    } | null\n  >(() => null);\n  const moveStartLocationRef = useRef<null | {\n    id: string;\n    index: number;\n    anchor: Anchor;\n    isSplit: boolean;\n  }>(null);\n\n  const contextValue = useMemo(\n    (): MovableToolWindowStripeContextType<T> => ({\n      addStripe: (id, propsRef) => {\n        if (stripes.current[id]) {\n          console.error(`multiple stripes with the same id \"${id}`);\n        }\n        // @ts-expect-error\n        stripes.current[id] = propsRef;\n        return () => {\n          delete stripes.current[id];\n        };\n      },\n      startMove: (id, { from, key }) => {\n        const stripe = stripes.current[id]?.current;\n        if (!stripe) {\n          return;\n        }\n        const { stripeElRef } = stripe;\n        const stripeElement = stripeElRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n\n        // Running the following two state setters immediately affect the layout\n        // in a way that is necessary for drop position calculation, so the order\n        // is important\n        setDraggingRect(getItemRect(key).toJSON());\n        setDraggingKey(key);\n\n        const indexInMain = stripe.mainItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        const indexInSplit = stripe.splitItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        moveStartLocationRef.current = {\n          id,\n          anchor: stripe.anchor,\n          index: indexInMain > -1 ? indexInMain : indexInSplit,\n          isSplit: indexInSplit > -1,\n        };\n\n        const dropPositionGetters = Object.entries(stripes.current).map(\n          ([id, stripe]) =>\n            [id, stripe.current!.createGetDropPosition(key)] as const\n        );\n        const getDropPosition = (draggedRect: Rect) => {\n          for (const [id, getDropPosition] of dropPositionGetters) {\n            const dropPosition = getDropPosition(draggedRect);\n            if (dropPosition) {\n              return {\n                id,\n                dropPosition,\n              };\n            }\n          }\n          return null;\n        };\n\n        setDropPosition(getDropPosition(from));\n\n        getDropPositionRef.current = getDropPosition;\n      },\n      move: ({ to }) => {\n        setDropPosition(getDropPositionRef.current(to));\n      },\n      endMove: () => {\n        if (dropPosition && draggingKey) {\n          onMove({\n            from: moveStartLocationRef.current!,\n            to: {\n              anchor: dropPosition.id as Anchor /*FIXME*/,\n              index: dropPosition.dropPosition.index,\n              isSplit: dropPosition.dropPosition.split,\n            },\n          });\n        }\n        setDraggingKey(null);\n        setDropPosition(null);\n        setDraggingRect(null);\n      },\n      dropPosition,\n      draggingRect,\n      draggingKey,\n    }),\n    [dropPosition, draggingKey, draggingRect]\n  );\n\n  return (\n    <MovableToolWindowStripeContext.Provider value={contextValue}>\n      {children}\n    </MovableToolWindowStripeContext.Provider>\n  );\n};\n\nexport function useMovableStripeButtons<T>(props: MovableStripeProps<T>) {\n  // Seems reasonable to assume anchor is unique. Also current onMove signature is coupled with anchor, not a more generic id.\n  const id = props.anchor;\n  const context = useContext(MovableToolWindowStripeContext);\n  const latestPropsRef = useLatest(props);\n  useEffect(() => {\n    if (context) {\n      return context.addStripe(id, latestPropsRef);\n    }\n  }, [context, id]);\n\n  const getProps = (\n    key: Key\n  ): Pick<\n    Required<UseElementMoveOptions<unknown>>,\n    \"onMoveStart\" | \"onMove\" | \"onMoveEnd\"\n  > & { moveDisabled: boolean } => ({\n    moveDisabled: !context,\n    onMoveStart: ({ from }) => {\n      context?.startMove?.(id, { from, key });\n    },\n    onMove: ({ to }) => {\n      context?.move({ to });\n    },\n    onMoveEnd: () => {\n      context?.endMove();\n    },\n  });\n  return {\n    getProps,\n    draggingRect: context?.draggingRect ?? null,\n    dropPosition:\n      context?.dropPosition?.id === id\n        ? context?.dropPosition.dropPosition\n        : null,\n    draggingKey: context?.draggingKey ?? null,\n  };\n}\n","import { styled } from \"../styled\";\nimport { css } from \"styled-components\";\n\nconst TopStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: ts;\n`;\nconst BottomStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: bs;\n`;\nconst LeftStripe = styled.div`\n  grid-area: ls;\n`;\nconst RightStripe = styled.div`\n  grid-area: rs;\n`;\nconst InnerView = styled.div`\n  grid-area: main;\n  min-height: 0; // necessary to prevent overflow;\n  position: relative; // necessary for undock views which are absolute positioned\n  background: inherit;\n  min-width: 0; // very important for layout. If not set, resizing tool windows can cause weird scrollbar inside tool windows pane.\n`;\n\n/**\n * The container which renders top,bottom,left and right stripes with a centered content.\n * responsible only for the layout of the stripes and the centered content. layout doesn't\n * include the opened tool windows on different sides and is just about the stripes around\n * the center area.\n * It also supports toggling stripes visibility.\n */\nconst Shell = styled.div<{ hideStripes: boolean }>`\n  display: grid;\n  grid-template-columns: min-content auto min-content;\n  grid-template-rows: min-content auto min-content;\n  grid-template-areas:\n    \".   ts   .\"\n    \"ls main rs\"\n    \".   bs   .\";\n\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${({ hideStripes }) =>\n    hideStripes &&\n    css`\n      ${TopStripe},\n      ${BottomStripe}, \n      ${LeftStripe}, \n      ${RightStripe} {\n        display: none;\n      }\n    `}\n`;\n\nexport const StyledToolWindowOuterLayout = {\n  Shell,\n  TopStripe,\n  BottomStripe,\n  LeftStripe,\n  RightStripe,\n  InnerView,\n};\n","import { compose, filter, groupBy, map, pipe, prop, sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\nimport {\n  ToolWindowsState,\n  ToolWindowState,\n  ViewMode,\n} from \"./ToolWindowsState\";\n\ntype ToolWindowStateWithKey = { key: Key } & ToolWindowState;\n\nexport interface StripesState {\n  main: Key[];\n  split: Key[];\n  activeKeys: Key[];\n}\n\n/**\n * Represents UI state of the split view (aka secondary or side view) within a docked view at one of the four sides.\n */\ntype SideDockedSplitState = {\n  key: Key;\n  /**\n   * relative size of the split view inside a docked view. Note that this is intentionally a fraction size (0≤size<1),\n   * based on the expected behaviour. split views inside a docked view are not fixed sized and resizing the window\n   * affect their size. This is not the case for the docked views themselves inside the main layout, which have fixed\n   * size which is not affected by window resizing.\n   */\n  sizeFraction: number;\n};\n\n// A potential improvement for this and similar nullable types like SideDockedState.split might be to avoid null type\n// and have it like { open: false} | {open: true, ...relevantProps}\n// Not sure if it's really preferred in terms of usage in the react component.\nexport type SideDockedState = null | {\n  size: number;\n  mainKey: Key;\n  split: SideDockedSplitState | null;\n};\n\nexport type SideUnDockedState = null | {\n  size: number;\n  key: Key;\n};\n\nexport interface SideState {\n  docked: SideDockedState;\n  undocked: SideUnDockedState;\n  stripes: StripesState;\n}\n\nexport interface FloatWindowState {\n  key: Key;\n  bounds: Exclude<ToolWindowState[\"floatingBounds\"], undefined>;\n}\n\n/**\n * Derived from ToolWindowsState, it represents the same information in a away that is suitable for ToolWindows\n * component to render the layout.\n */\nexport interface ToolWindowsLayoutState {\n  left: SideState;\n  top: SideState;\n  right: SideState;\n  bottom: SideState;\n  floatWindows: Array<FloatWindowState>;\n  windows: Array<FloatWindowState>;\n}\n\ninterface ContainerSize {\n  width: number;\n  height: number;\n}\n\nconst getSizeInAnchor = (containerSize: ContainerSize, anchor: Anchor) =>\n  containerSize[isHorizontalToolWindow(anchor) ? \"height\" : \"width\"];\n\nconst mapToKey = map<ToolWindowStateWithKey, Key>(prop(\"key\"));\nconst sortAndMapToKey = compose(\n  mapToKey,\n  sortBy(({ order }: ToolWindowStateWithKey) => order)\n);\nconst filterMains = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => !isSplit\n);\nconst getMains = compose(sortAndMapToKey, filterMains);\nconst filterSplits = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => isSplit\n);\nconst filterVisible = (expectedViewMode: ViewMode | ViewMode[] = []) =>\n  filter<ToolWindowStateWithKey, \"array\">(\n    ({ viewMode, isVisible }: ToolWindowStateWithKey) =>\n      isVisible &&\n      ([] as ViewMode[]).concat(expectedViewMode).includes(viewMode)\n  );\nconst getSplits = compose(sortAndMapToKey, filterSplits);\n\nconst filterVisibleDocked = filterVisible([\"docked_unpinned\", \"docked_pinned\"]);\nconst filterVisibleUnDocked = filterVisible(\"undock\");\n\nconst getDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideDockedState => {\n  const docks = filterVisibleDocked(toolWindows);\n  const mains = filterMains(docks);\n  const splits = filterSplits(docks);\n  if (mains.length > 1 || splits.length > 1) {\n    throw new Error(\n      \"More than one visible docked window in a side is not possible\"\n    );\n  }\n  if (mains[0] || splits[0]) {\n    const weight = mains[0]?.weight || splits[0]?.weight;\n    return {\n      mainKey: mains[0]?.key || splits[0]?.key,\n      split:\n        mains[0]?.key && splits[0]?.key\n          ? {\n              key: splits[0].key,\n              sizeFraction: mains[0].weight\n                ? 1 - mains[0].sideWeight\n                : splits[0].sideWeight,\n            }\n          : null,\n      size: weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  return null;\n};\n\nconst getUnDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideUnDockedState => {\n  const windows = filterVisibleUnDocked(toolWindows);\n  if (windows.length === 1) {\n    return {\n      key: windows[0].key,\n      size: windows[0].weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  if (windows.length === 0) {\n    return null;\n  }\n  throw new Error(\n    \"More than one visible undocked window in a side is not possible\"\n  );\n};\n\nconst getSideState = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideState => ({\n  stripes: {\n    main: getMains(toolWindows),\n    split: getSplits(toolWindows),\n    activeKeys: mapToKey(toolWindows.filter(({ isVisible }) => isVisible)),\n  },\n  undocked: getUnDocked(anchor, containerSize, toolWindows),\n  docked: getDocked(anchor, containerSize, toolWindows),\n});\n\nconst DEFAULT_HEIGHT = 300;\nconst DEFAULT_WIDTH = 400;\nconst getFloatWindowState =\n  (containerSize: ContainerSize) =>\n  ({\n    floatingBounds: bounds = {\n      top: containerSize.height / 2 - DEFAULT_HEIGHT / 2,\n      left: containerSize.width / 2 - DEFAULT_WIDTH / 2,\n      height: DEFAULT_HEIGHT,\n      width: DEFAULT_WIDTH,\n    },\n    key,\n  }: ToolWindowStateWithKey): FloatWindowState => ({ bounds, key });\n\nconst getFloatWindowsState = (\n  viewMode: \"float\" | \"window\",\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n) =>\n  pipe(\n    filterVisible(viewMode),\n    map<ToolWindowStateWithKey, FloatWindowState>(\n      getFloatWindowState(containerSize)\n    )\n  )(toolWindows);\n\nexport function getToolWindowsLayoutState(\n  state: Readonly<ToolWindowsState>,\n  containerSize: ContainerSize,\n  /**\n   * list of valid window ids. If state contains window ids that are not included here, they will be excluded in\n   * the returned state object.\n   */\n  windowIds: string[] = Object.keys(state.windows)\n): ToolWindowsLayoutState {\n  const toolWindows = Object.keys(state.windows)\n    .filter(\n      (key) => windowIds.includes(key) && !state.removedFromSideBarIds.has(key)\n    )\n    .map((key) => ({\n      ...state.windows[key],\n      key,\n    }));\n  const {\n    top = [],\n    bottom = [],\n    left = [],\n    right = [],\n  } = groupBy(({ anchor }) => anchor, toolWindows);\n  return {\n    left: getSideState(\"left\", containerSize, left),\n    top: getSideState(\"top\", containerSize, top),\n    right: getSideState(\"right\", containerSize, right),\n    bottom: getSideState(\"bottom\", containerSize, bottom),\n    windows: getFloatWindowsState(\"window\", containerSize, toolWindows),\n    floatWindows: getFloatWindowsState(\"float\", containerSize, toolWindows),\n  };\n}\n","import { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { Key } from \"react\";\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface DropPosition {\n  index: number;\n  split: boolean;\n\n  relative?: {\n    placement: \"before\" | \"after\";\n    key: Key;\n  };\n}\n\n/**\n * TODO: Add a few words about what this function do.\n */\nexport const createGetDropPosition = <T extends any>({\n  anchor,\n  stripeElement,\n  splitItems,\n  mainItems,\n  getItemRect,\n  getKey,\n}: {\n  stripeElement: HTMLElement;\n  anchor: Anchor;\n  getItemRect: (key: Key) => Rect;\n  getKey: (key: T) => Key;\n  mainItems: T[];\n  splitItems: T[];\n}): ((draggedRect: Rect) => DropPosition | null) => {\n  // Note: It may be tempting to calculate stripe element boundaries just once\n  // here, since it's not supposed to change during a drag session, but it\n  // can change due to getting empty when the only button is being dragged out.\n  const getStripeRect = () => stripeElement.getBoundingClientRect();\n\n  const getCanDrop = (draggingRect: Rect) => {\n    const stripeRect = getStripeRect();\n    return (\n      draggingRect.right > stripeRect.left - stripeRect.width &&\n      draggingRect.left < stripeRect.right &&\n      draggingRect.bottom > stripeRect.top - stripeRect.height &&\n      draggingRect.top < stripeRect.bottom\n    );\n  };\n\n  const start = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.left : rect.top;\n  const end = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.right : rect.bottom;\n\n  const getKeyToOffsets = (items: T[]) => {\n    const keyToOffsets: Record<Key, { start: number; end: number }> = {};\n    items.forEach((item) => {\n      const key = getKey(item);\n      const boundingRect = getItemRect(key);\n      keyToOffsets[key] = {\n        start: start(boundingRect),\n        end: end(boundingRect),\n      };\n    });\n    return keyToOffsets;\n  };\n\n  const getDropPositions = (\n    items: T[],\n    split = false\n    // FIXME: score is a bad name. it's quite the opposite! the less means the higher score.\n  ): Array<DropPosition & { score: (rect: Rect) => number }> => {\n    const getRef = split ? end : start;\n    if (items.length === 0) {\n      // if the section is empty, we should still allow adding to it.\n      return [\n        {\n          index: 0,\n          split,\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - getRef(getStripeRect())),\n        },\n      ];\n    }\n    return items.flatMap((item, index) => {\n      const key = getKey(item);\n      return [\n        {\n          index,\n          split,\n          relative: { key, placement: \"before\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].start),\n        },\n        {\n          index: index + 1,\n          split,\n          relative: { key, placement: \"after\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].end),\n        },\n      ];\n    });\n  };\n\n  const keyToOffsets = getKeyToOffsets([...mainItems, ...splitItems]);\n\n  const dropPositions = [\n    ...getDropPositions(mainItems),\n    ...getDropPositions(splitItems, true),\n  ];\n\n  let lastDropPosition: DropPosition | null = null;\n  return (draggingRect: Rect) => {\n    if (!getCanDrop(draggingRect)) {\n      return null;\n    }\n    const result = dropPositions.reduce(\n      (bestMatch, candidate) => {\n        const score = candidate.score(draggingRect);\n        if (!bestMatch || score < bestMatch.score) {\n          return {\n            ...candidate,\n            score,\n          };\n        }\n        return bestMatch;\n      },\n      null as\n        | null\n        | (DropPosition & {\n            score: number;\n          })\n    );\n\n    if (!result) {\n      return null;\n    }\n    if (\n      result.split !== lastDropPosition?.split ||\n      result.index !== lastDropPosition?.index\n    ) {\n      lastDropPosition = result;\n    }\n    return lastDropPosition;\n  };\n};\n","import { StyledIconWrapper } from \"../Icon/StyledIconWrapper\";\nimport { styled } from \"../styled\";\nimport React from \"react\";\nimport { css } from \"styled-components\";\nimport { Anchor } from \"./utils\";\n\nexport interface StyledToolWindowStripeButtonProps {\n  anchor: Anchor;\n  active?: boolean;\n}\n\nexport const STRIPE_BUTTON_CROSS_PADDING = 2.5;\nexport const STRIPE_BUTTON_LINE_HEIGHT = \"1rem\";\n\nconst anchorStyles = ({ anchor }: { anchor: Anchor }) => {\n  const orientation =\n    anchor === \"left\" || anchor === \"right\" ? \"vertical\" : \"horizontal\";\n\n  return orientation === \"horizontal\"\n    ? css`\n        padding: ${STRIPE_BUTTON_CROSS_PADDING}px 10px;\n      `\n    : css`\n        padding: 10px ${STRIPE_BUTTON_CROSS_PADDING}px;\n        writing-mode: vertical-lr;\n        // writing-mode: sideways-lr is not supported anywhere other than FF, so, we need to rotate\n        transform: ${anchor === \"left\" ? \"rotateZ(180deg)\" : undefined};\n\n        // icons are not rotated like text in Intellij Platform implementation. It kind of makes sense.\n        ${StyledIconWrapper} {\n          transform: rotate(180deg);\n        }\n      `;\n};\n\nexport const StyledToolWindowStripeButton = styled.span<StyledToolWindowStripeButtonProps>`\n  box-sizing: border-box;\n  display: flex; // to allow icon and text alignment by default;\n  align-items: center;\n  cursor: default;\n  user-select: none;\n  overflow: hidden;\n  direction: ltr;\n  flex-shrink: 0;\n  font-size: 0.7rem;\n  line-height: ${STRIPE_BUTTON_LINE_HEIGHT}; // absolute value seems to be problematic when the base font size is changed\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedForeground\",\n          theme.dark ? \"rgb(255,255,255)\" : \"rgb(0,0,0)\"\n        )\n      : theme.color(\"*.foreground\")};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedBackground\",\n          theme.dark ? \"rgba(15,15,15,.332)\" : \"rgba(85,85,85,.332)\"\n        )\n      : undefined};\n\n  ${anchorStyles}\n  ${({ active }) =>\n    !active &&\n    css`\n      &:hover {\n        background: ${({ theme }) =>\n          theme.color(\n            \"ToolWindow.Button.hoverBackground\",\n            theme.dark ? \"rgba(15,15,15,.156)\" : \"rgba(85,85,85,.156)\"\n          )};\n      }\n    `};\n`;\n","import {\n  STRIPE_BUTTON_CROSS_PADDING,\n  STRIPE_BUTTON_LINE_HEIGHT,\n  StyledToolWindowStripeButton,\n} from \"./StyledToolWindowStripeButton\";\nimport { Anchor, isHorizontalToolWindow, theOtherSide } from \"./utils\";\nimport { css } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { styled } from \"../styled\";\nimport { Color } from \"../Theme/Color\";\n\nconst minHeight = `calc(${STRIPE_BUTTON_LINE_HEIGHT} + ${\n  2 * STRIPE_BUTTON_CROSS_PADDING + 1 /*border*/\n}px)`;\n\nconst anchorStyles = ({\n  anchor,\n  preventCollapse,\n}: StyledToolWindowStripeProps) =>\n  isHorizontalToolWindow(anchor)\n    ? css`\n        flex-direction: row;\n        width: 100%;\n        min-height: ${preventCollapse ? minHeight : \"fit-content\"};\n        ${StyledToolWindowStripeButton} {\n          height: 1.25rem;\n        }\n      `\n    : css`\n        flex-direction: column;\n        height: 100%;\n        min-width: ${preventCollapse ? minHeight : \"fit-content\"};\n        ${StyledToolWindowStripeButton} {\n          width: 1.25rem;\n        }\n      `;\nconst borderStyle = ({ anchor, theme }: { anchor: Anchor; theme: Theme }) =>\n  css`border-${theOtherSide(anchor)}: 1px solid ${\n    theme.commonColors.contrastBorder\n  }`;\n\nexport interface StyledToolWindowStripeProps {\n  anchor: Anchor;\n  highlighted?: boolean;\n  preventCollapse?: boolean;\n}\n\nexport const StyledToolWindowStripe = styled.div<StyledToolWindowStripeProps>`\n  box-sizing: border-box;\n  background: ${({ theme, highlighted }) =>\n    highlighted\n      ? Color.brighter(theme.commonColors.panelBackground)\n      : theme.commonColors.panelBackground};\n  display: inline-flex;\n  overflow: hidden;\n  ${borderStyle};\n  ${anchorStyles}\n`;\n\nexport const StyledSpacer = styled.div`\n  flex: 1;\n`;\n","import { RefObject } from \"react\";\nimport {\n  useMove,\n  UseMoveOptions,\n  XY,\n} from \"../utils/interaction-utils/useMove\";\nimport { findEffectiveBackgroundColor } from \"./findEffectiveBackgroundColor\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface UseElementMoveOptions<S>\n  extends Omit<UseMoveOptions<S>, \"onMoveStart\" | \"onMove\"> {\n  ref: RefObject<HTMLElement>;\n  /**\n   * if true a clone of the element is created and used as ghost.\n   * A function can be passed to customize the default ghost element or return a completely\n   * different one.\n   */\n  ghost?: boolean | ((defaultGhost: HTMLElement) => HTMLElement);\n\n  onMoveStart: (args: { from: Rect }) => S;\n  onMove: (args: { from: Rect; to: Rect; movement: XY; startState: S }) => void;\n}\n\n/**\n * Provides necessary event handling props to be applied on an element to make it movable.\n * It's implemented on top of {@link useMove}. The differences are:\n * - The signature of `onMoveStart`, `onMove` and `onMoveEnd` are changed to pass\n *   {@link Rect} instead of {@link XY}.\n * - rendering a ghost element.\n *\n * ## A note about ghost:\n * There is no easy way to create a snapshot image of an html element. Native drag and drop API\n * supports [setting drag\n * image](https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/setDragImage) but we are\n * not using drag events mainly because of not being able to customize the offset after which drag\n * should start. See {@link UseMoveOptions#dragThreshold dragThreshold} for more details. There are\n * some libraries like html2canvas for creating an image from an html element, but they are very\n * big and using them doesn't make sense at all from a value/cost ratio perspective. There might be\n * some ways of implementing custom move threshold on top of native drag events. For example by\n * delaying the call to setDragImage, but it needs more investigation. Also, not sure if opacity of\n * the ghost is something you can control when using setDragImage.\n **/\nexport function useElementMove<S>({\n  ref,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  ghost: ghostOption,\n  ...otherOptions\n}: UseElementMoveOptions<S>) {\n  return useMove({\n    ...otherOptions,\n    onMoveStart: () => {\n      const element = ref.current;\n      let ghost: HTMLElement | null = null;\n      if (!element) {\n        throw new Error(\n          \"Movement started but ref value is null. Make sure the passed ref is applied on the same element that other props are.\"\n        );\n      }\n      const updateGhostPosition = (rect: Rect) => {\n        if (ghost) {\n          ghost.style.left = `${rect.left}px`;\n          ghost.style.top = `${rect.top}px`;\n        }\n      };\n      const from: Rect = element.getBoundingClientRect();\n      if (ghostOption) {\n        const defaultGhost = createDefaultGhost(element);\n        ghost =\n          typeof ghostOption === \"function\"\n            ? ghostOption(defaultGhost) || defaultGhost\n            : defaultGhost;\n        ghost.style.position = \"fixed\";\n        document.body.append(ghost);\n        updateGhostPosition(from);\n      }\n      return {\n        ghost,\n        from,\n        updateGhostPosition,\n        startState: onMoveStart({ from }),\n      };\n    },\n    onMove: ({\n      movement,\n      startState: { from, updateGhostPosition, startState },\n    }) => {\n      const to: Rect = {\n        left: from.left + movement.x,\n        right: from.right + movement.x,\n        top: from.top + movement.y,\n        bottom: from.bottom + movement.y,\n        height: from.height,\n        width: from.width,\n      };\n      updateGhostPosition(to);\n      onMove({ from, to, movement, startState });\n    },\n    onMoveEnd: ({ startState: { ghost, startState } }) => {\n      ghost?.remove();\n      onMoveEnd?.({ startState });\n    },\n  });\n}\n\nfunction createDefaultGhost(element: HTMLElement) {\n  const ghost = element.cloneNode(true) as HTMLElement;\n  ghost.style.backgroundColor = findEffectiveBackgroundColor(element);\n  return ghost;\n}\n","import { Color } from \"../Theme/Color\";\n\n/**\n * Computes the effective background color of the element by blending translucent backgrounds of\n * the elements ancestors. It traverses up the parents, until reaches a solid background color.\n * all translucent backgrounds in between are blended with that solid color, with respect to their\n * transparency. It's meant to be used only for the simple cases where an element doesn't overflow\n * the parents. Obviously, in other cases there won't be one single effective background color\n * for the element.\n */\nexport function findEffectiveBackgroundColor(element: HTMLElement): string {\n  let elem: HTMLElement | null = element;\n  let colors: Color[] = [];\n  while (elem != null) {\n    const computedBackground = getComputedStyle(elem).backgroundColor;\n    if (computedBackground) {\n      const color = new Color(computedBackground);\n      colors.unshift(color);\n      if (color.a === 255) {\n        // if we've reached a solid color, we don't need to continue traversing ancestors\n        break;\n      }\n    }\n    elem = elem.parentElement;\n  }\n  return (\n    colors\n      .reduce<Color | null>((resultColor, nextColor) => {\n        return resultColor ? resultColor.blend(nextColor) : nextColor;\n      }, null)\n      ?.toString() || \"\"\n  );\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport React, { CSSProperties, HTMLAttributes, Key, useRef } from \"react\";\nimport { createGetDropPosition, DropPosition } from \"./createGetDropPosition\";\nimport { useMovableStripeButtons } from \"./MovableToolWindowStripeProvider\";\nimport { StyledSpacer, StyledToolWindowStripe } from \"./StyledToolWindowStripe\";\nimport { StyledToolWindowStripeButton } from \"./StyledToolWindowStripeButton\";\nimport { useElementMove, UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\ninterface ToolWindowStripeProps<T> {\n  anchor: Anchor;\n  items: T[];\n  splitItems?: T[];\n  getKey: (item: T) => Key;\n  renderItem: (item: T) => React.ReactNode;\n  selectedKeys?: Key[];\n  onItemPress?: (key: Key) => void;\n}\n\n/**\n * TODO: refactor to remove the key based interface.\n */\nexport function ToolWindowStripe<T>({\n  anchor,\n  items: mainItems,\n  renderItem: render,\n  splitItems = [],\n  selectedKeys = [],\n  onItemPress,\n  getKey,\n}: ToolWindowStripeProps<T>) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const { getProps, draggingRect, draggingKey, dropPosition } =\n    useMovableStripeButtons({\n      stripeElRef: containerRef,\n      getKey,\n      anchor,\n      mainItems,\n      splitItems,\n      createGetDropPosition: (key: Key) => {\n        const isNotCurrentItem = (anItem: T) => getKey(anItem) !== key;\n        const stripeElement = containerRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n        return createGetDropPosition({\n          stripeElement: stripeElement,\n          mainItems: mainItems.filter(isNotCurrentItem),\n          splitItems: splitItems.filter(isNotCurrentItem),\n          getKey,\n          anchor,\n          getItemRect,\n        });\n      },\n    });\n\n  const highlighted =\n    dropPosition != null &&\n    draggingKey != null &&\n    [...mainItems, ...splitItems].every((item) => getKey(item) !== draggingKey);\n\n  const renderItem = (item: T) => {\n    const key = getKey(item);\n\n    return (\n      <ToolWindowStripeButton\n        anchor={anchor}\n        key={key}\n        data-key={key}\n        style={{\n          ...getStripeButtonStyles({\n            key,\n            dropPosition,\n            anchor,\n            draggingRect,\n            draggingKey,\n          }),\n        }}\n        {...getProps(key)}\n        active={selectedKeys.includes(key)}\n        onPress={() => onItemPress?.(key)}\n      >\n        {render(item)}\n      </ToolWindowStripeButton>\n    );\n  };\n  return (\n    <>\n      <StyledToolWindowStripe\n        anchor={anchor}\n        preventCollapse={Boolean(dropPosition)}\n        highlighted={highlighted}\n        ref={containerRef}\n      >\n        {mainItems.map(renderItem)}\n        <StyledSpacer />\n        {splitItems.map(renderItem)}\n      </StyledToolWindowStripe>\n    </>\n  );\n}\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nfunction getStripeButtonStyles({\n  anchor,\n  key,\n  dropPosition,\n  draggingRect,\n  draggingKey,\n}: {\n  anchor: Anchor;\n  key: Key;\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n  dropPosition: DropPosition | null;\n}) {\n  const styles: CSSProperties = {\n    // transition: \"margin 100ms\", // maybe only when drag is in progress, if unwanted transition at drop\n  };\n  if (dropPosition?.relative?.key === key && draggingRect) {\n    const marginValue = isHorizontalToolWindow(anchor)\n      ? draggingRect.width\n      : draggingRect.height;\n\n    if (isHorizontalToolWindow(anchor)) {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginLeft\"\n          : \"marginRight\"\n      ] = marginValue;\n    } else {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginTop\"\n          : \"marginBottom\"\n      ] = marginValue;\n    }\n  }\n  if (key === draggingKey) {\n    styles.display = \"none\";\n  }\n  return styles;\n}\n\nfunction ToolWindowStripeButton<T, S>({\n  children,\n  anchor,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  onPress,\n  moveDisabled,\n  ...otherProps\n}: {\n  children: React.ReactNode;\n  anchor: Anchor;\n  style: CSSProperties;\n  active: boolean;\n  onPress: () => void;\n  moveDisabled?: boolean;\n  onMoveStart: UseElementMoveOptions<S>[\"onMoveStart\"];\n  onMove: UseElementMoveOptions<S>[\"onMove\"];\n  onMoveEnd: UseElementMoveOptions<S>[\"onMoveEnd\"];\n}) {\n  const ref = useRef<HTMLElement>(null);\n\n  // for some reason, usePress and useMove (used in useElementMove) are not compatible.\n  // it seems onMouseDown in useMove is not called, even when handlers are merged by mergeProps.\n  // FIXME: fix compatibility of useMove and usePress, and switch to usePress({ onPress })\n  const { pressProps } = {\n    pressProps: {\n      onPointerUp: onPress,\n      onMouseDown: (e) => {\n        e.preventDefault();\n      },\n    } as HTMLAttributes<HTMLElement>,\n  }; //usePress({ onPress });\n  const props = useElementMove({\n    ref,\n    disabled: moveDisabled,\n    dragThreshold: 7,\n    ghost: true,\n    onMoveStart,\n    onMove,\n    onMoveEnd,\n  });\n\n  return (\n    <StyledToolWindowStripeButton\n      anchor={anchor}\n      {...mergeProps(otherProps, pressProps, props)}\n      ref={ref}\n    >\n      {children}\n    </StyledToolWindowStripeButton>\n  );\n}\n","import React from \"react\";\nimport { css } from \"styled-components\";\nimport { ResizableView } from \"../ResizableView\";\nimport { styled } from \"../styled\";\nimport { SideUnDockedState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\nexport const StyledUndockSide = styled.div<{ anchor: Anchor }>`\n  position: absolute;\n  background: inherit;\n  z-index: 1;\n  ${({ anchor }) =>\n    isHorizontalToolWindow(anchor)\n      ? css`\n          left: 0;\n          right: 0;\n        `\n      : css`\n          top: 0;\n          bottom: 0;\n        `};\n  ${({ anchor }) =>\n    css`\n      ${anchor}: 0;\n    `};\n`;\n\nexport function UndockSide({\n  state,\n  anchor,\n  children,\n  onResize,\n}: {\n  state: Exclude<SideUnDockedState, null>;\n  anchor: Anchor;\n  children: React.ReactNode;\n  onResize: (size: number) => void;\n}) {\n  return (\n    state && (\n      <StyledUndockSide anchor={anchor}>\n        <ResizableView\n          orientation={\n            isHorizontalToolWindow(anchor) ? \"vertical\" : \"horizontal\"\n          }\n          resizerPlacement={\n            anchor === \"left\" || anchor === \"top\" ? \"after\" : \"before\"\n          }\n          size={state.size}\n          onResize={onResize}\n        >\n          {children}\n        </ResizableView>\n      </StyledUndockSide>\n    )\n  );\n}\n","import { indexBy } from \"ramda\";\nimport React, {\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n  Key,\n  useImperativeHandle,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nimport { ThreeViewSplitter } from \"../ThreeViewSplitter/ThreeViewSplitter\";\nimport { FocusScope } from \"../utils/FocusScope\";\nimport { FloatToolWindows } from \"./FloatToolWindows\";\nimport { MovableToolWindowStripeProvider } from \"./MovableToolWindowStripeProvider\";\nimport { StyledToolWindowOuterLayout } from \"./StyledToolWindowOuterLayout\";\nimport {\n  getToolWindowsLayoutState,\n  SideDockedState,\n  StripesState,\n  ToolWindowsLayoutState,\n} from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { ToolWindowsState } from \"./ToolWindowsState/ToolWindowsState\";\nimport { ToolWindowStateProvider } from \"./ToolWindowsState/ToolWindowStateProvider\";\nimport { ToolWindowStripe } from \"./ToolWindowStripe\";\nimport { UndockSide } from \"./UndockSide\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { useOnFocusLost } from \"./useOnFocusLost\";\nimport { useInteractOutside } from \"@react-aria/interactions\";\n\ninterface ToolWindow {\n  id: string;\n  toolbarButton: React.ReactNode;\n  content: React.ReactNode;\n}\n\nexport interface ToolWindowsProps {\n  children: React.ReactNode;\n  windows: ToolWindow[];\n  toolWindowsState: Readonly<ToolWindowsState>;\n  onToolWindowStateChange: (newState: ToolWindowsState) => void;\n\n  /**\n   * Whether stripe buttons should be hidden or not.\n   * `hideToolStripes` UISettings in Intellij Platform\n   */\n  hideToolWindowBars?: boolean;\n\n  /**\n   *\n   * `wideScreenSupport` in UISettings in Intellij Platform\n   */\n  useWidescreenLayout?: boolean;\n\n  /**\n   * min width applied to the main content (children).\n   * @default 50\n   */\n  mainContentMinWidth?: number;\n\n  height?: CSSProperties[\"height\"];\n  minHeight?: CSSProperties[\"minHeight\"];\n  margin?: CSSProperties[\"margin\"];\n\n  /**\n   * props to be passed to the container element.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"as\">;\n}\n\nexport interface ToolWindowRefValue {\n  focus(key: Key): void;\n  hasFocus(key: Key): void;\n  focusLastActiveWindow(): void;\n  focusMainContent(): void;\n  changeState(\n    updater: (currentState: Readonly<ToolWindowsState>) => ToolWindowsState\n  ): void;\n}\n\n/**\n * @constructor\n *\n * Corresponding to ToolWindowPane in Intellij Platform\n *\n * Known issues:\n * - in Firefox and Safari, left and right toolbars are not properly shown. Seems like a nasty bug, since adding and\n * then removing some min-width: fit-content style fixes it.\n * - in the dock view of a side, open only a window from the split ones. then open a window from main ones.\n *   focus is not moved to the just opened window. The reason is we rely on autofocusing and because the React tree\n *   changes for both windows, even the split one which was open will be unmounted and mounted again, and since it's\n *   placed after the main one, and hence mounted later, it will get the focus again. This becomes a bigger issue\n *   if the main one is unpinned, because it immediately gets closed after opening.\n *   Possible solutions:\n *   - make sure the split one won't unmount and mount again in such scenario.\n *   - decouple focusing logic from mounting logic, and only focus windows somehow, when the `isVisible` is changed\n *     from false to true, not when mounted.\n * - related to previous issue: open a tool window in split section of a side. set view mode for a tool window in main\n *   section of the same side to docked_unpinned. try to open the unpinned one while the split one is open. it doesn't\n *   work.\n */\nexport const ToolWindows = React.forwardRef(function ToolWindows(\n  {\n    hideToolWindowBars = false,\n    useWidescreenLayout = false,\n    height = \"100%\",\n    minHeight = \"0\",\n    toolWindowsState,\n    onToolWindowStateChange,\n    windows,\n    children,\n    mainContentMinWidth = 50,\n    containerProps = {},\n  }: ToolWindowsProps,\n  ref: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const windowsById = indexBy(({ id }) => id, windows);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const mainContentFocusScopeRef =\n    useRef<React.ComponentRef<typeof FocusScope>>(null);\n  const [layoutState, setLayoutState] = useState<ToolWindowsLayoutState>();\n  const windowFocusableRefs = useRef<{\n    [key: string]: React.RefObject<React.ComponentRef<typeof FocusScope>>;\n  }>({});\n\n  const latestRef = useLatest({ toolWindowsState, onToolWindowStateChange });\n\n  useLayoutEffect(() => {\n    const container = containerRef.current;\n    const _setLayoutState = () =>\n      setLayoutState(\n        getToolWindowsLayoutState(\n          toolWindowsState,\n          container!.getBoundingClientRect(),\n          windows.map(({ id }) => id)\n        )\n      );\n\n    // If container is rendered but has zero dimensions for any reason, we start observing size changes, until\n    // it's no longer collapsed. Note that we don't want to unconditionally observe resizes and update the layout state.\n    // because tool windows are not supposed to keep the fraction width as the window resizes. They are supposed to have\n    // a fixed width which is determined fraction-based, but only when the tool window is opened. In fact, updating the\n    // layout state, on each and every change to toolWindowsState is also not quite correct, as some state changes\n    // are unrelated and shouldn't cause a re-calculation of the size. FIXME: don't re-calculate fraction base sizes on\n    //  every state change.\n    if (container?.offsetWidth === 0 || container?.offsetHeight === 0) {\n      const observer = new ResizeObserver(([resize]) => {\n        if (resize.contentRect.width > 0 && resize.contentRect.height > 0) {\n          _setLayoutState();\n          observer.unobserve(container);\n        }\n      });\n      observer.observe(container);\n    }\n    _setLayoutState();\n  }, [toolWindowsState]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (key: Key) => {\n        windowFocusableRefs.current[key]?.current?.focus();\n      },\n      hasFocus: (key: Key) =>\n        document.activeElement?.closest(`[data-tool-window-id=\"${key}\"]`) !==\n        null,\n      focusLastActiveWindow: () => {\n        const { lastFocusedKey } = latestRef.current.toolWindowsState;\n        if (lastFocusedKey != null) {\n          if (\n            !latestRef.current.toolWindowsState.windows[lastFocusedKey]\n              .isVisible\n          ) {\n            latestRef.current.onToolWindowStateChange(\n              toolWindowsState.show(lastFocusedKey)\n            );\n          }\n          windowFocusableRefs.current[lastFocusedKey].current?.focus(true);\n        }\n      },\n      focusMainContent: () => {\n        mainContentFocusScopeRef.current?.focus();\n      },\n      changeState: (updater) => {\n        onToolWindowStateChange(updater(latestRef.current.toolWindowsState));\n      },\n    }),\n    []\n  );\n\n  const interactionOutsideRef = useRef(false);\n  useInteractOutside({\n    ref: containerRef,\n    onInteractOutsideStart: () => {\n      interactionOutsideRef.current = true;\n    },\n    onInteractOutside: () => {\n      interactionOutsideRef.current = false;\n    },\n  });\n\n  useOnFocusLost(({ focusReceivingElement }) => {\n    if (!focusReceivingElement && !interactionOutsideRef.current) {\n      mainContentFocusScopeRef.current?.focus();\n    }\n  }, containerRef);\n\n  // TODO: extract component candidate\n  const renderStripe = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: StripesState;\n  }) => (\n    <ToolWindowStripe\n      anchor={anchor}\n      items={state.main}\n      splitItems={state.split}\n      getKey={(item) => item}\n      renderItem={(item) => windowsById[item]?.toolbarButton}\n      onItemPress={(key) =>\n        onToolWindowStateChange(toolWindowsState.toggle(key))\n      }\n      selectedKeys={state.activeKeys}\n    />\n  );\n\n  const renderToolWindow = (key: Key) => {\n    if (!windowFocusableRefs.current[key]) {\n      windowFocusableRefs.current[key] = React.createRef();\n    }\n    return (\n      <div\n        style={{ all: \"unset\" }}\n        data-tool-window-id={key}\n        onFocus={() => {\n          onToolWindowStateChange(toolWindowsState.lastFocused(key));\n        }}\n      >\n        <FocusScope ref={windowFocusableRefs.current[key]}>\n          <ToolWindowStateProvider\n            id={key}\n            containerRef={containerRef}\n            mainContentFocusableRef={mainContentFocusScopeRef}\n            toolWindowsState={toolWindowsState}\n            onToolWindowStateChange={onToolWindowStateChange}\n          >\n            {windowsById[key]?.content}\n          </ToolWindowStateProvider>\n        </FocusScope>\n      </div>\n    );\n  };\n  // TODO: candidate for component extraction\n  const renderSideDockedView = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: SideDockedState;\n  }) => {\n    if (!state) {\n      return null;\n    }\n    return (\n      <ThreeViewSplitter\n        innerView={renderToolWindow(state.mainKey)}\n        innerViewMinSize={50}\n        lastView={state.split && renderToolWindow(state.split.key)}\n        lastSize={state.split?.sizeFraction}\n        onLastResize={(newSize) => {\n          onToolWindowStateChange(\n            toolWindowsState.resizeDockSplitView(anchor, newSize)\n          );\n        }}\n        orientation={isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\"}\n      />\n    );\n  };\n  const onDockResize = (anchor: Anchor) => (size: number) => {\n    const containerBounds = containerRef.current?.getBoundingClientRect();\n    // containerBounds should have value in normal course of events\n    if (containerBounds) {\n      onToolWindowStateChange(\n        toolWindowsState.resizeDock(anchor, size, containerBounds)\n      );\n    }\n  };\n  const getSplitViewProps = (\n    layoutState: ToolWindowsLayoutState,\n    orientation: \"horizontal\" | \"vertical\"\n  ) => {\n    const firstAnchor = orientation === \"horizontal\" ? \"left\" : \"top\";\n    const secondAnchor = orientation === \"horizontal\" ? \"right\" : \"bottom\";\n    return {\n      orientation,\n      firstView: renderSideDockedView({\n        anchor: firstAnchor,\n        state: layoutState[firstAnchor].docked,\n      }),\n      firstSize: layoutState[firstAnchor].docked?.size,\n      onFirstResize: onDockResize(firstAnchor),\n      lastView: renderSideDockedView({\n        anchor: secondAnchor,\n        state: layoutState[secondAnchor].docked,\n      }),\n      lastSize: layoutState[secondAnchor].docked?.size,\n      onLastResize: onDockResize(secondAnchor),\n    };\n  };\n  const renderInnerLayout = (layoutState: ToolWindowsLayoutState) => {\n    const horizontalSplitterProps = getSplitViewProps(\n      layoutState,\n      \"horizontal\"\n    );\n    const verticalSplitterProps = getSplitViewProps(layoutState, \"vertical\");\n\n    const [outerSplitterProps, innerSplitterProps] = useWidescreenLayout\n      ? [horizontalSplitterProps, verticalSplitterProps]\n      : [verticalSplitterProps, horizontalSplitterProps];\n\n    const undockLayers = ([\"left\", \"top\", \"right\", \"bottom\"] as const).map(\n      (anchor) => {\n        const state = layoutState[anchor].undocked;\n        return (\n          state && (\n            <UndockSide\n              key={anchor}\n              anchor={anchor}\n              state={state}\n              onResize={(size) => {\n                containerRef.current &&\n                  onToolWindowStateChange(\n                    toolWindowsState.resizeUndock(\n                      anchor,\n                      size,\n                      containerRef.current.getBoundingClientRect()\n                    )\n                  );\n              }}\n            >\n              {renderToolWindow(state.key)}\n            </UndockSide>\n          )\n        );\n      }\n    );\n\n    return (\n      <>\n        <MovableToolWindowStripeProvider\n          onMove={({ to, from }) => {\n            onToolWindowStateChange(\n              toolWindowsState.move(\n                layoutState[from.anchor].stripes[\n                  from.isSplit ? \"split\" : \"main\"\n                ][from.index],\n                { anchor: to.anchor, isSplit: to.isSplit },\n                to.index\n              )\n            );\n          }}\n        >\n          {/**\n           * ToolWindow bars, aka Stripes. Order of stripes is irrelevant for layout but relevant for\n           * priority when stripe buttons are moved across stripes.\n           * layout is handled by `StyledToolWindowOuterLayout`.\n           */}\n          <StyledToolWindowOuterLayout.LeftStripe>\n            {renderStripe({\n              anchor: \"left\",\n              state: layoutState[\"left\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.LeftStripe>\n          <StyledToolWindowOuterLayout.TopStripe>\n            {renderStripe({\n              anchor: \"top\",\n              state: layoutState[\"top\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.TopStripe>\n          <StyledToolWindowOuterLayout.RightStripe>\n            {renderStripe({\n              anchor: \"right\",\n              state: layoutState[\"right\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.RightStripe>\n          <StyledToolWindowOuterLayout.BottomStripe>\n            {renderStripe({\n              anchor: \"bottom\",\n              state: layoutState[\"bottom\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.BottomStripe>\n        </MovableToolWindowStripeProvider>\n        {/**\n         * The inner layout of the ToolWindow, including four tool windows and\n         * a main content in the center.\n         */}\n        <StyledToolWindowOuterLayout.InnerView>\n          <ThreeViewSplitter\n            {...outerSplitterProps}\n            innerView={\n              <ThreeViewSplitter\n                innerViewMinSize={mainContentMinWidth}\n                innerView={\n                  <FocusScope ref={mainContentFocusScopeRef}>\n                    {children}\n                  </FocusScope>\n                }\n                {...innerSplitterProps}\n              />\n            }\n          />\n          {undockLayers}\n          {\n            <FloatToolWindows\n              floatWindows={layoutState?.floatWindows}\n              renderToolWindow={renderToolWindow}\n              onBoundsChange={(key, bounds) =>\n                onToolWindowStateChange(\n                  toolWindowsState.setFloatingBound(key, bounds)\n                )\n              }\n            />\n          }\n        </StyledToolWindowOuterLayout.InnerView>\n      </>\n    );\n  };\n\n  return (\n    <StyledToolWindowOuterLayout.Shell\n      {...containerProps}\n      ref={containerRef}\n      /**\n       * Potential refactoring: hideStripes can also be handled by conditionally\n       * rendering tool window bars, instead of considering it as a feature of\n       * StyledToolWindowOuterLayout\n       **/\n      hideStripes={hideToolWindowBars}\n      style={{ height, minHeight, ...containerProps?.style }}\n    >\n      {layoutState && renderInnerLayout(layoutState)}\n    </StyledToolWindowOuterLayout.Shell>\n  );\n});\n","import { RefObject, useEffect } from \"react\";\n\n/**\n * Executes a callback function when focus is lost from the container element. i.e. when the currently focused element\n * was within the container and:\n * - The focus is going to an element outside the container, or\n * - The focus is about to get lost (i.e. go to `document.body`).\n *\n * Note: react-aria's `useFocusWithin` (and it's `onBlurWithin` option) can't be used, since (at least currently) it\n * doesn't cover the scenario where the focus is about to get lost due to the focused element getting unmounted.\n */\nexport function useOnFocusLost(\n  onFocusLost: (args: {\n    focusLosingElement: HTMLElement | null;\n    focusReceivingElement: Element | null;\n  }) => void,\n  containerRef: RefObject<HTMLElement>\n): void {\n  useEffect(() => {\n    const handleBodyFocus = (e: FocusEvent) => {\n      if (\n        e.target instanceof HTMLElement &&\n        containerRef.current?.contains(e.target) &&\n        (!e.relatedTarget || e.relatedTarget instanceof HTMLElement) &&\n        !containerRef.current?.contains(e.relatedTarget)\n      ) {\n        onFocusLost({\n          focusLosingElement: e.target,\n          focusReceivingElement: e.relatedTarget,\n        });\n      }\n    };\n    containerRef.current?.addEventListener(\"focusout\", handleBodyFocus);\n    return () => {\n      containerRef.current?.removeEventListener(\"focusout\", handleBodyFocus);\n    };\n  }, []);\n}\n","import React, { Key, RefObject, useContext, useMemo } from \"react\";\nimport { ToolWindowsProps } from \"../ToolWindows\";\nimport { ToolWindowState, ViewMode, WindowBounds } from \"./ToolWindowsState\";\nimport { Anchor } from \"../utils\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ntype ToolWindowStateContextValue = {\n  state: Readonly<ToolWindowState>;\n  hide: () => void;\n  remove: () => void;\n  blur: () => void;\n  focusMainContent: () => void;\n  moveToSide: (args: { anchor: Anchor; isSplit: boolean }) => void;\n  changeViewMode: (viewMode: ViewMode) => void;\n  stretchWidth: (value: number) => void;\n  stretchHeight: (value: number) => void;\n  setFloatingBounds: (bounds: WindowBounds) => void;\n};\nconst ToolWindowStateContext =\n  React.createContext<ToolWindowStateContextValue | null>(null);\n\n/**\n * Used in a tool window's UI tree, to get access to the tool window state and actions for changing it.\n */\nexport const useToolWindowState = () => {\n  const context = useContext(ToolWindowStateContext);\n  if (!context) {\n    throw new Error(\n      \"useToolWindowContext is meant to be used inside a tool window.\"\n    );\n  }\n  return context;\n};\n\n/**\n * Used in ToolWindows to provide tool window state and necessary actions as a context, which will be accessible\n * within the tool window content tree, via {@link useToolWindowState}\n */\nexport const ToolWindowStateProvider: React.FC<\n  {\n    children?: React.ReactNode;\n    id: Key;\n    containerRef: RefObject<HTMLElement>;\n    mainContentFocusableRef: RefObject<{ focus: () => void }>;\n  } & Pick<ToolWindowsProps, \"toolWindowsState\" | \"onToolWindowStateChange\">\n> = ({\n  toolWindowsState,\n  containerRef,\n  mainContentFocusableRef,\n  onToolWindowStateChange,\n  id,\n  children,\n}) => {\n  const blur = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.blur(id));\n  });\n  const hide = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.hide(id));\n  });\n  const remove = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.removeFromSidebar(id));\n  });\n  const focusMainContent = useEventCallback(() => {\n    mainContentFocusableRef.current?.focus();\n  });\n  const moveToSide = useEventCallback(\n    (side: { anchor: Anchor; isSplit: boolean }) => {\n      onToolWindowStateChange(toolWindowsState.move(id, side));\n    }\n  );\n  const changeViewMode = useEventCallback((viewMode: ViewMode) => {\n    onToolWindowStateChange(toolWindowsState.changeViewMode(id, viewMode));\n  });\n  const stretchWidth = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchWidth(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const stretchHeight = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchHeight(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const setFloatingBounds = useEventCallback((bounds: WindowBounds) => {\n    onToolWindowStateChange(toolWindowsState.setFloatingBound(id, bounds));\n  });\n  const contextValue = useMemo((): ToolWindowStateContextValue => {\n    const state = toolWindowsState.windows[id];\n    return {\n      state,\n      hide,\n      blur,\n      remove,\n      focusMainContent,\n      moveToSide,\n      changeViewMode,\n      stretchWidth,\n      stretchHeight,\n      setFloatingBounds,\n    };\n  }, [toolWindowsState, id]);\n  return (\n    <ToolWindowStateContext.Provider value={contextValue}>\n      {children}\n    </ToolWindowStateContext.Provider>\n  );\n};\n","import { clamp, curry, fromPairs, insert, mapObjIndexed, move } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\n\nexport type ViewMode =\n  | \"docked_pinned\"\n  | \"docked_unpinned\"\n  | \"undock\"\n  | \"float\"\n  /**\n   * @deprecated \"window\" ViewMode was initially added following the original impl. It doesn't seem reasonable to\n   * support it though. It's marked as deprecated to be removed in the future.\n   */\n  | \"window\";\n\nexport type WindowBounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * Data structure for keeping the state of a single tool window. very similar to WindowInfo in Intellij Platform\n *\n * A note about about the data structure:\n * Some fields like `isSplit`, `weight`, `floatingBound` are meaningful only\n * for a subset of viewModes. So it may be tempting to introduce a `viewMode`\n * type which minimally and more accurately describes the information\n * relevant for each viewMode. But it's not structured like that, and it's\n * orthogonal to viewMode, since we want to preserve the relevant information\n * for each viewMode, to be used when the viewMode is changed back.\n *\n * NOTE: consider renaming to `WindowState` to avoid confusion with `ToolWindowsState`\n */\nexport interface ToolWindowState {\n  /**\n   * The order of the tool window in its group. The group is specified by `anchor` and `isSplit`.\n   */\n  order: number;\n  /**\n   * Whether the tool window is visible (open) or not.\n   * NOTE: A maximum of 1 **docked** tool window within the same group (same `anchor` and `isSplit`) can be visible.\n   * You will get a render error in `ToolWindows` component otherwise.\n   */\n  isVisible: boolean;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered in the primary group, i.e. when\n   * `isSplit` is false\n   */\n  weight: number;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered in the secondary group. i.e.\n   * when `isSplit` is true.\n   */\n  sideWeight: number;\n  /**\n   * The side of the tool window, being \"left\", \"right\", \"top\" or \"bottom\"\n   */\n  anchor: Anchor;\n  /**\n   * Specifies whether the tool window should be shown in the split view, aka \"Secondary group\".\n   */\n  isSplit: boolean;\n  /**\n   * Tool windows view mode. See {@link ViewMode}\n   *\n   * NOTE: in Intellij Platform, there is a window `type` and also `docked` and\n   * `autoHide`.\n   * keeping one viewMode makes more sense and prevents invalid combinations\n   * like { type: \"window, \"docked\": true}, that would be unnecessarily allowed.\n   */\n  viewMode: ViewMode;\n  /**\n   * Boundaries of the tool window, when rendered in \"float\" view mode.\n   */\n  floatingBounds?: WindowBounds;\n}\n\nconst isDocked = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" ||\n  toolWindow.viewMode === \"docked_pinned\";\n\n/**\n * Determines whether the tool window should hide on focus. In the java implementation, it's a field on window\n * info instead of being a calculated field. We changed that to match viewMode with the 5 view modes that are possible\n * to choose from the UI, eliminating the combinations that are never allowed. If from UX perspective, having window\n * or float mode with autoHide feature is considered valid at some point, we may need to change the implementation\n * to something similar to the original implementation where isAutoHide and viewMode are separate.\n */\nconst isAutoHide = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" || toolWindow.viewMode === \"undock\";\n\nexport type SideInfo = Pick<ToolWindowState, \"anchor\" | \"isSplit\">;\nexport const areInSameSection = curry(\n  (window1: SideInfo, window2: SideInfo) =>\n    window1.anchor === window2.anchor && window1.isSplit === window2.isSplit\n);\n\nexport const getViewModeType = (viewMode: ViewMode) => {\n  if (viewMode === \"docked_pinned\" || viewMode === \"docked_unpinned\") {\n    return \"docked\";\n  }\n  if (viewMode === \"window\" || viewMode === \"float\") {\n    return \"float\";\n  }\n  return viewMode;\n};\ntype IdToWindowStateMap = Readonly<{\n  [key: string]: Readonly<ToolWindowState>;\n}>;\n\n/**\n * Represents UI state of a bunch of tool windows. What is rendered inside each window or toolbar button is irrelevant.\n *\n * TODO: document pros and cons of these two approaches\n * - Having a class for ToolWindowsState which keeps a readonly mapping of keys to window states.\n * - Having ToolWindowsState as an interface (a mapping from keys to window states), and a bunch of action functions\n *   which accept a window state and some arguments, and return a new window state.\n */\nexport class ToolWindowsState {\n  public readonly lastFocusedKey: Key | null;\n  public readonly removedFromSideBarIds: ReadonlySet<Key>;\n  private readonly layoutToRestore: IdToWindowStateMap;\n  constructor(\n    public readonly windows: IdToWindowStateMap,\n    {\n      lastFocusedKey = null,\n      layoutToRestore = {},\n      removedFromSideBarIds = [],\n    }: {\n      lastFocusedKey?: Key | null;\n      layoutToRestore?: IdToWindowStateMap;\n      removedFromSideBarIds?: Iterable<Key>;\n    } = {}\n  ) {\n    this.lastFocusedKey = lastFocusedKey;\n    this.layoutToRestore = layoutToRestore;\n    this.removedFromSideBarIds = new Set(removedFromSideBarIds);\n    // TODO: instead of keeping a set of removedFromSideBarIds showStripeButton can be a boolean on each window state.\n    //  if we want to avoid the invalid combination of `{ isVisible: true, showStripeButton: false }`, we can have a\n    //  a single property like : visibility: 'open' | 'closed' | 'removed'\n    const invalidWindows = Object.keys(this.windows).filter(\n      (key) =>\n        this.removedFromSideBarIds.has(key) && this.windows[key].isVisible\n    );\n    if (invalidWindows.length > 0) {\n      throw new Error(\n        `Invalid ToolWindowsState. The following windows are set as visible but are removed from the sidebar: ${invalidWindows}`\n      );\n    }\n  }\n\n  hide(targetKey: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow, key) =>\n      key === targetKey\n        ? {\n            ...toolWindow,\n            isVisible: false,\n          }\n        : toolWindow\n    );\n  }\n  hideAll(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) =>\n        getViewModeType(toolWindow.viewMode) === \"float\"\n          ? toolWindow\n          : {\n              ...toolWindow,\n              isVisible: false,\n            },\n      { layoutToRestore: this.windows }\n    );\n  }\n\n  /**\n   * Restores windows to the state before hideAll.\n   */\n  restoreWindows(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) => this.layoutToRestore[key] || toolWindow\n    );\n  }\n\n  lastFocused(key: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow) => toolWindow, {\n      lastFocusedKey: key,\n    });\n  }\n\n  show(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const closableViewModes: ViewMode[] = [];\n    if (target.viewMode === \"undock\") {\n      closableViewModes.push(\"undock\");\n    } else if (isDocked(target)) {\n      closableViewModes.push(\"docked_unpinned\", \"docked_pinned\", \"undock\");\n    }\n    return this.mapWindows(\n      (toolWindow, key) => {\n        if (key === targetKey) {\n          return {\n            ...toolWindow,\n            isVisible: true,\n          };\n        }\n        if (\n          toolWindow.isVisible &&\n          areInSameSection(target, toolWindow) &&\n          closableViewModes.includes(toolWindow.viewMode)\n        ) {\n          return { ...toolWindow, isVisible: false };\n        }\n        return toolWindow;\n      },\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds].filter(\n          (key) => key !== targetKey\n        ),\n      }\n    );\n  }\n\n  toggle(targetKey: Key): ToolWindowsState {\n    return this.windows[targetKey]?.isVisible\n      ? this.hide(targetKey)\n      : this.show(targetKey);\n  }\n\n  blur(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target || !isAutoHide(target)) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  // TODO: initiate floatingBound when changing viewMode to float or window and there is no previous floatingBound\n  changeViewMode(targetKey: Key, viewMode: ViewMode): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          viewMode,\n        };\n      }\n      const viewModeType = getViewModeType(toolWindow.viewMode);\n      if (\n        toolWindow.isVisible &&\n        viewModeType !== \"float\" &&\n        areInSameSection(toolWindow, target) &&\n        viewModeType === getViewModeType(viewMode)\n      ) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  move(targetKey: Key, index: number): ToolWindowsState;\n  move(targetKey: Key, side: SideInfo, index?: number): ToolWindowsState;\n  move(\n    targetKey: Key,\n    sideOrIndex: SideInfo | number,\n    index?: number\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const targetSide = typeof sideOrIndex === \"object\" ? sideOrIndex : target;\n    const targetIndex = typeof sideOrIndex === \"number\" ? sideOrIndex : index;\n    const targetSideWindows = Object.entries(this.windows).filter(([, value]) =>\n      areInSameSection(targetSide, value)\n    );\n    const indexInTargetSide = targetSideWindows.findIndex(\n      ([, window]) => window === target\n    );\n    const sortedTargetWindows: Array<[Key, ToolWindowState]> =\n      indexInTargetSide < 0\n        ? insert(\n            targetIndex ?? -1,\n            [targetKey, { ...target, ...targetSide }],\n            targetSideWindows\n          )\n        : move(\n            indexInTargetSide,\n            targetIndex ?? indexInTargetSide,\n            targetSideWindows\n          );\n    const newTargetSideWindows = fromPairs(\n      sortedTargetWindows.map(([key, value], index) => {\n        let newValue = value;\n        if (value.order !== index) {\n          newValue = { ...value, order: index };\n        }\n        const targetViewMode = getViewModeType(target.viewMode);\n        if (\n          key !== targetKey &&\n          target.isVisible &&\n          value.isVisible &&\n          targetViewMode !== \"float\" &&\n          getViewModeType(value.viewMode) === targetViewMode\n        ) {\n          newValue = { ...value, isVisible: false };\n        }\n        return [`${key}`, newValue];\n      })\n    );\n    return this.mapWindows((value, key) => newTargetSideWindows[key] || value);\n  }\n\n  stretchWidth(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"width\");\n  }\n\n  stretchHeight(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"height\");\n  }\n\n  setFloatingBound(\n    targetKey: Key,\n    floatingBounds: WindowBounds\n  ): ToolWindowsState {\n    return this.update(targetKey, \"floatingBounds\", floatingBounds);\n  }\n\n  removeFromSidebar(targetKey: Key): ToolWindowsState {\n    return this.mapWindows(\n      (state, key) =>\n        key === targetKey\n          ? {\n              ...state,\n              isVisible: false,\n            }\n          : state,\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds, targetKey],\n      }\n    );\n  }\n\n  mapWindows(\n    mapFn: (toolWindow: ToolWindowState, key: string) => ToolWindowState,\n    options: ConstructorParameters<typeof ToolWindowsState>[1] = {}\n  ) {\n    return new ToolWindowsState(mapObjIndexed(mapFn, this.windows), {\n      lastFocusedKey: this.lastFocusedKey,\n      layoutToRestore: this.layoutToRestore,\n      removedFromSideBarIds: this.removedFromSideBarIds,\n      ...options,\n    });\n  }\n\n  private update<K extends keyof ToolWindowState>(\n    targetKey: Key,\n    key: K,\n    value: ToolWindowState[K]\n  ) {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((window) => {\n      if (window === target) {\n        return {\n          ...window,\n          [key]: value,\n        };\n      }\n      return window;\n    });\n  }\n\n  private stretch(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number },\n    property: \"width\" | \"height\"\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const viewModeType = getViewModeType(target.viewMode);\n    if (viewModeType === \"float\") {\n      return this.mapWindows((window) => {\n        if (window === target) {\n          const currentFloatingBound = window.floatingBounds!;\n          return {\n            ...window,\n            floatingBounds: {\n              ...currentFloatingBound,\n              [property]: currentFloatingBound[property] + value,\n            },\n          };\n        }\n        return window;\n      });\n    }\n    const expectedProperty = isHorizontalToolWindow(target.anchor)\n      ? \"height\"\n      : \"width\";\n    if (expectedProperty !== property) {\n      return this;\n    }\n    const containerSize = containerBounds[property];\n    const newValue = containerSize * target.weight + value;\n    const isNewValueValid = clamp(0, containerSize, newValue) === newValue;\n    if (isNewValueValid) {\n      if (viewModeType === \"docked\") {\n        return this.resizeDock(target.anchor, newValue, containerBounds);\n      } else {\n        return this.resizeUndock(target.anchor, newValue, containerBounds);\n      }\n    }\n    return this;\n  }\n\n  resizeDock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(true, anchor, size, containerBounds);\n  }\n\n  resizeUndock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(false, anchor, size, containerBounds);\n  }\n\n  resizeDockSplitView(anchor: Anchor, weight: number): ToolWindowsState {\n    return this.mapWindows((window) => {\n      if (window.anchor === anchor && window.isVisible && isDocked(window)) {\n        return {\n          ...window,\n          sideWeight: window.isSplit ? weight : 1 - weight,\n        };\n      }\n      return window;\n    });\n  }\n\n  private resizeSide(\n    dock: boolean,\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.mapWindows((window) => {\n      const isInResizingView = dock\n        ? isDocked(window)\n        : window.viewMode === \"undock\";\n      if (window.anchor === anchor && isInResizingView && window.isVisible) {\n        const containerSize = !isHorizontalToolWindow(anchor)\n          ? containerBounds.width\n          : containerBounds.height;\n        return {\n          ...window,\n          weight: size / containerSize,\n        };\n      }\n      return window;\n    });\n  }\n}\n\nexport const toolWindowState = ({\n  viewMode = \"docked_pinned\",\n  ...inputs\n}: Partial<ToolWindowState> = {}): ToolWindowState => ({\n  anchor: \"left\",\n  isSplit: false,\n  viewMode: viewMode,\n  order: 1,\n  weight: 0.2,\n  sideWeight: 0.5,\n  isVisible: false,\n  floatingBounds:\n    getViewModeType(viewMode) === \"float\"\n      ? {\n          left: 300,\n          top: 300,\n          width: 600,\n          height: 300,\n        }\n      : undefined,\n  ...inputs,\n});\n","export type Anchor = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport const getAnchorOrientation = (\n  anchor: Anchor\n): \"horizontal\" | \"vertical\" =>\n  isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\";\n\nexport const isHorizontalToolWindow = (anchor: Anchor) =>\n  anchor === \"top\" || anchor === \"bottom\";\n\nexport const theOtherSide = (anchor: Anchor) =>\n  ({\n    left: \"right\" as const,\n    right: \"left\" as const,\n    top: \"bottom\" as const,\n    bottom: \"top\" as const,\n  }[anchor]);\n","import React, { RefObject, useEffect, useRef, useState } from \"react\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport { useOverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\nimport { useFocusForwarder } from \"@intellij-platform/core/utils/useFocusForwarder\";\n\nexport function useToolWindow(\n  {\n    containerRef,\n    contentRef,\n    focusableContentRef,\n  }: {\n    containerRef: RefObject<HTMLElement>;\n    contentRef: RefObject<Element>;\n    focusableContentRef: RefObject<{ focus: () => void }>;\n  },\n  { onFocusChange }: { onFocusChange?: (focused: boolean) => void } = {}\n) {\n  const [contentHasFocus, setContentHasFocus] = useState(false);\n  /**\n   * NOTE: useFocusWithin form @react-aria/interactions (at least until 3.5.1) has a couple of problem, because of which\n   * we may need to implement our own version of it.\n   * - It doesn't play nice with FocusScope with `contain` set to true. When something is blurred, FocusScope prevents\n   *   that by restoring focus back immediately. but the blur event is already caught by useFocusWithin. One solution\n   *   would be to change useFocusWithin implementation to ignore these blur events that are immediately followed\n   *   by a focus event that keeps the focus in.\n   * - useFocusWithin has an inconsistent behaviour when it comes to Portals. Since it uses react props for handling\n   *   focus and blur, the [react tree determines event bubbling](https://reactjs.org/docs/portals.html#event-bubbling-through-portals),\n   *   which can be a very nice feature, when an overlay (rendered in a portal) grabs the focus, which should still\n   *   be seen as \"within\". But the problems is that the current implementation uses DOM `.contains(e.relatedTarget)`\n   *   method to determine if focus is no longer within. First of all, using react tree or dom tree to determine \"within\"\n   *   can be seen as an option perhaps. Secondly, it should be consistent on focus and blur.\n   *\n   *   Right now these problems are no big deal. but it may become an issue when portals are used within the content\n   *   of the tool window.\n   *\n   * NOTE: In the original implementation, when a heading toolbar button opens a menu, and focus goes to menu, the\n   * header loses the focus appearance, ant it relies only on content having the focus.\n   */\n  const { focusWithinProps: contentFocusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setContentHasFocus,\n  });\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: onFocusChange,\n  });\n\n  const { toolWindowProps: autoHideProps } = useAutoHide();\n\n  const { focusForwarderProps } = useFocusForwarder({\n    forwardFocus: focusableContentRef.current?.focus,\n    ignoreFocusedDescendant: true,\n  });\n\n  // If there is no focusable content rendered in the tool window, nothing will be autofocused. In that case\n  // we will focus the tool window container itself as a fallback.\n  useEffect(() => {\n    if (\n      !document.activeElement ||\n      !containerRef.current?.contains(document.activeElement)\n    ) {\n      containerRef.current?.focus();\n    }\n  }, []);\n\n  const { moveHandleProps } = useOverlayMoveHandle();\n\n  return {\n    contentHasFocus,\n    toolWindowProps: mergeProps(\n      focusForwarderProps,\n      focusWithinProps,\n      autoHideProps,\n      {\n        tabIndex: -1,\n      }\n    ),\n    toolWindowContentProps: contentFocusWithinProps,\n    toolWindowHeaderProps: moveHandleProps,\n  };\n}\n\n/**\n * Applies the auto hide behaviour of tool window based on view mode information and by handling focus and blur events,\n * on the root tool window element. Returns the necessary props that should be applied to the root tool window element.\n * The implementation is not perfect and may not 100% match the original Intellij Platform implementation.\n * If this focus based implementation for auto hide proves to be fragile and not good enough in future,\n * an alternative approach would be to move auto hide logic to the state management logic as much as possible,\n * and limit the focus based auto-hiding to only when the focus goes within the main content area. That should have\n * less focus-related edge cases.\n * TODO: auto hide behaviour should be moved to the core ToolWindows API. ToolWindows now renders a FocusScope and\n * handles focus events on any tool window, to track last focused tool window.\n */\nfunction useAutoHide() {\n  const { blur } = useToolWindowState();\n  const hideTimeoutId = useRef<number | null>(null);\n  const { focusWithinProps: windowFocusWithinProps } = useFocusWithin({\n    onBlurWithin: (e) => {\n      // setTimeout and windowHasFocusRef is to work around the problem with useFocusWithin, described above.\n      hideTimeoutId.current = window.setTimeout(() => {\n        // Sometimes when the element is blurred, the subsequent focus that is triggered by FocusScope to keep the focus\n        // is a little delayed and therefore after the timeout reaches. It seem to happen only when a non-focusable\n        // area is clicked. We mitigate it by ignoring blur events where nothing is focused. It's not a problem\n        // at least with `DefaultToolWindow` implementation that uses a FocusScope.\n        const isSomethingElseFocused = e.relatedTarget;\n        if (isSomethingElseFocused) {\n          blur();\n        }\n      });\n    },\n    onFocusWithin: () => {\n      if (hideTimeoutId.current !== null) {\n        clearTimeout(hideTimeoutId.current);\n        hideTimeoutId.current = null;\n      }\n    },\n  });\n  return {\n    toolWindowProps: windowFocusWithinProps,\n  };\n}\n","import React from \"react\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport {\n  useAction,\n  useActionGroup,\n} from \"@intellij-platform/core/ActionSystem\";\nimport {\n  ActionItem,\n  ActionsMenu,\n} from \"@intellij-platform/core/ActionSystem/components\";\nimport {\n  MOVE_TO_ACTION_GROUP_ID,\n  TOOL_WINDOW_RESIZE_ACTION_GROUP_ID,\n  VIEW_MODE_ACTION_GROUP_ID,\n  ViewModeToActionId,\n} from \"./useToolWindowActions\";\nimport {\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { MenuTriggerProps } from \"@intellij-platform/core/Menu\";\n\n/**\n * Tool window gear icon menu, with a set of default actions and some extra ones.\n * TODO: add support for extra actions when action system is progressed a little.\n */\nexport function ToolWindowSettingsIconMenu({\n  menuProps,\n}: {\n  menuProps: Parameters<MenuTriggerProps[\"renderMenu\"]>[0][\"menuProps\"];\n}) {\n  const { state } = useToolWindowState();\n\n  const viewModeActionGroup = useActionGroup(VIEW_MODE_ACTION_GROUP_ID);\n  const moveToActionGroup = useActionGroup(MOVE_TO_ACTION_GROUP_ID);\n  const resizeActions = useActionGroup(TOOL_WINDOW_RESIZE_ACTION_GROUP_ID);\n  const maximizeAction = useAction(MAXIMIZE_TOOL_WINDOW_ACTION_ID);\n  const removeFromSideBarAction = useAction(\n    REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID\n  );\n  if (\n    !viewModeActionGroup ||\n    !moveToActionGroup ||\n    !resizeActions ||\n    !maximizeAction ||\n    !removeFromSideBarAction\n  ) {\n    throw new Error(\n      \"[ToolWindowSettingsIconMenu]: can't find tool window actions.\"\n    );\n  }\n\n  const gearIconActions: Array<ActionItem> = [\n    viewModeActionGroup,\n    moveToActionGroup,\n    {\n      id: \"resize\",\n      title: \"Resize\",\n      menuPresentation: \"submenu\",\n      children: [...resizeActions.children, maximizeAction],\n    },\n    new DividerItem(),\n    removeFromSideBarAction,\n  ];\n  return (\n    <ActionsMenu\n      actions={gearIconActions}\n      selectedKeys={[ViewModeToActionId[state.viewMode]]}\n      {...menuProps}\n    />\n  );\n}\n","import React, { HTMLProps } from \"react\";\nimport { IconButton } from \"@intellij-platform/core/IconButton\";\nimport { Toolbar } from \"@intellij-platform/core/Toolbar/Toolbar\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { MenuTrigger } from \"@intellij-platform/core/Menu/MenuTrigger\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledHorizontalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme/Theme\";\nimport { ToolWindowSettingsIconMenu } from \"./ToolWindowSettingsIconMenu\";\nimport {\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { ActionButton } from \"@intellij-platform/core/ActionSystem/components\";\n\nexport interface ToolWindowHeaderProps\n  extends Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\"> {\n  contentHasFocus?: boolean;\n  additionalActions?: React.ReactNode;\n}\n\nconst StyledToolWindowHeader = styled.div<{ active: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: end; // to have the content overflow from right, as the toolwindow shrinks. That will keep the left-most buttons in the view\n  padding: 0 2px 0 4px;\n  overflow: hidden; // for the negative margin applied on StyledToolWindowHeaderActions\n  border-bottom: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Header.borderColor\" as UnknownThemeProp<\"ToolWindow.Header.borderColor\">\n      ) ||\n      theme.color(\"DefaultTabs.borderColor\") ||\n      theme.commonColors.contrastBorder};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\"ToolWindow.Header.background\") ||\n        theme.color(\n          \"ToolWindow.header.active.background\" as UnknownThemeProp<\"ToolWindow.header.active.background\">\n        ) ||\n        \"#E2E6EC\"\n      : theme.color(\"ToolWindow.Header.inactiveBackground\") ||\n        theme.color(\"ToolWindow.Header.background\") ||\n        \"#ECECEC\"};\n`;\n\nconst StyledToolWindowHeaderActions = styled.div`\n  margin-right: -4px;\n`;\n\nconst StyledToolWindowHeaderContent = styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n  overflow: hidden;\n`;\n\nexport const DefaultToolWindowHeader: React.FC<ToolWindowHeaderProps> = ({\n  children,\n  additionalActions,\n  contentHasFocus = false,\n  ...otherProps\n}) => {\n  return (\n    <StyledToolWindowHeader active={contentHasFocus} {...otherProps}>\n      <StyledToolWindowHeaderContent>{children}</StyledToolWindowHeaderContent>\n      <StyledToolWindowHeaderActions>\n        <Toolbar>\n          {additionalActions && (\n            <>\n              {additionalActions}\n              <StyledHorizontalSeparator />\n            </>\n          )}\n          <ActionButton actionId={DOCK_TOOL_WINDOW_ACTION_ID} />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => {\n              return <ToolWindowSettingsIconMenu menuProps={menuProps} />;\n            }}\n          >\n            {(props, ref) => (\n              <TooltipTrigger tooltip={<ActionTooltip actionName=\"Options\" />}>\n                <IconButton {...props} ref={ref}>\n                  <PlatformIcon icon=\"general/gearPlain\" />\n                </IconButton>\n              </TooltipTrigger>\n            )}\n          </MenuTrigger>\n          <ActionButton actionId={HIDE_ACTIVE_WINDOW_ACTION_ID} />\n        </Toolbar>\n      </StyledToolWindowHeaderActions>\n    </StyledToolWindowHeader>\n  );\n};\n","import React, { useContext, useMemo, useRef } from \"react\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  FocusScope,\n  FocusScopeRef,\n} from \"@intellij-platform/core/utils/FocusScope\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { useToolWindow } from \"./useToolWindow\";\nimport { DefaultToolWindowHeader } from \"./DefaultToolWindowHeader\";\nimport { useToolWindowActions } from \"./useToolWindowActions\";\n\nexport interface DefaultToolWindowProps extends DOMProps {\n  children?: React.ReactNode;\n  /**\n   * title to be shown on the left side of the tool window header.\n   */\n  headerContent?: React.ReactNode;\n  /**\n   * additional action buttons to be rendered before the default gear and hide buttons.\n   */\n  additionalActions?: React.ReactNode;\n  /**\n   * Actions to be provided in the tool window, in addition to the default tool window actions.\n   */\n  actions?: ActionDefinition[];\n  /**\n   * The title of main part of the tool windows component. Used in tool window actions.\n   * @default \"Editor\"\n   */\n  mainContentTitle?: string;\n  onFocusChange?: (focused: boolean) => void;\n}\n\nconst StyledToolWindowContainer = styled.div`\n  outline: none;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  flex: 1;\n`;\nconst StyledToolWindowContent = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\ninterface DefaultToolWindowContextObj {\n  hasFocus?: boolean;\n}\n\nconst DefaultToolWindowContext =\n  React.createContext<DefaultToolWindowContextObj>({\n    hasFocus: false,\n  });\n\nexport const useDefaultToolWindowContext = () =>\n  useContext(DefaultToolWindowContext);\n/**\n * Default component for rendering the content of a tool window. It supports a header and a scrollable area.\n * The header supports showing a content, and some default+custom actions on the right.\n *\n * @see MultiContentToolWindow\n *\n * Remaining features:\n * - Additional gear menu actions.\n *\n */\nexport const DefaultToolWindow: React.FC<DefaultToolWindowProps> = ({\n  headerContent,\n  children,\n  additionalActions,\n  onFocusChange,\n  actions,\n  mainContentTitle = \"Editor\",\n  ...otherProps\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const focusableContentRef = useRef<FocusScopeRef>(null);\n  const {\n    // NOTE: we might as well use :focus-within and target StyledToolWindowHeader to set the background, but it's not\n    // a clear improvement.\n    contentHasFocus,\n    toolWindowProps,\n    toolWindowContentProps,\n    toolWindowHeaderProps,\n  } = useToolWindow(\n    { containerRef, contentRef, focusableContentRef },\n    {\n      onFocusChange,\n    }\n  );\n\n  const defaultToolWindowContext = useMemo(\n    () => ({\n      hasFocus: contentHasFocus,\n    }),\n    [contentHasFocus]\n  );\n  const activeToolWindowActionGroup = useToolWindowActions({\n    mainContentTitle,\n  });\n  const allActions = [activeToolWindowActionGroup, ...(actions || [])];\n\n  return (\n    <ActionsProvider actions={allActions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledToolWindowContainer\n          {...mergeProps(\n            toolWindowProps,\n            shortcutHandlerProps,\n            filterDOMProps(otherProps)\n          )}\n          ref={containerRef}\n        >\n          <DefaultToolWindowContext.Provider value={defaultToolWindowContext}>\n            <DefaultToolWindowHeader\n              additionalActions={additionalActions}\n              contentHasFocus={contentHasFocus}\n              {...toolWindowHeaderProps}\n            >\n              {headerContent}\n            </DefaultToolWindowHeader>\n            <StyledToolWindowContent\n              ref={contentRef}\n              {...toolWindowContentProps}\n            >\n              {/**\n               * FIXME: adding `contain` prevents focus from moving to another focus scope both with mouse and keyboard.\n               * If we want to follow the Intellij Platform behaviour exactly, we need a kind of focus containment, where\n               * focus is trapped only for keyboard interaction, and user can still move focus by clicking another scope.\n               * Maybe a custom useFocusContainment hook and a separate option for activating it on our own FocusScope.\n               */}\n              <FocusScope ref={focusableContentRef} autoFocus>\n                {children}\n              </FocusScope>\n            </StyledToolWindowContent>\n          </DefaultToolWindowContext.Provider>\n        </StyledToolWindowContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n","import React from \"react\";\nimport { Shortcut, useAction } from \"@intellij-platform/core/ActionSystem\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { getActivateToolWindowActionId } from \"./useToolWindowsActions\";\nimport styled from \"styled-components\";\n\nconst getToolWindowNumberFromShortcut = (shortcut: Shortcut): number | null => {\n  const num =\n    shortcut.type === \"keyboard\" &&\n    shortcut.firstKeyStroke.modifiers?.length === 1 &&\n    [\"Alt\", \"Meta\", \"Control\"].includes(shortcut.firstKeyStroke.modifiers[0]) &&\n    shortcut.firstKeyStroke.code.match(/^(Digit|Numpad)([0-9])$/)?.[2];\n  if (num) {\n    return parseInt(num);\n  }\n  return null;\n};\n\nconst StyledWrapper = styled.span`\n  display: flex;\n`;\n\n/**\n * Default UI for the toolbar button (aka. stripe button) of the tool window.\n * - Renders the title and icon for the tool window\n * - Optionally shows the number before the title, if a numeric shortcut is set for the corresponding ActivateToolWindow\n *   action, in the currently applied keymap.\n * - Adds an Action Tooltip\n */\nexport const DefaultToolWindowToolbarButton = ({\n  id,\n  title,\n  icon,\n  showNumber = true,\n}: {\n  id: React.Key;\n  title: string;\n  icon: React.ReactNode;\n  showNumber?: boolean;\n}) => {\n  const action = useAction(getActivateToolWindowActionId(`${id}`));\n\n  const number = action?.shortcuts\n    ?.map(getToolWindowNumberFromShortcut)\n    .find(Number.isInteger);\n  return (\n    <TooltipTrigger\n      tooltip={<ActionTooltip actionName={title} shortcut={action?.shortcut} />}\n    >\n      <StyledWrapper>\n        {icon}\n        &nbsp;\n        {number != null && showNumber ? (\n          <>\n            <u>{number}</u>:&nbsp;\n          </>\n        ) : null}\n        {title}\n      </StyledWrapper>\n    </TooltipTrigger>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { indexBy } from \"ramda\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  ToolWindowRefValue,\n  ToolWindows,\n  ToolWindowsProps,\n} from \"@intellij-platform/core/ToolWindows\";\nimport { useToolWindowsActions } from \"./useToolWindowsActions\";\nimport { DefaultToolWindowToolbarButton } from \"./DefaultToolWindowToolbarButton\";\nimport { ActionsProvider } from \"@intellij-platform/core/ActionSystem\";\n\ninterface DefaultToolWindow {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactNode;\n}\n\n/**\n * A wrapper around ToolWindows, which provides default actions. It also expects windows to have a `title` and an `icon`\n * instead of more generic `toolbarButton`. The `title` and `icon` are then used in toolbar button, and also in the\n * actions that are dynamically created for each window to toggle/focus the tool window.\n */\nexport const DefaultToolWindows = React.forwardRef(function DefaultToolWindows(\n  {\n    windows: toolWindows,\n    toolWindowsState,\n    showNumbers,\n    ...props\n  }: Omit<ToolWindowsProps, \"windows\"> & {\n    windows: DefaultToolWindow[];\n    showNumbers?: boolean;\n  },\n  forwardedRef: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const toolWindowsRef = useObjectRef(forwardedRef);\n  const windowById = indexBy(({ id }) => id, toolWindows);\n  const actions = useToolWindowsActions({\n    toolWindowsRef,\n    toolWindowsState,\n    getPresentation: (id) => windowById[id],\n  });\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <ToolWindows\n          {...props}\n          ref={toolWindowsRef}\n          toolWindowsState={toolWindowsState}\n          windows={toolWindows.map(({ id, icon, content, title }) => ({\n            id,\n            toolbarButton: (\n              <DefaultToolWindowToolbarButton\n                id={id}\n                icon={icon}\n                title={title}\n                showNumber={showNumbers}\n              />\n            ),\n            content,\n          }))}\n          containerProps={mergeProps(\n            props.containerProps || {},\n            shortcutHandlerProps\n          )}\n        />\n      )}\n    </ActionsProvider>\n  );\n});\n","import React, { Key, useEffect, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { DefaultToolWindow, DefaultToolWindowProps } from \"./DefaultToolWindow\";\nimport { TabItem } from \"../Tabs/TabItem\";\nimport { usePrevious } from \"../utils/usePrevious\";\nimport { ToolWindowTabs } from \"../Tabs/ToolWindowTabs/ToolWindowTabs\";\n\nexport interface MultiContentToolWindowProps\n  extends Pick<DefaultToolWindowProps, \"additionalActions\"> {\n  /**\n   * List of contents that will be accessible with a list of grouped or ungrouped tabs in the tool window header.\n   */\n  children:\n    | React.ReactElement<MultiContentToolWindowContentProps>[]\n    | React.ReactElement<MultiContentToolWindowContentProps>;\n  /**\n   * Key of currently active content\n   */\n  activeKey?: Key;\n  defaultActiveKey?: Key;\n  onActiveKeyChange?: (key: Key) => void;\n  /**\n   * If true, it groups tabs in a dropdown instead.\n   *\n   * @default false\n   */\n  groupTabs?: boolean;\n  /**\n   * The content shown as the title of the tool window, before content switcher (tabs or dropdown).\n   * For more control over header content, you can pass a function which accepts rendered content switcher,\n   * and then you can compose it with other content as you wish. Use case examples of function variant:\n   * - You want to render a title before the content switcher, and something after the tabs. Like a \"+\" button in\n   *   terminal.\n   * - You want to conditionally move inner-content header up to the tool window header, if there is only one tab. In\n   *   that case you don't need to render the content switcher at all. An example is the new design in the \"Run\"\n   *   tool window.\n   */\n  headerContent?:\n    | React.ReactNode\n    | ((props: { renderedViewSwitcher: React.ReactNode }) => React.ReactNode);\n}\n\n/**\n * Implemented on top of DefaultToolWindow, allows for multiple tabbed content within a tool window.\n * Remaining features:\n * - Although trivial, group tabs action in tool window header gear icon is intentionally left unimplemented for now,\n *   until an increment on action system is done.\n * - Grouped mode is not implemented currently, as we don't have a dropdown component. Though it seems it's just a\n *   MenuTrigger and some trigger with a arrow icon.\n */\nexport const MultiViewToolWindow = ({\n  groupTabs,\n  children,\n  headerContent,\n  ...props\n}: MultiContentToolWindowProps) => {\n  const [isToolWindowFocused, setToolWindowFocused] = useState(false);\n  const [activeKey, setActiveKey] = useControlledState(\n    props.activeKey!,\n    props.defaultActiveKey!,\n    props.onActiveKeyChange!\n  );\n  const contents = React.Children.toArray(children)\n    .filter(\n      (\n        child\n      ): child is React.ReactElement<MultiContentToolWindowContentProps> => {\n        const validChild =\n          React.isValidElement(child) &&\n          child.type === MultiContentToolWindowContent;\n        if (!validChild) {\n          // FIXME: only warn in dev mode\n          console.warn(\n            \"You are not supposed to render anything but MultiContentToolWindowContent inside MultiViewToolWindow. Rendered: \",\n            child\n          );\n        }\n        return validChild;\n      }\n    )\n    // The following map is because of what React.Children.toArray does to keys: https://stackoverflow.com/q/33791401/1493081\n    // It doesn't look like a good idea since and there might be better ways to fix this, or at least make sure it would\n    // work in all cases. FIXME\n    .map((content) => ({ ...content, key: `${content.key}`.slice(2) as Key }));\n  const renderContentSwitcher = () => {\n    if (groupTabs) {\n      console.error(\n        \"groupTab is not supported yet in MultiViewToolWindow. Will fallback to ungrouped tabs\"\n      );\n    }\n    return (\n      <ToolWindowTabs\n        noBorders\n        items={contents}\n        active={isToolWindowFocused}\n        selectedKey={activeKey}\n        onSelectionChange={setActiveKey}\n      >\n        {(item) => <TabItem key={item.key}>{item.props.tabContent}</TabItem>}\n      </ToolWindowTabs>\n    );\n  };\n  const renderedViewSwitcher = renderContentSwitcher();\n\n  // We set the active key if it's not set or is invalid. A common scenario is when tabs are closable, and when the\n  // active tab is closed. You would always want to previous tab to get activated in such cases, instead of the first\n  // one. By having the logic here, there is no need to repeat the same logic in each use case. Although, it can also\n  // be moved into a state management utility for tabs, maybe in the future.\n\n  const keys = contents.map(({ key }) => key);\n  const previousKeys = usePrevious(keys);\n  useEffect(() => {\n    if (!keys.includes(activeKey)) {\n      const newActiveKey = keys[previousKeys.indexOf(activeKey) - 1] ?? keys[0];\n      if (newActiveKey != undefined) {\n        setActiveKey(newActiveKey);\n      }\n    }\n  });\n\n  const activeContent = contents.find(\n    (content) => activeKey == undefined || activeKey === content.key\n  );\n  return (\n    <DefaultToolWindow\n      onFocusChange={setToolWindowFocused}\n      headerContent={\n        typeof headerContent === \"function\" ? (\n          headerContent({ renderedViewSwitcher })\n        ) : (\n          <>\n            {headerContent}\n            {renderedViewSwitcher}\n          </>\n        )\n      }\n      additionalActions={props.additionalActions}\n    >\n      {activeContent?.props.children}\n    </DefaultToolWindow>\n  );\n};\n\nexport interface MultiContentToolWindowContentProps {\n  key: Key;\n  /**\n   * Used in the corresponding tab.\n   */\n  tabContent: React.ReactNode;\n\n  children: React.ReactNode;\n}\n\nconst MultiContentToolWindowContent =\n  ({}: MultiContentToolWindowContentProps) => {\n    throw new Error(\n      \"MultiContentToolWindowContent is not meant to be rendered directly. You should only use it in MultiViewToolWindow\"\n    );\n  };\n\nMultiViewToolWindow.View = MultiContentToolWindowContent;\n","export const HIDE_ALL_WINDOWS_ACTION_ID = \"HideAllWindows\";\nexport const JUMP_TO_LAST_WINDOW_ACTION_ID = \"JumpToLastWindow\";\nexport const HIDE_ACTIVE_WINDOW_ACTION_ID = \"HideActiveWindow\";\nexport const MAXIMIZE_TOOL_WINDOW_ACTION_ID = \"MaximizeToolWindow\";\nexport const DOCK_TOOL_WINDOW_ACTION_ID = \"DockToolWindow\";\nexport const RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID = \"ResizeToolWindowRight\";\nexport const RESIZE_TOOL_WINDOW_LEFT_ACTION_ID = \"ResizeToolWindowLeft\";\nexport const RESIZE_TOOL_WINDOW_TOP_ACTION_ID = \"ResizeToolWindowTop\";\nexport const RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID = \"ResizeToolWindowBottom\";\nexport const DOCK_PINNED_MODE_ACTION_ID = \"DockPinnedMode\";\nexport const DOCK_UNPINNED_MODE_ACTION_ID = \"DockUnpinnedMode\";\nexport const UNDOCK_MODE_ACTION_ID = \"UndockMode\";\nexport const FLOAT_MODE_ACTION_ID = \"FloatMode\";\nexport const WINDOW_MODE_ACTION_ID = \"WindowMode\";\nexport const FOCUS_EDITOR_ACTION_ID = \"FocusEditor\";\nexport const REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID =\n  \"RemoveToolWindowFromSidebar\"; // doesn't show up in keymap. Not sure what the id is in the original impl.\n","import React from \"react\";\nimport {\n  Anchor,\n  isHorizontalToolWindow,\n  useToolWindowState,\n  ViewMode,\n} from \"@intellij-platform/core/ToolWindows\";\nimport {\n  ActionDefinition,\n  ActionGroupDefinition,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport {\n  DOCK_PINNED_MODE_ACTION_ID,\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  DOCK_UNPINNED_MODE_ACTION_ID,\n  FLOAT_MODE_ACTION_ID,\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  UNDOCK_MODE_ACTION_ID,\n  WINDOW_MODE_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { useCreateDefaultActionGroup } from \"@intellij-platform/core/ActionSystem/components\";\n\n// Resize steps in Intellij Platform is calculated based on the size of a \"W\" character and some\n// configuration (ide.windowSystem.hScrollChars). Although it's technically feasible, it seems not necessary\nconst HEIGHT_RESIZE_STEP = 16 * 5;\nconst WIDTH_RESIZE_STEP = 13 * 5;\n\nexport const anchors: Array<{\n  anchor: Anchor;\n  isSplit: boolean;\n  id: string;\n}> = [\n  { id: \"moveToLeftTop\", anchor: \"left\", isSplit: false },\n  { id: \"moveToLeftBottom\", anchor: \"left\", isSplit: true },\n  { id: \"moveToBottomLeft\", anchor: \"bottom\", isSplit: false },\n  { id: \"moveToBottomRight\", anchor: \"bottom\", isSplit: true },\n  { id: \"moveToRightTop\", anchor: \"right\", isSplit: true },\n  { id: \"moveToRightBottom\", anchor: \"right\", isSplit: false },\n  { id: \"moveToTopRight\", anchor: \"top\", isSplit: true },\n  { id: \"moveToTopLeft\", anchor: \"top\", isSplit: false },\n];\n\nconst getAnchorName = ({\n  anchor,\n  isSplit,\n}: {\n  anchor: Anchor;\n  isSplit: boolean;\n}) =>\n  `${anchor[0].toUpperCase()}${anchor.slice(1)} ${\n    isHorizontalToolWindow(anchor)\n      ? isSplit\n        ? \"Right\"\n        : \"Left\"\n      : isSplit\n      ? \"Bottom\"\n      : \"Top\"\n  }`;\n\nexport const ViewModeToActionId: Record<ViewMode, string> = {\n  docked_pinned: DOCK_PINNED_MODE_ACTION_ID,\n  docked_unpinned: DOCK_UNPINNED_MODE_ACTION_ID,\n  undock: UNDOCK_MODE_ACTION_ID,\n  float: FLOAT_MODE_ACTION_ID,\n  window: WINDOW_MODE_ACTION_ID,\n};\n\nexport const VIEW_MODE_ACTION_GROUP_ID = \"TW.ViewModeGroup\";\nexport const MOVE_TO_ACTION_GROUP_ID = \"TW.MoveToGroup\";\nexport const TOOL_WINDOW_RESIZE_ACTION_GROUP_ID = \"ResizeToolWindowGroup\";\n\nexport function useToolWindowActions({\n  mainContentTitle,\n}: {\n  mainContentTitle: string;\n}): ActionGroupDefinition {\n  const {\n    stretchWidth,\n    stretchHeight,\n    changeViewMode,\n    moveToSide,\n    focusMainContent,\n    hide,\n    remove,\n    state,\n  } = useToolWindowState();\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n\n  const actions: ActionDefinition[] = [];\n  if (!state) {\n    // FIXME: when window is removed, a last render happens with the new ToolWindowsState, which doesn't have state\n    //  for the removed tool window. Need to understand why that happens.\n    return createDefaultActionGroup({\n      id: \"ActiveToolwindowGroup\",\n      title: \"Active Tool Window\",\n      children: [],\n    });\n  }\n  const viewModeActionGroup = createDefaultActionGroup({\n    id: VIEW_MODE_ACTION_GROUP_ID,\n    title: \"View Mode\",\n    children: [\n      {\n        id: DOCK_PINNED_MODE_ACTION_ID,\n        title: \"Dock Pinned\",\n        actionPerformed: () => {\n          changeViewMode(\"docked_pinned\");\n        },\n      },\n      {\n        id: DOCK_UNPINNED_MODE_ACTION_ID,\n        title: \"Dock Unpinned\",\n        actionPerformed: () => {\n          changeViewMode(\"docked_unpinned\");\n        },\n      },\n      {\n        id: UNDOCK_MODE_ACTION_ID,\n        title: \"Undock\",\n        actionPerformed: () => {\n          changeViewMode(\"undock\");\n        },\n      },\n      {\n        id: FLOAT_MODE_ACTION_ID,\n        title: \"Float\",\n        actionPerformed: () => {\n          changeViewMode(\"float\");\n        },\n      },\n      {\n        id: WINDOW_MODE_ACTION_ID,\n        title: \"Window\",\n        actionPerformed: () => {\n          changeViewMode(\"window\");\n        },\n      },\n    ],\n  });\n  const moveToActionGroup = createDefaultActionGroup({\n    id: MOVE_TO_ACTION_GROUP_ID,\n    title: \"Move to\",\n    children: anchors.map(\n      (anchor): ActionDefinition => ({\n        id: `TW.MoveTo.${anchor.id}`,\n        title: getAnchorName(anchor),\n        icon: <PlatformIcon icon={`actions/${anchor.id}`} />,\n        isDisabled:\n          state.anchor === anchor.anchor && state.isSplit === anchor.isSplit,\n        actionPerformed: () => {\n          moveToSide(anchor);\n        },\n      })\n    ),\n  });\n  actions.push(\n    {\n      id: FOCUS_EDITOR_ACTION_ID,\n      title: `Focus ${mainContentTitle}`, // in intellij it says \"Focus Editor\" but it's not generic enough.\n      actionPerformed: () => {\n        focusMainContent();\n      },\n    },\n    {\n      id: HIDE_ACTIVE_WINDOW_ACTION_ID,\n      title: \"Hide\",\n      icon: <PlatformIcon icon=\"general/hideToolWindow\" />,\n      actionPerformed: () => {\n        hide();\n      },\n    },\n    {\n      id: MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n      title: \"Maximize Tool Window\", // Should be \"Restore Tool Window Size if the window is currently maximized\n      actionPerformed: () => {\n        // TODO(release): either remove the action or implement it\n        alert(\"Not implemented\");\n      },\n    },\n    {\n      id: REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n      title: \"Remove from Sidebar\",\n      actionPerformed: () => {\n        remove();\n      },\n    },\n    viewModeActionGroup,\n    moveToActionGroup\n  );\n  if (state.viewMode === \"float\") {\n    actions.push({\n      id: DOCK_TOOL_WINDOW_ACTION_ID,\n      title: \"Dock\",\n      icon: (\n        <PlatformIcon\n          icon={`actions/${\n            anchors.find(\n              ({ anchor, isSplit }) =>\n                anchor === state.anchor && isSplit === state.isSplit\n            )?.id\n          }`}\n        />\n      ),\n      actionPerformed: () => {\n        changeViewMode(\"docked_pinned\");\n      },\n    });\n  }\n  if (state.viewMode !== \"float\" && state.viewMode !== \"window\") {\n    const resizeGroup = createDefaultActionGroup({\n      id: TOOL_WINDOW_RESIZE_ACTION_GROUP_ID,\n      title: \"Resize\",\n      children: [],\n    });\n    if (isHorizontalToolWindow(state.anchor)) {\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n        title: \"Stretch to bottom\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"bottom\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      });\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n        title: \"Stretch to top\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"top\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      });\n    } else {\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n        title: \"Stretch to left\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"left\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      });\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n        title: \"Stretch to right\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"right\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      });\n    }\n    actions.push(resizeGroup);\n  }\n  return createDefaultActionGroup({\n    id: \"ActiveToolwindowGroup\",\n    title: \"Active Tool Window\",\n    children: actions,\n  });\n}\n","import React from \"react\";\nimport { ActionDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport {\n  getViewModeType,\n  ToolWindowRefValue,\n  ToolWindowsState,\n} from \"@intellij-platform/core/ToolWindows\";\nimport {\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\n\ninterface DefaultToolWindowActionsProps {\n  toolWindowsState: Readonly<ToolWindowsState>;\n  toolWindowsRef: React.RefObject<ToolWindowRefValue>;\n  /**\n   * Used when creating ActivateToolWindow action for each tool window.\n   */\n  getPresentation?: (key: React.Key) =>\n    | {\n        title: string;\n        icon: React.ReactNode;\n      }\n    | undefined;\n}\n\nexport const getActivateToolWindowActionId = (id: string) =>\n  `Activate${id.replace(\" \", \"\")}Window`;\n\n/**\n * Provides default tool windows actions:\n * - Hide all tool windows\n * - Activate{id}Window action for each window\n * - Jump to last tool window\n *\n * @see also {@link DefaultToolWindows}\n */\nexport function useToolWindowsActions({\n  toolWindowsState,\n  toolWindowsRef,\n  getPresentation,\n}: DefaultToolWindowActionsProps) {\n  const isAnySideWindowWindowOpen = (state: Readonly<ToolWindowsState>) =>\n    Object.values(state.windows).some(\n      ({ isVisible, viewMode }) =>\n        isVisible && getViewModeType(viewMode) !== \"float\"\n    );\n  const windowIds = Object.keys(toolWindowsState.windows).map(\n    (key) => `${key}`\n  );\n  const activateToolWindowActions = windowIds.map(\n    (id: string, index): ActionDefinition => {\n      const { title, icon } = getPresentation?.(id) || {};\n      return {\n        id: getActivateToolWindowActionId(id),\n        title: title || `${getOrdinal(index)} window`,\n        icon,\n        description: `Activate ${title || getOrdinal(index)} window`,\n        actionPerformed: () => {\n          if (\n            toolWindowsState.windows[id]?.isVisible &&\n            !toolWindowsRef.current?.hasFocus(id)\n          ) {\n            toolWindowsRef.current?.focus(id);\n          } else {\n            toolWindowsRef.current?.changeState((state) => state.toggle(id));\n          }\n        },\n      };\n    }\n  );\n  const actions: ActionDefinition[] = [\n    ...activateToolWindowActions,\n    {\n      id: HIDE_ALL_WINDOWS_ACTION_ID,\n      title: isAnySideWindowWindowOpen(toolWindowsState)\n        ? \"Hide All Windows\"\n        : \"Restore windows\",\n      actionPerformed: () => {\n        toolWindowsRef.current?.changeState((state) => {\n          if (isAnySideWindowWindowOpen(state)) {\n            return state.hideAll();\n          } else {\n            return state.restoreWindows();\n          }\n        });\n        // Because windows have autofocus behaviour, a timeout is set. Not sure how reliable it is.\n        // TODO: replace effect-based auto focus behaviour with something better, maybe controlled by ToolWindows\n        //  component, and when a tool window is opened.\n        setTimeout(() => {\n          toolWindowsRef.current?.focusMainContent();\n        });\n      },\n    },\n    {\n      id: JUMP_TO_LAST_WINDOW_ACTION_ID,\n      title: \"Jump to Last Tool Window\",\n      isDisabled: toolWindowsState.lastFocusedKey == null,\n      actionPerformed: () => {\n        toolWindowsRef.current?.focusLastActiveWindow();\n      },\n    },\n  ];\n  return actions;\n}\n\nfunction getOrdinal(n: number) {\n  let ord = [\"st\", \"nd\", \"rd\"];\n  let exceptions = [11, 12, 13];\n  let nth =\n    ord[(n % 10) - 1] == undefined || exceptions.includes(n % 100)\n      ? \"th\"\n      : ord[(n % 10) - 1];\n  return n + nth;\n}\n","import React, {\n  CSSProperties,\n  MouseEvent,\n  useContext,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { styled, css } from \"../styled\";\nimport {\n  StyledHorizontalSeparator,\n  StyledSeparator,\n  StyledVerticalSeparator,\n} from \"../StyledSeparator\";\nimport { useOverflowObserver } from \"@intellij-platform/core/utils/overflow-utils/useOverflowObserver\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { Overlay, useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\ntype ToolbarBorderProp =\n  | true\n  | \"horizontal\"\n  | \"vertical\"\n  | \"bottom\"\n  | \"top\"\n  | \"left\"\n  | \"right\";\n\nexport type ToolbarProps = {\n  children: React.ReactNode;\n  orientation?: \"vertical\" | \"horizontal\";\n  border?: ToolbarBorderProp;\n  style?: CSSProperties;\n  className?: string;\n} & (\n  | {\n      orientation: \"vertical\";\n    }\n  | {\n      orientation?: \"horizontal\";\n      /**\n       * Defines how the toolbar should handle its children when there is not enough room\n       * to fit all:\n       * - popup: the overflowed children will be hidden behind a show more arrow icon that\n       *   shows the rest of the items in a popup.\n       * - wrap: children will be wrapped so that they fit the available width/height\n       **/\n      overflowBehavior?: \"popup\" | \"wrap\";\n    }\n);\n\nconst borderStyle = ({ border }: { border?: ToolbarBorderProp }) =>\n  border &&\n  css`\n    border-style: solid;\n    border-color: ${({ theme }) => theme.commonColors.borderColor};\n    border-width: ${border === true ? \"1px\" : borderPropToCssProp[border]};\n  `;\n\nconst StyledToolbar = styled.div<{\n  border?: ToolbarBorderProp;\n}>`\n  display: inline-flex;\n  box-sizing: border-box;\n  overflow: hidden;\n  // NOTE: in the original implementation, there is no empty space between buttons, but buttons have kind of an\n  // invisible left padding, which is mouse-intractable, but doesn't visually seem a part of the button.\n  // Although implementable, it didn't seem necessary to follow the exact same thing. Margin should be fine.\n  gap: 4px;\n  ${borderStyle}\n  ${StyledSeparator}:first-child {\n    display: none;\n  }\n  ${StyledSeparator}:last-child {\n    display: none;\n  }\n`;\n\nconst borderPropToCssProp: Record<\n  Exclude<ToolbarBorderProp, boolean>,\n  CSSProperties[\"borderWidth\"]\n> = {\n  top: \"1px 0 0 0\",\n  bottom: \"0 0 1px 0\",\n  right: \"0 1px 0 0\",\n  left: \"0 0 0 1px\",\n  horizontal: \"0 1px\",\n  vertical: \"1px 0\",\n};\n\nconst SIDE_PADDING = 3;\nconst END_PADDING = 4;\n\nconst StyledShowMoreButton = styled.button`\n  all: unset;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  ${borderStyle};\n`;\n\nconst StyledHorizontalToolbar = styled(StyledToolbar)`\n  padding: ${SIDE_PADDING}px ${END_PADDING}px;\n  max-width: 100%;\n  /*noinspection CssInvalidPropertyValue*/\n  max-width: -webkit-fill-available;\n  ${StyledHorizontalSeparator} {\n    margin: 1px 0;\n  }\n  ${StyledShowMoreButton} {\n    margin-right: -${END_PADDING}px;\n  }\n`;\n\nconst StyledVerticalToolbar = styled(StyledToolbar)`\n  flex-direction: column;\n  max-height: 100%;\n  /*noinspection CssInvalidPropertyValue*/\n  max-height: -webkit-fill-available;\n  padding: ${END_PADDING}px ${SIDE_PADDING}px;\n  ${StyledVerticalSeparator} {\n    margin: 0 1px;\n  }\n  ${StyledShowMoreButton} {\n    margin-bottom: -${END_PADDING}px;\n  }\n`;\n\nconst StyledToolbarContent = styled.div<{\n  shouldWrap?: boolean;\n  firstOverflowedIndex: number;\n}>`\n  box-sizing: inherit;\n  display: inherit;\n  flex-direction: inherit;\n  flex-wrap: ${({ shouldWrap }) => (shouldWrap ? \"wrap\" : \"nowrap\")};\n  gap: inherit;\n  max-height: inherit;\n  max-width: inherit;\n  min-height: 0;\n  min-width: 0;\n\n  ${({ firstOverflowedIndex }) =>\n    /**\n     * The hidden styles should be in a way that the hidden element:\n     * - occupies its space in the document layout.\n     * - doesn't capture mouse events. (e.g. a half-overflowing hidden element shouldn't show tooltip)\n     * - remains accessible to screen readers.\n     */\n    css`\n      > ${firstOverflowedIndex === 0\n          ? \"*\"\n          : `:nth-child(${firstOverflowedIndex}) ~ *`} {\n        opacity: 0 !important;\n        pointer-events: none !important;\n      }\n    `}\n`;\n// This can be used in other places if use-cases are raised for keeping orientation in the context.\nconst OrientationContext = React.createContext<\"horizontal\" | \"vertical\">(\n  \"horizontal\"\n);\n\n/**\n * ## Toolbar API/Implementation notes\n *\n * ### Handling Overflow\n *\n * Handling the overflow popup on DOM-level, allows for a simple and flexible implementation that doesn't\n * require any coupling between Toolbar and components like IconButton. Other components can also similarly be\n * rendered inside toolbar without adopting any specific API. It's worth noting that any generic approach based\n * on children react nodes instead of children DOM nodes will have many edge cases and will involve assumptions\n * that will limit the API of toolbar. Also, any approach based on moving dom nodes to the overflow popup will\n * conflict with React owning the DOM.\n *\n * #### Assumption\n *\n * Since the overflow popup renders the same `children`, and items in the toolbar and popup overflow are made\n * visible/hidden based on the index of DOM nodes, it's important than children deterministically results in the\n * same dom structure. i.e. if a component in children randomly renders different number of root dom nodes in\n * each render, it can cause issues in hiding/showing elements.\n *\n * ### Orientation\n * A few reasons for not having separate `HorizontalToolbar` and `VerticalToolbar` components instead of `Toolbar` with\n * `orientation` prop:\n * - From usage side, a single `Toolbar` component is considered a more discoverable API.\n * - Separate components would require abstracting common parts which unnecessarily adds to complexity.\n *   The amount of branching to handle the differences is considered ok, at the current state of the component.\n */\n\n/**\n * @description\n * A toolbar is a container for {@link IconButton} and similar UI components.\n *\n * ## Features:\n * - A toolbar can be horizontal or vertical\n * - When there is not enough space for all children, toolbar shows an arrow icon, which shows the overflowing\n *   items in a popup, upon mouseover.\n *   Optionally, overflow can be wrapped into multiple lines, in horizontal toolbars.\n *\n * @example\n * <Toolbar>\n *   <IconButton aria-label=\"Show Diff\">\n *     <PlatformIcon icon=\"actions/diff\" />\n *   </IconButton>\n *   </Toolbar>\n */\nexport const Toolbar: React.FC<ToolbarProps> = ({\n  border,\n  orientation = \"horizontal\",\n  ...props\n}): React.ReactElement => {\n  const overflowBehavior =\n    orientation === \"horizontal\" && \"overflowBehavior\" in props\n      ? props.overflowBehavior\n      : null;\n  const rootProps = { style: props.style, className: props.className };\n  const ref = useRef<HTMLDivElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const showMoreButtonRef = useRef<HTMLButtonElement>(null);\n  const StyledToolbar =\n    orientation === \"horizontal\"\n      ? StyledHorizontalToolbar\n      : StyledVerticalToolbar;\n  const { overflowedElements } = useOverflowObserver(ref, { threshold: 0.8 });\n  const [isOverflowPopupVisible, setOverflowPopupVisible] = useState(false);\n  const [popupHeight, setPopupHeight] = useState(30);\n  const [firstOverflowedChildIndex, setFirstOverflowedChildIndex] =\n    useState<number>(-1);\n  const firstOverflowedChildRef = useRef<HTMLElement | undefined>();\n\n  useLayoutEffect(() => {\n    if (ref.current) {\n      const childElements = [...ref.current.children].filter(\n        (node): node is HTMLElement => node instanceof HTMLElement\n      );\n      const firstOverflowedChild = childElements.findIndex((child) =>\n        overflowedElements.includes(child)\n      );\n      setFirstOverflowedChildIndex(firstOverflowedChild);\n      firstOverflowedChildRef.current = childElements[firstOverflowedChild];\n    }\n  }, [overflowedElements]);\n\n  useLayoutEffect(() => {\n    if (overlayRef.current && popupHeight !== overlayRef.current.offsetHeight) {\n      setPopupHeight(overlayRef.current.offsetHeight);\n    }\n  });\n\n  const { overlayProps } = useOverlayPosition({\n    isOpen: isOverflowPopupVisible,\n    placement: \"bottom left\",\n    offset:\n      // in lack of positioning options for aligning bottom and left of of the overflow popup with the bottom and left\n      // of the toolbar itself, we have to measure the popup height, and use offset to achieve the same\n      orientation === \"horizontal\"\n        ? -popupHeight + SIDE_PADDING + 1\n        : -popupHeight + 1,\n    crossOffset:\n      orientation === \"horizontal\" ? -(SIDE_PADDING + 2) : -(SIDE_PADDING + 1),\n    containerPadding: 0,\n    shouldFlip: false,\n    targetRef: orientation === \"horizontal\" ? ref : showMoreButtonRef,\n    overlayRef: overlayRef,\n    onClose: () => {\n      setOverflowPopupVisible(false);\n    },\n  });\n\n  const showOverflowPopup = () => {\n    setOverflowPopupVisible(true);\n  };\n\n  const toolbarProps = {\n    onMouseMove: (event: MouseEvent) => {\n      const firstOverflowedElement = firstOverflowedChildRef.current;\n      if (!firstOverflowedElement) {\n        return;\n      }\n      const shouldShow =\n        orientation === \"vertical\"\n          ? event.clientY > firstOverflowedElement.getBoundingClientRect().top\n          : event.clientX > firstOverflowedElement.getBoundingClientRect().left;\n      if (shouldShow !== isOverflowPopupVisible) {\n        setOverflowPopupVisible(shouldShow);\n      }\n    },\n    onMouseLeave: () => {\n      if (isOverflowPopupVisible) {\n        setOverflowPopupVisible(false);\n      }\n    },\n  };\n  const toolbarOverflowPopupProps = {\n    onMouseEnter: () => setOverflowPopupVisible(true),\n    onMouseLeave: () => setOverflowPopupVisible(false),\n  };\n  return (\n    <OrientationContext.Provider value={orientation}>\n      <StyledToolbar\n        border={border}\n        {...mergeProps(rootProps, toolbarProps)}\n        role=\"toolbar\"\n      >\n        <StyledToolbarContent\n          ref={ref}\n          role=\"presentation\"\n          firstOverflowedIndex={firstOverflowedChildIndex}\n          shouldWrap={overflowBehavior === \"wrap\"}\n        >\n          {props.children}\n        </StyledToolbarContent>\n        {overflowedElements.length > 0 && (\n          <StyledShowMoreButton\n            ref={showMoreButtonRef}\n            tabIndex={-1}\n            onMouseEnter={showOverflowPopup}\n          >\n            <PlatformIcon icon=\"ide/link\" />\n          </StyledShowMoreButton>\n        )}\n      </StyledToolbar>\n      {isOverflowPopupVisible && overflowedElements.length > 0 && (\n        // Maybe more accessible to reuse the entire Popup here? it would require more flexible API to handle mouseleave though\n        // Note: we could also render the whole toolbar with the same props and only orientation being overwritten,\n        // but it has the risk of infinite overlay opening in some edge cases, and that level of generality doesn't\n        // seem to be necessary, at least at the moment.\n        <OrientationContext.Provider value=\"horizontal\">\n          <Overlay>\n            <StyledPopupContainer\n              ref={overlayRef}\n              {...mergeProps(overlayProps, toolbarOverflowPopupProps)}\n            >\n              <ToolbarInOverlay\n                border\n                firstVisibleIndex={\n                  orientation === \"vertical\"\n                    ? firstOverflowedChildIndex\n                    : undefined\n                }\n              >\n                {props.children}\n              </ToolbarInOverlay>\n            </StyledPopupContainer>\n          </Overlay>\n        </OrientationContext.Provider>\n      )}\n    </OrientationContext.Provider>\n  );\n};\n\nconst ToolbarInOverlay = styled(StyledHorizontalToolbar)<{\n  firstVisibleIndex?: number;\n}>`\n  ${({ firstVisibleIndex }) =>\n    firstVisibleIndex &&\n    css`\n      ${StyledSeparator}:nth-child(${firstVisibleIndex + 1}) {\n        display: none;\n      }\n      > :not(:nth-child(${firstVisibleIndex}) ~ *) {\n        display: none;\n      }\n    `};\n`;\n\n/**\n * Separator to be used between items in a toolbar.\n */\nexport const ToolbarSeparator = (): React.ReactElement => {\n  const orientation = useContext(OrientationContext);\n  return orientation === \"horizontal\" ? (\n    <StyledHorizontalSeparator />\n  ) : (\n    <StyledVerticalSeparator />\n  );\n};\n","import React from \"react\";\nimport { Tooltip, TooltipProps } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionHelpTooltipProps\n  extends Omit<TooltipProps, \"children\" | \"multiline\"> {\n  actionName: React.ReactNode;\n  helpText: React.ReactNode;\n  shortcut?: React.ReactNode;\n  link?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action Help\"\n * @see {@link ActionTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionHelpTooltip = ({\n  actionName,\n  helpText,\n  shortcut,\n  link,\n  ...tooltipProps\n}: ActionHelpTooltipProps): JSX.Element => {\n  return (\n    <Tooltip multiline {...tooltipProps}>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n      <Tooltip.Description>{helpText}</Tooltip.Description>\n      {link && <Tooltip.Link>{link}</Tooltip.Link>}\n    </Tooltip>\n  );\n};\n","import React from \"react\";\nimport { Tooltip, TooltipProps } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionTooltipProps\n  extends Omit<TooltipProps, \"children\" | \"multiline\"> {\n  actionName: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action\"\n * @see {@link ActionHelpTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionTooltip = ({\n  actionName,\n  shortcut,\n  ...tooltipProps\n}: ActionTooltipProps): JSX.Element => {\n  return (\n    <Tooltip {...tooltipProps}>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n    </Tooltip>\n  );\n};\n","import React from \"react\";\nimport { Tooltip, TooltipProps } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface HelpTooltipProps\n  extends Omit<TooltipProps, \"children\" | \"multiline\"> {\n  helpText: React.ReactNode;\n  shortcut?: React.ReactNode;\n  link?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Help\"\n * @see {@link ActionTooltip} {@link ActionHelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const HelpTooltip = ({\n  helpText,\n  shortcut,\n  link,\n  ...tooltipProps\n}: HelpTooltipProps): JSX.Element => {\n  return (\n    <Tooltip multiline {...tooltipProps}>\n      <Tooltip.Header>{helpText}</Tooltip.Header>\n      {shortcut && (\n        <div>\n          <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>\n        </div>\n      )}\n      {link && <Tooltip.Link>{link}</Tooltip.Link>}\n    </Tooltip>\n  );\n};\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { TooltipTriggerProps as AriaTooltipTriggerProps } from \"@react-aria/tooltip\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { AriaPositionProps, useOverlayPosition } from \"@react-aria/overlays\";\nimport { TooltipTriggerAndOverlay } from \"./TooltipTriggerAndOverlay\";\nimport { useObjectRef } from \"@react-aria/utils\";\n\nexport interface PositionedTooltipTriggerProps<\n  T extends HTMLElement = HTMLElement\n> extends Omit<AriaTooltipTriggerProps, \"trigger\">,\n    Pick<\n      AriaPositionProps,\n      \"placement\" | \"offset\" | \"crossOffset\" | \"shouldFlip\"\n    > {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<T> }\n      ) => React.ReactNode);\n\n  /**\n   * Whether to show the tooltip on trigger's focus. By default, tooltip is shown only when the trigger\n   * is hovered, but it can improve accessibility to show the tooltip on focus as well.\n   */\n  showOnFocus?: boolean;\n\n  /**\n   * Ref to trigger.\n   * If not provided, a ref will be created internally.\n   * Useful for when a ref to the trigger is necessary where PositionedTooltipTrigger\n   * is used.\n   */\n  triggerRef?: RefObject<T>;\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}. Tooltip will be positioned based relative to the trigger.\n * The default tooltip positioning is based on cursor, which is implemented by {@link TooltipTrigger}\n */\nexport const PositionedTooltipTrigger = <T extends HTMLElement>({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  offset = 8,\n  showOnFocus,\n  triggerRef: inputTriggerRef,\n  ...props\n}: PositionedTooltipTriggerProps<T>): JSX.Element => {\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const fallbackRef = useObjectRef<T>(inputTriggerRef);\n  const triggerRef = inputTriggerRef || fallbackRef;\n\n  const positionAria = useOverlayPosition({\n    ...props,\n    overlayRef,\n    targetRef: triggerRef,\n    offset,\n    isOpen: state.isOpen,\n    onClose: state.close,\n  });\n\n  // A workaround for a mysterious issue that happens only in docusaurus build.\n  // The ref value is not up-to-date, when the effect runs.\n  // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n  useEffect(() => {\n    if (state.isOpen) {\n      requestAnimationFrame(positionAria.updatePosition);\n    }\n  }, [state.isOpen]);\n\n  return (\n    <TooltipTriggerAndOverlay\n      tooltip={tooltip}\n      positionAria={positionAria}\n      trigger={children}\n      state={state}\n      overlayRef={overlayRef}\n      triggerRef={triggerRef}\n      showOnFocus={showOnFocus}\n      isDisabled={props.isDisabled}\n    />\n  );\n};\n","import React, { ForwardedRef, MutableRefObject, useContext } from \"react\";\nimport { AriaTooltipProps, useTooltip } from \"@react-aria/tooltip\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { PositionAria } from \"@react-aria/overlays\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { TooltipContext } from \"./TooltipContext\";\nimport { TooltipPointer, TooltipPointerPosition } from \"./TooltipPointer\";\nimport {\n  tooltipBackground,\n  tooltipBorderColor,\n  WITH_POINTER_BORDER_RADIUS,\n} from \"./tooltip-styles\";\n\nexport interface TooltipProps extends Omit<AriaTooltipProps, \"isOpen\"> {\n  children: React.ReactNode;\n  multiline?: boolean;\n  className?: string;\n  /**\n   * Whether (and in what position) the arrow pointer should be shown.\n   * When using {@link TooltipTrigger} or {@link PositionedTooltipTrigger}, the position of the pointer is calculated\n   * based on the target element, and a boolean value to define whether the arrow should be shown or not would suffice.\n   *\n   * Tooltips with pointer have slight style difference.\n   * {@see https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-(Community)?type=design&node-id=15-51&mode=design&t=7PplrxG8ZfXB4hIK-0}\n   *\n   * @example\n   * <Tooltip withPointer />\n   * // shows the pointer in the position controlled by {@link TooltipTrigger} or {@link PositionedTooltipTrigger}\n   * // If there is not `TooltipTrigger` or `PositionedTooltipTrigger`, the arrow is shown on top center by default.\n   *\n   * @example\n   * <Tooltip withPointer={{side: 'top', offset: 30}} />\n   * // shows the pointer on the top side, with horizontal offset of 30px from the left of tooltip, regardless\n   * // of whether `TooltipTrigger` or `PositionedTooltipTrigger` is used.\n   *\n   * @example\n   * <Tooltip withPointer={{side: 'left', offset: -30}} />\n   * // shows the pointer on the left side, with vertidcal offset of 30px from the bottom of the tooltip, regardless\n   * // of whether `TooltipTrigger` or `PositionedTooltipTrigger` is used.\n   */\n  withPointer?: boolean | TooltipPointerPosition;\n}\n\n// Providing default value for paddings, based on intellijlaf theme. In Intellij Platform, themes extend either\n// intellijlaf or darcula. Which means some properties can be omitted in the custom theme, relying on the values\n// in the base theme. This is not how theming works here, at the moment, and there are other similar issues, but\n// this is just a mitigation for one case, spacing in tooltip.\nexport const DEFAULT_TEXT_BORDER_INSETS = \"0.5rem 0.8125rem 0.625rem 0.625rem\";\nexport const DEFAULT_SMALL_TEXT_BORDER_INSETS =\n  \"0.375rem 0.75rem 0.4375rem 0.625rem\";\nconst StyledTooltip = styled.div<{ multiline?: boolean; hasPointer?: boolean }>`\n  box-sizing: content-box;\n  max-width: ${\n    /**\n     * Max width is meant to be set on the multiline description (which is not used in ActionTooltip which would\n     * be right according to [the specs](https://jetbrains.github.io/ui/controls/tooltip/#09)).\n     * But if set on `Tooltip.Description`, title and link can still make the tooltip grow more that the expected max\n     * width. So it makes more sense to set the max width on the container anyway. But since the value of the max width\n     * is meant to be for description we set the box-sizing to \"content-box\" to exclude container's padding in max-width\n     * calculation.\n     */\n    ({ theme, multiline }) =>\n      multiline\n        ? `${\n            theme.value<number>(\n              \"HelpTooltip.maxWidth\" as UnknownThemeProp<\"HelpTooltip.maxWidth\">\n            ) ?? 250\n          }px`\n        : null\n  };\n  white-space: ${({ multiline }) => (!multiline ? \"nowrap\" : null)};\n  display: inline-flex;\n  flex-direction: column;\n  gap: ${({ theme }) =>\n    theme.value<number>(\n      \"HelpToolTip.verticalGap\" as UnknownThemeProp<\"HelpToolTip.verticalGap\">\n    ) ?? 4}px;\n  background: ${tooltipBackground};\n  color: ${({ theme }) =>\n    theme.color(\"ToolTip.foreground\", !theme.dark ? \"#000\" : \"#bfbfbf\")};\n  padding: ${({ theme, multiline }) =>\n    multiline\n      ? theme.inset(\"HelpTooltip.defaultTextBorderInsets\") ||\n        DEFAULT_TEXT_BORDER_INSETS\n      : theme.inset(\"HelpTooltip.smallTextBorderInsets\") ||\n        DEFAULT_SMALL_TEXT_BORDER_INSETS};\n  line-height: 1.2;\n  border-style: solid;\n  border-width: ${({ theme, hasPointer }) =>\n    theme.value<boolean>(\"ToolTip.paintBorder\") || hasPointer ? \"1px\" : \"0px\"};\n  border-color: ${tooltipBorderColor};\n  ${WINDOW_SHADOW};\n  ${({ hasPointer }) =>\n    hasPointer &&\n    css`\n      position: relative; // needed for absolute positioning of the pointer\n      border-radius: ${WITH_POINTER_BORDER_RADIUS}px;\n    `}\n`;\n\nconst StyledShortcut = styled.kbd`\n  all: unset;\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.shortcutForeground\",\n      !theme.dark ? \"#787878\" : \"#999999\"\n    )};\n`;\n\nconst StyledHeader = styled.div`\n  font-size: ${({ theme }) => theme.fontSizeDelta(\"HelpTooltip.fontSizeDelta\")};\n  display: flex;\n  gap: 0.5rem;\n`;\nconst StyledDescription = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"Tooltip.infoForeground\" as UnknownThemeProp<\"Tooltip.infoForeground\">,\n      theme.commonColors.contextHelpForeground\n    )};\n  font-size: ${({ theme }) =>\n    theme.fontSizeDelta(\"HelpTooltip.descriptionSizeDelta\")};\n`;\n\nconst StyledLink = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.linkForeground\" as UnknownThemeProp<\"ToolTip.linkForeground\">,\n      theme.commonColors.linkForegroundEnabled\n    )};\n  a,\n  [role=\"link\"] {\n    // Maybe target Link instead, without important. It didn't work as expected, in the first try tho.\n    color: inherit !important;\n  }\n`;\n\nexport const placementToPointerSide: Record<\n  PositionAria[\"placement\"],\n  TooltipPointerPosition[\"side\"]\n> = {\n  bottom: \"top\",\n  top: \"bottom\",\n  left: \"right\",\n  right: \"left\",\n  center: \"top\", // doesn't make sense :-?\n};\n/**\n * Implements the UI of a Tooltip. For tooltip to be shown for a trigger, on hover, use {@link TooltipTrigger}.\n * The following components can be used to compose the content of a tooltip.\n * - {@link Tooltip.Header}\n * - {@link Tooltip.Description}\n * - {@link Tooltip.Link}\n * - {@link Tooltip.Shortcut}\n * Prefer using higher-level components like {@link HelpTooltip}, {@link ActionHelpTooltip} or {@link ActionTooltip}.\n * that ensure different pieces of tooltip content follow the\n * [design system recommendation](https://jetbrains.github.io/ui/controls/tooltip)\n *\n *\n * ### Reference:\n * Tooltip, Tooltip.* and TooltipTrigger are corresponding to [HelpTooltip](https://github.com/JetBrains/intellij-community/blob/854daf45b47a6ea9da0348978608bfbfe998d99c/platform/platform-api/src/com/intellij/ide/HelpTooltip.java#L102)\n * in the original impl.\n */\nconst Tooltip = React.forwardRef(function Tooltip(\n  { children, multiline, withPointer, ...props }: TooltipProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref: MutableRefObject<HTMLDivElement | null> =\n    useObjectRef(forwardedRef);\n  const {\n    state,\n    isInteractive,\n    pointerPositionStyle,\n    placement = \"bottom\",\n  } = useContext(TooltipContext) || {};\n  const { tooltipProps } = useTooltip(\n    props,\n    state\n      ? {\n          ...state,\n          // if the tooltip is not interactive, let it be closed even when it's hovered. That's the according to the reference impl.\n          open: isInteractive ? state?.open : () => {},\n        }\n      : state\n  );\n\n  const { side, offset } =\n    typeof withPointer === \"object\"\n      ? withPointer\n      : { side: placementToPointerSide[placement], offset: undefined };\n\n  return (\n    <StyledTooltip\n      hasPointer={Boolean(withPointer)}\n      multiline={multiline}\n      {...tooltipProps}\n      className={props.className}\n      ref={ref}\n    >\n      {withPointer && (\n        <TooltipPointer\n          tooltipRef={ref}\n          side={side}\n          offset={\n            offset || !pointerPositionStyle\n              ? { type: \"specific\", value: offset }\n              : { type: \"calculated\", value: pointerPositionStyle }\n          }\n        />\n      )}\n      {children}\n    </StyledTooltip>\n  );\n});\n\nconst _Tooltip = Object.assign(Tooltip, {\n  Header: StyledHeader,\n  Shortcut: StyledShortcut,\n  Description: StyledDescription,\n  Link: StyledLink,\n});\n\nexport { _Tooltip as Tooltip };\n","import React, { CSSProperties } from \"react\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\nimport { PositionAria } from \"@react-aria/overlays\";\n\ninterface TooltipContextObject {\n  state: TooltipTriggerState;\n  isInteractive: boolean;\n  placement: PositionAria[\"placement\"];\n  pointerPositionStyle?: CSSProperties;\n}\n\nexport const TooltipContext = React.createContext<TooltipContextObject | null>(\n  null\n);\n","import { compose, identity } from \"ramda\";\nimport React, { CSSProperties, RefObject, useEffect, useState } from \"react\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\n\nimport {\n  tooltipBackground,\n  WITH_POINTER_BORDER_RADIUS,\n} from \"./tooltip-styles\";\n\ntype OffsetValue = number | `${number}%`;\nexport type TooltipPointerPosition = {\n  /**\n   * The side of the tooltip the pointer is shown\n   */\n  side: \"top\" | \"bottom\" | \"left\" | \"right\";\n  /**\n   * - When side is \"top\" or \"bottom\":\n   *   Horizontal offset (in px) with respect to the left (or right, if negative) of the tooltip.\n   * - When side is \"left\" or \"right\":\n   *   Vertical offset (in px) with respect to the top (or bottom, if negative) of the tooltip.\n   *\n   * @default: '50%'\n   */\n  offset?: OffsetValue | { value: OffsetValue; invert?: boolean };\n};\n\nconst POINTER_WIDTH = 6;\nconst POINTER_HEIGHT = 9;\nconst POINTER_THICKNESS = 1.5;\nconst TRANSLATE = `translate(-${POINTER_WIDTH}px, -${POINTER_HEIGHT}px)`;\nconst sideStyles = {\n  top: css`\n    top: 0;\n    transform: ${TRANSLATE};\n  `,\n  bottom: css`\n    bottom: 0;\n    transform: rotateX(180deg) ${TRANSLATE};\n  `,\n  left: css`\n    left: 0;\n    transform: rotate(-90deg) ${TRANSLATE};\n  `,\n  right: css`\n    right: 0;\n    transform: rotate(90deg) ${TRANSLATE};\n  `,\n};\nconst StyledTooltipPointer = styled.span<{\n  side: TooltipPointerPosition[\"side\"];\n}>`\n  position: absolute;\n  width: 0;\n  height: 0;\n  ${({ side }) => sideStyles[side]};\n\n  &::before {\n    content: \"\";\n    position: absolute;\n    border-left: ${POINTER_WIDTH + POINTER_THICKNESS}px solid transparent;\n    border-right: ${POINTER_WIDTH + POINTER_THICKNESS}px solid transparent;\n    border-bottom: ${POINTER_HEIGHT + POINTER_THICKNESS}px solid #636569;\n    left: -${POINTER_THICKNESS}px;\n    top: -${POINTER_THICKNESS}px;\n  }\n\n  &::after {\n    content: \"\";\n    position: absolute;\n    border-left: ${POINTER_WIDTH}px solid transparent;\n    border-right: ${POINTER_WIDTH}px solid transparent;\n    border-bottom: ${POINTER_HEIGHT}px solid ${tooltipBackground};\n  }\n`;\n\nfunction normalizeCssValue(value: string | number) {\n  return typeof value === \"number\" ? `${value}px` : value;\n}\n\nconst withMin = (min: number) => (value: string | number | undefined) =>\n  value != undefined ? `max(${min}px, ${normalizeCssValue(value)})` : value;\nconst withMax = (max: number) => (value: string | number | undefined) =>\n  value != undefined ? `min(${max}px, ${normalizeCssValue(value)})` : value;\nconst HEIGHT_OFFSET = POINTER_HEIGHT + WITH_POINTER_BORDER_RADIUS;\nconst WIDTH_OFFSET = POINTER_WIDTH + WITH_POINTER_BORDER_RADIUS;\n\n/**\n * Ensures pointer is not offset too much or too little that would make the arrow appear\n * outside the tooltip boundary.\n */\nfunction limitPointerPositionStyles(\n  { width, height }: { width: number | undefined; height: number | undefined },\n  { top, left, right, bottom }: CSSProperties\n) {\n  const applyVerticalMinMax = compose(\n    height ? withMax(height - HEIGHT_OFFSET) : identity,\n    withMin(HEIGHT_OFFSET)\n  );\n  const applyHorizontalMinMax = compose(\n    width ? withMax(width - WIDTH_OFFSET) : identity,\n    withMin(WIDTH_OFFSET)\n  );\n  return {\n    top: applyVerticalMinMax(top),\n    bottom: applyVerticalMinMax(bottom),\n    left: applyHorizontalMinMax(left),\n    right: applyHorizontalMinMax(right),\n  };\n}\n\nconst getOffsetCssProp = (\n  side: TooltipPointerPosition[\"side\"],\n  invert?: boolean\n): \"top\" | \"bottom\" | \"left\" | \"right\" => {\n  if (side === \"top\" || side === \"bottom\") {\n    return invert ? \"right\" : \"left\";\n  }\n  return invert ? \"bottom\" : \"top\";\n};\n\nfunction pointerPositionToOffsetStyle({\n  side,\n  offset = \"50%\",\n}: TooltipPointerPosition): CSSProperties {\n  const { invert = false, value: offsetValue } =\n    typeof offset === \"object\" ? offset : { invert: false, value: offset };\n  return {\n    [getOffsetCssProp(side, invert)]: offsetValue,\n  };\n}\n\nexport function TooltipPointer({\n  side,\n  offset,\n  tooltipRef,\n}: {\n  side: TooltipPointerPosition[\"side\"];\n  offset:\n    | { type: \"calculated\"; value: CSSProperties }\n    | { type: \"specific\"; value: TooltipPointerPosition[\"offset\"] };\n  tooltipRef: RefObject<HTMLElement>;\n}) {\n  const [size, setSize] = useState<{\n    height: number | undefined;\n    width: number | undefined;\n  }>({ height: undefined, width: undefined });\n  useEffect(() => {\n    const { offsetHeight, offsetWidth } = tooltipRef.current || {};\n    if (offsetHeight != size?.height || offsetWidth != size?.width) {\n      setSize({ height: offsetHeight, width: offsetWidth });\n    }\n  });\n\n  return (\n    <StyledTooltipPointer\n      side={side}\n      style={limitPointerPositionStyles(\n        size,\n        offset.type === \"specific\"\n          ? pointerPositionToOffsetStyle({ side, offset: offset.value })\n          : offset.value\n      )}\n    />\n  );\n}\n","import React, { useRef } from \"react\";\nimport { useLayoutEffect } from \"@react-aria/utils\";\nimport {\n  AriaPositionProps,\n  PositionAria,\n  useOverlayPosition,\n} from \"@react-aria/overlays\";\n\n/**\n * `useOverlayPosition` only supports positioning overlay relative to an element, at the moment.\n *  For context menu or tooltip, we may want to position the overlay based on the coordinates of the mouse event which\n *  has triggered the overlay.\n *  This hook wraps `useOverlayPosition`, and is very similar to it, but you don't need to pass `targetRef`. Instead,\n *  you have to call the updatePosition in the event handler that triggers the overlay, passing the `MouseEvent` object.\n *\n * This is hopefully a temporary solution to circumvents the limitation of `useOverlayPosition`, until it supports\n * non-element based positioning as well. It works by appending a dummy 1x1 px element to body and positioning it\n * based on React.MouseEvent objects. Then it uses a ref to that element as the `targetRef`, passed to `useOverlayPosition`\n *\n * @example\n * ```ts\n * const { updatePosition, overlyProps} = useMouseEventOverlayPosition({ overlayRef });\n *\n * const onContextMenu = (event: React.ReactEvent) => {\n *  updatePosition(event);\n *  // ...\n * }\n * ```\n */\nlet globalMoveHandler: null | ((e: MouseEvent) => void) = null;\nlet lastMouseClientPos: { clientX: number; clientY: number } | undefined;\n\nexport function useMouseEventOverlayPosition(\n  options: Omit<AriaPositionProps, \"targetRef\">\n): Omit<PositionAria, \"updatePosition\"> & {\n  updatePosition: (event?: React.MouseEvent) => void;\n} {\n  const targetRef = useRef<HTMLElement>(null);\n\n  useLayoutEffect(() => {\n    if (!globalMoveHandler) {\n      // After the first use of the hook, the listener will be attached forever. Not a big deal but can be improved.\n      globalMoveHandler = ({ clientX, clientY }) => {\n        lastMouseClientPos = { clientX, clientY };\n      };\n      document.addEventListener(\"mousemove\", globalMoveHandler);\n    }\n    if (!targetRef.current) {\n      const fakeTarget = document.createElement(\"span\");\n      Object.assign(fakeTarget.style, {\n        width: \"0px\",\n        height: \"0px\",\n        pointerEvents: \"none\",\n        position: \"fixed\",\n        visibility: \"hidden\",\n      });\n      document.body.appendChild(fakeTarget);\n      // @ts-expect-error We intentionally don't pass null to generic argument, to not have it as a mutable nullable\n      // ref, since we are mimicking an element ref.\n      targetRef.current = fakeTarget;\n      return () => {\n        fakeTarget.remove();\n      };\n    }\n  }, []);\n\n  const updatePosition = (e?: React.MouseEvent) => {\n    const coordinatesSource = e || lastMouseClientPos;\n    if (targetRef.current && coordinatesSource) {\n      const { clientX, clientY } = coordinatesSource;\n      targetRef.current.style.left = `${\n        // not sure why crossOffset passed to useOverlayPosition doesn't work, so compensating for it here.\n        clientX + (options.crossOffset ?? 0)\n      }px`;\n      targetRef.current.style.top = `${clientY}px`;\n    }\n    _updatePosition();\n  };\n  useLayoutEffect(() => {\n    if (options.isOpen) {\n      updatePosition();\n    }\n  }, [options.isOpen, targetRef.current]);\n\n  const { updatePosition: _updatePosition, ...result } = useOverlayPosition({\n    ...options,\n    targetRef,\n  });\n\n  return {\n    ...result,\n    /**\n     * Ref to be passed to be passed as targetRef\n     */\n    updatePosition,\n  };\n}\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { TooltipTriggerProps as AriaTooltipTriggerProps } from \"@react-aria/tooltip\";\nimport { AriaPositionProps } from \"@react-aria/overlays\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { useMouseEventOverlayPosition } from \"@intellij-platform/core/utils/useMouseEventOverlayPosition\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { TooltipTriggerAndOverlay } from \"@intellij-platform/core/Tooltip/TooltipTriggerAndOverlay\";\n\nexport interface TooltipTriggerProps\n  // controlling isOpen state is not supported since positioning is based on cursor.\n  // PositionedTooltipTrigger can be used for controlled isOpen state\n  extends Omit<AriaTooltipTriggerProps, \"isOpen\" | \"defaultOpen\" | \"trigger\"> {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Placement of the tooltip with respect to the cursor\n   * @default \"bottom left\"\n   */\n  placement?: AriaPositionProps[\"placement\"];\n  /**\n   * The additional offset applied along the main axis between the element and its\n   * anchor element.\n   * @default theme.value<number>(\"HelpTooltip.mouseCursorOffset\") ?? 20\n   */\n  offset?: number;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n      ) => React.ReactNode);\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}.\n * Showing tooltip on focus and controlled open state are not supported at the moment, based on how tooltip works in the\n * reference impl, and since tooltip is positioned based on cursor position. Positioning the tooltip based on cursor\n * position requires tooltip to be opened on hover. That's why neither controlling opened state nor showing the tooltip\n * on focus are supported here. {@link PositionedTooltipTrigger} allows for positioning the tooltip with respect to the\n * trigger element, and offers more options.\n */\nexport const TooltipTrigger = ({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  offset,\n  placement = \"bottom left\",\n  ...props\n}: TooltipTriggerProps): JSX.Element => {\n  const triggerRef = useRef<HTMLElement>(null);\n  const theme = useTheme();\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  const positionAria = useMouseEventOverlayPosition({\n    overlayRef,\n    isOpen: state.isOpen,\n    placement,\n    shouldFlip: true,\n    offset:\n      offset ?? theme.value<number>(\"HelpTooltip.mouseCursorOffset\") ?? 20,\n  });\n\n  // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n  useEffect(() => {\n    if (state.isOpen) {\n      requestAnimationFrame(() => {\n        positionAria.updatePosition();\n      });\n    }\n  }, [state.isOpen]);\n\n  return (\n    <TooltipTriggerAndOverlay\n      tooltip={tooltip}\n      positionAria={positionAria}\n      trigger={children}\n      state={state}\n      overlayRef={overlayRef}\n      triggerRef={triggerRef}\n      /**\n       * If we want to support showing tooltip on focus, or if we want to allow controlled open state, we should let it\n       * be positioned by the trigger element in that case, rather than mouse position.\n       * One solution would be to use useOverlayPosition as well, and conditionally use the right `overlayProps`, based on\n       * whether the position determined by mouse is within `triggerRef.current?.getBoundingClientRect()`. Another way\n       * (maybe better) would be to have `useMouseEventOverlayPosition` accept `bounds` or `containerBounds`, which if\n       * passed, makes sure the position is kept within that boundary. Outside positions would be mapped to the closest\n       * point on the border of the boundary.\n       */\n      showOnFocus={false}\n      isDisabled={props.isDisabled}\n    />\n  );\n};\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useState,\n} from \"react\";\nimport { useTooltipTrigger as useAriaTooltipTrigger } from \"@react-aria/tooltip\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\nimport { FocusableProvider } from \"@react-aria/focus\";\nimport { Overlay, PositionAria } from \"@react-aria/overlays\";\nimport { mergeProps, useLayoutEffect } from \"@react-aria/utils\";\n\nimport { TooltipContext } from \"./TooltipContext\";\n\ninterface TooltipTriggerBaseProps<T extends HTMLElement = HTMLElement> {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  trigger:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<T> }\n      ) => React.ReactNode);\n\n  state: TooltipTriggerState;\n\n  showOnFocus?: boolean;\n  positionAria: PositionAria;\n  overlayRef: RefObject<HTMLDivElement>;\n  triggerRef: RefObject<T>;\n  isDisabled?: boolean;\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}. It doesn't handle tooltip positioning, and so shouldn't be used\n * directly. {@param tooltipOverlayProps} should be used to apply the intended positioning.\n *\n * TODO: Implement timeout-based auto-hide (https://jetbrains.github.io/ui/controls/tooltip/#19)\n * TODO: shadow\n */\nexport const TooltipTriggerAndOverlay = <T extends HTMLElement>({\n  tooltip,\n  trigger,\n  state,\n  overlayRef,\n  triggerRef,\n  showOnFocus,\n  positionAria,\n  ...props\n}: TooltipTriggerBaseProps<T>): JSX.Element => {\n  const [isInteractive, setInteractive] = useState(false);\n  const { triggerProps, tooltipProps } = useTooltipTrigger(\n    props,\n    // In Intellij Platform. The tooltip hides right away. We follow the same, unless the tooltip is interactive.\n    // Maybe something to rethink if it's worth following the reference impl for.\n    { ...state, close: isInteractive ? state.close : () => state.close(true) },\n    triggerRef\n  );\n\n  if (!showOnFocus) {\n    delete triggerProps.onFocus;\n  }\n\n  useLayoutEffect(() => {\n    setInteractive(\n      overlayRef.current?.querySelector(\n        'a, button, [role=\"button\"], [role=link]'\n      ) !== null\n    );\n  });\n  return (\n    <>\n      {normalizeChildren(trigger, { ...triggerProps, ref: triggerRef })}\n      {state.isOpen && !props.isDisabled && (\n        <Overlay>\n          <TooltipContext.Provider\n            value={{\n              state,\n              isInteractive,\n              placement: positionAria.placement,\n              pointerPositionStyle: positionAria.arrowProps.style,\n            }}\n          >\n            <div\n              {...mergeProps(\n                positionAria.overlayProps,\n                // Is it ok to apply tooltip props on this wrapper?\n                tooltipProps\n              )}\n              ref={overlayRef}\n            >\n              {tooltip}\n            </div>\n          </TooltipContext.Provider>\n        </Overlay>\n      )}\n    </>\n  );\n};\n\nfunction normalizeChildren<T extends HTMLElement = HTMLElement>(\n  children: TooltipTriggerBaseProps<T>[\"trigger\"],\n  triggerProps: HTMLAttributes<HTMLElement> & { ref: RefObject<T> }\n) {\n  if (typeof children === \"function\") {\n    return children(triggerProps);\n  }\n  if (React.isValidElement(children) && typeof children.type === \"string\") {\n    return React.cloneElement(children, triggerProps);\n  }\n  return <FocusableProvider {...triggerProps}>{children}</FocusableProvider>;\n}\n\n/**\n * A wrapper around react-aria's useTooltipTrigger, adjusting it for Intellij Platform.\n */\nconst useTooltipTrigger: typeof useAriaTooltipTrigger = (props, state, ref) => {\n  const { triggerProps, tooltipProps } = useAriaTooltipTrigger(\n    props,\n    state,\n    ref\n  );\n  // onPointerDown returned from the underlying usePress stops propagation which messes with some usages of tooltip\n  // like in tab or tool window stripe button. We replace onPointerDown handler with a similar handler that closes\n  // the tooltip.\n  triggerProps.onPointerDown = () => {\n    if (!(ref.current instanceof HTMLInputElement)) {\n      state.close(true);\n    }\n  };\n  /**\n   * onMouseDown is preventDefault-ed which interferes with functionality of the tooltip trigger, in use cases like\n   * tool window stripe button. Note that since pointerDown is handled for calling the tooltip trigger's onPressStart\n   * handler (which hides the tooltip), there is no issue in excluding onMouseDown, because it's only used to preventDefault\n   * the event, because of some edge cases focus handling which is not our concern.\n   */\n  delete triggerProps.onMouseDown;\n\n  return {\n    triggerProps,\n    tooltipProps,\n  };\n};\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport interface ValidationTooltipProps {\n  children: React.ReactNode;\n  /**\n   * @default error\n   */\n  type?: \"error\" | \"warning\";\n}\n\nconst StyledValidationTooltip = styled(Tooltip)`\n  box-shadow: none;\n  padding: 0.25rem 0.5rem; // from ComponentValidator class in the reference impl\n  max-width: ${({ theme }) =>\n    `${theme.value<number>(\"ValidationTooltip.maxWidth\")}px`};\n  background: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.errorBackground\")};\n  border: 1px solid\n    ${({ theme }) => theme.color(\"ValidationTooltip.errorBorderColor\")};\n`;\n\nconst StyledWarningValidationTooltip = styled(StyledValidationTooltip)`\n  background: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.warningBackground\")};\n  border-color: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.warningBorderColor\")};\n`;\n\n/**\n * Tooltip to be used for validation error messages\n * @see https://jetbrains.github.io/ui/principles/validation_errors/\n */\nexport const ValidationTooltip = ({\n  type = \"error\",\n  children,\n}: ValidationTooltipProps): JSX.Element => {\n  const Component =\n    type === \"error\" ? StyledValidationTooltip : StyledWarningValidationTooltip;\n  return <Component multiline>{children}</Component>;\n};\n","import { Theme } from \"@intellij-platform/core/Theme\";\n\nexport const WITH_POINTER_BORDER_RADIUS = 4;\nexport const tooltipBackground = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ToolTip.background\", !theme.dark ? \"#f2f2f2\" : \"#3c3f41\");\nexport const tooltipBorderColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ToolTip.borderColor\", !theme.dark ? \"#adadad\" : \"#636569\");\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeNode } from \"../TreeNode\";\nimport { SpeedSearchItemHighlightsProvider } from \"@intellij-platform/core/CollectionSpeedSearch\";\n\nexport const SpeedSearchTreeNode = <T extends object>({\n  item,\n}: {\n  item: Node<T>;\n}) => {\n  return (\n    <SpeedSearchItemHighlightsProvider itemKey={item.key}>\n      <TreeNode key={item.key} item={item} />\n    </SpeedSearchItemHighlightsProvider>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { Virtualizer } from \"@react-aria/virtualizer\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport {\n  SpeedSearchProps,\n  SpeedSearchStateProps,\n} from \"@intellij-platform/core/SpeedSearch\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { StyledTree } from \"../StyledTree\";\nimport { SpeedSearchPopup } from \"../../SpeedSearch/SpeedSearchPopup\";\nimport { useTreeState } from \"../useTreeState\";\nimport { TreeProps } from \"../Tree\";\nimport { useTreeVirtualizer } from \"../useTreeVirtualizer\";\nimport { TreeContext } from \"../TreeContext\";\nimport { useSpeedSearchTree } from \"./useSpeedSearchTree\";\nimport { SpeedSearchTreeNode } from \"./SpeedSearchTreeNode\";\nimport { filterDOMProps } from \"@react-aria/utils\";\n\nexport type SpeedSearchTreeProps<T extends object> = TreeProps<T> &\n  SpeedSearchProps &\n  SpeedSearchStateProps & {\n    /**\n     * Whether speed search popup should not be shown. Useful when speed search state is controlled, and\n     * a search input is rendered outside the tree.\n     */\n    hideSpeedSearchPopup?: boolean;\n  };\n\nexport const SpeedSearchTree = React.forwardRef(\n  <T extends object>(\n    {\n      fillAvailableSpace = false,\n      treeRef,\n      hideSpeedSearchPopup,\n      style,\n      className,\n      ...props\n    }: SpeedSearchTreeProps<T>,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) => {\n    const state = useTreeState(\n      { ...props, disallowEmptySelection: !props.allowEmptySelection },\n      treeRef\n    );\n    const ref = useForwardedRef(forwardedRef);\n    const {\n      treeProps,\n      treeContext,\n      speedSearchContextValue,\n      searchPopupProps,\n    } = useSpeedSearchTree({ ...props, isVirtualized: true }, state, ref);\n\n    const { virtualizerProps } = useTreeVirtualizer({ state });\n\n    // NOTE: SpeedSearchPopup can be rendered as a portal with proper positioning (useOverlayPosition), if overflow\n    // issues required it.\n    return (\n      <TreeContext.Provider value={treeContext}>\n        <CollectionSpeedSearchContext.Provider value={speedSearchContextValue}>\n          {!hideSpeedSearchPopup && <SpeedSearchPopup {...searchPopupProps} />}\n          <StyledTree\n            as={Virtualizer}\n            ref={ref}\n            fillAvailableSpace={fillAvailableSpace}\n            {...virtualizerProps}\n            {...treeProps}\n            {...filterDOMProps(props, { labelable: true })}\n            style={style}\n            className={className}\n          >\n            {(type: string, item: unknown) => (\n              <SpeedSearchTreeNode\n                key={(item as Node<T>).key}\n                item={item as Node<T>}\n              />\n            )}\n          </StyledTree>\n        </CollectionSpeedSearchContext.Provider>\n      </TreeContext.Provider>\n    );\n  }\n);\n","import { RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useCollectionSpeedSearch } from \"../../CollectionSpeedSearch/useCollectionSpeedSearch\";\nimport {\n  SpeedSearchProps,\n  SpeedSearchStateProps,\n} from \"../../SpeedSearch/useSpeedSearch\";\nimport { TreeKeyboardDelegate } from \"../TreeKeyboardDelegate\";\nimport { SelectableTreeProps, useSelectableTree } from \"../useSelectableTree\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\ninterface UseSpeedSearchTreeProps<T>\n  extends SpeedSearchProps,\n    SpeedSearchStateProps,\n    SelectableTreeProps<T> {}\n\nexport function useSpeedSearchTree<T>(\n  props: UseSpeedSearchTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const {\n    containerProps,\n    keyboardDelegate,\n    selectionManager,\n    speedSearch,\n    ...collectionSpeedSearch\n  } = useCollectionSpeedSearch({\n    ...props,\n    collection: state.collection,\n    selectionManager: state.selectionManager,\n    keyboardDelegate: new TreeKeyboardDelegate(\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    ref,\n    // TODO: maybe allow control over speed search via other props\n  });\n\n  // Speed search is cleared on \"Enter\" key. Alternatively we could wrap onAction and onToggle props\n  // but this seemed more reasonable\n  // NOTE: It may make sense for this behaviour to be pulled up to useCollectionSpeedSearch.\n  const { keyboardProps: speedSearchKeyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (\n        [\"Enter\", \"ArrowLeft\", \"ArrowRight\"].includes(e.key) &&\n        !hasAnyModifier(e)\n      ) {\n        speedSearch.clear();\n      } else {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  const { treeProps, ...selectableTree } = useSelectableTree(\n    { ...props, keyboardDelegate },\n    { ...state, selectionManager },\n    ref\n  );\n\n  return {\n    treeProps: mergeProps(treeProps, containerProps, speedSearchKeyboardProps),\n    ...collectionSpeedSearch,\n    ...selectableTree,\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { StyledList } from \"@intellij-platform/core/List/StyledList\";\n\nexport const StyledTree = styled(StyledList).attrs({ role: \"tree\" as string })`\n  background: ${({ theme }) => theme.color(\"Tree.background\")};\n`;\n","import React, { Key, MutableRefObject } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\n\nexport type TreeContextType<T> = {\n  state: Pick<\n    TreeState<T>,\n    | \"collection\"\n    | \"selectionManager\"\n    | \"expandedKeys\"\n    | \"disabledKeys\"\n    | \"toggleKey\"\n  >;\n  focused: boolean;\n  onActionRef: MutableRefObject<((key: Key) => void) | undefined>;\n};\n\nexport const TreeContext = React.createContext<TreeContextType<any> | null>(\n  null\n);\n","import { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key, RefObject } from \"react\";\n\nexport class TreeKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  constructor(\n    private collection: Collection<Node<T>>,\n    disabledKeys: Set<Key>,\n    ref: RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super({\n      collection,\n      disabledKeys,\n      ref,\n      collator,\n      // Since @react-aria/selection@3.16.0 getKeyLeftOf and getKeyRightOf is\n      // removed if orientation is vertical and layout is \"stack\".\n      layout: \"grid\",\n    });\n  }\n\n  getKeyLeftOf(key: React.Key): React.Key | null {\n    const item = this.collection.getItem(key);\n    return item?.parentKey ?? this.getKeyAbove(key);\n  }\n\n  getKeyRightOf(key: React.Key): React.Key | null {\n    return this.getKeyBelow(key);\n  }\n}\n","import { LafIcon } from \"../Icon\";\nimport React, { ComponentProps, useMemo } from \"react\";\nimport { styled } from \"../styled\";\n\nexport const TREE_ICON_SIZE = 16;\nconst StyledTreeNodeIcon = styled(LafIcon)`\n  margin-left: -20px;\n  margin-right: 4px;\n  margin-top: -1px; // the svg path seems to have uneven vertical padding. This is to compensate for that.\n  flex-shrink: 0;\n  align-self: center;\n`;\n\ntype TreeNodeIconProps = ComponentProps<typeof StyledTreeNodeIcon> & {\n  selected: boolean;\n  expanded: boolean;\n};\nconst getIcon = (selected: boolean, expanded: boolean) => {\n  const modifiers = { Selected: selected };\n  if (expanded) {\n    return {\n      themePath: selected ? \"Tree.expandedSelectedIcon\" : \"Tree.expandedIcon\",\n      iconPath: { name: \"treeExpanded\", modifiers },\n    };\n  }\n  if (!expanded) {\n    return {\n      themePath: selected ? \"Tree.collapsedSelectedIcon\" : \"Tree.collapsedIcon\",\n      iconPath: { name: \"treeCollapsed\", modifiers },\n    };\n  }\n};\n\nexport function TreeNodeIcon({\n  selected,\n  expanded,\n  ...props\n}: TreeNodeIconProps) {\n  const icon = useMemo(() => getIcon(selected, expanded), [selected, expanded]);\n  return (\n    <StyledTreeNodeIcon\n      icon={icon?.iconPath}\n      themePath={icon?.themePath}\n      size={TREE_ICON_SIZE}\n      {...props}\n    />\n  );\n}\n","import { Key } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { PressProps } from \"@react-aria/interactions\";\n\nexport function useTreeNodeToggleButton<T>({\n  collection,\n  toggleKey,\n  selectionManager,\n  key,\n}: { key: Key } & Pick<\n  TreeState<T>,\n  \"collection\" | \"toggleKey\" | \"selectionManager\"\n>): { treeNodeToggleButtonProps: PressProps } {\n  return {\n    treeNodeToggleButtonProps: {\n      preventFocusOnPress: true,\n      onPress: () => {\n        toggleKey(key);\n\n        // The rest is for deselecting selected descendants and selecting the toggled node, if there\n        // is at least one of such currently selected descendants. This is the exact behavior\n        // of Tree in Intellij Platform, and hence implemented here.\n        const selectedDescendantKeys = [\n          ...selectionManager.selectedKeys,\n        ].filter((key: Key) => {\n          let parentKey = collection.getItem(key)?.parentKey;\n          while (parentKey) {\n            if (parentKey === key) {\n              return true;\n            }\n            parentKey = collection.getItem(parentKey)?.parentKey;\n          }\n          return false;\n        });\n        selectedDescendantKeys.forEach((key) =>\n          selectionManager.toggleSelection(key)\n        );\n        // if any of the descendants are selected\n        if (\n          !selectionManager.isSelected(key) &&\n          selectedDescendantKeys.length > 0\n        ) {\n          selectionManager.toggleSelection(key);\n        }\n      },\n    },\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { TREE_ICON_SIZE } from \"./TreeNodeIcon\";\n\ntype StyledListItemProps = {\n  level: number;\n};\nexport const StyledTreeNode = styled(StyledListItem).attrs<StyledListItemProps>(\n  { role: \"treeitem\" }\n)<StyledListItemProps>`\n  // There are some theme properties for tree node padding (theme.ui.Tree.leftChildIndent and\n  // theme.ui.Tree.leftChildIndent), but they doesn't seem to be applicable.\n  padding-left: ${({ level }) => `${(level + 1) * TREE_ICON_SIZE + 8}px`};\n  padding-right: 0.25rem;\n  ${({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"Tree.foreground\" as UnknownThemeProp<\"Tree.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color = theme.asCurrentForeground(\n          theme.color(\n            \"Tree.selectionForeground\" as UnknownThemeProp<\"Tree.selectionForeground\">\n          ) || theme.commonColors.labelSelectedForeground\n        ) /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"Tree.selectionBackground\" as UnknownThemeProp<\"Tree.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"Tree.selectionInactiveForeground\" as UnknownThemeProp<\"Tree.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"Tree.selectionBackgroundInactive\" as UnknownThemeProp<\"Tree.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor,\n      color,\n    };\n  }}\n`;\n","import { usePress } from \"@react-aria/interactions\";\nimport { Node } from \"@react-types/shared\";\nimport React, { useContext, useRef } from \"react\";\nimport { ItemStateContext } from \"../Collections/ItemStateContext\";\nimport { TreeNodeIcon } from \"./TreeNodeIcon\";\nimport { useTreeNode } from \"./useTreeNode\";\nimport { useTreeNodeToggleButton } from \"./useTreeNodeToggleButton\";\nimport { TreeContext } from \"./TreeContext\";\nimport { StyledTreeNode } from \"@intellij-platform/core/Tree/StyledTreeNode\";\n\ntype TreeNodeProps<T> = {\n  item: Node<T>;\n  showAsFocused?: boolean;\n};\n\nexport function TreeNode<T>({ item }: TreeNodeProps<T>) {\n  const ref = useRef(null);\n  const {\n    state: {\n      collection,\n      selectionManager,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n    },\n    focused: containerFocused,\n    onActionRef: { current: onAction },\n  } = useContext(TreeContext)!;\n\n  const isSelected = selectionManager.isSelected(item.key);\n  const expanded = expandedKeys.has(item.key);\n  const isDisabled = disabledKeys.has(item.key);\n\n  const { pressProps: togglePressProps } = usePress({\n    ...useTreeNodeToggleButton({\n      key: item.key,\n      collection,\n      selectionManager,\n      toggleKey,\n    }).treeNodeToggleButtonProps,\n    isDisabled,\n  });\n\n  const { treeNodeProps } = useTreeNode({\n    item,\n    ref,\n    toggleKey,\n    onAction,\n    selectionManager,\n    disabled: isDisabled,\n  });\n\n  /**\n   * NOTE: TreeNode intentionally is not designed in a recursive way for two main reasons:\n   * - Performance\n   * - Better support for virtualization\n   * So instead of rendering TreeNode for childNodes, if the node is expanded, we expect parent\n   * to render children. It's not a layout issue since we don't need any nesting in terms of\n   * layout of nested items. In terms of layout, a tree will be rendered similar to a flat list,\n   * but with more indentation for nested nodes.\n   */\n  return (\n    <>\n      <StyledTreeNode\n        ref={ref}\n        {...treeNodeProps}\n        containerFocused={containerFocused}\n        disabled={isDisabled}\n        selected={isSelected}\n        aria-disabled={isDisabled}\n        aria-selected={isSelected}\n        level={item.level}\n      >\n        {[...item.childNodes].length > 0 && (\n          <TreeNodeIcon\n            selected={isSelected}\n            expanded={expanded}\n            {...togglePressProps}\n          />\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isSelected,\n            isContainerFocused: containerFocused,\n            node: item,\n          }}\n        >\n          {item.rendered}\n        </ItemStateContext.Provider>\n      </StyledTreeNode>\n    </>\n  );\n}\n","import { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { Node } from \"@react-types/shared\";\nimport { Key, RefObject } from \"react\";\n\nexport function useTreeNode<T>({\n  item,\n  ref,\n  selectionManager,\n  disabled,\n  toggleKey,\n  onAction,\n}: {\n  item: Node<T>;\n  ref: RefObject<HTMLElement>;\n  disabled: boolean;\n  toggleKey: (key: Key) => void;\n  onAction?: (key: Key) => void;\n  selectionManager: SelectionManager;\n}) {\n  const {\n    pressProps: { onKeyDown, ...pressProps },\n  } = usePress({\n    ...useSelectableItem({\n      key: item.key,\n      ref,\n      selectionManager,\n      isVirtualized: false,\n    }).itemProps,\n    isDisabled: disabled,\n    preventFocusOnPress: false,\n  });\n\n  const onDoubleClick = () => {\n    if ([...item.childNodes].length > 0) {\n      toggleKey(item.key);\n    } else {\n      onAction?.(item.key);\n    }\n  };\n  const ariaProps = {\n    role: \"treeitem\",\n  };\n\n  return {\n    treeNodeProps: mergeProps(pressProps, { onDoubleClick }, ariaProps),\n  };\n}\n","import { Key, RefObject, useEffect, useMemo, useRef, useState } from \"react\";\nimport {\n  DOMProps,\n  KeyboardDelegate,\n  KeyboardEvent,\n  Node,\n} from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { TreeKeyboardDelegate } from \"./TreeKeyboardDelegate\";\nimport { useCollectionAutoScroll } from \"../Collections/useCollectionAutoScroll\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeContextType } from \"./TreeContext\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\nimport { FocusEvents } from \"@react-types/shared/src/events\";\nimport { FocusStrategy } from \"@react-types/shared/src/selection\";\nimport { groupBy } from \"ramda\";\nimport {\n  CollectionFocusProxyProps,\n  useCollectionFocusProxy,\n} from \"@intellij-platform/core/Collections\";\n\nexport interface SelectableTreeProps<T>\n  extends DOMProps,\n    Omit<FocusEvents, \"onFocusChange\">,\n    CollectionFocusProxyProps {\n  isVirtualized?: boolean;\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Called when the action associated with a leaf tree node should be taken.\n   * The exact UI interaction is abstracted away, but it's either Enter key or double click.\n   */\n  onAction?: (key: Key) => void;\n  onNodeKeyDown?: (event: KeyboardEvent, node: Node<T>) => void;\n\n  allowEmptySelection?: boolean;\n\n  autoFocus?: boolean | FocusStrategy;\n\n  showAsFocused?: boolean;\n}\n\n/**\n * NOTE: at the time of writing this hook, react-aria didn't have support for Tree. When useTree is implemented in\n * react-aria, it makes sense to refactor this and use that. There will still be something on top of it here.\n */\nexport function useSelectableTree<T>(\n  {\n    onAction,\n    onFocus,\n    onBlur,\n    autoFocus,\n    showAsFocused,\n    focusProxyRef,\n    ...props\n  }: SelectableTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const domProps = filterDOMProps(props);\n  const collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n\n  const [focused, setFocused] = useState(false);\n  const {\n    collectionProps: {\n      // preventDefault in onMouseDown prevents collection from getting focused.\n      // Maybe it should be removed from useSelectableCollection, now that it lives here\n      onMouseDown,\n      onKeyDown: selectionKeyDown,\n      ...collectionProps\n    },\n  } = useSelectableCollection({\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    selectOnFocus: true,\n    autoFocus,\n    keyboardDelegate: useMemo(\n      () =>\n        props.keyboardDelegate ||\n        new TreeKeyboardDelegate(\n          state.collection,\n          state.disabledKeys,\n          ref,\n          collator\n        ),\n      [state.collection, state.disabledKeys, props.keyboardDelegate]\n    ),\n  });\n\n  useCollectionFocusProxy({\n    collectionRef: ref,\n    state,\n    onAction,\n    focusProxyRef,\n  });\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  useCollectionAutoScroll(\n    {\n      isVirtualized: props.isVirtualized,\n      selectionManager: state.selectionManager,\n    },\n    ref\n  );\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    const focusedKey = state.selectionManager.focusedKey;\n    const focusedItem = focusedKey\n      ? state.collection.getItem(focusedKey)\n      : null;\n    if (focusedItem) {\n      const isExpandable = Boolean(focusedItem?.hasChildNodes);\n      const expanded = state.expandedKeys.has(focusedKey);\n      const isDisabled = state.disabledKeys.has(focusedKey);\n      if (isDisabled) {\n        event.continuePropagation();\n        return;\n      }\n      props?.onNodeKeyDown?.(event, focusedItem);\n      const shouldToggle =\n        !hasAnyModifier(event) &&\n        (event.key === \"Enter\" ||\n          (event.key === \"ArrowLeft\" && expanded) ||\n          (event.key === \"ArrowRight\" && !expanded));\n      if (isExpandable && shouldToggle) {\n        event.preventDefault();\n        state.toggleKey(focusedKey);\n        return;\n      } else if (event.key === \"Enter\") {\n        onAction?.(focusedKey);\n        return;\n      }\n    }\n    // selectionKeyDown currently doesn't report back if it handled the event or not. We could have conditionally\n    // continued propagation if the event was not handled. Then we could change Speed Search impl to only handle\n    // inputs when the propagation is not prevented.\n    // Also, selectionKeyDown is not accurate in handling actions like \"select all\". e.g. it takes 'cmd+shift+a' too,\n    // as select all which can conflict with action system. So we don't call it if there are multiple modifiers.\n    const hasAtMostOneModifier =\n      [event.metaKey, event.ctrlKey, event.shiftKey, event.altKey].filter(\n        (i) => i\n      ).length < 2;\n    if (hasAtMostOneModifier) {\n      selectionKeyDown?.(event);\n    }\n    event.continuePropagation();\n  };\n  const { keyboardProps } = useKeyboard({\n    onKeyDown,\n  });\n\n  //////////////////////////////// providing context value ////////////////////////////////\n  const onActionRef = useLatest(onAction);\n\n  const {\n    selectionManager,\n    collection,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n  } = state;\n  const treeContext = useMemo<TreeContextType<T>>(\n    () => ({\n      state: {\n        collection,\n        selectionManager,\n        expandedKeys,\n        disabledKeys,\n        toggleKey,\n      },\n      focused: Boolean(focused || showAsFocused),\n      onActionRef,\n    }),\n    [\n      selectionManager,\n      collection,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n      focused,\n      showAsFocused,\n      onActionRef,\n    ]\n  );\n  ////////////////////////////////////////////////////////////////////////////////////////\n  useSelectParentOfRemovedSelectedNode(state);\n\n  return {\n    // order of merging here is important. navigation handling should precede selection handling\n    treeProps: mergeProps(\n      focusWithinProps,\n      collectionProps,\n      keyboardProps,\n      domProps,\n      { onFocus, onBlur, role: \"tree\" }\n    ),\n    treeContext,\n    focused,\n  };\n}\n\n/**\n * When a selected node is removed from the tree, selects the parent of the removed node\n * if no other node is selected.\n *\n * Note: this behavior is observed in a couple of tree views, including project files tree.\n * There could be an option for disabling/enabling it, if use cases comes up in future\n * where this behavior causes issues.\n */\nconst useSelectParentOfRemovedSelectedNode = (state: TreeState<unknown>) => {\n  const previousCollectionRef = useRef(state.collection);\n  useEffect(() => {\n    if (state.selectionManager.rawSelection !== \"all\") {\n      const keys = [...state.collection.getKeys()];\n\n      const { invalid = [], valid = [] } = groupBy(\n        (selectedKey) => (keys.includes(selectedKey) ? \"valid\" : \"invalid\"),\n        [...state.selectionManager.selectedKeys]\n      );\n      if (valid.length === 0 && invalid.length > 0) {\n        for (let invalidKey of invalid) {\n          let key: Key | undefined = invalidKey;\n          while (key != undefined) {\n            if (keys.includes(key)) {\n              state.selectionManager.setSelectedKeys(valid.concat(key));\n              state.selectionManager.setFocusedKey(key);\n              return;\n            }\n            key =\n              previousCollectionRef.current.getItem(key)?.parentKey ??\n              undefined;\n          }\n        }\n      }\n    }\n    previousCollectionRef.current = state.collection;\n  }, [state.collection]);\n};\n","import { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { CacheInvalidationContext } from \"./Item\";\n\nexport interface CollectionCacheInvalidationProps {\n  /**\n   * Defines cache invalidation policy for items. By default, the render result is cached based on the item objects.\n   * This is equivalent of passing false or not passing anything for `cacheInvalidation`. If `true` is passed, it will\n   * always invalidate the render result, causing the collection to be recreated on each re-render. It can\n   * considerably affect performance in large collections. in addition to boolean value, an object with the list of\n   * invalidators can also be passed. renderer function is called each time any of the invalidators are changed.\n   * Think of it as [dependency array in react hooks](https://reactjs.org/docs/hooks-reference.html#usememo). Except\n   * that the length of the array can also safely change.\n   */\n  cacheInvalidation?: boolean | { invalidators: ReadonlyArray<unknown> };\n}\n\n/**\n * Allows cache invalidation options based on input props, for components that use collection\n */\nexport const useCollectionCacheInvalidation = ({\n  cacheInvalidation,\n}: CollectionCacheInvalidationProps): CacheInvalidationContext => {\n  const invalidators =\n    typeof cacheInvalidation === \"object\" ? cacheInvalidation.invalidators : [];\n  const lastInvalidators = usePrevious(invalidators);\n\n  const invalidated =\n    typeof cacheInvalidation === \"object\"\n      ? cacheInvalidation.invalidators.length !== lastInvalidators.length ||\n        cacheInvalidation.invalidators.some(\n          (anInvalidator, index) => anInvalidator !== lastInvalidators[index]\n        )\n      : cacheInvalidation;\n\n  return {\n    invalidated,\n  };\n};\n","//@ts-nocheck\n/**\n * Not exported from @react-stately/tree, but needed in the custom implementation of useTreeState\n */\n\nimport { Key } from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\n\nexport class TreeCollection<T> implements Collection<Node<T>> {\n  private keyMap: Map<Key, Node<T>> = new Map();\n  private iterable: Iterable<Node<T>>;\n  private firstKey: Key;\n  private lastKey: Key;\n\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys?: Set<Key> } = {}\n  ) {\n    this.iterable = nodes;\n    expandedKeys = expandedKeys || new Set();\n\n    let visit = (node: Node<T>) => {\n      this.keyMap.set(node.key, node);\n\n      if (\n        node.childNodes &&\n        (node.type === \"section\" || expandedKeys.has(node.key))\n      ) {\n        for (let child of node.childNodes) {\n          visit(child);\n        }\n      }\n    };\n\n    for (let node of nodes) {\n      visit(node);\n    }\n\n    let last: Node<T>;\n    let index = 0;\n    for (let [key, node] of this.keyMap) {\n      if (last) {\n        last.nextKey = key;\n        node.prevKey = last.key;\n      } else {\n        this.firstKey = key;\n        node.prevKey = undefined;\n      }\n\n      if (node.type === \"item\") {\n        node.index = index++;\n      }\n\n      last = node;\n\n      // Set nextKey as undefined since this might be the last node\n      // If it isn't the last node, last.nextKey will properly set at start of new loop\n      last.nextKey = undefined;\n    }\n\n    this.lastKey = last?.key;\n  }\n\n  *[Symbol.iterator]() {\n    yield* this.iterable;\n  }\n\n  get size() {\n    return this.keyMap.size;\n  }\n\n  getKeys() {\n    return this.keyMap.keys();\n  }\n\n  getKeyBefore(key: Key) {\n    let node = this.keyMap.get(key);\n    return node?.prevKey ?? null;\n  }\n\n  getKeyAfter(key: Key) {\n    let node = this.keyMap.get(key);\n    return node?.nextKey ?? null;\n  }\n\n  getFirstKey() {\n    return this.firstKey;\n  }\n\n  getLastKey() {\n    return this.lastKey;\n  }\n\n  getItem(key: Key) {\n    return this.keyMap.get(key) ?? null;\n  }\n\n  at(idx: number) {\n    const keys = [...this.getKeys()];\n    return this.getItem(keys[idx]);\n  }\n}\n","import { Node } from \"@react-types/shared\";\nimport { Key } from \"react\";\n\n/**\n * given a node, returns keys of all consecutive single children\n */\nexport function getSingleChildrenKeys<T>(\n  node: Node<T> | null | undefined\n): Key[] {\n  return getSingleChildrenKeysRecursive(node, []);\n}\n\nfunction getSingleChildrenKeysRecursive<T>(\n  node: Node<T> | null | undefined,\n  previousKeys: Key[]\n): Key[] {\n  if (!node) {\n    return [];\n  }\n  const childNodesIterator: Iterator<\n    Node<T>,\n    Node<T> | undefined\n  > = node.childNodes[Symbol.iterator]();\n  const { value: firstChild, done } = childNodesIterator.next();\n  const noMoreChildren = done || childNodesIterator.next().value == null;\n  if (firstChild != null && noMoreChildren && isExpandable(firstChild)) {\n    return getSingleChildrenKeysRecursive(\n      firstChild,\n      previousKeys.concat((firstChild as Node<T>).key)\n    );\n  }\n  return previousKeys;\n}\n\nconst isExpandable = <T>(node: Node<T>) =>\n  node.hasChildNodes || !isEmptyIterable(node.childNodes);\n\nfunction isEmptyIterable(iterable: Iterable<unknown> | undefined | null) {\n  for (const _ of iterable || []) {\n    // eslint-disable-line no-unused-vars, no-unreachable-loop\n    return false;\n  }\n  return true;\n}\n","import {\n  MultipleSelectionState,\n  SelectionManager,\n  SelectionManagerOptions,\n} from \"@react-stately/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key } from \"react\";\n\nexport class TreeSelectionManager extends SelectionManager {\n  private readonly collection: Collection<Node<unknown>>;\n\n  constructor(\n    collection: Collection<Node<unknown>>,\n    state: MultipleSelectionState,\n    options?: SelectionManagerOptions\n  ) {\n    super(collection, state, options);\n    this.collection = collection;\n  }\n\n  expandSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      if (node) {\n        const { expandKeys } = this.getExpandAndShrinkKeys(node);\n        if (expandKeys.length > 0) {\n          this.setSelectedKeys([...this.selectedKeys, ...expandKeys]);\n        }\n      }\n    }\n  }\n  shrinkSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      if (node) {\n        const { shrinkKeys } = this.getExpandAndShrinkKeys(node);\n        if (shrinkKeys.length > 0) {\n          this.setSelectedKeys(\n            [...this.selectedKeys].filter((key) => !shrinkKeys.includes(key))\n          );\n        }\n      }\n    }\n  }\n\n  private getExpandAndShrinkKeys(node: Node<unknown>) {\n    return this.recursivelyGetExpandAndShrinkKeys(\n      node,\n      [...this.collection.getKeys()],\n      null\n    );\n  }\n  /**\n   * Starting from a node, traverses the tree up, until it reaches the root of the fully selected subtree that includes\n   * the starting node. The root itself may or may not be selected. Returns:\n   * - keys to be added to selection, when expanding selection\n   * - keys to be removed from selection, when shrinking selection\n   */\n  private recursivelyGetExpandAndShrinkKeys(\n    node: Node<unknown>,\n    keys: Array<Key>,\n    previousChild: Key | null\n  ): { expandKeys: Key[]; shrinkKeys: Key[] } {\n    const parent =\n      node && node.parentKey ? this.collection.getItem(node.parentKey) : null;\n    const newKeys = keys.filter((key) => key !== previousChild);\n    const parentDescendants = parent\n      ? getAllDescendants(parent, newKeys).map(({ key }) => key)\n      : this.getAllRoots().flatMap((key) => {\n          const item = this.collection.getItem(key);\n          return key !== node.key && item\n            ? getAllDescendants(item, newKeys)\n                .map(({ key }) => key)\n                .concat(key)\n            : [];\n        });\n    if (parent && parentDescendants.every((key) => this.isSelected(key))) {\n      return this.recursivelyGetExpandAndShrinkKeys(parent, keys, node.key);\n    }\n    const descendants = getAllDescendants(\n      node,\n      keys.filter((key) => key !== previousChild)\n    ).map(({ key }) => key);\n\n    return {\n      expandKeys: descendants.some((key) => !this.isSelected(key))\n        ? descendants\n        : !this.isSelected(node.key)\n        ? [node.key]\n        : parentDescendants,\n      shrinkKeys:\n        parentDescendants.length > 0 &&\n        parentDescendants.every((key) => this.isSelected(key))\n          ? parentDescendants\n          : this.isSelected(node.key) && previousChild\n          ? [node.key]\n          : descendants.filter((key) => this.isSelected(key)),\n    };\n  }\n\n  private getAllRoots() {\n    return [...this.collection.getKeys()].filter(\n      (key) => this.collection.getItem(key)?.parentKey == null\n    );\n  }\n}\n\nfunction getAllDescendants<T>(\n  node: Node<T>,\n  stopKeys: Array<React.Key>\n): Node<T>[] {\n  const childNodes = (node.hasChildNodes ? [...node.childNodes] : []).filter(\n    (node) => stopKeys.includes(node.key)\n  );\n  return node.hasChildNodes\n    ? childNodes.concat(\n        childNodes.map((node) => getAllDescendants(node, stopKeys)).flat()\n      )\n    : [];\n}\n","import {\n  Collection,\n  CollectionStateBase,\n  Expandable,\n  MultipleSelection,\n  Node,\n} from \"@react-types/shared\";\nimport { TreeProps as _TreeProps, TreeState } from \"@react-stately/tree\";\nimport {\n  TreeRefValue,\n  useTreeRef,\n} from \"@intellij-platform/core/Tree/useTreeRef\";\nimport { ForwardedRef, Key, useCallback, useEffect, useMemo } from \"react\";\nimport { useMultipleSelectionState } from \"@react-stately/selection\";\nimport { useCollection } from \"@react-stately/collections\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  CollectionCacheInvalidationProps,\n  useCollectionCacheInvalidation,\n} from \"@intellij-platform/core/Collections/useCollectionCacheInvalidation\";\nimport { TreeCollection as _TreeCollection } from \"./__copied__TreeCollection\";\nimport { getSingleChildrenKeys } from \"./getSingleChildrenKeys\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport class TreeCollection<T> extends _TreeCollection<T> {\n  public readonly rootKeys: Key[];\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys: Set<Key> }\n  ) {\n    super(nodes, { expandedKeys });\n    this.rootKeys = Array.from(nodes).map(({ key }) => key);\n  }\n\n  getAllExpandableKeys(): Set<Key> {\n    const rootNodes = this.rootKeys\n      .map((key) => this.getItem(key))\n      .filter(notNull);\n    return this.recursivelyAddExpandableKeys(rootNodes, new Set<Key>());\n  }\n\n  private recursivelyAddExpandableKeys(\n    nodes: Iterable<Node<T>>,\n    result: Set<Key>\n  ) {\n    for (const node of nodes) {\n      if (node?.hasChildNodes) {\n        result.add(node.key);\n        this.recursivelyAddExpandableKeys(node.childNodes, result);\n      }\n    }\n    return result;\n  }\n}\nexport interface TreeProps<T>\n  extends CollectionStateBase<T, TreeCollection<T>>,\n    Expandable,\n    MultipleSelection,\n    CollectionCacheInvalidationProps {\n  childExpansionBehaviour?: \"multi\" | \"single\";\n}\n/**\n * Provides state management for tree-like components. Handles building a collection\n * of items from props, item expanded state, and manages multiple selection state.\n *\n * Similar to (and initially copied from) useTreeState from @react-stately/tree, but with the following changes:\n * - Supports exposing some imperative API via ref.\n *   Could be done via a wrapper too.\n * - Different onToggle implementation with two adjustments to match Intellij Platform:\n *   - Collapsing a key collapses all descendants as well.\n *   - Expanding a single-child node will recursively expand all single-child descendants.\n *   Couldn't be done with a wrapper in a clean and optimal way. Access to setExpandedKey is not provided. We would need\n *   to either maintain a new state for expanded keys and ignore the one returned from the wrapped hook, or\n *   inefficiently call the returned `toggleKey` function many times.\n * - Supports collection invalidation via CollectionCacheInvalidationProps\n *   Perhaps not the most important addition, but not possible to be done via a wrapper.\n * - Uses TreeSelectionManager instead of the default SelectionManager, which implements expand/shrink selection.\n *   Could be done in a wrapper, with a little hack. Would need to replace selection manager.\n * - returned `collection` is of type `TreeCollection` (which is an improved version of react-stately `TreeCollection`),\n *   instead of the more generic `Collection`.\n */\nexport function useTreeState<T extends object>(\n  { childExpansionBehaviour = \"multi\", ...props }: TreeProps<T>,\n  treeRef?: ForwardedRef<TreeRefValue>\n): TreeState<T> {\n  let [expandedKeys, setExpandedKeys] = useControlledState(\n    props.expandedKeys ? new Set(props.expandedKeys) : undefined!,\n    props.defaultExpandedKeys ? new Set(props.defaultExpandedKeys) : new Set(),\n    props.onExpandedChange!\n  );\n\n  let selectionState = useMultipleSelectionState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  let disabledKeys = useMemo(\n    () => (props.disabledKeys ? new Set(props.disabledKeys) : new Set<Key>()),\n    [props.disabledKeys]\n  );\n\n  const context = useCollectionCacheInvalidation(props);\n\n  let tree = useCollection<T, TreeCollection<T>>(\n    props,\n    useCallback(\n      (nodes) => new TreeCollection(nodes, { expandedKeys }),\n      [expandedKeys]\n    ),\n    context\n  );\n\n  const selectionManager = new TreeSelectionManager(\n    tree as Collection<Node<T>>,\n    selectionState\n  );\n\n  useTreeRef({ selectionManager, setExpandedKeys, tree }, treeRef);\n\n  // Reset focused key if that item is deleted from the collection.\n  useEffect(() => {\n    if (\n      selectionState.focusedKey != null &&\n      !tree.getItem(selectionState.focusedKey)\n    ) {\n      // @ts-expect-error imprecise typing in @react-stately/selection\n      selectionState.setFocusedKey(null);\n    }\n  }, [tree, selectionState.focusedKey]);\n\n  const toggleKey = (key: Key) => {\n    let newExpandedKeys = toggleTreeNode(\n      tree as Collection<Node<T>>,\n      expandedKeys,\n      key\n    );\n    if (childExpansionBehaviour === \"single\") {\n      const expandedSiblings = getSiblings(tree, key).filter(\n        (aKey) => aKey !== key && expandedKeys.has(aKey)\n      );\n      newExpandedKeys = expandedSiblings.reduce((expandedKeys, expandedKey) => {\n        return toggleTreeNode(\n          tree as Collection<Node<T>>,\n          expandedKeys,\n          expandedKey\n        );\n      }, newExpandedKeys);\n    }\n    setExpandedKeys(newExpandedKeys);\n  };\n\n  return {\n    collection: tree as Collection<Node<T>>,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n    selectionManager,\n    setExpandedKeys,\n  };\n}\n\nfunction getChildItems<T>(node: Node<T>): Node<T>[] {\n  const childNodes = [...(node.childNodes || [])];\n  const childItems = childNodes.filter(({ type }) => type === \"item\");\n  const sectionItems = childNodes.filter(({ type }) => type === \"section\");\n\n  return childItems.concat(sectionItems.flatMap(getChildItems));\n}\n\nfunction getRootItemKeys(tree: TreeCollection<unknown>) {\n  return tree.rootKeys\n    .map((key) => tree.getItem(key))\n    .filter(notNull)\n    .flatMap(getChildItems)\n    .map(({ key }) => key);\n}\n/**\n * Returns the siblings of an item in tree, ignoring sections.\n * Disclaimer: The code is done quick and dirty and in a rush. Unpleasant code, good candidate for refactoring :D\n */\nfunction getSiblings(tree: TreeCollection<unknown>, key: Key): Key[] {\n  const parentKey = tree.getItem(key)?.parentKey;\n  if (!parentKey) {\n    return [...tree.rootKeys].concat(getRootItemKeys(tree));\n  }\n  let parent = parentKey ? tree.getItem(parentKey) : null;\n  if (parent?.type === \"item\") {\n    return getChildItems(parent).map(({ key }) => key);\n  }\n  const siblings: Key[] = [];\n  while (parent) {\n    siblings.push(...getChildItems(parent).map(({ key }) => key));\n    if (parent.type === \"section\") {\n      if (parent.parentKey) {\n        parent = tree.getItem(parent.parentKey);\n      } else {\n        siblings.push(...getRootItemKeys(tree));\n        parent = null;\n      }\n    } else {\n      parent = null;\n    }\n  }\n  return Array.from(new Set(siblings));\n}\nfunction toggleTreeNode(\n  tree: Collection<Node<unknown>>,\n  expandedKeys: Set<Key>,\n  key: Key\n): Set<Key> {\n  // toggling a non-expandable node should be no-op\n  if (!expandedKeys.has(key) && !tree.getItem(key)?.hasChildNodes) {\n    return expandedKeys;\n  }\n  const newKeys = toggleKey(expandedKeys, key);\n  // In Intellij impl, when a node is collapsed, all descendants are also collapsed. In other words, keys that are\n  // not a part of the list of visible nodes, will be excluded from the expanded keys, with the toggle action.\n  for (const aKey of newKeys) {\n    if (tree.getItem(aKey) == null) {\n      newKeys.delete(aKey);\n    }\n  }\n\n  // If we are toggling it open, expand all expandable single-child items\n  if (newKeys.has(key)) {\n    for (const aKey of getSingleChildrenKeys(tree.getItem(key))) {\n      newKeys.add(aKey);\n    }\n  }\n  return newKeys;\n}\n\nfunction toggleKey(set: Set<Key>, key: Key): Set<Key> {\n  let res = new Set(set);\n  if (res.has(key)) {\n    res.delete(key);\n  } else {\n    res.add(key);\n  }\n\n  return res;\n}\n","import { ForwardedRef, Key, useImperativeHandle } from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeSelectionManager } from \"./TreeSelectionManager\";\nimport { TreeCollection } from \"./useTreeState\";\n\nexport interface TreeRefValue {\n  focus(key: Key): void;\n  replaceSelection(key: Key): void;\n\n  /**\n   * Extends selection to all siblings of the currently focused node.\n   */\n  expandSelection(): void;\n  /**\n   * Shrinks selection towards currently focused node.\n   */\n  shrinkSelection(): void;\n\n  expandAll(): void;\n  collapseAll(): void;\n}\n\n/**\n * Sets up a tree ref for imperatively working with tree from outside. For imperatively focusing, expanding to\n * specific key, etc.\n */\nexport function useTreeRef<T extends {}>(\n  props: {\n    tree: TreeCollection<T>;\n    selectionManager: TreeSelectionManager;\n    setExpandedKeys: (keys: Set<Key>) => void;\n  },\n  forwardedRef?: ForwardedRef<TreeRefValue>\n) {\n  const latestState = useLatest(props);\n\n  useImperativeHandle(\n    forwardedRef,\n    () => {\n      return {\n        replaceSelection: (key: Key) => {\n          latestState.current.selectionManager.replaceSelection(key);\n        },\n        focus: (key: Key) => {\n          const selectionManager = latestState.current.selectionManager;\n          selectionManager.setFocused(true);\n          /**\n           * NOTE: we set focus key to null and set it to key again, to make sure scroll into view works even when\n           * the key is currently focused but not in view. It wouldn't be needed if there was an imperative handle\n           * for scrolling an item into view, but it's only implemented in way that is reactive to changes to the\n           * focused key. {@see useCollectionAutoScroll}\n           */\n          selectionManager.setFocusedKey(null);\n          setTimeout(() => {\n            selectionManager.setFocusedKey(key);\n          });\n        },\n        expandSelection() {\n          latestState.current.selectionManager.expandSelection();\n        },\n        shrinkSelection() {\n          latestState.current.selectionManager.shrinkSelection();\n        },\n        expandAll() {\n          latestState.current.setExpandedKeys(\n            latestState.current.tree.getAllExpandableKeys()\n          );\n        },\n        collapseAll() {\n          const { tree, setExpandedKeys, selectionManager } =\n            latestState.current;\n          const focusedKey = selectionManager.focusedKey;\n          setExpandedKeys(new Set());\n\n          // Find the root node that is a grandparent of focused node, and focus/select it.\n          // NOTE: this behaviour of updating selection when nodes are collapsed is something to be fixed in general,\n          // and then this custom logic here would be not necessary.\n          if (focusedKey && !tree.rootKeys.includes(focusedKey)) {\n            let item = tree.getItem(focusedKey);\n            while (item?.parentKey != null) {\n              item = tree.getItem(item.parentKey);\n            }\n            if (item) {\n              selectionManager.setFocusedKey(item.key);\n              if (selectionManager.isSelected(focusedKey)) {\n                selectionManager.select(item.key);\n              }\n            }\n          }\n        },\n      };\n    },\n    []\n  );\n}\n","import { HTMLAttributes, useMemo } from \"react\";\nimport { LayoutNode } from \"@react-stately/layout\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { VirtualizerProps } from \"@react-aria/virtualizer\";\nimport { LayoutInfo, Rect, Size } from \"@react-stately/virtualizer\";\nimport { VariableWidthListLayout } from \"@intellij-platform/core/VariableWidthListLayout\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nclass FlattenedTreeLayout<T> extends VariableWidthListLayout<T> {\n  buildChild(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildChild(node, x, y);\n    if (\n      node.parentKey &&\n      this.collection.getItem(node.parentKey)?.type === \"item\"\n    ) {\n      layoutNode.layoutInfo.parentKey = null;\n    }\n    return layoutNode;\n  }\n\n  doBuildCollection(): LayoutNode[] {\n    let y = this.padding;\n    let nodes = [];\n    /**\n     * The only difference here is that in tree, we need to use getKeys() to get the keys for a flattened list of items\n     * that are currently visible. With this difference only, things seem to work as expected, but sections are not\n     * tested, and not even sure if they would be applicable for Tree view.\n     * Diff compared to ListView#BuildCollection:\n     * -        for (let node of this.collection) {\n     * +        const visibleNodes = [...this.collection.getKeys()].map(key => this.collection.getItem(key));\n     * +        for (let node of visibleNodes) {\n     * This needs to be maintained with version upgrades, until TreeLayout is supported:\n     * https://github.com/adobe/react-spectrum/issues/2396\n     */\n    const visibleNodes = [...this.collection.getKeys()]\n      .map((key) => this.collection.getItem(key))\n      .filter(notNull);\n    for (let node of visibleNodes) {\n      let layoutNode = this.buildChild(node, 0, y);\n      y = layoutNode.layoutInfo.rect.maxY;\n      nodes.push(layoutNode);\n    }\n\n    if (this.isLoading) {\n      let rect = new Rect(\n        0,\n        y,\n        this.virtualizer.visibleRect.width,\n        this.loaderHeight ?? this.virtualizer.visibleRect.height\n      );\n      let loader = new LayoutInfo(\"loader\", \"loader\", rect);\n      this.layoutInfos.set(\"loader\", loader);\n      nodes.push({ layoutInfo: loader });\n      y = loader.rect.maxY;\n    }\n\n    if (nodes.length === 0) {\n      let rect = new Rect(\n        0,\n        y,\n        this.virtualizer.visibleRect.width,\n        this.placeholderHeight ?? this.virtualizer.visibleRect.height\n      );\n      let placeholder = new LayoutInfo(\"placeholder\", \"placeholder\", rect);\n      this.layoutInfos.set(\"placeholder\", placeholder);\n      nodes.push({ layoutInfo: placeholder });\n      y = placeholder.rect.maxY;\n    }\n\n    this.contentSize = new Size(\n      this.virtualizer.visibleRect.width,\n      y + this.padding\n    );\n    return nodes;\n  }\n\n  getVisibleLayoutInfos(rect: Rect): LayoutInfo[] {\n    return super\n      .getVisibleLayoutInfos(rect)\n      .filter((layoutInfo) => this.collection.getItem(layoutInfo.key) != null);\n  }\n}\n\nexport const useTreeVirtualizer = <T extends object>({\n  state,\n}: {\n  state: TreeState<T>;\n}): {\n  virtualizerProps: Omit<\n    VirtualizerProps<any, unknown>,\n    \"children\" | keyof HTMLAttributes<HTMLElement>\n  >;\n} => {\n  const layout = useMemo(\n    () =>\n      new FlattenedTreeLayout({\n        /**\n         * there is currently no documentation available for these fields, but setting `rowHeight` enforces it, which\n         * wouldn't be good for custom tree UI with a different row height.\n         * wrong estimatedRowHeight seems to only affect small scrollbar position inaccuracy, which is a minor issue\n         * and not even noticeable in most cases. Also, it seems it slightly improves the performance if it exactly\n         * matches the real row height. But not even sure.\n         */\n        estimatedRowHeight: 20,\n      }),\n    []\n  );\n  layout.collection = state.collection;\n  layout.disabledKeys = state.disabledKeys;\n\n  return {\n    virtualizerProps: {\n      focusedKey: state.selectionManager.focusedKey,\n      collection: state.collection,\n      layout,\n      // Not clear how this sizeToFit is supposed to work, due to lack of documentation, but don't be tempted to\n      // think it solves the problem VariableWidthListLayout is trying to solve, because it doesn't :D\n      // Also, note that setting this to \"width\" prevents re-layout when container width is increased, which\n      // causes issues.\n      sizeToFit: \"height\",\n      scrollToItem: (key) => {\n        return layout.virtualizer.scrollToItem(key, {\n          shouldScrollX: false,\n          duration: 0,\n        });\n      },\n      scrollDirection: \"both\",\n    },\n  };\n};\n","import React, { RefObject } from \"react\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TreeRefValue } from \"@intellij-platform/core/Tree\";\n\n/**\n * Returns action definitions object for common tree actions\n * TODO: add example in docs\n */\nexport function useTreeActions({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): Array<ActionDefinition> {\n  return [\n    {\n      id: CommonActionId.EXPAND_ALL,\n      title: \"Expand All\",\n      icon: <PlatformIcon icon=\"actions/expandall\" />,\n      actionPerformed: () => {\n        treeRef.current?.expandAll();\n      },\n    },\n    {\n      id: CommonActionId.COLLAPSE_ALL,\n      title: \"Collapse All\",\n      icon: <PlatformIcon icon=\"actions/collapseall\" />,\n      actionPerformed: () => {\n        treeRef.current?.collapseAll();\n      },\n    },\n    {\n      id: CommonActionId.EXPAND_SELECTION,\n      title: \"Expand Selection\",\n      actionPerformed: () => {\n        treeRef.current?.expandSelection();\n      },\n    },\n    {\n      id: CommonActionId.SHRINK_SELECTION,\n      title: \"Shrink Selection\",\n      // TODO: disable if selection is only one item. Would need more data from treeRef. Maybe after treeRef is refactored\n      //  to implement/extend CollectionRef\n      actionPerformed: () => {\n        treeRef.current?.shrinkSelection();\n      },\n    },\n  ];\n}\n","import { Key } from \"react\";\n\ninterface SetState<T> {\n  items: Iterable<T>;\n\n  toggle(key: T): void;\n\n  add(...key: T[]): void;\n\n  delete(...key: T[]): void;\n}\n\nexport type SelectionState = \"NotSelected\" | \"Selected\" | \"PartiallySelected\";\n\nexport interface TreeModel<T, K = Key> {\n  rootNodes: ReadonlyArray<T>;\n  getChildren: (root: T) => ReadonlyArray<T> | /*for convenience*/ T | null;\n  getKey: (item: T) => K;\n}\n\nexport interface NestedSelectionState<T> {\n  getSelectionState: (item: T) => SelectionState;\n  toggle: (item: T) => void;\n}\n\nconst collectSelectableItems = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>\n) => {\n  const collectedItems: T[] = [];\n  collectSelectableItemsRecursive(item, getChildren, collectedItems);\n  return collectedItems;\n};\nconst collectSelectableItemsRecursive = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>,\n  collectedItems: T[] = []\n) => {\n  const children = getChildren(item);\n  if (children == null) {\n    collectedItems.push(item);\n  } else {\n    children.forEach((child) =>\n      collectSelectableItemsRecursive(child, getChildren, collectedItems)\n    );\n  }\n};\n\n// TODO: maybe change the interface to work with keys instead of items?\nexport class NestedSelection<T extends object, K = Key>\n  implements NestedSelectionState<T>\n{\n  cache = new WeakMap<T, SelectionState>();\n  constructor(private state: SetState<K>, private tree: TreeModel<T, K>) {\n    this.tree = tree;\n    this.state = state;\n  }\n\n  toggle(item: T) {\n    const children = this.tree.getChildren(item);\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    if (isSelectableNode) {\n      this.state.toggle(key);\n    } else {\n      const state = this.getSelectionState(item);\n      const itemsInSubtree = collectSelectableItems(item, (item) =>\n        normalizeChildren(this.tree.getChildren(item))\n      ).map(this.tree.getKey);\n      if (state === \"Selected\") {\n        this.state.delete(...itemsInSubtree);\n      } else {\n        this.state.add(...itemsInSubtree);\n      }\n    }\n  }\n\n  getSelectionState(item: T): SelectionState {\n    // caching can be refactored into a nice little decorator like WeakMapCached which would be applicable on a method\n    // with a single object argument.\n    const cachedState = this.cache.get(item);\n    if (cachedState) {\n      return cachedState;\n    }\n    const children = normalizeChildren(this.tree.getChildren(item));\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    let state: SelectionState;\n    if (isSelectableNode) {\n      state = [...this.state.items].includes(key) ? \"Selected\" : \"NotSelected\";\n    } else {\n      const allDescendantsStates = children.map((child) =>\n        this.getSelectionState(child)\n      );\n      if (allDescendantsStates.every((state) => state === \"NotSelected\")) {\n        state = \"NotSelected\";\n      } else {\n        state = allDescendantsStates.every((state) => state === \"Selected\")\n          ? \"Selected\"\n          : \"PartiallySelected\";\n      }\n    }\n    this.cache.set(item, state);\n    return state;\n  }\n}\n\nfunction normalizeChildren<T>(children: T | ReadonlyArray<T> | null) {\n  if (children) {\n    return ([] as ReadonlyArray<T>).concat(children);\n  }\n  return null;\n}\n","import React, { ForwardedRef } from \"react\";\nimport {\n  SpeedSearchTree,\n  SpeedSearchTreeProps,\n  TreeRefValue,\n} from \"@intellij-platform/core/Tree\";\nimport { NestedSelectionState } from \"./NestedSelection\";\n\n/**\n * Experimental wrapper component around SpeedSearchTree, which allows rendering {@link TreeNodeCheckbox} in nodes.\n *\n * See [design-decisions.md](../Tree/design-decisions.md) for more thoughts about how should different features\n * like this be supported.\n *\n * @alpha\n */\nexport const SpeedSearchTreeWithCheckboxes = React.forwardRef(\n  <T extends object>(\n    {\n      nestedSelection,\n      cacheInvalidation,\n      onNodeKeyDown,\n      ...props\n    }: SpeedSearchTreeProps<T> & {\n      nestedSelection: NestedSelectionState<T>;\n    },\n    ref: ForwardedRef<HTMLDivElement>\n  ): React.ReactElement => {\n    const otherInvalidators =\n      typeof cacheInvalidation === \"object\"\n        ? cacheInvalidation.invalidators\n        : [];\n    return (\n      <SpeedSearchTree\n        ref={ref}\n        {...props}\n        // instead of passing cacheInvalidation, a better approach could be to provide nestedSelection as context.\n        cacheInvalidation={{\n          invalidators: [nestedSelection, ...otherInvalidators],\n        }}\n        onNodeKeyDown={(event, item) => {\n          if (event.key === \" \" && item.value) {\n            nestedSelection.toggle(item.value);\n          }\n          onNodeKeyDown?.(event, item);\n        }}\n      />\n    );\n  }\n);\n","import React, { useContext } from \"react\";\nimport { Checkbox } from \"@intellij-platform/core/Checkbox\";\nimport { TreeContext } from \"@intellij-platform/core/Tree/TreeContext\";\nimport { SelectionState } from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport styled from \"styled-components\";\n\nexport type TreeNodeCheckboxProps<T extends unknown> = {\n  selectionState?: SelectionState;\n  selectItemOnPress?: boolean;\n  onToggle: () => void;\n  // maybe a isDisabled prop to be merged with isDisabled from the item?\n};\n\nconst StyledCheckboxWrapper = styled.span`\n  margin-right: 0.125rem;\n  display: inline-flex;\n`;\n\n/**\n * Checkbox to be used with {@link SpeedSearchTreeWithCheckboxes}. `SpeedSearchTreeWithCheckboxes` doesn't add the\n * checkboxes by default to the nodes, which makes it more flexible in terms of which nodes should have checkbox, or\n * it's exact placement within the tree rows.\n *\n * TreeNodeCheckbox renders a Checkbox with a few extras:\n * - `aria-label` set based on the encompassing item's textValue\n * - `isSelected` and `isIndeterminate` set based on `selectionState`\n * - `isDisabled` is set based in disabled state of the item.\n * - The encompassing item will be selected upon press, if `selectItemOnPress` is `true` (default is `true`).\n * - Small styling adjustment achieved by a wrapper StyledListIconWrapper.\n *\n * @see SpeedSearchTreeWithCheckboxes\n * @see useNestedSelectionState\n *\n * NOTE: this component currently uses TreeContext, to get a hold of selectionManager. If a more abstract component\n * like CollectionCheckbox is needed in the future, we can refactor TreeContext also to something more abstract like\n * CollectionContext which is provided by all such components like List, Tree or Table.\n */\nexport const TreeNodeCheckbox = <T extends unknown>({\n  selectionState,\n  onToggle,\n  selectItemOnPress = true,\n}: TreeNodeCheckboxProps<T>) => {\n  const treeContext = useContext(TreeContext);\n  const itemContext = useContext(ItemStateContext);\n  if (!itemContext) {\n    throw new Error(\"TreeNodeCheckbox is rendered outside tree nodes.\");\n  }\n\n  return (\n    <StyledCheckboxWrapper>\n      <Checkbox\n        preventFocus\n        aria-label={`Select ${itemContext.node.textValue}`}\n        isSelected={selectionState === \"Selected\"}\n        isIndeterminate={selectionState === \"PartiallySelected\"}\n        isDisabled={itemContext.isDisabled}\n        onChange={() => {\n          onToggle();\n          // this if and the whole need for treeContext could be avoided if event.stopPropagation() was not hard coded\n          // in useToggle: https://github.com/adobe/react-spectrum/blob/0d007bca9417c4b7b86fafd5842871bf997bd4c0/packages/@react-aria/toggle/src/useToggle.ts#L46\n          // An improvement could be to replace Checkbox with CheckboxIcon, and simply handle press on it (potential TODO)\n          if (treeContext && itemContext && selectItemOnPress) {\n            treeContext.state.selectionManager.setFocusedKey(\n              itemContext.node.key\n            );\n            treeContext.state.selectionManager.setFocused(true);\n            treeContext.state.selectionManager.setSelectedKeys([\n              itemContext.node.key,\n            ]);\n          }\n        }}\n      />\n    </StyledCheckboxWrapper>\n  );\n};\n","import { Key, useMemo } from \"react\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { useControllableSet } from \"@intellij-platform/core/utils/useSet\";\nimport {\n  NestedSelection,\n  NestedSelectionState,\n  TreeModel,\n} from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\n\n/**\n * A state management util for a selectable list of items with an arbitrary nested grouping. In other words,\n * it manages selection of leaves in a tree.\n *\n * tree is represented as a `getChildren` function that returns children for a given root. if null is passed it\n * returns the top level nodes.\n * Important Note: the tree structure that can be generated by calling `getChildren` function is supposed to be\n * **immutable**. in other words, any change in the tree, should result in a new array of top level items.\n */\n\nexport const useNestedSelectionState = <T extends object, K = Key>(\n  tree: TreeModel<T, K>,\n  {\n    selectedKeys: selectedKeysProp,\n    defaultSelectedKeys,\n    onSelectedKeysChange,\n  }: ControlledStateProps<{\n    selectedKeys: Set<K>;\n  }>\n): NestedSelectionState<T> => {\n  const [selectedKeys, selectedKeysSetter] = useControllableSet(\n    selectedKeysProp!, // bad typing in useControlledState\n    defaultSelectedKeys || new Set(),\n    onSelectedKeysChange! // bad typing in useControlledState\n  );\n  const treeRef = useLatest(tree);\n\n  return useMemo(\n    () =>\n      new NestedSelection<T, K>(\n        { items: selectedKeys, ...selectedKeysSetter },\n        treeRef.current\n      ),\n    [selectedKeys, tree.rootNodes]\n  );\n};\n","import {\n  LayoutNode,\n  ListLayout,\n  ListLayoutOptions,\n} from \"@react-stately/layout\";\nimport React, { Key } from \"react\";\nimport {\n  InvalidationContext,\n  LayoutInfo,\n  Rect,\n  Size,\n} from \"@react-stately/virtualizer\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Extends `ListLayout` and allows items of the list to have width based on the content. `ListLayout` by default\n * sets width based on the virtualizer's visible rect. This means the overflow of list items will be clipped.\n * In `VariableWidthListLayout`, the width of the list depends on the content of the visible items.\n *\n * NOTE: At the time of writing this class, Virtualization in @react-aria and @react-stately don't have proper\n * documentation, and it wasn't clear if there could be better ways of letting list's width grow based on the content.\n * Also, this implementation currently lacks support for sections. `buildSection()` would most probably need to be\n * overridden like how `buildItem` is.\n */\nexport class VariableWidthListLayout<T> extends ListLayout<T> {\n  /**\n   * content width of items are stored here, if the content width is bigger than the Virtualizer's visible rect's width.\n   */\n  keyToWidth = new Map<Key, number>();\n  private visibleContentWidth: number = 0;\n  private dividerHeight: number = 2;\n\n  constructor(options: ListLayoutOptions<T> & { dividerHeight?: number }) {\n    super(options);\n    if (options.dividerHeight != undefined) {\n      this.dividerHeight = options.dividerHeight;\n    }\n  }\n\n  buildItem(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildItem(node, x, y);\n    if (this.visibleContentWidth) {\n      layoutNode.layoutInfo.rect.width = this.visibleContentWidth;\n    }\n    return layoutNode;\n  }\n\n  buildNode(node: Node<T>, x: number, y: number): LayoutNode {\n    if (node.type === \"divider\") {\n      return this.buildDivider(node, x, y);\n    }\n    return super.buildNode(node, x, y);\n  }\n\n  buildDivider(node: Node<T>, x: number, y: number): LayoutNode {\n    let width = this.virtualizer.visibleRect.width;\n    let rectHeight = this.dividerHeight;\n\n    let rect = new Rect(x, y, width - x, rectHeight);\n    let layoutInfo = new LayoutInfo(node.type, node.key, rect);\n    layoutInfo.estimatedSize = false;\n    return {\n      layoutInfo,\n      // validRect: layoutInfo.rect,\n    };\n  }\n\n  /**\n   * Allows for overriding buildCollection in a sub-class\n   */\n  protected doBuildCollection() {\n    return super.buildCollection();\n  }\n\n  buildCollection(): LayoutNode[] {\n    this.visibleContentWidth = this.getVisibleContentWidth();\n    // in buildChild, if invalidateEverything is false and y is not changed, it will reuse the existing layoutInfo.\n    // which can be problematic, if it was created in a time when the visible content width was different.\n    // A more efficient approach (instead of rebuilding the whole collection), might be to set layout width to\n    // visibleContentWidth, in getVisibleLayoutInfos, if mutation is ok.\n    // UPDATE: using getFinalLayoutInfo seems to be a legitimate last minute way to mutate layout infos.\n    this.invalidateEverything =\n      this.contentSize?.width !== this.visibleContentWidth;\n    const layoutNodes = this.doBuildCollection();\n    this.contentSize.width = this.visibleContentWidth;\n    return layoutNodes;\n  }\n\n  shouldInvalidate(newRect: Rect, oldRect: Rect): boolean {\n    return (\n      super.shouldInvalidate(newRect, oldRect) ||\n      this.getVisibleContentWidth() !== this.visibleContentWidth\n    );\n  }\n\n  // Setting lastWidth doesn't seem to be important, but we set it based on the content anyway.\n  validate(invalidationContext: InvalidationContext<Node<T>, unknown>) {\n    super.validate(invalidationContext);\n    this.lastWidth = this.contentSize.width;\n  }\n\n  updateItemSize(key: React.Key, size: Size): boolean {\n    const changed = super.updateItemSize(key, size);\n    const layoutInfo = this.layoutInfos.get(key);\n    if (layoutInfo && size.width > this.contentSize.width) {\n      this.keyToWidth.set(key, size.width);\n      return true;\n    } else {\n      this.keyToWidth.delete(key);\n      return changed;\n    }\n  }\n\n  private getVisibleContentWidth() {\n    return Math.max(\n      this.virtualizer.visibleRect.width,\n      ...this.virtualizer.visibleViews.map((view) => {\n        const layoutInfo = view.layoutInfo;\n        const itemContentWidth =\n          layoutInfo && this.keyToWidth.get(layoutInfo.key);\n        if (\n          itemContentWidth &&\n          layoutInfo.rect.intersects(this.virtualizer.getVisibleRect())\n        ) {\n          return itemContentWidth;\n        }\n        return 0;\n      })\n    );\n  }\n}\n","export function isWordSeparator(c: string) {\n  return (\n    isWhitespace(c) || c == \"_\" || c == \"-\" || c == \":\" || c == \"+\" || c == \".\"\n  );\n}\n\nexport function isWhitespace(char: string): boolean {\n  return /^\\s*$/.test(char);\n}\n\nexport function isUpperCase(str: string) {\n  return str.toUpperCase() === str && str.toLowerCase() !== str;\n}\n","import { createRangesFromIndices, TextRange } from \"./TextRange\";\nimport {\n  isUpperCase,\n  isWhitespace,\n  isWordSeparator,\n} from \"./utils/string-utils\";\n\nfunction isMeaningfulChar(ch: string) {\n  return !isWordSeparator(ch) && !isWhitespace(ch);\n}\n\n// Simplified version of https://github.com/JetBrains/intellij-community/blob/master/platform/util/text-matching/src/com/intellij/psi/codeStyle/MinusculeMatcherImpl.java\nexport const minusculeMatch = (\n  input: string,\n  rawPattern: string\n): Array<TextRange> | null => {\n  const isStarts = input.split(\"\").map(isStart);\n  const pattern = rawPattern.split(\"\").filter(isMeaningfulChar).join(\"\");\n  const matches: Array<{ patternIndex: number; inputIndex: number }> = [];\n  let continuous = false;\n  let inputIndex = 0,\n    patternIndex = 0;\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    if (matches.length === pattern.length) {\n      return createRangesFromIndices(matches.map(({ inputIndex: i }) => i));\n    }\n    if (inputIndex > input.length - 1) {\n      if (matches.length > 0) {\n        // TODO: the same character match can be popped out and in several times, if something\n        //  is popped out, it should never be added back again, since it's already examined without\n        //  a full match.\n        const lastMatch = matches.pop()!;\n        inputIndex = lastMatch.inputIndex + 1;\n        patternIndex = lastMatch.patternIndex;\n        continue;\n      }\n      break;\n    }\n    if (!isMeaningfulChar(input[inputIndex])) {\n      inputIndex++;\n      continue;\n    }\n    if (\n      pattern[patternIndex].toLowerCase() === input[inputIndex].toLowerCase() &&\n      (continuous || isStarts[inputIndex] || matches.length === 0)\n    ) {\n      matches.push({ patternIndex, inputIndex });\n      continuous = true;\n      patternIndex++;\n      inputIndex++;\n    } else {\n      continuous = false;\n      inputIndex++;\n    }\n  }\n  return null;\n};\n\nfunction isStart(char: string, index: number, chars: string[]): boolean {\n  const previousChar = chars[index - 1];\n  return (\n    index === 0 ||\n    (isWordSeparator(previousChar) && !isWordSeparator(char)) ||\n    (isUpperCase(char) && !isUpperCase(previousChar))\n  );\n}\n","import { useEffect } from \"react\";\nimport { useSelectableCollection as useAriaSelectableCollection } from \"@react-aria/selection\";\n\n/**\n * Wrapper around react-aria useSelectableCollection to fix pending issues or\n * add missing functionality.\n */\nexport const useSelectableCollection: typeof useAriaSelectableCollection = (\n  options\n) => {\n  const {\n    collectionProps: { onKeyDown, ...collectionProps },\n  } = useAriaSelectableCollection(options);\n  useEffect(() => {\n    // Fixing https://github.com/adobe/react-spectrum/issues/4391\n    const { selectionManager, autoFocus, selectOnFocus } = options;\n    if (\n      selectOnFocus &&\n      (autoFocus === \"first\" || autoFocus === \"last\") &&\n      selectionManager.focusedKey != null\n    ) {\n      selectionManager.replaceSelection(selectionManager.focusedKey);\n    }\n\n    // Working around https://github.com/adobe/react-spectrum/issues/7512\n    // FIXME: remove the workaround the issue is closed\n    if (\n      selectionManager.firstSelectedKey &&\n      selectionManager.focusedKey == null\n    ) {\n      // initialize the focusedKey so that the buggy code that mutates selection\n      // onFocus doesn't get to run.\n      selectionManager.setFocusedKey(selectionManager.firstSelectedKey);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return {\n    collectionProps: {\n      ...collectionProps,\n      onKeyDown: (e) => {\n        // keydown events used to not be handled when alt key is pressed.\n        // it's changed in https://github.com/adobe/react-spectrum/commit/885b5e6b84253925b2ac9f7f2766417c63b654b5#diff-e356ae602508922357fd9cd1aa7896f74e24f87bcb2ee86a7bb4a486ea87a2f2R120\n        // handling keydown events when alt is down interferes with tree action shortcuts\n        // FIXME: make tree actions use capture phase to handle shortcuts so it takes precedence over\n        //  the default handlers regardless of what the shortcut is. Revert the patch here, after.\n        //  At the time of writing this, `useCapture` is only an option on ActionsProvider, but it\n        //  needs to be an option on each action, to allow for this use case.\n        if (!e.altKey) {\n          onKeyDown?.(e);\n        }\n      },\n    },\n  };\n};\n","import { useSelectableItem as useOriginalSelectableItem } from \"@react-aria/selection\";\nimport { MouseEventHandler } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\n/**\n * A wrapper around useSelectableItem, which adjusts for intellij platform nuances:\n * - Selects item with right clicks as well, which allows ContextMenuContainer to be used with any collection component\n *   without the need for built-in context-menu support in such components. We won't need this if we move to a built-in\n *   context-menu support for List,Tree, etc.\n * @private\n */\nexport const useSelectableItem: typeof useOriginalSelectableItem = (\n  options\n) => {\n  const onContextMenu: MouseEventHandler<HTMLElement> = (e) => {\n    if (!options.selectionManager.isSelected(options.key)) {\n      options.selectionManager.select(options.key);\n    }\n  };\n  const result = useOriginalSelectableItem(options);\n  return {\n    ...result,\n    itemProps: mergeProps(result.itemProps, { onContextMenu }),\n  };\n};\n","/**\n * Drop shadow of windows and other overlays.\n * The current value is not accurate and needs to be revisited. It should also be os-dependant.\n * FIXME: On windows, there is only a border-like shadow. No drop shadow\n * FIXME: On Mac, there is a border-like shadow and a drop shadow. the border-like shadow is missing in the current value\n */\nexport const WINDOW_SHADOW = \"box-shadow: 0 5px 15px rgb(0 0 0 / 30%)\";\n","import {\n  FocusManager,\n  FocusScope as WrappedFocusScope,\n  FocusScopeProps,\n  useFocusManager,\n} from \"@react-aria/focus\";\nimport React, { ForwardedRef, useImperativeHandle, useRef } from \"react\";\n\nexport type FocusScopeRef = { focus: (forceFocusFirst?: boolean) => void };\n/**\n * A version of FocusScope which also allows for imperatively moving focus to the scope.\n * and has tiny patches/improvements\n * It's useful for\n */\nexport const FocusScope = React.forwardRef(function BetterFocusScope(\n  { children, ...otherProps }: FocusScopeProps,\n  ref: ForwardedRef<FocusScopeRef>\n) {\n  const directChildRef = useRef<HTMLSpanElement>(null);\n  const focusManagerRef = useRef<FocusManager>(null);\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (forceFocusFirst?: boolean) => {\n        const focusManager = focusManagerRef.current;\n        const containerElement = directChildRef.current?.parentElement;\n        if (!focusManager) {\n          throw new Error(\"focus manager not found!\");\n        }\n        if (!containerElement) {\n          throw new Error(\"container element not found\");\n        }\n        if (forceFocusFirst) {\n          return focusManager.focusFirst();\n        }\n        const alreadyHasFocused =\n          document.activeElement &&\n          document.activeElement !== containerElement &&\n          containerElement.contains(document.activeElement);\n        if (!alreadyHasFocused) {\n          focusManager.focusNext({ tabbable: true });\n        }\n      },\n    }),\n    []\n  );\n\n  return (\n    <WrappedFocusScope {...otherProps}>\n      <GetFocusManager ref={focusManagerRef} />\n      <span data-focus-root-direct-child=\"\" hidden ref={directChildRef} />\n      {children}\n    </WrappedFocusScope>\n  );\n});\nconst GetFocusManager = React.forwardRef(function FocusScopeHandle(\n  props: {},\n  ref: ForwardedRef<FocusManager>\n) {\n  const focusManager = useFocusManager()!;\n  useImperativeHandle(ref, () => focusManager, [focusManager]);\n  return null;\n});\n","/**\n * Properly typed filter function for filtering out null/undefined items in array.\n */\nexport const notNull = <T>(\n  item: T | undefined | null\n): item is NonNullable<T> => item != null;\n","/**\n * IMPORTANT: this is a copy of a non-exported file from @react-aria/interactions\n */\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { runAfterTransition } from \"@react-aria/utils\";\n\n// Safari on iOS starts selecting text on long press. The only way to avoid this, it seems,\n// is to add user-select: none to the entire page. Adding it to the pressable element prevents\n// that element from being selected, but nearby elements may still receive selection. We add\n// user-select: none on touch start, and remove it again on touch end to prevent this.\n// This must be implemented using global state to avoid race conditions between multiple elements.\n\n// There are three possible states due to the delay before removing user-select: none after\n// pointer up. The 'default' state always transitions to the 'disabled' state, which transitions\n// to 'restoring'. The 'restoring' state can either transition back to 'disabled' or 'default'.\ntype State = \"default\" | \"disabled\" | \"restoring\";\n\nlet state: State = \"default\";\nlet savedUserSelect = \"\";\n\nexport function disableTextSelection() {\n  if (state === \"default\") {\n    savedUserSelect = document.documentElement.style.webkitUserSelect;\n    document.documentElement.style.webkitUserSelect = \"none\";\n  }\n\n  state = \"disabled\";\n}\n\nexport function restoreTextSelection() {\n  // If the state is already default, there's nothing to do.\n  // If it is restoring, then there's no need to queue a second restore.\n  if (state !== \"disabled\") {\n    return;\n  }\n\n  state = \"restoring\";\n\n  // There appears to be a delay on iOS where selection still might occur\n  // after pointer up, so wait a bit before removing user-select.\n  setTimeout(() => {\n    // Wait for any CSS transitions to complete so we don't recompute style\n    // for the whole page in the middle of the animation and cause jank.\n    runAfterTransition(() => {\n      // Avoid race conditions\n      if (state === \"restoring\") {\n        if (document.documentElement.style.webkitUserSelect === \"none\") {\n          document.documentElement.style.webkitUserSelect =\n            savedUserSelect || \"\";\n        }\n\n        savedUserSelect = \"\";\n        state = \"default\";\n      }\n    });\n  }, 300);\n}\n","import React, { MouseEventHandler } from \"react\";\nimport { disableTextSelection, restoreTextSelection } from \"./textSelection\";\nimport { useLatest } from \"../useLatest\";\n\n/**\n * To be used with {@link UseMoveOptions#canMoveStart} to allow\n * the move to start only on whitespaces. Does that by checking if the\n * element is an HTMLElement with all children being Elements.\n * This logic almost always detects the whitespaces properly, because if mouse\n * was pressed on a piece of text, the event target would have been that element.\n */\nexport function isEventOnEmptySpaces({\n  target,\n  currentTarget,\n}: React.MouseEvent) {\n  return (\n    currentTarget === target ||\n    (target instanceof HTMLElement &&\n      [...target.childNodes].every((child) => child instanceof HTMLElement))\n  );\n}\n\nexport type XY = { x: number; y: number };\nexport type UseMoveOptions<S> = {\n  /**\n   * the amount of movement (in pixels) after which the move should start. It prevents interference\n   * with simple click (or more generally, press) events, and provides better UX.\n   * @default 0\n   */\n  dragThreshold?: number;\n  disabled?: boolean;\n  /**\n   * Whether the move should be initiated from a mouse down event.\n   * Note: regardless of the value of this option, the move won't start when interactive elements like buttons\n   * are being pressed.\n   * @see isEventOnEmptySpaces\n   * @example\n   * ```ts\n   * // Don't move when children are being dragged.\n   * useMove({ canMoveStart: e => e.target === e.currentTarget });\n   * ```\n   *\n   * @example\n   * ```ts\n   * // move when empty spaces are being dragged.\n   * useMove({ canMoveStart: isEventOnEmptySpaces });\n   * ```\n   */\n  canMoveStart?: (eventTarget: React.MouseEvent) => boolean;\n  onMoveStart: (args: { from: XY }) => S;\n  onMove: (args: { from: XY; to: XY; movement: XY; startState: S }) => void;\n  onMoveEnd?: (args: { startState: S }) => void;\n};\n\n// TODO: cleanup if unmount happens during drag.\n// TODO: Better even handling for touch devices?\n//  wrapping `useMove` from react-aria to just add support for movement threshold should be the\n//  way to go, but there are a few problems:\n//    - it seemed a little buggy in the example here: https://react-spectrum.adobe.com/react-aria/useMove.html\n//    - the API is not great in a sense that it only gives the diff in last movement.\n//      Also onMoveStart doesn't give the initial position, so it's not possible to even calculate\n//\n// TODO: move should be finished by pressing Escape. onMoveCancel maybe?\n/**\n * Similar to https://react-spectrum.adobe.com/react-aria/useMove.html, with slightly different\n * features and API.\n * NOTE: initially the API was designed in a way that onMove and onMove end callbacks were\n * returned from onMoveStart, instead of being directly passed in the options.\n * This would enable capturing the initial state of each move transaction, by defining whatever\n * variable in onMoveStart and closing over them by onMove and onMoveEnd.\n * The problem with this approach was that although you could capture the initial state of the\n * movement, by closure, any other variable in the outer scopes was also closed over, and you were\n * stuck with the values from the particular render in which the movement was started.\n * Of course, you could work around it by using refs, but it would be unintuitive.\n * So because of that issue, it's redesigned to have onMoveStart, onMove, and onMoveEnd all\n * directly passed as options, but you can return anything from `onMoveStart` which will be passed\n * to onMove and onMoveEnd as `startState`.\n */\nexport function useMove<S>({\n  dragThreshold = 0,\n  disabled,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  canMoveStart = () => true,\n}: UseMoveOptions<S>): { onMouseDown?: MouseEventHandler } {\n  const handlersRef = useLatest({ onMove, onMoveEnd });\n\n  const onMouseDown = (event: React.MouseEvent) => {\n    if (event.button !== 0 || !canMoveStart(event)) {\n      return;\n    }\n    disableTextSelection();\n    const from = { x: event.pageX, y: event.pageY };\n    let dragStarted = false;\n    let startState: S;\n\n    const onMouseMove = (event: MouseEvent) => {\n      const { pageX: x, pageY: y } = event;\n      const movement = { x: x - from.x, y: y - from.y };\n      const isDraggedEnough =\n        Math.abs(movement.x) >= dragThreshold ||\n        Math.abs(movement.y) >= dragThreshold;\n      if (isDraggedEnough && !dragStarted) {\n        dragStarted = true;\n        startState = onMoveStart({ from });\n      }\n      if (dragStarted) {\n        handlersRef.current.onMove({\n          from,\n          to: { x: from.x + movement.x, y: from.y + movement.y },\n          movement,\n          startState,\n        });\n      }\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n\n    document.addEventListener(\n      \"mouseup\",\n      () => {\n        restoreTextSelection();\n        if (dragStarted) {\n          handlersRef.current.onMoveEnd?.({ startState });\n        }\n        document.removeEventListener(\"mousemove\", onMouseMove);\n      },\n      { once: true }\n    );\n  };\n  return disabled ? {} : { onMouseDown };\n}\n","import React from \"react\";\nimport { isMac } from \"@react-aria/utils\";\n\n/**\n * TODO: The current name is not accurate, and can be confusing. Rename to something better.\n */\nexport function isCtrlKeyPressed(\n  e: { metaKey: boolean; ctrlKey: boolean } | undefined\n) {\n  if (isMac()) {\n    return e?.metaKey;\n  }\n\n  return e?.ctrlKey;\n}\n\nexport function hasAnyModifier(e: KeyboardEvent | React.KeyboardEvent) {\n  return e.altKey || e.ctrlKey || e.metaKey || e.shiftKey;\n}\n","import { sortBy, uniqBy } from \"ramda\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport interface OverflowObserverRecord {\n  target: Element;\n  overflowedElements: Element[];\n  previouslyOverflowedElements: Element[];\n}\n\nexport type OverflowObserverCallback = (\n  change: OverflowObserverRecord,\n  observer: OverflowObserver\n) => void;\n\n/**\n * Allows observing the list of overflowing children of a given target element.\n * An `IntersectionObserver` is created for each target to observe the intersection between the target and each child\n * element. The child elements are observed/unobserved by the intersection observer as they are added/removed to the\n * DOM, which is observed using a `MutationObserver`.\n * `IntersectionObserver` options such as `rootMargin` are supported, to fine tune what should be considered as\n * overflowed.\n *\n * TODO: add a takeRecords method to allow processing pending mutations before disconnect\n * TODO: maybe add direction option?\n *\n */\nexport class OverflowObserver {\n  private mutationObserver: MutationObserver;\n  private data: Map<\n    Element,\n    {\n      intersectionObserver: IntersectionObserver;\n      currentOverflowElements: Element[];\n    }\n  > = new Map();\n\n  constructor(private callback: OverflowObserverCallback) {\n    this.mutationObserver = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        const target = mutation.target;\n        if (!(target instanceof Element)) {\n          return;\n        }\n        mutation.removedNodes.forEach((node) => {\n          if (node instanceof Element) {\n            this.data.get(target)?.intersectionObserver.unobserve(node);\n          }\n        });\n        mutation.addedNodes.forEach((node) => {\n          if (node instanceof Element) {\n            this.data.get(target)?.intersectionObserver.observe(node);\n          }\n        });\n      });\n    });\n  }\n\n  observe(target: Element, options: Omit<IntersectionObserverInit, \"root\">) {\n    this.data.get(target)?.intersectionObserver.disconnect();\n\n    const intersectionObserver = new IntersectionObserver(\n      (entries) => {\n        const data = this.data.get(target);\n        const sortedEntries = sortBy((entry) => -entry.time, entries);\n        const validEntries = uniqBy((entry) => entry.target, sortedEntries);\n\n        const newHiddenElements = validEntries\n          .map((entry) =>\n            !entry.isIntersecting && entry.target instanceof Element\n              ? entry.target\n              : undefined\n          )\n          .filter(notNull);\n        const newVisibleElements = validEntries\n          .map((entry) =>\n            entry.isIntersecting && entry.target instanceof Element\n              ? entry.target\n              : null\n          )\n          .filter(notNull);\n\n        //  Also cover this in Toolbar with a test case\n        const previouslyOverflowedElements =\n          data?.currentOverflowElements || [];\n        const overflowedElements = previouslyOverflowedElements\n          .filter((element) => !newVisibleElements.includes(element))\n          .concat(newHiddenElements)\n          .filter((element) => {\n            // In some cases some elements may be hidden by some styles (e.g. the first/last separator in a toolbar).\n            // It doesn't make sense to report them as overflowed.\n            const isHidden =\n              element instanceof HTMLElement &&\n              element.offsetWidth === 0 &&\n              element.offsetHeight === 0;\n            return !isHidden;\n          });\n        this.callback(\n          {\n            previouslyOverflowedElements,\n            overflowedElements: overflowedElements,\n            target,\n          },\n          this\n        );\n        if (data) {\n          data.currentOverflowElements = overflowedElements;\n        }\n      },\n      {\n        ...options,\n        root: target,\n      }\n    );\n    [...(target?.children || [])].forEach((childElement) => {\n      intersectionObserver.observe(childElement);\n    });\n    this.data.set(target, {\n      intersectionObserver,\n      currentOverflowElements: [],\n    });\n    this.mutationObserver.observe(target, {\n      childList: true,\n    });\n  }\n\n  unobserve(target: Element) {\n    this.data.get(target)?.intersectionObserver.disconnect();\n  }\n\n  disconnect() {\n    [...this.data.values()].forEach(({ intersectionObserver }) =>\n      intersectionObserver.disconnect()\n    );\n    this.data = new Map();\n    this.mutationObserver.disconnect();\n  }\n}\n","import { RefObject, useEffect, useState } from \"react\";\nimport { OverflowObserver } from \"@intellij-platform/core/utils/overflow-utils/OverflowObserver\";\n\n/**\n * Given a ref to a scrollable container, returns the child elements that are not completely visible and\n * are off view because of scroll.\n * @param scrollableContainerRef\n * @param threshold\n */\nexport function useOverflowObserver(\n  scrollableContainerRef: RefObject<HTMLElement>,\n  {\n    threshold = 0.9,\n    rootMargin = \"0px\",\n  }: Omit<IntersectionObserverInit, \"root\"> = {}\n) {\n  const [overflowedElements, setOverflowedElements] = useState<Element[]>([]);\n\n  useEffect(() => {\n    const overflowObserver = new OverflowObserver((change) => {\n      setOverflowedElements(change.overflowedElements);\n    });\n    overflowObserver.observe(scrollableContainerRef.current!, {\n      rootMargin,\n      threshold,\n    });\n    return () => {\n      overflowObserver.disconnect();\n    };\n  }, [\n    /**\n     * It's ok and needed to have the ref value as a dependency here. We don't know if ref is attached to different\n     * elements in each render, and it's ok that it's not a state, since we don't change it, and it's not supposed to\n     * change without a rerender\n     **/\n    scrollableContainerRef.current,\n  ]);\n\n  return {\n    overflowedElements,\n  };\n}\n","import { Key } from \"react\";\nimport { Ord } from \"ramda\";\n\ntype TreeNodeFn<T> = (root: T) => null | readonly T[];\ntype MutableTreeNodeFn<T> = (root: T) => null | T[];\n\ntype Tree<T> = {\n  getChildren: TreeNodeFn<T>;\n  roots: ReadonlyArray<T>;\n};\n\ntype MutableTree<T> = {\n  getChildren: MutableTreeNodeFn<T>;\n  roots: Array<T>;\n};\n\nexport const getExpandAllKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeNodeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key,\n  roots: ReadonlyArray<T>\n) => {\n  const keys: Key[] = roots.map(getKey);\n  const processItem = (node: T | null) => {\n    const children = node ? getChildren(node) : null;\n    if (node == null || !children) {\n      return;\n    }\n    keys.push(getKey(node));\n    children.forEach(processItem);\n  };\n  roots.map(getChildren).flat().forEach(processItem);\n  return keys;\n};\n\nexport const getExpandedToNodesKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeNodeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key,\n  roots: ReadonlyArray<T>,\n  targetNodeKeys: Iterable<Key>\n) => {\n  const targetNodeKeySet = new Set(targetNodeKeys);\n  const expandedKeys: Key[] = [];\n  dfsVisit<T, boolean>(\n    getChildren,\n    (node, childValues) => {\n      const key = getKey(node);\n      const isExpanded: boolean =\n        childValues?.some((childValue) => childValue) ||\n        targetNodeKeySet.has(key);\n      if (isExpanded) {\n        expandedKeys.push(key);\n      }\n      return isExpanded;\n    },\n    roots\n  );\n  return expandedKeys;\n};\n\nexport const dfsVisit = <T, R>(\n  getChildren: TreeNodeFn<T>,\n  visit: (node: T, childrenValues: null | R[]) => R,\n  roots: ReadonlyArray<T>\n) => {\n  const dfs = (node: T): R => {\n    const children = getChildren(node);\n    const values = children?.map(dfs) ?? null;\n    return visit(node, values);\n  };\n  roots.forEach(dfs);\n};\n\nexport const bfsVisit = <T, R>(\n  getChildren: TreeNodeFn<T>,\n  visit: (node: T, parentValue: R | null) => R,\n  roots: ReadonlyArray<T>\n) => {\n  const bfs: typeof visit = (node, parentValue) => {\n    const result = visit(node, parentValue);\n    const children = getChildren(node);\n    children?.map((childNode) => bfs(childNode, result));\n    return result;\n  };\n  return roots.map((root) => bfs(root, null));\n};\n\nexport const sortTreeNodesInPlace = <T>(\n  by: (t: T) => Ord,\n  tree: MutableTree<T>\n) => {\n  const compareFn = (a: T, b: T) => {\n    const aa = by(a);\n    const bb = by(b);\n    return aa < bb ? -1 : aa > bb ? 1 : 0;\n  };\n  tree.roots.sort(compareFn);\n  bfsVisit(\n    tree.getChildren,\n    (node) => {\n      const children = tree.getChildren(node);\n      if (children) {\n        children.sort(compareFn);\n      }\n    },\n    tree.roots\n  );\n};\n","import React, { useContext } from \"react\";\n\nexport const useContextOrThrow = <ContextType extends unknown>(\n  Context: React.Context<ContextType | null>,\n  nullErrorMessage: string\n) => {\n  const context = useContext<ContextType | null>(Context);\n\n  if (context == null) {\n    throw new Error(nullErrorMessage);\n  }\n\n  return context;\n};\n","import { useCallback, useLayoutEffect, useRef } from \"react\";\n\n/**\n * Interim solution for non-reactive callbacks, until\n * [useEvent](https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md) (or whatever it will end up being\n * called), becomes available.\n */\nexport function useEventCallback<T extends (...args: any[]) => any>(fn: T): T {\n  let ref = useRef<typeof fn>();\n  useLayoutEffect(() => {\n    ref.current = fn;\n  });\n  const callback = ((...args: Parameters<T>) =>\n    ref.current?.apply(null, args)) as T;\n  return useCallback<T>(callback, []);\n}\n","import { FocusEventHandler } from \"react\";\nimport { getFocusableTreeWalker } from \"@react-aria/focus\";\n\n/**\n * Provides a focus management mechanism for a container that doesn't retain focus but forwards it to its focusable\n * descendants. More specifically:\n * - When the container gets focused, it automatically focuses the first focusable child element.\n *   The {@param forwardFocus} parameter can be used to customize which element should receive focus.\n * - By default, focus is prevented from returning to the container itself when focus is being moved from a descendant\n *   to the container. {@param ignoreFocusedDescendant} can be set to `true`, to disable this behaviour.\n *   If {@param ignoreFocusedDescendant} is true, focus will be forcibly moved to the first element (or the element\n *   specified by {@param forwardFocus}) when the container gets focused.\n *\n * NOTE: This hook does not make the container element focusable. It only returns the focus event handler that should be\n * passed to the container.\n */\nexport function useFocusForwarder({\n  forwardFocus,\n  ignoreFocusedDescendant = false,\n}: {\n  /**\n   * Called when the container gets focused, to forward focus to the appropriate focusable child element.\n   * If not passed, focus is forwarded to the first focusable element, by default.\n   */\n  forwardFocus?: () => void;\n  ignoreFocusedDescendant?: boolean;\n} = {}) {\n  const onFocus: FocusEventHandler = (event) => {\n    if (event.target !== event.currentTarget) {\n      // only when this container is focused. not when anything inside is focused.\n      return;\n    }\n    const possiblyBlurredElement = event.relatedTarget;\n    if (\n      possiblyBlurredElement instanceof Element &&\n      event.currentTarget?.contains(possiblyBlurredElement) &&\n      !ignoreFocusedDescendant\n    ) {\n      // If anything inside the content is being blurred while the container is getting focused, we don't let focus\n      // go from that element, to the container.\n      if (possiblyBlurredElement instanceof HTMLElement) {\n        possiblyBlurredElement.focus();\n      }\n      return;\n    }\n    if (forwardFocus) {\n      forwardFocus();\n    } else {\n      (\n        getFocusableTreeWalker(event.currentTarget).firstChild() as HTMLElement\n      )?.focus();\n    }\n  };\n  return { focusForwarderProps: { onFocus } };\n}\n","import React, { useRef } from \"react\";\n\n/**\n * For when a component needs to forward ref, but it too needs to use the same ref. Since forwarded ref can be in form\n * of a callback too, this will normalize it as a RefObject.\n * NOTE: Should we keep the ref in state because of edge cases?\n */\nexport default function useForwardedRef<T>(\n  forwardedRef: React.Ref<T>\n): React.RefObject<T> {\n  const innerRef = useRef<T>(null);\n  React.useEffect(() => {\n    if (!forwardedRef) {\n      return;\n    }\n\n    if (typeof forwardedRef === \"function\") {\n      forwardedRef(innerRef.current);\n    } else {\n      (forwardedRef as React.MutableRefObject<T | null>).current =\n        innerRef.current;\n    }\n  });\n\n  return innerRef;\n}\n","import { useLayoutEffect, useRef } from \"react\";\n\nexport function useLatest<T>(value: T) {\n  const ref = useRef(value);\n  useLayoutEffect(() => {\n    ref.current = value;\n  });\n  return ref;\n}\n","import { useEffect, useRef } from \"react\";\n\nexport function usePrevious<T>(value: T): T {\n  const ref = useRef(value);\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n","export class ImmutableSet<T> implements ReadonlySet<T> {\n  readonly size: number;\n  private readonly set: ReadonlySet<T>;\n\n  constructor(values: Iterable<T>) {\n    this.set = new Set(values);\n    this.size = this.set.size;\n  }\n\n  add(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.add(item);\n      });\n    });\n  }\n\n  delete(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.delete(item);\n      });\n    });\n  }\n\n  toggle(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        if (!newValue.delete(item)) {\n          newValue.add(item);\n        }\n      });\n    });\n  }\n\n  clear(): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      newValue.clear();\n    });\n  }\n\n  private setValueWithMutation(\n    mutate: (newValue: Set<T>) => void\n  ): ImmutableSet<T> {\n    const newValue = new Set(this.set);\n    mutate(newValue);\n    return new ImmutableSet(newValue);\n  }\n\n  ////////////////////////////////////////////////// delegated methods /////////////////////////////////////////////////\n  forEach(...args: Parameters<ReadonlySet<T>[\"forEach\"]>): void {\n    return this.set.forEach(...args);\n  }\n\n  has(value: T): boolean {\n    return this.set.has(value);\n  }\n\n  [Symbol.iterator](): IterableIterator<T> {\n    return this.set[Symbol.iterator]();\n  }\n\n  entries(): IterableIterator<[T, T]> {\n    return this.set.entries();\n  }\n\n  keys(): IterableIterator<T> {\n    return this.set.keys();\n  }\n\n  values(): IterableIterator<T> {\n    return this.set.values();\n  }\n}\n","import { useControlledState } from \"@react-stately/utils\";\nimport { useMemo } from \"react\";\nimport { ImmutableSet } from \"./immutableSet\";\n\n/**\n * Creates map interface out of a setter of form (currentValue: Map) => Map\n * Use {@link useControllableSet} instead if you need a Set state in a React component.\n * This is useful for use outside React components, such as state management libraries.\n */\nexport const createSetInterface = <T>(\n  set: (value: (prevState: Set<T>) => Set<T>) => void\n) => ({\n  add: (...values: T[]) =>\n    set(\n      (currentValue) => new Set(new ImmutableSet(currentValue).add(...values))\n    ),\n  delete: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).delete(...values))\n    ),\n  clear: () =>\n    set((currentValue) => new Set(new ImmutableSet(currentValue).clear())),\n  toggle: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).toggle(...values))\n    ),\n});\n\nfunction useStateSetterForSet<T>(\n  setValue: (value: (prevState: Set<T>) => Set<T>, ...args: any[]) => void\n) {\n  return useMemo(() => createSetInterface(setValue), [setValue]);\n}\n\n/**\n * controllable state management for a Set. returns a tuple containing the value and an object with Set functions on it,\n * which would update the state.\n */\nexport const useControllableSet = <T>(\n  valueProp: Set<T> | undefined,\n  defaultValue: Set<T> = new Set(),\n  onChange: ((newValue: Set<T>) => void) | undefined\n) => {\n  const [value, setValue] = useControlledState(\n    valueProp!, // bad typing in useControlledState\n    defaultValue,\n    onChange! // bad typing in useControlledState\n  );\n\n  // @ts-expect-error FIXME https://github.com/adobe/react-spectrum/issues/2320\n  return [value, useStateSetterForSet(setValue)] as const;\n};\n","var map = {\n\t\"./simpleWorker\": 87223,\n\t\"./simpleWorker.js\": 87223\n};\n\nfunction webpackAsyncContext(req) {\n\treturn Promise.resolve().then(() => {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\n\t\tvar id = map[req];\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 96300;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./editorBaseApi\": [\n\t\t79375\n\t],\n\t\"./editorBaseApi.js\": [\n\t\t79375\n\t],\n\t\"./editorSimpleWorker\": [\n\t\t42789\n\t],\n\t\"./editorSimpleWorker.js\": [\n\t\t42789\n\t],\n\t\"./editorWorker\": [\n\t\t30363\n\t],\n\t\"./editorWorker.js\": [\n\t\t30363\n\t],\n\t\"./editorWorkerHost\": [\n\t\t76679\n\t],\n\t\"./editorWorkerHost.js\": [\n\t\t76679\n\t],\n\t\"./findSectionHeaders\": [\n\t\t43631\n\t],\n\t\"./findSectionHeaders.js\": [\n\t\t43631\n\t],\n\t\"./getIconClasses\": [\n\t\t75154\n\t],\n\t\"./getIconClasses.js\": [\n\t\t75154\n\t],\n\t\"./languageFeatureDebounce\": [\n\t\t69060\n\t],\n\t\"./languageFeatureDebounce.js\": [\n\t\t69060\n\t],\n\t\"./languageFeatures\": [\n\t\t35921\n\t],\n\t\"./languageFeatures.js\": [\n\t\t35921\n\t],\n\t\"./languageFeaturesService\": [\n\t\t33293\n\t],\n\t\"./languageFeaturesService.js\": [\n\t\t33293\n\t],\n\t\"./languageService\": [\n\t\t44718\n\t],\n\t\"./languageService.js\": [\n\t\t44718\n\t],\n\t\"./languagesAssociations\": [\n\t\t41356\n\t],\n\t\"./languagesAssociations.js\": [\n\t\t41356\n\t],\n\t\"./languagesRegistry\": [\n\t\t33550\n\t],\n\t\"./languagesRegistry.js\": [\n\t\t33550\n\t],\n\t\"./markerDecorations\": [\n\t\t52919\n\t],\n\t\"./markerDecorations.js\": [\n\t\t52919\n\t],\n\t\"./markerDecorationsService\": [\n\t\t1022\n\t],\n\t\"./markerDecorationsService.js\": [\n\t\t1022\n\t],\n\t\"./model\": [\n\t\t65041\n\t],\n\t\"./model.js\": [\n\t\t65041\n\t],\n\t\"./modelService\": [\n\t\t94657\n\t],\n\t\"./modelService.js\": [\n\t\t94657\n\t],\n\t\"./resolverService\": [\n\t\t91223\n\t],\n\t\"./resolverService.js\": [\n\t\t91223\n\t],\n\t\"./semanticTokensDto\": [\n\t\t21982\n\t],\n\t\"./semanticTokensDto.js\": [\n\t\t21982\n\t],\n\t\"./semanticTokensProviderStyling\": [\n\t\t76263\n\t],\n\t\"./semanticTokensProviderStyling.js\": [\n\t\t76263\n\t],\n\t\"./semanticTokensStyling\": [\n\t\t76567\n\t],\n\t\"./semanticTokensStyling.js\": [\n\t\t76567\n\t],\n\t\"./semanticTokensStylingService\": [\n\t\t29922\n\t],\n\t\"./semanticTokensStylingService.js\": [\n\t\t29922\n\t],\n\t\"./textModelSync/textModelSync.impl\": [\n\t\t54632\n\t],\n\t\"./textModelSync/textModelSync.impl.js\": [\n\t\t54632\n\t],\n\t\"./textModelSync/textModelSync.protocol\": [\n\t\t66828,\n\t\t6828\n\t],\n\t\"./textModelSync/textModelSync.protocol.js\": [\n\t\t66828,\n\t\t6828\n\t],\n\t\"./textResourceConfiguration\": [\n\t\t16576\n\t],\n\t\"./textResourceConfiguration.js\": [\n\t\t16576\n\t],\n\t\"./treeSitterParserService\": [\n\t\t40143\n\t],\n\t\"./treeSitterParserService.js\": [\n\t\t40143\n\t],\n\t\"./treeViewsDnd\": [\n\t\t55247\n\t],\n\t\"./treeViewsDnd.js\": [\n\t\t55247\n\t],\n\t\"./treeViewsDndService\": [\n\t\t61860\n\t],\n\t\"./treeViewsDndService.js\": [\n\t\t61860\n\t],\n\t\"./unicodeTextModelHighlighter\": [\n\t\t83969\n\t],\n\t\"./unicodeTextModelHighlighter.js\": [\n\t\t83969\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(() => {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 34428;\nmodule.exports = webpackAsyncContext;"],"names":["LoadingGif","props","React","Img","_extends","src","darkSrc","__docgenInfo","Loading","styled","withConfig","displayName","componentId","DefaultSuspense","_ref","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","refreshDepsMap","WeakMap","refreshableAtoms","WeakSet","atomWithRefresh","read","write","refreshAtom","atom","refreshableAtom","get","options","deps","Set","value","arguments","length","undefined","has","add","set","_len","args","Array","_key","currentValue","dep","c","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","IndexedDB","Create","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","name","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","pathname","persistentFsPreference","key","localStorage","getItem","setItem","switchToPersistentFS","_temp","log","getRootFS","InMemory","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentAtom","atomFamily","fileNames","stats","all","map","fileName","type","basename","lastModification","mtimeMs","size","getDirContent","debugLabel","reloadFileFromDiskCallback","_get","fileContentAtom","encoding","atomWithLazy","error","convertGitStatus","isArray","filterPath","includes","autoClonedRepo","defaultProject","currentProjectAtom","projectFilePath","projectRelativePath","currentProjectFilesAtom","project","projectFilesAtom","projectPath","files","addItem","item","childItems","forEach","push","relativePath","activePathsAtom","activePathExistsAtom","useActivePathsProvider","createFocusBasedSetterHook","nullValue","focusedElement","setValue","useStore","setAtom","useSetAtom","useCallback","newValue","useStableSetAtom","elementRef","useRef","useEffect","current","equals","useFocusWithin","onFocusWithin","currentTarget","onBlurWithin","relatedTarget","Element","closest","focusWithinProps","projectPopupManagerRefAtom","createRef","windowManagerRefAtom","alertDialogRefAtom","StorageFiles","storagePaths","storageFile","storageFileDir","storageFileMapping","persistentStateStoreAtoms","cacheAtom","storageContentAtom","xmlParser","XMLParser","WORKSPACE_XML_PARSE_OPTIONS","storageFileExists","EMPTY_STORAGE_STATE","xmlData","workspace","Object","assign","parse","component","readStorageFile","fsWriteTimer","update","storageFilepath","state","currentState","clearTimeout","setTimeout","XMLBuilder","WORKSPACE_XML_BUILD_OPTIONS","build","serializeState","atomWithPersistence","initialValue","baseAtom","persistenceAtom","WORKSPACE_FILE","componentName","schema","v","identity","componentState","find","output","safeParse","data","action","components","index","findIndex","splice","createPersistedStateAtom","syncEffect","atomEffect","peek","persistedValue","x","z","object","whatever","number","optional","s","y","attributeNamePrefix","ignoreAttributes","tagName","jPath","format","maybeArray","union","array","transform","list","itemTagName","itemSchema","vcsRootsAtom","mapping","string","enum","dir","vcs","git","roots","filter","notNull","_ref2","vcsFootForFileAtom","findRoot","fetchRepoStatusFromFs","repoDir","rows","statusMatrix","result","row","repoStatusAtoms","targetAtom","withAtomEffect","repoStatus","isRepoStatusUpdatingAtom","_repoRoot","isAnyRepoStatusUpdatingAtom","some","_ref3","fileStatusAtoms","repoRoot","filepaths","refreshFileStatusCallback","statusMap","newStatusMap","refreshRepoStatusesCallback","_ref4","finally","useRefreshRepoStatuses","useAtomCallback","useStatusColor","theme","useTheme","dark","FileStatusColor","color","fileStatus","useAtomValue","unwrap","useFileStatusColor","style","StatusColor","currentForegroundAware","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","StyledContainer","div","attrs","tabIndex","StyledLine","StyledShortcut","commonColors","linkForegroundEnabled","EditorZeroState","ActionTip","actionId","CommonActionId","GO_TO_FILE","GO_TO_ACTION","getShortcut","useGetActionShortcut","useAction","AppActionIds","editorActionIds","EXPAND_REGION","EXPAND_REGION_RECURSIVELY","EXPAND_ALL_REGIONS","EXPAND_ALL_TO_LEVEL","EXPAND_ALL_TO_LEVEL1","EXPAND_ALL_TO_LEVEL2","EXPAND_ALL_TO_LEVEL3","EXPAND_ALL_TO_LEVEL4","EXPAND_ALL_TO_LEVEL5","COLLAPSE_REGION","COLLAPSE_REGION_RECURSIVELY","COLLAPSE_ALL_REGIONS","COLLAPSE_DOC_COMMENTS","TOGGLE_FOLDING","EDITOR_LANG_POPUP_MENU","CompareClipboardWithSelection","context","event","getCallbackAtom","setSelf","callback","editorTabsAtom","currentProjectFiles","sortWith","descend","file","endsWith","slice","editorState","cursorPos","lineNumber","column","activeEditorTabIndexState","activeEditorTabAtom","tabs","editorCursorPositionState","Position","editorRefAtom","openPathCallback","shouldFocus","tabsState","tab","select","focus","newIndex","closeCallback","_","closePathCallback","Math","max","closeOtherTabsCallback","selectTabCallback","numTabs","focusTabCallback","editorManagerAtom","getCallback","openPath","closeTab","closeOtherTabs","closePath","useEditorStateManager","darculaColorSchemeTokenRules","vsCodeTheme","flatMap","scope","settings","token","values","keys","StyledEditor","MonacoEditor","Editor","editorTheme","useEditorTheme","monaco","useMonaco","themeName","setThemeName","useState","useLayoutEffect","replace","bracketColor","editor","defineTheme","base","inherit","colors","rules","minimap","enabled","lineHeight","showFoldingControls","guides","indentation","overviewRulerBorder","fontFamily","fontSize","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","getCached","m","k","cache1","memo2","create","dep1","dep2","cache2","Map","nullObj","unwrapLatestWithLoading","anAtom","defaultValue","freshAtom","isLoading","unwrappedAtom","prev","editorFullStateAtom","activeEditorTab","FileEditor","editorTabs","editorStateManager","editorRef","active","setActive","contextMenu","setContextMenu","hideAllAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","isContentLoading","tabActionsRef","useLatest","closeOthersTabs","setEditorRef","setContent","updateFileStatus","editorActionGroupDefinition","createDefaultActionGroup","useCreateDefaultActionGroup","selection","getSelection","selectedText","getModel","getValueInRange","id","description","isSearchable","menuPresentation","PlatformIcon","actionPerformed","COPY","copyToClipboard","PASTE","trigger","COPY_REFERENCE","level","useEditorActionGroup","updateContent","newContent","activePathsProviderProps","ActionsProvider","shortcutHandlerProps","StyledFileEditorContainer","mergeProps","onFocus","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","contextmenu","onMount","monacoEditor","onContextMenu","preventDefault","onDidScrollChange","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","JsxEmit","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","onChange","FileEditorLoading","MenuOverlayFromOrigin","origin","browserEvent","onClose","EditorActionGroupMenu","actionGroup","useActionGroup","ActionGroupMenu","menuProps","autoFocus","isUnderDarcula","panelBackground","StyledXterm","XTerm","Terminal","input","setInput","xtermRef","useMemo","background","letterSpacing","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","ref","onData","charCodeAt","foldersOnTopState","expandedKeysAtom","atomWithDefault","selectionAtom","selectedNodesAtom","nodesByKey","currentProjectTreeAtom","byKey","projectViewTreeRefAtom","rootItems","mapItem","parent","node","dirNode","sortProjectTreeNodes","root","createProjectTree","sort","item1","item2","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","projectActionIds","NewElement","NewFile","NewDir","CopyReferencePopupGroup","CopyPaths","CopyFileReference","CopyAbsolutePath","CopySourceRootPath","CopyFileName","ProjectViewContextMenu","getActionContext","ActionsMenu","actionContext","shortcut","DividerItem","CUT","DELETE","memoized","_cache","arg1","unwrapLatest","unwrapLatestOrNull","ProjectViewPane","setProjectViewTreeRef","treeState","setExpandedKeys","useAtom","selectedKeys","setSelectedKeys","sortItems","sortBy","a","selectedKeysArray","i","containerRef","contextMenuTargetKey","element","querySelector","onOpen","dataset","SpeedSearchTree","fillAvailableSpace","selectionMode","onExpandedChange","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","Hint","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","_ref5","HelpButton","HelpTooltip","helpText","Button","variant","findRootPaths","objects","getPath","obj","thePath","anObject","startsWith","deleteFileCallback","unlink","deleteFilesCallback","filePaths","createDirectoryCallback","destination","fullpath","isAtom","actionAtom","isSearchableValue","isDisabled","isDisabledValue","maybeAtom","fileCountMsg","IntlMessageFormat","dirCountMsg","deleteActionAtom","selectedNodes","windowManager","alertDialog","nodesToDelete","directories","singleDirName","confirm","okText","message","width","count","join","recursivelyDeleteDir","pathnames","rmdir","deleteDirCallback","open","close","DeleteFilesConfirmationDialog","confirmed","requestAnimationFrame","ModalWindow","minWidth","minHeight","WindowLayout","header","onSubmit","padding","marginBottom","display","flexDirection","gap","Checkbox","footer","Footer","left","right","form","copyActionAtom","cutActionAtom","pasteActionAtom","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","activeTab","selectPathInProjectView","selectOpenedFile","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","EXPAND_ALL","COLLAPSE_ALL","DEFAULT_LOADING_DELAY_MS","Delayed","waitedEnough","setWaitedEnough","timer","Tagged","change","Change","before","after","Unversioned","revision","changeToFileStatus","ADDED","DELETED","MOVED","RENAMED","MODIFIED","UNVERSIONED","revisionEquals","b","isDir","isAddition","isDeletion","isRename","isMove","isModified","isUnversioned","sameBefore","sameAfter","repoChangesAtoms","entries","allChangesAtom","flat","rollbackChangesCallback","changes","deleteAddedFiles","reloadFileFromDisk","changesWithRepoRoots","groupedChanges","groupBy","toReset","toCheckout","allSettled","_ref6","resetIndex","checkout","_ref7","_ref8","_ref9","_ref10","pathToRefresh","_ref11","changeListsAtom","jotaiAtom","comment","activeChangeListState","changeList","unversionedChangesAtom","SyncChangeListsState","setChangeLists","changeLists","trackedChanges","updatedChangeLists","aChange","existingChanges","newChanges","anExistingChange","createGroupByDirectory","mapNode","createDirectoryNode","shouldCollapseDirectories","nodes","pathToNodeCache","rootDirNodes","reduce","prevNode","parentNodePath","isDirectoryNode","directoryNodes","uniq","collapseDirectories","createDirectorNode","child","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","ADD_UNVERSIONED","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","EDIT_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GROUP_BY_DIRECTORY","GIT_ADD","GIT_INIT","GIT_CLONE","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","GIT_LOG_HIDE_BRANCHES","GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH","GIT_UPDATE_SELECTED","FOCUS_TEXT_FILTER","MATCH_CASE","REG_EXP","COPY_REVISION_NUMBER","LOG_REFRESH","SHOW_DETAILS","SHOW_DIFF_PREVIEW","PRESENTATION_SETTINGS","FILE_HISTORY_PRESENTATION_SETTINGS","CopyPathFromRepositoryRootProvider","changesTreeNodeKey","getNodeKeyForChange","changeNode","showPath","isGroupNode","isChangeNode","getChildren","repositoryGrouping","isAvailable","groupFn","repository","repositoryNode","directoryGrouping","useShortcutOf","keyPrefix","directoryNode","defaultChangeGroupings","defaultChangeGroupingsAtom","grouping","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","getPrefixedChangesGroupFn","isActive","groupings","groupFns","isOpenAtom","windowBoundsAtom","initiallyIncludedChangesAtom","rootNodesAtom","selectedChanges","rootNodes","changesTreeNodesAtom","includedRootNodes","rollbackViewState","initiallyExpandedKeysAtom","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","changesTreeNodesResult","fileCountsMap","expandAllKeys","dfsVisit","childrenFileCount","fileCount","total","changeListNode","showIgnoredFilesAtom","showRelatedFilesAtom","changesGroupingActiveState","selectedKeysAtom","resolvedSelectedKeysAtom","bfsVisit","parentValue","changesUnderSelectedKeysAtom","allChanges","processNode","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysAtom","includedChangesAtom","includedChangeKeys","includedChangesNestedSelectionAtom","NestedSelection","createSetInterface","getKey","updater","changesViewGroupingsState","groupChildren","changeListNodes","prefixedGroupFn","unversionedChanges","unversionedChangesNode","commitMessageSizeState","orientation","amendCommitAtom","commitMessageAtom","commitErrorMessageAtom","commitTaskIdAtom","changesFromActivePathsAtom","activePaths","activePath","queueCheckInCallback","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","contextual","changesUnderSelection","changesBasedOnActivePaths","ChangesViewTreeContextMenu","asyncFilter","predicate","predicateResult","getTrackingBranch","localBranchName","mergeRef","remote","repoLocalBranchesAtom","branches","branch","trackingBranch","repoRemoteBranchesAtoms","remotes","repoBranchesAtom","currentBranchName","repoCurrentBranchNameAtom","localBranches","currentBranch","remoteBranches","fullname","allBranchesAtom","repoRoots","branchForPathAtoms","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","readBranchStorage","branchStorage","entry","writeBranchStorage","branchesByType","keyAttribute","gitSettingsAtom","excludedBranches","newState","favoriteBranchesAtom","focusAtom","optic","prop","excludedFromFavoriteBranchesAtom","isFavoriteBranchAtoms","branchInfo","isFavorite","isPredefinedAsFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","StyledRepoColorSquare","span","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","currentBackgroundAware","formatFileCount","ChangeNodeHint","defaultNodeRenderers","repoNodeRenderer","rendered","directory","directoryNodeRenderer","createChangesTreeNodeRenderer","renderers","defaultRendererOverrides","nodeRenderers","getItemProps","nodeRenderer","dirCount","hasChildItems","getTextValue","itemRenderer","LoadingText","loading","changesViewTreeNodeRenderer","changelist","changeListNodeRenderer","fontWeight","unversioned","unversionedChangesNodeRenderer","_node","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","_set","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","selectionState","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","actionMenuProps","SpeedSearchMenu","GroupByActionButton","IconButton","isPressed","Section","ChangesGroupByActionButton","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","border","ToolbarSeparator","tasksAtom","firstTaskAtom","taskCountAtom","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","cancelToken","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","updates","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","onFinished","useCancelTask","abort","resolvedRefAtoms","depth","dateToString","date","getMonth","getDate","getFullYear","toString","dateRangeToString","dateRange","from","to","vcsTabKeysAtom","vcsActiveTabKeyAtom","vcsTabTitleAtoms","searchQuery","vcsLogFilter","user","parts","short","long","part","tabAtomFamilies","vcsLogAtomFamily","_tab","atomWithReset","vcsLogTabShowBranchesAtoms","vcsLogTabShowCommitDetailsAtoms","vcsLogTabShowCommitDetailsInCurrentTabAtom","CURRENT_USER_FILTER_VALUE","matchCase","regExp","vcsLogFilterCurrentTab","mapObjIndexed","useResetFilters","tabKey","getAtom","RESET","closeTabCallback","cache","commitDateComparator","commit","committer","timestamp","match","query","flags","RegExp","test","toLowerCase","allCommitsAtom","allCommits","commitsMap","commitsToProcess","readCommitResult","oid","sources","initialCommits","refs","repoPath","isBare","getCommonArgs","c1","c2","addCommit","latestCommit","containingRefs","shift","aCommit","readCommits","commitsTableRowsAtom","dateFilter","author","getTime","tree","byOid","indexBy","allResolvedRefsAtom","repoBranches","addRef","resolvedRef","isCurrent","commitsSelectionAtom","selectedCommitOids","selectedCommitsAtom","selectedCommitAtom","vcsTableShowCommitTimestampAtom","vcsTableReferencesOnTheLeftAtom","vcsTableHighlightMyCommitsAtom","authorColumn","hashColumn","dateColumn","defaultVisibleColumns","vcsTableColumnsVisibilityAtoms","commitSuccessfulMessage","useCommitChanges","refreshFileStatus","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","containsChange","blob","mode","newTreeOid","commitRef","commitFiles","email","StyledCommitMessageContainer","StyledCommitMessageTextArea","textarea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","amend","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","placeholder","preventFocusOnPress","mnemonic","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","setAmend","ActionHelpTooltip","focusCommitMessage","preventFocus","deleteChangeListMsg","selectedFilesCountMsg","deletablePathsUnderChangesTreeSelectionState","pathsToDelete","useChangesViewActions","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","refresh","StyledTreeViewWrapper","StyledLoadingWrapper","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","updating","commitMessageSize","setCommitMessageSize","changesViewActions","treeActions","ThreeViewSplitter","innerView","innerViewMinSize","lastView","lastSize","onLastResize","inactiveTextColor","ChangesViewZeroState","performAction","usePerformAction","textAlign","verticalAlign","ChangesViewPane","vcsRoots","TrackingBranchInfo","borderSpacing","COMMIT_TOOLWINDOW_ID","changesBranchesAtom","changesRepoRoots","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","View","tabContent","UNSAFE_FocusRestoringSuspense","document","activeElement","HTMLElement","isConnected","StyledHeader","borderColor","StyledSpacer","StyledPlaceholderContainer","parseCommitMessage","lines","bodyLines","subject","bodyAsString","line","shortenOid","commitDateTimeFormatter","Intl","DateTimeFormat","day","month","year","hour","minute","hour12","commitTimeFormatter","commitDateFormatter","getText","commitChangesTreeNodeRenderer","commitParent","DEFAULT_SIMILARITY_INDEX","detectRenames","deletions","additions","contents","getContent","renameMapping","similarity","file1Content","file2Content","diffLines","unchanged","added","removed","computeSimilarity","deletion","addition","currentCandidate","mergeRenames","detectRenamesBasedOnContent","hash","detectRenamesBasedOnHash","renamedChanges","rename","candidate","changesGroupingActiveAtoms","commitChangesTreeRefAtom","COMMIT_PARENT_ID","commitsDiffWithoutRenamesAtoms","fromRef","toRef","trees","afterOid","beforeOid","afterType","beforeType","afterRevision","TextDecoder","decode","Uint8Array","beforeRevision","getCommitChanges","commitsDiffAtoms","getChangedFilesAtom","atomForCommitsDiff","commitLogItem","parents","getChangesGroupFn","sortTreeNodesInPlace","changedFilesWithoutRenamesAtom","changedFilesAtom","loadableChangedFilesAtom","loadable","changedFilesLoadableAtom","CommitChangedFiles","treeShortcutHandlerProps","selectedCommits","nothingSelected","stateLoadable","setSelection","paddingBottom","PositionedTooltipTrigger","placement","bottom","labelIcon","fill","d","vcsLogStandardColors","light","gitLogColors","head","localBranch","remoteBranch","tag","StyledRef","StyledLabelSvg","svg","viewBox","StyledRefIconGroup","StyledLabelText","RefIcon","RefIconGroup","types","RefLabel","StyledCommitMessage","StyledCommitMessageHeader","StyledCommitterInfo","label","disabled","StyledCommitInfoRow","StyledRepoColorIcon","StyledRefsContainer","CommitDetails","firstSelectedCommit","allResolvedRefs","isMultiRepo","committerInfo","EmailLink","formatDateAndTime","refsByType","Tooltip","Date","RefGroup","StyledRefWithIcon","href","formatCommitDate","formatCommitTime","useRedefineAction","newId","useActions","commonProperties","useShortcutsOf","splitViewSizeState","groupingAtom","GROUP_BY_ACTION_GROUP_ID","LAYOUT_ACTION_GROUP_ID","VIEW_OPTIONS_ACTION_GROUP_ID","SHOW_DETAILS_ACTION_ID","SHOW_DIFF_PREVIEW_ACTION_ID","groupingActionId","VcsLogDetailsView","splitViewSize","setSplitViewSize","isDetailsVisible","toggleGroupBy","createActionGroup","availableGroupings","VcsLogsDetailsViewOptionsMenu","flexShrink","flex","firstSize","onFirstResize","firstViewMinSize","firstView","toggleActionAtoms","fromEntries","StyledDropdownButton","button","focusRing","focused","StyledDropdownIcon","StyledValue","FocusableAutoHoverPlatformIcon","AutoHoverPlatformIcon","VcsFilterDropdown","onClear","menuTriggerProps","MenuTrigger","BareButton","hoverIcon","StyledMenuIconButton","role","BranchFavoriteButton","onClick","onPointerUp","stopPropagation","hoverContainerSelector","BranchesFilterDropdown","selectedBranches","setSelectedBranches","resetBranches","useResetAtom","BranchesFilterMenu","onBranchesSelected","groupRepoRoots","repoGroupedAllBranchesState","allBranches","allRemoteBranches","allLocalBranches","setFavoriteBranches","repoGroupedAllBranches","remoteBranchesByRemote","createLocalBranchItems","renderBranchItem","submenuBehavior","_ref12","Divider","_ref13","_ref14","_ref15","NAME_PATTERN","getNameInStandardForm","firstAndLastName","matches","getFirstAndLastName","firstName","lastName","PRINTABLE_ASCII_PATTERN","nameToLowerCase","gitRepoUserAtoms","StyledCommitRow","StyledCommitCell","asOverlay","StyledMessageContainer","StyledRefTooltipRow","useCurrentUserHighlightStyle","currentUser","shouldHighlightCurrentUserCommits","userFilter","user2","CommitsTableRow","showCommitTimestamp","referencesOnTheLeft","isAuthorVisible","isDateVisible","isHashVisible","highlightStyles","flexBasis","flexGrow","CommitRefs","onLeft","refKey","filteredRefs","headIsOnABranch","aBranch","delay","withPointer","tooltipTriggerProps","unshift","StyledProgressBar","ProgressBar","StyledListItem","ResolvedRefsContext","CommitsTable","currentTabKey","resetFilters","setSelectedCommits","Provider","List","estimatedItemHeight","Consumer","showToggleDefs","highlightToggleDefs","columnToggleDefs","useToggleDef","CommitsTableViewOptionsMenuIconButton","showToggles","highlightToggles","columnToggles","allToggles","toggleKey","StyledSearchInput","SearchInput","searchHistoryState","VcsLogCommitsView","textFilterRef","searchInputRefAtom","setSearchQuery","setUser","resetUser","setDateFilter","resetDate","searchHistory","setSearchHistory","searchInputValue","setSearchInputValue","getActionShortcut","isRegExpOn","isMatchCaseOn","submitSearchQuery","createNewTab","newTabId","uuid","getTabFilterAtom","today","sevenDaysAgo","setDate","yesterday","predefinedDateRanges","inputRef","onBlur","addonAfter","StyledHoverContainer","excludeFromTabOrder","predefinedDateRange","getLocalBranchNodes","shouldGroupByDirectory","localBranchNodes","repos","groupNodesByDirectory","getRemoteBranchNodes","remoteBranchNodes","branchesTreeNodeAtom","branchTreeGroupingAtoms","shouldGroupByRepository","isGroupByRepositoryAvailableAtom","_param","branchesTreeRefAtoms","selectedKeysAtoms","expandedKeysAtoms","searchInputAtoms","availableGroupingsAtom","BranchesGroupByActionButton","branchTreeNodeRenderers","toUpperCase","Group","keyToBranch","_repo","StyledSearchIconContainer","BranchesTree","branchesTreeNodes","searchTerm","setSearchTerm","searchInputRef","isInputFocused","setInputFocused","setBranchFilter","focusProxyRef","showAsFocused","onSearchTermChange","keepSearchActiveOnBlur","hideSpeedSearchPopup","isSearchActive","DELETE_BRANCH_ACTION_ID","SHOW_BRANCH_DIFF_ACTION_ID","SHOW_MY_BRANCHES_ACTION_ID","FETCH_ACTION_ID","TOGGLE_FAVORITE_ACTION_ID","VcsBranchesView","VcsLogBranchesViewToolbar","StyledToolbar","refreshLogAction","copyRevisionNumberAction","useCommitsTableActions","VersionControlToolWindowZeroState","firstViewSizeState","lastViewSizeState","StyledToolWindowHeader","VersionControlToolWindow","tabKeys","activeTabKey","setActiveTabKey","activeKey","onActiveKeyChange","VcsToolWindowTabTitle","VcsTab","StyledExpandStripeButton","StyledShowBranchesButton","StyledShowBranchesButtonText","ShowBranchesButton","firstViewSize","setFirstViewSize","lastViewSize","setLastViewSize","focusTextFilterAction","hideBranchesAction","toggleMatchCaseAction","toggleRegExpAction","toggleDetailsAction","showDiffPreviewAction","useVcsLogsToolWindowActions","showBranches","setShowBranches","firstViewProps","lastViewMinSize","ToolWindowTabContent","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","isSplit","showProgressPanelAtom","tasksPopupBoundsAtom","StyledPopupTitle","TasksPopup","setShowProgressPanel","cancel","bounds","setBounds","Popup","innerWidth","top","innerHeight","onBoundsChange","nonDismissable","interactions","Layout","Header","hasControls","margin","details","secondaryDetails","maxValue","ProgressBarStopButton","StyledVerticalSeparator","StatusBarProgress","dense","namePosition","Spacer","StyledProgressBarButton","Container","StatusBarTaskProgressBar","firstTask","tasksCount","showProgressPanel","small","activeFileRepoRootAtom","activeFile","activeFileRepoBranchesAtom","activeFileRepoRoot","activeFileCurrentBranchAtom","selectAtom","prevValue","activeFileRepoHeadAtom","detached","resolveRef","validateBranchName","newBranchName","ILLEGAL_CHARS_PATTERN","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","labelPlacement","validationMessage","Boolean","StyledTitle","branchesPopupSizeState","BranchesPopup","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","useWindowManager","checkoutBranch","openedFiles","existingOpenedFile","interactionType","PopupLayout","currentBounds","disabledKeys","operation","tryCheckout","Errors","CheckoutConflictError","BalloonActionLink","aRepoRoot","checkoutRemoteBranch","getSectionLabel","compareActions","mergeActions","favoriteBranchArgs","notified","BranchPopupTrigger","gitRepoHead","maybeShowGitCloneTip","useShowGitTipIfNeeded","showSticky","PopupTrigger","onOpenChange","isOpen","popup","StatusBarWidget","StyledLastMessage","IdeStatusBar","cursorPosition","StatusBar","RollbackTreeContextMenu","StyledFrame","contrastBorder","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","windowBounds","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","balloons","setOpen","setDeleteAddedFiles","atLeastOneNewFileSelected","toolWindowsStateAtom","ToolWindowsState","removedFromSideBarIds","showStripeButton","tips","EXPAND_SELECTION","SHRINK_SELECTION","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsAtom","noContentHeight","otherProps","persistBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","ActionItem","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","SHOW_INTENTION_ACTIONS","search","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","getItemText","renderItem","FileItem","dirMatches","filenameMatches","splitWhen","titleMatches","filesSearchContributor","projectFiles","SearchEverywhereActionIds","StyledTab","selected","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","hr","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","selectionManagerRef","setFocusedKey","localActions","currentContributorIndex","contributorActions","_ref16","limit","nextItem","itemWrapper","_ref17","Tabs","TabComponent","TabsComponent","FocusScope","contain","newPattern","newPatternContainsPrevious","onPatternChanged","shouldFocusWrap","_ref18","itemText","gitAddCallback","StyledInput","NewItemPopup","inputName","validationType","hideMessage","setHideMessage","onMouseDown","offset","crossOffset","ValidationTooltip","appearance","createFileActionAtom","popupManager","destinationDir","NewFilePopup","createFile","editorManager","createFileCallback","waitUntil","HTMLTextAreaElement","AddFileToGitWindow","setFilename","setValidationMessage","submit","addToGit","criteria","timeoutInMs","createDirectoryActionAtom","NewDirectoryPopup","createDirectory","dirName","setDirName","validationResult","setValidationResult","updateValidation","asyncCallback","callbackRef","_len2","_key2","useCancelableAsyncCallback","validate","copyFilenameActionAtom","copyAbsolutePathActionAtom","copyPathFromRepositoryRootActionAtom","openSearchEverywhereCallback","useProjectActions","openSearchEverywhere","newFileAction","newDirectoryAction","newElementActionGroup","copyReferencePopupGroup","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","relative","isPathInside","selectedPathsAreDirectories","every","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","changePath","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","AlreadyExistsError","autoSelect","pathsToAddAtom","isIgnored","isUnchangedFile","gitAddDisabledAtom","gitAddActionAtom","pathsToAdd","aPath","gitInitActionAtom","visitedUrlsSchema","option","cloneParentDirSchema","gitRememberedInputsAtom","visitedUrls","cloneParentDir","UrlAndUserName","url","username","gitVisitedUrlsAtom","cloneParentDirAtom","defaultWorkspaceFiles","defaultInitializer","InlinePopup","StyledPopupContainer","ProjectInitializer","autoCloneSampleRepo","cloneProgress","setCloneProgress","setState","ensureSampleRepo","repoUrl","info","isSuccessfullyCloned","cloneRepo","onProgress","initializer","INITIALIZE_APP","projectDir","loaded","phase","round","AlertDialog","heading","buttons","location","reload","clone","http","corsProxy","singleBranch","getInputCursorOffset","caretIndex","selectionStart","inputStyle","getComputedStyle","hiddenSpan","createElement","visibility","whiteSpace","font","paddingLeft","textContent","substring","appendChild","caretOffset","offsetWidth","removeChild","StyledPopover","WINDOW_SHADOW","ListBoxStyledAsMenu","ListBox","MENU_VERTICAL_PADDING","PathInputField","valueProp","onChangeProp","defaultValueProp","useControlledState","isAutocompleteVisible","setAutocompleteVisible","collectionRef","pathSearchQuery","setPathSearchQuery","pathSuggestions","setPathSuggestions","updatePathAutocompletion","setMenuOrigin","clientX","inputClientRect","clientY","wasAutocompleteVisible","usePrevious","pathParts","searchDirectory","canceled","getChildDirectories","suggestions","matchedSuggestions","setSelectionRange","menuOrigin","getBoundingClientRect","CODE_COMPLETION","mergeRefs","inputProps","onKeyDown","shouldFocusOnHover","shouldUseVirtualFocus","gitCloneActionAtom","GitCloneWindow","cloneAnotherRepoActionAtom","urlProp","setUrl","parentDir","setCloneParentDirState","setVisitedUrls","setDirectory","autoFillDirectory","setAutoFillDirectory","showValidationErrors","setShowValidationErrors","urlInputRef","dirInputRef","urlError","removePrefix","trim","sanitizeCloneUrl","URL","SSH_URL_PATTERN","validateRepoUrl","dirError","setDirError","setVcsRoots","onSuccess","useClone","repoName","LabeledControlsAlignmentProvider","dirValidationError","validateCloneDirectory","urls","visitedUrl","ComboBox","onValueChange","str","prefix","useVcsActions","usePopupManager","gitAddAction","gitInitAction","gitCloneAction","cloneAnotherRepoAction","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","useAlertDialog","BalloonManager","disablePortal","SetBalloonManagerRef","UsePersistentFsNotification","ProjectActionProvider","DefaultToolWindows","toolWindowsState","onToolWindowStateChange","windows","useCapture","timeoutId","usePersistenceFsNotification","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateVersionControlWindow","ActivateTerminalWindow","SafeDelete","secondKeyStroke","App","KeymapProvider","WindowManager","PopupManager","isActionGroup","isResolvedActionGroup","isActionGroupDefinition","shortcutString","isKeyMatch","keyStroke","loose","supportedModifiers","modifier","getModifierState","ActionsContext","generateId","ACTION_PROVIDER_ID_ATTRIBUTE","ACTION_PROVIDER_ID_DATA_PREFIX","actionProvidersMap","parentContext","recursivelyCreateActions","shortcuts","actionProviderId","firstKeyActivatedShortcutsRef","secondStrokeResetTimerIdRef","nativeEvent","repeat","triggerAction","firstKeyMatches","isKeyboardShortcut","addEventListener","once","capture","useShortcuts","delete","actionDefinitions","actionDefinition","firstShortcut","isMutableActionGroup","closestActionProvider","actionSets","dataKey","actionSet","SHOW_SEARCH_HISTORY","KeymapContext","defaultKeymap","keymapProp","parentKeyMap","actionButton","isAction","getAllActions","renderActionAsMenuItem","isGroup","hasDivider","flatten","openActionsInPopup","positioning","targetRef","MENU_POSITION_TARGET_DATA_ATTRIBUTE","groupDefinition","RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID","RESIZE_TOOL_WINDOW_LEFT_ACTION_ID","RESIZE_TOOL_WINDOW_TOP_ACTION_ID","RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID","MAXIMIZE_TOOL_WINDOW_ACTION_ID","FOCUS_EDITOR_ACTION_ID","HIDE_ACTIVE_WINDOW_ACTION_ID","JUMP_TO_LAST_WINDOW_ACTION_ID","defaultKeyToStr","Control","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Enter","Quote","Minus","Subtract","NumpadAdd","Multiply","NumpadMultiply","Equal","Backspace","fromPairs","KeystrokeToString","isMac","separator","codeToStr","Alt","Shift","Meta","Escape","modifiersOrder","keystrokeToString","keystroke","actionGroupId","StyledModalWindow","StyledWindowContainer","StyledHeading","h2","StyledBody","StyledContent","StyledCheckbox","StyledButtons","ButtonGroup","StyledIcon","StyledHelpIcon","checkbox","helpButton","defaultBounds","observeContentResize","OverlayMoveHandle","dragThreshold","canMoveStart","isEventOnEmptySpaces","moveHandleProps","cancelText","bgColor","StyledHeaderActions","StyledBalloonContainer","StyledIconContainer","StyledBalloonHeader","StyledBalloonBody","lineClamp","StyledBalloonFooter","StyledToggleIconContainer","StyledToggleExpandButtonContainer","StyledToggleExpandButtonFooterContainer","BalloonContext","Balloon","iconProp","expanded","expandedProp","defaultExpanded","headerActions","bodyRef","expandable","setExpandable","setExpanded","maxLinesWhenNotExpanded","bodyElem","clientHeight","parseFloat","getNumLines","scrollHeight","iconType","effectiveExpanded","marginLeft","ToggleWrapper","Component","iconName","toggleIcon","className","NotImplementedFn","BalloonsContext","BalloonsContainer","StyledBalloonsStack","setBalloons","timeoutIdsRef","lastIdRef","api","timeout","aBalloon","balloon","aTimeoutId","notificationsStack","ReactDOM","elementType","elementTypeProp","buttonProps","useButton","domProps","filterDOMProps","StyledButton","StyledDefaultButton","StyledIconButton","variants","default","MnemonicTrigger","onTriggered","StyledButtonGroup","HorizontalArrowKeyNavigation","arrowKeyNavigationProps","focusManager","useFocusManager","keyboardProps","useKeyboard","hasAnyModifier","focusPrevious","wrap","focusNext","continuePropagation","StyledWrapperLabel","StyledCheckboxLabelText","disableFocusAlwaysVisible","useToggleState","useCheckbox","isFocusVisible","isFocused","focusProps","useFocusRing","focusDisabledProps","onFocusCapture","blur","CheckboxIcon","pointerEvents","LafIcon","Disabled","Selected","Focused","CollectionSpeedSearchContext","CollectionSpeedSearchItemContext","SpeedSearchItemHighlightsProvider","itemKey","collection","highlightedRanges","speedSearchContext","useCollectionSpeedSearchResult","selectionManager","inputSelectionManager","speedSearch","focusBestMatch","getKeys","matchedRanges","wrappedSelectionManager","selectAll","createSpeedSearchSelectionManager","latestValues","matchedKeys","noneOfTheMatchesAreSelected","matchedKey","keyToFocus","firstRange","rangeA","rangeB","getLongestCommonPrefixMatch","passedFirstSelection","firstSelectedKey","getMatchToSelect","useCollectionSpeedSearch","keyboardDelegate","speedSearchStateProps","useSpeedSearchState","speedSearchSelectionManager","useSpeedSearch","speedSearchKeyboardDelegate","wrappedKeyboardDelegate","findFirstMatch","fromKey","direction","currentKey","getKeyAbove","getKeyBelow","getFirstKey","global","firstKey","getLastKey","lastKey","createSpeedSearchKeyboardDelegate","speedSearchContextValue","searchPopupProps","constructor","seq","this","_Divider","getCollectionNode","hasChildNodes","_Item","StatelyItem","originalShouldInvalidate","shouldInvalidate","invalidated","GAP","StyledHint","StyledGroup","useCollectionAutoScroll","isVirtualized","focusedKey","scrollIntoView","useCollectionFocusProxy","proxy","dispatchEvent","KeyboardEvent","removeEventListener","StyledComboBoxContainer","StyledComboBoxInput","inset","forwardRef","contextHelp","contextHelpPlacement","inputRefProp","buttonRef","dropdownContainerRef","popoverRef","listBoxRef","isInvalid","useComboBoxState","menuTrigger","allowsCustomValue","inputValue","defaultInputValue","onInputChange","descriptionProps","errorMessageProps","labelProps","comboboxInputProps","listBoxProps","useComboBox","WithLabel","WithInlineContextHelp","showOnFocus","triggerRef","StyledDropdownArrowIcon","Popover","containerPadding","StatelessListBox","useListState","selectionBehavior","useListBox","StyledList","ListBoxSection","section","Option","optionProps","useOption","containerFocused","StyledSectionHeading","StyledSection","itemProps","headingProps","groupProps","useListBoxSection","childNodes","borderRadius","StyledContextHelp","contextHelpForeground","StyledContextHelpWrapper","StyledLabelContainer","StyledLabel","labelRef","applyLabelWidth","commonWidth","LabelAlignmentContext","apply","useAlignedLabels","setCommonWidth","currentWidth","StyledIconHoverContainer","amendName","ICONS_DIR_PREFIX","useIconPath","iconDescriptor","themePath","resolvedValue","findIconPath","resolvedIconPath","useForwardedRef","useSvgIcon","iconNameOrPath","amendment","ext","getPlatformIconPath","darkIcon","getDarkPath","darkPath","fallbackPath","DEFAULT_ICON_SIZE","itemState","ariaBusy","getSvgIcon","svgElement","outerHTML","randomPostfix","toFixed","idMatches","matchAll","modifiedSvg","replaceAll","makeIdsUnique","fetchIcon","theOld","theNew","replaced","replacedAgain","DEFAULT_MINIMUM_BUTTON_SIZE","NAVBAR_MINIMUM_BUTTON_SIZE","minSize","isPressedInput","onPressChange","onPressEnd","onPressStart","onPressUp","shouldCancelOnPointerExit","pressProps","usePress","ArrowIcon","noArrow","previouslyFocusedElementRef","StyledInputBox","StyledAddons","StyledRightAddons","StyledLeftAddons","addonBefore","setIsFocused","onFocusWithinChange","spellCheck","fieldProps","useField","StyledLink","focusBorderColor","labelable","interactionHandlers","FocusRing","focusRingClass","allowEmptySelection","disallowEmptySelection","listProps","listContext","useList","virtualizerProps","renderNode","useListVirtualizer","ListItem","ListContext","Virtualizer","ListDivider","useSeparator","separatorProps","listFocused","useSelectableItem","shouldForwardProp","labelForeground","asCurrentForeground","labelSelectedForeground","asCurrentBackground","selectOnFocus","disallowTypeAhead","allowsTabNavigation","collator","useCollator","usage","sensitivity","delegate","ListKeyboardDelegate","collectionProps","useSelectableCollection","useSelectableList","setFocused","isEmpty","onActionCallback","originalUseListState","useCollectionRef","StyledListSectionHeader","outline","cursor","ListSection","reusableView","headerRef","useVirtualizerItem","layoutInfoToStyle","layoutInfo","renderWrapper","renderChildren","viewType","VirtualizerItem","layout","VariableWidthListLayout","estimatedRowHeight","estimatedHeadingHeight","dividerHeight","sizeToFit","scrollToItem","virtualizer","shouldScrollX","duration","scrollDirection","useMenuTriggerState","positionOrigin","overlayRef","useContextMenu","setPositionOrigin","allProps","defaultAutoFocus","patchCollectionItem","partialNode","result2","partialChildNode","partialChildNodeWithoutType","PatchedItem","bind","PatchedSection","convertChildren","Item2","MenuOverlayContext","MenuContext","useMenu","onActionProp","menuContextValue","useMenuAria","useMenuState","patchCollectionProps","useTreeState","childExpansionBehaviour","expandedKey","onExpandedKeyChange","defaultExpandedKey","StyledMenu","renderMenuNodes","StyledMenuItemText","StyledMenuItemPlatformIcon","StyledMenuItemLafIcon","MenuItemContext","keyboardShortcutProps","useMenuItemLayout","MenuItem","nestedMenuRef","isExpanded","renderSubmenu","Submenu","menuItemProps","hasSubmenu","ariaMenuItemProps","useMenuItemAria","onMouseEnter","onPointerEnter","onPointerDown","hoverProps","useHover","onHoverStart","isAnySubmenuOpen","parentKey","togglePressProps","useMenuItem","overlayProps","positionProps","useOverlayPosition","shouldFlip","MENU_BORDER_WIDTH","arrowProps","StyledMenuItem","StyledMenuItemIcon","StyledNestedArrow","Overlay","OverlayComponent","SimpleOverlay","parentState","rootKey","portalContainer","StyledMenuItemLayout","Content","Shortcut","kbd","useContextOrThrow","allowedIcon","MenuOverlay","restoreFocus","otherOverlayProps","inputOverlayRef","useOverlay","shouldCloseOnBlur","isKeyboardDismissDisabled","isDismissable","shouldCloseOnInteractOutside","areInNestedOverlays","usePreventScroll","onOutsideContextMenu","useOverlayPositionFromOrigin","setPosition","overlayElement","overlayWidth","overlayHeight","totalWidth","documentElement","clientWidth","totalHeight","calculatePosition","offsetHeight","zIndex","DisableScrollStyles","createGlobalStyle","scrollParent","isScrollable","getScrollParent","classList","align","positioningTargetRef","triggerProps","useMenuTrigger","ariaButtonProps","getPlacement","StyledItemsContainer","ul","StyledSearchFieldWrapper","StyledSpeedSearchMenu","useSpeedSearchMenu","speedSearchContainerProps","ListCollection","MenuKeyboardDelegate","contains","focusSafely","setSize","measureSize","useResizeObserver","onResize","sizeStyleProps","maxHeight","emptyText","clear","SpeedSearchSubmenu","SpeedSearchMenuContent","menuRef","SpeedSearchInput","useSubmenuState","rootItem","submenuProps","useSubmenu","highlightedStyle","defaultStyle","disabledStyle","li","useSubmenuAria","submenuBehaviorProps","super","keyBelow","keyAbove","isFocusedRef","focusedKeyRef","defineProperties","SelectionManager","StyledMenuHeading","StyledMenuSectionItemsContainer","MenuSection","useMenuSection","MnemonicContext","createContext","character","onTriggeredProp","keydownListener","parentElement","getClientRects","keyupListener","renderedMnemonicRef","timerId","hidden","MnemonicText","found","UNSAFE_React17SuspenseFix","measureContentSize","NullSuspenseFallback","afterUnsuspended","afterSuspended","afterSuspendedProp","afterUnsuspendedProp","StyledWindowUnderlay","StyledWindowInnerContainer","DEFAULT_WINDOW_MIN_WIDTH","DEFAULT_WINDOW_MIN_HEIGHT","WindowControllerContext","propsContext","modalProps","underlayProps","useModalOverlay","useOverlayTriggerState","dialogProps","titleProps","useDialog","overlayInteractionHandlerProps","UNSAFE_measureContentSize","useResizableMovableOverlay","focusContainmentFixProps","lastFocusedElementRef","probablyFocusedElement","elementToFocus","useFocusContainmentFix","OverlayInteractionHandler","WindowContext","movable","OverlayResizeHandles","StyledFooter","hasBorder","StyledFooterSide","WindowFooter","StyledWindowTitle","h1","WindowHeader","renderTitle","StyledWindowFooter","StyledWindowContentWrapper","WindowsContext","setWindows","newKeyRef","currentWindows","aWindow","ParentOverlayContext","AriaOverlay","element1","element2","overlayRoot1","overlayRoot2","OverlayInteractionHandlerContext","useOverlayInteractionHandler","useOverlayMoveHandle","interactionHandler","finishInteraction","startInteraction","updateBounds","useMove","onMoveStart","onMove","startState","movement","onMoveEnd","overlayResizer","initialBoundsRef","newWidth","initialBounds","newHeight","getResizerProps","side","onResizeStarted","onResizeEnd","useOverlayResizer","RightResizer","LeftResizer","TopResizer","BottomResizer","popoverProps","usePopover","DismissButton","onDismiss","withMinSize","getCenteredBounds","targetElement","targetBounds","ensureInViewport","viewportWidth","viewportHeight","clamp","getContentSize","ceil","cloneNode","returnValue","withTemporaryStyle","useContentSize","observe","measuredSizes","setMeasuredSizes","lastMeasuredSize","at","Size","isEqual","newSize","cancelAnimationFrame","measure","currentSize","aSize","debouncedMeasure","fnRef","currentTimeoutId","useDebouncedCallback","mutationObserver","MutationObserver","subtree","childList","disconnect","width2","height2","inputBounds","onBoundsChanging","contentSize","currentInteraction","setCurrentInteraction","effectiveMinWidth","effectiveMinHeight","applyMinSize","getBounds","updatedBounds","partialBounds","centeredContentBounds","positioned","sized","StyledInnerContainer","DEFAULT_POPUP_MIN_WIDTH","DEFAULT_POPUP_MIN_HEIGHT","_Popup","allowScroll","positioningProp","onCloseProp","PopupControllerContext","useInteractOutside","onInteractOutsideStart","onInteractOutside","positionedBounds","pipe","focusForwarderProps","useFocusForwarder","titleId","useSlotId","useOverlayFocusContain","propsArray","mergeNonNullProps","PopupContext","PopupHeader","StyledPopupHint","StyledPopupHeader","labelDisabledForeground","renderHeader","StyledPopupLayout","StyledPopupLayoutHeader","StyledPopupLayoutContent","StyledPopupLayoutFooter","PopupsContext","popups","setPopups","currentPopups","aPopup","wrappedPopup","useOverlayTrigger","PressResponder","minValue","valueLabel","showValueLabel","progressBarProps","useProgressBar","percentage","forcedDetails","setForcedDetails","setTooltip","contextValue","StyledProgressBarLabel","effectiveDetails","StyledProgressBarContainer","StyledProgressBarLineContainer","hasTopMargin","hasBottomMargin","StyledProgressBarTrack","indeterminate","StyledProgressBarProgress","ProgressBarContext","StyledProgressBarDetails","getIndeterminateStartColor","getIndeterminateEndColor","indeterminateBackgroundAnimation","keyframes","useProgressBarIconButton","hoverTooltip","isHovered","useProgressBarPauseIconButton","paused","Label","LineContainer","Track","Progress","Details","ResizableView","resizerPlacement","resizerProps","useBottomResizer","VerticalResizer","StyledHorizontalResizer","StyledHorizontalResizerArea","handleSize","HorizontalResizer","outerPadding","useLeftResizer","useRightResizer","useTopResizer","StyledVerticalResizer","StyledVerticalResizerArea","useResizer","invert","onHistoryItemSelected","historyButtonTitle","inputContainerRef","isSearchHistoryOpen","setSearchHistoryOpen","showSearchHistoryAction","searchIcon","historyItemText","parseInt","historyItem","StyledSearchIcon","StyledSpeedSearchInput","noMatch","getOutlineColor","StyledSearchText","clearButtonRef","SpeedSearchPopup","StyledSpeedSearchPopup","tooltipForeground","useGhostInput","valueRef","ctrlKey","metaKey","elem","isContentEditable","HTMLInputElement","sliceEnd","defaultIsSearchActive","onIsSearchActiveChange","defaultSearchTerm","ghostInputKeydown","trimmedValue","trimStart","onKeyUp","StyledStatusBar","StyledStatusBarLeft","StyledStatusBarRight","StyledStatusBarSection","StyledWrapper","StyledStatusBarWidget","StyledStatusBarIconWidget","DarculaSeparatorUI","defaultSize","StyledSeparator","backgroundClip","boxSizing","StyledHorizontalSeparator","onUnpin","pinned","TabContentLayout","startIcon","endIcon","editorTabTheme","underlineHeight","underlinedTabInactiveBackground","underlinedTabBackground","hoverInactiveBackground","hoverBackground","inactiveUnderlineColor","underlineColor","underlinedTabInactiveForeground","underlinedTabForeground","StyledEditorTab","StyledDefaultTab","getTabThemeStyles","StyledEditorTabs","StyledDefaultTabs","getTabsThemeStyles","focusable","StyledTabItemLayout","iconStyle","StyledStartIconWrapper","StyledEndIconWrapper","horizontalOverflowIndicatorStyles","StyledHorizontalOverflowShadows","hasOverflowAtStart","hasOverflowAtEnd","Tab","shouldSelectOnPressUp","tabProps","useTab","scrollBarDisabledStyle","StyledTabList","multiRow","noOverflowMenu","noScroll","useTabListState","tabListProps","useTabList","scrolledIndicatorProps","hasOverflow","threshold","setHasOverflow","offsetLeft","scrollLeft","offsetRight","scrollWidth","offsetTop","scrollTop","offsetBottom","newHasOverflow","onScroll","useHasOverflow","overflowedElements","useOverflowObserver","overflowedKeys","scrollableContainer","selectedTabElement","TabsOverflowMenu","onSelect","setSelectedKey","menuItem","toolWindowTabTheme","StyledToolWindowTab","StyledToolWindowTabs","ToolWindowTabs","getAllRanges","ranges","gapRange","range","createRangesFromIndices","indices","lastRange","HighlightedMatch","highlighted","numberPattern","parseComponent","componentStr","min","parseHexRgba","parseShorthandHex","parseRgb","parseRgba","Color","rgba","g","r","NaN","Number","isInteger","parseColorString","withTransparency","alpha","brighter","int","FACTOR","darker","blend","colorOrColorString","getBlendedValue","isNaN","padStart","StyledSplitterContainer","StyledView","StyledSplitterInnerView","resizerPropsOverrides","firstViewRef","lastViewRef","firstSizeState","setFirstSizeState","lastSizeState","setLastSizeState","horizontalValue","verticalValue","FirstResizer","SecondResizer","sizeStyleProp","minSizeStyleProp","isFractionSize","normalizeSize","getSize","getNewSize","newFractionSize","getActualSize","viewElem","actualSize","currentLastSize","currentFirstSize","StyledFloatView","FloatView","boundsStyle","FloatToolWindows","floatWindows","renderToolWindow","stackedFloatWindows","sortedKeys","setSortedKeys","sorted","bringToFront","move","useStackedLayersState","layersProps","toolWindow","MovableToolWindowStripeContext","MovableToolWindowStripeProvider","stripes","draggingRect","setDraggingRect","draggingKey","setDraggingKey","dropPosition","setDropPosition","getDropPositionRef","moveStartLocationRef","addStripe","propsRef","startMove","stripe","stripeElRef","stripeElement","getItemRect","toJSON","indexInMain","mainItems","indexInSplit","splitItems","dropPositionGetters","createGetDropPosition","getDropPosition","draggedRect","endMove","TopStripe","BottomStripe","LeftStripe","RightStripe","InnerView","StyledToolWindowOuterLayout","Shell","hideStripes","getSizeInAnchor","containerSize","isHorizontalToolWindow","mapToKey","sortAndMapToKey","compose","order","filterMains","getMains","filterSplits","filterVisible","expectedViewMode","viewMode","getSplits","filterVisibleDocked","filterVisibleUnDocked","getDocked","docks","mains","splits","mainKey","sizeFraction","sideWeight","getUnDocked","getSideState","main","activeKeys","undocked","docked","DEFAULT_HEIGHT","DEFAULT_WIDTH","getFloatWindowsState","floatingBounds","getFloatWindowState","getStripeRect","start","rect","end","getDropPositions","getRef","score","abs","keyToOffsets","boundingRect","getKeyToOffsets","dropPositions","lastDropPosition","stripeRect","getCanDrop","bestMatch","STRIPE_BUTTON_LINE_HEIGHT","StyledToolWindowStripeButton","StyledToolWindowStripe","theOtherSide","preventCollapse","useElementMove","ghost","ghostOption","otherOptions","updateGhostPosition","defaultGhost","computedBackground","resultColor","nextColor","findEffectiveBackgroundColor","createDefaultGhost","append","ToolWindowStripe","render","onItemPress","getProps","latestPropsRef","moveDisabled","useMovableStripeButtons","isNotCurrentItem","anItem","ToolWindowStripeButton","getStripeButtonStyles","styles","marginValue","StyledUndockSide","UndockSide","ToolWindows","hideToolWindowBars","useWidescreenLayout","mainContentMinWidth","windowsById","mainContentFocusScopeRef","layoutState","setLayoutState","windowFocusableRefs","latestRef","container","_setLayoutState","windowIds","getToolWindowsLayoutState","observer","ResizeObserver","contentRect","unobserve","focusLastActiveWindow","lastFocusedKey","focusMainContent","interactionOutsideRef","onFocusLost","handleBodyFocus","focusLosingElement","focusReceivingElement","useOnFocusLost","renderStripe","toolbarButton","lastFocused","ToolWindowStateProvider","mainContentFocusableRef","renderSideDockedView","resizeDockSplitView","onDockResize","containerBounds","resizeDock","getSplitViewProps","firstAnchor","secondAnchor","horizontalSplitterProps","verticalSplitterProps","outerSplitterProps","innerSplitterProps","undockLayers","resizeUndock","setFloatingBound","renderInnerLayout","ToolWindowStateContext","hide","removeFromSidebar","moveToSide","changeViewMode","stretchWidth","stretchHeight","setFloatingBounds","isDocked","areInSameSection","curry","window1","window2","getViewModeType","layoutToRestore","invalidWindows","targetKey","mapWindows","hideAll","restoreWindows","closableViewModes","viewModeType","sideOrIndex","targetSide","targetIndex","targetSideWindows","indexInTargetSide","sortedTargetWindows","insert","newTargetSideWindows","targetViewMode","stretch","mapFn","property","currentFloatingBound","resizeSide","dock","isInResizingView","_temp2","inputs","useToolWindow","contentRef","focusableContentRef","onFocusChange","contentHasFocus","setContentHasFocus","contentFocusWithinProps","toolWindowProps","autoHideProps","hideTimeoutId","windowFocusWithinProps","useAutoHide","forwardFocus","ignoreFocusedDescendant","toolWindowContentProps","toolWindowHeaderProps","ToolWindowSettingsIconMenu","viewModeActionGroup","VIEW_MODE_ACTION_GROUP_ID","moveToActionGroup","MOVE_TO_ACTION_GROUP_ID","resizeActions","TOOL_WINDOW_RESIZE_ACTION_GROUP_ID","maximizeAction","removeFromSideBarAction","REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID","gearIconActions","ViewModeToActionId","StyledToolWindowHeaderActions","StyledToolWindowHeaderContent","DefaultToolWindowHeader","DOCK_TOOL_WINDOW_ACTION_ID","StyledToolWindowContainer","StyledToolWindowContent","DefaultToolWindowContext","mainContentTitle","defaultToolWindowContext","useToolWindowActions","getToolWindowNumberFromShortcut","DefaultToolWindowToolbarButton","showNumber","getActivateToolWindowActionId","showNumbers","toolWindowsRef","windowById","useToolWindowsActions","getPresentation","groupTabs","isToolWindowFocused","setToolWindowFocused","setActiveKey","defaultActiveKey","toArray","validChild","MultiContentToolWindowContent","renderedViewSwitcher","previousKeys","newActiveKey","activeContent","DOCK_PINNED_MODE_ACTION_ID","DOCK_UNPINNED_MODE_ACTION_ID","UNDOCK_MODE_ACTION_ID","FLOAT_MODE_ACTION_ID","WINDOW_MODE_ACTION_ID","HEIGHT_RESIZE_STEP","WIDTH_RESIZE_STEP","anchors","getAnchorName","docked_pinned","docked_unpinned","undock","float","alert","resizeGroup","isAnySideWindowWindowOpen","getOrdinal","n","ord","borderStyle","borderPropToCssProp","StyledShowMoreButton","StyledHorizontalToolbar","StyledVerticalToolbar","StyledToolbarContent","shouldWrap","firstOverflowedIndex","OrientationContext","overflowBehavior","rootProps","showMoreButtonRef","isOverflowPopupVisible","setOverflowPopupVisible","popupHeight","setPopupHeight","firstOverflowedChildIndex","setFirstOverflowedChildIndex","firstOverflowedChildRef","childElements","firstOverflowedChild","toolbarProps","onMouseMove","firstOverflowedElement","shouldShow","onMouseLeave","toolbarOverflowPopupProps","showOverflowPopup","ToolbarInOverlay","firstVisibleIndex","link","tooltipProps","multiline","Description","inputTriggerRef","useTooltipTriggerState","fallbackRef","positionAria","updatePosition","TooltipTriggerAndOverlay","StyledTooltip","tooltipBackground","hasPointer","tooltipBorderColor","WITH_POINTER_BORDER_RADIUS","fontSizeDelta","StyledDescription","placementToPointerSide","center","isInteractive","pointerPositionStyle","TooltipContext","useTooltip","TooltipPointer","tooltipRef","_Tooltip","POINTER_THICKNESS","TRANSLATE","sideStyles","StyledTooltipPointer","POINTER_WIDTH","POINTER_HEIGHT","normalizeCssValue","withMin","withMax","HEIGHT_OFFSET","WIDTH_OFFSET","limitPointerPositionStyles","applyVerticalMinMax","applyHorizontalMinMax","getOffsetCssProp","pointerPositionToOffsetStyle","offsetValue","lastMouseClientPos","globalMoveHandler","fakeTarget","coordinatesSource","_updatePosition","useMouseEventOverlayPosition","setInteractive","useTooltipTrigger","FocusableProvider","normalizeChildren","useAriaTooltipTrigger","StyledValidationTooltip","StyledWarningValidationTooltip","SpeedSearchTreeNode","TreeNode","treeProps","treeContext","useSpeedSearchTree","useTreeVirtualizer","TreeContext","StyledTree","collectionSpeedSearch","TreeKeyboardDelegate","speedSearchKeyboardProps","selectableTree","useSelectableTree","getKeyLeftOf","getKeyRightOf","TREE_ICON_SIZE","StyledTreeNodeIcon","getIcon","iconPath","TreeNodeIcon","useTreeNodeToggleButton","treeNodeToggleButtonProps","selectedDescendantKeys","toggleSelection","StyledTreeNode","onActionRef","treeNodeProps","useTreeNode","selectionKeyDown","focusedItem","isExpandable","onNodeKeyDown","shouldToggle","shiftKey","useSelectParentOfRemovedSelectedNode","previousCollectionRef","rawSelection","invalid","valid","invalidKey","useCollectionCacheInvalidation","cacheInvalidation","invalidators","lastInvalidators","anInvalidator","Symbol","iterator","TreeCollection","keyMap","iterable","last","visit","nextKey","prevKey","_Symbol$iterator","getKeyBefore","getKeyAfter","idx","getSingleChildrenKeys","getSingleChildrenKeysRecursive","childNodesIterator","firstChild","done","noMoreChildren","isEmptyIterable","TreeSelectionManager","expandSelection","expandKeys","getExpandAndShrinkKeys","shrinkSelection","shrinkKeys","recursivelyGetExpandAndShrinkKeys","previousChild","newKeys","parentDescendants","getAllDescendants","getAllRoots","descendants","stopKeys","_TreeCollection","rootKeys","getAllExpandableKeys","recursivelyAddExpandableKeys","useMultipleSelectionState","useCollection","latestState","expandAll","collapseAll","useTreeRef","newExpandedKeys","toggleTreeNode","expandedSiblings","getRootItemKeys","getChildItems","siblings","getSiblings","aKey","sectionItems","FlattenedTreeLayout","buildChild","layoutNode","doBuildCollection","visibleNodes","maxY","Rect","visibleRect","loaderHeight","loader","LayoutInfo","layoutInfos","placeholderHeight","getVisibleLayoutInfos","collectSelectableItemsRecursive","collectedItems","itemsInSubtree","collectSelectableItems","cachedState","allDescendantsStates","otherInvalidators","StyledCheckboxWrapper","selectItemOnPress","itemContext","selectedKeysProp","defaultSelectedKeys","selectedKeysSetter","useControllableSet","ListLayout","keyToWidth","visibleContentWidth","buildItem","buildNode","buildDivider","rectHeight","estimatedSize","buildCollection","getVisibleContentWidth","invalidateEverything","layoutNodes","newRect","oldRect","invalidationContext","lastWidth","updateItemSize","changed","visibleViews","view","itemContentWidth","intersects","getVisibleRect","isWordSeparator","isWhitespace","char","isUpperCase","isMeaningfulChar","ch","rawPattern","isStarts","isStart","continuous","inputIndex","patternIndex","lastMatch","chars","previousChar","useAriaSelectableCollection","useOriginalSelectableItem","directChildRef","focusManagerRef","forceFocusFirst","containerElement","focusFirst","tabbable","WrappedFocusScope","GetFocusManager","savedUserSelect","handlersRef","webkitUserSelect","pageX","pageY","dragStarted","runAfterTransition","OverflowObserver","mutations","mutation","removedNodes","intersectionObserver","addedNodes","IntersectionObserver","sortedEntries","validEntries","uniqBy","newHiddenElements","isIntersecting","newVisibleElements","previouslyOverflowedElements","currentOverflowElements","childElement","scrollableContainerRef","rootMargin","setOverflowedElements","overflowObserver","processItem","targetNodeKeys","targetNodeKeySet","childValues","childValue","dfs","bfs","childNode","by","compareFn","aa","bb","Context","nullErrorMessage","possiblyBlurredElement","getFocusableTreeWalker","innerRef","ImmutableSet","setValueWithMutation","_len3","_key3","mutate","useStateSetterForSet","webpackAsyncContext","req","__webpack_require__","o","module","exports","ids"],"sourceRoot":""}