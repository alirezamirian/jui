{"version":3,"file":"assets/js/2735.a69b2985.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/recoil-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/tree-utils/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/change-view-nodes.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/Project/persistence/persistentAtomEffect.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/TrackingBranchInfo.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/styled-components.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VcsLogDetailsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VcsLogDropdown.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DateRange.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/vcs-logs.state.ts","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/BranchesFilterDropdown.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogCommitsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/branchTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/VcsBranchesView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/SampleRepoInitializer.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.state.ts","webpack://website/../example-app/src/StatusBar/TasksPopup.tsx","webpack://website/../example-app/src/StatusBar/StatusBarTaskProgressBar.tsx","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/StatusBar/BranchPopupTrigger.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/Project/persistence/PersistentStateProvider.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx","webpack://website/../jui/src/ActionSystem/ActionGroup.tsx","webpack://website/../jui/src/ActionSystem/ActionShortcut.tsx","webpack://website/../jui/src/ActionSystem/useShortcut.ts","webpack://website/../jui/src/ActionSystem/ActionsProvider.tsx","webpack://website/../jui/src/ActionSystem/CommonActionIds.ts","webpack://website/../jui/src/ActionSystem/KeymapProvider.tsx","webpack://website/../jui/src/ActionSystem/Shortcut.ts","webpack://website/../jui/src/ActionSystem/components/ActionButton.tsx","webpack://website/../jui/src/ActionSystem/components/ActionsMenu.tsx","webpack://website/../jui/src/ActionSystem/components/useCreateDefaultActionGroup.tsx","webpack://website/../jui/src/ActionSystem/defaultKeymap.tsx","webpack://website/../jui/src/ActionSystem/shortcutToString.ts","webpack://website/../jui/src/ActionSystem/useActionGroup.tsx","webpack://website/../jui/src/Balloon/Balloon.styled.tsx","webpack://website/../jui/src/Balloon/Balloon.tsx","webpack://website/../jui/src/Balloon/BalloonManager.tsx","webpack://website/../jui/src/Balloon/StyledBalloonsStack.tsx","webpack://website/../jui/src/Button/BareButton.tsx","webpack://website/../jui/src/Button/StyledButton.tsx","webpack://website/../jui/src/Button/Button.tsx","webpack://website/../jui/src/Checkbox/Checkbox.tsx","webpack://website/../jui/src/Checkbox/CheckboxIcon.tsx","webpack://website/../jui/src/CollectionSpeedSearch/CollectionSpeedSearchContext.tsx","webpack://website/../jui/src/CollectionSpeedSearch/HighlightedTextValue.tsx","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearchResult.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchSelectionManager.ts","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearch.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchKeyboardDelegate.ts","webpack://website/../jui/src/Collections/Divider.ts","webpack://website/../jui/src/Collections/Item.ts","webpack://website/../jui/src/Collections/ItemLayout.tsx","webpack://website/../jui/src/Collections/ItemStateContext.tsx","webpack://website/../jui/src/Collections/useCollectionAutoScroll.ts","webpack://website/../jui/src/Collections/useCollectionRef.ts","webpack://website/../jui/src/Collections/useCollectionSearchInput.ts","webpack://website/../jui/src/Icon/AutoHoverPlatformIcon.tsx","webpack://website/../jui/src/Icon/LafIcon.tsx","webpack://website/../jui/src/Icon/PlatformIcon.tsx","webpack://website/../jui/src/Icon/StyledIconWrapper.tsx","webpack://website/../jui/src/Icon/useSvgIcon.tsx","webpack://website/../jui/src/IconButton/IconButton.tsx","webpack://website/../jui/src/IconButtonWithMenu/IconButtonWithMenu.tsx","webpack://website/../jui/src/Img.tsx","webpack://website/../jui/src/InputField/Input.tsx","webpack://website/../jui/src/Label/StyledLabel.ts","webpack://website/../jui/src/InputField/InputField.tsx","webpack://website/../jui/src/Link/StyledLink.tsx","webpack://website/../jui/src/Link/Link.tsx","webpack://website/../jui/src/List/List.tsx","webpack://website/../jui/src/List/ListDivider.tsx","webpack://website/../jui/src/List/ListItem.tsx","webpack://website/../jui/src/List/StyledList.tsx","webpack://website/../jui/src/List/StyledListItem.tsx","webpack://website/../jui/src/List/StyledListSectionHeader.tsx","webpack://website/../jui/src/List/listItemRenderer.tsx","webpack://website/../jui/src/List/useList.ts","webpack://website/../jui/src/List/useSelectableList.ts","webpack://website/../jui/src/List/useListState.ts","webpack://website/../jui/src/Menu/ContextMenuContainer.tsx","webpack://website/../jui/src/Menu/useContextMenu.tsx","webpack://website/../jui/src/Collections/patchCollectionProps.tsx","webpack://website/../jui/src/Menu/Menu.tsx","webpack://website/../jui/src/Menu/MenuItem.tsx","webpack://website/../jui/src/Menu/MenuItemLayout.tsx","webpack://website/../jui/src/Menu/MenuOverlay.tsx","webpack://website/../jui/src/Menu/MenuTrigger.tsx","webpack://website/../jui/src/Menu/SpeedSearchMenu.tsx","webpack://website/../jui/src/Menu/StyledMenu.tsx","webpack://website/../jui/src/Menu/StyledMenuItem.tsx","webpack://website/../jui/src/Menu/Submenu.tsx","webpack://website/../jui/src/Menu/_useSubmenu.ts","webpack://website/../jui/src/Menu/_useSubmenuState.tsx","webpack://website/../jui/src/Menu/MenuSection.tsx","webpack://website/../jui/src/Menu/renderMenuNodes.tsx","webpack://website/../jui/src/Overlay/UNSAFE_React17SuspenseFix.tsx","webpack://website/../jui/src/ModalWindow/ModalWindow.tsx","webpack://website/../jui/src/ModalWindow/WindowContext.ts","webpack://website/../jui/src/ModalWindow/WindowFooter.tsx","webpack://website/../jui/src/ModalWindow/WindowHeader.tsx","webpack://website/../jui/src/ModalWindow/WindowLayout.tsx","webpack://website/../jui/src/ModalWindow/WindowManager.tsx","webpack://website/../jui/src/Overlay/Overlay.tsx","webpack://website/../jui/src/Overlay/OverlayInteractionHandler.tsx","webpack://website/../jui/src/Overlay/OverlayMoveHandle.tsx","webpack://website/../jui/src/Overlay/OverlayResizeHandles.tsx","webpack://website/../jui/src/Overlay/bounds-helpers.tsx","webpack://website/../jui/src/utils/useDebounce.ts","webpack://website/../jui/src/Overlay/useContentSize.tsx","webpack://website/../jui/src/Overlay/useResizableMovableOverlay.tsx","webpack://website/../jui/src/Popup/Popup.tsx","webpack://website/../jui/src/Popup/_useDialog.ts","webpack://website/../jui/src/utils/mergeNonNullProps.tsx","webpack://website/../jui/src/Popup/PopupContext.tsx","webpack://website/../jui/src/Popup/PopupHeader.tsx","webpack://website/../jui/src/Popup/PopupLayout.tsx","webpack://website/../jui/src/Popup/PopupManager.tsx","webpack://website/../jui/src/Popup/PopupTrigger.tsx","webpack://website/../jui/src/Popup/StyledPopupHint.tsx","webpack://website/../jui/src/ProgressBar/ProgressBar.tsx","webpack://website/../jui/src/ProgressBar/ProgressBarStopButton.tsx","webpack://website/../jui/src/ResizableView.tsx","webpack://website/../jui/src/Resizer/BottomResizer.tsx","webpack://website/../jui/src/Resizer/HorizontalResizer.tsx","webpack://website/../jui/src/Resizer/LeftResizer.tsx","webpack://website/../jui/src/Resizer/RightResizer.tsx","webpack://website/../jui/src/Resizer/TopResizer.tsx","webpack://website/../jui/src/Resizer/VerticalResizer.tsx","webpack://website/../jui/src/Resizer/useResizer.ts","webpack://website/../jui/src/SearchInput/SearchInput.tsx","webpack://website/../jui/src/SpeedSearch/SpeedSearchInput.tsx","webpack://website/../jui/src/SpeedSearch/SpeedSearchPopup.tsx","webpack://website/../jui/src/SpeedSearch/useGhostInput.tsx","webpack://website/../jui/src/SpeedSearch/useSpeedSearch.tsx","webpack://website/../jui/src/StatusBar/StatusBar.tsx","webpack://website/../jui/src/StatusBar/StatusBarWidget.tsx","webpack://website/../jui/src/StyledSeparator.tsx","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabContent.tsx","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTab.ts","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTabs.ts","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabs.tsx","webpack://website/../jui/src/Tabs/StyledDefaultTab.ts","webpack://website/../jui/src/Tabs/StyledDefaultTabs.ts","webpack://website/../jui/src/Tabs/TabCloseButton.tsx","webpack://website/../jui/src/Tabs/TabContentLayout.tsx","webpack://website/../jui/src/Tabs/TabItem.tsx","webpack://website/../jui/src/Tabs/TabTheme.ts","webpack://website/../jui/src/Tabs/StyledHorizontalOverflowShadows.tsx","webpack://website/../jui/src/Tabs/Tab.tsx","webpack://website/../jui/src/Tabs/Tabs.tsx","webpack://website/../jui/src/Tabs/useHasOverflow.tsx","webpack://website/../jui/src/Tabs/TabsOverflowMenu.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabContent.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTab.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTabs.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabs.tsx","webpack://website/../jui/src/TextRange.ts","webpack://website/../jui/src/TextWithHighlights/TextWithHighlights.tsx","webpack://website/../jui/src/Theme/parseColorString.ts","webpack://website/../jui/src/Theme/Color.ts","webpack://website/../jui/src/ThreeViewSplitter/ThreeViewSplitter.tsx","webpack://website/../jui/src/ToolWindows/FloatView.tsx","webpack://website/../jui/src/ToolWindows/FloatToolWindows.tsx","webpack://website/../jui/src/ToolWindows/MovableToolWindowStripeProvider.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowOuterLayout.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsLayoutState.ts","webpack://website/../jui/src/ToolWindows/createGetDropPosition.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripeButton.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/useElementMove.tsx","webpack://website/../jui/src/ToolWindows/findEffectiveBackgroundColor.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/UndockSide.tsx","webpack://website/../jui/src/ToolWindows/ToolWindows.tsx","webpack://website/../jui/src/ToolWindows/useOnFocusLost.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowStateProvider.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsState.ts","webpack://website/../jui/src/ToolWindows/utils.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowSettingsIconMenu.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowHeader.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowToolbarButton.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindows.tsx","webpack://website/../jui/src/ToolWindowsImpl/MultiViewToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowActionIds.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowActions.tsx","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowsActions.tsx","webpack://website/../jui/src/Toolbar/Toolbar.tsx","webpack://website/../jui/src/Tooltip/ActionHelpTooltip.tsx","webpack://website/../jui/src/Tooltip/ActionTooltip.tsx","webpack://website/../jui/src/Tooltip/PositionedTooltipTrigger.tsx","webpack://website/../jui/src/Tooltip/Tooltip.tsx","webpack://website/../jui/src/Tooltip/TooltipContext.tsx","webpack://website/../jui/src/Tooltip/TooltipTrigger.tsx","webpack://website/../jui/src/Tooltip/TooltipTriggerAndOverlay.tsx","webpack://website/../jui/src/Tooltip/ValidationTooltip.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTreeNode.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTree.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/useSpeedSearchTree.ts","webpack://website/../jui/src/Tree/StyledTree.tsx","webpack://website/../jui/src/Tree/TreeContext.tsx","webpack://website/../jui/src/Tree/TreeKeyboardDelegate.tsx","webpack://website/../jui/src/Tree/TreeNodeIcon.tsx","webpack://website/../jui/src/Tree/useTreeNodeToggleButton.tsx","webpack://website/../jui/src/Tree/StyledTreeNode.tsx","webpack://website/../jui/src/Tree/TreeNode.tsx","webpack://website/../jui/src/Tree/useTreeNode.tsx","webpack://website/../jui/src/Tree/useSelectableTree.tsx","webpack://website/../jui/src/Tree/__copied__TreeCollection.ts","webpack://website/../jui/src/Tree/getSingleChildrenKeys.ts","webpack://website/../jui/src/Tree/TreeSelectionManager.ts","webpack://website/../jui/src/Tree/useTreeState.ts","webpack://website/../jui/src/Collections/useCollectionCacheInvalidation.ts","webpack://website/../jui/src/Tree/useTreeRef.tsx","webpack://website/../jui/src/VariableWidthListLayout.tsx","webpack://website/../jui/src/Tree/useTreeVirtualizer.tsx","webpack://website/../jui/src/TreeActions/useTreeActions.tsx","webpack://website/../jui/src/TreeCheckboxes/NestedSelection.ts","webpack://website/../jui/src/TreeCheckboxes/SpeedSearchTreeWithCheckboxes.tsx","webpack://website/../jui/src/TreeCheckboxes/TreeNodeCheckbox.tsx","webpack://website/../jui/src/TreeCheckboxes/useNestedSelectionState.ts","webpack://website/../jui/src/utils/string-utils.ts","webpack://website/../jui/src/minusculeMatch.ts","webpack://website/../jui/src/selection/useSelectableCollection.ts","webpack://website/../jui/src/selection/useSelectableItem.tsx","webpack://website/../jui/src/style-constants.ts","webpack://website/../jui/src/styled.ts","webpack://website/../jui/src/utils/FocusScope.tsx","webpack://website/../jui/src/utils/array-utils.ts","webpack://website/../jui/src/utils/interaction-utils/textSelection.ts","webpack://website/../jui/src/utils/interaction-utils/useMove.tsx","webpack://website/../jui/src/utils/keyboard-utils.ts","webpack://website/../jui/src/utils/overflow-utils/OverflowObserver.ts","webpack://website/../jui/src/utils/overflow-utils/useOverflowObserver.tsx","webpack://website/../jui/src/utils/tree-utils.ts","webpack://website/../jui/src/utils/useContextOrThrow.tsx","webpack://website/../jui/src/utils/useEventCallback.ts","webpack://website/../jui/src/utils/useFocusForwarder.ts","webpack://website/../jui/src/utils/useForwardedRef.ts","webpack://website/../jui/src/utils/useLatest.ts","webpack://website/../jui/src/utils/useMouseEventOverlayPosition.tsx","webpack://website/../jui/src/utils/usePrevious.ts","webpack://website/../jui/src/utils/immutableSet.ts","webpack://website/../jui/src/utils/useSet.ts"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif: React.FC = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editor.lineHighlightBorder\": \"none\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  return (\n    <StyledEditor\n      {...props}\n      options={{\n        minimap: { enabled: false },\n        lineHeight: 20,\n        showFoldingControls: \"always\",\n        renderIndentGuides: true,\n        overviewRulerBorder: false,\n        scrollbar: {\n          verticalScrollbarSize: 14,\n          horizontalScrollbarSize: 8,\n          verticalSliderSize: 8,\n          horizontalSliderSize: 8,\n          horizontal: \"auto\",\n          vertical: \"visible\",\n          alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n        },\n        ...props.options,\n      }}\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport { BFSCallback } from \"browserfs/src/core/file_system\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (persistentFsPreference.get() ===\n\"yes\"\n  ? createIndexedDBFS()\n  : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC = ({ children }) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import {\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { fs } from \"./fs\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\nimport { basename } from \"path\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  name: string;\n  path: string;\n  lastModification: number;\n  size: number;\n}\n\n/**\n * recoil atoms and selectors for keeping list and content of files in recoil state, for components that need on such\n * state.\n * NOTE: still not clear if we should be using atomFamily or selectorFamily for this. changing the current\n * implementation to atomFamily however is easy and side effect free.\n */\nexport const dirContentState = selectorFamily({\n  key: \"dirContents\",\n  get: (path: string) => async (): Promise<null | FsItem[]> => {\n    let fileNames: string[];\n    try {\n      fileNames = await fs.promises.readdir(path);\n    } catch (e) {\n      return null;\n    }\n    const stats = await Promise.all(\n      fileNames.map((fileName) => {\n        const filePath = `${path}/${fileName}`;\n        return fs.promises.stat(filePath).then((stat: Stats) => ({\n          ...stat,\n          type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n          filePath,\n        }));\n      })\n    );\n    return stats.map((stat) => ({\n      type: stat.type,\n      name: basename(stat.filePath),\n      path: stat.filePath,\n      lastModification: stat.mtimeMs,\n      size: stat.size,\n    }));\n  },\n});\n\n/**\n * recoil callback to refresh the file content recoil value of a give path.\n * The callback returns `true` the file exists and content is refreshed successfully, and `false otherwise.\n * @param set\n */\nexport const reloadFileFromDiskCallback =\n  ({ set }: CallbackInterface) =>\n  async (path: string) => {\n    try {\n      const content = await fetchFileContent(path);\n      set(fileContent(path), content);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\nconst fetchFileContent = async (\n  filepath: string | undefined\n): Promise<string> => {\n  if (!filepath) {\n    return \"\";\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n};\n\n/**\n * **Note**: Still not quite clear if we should use atom and [synchronize with source of truth (FS)][recoil-atom-effects],\n * or if we should use selector and refresh it when needed. We probably need a proper [VFS][vfs] implementation at\n * some point, which would be capable of tracking modifications, and setting up listeners for it, and then atoms, can\n * hold the states like directory content, with effects which uses the listener API.\n * A few things to consider in that regard:\n * - if modifications to files are not directly synchronized to fs, using isomorphic-git for updating the file status\n *   can be tricky, unless an FS implementation is provided which uses the file content that is not yet synced with\n *   the actual local FS. Maybe something like Intellij's VFS, can be implemented as a BrowserFS backend impl.\n *\n * **Note**: currently, only text file is supported, for simplicity.\n *\n * [recoil-atom-effects]: https://recoiljs.org/docs/guides/atom-effects#write-through-cache-example\n * [vfs]: https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html\n **/\nexport const fileContent = atomFamily<string, string | undefined>({\n  key: \"fileContent\",\n  default: fetchFileContent,\n  effects: (filepath) => [\n    ({ onSet }) => {\n      onSet((content) => {\n        if (filepath) {\n          // Should a sync API be used here?\n          fs.promises\n            .writeFile(filepath, content, \"utf8\")\n            .catch((e: unknown) => {\n              console.error(\"failed to sync the file back to the fs\", e);\n            });\n        }\n      });\n    },\n  ],\n});\n\nexport const useReloadFromDisk = (path: string) => {\n  return useRecoilRefresher_UNSTABLE(dirContentState(path));\n};\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import {\n  RecoilState,\n  RecoilValue,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useRecoilState,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { FocusEvent, useEffect, useRef, useState } from \"react\";\nimport { equals } from \"ramda\";\n\nexport const createFocusBasedSetterHook = <T extends unknown, N extends T = T>(\n  state: RecoilState<T>,\n  nullValue: N\n) => {\n  let focusedElement: Element | null = null;\n  return (value: T, name: string = \"unknown\") => {\n    const setValue = useSetRecoilState(state);\n    const elementRef = useRef<Element>();\n    useEffect(() => {\n      if (focusedElement === elementRef.current) {\n        setValue((currentValue) =>\n          equals(value, currentValue) ? currentValue : value\n        );\n      }\n    }, [value]);\n    return {\n      onFocus: (e: FocusEvent) => {\n        elementRef.current = e.currentTarget;\n        focusedElement = e.currentTarget;\n        setValue(value);\n      },\n      onBlur: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n      },\n    };\n  };\n};\n\n/**\n * Returns the latest value of a recoil value, or null, if the value is being loaded for the first time.\n * Useful for when stale data is ok, but may get synced soon.\n */\nexport function useLatestRecoilValue<T>(recoilValue: RecoilValue<T>): T | null {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  return state;\n}\n\n/**\n * Refreshes recoil value on mount\n */\nexport function useRefreshRecoilValueOnMount<T>(value: RecoilValue<T>) {\n  const refresh = useRecoilRefresher_UNSTABLE(value);\n  useEffect(() => {\n    refresh();\n  }, []);\n}\n\nexport function useRecoilInitialValue<T>(recoilState: RecoilState<T>): T;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: Exclude<T, undefined | null>\n): Exclude<T, undefined | null>;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: T\n) {\n  return useRecoilCallback(\n    ({ snapshot }) =>\n      () =>\n        snapshot.getLoadable(recoilState).getValue() ?? defaultValue,\n    []\n  );\n}\n","import {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"./project-utils\";\nimport { createFocusBasedSetterHook } from \"../recoil-utils\";\nimport path from \"path\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const sampleRepos = {\n  JUI: {\n    path: \"/workspace/jui\",\n    url: \"https://github.com/alirezamirian/jui.git\",\n  },\n  \"React Spectrum\": {\n    path: \"/workspace/react-spectrum\",\n    url: \"https://github.com/adobe/react-spectrum.git\",\n  },\n  Recoil: {\n    path: \"/workspace/recoil\",\n    url: \"https://github.com/facebookexperimental/Recoil.git\",\n  },\n  ExampleRepo: {\n    path: \"/workspace/example-repo\",\n    url: \"https://github.com/thurwitz/example-branches.git\",\n  },\n};\nconst sampleRepoKey: keyof typeof sampleRepos = \"JUI\";\n\n/**\n * temporary hard coded sample repo, until clone UI is implemented.\n */\nexport const sampleRepo = sampleRepos[sampleRepoKey];\n\nexport const currentProjectState = atom<Project>({\n  key: \"project\",\n  default: {\n    name: \"Workspace\",\n    path: \"/workspace\",\n  },\n});\n\nexport const projectFilePath = selectorFamily({\n  key: \"projectFilePath\",\n  get:\n    (projectRelativePath: string) =>\n    ({ get }) =>\n      path.join(get(currentProjectState).path, projectRelativePath),\n});\n\nexport const currentProjectFilesState = selector({\n  key: \"project.current.files\",\n  get: async ({ get }): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectState);\n    return get(projectFilesState(project.path));\n  },\n});\n\nexport const projectFilesState = selectorFamily({\n  key: \"project.files\",\n  get:\n    (\n      projectPath: string /* could be changed to project id, when project entity is more mature */\n    ) =>\n    async ({ get }): Promise<ProjectFsItem[]> => {\n      const items = get(dirContentState(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = get(dirContentState(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      (items || []).forEach((item) => addItem(item));\n      return files;\n    },\n});\n\nexport const useRefreshCurrentProjectFiles = () =>\n  useRecoilRefresher_UNSTABLE(currentProjectFilesState);\n\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsState = atom<string[]>({\n  key: \"project.activePaths\",\n  default: [],\n});\n\n/**\n * Sets the value of {@link activePathsState} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsState,\n  []\n);\n","import {\n  atom,\n  selector,\n  useRecoilCallback,\n  useRecoilState,\n  useSetRecoilState,\n} from \"recoil\";\nimport { Focusable } from \"../common-types\";\nimport { descend, sortWith } from \"ramda\";\nimport {\n  currentProjectFilesState,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Position } from \"monaco-editor\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n// settings.\nconst temporaryTabsDefaultValue = selector({\n  key: \"editor.tabs/Default\",\n  get: ({ get }) =>\n    sortWith(\n      [\n        // first README.md, then ts and js files.\n        descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n        descend((file) => file.path.endsWith(\".ts\")),\n        descend((file) => file.path.endsWith(\".js\")),\n      ],\n      get(currentProjectFilesState).filter((item) => item.type === \"file\")\n    )\n      .slice(0, 12)\n      // map project file to editor state object\n      .map((file) => ({\n        filePath: file.path,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n      })),\n});\n\n// it should become something under \"project\" state later.\nexport const editorTabsState = atom<EditorTabState[]>({\n  key: \"editor.tabs\",\n  default: temporaryTabsDefaultValue,\n});\n\nconst activeEditorTabIndexState = atom<number>({\n  key: \"editor.activeTabIndex\",\n  default: 0,\n});\n\nexport const activeEditorTabState = selector<EditorTabState | null>({\n  key: \"editor.activeTab\",\n  get: ({ get }) => {\n    const tabs = get(editorTabsState);\n    return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n  },\n});\n\nexport const editorCursorPositionState = atom<Position>({\n  key: \"editor.cursorPosition\",\n  default: new Position(0, 0),\n});\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefState = atom<null | Focusable>({\n  key: \"editor.focusHandle\",\n  default: null,\n});\n\nexport interface EditorStateManager {\n  tabs: EditorTabState[];\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOthersTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n}\n\n/**\n * TODO: refactor this to expose actions in a way that doesn't create dependency to state. A piece of UI that only\n *  needs to open a file in editor in response to some action (e.g. ProjectViewPane or ChangeViewTree) doesn't need to\n *  re-render on editor state changes\n */\nexport const useEditorStateManager = (): EditorStateManager => {\n  const [tabsState, setTabsState] = useRecoilState(editorTabsState);\n  const setActiveTabIndex = useSetRecoilState(activeEditorTabIndexState);\n  const focus = useRecoilCallback(\n    ({ snapshot }) =>\n      () => {\n        snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n      },\n    []\n  );\n\n  const select = (index: number) => {\n    setActiveTabIndex(index);\n  };\n  const closePath = (filePath: string) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      closeTab(index);\n      setActiveTabIndex(Math.max(index - 1, 0));\n    }\n  };\n  const openPath = (filePath: string, shouldFocus = true) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      select(index);\n    } else {\n      const newIndex = tabsState.length;\n      setTabsState((currentState) => [\n        ...currentState,\n        {\n          filePath,\n          editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n        },\n      ]);\n      select(newIndex);\n    }\n    if (shouldFocus) {\n      // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n      // event handler) is picked up by editor, adding unwanted new line.\n      setTimeout(focus);\n    }\n  };\n  const closeTab = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex !== index)\n    );\n  };\n  const closeOthersTabs = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex === index)\n    );\n  };\n  return {\n    tabs: tabsState,\n    // This should become an action. Something like \"open project file\", when action system is implemented.\n    openPath,\n    closePath,\n    closeTab,\n    closeOthersTabs,\n    select,\n  };\n};\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useResetRecoilState,\n} from \"recoil\";\nimport { sampleRepos } from \"../Project/project.state\";\nimport { findRoot, status, statusMatrix } from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport { useEffect } from \"react\";\nimport * as path from \"path\";\nimport { asyncFilter } from \"../async-utils\";\n\n// This should be refactored to have the configuration file(s) as the source of truth.\nconst temporaryVcsMappingsDefaultState = selector({\n  key: \"vcsRoots/temporaryDefault\",\n  get: async (): Promise<VcsDirectoryMapping[]> => {\n    return asyncFilter(\n      ({ dir }) => fs.promises.stat(dir).then(Boolean),\n      Object.values(sampleRepos).map(({ path }) => ({\n        dir: path,\n        vcs: \"git\",\n      }))\n    );\n  },\n});\nexport const vcsRootsState = atom<VcsDirectoryMapping[]>({\n  key: \"vcsRoots\",\n  default: temporaryVcsMappingsDefaultState,\n});\n\n/**\n * temporary(?) hook to refresh vcs roots\n */\nexport const useRefreshVcsRoots = () => {\n  const refreshTemporaryVcsMappingsDefault = useRecoilRefresher_UNSTABLE(\n    temporaryVcsMappingsDefaultState\n  );\n  const refreshVcsRoots = useResetRecoilState(vcsRootsState);\n  return () => {\n    refreshTemporaryVcsMappingsDefault();\n    refreshVcsRoots();\n  };\n};\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsRootForFile = selectorFamily<string | null, string>({\n  key: \"gitRootForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      return findRoot({ fs, filepath }).catch(() => null);\n    },\n});\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: Should it be an atom or selector?\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n */\nexport const fileStatusState = atomFamily<FileStatus, string>({\n  key: \"fileStatus\",\n  default: \"NOT_CHANGED\",\n});\n\nexport const useUpdateFileStatus = () =>\n  useRecoilCallback(\n    ({ snapshot, set }: CallbackInterface) =>\n      async (filepath: string) => {\n        const repoRoot = await snapshot.getPromise(vcsRootForFile(filepath));\n        if (repoRoot != null) {\n          console.time(`status ${filepath}`);\n          const fileStatus = await status({\n            fs,\n            dir: repoRoot,\n            filepath: path.relative(repoRoot, filepath),\n          });\n          console.timeEnd(`status ${filepath}`);\n          set(fileStatusState(filepath), convertGitStatus(fileStatus));\n        }\n      },\n    []\n  );\n\nexport const useUpdateVcsFileStatuses = () =>\n  useRecoilCallback(\n    ({ snapshot, transact_UNSTABLE }: CallbackInterface) =>\n      async () => {\n        const vcsDirectoryMappings = await snapshot.getPromise(vcsRootsState);\n        return Promise.all(\n          vcsDirectoryMappings\n            .filter(({ vcs }) => vcs === \"git\")\n            .map(async ({ dir }) => {\n              console.time(\"statusMatrix\");\n              const rows = await statusMatrix({ fs, dir });\n              console.timeEnd(\"statusMatrix\");\n              transact_UNSTABLE(({ set }) => {\n                rows.forEach((row) => {\n                  set(\n                    fileStatusState(`${dir}/${row[0]}`),\n                    convertGitStatus(row)\n                  );\n                });\n              });\n            })\n        );\n      },\n    []\n  );\n\nexport const useInitializeVcs = () => {\n  const updateVcsFileStatuses = useUpdateVcsFileStatuses();\n  useEffect(() => {\n    updateVcsFileStatuses().catch((e) => {\n      console.error(\"could not initialize VCS file statuses\", e);\n    });\n  }, []);\n};\n","import { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { useRecoilValue } from \"recoil\";\nimport { fileStatusState } from \"./file-status.state\";\nimport React from \"react\";\nimport { FileStatus } from \"./file-status\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const fileStatus = useRecoilValue(fileStatusState(filepath));\n  return useStatusColor(fileStatus);\n};\n\nexport const FileStatusColor: React.FC<{ filepath: string }> = ({\n  children,\n  filepath,\n}) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{ status: FileStatus }> = ({\n  children,\n  status,\n}) => {\n  const color = useStatusColor(status);\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport {\n  useRecoilValue,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { Editor } from \"./Editor\";\nimport {\n  activeEditorTabState,\n  editorCursorPositionState,\n  editorRefState,\n  useEditorStateManager,\n} from \"./editor.state\";\nimport { fileContent } from \"../fs/fs.state\";\nimport { useUpdateFileStatus } from \"../VersionControl/file-status.state\";\nimport * as path from \"path\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useAction } from \"@intellij-platform/core\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\n\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const editorStateManager = useEditorStateManager();\n  const activeTab = useRecoilValue(activeEditorTabState);\n  const editorRef = useRef<editor.IEditor>();\n  const [active, setActive] = useState(false);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetRecoilState(editorCursorPositionState);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items),\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOthersTabs,\n  });\n\n  const setEditorRef = useSetRecoilState(editorRefState);\n\n  const fileContentState = fileContent(activeTab?.filePath);\n  const contentLoadable = useRecoilValueLoadable(fileContentState);\n  const setContent = useSetRecoilState(fileContentState);\n  const updateFileStatus = useUpdateFileStatus();\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (activeTab) {\n      updateFileStatus(activeTab.filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n  useEffect(() => {\n    editorRef.current?.focus();\n    if (activeTab?.editorState.cursorPos) {\n      editorRef.current?.setPosition(activeTab?.editorState.cursorPos);\n    }\n  }, [activeTab?.filePath]);\n\n  const activePathsProviderProps = useActivePathsProvider(\n    activeTab ? [activeTab.filePath] : []\n  );\n\n  const content = contentLoadable.valueMaybe();\n\n  return (\n    <StyledFileEditorContainer\n      {...mergeProps(activePathsProviderProps, {\n        onFocus: () => {\n          setActive(true);\n          setEditorRef({\n            focus: () => editorRef.current?.focus(),\n          });\n        },\n      })}\n    >\n      {editorStateManager.tabs.length > 0 && (\n        <ContextMenuContainer\n          renderMenu={() => (\n            <Menu\n              // TODO: detect which tab was triggering context menu and handle the action accordingly\n              //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n              //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n              //  modified to pass the MouseEvent object, in renderMenu.\n              onAction={notImplemented}\n            >\n              <Item key=\"close\">Close</Item>\n              <Item key=\"closeOthers\">Close Other tabs</Item>\n              <Item key=\"closeAll\">Close all tabs</Item>\n              <Item key=\"closeLeft\">Close tabs to the left</Item>\n              <Item key=\"closeRight\">Close tabs to the right</Item>\n            </Menu>\n          )}\n        >\n          <EditorTabs\n            items={editorStateManager.tabs}\n            active={active}\n            selectedKey={activeTab?.filePath}\n            onSelectionChange={(key) =>\n              editorStateManager.select(\n                editorStateManager.tabs.findIndex((tab) => tab.filePath === key)\n              )\n            }\n            noBorders\n          >\n            {(tab) => {\n              const filename = path.basename(tab.filePath);\n              const icon = <PlatformIcon icon={getIconForFile(tab.filePath)} />;\n              return (\n                <TabItem\n                  key={tab.filePath}\n                  textValue={filename}\n                  inOverflowMenu={\n                    <MenuItemLayout content={filename} icon={icon} />\n                  }\n                >\n                  <TooltipTrigger\n                    tooltip={<ActionTooltip actionName={tab.filePath} />}\n                  >\n                    <EditorTabContent\n                      icon={icon}\n                      title={\n                        <FileStatusColor filepath={tab.filePath}>\n                          {filename}\n                        </FileStatusColor>\n                      }\n                      closeButton={\n                        <TooltipTrigger\n                          tooltip={\n                            <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                          }\n                        >\n                          <TabCloseButton\n                            onPress={(e) => {\n                              if (e.altKey) {\n                                tabActionsRef.current.closeOthersTabs(\n                                  editorStateManager.tabs.indexOf(tab)\n                                );\n                              } else {\n                                tabActionsRef.current.closePath(tab.filePath);\n                              }\n                            }}\n                          />\n                        </TooltipTrigger>\n                      }\n                      containerProps={{\n                        onDoubleClick: () => {\n                          hideAllAction?.perform();\n                        },\n                      }}\n                    />\n                  </TooltipTrigger>\n                </TabItem>\n              );\n            }}\n          </EditorTabs>\n        </ContextMenuContainer>\n      )}\n      {activeTab &&\n        (typeof content === \"string\" ? (\n          <Editor\n            height=\"100%\"\n            path={activeTab.filePath}\n            onMount={(monacoEditor, monaco) => {\n              monacoEditor.focus();\n              enableJsx(monaco);\n              editorRef.current = monacoEditor;\n              monacoEditor.onDidChangeCursorPosition((e) => {\n                setCursorPositionState(e.position);\n              });\n              monacoEditor.onDidChangeModel(() => {\n                const position = editorRef.current?.getPosition();\n                if (position) {\n                  setCursorPositionState(position);\n                }\n              });\n            }}\n            onChange={updateContent}\n            value={content}\n          />\n        ) : (\n          content && \"UNSUPPORTED CONTENT\"\n        ))}\n      {contentLoadable.state === \"loading\" && <FileEditorLoading />}\n    </StyledFileEditorContainer>\n  );\n};\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  CallbackInterface,\n  GetRecoilValue,\n  selector,\n  useRecoilCallback,\n} from \"recoil\";\nimport { currentProjectState, Project } from \"../Project/project.state\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport { vcsRootsState } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom({\n  key: \"projectView.foldersOnTop\",\n  default: true,\n});\n\nexport const expandedKeysState = atom({\n  key: \"projectView.expandedKeys\",\n  default: selector({\n    key: \"projectView.expandedKeys/default\",\n    get: ({ get }) =>\n      new Set<Key>(\n        get(vcsRootsState).flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n      ),\n  }),\n});\n\nexport const selectedKeysState = atom<Selection>({\n  key: \"projectView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\nexport const projectViewTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"projectView.focusHandle\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const currentProjectTreeState = selector({\n  key: \"projectTree\",\n  get: ({ get }) => {\n    const project = get(currentProjectState);\n    return createProjectTree(project, get);\n  },\n});\n\ntype FilesTreeSort = \"name\"; // more to be added\n\n// TODO: add more sort options and add \"Tree Appearance\" option in Project tool window settings menu.\nexport const projectTreeSortState = atom<FilesTreeSort>({\n  key: \"project.tree.sort\",\n  default: \"name\",\n});\n\n/**\n * NOTE: using in-place native sort for performance.\n * See more https://www.measurethat.net/Benchmarks/Show/6698/0/ramda-sort-vs-js-native-sort\n */\nfunction sortProjectTreeNodes(items: FileTreeNode[]): void {\n  // TODO: add sortBy: FileTreeSort parameter\n  // TODO: add directoriesOnTop: boolean parameter\n  items.sort((item1, item2) => {\n    if (item1.name < item2.name) {\n      return -1;\n    }\n    if (item1.name > item2.name) {\n      return 1;\n    }\n    return 0;\n  });\n}\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: GetRecoilValue\n): Promise<ProjectTreeRoot> {\n  const rootItems = get(dirContentState(project.path));\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const node = {\n        ...item,\n        parent,\n      };\n      const dirNode: FileTreeDirNode = { ...node, children: [] };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          dirNode.children = (\n            await Promise.all(\n              (get(dirContentState(item.path)) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          sortProjectTreeNodes(dirNode.children);\n          return dirNode;\n        }\n        return null;\n      }\n      return node;\n    };\n\n  const children = (\n    await Promise.all((rootItems || []).map(mapItem(null)))\n  ).filter(notNull);\n  sortProjectTreeNodes(children);\n  return {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children,\n  };\n}\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for expanding to a certain path in project view.\n * @param snapshot\n * @param set\n */\nexport const expandToPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (path: string) => {\n    const expandedKeys = snapshot.getLoadable(expandedKeysState).valueOrThrow();\n    const keysToExpand = [\n      snapshot.getLoadable(currentProjectState).valueOrThrow().path,\n    ].concat(getParentPaths(path));\n    set(expandedKeysState, new Set([...expandedKeys, ...keysToExpand]));\n  };\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n * // TODO: open project view tool window if needed, when tool window state is also moved to recoil instead of local\n * //  state.\n */\nexport const selectKeyAndFocusCallback =\n  ({ snapshot }: CallbackInterface) =>\n  (key: Key) => {\n    const treeRef = snapshot\n      .getLoadable(projectViewTreeRefState)\n      .valueOrThrow()?.current;\n    treeRef?.replaceSelection(key);\n    treeRef?.focus(key);\n  };\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useRecoilCallback(expandToPathCallback, []);\n  const selectKeyAndFocus = useRecoilCallback(selectKeyAndFocusCallback, []);\n  return (path: string) => {\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","import {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectState,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeState,\n  expandedKeysState,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefState,\n  selectedKeysState,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useRecoilValue(currentProjectState);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetRecoilState(projectViewTreeRefState);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const projectTree = useRecoilValue(currentProjectTreeState);\n\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const foldersOnTop = useRecoilValue(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n\n  return (\n    <DefaultSuspense>\n      <SpeedSearchTree\n        treeRef={treeRef}\n        {...activePathsProviderProps}\n        items={[projectTree] as ProjectTreeNode[]}\n        onAction={(path) => {\n          editor.openPath(`${path}`);\n        }}\n        fillAvailableSpace\n        autoFocus\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n      >\n        {(item) => (\n          <Item\n            key={item.path}\n            textValue={item.name}\n            childItems={\n              \"children\" in item ? sortItems(item.children) : undefined\n            }\n          >\n            <ItemLayout>\n              {<ProjectViewNodeIcon node={item} />}\n              {item.type === \"project\" ? (\n                <>\n                  <b>\n                    <HighlightedTextValue />\n                  </b>\n                  <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                </>\n              ) : (\n                <FileTreeNodeText node={item} />\n              )}\n              {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n            </ItemLayout>\n          </Item>\n        )}\n      </SpeedSearchTree>\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport {\n  projectViewTreeRefState,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useRecoilValue(projectViewTreeRefState);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useRecoilValue(activeEditorTabState);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n  ];\n}\n","import { atom, CallbackInterface, selector, useRecoilCallback } from \"recoil\";\nimport { checkout, resetIndex, statusMatrix, StatusRow } from \"isomorphic-git\";\nimport { useEffect } from \"react\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\n\nimport { fs } from \"../../fs/fs\";\nimport { reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport {\n  useUpdateFileStatus,\n  vcsRootForFile,\n  vcsRootsState,\n} from \"../file-status.state\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n};\n\nexport interface Change {\n  before: Revision;\n  after: Revision;\n}\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: Change[];\n}\n\nexport const changeListsState = atom<ChangeListObj[]>({\n  key: \"changelists.lists\",\n  default: [\n    {\n      id: \"some-UUID\",\n      name: \"Changes\",\n      comment: \"last modified commit message\",\n      changes: [],\n      active: true,\n    },\n    {\n      id: \"some-other-UUID\",\n      name: \"Some other changelist\",\n      comment: \"Some empty changelist for testing\",\n      changes: [],\n      active: false,\n    },\n  ],\n});\n\nexport const activeChangeListState = selector<ChangeListObj | null>({\n  key: \"changelists.lists/default\",\n  get: ({ get }) =>\n    get(changeListsState).find((changeList) => changeList.active) ?? null,\n});\n\nexport const allChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changelists.allChanges\",\n  get: ({ get }) =>\n    get(changeListsState)\n      .map((changeLists) => changeLists.changes)\n      .flat(),\n});\n\nconst isAChange = ([, head, workingDir, stage]: StatusRow): boolean =>\n  head !== 1 || workingDir !== 1 || stage !== 1;\n\nconst refreshChangesCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  async () => {\n    const gitRoots = (await snapshot.getPromise(vcsRootsState)).filter(\n      (root) => root.vcs === \"git\"\n    );\n    const allStatusMatrices = await Promise.all(\n      gitRoots.map(async ({ dir }) => {\n        const rows = await statusMatrix({ fs, dir });\n        return rows\n          .filter(isAChange)\n          .map(\n            ([pathname, ...theRest]) =>\n              [path.join(dir, pathname), ...theRest] as StatusRow\n          );\n      })\n    );\n    const unversionedPaths = []; // FIXME: handle unversioned files\n    const changes = allStatusMatrices\n      .flat()\n      .map(([path, head, workdir, stage]) => ({\n        // FIXME: change object creation doesn't cover all kind of changes.\n        after: { path, isDir: false },\n        before: { path, isDir: false },\n      }));\n\n    // FIXME: changes now all go to default change list on each refresh. fix it.\n    set(changeListsState, (changeLists) =>\n      changeLists.map((changeList) => {\n        if (changeList.active) {\n          return {\n            ...changeList,\n            changes,\n          };\n        }\n        return {\n          ...changeList,\n          changes: [],\n        };\n      })\n    );\n  };\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  const updateFileStatus = useUpdateFileStatus();\n  return useRecoilCallback(\n    (callbackInterface) => async (changes: readonly Change[]) => {\n      const { snapshot, set } = callbackInterface;\n      const reloadFileFromDisk = reloadFileFromDiskCallback(callbackInterface);\n\n      const changesWithRepoRoots = await Promise.all(\n        changes\n          .filter((change) => !change.after.isDir)\n          .map(async (change) => {\n            const repoRoot = (await snapshot.getPromise(\n              vcsRootForFile(change.after.path)\n            ))!; // FIXME: handle null\n            return {\n              repoRoot,\n              fullPath: change.after.path,\n              relativePath: path.relative(repoRoot, change.after.path),\n            };\n          })\n      );\n      const groupedChanges = groupBy(\n        ({ repoRoot }) => repoRoot,\n        changesWithRepoRoots\n      );\n      await Promise.all(\n        Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n          await checkout({\n            fs,\n            dir: repoRoot,\n            force: true,\n            filepaths: items.map(({ relativePath }) => relativePath),\n          });\n          await Promise.all(\n            items.map(async ({ fullPath, relativePath }) => {\n              await resetIndex({ fs, dir: repoRoot, filepath: relativePath });\n              await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n              return updateFileStatus(fullPath);\n            })\n          );\n        })\n      );\n\n      // Remove all changes from changelists. It's much more efficient than refresh.\n      set(changeListsState, (changeLists) =>\n        changeLists.map((changeList) => {\n          return {\n            ...changeList,\n            changes: changeList.changes.filter(\n              (change) => !changes.includes(change)\n            ),\n          };\n        })\n      );\n    },\n    []\n  );\n};\n\nexport const useRefreshChanges = () =>\n  useRecoilCallback(refreshChangesCallback, []);\n\nexport const useSetActiveChangeList = () =>\n  useRecoilCallback(\n    ({ set, snapshot }) =>\n      (changeListId) => {\n        const changeLists = snapshot.getLoadable(changeListsState).getValue();\n        const targetChangeList = changeLists.find(\n          ({ id }) => id === changeListId\n        );\n        if (targetChangeList) {\n          set(\n            changeListsState,\n            changeLists.map((changeList) => ({\n              ...changeList,\n              active: changeList === targetChangeList,\n            }))\n          );\n        }\n        // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n      },\n    []\n  );\n\n// temporary, perhaps\nexport const useInitializeChanges = () => {\n  const refresh = useRefreshChanges();\n  useEffect(() => {\n    refresh().catch((e) => console.error(\"could not initialize changes\", e));\n  }, [refresh]);\n};\n","import { uniq } from \"ramda\";\nimport { getParentPaths } from \"../file-utils\";\n\nexport interface DirectoryNode {\n  type: \"directory\";\n  dirPath: string;\n  parentNodePath: string;\n  children: ReadonlyArray<any>;\n}\n\ntype GroupByDirectorAdapter<T, D extends DirectoryNode> = {\n  shouldCollapseDirectories?: boolean;\n  getPath: (node: T) => string;\n  createDirectoryNode?: (dirNode: DirectoryNode) => D;\n};\n/**\n * Exported only for tests.\n * @internal\n */\nexport const groupByDirectory =\n  <T, D extends DirectoryNode>({\n    getPath,\n    createDirectoryNode = (i) => i as D,\n    shouldCollapseDirectories = false,\n  }: GroupByDirectorAdapter<T, D>) =>\n  (nodes: ReadonlyArray<T>): readonly D[] => {\n    const pathToNodeCache: Record<string, D> = {};\n    const rootDirNodes = nodes.map((node) => {\n      const filepath = getPath(node);\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(\n        filepath.startsWith(\"/\") ? filepath : `/${filepath}`\n      ).reduce((prevNode: D | T, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = createDirectoryNode({\n            type: \"directory\",\n            dirPath,\n            parentNodePath: \"\",\n            children: [],\n          });\n        }\n        if (isDirectoryNode(prevNode)) {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      }, node) as D; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const directoryNodes = uniq(rootDirNodes);\n    return shouldCollapseDirectories\n      ? directoryNodes.map((node) =>\n          collapseDirectories(createDirectoryNode, node)\n        )\n      : directoryNodes;\n  };\n\nfunction isDirectoryNode<T, D extends DirectoryNode>(node: D | T): node is D {\n  return \"type\" in node && node.type === \"directory\";\n}\n\nfunction collapseDirectories<T, D extends DirectoryNode>(\n  createDirectorNode: Required<\n    GroupByDirectorAdapter<T, any>\n  >[\"createDirectoryNode\"],\n  dirNode: D\n): D {\n  let { children, dirPath, parentNodePath } = dirNode;\n  if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n    dirPath = dirNode.children[0].dirPath;\n    children = dirNode.children[0].children.map((child: D | T) =>\n      isDirectoryNode<T, D>(child)\n        ? collapseDirectories<T, D>(createDirectorNode, {\n            ...child,\n            parentNodePath: dirPath,\n          })\n        : child\n    );\n    return collapseDirectories<T, D>(\n      createDirectorNode,\n      createDirectorNode({\n        type: \"directory\",\n        dirPath,\n        parentNodePath,\n        children,\n      })\n    );\n  }\n  return {\n    ...dirNode,\n    children: children.map((child) =>\n      isDirectoryNode(child)\n        ? collapseDirectories<T, D>(createDirectorNode, child)\n        : child\n    ),\n  };\n}\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { Change, ChangeListObj } from \"../change-lists.state\";\nimport { GroupFn } from \"./ChangesView.state\";\n\nexport interface ChangeBrowserNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface GroupNode<T extends string> extends ChangeBrowserNode<T> {\n  children: ReadonlyArray<AnyNode>;\n}\n\nexport interface ChangeNode extends ChangeBrowserNode<\"change\"> {\n  change: Change;\n}\n\nexport interface ChangeListNode extends GroupNode<\"changelist\"> {\n  changeList: ChangeListObj;\n}\n\nexport interface DirectoryNode extends GroupNode<\"directory\"> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode extends GroupNode<\"repo\"> {\n  repository: VcsDirectoryMapping;\n}\n\nexport type AnyGroupNode = ChangeListNode | RepositoryNode | DirectoryNode;\nexport type AnyNode = AnyGroupNode | ChangeNode;\nconst changeBrowserNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\nexport const getNodeKeyForChange = (change: Change) =>\n  changeBrowserNodeKey(\"change\", change.after.path);\nexport const changeNode = (change: Change): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n});\nexport const changeListNode = (\n  changeList: ChangeListObj,\n  groupFn: GroupFn<any> = (i) => i\n): ChangeListNode => ({\n  type: \"changelist\",\n  key: changeBrowserNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: groupFn(changeList.changes.map((change) => changeNode(change))),\n});\nexport const directoryNode = (\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly AnyNode[] = []\n): DirectoryNode => ({\n  type: \"directory\",\n  key: changeBrowserNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = (\n  repository: VcsDirectoryMapping,\n  children: AnyNode[] = []\n): RepositoryNode => ({\n  type: \"repo\",\n  key: changeBrowserNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = (\n  node: ChangeBrowserNode<any>\n): node is GroupNode<any> => \"children\" in node;\nexport const isChangeNode = (\n  node: ChangeBrowserNode<any>\n): node is ChangeNode => node.type === \"change\";\nexport const isDirectoryNode = (node: AnyNode): node is DirectoryNode =>\n  node.type === \"directory\";\nexport const getChildren = (node: AnyNode) =>\n  isGroupNode(node) ? node.children : null;\n","import { GetRecoilValue, selector } from \"recoil\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { ChangeGrouping } from \"./ChangesView.state\";\nimport { groupByDirectory } from \"../../../tree-utils/groupByDirectory\";\nimport {\n  ChangeNode,\n  directoryNode,\n  DirectoryNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./change-view-nodes\";\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: selector({\n    key: \"repositoryGrouping/isAvailable\",\n    get: ({ get }) => get(vcsRootsState).length > 0,\n  }),\n  groupFn: selector({\n    key: \"repositoryGrouping/groupFn\",\n    get:\n      ({ get }: { get: GetRecoilValue }) =>\n      (nodes: ReadonlyArray<ChangeNode>) => {\n        const repos = get(vcsRootsState);\n        return repos.map(\n          (repository): RepositoryNode =>\n            repositoryNode(\n              repository,\n              nodes.filter((node) =>\n                (\n                  node.change.after?.path || node.change.before?.path\n                )?.startsWith(repository.dir)\n              )\n            )\n        );\n      },\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: true,\n  groupFn: groupByDirectory<ChangeNode, DirectoryNode>({\n    shouldCollapseDirectories: true,\n    createDirectoryNode: ({ dirPath, parentNodePath, children }) =>\n      directoryNode(dirPath, parentNodePath, children),\n    getPath: (node) => {\n      if (node.change.after.isDir) {\n        throw new Error(\"isDir=true is not supported for changes ATM!\");\n      }\n      return node.change.after.path;\n    },\n  }),\n};\n\nexport const groupings = [repositoryGrouping, directoryGrouping];\n","import { atom, selector } from \"recoil\";\nimport { Change } from \"../change-lists.state\";\nimport { changesTreeNodesState } from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  AnyNode,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesView/change-view-nodes\";\n\nconst isOpen = atom<boolean>({\n  key: \"rollbackView.isOpen\",\n  default: false,\n});\nconst windowBounds = atom<Partial<Bounds>>({\n  key: \"rollbackView.windowBounds\",\n  default: { height: 500 },\n});\nconst initiallyIncludedChanges = atom<ReadonlyArray<Change>>({\n  key: \"rollbackView.initiallySelectedChanges\",\n  default: [],\n});\nconst rootNodes = selector({\n  key: \"rollbackView.includedRootNodes\",\n  get: ({ get }) => {\n    const selectedChanges = get(initiallyIncludedChanges);\n    const { rootNodes } = get(changesTreeNodesState);\n    return rootNodes.filter(\n      ({ changeList: { changes, active } }) =>\n        (selectedChanges.length === 0 && active) ||\n        selectedChanges.some((change) => changes.includes(change))\n    );\n  },\n});\nconst initiallyExpandedKeys = selector({\n  key: \"rollbackView.initiallyExpandedKeys\",\n  get: ({ get }) => {\n    const includedChanges = get(initiallyIncludedChanges);\n    const nodes = get(rootNodes);\n    const expandedKeys = getExpandedToNodesKeys<AnyNode>(\n      (node) => (isGroupNode(node) ? node.children : null),\n      (node) => node.key,\n      nodes,\n      includedChanges.map(getNodeKeyForChange)\n    );\n    return new Set(\n      expandedKeys.length\n        ? expandedKeys\n        : getExpandAllKeys<AnyNode>(\n            (node) => (isGroupNode(node) ? node.children : null),\n            (node) => node.key,\n            nodes\n          )\n    );\n  },\n});\n\nexport const rollbackViewState = {\n  isOpen,\n  windowBounds,\n  initiallyExpandedKeys,\n  initiallyIncludedChanges,\n  rootNodes,\n};\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  isRecoilValue,\n  RecoilValue,\n  selector,\n} from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  allChangesState,\n  Change,\n  ChangeListObj,\n  changeListsState,\n} from \"../change-lists.state\";\nimport { groupings } from \"./changesGroupings\";\nimport {\n  bfsVisit,\n  dfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsState } from \"../../../Project/project.state\";\nimport {\n  AnyGroupNode,\n  AnyNode,\n  ChangeBrowserNode,\n  ChangeListNode,\n  changeListNode,\n  ChangeNode,\n  getChildren,\n  getNodeKeyForChange,\n  GroupNode,\n  isChangeNode,\n  isGroupNode,\n} from \"./change-view-nodes\";\nimport { Task } from \"../../../tasks\";\n\ntype MaybeRecoilValue<T> = T | RecoilValue<T>;\n\nexport type GroupFn<T extends AnyGroupNode> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<T extends AnyGroupNode, I = string> {\n  id: I;\n  title: string;\n  isAvailable: MaybeRecoilValue<boolean>;\n  groupFn: MaybeRecoilValue<GroupFn<T>>;\n}\nexport const showIgnoredFilesState = atom({\n  key: \"changesView/showIgnoredFiles\",\n  default: false,\n});\n\nexport const showRelatedFilesState = atom({\n  key: \"changesView/showRelatedFiles\",\n  default: false,\n});\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = typeof groupings[number][\"id\"];\n\nexport const changesGroupingState = atomFamily<boolean, GroupingIds>({\n  key: \"changesView/grouping\",\n  default: true, // it's false in IntelliJ\n});\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysState = atom<Selection>({\n  key: \"changesView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\n/**\n * Same as {@link selectedKeysState}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysState = selector<Set<Key>>({\n  key: \"changesView.resolvedSelectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectedKeysState);\n    if (selection === \"all\") {\n      const { rootNodes } = get(changesTreeNodesState);\n      return new Set(\n        bfsVisit<AnyNode, AnyNode[]>(\n          (node) => (isGroupNode(node) ? node.children : []),\n          (node, parentValue) => {\n            const nodes = parentValue ?? [];\n            nodes.push(node);\n            return nodes;\n          },\n          rootNodes\n        )\n          .flat()\n          .map((node) => node.key)\n      );\n    }\n    return selection;\n  },\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysState}\n */\nconst selectedNodesState = selector<ReadonlySet<AnyNode>>({\n  key: \"changesView.selectedNodes\",\n  get: ({ get }) => {\n    const selectedKeys = get(resolvedSelectedKeysState);\n    const { byKey } = get(changesTreeNodesState);\n    return new Set(\n      [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n    );\n  },\n});\n\nexport const changesUnderSelectedKeys = selector<ReadonlySet<Change>>({\n  key: \"changesView.selectedKeys.changes\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChanges: Set<Change> = new Set();\n    const processNode = (node: AnyNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  },\n});\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = selector<ReadonlySet<ChangeListObj>>({\n  key: \"changesView.selectedChangeLists\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChangeLists = get(changeListsState);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: AnyNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  },\n});\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysState = atom<Set<string>>({\n  key: \"changesView.includedChangeKeys\",\n  default: new Set<string>([]),\n});\n\nexport const includedChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changesView.includedChanges\",\n  get: ({ get }) => {\n    const includedChangeKeys = get(includedChangeKeysState);\n    const allChanges = get(allChangesState);\n    return allChanges.filter((change) =>\n      includedChangeKeys.has(getNodeKeyForChange(change))\n    );\n  },\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelection = selector<\n  NestedSelectionState<AnyNode>\n>({\n  key: \"changesView.selectedChanges.nestedSelectionState\",\n  get: ({ get, getCallback }) => {\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedChangeKeys = get(includedChangeKeysState);\n    const setSelectedKeys = getCallback(\n      ({ set }) =>\n        (setValue: (currentValue: Set<string>) => Set<string>) =>\n          set(includedChangeKeysState, setValue)\n    );\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface(setSelectedKeys),\n      },\n      {\n        rootNodes,\n        getChildren: (item: AnyNode) =>\n          isGroupNode(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n});\n\nexport const expandedKeysState = atom<Selection>({\n  key: \"changesView.expandedKeys\",\n  default: selector({\n    key: \"changesView.expandedKeys/temporaryDefault\",\n    get: ({ get }) => {\n      return new Set<Key>(\n        get(changesTreeNodesState)\n          .rootNodes.map((node) => [\n            node.key,\n            ...node.children.map((child) => child.key),\n          ])\n          .flat()\n      );\n    },\n  }),\n});\n\nexport const availableGroupingsState = selector({\n  key: \"changes.availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        ...grouping,\n        isActive: get(changesGroupingState(grouping.id)),\n      })),\n});\n\nconst recursiveGrouping = (\n  groupingFns: Array<GroupFn<AnyGroupNode>>,\n  nodes: ReadonlyArray<ChangeBrowserNode<any>>\n): ReadonlyArray<AnyGroupNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes as ReadonlyArray<AnyGroupNode>; // can we avoid explicit cast?\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n  const changeNodes = nodes.filter(isChangeNode);\n  const groupNodes = nodes.filter(isGroupNode);\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\nexport const changesTreeNodesState = selector<{\n  rootNodes: ChangeListNode[];\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, AnyNode>;\n}>({\n  key: \"changesView.treeNodes\",\n  get: ({ get }) => {\n    const resolve = <T>(value: MaybeRecoilValue<T>): T =>\n      isRecoilValue(value) ? get(value) : value;\n    const changeLists = get(changeListsState);\n    const groupFns = get(availableGroupingsState)\n      .filter(({ isActive }) => isActive)\n      .map(({ groupFn }) => {\n        return resolve(groupFn);\n      });\n\n    const groupChanges = (changes: readonly ChangeNode[]) =>\n      recursiveGrouping(groupFns, changes);\n\n    const rootNodes = sortBy(({ active }) => !active, changeLists).map(\n      (changeList) => changeListNode(changeList, groupChanges)\n    );\n    const fileCountsMap = new Map();\n    const byKey = new Map();\n    const getFileCount = (node: GroupNode<any>): number => {\n      return node.children.reduce(\n        (totalSum, child) =>\n          totalSum + (isGroupNode(child) ? getFileCount(child) : 1),\n        0\n      );\n    };\n    dfsVisit<AnyNode, number>(\n      getChildren,\n      (node, childrenFileCount) => {\n        byKey.set(node.key, node);\n        if (!childrenFileCount) {\n          return 1;\n        }\n        const fileCount = childrenFileCount.reduce(\n          (total, count) => total + count,\n          0\n        );\n        fileCountsMap.set(node.key, fileCount);\n        return fileCount;\n      },\n      rootNodes\n    );\n    return { rootNodes, fileCountsMap, byKey };\n  },\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily<\n  number,\n  \"horizontal\" | \"vertical\"\n>({\n  key: \"changesView/splitter/commitMessageSize\",\n  default: (orientation) => (orientation === \"horizontal\" ? 0.4 : 0.3),\n});\n/**\n * Whether --amend should be used for commit.\n */\nexport const amendCommitState = atom({\n  key: \"changesView/amendCommit\",\n  default: false,\n  // TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n  // it should add a record to the commit message history and switch the message. When toggled to false,\n  // last entry in history should be back again. There is currently no history :D\n});\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageState = atom({\n  key: \"changesView/commitMessage\",\n  default: \"\",\n});\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageState = atom({\n  key: \"changesView/commitErrorMessage\",\n  default: \"\",\n});\n\nexport const commitTaskIdState = atom<Task[\"id\"] | null>({\n  key: \"changesView/commitTaskId\",\n  default: null,\n});\n\nexport const changesFromActivePaths = selector({\n  key: \"changesView/changesFromActivePaths\",\n  get: ({ get }) => {\n    const activePaths = get(activePathsState);\n    return get(allChangesState).filter((change) =>\n      activePaths.some((activePath) => change.after.path.startsWith(activePath))\n    );\n  },\n});\n\n/**\n * Recoil callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = ({ set, snapshot }: CallbackInterface) => {\n  /**\n   * @param paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  return (paths?: string[]) => {\n    const changes = paths\n      ? snapshot\n          .getLoadable(allChangesState)\n          .getValue()\n          .filter((change) =>\n            paths.some((activePath) => change.after.path.startsWith(activePath))\n          )\n      : snapshot.getLoadable(changesFromActivePaths).getValue();\n\n    const includedChangeKeys = changes.map(getNodeKeyForChange);\n    set(includedChangeKeysState, new Set(includedChangeKeys));\n    if (includedChangeKeys.length > 0) {\n      const expandedKeys = getExpandedToNodesKeys<AnyNode>(\n        (node) => (isGroupNode(node) ? node.children : null),\n        (node) => node.key,\n        snapshot.getLoadable(changesTreeNodesState).getValue().rootNodes,\n        includedChangeKeys\n      );\n      set(expandedKeysState, (currentExpandedKeys) => {\n        return new Set([\n          ...(currentExpandedKeys !== \"all\"\n            ? currentExpandedKeys\n            : new Set<Key>()),\n          ...expandedKeys,\n        ]);\n      });\n      set(selectedKeysState, new Set([includedChangeKeys[0]]));\n    }\n  };\n};\n\nexport const openRollbackWindowForSelectionCallback = ({\n  set,\n  snapshot,\n}: CallbackInterface) => {\n  /**\n   * If contextual is true, changes related to {@link activePathsState} will be preselected.\n   */\n  return (contextual = true) => {\n    const activePaths = snapshot.getLoadable(activePathsState).getValue();\n    const changesUnderSelection = snapshot\n      .getLoadable(changesUnderSelectedKeys)\n      .getValue();\n    const changesBasedOnActivePaths =\n      contextual && activePaths.length > 0\n        ? snapshot.getLoadable(changesFromActivePaths).getValue()\n        : null;\n    set(\n      rollbackViewState.initiallyIncludedChanges,\n      changesBasedOnActivePaths ?? [...changesUnderSelection]\n    );\n    set(rollbackViewState.isOpen, true);\n  };\n};\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n\n  GIT_LOG_HIDE_BRANCHES: \"Git.Log.Hide.Branches\",\n  GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH:\n    \"Git.Log.Branches.Navigate.Log.To.Selected.Branch\",\n  GIT_UPDATE_SELECTED: \"Git.Update.Selected\",\n\n  FOCUS_TEXT_FILTER: \"Vcs.Log.FocusTextFilter\",\n  MATCH_CASE: \"Vcs.Log.MatchCaseAction\",\n  REG_EXP: \"Vcs.Log.EnableFilterByRegexAction\",\n};\n","import { useRecoilValue } from \"recoil\";\nimport { selectedKeysState } from \"./ChangesView.state\";\nimport { DividerItem, useAction } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Context menu\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(VcsActionIds.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.2rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useRecoilValue(vcsRootsState).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = ({ rootPath }: { rootPath: string }) => (\n  <StyledRepoColorSquare\n    style={{ backgroundColor: useRepoRootColor(rootPath) }}\n  />\n);\n","import React from \"react\";\nimport { Color, styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    new Color(\n      theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )\n    )\n      .withTransparency(\n        theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08\n      )\n      .toString()};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { Checker } from \"@recoiljs/refine\";\nimport { syncEffect } from \"recoil-sync\";\nimport { DefaultValue } from \"recoil\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nexport type PersistentAtomEffectArgs<C, A> = {\n  read: (componentState: C) => Promise<A> | A;\n  update: (value: A) => (componentState: C) => C;\n  refine: Checker<A>;\n  componentName: string;\n  storageFile?: string;\n};\n\nexport function persistentAtomEffect<A, C>({\n  componentName,\n  refine,\n  read,\n  update,\n  storageFile = StorageFiles.WORKSPACE_FILE,\n}: PersistentAtomEffectArgs<C, A>) {\n  const itemKey = [storageFile, componentName].join(\"|\");\n  return syncEffect<A>({\n    storeKey: \"ProjectWorkspace\",\n    itemKey,\n    syncDefault: false,\n    read: async ({ read: readComponentState }) => {\n      return read((await readComponentState(itemKey)) as C);\n    },\n    write: ({ write, read }, value) => {\n      if (!(value instanceof DefaultValue)) {\n        write(itemKey, update(value));\n      }\n    },\n    refine,\n  });\n}\n","import { equals, groupBy } from \"ramda\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilValue,\n} from \"recoil\";\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\n\nimport { fs } from \"../../fs/fs\";\nimport { vcsRootForFile, vcsRootsState } from \"../file-status.state\";\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsState } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { persistentAtomEffect } from \"../../Project/persistence/persistentAtomEffect\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\nexport type BranchType = \"LOCAL\" | \"REMOTE\";\n\nexport type BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesState = selectorFamily<LocalBranch[], string>({\n  key: \"vcs/repoLocalBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({}) => {\n      const branches = await git.listBranches({ fs, dir: repoRoot });\n      return Promise.all(\n        branches.map(async (branch) => ({\n          name: branch,\n          trackingBranch: await getTrackingBranch({\n            fs,\n            dir: repoRoot,\n            localBranchName: branch,\n          }),\n        }))\n      );\n    },\n});\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesState = selectorFamily({\n  key: \"vcs/repoRemoteBranches\",\n  get: (repoRoot: string) => async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  },\n});\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesState = selectorFamily<RepoBranches, string>({\n  key: \"vcs/repoBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({ get }) => {\n      const currentBranchName = get(repoCurrentBranchNameState(repoRoot));\n      const localBranches = get(repoLocalBranchesState(repoRoot));\n      return {\n        repoRoot,\n        currentBranch:\n          localBranches.find((branch) => branch.name === currentBranchName) ||\n          null,\n        localBranches: localBranches,\n        remoteBranches: get(repoRemoteBranchesState(repoRoot)),\n      };\n    },\n});\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameState = selectorFamily({\n  key: \"vcs/repoCurrentBranch\",\n  get: (repoRoot: string) => () => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  },\n});\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesState = selector<RepoBranches[]>({\n  key: \"vcs/allBranches\",\n  get: ({ get }) => {\n    const repoRoots = get(vcsRootsState);\n    return repoRoots.map(({ dir: repoRoot }) =>\n      get(repoBranchesState(repoRoot))\n    );\n  },\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathState = selectorFamily<string | null, string>({\n  key: \"gitBranchForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      const root = get(vcsRootForFile(filepath));\n      return root\n        ? get(repoBranchesState(root)).currentBranch?.name || null\n        : null;\n    },\n});\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\ntype MaybeArray<T> = Array<T> | T;\nconst maybeArray = <T>(input: MaybeArray<T> | undefined): Array<T> =>\n  Array.isArray(input) ? input : input ? [input] : [];\ninterface BranchStorage {\n  map: MaybeArray<{\n    entry: {\n      \"@type\": \"LOCAL\" | \"REMOTE\";\n      value: {\n        list: MaybeArray<{\n          \"branch-info\": {\n            \"@repo\": string;\n            \"@source\": string;\n          };\n        }>;\n      };\n    };\n  }>;\n}\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\ninterface GitSettingsStorage {\n  \"favorite-branches\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n  \"exclude-from-favorite\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n}\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    maybeArray(branchStorage?.map).flatMap<BranchInfo>((entry) =>\n      maybeArray(entry?.entry.value.list).map(\n        ({ \"branch-info\": { \"@source\": branchName, \"@repo\": repoRoot } }) => ({\n          branchType: entry?.entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction toBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      entry: {\n        \"@type\": branchType as BranchType,\n        value: {\n          list: branches.map((branch) => ({\n            \"branch-info\": {\n              \"@repo\": branch.repoRoot,\n              \"@source\": branch.branchName,\n            },\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: entries,\n  };\n}\n\nconst branchInfoArrayChecker = array(\n  object({\n    branchType: union(literal(\"LOCAL\"), literal(\"REMOTE\")),\n    branchName: string(),\n    repoRoot: string(),\n  })\n);\n\nconst favoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"favorite-branches\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nexport const isFavoriteBranchState = selectorFamily({\n  key: \"vcs/branches/isFavorite\",\n  get:\n    (branchInfo: BranchInfo) =>\n    ({ get }) => {\n      return isFavorite(\n        get(favoriteBranchesState),\n        get(excludedFromFavoriteBranchesState),\n        branchInfo\n      );\n    },\n});\n\nconst excludedFromFavoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite-excluded\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"exclude-from-favorite\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      (\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          snapshot.getLoadable(favoriteBranchesState).getValue(),\n          snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesState, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesState, add);\n          }\n        } else {\n          set(favoriteBranchesState, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesState, add);\n          }\n        }\n      },\n    []\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useRecoilValue(favoriteBranchesState);\n  const excludedFromFavoriteBranches = useRecoilValue(\n    excludedFromFavoriteBranchesState\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string, checkout: boolean = true) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            refresh(repoBranchesState(repoRoot));\n          }\n        );\n      },\n    []\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useRecoilCallback(\n    ({ refresh, snapshot }) =>\n      async (repoRoot: string, branchName: string, newBranchName: string) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            snapshot.getLoadable(favoriteBranchesState).getValue(),\n            snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n    []\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (repoRoot: string, branchName: string, remote?: string) => {\n        const { refresh, snapshot, set } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        refresh(dirContentState(repoRoot));\n        const openedFiles = snapshot.getLoadable(editorTabsState).getValue();\n        const existingOpenedFile = await asyncFilter(\n          ({ filePath }) => reloadFileFromDisk(filePath),\n          openedFiles\n        );\n        set(editorTabsState, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n    []\n  );\n}\n\nexport function useDeleteBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string) => {\n        return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n          refresh(repoBranchesState(repoRoot));\n        });\n      },\n    []\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathState } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useRecoilValue(branchForPathState(repo.dir));\n  return <>{branch}</>;\n};\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport { changesGroupingState } from \"./ChangesView.state\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport path from \"path\";\nimport {\n  HighlightedTextValue,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { RepoColorIcon } from \"./StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"./StyledCurrentBranchTag\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  AnyNode,\n  ChangeBrowserNode,\n  ChangeListNode,\n  ChangeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./change-view-nodes\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\ntype NodeRenderer<T extends ChangeBrowserNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\nconst repoNodeItemProps: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{fileCountMsg.format({ fileCount })}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeItemProps: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{fileCountMsg.format({ fileCount })}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst changeListNodeItemProps: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {fileCountMsg.format({ fileCount })}{\" \"}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  const isGroupedByDirectory = useRecoilValue(\n    changesGroupingState(\"directory\")\n  );\n  return (\n    <ItemLayout.Hint>\n      {!isGroupedByDirectory && path.dirname(node.change.after.path)}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeItemProps: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(node.change.after.path),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(node.change.after.path)} />\n      <HighlightedTextValue />\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\nconst nodeRenderers: {\n  [type in AnyNode[\"type\"]]: NodeRenderer<AnyNode & { type: type }>;\n} = {\n  repo: repoNodeItemProps,\n  directory: directoryNodeItemProps,\n  changelist: changeListNodeItemProps,\n  change: changeNodeItemProps,\n};\n\nexport const getChangeListTreeItemProps = ({\n  node,\n  fileCountsMap,\n}: {\n  node: AnyNode;\n  fileCountsMap: Map<Key, number>;\n}): ItemProps<AnyNode> & { key: Key } => {\n  // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n  // to node types\n  const nodeRenderer: NodeRenderer<any> /* FIXME: why is any needed? */ =\n    nodeRenderers[node.type];\n  const { textValue, rendered } = nodeRenderer(node, {\n    fileCount: fileCountsMap.get(node.key) || 0,\n    dirCount: 0, // It seems it's only used for ignored files subtree\n  });\n  return {\n    key: node.key,\n    childItems: isGroupNode(node) ? node.children : [],\n    hasChildItems: isGroupNode(node) && node.children?.length > 0,\n    textValue,\n    children: rendered,\n  };\n};\n","import React, { Key, RefObject } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesState,\n  expandedKeysState,\n  includedChangesNestedSelection,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { getChangeListTreeItemProps } from \"./changesTreeNodeRenderers\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { AnyNode, isGroupNode } from \"./change-view-nodes\";\n\nfunction findPathsUnderNode(node: AnyNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [node.change.after.path];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } = useRecoilValue(\n    changesTreeNodesState\n  );\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const nestedSelection = useRecoilValue(includedChangesNestedSelection);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useRecoilCallback(\n    ({ snapshot }) =>\n      (key: Key) => {\n        const change = snapshot\n          .getLoadable(changesTreeNodesState)\n          .getValue()\n          .byKey.get(key);\n        if (change?.type === \"change\") {\n          openPath(change.change.after.path);\n        }\n        return change;\n      },\n    []\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        treeRef={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = getChangeListTreeItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  IconButtonWithMenu,\n  PlatformIcon,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu menuProps={menuProps} actions={actions} />\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionTooltip,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\ninterface Grouping<K extends string> {\n  id: K;\n  title: string;\n  isActive: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function GroupByActionButton<K extends string>({\n  groupings,\n  onToggle,\n}: {\n  groupings: Array<Grouping<K>>;\n  onToggle: (id: K) => void;\n}) {\n  //  TODO: Generalize and make action\n  if (groupings.length === 1 && groupings[0].icon) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={`Group By ${groupings[0].title}`} />\n        }\n      >\n        <IconButton\n          isPressed={groupings[0].isActive}\n          onPress={() => onToggle(groupings[0].id)}\n        >\n          {groupings[0].icon}\n        </IconButton>\n      </TooltipTrigger>\n    );\n  }\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            <Menu\n              {...menuProps}\n              selectedKeys={groupings\n                .filter(({ isActive }) => isActive)\n                .map(({ id }) => id)}\n              onAction={(key) => {\n                const id = groupings.find(({ id }) => id === key)?.id;\n                if (id) {\n                  onToggle(id);\n                }\n              }}\n            >\n              <Section title=\"Group By\">\n                {groupings.map(({ id, title }) => (\n                  <Item key={id}>{title}</Item>\n                ))}\n              </Section>\n            </Menu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../../GroupByActionButton\";\nimport {\n  availableGroupingsState,\n  changesGroupingState,\n  GroupingIds,\n} from \"../ChangesView.state\";\n\nexport const ChangesGroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: GroupingIds) => {\n        set(changesGroupingState(id), (value) => !value);\n      },\n    []\n  );\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n};\n","import React from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport {\n  showIgnoredFilesState,\n  showRelatedFilesState,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useRecoilState(\n    showRelatedFilesState\n  );\n  const [showIgnoredFiles, setShowIgnoredFiles] = useRecoilState(\n    showIgnoredFilesState\n  );\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { ChangesGroupByActionButton } from \"./ActionButtons/ChangesGroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\nimport React from \"react\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar border=\"bottom\">\n      <ActionButton actionId={VcsActionIds.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <ChangesGroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { atom, selector, useRecoilCallback, useSetRecoilState } from \"recoil\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksState = atom<Task[]>({\n  key: \"tasks.list\",\n  default: [],\n});\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskState = selector<Task | null>({\n  key: \"tasks.first\",\n  get: ({ get }) => get(tasksState)[0],\n});\n\n/**\n * Optimized recoil value to get the number of tasks, if the tasks are not needed.\n */\nexport const taskCountState = selector<number>({\n  key: \"tasks.count\",\n  get: ({ get }) => get(tasksState).length,\n});\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetRecoilState(tasksState);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useRecoilCallback(({ snapshot }) => (id: Task[\"id\"]) => {\n    const task = snapshot\n      .getLoadable(tasksState)\n      .getValue()\n      .find((task) => task.id === id);\n    if (task) {\n      task.abortController.abort();\n    }\n  });\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useRecoilCallback } from \"recoil\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useUpdateVcsFileStatuses,\n  vcsRootForFile,\n} from \"../../file-status.state\";\nimport { Change, useRefreshChanges } from \"../change-lists.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdState } from \"./ChangesView.state\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshChanges = useRefreshChanges();\n  const refreshFileStatus = useUpdateVcsFileStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useRecoilCallback(\n    ({ snapshot, set }) =>\n      (changes: readonly Change[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = change.after.path;\n                      const repoRoot = snapshot\n                        .getLoadable(vcsRootForFile(filePath))\n                        .getValue();\n                      const content = await fs.promises.readFile(filePath);\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      files: updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                  }\n                )\n              ).then(\n                () => {\n                  // TODO: file status state and changes state separately use statusMatrix. It can be refactored for\n                  //  changes to be based on file status state.\n                  refreshChanges().catch(console.error);\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdState, null);\n            },\n          }\n        );\n        set(commitTaskIdState, taskId);\n      },\n    [refreshChanges]\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n * TODO: support removing files by null as content\n */\nexport async function commitFiles({\n  files,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  files: { [filePath: string]: Uint8Array };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(files).map(async ([filePath, blob]) => {\n      const entry = entries.find(({ path }) => path === filePath);\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n    })\n  );\n\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(files).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitState,\n  commitErrorMessageState,\n  commitMessageState,\n  commitTaskIdState,\n  includedChangesState,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useRecoilState(commitMessageState);\n  const commit = useCommitChanges();\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useRecoilState(\n    commitErrorMessageState\n  );\n  const commitTaskId = useRecoilValue(commitTaskIdState);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useRecoilCallback(({ snapshot }) => {\n    const includedChanges = snapshot\n      .getLoadable(includedChangesState)\n      .getValue();\n    const commitMessage = snapshot.getLoadable(commitMessageState).getValue();\n    return () => {\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (snapshot.getLoadable(amendCommitState).getValue()) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    };\n  }, []);\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n        >\n          Commit\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented}>\n          Commit and Push...\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { Change } from \"./change-lists.state\";\nimport { StatusColor } from \"../FileStatusColor\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<Change>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => change.after.path && change.before.path\n  ).length;\n  const addedCount = changes.filter(\n    (change) => change.after.path && !change.before.path\n  ).length;\n  const deletedCount = changes.filter(\n    (change) => change.before.path && !change.after.path\n  ).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitState, includedChangesState } from \"./ChangesView.state\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useRecoilValue(includedChangesState);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useRecoilState(amendCommitState);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={setAmend}\n              preventFocus\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { useRecoilState } from \"recoil\";\n\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport React, { useRef } from \"react\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const [commitMessageSize, setCommitMessageSize] = useRecoilState(\n    commitMessageSizeState(orientation)\n  );\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={treeActions}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React, { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { useRefreshChanges } from \"../change-lists.state\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const refresh = useRefreshChanges();\n  useEffect(() => {\n    refresh();\n  }, []);\n  return (\n    <StyledContainer>\n      <ChangesViewSplitter />\n    </StyledContainer>\n  );\n};\n","import path from \"path\";\nimport React from \"react\";\n\nimport { LocalBranch } from \"./Branches/branches.state\";\n\nexport function TrackingBranchInfo({\n  branches,\n}: {\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n}) {\n  return (\n    <table style={{ borderSpacing: 0 }}>\n      {branches.map(({ branch, repoRoot }) => {\n        const mapping = branch.trackingBranch\n          ? `${branch.name}  ${branch.trackingBranch}`\n          : branches.length > 1\n          ? `${branch.name} (no tracking branch)`\n          : \"No tracking branch\";\n\n        return branches.length > 1 ? (\n          <tr key={repoRoot}>\n            <td>{path.basename(repoRoot)}: &nbsp;</td>\n            <td>{mapping}</td>\n          </tr>\n        ) : (\n          <tr key={repoRoot}>\n            <td>{mapping}</td>\n          </tr>\n        );\n      })}\n    </table>\n  );\n}\n","import React from \"react\";\nimport { selector, useRecoilValue } from \"recoil\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { allChangesState } from \"./Changes/change-lists.state\";\nimport { vcsRootForFile } from \"./file-status.state\";\nimport { LocalBranch, repoBranchesState } from \"./Branches/branches.state\";\nimport { changesGroupingState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { TrackingBranchInfo } from \"./TrackingBranchInfo\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesState = selector({\n  key: \"vcs/commitToolWindow/changedRepos\",\n  get: ({ get }): Array<{ repoRoot: string; branch: LocalBranch }> => {\n    const changesRepoRoots = get(allChangesState)\n      .map((change) => get(vcsRootForFile(change.after.path)))\n      .filter(notNull);\n\n    return changesRepoRoots\n      .map((repoRoot) => {\n        const branch = get(repoBranchesState(repoRoot)).currentBranch;\n        return branch\n          ? {\n              repoRoot,\n              branch,\n            }\n          : null;\n      })\n      .filter(notNull);\n  },\n});\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useRecoilValue(\n    changesGroupingState(\"repository\")\n  );\n  const changesBranches = useRecoilValue(changesBranchesState);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={changesBranches} />}\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledHeader = styled.div`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  height: 2.0625rem;\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nexport const StyledSpacer = styled.div`\n  flex-grow: 1;\n`;\nexport const StyledPlaceholderContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  justify-content: end;\n  align-items: center;\n  gap: 0.25rem;\n  min-height: 37%;\n`;\n","import React from \"react\";\n\nimport { StyledPlaceholderContainer } from \"../styled-components\";\n\nexport function CommitChangedFiles() {\n  return (\n    <StyledPlaceholderContainer>\n      Select commits to to view changes\n    </StyledPlaceholderContainer>\n  );\n}\nexport function CommitDetails() {\n  return (\n    <StyledPlaceholderContainer>No commits selected</StyledPlaceholderContainer>\n  );\n}\n","import React from \"react\";\nimport { atom, useRecoilState } from \"recoil\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  CommonActionId,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  ThreeViewSplitter,\n  Toolbar,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { StyledHeader, StyledSpacer } from \"./styled-components\";\nimport { CommitChangedFiles, CommitDetails } from \"./CommitsView/CommitsTable\";\n\nconst splitViewSizeState = atom({\n  key: \"vcs/toolwindow/splitViewSize\",\n  default: 0.5,\n});\nexport function VcsLogDetailsView() {\n  const [splitViewSize, setSplitViewSize] = useRecoilState(splitViewSizeState);\n  return (\n    <>\n      <StyledHeader>\n        <Toolbar>\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Show Diff\" shortcut=\"D\" />}\n          >\n            <IconButton isDisabled>\n              <PlatformIcon icon={\"actions/diff.svg\"} />\n            </IconButton>\n          </TooltipTrigger>\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Revert Selected Changes\" />}\n          >\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"actions/rollback.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <IconButtonWithMenu\n            renderMenu={({ menuProps }) => {\n              return (\n                <Menu {...menuProps}>\n                  <Section title=\"Show\">\n                    <Item>Compact References View</Item>\n                  </Section>\n                </Menu>\n              );\n            }}\n          >\n            <PlatformIcon icon=\"actions/groupBy.svg\" />\n          </IconButtonWithMenu>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </Toolbar>\n      </StyledHeader>\n      <ThreeViewSplitter\n        orientation=\"vertical\"\n        firstSize={splitViewSize}\n        onFirstResize={setSplitViewSize}\n        firstView={<CommitChangedFiles />}\n        innerView={<CommitDetails />}\n      />\n    </>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  BareButton,\n  MenuTrigger,\n  MenuTriggerProps,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledDropdownButton = styled.button`\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding-left: 0.25rem;\n  cursor: pointer;\n  background: ${({ theme }) => theme.color(\"ComboBoxButton.background\")};\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n\n  line-height: 1.5;\n  border-radius: 0.25rem;\n  white-space: nowrap;\n  border: 2px solid transparent;\n  &:hover {\n    color: ${({ theme }) => theme.color(\"*.foreground\")};\n  }\n  &:focus-visible {\n    border-color: ${({ theme }) =>\n      theme.commonColors.focusRing({ focused: true })};\n  }\n`;\n\nconst StyledDropdownIcon = styled.span`\n  margin-left: -1px;\n  line-height: 1.2;\n`;\n\nconst StyledValue = styled.span`\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  max-width: 8.25rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst FocusableAutoHoverPlatformIcon = styled(AutoHoverPlatformIcon)`\n  &:focus-visible {\n    outline: 2px solid\n      ${({ theme }) => theme.commonColors.focusRing({ focused: true })};\n    outline-offset: -2px;\n  }\n`;\nexport function VcsFilterDropdown({\n  label,\n  value,\n  onClear,\n  ...menuTriggerProps\n}: Omit<MenuTriggerProps, \"children\"> & {\n  label: React.ReactNode;\n  value?: React.ReactNode;\n  onClear?: () => void;\n}) {\n  return (\n    <MenuTrigger {...menuTriggerProps}>\n      {(props, ref) => (\n        <StyledDropdownButton {...props} ref={ref}>\n          {label}\n          {value ? (\n            <>\n              : <StyledValue>{value}</StyledValue>\n              <BareButton onPress={onClear}>\n                <FocusableAutoHoverPlatformIcon\n                  icon=\"actions/close\"\n                  hoverIcon=\"actions/closeHovered\"\n                />\n              </BareButton>\n            </>\n          ) : (\n            <StyledDropdownIcon>\n              <PlatformIcon icon=\"general/arrowDownSmall.svg\" />\n            </StyledDropdownIcon>\n          )}\n        </StyledDropdownButton>\n      )}\n    </MenuTrigger>\n  );\n}\n","export type DateRange = { from?: Date; to?: Date };\nexport const dateToString = (date: Date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date\n    .getFullYear()\n    .toString()\n    .slice(-2)}`;\n};\nexport const dateRangeToString = (dateRange: DateRange): string => {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n};\n","import { mapObjIndexed } from \"ramda\";\nimport {\n  atom,\n  atomFamily,\n  RecoilState,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\n\nimport { DateRange, dateRangeToString } from \"./DateRange\";\n\nexport const vcsTabKeysState = atom<string[]>({\n  key: \"vcs/log/tabs/keys\",\n  default: [\"MAIN\"],\n});\n\nexport const vcsActiveTabKeyState = atom<string>({\n  key: \"vcs/log/tabs/activeKey\",\n  default: \"MAIN\",\n});\n\n/**\n * The title of a VCS log tab\n */\nexport const vcsTabTitleState = selectorFamily({\n  key: \"vcs/logs/tab/title\",\n  get:\n    (key: string) =>\n    ({ get }) => {\n      const searchQuery = get(vcsLogFilter.searchQuery(key));\n      const user = get(vcsLogFilter.user(key));\n      const date = get(vcsLogFilter.date(key));\n      const branches = get(vcsLogFilter.branch(key));\n      const parts: { short: string; long: string }[] = [];\n\n      if (branches?.length > 0) {\n        parts.push({\n          short: branches.join(\", \"),\n          long: `on ${branches.join(\", \")}`,\n        });\n      }\n      if (date) {\n        parts.push({\n          short: dateRangeToString(date),\n          long: `made ${dateRangeToString(date)}`,\n        });\n      }\n      if (searchQuery) {\n        parts.push({\n          short: `'${searchQuery}'`,\n          long: `containing '${searchQuery}'`,\n        });\n      }\n      if (user) {\n        parts.push({\n          short: user,\n          long: `by ${user}`,\n        });\n      }\n\n      return `Log${parts.length > 0 ? \": \" : \"\"}${\n        parts.length === 1\n          ? parts[0].short\n          : parts.map((part) => part.long).join(\" \")\n      }`;\n    },\n});\n\n/**\n * Whether branches filter is visible for a VCS log tab\n */\nexport const vcsLogTabShowBranches = atomFamily<boolean, string>({\n  key: \"vcs/logs/filter/showBranches\",\n  default: false,\n});\nexport const vcsLogFilter = {\n  /**\n   * The state of search query, for a VCS log tab\n   */\n  searchQuery: atomFamily<string, string>({\n    key: \"vcs/logs/filter/searchQuery\",\n    default: \"\",\n  }),\n  /**\n   * The state of whether \"match case\" is on the search query, for a VCS log tab\n   */\n  matchCase: atomFamily<boolean, string>({\n    key: \"vcs/logs/filter/matchCase\",\n    default: false,\n  }),\n  /**\n   * The state of whether \"regexp\" is on the search query, for a VCS log tab\n   */\n  regExp: atomFamily<boolean, string>({\n    key: \"vcs/logs/filter/regExp\",\n    default: false,\n  }),\n  /**\n   * The state of user filter, for a VCS log tab\n   */\n  user: atomFamily<string | null, string>({\n    key: \"vcs/logs/filter/user\",\n    default: null,\n  }),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  date: atomFamily<DateRange | null, string>({\n    key: \"vcs/logs/filter/date\",\n    default: null,\n  }),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  branch: atomFamily<string[], string>({\n    key: \"vcs/logs/filter/branch\",\n    default: [],\n  }),\n};\n\ntype FamilyToAtom<F> = F extends (param: any) => RecoilState<infer S>\n  ? RecoilState<S>\n  : never;\n\ntype VcsLogFilter = typeof vcsLogFilter;\n\nexport const vcsLogFilterCurrentTab = mapObjIndexed((atomFamily, key) => {\n  return selector({\n    key: `vcs/logs/currentTabFilter/${key}`,\n    get: ({ get }) =>\n      get(atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>),\n    set: ({ set, get }, newValue) => {\n      set(\n        atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>,\n        newValue\n      );\n    },\n  });\n}, vcsLogFilter) as {\n  [key in keyof VcsLogFilter]: FamilyToAtom<VcsLogFilter[key]>;\n};\n\nexport const useResetFilters = () =>\n  useRecoilCallback(\n    ({ reset }) =>\n      (tabKey: string) => {\n        Object.values(vcsLogFilter)\n          .map((state) => state(tabKey))\n          .forEach(reset);\n      },\n    []\n  );\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport React, { HTMLAttributes, useEffect, useState } from \"react\";\nimport {\n  selector,\n  useRecoilState,\n  useRecoilValue,\n  useResetRecoilState,\n} from \"recoil\";\nimport {\n  Divider,\n  Item,\n  MenuItemLayout,\n  SpeedSearchMenu,\n} from \"@intellij-platform/core\";\n\nimport {\n  allBranchesState,\n  BranchType,\n  useFavoriteBranches,\n} from \"../../Branches/branches.state\";\nimport { BranchFavoriteButton } from \"../../Branches/BranchFavoriteButton\";\nimport { vcsLogFilter } from \"../vcs-logs.state\";\nimport { VcsFilterDropdown } from \"../VcsLogDropdown\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport function BranchesFilterDropdown({ tabKey }: { tabKey: string }) {\n  const [selectedBranches, setSelectedBranches] = useRecoilState(\n    vcsLogFilter.branch(tabKey)\n  );\n  const resetBranches = useResetRecoilState(vcsLogFilter.branch(tabKey));\n\n  return (\n    <VcsFilterDropdown\n      value={selectedBranches.length > 0 ? selectedBranches.join(\"|\") : null}\n      onClear={resetBranches}\n      renderMenu={({ menuProps }) => (\n        <BranchesFilterMenu\n          menuProps={menuProps}\n          onBranchesSelected={setSelectedBranches}\n        />\n      )}\n      label=\"Branch\"\n    />\n  );\n}\n\nconst groupRepoRoots = (\n  branches: Array<{ branchName: string; repoRoot: string }>\n) =>\n  Object.entries(groupBy(({ branchName }) => branchName, branches)).map(\n    ([branchName, items]) => ({\n      branchName,\n      repoRoots: items.map((item) => item.repoRoot),\n    })\n  );\n/**\n * Unique list of all local and remote branches of all repositories.\n * Each branch has a list of repos which indicates the list of repository roots the branch appears in.\n */\nconst repoGroupedAllBranches = selector({\n  key: \"vcs/allBranchesRepoConsolidated\",\n  get: ({ get }) => {\n    const allBranches = get(allBranchesState);\n    const allRemoteBranches = allBranches.flatMap(\n      ({ remoteBranches, repoRoot }) =>\n        remoteBranches.map((branch) => ({\n          repoRoot,\n          branchName: `${branch.remote}/${branch.name}`,\n        }))\n    );\n    const allLocalBranches = allBranches.flatMap(\n      ({ localBranches, repoRoot }) =>\n        localBranches.map((branch) => ({\n          repoRoot,\n          branchName: branch.name,\n        }))\n    );\n    return {\n      localBranches: groupRepoRoots(allLocalBranches),\n      remoteBranches: groupRepoRoots(allRemoteBranches),\n    };\n  },\n});\n\ntype BranchMenuItem = {\n  branchType: BranchType;\n  branchName: string;\n  repoRoots: string[];\n};\n\nfunction BranchesFilterMenu({\n  menuProps,\n  onBranchesSelected,\n}: {\n  onBranchesSelected: (branches: string[]) => void;\n  menuProps: HTMLAttributes<HTMLElement>;\n}) {\n  const [favoriteBranches, setFavoriteBranches] = useState<BranchMenuItem[]>(\n    []\n  );\n  const { toggleFavorite, isFavorite } = useFavoriteBranches();\n  const { localBranches, remoteBranches } = useRecoilValue(\n    repoGroupedAllBranches\n  );\n\n  const remoteBranchesByRemote = groupBy(\n    ({ branchName }) => branchName.split(\"/\")[0],\n    remoteBranches\n  );\n\n  // The list of favorite branches is calculated on render, and is intentionally not updated. This behavior is copied\n  // from the reference implementation. Probably in order to not have items jump in and out of the menu, when branches\n  // are marked/unmarked as favorite. One improvement (?) here is that isFavorite state is always correct, as opposed\n  // to the reference implementation where (at least currently) the state of favorite icon is not kept up-to-date.\n  useEffect(() => {\n    const createLocalBranchItems = (\n      branchType: BranchType,\n      branches: Array<{ branchName: string; repoRoots: string[] }>\n    ): BranchMenuItem[] => {\n      return branches\n        .filter(({ branchName, repoRoots }) =>\n          repoRoots.some((repoRoot) =>\n            isFavorite({ branchType, branchName, repoRoot })\n          )\n        )\n        .map(({ branchName, repoRoots }) => ({\n          branchType,\n          branchName,\n          repoRoots,\n        }));\n    };\n\n    setFavoriteBranches(\n      [\n        {\n          branchType: \"LOCAL\",\n          branchName: \"HEAD\",\n          repoRoots: [],\n        } as BranchMenuItem,\n      ]\n        .concat(createLocalBranchItems(\"LOCAL\", localBranches))\n        .concat(createLocalBranchItems(\"REMOTE\", remoteBranches))\n    );\n  }, []);\n\n  const renderBranchItem = ({\n    branchName,\n    branchType,\n    repoRoots,\n  }: BranchMenuItem) => (\n    <Item key={`branch:${branchName}`} textValue={branchName}>\n      <MenuItemLayout\n        content={branchName}\n        icon={\n          <BranchFavoriteButton\n            isFavorite={\n              branchName === \"HEAD\" ||\n              repoRoots.some((repoRoot) =>\n                isFavorite({\n                  branchType,\n                  repoRoot,\n                  branchName,\n                })\n              )\n            }\n            onClick={() => {\n              if (branchName !== \"HEAD\") {\n                repoRoots.forEach((repoRoot) => {\n                  toggleFavorite({\n                    branchType,\n                    repoRoot,\n                    branchName,\n                  });\n                });\n              }\n            }}\n          />\n        }\n      />\n    </Item>\n  );\n  return (\n    <SpeedSearchMenu\n      {...menuProps}\n      submenuBehavior=\"toggleOnPress\"\n      autoFocus=\"first\"\n      minWidth={250}\n      onAction={(key) => {\n        const [type, value] = `${key}`.split(\":\");\n        if (type === \"branch\" && value) {\n          onBranchesSelected([value]);\n        } else if (type === \"favorites\") {\n          onBranchesSelected(\n            favoriteBranches.map(({ branchName }) => branchName)\n            // we could have filtered the ones that are actually favorite at this point, but not doing so to follow\n            // the original implementation, even though it's a little questionable.\n          );\n        } else if (type === \"select\") {\n          notImplemented(); // TODO\n        }\n      }}\n    >\n      {[\n        <Item key=\"select\">Select...</Item>,\n        <Item key=\"favorites\">Favorites</Item>,\n        ...favoriteBranches.map(renderBranchItem),\n        <Divider />,\n        <Item key=\"local\" title=\"Local\">\n          {localBranches.map(({ branchName, repoRoots }) =>\n            renderBranchItem({ branchType: \"LOCAL\", branchName, repoRoots })\n          )}\n        </Item>,\n        ...Object.entries(remoteBranchesByRemote).map(([origin, branches]) => (\n          <Item key={`remote:${origin}`} title={`${origin}/...`}>\n            {branches.map(({ branchName, repoRoots }) =>\n              renderBranchItem({ branchType: \"REMOTE\", branchName, repoRoots })\n            )}\n          </Item>\n        )),\n      ]}\n    </SpeedSearchMenu>\n  );\n}\n","import { v4 as uuid } from \"uuid\";\nimport React, { useEffect, useState } from \"react\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Link,\n  Menu,\n  PlatformIcon,\n  SearchInput,\n  Section,\n  styled,\n  StyledHoverContainer,\n  Toolbar,\n  ToolbarSeparator,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledHeader,\n  StyledPlaceholderContainer,\n  StyledSpacer,\n} from \"../styled-components\";\nimport { VcsFilterDropdown } from \"../VcsLogDropdown\";\nimport {\n  atom,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n  useResetRecoilState,\n} from \"recoil\";\nimport { searchInputRefState } from \"../VersionControlToolWindow\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  useResetFilters,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsTabKeysState,\n} from \"../vcs-logs.state\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { DateRange, dateToString } from \"../DateRange\";\nimport { BranchesFilterDropdown } from \"./BranchesFilterDropdown\";\n\nconst StyledSearchInput = styled(SearchInput)`\n  border-radius: 2px;\n  width: 219px;\n  margin-right: 0.0625rem;\n  margin-left: 0.2rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n`;\n\nconst searchHistoryState = atom<string[]>({\n  key: \"vcs/toolwindow/searchHistory\",\n  default: [], // TODO: add an effect to persist it under application level other.xml file under\n  // PropertyService component's \"Vcs.Log.Text.Filter.History\" property\n});\n\nexport function VcsLogCommitsView({ tabKey }: { tabKey: string }) {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const [searchQuery, setSearchQuery] = useRecoilState(\n    vcsLogFilter.searchQuery(tabKey)\n  );\n  const [user, setUser] = useRecoilState(vcsLogFilter.user(tabKey));\n  const resetUser = useResetRecoilState(vcsLogFilter.user(tabKey));\n  const [dateFilter, setDateFilter] = useRecoilState(vcsLogFilter.date(tabKey));\n  const resetDate = useResetRecoilState(vcsLogFilter.date(tabKey));\n  const [searchHistory, setSearchHistory] = useRecoilState(searchHistoryState);\n  const [searchInputValue, setSearchInputValue] = useState(searchQuery);\n  const getActionShortcut = useGetActionShortcut();\n  const isRegExpOn = useRecoilValue(vcsLogFilter.regExp(tabKey));\n  const isMatchCaseOn = useRecoilValue(vcsLogFilter.matchCase(tabKey));\n  const submitSearchQuery = (value = searchInputValue) => {\n    setSearchQuery(value);\n    if (value && !searchHistory.includes(value)) {\n      setSearchHistory((searchHistory) => [\n        value,\n        ...searchHistory.filter((item) => item !== value),\n      ]);\n    }\n  };\n\n  useEffect(() => {\n    setSearchInputValue(searchQuery);\n  }, [searchQuery]);\n\n  const createNewTab = useRecoilCallback(\n    ({ set }) =>\n      () => {\n        const newTabId = uuid();\n        set(vcsTabKeysState, (value) => [...value, newTabId]);\n        set(vcsActiveTabKeyState, newTabId);\n      },\n    []\n  );\n  const today = new Date();\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(today.getDate() - 7);\n  const yesterday = new Date();\n  yesterday.setDate(today.getDate() - 1);\n  const predefinedDateRanges = [\n    {\n      name: \"Last 24 hours\",\n      value: { from: sevenDaysAgo },\n    },\n    {\n      name: \"Last 7 days\",\n      value: { from: yesterday },\n    },\n  ];\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName=\"Text or Hash Filter\"\n              shortcut={getActionShortcut(VcsActionIds.FOCUS_TEXT_FILTER)}\n            />\n          }\n        >\n          <StyledSearchInput\n            inputRef={textFilterRef}\n            value={searchInputValue}\n            onChange={setSearchInputValue}\n            onSubmit={submitSearchQuery}\n            onBlur={() => submitSearchQuery()}\n            searchHistory={searchHistory}\n            addonAfter={\n              <>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.REG_EXP}\n                >\n                  <AutoHoverPlatformIcon\n                    icon={\n                      isRegExpOn ? \"actions/regexSelected\" : \"actions/regex\"\n                    }\n                    hoverIcon={\n                      isRegExpOn\n                        ? \"actions/regexSelected\"\n                        : \"actions/regexHovered\"\n                    }\n                  />\n                </StyledHoverContainer>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.MATCH_CASE}\n                >\n                  {isMatchCaseOn ? (\n                    <PlatformIcon icon=\"actions/matchCaseSelected\" />\n                  ) : (\n                    <AutoHoverPlatformIcon\n                      icon=\"actions/matchCase\"\n                      hoverIcon=\"actions/matchCaseHovered\"\n                    />\n                  )}\n                </StyledHoverContainer>\n              </>\n            }\n          />\n        </TooltipTrigger>\n        <Toolbar>\n          <BranchesFilterDropdown tabKey={tabKey} />\n          <VcsFilterDropdown\n            value={user}\n            onClear={resetUser}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  if (key === \"select\") {\n                    return notImplemented();\n                  }\n                  setUser(`${key}`);\n                }}\n              >\n                <Item key=\"select\">Select...</Item>\n                <Item key=\"me\">me</Item>\n              </Menu>\n            )}\n            label=\"User\"\n          />\n          <VcsFilterDropdown\n            value={dateFilter && dateRangeToString(dateFilter)}\n            onClear={resetDate}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  const predefinedDateRange = predefinedDateRanges.find(\n                    ({ name }) => name === key\n                  );\n                  if (predefinedDateRange) {\n                    setDateFilter(predefinedDateRange.value);\n                  } else {\n                    notImplemented();\n                  }\n                }}\n              >\n                {[\n                  <Item key=\"select\">Select...</Item>,\n                  ...predefinedDateRanges.map(({ name }) => (\n                    <Item key={name}>{name}</Item>\n                  )),\n                ]}\n              </Menu>\n            )}\n            label=\"Date\"\n          />\n          <VcsFilterDropdown\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Select in...</Item>\n                <Item>Select in Tree...</Item>\n              </Menu>\n            )}\n            label=\"Paths\"\n          />\n          <ToolbarSeparator />\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Open New Git Log Tab\" />}\n          >\n            <IconButton aria-label=\"Checkout\" onPress={createNewTab}>\n              <PlatformIcon icon=\"actions/openNewTab.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Refresh\" shortcut=\"R\" />}\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/refresh.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Cherry-Pick\" />}>\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/cherryPick.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n            <IconButtonWithMenu\n              renderMenu={({ menuProps }) => {\n                return (\n                  <Menu {...menuProps}>\n                    <Section title=\"Show\">\n                      <Item>Compact References View</Item>\n                    </Section>\n                  </Menu>\n                );\n              }}\n            >\n              <PlatformIcon icon=\"actions/groupBy.svg\" />\n            </IconButtonWithMenu>\n          </TooltipTrigger>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip actionName=\"Go To Hash/Branch/Tag\" shortcut=\"F\" />\n            }\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/find\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n      </StyledHeader>\n      <CommitsTable />\n    </StyledContainer>\n  );\n}\n\nfunction CommitsTable() {\n  const currentTabKey = useRecoilValue(vcsActiveTabKeyState);\n  const resetFilters = useResetFilters();\n\n  return (\n    <StyledPlaceholderContainer>\n      No commits matching filters\n      <Link onPress={() => resetFilters(currentTabKey)}>Reset filters</Link>\n    </StyledPlaceholderContainer>\n  );\n}\n\nfunction dateRangeToString(dateRange: DateRange): string {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n}\n","import { basename } from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, atomFamily, isRecoilValue, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { PlatformIcon, TreeRefValue } from \"@intellij-platform/core\";\n\nimport {\n  allBranchesState,\n  BranchType,\n  isFavoriteBranchState,\n  LocalBranch,\n  RemoteBranch,\n  RepoBranches,\n} from \"../../Branches/branches.state\";\nimport {\n  DirectoryNode,\n  groupByDirectory,\n} from \"../../../tree-utils/groupByDirectory\";\nimport { vcsRootsState } from \"../../file-status.state\";\n\ntype LocalBranchNode = {\n  type: \"localBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is current branch in at least one repo\n   */\n  isCurrent: boolean;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n};\ntype RemoteBranchNode = {\n  type: \"remoteBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n  branches: Array<{ repoRoot: string; branch: RemoteBranch }>;\n};\ntype BranchDirectoryNode = DirectoryNode & {\n  children: readonly AnyBranchTreeNode[];\n};\ntype RepositoryNode = {\n  type: \"repository\";\n  key: string;\n  repoRoot: string;\n  children: ReadonlyArray<LocalBranchNode | RemoteBranchNode | DirectoryNode>;\n};\nexport type AnyBranchTreeNode =\n  | {\n      type: \"head\";\n    }\n  | {\n      type: \"branchType\";\n      branchType: BranchType;\n      children: readonly AnyBranchTreeNode[];\n    }\n  | RepositoryNode\n  | BranchDirectoryNode\n  | LocalBranchNode\n  | RemoteBranchNode;\n\nfunction getLocalBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allLocalBranches = repoBranches.flatMap(\n    ({ repoRoot, localBranches, currentBranch }) =>\n      localBranches.map((branch) => ({\n        repoRoot,\n        isCurrent: currentBranch?.name === branch.name,\n        branch,\n      }))\n  );\n  const localBranchNodes = Object.entries(\n    groupBy(({ branch }) => branch.name, allLocalBranches)\n  ).map<LocalBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"localBranch\",\n      key: `localBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"LOCAL\",\n          branchName: branch.name,\n        })\n      ),\n      isCurrent: branches.some(({ isCurrent }) => isCurrent),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(localBranchNodes);\n  }\n  return localBranchNodes;\n}\n\nfunction getRemoteBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allRemoteBranches = repoBranches.flatMap(\n    ({ repoRoot, remoteBranches }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branch,\n      }))\n  );\n  const remoteBranchNodes = Object.entries(\n    groupBy(\n      ({ branch }) => `${branch.remote}/${branch.name}`,\n      allRemoteBranches\n    )\n  ).map<RemoteBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"remoteBranch\",\n      key: `remoteBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"REMOTE\",\n          branchName: branch.name,\n        })\n      ),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(remoteBranchNodes);\n  }\n  return remoteBranchNodes;\n}\n\nexport const branchesTreeNodeState = selector({\n  key: \"vcs/branchesTree/nodes\",\n  get: ({ get }): AnyBranchTreeNode[] => {\n    // TODO: sorting. favorite should be on top. Others should be alphabetical\n    const repoBranches = get(allBranchesState);\n    const shouldGroupByDirectory = get(branchTreeGroupingState(\"directory\"));\n    const shouldGroupByRepository =\n      get(isGroupByRepositoryAvailableState) &&\n      get(branchTreeGroupingState(\"repository\"));\n\n    return [\n      { type: \"head\" },\n      {\n        type: \"branchType\",\n        branchType: \"LOCAL\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `LOCAL:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getLocalBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getLocalBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n      {\n        type: \"branchType\",\n        branchType: \"REMOTE\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `REMOTE:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getRemoteBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getRemoteBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n    ];\n  },\n});\nconst groupNodesByDirectory = groupByDirectory<\n  LocalBranchNode | RemoteBranchNode,\n  BranchDirectoryNode\n>({\n  shouldCollapseDirectories: false,\n  getPath: (node) => node.name,\n});\nexport const branchTreeGroupingState = atomFamily<\n  boolean,\n  \"directory\" | \"repository\"\n>({\n  key: \"vcs/branchesTree/grouping\",\n  default: true,\n});\nexport const isGroupByRepositoryAvailableState = selector<boolean>({\n  key: \"vcs/branchesTree/grouping/repo/available\",\n  get: ({ get }) => get(vcsRootsState).length > 0,\n});\nexport const branchesTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"vcs/branchesTree/ref\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\nexport const selectedKeysState = atom<Selection>({\n  key: \"vcs/branchesTree/selectedKeys\",\n  default: new Set(),\n});\nexport const expandedKeysState = atom<Set<Key>>({\n  key: \"vcs/branchesTree/expandedKeys\",\n  default: new Set(),\n});\n\nconst groupings = [\n  {\n    id: \"directory\" as const,\n    title: \"Directory\",\n    icon: <PlatformIcon icon=\"actions/GroupByPackage.svg\" />,\n    isActive: branchTreeGroupingState(\"directory\"),\n    isAvailable: true,\n  },\n  {\n    id: \"repository\" as const,\n    title: \"Repository\",\n    isActive: branchTreeGroupingState(\"repository\"),\n    isAvailable: isGroupByRepositoryAvailableState,\n  },\n];\nexport const availableGroupingsState = selector({\n  key: \"vcs/branchesTree/availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        ...grouping,\n        isActive: get(branchTreeGroupingState(grouping.id)),\n      })),\n});\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../GroupByActionButton\";\nimport {\n  availableGroupingsState,\n  branchTreeGroupingState,\n} from \"./BranchesTree.state\";\n\nexport function BranchesGroupByActionButton() {\n  //  TODO: Generalize and convert to actions\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: \"directory\" | \"repository\") => {\n        set(branchTreeGroupingState(id), (value) => !value);\n      },\n    []\n  );\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n}\n","import { basename } from \"path\";\nimport React from \"react\";\nimport { ItemElement } from \"@react-types/shared/src/collections\";\nimport {\n  ActionTooltip,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { TrackingBranchInfo } from \"../../TrackingBranchInfo\";\nimport { RepoColorIcon } from \"../../Changes/ChangesView/StyledRepoColorSquare\";\nimport { AnyBranchTreeNode } from \"./BranchesTree.state\";\n\nexport const branchTreeNodeRenderers: {\n  [nodeType in AnyBranchTreeNode[\"type\"]]: (\n    node: AnyBranchTreeNode & { type: nodeType }\n  ) => ItemElement<AnyBranchTreeNode>;\n} = {\n  branchType: (node) => {\n    return (\n      <Item\n        key={`${node.type}:${node.branchType}`}\n        textValue={wordCase(node.branchType)}\n        childItems={node.children}\n      >\n        <HighlightedTextValue />\n      </Item>\n    );\n  },\n  localBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={node.branches} />}\n              ></ActionTooltip>\n            }\n          >\n            {(props) => (\n              <ItemLayout.Group {...props}>\n                {node.isCurrent ? (\n                  <TooltipTrigger\n                    tooltip={\n                      <Tooltip>\n                        Current {node.isFavorite && \"favorite \"}branch\n                      </Tooltip>\n                    }\n                  >\n                    {(props) => (\n                      <ItemLayout.Group {...props}>\n                        <PlatformIcon\n                          icon={\n                            node.isFavorite\n                              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n                              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n                          }\n                        />\n                      </ItemLayout.Group>\n                    )}\n                  </TooltipTrigger>\n                ) : (\n                  <PlatformIcon icon=\"vcs/branchNode\" />\n                )}\n                <HighlightedTextValue />\n                {node.repos && (\n                  <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n                )}\n              </ItemLayout.Group>\n            )}\n          </TooltipTrigger>\n        </ItemLayout>\n      </Item>\n    );\n  },\n  remoteBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <PlatformIcon\n            icon={node.isFavorite ? \"nodes/favorite.svg\" : \"vcs/branchNode\"}\n          />\n          <HighlightedTextValue />\n          {node.repos && (\n            <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n          )}\n        </ItemLayout>\n      </Item>\n    );\n  },\n  repository: (node) => (\n    <Item\n      key={`${node.key}`}\n      textValue={basename(node.repoRoot)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <RepoColorIcon rootPath={node.repoRoot} />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  directory: (node) => (\n    <Item\n      key={`${node.type}_${node.parentNodePath}${node.dirPath}`}\n      textValue={basename(node.dirPath)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <PlatformIcon icon=\"nodes/folder.svg\" />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  head: (node) => (\n    <Item key={`${node.type}`} textValue=\"HEAD (Current Branch)\">\n      <HighlightedTextValue />\n    </Item>\n  ),\n};\n\nfunction wordCase(input: string): string {\n  return input[0].toUpperCase() + input.slice(1).toLowerCase();\n}\n\nexport const keyToBranch = (key: string): string | null => {\n  const [type, _repo, branchName] = key.split(\":\");\n  if (type === \"head\") {\n    return \"HEAD\";\n  }\n  if (type === \"localBranch\" || type === \"remoteBranch\") {\n    return branchName ?? null;\n  }\n  return null;\n};\n","import React, { useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport {\n  PlatformIcon,\n  SpeedSearchTree,\n  styled,\n  useCollectionSearchInput,\n} from \"@intellij-platform/core\";\n\nimport {\n  branchTreeNodeRenderers,\n  keyToBranch,\n} from \"./branchTreeNodeRenderers\";\nimport {\n  branchesTreeNodeState,\n  branchesTreeRefState,\n  expandedKeysState,\n  selectedKeysState,\n} from \"./BranchesTree.state\";\nimport { StyledHeader } from \"../styled-components\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst StyledSearchInput = styled.input`\n  all: unset;\n  flex: 1;\n  align-self: stretch;\n`;\nconst StyledContainer = styled.div`\n  min-width: 0; // don't outgrow the container\n  flex-grow: 1; // fill the available space\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledSearchIconContainer = styled.span`\n  display: inline-flex;\n  margin-top: -0.0625rem;\n  margin-left: 0.7rem;\n  margin-right: 0.25rem;\n  cursor: text;\n`;\n\nexport function BranchesTree() {\n  const branchesTreeNodes = useRecoilValue(branchesTreeNodeState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const treeRef = useRecoilValue(branchesTreeRefState);\n  const ref = useRef<HTMLDivElement>(null);\n  const selectionManagerRef = useRef<TreeSelectionManager>(null);\n  const [isInputFocused, setInputFocused] = useState(false);\n  const setBranchFilter = useSetRecoilState(vcsLogFilterCurrentTab.branch);\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef: ref,\n    selectionManager: selectionManagerRef.current,\n  });\n  // FIXME: selectedKeys and expandedKeys can become invalid due to changes in nodes, which makes the tree view\n  //  not react to the key events. Ideally, the tree view should be robust regarding invalid keys, and otherwise\n  //  the keys should be validated everytime nodes change.\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <StyledSearchIconContainer>\n          <PlatformIcon icon=\"actions/search\" />\n        </StyledSearchIconContainer>\n        {/* FIXME: tabIndex -1 is a workaround to not get the input focused when the toolwindow opens. Not ideal.*/}\n        <StyledSearchInput\n          tabIndex={-1}\n          {...mergeProps(collectionSearchInputProps, {\n            onFocus: () => setInputFocused(true),\n            onBlur: () => setInputFocused(false),\n          })}\n        />\n      </StyledHeader>\n      <SpeedSearchTree\n        ref={ref}\n        treeRef={treeRef}\n        selectionManagerRef={selectionManagerRef}\n        items={branchesTreeNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onAction={(key) => {\n          const branch = keyToBranch(`${key}`);\n          if (branch) {\n            setBranchFilter([branch]);\n          }\n        }}\n        fillAvailableSpace\n        showAsFocused={isInputFocused}\n      >\n        {(node) => {\n          // @ts-expect-error we need to somehow infer the type of `node.type`\n          return branchTreeNodeRenderers[node.type](node);\n        }}\n      </SpeedSearchTree>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  PlatformIcon,\n  Toolbar,\n  ToolbarSeparator,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { BranchesGroupByActionButton } from \"./BranchesGroupByActionButton\";\nimport { BranchesTree } from \"./BranchesTree\";\nimport { branchesTreeRefState } from \"./BranchesTree.state\";\n\nconst DELETE_BRANCH_ACTION_ID = \"Git.DeleteBranch\";\nconst SHOW_BRANCH_DIFF_ACTION_ID = \"Git.Compare.With.Current\";\nconst SHOW_MY_BRANCHES_ACTION_ID = \"Git.Show.My.Branches\";\nconst FETCH_ACTION_ID = \"Git.Fetch\";\nconst TOGGLE_FAVORITE_ACTION_ID = \"Git.Toggle.Favorite\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  height: 100%;\n`;\n\nexport function VcsBranchesView() {\n  const treeRef = useRecoilValue(branchesTreeRefState);\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.GIT_UPDATE_SELECTED,\n      title: \"Update Selected\",\n      icon: <PlatformIcon icon=\"actions/checkOut\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: DELETE_BRANCH_ACTION_ID,\n      title: \"Delete branch\",\n      icon: <PlatformIcon icon=\"actions/gc\" />,\n      useShortcutsOf: \"SafeDelete\",\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_BRANCH_DIFF_ACTION_ID,\n      title: \"Compare with current\",\n      icon: <PlatformIcon icon=\"actions/diff\" />,\n      useShortcutsOf: VcsActionIds.SHOW_DIFF,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_MY_BRANCHES_ACTION_ID,\n      title: \"Show My Branches\",\n      icon: <PlatformIcon icon=\"actions/find\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: FETCH_ACTION_ID,\n      title: \"Fetch All Remotes\",\n      icon: <PlatformIcon icon=\"vcs/fetch\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: TOGGLE_FAVORITE_ACTION_ID,\n      title: \"Mark/Unmark as Favorite\",\n      icon: <PlatformIcon icon=\"nodes/favorite\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer {...shortcutHandlerProps}>\n          <VcsLogBranchesViewToolbar />\n          <BranchesTree />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst StyledToolbar = styled(Toolbar)`\n  height: 100%;\n  flex-shrink: 0;\n`;\n\nfunction VcsLogBranchesViewToolbar() {\n  return (\n    <StyledToolbar border=\"right\" orientation=\"vertical\">\n      <ActionButton actionId={VcsActionIds.GIT_LOG_HIDE_BRANCHES} />\n      <ToolbarSeparator />\n      {/*FIXME: replace this with a separate \"new branch from\" action*/}\n      <ActionButton actionId={VcsActionIds.GIT_CREATE_NEW_BRANCH} />\n      <ActionButton actionId={VcsActionIds.GIT_UPDATE_SELECTED} />\n      <ActionButton actionId={DELETE_BRANCH_ACTION_ID} />\n      <ActionButton actionId={SHOW_BRANCH_DIFF_ACTION_ID} />\n      <ActionButton actionId={SHOW_MY_BRANCHES_ACTION_ID} />\n      <ActionButton actionId={FETCH_ACTION_ID} />\n      <ActionButton actionId={TOGGLE_FAVORITE_ACTION_ID} />\n      <ActionButton\n        actionId={VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH}\n      />\n      <ToolbarSeparator />\n      <BranchesGroupByActionButton />\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </StyledToolbar>\n  );\n}\n","import React, { RefObject } from \"react\";\nimport {\n  atom,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionTooltip,\n  MultiViewToolWindow,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n  TooltipTrigger,\n  ToolWindowTabContent,\n} from \"@intellij-platform/core\";\n\nimport { VcsLogDetailsView } from \"./VcsLogDetailsView\";\nimport { VcsLogCommitsView } from \"./CommitsView/VcsLogCommitsView\";\nimport { VcsBranchesView } from \"./BranchesView/VcsBranchesView\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  useResetFilters,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsLogTabShowBranches,\n  vcsTabKeysState,\n  vcsTabTitleState,\n} from \"./vcs-logs.state\";\n\nexport const VERSION_CONTROL_TOOLWINDOW_ID = \"Version Control\";\n\nconst firstViewSizeState = atom({\n  key: \"vcs/toolwindow/firstViewSize\",\n  default: 0.25,\n});\nconst lastViewSizeState = atom({\n  key: \"vcs/toolwindow/lastViewSize\",\n  default: 0.35,\n});\n\nconst StyledToolWindowHeader = styled.span`\n  margin: 0 0.5rem 0 0.125rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  :focus-visible {\n    outline: none;\n  }\n`;\n\nexport const searchInputRefState = atom<RefObject<HTMLInputElement>>({\n  key: \"vcs/toolWindow/searchInputRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const VersionControlToolWindow = () => {\n  const tabKeys = useRecoilValue(vcsTabKeysState);\n  const [activeTabKey, setActiveTabKey] = useRecoilState(vcsActiveTabKeyState);\n  return (\n    <MultiViewToolWindow\n      headerContent={<StyledToolWindowHeader>Git:</StyledToolWindowHeader>}\n      activeKey={activeTabKey}\n      onActiveKeyChange={(key) => setActiveTabKey(`${key}`)}\n    >\n      {tabKeys.map((key) => (\n        <MultiViewToolWindow.View\n          tabContent={<VcsToolWindowTabTitle tabKey={key} />}\n          key={key}\n        >\n          <VcsTab tabKey={key} />\n        </MultiViewToolWindow.View>\n      ))}\n    </MultiViewToolWindow>\n  );\n};\n\nconst StyledExpandStripeButton = styled.button.attrs({ tabIndex: -1 })`\n  box-sizing: border-box;\n  all: unset;\n  height: 100%;\n  width: 1.71875rem;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.625rem;\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  :disabled {\n    color: ${({ theme }) => theme.color(\"Button.disabledText\")};\n  }\n  &:hover {\n    background: ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Button.hoverBackground\",\n        theme.dark ? \"#0f0f0f28\" : \"#55555528\"\n      )};\n  }\n`;\nconst StyledShowBranchesButton = styled(StyledExpandStripeButton)`\n  border-right: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nconst StyledShowBranchesButtonText = styled.span`\n  writing-mode: vertical-lr;\n  transform: rotateZ(180deg);\n  font-size: 0.6875rem;\n`;\n\nfunction ShowBranchesButton({ onPress }: { onPress: () => void }) {\n  return (\n    <StyledShowBranchesButton onClick={onPress}>\n      <PlatformIcon icon=\"actions/arrowExpand\" />\n      <StyledShowBranchesButtonText>Branches</StyledShowBranchesButtonText>\n    </StyledShowBranchesButton>\n  );\n}\n\nfunction VcsTab({ tabKey }: { tabKey: string }) {\n  const [firstViewSize, setFirstViewSize] = useRecoilState(firstViewSizeState);\n  const [lastViewSize, setLastViewSize] = useRecoilState(lastViewSizeState);\n\n  const actions = useVcsLogsToolWindowActions();\n  const [showBranches, setShowBranches] = useRecoilState(\n    vcsLogTabShowBranches(tabKey)\n  );\n\n  const firstViewProps: Partial<ThreeViewSplitterProps> = showBranches\n    ? {\n        firstView: <VcsBranchesView />,\n        firstSize: firstViewSize,\n        onFirstResize: setFirstViewSize,\n        firstViewMinSize: 85,\n      }\n    : {};\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        // tabIndex is added to make the whole container focusable, which means the focus can go away from the currently\n        // focused element, when background is clicked. This is to follow the original implementation.\n        <StyledContainer {...shortcutHandlerProps} tabIndex={0}>\n          {!showBranches && (\n            <ShowBranchesButton onPress={() => setShowBranches(true)} />\n          )}\n          <ThreeViewSplitter\n            {...firstViewProps}\n            innerView={<VcsLogCommitsView tabKey={tabKey} />}\n            innerViewMinSize={200}\n            lastView={<VcsLogDetailsView />}\n            lastSize={lastViewSize}\n            onLastResize={setLastViewSize}\n            lastViewMinSize={40}\n          />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nfunction useVcsLogsToolWindowActions() {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const hideBranches = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          vcsLogTabShowBranches(\n            snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n          ),\n          // Would be nicer to have the action toggle, but prioritized matching the reference impl here.\n          false\n        );\n      },\n    []\n  );\n  const toggleMatchCaseAction = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          vcsLogFilter.matchCase(\n            snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n          ),\n          (value) => !value\n        );\n      },\n    []\n  );\n\n  const toggleRegExpAction = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          vcsLogFilter.regExp(\n            snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n          ),\n          (value) => !value\n        );\n      },\n    []\n  );\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.FOCUS_TEXT_FILTER,\n      title: \"Focus Text Filter\",\n      actionPerformed: () => {\n        textFilterRef.current?.focus();\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_HIDE_BRANCHES,\n      title: \"Hide Git Branches\",\n      icon: <PlatformIcon icon=\"actions/arrowCollapse\" />,\n      actionPerformed: hideBranches,\n    },\n    {\n      id: VcsActionIds.MATCH_CASE,\n      title: \"Match Case\",\n      icon: <PlatformIcon icon=\"actions/matchCase.svg\" />,\n      actionPerformed: toggleMatchCaseAction,\n    },\n    {\n      id: VcsActionIds.REG_EXP,\n      title: \"Regex\",\n      icon: <PlatformIcon icon=\"actions/regex\" />,\n      actionPerformed: toggleRegExpAction,\n    },\n  ];\n  return actions;\n}\n\nfunction VcsToolWindowTabTitle({ tabKey }: { tabKey: string }) {\n  const resetFilters = useResetFilters();\n  const closeTab = useRecoilCallback(\n    ({ set, snapshot, reset }) =>\n      () => {\n        const tabs = snapshot.getLoadable(vcsTabKeysState).getValue();\n        const currentActiveTabKey = snapshot\n          .getLoadable(vcsActiveTabKeyState)\n          .getValue();\n        if (currentActiveTabKey === tabKey) {\n          // make sure the active tab key remains valid, by switching to previous tab. In the reference implementation\n          // the previously activated tab will be activated instead of the previous one index-wise, but it's a\n          // negligible and easy-to-fix difference.\n          set(\n            vcsActiveTabKeyState,\n            tabs[tabs.findIndex((key) => key === tabKey) - 1] || tabs[0]\n          );\n        }\n        set(vcsTabKeysState, (keys) => keys.filter((key) => key !== tabKey));\n        resetFilters(tabKey);\n        reset(vcsLogTabShowBranches(tabKey));\n      },\n    []\n  );\n  return (\n    <ToolWindowTabContent\n      title={useRecoilValue(vcsTabTitleState(tabKey))}\n      closeButton={\n        tabKey !== \"MAIN\" && (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Close Tab\" />}>\n            <TabCloseButton onPress={closeTab} />\n          </TooltipTrigger>\n        )\n      }\n    />\n  );\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\n\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\nimport {\n  VERSION_CONTROL_TOOLWINDOW_ID,\n  VersionControlToolWindow,\n} from \"../VersionControl/VersionControlToolWindow/VersionControlToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  showStripeButton?: boolean;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({ anchor: \"left\", isVisible: false }),\n  },\n  {\n    id: VERSION_CONTROL_TOOLWINDOW_ID,\n    title: \"Version Control\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowChanges\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <VersionControlToolWindow />\n      </Suspense>\n    ),\n    showStripeButton: false,\n    initialState: toolWindowState({\n      anchor: \"bottom\",\n      weight: 0.35,\n    }),\n  },\n];\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport { repoBranchesState, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useRecoilValue(repoBranchesState(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"invalid\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                errorMessage={\n                  error && validationState === \"invalid\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  IconButton,\n  Toolbar,\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport {\n  allBranchesState,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useRecoilState } from \"recoil\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>({\n  key: \"branchesPopup.bounds\",\n  default: undefined,\n});\n\nexport function BranchesPopup({ onClose }: { onClose: () => void }) {\n  const repoBranches = useLatestRecoilValue(allBranchesState);\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] =\n    useRecoilState(branchesPopupSizeState);\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  // useRefreshRecoilValueOnMount(allBranchesState);\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      onClose();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={onClose}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport { sampleRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { clone } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport styled from \"styled-components\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core\";\n\nconst StyledDialog = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${WINDOW_SHADOW};\n  text-align: center;\n  line-height: 1.5;\n`;\nconst StyledDialogHeader = styled.div`\n  background: ${({ theme }) => theme.color(\"Popup.Header.activeBackground\")};\n  padding: 4px;\n  text-align: center;\n`;\nconst StyledDialogContent = styled.div`\n  padding: 8px 16px;\n`;\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nexport const SampleRepoInitializer: React.FC = ({ children }) => {\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function init(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl });\n      }\n    }\n\n    init(sampleRepo.path, sampleRepo.url)\n      .then(() => {\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      })\n      .catch((e) => {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      });\n  }, []);\n\n  if (state === \"uninitialized\") {\n    return null;\n  }\n  if (state === \"initialized\") {\n    return <>{children}</>;\n  }\n  return (\n    <div style={{ minHeight: \"100vh\", position: \"relative\" }}>\n      <StyledDialog>\n        <StyledDialogHeader>Cloning sample repo</StyledDialogHeader>\n        <StyledDialogContent>\n          {state === \"cloning\" ? (\n            <>\n              Cloning <b>{sampleRepo.url}</b>. <br />\n              It may take several seconds.\n            </>\n          ) : (\n            <>Something went wrong!</>\n          )}\n        </StyledDialogContent>\n      </StyledDialog>\n    </div>\n  );\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n} from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\nimport {\n  sampleRepos,\n  useRefreshCurrentProjectFiles,\n} from \"../Project/project.state\";\nimport { cloneRepo, isSuccessfullyCloned } from \"../SampleRepoInitializer\";\nimport React from \"react\";\nimport { useRefreshVcsRoots } from \"./file-status.state\";\nimport { useRecoilCallback } from \"recoil\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n  const refreshProjectFiles = useRefreshCurrentProjectFiles();\n  const refreshVcsRoots = useRefreshVcsRoots();\n\n  return useRecoilCallback(\n    ({ reset }) =>\n      async () => {\n        const cloned = await isSuccessfullyCloned(sampleRepos.ExampleRepo.path);\n        if (!cloned && !notified) {\n          notified = true;\n          balloonManager.showSticky({\n            title: \"Clone another repo\",\n            icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n            body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n            actions: (\n              <>\n                <BalloonActionLink\n                  onPress={() => {\n                    runTask(\n                      {\n                        title: `Cloning source repository ${sampleRepos.ExampleRepo.url}`,\n                      },\n                      {\n                        run: async ({\n                          setIndeterminate,\n                          setFraction,\n                          setSecondaryText,\n                        }) => {\n                          await cloneRepo({\n                            dir: sampleRepos.ExampleRepo.path,\n                            url: sampleRepos.ExampleRepo.url,\n                            onProgress: (progress) => {\n                              if (progress.total) {\n                                const fraction =\n                                  progress.loaded / progress.total;\n                                setFraction(fraction);\n                                setSecondaryText(\n                                  `${progress.phase}: ${Math.round(\n                                    fraction * 100\n                                  )}% ${progress.loaded}/${progress.total}`\n                                );\n                              } else {\n                                setSecondaryText(progress.phase);\n                                setIndeterminate(true);\n                              }\n                            },\n                          }).then(\n                            () => {\n                              refreshVcsRoots();\n                              refreshProjectFiles(); // FIXME: flashes the whole page\n                            },\n                            (e) => {\n                              balloonManager.show({\n                                icon: \"Error\",\n                                title: \"Clone failed\",\n                                body: `Failed to clone git repo \"${sampleRepos.ExampleRepo.url} into ${sampleRepos.ExampleRepo.path}: ${e}\"`,\n                              });\n                            }\n                          );\n                        },\n                      }\n                    );\n                  }}\n                >\n                  Clone example-repo\n                </BalloonActionLink>\n              </>\n            ),\n          });\n        }\n      },\n    []\n  );\n};\n","import { atom } from \"recoil\";\nimport { Bounds } from \"@intellij-platform/core\";\n\nexport const showProgressPanelState = atom({\n  key: \"ide.statusbar.showProgressPanel\",\n  default: false,\n});\nexport const tasksPopupBoundsState = atom<Bounds | null>({\n  key: \"ide.statusbar.tasksPopup\",\n  default: null,\n});\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport {\n  IconButton,\n  PlatformIcon,\n  Popup,\n  ProgressBar,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { tasksState, useCancelTask } from \"../tasks\";\nimport {\n  showProgressPanelState,\n  tasksPopupBoundsState,\n} from \"./IdeStatusBar.state\";\n\nconst StyledPopupTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport function TasksPopup() {\n  const setShowProgressPanel = useSetRecoilState(showProgressPanelState);\n  const tasks = useRecoilValue(tasksState);\n  const cancel = useCancelTask();\n  const [bounds, setBounds] = useRecoilState(tasksPopupBoundsState);\n\n  return (\n    <Popup\n      bounds={\n        // Maybe it would be a nicer UX to not fix height, and let it be based on content, but tried to mimic the\n        // original impl, where the height is fixed. The only improvement over the original impl is that the default\n        // height (in case of no persisted bounds), would depend on the content, and it will remain based on content,\n        // as long as the bounds is not changed manually by the user.\n        bounds || {\n          width: 300,\n          // TODO: allow for positioning based on right and/or bottom\n          left: window.innerWidth - 300 - /* distance to right edge */ 150,\n          top:\n            window.innerHeight -\n            tasks.length * 80 - // progress bars\n            30 - // header\n            100, // distance to bottom edge,\n        }\n      }\n      onBoundsChange={(bounds) => {\n        setBounds(bounds);\n      }}\n      minHeight={100}\n      minWidth={300}\n      nonDismissable\n      interactions=\"all\"\n    >\n      <Popup.Layout\n        header={\n          <Popup.Header hasControls>\n            <StyledPopupTitle>Background Tasks</StyledPopupTitle>\n            <TooltipTrigger tooltip={<Tooltip>Hide</Tooltip>}>\n              <IconButton\n                preventFocusOnPress\n                excludeFromTabOrder\n                onPress={() => setShowProgressPanel(false)}\n              >\n                <PlatformIcon icon=\"general/hideToolWindow\" />\n              </IconButton>\n            </TooltipTrigger>\n          </Popup.Header>\n        }\n        content={\n          <>\n            {tasks.map((task, index) => (\n              <React.Fragment key={task.id}>\n                <ProgressBar\n                  style={{ margin: \".5rem 0.75rem\" }}\n                  name={task.title}\n                  isIndeterminate={task.progress.isIndeterminate}\n                  aria-label={`Progress of ${task.title}`}\n                  details={\n                    task.progress.text ||\n                    (task.progress.secondaryText ? <>&nbsp;</> : undefined)\n                  }\n                  secondaryDetails={task.progress.secondaryText}\n                  value={task.progress.fraction}\n                  maxValue={1}\n                  button={\n                    task.isCancelable && (\n                      <ProgressBarStopButton onPress={() => cancel(task.id)} />\n                    )\n                  }\n                />\n                {tasks[index + 1] && <StyledVerticalSeparator />}\n              </React.Fragment>\n            ))}\n          </>\n        }\n      />\n    </Popup>\n  );\n}\n","import styled from \"styled-components\";\nimport {\n  BareButton,\n  Link,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { firstTaskState, taskCountState, useCancelTask } from \"../tasks\";\nimport { showProgressPanelState } from \"./IdeStatusBar.state\";\nimport React, { useEffect } from \"react\";\nimport { TasksPopup } from \"./TasksPopup\";\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\nconst StyledProgressBarButton = styled.span`\n  cursor: pointer;\n\n  ${ProgressBar.Container} {\n    cursor: unset;\n  }\n`;\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nexport const StatusBarTaskProgressBar = () => {\n  const firstTask = useRecoilValue(firstTaskState);\n  const tasksCount = useRecoilValue(taskCountState);\n  const cancel = useCancelTask();\n  const [showProgressPanel, setShowProgressPanel] = useRecoilState(\n    showProgressPanelState\n  );\n\n  // When there is no tasks, switch back to not showing the panel.\n  useEffect(() => {\n    if (tasksCount === 0) {\n      setShowProgressPanel(false);\n    }\n  }, [tasksCount]);\n\n  return (\n    <>\n      {firstTask && !showProgressPanel && (\n        <TooltipTrigger\n          tooltip={\n            <Tooltip>{`${firstTask.title}. Click to see all running background tasks.`}</Tooltip>\n          }\n        >\n          <BareButton\n            preventFocusOnPress\n            excludeFromTabOrder\n            onPress={() => {\n              setShowProgressPanel(true);\n            }}\n          >\n            <StyledProgressBarButton>\n              <StatusBarProgress\n                name={firstTask.progress.text || firstTask.title}\n                isIndeterminate={firstTask.progress.isIndeterminate}\n                value={firstTask.progress.fraction}\n                maxValue={1}\n                button={\n                  <>\n                    {/*  {task.canPause && (\n                      <ProgressBarPauseButton\n                        small\n                        paused={false}\n                        onPausedChange={() => {}}\n                      />\n                    )}*/}\n                    {firstTask.isCancelable && (\n                      <TooltipTrigger tooltip={<Tooltip>Cancel</Tooltip>}>\n                        <ProgressBarStopButton\n                          small\n                          onPress={() => cancel(firstTask.id)}\n                        />\n                      </TooltipTrigger>\n                    )}\n                  </>\n                }\n              />\n            </StyledProgressBarButton>\n          </BareButton>\n        </TooltipTrigger>\n      )}\n      {(tasksCount > 1 || showProgressPanel) && (\n        <>\n          <Spacer />\n          <Link\n            onPress={() =>\n              setShowProgressPanel((currentValue) => !currentValue)\n            }\n          >\n            {showProgressPanel ? \"Hide processes\" : \"Show all\"} ({tasksCount})\n          </Link>\n        </>\n      )}\n      {showProgressPanel && tasksCount > 0 && <TasksPopup />}\n    </>\n  );\n};\n","import { resolveRef } from \"isomorphic-git\";\nimport { selector } from \"recoil\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsRootForFile, vcsRootsState } from \"./file-status.state\";\nimport {\n  branchForPathState,\n  RepoBranches,\n  repoBranchesState,\n} from \"./Branches/branches.state\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootState = selector({\n  key: \"vcs/activeFileRepo\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    const activeFileRepo = activeFile && get(vcsRootForFile(activeFile));\n    return activeFileRepo ?? get(vcsRootsState)[0]?.dir;\n  },\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesState = selector<RepoBranches>({\n  key: \"vcs/activeFileRepoBranches\",\n  get: ({ get }) => {\n    const activeFileRepoRoot = get(activeFileRepoRootState);\n    return get(repoBranchesState(activeFileRepoRoot));\n  },\n});\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchState = selector({\n  key: \"vcs/activeFileCurrentBranch\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    return activeFile ? branchForPathState(activeFile) : null;\n  },\n});\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadState = selector({\n  key: \"vcs/activeFileRepoHead\",\n  get: async ({ get }) => {\n    const branch = get(activeFileCurrentBranchState);\n    if (branch) {\n      return {\n        detached: false,\n        head: branch,\n      };\n    }\n    const repoRoot = get(activeFileRepoRootState);\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  },\n});\n","import {\n  ActionTooltip,\n  PlatformIcon,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { activeFileRepoHeadState } from \"../VersionControl/active-file.state\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\n\nexport function BranchPopupTrigger() {\n  const gitRepoHead = useLatestRecoilValue(activeFileRepoHeadState);\n\n  return (\n    gitRepoHead && (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip\n            actionName={\n              gitRepoHead.detached\n                ? \"Git: Detached HEAD doesn't point to any branch\"\n                : `Git Branch: ${gitRepoHead.head}`\n            }\n          />\n        }\n      >\n        <StatusBarWidget\n          icon={\n            <PlatformIcon\n              icon={\n                gitRepoHead.detached ? \"general/warning.svg\" : \"vcs/branch.svg\"\n              }\n            />\n          }\n          label={gitRepoHead.head.slice(\n            0,\n            gitRepoHead.detached ? 8 : undefined\n          )}\n        />\n      </TooltipTrigger>\n    )\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  PopupTrigger,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\n\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\nimport { StatusBarTaskProgressBar } from \"./StatusBarTaskProgressBar\";\nimport { BranchPopupTrigger } from \"./BranchPopupTrigger\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\nexport const IdeStatusBar = () => {\n  const cursorPosition = useRecoilValue(editorCursorPositionState);\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarTaskProgressBar />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <PopupTrigger\n            placement=\"top\"\n            onOpenChange={(isOpen) => {\n              if (!isOpen) {\n                setTimeout(maybeShowGitCloneTip, 500);\n              }\n            }}\n            popup={({ close }) => <BranchesPopup onClose={close} />}\n          >\n            <BranchPopupTrigger />\n          </PopupTrigger>\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  IconButton,\n  IconButtonWithMenu,\n  ActionsProvider,\n  Toolbar,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n  ActionButton,\n} from \"@intellij-platform/core\";\n\nimport { changesTreeNodesState } from \"../ChangesView/ChangesView.state\";\nimport { getChangeListTreeItemProps } from \"../ChangesView/changesTreeNodeRenderers\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { allChangesState, useRollbackChanges } from \"../change-lists.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { groupings } from \"../ChangesView/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  AnyNode,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesView/change-view-nodes\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  line-height: 2;\n  padding-left: 0.5rem;\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useRecoilValue(\n    rollbackViewState.initiallyExpandedKeys\n  );\n  const initiallyIncludedChangeKeys = useRecoilValue(\n    rollbackViewState.initiallyIncludedChanges\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [windowBounds, setWindowBounds] = useRecoilState(\n    rollbackViewState.windowBounds\n  );\n  const rootNodes = useRecoilValue(rollbackViewState.rootNodes);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<AnyNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetRecoilState(rollbackViewState.isOpen);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              groupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      treeRef={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = getChangeListTreeItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \"0 .75rem\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox isDisabled>\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close}>Cancel</Button>\n                  <Button\n                    variant=\"default\"\n                    onPress={() => {\n                      rollbackChanges(includedChanges)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"recoil\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsState = atom({\n  key: \"toolWindows\",\n  default: new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    ),\n    {\n      removedFromSideBarIds: toolWindows\n        .filter(({ showStripeButton }) => showStripeButton === false)\n        .map(({ id }) => id),\n    }\n  ),\n});\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom, atomFamily } from \"recoil\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom({\n    key: \"search.everywhere.isOpen\",\n    default: false,\n  }),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>({\n    key: \"search.everywhere.tab\",\n    default: \"All\",\n  }),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element>({\n    key: \"search.everywhere.contextElement\",\n    default: undefined,\n  }),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily<string, string>({\n    key: \"search.everywhere.initialQuery\",\n    default: \"\",\n  }),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>({\n    key: \"search.everywhere.bounds\",\n    default: null,\n  }),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { RecoilState, useSetRecoilState } from \"recoil\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsState,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of a recoil state.\n   */\n  persistedBoundsState: RecoilState<Partial<Bounds> | null>;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetRecoilState(persistedBoundsState);\n  const getInitBounds = useRecoilInitialValue(persistedBoundsState, {\n    top: 150,\n    height: Math.max(200, window.innerHeight - 300),\n  });\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(getInitBounds);\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 0.9375rem;\n  margin-right: 0.25rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useRecoilValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = file.name;\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback } from \"recoil\";\nimport {\n  currentProjectFilesState,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const getProjectFiles = useRecoilCallback(\n      ({ snapshot }) =>\n        () =>\n          snapshot.getLoadable(currentProjectFilesState).getValue(),\n      []\n    );\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        getProjectFiles()\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useCollectionSearchInput,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetRecoilState(searchEverywhereState.isOpen);\n  const [tab, setTab] = useRecoilState(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useRecoilInitialValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetRecoilState(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const collectionRef = useRef<HTMLUListElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef,\n    selectionManager: selectionManagerRef.current,\n  });\n\n  const tips = useTips();\n\n  return (\n    <ContentAwarePopup\n      persistedBoundsState={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        {...collectionSearchInputProps}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        ref={collectionRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        showAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={(key) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            setSearchResultLimit(\n                              (limit) => limit + SEARCH_RESULT_LIMIT\n                            );\n                            const nextItem =\n                              searchResult[visibleSearchResult.length + 1];\n                            if (nextItem) {\n                              // nextItem is expected to always have value\n\n                              // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n                              // if we want to avoid setTimeout\n                              setTimeout(() => {\n                                setSelectedKeys(new Set([nextItem.key]));\n                                selectionManagerRef.current?.setFocusedKey(\n                                  nextItem.key\n                                );\n                              });\n                            }\n                          } else {\n                            close();\n                            // Making sure the popup is fully closed before the new action is performed. One edge case that can\n                            // make a difference is actions like FindAction that open the same popup. By performing an action\n                            // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n                            // won't get any feedback when choosing such actions.\n                            setTimeout(() => {\n                              const itemWrapper = searchResult.find(\n                                (item) => item.key === key\n                              );\n                              itemWrapper?.contributor.processSelectedItem(\n                                itemWrapper.item\n                              );\n                              /**\n                               * The 50ms timeout is a workaround for an issue in FocusScope:\n                               * restoreFocus only works if the previously focused element is in the dom, when the focus\n                               * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n                               * window, which has a focus scope, when the window is opened, the currently focused\n                               * element (which will be the one to restore focus to), is search everywhere dialog, which\n                               * is immediately closed. So when the modal window is closed, it tries to move focus back\n                               * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n                               * track a chain of nodes to restore focus to.\n                               * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n                               * is closed, and then the actions is performed, for focus restoration to work.\n                               */\n                            }, 50);\n                          }\n                        }}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          return (\n                            <Item\n                              key={key}\n                              textValue={contributor.getItemText(item)}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import { useRecoilCallback } from \"recoil\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core\";\n\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useRecoilCallback(\n    ({ set }) =>\n      ({ element }: ActionContext, tab: string) => {\n        if (element) {\n          set(searchEverywhereState.isOpen, true);\n          set(searchEverywhereState.tab, tab);\n          set(searchEverywhereState.contextElement, element);\n        }\n      },\n    []\n  );\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changeListsUnderSelection,\n  changesTreeNodesState,\n  changesUnderSelectedKeys,\n  expandedKeysState,\n  includedChangeKeysState,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysState,\n} from \"./ChangesView/ChangesView.state\";\nimport {\n  allChangesState,\n  useRefreshChanges,\n  useSetActiveChangeList,\n} from \"./change-lists.state\";\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsState,\n  currentProjectFilesState,\n} from \"../../Project/project.state\";\nimport path from \"path\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport {\n  AnyNode,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"./ChangesView/change-view-nodes\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useRecoilCallback(\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  const refresh = useRefreshChanges();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useRecoilCallback(queueCheckInCallback, []);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useRecoilValue(activePathsState);\n  const projectFiles = useRecoilValue(currentProjectFilesState);\n  const roots = activePaths.filter(\n    (path) =>\n      !activePaths.find(\n        (activePath) => path !== activePath && path.startsWith(activePath)\n      )\n  );\n\n  const isDir = projectFiles.find(\n    (item) => path.dirname(item.path).startsWith(roots[0]) // This is not quite accurate!\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, change.after.path))\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: isDir\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useRecoilCallback(\n    ({ snapshot, set }) =>\n      () => {\n        const includedChangesKeys = snapshot\n          .getLoadable(includedChangeKeysState)\n          .getValue();\n        let keyToSelect = includedChangesKeys.values().next().value;\n        if (includedChangesKeys.size === 0) {\n          const allKeys = snapshot\n            .getLoadable(allChangesState)\n            .getValue()\n            .map(getNodeKeyForChange);\n          set(includedChangeKeysState, new Set(allKeys));\n          keyToSelect = allKeys[0];\n        }\n        if (keyToSelect) {\n          const { rootNodes } = snapshot\n            .getLoadable(changesTreeNodesState)\n            .getValue();\n          set(\n            expandedKeysState,\n            new Set([\n              ...snapshot.getLoadable(expandedKeysState).getValue(),\n              ...getExpandedToNodesKeys(\n                (node) => (isGroupNode(node) ? node.children : null),\n                (node) => node.key,\n                rootNodes as AnyNode[],\n                [keyToSelect]\n              ),\n            ])\n          );\n          set(selectedKeysState, new Set([keyToSelect]));\n        }\n      },\n    []\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        if (!change.after.isDir) {\n          editorStateManager.openPath(\n            change.after.path,\n            index === arr.length - 1\n          );\n        }\n      });\n    },\n  };\n}\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChangeLists = useRecoilValue(changeListsUnderSelection);\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  if (selectedChanges.size > 0) {\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { activeFileRepoBranchesState } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport { Errors } from \"isomorphic-git\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useRecoilValue(activeFileRepoBranchesState);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"invalid\" : \"valid\";\n\n  const create = () => {\n    if (isValid) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              errorMessage={\n                validationState === \"invalid\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"invalid\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n\n  return [\n    ...useChangesViewActionDefinitions(),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup onClose={close} />);\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH,\n      title: \"Navigate Log to Selected Branch Head\",\n      useShortcutsOf: \"SelectIn\",\n      icon: <PlatformIcon icon=\"general/locate.svg\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n  ];\n}\n","import {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { useEffect, useRef } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { RecoilSync } from \"recoil-sync\";\n\nimport { fs } from \"../../fs/fs\";\nimport { ensureDir } from \"../../fs/fs-utils\";\nimport { currentProjectState } from \"../project.state\";\nimport { StorageFiles } from \"./persistentAtomEffect\";\n\ntype ComponentState = { [key: string]: unknown; \"@name\": string };\ntype WorkspaceState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\n\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\n\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nasync function readWorkspace(\n  storageFile: string\n): Promise<null | WorkspaceState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const workspaceFileExists = await fs.promises.exists(storageFile);\n  if (!workspaceFileExists) {\n    return null;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = xmlParser.parse(xmlData);\n  workspace.project = workspace.project || {};\n  workspace.project.component = workspace.project.component || {\n    component: [],\n  };\n  return workspace;\n}\nasync function writeWorkspace(\n  storageFile: string,\n  workspaceState: WorkspaceState\n): Promise<void> {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n\n  const xmlString = xmlBuilder.build(workspaceState);\n  await ensureDir(fs.promises, path.dirname(storageFile));\n  await fs.promises.writeFile(storageFile, xmlString);\n}\n\nconst storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n\nexport function PersistentStateProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const containerDirectory = path.join(\n    useRecoilValue(currentProjectState).path,\n    \".idea\"\n  );\n  const workspacePromiseRef = useRef<{\n    [key: string]: Promise<WorkspaceState | null>;\n  }>({});\n\n  const resolveStorageFile = (storageFile: string) =>\n    path.join(\n      containerDirectory,\n      storageFileMapping[storageFile] || storageFile\n    );\n\n  const getWorkspace = (storageFile: string) => {\n    // FIXME: caching the first read can cause issues when multiple writes happen, where they override each other.\n    const resolvedStorageFile = resolveStorageFile(storageFile);\n    if (!workspacePromiseRef.current[resolvedStorageFile]) {\n      workspacePromiseRef.current[resolvedStorageFile] =\n        readWorkspace(resolvedStorageFile);\n    }\n    return workspacePromiseRef.current[resolvedStorageFile];\n  };\n\n  // preload common storage files\n  useEffect(() => {\n    getWorkspace(StorageFiles.WORKSPACE_FILE);\n  }, []);\n\n  return (\n    <RecoilSync\n      storeKey=\"ProjectWorkspace\"\n      read={async (key: string) => {\n        const [storageFile, componentName] = key.split(\"|\");\n        const workspace = await getWorkspace(storageFile);\n        return workspace?.project.component.find(\n          ({ \"@name\": name }) => name === componentName\n        );\n      }}\n      write={async ({ diff }) => {\n        const changesByFile = groupBy(\n          ({ storageFile }) => storageFile,\n          [...diff.entries()].map(([key, value]) => {\n            const [storageFile, componentName] = key.split(\"|\");\n            return {\n              storageFile,\n              componentName,\n              value,\n            };\n          })\n        );\n\n        for (const storageFile in changesByFile) {\n          const changes = changesByFile[storageFile];\n          const workspace: WorkspaceState = (await readWorkspace(\n            storageFile\n          )) || {\n            \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n            project: { \"@version\": \"4\", component: [] },\n          };\n          for (const { value, componentName } of changes) {\n            const components = workspace.project.component;\n            const index = components.findIndex(\n              ({ \"@name\": name }) => name === componentName\n            );\n            const componentState =\n              typeof value === \"function\"\n                ? value(components[index] || null)\n                : (value as object);\n            components.splice(index, index >= 0 ? 1 : 0, {\n              \"@name\": componentName,\n              ...componentState,\n            });\n          }\n          await writeWorkspace(resolveStorageFile(storageFile), workspace);\n        }\n      }}\n    >\n      {children}\n    </RecoilSync>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + Math.round(num / 20) + 1;\n}\n","import React, { CSSProperties, RefObject } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useBalloonManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { useInitializeVcs } from \"../VersionControl/file-status.state\";\nimport { toolWindows } from \"./toolWindows\";\nimport { useInitializeChanges } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsState } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { PersistentStateProvider } from \"./persistence/PersistentStateProvider\";\nimport { useTestActions } from \"../testActions/useTestActions\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({\n  height,\n  toolWindowRef,\n}: {\n  height: CSSProperties[\"height\"];\n  toolWindowRef: RefObject<ToolWindowRefValue>;\n}) => {\n  const [state, setState] = useRecoilState(toolWindowsState);\n  const isRollbackWindowOpen = useRecoilValue(rollbackViewState.isOpen);\n  const isSearchEveryWhereOpen = useRecoilValue(searchEverywhereState.isOpen);\n\n  useInitializeVcs();\n  useInitializeChanges();\n  usePersistenceFsNotification();\n  _balloonManagerRef.value = useBalloonManager();\n\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n\n  return (\n    <PersistentStateProvider>\n      <StyledWindowFrame style={{ height }}>\n        <ActionsProvider\n          actions={allActions}\n          useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n        >\n          {({ shortcutHandlerProps }) => (\n            <>\n              <DefaultToolWindows\n                ref={toolWindowRef}\n                toolWindowsState={state}\n                onToolWindowStateChange={(newState) => {\n                  setState(newState);\n                }}\n                windows={toolWindows}\n                containerProps={shortcutHandlerProps}\n              >\n                <FileEditor />\n              </DefaultToolWindows>\n              <IdeStatusBar />\n            </>\n          )}\n        </ActionsProvider>\n\n        {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n        {isRollbackWindowOpen && <RollbackWindow />}\n      </StyledWindowFrame>\n    </PersistentStateProvider>\n  );\n};\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport interface ProcessState {\n  state:\n    | \"STARTED\"\n    | \"PAUSED\"\n    | \"PAUSING\"\n    | \"CANCELED\"\n    | \"CANCELING\"\n    | \"FINISHED\";\n  /**\n   * between 1 and 100\n   */\n  progress: number;\n  isIndeterminate: boolean;\n  name: string;\n  details: string;\n  onCancel?: () => void;\n  onPause?: () => void;\n}\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateVersionControlWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit9\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n  [VcsActionIds.FOCUS_TEXT_FILTER]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyL\",\n      },\n    },\n  ],\n  SafeDelete: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n};\n","import React, { CSSProperties, useRef } from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  BalloonManager,\n  KeymapProvider,\n  PopupManager,\n  ToolWindowRefValue,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { SampleRepoInitializer } from \"./SampleRepoInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport { ToolWindowsRefContext } from \"./Project/useToolWindowManager\";\nimport * as path from \"path\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({ height }: { height?: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <SampleRepoInitializer>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <RecoilRoot>\n              <BalloonManager disablePortal>\n                <WindowManager>\n                  <PopupManager>\n                    {/* disablePortal to make example app more portable*/}\n                    <ToolWindowsRefContext.Provider value={toolWindowRef}>\n                      <Project height={height} toolWindowRef={toolWindowRef} />\n                    </ToolWindowsRefContext.Provider>\n                  </PopupManager>\n                </WindowManager>\n              </BalloonManager>\n            </RecoilRoot>\n          </KeymapProvider>\n        </SampleRepoInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n","import {\n  Action,\n  ActionDefinition,\n} from \"@intellij-platform/core/ActionSystem/Action\";\n\nexport type ActionInResolvedGroup = Action & { parent: ResolvedActionGroup };\n\nexport interface MutableActionGroup extends Action {\n  children: Action[];\n  /**\n   * Whether the action group is searchable. See {@link getAvailableActionsFor}.\n   */\n  isSearchable?: boolean;\n  /**\n   * If the action group should be rendered as a popup (submenu), in menus.\n   */\n  isPopup?: boolean;\n}\nexport type ActionGroup = Readonly<MutableActionGroup>;\nexport interface ResolvedActionGroup extends ActionGroup {\n  parent: ResolvedActionGroup | null;\n  children: ActionInResolvedGroup[];\n}\nexport interface ActionGroupDefinition extends ActionDefinition {\n  children: ActionDefinition[]; // Should DividerItem be supported first-class here?\n  /**\n   * Whether the action group is searchable. See {@link getAvailableActionsFor}.\n   */\n  isSearchable?: boolean;\n  /**\n   * If the action group should be rendered as a popup (submenu), in menus.\n   */\n  isPopup?: boolean;\n}\n\nexport function isInResolvedActionGroup(\n  action: Action\n): action is ActionInResolvedGroup {\n  return \"parent\" in action;\n}\nexport function isActionGroup(action: Action): action is ActionGroup {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n\nexport function isResolvedActionGroup<T extends Action>(\n  action: Action\n): action is ResolvedActionGroup {\n  return \"children\" in action && \"parent\" in action; // probably better to use a discriminator field like `type`\n}\n\nexport function isActionGroupDefinition(\n  action: ActionDefinition\n): action is ActionGroupDefinition {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n","import React from \"react\";\nimport { useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\n\n/**\n * Renders the first keyboard shortcut for the action specified by {@param actionId}, based on the keymap context.\n * if {@param children} is provided, treats it as a render function that receives the shortcut string.\n */\nexport const ActionShortcut = ({\n  actionId,\n  children,\n}: {\n  actionId: string;\n  children?: (shortcut: string) => React.ReactNode;\n}) => {\n  const getShortcut = useGetActionShortcut();\n  const shortcutString = getShortcut(actionId);\n  return (\n    <>\n      {shortcutString && (children ? children(shortcutString) : shortcutString)}\n    </>\n  );\n};\n\n/**\n * Returns a function that gets first keyboard shortcut for the action specified by `actionId`, based on the\n * keymap context.\n */\nexport const useGetActionShortcut = (): ((actionId: string) => string) => {\n  const keymap = useKeymap();\n  return (actionId: string) => {\n    const keyboardShortcut = keymap?.[actionId]?.find(\n      ({ type }) => type === \"keyboard\"\n    );\n    return keyboardShortcut ? shortcutToString(keyboardShortcut) : \"\";\n  };\n};\n","import React, { KeyboardEventHandler, useRef } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  isKeyboardShortcut,\n  KeyboardShortcut,\n  KeyStroke,\n  Shortcut,\n  supportedModifiers,\n} from \"./Shortcut\";\n\nexport function useShortcuts(\n  shortcuts: { [actionId: string]: ReadonlyArray<Shortcut> },\n  onAction: (\n    actionId: string,\n    args: {\n      event: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>;\n    }\n  ) => void | boolean,\n  {\n    useCapture = false,\n  }: {\n    /**\n     * Experimental option to determine if event handling should be done on capture phase. Useful for cases where\n     * a descendant element handles events in capture phase, and that conflicts with an action.\n     */\n    useCapture?: boolean;\n  } = {}\n) {\n  const firstKeyActivatedShortcutsRef = useRef<\n    Array<{ actionId: string; shortcut: KeyboardShortcut }>\n  >([]);\n  const secondStrokeResetTimerIdRef = useRef<number | null>(null);\n  const onKeyDown: KeyboardEventHandler<HTMLElement> = useEventCallback((e) => {\n    // TODO: repeated key downs can trigger an action repeatedly, in the original impl. Example: expand/shrink selection\n    if (isModifierOnly(e.nativeEvent) || e.repeat) {\n      return;\n    }\n    // firstKeyActivatedShortcutsRef will be re-adjusted in any case. Cleaning whatever scheduled reset\n    if (secondStrokeResetTimerIdRef.current !== null) {\n      window.clearTimeout(secondStrokeResetTimerIdRef.current);\n    }\n\n    function triggerAction(actionId: string) {\n      const result = onAction(actionId, { event: e });\n      if (result !== false) {\n        // TODO: make sure about how propagation should be stopped and/or controlled\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }\n    // If there are keyboard shortcuts that are half way handled (first keystroke triggered already, and we are within\n    // the valid wait for the second keystroke), they should be prioritized over first keystroke matching.\n    if (firstKeyActivatedShortcutsRef.current.length > 0) {\n      firstKeyActivatedShortcutsRef.current.some(({ shortcut, actionId }) => {\n        if (isKeyMatch(shortcut.secondKeyStroke, e, true)) {\n          triggerAction(actionId);\n          return true;\n        }\n      });\n      firstKeyActivatedShortcutsRef.current = [];\n    } else {\n      const firstKeyMatches = Object.entries(shortcuts)\n        .flatMap(([actionId, shortcuts]) =>\n          shortcuts.map((shortcut) => ({ actionId, shortcut }))\n        )\n        .filter(\n          (\n            input\n          ): input is {\n            actionId: string;\n            shortcut: KeyboardShortcut;\n          } => isKeyboardShortcut(input.shortcut)\n        )\n        .filter(({ shortcut }) => isKeyMatch(shortcut.firstKeyStroke, e));\n\n      firstKeyActivatedShortcutsRef.current = firstKeyMatches.filter(\n        ({ shortcut, actionId }) => shortcut.secondKeyStroke\n      );\n\n      if (firstKeyActivatedShortcutsRef.current.length > 0) {\n        secondStrokeResetTimerIdRef.current = window.setTimeout(() => {\n          firstKeyActivatedShortcutsRef.current = [];\n        }, 2000);\n        document.addEventListener(\n          \"keydown\",\n          () => {\n            document.addEventListener(\n              \"keyup\",\n              () => {\n                firstKeyActivatedShortcutsRef.current = [];\n              },\n              { once: true }\n            );\n          },\n          //  by passing capture: true, we skip the current keydown event, since it's already passed capture phase\n          { once: true, capture: true }\n        );\n      } else if (firstKeyMatches.length > 0) {\n        triggerAction(firstKeyMatches[0].actionId);\n      }\n    }\n  });\n  const shortcutHandlerProps = {\n    /**\n     * by setting onKeyDownCapture is set instead of onKeyDown, we can prioritize action event handler over\n     * component-specific handlers. That might be useful for some components that aggressively stop propagation of\n     * events they handle, if the action is considered of higher priority compared to the conflicting component-internal\n     * functionality. So maybe an option would be in order to define whether the shortcut's event handling should be done\n     * in capture or bubbling phase.\n     * Another thing to get clarified as action system is more used, is to decide if action handler should stop\n     * propagation or not. Or should it be an option?\n     * UPDATE: Added an option to determine whether event handling should be done in capture phase. The use case is\n     * \"Find in files\" action with Cmd+Shift+O shortcut, which overlaps with some action in Monaco editor (only in .ts\n     * files). Monaco uses capture phase, and stops propagation, so unless we use capture phase, useShortcut's event\n     * handler is never called.\n     * An apposite use case is in SpeedSearchTree in tool windows, where we want Escape to be handled by speed search,\n     * and propagation stopped, if speed search is currently active. The second Escape keystroke should move focus to\n     * the editor. That wouldn't work if we unconditionally handle events in capture phase.\n     */\n    [useCapture ? \"onKeyDownCapture\" : \"onKeyDown\"]: onKeyDown,\n  };\n  return { shortcutHandlerProps };\n}\n\nconst isKeyMatch = (\n  keyStroke: KeyStroke | undefined,\n  e: React.KeyboardEvent,\n  loose?: boolean\n) =>\n  e.code === keyStroke?.code &&\n  (loose ? keyStroke.modifiers || [] : supportedModifiers).every(\n    (modifier) =>\n      e.getModifierState(modifier) ===\n      Boolean(keyStroke.modifiers?.includes(modifier))\n  );\n\nfunction isModifierOnly(event: KeyboardEvent) {\n  return event.location === 1 || event.location === 2;\n}\n","import { pick, sortBy } from \"ramda\";\nimport React, { HTMLAttributes, useContext, useEffect, useState } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { Keymap, useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\nimport { useShortcuts } from \"./useShortcut\";\nimport {\n  ActionGroup,\n  ActionInResolvedGroup,\n  isActionGroup,\n  isActionGroupDefinition,\n  MutableActionGroup,\n} from \"./ActionGroup\";\nimport {\n  Action,\n  ActionContext,\n  ActionDefinition,\n  MutableAction,\n} from \"./Action\";\n\n/**\n * Represents the properties required for the ActionsProvider component.\n */\ninterface ActionsProviderProps {\n  /**\n   * A collection of action definitions.\n   */\n  actions: ActionDefinition[];\n  children: (args: {\n    shortcutHandlerProps: HTMLAttributes<HTMLElement>;\n  }) => React.ReactElement;\n\n  /**\n   * Experimental option to determine if event handling should be done on capture phase. Useful for cases where\n   * a descendant element handles events in capture phase, and that conflicts with an action.\n   */\n  useCapture?: boolean;\n}\n\nconst ActionsContext = React.createContext<Action[]>([]);\n\nfunction generateId() {\n  return `jui-${Math.floor(Math.random() * 10000000)}`;\n}\n\nconst ACTION_PROVIDER_ID_ATTRIBUTE = \"data-action-provider\";\nconst ACTION_PROVIDER_ID_DATA_PREFIX = \"action_provider_id_\";\nconst actionProvidersMap = new Map<string, Action[]>();\n\n/**\n * Provides a set of actions for the wrapped UI. Uses the currently provided keymap to find the shortcuts\n * for each action, and passes the necessary event handlers for the shortcuts, to the `children` render function.\n *\n * @param {Array<Action>} props.actions - The actions to be provided.\n * @param {boolean} [props.useCapture] - Specifies whether to use capture phase for event handling.\n * @param {Function} props.children - Render function that accepts shortcutHandlerProps as argument.\n */\nexport function ActionsProvider(props: ActionsProviderProps): JSX.Element {\n  const parentContext = useContext(ActionsContext);\n  const keymap = useKeymap();\n  const actions: Action[] = [];\n  dfsVisit(\n    (action: Action | null) =>\n      action && isActionGroup(action) ? action.children : null,\n    (action) => actions.push(action),\n    recursivelyCreateActions(keymap, props.actions)\n  );\n\n  const actionIds = actions.map((action) => action.id);\n  const shortcuts = pick(actionIds, keymap || {});\n  const [actionProviderId] = useState(generateId);\n\n  const { shortcutHandlerProps } = useShortcuts(\n    shortcuts,\n    (actionId, { event }) => {\n      actions\n        .find((action) => action.id === actionId)\n        ?.perform({\n          event,\n          // it's important to use target and not currentTarget\n          element: event.target instanceof Element ? event.target : null,\n        });\n    },\n    { useCapture: props.useCapture }\n  );\n\n  const allActions = [...parentContext, ...actions]; // Maybe warn overrides?\n\n  // @ts-expect-error: not sure why data-* attribute is not accepted.\n  shortcutHandlerProps[ACTION_PROVIDER_ID_ATTRIBUTE] = actionProviderId;\n  // @ts-expect-error: not sure why data-* attribute is not accepted.\n  shortcutHandlerProps[\n    `data-${ACTION_PROVIDER_ID_DATA_PREFIX}${actionProviderId}`\n  ] = \"\";\n\n  useEffect(() => {\n    actionProvidersMap.set(actionProviderId, allActions);\n  });\n  useEffect(() => {\n    return () => {\n      actionProvidersMap.delete(actionProviderId);\n    };\n  }, []);\n  return (\n    <ActionsContext.Provider value={allActions}>\n      {props.children({ shortcutHandlerProps })}\n    </ActionsContext.Provider>\n  );\n}\n\nfunction isMutableActionGroup(\n  action: MutableAction\n): action is MutableActionGroup {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: ActionDefinition[],\n  parent: ActionGroup\n): Array<ActionInResolvedGroup>;\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: ActionDefinition[]\n): Array<Action | ActionGroup>;\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: ActionDefinition[],\n  parent?: ActionGroup\n): Array<Action | ActionInResolvedGroup | ActionGroup> {\n  return actionDefinitions.map((actionDefinition: ActionDefinition): Action => {\n    const shortcuts =\n      keymap?.[actionDefinition.id] ??\n      (actionDefinition.useShortcutsOf\n        ? keymap?.[actionDefinition.useShortcutsOf]\n        : undefined);\n    const firstShortcut = shortcuts?.[0];\n    const action: MutableAction | ActionInResolvedGroup = {\n      ...actionDefinition,\n      ...(parent ? { parent } : {}),\n      shortcuts,\n      shortcut: firstShortcut ? shortcutToString(firstShortcut) : undefined, // Maybe it should be all shortcuts?\n      perform: (context) => {\n        if (!action.isDisabled) {\n          actionDefinition.actionPerformed(\n            context || { event: null, element: null }\n          );\n        }\n      },\n    };\n    if (\n      isMutableActionGroup(action) &&\n      isActionGroupDefinition(actionDefinition)\n    ) {\n      action.children = recursivelyCreateActions(\n        keymap,\n        actionDefinition.children,\n        action\n      );\n    }\n    return action;\n  });\n}\n\n/**\n * Experimental function to get list of all actions available from a given html elements. Useful for implementing\n * action search UI.\n * @experimental\n */\nexport function getAvailableActionsFor(element: Element): Action[] {\n  const closestActionProvider = element.closest(\n    `[${ACTION_PROVIDER_ID_ATTRIBUTE}]`\n  );\n  if (closestActionProvider instanceof HTMLElement) {\n    /**\n     * NOTE: initially, only one data attribute was used to hold the action provider id. Although simpler, that approach\n     * is subject to bug in some edge cases, where multiple nested action providers are rendered, but `actionProviderProps`\n     * is merged on a single dom element. In such cases, it's important that the props from the innermost action provider\n     * is merged last, overwriting other values for data-action-provider-id.\n     * Because that's error-prone, we keep unique data attributes (`data-action_provider_id_...`} for each action\n     * provider id, and to simplify querying part, we also add a constant data attribute (data-action-provider).\n     * This way we can read all action providers applied on the same dom element. Since action providers inherit actions\n     * from parent action providers, we can reliably pick the actions from the one with the highest number of actions.\n     */\n    const actionSets = Object.keys(closestActionProvider.dataset)\n      .filter((dataKey) => dataKey.startsWith(ACTION_PROVIDER_ID_DATA_PREFIX))\n      .map((dataKey) => {\n        const id = dataKey?.replace(ACTION_PROVIDER_ID_DATA_PREFIX, \"\");\n        const actions = id && actionProvidersMap.get(id);\n        return actions ? Object.values(actions) : [];\n      })\n      .concat();\n    return sortBy((actionSet) => -actionSet.length, actionSets)[0] || [];\n  }\n  return [];\n}\n\nexport function useActions(): Action[] {\n  return useContext(ActionsContext);\n}\n\nexport const useAction = (actionId: string): Action | null => {\n  return useActions().find(({ id }) => id === actionId) ?? null;\n};\n\nexport const usePerformAction = (): ((\n  actionId: string,\n  context?: ActionContext\n) => void) => {\n  const actions = useActions();\n  return useEventCallback((actionId: string, context?: ActionContext) => {\n    const action = actions.find(({ id }) => id === actionId);\n    if (action) {\n      action.perform(context);\n    } else {\n      console.error(\n        `An attempt to perform action with id ${actionId} failed because action was not found`\n      );\n    }\n  });\n};\n","export const CommonActionId = {\n  EXPAND_ALL: \"ExpandAll\",\n  COLLAPSE_ALL: \"CollapseAll\",\n  EXPAND_SELECTION: \"EditorSelectWord\",\n  SHRINK_SELECTION: \"EditorUnSelectWord\",\n  GO_TO_ACTION: \"GotoAction\",\n  GO_TO_FILE: \"GotoFile\",\n  SHOW_INTENTION_ACTIONS: \"ShowIntentionActions\",\n  EDIT_SOURCE: \"Documentation.EditSource\",\n  SHOW_SEARCH_HISTORY: \"ShowSearchHistory\",\n};\n","import React, { useContext } from \"react\";\nimport { Shortcut } from \"./Shortcut\";\nimport { defaultKeymap } from \"./defaultKeymap\";\n\nexport interface Keymap {\n  [actionId: string]: ReadonlyArray<Shortcut>;\n}\n\nexport const KeymapContext = React.createContext<Keymap | null>(defaultKeymap);\n\nexport const KeymapProvider: React.FC<{ keymap: Keymap }> = ({\n  keymap: keymapProp,\n  children,\n}) => {\n  const parentKeyMap = useContext(KeymapContext);\n  const keymap = Object.assign(Object.create(parentKeyMap), keymapProp);\n  return (\n    <KeymapContext.Provider value={keymap}>{children}</KeymapContext.Provider>\n  );\n};\n\nexport const useKeymap = () => useContext(KeymapContext);\n","type ShortcutType = \"mouse\" | \"keyboard\";\nexport type KeyStrokeModifier = \"Alt\" | \"Shift\" | \"Meta\" | \"Control\";\n\nexport interface KeyStroke {\n  /**\n   * {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key}\n   */\n  code: string;\n  modifiers?: Array<KeyStrokeModifier>;\n}\n\ninterface ShortcutBase {\n  type: ShortcutType;\n}\n\ninterface MouseShortcut extends ShortcutBase {\n  type: \"mouse\";\n}\n\nexport interface KeyboardShortcut extends ShortcutBase {\n  type: \"keyboard\";\n  firstKeyStroke: KeyStroke;\n  secondKeyStroke?: KeyStroke;\n}\n\nexport type Shortcut = MouseShortcut | KeyboardShortcut;\n\nexport const isKeyboardShortcut = (\n  shortcut: Shortcut\n): shortcut is KeyboardShortcut => shortcut.type === \"keyboard\";\n\nexport const supportedModifiers: KeyStrokeModifier[] = [\n  \"Alt\",\n  \"Meta\",\n  \"Shift\",\n  \"Control\",\n];\n","import React from \"react\";\nimport { useAction } from \"@intellij-platform/core/ActionSystem/ActionsProvider\";\nimport {\n  IconButton,\n  IconButtonProps,\n} from \"@intellij-platform/core/IconButton\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport const ActionButton = ({\n  actionId,\n  children,\n  ...otherProps\n}: {\n  actionId: string;\n  /**\n   * Content to show instead of `action.icon`.\n   */\n  children?: React.ReactNode;\n} & IconButtonProps): JSX.Element => {\n  const action = useAction(actionId);\n  if (!action) {\n    return <></>;\n  }\n  const actionButton = (\n    <IconButton\n      isDisabled={action.isDisabled}\n      {...otherProps}\n      onPress={(e) => {\n        action?.perform();\n        otherProps.onPress?.(e);\n      }}\n    >\n      {children || action.icon}\n    </IconButton>\n  );\n  if (action.title) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={action.title} shortcut={action.shortcut} />\n        }\n      >\n        {actionButton}\n      </TooltipTrigger>\n    );\n  }\n  return actionButton;\n};\n","import React from \"react\";\nimport { flatten } from \"ramda\";\nimport { Menu, MenuItemLayout } from \"@intellij-platform/core/Menu\";\nimport { Divider, Item, Section } from \"@intellij-platform/core/Collections\";\nimport { DividerItem } from \"@intellij-platform/core/Collections/Divider\"; // Importing from /Collections breaks the build for some reason\nimport { type ActionGroup } from \"@intellij-platform/core/ActionSystem/ActionGroup\";\nimport { type Action } from \"@intellij-platform/core/ActionSystem/Action\";\n\ntype ActionGroupAsMenuItem = Pick<\n  ActionGroup,\n  \"id\" | \"icon\" | \"title\" | \"isDisabled\" | \"children\" | \"isPopup\"\n>;\nexport type ActionItem = ActionGroupAsMenuItem | Action | DividerItem;\n\nfunction isAction(item: ActionItem): item is Action {\n  return \"perform\" in item;\n}\n\nexport type ActionMenuProps = {\n  selectedKeys?: string[];\n  menuProps?: React.HTMLAttributes<HTMLElement>;\n  actions: Array<ActionItem>;\n};\n\n/**\n * Given a nested list of resolved actions, renders a menu corresponding to them.\n */\nexport function ActionsMenu({\n  actions,\n  selectedKeys,\n  menuProps,\n}: ActionMenuProps) {\n  const allActions = getAllActions(actions);\n  const disabledKeys = allActions\n    .filter(({ isDisabled }) => isDisabled)\n    .map(({ id }) => id);\n\n  return (\n    <Menu\n      {...menuProps}\n      onAction={(key) => {\n        const action = allActions.find(({ id }) => id === key);\n        if (action && isAction(action)) {\n          action.perform(); // TODO: pass context, containing the menu item as `element`\n        }\n      }}\n      selectedKeys={selectedKeys} // FIXME: keep isSelected on actions (toggle action)?\n      disabledKeys={disabledKeys}\n      items={actions}\n      autoFocus\n    >\n      {(action) => {\n        if (action instanceof DividerItem) {\n          return <Divider />;\n        }\n        return renderActionAsMenuItem(action);\n      }}\n    </Menu>\n  );\n}\n\ntype ActionAsMenuItem = Omit<Action, \"perform\" | \"shortcuts\">;\n\nexport function renderActionAsMenuItem(\n  action: ActionAsMenuItem | ActionGroupAsMenuItem\n) {\n  const isGroup = \"children\" in action;\n  if (isGroup && !action.isPopup) {\n    return (\n      // `title` is intentionally not passed, as menu sections created from action groups usually don't have title.\n      // Maybe it should be an option?\n      // @ts-expect-error: hasDivider is not yet made a public API.\n      <Section key={action.id} hasDivider items={action.children}>\n        {renderActionAsMenuItem}\n      </Section>\n    );\n  }\n  return (\n    <Item\n      key={action.id}\n      textValue={action.title}\n      childItems={isGroup ? action.children : undefined}\n    >\n      <MenuItemLayout\n        content={action.title}\n        icon={action.icon}\n        shortcut={\"shortcut\" in action ? action.shortcut : undefined}\n      />\n    </Item>\n  );\n}\n\nfunction getAllActions(items: ActionItem[]): Action[] {\n  return flatten(\n    items.map((item) => (\"children\" in item ? item.children : item))\n  ).filter(isAction);\n}\n","import { flatten } from \"ramda\";\nimport React from \"react\";\nimport {\n  type ActionGroupDefinition,\n  isActionGroupDefinition,\n} from \"@intellij-platform/core/ActionSystem/ActionGroup\";\nimport { useGetActionShortcut } from \"@intellij-platform/core/ActionSystem/ActionShortcut\";\nimport { Popup, usePopupManager } from \"@intellij-platform/core/Popup\";\nimport { SpeedSearchMenu } from \"@intellij-platform/core/Menu\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { renderActionAsMenuItem } from \"./ActionsMenu\";\nimport { ActionContext } from \"@intellij-platform/core/ActionSystem/Action\";\n\nexport const useCreateDefaultActionGroup = () => {\n  const { show } = usePopupManager();\n  const getActionShortcut = useGetActionShortcut();\n  const openActionsInPopup = useEventCallback(\n    (\n      { children, title }: Pick<ActionGroupDefinition, \"children\" | \"title\">,\n      context: ActionContext\n    ) => {\n      show(({ close }) => (\n        <Popup>\n          <Popup.Layout\n            content={\n              /**\n               * NOTE: It would be much nicer to use {@link ActionGroupMenu} component here. But the action group is not\n               * yet provided when the group definition is being created. It seems like a sign of bad design that needs\n               * to get addressed.\n               */\n              <SpeedSearchMenu\n                aria-label={title}\n                items={children}\n                onAction={(key) => {\n                  // The need for calculating `allActions` is a consequence of the issue explained in the note above.\n                  const allActions = flatten(\n                    children.map((item) =>\n                      isActionGroupDefinition(item) ? item.children : item\n                    )\n                  );\n                  const action = allActions.find((action) => action.id === key);\n                  if (action && !action.isDisabled) {\n                    action.actionPerformed(context);\n                  }\n                }}\n                onClose={close}\n                autoFocus=\"first\"\n              >\n                {(item) =>\n                  renderActionAsMenuItem({\n                    ...item,\n                    // a consequence of the issue explained in the note above.\n                    shortcut: getActionShortcut(item.id),\n                  })\n                }\n              </SpeedSearchMenu>\n            }\n            header={title}\n          />\n        </Popup>\n      ));\n    }\n  );\n\n  return (\n    groupDefinition: Omit<ActionGroupDefinition, \"actionPerformed\">\n  ): ActionGroupDefinition => {\n    return {\n      isPopup: true,\n      ...groupDefinition,\n      actionPerformed: (context) =>\n        openActionsInPopup(groupDefinition, context),\n    };\n  };\n};\n","import {\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  // For some reason importing from shorter paths doesn't work as expected in cypress \\_()_/\n  // Weirdly, `import *` works in that case.\n} from \"@intellij-platform/core/ToolWindowsImpl/ToolWindowActionIds\";\n\nimport { Keymap } from \"./KeymapProvider\";\nimport { CommonActionId } from \"./CommonActionIds\";\n\n// TODO: OS specific defaults\n// TODO: extract and export action ids\n// NOTE: defaultKeymap doesn't belong to ActionSystem semantically. Would be something to be moved to a separate module\n/**\n * Default Intellij Idea keymapping for common action ids, including tool window actions.\n * @see CommonActionId\n */\nexport const defaultKeymap: Keymap = {\n  [RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowRight\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_LEFT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowLeft\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_TOP_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowUp\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowDown\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [MAXIMIZE_TOOL_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Quote\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [FOCUS_EDITOR_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n      },\n    },\n  ],\n  [HIDE_ACTIVE_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n        modifiers: [\"Shift\"],\n      },\n    },\n  ],\n  [HIDE_ALL_WINDOWS_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [JUMP_TO_LAST_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowUp\",\n      },\n    },\n  ],\n  [CommonActionId.SHRINK_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n  ],\n  [CommonActionId.COLLAPSE_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [CommonActionId.GO_TO_ACTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [CommonActionId.SHOW_INTENTION_ACTIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"Enter\",\n      },\n    },\n  ],\n  [CommonActionId.GO_TO_FILE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyO\",\n      },\n    },\n  ],\n  [CommonActionId.EDIT_SOURCE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"ArrowDown\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F4\",\n      },\n    },\n  ],\n\n  [CommonActionId.SHOW_SEARCH_HISTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n};\n","import { fromPairs } from \"ramda\";\nimport { isMac } from \"@react-aria/utils\";\nimport {\n  isKeyboardShortcut,\n  KeyStroke,\n  KeyStrokeModifier,\n  Shortcut,\n} from \"./Shortcut\";\nimport {\n  KeyboardEventKey,\n  LinuxDeadKeys,\n  NumericKeypadKeys,\n  UpperAlpha,\n} from \"./KeyboardEventKey\";\n\nconst defaultKeyToStr: {\n  [key in Exclude<\n    KeyStrokeModifier | KeyboardEventKey,\n    LinuxDeadKeys | UpperAlpha | NumericKeypadKeys\n  >]: string;\n} = {\n  Control: \"Ctrl\",\n  \" \": \"Space\",\n  ArrowDown: \"\",\n  ArrowUp: \"\",\n  ArrowLeft: \"\",\n  ArrowRight: \"\",\n  Enter: \"\",\n  Quote: \"'\",\n  Minus: \"-\",\n  Equal: \"+\",\n  Backspace: \"\",\n  // lowercase to uppercase map\n  ...fromPairs(\n    Array.from(Array(26))\n      .map((e, i) => i + \"a\".charCodeAt(0))\n      .map((x) => String.fromCharCode(x))\n      .map((a) => [a, a.toUpperCase()])\n  ),\n};\nconst KeystrokeToString: {\n  separator: string;\n  codeToStr: Record<KeyStrokeModifier | KeyboardEventKey, string>;\n} = isMac()\n  ? {\n      separator: \"\",\n      codeToStr: {\n        ...defaultKeyToStr,\n        Alt: \"\",\n        Shift: \"\",\n        Meta: \"\",\n        Control: \"^\",\n        Escape: \"\",\n      },\n    }\n  : {\n      separator: \"+\",\n      codeToStr: defaultKeyToStr,\n    };\n\nconst modifiersOrder: KeyStrokeModifier[] = [\"Control\", \"Alt\", \"Shift\", \"Meta\"];\nexport const keystrokeToString = (keystroke: KeyStroke) => {\n  return [\n    ...(keystroke.modifiers || []).sort(\n      (a, b) => modifiersOrder.indexOf(a) - modifiersOrder.indexOf(b)\n    ),\n    keystroke.code,\n  ]\n    .map((code) => KeystrokeToString.codeToStr[code] || code)\n    .map((code) => code.replace(/^(Key|Digit|Numpad)(.)$/, \"$2\"))\n    .join(KeystrokeToString.separator);\n};\nexport const shortcutToString = (shortcut: Shortcut) => {\n  if (isKeyboardShortcut(shortcut)) {\n    return [shortcut.firstKeyStroke, shortcut.secondKeyStroke]\n      .filter((i): i is KeyStroke => i != undefined)\n      .map(keystrokeToString)\n      .join(\", \");\n  }\n  throw new Error(\"Not implemented yet\");\n};\n","import { useAction } from \"./ActionsProvider\";\nimport { isResolvedActionGroup, ResolvedActionGroup } from \"./ActionGroup\";\n\nexport const useActionGroup = (\n  actionGroupId: string\n): ResolvedActionGroup | null => {\n  const action = useAction(actionGroupId);\n  if (action) {\n    if (isResolvedActionGroup(action)) {\n      return action;\n    }\n    throw new Error(`Action with id ${actionGroupId} is not a group`);\n  }\n  return null;\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nconst CORNER_RADIUS = 12; // it used to be 8. After introduction of Notifications tool window, it's 12\n\nconst bgColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\n    \"Notification.background\",\n    !theme.dark ? \"rgb(242,242,242)\" : \"#4E5052\"\n  );\n\nexport const StyledHeaderActions = styled.div`\n  position: absolute;\n  right: 0;\n  top: 0;\n  background: inherit;\n  padding: 0.375rem 0.5rem 0;\n  &::before {\n    content: \"\";\n    position: absolute;\n    right: 100%;\n    background: linear-gradient(90deg, transparent, ${bgColor});\n    width: 20px;\n    height: 100%;\n    z-index: 1;\n    top: 0;\n  }\n`;\n\nexport const StyledBalloonContainer = styled.div`\n  line-height: 1.2;\n  box-sizing: border-box;\n  overflow: hidden; // header actions overflows a little at the top right rounded corner\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); // shadow doesn't seem to be themed\n  padding: 0.5rem 0;\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"Notification.borderColor\",\n        !theme.dark ? \"#B2B2B2CD\" : \"#565A5CCD\"\n      )};\n  border-radius: ${({ theme }) =>\n    `${\n      (theme.value<number>(\n        \"Notification.arc\" as UnknownThemeProp<\"Notification.arc\">\n      ) ?? CORNER_RADIUS) / 2\n    }px`};\n  //display: inline-flex;\n  width: 23.3125rem;\n  position: relative;\n  background-color: ${bgColor};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Notification.foreground\",\n      !theme.dark ? \"#000\" : \"rgb(191,191,191)\"\n    )};\n\n  ${StyledHeaderActions} {\n    display: none;\n  }\n  &:hover ${StyledHeaderActions} {\n    display: initial;\n  }\n`;\n\nexport const StyledIconContainer = styled.span`\n  position: absolute;\n  left: 0.75rem;\n  top: 0.5rem;\n`;\n\nexport const StyledBalloonHeader = styled.div`\n  line-height: 1rem;\n  font-weight: bold;\n  margin: 0 2.125rem 0.25rem;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis; // this is not the case in original impl, but it's a clear improvement\n`;\n\nexport const StyledBalloonBody = styled.div<{\n  lineClamp: number | false;\n}>`\n  margin: 0 2.125rem 0 2.125rem;\n  line-height: 1rem;\n  display: inline;\n  -webkit-line-clamp: ${({ lineClamp }) => lineClamp};\n  word-break: ${({ lineClamp }) => lineClamp === 1 && \"break-all\"};\n  text-overflow: ellipsis;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  word-wrap: break-word;\n`;\n\nexport const StyledBalloonFooter = styled.div`\n  margin: 0.375rem 1.875rem 0 2.125rem;\n  display: inline-flex;\n  white-space: nowrap;\n  overflow: hidden;\n  gap: 1rem;\n\n  // could be -webkit-fill-available too, if it has good support. Probably it doesn't tho\n  max-width: calc(100% - 3.5rem);\n`;\n\nexport const StyledToggleIconContainer = styled.span`\n  display: inline-flex;\n  position: absolute;\n  right: 0.5rem;\n  bottom: 0;\n  background-color: ${bgColor};\n  padding-left: 0.5rem;\n`;\n\nexport const StyledToggleExpandButtonContainer = styled.span`\n  display: block;\n  position: relative; // for icon absolute positioning\n  cursor: pointer;\n  flex: 1;\n`;\n\nexport const StyledToggleExpandButtonFooterContainer = styled(\n  StyledToggleExpandButtonContainer\n)`\n  min-height: 1.5rem;\n  margin: -0.5rem 0;\n  position: relative;\n  z-index: 1;\n  ${StyledToggleIconContainer} {\n    bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter} {\n    margin-top: 0.875rem;\n    margin-bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter}:hover + * .icon[data-hover] {\n    display: none;\n  }\n  ${StyledBalloonFooter}:hover + * .icon {\n    display: unset;\n  }\n`;\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\nimport { IconProps } from \"@intellij-platform/core/Icon/IconProps\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  StyledBalloonBody,\n  StyledBalloonContainer,\n  StyledBalloonFooter,\n  StyledBalloonHeader,\n  StyledHeaderActions,\n  StyledIconContainer,\n  StyledToggleExpandButtonContainer,\n  StyledToggleExpandButtonFooterContainer,\n  StyledToggleIconContainer,\n} from \"@intellij-platform/core/Balloon/Balloon.styled\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { Link } from \"@intellij-platform/core/Link\";\n\nexport type BalloonProps = ControlledStateProps<{ expanded: boolean }> &\n  DOMProps & {\n    /**\n     * Icon rendered in the top left\n     */\n    icon?: \"Info\" | \"Warning\" | \"Error\" | React.ReactElement<IconProps>;\n    /**\n     * Rendered beside close button. Can be used for rendering a \"notification settings\" icon button.\n     */\n    headerActions?: React.ReactNode;\n    /**\n     * Called when the close button is clicked. If not passed, close button will not be rendered.\n     */\n    onClose?: () => void;\n    /**\n     * Actions rendered in the footer.\n     */\n    actions?: React.ReactNode;\n  } & (\n    | {\n        title?: React.ReactNode;\n        body: React.ReactNode;\n      }\n    | {\n        title: React.ReactNode;\n        body?: React.ReactNode;\n      }\n  );\n\ntype BalloonContextObj = {\n  onClose?: () => void;\n};\nconst BalloonContext = React.createContext<BalloonContextObj | null>(null);\n\n/**\n * A tiny wrapper around {@link Link} component, to be used for actions in Balloon.\n * It closes the balloon when pressed.\n */\nexport const BalloonActionLink: typeof Link = React.forwardRef(\n  ({ onPress, ...props }, ref) => {\n    const context = useContext(BalloonContext);\n    if (context === null) {\n      throw new Error(\n        \"BalloonActionLink should only be rendered inside Balloon notifications\"\n      );\n    }\n    return (\n      <Link\n        ref={ref}\n        {...props}\n        onPress={(...args) => {\n          context?.onClose?.();\n          return onPress?.(...args);\n        }}\n      />\n    );\n  }\n);\n/**\n * [Balloon notification](https://jetbrains.github.io/ui/controls/balloon/) UI.\n *\n * Notes and TODO:\n * - Add support for \"error\" variant: https://github.com/JetBrains/intellij-community/blob/48c024fcd38bd8d1eccdada05489a8952a494270/platform/platform-impl/src/com/intellij/diagnostic/IdeMessagePanel.java#L215\n * - Add support for timeout. Although if the auto close behaviour is only timeout-based, maybe there is not much value in adding a prop for it and calling onClose on timeout.\n * - BalloonActions component to be used for rendering a bunch of links in the actions. It should encapsulate the\n *   behaviour of moving actions into a menu when there is not enough room.\n */\nexport const Balloon = ({\n  icon: iconProp = \"Info\",\n  expanded: expandedProp,\n  defaultExpanded = false,\n  onExpandedChange,\n  title,\n  headerActions,\n  onClose,\n  body,\n  actions,\n  ...containerProps\n}: BalloonProps): React.ReactElement => {\n  const bodyRef = useRef<HTMLDivElement>(null);\n  const [expandable, setExpandable] = useState(false);\n  const [expanded, setExpanded] = useControlledState(\n    expandedProp!,\n    defaultExpanded,\n    onExpandedChange!\n  );\n  const maxLinesWhenNotExpanded = 1 + (title ? 0 : 1) + (actions ? 0 : 1);\n\n  useEffect(() => {\n    const bodyElem = bodyRef.current;\n    if (bodyElem) {\n      setExpandable(\n        expanded\n          ? getNumLines(bodyElem) > maxLinesWhenNotExpanded\n          : bodyElem.scrollHeight > bodyElem.clientHeight\n      );\n    } else {\n      setExpandable(false);\n    }\n  }, [expanded]);\n  const validIconTypes = [\"Error\", \"Warning\", \"Info\"] as const;\n  const icon =\n    typeof iconProp === \"string\" ? (\n      <PlatformIcon\n        icon={`general/notification${validIconTypes.find(\n          (iconType, index, arr) =>\n            iconType === iconProp || index === arr.length - 1\n        )}.svg`}\n      />\n    ) : (\n      iconProp\n    );\n  // @ts-expect-error support for callback updater is removed from useControlledState. https://github.com/adobe/react-spectrum/issues/2320\n  const toggle = () => setExpanded((expanded) => !expanded);\n\n  const effectiveExpanded = expanded && Boolean(body);\n\n  return (\n    <BalloonContext.Provider value={{ onClose }}>\n      <StyledBalloonContainer data-testid=\"balloon\" {...containerProps}>\n        <StyledIconContainer>{icon}</StyledIconContainer>\n        {title && <StyledBalloonHeader>{title}</StyledBalloonHeader>}\n        <StyledHeaderActions>\n          {headerActions}\n          {onClose && (\n            <AutoHoverPlatformIcon\n              icon=\"ide/notification/close.svg\"\n              onClick={onClose}\n              role=\"button\"\n              data-testid=\"close-btn\"\n              style={{ marginLeft: \"0.75rem\" }}\n            />\n          )}\n        </StyledHeaderActions>\n        {body && (\n          <ToggleWrapper\n            expanded={effectiveExpanded}\n            enabled={expandable && !effectiveExpanded}\n            onToggle={toggle}\n          >\n            <StyledBalloonBody\n              lineClamp={!effectiveExpanded && maxLinesWhenNotExpanded}\n              ref={bodyRef}\n            >\n              {body}\n            </StyledBalloonBody>\n          </ToggleWrapper>\n        )}\n        <ToggleWrapper\n          expanded={effectiveExpanded}\n          enabled={expandable && effectiveExpanded}\n          onToggle={toggle}\n          Component={StyledToggleExpandButtonFooterContainer}\n        >\n          {actions && (\n            <StyledBalloonFooter onClick={(e) => e.stopPropagation()}>\n              {actions}\n            </StyledBalloonFooter>\n          )}\n        </ToggleWrapper>\n      </StyledBalloonContainer>\n    </BalloonContext.Provider>\n  );\n};\n\n/**\n * If enabled wraps its children in a clickable area (with the expand/collapse arrow),f for toggling expanded state.\n */\nconst ToggleWrapper: React.FC<{\n  enabled: boolean;\n  expanded: boolean;\n  Component?: typeof StyledToggleExpandButtonContainer;\n  onToggle: () => void;\n}> = ({\n  children,\n  onToggle,\n  expanded,\n  enabled,\n  Component = StyledToggleExpandButtonContainer,\n}) => {\n  const iconName = expanded ? \"collapse\" : \"expand\";\n  const toggleIcon = (\n    <StyledToggleIconContainer>\n      <AutoHoverPlatformIcon\n        hoverContainerSelector={`${Component}`}\n        icon={`ide/notification/${iconName}.svg`}\n        className=\"icon\"\n      />\n    </StyledToggleIconContainer>\n  );\n\n  return enabled ? (\n    <Component\n      onClick={onToggle}\n      role=\"button\"\n      data-testid={`${expanded ? \"collapse\" : \"expand\"}-btn`}\n    >\n      {children}\n      {toggleIcon}\n    </Component>\n  ) : (\n    <>{children}</>\n  );\n};\n\n/**\n * Based on the computed line-height and clientHeight of the element, returns the number of lines of the content.\n */\nfunction getNumLines(bodyElem: Element) {\n  return (\n    bodyElem.clientHeight / parseFloat(getComputedStyle(bodyElem).lineHeight)\n  );\n}\n","import React, {\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Balloon, BalloonProps } from \"./Balloon\";\nimport { StyledBalloonsStack } from \"./StyledBalloonsStack\";\n\ntype ShowProps = Pick<\n  BalloonProps,\n  \"title\" | \"icon\" | \"body\" | \"actions\" | \"headerActions\"\n>;\n\nexport interface BalloonManagerAPI {\n  /**\n   * Shows a Balloon notification on the bottom left of the screen.\n   * @param props: Props to pass to the Balloon component\n   * @param [autoHideTimeout=10_000] timeout in ms for hiding the balloon notification.\n   * @returns hide function, in case the notification can expire for some reason.\n   */\n  show(props: ShowProps, autoHideTimeout?: number): () => void;\n  showSticky(props: ShowProps): () => void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\"You must render a BalloonManager...\");\n};\n\nconst BalloonsContext = React.createContext<BalloonManagerAPI>({\n  show: NotImplementedFn,\n  showSticky: NotImplementedFn,\n});\n\nexport const useBalloonManager = (): BalloonManagerAPI =>\n  useContext(BalloonsContext);\n\ntype BalloonElement = ReactElement<BalloonProps, typeof Balloon>;\n\nexport interface BalloonManagerProps {\n  disablePortal?: boolean;\n  BalloonsContainer?: React.ElementType;\n}\n\n/**\n * Enables imperative API (via {@link useBalloonManager}) for showing Balloon notifications on the bottom right of the screen.\n * It renders notifications in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n * @param disablePortal: if `true`, the container for notifications will not be rendered in a portal\n * @param BalloonsContainer: container component for the notifications. It's {@link StyledBalloonsStack} by default.\n *\n * TODO: fade in/out transition. Notes:\n *  - Doesn't seem fade-in is needed. Tho it's much easier than fade-out, as it can be achieved with a css animation.\n *  - Fade out should happen only when the balloon is being hidden by timeout.\n * TODO: Support for maximum number of notifications and showing \"x more notification(s)\" button if the limit exceeds\n */\n\nexport const BalloonManager: React.FC<BalloonManagerProps> = ({\n  children,\n  disablePortal,\n  BalloonsContainer = StyledBalloonsStack,\n}) => {\n  const [balloons, setBalloons] = useState<Array<BalloonElement>>([]);\n  const timeoutIdsRef = useRef<number[]>([]);\n  const lastIdRef = useRef<number>(0);\n\n  const api = useMemo<BalloonManagerAPI>(() => {\n    const show: BalloonManagerAPI[\"show\"] = (props, timeout = 10_000) => {\n      lastIdRef.current++;\n      const onClose = () => {\n        setBalloons((balloons) =>\n          balloons.filter((aBalloon) => aBalloon !== balloon)\n        );\n      };\n      const balloon = (\n        <Balloon\n          key={lastIdRef.current}\n          {...props}\n          title={props.title} // TS acts unreasonable without this\n          onClose={onClose}\n        />\n      );\n      setBalloons((balloons) => {\n        if (timeout > 0) {\n          const timeoutId = window.setTimeout(() => {\n            onClose();\n            timeoutIdsRef.current = timeoutIdsRef.current.filter(\n              (aTimeoutId) => aTimeoutId !== timeoutId\n            );\n          }, timeout);\n          timeoutIdsRef.current = [...timeoutIdsRef.current, timeoutId];\n        }\n        return balloons.concat(balloon);\n      });\n      return onClose;\n    };\n    return {\n      show,\n      showSticky: (props) => show(props, 0),\n    };\n  }, []);\n\n  // clear timeouts when unmounted\n  useEffect(() => {\n    return () => {\n      timeoutIdsRef.current.forEach((id) => {\n        window.clearTimeout(id);\n      });\n    };\n  }, []);\n\n  const notificationsStack = (\n    <BalloonsContainer\n      style={{ position: disablePortal ? \"absolute\" : undefined }}\n    >\n      {balloons}\n    </BalloonsContainer>\n  );\n\n  return (\n    <BalloonsContext.Provider value={api}>\n      {children}\n      {disablePortal\n        ? notificationsStack\n        : ReactDOM.createPortal(notificationsStack, document.body)}\n    </BalloonsContext.Provider>\n  );\n};\n","import styled from \"styled-components\";\nimport { StyledBalloonContainer } from \"@intellij-platform/core/Balloon/Balloon.styled\";\n\n/**\n * Container component for stacking a number of Balloons in an overlay placed on the bottom right of where it's rendered.\n */\nexport const StyledBalloonsStack = styled.div`\n  position: fixed;\n  z-index: 1;\n  bottom: 42px;\n  right: 26px;\n  ${StyledBalloonContainer} {\n    margin-bottom: 12px;\n  }\n`;\n","import React, { ForwardedRef, JSXElementConstructor } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { AriaBaseButtonProps, ButtonProps } from \"@react-types/button\";\n\nexport interface BareButtonProps extends AriaBaseButtonProps, ButtonProps {\n  children: React.ReactElement;\n\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n}\n\n/**\n * A component to make arbitrary content an accessible button which is also able to be a tooltip trigger.\n */\nexport const BareButton: React.FC<BareButtonProps> = React.forwardRef(\n  function BareButton(props: BareButtonProps, ref: ForwardedRef<HTMLElement>) {\n    const elementType = React.isValidElement(props.children)\n      ? (props.children.type as JSXElementConstructor<unknown>)\n      : undefined;\n    const { buttonProps } = useButton(\n      {\n        elementType,\n        ...props,\n      },\n      useObjectRef(ref)\n    );\n    const domProps = filterDOMProps(props);\n    const { autoFocus } = props;\n\n    return React.cloneElement(\n      props.children,\n      mergeProps(domProps, buttonProps, { autoFocus, ref })\n    );\n  }\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport const StyledButton = styled.button<{ disabled?: boolean }>`\n  box-sizing: border-box;\n  min-width: 4.5rem; // https://jetbrains.github.io/ui/controls/button/#28\n  padding: 0 0.875rem; // https://jetbrains.github.io/ui/controls/button/#28\n  height: 1.5rem;\n  font-family: inherit;\n  background-color: ${({ theme, disabled }) =>\n    disabled ? \"transparent\" : theme.color(\"Button.startBackground\")};\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"Button.disabledText\")\n      : theme.color(\n          \"Button.foreground\" as UnknownThemeProp<\"Button.foreground\">\n        )};\n  border: 1px solid\n    ${({ theme, disabled }) =>\n      disabled\n        ? theme.color(\"Button.disabledBorderColor\")\n        : theme.color(\"Button.startBorderColor\")};\n  border-radius: ${({ theme }) =>\n    (theme.value<number>(\"Button.arc\") ?? 6) / 2}px;\n  box-shadow: ${({ theme }) =>\n    theme.value(\"Button.paintShadow\")\n      ? `0 0 0 ${theme.value(\"Button.shadowWidth\") ?? 2}px ${\n          theme.color(\"Button.shadowColor\") ?? // Button.darcula.shadowColor default is skipped.\n          (theme.dark ? \"#36363680\" : \"#a6a6a633\")\n        }`\n      : \"\"};\n  white-space: nowrap; // https://jetbrains.github.io/ui/controls/button/#29\n\n  flex-shrink: 0; // button should not shrink when rendered in a flex container\n\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.focusedBorderColor\", \"#87afda\")};\n    outline: none;\n    box-shadow: ${({ theme }) =>\n      `0 0 0 2px ${\n        // NOTE: by not using the second argument for default value, we prioritize *.focusColor over the rest.\n        theme.color(\"Component.focusColor\") ??\n        theme.color(\n          \"Focus.borderColor\" as UnknownThemeProp<\"Focus.borderColor\">,\n          \"#8ab2eb\"\n        )\n      }`};\n  }\n`;\nexport const StyledDefaultButton = styled(StyledButton)`\n  background-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBackground\", \"#384f6b\")};\n  color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.foreground\")};\n  border-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBorderColor\", \"#BFBFBF\")};\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.default.focusedBorderColor\", \"#87afda\")};\n  }\n`;\n\nexport const StyledIconButton = styled(StyledButton)`\n  border-radius: 1000px;\n  padding: 0;\n  line-height: 0;\n  min-width: 0;\n  height: 1.5rem;\n  width: 1.5rem;\n`;\n","import React, { ButtonHTMLAttributes, ForwardedRef } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { AriaButtonProps } from \"@react-types/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  StyledButton,\n  StyledDefaultButton,\n  StyledIconButton,\n} from \"@intellij-platform/core/Button/StyledButton\";\n\ntype ButtonVariant = \"default\" | \"icon\";\nexport interface ButtonProps extends AriaButtonProps {\n  variant?: ButtonVariant; // can allow for custom (styled) component too if needed.\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  // Should this be become true by default? Maybe an context-based API to set defaults like this for a section?\n  preventFocusOnPress?: boolean;\n\n  form?: ButtonHTMLAttributes<HTMLButtonElement>[\"form\"];\n}\n\nconst variants: { [key in ButtonVariant]: typeof StyledButton } = {\n  default: StyledDefaultButton,\n  icon: StyledIconButton,\n};\n\n/**\n * https://jetbrains.github.io/ui/controls/button/\n *\n * TODO:\n * - Support for \"default\" button behaviour. it's kind of similar to a <button type=\"submit\" /> in html, but textarea\n * behaviour is different from what is explained here: https://jetbrains.github.io/ui/controls/button/#16\n * Cmd+Enter should always trigger onPress. Plus, maybe it should work independent of \"form\" being used? or maybe it's\n * not a big deal to expect an ancestor \"form\" element, when variant is \"default\"?\n * - Support for mnemonic\n * - \"Default\" style differences in Windows.\n * - Gradient colors (low hanging fruit, but negligible added value).\n *\n * Known issues:\n * - In the original impl, default button looks the same as normal button, when focus is not within the same area that\n * the button is. For example in the commit tool window, \"Commit\" button which is default, is not blue, unless the\n * \"Commit\" tool window is focused. This particular case can easily be achieved by conditionally setting variant to,\n * \"default\" based on tool window focus state, which is accessible via useDefaultToolWindowContext(), if\n * DefaultToolWindow is used. But we need to see if the same requirement exists in various places.\n * NOTE: this item is related to the first item in the to-do list above. There can be a container kind of component,\n * which enables \"default\" behaviour and look. Maybe it can be FocusScope or at least related to FocusScope.\n * - In the original impl, there is no visual clue for pressed state, which is poor accessibility. For now, the same\n * behaviour is followed here too. But we may reconsider deviating from the original impl for an improvement here.\n *\n */\nexport const Button: React.FC<ButtonProps> = React.forwardRef(function Button(\n  { variant, ...props }: ButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const { buttonProps } = useButton(props, ref);\n  const domProps = filterDOMProps(props);\n  const { autoFocus, form } = props;\n\n  const Component = (variant && variants[variant]) || StyledButton;\n  return (\n    <Component\n      {...mergeProps(domProps, buttonProps, { autoFocus, form })}\n      ref={ref}\n    >\n      {props.children}\n    </Component>\n  );\n});\n","import React, { HTMLProps, ReactNode } from \"react\";\nimport { useToggleState } from \"@react-stately/toggle\";\nimport { useCheckbox } from \"@react-aria/checkbox\";\nimport {\n  AriaLabelingProps,\n  FocusableDOMProps,\n  FocusableProps,\n  InputBase,\n} from \"@react-types/shared\";\nimport { useFocusRing } from \"@react-aria/focus\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { CheckboxIcon } from \"./CheckboxIcon\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface CheckboxProps\n  extends InputBase,\n    FocusableDOMProps,\n    AriaLabelingProps,\n    FocusableProps {\n  /**\n   * If set to true, the checkbox won't be focusable.\n   * Common use cases:\n   * - When checkbox is rendered in a focusable container, like a list item where the focus should not be taken away\n   *   from that container.\n   * - \"Amend\" checkbox in \"Commit\" tool window. The focus is kept in the commit message or changes tree, perhaps, for\n   *   a questionably better UX.\n   * Note: Passing {@link excludeFromTabOrder} will still let the checkbox be focusable, while `preventFocus`, doesn't\n   * let the component get focused at all.\n   * TODO(potential): it might be nicer to have a `preventFocusOnPress` prop consistent with IconButton, instead.\n   *  In that case preventing focus completely would be achieved with `preventFocusOnPres` and `excludeFromTabOrder`.\n   */\n  preventFocus?: boolean;\n\n  /**\n   * By default, focus ring is always shown when the checkbox is focused, independent of the interaction method.\n   * if set to false, the focus will be only visible if the interaction is done via keyboard or screen readers.\n   * Similar to how [:focus-visible](https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible) works.\n   */\n  disableFocusAlwaysVisible?: boolean;\n\n  /**\n   * Indeterminism is presentational only.\n   * The indeterminate visual representation remains regardless of user interaction.\n   */\n  isIndeterminate?: boolean;\n\n  /**\n   * The label for the element.\n   */\n  children?: ReactNode;\n\n  /**\n   * Whether the element should be selected (uncontrolled).\n   */\n  defaultSelected?: boolean;\n  /**\n   * Whether the element should be selected (controlled).\n   */\n  isSelected?: boolean;\n  /**\n   * Handler that is called when the element's selection state changes.\n   */\n  onChange?: (isSelected: boolean) => void;\n  /**\n   * The value of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefvalue).\n   */\n  value?: string;\n  /**\n   * The name of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefname).\n   */\n  name?: string;\n\n  className?: string; // to support styled-components\n}\n\nconst StyledWrapperLabel = styled.label`\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst StyledCheckboxLabelText = styled.span<{\n  isDisabled: boolean | undefined;\n}>`\n  margin-left: 0.25rem;\n  color: ${({ theme, isDisabled }) =>\n    isDisabled\n      ? theme.color(\n          \"CheckBox.disabledText\" as UnknownThemeProp<\"CheckBox.disabledText\">,\n          \"#808080\" /* this default value was a bit tricky. Still not clear from where it comes in darcular \n          theme when there is no clue of Checkbox.disabledText or *.disabledText. Note that using \n          CheckBox.disabledForeground is not a good option, because it's something other than #808080 for darcula */\n        )\n      : theme.color(\"*.foreground\")};\n`;\n\nconst StyledInput = styled.input`\n  opacity: 0.0001;\n  position: absolute;\n  z-index: 1;\n  inset: 0;\n  cursor: default;\n  &:disabled {\n    cursor: default;\n  }\n`;\n\n/**\n * Checkbox component to be used with or without a label.\n *\n * While the checkbox without the label + preventFocus makes it usable in tree/list, it might be more optimized to\n * use a more lightweight component like ListItemCheckbox, which uses CheckboxIcon with a simple press handle. Without\n * any input, state, etc.\n */\nexport const Checkbox = ({\n  preventFocus,\n  className,\n  disableFocusAlwaysVisible,\n  ...props\n}: CheckboxProps) => {\n  const state = useToggleState(props);\n  const ref = React.useRef<HTMLInputElement>(null);\n  const { inputProps } = useCheckbox(props, state, ref);\n\n  const { isFocusVisible, isFocused, focusProps } = useFocusRing({\n    autoFocus: props.autoFocus,\n  });\n\n  const focusDisabledProps: Pick<\n    HTMLProps<HTMLInputElement>,\n    \"onFocusCapture\" | \"tabIndex\"\n  > = preventFocus\n    ? {\n        onFocusCapture: (event) => {\n          event.stopPropagation();\n          event.preventDefault();\n          if (event.relatedTarget instanceof HTMLElement) {\n            event.relatedTarget.focus();\n          } else {\n            event.target.blur();\n          }\n        },\n        tabIndex: -1,\n      }\n    : {};\n\n  return (\n    <StyledWrapperLabel className={className}>\n      <StyledInput\n        {...mergeProps(inputProps, focusProps, focusDisabledProps)}\n        ref={ref}\n      />\n      <CheckboxIcon\n        isIndeterminate={props.isIndeterminate}\n        isFocused={disableFocusAlwaysVisible ? isFocusVisible : isFocused}\n        isSelected={props.isIndeterminate || state.isSelected}\n        isDisabled={props.isDisabled}\n        aria-hidden=\"true\"\n        style={{\n          pointerEvents: \"none\",\n        }}\n      />\n      {props.children && (\n        <StyledCheckboxLabelText isDisabled={props.isDisabled}>\n          {props.children}\n        </StyledCheckboxLabelText>\n      )}\n    </StyledWrapperLabel>\n  );\n};\n","import React, { ComponentProps } from \"react\";\nimport { LafIcon } from \"@intellij-platform/core/Icon\";\n\n/**\n * Renders checkbox UI in different states (focused, selected, indeterminate, etc.), without having anything to do\n * with the interactions\n */\nexport const CheckboxIcon = ({\n  isDisabled,\n  isFocused,\n  isIndeterminate,\n  isSelected,\n  ...otherProps\n}: Omit<ComponentProps<typeof LafIcon>, \"size\" | \"icon\"> & {\n  isIndeterminate: boolean | undefined;\n  isFocused: boolean;\n  isDisabled: boolean | undefined;\n  isSelected: boolean;\n}) => {\n  return (\n    <LafIcon\n      {...otherProps}\n      size={20}\n      icon={{\n        name: isIndeterminate ? \"checkBoxIndeterminate\" : \"checkBox\",\n        modifiers: {\n          Disabled: isDisabled,\n          Selected: isSelected || isIndeterminate,\n          Focused: isFocused,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { CollectionSpeedSearchMatches } from \"./useCollectionSpeedSearchResult\";\n\nexport type CollectionSpeedSearchContextValue = {\n  matches: CollectionSpeedSearchMatches;\n  collection: Collection<Node<unknown>>;\n};\n\nexport const CollectionSpeedSearchContext =\n  React.createContext<CollectionSpeedSearchContextValue | null>(null);\n","import React, { Key, useContext } from \"react\";\nimport { TextWithHighlights } from \"@intellij-platform/core/TextWithHighlights/TextWithHighlights\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch/CollectionSpeedSearchContext\";\n\ntype CollectionSpeedSearchItemContextValue = {\n  text: string;\n  highlightedRanges: null | TextRange[];\n};\n\nconst CollectionSpeedSearchItemContext =\n  React.createContext<null | CollectionSpeedSearchItemContextValue>(null);\n\nexport const SpeedSearchItemHighlightsProvider: React.FC<{ itemKey: Key }> = ({\n  children,\n  itemKey,\n}) => {\n  const context = useContext(CollectionSpeedSearchContext);\n  if (!context) {\n    throw new Error(\n      `SpeedSearchItemProvider is only meant to be rendered by collection components with speed search. \n      CollectionSpeedSearchContext is expected to be rendered as a wrapper around all items.`\n    );\n  }\n  const item = context.collection.getItem(itemKey);\n  const text = item?.textValue;\n  if (!text && item?.props.textValue === undefined) {\n    console.warn(\n      \"no textValue specified on Item. When using SpeedSearch, you need to specify textValue for item, which will be the basis for search\"\n    );\n  }\n  return (\n    <CollectionSpeedSearchItemContext.Provider\n      value={{\n        highlightedRanges: context.matches.get(itemKey) || null,\n        text: text,\n      }}\n    >\n      {children}\n    </CollectionSpeedSearchItemContext.Provider>\n  );\n};\n\n/**\n * Used inside Item content, to render the textValue of the Item, potentially with highlighted ranges if it's a match\n * in current search.\n */\nexport const HighlightedTextValue = function ({\n  Component = \"span\",\n}: {\n  /**\n   * When rendering in a flex parent (which is the case for tree or list), rendering a container is necessary to have\n   * the right spacing around highlights, when the highlighter span is immediately followed or proceeded by a white\n   * space. By default, a \"span\" is rendered.\n   */\n  Component?: React.ElementType;\n}) {\n  const speedSearchContext = React.useContext(CollectionSpeedSearchItemContext);\n  if (!speedSearchContext) {\n    throw new Error(\n      \"HighlightedTextValue should be rendered only in items of a speed search enabled collection component\"\n    );\n  }\n  const { highlightedRanges, text } = speedSearchContext;\n  return (\n    <Component>\n      {highlightedRanges ? (\n        <TextWithHighlights highlights={highlightedRanges}>\n          {text}\n        </TextWithHighlights>\n      ) : (\n        text\n      )}\n    </Component>\n  );\n};\n","import { Key, useEffect, useMemo } from \"react\";\nimport { minusculeMatch } from \"../minusculeMatch\";\nimport { SpeedSearchState } from \"../SpeedSearch/useSpeedSearch\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { createSpeedSearchSelectionManager } from \"./createSpeedSearchSelectionManager\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nexport type CollectionSpeedSearchMatches = Map<Key, TextRange[]>;\n\nexport function useCollectionSpeedSearchResult<T>({\n  collection,\n  selectionManager: inputSelectionManager,\n  speedSearch,\n  focusBestMatch = false,\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  speedSearch: SpeedSearchState;\n  /**\n   * If true, focusing the best match (the longest \"start-with\" match) will be preferred.\n   * By default, the focus is moved to the first match that comes after the currently focused item, if currently\n   * focused item itself is not a match.\n   * A typical use case would be collections that filter out non-match items.\n   * @default false\n   */\n  focusBestMatch?: boolean;\n}) {\n  const { searchTerm, active } = speedSearch;\n\n  /**\n   * Note: when a component is implemented using react-aria's useCollection, any re-render of that component causes\n   * a new collection. That's because prop.children is normally an inline function, and therefore the collection is\n   * re-created: https://github.com/adobe/react-spectrum/blob/4a1cff846018e449487ccf54d7474bdfa4d4f57c/packages/@react-stately/collections/src/useCollection.ts#L29\n   * This means we will unnecessarily perform the search in such cases. it might be a non-issue, but if it turned out\n   * to be an issue, a sub-optimum improvement would be to use `collection.size` as a dependency instead of `collection`,\n   * assuming that searchable text in collections won't change, and assuming that the important changes (search-wise)\n   * will usually involve a size change in the collection.\n   */\n  const { matches } = useMemo(() => {\n    const matches: CollectionSpeedSearchMatches = new Map(); // maybe make it nullable makes more sense\n    if (speedSearch.active) {\n      // it's important not to iterate on items, since they can be nested.\n      [...collection.getKeys()]\n        .map((key) => collection.getItem(key))\n        .filter(({ type }) => type === \"item\")\n        .forEach((item) => {\n          const matchedRanges = minusculeMatch(item.textValue, searchTerm);\n          if (matchedRanges) {\n            matches.set(item.key, matchedRanges);\n          }\n        });\n    }\n\n    return {\n      matches,\n    };\n  }, [searchTerm, collection, active]);\n\n  const selectionManager = createSpeedSearchSelectionManager(\n    inputSelectionManager,\n    active ? matches : null\n  );\n  const latestValues = useLatest({\n    matches,\n    selectionManager,\n    collection,\n    focusBestMatch,\n  });\n\n  // On every query change, if the current selection doesn't include any of the matched items, move selection to the\n  // first matched item.\n  useEffect(() => {\n    const { selectionManager, matches, collection } = latestValues.current;\n    const matchedKeys = [...matches.keys()];\n    const noneOfTheMatchesAreSelected = !matchedKeys.some((matchedKey) =>\n      selectionManager.isSelected(matchedKey)\n    );\n    let keyToFocus: Key | undefined;\n    if (latestValues.current.focusBestMatch) {\n      keyToFocus = getLongestCommonPrefixMatch(matches);\n    }\n    if (!keyToFocus && matchedKeys.length > 0 && noneOfTheMatchesAreSelected) {\n      keyToFocus = getMatchToSelect({\n        collection,\n        selectionManager,\n        matchedKeys,\n      });\n    }\n    if (keyToFocus) {\n      selectionManager.setFocusedKey(keyToFocus);\n      selectionManager.replaceSelection(keyToFocus);\n    }\n  }, [\n    searchTerm,\n    latestValues /*it's a ref object, so no harm in listing it here to comply with rules of hooks*/,\n  ]);\n  return {\n    matches,\n    selectionManager,\n  };\n}\n\n/**\n * given a non-empty array of matched keys, returns the one that should be selected\n */\nfunction getMatchToSelect({\n  collection,\n  selectionManager,\n  matchedKeys,\n}: {\n  collection: Collection<Node<unknown>>;\n  selectionManager: SelectionManager;\n  matchedKeys: Key[];\n}): Key {\n  let passedFirstSelection = false;\n  for (const key of collection.getKeys()) {\n    if (key === selectionManager.firstSelectedKey) {\n      passedFirstSelection = true;\n    }\n    if (passedFirstSelection && matchedKeys.includes(key)) {\n      return key;\n    }\n  }\n  return matchedKeys[0];\n}\n\n/**\n * Returns the longest match from the beginning, if exists.\n */\nfunction getLongestCommonPrefixMatch(matches: CollectionSpeedSearchMatches) {\n  return [...matches.entries()]\n    .filter(([, [firstRange]]) => firstRange?.from === 0)\n    .sort(\n      ([, [rangeA]], [, [rangeB]]) =>\n        rangeB.to - rangeB.from - rangeA.to - rangeA.from\n    )?.[0]?.[0];\n}\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { Key } from \"react\";\n\nexport function createSpeedSearchSelectionManager(\n  wrappedSelectionManager: SelectionManager,\n  matches: Map<Key, unknown /* We don't care what a match is here */> | null\n): SelectionManager {\n  return Object.create(wrappedSelectionManager, {\n    selectAll: {\n      value: () => {\n        if (matches) {\n          // @ts-expect-error: state is private and there is no API on SelectionManager for bulk\n          // setting selected keys (which would ideally check for not selecting disabled keys internally).\n          const state = wrappedSelectionManager.state;\n          state.setSelectedKeys(\n            new Set(\n              [...matches.keys()].filter((key) => !state.disabledKeys.has(key))\n            )\n          );\n        } else {\n          wrappedSelectionManager.selectAll();\n        }\n      },\n    },\n  });\n}\n","import { HTMLAttributes, RefObject, useMemo } from \"react\";\nimport { Collection, KeyboardDelegate, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { SpeedSearchPopupProps } from \"@intellij-platform/core/SpeedSearch\";\nimport {\n  SpeedSearchState,\n  SpeedSearchStateProps,\n  useSpeedSearch,\n  useSpeedSearchState,\n} from \"../SpeedSearch/useSpeedSearch\";\nimport { CollectionSpeedSearchContextValue } from \"./CollectionSpeedSearchContext\";\nimport {\n  CollectionSpeedSearchMatches,\n  useCollectionSpeedSearchResult,\n} from \"./useCollectionSpeedSearchResult\";\nimport { createSpeedSearchKeyboardDelegate } from \"./createSpeedSearchKeyboardDelegate\";\n\nexport interface CollectionSpeedSearch {\n  containerProps: HTMLAttributes<HTMLElement>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  speedSearch: SpeedSearchState & { matches: CollectionSpeedSearchMatches };\n  searchPopupProps: SpeedSearchPopupProps;\n  speedSearchContextValue: CollectionSpeedSearchContextValue;\n}\n\n/**\n * Given a `collection`, a `selectionManager` and a `keyboardDelegate`, it returns:\n * - `speedSearch`: search term, if speed search is active or not, and the matched keys\n * - `matches`: A Set of matched keys, or `null` if speed search is not active\n * - `containerProps`: The props you need to pass to the collection container element to enable\n * speedSearch on it.\n * - `selectionManager`: a selection manager in which select all is overridden to only select\n * matched items if speed search is active.\n * - `keyboardDelegate`: a keyboard delegate in which limits navigation to matched items, when\n * speed search is active.\n *\n * Speed search options, including the ones for optionally controlling the state of the speed search\n * are also accepted in inputs.\n */\nexport function useCollectionSpeedSearch<T>({\n  collection,\n  selectionManager,\n  stickySearch,\n  keyboardDelegate,\n  focusBestMatch,\n  ref,\n  ...speedSearchStateProps\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  ref: RefObject<HTMLElement>;\n  stickySearch?: boolean;\n  focusBestMatch?: boolean;\n} & SpeedSearchStateProps): CollectionSpeedSearch {\n  const speedSearch = useSpeedSearchState(speedSearchStateProps);\n\n  const { matches, selectionManager: speedSearchSelectionManager } =\n    useCollectionSpeedSearchResult({\n      collection,\n      selectionManager,\n      speedSearch,\n      focusBestMatch,\n    });\n  const { containerProps } = useSpeedSearch({ stickySearch }, speedSearch, ref);\n  const speedSearchKeyboardDelegate = useMemo(\n    () =>\n      createSpeedSearchKeyboardDelegate(\n        keyboardDelegate,\n        speedSearch.active ? matches : null\n      ),\n    [speedSearch.active, keyboardDelegate, matches]\n  );\n\n  // Doesn't seem necessary to wrap with useMemo, but can be rethink-ed\n  const speedSearchContextValue = { matches, collection };\n\n  return {\n    containerProps,\n    selectionManager: speedSearchSelectionManager,\n    keyboardDelegate: speedSearchKeyboardDelegate,\n    speedSearch: {\n      ...speedSearch,\n      matches,\n    },\n    searchPopupProps: {\n      active: speedSearch.active,\n      match: matches.size > 0,\n      children: speedSearch.searchTerm,\n    },\n    speedSearchContextValue,\n  };\n}\n","import React, { Key } from \"react\";\nimport { KeyboardDelegate } from \"@react-types/shared\";\n\n/**\n * Creates a new KeyboardDelegate in which keyKeyBelow and getKeyAbove are overridden in a way that\n * navigation is limited to matched items.\n * Note: select all action is not handled in KeyboardDelegate.\n * Note: when virtualization is added, this probably need to change, like how it's handled\n * in `useListBoxLayout` in react spectrum.\n */\nexport function createSpeedSearchKeyboardDelegate(\n  wrappedKeyboardDelegate: KeyboardDelegate,\n  matches: Map<Key, unknown /*We don't care what a match is, here*/> | null\n): KeyboardDelegate {\n  // TODO: page up and down deactivate speed search. If we want that, we can pass the speedSearch\n  //  object too. but doesn't seem like the best way to do it, even it the same behavior is expected\n  const findFirstMatch = <T extends React.Key | undefined, K>(\n    fromKey: React.Key | undefined | null,\n    direction: \"up\" | \"down\"\n  ) => {\n    let currentKey: React.Key | undefined | null = fromKey;\n    while (currentKey != null) {\n      if (!matches || matches.has(currentKey)) {\n        return currentKey;\n      }\n      currentKey =\n        direction === \"up\"\n          ? wrappedKeyboardDelegate.getKeyAbove?.(currentKey)\n          : wrappedKeyboardDelegate.getKeyBelow?.(currentKey);\n    }\n    return currentKey ?? undefined;\n  };\n  return Object.create(wrappedKeyboardDelegate, {\n    getKeyBelow: {\n      value: (key) =>\n        findFirstMatch(wrappedKeyboardDelegate.getKeyBelow?.(key), \"down\"),\n    },\n    getKeyAbove: {\n      value: (key) =>\n        findFirstMatch(wrappedKeyboardDelegate.getKeyAbove?.(key), \"up\"),\n    },\n    getFirstKey: {\n      value: (key?: React.Key, global?: boolean): React.Key | null => {\n        const firstKey = findFirstMatch(\n          wrappedKeyboardDelegate.getFirstKey?.(key, global),\n          \"down\"\n        );\n        return firstKey == null ? matches?.values().next().value : firstKey;\n      },\n    },\n    getLastKey: {\n      value: (key?: React.Key, global?: boolean): React.Key | null => {\n        const lastKey = findFirstMatch(\n          wrappedKeyboardDelegate.getLastKey?.(key, global),\n          \"down\"\n        );\n        return lastKey == null\n          ? [...(matches?.keys() || [])].pop() ?? null\n          : lastKey;\n      },\n    },\n  } as { [key in keyof KeyboardDelegate]: { value: KeyboardDelegate[key] } });\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { PartialNode } from \"@react-stately/collections\";\n\ninterface DividerProps {}\n\n/**\n * To be used in dynamic collections, just to provide a key and make it easy to check in the render\n * function to figure out what to render (an Item or a Divider)\n */\nexport class DividerItem {\n  private static seq = 0;\n  key = \"divider_\" + DividerItem.seq++;\n  get id() {\n    return this.key;\n  }\n}\n\nfunction Divider({}: DividerProps): ReactElement {\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  return null as any;\n}\n// We don't want getCollectionNode to show up in the type definition\nlet _Divider = Divider as (props: DividerProps) => JSX.Element;\nexport { _Divider as Divider };\n\nDivider.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>\n): Generator<PartialNode<T>> {\n  let rendered = null;\n\n  yield {\n    type: \"divider\",\n    element: null as any, // to prevent check on key, which is not necessary for divider\n    props: props,\n    rendered,\n    hasChildNodes: false,\n  };\n};\n","import React, { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { Item as StatelyItem, PartialNode } from \"@react-stately/collections\";\n\n// noinspection JSUnusedLocalSymbols\n/**\n * Item for collection components, which by default disables caching, unless `invalidated` prop is set to false on the\n * context passed to useCollection. Control over cache invalidation policy can be enabled by using\n * `useCollectionCacheInvalidation` for creating such context object.\n */\nfunction Item<T>(props: ItemProps<T>): ReactElement {\n  return null as any as React.ReactElement;\n}\n\nexport type CacheInvalidationContext = { invalidated?: boolean };\n\n// We don't want getCollectionNode to show up in the type definition\nlet _Item = Item as <T>(props: ItemProps<T>) => JSX.Element;\nexport { _Item as Item };\n\n/**\n * @private @preapproved\n */\nItem.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: CacheInvalidationContext\n): Generator<PartialNode<T>> {\n  const itemGenerator: Generator<PartialNode<T>> = (\n    StatelyItem as any\n  ).getCollectionNode(props, context);\n  const result = itemGenerator.next().value;\n  const originalShouldInvalidate = result.shouldInvalidate;\n  result.shouldInvalidate = (context: CacheInvalidationContext) =>\n    originalShouldInvalidate?.(context) || context.invalidated;\n  yield result;\n};\n","import React from \"react\";\nimport { styled } from \"../styled\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\nconst GAP = \"0.1875rem\";\nconst StyledItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  padding-right: 0.25rem;\n  gap: ${GAP};\n`;\n\nconst StyledHint = styled.span<{ small?: boolean }>`\n  display: inline-flex;\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n  padding-left: 0.1rem;\n  font-size: ${({ small }) => small && \"0.9em\"};\n`;\n\nconst StyledGroup = styled.span.attrs({\n  role: \"presentation\" as string,\n})`\n  display: inline-flex;\n  display: flex;\n  align-items: center;\n  gap: ${GAP};\n`;\n/**\n * Generic layout component capturing common use cases of tree or list items.\n * It handles the spacing between parts, and provides styled components for parts that need specific styling.\n * For more flexibility over the order of various pieces of content in list/tree items, there is no specific props\n * for parts. Different parts should just be rendered in children.\n *\n * @example\n * ```tsx\n * <ItemLayout>\n *   <PlatformIcon icon=\"nodes/folder\" />\n *   <HighlightedTextValue />\n *   <ItemLayout.Hint>~/workspace/jui</ItemLayout.Hint>\n * </ItemLayout>\n * ```\n * @beta\n */\nexport const ItemLayout = (\n  props: { children: React.ReactNode } & DOMAttributes\n) => {\n  return <StyledItemLayout {...props} />;\n};\n\n/**\n * A more subtle text usually rendered next to the main text in the item.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Hint = StyledHint;\n\n/**\n * Useful when a number of items need to be grouped by a wrapper, e.g. to have a tooltip.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Group = StyledGroup;\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Generic state of items in collections, provided via a context.\n * To be used in Menu, Tree, or anything that deals with a collection of items for which the common states like\n * **disabled** or **selected** is applicable.\n */\nexport interface ItemStateContextType {\n  node: Node<unknown>;\n  isSelected: boolean;\n  isContainerFocused: boolean;\n  isDisabled: boolean;\n}\n\nexport const ItemStateContext =\n  React.createContext<ItemStateContextType | null>(null);\n","import { RefObject, useEffect } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { scrollIntoView } from \"@react-aria/utils\";\n\ntype CollectionAutoScrollProps = {\n  isVirtualized?: boolean;\n  selectionManager: SelectionManager;\n};\n\nexport function useCollectionAutoScroll(\n  { isVirtualized, selectionManager }: CollectionAutoScrollProps,\n  ref: RefObject<HTMLElement>\n) {\n  // If not virtualized, scroll the focused element into view when the focusedKey changes.\n  // When virtualized, Virtualizer handles this internally.\n  useEffect(() => {\n    if (!isVirtualized && selectionManager.focusedKey && ref?.current) {\n      let element = ref.current.querySelector(\n        `[data-key=\"${selectionManager.focusedKey}\"]`\n      ) as HTMLElement;\n      if (element) {\n        scrollIntoView(ref.current, element);\n      }\n    }\n  }, [isVirtualized, ref, selectionManager.focusedKey]);\n}\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { RefObject, useImperativeHandle } from \"react\";\n\nexport type CollectionRefProps = {\n  /**\n   * Gives imperative access to selection manager.\n   */\n  selectionManagerRef?: RefObject<SelectionManager>;\n};\n\n/**\n * Common imperative API for collections. Used in Lists at the moment. Tree components implement a different imperative\n * API that can be refactored later for more consistency.\n */\nexport function useCollectionRef(\n  { selectionManagerRef }: CollectionRefProps,\n  state: { selectionManager: SelectionManager }\n) {\n  useImperativeHandle(selectionManagerRef, () => state.selectionManager);\n}\n","import React, { RefObject } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\n/**\n * A solution for connecting a collection to a search input, so that collection can still be navigated by keyboard\n * while the input is focused. It works by replaying certain keyboard events on the collection container and focused\n * item. An alternative approach (which is used in react-aria's useCombobox) is to use useSelectableCollection\n * separately for the input, but the biggest issue with that approach is that it's limiting in the following ways:\n * - Rendering input should be a part of the same component that renders the collection. Having specific components\n *   for use cases that requires a search input is not flexible enough. For example one may want to use SpeedSearchList\n *   or List connected to an input. Also, the input and the collection may need to be in different layouts in different\n *   use cases. Decoupling the rendering of the input and collection is a more flexible solution.\n * - The same options used for collection should be passed to the input field for behavior consistency, and that can be\n *   prone to error. Some of these options, like `keyboardDelegate` can even have a default value in hooks like\n *   `useSelectableList`, which means for making sure the same value is passed to the useSelectableCollection for input,\n *   would require to not use the default value, since the same value can't be accessed.\n *\n * With this event forwarding approach, it's an arrow up or down event would behave exactly like it was triggered on\n * the collection itself, leaving no room for behavior discrepancies. But it has a few drawbacks:\n * - Although small, there is still some coupling between this code and implementation of the collection component.\n *   More specifically, the following things are assumed by this implementation:\n *   - \"Enter\" keys (selection or action) are handled on items, but arrow keys are handled on the collection element.\n *   - \"[data-key] attribute is set on items. That is used to find the element for the focused item (which of course is\n *     not actually focused while the input is).\n */\nexport const useCollectionSearchInput = ({\n  collectionRef,\n  selectionManager,\n}: {\n  /**\n   * ref to the html element of the collection component\n   */\n  collectionRef: RefObject<HTMLElement>;\n  /**\n   * SelectionManager instance, returned from the state management hook for the collection component.\n   * {@link CollectionRefProps.selectionManagerRef} can be used on collection components that implement\n   * `useCollectionRef`, to get a hold of selection manager, from outside.\n   */\n  selectionManager: SelectionManager | null | undefined;\n}): { collectionSearchInputProps: DOMAttributes<HTMLInputElement> } => {\n  const relayEventsToCollection = useEventCallback(\n    (event: React.KeyboardEvent) => {\n      // Relay ArrowUp and ArrowDown to the container\n      if (\n        event.type === \"keydown\" &&\n        (event.key === \"ArrowUp\" || event.key === \"ArrowDown\")\n      ) {\n        event.preventDefault();\n        event.stopPropagation();\n        collectionRef.current?.dispatchEvent(\n          new KeyboardEvent(event.type, event.nativeEvent)\n        );\n      }\n      // Relay Enter to the focused item\n      else if (event.key === \"Enter\" && selectionManager?.focusedKey) {\n        collectionRef.current\n          ?.querySelector(`[data-key=\"${selectionManager?.focusedKey}\"]`)\n          ?.dispatchEvent(new KeyboardEvent(event.type, event.nativeEvent));\n        event.preventDefault();\n      }\n    }\n  );\n\n  return {\n    collectionSearchInputProps: {\n      onKeyDown: relayEventsToCollection,\n      onKeyUp: relayEventsToCollection,\n      onKeyPress: relayEventsToCollection,\n    },\n  };\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, { ForwardedRef } from \"react\";\nimport { amendName, PlatformIcon, PlatformIconProps } from \"./PlatformIcon\";\n\nexport const StyledHoverContainer = styled.span<{\n  hoverContainerSelector?: string;\n}>`\n  ${({ hoverContainerSelector }) =>\n    hoverContainerSelector\n      ? `${hoverContainerSelector} &`\n      : \"\"} .icon[data-hover] {\n    display: none;\n  }\n\n  ${({ hoverContainerSelector }) =>\n    hoverContainerSelector ? `${hoverContainerSelector}:hover &` : \"&:hover\"} {\n    .icon {\n      display: none;\n    }\n\n    .icon[data-hover] {\n      display: inline-flex;\n    }\n  }\n`;\n\nconst StyledIconHoverContainer = styled(StyledHoverContainer)`\n  display: inline-flex;\n`;\n\n/**\n * A common use case for PlatformIcons is to have a default icon and a hover icon.\n * This component captures that simple use case, by rendering both icons, and hiding one based on a hover selector.\n *\n * ### Parent hover container\n *\n * If the hover-able element is a parent of the icon, and not the icon itself (i.e., the icon should change if the\n * that parent is hovered), you can use `StyledHoverContainer` to define that parent element:\n *\n * ```tsx\n * const SomeParent = styled(StyledHoverContainer)`...`;\n * <SomeParent><AutoHoverPlatformIcon icon=\"...\" /></SomeParent>\n * ```\n *\n * If the hover-able element is a parent of the icon, with a known selector, you can pass `hoverContainerSelector`,\n * instead of using `StyledHoverContainer`:\n *\n * ```tsx\n * <AutoHoverPlatformIcon icon=\"...\" hoverContainerSelector=\"[role=menuitem]\" />\n * ```\n *\n * If the hover container is a styled component, you can have it converted to selector like this:\n *\n * ```tsx\n * <AutoHoverPlatformIcon icon=\"...\" hoverContainerSelector={`${MyStyledHoverContainer}`} />\n * ```\n *\n * In all examples above, the hover icon is shown when the parent is hovered, instead of the icon itself.\n *\n */\nexport const AutoHoverPlatformIcon = React.forwardRef(\n  function AutoHoverPlatformIcon(\n    {\n      hoverIcon,\n      hoverContainerSelector,\n      ...props\n    }: PlatformIconProps & {\n      /**\n       * The icon to be used when hovered. If not provided, it will be the \"somethingHovered\" where \"something\" is the `icon`\n       */\n      hoverIcon?: string;\n      hoverContainerSelector?: string;\n    },\n    ref: ForwardedRef<HTMLSpanElement>\n  ) {\n    const className = `icon ${props.className || \"\"}`;\n    return (\n      <StyledIconHoverContainer\n        ref={ref}\n        hoverContainerSelector={hoverContainerSelector}\n      >\n        <PlatformIcon {...props} className={className} />\n        <PlatformIcon\n          {...props}\n          className={className}\n          icon={hoverIcon ?? amendName(props.icon, \"Hover\")}\n          data-hover\n        />\n      </StyledIconHoverContainer>\n    );\n  }\n);\n","import useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport React, { ForwardedRef } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\ninterface IconModifiers {\n  Selected?: boolean;\n  Focused?: boolean;\n  Disabled?: boolean;\n  Editable?: boolean;\n  Pressed?: boolean;\n}\n\nexport interface ThemeIconProps extends IconProps {\n  /**\n   * Icon which will be resolved against the default icon location based on theme type\n   */\n  icon: string | { name: string; modifiers: IconModifiers };\n\n  /**\n   * A theme key that can optionally override the icon.\n   */\n  themePath?: string;\n}\n\nconst ICONS_DIR_PREFIX = \"com/intellij/ide/ui/laf/icons/\";\n\n// Similar to LafIconLookup\nfunction findIconPath(\n  theme: Theme,\n  name: string,\n  modifiers: IconModifiers = {}\n) {\n  const basePath = `${ICONS_DIR_PREFIX}${\n    theme.isUnderDarcula() ? \"darcula/\" : \"intellij/\"\n  }`;\n  const suffix = (\n    [\"Editable\", \"Selected\", \"Pressed\", \"Focused\", \"Disabled\"] as Array<\n      keyof typeof modifiers\n    >\n  )\n    .filter((modifier) =>\n      // Focused or Pressed can't coexist with Disabled\n      modifiers.Disabled ? ![\"Focused\", \"Pressed\"].includes(modifier) : true\n    )\n    .reduce(\n      (soFar, modifier) => soFar + (modifiers[modifier] ? modifier : \"\"),\n      \"\"\n    );\n  return `${basePath}${name}${suffix}.svg`;\n}\n\nfunction useIconPath(\n  iconDescriptor: string | { name: string; modifiers?: IconModifiers },\n  themePath?: string\n) {\n  const theme = useTheme() as Theme; // TODO: investigate why useTheme is typed like this\n  const resolvedValue = themePath && theme.value(themePath);\n  if (resolvedValue) {\n    return resolvedValue;\n  }\n  const { modifiers = {}, name } =\n    typeof iconDescriptor === \"string\"\n      ? { name: iconDescriptor }\n      : iconDescriptor;\n  return findIconPath(theme, name, modifiers);\n}\n\nexport const LafIcon = React.forwardRef(\n  (\n    { themePath, icon, size, ...props }: ThemeIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const resolvedIconPath = useIconPath(icon, themePath);\n\n    const ref = useForwardedRef(forwardedRef);\n    useSvgIcon({ path: `platform/platform-impl/src/${resolvedIconPath}` }, ref);\n    return <StyledIconWrapper {...props} ref={ref} size={size} />;\n  }\n);\n","import React, { ForwardedRef } from \"react\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\nexport interface PlatformIconProps extends IconProps {\n  /**\n   * Icon path in intellij platform repo.\n   * If starts with \"/\", the path will be from the repo root. Otherwise, it's relative to \"platform/icons/src\".\n   * \".svg\" extension is optional.\n   */\n  icon: string;\n  /**\n   * Similar to icon, but for dark themes.\n   */\n  darkIcon?: string;\n}\n\nexport const amendName = (iconNameOrPath: string, amendment: string) => {\n  const [name, ext] = iconNameOrPath.split(\".\");\n  return `${name}${amendment}${ext ? `.${ext}` : \"\"}`;\n};\n\nexport const getDarkPath = (path: string, darkPath?: string) => {\n  const [name, ext] = path.split(\".\");\n  return darkPath || `${name}_dark${ext ? `.${ext}` : \"\"}`;\n};\n\nconst getPlatformIconPath = (relativePath: string) =>\n  relativePath.startsWith(\"/\")\n    ? relativePath.slice(1)\n    : `platform/icons/src/${relativePath}`;\n\n/**\n * Renders an icon from the predefined list of platform icons.\n * icon name must follow the directory structure in platform icons.\n * @example <PlatformIcon icon=\"general/hideToolWindow\" />\n * @example <PlatformIcon icon=\"toolbar/pin\" />\n * @example <PlatformIcon icon=\"toolbar/pin.svg\" />\n * @example <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\" />\n */\nexport const PlatformIcon = React.forwardRef(\n  (\n    { icon, darkIcon, ...props }: PlatformIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const ref = useForwardedRef(forwardedRef);\n    const theme = useTheme();\n    const iconName = theme.dark ? getDarkPath(icon, darkIcon) : icon;\n    useSvgIcon(\n      {\n        path: getPlatformIconPath(iconName),\n        fallbackPath: getPlatformIconPath(icon),\n      },\n      ref\n    );\n\n    return <StyledIconWrapper {...props} ref={ref} />;\n  }\n);\n","import { styled } from \"../styled\";\nimport { IconSize } from \"@intellij-platform/core/Icon/IconProps\";\n\nconst DEFAULT_ICON_SIZE: IconSize = 16;\n\nexport const StyledIconWrapper = styled.span<{\n  size?: IconSize;\n  useCurrentColor?: boolean;\n  role?: string;\n}>`\n  box-sizing: border-box;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 0;\n  width: ${({ size = DEFAULT_ICON_SIZE }) => `${size}px`};\n  height: ${({ size = DEFAULT_ICON_SIZE }) => `${size}px`};\n  position: relative; // to allow absolute positioned indicators and overlays on icon\n  cursor: ${({ role }) => (role === \"button\" ? \"pointer\" : undefined)};\n`;\n","import { RefObject, useContext, useEffect } from \"react\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\n\nexport function useSvgIcon(\n  { path, fallbackPath }: { path: string; fallbackPath?: string },\n  /**\n   * ref to the icon wrapper element in which the svg should be injected.\n   * This hook used to return svg string, and that svg was set as dangerouslySetInnerHTML. But now it injects the svg.\n   * by direct DOM manipulation. That's to eliminate the need for using dangerouslySetInnerHTML, so that we can allow\n   * arbitrary children (like LiveIndicator) as overlays on top of icons.\n   */\n  ref: RefObject<HTMLElement>\n) {\n  const theme = useTheme();\n  const itemState = useContext(ItemStateContext);\n  const selected = itemState?.isSelected || itemState?.isContainerFocused;\n  useEffect(() => {\n    let unmounted = false;\n    const fetchIcon = async () => {\n      if (!path) {\n        console.error(\"icon path is empty\");\n        return;\n      }\n      if (ref.current) {\n        // For querying for icons that are not loaded yet. Especially useful for visual testing\n        ref.current.dataset.loadingIcon = \"true\";\n      }\n      const svg = await theme.getSvgIcon(path, selected).catch((e) => {\n        if (fallbackPath) {\n          return theme.getSvgIcon(fallbackPath, selected);\n        }\n        throw e;\n      });\n      if (svg) {\n        if (!unmounted && ref?.current) {\n          if (ref) {\n            ref.current?.querySelector(\"svg\")?.remove();\n            const svgElement = document.createElement(\"svg\");\n            ref.current?.appendChild(svgElement);\n            svgElement.outerHTML = makeIdsUnique(svg); // UNSAFE! Would require sanitization, or icon sources must be trusted.\n            delete ref.current?.dataset.loadingIcon;\n          }\n        }\n      } else {\n        console.error(\"Could not resolve icon:\", path);\n      }\n    };\n    fetchIcon().catch(console.error);\n    return () => {\n      unmounted = true;\n    };\n  }, [path, selected]);\n}\n\n/**\n * If multiple instance of the same icon is rendered at the same time, and the SVG includes\n * url(#...) references to locally defined ids, in some cases the icon is not rendered properly.\n * because of ids colliding. We make sure the ids are unique in each rendered icon.\n */\nfunction makeIdsUnique(svg: string): string {\n  const randomPostfix = (Math.random() * 1000).toFixed(0);\n  const idMatches = svg.matchAll(/id=\"(.*?)\"/g);\n  return [...idMatches].reduce((modifiedSvg, [_, id]) => {\n    const newId = `${id}-${randomPostfix}`;\n    return replaceAll(\n      `id=\"${id}\"`,\n      `id=\"${newId}\"`,\n      replaceAll(`url(#${id})`, `url(#${newId})`, modifiedSvg)\n    );\n  }, svg);\n}\n\nfunction replaceAll(theOld: string, theNew: string, str: string): string {\n  const replaced = str.replace(theOld, theNew);\n  const replacedAgain = replaced.replace(theOld, theNew);\n  if (replaced === replacedAgain) {\n    return replaced;\n  }\n  return replaceAll(theOld, theNew, replacedAgain);\n}\n","import { PressProps, usePress } from \"@react-aria/interactions\";\nimport React, { ForwardedRef, HTMLProps } from \"react\";\nimport { styled } from \"../styled\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface IconButtonProps\n  extends PressProps,\n    // Maybe we should allow any arbitrary HTMLProps<HTMLButtonElement> props, instead of whitelisting?\n    Pick<\n      HTMLProps<HTMLButtonElement>,\n      \"onFocus\" | \"onBlur\" | \"style\" | \"className\"\n    > {\n  children?: React.ReactNode;\n  /**\n   * The minimum width/height of the button.\n   */\n  minSize?: number;\n  /**\n   * Whether the button should be focusable by pressing tab. The default is true for icon buttons (aka. action buttons),\n   * which means they are not included in the tab order.\n   */\n  excludeFromTabOrder?: boolean;\n}\n\nexport const DEFAULT_MINIMUM_BUTTON_SIZE = 22;\nexport const NAVBAR_MINIMUM_BUTTON_SIZE = 20;\n\nexport const StyledIconButton = styled.button<{ minSize: number }>`\n  position: relative; // to allow absolutely positioned overlays like an dropdown icon at the bottom right corner\n  background: none;\n  color: inherit;\n  border: 1px solid transparent;\n  border-radius: 3px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-height: ${({ minSize }) => `${minSize}px`};\n  min-width: ${({ minSize }) => `${minSize}px`};\n  padding: 0;\n  margin: 0;\n  &:disabled {\n    opacity: 0.25; // not quite accurate implementation. There might be better ways to style disabled state.\n  }\n  &:hover:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBackground\", \"#DFDFDF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBorderColor\", \"#DFDFDF\")};\n  }\n  &:focus-visible:not(:disabled) {\n    outline: none;\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\n        \"ActionButton.focusedBorderColor\",\n        theme.dark ? \"#5eacd0\" : \"#62b8de\"\n      )};\n  }\n  &:active:not(:disabled),\n  &.active:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBorderColor\", \"#CFCFCF\")};\n  }\n`;\n\n/**\n * Icon button, aka Action Button, in the reference implementation.\n * @see https://jetbrains.github.io/ui/controls/icon_button/\n */\nexport const IconButton = React.forwardRef(function IconButton(\n  {\n    minSize = DEFAULT_MINIMUM_BUTTON_SIZE,\n    preventFocusOnPress = true,\n    excludeFromTabOrder = true,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    ...otherProps\n  }: IconButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  // FIXME: use useButton\n\n  const ref = useObjectRef(forwardedRef);\n  const { focusableProps } = useFocusable({ isDisabled }, ref);\n  const { pressProps, isPressed } = usePress({\n    ref,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    preventFocusOnPress,\n  });\n\n  return (\n    <StyledIconButton\n      className={isPressed ? \"active\" : \"\"}\n      disabled={isDisabled}\n      {...mergeProps(pressProps, otherProps, focusableProps)}\n      minSize={minSize}\n      tabIndex={excludeFromTabOrder && !isDisabled ? -1 : undefined}\n      ref={ref}\n    />\n  );\n});\n","import React, { useRef } from \"react\";\nimport styled from \"styled-components\";\nimport {\n  IconButton,\n  IconButtonProps,\n} from \"@intellij-platform/core/IconButton\";\nimport { MenuTrigger, MenuTriggerProps } from \"@intellij-platform/core/Menu\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst ArrowIcon = styled(PlatformIcon)`\n  position: absolute;\n  right: 1px;\n  bottom: 1px;\n`;\n\ntype IconButtonWithMenuProps = IconButtonProps &\n  Pick<MenuTriggerProps, \"renderMenu\"> & {\n    /**\n     * whether the default arrow should be removed or not. false by default.\n     */\n    noArrow?: boolean;\n  };\n/**\n * Renders an IconButton which opens a menu. by default a down arrow icon is shown as an overlay on the rendered\n * icon, but it can be disabled by passing `noArrow`. It also restores the focus to the previously focused element,\n * when the menu is closed.\n * @param renderMenu: render prop for rendering the menu\n * @param children: the content of the icon button\n * @param noArrow: whether the default arrow should be removed or not. false by default.\n * @param buttonProps: the rest of the props that will be passed down to IconButton\n *\n * TODO: Add story and write test for focus restoration, noArrow, and basic functionality.\n */\nexport const IconButtonWithMenu = ({\n  renderMenu,\n  children,\n  noArrow = false,\n  ...buttonProps\n}: IconButtonWithMenuProps) => {\n  const previouslyFocusedElementRef = useRef<HTMLElement>();\n  return (\n    <MenuTrigger\n      renderMenu={renderMenu}\n      onOpenChange={(open) => {\n        if (!open && previouslyFocusedElementRef.current) {\n          previouslyFocusedElementRef.current.focus();\n        }\n      }}\n    >\n      {(props, ref) => (\n        <IconButton\n          {...mergeProps(buttonProps, props, {\n            onFocus: (e: FocusEvent) => {\n              if (e.relatedTarget && e.relatedTarget instanceof HTMLElement) {\n                previouslyFocusedElementRef.current = e.relatedTarget;\n              }\n            },\n          })}\n          ref={ref}\n        >\n          {children}\n          {!noArrow && <ArrowIcon icon=\"general/dropdown.svg\" />}\n        </IconButton>\n      )}\n    </MenuTrigger>\n  );\n};\n","import React, { ComponentProps } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"./Theme/Theme\";\n\ninterface Props extends ComponentProps<\"img\"> {\n  /**\n   * src for when a dark theme is active. if `darkSrc` doesn't have a non-empty string value, src will be used both\n   * for dark and light themes.\n   */\n  darkSrc?: string;\n}\n/**\n * Same as default `img`, but theme aware. Meaning that you can specify different sources for normal and dark mode.\n */\nexport const Img: React.FC<Props> = ({ darkSrc, ...props }) => {\n  const theme = useTheme() as Theme;\n  if (theme.dark) {\n    return <img {...props} src={darkSrc || props.src} />;\n  }\n  return <img {...props} />;\n};\n","import React, {\n  ForwardedRef,\n  InputHTMLAttributes,\n  useEffect,\n  useState,\n} from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { FocusableOptions, useFocusable } from \"@react-aria/focus\";\nimport { ValidationState } from \"@react-types/shared\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nconst StyledInputBox = styled.div<{\n  disabled?: boolean;\n  focused?: boolean;\n  validationState: ValidationState | undefined;\n}>`\n  box-sizing: border-box;\n  display: inline-flex;\n  min-width: 4rem; // https://jetbrains.github.io/ui/controls/input_field/#28\n  background: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"TextField.disabledBackground\")\n      : theme.color(\"TextField.background\")};\n  border: 1px solid\n    ${({ theme, focused, disabled, validationState }) =>\n      theme.commonColors.border({\n        focused: focused,\n        disabled: disabled,\n        invalid: validationState === \"invalid\",\n      })};\n  box-shadow: 0 0 0 0.125rem\n    ${({ theme, focused = false, validationState, disabled }) =>\n      disabled\n        ? \"transparent\"\n        : theme.commonColors.focusRing({\n            invalid: validationState === \"invalid\",\n            focused: focused,\n          })};\n  border-radius: 1px;\n  cursor: text; // the whole box moves focus to the input\n  overflow: hidden;\n`;\n\nconst StyledInput = styled.input<{ disabled?: boolean }>`\n  all: unset;\n  padding: 0.1875rem 0.375rem;\n  flex: 1; // fill in the available space within the input box\n  min-width: 0;\n  line-height: 1rem;\n  color: ${({ theme }) =>\n    theme.color(\n      \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n    )};\n  color: ${({ theme, disabled }) =>\n    disabled &&\n    theme.color(\n      \"TextField.inactiveForeground\" as UnknownThemeProp<\"TextField.inactiveForeground\">\n    )};\n\n  caret-color: ${({ theme }) =>\n    theme.color(\n      \"TextField.caretForeground\" as UnknownThemeProp<\"TextField.caretForeground\">\n    )};\n  &::selection {\n    background: ${({ theme }) =>\n      theme.color(\n        \"*.selectionBackground\"\n      )}; // Not checked with the reference impl\n    color: ${({ theme }) =>\n      theme.color(\n        \"*.selectionForeground\"\n      )}; // Not checked with the reference impl\n  }\n  &::placeholder {\n    color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  }\n`;\n\nconst StyledAddons = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem; /* TODO: check */\n  padding: 1px 0;\n`;\nconst StyledRightAddons = styled(StyledAddons)`\n  margin-right: 0.125rem; /* TODO: check */\n`;\n\nconst StyledLeftAddons = styled(StyledAddons)`\n  margin-left: 0.375rem; /* TODO: check */\n`;\n\nexport interface InputProps extends InputHTMLAttributes<HTMLInputElement> {\n  validationState?: ValidationState;\n  /**\n   * Whether to auto select the value initially\n   */\n  autoSelect?: boolean;\n\n  /**\n   * Rendered inside the input box and after the input element.\n   * Used to render [Built-in buttons](https://jetbrains.github.io/ui/controls/built_in_button/).\n   */\n  addonAfter?: React.ReactNode;\n  /**\n   * Rendered inside the input box and before the input element.\n   */\n  addonBefore?: React.ReactNode;\n\n  /**\n   * Ref to the underlying input element\n   */\n  inputRef?: React.Ref<HTMLInputElement>;\n}\n\n/**\n * Bare input, themed, and with a few extra features:\n * - Support for \"invalid\" state ({@param validationState}\n * - Support for autoSelect.\n * - Disables spell check by default. It can be overwritten.\n * Use {@link InputField} for more features like an associated label, error message and context help.\n */\nexport const Input = React.forwardRef(function Input(\n  {\n    validationState,\n    autoSelect,\n    addonBefore,\n    addonAfter,\n    style,\n    className,\n    inputRef: inputRefProp,\n    onKeyDown,\n    onKeyUp,\n    onFocus,\n    onBlur,\n    autoFocus,\n    ...props\n  }: InputProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const inputRef = useObjectRef(inputRefProp);\n  const { focusableProps } = useFocusable(\n    {\n      isDisabled: props.disabled,\n      autoFocus,\n      onFocus,\n      onBlur,\n      onKeyDown,\n      onKeyUp,\n    } as FocusableOptions,\n    inputRef\n  );\n  const [isFocused, setIsFocused] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setIsFocused,\n  });\n\n  useEffect(() => {\n    if (autoSelect) {\n      inputRef.current.select();\n    }\n  }, [autoSelect]);\n\n  return (\n    <StyledInputBox\n      ref={ref}\n      spellCheck={false}\n      {...mergeProps(focusWithinProps, {\n        className,\n        style,\n        onMouseDown: (event: MouseEvent) => {\n          if (event.target !== inputRef.current) {\n            event.preventDefault();\n            inputRef.current.focus();\n          }\n        },\n      })}\n      focused={isFocused}\n      validationState={validationState}\n      disabled={props.disabled}\n    >\n      {addonBefore && <StyledLeftAddons>{addonBefore}</StyledLeftAddons>}\n      <StyledInput ref={inputRef} {...mergeProps(props, focusableProps)} />\n      {addonAfter && <StyledRightAddons>{addonAfter}</StyledRightAddons>}\n    </StyledInputBox>\n  );\n});\n","import { styled } from \"@intellij-platform/core/styled\";\n\nexport const StyledLabel = styled.label<{ disabled?: boolean }>`\n  color: ${({ theme, disabled }) => theme.commonColors.label({ disabled })};\n`;\n","import React, {\n  ChangeEvent,\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n} from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { AriaFieldProps, useField } from \"@react-aria/label\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { FocusableProps } from \"@react-types/shared\";\nimport { Label } from \"@intellij-platform/core/Label\";\nimport {\n  PositionedTooltipTrigger,\n  ValidationTooltip,\n} from \"@intellij-platform/core/Tooltip\";\nimport { Input, InputProps } from \"@intellij-platform/core/InputField/Input\";\n\ntype LabelPlacement = \"above\" | \"before\";\n\nexport interface InputFieldProps\n  extends Omit<AriaFieldProps, \"labelElementType\">,\n    FocusableProps,\n    Pick<InputProps, \"addonBefore\" | \"addonAfter\" | \"inputRef\"> {\n  /**\n   * className applied on the field's wrapper div.\n   */\n  className?: string;\n  /**\n   * style applied on the field's wrapper div.\n   */\n  style?: CSSProperties;\n  /**\n   * Label to be associated with the input.\n   */\n  label?: React.ReactNode;\n  /**\n   * Context help, shown below the input. A typical use case is\n   * [to provide example values](https://jetbrains.github.io/ui/principles/context_help/#07).\n   */\n  contextHelp?: React.ReactNode;\n  /**\n   * Placement of the label with respect to the input box.\n   */\n  labelPlacement?: LabelPlacement;\n\n  /**\n   * Whether the input is disabled. Use this prop\n   */\n  isDisabled?: boolean;\n\n  /**\n   * Convenient prop to be used instead of inputProps.placeholder\n   **/\n  placeholder?: string;\n  /**\n   * Convenient prop to be used instead of inputProps.value\n   **/\n  value?: HTMLProps<HTMLInputElement>[\"value\"];\n  /**\n   * Convenient prop to be used instead of inputProps.defaultValue\n   **/\n  defaultValue?: HTMLProps<HTMLInputElement>[\"defaultValue\"];\n  /**\n   * Convenient prop to be used instead of inputProps.onChange. It also calls the passed callback with the\n   * change value instead of input.\n   **/\n  onChange?: (newValue: string) => void;\n  /**\n   * Props to be passed to the underlying input element.\n   **/\n  inputProps?: Omit<\n    HTMLProps<HTMLInputElement>,\n    \"as\" | \"ref\" | \"disabled\" //isDisabled should be used\n  >;\n  /**\n   * Whether to auto select the value initially\n   */\n  autoSelect?: boolean;\n}\n\nconst StyledInputContainer = styled.div<{ labelPlacement?: LabelPlacement }>`\n  display: inline-flex;\n  flex-direction: ${({ labelPlacement }) =>\n    labelPlacement === \"above\" ? \"column\" : \"row\"};\n  align-items: start;\n  gap: 0.375rem;\n`;\n\nconst StyledLabel = styled(Label)`\n  margin-top: 0.25rem;\n  line-height: 1.2;\n`;\nconst StyledContextHelp = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n`;\n\nconst StyledBoxAndContextHelpWrapper = styled.div`\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  gap: 0.25rem; /* Not checked with the reference impl */\n`;\n\n/**\n * An input box with an associated label, error message, and context help.\n */\nexport const InputField = React.forwardRef(function InputField(\n  {\n    className,\n    style,\n    labelPlacement = \"before\",\n    contextHelp,\n    inputProps = {},\n    addonBefore,\n    addonAfter,\n    inputRef,\n    ...props\n  }: InputFieldProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref = useObjectRef(forwardedRef);\n  const { fieldProps, errorMessageProps, labelProps, descriptionProps } =\n    useField(props);\n\n  return (\n    <StyledInputContainer\n      ref={ref}\n      labelPlacement={labelPlacement}\n      className={className}\n      style={style}\n    >\n      <StyledLabel {...labelProps} disabled={props.isDisabled}>\n        {props.label}\n      </StyledLabel>\n      <StyledBoxAndContextHelpWrapper>\n        <PositionedTooltipTrigger\n          placement=\"top start\"\n          crossOffset={36}\n          showOnFocus\n          isDisabled={!props.errorMessage}\n          tooltip={\n            <ValidationTooltip>\n              <div {...errorMessageProps}>{props.errorMessage}</div>\n            </ValidationTooltip>\n          }\n          delay={0}\n        >\n          <Input\n            inputRef={inputRef}\n            placeholder={props.placeholder}\n            disabled={props.isDisabled}\n            validationState={props.validationState}\n            autoSelect={props.autoSelect}\n            autoFocus={props.autoFocus}\n            addonAfter={addonAfter}\n            addonBefore={addonBefore}\n            {...mergeProps(fieldProps, inputProps, {\n              value: props.value,\n              defaultValue: props.defaultValue,\n              onChange: (e: ChangeEvent<HTMLInputElement>) =>\n                props.onChange?.(e.target.value),\n            })}\n          />\n        </PositionedTooltipTrigger>\n        {contextHelp && (\n          <StyledContextHelp {...descriptionProps}>\n            {contextHelp}\n          </StyledContextHelp>\n        )}\n      </StyledBoxAndContextHelpWrapper>\n    </StyledInputContainer>\n  );\n});\n","import { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nconst getDefaultLinkColor = ({ theme }: { theme: Theme }) =>\n  theme.commonColors.linkForegroundEnabled;\n\nexport const StyledLink = styled.a`\n  cursor: pointer;\n  text-decoration: none;\n  outline: none;\n  // &:focus-visible didn't work as expected, so FocusRing is used\n  &.focus-visible {\n    outline: 1px solid\n      ${({ theme }) =>\n        theme.color(\n          \"Link.focusedBorderColor\" as UnknownThemeProp<\"Link.focusedBorderColor\">,\n          theme.commonColors.focusBorderColor\n        )};\n    border-radius: 2px; // Registry.intValue(\"ide.link.button.focus.round.arc\", 4)\n  }\n  color: ${getDefaultLinkColor};\n\n  &:hover,\n  &.hover /* for testing purposes*/ {\n    text-decoration: underline;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.hoverForeground\",\n        theme.color(\n          \"link.hover.foreground\" as UnknownThemeProp<\"link.hover.foreground\">,\n          \"\" /*FIXME: check*/\n        )\n      )};\n  }\n  &:active,\n  &.active {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.pressedForeground\",\n        theme.color(\n          \"link.pressed.foreground\" as UnknownThemeProp<\"link.pressed.foreground\">,\n          !theme.dark ? \"#F00000\" : \"#BA6F25\"\n        )\n      )};\n  }\n  &:disabled,\n  &.disabled {\n    cursor: default;\n    text-decoration: none;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.disabledForeground\" as UnknownThemeProp<\"Link.disabledForeground\">,\n        theme.color(\n          \"Label.disabledForeground\",\n          theme.color(\"Label.disabledText\", \"#999\")\n        )\n      )};\n  }\n  // We may need to refine this to allow passing visited as a prop for links that don't have href, and not apply the\n  // styles in that case, since it seems no href is considered visited by default. Although, in all main themes\n  // Link.visitedForeground is set to the default link color.\n  &:visited,\n  &.visited {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.visitedForeground\",\n        theme.color(\n          \"link.visited.foreground\" as UnknownThemeProp<\"link.visited.foreground\">,\n          !theme.dark ? \"#800080\" : \"#9776A9\"\n        )\n      )};\n  }\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { AriaLinkProps } from \"@react-types/link\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { FocusRing, useFocusable } from \"@react-aria/focus\";\nimport { StyledLink } from \"@intellij-platform/core/Link/StyledLink\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\n\nexport type LinkProps = AriaLinkProps & {\n  isDisabled?: boolean;\n  className?: string;\n  children: React.ReactNode;\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n  excludeFromTabOrder?: boolean;\n};\n\n/**\n * A focusable span in style of [Link](https://jetbrains.github.io/ui/controls/link/) and with accessibility role of link.\n *\n * TODO and known issues:\n * - in the reference impl, Space presses the link, Enter doesn't. It's vice versa here, because of how usePress is implemented.\n * - Support for External links\n * - Support for Anchor elements?\n *\n * Unknowns:\n * - What are ActionLink and DefaultLinkButtonUI?\n * - What is HyperLinkLabel compared to LabelLink (which was looked into in implementation of this component)?\n */\nexport const Link = React.forwardRef(\n  (\n    props: LinkProps,\n    forwardedRef: ForwardedRef<HTMLAnchorElement>\n  ): React.ReactElement => {\n    const ref = useForwardedRef(forwardedRef);\n\n    const { focusableProps } = useFocusable(props, ref);\n    const { pressProps, isPressed } = usePress({ ...props, ref });\n    const domProps = filterDOMProps(props, { labelable: true });\n    const interactionHandlers = mergeProps(focusableProps, pressProps);\n\n    return (\n      <FocusRing focusRingClass=\"focus-visible\">\n        <StyledLink\n          {...mergeProps(focusableProps, interactionHandlers, domProps)}\n          as=\"span\"\n          role=\"link\"\n          ref={ref}\n          // maybe use clsx\n          className={`${props.isDisabled ? \"disabled\" : \"\"} ${\n            isPressed ? \"active\" : \"\"\n          } ${props.className || \"\"}`}\n          aria-disabled={props.isDisabled || undefined}\n          tabIndex={\n            !props.isDisabled ? (props.excludeFromTabOrder ? -1 : 0) : undefined\n          }\n        >\n          {props.children}\n        </StyledLink>\n      </FocusRing>\n    );\n  }\n);\n","import { AriaListBoxProps } from \"@react-types/listbox\";\nimport { AsyncLoadable } from \"@react-types/shared\";\nimport React, { ForwardedRef, Key } from \"react\";\nimport { useList } from \"./useList\";\nimport { ListItem } from \"./ListItem\";\nimport { StyledList } from \"./StyledList\";\nimport { listItemRenderer } from \"./listItemRenderer\";\nimport { useListState } from \"./useListState\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { CollectionRefProps } from \"@intellij-platform/core/Collections/useCollectionRef\";\n\nexport type ListProps<T extends object> = Omit<\n  Omit<AriaListBoxProps<T>, \"disallowEmptySelection\">,\n  keyof AsyncLoadable\n> &\n  CollectionRefProps & {\n    /**\n     * fills the available horizontal or vertical space, when rendered in a flex container.\n     */\n    fillAvailableSpace?: boolean;\n    /**\n     * When true, shows the list in focused style, even when it's not focused. A common use case is when the list\n     * is virtually focused. i.e. the focus is physically on some other element (like a search input) which handles\n     * keyboard events as if the list was focused.\n     * Another (maybe questionable) use case is master detail views, where the master view is shown as focused, even\n     * when the details view has physical focus.\n     */\n    showAsFocused?: boolean;\n    allowEmptySelection?: boolean;\n    /**\n     * Called when the action for the item should be triggered, which can be by double click or pressing Enter.\n     * Enter not implemented yet :D\n     */\n    onAction?: (key: Key) => void;\n  };\n\n/**\n * List view with speedSearch instead of default typeahead.\n * TODO:\n *  - Support virtualization\n *  - Support custom rendering\n *  -\n */\nexport const List = React.forwardRef(function List<T extends object>(\n  {\n    allowEmptySelection = false,\n    showAsFocused = false,\n    fillAvailableSpace = false,\n    onAction,\n    ...inputProps\n  }: ListProps<T>,\n  forwardedRef: ForwardedRef<HTMLUListElement>\n) {\n  const props: AriaListBoxProps<T> & CollectionRefProps = {\n    ...inputProps,\n    disallowEmptySelection: !allowEmptySelection,\n  };\n  const ref = useObjectRef(forwardedRef);\n  const state = useListState(props);\n  const { listProps, focused } = useList(props, state, ref);\n\n  return (\n    <StyledList\n      fillAvailableSpace={fillAvailableSpace}\n      {...listProps}\n      ref={ref}\n    >\n      {[...state.collection].map(\n        listItemRenderer({\n          item: (item) => (\n            <ListItem\n              key={item.key}\n              item={item}\n              state={state}\n              onAction={() => onAction?.(item.key)}\n              listFocused={showAsFocused || focused}\n            />\n          ),\n        })\n      )}\n    </StyledList>\n  );\n});\n","import React from \"react\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { useSeparator } from \"@react-aria/separator\";\n\nexport const ListDivider: React.FC = () => {\n  return (\n    <StyledVerticalSeparator\n      as={\"li\"}\n      {...useSeparator({ elementType: \"li\", orientation: \"vertical\" })\n        .separatorProps}\n    />\n  );\n};\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { ListState } from \"@react-stately/list\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport { StyledListItem } from \"./StyledListItem\";\n\nexport interface ListItemProps<T> {\n  listFocused: boolean;\n  item: Node<T>;\n  state: ListState<T>;\n  onAction: () => void;\n  children?: React.ReactNode;\n}\n\nexport function ListItem<T>({\n  listFocused,\n  item,\n  state,\n  onAction,\n  children,\n}: ListItemProps<T>) {\n  const ref = React.useRef(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isSelected = state.selectionManager.isSelected(item.key);\n\n  const { itemProps } = useSelectableItem({\n    key: item.key,\n    ref,\n    onAction,\n    selectionManager: state.selectionManager,\n  });\n  let { pressProps } = usePress({\n    ...itemProps,\n    isDisabled,\n    preventFocusOnPress: false,\n  });\n\n  return (\n    <StyledListItem\n      containerFocused={listFocused}\n      selected={isSelected}\n      disabled={isDisabled}\n      aria-disabled={isDisabled}\n      aria-selected={isSelected}\n      {...pressProps}\n      ref={ref}\n    >\n      <ItemStateContext.Provider\n        value={{\n          isDisabled,\n          isSelected,\n          isContainerFocused: listFocused,\n          node: item,\n        }}\n      >\n        {children || item.rendered}\n      </ItemStateContext.Provider>\n    </StyledListItem>\n  );\n}\n","import { css } from \"styled-components\";\nimport { styled } from \"../styled\";\n\nexport const StyledList = styled.ul.withConfig<{\n  fillAvailableSpace?: boolean;\n}>({\n  shouldForwardProp: (prop) => prop !== \"fillAvailableSpace\",\n})`\n  padding: 0;\n  margin: 0;\n  list-style: none;\n  max-height: 100%;\n  overflow: auto;\n  color: ${({ theme }) => theme.color(\"*.textForeground\")};\n  outline: none;\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      height: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n    `}\n  background: ${({ theme }) => theme.color(\"List.background\")};\n`;\n","import { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"../styled\";\n\nexport type StyledListItemProps = {\n  containerFocused: boolean;\n  selected: boolean;\n  disabled: boolean;\n};\n\nexport const StyledListItem = styled.li<StyledListItemProps>(\n  ({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"List.foreground\" as UnknownThemeProp<\"List.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color = theme.asCurrentForeground(\n          theme.color(\n            \"List.selectionForeground\" as UnknownThemeProp<\"List.selectionForeground\">\n          ) || theme.commonColors.labelSelectedForeground\n        ) /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"List.selectionBackground\" as UnknownThemeProp<\"List.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"List.selectionInactiveForeground\" as UnknownThemeProp<\"List.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"List.selectionBackgroundInactive\" as UnknownThemeProp<\"List.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor,\n      color,\n      position: \"relative\",\n      display: \"flex\",\n      whiteSpace: \"nowrap\",\n      paddingLeft: \"0.5rem\", // themed?\n      paddingRight: \"0.5rem\", // themed?\n      lineHeight: \"20px\",\n      outline: \"none\",\n      cursor: \"default\",\n      minWidth: \"min-content\", // ?\n    };\n  }\n);\n","import { styled } from \"../styled\";\n\nexport const StyledListSectionHeader = styled.li(({ theme }) => ({\n  paddingLeft: 8,\n  fontWeight: \"bold\",\n  lineHeight: \"20px\",\n  outline: \"none\",\n  cursor: \"default\",\n  color: theme.color(\"*.textForeground\", theme.color(\"*.foreground\")),\n}));\n","import { Node } from \"@react-types/shared\";\nimport React from \"react\";\nimport { StyledListSectionHeader } from \"./StyledListSectionHeader\";\nimport { ListDivider } from \"./ListDivider\";\n\ninterface SectionNode<T> extends Node<T> {\n  type: \"section\";\n}\n\ninterface ItemNode<T> extends Node<T> {\n  type: \"item\";\n}\n\ninterface DividerNode<T> extends Node<T> {\n  type: \"divider\";\n}\n\nconst isItemNode = <T extends any>(node: Node<T>): node is ItemNode<T> =>\n  node.type === \"item\";\nconst isSectionNode = <T extends any>(node: Node<T>): node is SectionNode<T> =>\n  node.type === \"section\";\nconst isDividerNode = <T extends any>(node: Node<T>): node is DividerNode<T> =>\n  node.type === \"divider\";\n\ntype listItemRendererArgs<T extends any> = {\n  item: (item: ItemNode<T>) => React.ReactNode;\n  sectionHeader?: (item: SectionNode<T>) => React.ReactNode;\n};\nexport const listItemRenderer = <T extends any>({\n  item: renderItem,\n  sectionHeader: renderSectionHeader = (item) => (\n    <StyledListSectionHeader>{item.rendered}</StyledListSectionHeader>\n  ),\n}: listItemRendererArgs<T>) => {\n  return render;\n\n  function render(item: Node<T>): React.ReactNode {\n    if (isItemNode(item)) {\n      return renderItem(item);\n    }\n    if (isSectionNode(item)) {\n      return (\n        <React.Fragment key={item.key}>\n          {renderSectionHeader(item)}\n          {[...(item.childNodes as ItemNode<T>[])].map(render)}\n        </React.Fragment>\n      );\n    }\n    if (isDividerNode(item)) {\n      return <ListDivider key={item.key} />;\n    }\n    return null;\n  }\n};\n","import { AriaSelectableListOptions } from \"@react-aria/selection\";\nimport { ListState } from \"@react-stately/list\";\nimport React, { useEffect, useState } from \"react\";\nimport { useSelectableList } from \"./useSelectableList\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { CollectionRefProps } from \"@intellij-platform/core/Collections/useCollectionRef\";\n\nexport interface ListProps\n  extends Omit<\n      AriaSelectableListOptions,\n      | \"disallowEmptySelection\"\n      | \"selectOnFocus\"\n      | \"selectionManager\" // Grouped as state, the second argument, like in useListBox\n      | \"collection\" // Grouped as state, the second argument, like in useListBox\n      | \"disabledKeys\" // Grouped as state, the second argument, like in useListBox\n      | \"ref\" // Third argument\n    >,\n    CollectionRefProps {\n  allowEmptySelection?: boolean;\n  id?: string;\n}\n// import { useSelectableList } from \"@react-aria/selection\";\n\nexport function useList<T>(\n  props: ListProps,\n  state: ListState<T>,\n  ref: React.RefObject<HTMLElement>\n) {\n  const {\n    listProps: { onMouseDown, ...listProps },\n  } = useSelectableList({\n    ...props,\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    collection: state.collection,\n    disabledKeys: state.disabledKeys,\n    // if selectOnFocus is going to be an option (which is not in intellij UI), we should also conditionally show outline on items\n    selectOnFocus: true,\n  });\n  const [focused, setFocused] = useState(false);\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  // auto select the first item, if selection is empty and allowEmptySelection is false.\n  useEffect(() => {\n    const firstKey = state.collection.getFirstKey();\n    if (\n      !props.allowEmptySelection &&\n      state.selectionManager.isEmpty &&\n      firstKey\n    ) {\n      state.selectionManager.setFocusedKey(firstKey);\n      state.selectionManager.select(firstKey);\n    }\n  }, [!props.allowEmptySelection]);\n\n  return {\n    listProps: mergeProps(listProps, focusWithinProps),\n    focused,\n  };\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {\n  Collection,\n  FocusStrategy,\n  KeyboardDelegate,\n  Node,\n} from \"@react-types/shared\";\nimport { HTMLAttributes, Key, RefObject, useMemo } from \"react\";\nimport { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport {\n  MultipleSelectionManager,\n  SelectionManager,\n} from \"@react-stately/selection\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { useCollectionAutoScroll } from \"@intellij-platform/core/Collections/useCollectionAutoScroll\";\n\ninterface SelectableListOptions {\n  /**\n   * An interface for reading and updating multiple selection state.\n   */\n  selectionManager: MultipleSelectionManager;\n  /**\n   * State of the collection.\n   */\n  collection: Collection<Node<unknown>>;\n  /**\n   * The item keys that are disabled. These items cannot be selected, focused, or otherwise\n   * interacted with.\n   */\n  disabledKeys: Set<Key>;\n  /**\n   * A ref to the item.\n   */\n  ref: RefObject<HTMLElement>;\n  /**\n   * A delegate that returns collection item keys with respect to visual layout.\n   */\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Whether the collection or one of its items should be automatically focused upon render.\n   * @default false\n   */\n  autoFocus?: boolean | FocusStrategy;\n  /**\n   * Whether focus should wrap around when the end/start is reached.\n   * @default false\n   */\n  shouldFocusWrap?: boolean;\n  /**\n   * Whether the option is contained in a virtual scroller.\n   */\n  isVirtualized?: boolean;\n  /**\n   * Whether the collection allows empty selection.\n   * @default false\n   */\n  disallowEmptySelection?: boolean;\n  /**\n   * Whether selection should occur automatically on focus.\n   * @default false\n   */\n  selectOnFocus?: boolean;\n  /**\n   * Whether typeahead is disabled.\n   * @default false\n   */\n  disallowTypeAhead?: boolean;\n  /**\n   * Whether the collection items should use virtual focus instead of being focused directly.\n   */\n  shouldUseVirtualFocus?: boolean;\n  /**\n   * Whether navigation through tab key is enabled.\n   */\n  allowsTabNavigation?: boolean;\n}\n\ninterface SelectableListAria {\n  /**\n   * Props for the option element.\n   */\n  listProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles interactions with a selectable list.\n */\nexport function useSelectableList(\n  props: SelectableListOptions\n): SelectableListAria {\n  let {\n    selectionManager,\n    collection,\n    disabledKeys,\n    ref,\n    keyboardDelegate,\n    autoFocus,\n    shouldFocusWrap,\n    isVirtualized,\n    disallowEmptySelection,\n    selectOnFocus = false,\n    disallowTypeAhead,\n    shouldUseVirtualFocus,\n    allowsTabNavigation,\n  } = props;\n\n  // By default, a KeyboardDelegate is provided which uses the DOM to query layout information (e.g. for page up/page down).\n  // When virtualized, the layout object will be passed in as a prop and override this.\n  let collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n  let delegate = useMemo(\n    () =>\n      keyboardDelegate ||\n      new ListKeyboardDelegate(collection, disabledKeys, ref, collator),\n    [keyboardDelegate, collection, disabledKeys, ref, collator]\n  );\n  useCollectionAutoScroll(\n    { isVirtualized, selectionManager: selectionManager as SelectionManager },\n    ref\n  );\n\n  let { collectionProps } = useSelectableCollection({\n    ref,\n    selectionManager,\n    keyboardDelegate: delegate,\n    autoFocus,\n    shouldFocusWrap,\n    disallowEmptySelection,\n    selectOnFocus,\n    disallowTypeAhead,\n    shouldUseVirtualFocus,\n    allowsTabNavigation,\n  });\n\n  return {\n    listProps: collectionProps,\n  };\n}\n","import {\n  ListProps,\n  ListState,\n  useListState as originalUseListState,\n} from \"@react-stately/list\";\nimport {\n  CollectionRefProps,\n  useCollectionRef,\n} from \"@intellij-platform/core/Collections/useCollectionRef\";\n\nexport function useListState<T extends object>(\n  props: ListProps<T> & CollectionRefProps\n): ListState<T> {\n  const state = originalUseListState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  useCollectionRef(props, state);\n  return state;\n}\n","import React, { HTMLAttributes, HTMLProps } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { OverlayTriggerProps } from \"@react-types/overlays\";\n\nimport { useContextMenu } from \"./useContextMenu\";\nimport { MenuOverlay } from \"./MenuOverlay\";\n\ninterface ContextMenuContainerProps extends HTMLProps<HTMLDivElement> {\n  /**\n   * Will be called to return the Menu when context menu is triggered. Use {@link Menu} component to render a menu.\n   */\n  renderMenu: () => React.ReactNode;\n  /**\n   * If children is a function, context menu props is passed to it, to be passed to the underlying element.\n   * Otherwise, a div container will be rendered.\n   */\n  children:\n    | React.ReactNode\n    | ((props: HTMLAttributes<HTMLElement>) => React.ReactNode);\n}\n\n/**\n * A generic container for context menu. It's the same as a normal div, only with an additional `renderMenu` prop,\n * to be used to render context menu, when it's triggered.\n * Closes the menu when a menu action is triggered.\n */\nexport const ContextMenuContainer = ({\n  children,\n  renderMenu,\n  ...props\n}: ContextMenuContainerProps) => {\n  const state = useMenuTriggerState({} as OverlayTriggerProps);\n\n  const { overlayProps, containerProps, overlayRef } = useContextMenu(\n    {},\n    state\n  );\n  const allProps = mergeProps(props, containerProps);\n  return (\n    <>\n      {typeof children === \"function\" ? (\n        children(allProps)\n      ) : (\n        <div {...allProps}>{children}</div>\n      )}\n      <MenuOverlay\n        state={state}\n        overlayRef={overlayRef}\n        overlayProps={overlayProps}\n        restoreFocus\n      >\n        {renderMenu()}\n      </MenuOverlay>\n    </>\n  );\n};\n","import React, { useRef } from \"react\";\nimport { MenuTriggerState } from \"@react-stately/menu\";\nimport { useOverlay } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMouseEventOverlayPosition } from \"@intellij-platform/core/utils/useMouseEventOverlayPosition\";\nimport { areInNestedOverlays } from \"@intellij-platform/core/Overlay\";\n\n/**\n * Functionality and accessibility of context menu.\n */\nexport const useContextMenu = (\n  { isDisabled = false }: { isDisabled?: boolean },\n  state: MenuTriggerState\n) => {\n  /**\n   * NOTE: not using useMenuTrigger because:\n   * - There is no option to have a trigger like this: \"right click + long press only by touch\" which seems to be the\n   *   reasonable trigger for context menu. If we want to use it just for long press, we could disable it if it's not\n   *   a touch device, but that would be suboptimal, since both touch and mouse can be available, and it should depend\n   *   not on availability of touch, but on the triggered event type. Plus, isDisabled is broken in v<3.5.0\n   * - It's not quite clear at the moment, if the aria attributes that useMenuTrigger sets would be applicable in case\n   *   of this context menu component too. the trigger is not the container. For example, if there is a list rendered\n   *   inside, the selected item would be the trigger. Maybe even this component, as a container for context menu\n   *   is not the best way to allow for context menu, when comes to a11y concerns. For now, we skip a11y props of the\n   *   trigger. A11y props of the menu itself (e.g. aria-label) would also be up to the usage of this component.\n   *\n   *   TODO: add support for long touch\n   */\n  const onContextMenu = (e: React.MouseEvent<HTMLElement>) => {\n    e.preventDefault();\n    // NOTE: we can't use offsetX/offsetY, because it would depend on the exact target that was clicked.\n    if (!state.isOpen) {\n      state.open(null);\n    }\n    updatePosition(e);\n  };\n\n  const overlayRef = useRef(null);\n\n  const { overlayProps: positionProps, updatePosition } =\n    useMouseEventOverlayPosition({\n      overlayRef,\n      placement: \"bottom start\",\n      // shouldFlip should be false, but it doesn't work as expected. Overlay container is rendered within the view port\n      // but the menu overflows from the overlay container\n      shouldFlip: true,\n      offset: -8,\n      isOpen: state.isOpen,\n    });\n  const { overlayProps } = useOverlay(\n    {\n      onClose: () => {\n        return state.close();\n      },\n      shouldCloseOnBlur: false,\n      isOpen: state.isOpen,\n      isKeyboardDismissDisabled: false,\n      isDismissable: true,\n      shouldCloseOnInteractOutside: (element) => {\n        return !areInNestedOverlays(overlayRef.current, element);\n      },\n    },\n    overlayRef\n  );\n\n  const containerProps: React.HTMLAttributes<HTMLElement> = isDisabled\n    ? {}\n    : { onContextMenu };\n  return {\n    /**\n     * props to be applied on the container element which is supposed to have the context menu\n     */\n    containerProps,\n    /**\n     * The ref to be applied on the menu overlay wrapper. It's usually an input instead of an output in similar\n     * react-aria hooks, but it seemed unnecessary here.\n     */\n    overlayRef,\n    /**\n     * props to be applied on the menu overlay wrapper.\n     */\n    overlayProps: mergeProps(overlayProps, positionProps),\n  };\n};\n","import { Item, PartialNode, Section } from \"@react-stately/collections\";\nimport { Item as Item2 } from \"./Item\";\nimport {\n  CollectionBase,\n  CollectionElement,\n  ItemProps,\n  SectionProps,\n} from \"@react-types/shared\";\nimport React from \"react\";\n\nfunction* patchCollectionItem<T>(nodes: Generator<PartialNode<T>>) {\n  for (const partialNode of nodes)\n    yield {\n      ...partialNode,\n      *childNodes() {\n        const result2 = partialNode.childNodes?.();\n        if (result2) {\n          for (const partialChildNode of result2) {\n            const { type, ...partialChildNodeWithoutType } = partialChildNode;\n            yield partialChildNodeWithoutType;\n          }\n        }\n      },\n    };\n}\n\nconst PatchedItem = Item.bind(null);\n\n// @ts-expect-error: getCollectionNode is not public\nPatchedItem.getCollectionNode = function getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: any\n): Generator<PartialNode<T>> {\n  // @ts-expect-error getCollectionNode is not public API\n  return patchCollectionItem(Item.getCollectionNode(props, context));\n};\n\nconst PatchedSection = Section.bind(null);\n\n// @ts-expect-error: getCollectionNode is not public\nPatchedSection.getCollectionNode = function getCollectionNode<T>(\n  props: SectionProps<T>,\n  context: any\n): Generator<PartialNode<T>> {\n  // @ts-expect-error getCollectionNode is not public API\n  return patchCollectionItem(Section.getCollectionNode(props, context));\n};\nfunction convertCollectionElement<T>(\n  result: CollectionElement<T> | React.ReactNode\n): CollectionElement<T> {\n  if (\n    React.isValidElement(result) &&\n    (result.type === Item || result.type === Item2)\n  ) {\n    return React.createElement(\n      PatchedItem,\n      {\n        key: result.key != null ? result.key : undefined,\n        ...(result.props as ItemProps<T>),\n      },\n      convertChildren(result.props.children)\n    ) as CollectionElement<T>;\n  }\n  if (React.isValidElement(result) && result.type === Section) {\n    return React.createElement(\n      PatchedSection,\n      {\n        key: result.key != null ? result.key : undefined,\n        ...(result.props as SectionProps<T>),\n      } as any,\n      convertChildren((result.props as any).children)\n    ) as CollectionElement<T>;\n  }\n  return result as CollectionElement<T>;\n}\n\nfunction convertChildren<T>(children: React.ReactNode): React.ReactNode {\n  return Array.isArray(children)\n    ? // NOTE: We intentionally avoid using React.Children.map as it messes with keys.\n      children.map(convertChildren)\n    : convertCollectionElement(children);\n}\n\n/**\n * CollectionBuilder expects child type to be the same as parent type, which is weird in the first place:\n * https://github.com/adobe/react-spectrum/blob/cae83ff95f2f709b761c70d47ace96d6346ed873/packages/%40react-stately/collections/src/CollectionBuilder.ts#L148\n * On the other hand, the default Item components sets the `type` to item, for all child PartialNode objects:\n * https://github.com/adobe/react-spectrum/blob/c49d9819adc2cb63377f39557352440c72072caf/packages/%40react-stately/collections/src/Item.ts#L40-L54\n * Which is also a little unexpected, as in many nested collections, an item can have all types of children.\n * This function patches that, replacing Item elements with PatchedItem element which doesn't set type on children\n * PartialNodes.\n */\nexport function patchCollectionProps<T>({\n  children,\n  ...props\n}: CollectionBase<T>): CollectionBase<T> {\n  return {\n    ...props,\n    children:\n      typeof children === \"function\"\n        ? (node: T) => convertChildren(children(node)) as CollectionElement<T>\n        : (convertChildren(children) as CollectionElement<T>),\n  };\n}\n","import React, { CSSProperties, Key, RefObject, useContext } from \"react\";\nimport { AriaMenuOptions, useMenu as useMenuAria } from \"@react-aria/menu\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { AriaMenuProps } from \"@react-types/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { patchCollectionProps } from \"@intellij-platform/core/Collections/patchCollectionProps\";\nimport { TreeProps, useTreeState } from \"../Tree/useTreeState\"; // shared dependency between tree and menu, that could be lifted up import {Submenu} from '@intellij-platform/core/Menu/Submenu'\nimport { renderMenuNodes } from \"./renderMenuNodes\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { SubmenuProps } from \"./Submenu\"; // internal export\n\nexport interface MenuProps<T>\n  extends Omit<\n    AriaMenuProps<T>,\n    // selection is not properly supported for nested menus. Plus, it's not even that meaningful for a nested menu\n    // at least the way it's implemented now.\n    | \"onSelectionChange\"\n    | \"defaultSelectedKeys\"\n    | \"selectionMode\"\n    | \"disallowEmptySelection\"\n  > {\n  /**\n   * Indicates currently expanded menu item (controlled).\n   */\n  expandedKey?: Key; // FIXME: should be keys\n  /**\n   * Called when expanded menu item is changed by user interaction, which can be either hovering over the menu item\n   */\n  onExpandedKeyChange?: (expandedKey: Key) => void; // FIXME: should be keys\n  defaultExpandedKey?: Key; // FIXME: should be keys\n  /**\n   * @deprecated\n   */\n  expandOn?: \"hover\" | \"press\"; // hover delay doesn't seem to be needed as an option\n\n  /**\n   * Defines the press behaviour (either by mouse or by pressing Enter when focused) on menu items with submenu.\n   * By default (undefined), pressing or hovering over a menu item with submenu, opens the submenu.\n   * When set to \"toggle\", pressing a menu item with submenu will toggle the submenu. Hovering over such items will\n   * no longer open the submenu.\n   * When set to \"action\", pressing a menu item with submenu will call onAction for that item, and closes the menu.\n   * Hovering over such items will no longer open the submenu.\n   *\n   * In all cases, pressing the right arrow will always open the submenu.\n   */\n  submenuBehavior?: \"default\" | \"toggleOnPress\" | \"actionOnPress\";\n\n  /**\n   * fills the available horizontal or vertical space, when rendered in a flex container.\n   */\n  fillAvailableSpace?: boolean;\n\n  /**\n   * Minimum width of the menu\n   * @default: 120px\n   */\n  minWidth?: CSSProperties[\"minWidth\"];\n}\n\n/**\n * Can be provided by the overlay where the menu is rendered in. If provided, menu will call the provided close function\n * on actions. Note that there is no `closeOnSelect` option as of now, on this context, since no use case seems to exist\n * for keeping the menu overlay open after a menu item is selected.\n * **Update**: there are use cases where the menu is not closed after an item is clicked. Most of the toggle-able\n * actions (the ones with a checkmark) seem to be like this.\n * TODO: Make \"close on selection\" more flexible. Some ideas:\n *  - instead of calling close, pass it to `onAction` handler. Then on each action, one would need to call close if\n *    needed.\n *  - Offer a `MenuItem` component to be used instead of generic `Item`, where it accepts `closeOnSelect` boolean, which\n *    is true by default.\n *  - pass a `keepOpen` function to `onAction`.\n *  - Allow signaling whether the menu should kept open, via the returned value of onAction. e.g. return false means keep open.\n *  Last two suggestions are based on the assumption that most of the menu items are not selectable.\n *  Note that MenuOverlayContext could be used directly in action handlers too, but baking it into the menu makes it\n *  much more convenient, which seems more important than breaking the nice separation between Menu and MenuTrigger.\n */\nexport const MenuOverlayContext = React.createContext({ close: () => {} });\nexport const MenuContext = React.createContext<\n  Pick<\n    MenuProps<unknown>,\n    \"onClose\" | \"onAction\" | \"submenuBehavior\" | \"autoFocus\"\n  > & {\n    itemWrapper?: (\n      renderedItem: React.ReactNode,\n      item: Node<unknown>\n    ) => React.ReactNode;\n    renderSubmenu?: (props: SubmenuProps<unknown>) => React.ReactNode;\n  }\n>({});\n\nexport function useMenu<T>(\n  {\n    onAction: onActionProp,\n    submenuBehavior = \"default\",\n    ...props\n  }: MenuProps<T> & AriaMenuOptions<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const { close } = useContext(MenuOverlayContext);\n  const onClose = () => {\n    props.onClose?.();\n    close();\n  };\n  const onAction = (key: Key) => {\n    if (\n      // The following check should have been in useMenu, but it's not currently. Probably because they haven't yet\n      // covered nested menus.\n      !state.collection.getItem(key)?.hasChildNodes\n    ) {\n      return onActionProp?.(key);\n    } else if (submenuBehavior === \"actionOnPress\") {\n      onClose();\n      return onActionProp?.(key);\n    }\n  };\n  const menuContextValue: React.ContextType<typeof MenuContext> = {\n    submenuBehavior,\n    autoFocus: props.autoFocus,\n    onAction,\n    onClose,\n  };\n  const { menuProps } = useMenuAria(\n    { ...props, onAction, onClose },\n    state,\n    ref\n  );\n\n  return {\n    menuProps,\n    menuContextValue,\n  };\n}\n\nexport function useMenuState<T extends object>(\n  props: TreeProps<T> &\n    Pick<\n      MenuProps<T>,\n      \"expandedKey\" | \"defaultExpandedKey\" | \"onExpandedKeyChange\"\n    >\n) {\n  props = patchCollectionProps(props);\n  return useTreeState({\n    ...props,\n    childExpansionBehaviour: \"single\",\n    expandedKeys: props.expandedKey ? [props.expandedKey] : undefined,\n    onExpandedChange: ([firstKey]) => props?.onExpandedKeyChange?.(firstKey),\n    defaultExpandedKeys: props.defaultExpandedKey\n      ? [props.defaultExpandedKey]\n      : undefined,\n  });\n}\n\n/**\n * UI for menus which are normally shown in a popover. Being rendered as an overlay is not handled here.\n * Also, there is no coupling with any higher level entity like \"Action\", since this is just for the UI layer.\n * Something like ActionMenu which creates a menu out of a list of actions can be implemented on top of this.\n *\n * @example\n *  <Menu>\n *    <Item>Item one</Item>\n *    <Item>\n *      <MenuItemLayout\n *        icon={<PlatformIcon icon={\"actions/copy\"} />}\n *        content=\"Copy\"\n *        shortcut={\"C\"} />\n *    </Item>\n *  </Menu>\n *\n *  Current issues and limitations:\n *  - Divider in sub-menu's is not supported. because of a constraint in @react-stately/collections, which results in\n *    this error: Unsupported type <Divider> in <Item>. Only <Item> is supported. Maybe supporting section would\n *    be a workaround for it.\n *  - when a parent menu item which has an open submenu is hovered, it gets focus.\n */\nexport function Menu<T extends object>({ minWidth, ...props }: MenuProps<T>) {\n  const ref = React.useRef<HTMLUListElement>(null);\n  const state = useMenuState(props);\n  const { menuContextValue, menuProps } = useMenu(props, state, ref);\n\n  return (\n    /**\n     * MenuContext is used to pass onAction and onClose to be passed to useMenu in submenus.\n     * That's needed because in useMenuItem onAction and onClose are read off a WeakMap which has the menu state\n     * (TreeState) as key. So we have to pass onAction and onClose everytime we call useMenu in submenus, to let the\n     * menu items in that submenu access the right value of onAction and onClose. To avoid drilling these props down,\n     * we keep it in a context.\n     */\n    <MenuContext.Provider value={menuContextValue}>\n      <StyledMenu\n        {...menuProps}\n        ref={ref}\n        style={{ minWidth }}\n        fillAvailableSpace={props.fillAvailableSpace}\n      >\n        {renderMenuNodes(state, [...state.collection])}\n      </StyledMenu>\n    </MenuContext.Provider>\n  );\n}\n","import React, { HTMLAttributes, ReactNode, RefObject, useContext } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { isFocusVisible, useHover, usePress } from \"@react-aria/interactions\";\nimport {\n  AriaMenuItemProps,\n  MenuItemAria,\n  useMenuItem as useMenuItemAria,\n} from \"@react-aria/menu\";\nimport { useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { FocusableElement, Node } from \"@react-types/shared\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\nimport { Overlay } from \"@intellij-platform/core/Overlay\";\n\nimport { LafIcon, PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\nimport { MenuContext, MenuProps } from \"./Menu\";\nimport { MENU_BORDER_WIDTH, MENU_VERTICAL_PADDING } from \"./StyledMenu\";\nimport {\n  StyledMenuItem,\n  StyledMenuItemIcon,\n  StyledNestedArrow,\n} from \"./StyledMenuItem\";\nimport { Submenu, SubmenuProps } from \"@intellij-platform/core/Menu/Submenu\";\n\nexport interface MenuItemProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  onSubmenuClose?: () => void;\n}\n\nconst StyledMenuItemText = styled.span`\n  flex: 1;\n`;\n\nconst StyledMenuItemPlatformIcon = styled(PlatformIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nconst StyledMenuItemLafIcon = styled(LafIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nfunction useMenuItem<T extends unknown>(\n  {\n    submenuBehavior,\n    ...props\n  }: AriaMenuItemProps & { submenuBehavior: MenuProps<T>[\"submenuBehavior\"] },\n  state: TreeState<T>,\n  ref: RefObject<FocusableElement>\n): MenuItemAria {\n  const item = state.collection.getItem(props.key!);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const hasSubmenu = item.hasChildNodes;\n  const { menuItemProps: ariaMenuItemProps, ...result } = useMenuItemAria(\n    {\n      key: item.key,\n      // hack to prevent react-aria to call onClose when nested items are selected, which is incorrect, and because\n      // react-aria doesn't officially support nested menus at the moment\n      onClose: hasSubmenu ? () => {} : undefined,\n    },\n    state,\n    ref\n  );\n\n  // useMenuItem in react aria utilizes useHover to focus item on hover. The logic there conflicts with nested menus\n  // requirements (at least based on how nested menu is implemented here currently). Also, submenuBehavior requires\n  // some more customization. So we delete the handlers set by useHover in useMenuItem, and add a custom useHover.\n  delete ariaMenuItemProps.onMouseEnter;\n  delete ariaMenuItemProps.onPointerEnter;\n\n  if (submenuBehavior === \"default\" && isExpanded) {\n    // When menu item has its submenu opened, clicking it should not move focus or do anything.\n    delete ariaMenuItemProps.onPointerDown;\n  }\n\n  const { hoverProps } = useHover({\n    isDisabled: isDisabled,\n    onHoverStart: () => {\n      const isAnySubmenuOpen = [...state.expandedKeys].some(\n        (expandedKey) =>\n          state.collection.getItem(expandedKey)?.parentKey === item.parentKey\n      );\n\n      if (submenuBehavior === \"default\" && !isExpanded) {\n        state.toggleKey(item.key);\n      }\n\n      if (!isFocusVisible()) {\n        const shouldFocus =\n          submenuBehavior === \"default\" ? !isExpanded : !isAnySubmenuOpen;\n        if (shouldFocus) {\n          state.selectionManager.setFocused(true);\n        }\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  const keyboardProps = {\n    onKeyDown: (e: React.KeyboardEvent) => {\n      if (\n        ((e.key === \"Enter\" || e.key === \" \") &&\n          submenuBehavior !== \"actionOnPress\") ||\n        \"ArrowRight\" === e.key\n      ) {\n        state.toggleKey(item.key);\n        e.stopPropagation();\n        return;\n      }\n    },\n  };\n\n  const { pressProps: togglePressProps } = usePress({\n    isDisabled: isDisabled,\n    onPressUp: () => {\n      state.toggleKey(item.key);\n      if (isExpanded) {\n        // submenu was expanded and is closed now. moving focus back to the parent item\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  return {\n    ...result,\n    menuItemProps: mergeProps(\n      hasSubmenu\n        ? {\n            \"aria-expanded\": isExpanded,\n            \"aria-haspopup\": \"menu\",\n          }\n        : {},\n      ariaMenuItemProps,\n      hoverProps,\n      keyboardProps,\n      submenuBehavior === \"toggleOnPress\" ? togglePressProps : {}\n    ),\n  };\n}\n\nconst MenuItemContext = React.createContext<{\n  labelProps: HTMLAttributes<HTMLElement>;\n  descriptionProps: HTMLAttributes<HTMLElement>;\n  keyboardShortcutProps: HTMLAttributes<HTMLElement>;\n}>({ descriptionProps: {}, labelProps: {}, keyboardShortcutProps: {} });\n\nexport const useMenuItemLayout = () => {\n  return useContext(MenuItemContext);\n};\n\nexport function MenuItem<T>({ item, state }: MenuItemProps<T>) {\n  // Get props for the menu item element\n  const ref = React.useRef<HTMLLIElement>(null);\n  const nestedMenuRef = React.useRef<HTMLDivElement>(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const isSelected = state.selectionManager.selectedKeys.has(item.key);\n  const isFocused = state.selectionManager.focusedKey === item.key;\n  const {\n    onClose,\n    submenuBehavior,\n    renderSubmenu = (props: SubmenuProps<T>) => <Submenu {...props} />,\n    itemWrapper = (i: React.ReactNode) => i,\n  } = useContext(MenuContext);\n\n  const { menuItemProps, labelProps, descriptionProps, keyboardShortcutProps } =\n    useMenuItem(\n      {\n        submenuBehavior,\n        key: item.key,\n      },\n      state,\n      ref\n    );\n\n  const { pressProps: togglePressProps } = usePress({\n    isDisabled: isDisabled,\n    onPressUp: () => {\n      state.toggleKey(item.key);\n      if (isExpanded) {\n        // submenu was expanded and is closed now. moving focus back to the parent item\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  let { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: ref,\n    overlayRef: nestedMenuRef,\n    placement: \"right top\",\n    shouldFlip: true,\n    onClose,\n    offset: 0,\n    crossOffset: -(MENU_VERTICAL_PADDING + MENU_BORDER_WIDTH),\n    isOpen: isExpanded,\n  });\n\n  const arrowProps: HTMLAttributes<HTMLElement> =\n    submenuBehavior !== \"default\"\n      ? {\n          role: \"button\",\n          \"aria-label\": \"Open\",\n          ...mergeProps(togglePressProps, {\n            // to prevent pointer up event handler on the item, which would trigger action.\n            onPointerUp: (e: React.PointerEvent) => e.stopPropagation(),\n          }),\n        }\n      : {};\n  return (\n    <>\n      <StyledMenuItem\n        {...menuItemProps}\n        isDisabled={isDisabled}\n        isActive={isFocused}\n        ref={ref}\n      >\n        {isSelected && (\n          <StyledMenuItemIcon>\n            <StyledMenuItemLafIcon\n              icon={{\n                name: \"checkmark\",\n                modifiers: { Selected: isFocused },\n              }}\n            />\n          </StyledMenuItemIcon>\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isContainerFocused: state.selectionManager.isFocused,\n            isSelected,\n            node: item,\n          }}\n        >\n          <MenuItemContext.Provider\n            value={{ labelProps, descriptionProps, keyboardShortcutProps }}\n          >\n            {itemWrapper(\n              typeof item.rendered === \"string\" ? (\n                <StyledMenuItemText {...labelProps}>\n                  {item.rendered}\n                </StyledMenuItemText>\n              ) : (\n                item.rendered\n              ),\n              item\n            )}\n          </MenuItemContext.Provider>\n        </ItemStateContext.Provider>\n        {item.hasChildNodes && (\n          <StyledNestedArrow {...arrowProps}>\n            <StyledMenuItemPlatformIcon icon=\"icons/ide/menuArrow\" />\n          </StyledNestedArrow>\n        )}\n      </StyledMenuItem>\n      {isExpanded && (\n        /**\n         * A note about using Overlay:\n         * If sub-menu is not rendered in a portal, useOverlayPosition doesn't work properly and the submenu may\n         * be rendered offscreen. Worse, it may introduce scroll in body (or some scrollable ancestor), which will\n         * trigger a scroll event which closes the menu if the menu is rendered in an overlay (like in MenuTrigger),\n         * which is almost always the case.\n         *\n         */\n        <Overlay\n          OverlayComponent={\n            /**\n             *  The FocusScope included in the default Overlay, messes with a particular expected behavior. So we use\n             *  SimpleOverlay, which just renders its children as a portal. There may be a better solution for that\n             *  problem, which would eliminate the need for the funky `OverlayComponent` prop on our `Overlay`\n             *  component. Something to look into in the future.\n             */\n            SimpleOverlay\n          }\n        >\n          <div ref={nestedMenuRef} {...positionProps}>\n            {renderSubmenu({ parentState: state, rootKey: item.key })}\n          </div>\n        </Overlay>\n      )}\n    </>\n  );\n}\n\n/**\n * A replacement for react-aria Overlay, which doesn't render FocusScope\n */\nfunction SimpleOverlay({\n  children,\n  portalContainer = document.body,\n}: {\n  children: ReactNode;\n  portalContainer?: Element | undefined;\n}) {\n  return ReactDOM.createPortal(children, portalContainer);\n}\n","import React from \"react\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { useContextOrThrow } from \"@intellij-platform/core/utils/useContextOrThrow\";\n\nimport { useMenuItemLayout } from \"./MenuItem\";\nimport { StyledMenuItemIcon } from \"./StyledMenuItem\";\n\ninterface MenuItemLayoutProps {\n  icon?: React.ReactNode;\n  content: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\nconst StyledMenuItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  flex: 1; // to make sure it takes as much space as available in the menu item row, so that the suffix (shortcut) is pushed to the right\n`;\nconst Content = styled.span`\n  flex: 1;\n`;\n\nconst Shortcut = styled.kbd`\n  font-family: system-ui, sans-serif;\n  margin-left: 30px;\n  margin-right: -0.625rem;\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"MenuItem.acceleratorForeground\")\n    )};\n`;\n\nexport const MenuItemLayout = ({\n  content,\n  shortcut,\n  icon,\n}: MenuItemLayoutProps) => {\n  const { isSelected } = useContextOrThrow(\n    ItemStateContext,\n    \"MenuItemLayout is meant to be rendered in Item component in Menus\"\n  );\n  const { labelProps, keyboardShortcutProps } = useMenuItemLayout();\n  const allowedIcon = !isSelected && icon;\n  return (\n    <StyledMenuItemLayout>\n      {allowedIcon && <StyledMenuItemIcon>{allowedIcon}</StyledMenuItemIcon>}\n      <Content {...labelProps}>{content}</Content>\n      {shortcut && <Shortcut {...keyboardShortcutProps}>{shortcut}</Shortcut>}\n    </StyledMenuItemLayout>\n  );\n};\n","import React, { HTMLProps } from \"react\";\nimport { MenuTriggerState } from \"@react-stately/menu\";\nimport { FocusScope } from \"@intellij-platform/core/utils/FocusScope\";\nimport { MenuOverlayContext } from \"@intellij-platform/core/Menu/Menu\";\nimport { Overlay } from \"@intellij-platform/core/Overlay\";\n\n/**\n * Overlay container for menu. Extracted into a separate component, to be used by components like MenuTrigger or\n * ContextMenuContainer, that need to render a menu as an overlay.\n * @private\n */\nexport function MenuOverlay({\n  children,\n  restoreFocus,\n  overlayProps,\n  overlayRef,\n  state,\n}: {\n  children: React.ReactNode;\n  restoreFocus?: boolean;\n  overlayProps: HTMLProps<HTMLDivElement>;\n  overlayRef: React.Ref<HTMLDivElement>;\n  state: MenuTriggerState;\n}) {\n  if (!state.isOpen) {\n    return null;\n  }\n  return (\n    <Overlay>\n      <FocusScope\n        restoreFocus={restoreFocus}\n        forceRestoreFocus={restoreFocus}\n        autoFocus\n      >\n        <MenuOverlayContext.Provider value={state}>\n          <div {...overlayProps} ref={overlayRef}>\n            {children}\n          </div>\n        </MenuOverlayContext.Provider>\n      </FocusScope>\n    </Overlay>\n  );\n}\n","import React, { HTMLAttributes, RefObject } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { useMenuTrigger } from \"@react-aria/menu\";\nimport { useOverlay, useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { MenuTriggerProps as AriaMenuTriggerProps } from \"@react-types/menu\";\n\nimport { MenuOverlay } from \"./MenuOverlay\";\nimport { AriaButtonProps } from \"@react-types/button\";\n\nexport interface MenuTriggerProps\n  extends Omit<AriaMenuTriggerProps, \"closeOnSelect\"> {\n  restoreFocus?: boolean;\n  // TODO: replace render function children with normal children, and utilize PressResponder. Add a story for the\n  //  edge case of custom trigger, using PressResponder\n  children: (\n    props: HTMLAttributes<HTMLButtonElement>,\n    ref: RefObject<any> // Using a generic didn't seem to work for some reason\n  ) => React.ReactNode;\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean;\n  /**\n   * By default, the menu is positioned relative to the trigger. `positioningTargetRef` can be used to have the menu\n   * positioned to another element. An example use case is when the menu trigger is a button inside some list item or\n   * text box, but the menu semantically belongs to the container list item or text box.\n   */\n  positioningTargetRef?: React.RefObject<HTMLElement>;\n  renderMenu: (props: {\n    menuProps: React.HTMLAttributes<HTMLElement>;\n  }) => React.ReactNode;\n}\n\n// FIXME: Escape doesn't close the menu\n// FIXME: Focus is not restored if nested menu are opened. It may be solved by using useOverlay and closing submenu in click outside.\n// FIXME: use PressResponder and replace render prop children with a normal react dom children. Issues with current impl:\n//  disabled trigger doesn't work as expected. props passed to children fn is html props, which is limiting for button\n//  components that don't accept arbitrary dom props.\n/**\n * Makes its children a trigger for a menu, rendered via {@link MenuTriggerProps#renderMenu} prop.\n * Closes the menu when a menu action is triggered.\n */\nexport const MenuTrigger: React.FC<MenuTriggerProps> = ({\n  children,\n  renderMenu,\n  direction = \"bottom\",\n  align = \"start\",\n  shouldFlip = true,\n  restoreFocus = true,\n  preventFocusOnPress = true,\n  positioningTargetRef,\n  ...otherProps\n}) => {\n  const menuTriggerProps: AriaMenuTriggerProps = {\n    ...otherProps,\n    direction,\n    align,\n    shouldFlip,\n  };\n  const state = useMenuTriggerState(menuTriggerProps);\n  const triggerRef = React.useRef(null);\n  const overlayRef = React.useRef(null);\n  // FIXME: Menu props is not used, but it's just about labelBy and id. Only needed for accessibility, but it would\n  //  require a `renderMenu` prop, instead of `menu`.\n  const { menuTriggerProps: triggerProps, menuProps } = useMenuTrigger(\n    { type: \"menu\" },\n    state,\n    triggerRef\n  );\n  const ariaButtonProps: AriaButtonProps<\"button\"> = {\n    ...triggerProps,\n    // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n    preventFocusOnPress,\n  };\n  const { buttonProps } = useButton(ariaButtonProps, triggerRef);\n  const { overlayProps } = useOverlay(\n    {\n      onClose: () => {\n        return state.close();\n      },\n      shouldCloseOnBlur: false,\n      isOpen: state.isOpen,\n      isKeyboardDismissDisabled: false,\n      isDismissable: true,\n      shouldCloseOnInteractOutside: (element) => {\n        // FIXME: this is kind of hacky and should be removed when nested menu is properly supported\n        return !element.matches(\"[role=menu] *\");\n      },\n    },\n    overlayRef\n  );\n\n  const { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: positioningTargetRef ?? triggerRef,\n    overlayRef,\n    placement: getPlacement(direction, align),\n    shouldFlip,\n    offset: 0,\n    containerPadding: 0,\n    isOpen: state.isOpen,\n  });\n\n  return (\n    <>\n      {children(buttonProps, triggerRef)}\n      <MenuOverlay\n        overlayProps={mergeProps(overlayProps, positionProps)}\n        overlayRef={overlayRef}\n        state={state}\n        restoreFocus={restoreFocus}\n      >\n        {renderMenu({ menuProps })}\n      </MenuOverlay>\n    </>\n  );\n};\n\nfunction getPlacement(\n  direction: Required<AriaMenuTriggerProps>[\"direction\"],\n  align: Required<AriaMenuTriggerProps>[\"align\"]\n) {\n  switch (direction) {\n    case \"left\":\n    case \"right\":\n    case \"start\":\n    case \"end\":\n      return `${direction} ${align === \"end\" ? \"bottom\" : \"top\"}` as const;\n    case \"bottom\":\n    case \"top\":\n    default:\n      return `${direction} ${align}` as const;\n  }\n}\n","import React, {\n  HTMLAttributes,\n  RefObject,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport {\n  mergeProps,\n  useLayoutEffect,\n  useResizeObserver,\n} from \"@react-aria/utils\";\nimport { focusSafely } from \"@react-aria/focus\";\nimport { ListCollection } from \"@react-stately/list\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  useCollectionSpeedSearch,\n  CollectionSpeedSearchMatches,\n} from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport {\n  SpeedSearchInput,\n  SpeedSearchPopupProps,\n  SpeedSearchState,\n} from \"@intellij-platform/core/SpeedSearch\";\n\nimport { StyledMenu } from \"./StyledMenu\";\nimport { MenuContext, MenuProps, useMenu, useMenuState } from \"./Menu\";\nimport { renderMenuNodes } from \"./renderMenuNodes\";\nimport { SubmenuProps, useSubmenu } from \"./Submenu\";\nimport { useSubmenuState } from \"./_useSubmenuState\";\nimport { MenuKeyboardDelegate } from \"./_useSubmenu\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\n\nexport interface SpeedSearchMenuProps<T>\n  extends Omit<MenuProps<T>, \"submenuBehavior\"> {\n  submenuBehavior?: Exclude<MenuProps<T>[\"submenuBehavior\"], \"default\">;\n  /**\n   * Text to show when the filtering is active but no match is found for the current query.\n   * @default \"Nothing to show\"\n   */\n  emptyText?: React.ReactNode;\n}\n\nconst StyledItemsContainer = styled.ul`\n  all: unset;\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledSearchFieldWrapper = styled.div`\n  flex-shrink: 0;\n  padding: 0 0.2rem 0.3rem;\n`;\n\nconst StyledSpeedSearchMenu = styled(StyledMenu)`\n  --jui-menu-item-padding: 1.25rem;\n  ${StyledVerticalSeparator} {\n    margin: 0 3px; // FIXME: probably use theme\n  }\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) =>\n    // Ref: StatusText => DEFAULT_ATTRIBUTES => SimpleTextAttributes.GRAYED_ATTRIBUTES\n    theme.color(\n      \"Component.infoForeground\",\n      theme.dark ? \"#787878\" : \"#999999\"\n    )};\n\n  // center positioning. Intentionally different from reference impl.\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n\n  white-space: nowrap;\n`;\n\nfunction useSpeedSearchMenu<T>(\n  state: TreeState<T>,\n  rootKey: React.Key | null,\n  ref: React.RefObject<HTMLUListElement>,\n  containerRef: React.RefObject<HTMLDivElement>\n) {\n  const {\n    speedSearch,\n    selectionManager,\n    keyboardDelegate,\n    containerProps: speedSearchContainerProps,\n    searchPopupProps,\n  } = useCollectionSpeedSearch({\n    collection: useMemo(\n      () =>\n        new ListCollection(\n          rootKey\n            ? state.collection.getItem(rootKey).childNodes\n            : state.collection\n        ),\n      [rootKey, state.collection]\n    ),\n    selectionManager: state.selectionManager,\n    keyboardDelegate: new MenuKeyboardDelegate(\n      rootKey,\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    stickySearch: true,\n    focusBestMatch: true,\n    ref,\n  });\n\n  // When a menu item which was focused is filtered out, the focus goes to body.\n  // We manually move focus back to the container.\n  useEffect(() => {\n    const element = ref.current;\n    if (\n      element &&\n      state.selectionManager.isFocused &&\n      !element?.contains(document.activeElement)\n    ) {\n      focusSafely(element);\n    }\n  });\n\n  const lastSize = useRef<{ width: number; height: number } | null>(null);\n  const [size, setSize] = useState<{ width: number; height: number } | null>(\n    null\n  );\n  const measureSize = () => {\n    const { offsetWidth = 0, offsetHeight = 0 } = containerRef.current || {};\n    if (offsetWidth > 0 && offsetHeight > 0) {\n      lastSize.current = {\n        width: offsetWidth,\n        height: offsetHeight,\n      };\n    }\n  };\n  const isSearchActive =\n    speedSearch.active && speedSearch.searchTerm.length > 0;\n  useResizeObserver({\n    ref: containerRef,\n    onResize: useEventCallback(() => {\n      if (!isSearchActive) {\n        measureSize();\n      }\n    }),\n  });\n  useLayoutEffect(() => {\n    if (isSearchActive) {\n      if (lastSize.current) {\n        setSize(lastSize.current);\n      }\n    } else {\n      if (!lastSize.current) {\n        measureSize();\n      }\n      setSize(null);\n    }\n  }, [isSearchActive]);\n\n  const sizeStyleProps: HTMLAttributes<HTMLElement> = size\n    ? {\n        style: {\n          ...size,\n          minHeight: size.height,\n          maxHeight: size.height,\n        },\n      }\n    : {};\n  return {\n    speedSearch,\n    keyboardDelegate,\n    selectionManager,\n    speedSearchContainerProps: mergeProps<HTMLAttributes<HTMLElement>[]>(\n      speedSearchContainerProps,\n      sizeStyleProps,\n      {\n        onMouseDown: (e: React.MouseEvent) => {\n          // Until SearchInput and connecting that to a selectable list is implemented, we should prevent menu from\n          // losing focus when the fake search input is clicked\n          e.preventDefault();\n        },\n      }\n    ),\n    searchPopupProps,\n  };\n}\n\n/**\n * Drop-in replacement for Menu, which implements SpeedSearch.\n *\n *\n */\nexport const SpeedSearchMenu = <T extends object>({\n  submenuBehavior = \"toggleOnPress\",\n  autoFocus = \"first\",\n  emptyText = \"Nothing to show\",\n  minWidth,\n  ...props\n}: SpeedSearchMenuProps<T>) => {\n  const onAction = (key: React.Key) => {\n    props.onAction?.(key);\n    speedSearch.clear();\n  };\n  const ref = React.useRef<HTMLUListElement>(null);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const state = useMenuState({ ...props });\n  const {\n    speedSearch,\n    speedSearchContainerProps,\n    searchPopupProps,\n    keyboardDelegate,\n  } = useSpeedSearchMenu(state, null, ref, containerRef);\n  const { menuContextValue, menuProps } = useMenu(\n    {\n      ...props,\n      autoFocus,\n      onAction,\n      keyboardDelegate,\n      submenuBehavior,\n    },\n    state,\n    ref\n  );\n\n  return (\n    <MenuContext.Provider\n      value={{\n        ...menuContextValue,\n        renderSubmenu: (props) => (\n          <SpeedSearchSubmenu emptyText={emptyText} {...props} />\n        ),\n      }}\n    >\n      <StyledSpeedSearchMenu\n        as=\"div\"\n        ref={containerRef}\n        style={{ minWidth }}\n        {...speedSearchContainerProps}\n        fillAvailableSpace={props.fillAvailableSpace}\n      >\n        <SpeedSearchMenuContent\n          items={[...state.collection]}\n          emptyText={emptyText}\n          speedSearch={speedSearch}\n          searchPopupProps={searchPopupProps}\n          state={state}\n          menuProps={menuProps}\n          menuRef={ref}\n        />\n      </StyledSpeedSearchMenu>\n    </MenuContext.Provider>\n  );\n};\n\nfunction SpeedSearchMenuContent<T>({\n  items,\n  state,\n  speedSearch,\n  searchPopupProps,\n  menuProps,\n  menuRef,\n  emptyText,\n}: {\n  state: TreeState<T>;\n  items: Node<T>[];\n  speedSearch: SpeedSearchState & { matches: CollectionSpeedSearchMatches };\n  searchPopupProps: SpeedSearchPopupProps;\n  menuProps: HTMLAttributes<HTMLElement>;\n  menuRef: RefObject<HTMLUListElement>;\n  emptyText: React.ReactNode;\n}) {\n  const filter = speedSearch.active\n    ? ({ key, type }: Node<T>) =>\n        type !== \"item\" || speedSearch.matches.has(key)\n    : undefined;\n  return (\n    <>\n      {searchPopupProps.children && (\n        <StyledSearchFieldWrapper\n          onClick={(e) => {\n            e.preventDefault();\n          }}\n        >\n          <SpeedSearchInput {...searchPopupProps} clear={speedSearch.clear} />\n        </StyledSearchFieldWrapper>\n      )}\n      <StyledItemsContainer {...menuProps} ref={menuRef}>\n        {renderMenuNodes(state, items, filter)}\n        {speedSearch.active && speedSearch.matches.size === 0 && (\n          <StyledPlaceholder>{emptyText}</StyledPlaceholder>\n        )}\n      </StyledItemsContainer>\n    </>\n  );\n}\n\nfunction SpeedSearchSubmenu<T>({\n  parentState,\n  rootKey,\n  emptyText,\n}: SubmenuProps<T> & { emptyText: React.ReactNode }) {\n  const ref = useRef<HTMLUListElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const state = useSubmenuState(parentState);\n  const rootItem = state.collection.getItem(rootKey);\n\n  const {\n    speedSearch,\n    speedSearchContainerProps,\n    searchPopupProps,\n    keyboardDelegate,\n  } = useSpeedSearchMenu(state, rootKey, ref, containerRef);\n  const { submenuProps } = useSubmenu(\n    { rootKey, parentState, keyboardDelegate },\n    state,\n    ref\n  );\n\n  return (\n    <StyledSpeedSearchMenu\n      {...speedSearchContainerProps}\n      as=\"div\"\n      ref={containerRef}\n    >\n      <SpeedSearchMenuContent\n        items={[...(rootItem?.childNodes || [])]}\n        speedSearch={speedSearch}\n        searchPopupProps={searchPopupProps}\n        state={state}\n        menuProps={submenuProps}\n        menuRef={ref}\n        emptyText={emptyText}\n      />\n    </StyledSpeedSearchMenu>\n  );\n}\n","import { css } from \"styled-components\";\n\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { UnknownThemeProp } from \"../Theme/Theme\";\n\nimport { StyledMenuItem, StyledMenuItemIcon } from \"./StyledMenuItem\";\n\nexport const MENU_VERTICAL_PADDING = 5;\nexport const MENU_BORDER_WIDTH = 1;\n\n// noinspection CssInvalidPropertyValue\nexport const StyledMenu = styled.ul<{ fillAvailableSpace?: boolean }>`\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  font-size: 0.8rem;\n  margin: 0;\n  padding: ${MENU_VERTICAL_PADDING}px 0;\n  outline: none;\n  list-style: none;\n  width: fit-content;\n  min-width: 120px;\n  overflow: auto;\n  // Border doesn't seem to be painted in the original impl. IdeaPopupMenuUI.isUnderPopup(c) seemed to return false\n  // in all cases. More info: https://github.com/JetBrains/intellij-community/blob/c5ece483811a3ab546fc3880225efb02cc8b94dd/platform/platform-impl/src/com/intellij/ide/ui/laf/darcula/ui/DarculaPopupMenuBorder.java#L24\n  /*  border: ${MENU_BORDER_WIDTH}px solid\n    ${({ theme }) =>\n    theme.color(\"Menu.borderColor\", !theme.dark ? \"#CDCDCD\" : \"#515151\")};*/\n  ${WINDOW_SHADOW};\n  background: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.background\" as UnknownThemeProp<\"PopupMenu.background\">\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.foreground\" as UnknownThemeProp<\"PopupMenu.foreground\">\n    )};\n\n  ${StyledVerticalSeparator}:first-child,\n  ${StyledVerticalSeparator}:last-child, \n  ${StyledVerticalSeparator} + ${StyledVerticalSeparator} {\n    display: none;\n  }\n  ${StyledVerticalSeparator} {\n    background-color: ${({ theme }) => theme.color(\"Menu.separatorColor\")};\n    height: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.height\") ?? 3}px`};\n    padding: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.stripeIndent\") ?? 1}px 0`};\n    margin: ${({ theme }) =>\n      `0 ${theme.value(\"PopupMenuSeparator.withToEdge\") ?? 1}px`};\n  }\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      width: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n      height: fill-available;\n    `}\n\n  --jui-menu-item-padding: 1rem;\n  --jui-menu-item-icon-width: 1rem;\n  --jui-menu-item-icon-spacing: 0.3125rem;\n\n  ${StyledMenuItem} {\n    // NOTE: The left margin seems not to be consistent in all menus.\n    padding-left: var(--jui-menu-item-padding);\n  }\n  &:has(${StyledMenuItemIcon}) {\n    // Adjusting item padding for menus with icon to be slightly smaller. Based on observations on the reference impl.\n    // Could be handled by a negative margin on icons as well.\n    --jui-menu-item-padding: 0.75rem;\n\n    // CSS-only solution to conditionally add left margin to menu items without icon, if there is at least one menu item\n    // with icon, in the current menu. To have text in all menu items aligned. The extra margin is avoided if there is no\n    // menu item with icon. It relies on :has() css pseudo-class which is not supported in FF at the moment.\n    ${StyledMenuItem}:not(:has(${StyledMenuItemIcon})) {\n      padding-left: calc(\n        var(--jui-menu-item-padding) + var(--jui-menu-item-icon-width) +\n          var(--jui-menu-item-icon-spacing)\n      );\n    }\n  }\n  ${StyledMenuItemIcon} {\n    width: var(--jui-menu-item-icon-width);\n    margin-right: var(--jui-menu-item-icon-spacing);\n  }\n`;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nexport const StyledMenuItemIcon = styled.span`\n  display: inline-flex; // prevents unwanted increased height\n`;\n\nexport const StyledNestedArrow = styled.span`\n  display: inline-flex; // to make it not take more height than the icon\n  margin-right: -0.75rem;\n  margin-left: 0.75rem;\n`;\n\nconst highlightedStyle = css`\n  color: ${({ theme }) =>\n    theme.asCurrentForeground(\n      theme.color(\n        \"MenuItem.selectionForeground\" as UnknownThemeProp<\"MenuItem.selectionForeground\">\n      )\n    )};\n  background: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.selectionBackground\" as UnknownThemeProp<\"MenuItem.selectionBackground\">\n    )};\n`;\nconst defaultStyle = css`\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.foreground\" as UnknownThemeProp<\"MenuItem.foreground\">\n    )};\n  background: unset;\n`;\nconst disabledStyle = css`\n  color: ${({ theme }) =>\n    theme.color(\"MenuItem.disabledForeground\") + \"!important\"};\n  background: unset !important;\n`;\nexport const StyledMenuItem = styled.li<{\n  isDisabled: boolean;\n  isActive: boolean;\n}>`\n  position: relative; // for being able to position arrow icon absolutely\n  outline: none;\n  cursor: default;\n  white-space: nowrap;\n\n  // bg/fg style for different states. Order is based on how they should override each other\n  ${defaultStyle};\n  ${({ isActive }) => isActive && highlightedStyle};\n  ${({ isDisabled }) => isDisabled && disabledStyle};\n\n  padding-right: 1.25rem;\n  line-height: 1.5; // to make the item have the right height\n  display: flex;\n  align-items: center;\n`;\n","import React, { useContext, useEffect, useRef } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { AriaMenuOptions, useMenu } from \"@react-aria/menu\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport {\n  MenuKeyboardDelegate,\n  useSubmenu as useSubmenuAria,\n} from \"./_useSubmenu\";\nimport { useSubmenuState } from \"./_useSubmenuState\";\nimport { MenuContext } from \"./Menu\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { renderMenuNodes } from \"./renderMenuNodes\";\n\nexport function useSubmenu<T>(\n  {\n    rootKey,\n    parentState,\n    keyboardDelegate,\n  }: { rootKey: React.Key; parentState: TreeState<T> } & Pick<\n    AriaMenuOptions<T>,\n    \"keyboardDelegate\"\n  >,\n  state: TreeState<T>,\n  ref: React.RefObject<HTMLElement>\n) {\n  const rootItem = state.collection.getItem(rootKey);\n  const {\n    submenuBehavior,\n    autoFocus = true,\n    onClose,\n    onAction,\n  } = useContext(MenuContext);\n  let { menuProps } = useMenu(\n    {\n      \"aria-label\": rootItem?.[\"aria-label\"] || rootItem?.textValue,\n      onAction,\n      onClose,\n      selectedKeys: state.selectionManager.selectedKeys,\n      keyboardDelegate:\n        keyboardDelegate ||\n        new MenuKeyboardDelegate(\n          rootKey,\n          state.collection,\n          state.disabledKeys,\n          ref\n        ),\n      autoFocus,\n    },\n    state,\n    ref\n  );\n  const { submenuProps } = useSubmenuAria({ rootKey }, parentState, ref);\n\n  const submenuBehaviorProps = {\n    onKeyDown: (e: React.KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        // Close the menu and submenu root node.\n        state.toggleKey(rootKey);\n        state.selectionManager.setFocusedKey(rootKey);\n        parentState.selectionManager.setFocused(true);\n        if (submenuBehavior !== \"default\") {\n          e.stopPropagation();\n        }\n        return;\n      }\n    },\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      // we need this hack until the nested menu is properly supported. That's because when the element is hovered\n      // it sets the focus key, which will move focus to that item.\n      // noinspection PointlessBooleanExpressionJS seems to be false positive. autoFocus can be \"first\" or \"last\"\n      if (autoFocus === true) {\n        ref.current?.focus();\n      }\n    });\n  }, []);\n\n  return {\n    submenuProps: mergeProps(menuProps, submenuProps, submenuBehaviorProps),\n  };\n}\n\nexport interface SubmenuProps<T> {\n  parentState: TreeState<T>;\n  rootKey: React.Key;\n}\n\nexport function Submenu<T>({ parentState, rootKey }: SubmenuProps<T>) {\n  const ref = useRef<HTMLUListElement>(null);\n  const state = useSubmenuState(parentState);\n  const rootItem = state.collection.getItem(rootKey);\n\n  const { submenuProps } = useSubmenu({ rootKey, parentState }, state, ref);\n\n  return (\n    <StyledMenu {...submenuProps} ref={ref}>\n      {renderMenuNodes(state, [...(rootItem?.childNodes || [])])}\n    </StyledMenu>\n  );\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport React, { Key, RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { ListKeyboardDelegate } from \"@react-aria/selection\";\n\nexport class MenuKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  private keys: React.Key[];\n  constructor(\n    rootKey: Key | null,\n    private collection: Collection<Node<T>>,\n    disabledKeys: Set<React.Key>,\n    ref: React.RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super(collection, disabledKeys, ref, collator);\n    this.keys = [...collection.getKeys()]\n      .map((key) => collection.getItem(key))\n      .flatMap((item) => {\n        if (item.parentKey == rootKey) {\n          if (item.type === \"item\") {\n            return [item.key];\n          } else if (item.type === \"section\") {\n            return [...item.childNodes].map(({ key }) => key);\n          }\n        }\n        return [];\n      });\n  }\n\n  getFirstKey(): React.Key {\n    return this.keys[0];\n  }\n  getLastKey(): React.Key {\n    return this.keys.slice(-1)[0];\n  }\n\n  getKeyBelow(key: React.Key): React.Key {\n    const keyBelow = super.getKeyBelow(key);\n    // @ts-expect-error: getKeyBelow should be allowed to return null, but typing is currently inaccurate in react-aria\n    return this.keys.includes(keyBelow) ? keyBelow : null;\n  }\n  getKeyAbove(key: React.Key): React.Key {\n    const keyAbove = super.getKeyAbove(key);\n    // @ts-expect-error: getKeyBelow should be allowed to return null, but typing is currently inaccurate in react-aria\n    return this.keys.includes(keyAbove) ? keyAbove : null;\n  }\n}\n\n/**\n * Behavior accessibility of submenus:\n * - Closing submenu on ArrowLeft key press.\n *   Note that it can't be implemented in useMenuItem, because the focus might be on no the submenu itself and not any\n *   of its items\n * @param rootKey: Key of the root node, the submenu is created from its children\n * @param state\n * @param ref\n */\nexport function useSubmenu<T>(\n  { rootKey }: { rootKey: Key },\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const { keyboardProps: submenuProps } = useKeyboard({\n    onKeyDown: (e) => {\n      // Keyboard events bubble through portals. Don't handle keyboard events\n      // for elements outside the collection (e.g. menus).\n      if (!ref.current?.contains(e.target as Element)) {\n        e.continuePropagation();\n        return;\n      }\n      const root = state.collection.getItem(rootKey);\n      if (e.key === \"ArrowLeft\" && state.expandedKeys.has(root.key)) {\n        state.toggleKey(root.key);\n        state.selectionManager.setFocused(true);\n        return;\n      }\n      e.continuePropagation();\n    },\n  });\n\n  return {\n    submenuProps,\n  };\n}\n","import { TreeState } from \"@react-stately/tree\";\nimport { Key, useRef, useState } from \"react\";\nimport {\n  MultipleSelectionState,\n  SelectionManager,\n} from \"@react-stately/selection\";\n\n/**\n * Creates a TreeState corresponding to the submenu, from the state of a parent (sub)menu.\n * The collection and everything is the same, and the only difference from the parent state is selection manager\n * having a separate focused state to keep the focused state of each menu container separately, as the submenus\n * are usually rendered in separate overlays.\n */\nexport function useSubmenuState<T>(parentState: TreeState<T>) {\n  // We want synchronous updates to `isFocused` and `focusedKey` after their setters are called.\n  // But we also need to trigger a re-render. So, we have both a ref (sync) and state (async).\n  const [, setFocused] = useState(false);\n  const [, setFocusedKey] = useState<Key | null>(null);\n  const isFocusedRef = useRef(false);\n  const focusedKeyRef = useRef<Key | null>(null);\n\n  const state: MultipleSelectionState = {\n    // @ts-expect-error state is private\n    ...parentState.selectionManager.state,\n    setFocused: (isFocused: boolean) => {\n      isFocusedRef.current = isFocused;\n      setFocused(isFocused);\n    },\n    setFocusedKey(key: Key) {\n      focusedKeyRef.current = key;\n      setFocusedKey(key);\n    },\n  };\n  Object.defineProperties(state, {\n    isFocused: {\n      get() {\n        return isFocusedRef.current;\n      },\n    },\n    focusedKey: {\n      get() {\n        return focusedKeyRef.current!;\n      },\n    },\n  });\n\n  return {\n    ...parentState,\n    selectionManager: new SelectionManager(parentState.collection, state),\n  };\n}\n","import React from \"react\";\nimport { useMenuSection } from \"@react-aria/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { renderMenuNodes } from \"./renderMenuNodes\";\n\nexport interface MenuSectionProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  filter?: (node: Node<T>) => boolean;\n}\n\nconst StyledMenuHeading = styled.div`\n  cursor: default;\n  padding: 2px 0 2px 12px;\n  font-weight: bold;\n  font-size: 0.8125rem;\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.disabledForeground\"\n    )}; // TODO: make sure about it. It's probably not correct color\n`;\n\nconst StyledMenuSectionItemsContainer = styled.ul`\n  padding: 0;\n  margin: 0;\n`;\n\nexport const MenuSection = <T extends unknown>({\n  item,\n  state,\n  filter = () => true,\n}: MenuSectionProps<T>): React.ReactElement => {\n  let { itemProps, headingProps, groupProps } = useMenuSection({\n    heading: item.rendered,\n    \"aria-label\": item[\"aria-label\"],\n  });\n\n  const nodes = [...item.childNodes].filter(filter);\n  if (nodes.filter(({ type }) => type === \"item\").length === 0) {\n    return <></>;\n  }\n  return (\n    <>\n      <li {...itemProps}>\n        {item.rendered && (\n          <StyledMenuHeading {...headingProps}>\n            {item.rendered}\n          </StyledMenuHeading>\n        )}\n        <StyledMenuSectionItemsContainer {...groupProps}>\n          {renderMenuNodes(state, nodes)}\n        </StyledMenuSectionItemsContainer>\n      </li>\n    </>\n  );\n};\n","import React from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { Node } from \"@react-types/shared\";\nimport { ListDivider } from \"@intellij-platform/core/List/ListDivider\"; // private import\n\nimport { MenuItem } from \"./MenuItem\";\nimport { MenuSection } from \"./MenuSection\";\n\nexport function renderMenuNodes<T>(\n  state: TreeState<T>,\n  nodes: Node<T>[],\n  filter: (node: Node<T>) => boolean = () => true\n) {\n  return nodes.filter(filter).map((node) => {\n    switch (node.type) {\n      case \"item\":\n        return <MenuItem key={node.key} item={node} state={state} />;\n      case \"section\":\n        return (\n          <>\n            {node.props.hasDivider && (\n              <ListDivider key={node.key + \"-divider\"} />\n            )}\n            <MenuSection\n              key={node.key}\n              item={node}\n              state={state}\n              filter={filter}\n            />\n          </>\n        );\n      case \"divider\":\n        return <ListDivider key={node.key} />;\n    }\n  });\n}\n","import { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport React, { useEffect } from \"react\";\n\n/**\n * A workaround for an issue in measuring overlay size, caused by a limitation/bug in how React 17 runs effects when\n * children suspend rendering: https://github.com/facebook/react/issues/21510\n *\n * Here is a simplified demonstration of the issue:\n * Expected behavior (React 18): https://codesandbox.io/s/parent-effects-suspense-v18-38m8p7?file=/src/App.tsx\n * Broken behavior (React 17): https://codesandbox.io/s/parent-effects-suspense-v17-h39g4g\n *\n * The overlay content size measuring runs in an effect, and that effect won't run when the content is rendered after\n * suspense.\n */\nexport function UNSAFE_React17SuspenseFix({\n  measureContentSize,\n  children,\n}: {\n  measureContentSize: () => void;\n  children: React.ReactNode;\n}) {\n  if (React.version.startsWith(\"17\")) {\n    return (\n      <React.Suspense\n        fallback={\n          <NullSuspenseFallback afterUnsuspended={measureContentSize} />\n        }\n      >\n        {children}\n      </React.Suspense>\n    );\n  }\n  return <>{children}</>;\n}\n\nfunction NullSuspenseFallback({\n  afterSuspended: afterSuspendedProp = () => {},\n  afterUnsuspended: afterUnsuspendedProp = () => {},\n}: {\n  afterUnsuspended?: () => void;\n  afterSuspended?: () => void;\n}) {\n  const afterSuspended = useEventCallback(afterSuspendedProp);\n  const afterUnsuspended = useEventCallback(afterUnsuspendedProp);\n  useEffect(() => {\n    afterSuspended?.();\n    return () => {\n      afterUnsuspended?.();\n    };\n  }, []);\n  return null;\n}\n","import React, { FocusEventHandler, useContext, useRef } from \"react\";\nimport { useModal, useOverlay, usePreventScroll } from \"@react-aria/overlays\";\nimport { focusSafely, FocusScope } from \"@react-aria/focus\";\nimport { useDialog } from \"@react-aria/dialog\";\nimport { AriaDialogProps } from \"@react-types/dialog\"; // temporary phantom dependency\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport {\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  ResizableMovableOverlayOptions,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { WindowContext } from \"@intellij-platform/core/ModalWindow/WindowContext\";\nimport { UNSAFE_React17SuspenseFix } from \"@intellij-platform/core/Overlay/UNSAFE_React17SuspenseFix\";\n\nexport interface ModalWindowProps\n  extends AriaDialogProps,\n    ResizableMovableOverlayOptions {\n  children: React.ReactNode;\n  onClose?: () => void;\n}\n\nconst StyledWindowUnderlay = styled.div`\n  position: fixed;\n  z-index: 1000; // FIXME: z-index should not be hard-coded like this\n  inset: 0;\n`;\nconst StyledWindowContainer = styled.div`\n  position: fixed;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  border-radius: 8px;\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n  outline: 1px solid #555; // FIXME\n`;\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledWindowInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const DEFAULT_WINDOW_MIN_WIDTH = 50;\nexport const DEFAULT_WINDOW_MIN_HEIGHT = 24;\n\nexport const WindowControllerContext = React.createContext<\n  Partial<Pick<ModalWindowProps, \"onClose\">>\n>({});\n\n/**\n * A movable/resizable modal window. The window header which holds the title, can be used to drag the window around.\n * In the reference impl, modal windows are os-native, and contain os-level buttons for minimize/close/maximise, which\n * are not relevant here since they wouldn't be os-native windows. A close button is still relevant (and kind of\n * necessary) and will be added in next iterations.\n *\n * The content container doesn't come with any padding. Other related components should be used for common layouts in\n * modal windows.\n * Example use cases: Window for git operations such as push, update, revert, new branch, etc.\n *\n * ![img.png](https://user-images.githubusercontent.com/3150694/181095858-968c5c66-2ae7-4e40-84e3-e6df43cd4aa4.png)\n *\n * NOTE: The part regarding rendering OverlayInteractionHandler, and rendering as a dialog with a focus scope, in an\n * overlay container could be extracted into a component which is then used to create custom resizable/movable overlay\n * dialogs, like \"Branches\", or \"Search Everywhere\".\n *\n * TODO: show close button (maybe os-aware styles?)\n *\n */\nexport const ModalWindow = ({\n  interactions = \"all\",\n  minWidth = DEFAULT_WINDOW_MIN_WIDTH,\n  minHeight = DEFAULT_WINDOW_MIN_HEIGHT,\n  ...props\n}: ModalWindowProps): React.ReactElement => {\n  const { children } = props;\n  const propsContext = useContext(WindowControllerContext);\n  const onClose = () => {\n    propsContext.onClose?.();\n    props.onClose?.();\n  };\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { overlayProps, underlayProps } = useOverlay(\n    {\n      isOpen: true, // maybe allow rendering closed window? :-?\n      onClose,\n      isDismissable: false,\n      isKeyboardDismissDisabled: false,\n      shouldCloseOnBlur: false,\n    },\n    ref\n  );\n  usePreventScroll();\n  const { modalProps } = useModal();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  const {\n    bounds: style,\n    overlayInteractionHandlerProps,\n    UNSAFE_measureContentSize,\n  } = useResizableMovableOverlay(ref, { ...props, minHeight, minWidth });\n\n  const { focusContainmentFixProps } = useFocusContainmentFix();\n\n  return (\n    <StyledWindowUnderlay {...underlayProps}>\n      <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n        <FocusScope contain restoreFocus autoFocus>\n          <StyledWindowContainer\n            {...mergeProps(\n              overlayProps,\n              dialogProps,\n              modalProps,\n              focusContainmentFixProps,\n              { style }\n            )}\n            ref={ref}\n          >\n            <StyledWindowInnerContainer>\n              <WindowContext.Provider\n                value={{\n                  isActive: true, // because it's modal. WindowContext would be used for non-modal windows too, in future\n                  titleProps,\n                  movable: interactions !== \"none\",\n                }}\n              >\n                <UNSAFE_React17SuspenseFix\n                  measureContentSize={UNSAFE_measureContentSize}\n                >\n                  {children}\n                </UNSAFE_React17SuspenseFix>\n              </WindowContext.Provider>\n            </StyledWindowInnerContainer>\n            {interactions === \"all\" && <OverlayResizeHandles />}\n          </StyledWindowContainer>\n        </FocusScope>\n      </OverlayInteractionHandler>\n    </StyledWindowUnderlay>\n  );\n};\n\n/**\n * The way FocusScope is implemented at the moment, it's possible for another focus scope to steal the focus,\n * right after the modal window is opened. The issue is not tracked down to the root cause. But with this hook,\n * we make sure there is no way for focus to go out of the modal window, when it's mounted.\n */\nfunction useFocusContainmentFix<T extends HTMLElement>() {\n  const lastFocusedElementRef = useRef<HTMLElement | null>(null);\n  const onFocus: FocusEventHandler<T> = (e) => {\n    lastFocusedElementRef.current = e.target;\n  };\n  const onBlur: FocusEventHandler = (e) => {\n    const probablyFocusedElement = e.relatedTarget;\n    if (\n      !probablyFocusedElement ||\n      (probablyFocusedElement instanceof Element &&\n        !e.currentTarget.contains(probablyFocusedElement))\n    ) {\n      const elementToFocus = lastFocusedElementRef.current;\n      if (elementToFocus) {\n        focusSafely(elementToFocus);\n      }\n    }\n  };\n  return {\n    focusContainmentFixProps: {\n      onFocus,\n      onBlur,\n    },\n  };\n}\n","import React from \"react\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\nexport const WindowContext = React.createContext<{\n  isActive: boolean;\n  movable: boolean;\n  titleProps: DOMAttributes;\n}>({ isActive: false, movable: true, titleProps: {} });\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\n\nconst StyledFooter = styled.div<{ hasBorder?: boolean }>`\n  padding: 0.625rem 0.875rem;\n  display: flex;\n  gap: 0.5rem;\n  justify-content: space-between;\n  align-items: center;\n  border-top: 1px solid transparent;\n  border-color: ${({ hasBorder, theme }) =>\n    hasBorder && theme.commonColors.contrastBorder};\n`;\nconst StyledFooterSide = styled.div`\n  display: flex;\n  gap: 0.75rem;\n`;\n\n/**\n * Implements the common layout for window footer, to be used in {@link ModalWindowProps#footer}.\n * Footer has a left and a right side. There is a standard gap between the children of each side.\n */\nexport function WindowFooter({\n  left,\n  right,\n  hasBorder,\n}: {\n  /**\n   * The content to go to the left side the footer. A help icon button is very common on the left side.\n   */\n  left?: React.ReactNode;\n  /**\n   * The content to go to the right side the footer. {@link Button}s are usually used inside the right content\n   */\n  right?: React.ReactNode;\n  /**\n   * Whether to show top border for footer or not\n   */\n  hasBorder?: boolean;\n}) {\n  return (\n    <StyledFooter hasBorder={hasBorder}>\n      <StyledFooterSide>{left}</StyledFooterSide>\n      <StyledFooterSide>{right}</StyledFooterSide>\n    </StyledFooter>\n  );\n}\n","import React, { HTMLAttributes, useContext } from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\n\nimport { WindowContext } from \"./WindowContext\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst StyledWindowTitle = styled.h1`\n  margin: 0;\n  text-align: center;\n  font-size: 13px; // not rem! intentional\n  line-height: 20px;\n  cursor: default;\n  user-select: none;\n  padding: 0 8px;\n`;\n\n/**\n * Implements appearance of Window header, and also acts as a handle for moving the window.\n * Expected to be used with {@link WindowLayout}:\n *\n * @example\n * ```tsx\n * <ModalWindow>\n *    <WindowLayout header={<WindowHeader>header</WindowHeader>} />\n * </ModalWindow>\n * ```\n */\nexport const WindowHeader = ({ children }: { children?: React.ReactNode }) => {\n  const { movable, titleProps } = useContext(WindowContext);\n  const renderTitle = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledWindowTitle {...mergeProps(titleProps, otherProps)}>\n      {children || <>&nbsp;</>}\n    </StyledWindowTitle>\n  );\n  return movable ? (\n    <OverlayMoveHandle>\n      {({ moveHandleProps }) => renderTitle(moveHandleProps)}\n    </OverlayMoveHandle>\n  ) : (\n    renderTitle()\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { WindowHeader } from \"./WindowHeader\";\nimport { WindowFooter } from \"@intellij-platform/core/ModalWindow/WindowFooter\";\n\nconst StyledWindowFooter = styled.div`\n  min-height: min-content;\n`;\n\nconst StyledWindowContentWrapper = styled.div`\n  overflow: auto;\n  flex: 1;\n`;\n\n/**\n * Window content layout, supporting fixed `header` and `footer` sections, and a scrollable `content` area.\n */\nexport function WindowLayout({\n  header,\n  footer,\n  content,\n}: {\n  /**\n   * Fixed position header of the window at the top. Use {@link WindowLayout.Header} for the default window header,\n   * which also acts as a move handle for the window. If a string is passed, it will be wrapped by\n   * {@link WindowLayout.Header} automatically.\n   */\n  header: React.ReactNode;\n  /**\n   * Scrollable content of the window.\n   */\n  content: React.ReactNode;\n  /**\n   * An area at the bottom of the window which is not scrolled as opposed to `content`. Use {@link WindowLayout.Footer}\n   * for rendering the common layout of a window footer.\n   */\n  footer?: React.ReactNode;\n}) {\n  return (\n    <>\n      {header &&\n        (typeof header === \"string\" ? (\n          <WindowHeader>{header}</WindowHeader>\n        ) : (\n          header\n        ))}\n      <StyledWindowContentWrapper>{content}</StyledWindowContentWrapper>\n      {footer && <StyledWindowFooter>{footer}</StyledWindowFooter>}\n    </>\n  );\n}\n\n// Just for improved discoverability. Might as well export WindowFooter and WindowHeader instead.\nWindowLayout.Footer = WindowFooter;\nWindowLayout.Header = WindowHeader;\n","import React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  ModalWindow,\n  WindowControllerContext,\n  ModalWindowProps,\n} from \"./ModalWindow\";\n\ninterface WindowManagerAPI {\n  /**\n   * Shows a modal window within the stack of windows managed by {@link WindowManager}.\n   * The opened windows will be closed when `onClose` interactions happen.\n   */\n  open(\n    props:\n      | React.ReactElement<ModalWindowProps, typeof ModalWindow>\n      | ((args: {\n          close: () => void;\n        }) => React.ReactElement<ModalWindowProps, typeof ModalWindow>)\n  ): void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\n    \"WindowManager not found. Wrap your application with WindowManager to be able to open windows imperatively\"\n  );\n};\n\nconst WindowsContext = React.createContext<WindowManagerAPI>({\n  open: NotImplementedFn,\n});\n\n/**\n * Returns imperative API for showing windows.\n *\n */\nexport const useWindowManager = (): WindowManagerAPI =>\n  useContext(WindowsContext);\n\ntype WindowElement = ReactElement<ModalWindowProps, typeof ModalWindow>;\n\nexport interface WindowManagerProps {\n  children?: ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link useWindowManager}) for opening windows.\n * It renders windows in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n */\nexport const WindowManager: React.FC<WindowManagerProps> = ({ children }) => {\n  const [windows, setWindows] = useState<Array<WindowElement>>([]);\n  const newKeyRef = useRef<number>(0);\n\n  const api = useMemo<WindowManagerAPI>(() => {\n    const openModalWindow: WindowManagerAPI[\"open\"] = (content) => {\n      newKeyRef.current++;\n      const close = () => {\n        setWindows((currentWindows) =>\n          currentWindows.filter((aWindow) => aWindow !== window)\n        );\n      };\n      const window = (\n        <WindowControllerContext.Provider\n          value={{ onClose: close }}\n          key={newKeyRef.current}\n        >\n          {typeof content === \"function\" ? content({ close }) : content}\n        </WindowControllerContext.Provider>\n      );\n      setWindows((currentWindows) => currentWindows.concat(window));\n    };\n    return {\n      open: openModalWindow,\n    };\n  }, []);\n\n  return (\n    <WindowsContext.Provider value={api}>\n      {children}\n      {windows}\n    </WindowsContext.Provider>\n  );\n};\n","import React, { useContext, useRef } from \"react\";\nimport { Overlay as AriaOverlay, OverlayProps } from \"@react-aria/overlays\";\n\nconst ParentOverlayContext = React.createContext<HTMLElement | null>(null);\n\n/**\n * A (drop-in replacement) wrapper around Overlay, which makes sure overlays created in nested\n * react components will be ported to the same top level container. This is especially useful to detect\n * \"outside clicks\" when overlays are nested. The most common example would be nested menu in popup.\n *\n */\nexport function Overlay({\n  children,\n  OverlayComponent = AriaOverlay,\n}: {\n  children: React.ReactNode;\n  OverlayComponent?: React.ComponentType<OverlayProps>;\n}) {\n  const root = useContext(ParentOverlayContext);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  if (root) {\n    return (\n      <OverlayComponent portalContainer={root}>{children}</OverlayComponent>\n    );\n  }\n  return (\n    <ParentOverlayContext.Provider value={containerRef.current}>\n      <OverlayComponent>\n        <div ref={containerRef} data-overlay-root=\"\">\n          {children}\n        </div>\n      </OverlayComponent>\n    </ParentOverlayContext.Provider>\n  );\n}\n\n/**\n * Returns true, if element1 and element2 are in nested overlays. \"Nested\" being in terms of React component tree.\n * Useful for detecting \"outside click\" when overlay components are nested in each other.\n */\nexport function areInNestedOverlays(\n  element1: Element | null,\n  element2: Element | null\n) {\n  const overlayRoot1 = element1?.closest(\"[data-overlay-root]\");\n  const overlayRoot2 = element2?.closest(\"[data-overlay-root]\");\n  return Boolean(overlayRoot1) && overlayRoot1 === overlayRoot2;\n}\n","import React, { useContext } from \"react\";\n\nexport type Bounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * TODO(docs): add a few words about this abstraction and it's use.\n */\nexport type OverlayInteractionHandlerProps = {\n  /**\n   * Signals start of a UI interaction like resize or move, in which overlay bounds change.\n   */\n  startInteraction: (type: \"move\" | \"resize\") => Bounds;\n  /**\n   * Used to update bounds state during a UI interaction.\n   */\n  updateBounds: (bounds: Bounds) => void;\n  /**\n   * Signals end of a UI interaction.\n   */\n  finishInteraction: () => void;\n\n  minWidth?: number;\n  minHeight?: number;\n};\n\nconst OverlayInteractionHandlerContext =\n  React.createContext<OverlayInteractionHandlerProps | null>(null);\n\n/**\n * Provides the context used by components like {@link OverlayMoveHandle} and {@link OverlayResizeHandles} that provide\n * user interactions that change the boundary of the overlay they are rendered in.\n * Use {@link useResizableMovableOverlay} which implements an efficient state management for overlay bounds and returns\n * props to be passed to `OverlayInteractionHandler`:\n *\n * @example\n *\n * const {\n *    bounds, // Bounds to be applied to the overlay element.\n *    overlayInteractionHandlerProps,\n *  } = useResizableMovableOverlay(props);\n *\n * return (\n *   <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n *     <div style={bounds}>...</div>\n *   </OverlayInteractionHandler>\n * );\n *\n * @see useResizableMovableOverlay\n */\nexport const OverlayInteractionHandler = ({\n  children,\n  ...props\n}: OverlayInteractionHandlerProps & { children: React.ReactNode }) => {\n  return (\n    <OverlayInteractionHandlerContext.Provider value={props}>\n      {children}\n    </OverlayInteractionHandlerContext.Provider>\n  );\n};\n\nexport const useOverlayInteractionHandler = () =>\n  useContext(OverlayInteractionHandlerContext);\n","import { useMove } from \"../utils/interaction-utils/useMove\";\nimport { useOverlayInteractionHandler } from \"./OverlayInteractionHandler\";\nimport React from \"react\";\n\n/**\n * Used for making a dom element a move handle for the overlay it's being rendered in.\n * It uses the context provided by {@link OverlayInteractionHandler}, and returns props to be applied on a dom element to\n * make it a move handle for the overlay it's being rendered in.\n *\n * @see OverlayMoveHandle\n */\nexport function useOverlayMoveHandle() {\n  const interactionHandler = useOverlayInteractionHandler();\n  if (!interactionHandler) {\n    return { moveHandleProps: {} };\n  }\n  const { finishInteraction, startInteraction, updateBounds } =\n    interactionHandler;\n\n  const moveProps = useMove({\n    onMoveStart: () => {\n      return startInteraction(\"move\");\n    },\n    onMove: ({ startState, movement }) => {\n      updateBounds({\n        ...startState,\n        top: startState.top + movement.y,\n        left: startState.left + movement.x,\n      });\n    },\n    onMoveEnd: () => {\n      finishInteraction();\n    },\n  });\n  return { moveHandleProps: moveProps || {} };\n}\n\n/**\n * Used for making a dom element a move handle for the overlay it's being rendered in.\n * It uses the context provided by {@link OverlayInteractionHandler}. A render function is expected as `children`. It's\n * passed the event handlers that need to be applied on a dom element to make it a move handle for the overlay it's\n * being rendered in.\n */\nexport const OverlayMoveHandle = ({\n  children,\n}: {\n  children: (\n    props: ReturnType<typeof useOverlayMoveHandle>\n  ) => React.ReactElement;\n}) => {\n  return children(useOverlayMoveHandle());\n};\n","import React, { useRef } from \"react\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport {\n  HorizontalResizerProps,\n  VerticalResizerProps,\n} from \"../Resizer/ResizerProps\";\nimport {\n  Bounds,\n  useOverlayInteractionHandler,\n} from \"./OverlayInteractionHandler\";\n\ntype OverlayResizeHandlesProps = {\n  minWidth?: number;\n  minHeight?: number;\n};\n\n/**\n * Renders invisible resize handles at the edges of the overlay it's rendered in. It uses the context provided by\n * {@link OverlayInteractionHandler} to resize the overlay when the handles are used.\n */\nexport function OverlayResizeHandles(props: OverlayResizeHandlesProps) {\n  const overlayResizer = useOverlayResizer(props);\n  return (\n    overlayResizer && (\n      <>\n        <RightResizer {...overlayResizer.getResizerProps(\"right\")} />\n        <LeftResizer {...overlayResizer.getResizerProps(\"left\")} />\n        <TopResizer {...overlayResizer.getResizerProps(\"top\")} />\n        <BottomResizer {...overlayResizer.getResizerProps(\"bottom\")} />\n      </>\n    )\n  );\n}\n\n/**\n * overlay resizing logic and state. When resizing is in progress, the source of truth is a local state, for performance\n * reasons. When the resize is done (e.g. by mouse being released), `onBoundsChange` is called with the new bounds.\n */\nfunction useOverlayResizer(props: OverlayResizeHandlesProps = {}) {\n  const initialBoundsRef = useRef<Bounds>({\n    top: 0,\n    height: 0,\n    width: 0,\n    left: 0,\n  });\n  const interactionHandler = useOverlayInteractionHandler();\n  const {\n    minWidth = interactionHandler?.minWidth ?? 1,\n    minHeight = interactionHandler?.minHeight ?? 1,\n  } = props;\n  if (!interactionHandler) {\n    return null;\n  }\n  const { finishInteraction, startInteraction, updateBounds } =\n    interactionHandler;\n\n  const onResize = {\n    right: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        width: Math.max(minWidth, initialBoundsRef.current.width + size),\n      }),\n    bottom: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        height: Math.max(minHeight, initialBoundsRef.current.height + size),\n      }),\n    left: (size: number) => {\n      const newWidth = Math.max(\n        minWidth,\n        initialBoundsRef.current.width + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        left: initialBounds.left + initialBounds.width - newWidth,\n        width: newWidth,\n      });\n    },\n    top: (size: number) => {\n      const newHeight = Math.max(\n        minHeight,\n        initialBoundsRef.current.height + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        top: initialBounds.top + initialBounds.height - newHeight,\n        height: newHeight,\n      });\n    },\n  };\n\n  function getResizerProps(side: \"left\" | \"right\"): HorizontalResizerProps;\n  function getResizerProps(side: \"top\" | \"bottom\"): VerticalResizerProps;\n  function getResizerProps(\n    side: \"left\" | \"right\" | \"top\" | \"bottom\"\n  ): HorizontalResizerProps | VerticalResizerProps {\n    const horizontal = side === \"left\" || side === \"right\";\n    return {\n      size: 1,\n      cursor: horizontal ? \"ew\" : \"ns\",\n      onResizeStarted: () => {\n        initialBoundsRef.current = startInteraction(\"resize\");\n      },\n      onResize: onResize[side],\n      onResizeEnd: finishInteraction,\n      style: { position: \"absolute\", [side]: 0 },\n    };\n  }\n\n  return {\n    getResizerProps,\n  };\n}\n","import { Bounds } from \"@intellij-platform/core/Overlay/OverlayInteractionHandler\";\nimport { clamp } from \"ramda\";\nimport { ResizableMovableOverlayOptions } from \"@intellij-platform/core/Overlay/useResizableMovableOverlay\";\n\nexport const withMinSize =\n  ({ width: minWidth, height: minHeight }: { width: number; height: number }) =>\n  (bounds: Bounds) => {\n    const width = Math.max(minWidth, bounds.width);\n    const height = Math.max(minHeight, bounds.height);\n    if (bounds.width != width || bounds.height != height) {\n      return { ...bounds, width, height };\n    }\n    return bounds;\n  };\n\nexport function getCenteredBounds(width: number, height: number): Bounds {\n  return {\n    left: (window.innerWidth - width) / 2,\n    top: (window.innerHeight - height) / 2,\n    width,\n    height,\n  };\n}\n\n/**\n * A helper function to create interaction interceptor which ensures bounds are contained within a container.\n *\n * @example\n * const ensureInViewPort = containedWithin({left: 0, top: 0, width: window.innerWidth, height: window.innerHeight})\n *\n * useResizableMovableOverlay({ onBoundsChanging: ensureInViewPort});\n */\nexport const containedWithin =\n  (\n    containerBounds: Bounds\n  ): ResizableMovableOverlayOptions[\"onBoundsChanging\"] =>\n  (bounds, interactionType) => {\n    if (interactionType === \"move\") {\n      const left = clamp(\n        containerBounds.left,\n        containerBounds.left + containerBounds.width - bounds.width,\n        bounds.left\n      );\n      const top = clamp(\n        containerBounds.top,\n        containerBounds.top + containerBounds.height - bounds.height,\n        bounds.top\n      );\n      return {\n        ...bounds,\n        left,\n        top,\n      };\n    } else if (interactionType === \"resize\") {\n      const left = Math.max(containerBounds.left, bounds.left);\n      const top = Math.max(containerBounds.top, bounds.top);\n      // the logic here seems unnecessarily complicated\n      return {\n        left,\n        top,\n        width:\n          bounds.width -\n          Math.max(\n            0,\n            bounds.left +\n              bounds.width -\n              (containerBounds.left + containerBounds.width)\n          ) -\n          (left - bounds.left),\n        height:\n          bounds.height -\n          Math.max(\n            0,\n            bounds.top +\n              bounds.height -\n              (containerBounds.top + containerBounds.height)\n          ) -\n          (top - bounds.top),\n      };\n    }\n    return bounds;\n  };\nexport const position =\n  ({\n    targetElement,\n    placement = \"bottom\",\n  }: {\n    placement?: \"bottom\" | \"top\";\n    targetElement: HTMLElement;\n  }) =>\n  ({ height, width }: Bounds): Bounds => {\n    const targetBounds = targetElement.getBoundingClientRect();\n    return {\n      left: targetBounds.left,\n      top:\n        placement === \"bottom\"\n          ? targetBounds.top + targetBounds.height\n          : targetBounds.top - height,\n      width,\n      height,\n    };\n  };\n\nexport function ensureInViewport(\n  bounds: Bounds,\n  { gap = 0 }: { gap?: number } = {}\n): Bounds {\n  const viewportWidth = window.innerWidth - gap;\n  const viewportHeight = window.innerHeight - gap;\n  const left = clamp(gap, viewportWidth - bounds.width, bounds.left);\n  const top = clamp(gap, viewportHeight - bounds.height, bounds.top);\n  if (left !== bounds.left || top !== bounds.top) {\n    return {\n      left,\n      top,\n      width: bounds.width,\n      height: bounds.height,\n    };\n  }\n  return bounds;\n}\n","import { useCallback, useEffect, useLayoutEffect, useRef } from \"react\";\n\nexport const useDebouncedCallback = (\n  fn: () => void,\n  { timeout = 100 } = {}\n) => {\n  const fnRef = useRef(fn);\n  const currentTimeoutId = useRef<number | null>(null);\n  useLayoutEffect(() => {\n    fnRef.current = fn;\n  });\n  useEffect(() => {\n    return () => {\n      if (currentTimeoutId.current !== null) {\n        clearTimeout(currentTimeoutId.current);\n      }\n    };\n  }, []);\n  return useCallback(() => {\n    if (currentTimeoutId.current !== null) {\n      clearTimeout(currentTimeoutId.current);\n    }\n    currentTimeoutId.current = window.setTimeout(fnRef.current, timeout);\n  }, []);\n};\n","import { RefObject, useEffect, useLayoutEffect, useState } from \"react\";\nimport { useDebouncedCallback } from \"@intellij-platform/core/utils/useDebounce\";\n\n/**\n * Clones the element, applies the temporary styles, and calls {@param fn} on the clone.\n * Previously, we applied the temporary styles on the element itself, run fn, and then revert to previous styles,\n * but that can mess with the scroll bar in the content. If there is a scrollable part in some nested element,\n * applying temporary style (in our case width: fit-content, height: fit-content) can cause scroll to jump which is not\n * restored after the style reversion. Now the approach is changed to apply the temporary styles on a temporary clone\n * of the element. It's certainly not as efficient and some optimization may be needed.\n * @param style: temporary styles to apply before fn is invoked, and revert after.\n * @param fn the function to compute something on the element with temporary styles\n */\nconst withTemporaryStyle =\n  <T extends any>(\n    style: Partial<CSSStyleDeclaration>,\n    fn: (element: HTMLElement) => T\n  ) =>\n  (element: HTMLElement): T => {\n    const clone = element.cloneNode(true) as HTMLElement;\n    clone.style.position = \"absolute\";\n    clone.style.left = \"-9999px\";\n    document.body.appendChild(clone);\n\n    Object.assign(clone.style, style);\n    const returnValue = fn(clone);\n\n    document.body.removeChild(clone);\n    return returnValue;\n  };\n\n/**\n * FIXME: withTemporaryStyle is not side-effect free and can cause scroll jumps. It creates awfully hard-to-debug\n *  issues.\n */\nexport const getContentSize = withTemporaryStyle(\n  {\n    width: \"\",\n    minWidth: \"fit-content\", // Shouldn't it be min-content? :-?\n    height: \"\",\n    minHeight: \"fit-content\",\n  },\n  (element) => ({\n    width: Math.ceil(parseFloat(getComputedStyle(element).width)),\n    height: Math.ceil(parseFloat(getComputedStyle(element).height)),\n  })\n);\n\nexport const useContentSize = (\n  ref: RefObject<HTMLElement>,\n  {\n    observe = false,\n  }: {\n    /**\n     * if false, the content size is measured only initially. If true, the dom changes are observed, and content size\n     * is updated accordingly.\n     * @default false\n     */\n    observe?: boolean;\n  } = {}\n) => {\n  const [measuredSizes, setMeasuredSizes] = useState<Size[]>([]);\n  useLayoutEffect(() => {\n    const element = ref.current;\n    if (!element || measuredSizes.length > 5) {\n      return;\n    }\n    const size = getContentSize(element);\n\n    const lastMeasuredSize = measuredSizes.at(-1);\n    if (!lastMeasuredSize || !Size.isEqual(lastMeasuredSize, size)) {\n      setMeasuredSizes([size]);\n    }\n    const id = window.requestAnimationFrame(() => {\n      const newSize = getContentSize(element);\n      if (!Size.isEqual(newSize, size)) {\n        setMeasuredSizes([...measuredSizes, newSize]);\n      }\n    });\n    return () => {\n      window.cancelAnimationFrame(id);\n    };\n  }, [\n    measuredSizes,\n    // ref value shouldn't normally be an effect's dependency, but for some reason, ref value is null in the first call\n    // when built for website. Interestingly, it doesn't happen in storybook. So maybe something to investigate further\n    ref.current,\n  ]);\n  const measure = () => {\n    const lastMeasuredSize = measuredSizes.at(-1);\n    if (ref.current && lastMeasuredSize) {\n      const currentSize = getContentSize(ref.current);\n      if (\n        currentSize.height !== lastMeasuredSize.height ||\n        currentSize.width !== lastMeasuredSize.width\n      ) {\n        setMeasuredSizes(\n          measuredSizes.map((aSize) =>\n            aSize === lastMeasuredSize ? currentSize : aSize\n          )\n        );\n      }\n    }\n  };\n  const debouncedMeasure = useDebouncedCallback(measure);\n\n  useEffect(() => {\n    const element = ref.current;\n    if (observe && element) {\n      const mutationObserver = new MutationObserver(() => {\n        debouncedMeasure();\n      });\n      mutationObserver.observe(element, {\n        subtree: true,\n        childList: true,\n      });\n      return () => {\n        mutationObserver.disconnect();\n      };\n    }\n  }, [\n    observe,\n    // ref value shouldn't normally be an effect's dependency, but for some reason, ref value is null in the first call\n    // when built for website. Interestingly, it doesn't happen in storybook. So maybe something to investigate further\n    ref.current,\n  ]);\n  return [measuredSizes.at(-1) || { width: 0, height: 0 }, measure] as const;\n};\n\ninterface Size {\n  width: number;\n  height: number;\n}\n// eslint-disable-next-line @typescript-eslint/no-redeclare\nexport const Size = {\n  isEqual: (\n    { width, height }: Size,\n    { width: width2, height: height2 }: { width: number; height: number }\n  ) => width === width2 && height === height2,\n};\n","import React, { RefObject, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  Bounds,\n  OverlayInteractionHandler,\n  OverlayInteractionHandlerProps,\n} from \"./OverlayInteractionHandler\";\nimport { clamp, filter } from \"ramda\";\nimport { useContentSize } from \"@intellij-platform/core/Overlay/useContentSize\";\nimport {\n  getCenteredBounds,\n  withMinSize,\n} from \"@intellij-platform/core/Overlay/bounds-helpers\";\n\n/**\n * Common props for resizable and movable overlays such as Windows or Popups.\n * There is currently no corresponding component/hook, and this is just a type helper.\n */\nexport interface ResizableMovableOverlayOptions {\n  onBoundsChange?: (bounds: Bounds, interactionType: \"move\" | \"resize\") => void;\n  /**\n   * For performance reason, overlay bounds is kept in a local state during a resize or move interaction, and\n   * `onBoundsChange` is called once at the end of interaction. `onBoundsChanging` gives a chance of rectifying\n   * bounds changes during an interaction to for example apply custom size/placement constraints.\n   */\n  onBoundsChanging?: (\n    newBounds: Bounds,\n    /**\n     * Whether the interaction is a \"move\" or \"resize\" considering the initial bounds when interaction was started.\n     */\n    interactionType: \"move\" | \"resize\"\n  ) => Bounds;\n  /**\n   * Controlled bounds. Can be a partially specified bounds.\n   * - If `top` not specified, the returned bounds will be centered vertically.\n   * - If `left` not specified, the returned bounds will be centered horizontally.\n   * - If `width` not specified, the width of the bounds will be based on content width.\n   * - If `height` not specified, the height of the bounds will be based on content height.\n   * Note that regardless of `bounds`, `onBoundsChange` always receives a full `bounds` object which is solely\n   * based on the bounds of the overlay, at the end of an interaction.\n   */\n  bounds?: Partial<Bounds>;\n  /**\n   * Default bounds in uncontrolled mode. Can be a partially specified bounds.\n   * - If `top` not specified, the returned bounds will be centered vertically.\n   * - If `left` not specified, the returned bounds will be centered horizontally.\n   * - If `width` not specified, the width of the bounds will be based on content width.\n   * - If `height` not specified, the height of the bounds will be based on content height.\n   * Note that regardless of `defaultBounds`, `onBoundsChange` always receives a full `bounds` object which is solely\n   * based on the bounds of the overlay, at the end of an interaction.\n   */\n  defaultBounds?: Partial<Bounds>;\n  minWidth?: number | \"content\"; // TODO: support function, receiving measured size, for more flexibility\n  minHeight?: number | \"content\"; // TODO: support function, receiving measured size, for more flexibility\n\n  /**\n   * Allowed interactions:\n   * - \"all\": both resizable and movable\n   * - \"move\": movable, but not resizable\n   * - \"none\": fixed size and position\n   * The reason there are no `resizable` and `movable` boolean props is that resizable=true,movable=false doesn't make\n   * sense from UX perspective.\n   * @default \"all\"\n   */\n  interactions?: \"all\" | \"move\" | \"none\"; // FIXME: it's not used in useResizableMovableOverlay, maybe separate props?\n\n  /**\n   * When the size is not specified by `bounds` or `defaultBounds` props, the content size is measured and used in the\n   * returned bounds. By default, the content size is measured initially. If `observeContentSize` is true, the DOM\n   * mutations will be observed and the content is re-measured as changes are observed.\n   */\n  observeContentResize?: boolean;\n}\n/**\n *\n * TODO: rename to something better? :D\n * TODO: maybe an option like ensureInViewport that would move the final bound into the viewport (if necessary), when\n *  calling onBoundsChange at the end of an interaction. That's important because if move handle(s) (usually rendered\n *  at the top of the overlay) are out of reach, there would be no way back.\n * TODO: description\n * Assumptions:\n * - The overlay is rendered in a portal, and with position \"fixed\".\n * - The returned bounds should be used to style the overlay.\n *   - There shouldn't be other style affecting the positioning, such as margin, or transform.\n *   - If the overlay has border, box-sizing should be \"border-box\"\n */\nexport function useResizableMovableOverlay(\n  overlayRef: RefObject<HTMLElement>,\n  {\n    bounds: inputBounds,\n    defaultBounds,\n    onBoundsChange,\n    onBoundsChanging = (i) => i,\n    minWidth,\n    minHeight,\n    observeContentResize,\n  }: ResizableMovableOverlayOptions\n): {\n  /**\n   * The bounds to be applied as `style` on the overlay, to position it. Even if the input `bounds` or `defaultBounds`\n   * is not defined, returned `bounds` is always a full bounds object. This eliminates any other need for styling,\n   * if the input bounds doesn't define size or position.\n   * NOTE: even when the size is not specified as input, and is to be based on content, the returned `bounds` include\n   * explicit, size, measured **after the first render**. This is because overlays such as windows are not expected to\n   * be resized without user interaction, and just based on the content size change. So we make sure even when the\n   * sizing is based on content, it's stable. If imperative re-measure of the size is needed, or even dynamic resizing\n   * based on content is needed in some cases, it is feasible to add it as an option.\n   */\n  bounds: Bounds;\n  /**\n   * `true` if the returned bounds has explicit position. `false` if it's centered as a fallback.\n   */\n  positioned: boolean;\n  /**\n   * `true` if the returned bounds has explicit size. `false` if it's measured based on content.\n   */\n  sized: boolean;\n  /**\n   * Props to be passed to {@link OverlayInteractionHandler}\n   */\n  overlayInteractionHandlerProps: OverlayInteractionHandlerProps;\n\n  /**\n   * Allow for remeasuring content size imperatively, when needed. Currently only used to work around\n   * an issue related to Suspense in React 17.\n   */\n  UNSAFE_measureContentSize: () => void;\n} {\n  const [bounds, setBounds] = useControlledState<Partial<Bounds> | undefined>(\n    inputBounds!,\n    defaultBounds!,\n    // onBoundsChange is called with Bounds object. Not Partial<Bounds>, and not undefined.\n    onBoundsChange as (\n      value: Partial<Bounds> | undefined,\n      reason: \"resize\" | \"move\"\n    ) => void\n  );\n  const [contentSize, measureContentSize] = useContentSize(overlayRef, {\n    observe: observeContentResize,\n  });\n  // local state of bounds for when the overlay is in a UI interaction, like movement or resize with mouse.\n  // We don't want to update the state in the higher levels repeatedly in such transactions, and we just want to\n  // trigger on update when the UI interaction is done.\n  // It's maintained during a UI interaction and then reset to null.\n  const [currentInteraction, setCurrentInteraction] = useState<null | {\n    type: \"move\" | \"resize\";\n    bounds: Bounds;\n  }>(null);\n\n  const effectiveMinWidth =\n    minWidth === \"content\" ? contentSize.width : minWidth || 0;\n  const effectiveMinHeight =\n    minHeight === \"content\" ? contentSize.height : minHeight || 0;\n  const applyMinSize = withMinSize({\n    width: effectiveMinWidth,\n    height: effectiveMinHeight,\n  });\n  const overlayInteractionHandlerProps: OverlayInteractionHandlerProps = {\n    startInteraction: (type: \"move\" | \"resize\") => {\n      if (!overlayRef.current) {\n        throw new Error(\n          \"overlayRef value is not set. Make sure to have the ref passed to the resizable/movable overlay\"\n        );\n      }\n      const bounds = getBounds(overlayRef.current);\n      setCurrentInteraction({ bounds, type });\n      return bounds;\n    },\n    updateBounds: (updatedBounds) => {\n      setCurrentInteraction((currentInteraction) => {\n        if (currentInteraction) {\n          const { type } = currentInteraction;\n          return {\n            type,\n            bounds: onBoundsChanging(updatedBounds, type) || updatedBounds,\n          };\n        }\n        return currentInteraction;\n      });\n    },\n    finishInteraction: () => {\n      if (currentInteraction && overlayRef.current) {\n        setBounds(getBounds(overlayRef.current), currentInteraction.type);\n      }\n      setCurrentInteraction(null);\n    },\n    minWidth: effectiveMinWidth,\n    minHeight: effectiveMinHeight,\n  };\n\n  const partialBounds = currentInteraction?.bounds ?? bounds;\n  const centeredContentBounds = getCenteredBounds(\n    clamp(\n      effectiveMinWidth,\n      window.innerWidth,\n      bounds?.width ?? contentSize.width\n    ),\n    clamp(\n      effectiveMinHeight,\n      window.innerHeight,\n      bounds?.height ?? contentSize.height\n    )\n  );\n  return {\n    positioned:\n      partialBounds?.left != undefined && partialBounds?.top != undefined,\n    sized:\n      partialBounds?.width != undefined && partialBounds?.height != undefined,\n    bounds: applyMinSize({\n      /**\n       * Since input bounds may be partial (e.g. only specifying size), we create a full bounds object as a fallback,\n       * based on the measured size, positioned in center. We can introduce a \"loose\" mode, where the returned bound\n       * is not \"filled\" with default properties.\n       */\n      ...centeredContentBounds,\n      ...(partialBounds && filter((value) => value != null, partialBounds)),\n    }),\n    UNSAFE_measureContentSize: measureContentSize,\n    overlayInteractionHandlerProps,\n  };\n}\n\nfunction getBounds(element: HTMLElement) {\n  const { left, top, width, height } = element.getBoundingClientRect();\n  return { left, top, width, height };\n}\n","import React, { ForwardedRef, RefObject, useContext, useState } from \"react\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { useFocusWithin, useInteractOutside } from \"@react-aria/interactions\";\nimport { FocusScope, useFocusable } from \"@react-aria/focus\";\nimport { useOverlay, usePreventScroll } from \"@react-aria/overlays\";\nimport { filterDOMProps, useObjectRef } from \"@react-aria/utils\";\nimport { pipe } from \"ramda\";\n\nimport {\n  ensureInViewport,\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  position,\n  ResizableMovableOverlayOptions,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { areInNestedOverlays, Overlay } from \"@intellij-platform/core/Overlay\";\nimport { mergeNonNullProps } from \"@intellij-platform/core/utils/mergeNonNullProps\";\nimport { useFocusForwarder } from \"@intellij-platform/core/utils/useFocusForwarder\";\n\nimport { useDialog } from \"./_useDialog\";\nimport { PopupHeader } from \"./PopupHeader\";\nimport { PopupContext, PopupControllerContext } from \"./PopupContext\";\nimport { PopupLayout } from \"./PopupLayout\";\nimport { StyledPopupHint } from \"./StyledPopupHint\";\n\nexport const StyledPopupContainer = styled.div`\n  position: fixed;\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n`;\nexport interface PopupProps extends ResizableMovableOverlayOptions, DOMProps {\n  children: React.ReactNode;\n  onClose?: () => void;\n\n  nonDismissable?: boolean;\n\n  /**\n   * By default, Popup prevents scrolling on the scrollable ancestor, if popup is positioned relative to a target\n   * element. Allowing or disallowing scroll can be forced by passing boolean value.\n   */\n  allowScroll?: \"auto\" | boolean;\n\n  /**\n   * Used to position the popup relative to a target element, if there is no positioning information in the input\n   * `bounds`/`defaultBounds`.\n   */\n  positioning?: {\n    targetRef: RefObject<HTMLElement>;\n    placement?: \"bottom\" | \"top\";\n  };\n}\n\nexport const DEFAULT_POPUP_MIN_WIDTH = 50;\nexport const DEFAULT_POPUP_MIN_HEIGHT = 50;\n\n/**\n * [Popup](https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-%28Community%29?node-id=75426%3A16881&t=vzpRGV2y2cDw5a6Z-0)\n * component, rendered as a draggable overlay which is positioned either in the center of the viewport or relative to a trigger element.\n * If there is a trigger element, use {@link PopupTrigger} instead.\n */\nexport const _Popup = (\n  // NOTE: export is only for __docgenInfo to be emitted for this.\n  {\n    interactions = \"move\",\n    nonDismissable = false,\n    allowScroll = \"auto\",\n    minWidth = DEFAULT_POPUP_MIN_WIDTH,\n    minHeight = DEFAULT_POPUP_MIN_HEIGHT,\n    positioning: positioningProp,\n    onClose: onCloseProp,\n    ...props\n  }: PopupProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element => {\n  const propsContext = useContext(PopupControllerContext);\n  const positioning = positioningProp || propsContext.positioning;\n  const onClose = () => {\n    onCloseProp?.();\n    propsContext.onClose?.();\n  };\n  const ref = useObjectRef<HTMLDivElement>(forwardedRef);\n  const shouldCloseOnInteractOutside = (element: Element) => {\n    return (\n      !positioning?.targetRef.current?.contains(element) &&\n      !areInNestedOverlays(ref.current, element)\n    );\n  };\n  const { overlayProps } = useOverlay(\n    {\n      isOpen: true, // FIXME?\n      onClose,\n      shouldCloseOnBlur: !nonDismissable,\n      shouldCloseOnInteractOutside,\n    },\n    ref\n  );\n  // Passing isDismissable to useOverlay also utilizes useInteractOutside and closes the overlay, but it calls\n  // preventDefault() and stopPropagation() on the event, which prevents focus from going to elements outside the popup.\n  // Not sure why they do this in react-aria, but it seems we are better off not using that option and using\n  // useInteractOutside directly here like this:\n  useInteractOutside({\n    ref,\n    onInteractOutsideStart: (e) => {\n      if (\n        !ref.current?.contains(document.activeElement) && // If we are focused, shouldCloseOnBlur will call onClose.\n        !nonDismissable &&\n        shouldCloseOnInteractOutside(e.target as Element)\n      ) {\n        onClose();\n      }\n    },\n    // onInteractOutsideStart will not be called if onInteractOutside is not passed!\n    onInteractOutside: () => {},\n  });\n\n  usePreventScroll({\n    isDisabled: allowScroll === \"auto\" ? !positioning : allowScroll,\n  });\n\n  const { bounds, positioned, overlayInteractionHandlerProps } =\n    useResizableMovableOverlay(ref, {\n      ...props,\n      minWidth,\n      minHeight,\n      observeContentResize: true,\n    });\n  const positionedBounds =\n    positioning?.targetRef.current && !positioned\n      ? pipe(\n          position({\n            targetElement: positioning.targetRef.current,\n            placement: positioning.placement,\n          }),\n          ensureInViewport\n        )(bounds)\n      : bounds;\n\n  const [isActive, setActive] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setActive,\n  });\n  const { focusableProps } = useFocusable(\n    {\n      excludeFromTabOrder: true,\n    },\n    ref\n  );\n  const { focusForwarderProps } = useFocusForwarder();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  /**\n   * A hook like useOverlayStack or useOverlayZIndex can be introduced which would handle focus/blur, and return/set\n   * the right z-index so that only the overlay holding the focus would have a higher z-index than others.\n   */\n  const zIndex = isActive ? 1 : 0;\n\n  return (\n    <Overlay>\n      <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n        {/* TODO: FocusScope is redundant. Test focus restoration without it (in status bar progress), and remove it if unnecessary */}\n        <FocusScope restoreFocus>\n          <StyledPopupContainer\n            ref={ref}\n            style={{\n              ...positionedBounds,\n              zIndex,\n            }}\n            tabIndex={-1}\n            {...mergeNonNullProps(\n              focusWithinProps,\n              focusableProps,\n              focusForwarderProps,\n              overlayProps,\n              propsContext.overlayProps || {},\n              dialogProps,\n              filterDOMProps(props)\n            )}\n          >\n            <PopupContext.Provider\n              value={{\n                isActive,\n                movable: interactions !== \"none\",\n                titleProps,\n              }}\n            >\n              <StyledInnerContainer>{props.children}</StyledInnerContainer>\n              {interactions === \"all\" && <OverlayResizeHandles />}\n            </PopupContext.Provider>\n          </StyledPopupContainer>\n        </FocusScope>\n      </OverlayInteractionHandler>\n    </Overlay>\n  );\n};\n\nexport const Popup = Object.assign(React.forwardRef(_Popup), {\n  Header: PopupHeader,\n  Layout: PopupLayout,\n  Hint: StyledPopupHint,\n});\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { AriaDialogProps } from \"@react-types/dialog\";\nimport { FocusableElement } from \"@react-types/shared\";\nimport { filterDOMProps, useSlotId } from \"@react-aria/utils\";\nimport { focusSafely } from \"@react-aria/focus\";\nimport { RefObject, useEffect } from \"react\";\nimport { useOverlayFocusContain } from \"@react-aria/overlays\";\nimport { DialogAria } from \"@react-aria/dialog\";\n\n////////////////// NOTE //////////////////////////\n// This is a copy of useDialog from react-aria, with a little part removed from the useEffect call.\n// In the original code, inside the effect, there is a hack to fix an issue in Safari, which involves\n// blurring and refocusing the element. Even though there is a comment about an attempt to make it work\n// nice when used with `shouldCloseOnBlur` option of `useOverlay`, it didn't work and the refocusing causes\n// the popup to close. Probably because in our case useOverlay and useDialog are used in the same level, but\n// in what they've tested on in react-aria, useDialog is used in something nested in the component that uses\n// useDialog.\n// TODO: replace with original useDialog, if the issue explained above got fixed in some version of react-aria.\n//////////////////////////////////////////////////\n/**\n * Provides the behavior and accessibility implementation for a dialog component.\n * A dialog is an overlay shown above other content in an application.\n */\nexport function useDialog(\n  props: AriaDialogProps,\n  ref: RefObject<FocusableElement>\n): DialogAria {\n  let { role = \"dialog\" } = props;\n  let titleId: string | undefined = useSlotId();\n  titleId = props[\"aria-label\"] ? undefined : titleId;\n\n  // Focus the dialog itself on mount, unless a child element is already focused.\n  useEffect(() => {\n    if (ref.current && !ref.current.contains(document.activeElement)) {\n      focusSafely(ref.current);\n    }\n  }, [ref]);\n\n  useOverlayFocusContain();\n\n  return {\n    dialogProps: {\n      ...filterDOMProps(props, { labelable: true }),\n      role,\n      tabIndex: -1,\n      \"aria-labelledby\": props[\"aria-labelledby\"] || titleId,\n    },\n    titleProps: {\n      id: titleId,\n    },\n  };\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport { filter } from \"ramda\";\n\n/**\n * Like mergeProps, but doesn't merge props where value is null or undefined. That's needed because useFocusable (and\n * maybe some other react-aria hooks as well) return props like onFocus, with value set to null or undefined, which\n * overrides the same prop from other sources.\n */\n// @ts-expect-error not sure why!\nexport const mergeNonNullProps: typeof mergeProps = (...propsArray) => {\n  return mergeProps(\n    ...propsArray.map((props): typeof props =>\n      filter((value) => value != undefined, props)\n    )\n  );\n};\n","import { DOMAttributes } from \"@react-types/shared\";\nimport { createContext } from \"react\";\nimport { PopupProps } from \"./Popup\";\n\nexport const PopupContext = createContext<{\n  isActive: boolean;\n  movable: boolean;\n  titleProps: DOMAttributes;\n}>({ isActive: false, movable: true, titleProps: {} });\n\n/**\n * A context to provide some props that are necessary for PopupTrigger or PopupManager.\n * Passing those props via context helps with providing a nice API in those components.\n */\nexport const PopupControllerContext = createContext<\n  {\n    overlayProps?: DOMAttributes;\n  } & Partial<Pick<PopupProps, \"positioning\" | \"onClose\">>\n>({});\n","import React, { HTMLAttributes, useContext } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\n\nimport { PopupContext } from \"./PopupContext\";\n\nconst StyledPopupHeader = styled.div<{\n  active?: boolean;\n  hasControls?: boolean;\n}>`\n  box-sizing: border-box;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 1.5rem;\n  min-height: ${({ hasControls }) => hasControls && \"1.75rem\"};\n  cursor: default;\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"Popup.Header.activeForeground\" as UnknownThemeProp<\"Popup.Header.activeForeground\">,\n          theme.commonColors.labelForeground\n        )\n      : theme.color(\n          \"Popup.Header.inactiveForeground\" as UnknownThemeProp<\"Popup.Header.inactiveForeground\">,\n          theme.commonColors.labelDisabledForeground\n        )};\n  background-color: ${({ theme, active }) =>\n    active\n      ? theme.color(\"Popup.Header.activeBackground\", \"#e6e6e6\")\n      : theme.color(\"Popup.Header.inactiveBackground\", `#ededed`)};\n`;\n/**\n * Implements appearance of\n * [Popup Header](https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-%28Community%29?node-id=75455%3A26566&t=Hzwse5j5R6iCEzVW-4),\n * and also acts as a handle for moving the panel.\n * Expected to be used with {@link Popup.Layout}:\n *\n * @example\n * ```tsx\n * <Popup>\n *    <Popup.Layout header={<Popup.Header>header</Popup.Header>} />\n * </Popup>\n * ```\n */\nexport const PopupHeader = ({\n  children,\n  hasControls,\n}: {\n  children?: React.ReactNode;\n  hasControls?: boolean;\n}) => {\n  const { isActive, movable, titleProps } = useContext(PopupContext);\n  const renderHeader = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledPopupHeader\n      active={isActive}\n      hasControls={hasControls}\n      {...mergeProps(titleProps, otherProps)}\n    >\n      {children}\n    </StyledPopupHeader>\n  );\n  return movable ? (\n    <OverlayMoveHandle>\n      {({ moveHandleProps }) => renderHeader(moveHandleProps)}\n    </OverlayMoveHandle>\n  ) : (\n    renderHeader()\n  );\n};\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { Popup } from \"./Popup\";\nimport { PopupHeader } from \"./PopupHeader\";\nimport { StyledPopupHint } from \"@intellij-platform/core/Popup/StyledPopupHint\";\n\nconst StyledPopupLayout = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n`;\nconst StyledPopupLayoutHeader = styled.div`\n  flex-shrink: 0;\n`;\nconst StyledPopupLayoutContent = styled.div`\n  flex: 1;\n  overflow: auto;\n  // Not sure about making the content area a vertical flex container, but it seemed it makes sense as default.\n  // The use case at hand where this was added was \"Branches\" popup, which would of course be implementable without this\n  // too, with an extra flex container around the menu.\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledPopupLayoutFooter = styled.div`\n  flex-shrink: 0;\n`;\n\n/**\n * Popup content layout, supporting fixed `header` and `footer` sections, and a scrollable `content` area.\n */\nexport function PopupLayout({\n  header,\n  footer,\n  content,\n}: {\n  /**\n   * Fixed position header of the popup at the top. {@link Popup.Header} can be used for the content.\n   */\n  header?: React.ReactNode;\n  /**\n   * Scrollable content of the popup.\n   */\n  content: React.ReactNode;\n  /**\n   * Fixed position footer of the popup at the bottom. {@link Popup.Hint} can be used for the content.\n   */\n  footer?: React.ReactNode;\n}) {\n  return (\n    <StyledPopupLayout>\n      {header && (\n        <StyledPopupLayoutHeader>\n          {typeof header === \"string\" ? (\n            <PopupHeader>{header}</PopupHeader>\n          ) : (\n            header\n          )}\n        </StyledPopupLayoutHeader>\n      )}\n      <StyledPopupLayoutContent>{content}</StyledPopupLayoutContent>\n      {footer && (\n        <StyledPopupLayoutFooter>\n          {typeof footer === \"string\" ? (\n            <StyledPopupHint>{footer}</StyledPopupHint>\n          ) : (\n            footer\n          )}\n        </StyledPopupLayoutFooter>\n      )}\n    </StyledPopupLayout>\n  );\n}\n","import React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { Popup, PopupProps } from \"./Popup\";\nimport { PopupControllerContext } from \"@intellij-platform/core/Popup/PopupContext\";\n\ninterface PopupManagerAPI {\n  /**\n   * Shows a popup within the stack of popups managed by {@link PopupManager}.\n   * The opened popup will be closed when `onClose` interactions happen.\n   */\n  show(\n    popup:\n      | React.ReactElement<PopupProps, typeof Popup>\n      | ((args: {\n          close: () => void;\n        }) => React.ReactElement<PopupProps, typeof Popup>)\n  ): void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\n    \"PopupManager not found. Wrap your application with PopupManager to be able to open popups imperatively\"\n  );\n};\n\nconst PopupsContext = React.createContext<PopupManagerAPI>({\n  show: NotImplementedFn,\n});\n\n/**\n * Returns imperative API for showing popups.\n */\nexport const usePopupManager = (): PopupManagerAPI => useContext(PopupsContext);\n\ntype PopupElement = ReactElement<PopupProps, typeof Popup>;\n\nexport interface PopupManagerProps {\n  children?: ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link usePopupManager}) for showing Popups.\n * It renders popups in a portal appended to `body`, unless `disablePortal` is `true`.\n */\nexport const PopupManager: React.FC<PopupManagerProps> = ({ children }) => {\n  const [popups, setPopups] = useState<Array<PopupElement>>([]);\n  const newKeyRef = useRef<number>(0);\n\n  const api = useMemo<PopupManagerAPI>(() => {\n    const show: PopupManagerAPI[\"show\"] = (popup) => {\n      newKeyRef.current++;\n      const close = () => {\n        setPopups((currentPopups) =>\n          currentPopups.filter((aPopup) => aPopup !== wrappedPopup)\n        );\n      };\n      const wrappedPopup = (\n        <PopupControllerContext.Provider\n          key={newKeyRef.current}\n          value={{ onClose: close }}\n        >\n          {typeof popup === \"function\" ? popup({ close }) : popup}\n        </PopupControllerContext.Provider>\n      );\n      setPopups((currentPopups) => currentPopups.concat(wrappedPopup));\n    };\n    return {\n      show,\n    };\n  }, []);\n\n  return (\n    <PopupsContext.Provider value={api}>\n      {children}\n      {popups}\n    </PopupsContext.Provider>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { OverlayTriggerProps, useOverlayTrigger } from \"@react-aria/overlays\";\nimport { PressResponder } from \"@react-aria/interactions\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport {\n  OverlayTriggerProps as OverlayTriggerStateProps,\n  useOverlayTriggerState,\n} from \"@react-stately/overlays\";\n\nimport { PopupProps } from \"./Popup\";\nimport { PopupControllerContext } from \"./PopupContext\";\n\nexport interface PopupTriggerProps\n  extends Partial<OverlayTriggerProps>,\n    OverlayTriggerStateProps {\n  placement?: Required<PopupProps>[\"positioning\"][\"placement\"];\n  popup:\n    | React.ReactElement\n    | (({ close }: { close: () => void }) => React.ReactNode);\n  children: React.ReactElement;\n}\n\n/**\n * Popup opened by a trigger. `trigger` can be an element of any pressable component (such as {@link Button} or\n * {@link IconButton}), and is rendered in place. Similar to {@link Popup component}, `children` defines the content\n * of Popup.\n */\nexport const PopupTrigger = React.forwardRef(function PopupTrigger(\n  { placement, children, popup, ...props }: PopupTriggerProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  const state = useOverlayTriggerState(props);\n  const triggerRef = useObjectRef(forwardedRef);\n  const { overlayProps, triggerProps } = useOverlayTrigger(\n    { type: props.type || \"menu\" },\n    state,\n    triggerRef\n  );\n  return (\n    <>\n      <PressResponder ref={triggerRef} {...triggerProps}>\n        {children}\n      </PressResponder>\n      {state.isOpen && (\n        <PopupControllerContext.Provider\n          value={{\n            overlayProps,\n            positioning: {\n              targetRef: triggerRef,\n              placement,\n            },\n            onClose: state.close,\n          }}\n        >\n          {typeof popup === \"function\" ? popup({ close: state.close }) : popup}\n        </PopupControllerContext.Provider>\n      )}\n    </>\n  );\n});\n","import { styled } from \"@intellij-platform/core/styled\";\n\n/**\n * Hint component (aka Advertiser) used in Popup's footer.\n * {@see Popup.Layout}\n */\nexport const StyledPopupHint = styled.div`\n  // NOTE: Following the reference implementation, would require to set fallback colors non-prior to\n  // *.(background|foreground) colors (by not passing the fallback color as the second argument to theme.color).\n  // It's only in BigPopup that the fallback colors are prioritized over *-fallback. But in Figma designs, this is\n  // simplified, and hint always has the muted color (like in BigPopup), instead of the default foreground.\n  // So we are intentionally deviating from the reference implementation here.\n  background: ${({ theme }) =>\n    theme.color(\n      \"Popup.Advertiser.background\",\n      theme.color(\"SearchEverywhere.Advertiser.background\")\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Popup.Advertiser.foreground\",\n      theme.color(\"SearchEverywhere.Advertiser.foreground\")\n    )};\n  padding: 0.3125rem 0.9375rem 0.3125rem 0.625rem;\n  font-size: 0.875em;\n  line-height: normal;\n  user-select: none;\n  cursor: default;\n  // NOTE: white-space is intentionally not set as nowrap.\n`;\n","import React, {\n  CSSProperties,\n  HTMLAttributes,\n  Ref,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { keyframes } from \"styled-components\";\nimport { useProgressBar } from \"@react-aria/progress\";\nimport { AriaProgressBarProps } from \"@react-types/progress\";\nimport { PressProps, useHover } from \"@react-aria/interactions\";\nimport { useButton } from \"@react-aria/button\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\n\nexport interface ProgressBarProps extends Omit<AriaProgressBarProps, \"label\"> {\n  /**\n   * Process name, shown above or to the left of the progress bar. Placement is controlled by {@link namePosition}.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-name\n   */\n  name?: React.ReactNode;\n\n  /**\n   * Process name position with respect to the progress bar.\n   * If `namePosition` is \"side\", {@link name} is **not** automatically appended with a colon.\n   * @default \"top\"\n   */\n  namePosition?: \"side\" | \"top\";\n\n  /**\n   * Process details, placed bellow the progress bar, with a de-emphasized color.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-details\n   */\n  details?: React.ReactNode;\n\n  /**\n   * A second line of details. Not an officially documented feature, but it's supported in the reference impl.\n   */\n  secondaryDetails?: React.ReactNode;\n\n  /**\n   * Placed next to and aligned with the progress bar, used for\n   * [process control](https://jetbrains.github.io/ui/controls/progress_bar/#process-control) buttons.\n   */\n  button?: React.ReactNode;\n\n  /**\n   * Progress bar track width.\n   */\n  width?: CSSProperties[\"width\"];\n\n  /**\n   * Not supported in [the official specs](https://jetbrains.github.io/ui/controls/progress_bar/#25), but the progress\n   * bar in status bar has a denser spacing. It still won't be a pixel perfect match with the progress bar in the\n   * status bar.\n   */\n  dense?: boolean;\n\n  style?: HTMLAttributes<unknown>[\"style\"];\n  className?: HTMLAttributes<unknown>[\"className\"];\n}\n\ninterface ProgressBarContextObj {\n  setForcedDetails: (details: string | null) => void;\n  setTooltip: (tooltip: string | null) => void;\n}\n\n/**\n * @see https://jetbrains.github.io/ui/controls/progress_bar/\n * @see https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/platform-api/src/com/intellij/openapi/ui/panel/ProgressPanelBuilder.java\n *\n * Known issues:\n * There are a couple of UI issues because of the current layout (which can be improved probably):\n * - max-width of the label and details, it's not necessarily aligned with the the progressbar track, because they don't\n *   share the same container\n * - when label is on the side, details is aligned with the label, instead of the progressbar track.\n */\nexport const ProgressBar = ({\n  value = 0,\n  maxValue = 100,\n  minValue = 0,\n  name,\n  namePosition = \"top\",\n  details,\n  secondaryDetails,\n  button,\n  width,\n  dense,\n  className,\n  style,\n  ...props\n}: ProgressBarProps): React.ReactElement => {\n  const { progressBarProps, labelProps } = useProgressBar({\n    ...props,\n    label: name,\n    value,\n    maxValue,\n    minValue,\n  });\n  const percentage = (100 * (value / maxValue)).toFixed(0);\n  const [forcedDetails, setForcedDetails] = useState<null | string>(\"\");\n  const [tooltip, setTooltip] = useState<null | string>(\"\");\n\n  const contextValue: ProgressBarContextObj = useMemo(\n    () => ({\n      setForcedDetails,\n      setTooltip,\n    }),\n    []\n  );\n  const label = (\n    <StyledProgressBarLabel {...labelProps}>{name}</StyledProgressBarLabel>\n  );\n  const effectiveDetails = details ? tooltip || forcedDetails || details : null;\n  return (\n    <StyledProgressBarContainer style={style} className={className}>\n      {namePosition === \"top\" && label}\n      <StyledProgressBarLineContainer\n        dense={dense}\n        hasTopMargin={Boolean(name) && namePosition === \"top\"}\n        hasBottomMargin={Boolean(effectiveDetails)}\n      >\n        {namePosition === \"side\" && label}\n        <StyledProgressBarTrack\n          style={{ width }}\n          {...progressBarProps}\n          indeterminate={props.isIndeterminate}\n        >\n          {!props.isIndeterminate && (\n            <StyledProgressBarProgress style={{ width: `${percentage}%` }} />\n          )}\n        </StyledProgressBarTrack>\n        {props.showValueLabel && (\n          <span>{props.valueLabel ?? `${percentage}%`}</span>\n        )}\n        <ProgressBarContext.Provider value={contextValue}>\n          {button}\n        </ProgressBarContext.Provider>\n      </StyledProgressBarLineContainer>\n      <StyledProgressBarDetails>{effectiveDetails}</StyledProgressBarDetails>\n      <StyledProgressBarDetails>{secondaryDetails}</StyledProgressBarDetails>\n    </StyledProgressBarContainer>\n  );\n};\n\nconst ProgressBarContext = React.createContext<null | ProgressBarContextObj>(\n  null\n);\n\nconst StyledProgressBarContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.labelForeground /* TODO: check*/};\n  cursor: default; // prevent cursor on text\n`;\n\nconst StyledProgressBarLineContainer = styled.div<{\n  dense?: boolean;\n  hasTopMargin?: boolean;\n  hasBottomMargin?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  gap: ${({ dense }) => (dense ? \"0.5rem\" : \"0.625rem\")};\n  height: 4px;\n  // spacing is based on the reference impl and figma designs. top and bottom spacing is inverted in the spec document\n  // figma: https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-(Community)?node-id=75426%3A16650\n  // spec document: https://jetbrains.github.io/ui/controls/progress_bar/#25\n  margin-top: ${({ hasTopMargin }) => hasTopMargin && \"0.375rem\"};\n  margin-bottom: ${({ hasBottomMargin }) => hasBottomMargin && \"0.25rem\"};\n`;\n\nconst StyledProgressBarLabel = styled.div`\n  white-space: nowrap;\n  max-width: calc(100% - 2rem);\n  overflow: hidden;\n`;\n\nconst StyledProgressBarDetails = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n  font-size: 0.82em;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 2rem); // not the best way\n`;\n\nconst StyledProgressBarTrack = styled.div<{ indeterminate?: boolean }>`\n  height: inherit;\n  border-radius: 2px;\n  overflow: hidden;\n  display: flex;\n\n  // In case used in flex layout\n  min-width: 0;\n  flex: 1;\n\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.trackColor\",\n      theme.dark ? \"rgb(85,85,85)\" : \"rgb(196,196,196)\"\n    )};\n  ${({ indeterminate }) =>\n    indeterminate &&\n    css`\n      background: linear-gradient(\n        90deg,\n        ${getIndeterminateStartColor} 0%,\n        ${getIndeterminateEndColor} 50%,\n        ${getIndeterminateStartColor} 100%\n      );\n      background-size: 96px auto;\n      animation: 800ms ${indeterminateBackgroundAnimation} linear infinite;\n    `}\n`;\n\nconst getIndeterminateStartColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateStartColor\");\nconst getIndeterminateEndColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateEndColor\");\n\nconst indeterminateBackgroundAnimation = keyframes`\n  0% {\n    background-position: 0;\n  }\n  100% {\n    background-position: 96px;\n  }\n`;\n\nconst StyledProgressBarProgress = styled.div`\n  height: 100%;\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.progressColor\",\n      theme.dark ? \"rgb(160,160,160)\" : \"rgb(128,128,128)\"\n    )};\n`;\n\ntype ProgressBarIconButtonProps = Pick<PressProps, \"onPress\"> & {\n  hoverTooltip: string;\n};\n\n/**\n * Accessibility and functionality of progress bar icon buttons\n * @private maybe?\n */\nexport function useProgressBarIconButton(\n  { onPress, hoverTooltip }: ProgressBarIconButtonProps,\n  ref: Ref<HTMLElement>\n) {\n  const { buttonProps } = useButton(\n    {\n      onPress,\n      elementType: \"span\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: it works, but it's intentionally excluded from the type.\n      preventFocusOnPress: true,\n    },\n    ref\n  );\n  const context = useContext(ProgressBarContext);\n  const { hoverProps, isHovered } = useHover({});\n  useEffect(() => {\n    context?.setTooltip(isHovered ? hoverTooltip : null);\n  }, [hoverTooltip, isHovered]);\n  return {\n    buttonProps: mergeProps(buttonProps, hoverProps),\n  };\n}\n\n/**\n * @private maybe?\n * */\nexport function useProgressBarPauseIconButton(\n  { paused, ...props }: ProgressBarIconButtonProps & { paused: boolean },\n  ref: Ref<HTMLElement>\n) {\n  const context = useContext(ProgressBarContext);\n  useEffect(() => {\n    context?.setForcedDetails(paused ? \"Paused\" : null);\n  }, [paused]);\n  return useProgressBarIconButton(props, ref);\n}\n\n/**\n * Experimenting with an idea of exposing parts on each component, to maximize styling customizability, similar to\n * [classes](https://mui.com/joy-ui/api/button/#classes) API in MUI components. But instead of passing classes prop,\n * one would be able to create custom versions of a component by doing something like this:\n * const CustomComponent = styled(Component)`\n *   ${Component.part1} {\n *     // custom style here\n *   }\n * `;\n * The question is if this type of customizability is actually a good thing in the balance between flexibility for\n * catering for different use cases and not stepping out of the design system boundaries.\n * Another potential downside is that the public API expands to the anatomy of the component.\n */\nProgressBar.Container = StyledProgressBarContainer;\nProgressBar.Label = StyledProgressBarLabel;\nProgressBar.LineContainer = StyledProgressBarLineContainer;\nProgressBar.Track = StyledProgressBarTrack;\nProgressBar.Progress = StyledProgressBarProgress;\nProgressBar.Details = StyledProgressBarDetails;\n","import React, { useRef } from \"react\";\nimport { AutoHoverPlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { useProgressBarIconButton } from \"./ProgressBar\";\n\ninterface ProgressBarCancelButtonProps {\n  /**\n   * whether small icon should be used.\n   */\n  small?: boolean;\n  onPress: () => void;\n}\n\n/**\n * Stop (cancel) icon button for progress bar, to be used in {@link ProgressBarProps#button}.\n */\nexport const ProgressBarStopButton = ({\n  small,\n  onPress,\n}: ProgressBarCancelButtonProps) => {\n  const ref = useRef<HTMLSpanElement>(null);\n  const { buttonProps } = useProgressBarIconButton(\n    { onPress, hoverTooltip: \"Cancel\" },\n    ref\n  );\n  return (\n    <AutoHoverPlatformIcon\n      ref={ref}\n      {...buttonProps}\n      icon={`process/stop${small ? \"Small\" : \"\"}.svg`}\n      hoverIcon={`process/stop${small ? \"Small\" : \"\"}Hovered.svg`}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n} from \"./ThreeViewSplitter/ThreeViewSplitter\";\n\ntype ResizableViewProps = Omit<\n  ThreeViewSplitterProps,\n  | \"innerView\"\n  | \"firstView\"\n  | \"firstSize\"\n  | \"onFirstResize\"\n  | \"lastView\"\n  | \"lastSize\"\n  | \"onLastResize\"\n> & {\n  children: React.ReactNode;\n  onResize: ThreeViewSplitterProps[\"onFirstResize\"];\n  size: ThreeViewSplitterProps[\"firstSize\"];\n  /**\n   * Whether the resizer should be placed at before or after the resizable view.\n   */\n  resizerPlacement?: \"before\" | \"after\";\n};\n/**\n * A single resizable view, built on top of {@link ThreeViewSplitter}, just to provide better prop interface.\n * Like `ThreeViewSplitter` it supports \"horizontal\" or \"vertical orientations. There is an extra `resizerPlacement`\n * prop which determines where the resizer should be placed in relation with the view. When set to \"before\" the view\n * will be resizable from the start (\"left\" or \"top\"). When set to \"after\" the view will be resizable from end (\"right\"\n * or \"bottom\"). Default is \"after\"\n */\nexport const ResizableView = ({\n  children,\n  size,\n  onResize,\n  resizerPlacement = \"after\",\n  ...props\n}: ResizableViewProps) => (\n  <ThreeViewSplitter\n    {...(resizerPlacement === \"after\"\n      ? { firstView: children, firstSize: size, onFirstResize: onResize }\n      : { lastView: children, lastSize: size, onLastResize: onResize })}\n    {...props}\n  />\n);\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useBottomResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will increase/decrease the height\n */\nexport const BottomResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useBottomResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype HorizontalResizerViewProps = ResizerViewProps<\"horizontal\">;\n\nconst StyledHorizontalResizer = styled.div`\n  top: 0;\n  height: 100%;\n  width: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledHorizontalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: HorizontalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  width: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  height: 100%;\n  left: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a horizontal layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const HorizontalResizer: React.FC<HorizontalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"col\",\n  children,\n  style = {},\n  resizerProps,\n}) => {\n  return (\n    <StyledHorizontalResizer\n      {...resizerProps}\n      style={{ ...style, background, width: size }}\n    >\n      {children}\n      <StyledHorizontalResizerArea handleSize={outerPadding} cursor={cursor} />\n    </StyledHorizontalResizer>\n  );\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useLeftResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the left side of the resizable view. i.e.\n * moving mouse to right/left will decrease/increase the width\n */\nexport const LeftResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useLeftResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useRightResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the right side of the resizable view. i.e.\n * moving mouse to right/left will increase/decrease the width\n */\nexport const RightResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useRightResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useTopResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will decrease/increase the height\n */\nexport const TopResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useTopResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype VerticalResizerViewProps = ResizerViewProps<\"vertical\">;\n\nconst StyledVerticalResizer = styled.div`\n  width: 100%;\n  height: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledVerticalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: VerticalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  height: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  width: 100%;\n  top: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a vertical layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const VerticalResizer: React.FC<VerticalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"row\",\n  resizerProps,\n  children,\n  style = {},\n}) => (\n  <StyledVerticalResizer\n    {...resizerProps}\n    style={{ ...style, background, height: size }}\n  >\n    {children}\n    <StyledVerticalResizerArea handleSize={outerPadding} cursor={cursor} />\n  </StyledVerticalResizer>\n);\n","import { useMove } from \"../utils/interaction-utils/useMove\";\nimport { ResizerProps } from \"./ResizerProps\";\n\ntype UseResizerProps = Pick<\n  ResizerProps,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n>;\n\nexport type ResizerViewProps<O = \"horizontal\" | \"vertical\"> = Omit<\n  ResizerProps<O>,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n> &\n  ReturnType<typeof useResizer>;\n\nconst useResizer = (\n  orientation: \"horizontal\" | \"vertical\",\n  invert: boolean,\n  { onResizeStarted, onResize, onResizeEnd }: UseResizerProps\n) => {\n  const props = useMove({\n    dragThreshold: 0,\n    onMoveStart: () => onResizeStarted() || 0,\n    onMoveEnd: () => onResizeEnd?.(),\n    onMove: ({ movement, startState }) =>\n      onResize(\n        startState +\n          (invert ? -1 : +1) *\n            movement[orientation === \"horizontal\" ? \"x\" : \"y\"]\n      ),\n  });\n  return {\n    resizerProps: props,\n  };\n};\n\nexport const useLeftResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", true, props);\n};\n\nexport const useRightResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", false, props);\n};\n\nexport const useTopResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", true, props);\n};\n\nexport const useBottomResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", false, props);\n};\n","import React, { ComponentProps, useState } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\n\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  useGetActionShortcut,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { Input, InputProps } from \"@intellij-platform/core/InputField\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { Item } from \"@intellij-platform/core/Collections\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport interface SearchInputProps\n  extends Omit<InputProps, \"onSubmit\" | \"onChange\"> {\n  /**\n   * Search history to be shown as a menu when the search icon is pressed.\n   */\n  searchHistory?: Array<string>;\n  /**\n   * The content of \"show history\" button tooltip, and the corresponding action title.\n   * @default \"Recent Search\"\n   */\n  historyButtonTitle?: string;\n  /**\n   * Called when the search input is cleared by either clear button or `Escape` key.\n   * `onChange` is also called with an empty string, whenever the input is cleared,\n   * so there is no need for updating the state using `onClear`, when the value is controlled.\n   *\n   * @param clearedValue the value before clearing.\n   */\n  onClear?: (clearedValue: string) => void;\n  /**\n   * Called when the search is submitted by pressing `Enter`\n   * @param value submitted text\n   */\n  onSubmit?: (value: string) => void;\n  /**\n   * Controlled value of the search input\n   */\n  value?: string;\n  /**\n   * Default value of the search input, used for initialization when value is uncontrolled.\n   */\n  defaultValue?: string;\n  /**\n   * Called when the value is changed.\n   */\n  onChange?: (value: string) => void;\n  /**\n   * Called when a history item is selected. `onChange` is called with the selected text, so\n   * there is no need for updating the state using `onHistoryItemSelected`, when the value is controlled.\n   *\n   * @param value text selected from history.\n   * @param previousValue the value of the input before the history item was selected.\n   */\n  onHistoryItemSelected?: (value: string, previousValue: string) => void;\n}\n\nconst StyledInput = styled(Input)`\n  input[type=\"search\"] {\n    -webkit-appearance: none;\n    &::-webkit-search-cancel-button {\n      -webkit-appearance: none;\n    }\n    &::-webkit-search-decoration {\n      -webkit-appearance: none;\n    }\n  }\n`;\n\n/**\n * A wrapper around {@link Input} with a few additions:\n * - A Search icon, added as an {@link InputProps#addonBefore addonBefore}.\n * - A clear button, added as an {@link InputProps#addonAfter addonAfter}, when the input has value.\n *   {@link SearchInputProps#onClear onClear} is called when the clear button is clicked.\n * - A list of search queries shown as a menu, when the search icon is clicked,\n *   if {@link SearchInputProps#searchHistory searchHistory} is provided.\n * - An action provided on the input element, to open the search history via\n *   {@link CommonActionId.SHOW_SEARCH_HISTORY} shortcut.\n * - Search submission callback ({@link SearchInputProps#onSubmit onSubmit}) called when search is submitted by pressing Enter\n *\n * {@link InputProps#onChange onChange} and {@link InputProps#onSubmit onSubmit} props are also different in SearchInput, compared to\n * the corresponding props of the native input.\n *\n * Caveat: If the width is not set (either explicitly or via the entailing layout), the width of the input will change when clear button shows/hides.\n *\n */\nexport const SearchInput = React.forwardRef(function SearchInput(\n  {\n    addonBefore,\n    addonAfter,\n    searchHistory,\n    onClear,\n    onSubmit,\n    onHistoryItemSelected,\n    historyButtonTitle = \"Recent Search\",\n    value: valueProp,\n    defaultValue = \"\",\n    onChange,\n    type = \"search\",\n    inputRef: inputRefProp,\n    ...props\n  }: SearchInputProps,\n  forwardedRef: React.Ref<HTMLDivElement>\n) {\n  const [value, setValue] = useControlledState(\n    valueProp!,\n    defaultValue,\n    onChange!\n  );\n  const inputContainerRef = useObjectRef(forwardedRef);\n  const inputRef = useObjectRef(inputRefProp);\n  const [isSearchHistoryOpen, setSearchHistoryOpen] = useState(false);\n  const showSearchHistoryAction: ActionDefinition = {\n    id: CommonActionId.SHOW_SEARCH_HISTORY,\n    title: historyButtonTitle,\n    actionPerformed: () => {\n      setSearchHistoryOpen(true);\n    },\n  };\n  // TODO: rename HelpTooltip, ActionTooltip, etc. to Tooltip.Action Tooltip.Help, then add ActionTooltip in action\n  //  components, and use that instead of the more low-level API used here.\n  const getShortcut = useGetActionShortcut();\n  const searchIcon = searchHistory ? (\n    <MenuTrigger\n      isOpen={isSearchHistoryOpen}\n      onOpenChange={setSearchHistoryOpen}\n      positioningTargetRef={inputContainerRef}\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          autoFocus=\"first\"\n          onAction={(key) => {\n            const historyItemText =\n              searchHistory[parseInt(`${key}`.split(\"_\")[0])];\n            if (historyItemText !== undefined) {\n              setValue(historyItemText);\n              onHistoryItemSelected?.(historyItemText, value);\n              inputRef.current?.focus();\n            }\n          }}\n        >\n          {searchHistory.map((historyItem, index) => (\n            <Item key={`${index}_${historyItem}`}>{historyItem}</Item>\n          ))}\n        </Menu>\n      )}\n    >\n      {(menuTriggerProps, ref) => (\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={historyButtonTitle}\n              shortcut={getShortcut(CommonActionId.SHOW_SEARCH_HISTORY)}\n            />\n          }\n        >\n          {(tooltipTriggerProps) => (\n            <PlatformIcon\n              {...mergeProps(tooltipTriggerProps, menuTriggerProps)}\n              ref={ref}\n              icon=\"actions/searchWithHistory.svg\"\n              role=\"button\"\n              aria-label={historyButtonTitle}\n            />\n          )}\n        </TooltipTrigger>\n      )}\n    </MenuTrigger>\n  ) : (\n    <PlatformIcon icon=\"actions/search.svg\" />\n  );\n  const clear = () => {\n    setValue(\"\");\n    onClear?.(value);\n  };\n  const inputProps = mergeProps<ComponentProps<typeof Input>[]>(props, {\n    ref: inputContainerRef,\n    inputRef,\n    value,\n    type,\n    onChange: (event) => {\n      setValue(event.target.value);\n    },\n    addonBefore: (\n      <>\n        {searchIcon}\n        {addonBefore}\n      </>\n    ),\n    addonAfter: (\n      <>\n        {value && (\n          <AutoHoverPlatformIcon\n            onClick={clear}\n            role=\"button\"\n            aria-label=\"Clear search\"\n            icon=\"actions/close\"\n            hoverIcon=\"actions/closeHovered\"\n          />\n        )}\n        {addonAfter}\n      </>\n    ),\n    onKeyDown: (event) => {\n      if (event.repeat) {\n        return;\n      }\n      if (event.key === \"Enter\") {\n        onSubmit?.(event.currentTarget.value);\n      } else if (event.key === \"Escape\") {\n        clear();\n      }\n    },\n  });\n  if (searchHistory) {\n    return (\n      <ActionsProvider actions={[showSearchHistoryAction]}>\n        {({ shortcutHandlerProps }) => (\n          <StyledInput {...mergeProps(inputProps, shortcutHandlerProps)} />\n        )}\n      </ActionsProvider>\n    );\n  }\n  return <StyledInput {...inputProps} />;\n});\n","import React, { useRef } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface SpeedSearchInputProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n  clear: () => void;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 0.25rem;\n`;\n\nconst StyledSpeedSearchInput = styled.span<{ noMatch?: boolean }>`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  background: ${({ theme, noMatch }) =>\n    noMatch\n      ? theme.color(\n          \"SearchField.errorBackground\",\n          theme.dark ? \"#743A3A\" : \"#ffcccc\"\n        )\n      : theme.color(\n          \"TextField.background\"\n        )}; // fallback logic not checked with the ref impl\n  color: ${({ theme }) =>\n    theme.color(\n      \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n    )}; // fallback logic not checked with the ref impl\n  height: 1.5rem; // 24px, JBTextField COMPACT_HEIGHT\n  padding: 0.125rem 0.375rem;\n  border: 1px solid ${({ theme }) => theme.getOutlineColor(true, false)};\n  border-radius: ${({ theme }) =>\n    ((theme.value(\"Component.arc\") as number) ?? 5) / 2}px;\n`;\nconst StyledSearchText = styled.span`\n  flex: 1;\n  font-size: 0.91em; // RelativeFont.SMALL\n`;\n\n/**\n * An input field to be rendered to show the filter value in speed search in menus and similar speedSearch-enabled\n * components.\n * @see SpeedSearchPopup\n */\nexport const SpeedSearchInput = React.forwardRef<\n  HTMLElement,\n  SpeedSearchInputProps\n>(({ active, match, children, clear }, ref) => {\n  const clearButtonRef = useRef<HTMLElement>(null);\n  const { buttonProps } = useButton(\n    {\n      elementType: \"span\",\n      \"aria-label\": \"Clear search\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n      preventFocusOnPress: true,\n      onPress: clear,\n    },\n    clearButtonRef\n  );\n\n  // Temporary styled components until SearchInput is implemented\n  return active ? (\n    <StyledSpeedSearchInput ref={ref} noMatch={!match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      <StyledSearchText>\n        {(children || \"\").replace(/ /g, \"\\u00A0\")}\n      </StyledSearchText>\n      {children && (\n        <AutoHoverPlatformIcon\n          {...buttonProps}\n          ref={clearButtonRef}\n          icon=\"actions/close\"\n          hoverIcon=\"actions/closeHovered\"\n        />\n      )}\n    </StyledSpeedSearchInput>\n  ) : null;\n});\n","import { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React from \"react\";\nimport { styled } from \"../styled\";\n\nexport interface SpeedSearchPopupProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 10px;\n  vertical-align: middle;\n`;\n\n/**\n * The little popup view shown in the top left corner of list, tree, etc., which shows the search\n * query.\n * @see SpeedSearchInput\n */\nexport const SpeedSearchPopup = React.forwardRef<\n  HTMLElement,\n  SpeedSearchPopupProps\n>(({ active, match, children }, ref) =>\n  active ? (\n    <StyledSpeedSearchPopup ref={ref} noMatch={!match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      {(children || \"\").replace(/ /g, \"\\u00A0\")}\n    </StyledSpeedSearchPopup>\n  ) : null\n);\n\nconst StyledSpeedSearchPopup = styled.span<{ noMatch?: boolean }>`\n  // ref: https://github.com/JetBrains/intellij-community/blob/e3c7d96daba1d5d84d5650bde6c220aed225bfda/platform/platform-impl/src/com/intellij/ui/SpeedSearchBase.java#L53-L53\n  box-sizing: border-box;\n  position: absolute;\n  background: ${({ theme }) =>\n    theme.color(\n      \"SpeedSearch.background\",\n      theme.dark ? \"rgb(111,111,111)\" : \"#fff\"\n    )};\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"SpeedSearch.borderColor\",\n        theme.dark ? \"rgb(64, 64, 64)\" : \"rgb(192, 192, 192)\"\n      )};\n  color: ${({ noMatch, theme }) =>\n    noMatch\n      ? theme.color(\"SpeedSearch.errorForeground\", theme.commonColors.red)\n      : theme.color(\n          \"SpeedSearch.foreground\",\n          theme.commonColors.tooltipForeground\n        )};\n  z-index: 1;\n  padding: 3px 7px;\n  height: 25px;\n  line-height: 1.2;\n  transform: translateY(-100%);\n`;\n","import React, { useRef } from \"react\";\n\nfunction isTypeableElement(elem: HTMLElement): boolean {\n  const nonTypeableInputTypes: Array<HTMLInputElement[\"type\"]> = [\n    \"checkbox\",\n    \"radio\",\n    \"button\",\n  ];\n  return (\n    elem.isContentEditable ||\n    (elem instanceof HTMLInputElement &&\n      !nonTypeableInputTypes.includes(elem.type)) ||\n    elem instanceof HTMLTextAreaElement\n  );\n}\n\n/**\n * Main use case is for a list of item, which can have keyboard focus, be filterable and capture\n * typing if the corresponding keyboard events are not happening on an inner element (like an input)\n * that already handles typing.\n * @param value\n * @param onChange\n * TODO: add support for removing word by word by alt+backspace like native text fields.\n * TODO: add support for removing the whole content by command/ctrl+backspace.\n */\nexport function useGhostInput({\n  value,\n  onChange,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n}) {\n  const valueRef = useRef(value);\n  valueRef.current = value;\n  const onKeyDown = (event: React.KeyboardEvent | KeyboardEvent) => {\n    if (\n      !event.ctrlKey &&\n      !event.altKey &&\n      !event.metaKey &&\n      (!(event.target instanceof HTMLElement) ||\n        !isTypeableElement(event.target))\n    ) {\n      if (event.key.length === 1) {\n        // Seems reasonable to prevent default here generally, but the specific case this is added for is the space key,\n        // scrolling the page.\n        event.preventDefault();\n        return onChange(`${valueRef.current}${event.key}`);\n      }\n      if (event.key === \"Backspace\") {\n        const sliceEnd = event.metaKey ? 0 : -1;\n        onChange(valueRef.current.slice(0, sliceEnd));\n      }\n    }\n  };\n  return { onKeyDown } as const;\n}\n","import { useGhostInput } from \"./useGhostInput\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport { RefObject } from \"react\";\n\nexport interface SpeedSearchState {\n  /**\n   * Whether speed search is active. Speed search becomes active when the user starts to type and becomes inactive\n   * when Escape is pressed, or when the speed search container is blurred and `stickySearch` is false.\n   * Whenever speed search becomes inactive, search text is also cleared.\n   * Note that speed search can be active while search term is empty.\n   */\n  active: boolean;\n  setActive: (value: boolean) => void;\n  searchTerm: string;\n  setSearchTerm: (value: string) => void;\n  /**\n   * clears search term and sets active to false\n   */\n  clear: () => void;\n}\n\nexport interface SpeedSearchStateProps\n  extends ControlledStateProps<{\n    searchTerm: string;\n    active: boolean;\n  }> {}\n\nexport function useSpeedSearchState(\n  props: SpeedSearchStateProps\n): SpeedSearchState {\n  const [active, setActive] = useControlledState(\n    props.active!,\n    props.active || false,\n    props.onActiveChange!\n  );\n  const [searchTerm, setSearchTerm] = useControlledState(\n    props.searchTerm!,\n    props.defaultSearchTerm || \"\",\n    props.onSearchTermChange!\n  );\n\n  return {\n    active,\n    searchTerm,\n    setActive,\n    setSearchTerm,\n    clear: () => {\n      setSearchTerm(\"\");\n      setActive(false);\n    },\n  };\n}\n\nexport interface SpeedSearchProps {\n  stickySearch?: boolean;\n}\n\n/**\n * TODO: description\n * IMPORTANT: making the container element focusable is not a part of this hook. But it's a prerequisite for it to work.\n * Previously, a tabIndex:-1 was passed as a container prop, but it turns out it's not that simple. For collections for\n * example we usually want tab index to be 0 once it's not focused and then when an item is focused, we want it to be\n * -1, and such kind of logics are handled in their respective hooks. So, making the container focusable and how to do\n * it is NOT this hook's responsibility anymore.\n */\nexport function useSpeedSearch(\n  { stickySearch }: SpeedSearchProps,\n  { searchTerm, active, setActive, setSearchTerm }: SpeedSearchState,\n  ref: RefObject<HTMLElement>\n) {\n  const { onKeyDown: ghostInputKeydown } = useGhostInput({\n    value: searchTerm,\n    onChange: (value) => {\n      const trimmedValue = value.trimStart();\n      setSearchTerm(trimmedValue);\n      if (!active && trimmedValue !== \"\") {\n        setActive(true);\n      }\n    },\n  });\n  const clear = () => {\n    setSearchTerm(\"\");\n    setActive(false);\n  };\n\n  const {\n    keyboardProps: { onKeyDown, onKeyUp },\n  } = useKeyboard({\n    onKeyDown: (e) => {\n      if (!ref.current?.contains(e.target as HTMLElement)) {\n        // In case events are propagated through portals\n        return;\n      }\n      if ((e.key === \"a\" && e.metaKey) || e.ctrlKey) {\n        e.preventDefault();\n      }\n      if (e.key === \"Escape\") {\n        if (searchTerm) {\n          clear();\n          return;\n        }\n      } else {\n        ghostInputKeydown(e);\n      }\n      e.continuePropagation();\n    },\n  });\n\n  const {\n    focusWithinProps: { onFocus, onBlur },\n  } = useFocusWithin({\n    onFocusWithinChange: (focused) => {\n      if (!focused && !stickySearch) {\n        clear();\n      }\n    },\n  });\n\n  return {\n    containerProps: {\n      onFocus,\n      onBlur,\n      onKeyDown,\n      onKeyUp,\n    },\n  };\n}\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface StatusBarProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n}\n\n/**\n * Status bar rendered at the bottom of the main window. In the reference implementation, there are three slots for\n * content: left, right and center. It doesn't seem center is really necessary, so only left and right are supported\n * for now.\n * @param left content on the left side of the status bar.\n * @param right content on the right side of the status bar. Typically, a bunch of {@link StatusBarWidget}s\n */\nexport const StatusBar = ({\n  left,\n  right,\n}: StatusBarProps): React.ReactElement => {\n  return (\n    <StyledStatusBar\n      onMouseDown={(e) => {\n        // stop focus from going out of the currently focused element, when status bar is clicked\n        // might be too intrusive to prevent default unconditionally :-? Also, it may make sense for it to be an option\n        e.preventDefault();\n      }}\n    >\n      <StyledStatusBarLeft>{left}</StyledStatusBarLeft>\n      <StyledStatusBarRight>{right}</StyledStatusBarRight>\n    </StyledStatusBar>\n  );\n};\n\nconst StyledStatusBar = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.25rem;\n  display: flex;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between; // because there is left and right sides\n  background-color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.background\" as UnknownThemeProp<\"StatusBar.background\">,\n      theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)\n    ) || \"#fff\"};\n  color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.Widget.foreground\" as UnknownThemeProp<\"StatusBar.Widget.foreground\">,\n      theme.commonColors.labelForeground\n    )};\n  border-top: 1px solid\n    ${({ theme }) => theme.color(\"StatusBar.borderColor\", \"rgb(145, 145, 145)\")};\n  height: calc(1.25rem + 1px /* border*/);\n  line-height: 1.25rem;\n  font-size: 0.656rem; // not verified\n  cursor: default;\n`;\n\nconst StyledStatusBarSection = styled.div`\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n`;\n\nconst StyledStatusBarRight = styled(StyledStatusBarSection)`\n  flex-shrink: 0;\n`;\nconst StyledStatusBarLeft = styled(StyledStatusBarSection)`\n  flex-shrink: 1;\n  min-width: 0;\n  overflow: hidden;\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { PressProps, usePress } from \"@react-aria/interactions\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface StatusBarWidgetProps extends PressProps {\n  label?: React.ReactNode;\n  icon?: React.ReactNode;\n}\n\n/**\n * Status bar button (aka widget), with the right hover and pressed appearance.\n * It doesn't get focused when pressed, and is excluded from tab order.\n * Disabled style is not couldn't be found, so it's skipped at the moment.\n */\nexport const StatusBarWidget = React.forwardRef(function StatusBarWidget(\n  props: StatusBarWidgetProps,\n  forwardedRef: ForwardedRef<HTMLSpanElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // Maybe it's better for a11y to use useButton, or at least use button element?\n  const { pressProps, isPressed } = usePress({\n    ref,\n    ...props,\n    preventFocusOnPress: true,\n  });\n  const { focusableProps } = useFocusable({ excludeFromTabOrder: true }, ref);\n\n  const StyledWrapper = props.label\n    ? StyledStatusBarWidget\n    : StyledStatusBarIconWidget;\n  return (\n    <StyledWrapper\n      {...mergeProps(pressProps, focusableProps)}\n      className={isPressed ? \"pressed\" : \"\"}\n      ref={ref}\n    >\n      {props.icon}\n      {props.icon && props.label && (\n        <>&nbsp;</> //not the nicest way to handle spacing!\n      )}\n      {props.label}\n    </StyledWrapper>\n  );\n});\n\nconst StyledStatusBarWidget = styled.span`\n  display: inline-flex;\n  align-items: center;\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.375rem\"};\n  height: 1.125rem;\n  white-space: nowrap;\n  &:hover {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverBackground\" as UnknownThemeProp<\"StatusBar.Widget.hoverBackground\">,\n        theme.color(\"ActionButton.hoverBackground\", \"#dfdfdf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverForeground\" as UnknownThemeProp<\"StatusBar.Widget.hoverForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n  &.pressed {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedBackground\" as UnknownThemeProp<\"StatusBar.Widget.pressedBackground\">,\n        theme.color(\"ActionButton.pressedBackground\", \"#cfcfcf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedForeground\" as UnknownThemeProp<\"StatusBar.Widget.pressedForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n`;\n\nconst StyledStatusBarIconWidget = styled(StyledStatusBarWidget)`\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.25rem\"};\n`;\n","import React from \"react\";\nimport { styled } from \"./styled\";\n\ntype SeparatorUI = {\n  STRIPE_INDENT: number;\n  STRIPE_WIDTH: number;\n};\n\n// based on implementation in com.intellij.ide.ui.laf.darcula.ui.DarculaSeparatorUI, which seems to be used for all themes\nconst DarculaSeparatorUI: SeparatorUI = {\n  STRIPE_INDENT: 1,\n  STRIPE_WIDTH: 1,\n};\n\nconst defaultSize =\n  2 * DarculaSeparatorUI.STRIPE_INDENT + DarculaSeparatorUI.STRIPE_WIDTH;\n\nexport const StyledSeparator = styled.hr(({ theme }) => ({\n  backgroundColor: theme.color(\n    \"Separator.separatorColor\",\n    theme.dark ? \"#cdcdcd\" : \"#515151\"\n  ),\n  backgroundClip: \"content-box\",\n  boxSizing: \"border-box\",\n  margin: 0,\n  border: \"none\",\n  flexShrink: 0,\n}));\n\nexport const StyledHorizontalSeparator = styled(StyledSeparator)`\n  height: inherit; // should it be auto?\n  padding: 0 ${DarculaSeparatorUI.STRIPE_INDENT}px;\n  width: ${defaultSize}px;\n`;\nexport const StyledVerticalSeparator = styled(StyledSeparator)`\n  width: auto;\n  padding: ${DarculaSeparatorUI.STRIPE_INDENT}px 0;\n  height: ${defaultSize}px;\n`;\n","import React from \"react\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport {\n  TabContentLayout,\n  TabItemLayoutProps,\n} from \"@intellij-platform/core/Tabs/TabContentLayout\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { BareButton } from \"@intellij-platform/core/Button\";\n\ninterface EditorTabContentProps {\n  icon: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button, shown in place of \"pin\" button if not pinned. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <EditorTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactElement;\n  onUnpin?: () => void;\n  pinned?: boolean;\n  containerProps?: TabItemLayoutProps[\"containerProps\"];\n}\n/**\n * For rendering the content of Editor tabs. supports for file icon which is shown on the left and close or unpin\n * button shown on the right.\n */\nexport const EditorTabContent = ({\n  icon,\n  title,\n  closeButton,\n  onUnpin,\n  pinned,\n  containerProps,\n}: EditorTabContentProps) => {\n  return (\n    <TabContentLayout\n      startIcon={icon}\n      title={title}\n      containerProps={containerProps}\n      endIcon={\n        pinned ? (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Unpin Tab\" />}>\n            <BareButton\n              onPress={onUnpin}\n              excludeFromTabOrder\n              preventFocusOnPress\n            >\n              <PlatformIcon icon=\"actions/pinTab\" />\n            </BareButton>\n          </TooltipTrigger>\n        ) : (\n          closeButton\n        )\n      }\n    />\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const editorTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"EditorTabs.borderColor\"),\n  underlineHeight: theme.value<number>(\"EditorTabs.underlineHeight\"),\n  background: theme.color(\"EditorTabs.background\"),\n  underlinedTabInactiveBackground: theme.color(\n    \"EditorTabs.underlinedTabBackground\" // that's correctly not underlinedTabInactiveBackground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabBackground: theme.color(\"EditorTabs.underlinedTabBackground\"), // TODO: use EditorColorsScheme when available\n  hoverInactiveBackground: theme.color(\n    \"EditorTabs.hoverInactiveBackground\" as UnknownThemeProp<\"EditorTabs.hoverInactiveBackground\">\n  ),\n  hoverBackground: theme.color(\"EditorTabs.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\"EditorTabs.inactiveUnderlineColor\"), // TODO: use EditorColorsScheme when available\n  underlineColor: theme.color(\"EditorTabs.underlineColor\"), // TODO: use EditorColorsScheme when available\n\n  underlinedTabInactiveForeground: theme.color(\n    \"EditorTabs.underlinedTabForeground\" // that's correctly not underlinedTabInactiveForeground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabForeground: theme.color(\"EditorTabs.underlinedTabForeground\"), // TODO: use EditorColorsScheme when available\n});\nexport const StyledEditorTab = styled(StyledDefaultTab)`\n  font-size: 0.7rem;\n  ${({ theme }) => getTabThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { editorTabTheme } from \"./StyledEditorTab\";\n\nexport const StyledEditorTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledEditorTab } from \"./StyledEditorTab\";\nimport { StyledEditorTabs } from \"./StyledEditorTabs\";\nimport React from \"react\";\n\nexport type EditorTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const EditorTabs = <T extends object>(props: EditorTabsProps<T>) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledEditorTab}\n    TabsComponent={StyledEditorTabs}\n    focusable={false}\n  />\n);\n","import { getTabThemeStyles } from \"./TabTheme\";\nimport { styled } from \"../styled\";\nimport { Theme, UnknownThemeProp } from \"../Theme\";\n\nexport type StyledTabProps = {\n  selected?: boolean;\n  disabled?: boolean;\n  active?: boolean;\n};\n\nconst defaultTabTheme = ({ theme }: { theme: Theme }) =>\n  getTabThemeStyles({\n    underlineHeight: theme.value<number>(\"DefaultTabs.underlineHeight\") ?? 3,\n    inactiveUnderlineColor: theme.color(\n      \"DefaultTabs.inactiveUnderlineColor\",\n      theme.dark ? \"#747a80\" : \"#9ca7b8\"\n    ),\n    underlineColor: theme.color(\n      \"DefaultTabs.underlineColor\",\n      theme.dark ? \"#4A88C7\" : \"#4083C9\"\n    ),\n\n    underlinedTabInactiveForeground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveForeground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveForeground\">\n    ),\n    underlinedTabForeground: theme.color(\"DefaultTabs.underlinedTabForeground\"),\n\n    background: theme.color(\n      \"DefaultTabs.background\",\n      theme.dark ? \"#3C3F41\" : \"#ECECEC\"\n    ),\n    underlinedTabInactiveBackground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveBackground\">\n    ),\n    underlinedTabBackground: theme.color(\n      \"DefaultTabs.underlinedTabBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabBackground\">\n    ),\n    hoverInactiveBackground: theme.color(\n      \"DefaultTabs.hoverInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.hoverInactiveBackground\">,\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n    hoverBackground: theme.color(\n      \"DefaultTabs.hoverBackground\",\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n  });\n\nexport const StyledDefaultTab = styled.div<StyledTabProps>`\n  box-sizing: border-box;\n  display: inline-flex;\n  letter-spacing: 0.015rem;\n  font-size: 0.85rem;\n  cursor: default;\n  white-space: nowrap;\n\n  // spacing\n  padding: 0 0.5rem;\n  line-height: 1.7rem; // vertical spacing handled by line-height\n\n  // disabled state doesn't seem to be supported in Intellij Platform at all.\n  opacity: ${({ disabled }) => (disabled ? \".5\" : \"1\")};\n  color: ${({ theme }) =>\n    theme.color(\n      \"DefaultTabs.foreground\" as UnknownThemeProp<\"DefaultTabs.foreground\">\n    )};\n\n  position: relative;\n  &::after {\n    content: \"\";\n    position: absolute;\n    width: 100%;\n    left: 0;\n    bottom: 0;\n  }\n\n  ${defaultTabTheme};\n`;\n","import { Theme } from \"../Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"./TabTheme\";\n\nconst defaultTabsTheme = ({ theme }: { theme: Theme }) =>\n  getTabsThemeStyles({\n    borderColor: theme.color(\n      \"DefaultTabs.borderColor\",\n      theme.commonColors.contrastBorder\n    ),\n    background: theme.color(\"DefaultTabs.background\"),\n  });\n\nexport const StyledDefaultTabs = styled.div<{ noBorders?: boolean }>`\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  border-style: solid;\n  border-width: ${({ noBorders }) => (noBorders ? \"0\" : \"1px 0\")};\n\n  ${defaultTabsTheme};\n`;\n","import React from \"react\";\nimport { BareButton, BareButtonProps } from \"@intellij-platform/core/Button\";\nimport { PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\n\nconst StyledIconWrapper = styled.span`\n  display: inherit;\n  .icon.hover {\n    display: none;\n  }\n  &:hover {\n    .icon {\n      display: none;\n    }\n    .icon.hover {\n      display: unset;\n    }\n  }\n`;\n/**\n * Close button for Tab\n */\nexport const TabCloseButton = (props: Omit<BareButtonProps, \"children\">) => {\n  // using useHover proved to be unstable.\n  return (\n    <BareButton {...props} excludeFromTabOrder preventFocusOnPress>\n      <StyledIconWrapper>\n        <PlatformIcon icon={\"actions/closeHovered\"} className=\"icon hover\" />\n        <PlatformIcon icon={\"actions/close\"} className=\"icon\" />\n      </StyledIconWrapper>\n    </BareButton>\n  );\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { css, styled } from \"../styled\";\nimport { useFocusable } from \"@react-aria/focus\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\n\nconst StyledTabItemLayout = styled.div`\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst iconStyle = css`\n  display: inline-flex; // without this, the wrapper takes the full height, causing icon to be placed on top\n  margin-top: -0.1rem; // seems necessary for pixel perfect match with the original impl\n`;\n\nconst StyledStartIconWrapper = styled.span`\n  ${iconStyle};\n  margin-right: 0.25rem;\n`;\n\nconst StyledEndIconWrapper = styled.span`\n  ${iconStyle};\n  margin-left: 0.25rem;\n  margin-right: -0.25rem; // default padding of the tab should be a little reduced when close icon is there.\n  border-radius: 16px;\n`;\n\nexport interface TabItemLayoutProps {\n  /**\n   * the icon placed before the text.\n   */\n  startIcon?: React.ReactNode;\n  /**\n   * title of the tab. Normally just a string\n   */\n  title?: React.ReactNode;\n  /**\n   * the icon placed after the text. Typical use cases: close or pin icon.\n   */\n  endIcon?: React.ReactNode;\n\n  /**\n   * Generic HTML props passed to the container div.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n}\n\n/**\n * Helper component for rendering the common layout of tab content.\n */\nexport const TabContentLayout = React.forwardRef(\n  (\n    { startIcon, title, endIcon, containerProps = {} }: TabItemLayoutProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    // To allow tooltip be used easily. TooltipTrigger passes props via FocusableContext.\n    const { focusableProps } = useFocusable({}, useObjectRef(ref));\n    return (\n      <StyledTabItemLayout\n        {...mergeProps(focusableProps, containerProps)}\n        ref={ref}\n      >\n        {startIcon && (\n          <StyledStartIconWrapper>{startIcon}</StyledStartIconWrapper>\n        )}\n        {title}\n        {endIcon && <StyledEndIconWrapper>{endIcon}</StyledEndIconWrapper>}\n      </StyledTabItemLayout>\n    );\n  }\n);\n","import { ItemProps } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport React from \"react\";\n\nexport interface TabItemProps extends ItemProps<never> {\n  /**\n   * Determines how the tab item should look when rendered as a menu item in overflow menu.\n   * If not passed, `textValue` will be used.\n   * @example\n   * <TabItem\n   *   key={tab.id}\n   *   textValue={tab.title}\n   *   inOverflowMenu={\n   *     <MenuItemLayout content={tab.title} icon={icon} />\n   *   }\n   *  >\n   *   <TabContentLayout startIcon={icon} title={tab.title} />\n   * </TabItem>\n   */\n  inOverflowMenu?: React.ReactNode;\n}\n\n/**\n * Same as {@link Item}, but allows for specifying the tab content for when it's rendered in the overflow menu item.\n */\nexport const TabItem: (props: TabItemProps) => React.ReactElement = Item;\n","import { css } from \"@intellij-platform/core/styled\";\nimport { StyledTabProps } from \"./StyledDefaultTab\";\n\n/**\n * Describes theme-able properties of a tab, which can then be passed to {@link getTabThemeStyles}\n */\nexport interface TabTheme {\n  underlineHeight?: number;\n\n  borderColor?: string;\n\n  inactiveUnderlineColor?: string;\n  underlineColor?: string;\n\n  underlinedTabInactiveForeground?: string;\n  underlinedTabForeground?: string;\n\n  background?: string;\n  underlinedTabBackground?: string;\n  underlinedTabInactiveBackground?: string;\n  hoverInactiveBackground?: string;\n  hoverBackground?: string;\n  inactiveColoredTabBackground?: string; // not used for now\n}\n\nexport const getTabsThemeStyles = ({\n  background,\n  borderColor,\n}: Pick<TabTheme, \"background\" | \"borderColor\">) => css`\n  border-color: ${borderColor};\n  background: ${background};\n`;\n\n/**\n * Converts tab theme properties to a chunk of style that can be dropped in a styled version of StyledDefaultTab\n *\n * @example\n * ```ts\n * const StyledCustomTab = styled(StyledDefaultTab)`\n *   ${getTabThemeStyles({background: 'red'})}\n * `\n * ```\n */\nexport const getTabThemeStyles = ({\n  underlineHeight,\n\n  background,\n  underlinedTabBackground,\n  underlinedTabInactiveBackground,\n  hoverInactiveBackground,\n  hoverBackground,\n\n  underlinedTabForeground,\n  underlinedTabInactiveForeground,\n\n  inactiveUnderlineColor,\n  underlineColor,\n}: TabTheme) =>\n  css<StyledTabProps>`\n    // active indicator\n    &::after {\n      height: ${underlineHeight != null ? `${underlineHeight}px` : undefined};\n      background-color: ${({ selected }) => selected && inactiveUnderlineColor};\n      background-color: ${({ selected, active }) =>\n        selected && active && underlineColor};\n    }\n\n    // foreground rules\n    color: ${({ selected }) => selected && underlinedTabInactiveForeground};\n    color: ${({ selected, active }) =>\n      selected && active && underlinedTabForeground};\n\n    //  background rules\n    background: ${background};\n    background: ${({ selected }) =>\n      selected && underlinedTabInactiveBackground};\n    background: ${({ selected, active }) =>\n      selected && active && underlinedTabBackground};\n\n    ${({ disabled, active }) =>\n      !disabled &&\n      css`\n        &:hover,\n        &.hover /* for testing purposes */ {\n          background: ${hoverInactiveBackground};\n          background: ${active && hoverBackground};\n        }\n      `}\n  `;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\ninterface Props {\n  hasOverflowAtStart: boolean;\n  hasOverflowAtEnd: boolean;\n}\n\nconst horizontalOverflowIndicatorStyles = css`\n  content: \"\";\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 10px;\n  z-index: 1;\n`;\nexport const StyledHorizontalOverflowShadows = styled.div<Props>`\n  position: relative; // for overflow indicator (pseudo-)elements to be positioned absolute\n\n  /* FIXME: find out what color, width and gradient parameters are used in the original implementation */\n  ${({ hasOverflowAtStart }) =>\n    hasOverflowAtStart &&\n    css`\n      ::before {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        left: 0;\n      }\n    `};\n  ${({ hasOverflowAtEnd }) =>\n    hasOverflowAtEnd &&\n    css`\n      ::after {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          -90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        right: 0;\n      }\n    `};\n`;\n","import { useTab } from \"@react-aria/tabs\";\nimport { TabListState } from \"@react-stately/tabs\";\nimport { Node } from \"@react-types/shared\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport React, { ForwardedRef, forwardRef, RefObject, useEffect } from \"react\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\n\ntype TabProps<T extends object> = {\n  state: TabListState<object>;\n  item: Node<T>;\n  /**\n   * {@see TabsProps#focusable}\n   */\n  focusable?: boolean;\n  /**\n   * {@see TabsProps#active}\n   */\n  active?: boolean;\n  shouldSelectOnPressUp?: boolean;\n  Component?: typeof StyledDefaultTab;\n};\n\nexport const Tab = forwardRef(function Tab<T extends object>(\n  {\n    state,\n    item,\n    focusable,\n    active,\n    shouldSelectOnPressUp,\n    Component = StyledDefaultTab,\n  }: TabProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): React.ReactElement {\n  const { key, rendered } = item;\n  const ref = useForwardedRef(forwardedRef);\n  const {\n    tabProps: {\n      /**\n       * by extracting out tabIndex, all keyboard support of the tabs is disabled, since we prevent the tab from being\n       * focusable.\n       */\n      tabIndex,\n      ...tabProps\n    },\n  } = useTab(\n    {\n      key,\n      // @ts-expect-error  TODO(@react-aria/tabs): update to ^3.6.0 to support this\n      shouldSelectOnPressUp,\n    },\n    state,\n    ref\n  );\n  const isSelected = state.selectedKey === key;\n  const isDisabled = state.disabledKeys.has(key);\n\n  return (\n    <Component\n      {...tabProps}\n      tabIndex={focusable ? tabIndex : undefined}\n      ref={ref}\n      active={active}\n      selected={isSelected}\n      disabled={isDisabled}\n    >\n      {rendered}\n    </Component>\n  );\n});\n","import React, { Key, useEffect } from \"react\";\nimport { useTabList } from \"@react-aria/tabs\";\nimport { filterDOMProps, mergeProps, scrollIntoView } from \"@react-aria/utils\";\nimport { useTabListState } from \"@react-stately/tabs\";\nimport { AriaTabListProps } from \"@react-types/tabs\";\nimport { StyledHorizontalOverflowShadows } from \"./StyledHorizontalOverflowShadows\";\nimport { TabsOverflowMenu } from \"./TabsOverflowMenu\";\nimport { useOverflowObserver } from \"../utils/overflow-utils/useOverflowObserver\";\nimport { useHasOverflow } from \"./useHasOverflow\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport { StyledDefaultTabs } from \"./StyledDefaultTabs\";\nimport { Tab } from \"./Tab\";\n\nexport type TabsProps<T> = Omit<\n  AriaTabListProps<T>,\n  \"orientation\" | \"isDisabled\" | \"\"\n> & {\n  /**\n   * Whether tabs should be focusable or not. By default, following the Intellij Platform implementation, tabs are\n   * not focusable and therefore lack the keyboard accessibility support specified in WAI-ARIA.\n   * You can change this default behaviour and make the tabs keyboard accessible by passing `focusable`.\n   * focus styles are not perfect at the moment, since it's not considered an important feature.\n   * @default false\n   */\n  focusable?: boolean;\n\n  /**\n   * Whether selected tab should change on press up instead of press down.\n   * @default false.\n   */\n  shouldSelectOnPressUp?: boolean;\n\n  /**\n   * Enables \"active\" style on tabs. Is usually related to a container having focus.\n   */\n  active?: boolean;\n\n  /**\n   * If set to true, tabs will be wrapped into multiple rows if needed.\n   * NOTE: In the original implementation, in multi row mode, rows are separated by a border. It's not easy to achieve\n   * this when we are implementing this feature with a simple `flex-wrap: wrap` css rule. It doesn't seem that\n   * important, but we can achieve something similar by some css tricks like the ones suggested here:\n   * https://stackoverflow.com/questions/36128333/row-lines-for-flex-container-css\n   * @default false\n   */\n  multiRow?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * If set to true and multiRow is not true, it will prevent horizontal scroll of tabs. Depending on the value of\n   * In this case:\n   * - if {@link noOverflowMenu} is not set to true, tabs that can't be fitted into the available space will be\n   *   accessible via an overflow menu.\n   * - if {@link noOverflowMenu} is set to true, the tabs will be fitted into the available space, and they will\n   *   be shrunk when needed.\n   *\n   * @todo: not implemented yet.\n   * @default false\n   */\n  noScroll?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * When set to true, tabs that couldn't be fitted into the available space, are either shrunk (if {@link noScroll}\n   * is set to true), or are just accessible by scroll.\n   */\n  noOverflowMenu?: boolean;\n\n  /**\n   * Removes the top and bottom border when passed.\n   * It's still not clear whether such option makes sense or not, but\n   * at least in common use cases like in tool windows, it seems borders are already there and there should be a way\n   * of removing tab borders. On the other hand, when Tabs is used without any assumption about the surrounding UI,\n   * it kind of makes sense to have the top and bottom borders by default. So that's why this is made an option for\n   * now, maybe until things are clearer.\n   *\n   * @default false\n   */\n  noBorders?: boolean;\n\n  TabsComponent?: typeof StyledDefaultTabs;\n  /**\n   *\n   */\n  TabComponent?: typeof StyledDefaultTab;\n};\n\nconst scrollBarDisabledStyle = css`\n  -ms-overflow-style: none; /* for Internet Explorer, Edge */\n  scrollbar-width: none; /* for Firefox */\n  &::-webkit-scrollbar {\n    /* for Chrome/Safari/Webkit */\n    display: none;\n  }\n`;\n\nconst StyledTabList = styled.div<{ multiRow?: boolean }>`\n  display: flex;\n  flex-wrap: ${({ multiRow }) => (multiRow ? \"wrap\" : \"nowrap\")};\n  overflow: auto;\n\n  ${scrollBarDisabledStyle};\n`;\n\n/**\n *\n * TODO: add support for overflow:\n *  - have vertical scroll also scroll tabs\n *  - add support for re-reordering tabs.\n *  - FIX: When a tab that was not selected is removed, selection should not change. It now changes to the tab before the removed one.\n */\nexport const Tabs = <T extends object>({\n  focusable,\n  shouldSelectOnPressUp,\n  active,\n  TabComponent,\n  TabsComponent = StyledDefaultTabs,\n  multiRow,\n  noOverflowMenu,\n  noScroll,\n  noBorders,\n  ...props\n}: TabsProps<T>): React.ReactElement => {\n  const state = useTabListState(props);\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { tabListProps } = useTabList(props, state, ref);\n\n  const { scrolledIndicatorProps, hasOverflow } = useHasOverflow({ ref });\n  const { overflowedElements } = useOverflowObserver(ref);\n  const overflowedKeys = new Set(\n    overflowedElements\n      .map((element) =>\n        element instanceof HTMLElement ? element.dataset[\"key\"] : null\n      )\n      .filter(notNull)\n  );\n\n  useEffect(() => {\n    if (!noScroll) {\n      const scrollableContainer = ref.current;\n      const selectedTabElement = scrollableContainer?.querySelector(\n        `[data-key=\"${state.selectedKey}\"]`\n      ) as HTMLElement;\n      if (scrollableContainer && selectedTabElement) {\n        scrollIntoView(scrollableContainer, selectedTabElement);\n      }\n    } else {\n      // TODO maybe? sample use case: project tool window tabs, when not grouped.\n    }\n  }, [state.selectedKey]);\n  const onOverflowMenuItemSelected = (key: Key) => {\n    state.setSelectedKey(key);\n  };\n  if (noScroll) {\n    throw new Error(\"noScroll is not supported yet.\");\n  }\n  return (\n    <TabsComponent noBorders={noBorders} {...filterDOMProps(props)}>\n      <StyledHorizontalOverflowShadows\n        hasOverflowAtStart={hasOverflow.left}\n        hasOverflowAtEnd={hasOverflow.right}\n        style={{ minWidth: 0 }}\n      >\n        <StyledTabList\n          {...mergeProps(tabListProps, scrolledIndicatorProps)}\n          multiRow={multiRow}\n          ref={ref}\n        >\n          {[...state.collection].map((item) => (\n            <Tab\n              key={item.key}\n              item={item}\n              state={state}\n              focusable={focusable}\n              shouldSelectOnPressUp={shouldSelectOnPressUp}\n              active={active}\n              Component={TabComponent}\n            />\n          ))}\n        </StyledTabList>\n      </StyledHorizontalOverflowShadows>\n      {!noOverflowMenu && (\n        <TabsOverflowMenu\n          collection={state.collection}\n          overflowedKeys={overflowedKeys}\n          onSelect={onOverflowMenuItemSelected}\n        />\n      )}\n    </TabsComponent>\n  );\n};\n","import { RefObject, UIEventHandler, useEffect, useState } from \"react\";\n\nexport function useHasOverflow<T extends HTMLElement>({\n  threshold = 5,\n  ref,\n}: {\n  threshold?: number;\n  ref: RefObject<T>;\n}) {\n  const [hasOverflow, setHasOverflow] = useState({\n    left: false,\n    right: false,\n    top: false,\n    bottom: false,\n  });\n\n  const update = () => {\n    const element = ref.current;\n    if (element) {\n      const offsetLeft = element.scrollLeft;\n      const offsetRight =\n        element.scrollWidth - (element.offsetWidth + element.scrollLeft);\n      const offsetTop = element.scrollTop;\n      const offsetBottom =\n        element.scrollHeight - (element.offsetHeight + element.scrollTop);\n      const newHasOverflow = {\n        top: offsetTop > threshold,\n        bottom: offsetBottom > threshold,\n        left: offsetLeft > threshold,\n        right: offsetRight > threshold,\n      };\n      if (\n        hasOverflow.top !== newHasOverflow.top ||\n        hasOverflow.bottom !== newHasOverflow.bottom ||\n        hasOverflow.left !== newHasOverflow.left ||\n        hasOverflow.right !== newHasOverflow.right\n      ) {\n        setHasOverflow(newHasOverflow);\n      }\n    }\n  };\n  useEffect(update);\n\n  return {\n    scrolledIndicatorProps: {\n      onScroll: update as UIEventHandler<T>,\n    },\n    hasOverflow,\n  };\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { IconButton } from \"@intellij-platform/core/IconButton\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React, { Key } from \"react\";\n\nexport const TabsOverflowMenu = <T extends unknown>({\n  collection,\n  overflowedKeys,\n  onSelect,\n}: {\n  collection: Collection<Node<T>>;\n  overflowedKeys: Set<Key>;\n  onSelect: (key: Key) => void;\n}) => (\n  <>\n    {overflowedKeys.size > 0 && (\n      <MenuTrigger\n        align=\"end\"\n        renderMenu={({ menuProps }) => {\n          const items: Iterable<Node<unknown>> = [...collection].filter(\n            (menuItem) => overflowedKeys.has(menuItem.key)\n          );\n          return (\n            <Menu\n              {...menuProps}\n              onAction={(key) => {\n                onSelect(key);\n              }}\n              items={items}\n            >\n              {(item) => (\n                <Item key={item.key} textValue={item.textValue}>\n                  {item.props.inOverflowMenu || item.textValue}\n                </Item>\n              )}\n            </Menu>\n          );\n        }}\n      >\n        {(props, ref) => (\n          <IconButton {...props} ref={ref}>\n            <PlatformIcon icon=\"actions/findAndShowNextMatches\" />\n          </IconButton>\n        )}\n      </MenuTrigger>\n    )}\n  </>\n);\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport { TabContentLayout } from \"@intellij-platform/core/Tabs/TabContentLayout\";\n\ntype ToolWindowTabContentProps = {\n  icon?: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button for the tab. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <ToolWindowTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactNode;\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n};\n\nexport const ToolWindowTabContent = React.forwardRef(\n  (\n    { icon, title, closeButton, containerProps }: ToolWindowTabContentProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    return (\n      <TabContentLayout\n        containerProps={containerProps}\n        ref={ref}\n        startIcon={icon}\n        title={title}\n        endIcon={closeButton}\n      />\n    );\n  }\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const toolWindowTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"ToolWindow.HeaderTab.borderColor\"),\n  underlineHeight: theme.value<number>(\"ToolWindow.HeaderTab.underlineHeight\"),\n  background: \"transparent\",\n  underlinedTabInactiveBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabInactiveBackground\"\n  ),\n  underlinedTabBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabBackground\"\n  ),\n  hoverInactiveBackground:\n    theme.color(\"ToolWindow.HeaderTab.hoverInactiveBackground\") ??\n    theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  hoverBackground: theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\n    \"ToolWindow.HeaderTab.inactiveUnderlineColor\"\n  ),\n  underlineColor: theme.color(\"ToolWindow.HeaderTab.underlineColor\"),\n\n  underlinedTabInactiveForeground:\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabInactiveForeground\") ??\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabForeground\"),\n  underlinedTabForeground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabForeground\"\n  ),\n});\nexport const StyledToolWindowTab = styled(StyledDefaultTab)`\n  padding: 0 0.7rem;\n  ${({ theme }) => getTabThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { toolWindowTabTheme } from \"./StyledToolWindowTab\";\n\nexport const StyledToolWindowTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import React from \"react\";\nimport { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledToolWindowTab } from \"./StyledToolWindowTab\";\nimport { StyledToolWindowTabs } from \"./StyledToolWindowTabs\";\n\ntype ToolWindowTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const ToolWindowTabs = <T extends object>(\n  props: ToolWindowTabsProps<T>\n) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledToolWindowTab}\n    TabsComponent={StyledToolWindowTabs}\n    focusable={false}\n    shouldSelectOnPressUp\n  />\n);\n","export type TextRange = { from: number; to: number };\n\nexport function isEmptyRange(range: TextRange) {\n  return range.from > range.to;\n}\n\nexport function getAllRanges(\n  ranges: TextRange[],\n  length: number\n): Array<[TextRange, boolean]> {\n  const result: Array<[TextRange, boolean]> = [];\n  if (!ranges?.length) {\n    return [[{ from: 0, to: length - 1 }, false]];\n  }\n  if (ranges[0].from > 0) {\n    result.push([{ from: 0, to: ranges[0].from - 1 }, false]);\n  }\n  ranges.forEach(({ from, to }, index) => {\n    result.push([{ from, to }, true]);\n    const gapRange: TextRange = ranges[index + 1]\n      ? { from: to + 1, to: ranges[index + 1].from - 1 }\n      : { from: to + 1, to: length - 1 };\n    if (!isEmptyRange(gapRange)) {\n      result.push([gapRange, false]);\n    }\n  });\n  return result;\n}\n\nexport function createRangesFromIndices(indices: number[]): TextRange[] {\n  return indices.reduce((ranges, index) => {\n    const lastRange = ranges.slice(-1)[0];\n    if (lastRange?.to === index - 1) {\n      return [...ranges.slice(0, -1), { from: lastRange.from, to: index }];\n    }\n    return [...ranges, { from: index, to: index }];\n  }, [] as TextRange[]);\n}\n","import React from \"react\";\nimport { getAllRanges, TextRange } from \"../TextRange\";\nimport { styled } from \"../styled\";\n\nconst HighlightedMatch = styled.span`\n  background: ${({ theme }) =>\n    `linear-gradient(${theme.color(\n      \"SearchMatch.startBackground\",\n      \"#ffeaa2b3\"\n    )}, ${theme.color(\"SearchMatch.endBackground\", \"#ffd042b3\")})`};\n  color: #000;\n  border-radius: 3px;\n`;\n\n/**\n * Renders the children (which must be a string), with highlights wrapped in spans with the highlight style.\n * Note: this component doesn't render a container. It just highlights the specified ranges.\n */\nexport function TextWithHighlights({\n  children,\n  highlights,\n}: {\n  children: string;\n  highlights: TextRange[] | null;\n}): React.ReactElement {\n  const parts: Array<[TextRange, boolean]> = highlights\n    ? getAllRanges(highlights, children.length)\n    : [[{ from: 0, to: children.length }, false]];\n  return (\n    <>\n      {parts.map(([{ from, to }, highlighted]) => {\n        const text = children.slice(from, to + 1);\n        return (\n          // TODO: key\n          <React.Fragment key={`${from}_${to}`}>\n            {highlighted ? <HighlightedMatch>{text}</HighlightedMatch> : text}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n","// language=JSRegexp\nconst numberPattern = \"[0-9]{0,3}.?[0-9]*\";\n\nconst parseComponent = (componentStr: string, index: number) =>\n  componentStr\n    ? index < 3\n      ? parseInt(componentStr)\n      : Math.round(Math.min(parseFloat(componentStr), 1) * 255)\n    : undefined;\n\nconst parseHexRgba = (str: string) =>\n  str\n    .match(/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})?$/i)\n    ?.slice(1, 5)\n    .map((i) => (i ? parseInt(i, 16) : undefined));\nconst parseShorthandHex = (str: string) =>\n  str\n    .match(/^#?([0-9A-F])([0-9A-F])([0-9A-F])$/i)\n    ?.slice(1, 4)\n    .map((i) => (i ? parseInt(i + i, 16) : undefined));\nconst parseRgb = (str: string) =>\n  str\n    .match(\n      new RegExp(\n        `^rgb\\\\(\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern}\\\\s*)\\\\)$`\n      )\n    )\n    ?.slice(1, 5)\n    .map(parseComponent);\nconst parseRgba = (str: string) =>\n  str\n    .match(\n      new RegExp(\n        `^rgba\\\\(\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern}\\\\s*)\\\\)$`\n      )\n    )\n    ?.slice(1, 5)\n    .map(parseComponent);\n\n/**\n * parses a color string into rgba components.\n * @param str\n */\nexport const parseColorString = (\n  str: string\n): [number, number, number, number?] | null => {\n  const result = [parseHexRgba, parseShorthandHex, parseRgb, parseRgba].reduce<\n    (number | undefined)[] | undefined\n  >((result, parse) => result || parse(str), undefined);\n  return Array.isArray(result) &&\n    result.slice(0, 3).every((c) => Number.isInteger(c))\n    ? (result as [number, number, number, number?])\n    : null;\n};\n","import { parseColorString } from \"./parseColorString\";\n\n/**\n * A Color class resembling AWT Color\n */\nexport class Color {\n  public readonly r: number;\n  public readonly g: number;\n  public readonly b: number;\n  public readonly a: number;\n\n  private static readonly FACTOR = 0.7;\n\n  constructor(r: number, g: number, b: number, a?: number);\n  constructor(rgba: string);\n  constructor(rgba: Color);\n  constructor(\n    rgba: string | number | Color,\n    g?: number,\n    b?: number,\n    a: number = 255\n  ) {\n    let r: number;\n    if (typeof rgba === \"string\") {\n      [r = NaN, g = NaN, b = NaN, a = 255] = parseColorString(rgba) || [];\n    } else if (rgba instanceof Color) {\n      [r, g, b, a] = [rgba.r, rgba.g, rgba.b, rgba.a];\n    } else {\n      r = rgba;\n    }\n    this.r = r;\n    this.g = g!;\n    this.b = b!;\n    this.a = a < 1 ? Math.round(a * 255) : a;\n  }\n\n  isValid() {\n    return (\n      Number.isInteger(this.r) &&\n      Number.isInteger(this.g) &&\n      Number.isInteger(this.b) &&\n      Number.isInteger(this.a)\n    );\n  }\n\n  /**\n   * Extra method for changing transparency\n   */\n  withTransparency(alpha: number) {\n    return new Color(this.r, this.g, this.b, alpha);\n  }\n\n  brighter() {\n    let { r, g, b, a: alpha } = this;\n    const int = Math.floor,\n      FACTOR = Color.FACTOR;\n    // The rest is copy paste of java.awt.Color (only `int i` is changed to `let i` :D)\n    let i = int(1.0 / (1.0 - FACTOR));\n    if (r == 0 && g == 0 && b == 0) {\n      return new Color(i, i, i, alpha);\n    }\n    if (r > 0 && r < i) r = i;\n    if (g > 0 && g < i) g = i;\n    if (b > 0 && b < i) b = i;\n\n    return new Color(\n      Math.min(int(r / FACTOR), 255),\n      Math.min(int(g / FACTOR), 255),\n      Math.min(int(b / FACTOR), 255),\n      alpha\n    );\n  }\n\n  darker() {\n    const FACTOR = Color.FACTOR;\n    const int = Math.floor;\n\n    return new Color(\n      Math.max(int(this.r * FACTOR), 0),\n      Math.max(int(this.g * FACTOR), 0),\n      Math.max(int(this.b * FACTOR), 0),\n      this.a\n    );\n  }\n\n  static brighter(color: string): string {\n    // note: we can't type args simply with ConstructorParameters<typeof Color>.\n    // see more: https://github.com/microsoft/TypeScript/issues/37079\n    return new Color(color).brighter().toString();\n  }\n\n  blend(colorOrColorString: Color | string) {\n    const color =\n      typeof colorOrColorString === \"string\"\n        ? new Color(colorOrColorString)\n        : colorOrColorString;\n    const getBlendedValue = (component: \"r\" | \"g\" | \"b\") =>\n      Math.round(\n        (color.a / 255) * color[component] +\n          (this.a / 255) * (1 - color.a / 255) * this[component]\n      );\n    return new Color(\n      getBlendedValue(\"r\"),\n      getBlendedValue(\"g\"),\n      getBlendedValue(\"b\")\n    );\n  }\n\n  toString() {\n    const toString = (component: number) =>\n      Number.isNaN(component) ? \"\" : component.toString(16).padStart(2, \"0\");\n    const r = toString(this.r);\n    const g = toString(this.g);\n    const b = toString(this.b);\n    const a = this.a === 255 ? \"\" : toString(this.a);\n    return `#${r}${g}${b}${a}`;\n  }\n}\n","import React, { CSSProperties, useRef, useState } from \"react\";\nimport styled, { useTheme } from \"styled-components\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport { ResizerProps } from \"../Resizer/ResizerProps\";\nimport { Theme } from \"../Theme/Theme\";\n\n/**\n * Props are named mostly based on ThreeComponentsSplitter in Intellij Platform.\n */\nexport interface ThreeViewSplitterProps {\n  orientation?: \"horizontal\" | \"vertical\";\n  resizerProps?: Partial<\n    Omit<ResizerProps, \"onResize\" | \"onResizeStarted\" | \"onResizeEnd\">\n  >;\n  innerView?: React.ReactNode;\n  innerViewMinSize?: number;\n  firstView?: React.ReactNode;\n  firstSize?: number | null;\n  firstViewMinSize?: number;\n  lastView?: React.ReactNode;\n  lastSize?: number | null;\n  lastViewMinSize?: number;\n  onFirstResize?: (size: number) => void;\n  onLastResize?: (size: number) => void;\n  style?: CSSProperties;\n  className?: string;\n}\n\nconst StyledSplitterContainer = styled.div<{\n  orientation: \"horizontal\" | \"vertical\";\n}>`\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  flex-direction: ${({ orientation }) =>\n    orientation === \"vertical\" ? \"column\" : \"row\"};\n`;\n\nconst StyledSplitterInnerView = styled.div`\n  // The default overflow visible should be changed obviously. Not sure if there is any layout implication\n  // in using 'auto' instead of hidden, to provide scroll behaviour by default, but even if we realize later\n  // that we need to set overflow to hidden here, we can have scrollable content inside the inner view via an\n  // intermediate element inside the inner view, with overflow set to auto and width set to 100%.\n  overflow: auto;\n  flex: 1;\n`;\n/**\n * Corresponding to\n * [ThreeComponentsSplitter](https://github.com/JetBrains/intellij-community/blob/58dbd93e9ea527987466072fa0bfbf70864cd35f/platform/platform-api/src/com/intellij/openapi/ui/ThreeComponentsSplitter.java#L40-L40)\n * `firstView` and `lastView` are optional, and if not provided, the corresponding resizer is not rendered.\n * innerView is supposed to fill the remaining space, while firstView and lastView have specific sizes.\n * size changes in a resize interaction is not reported and is handled by local state in the component. That's\n * to prevent frequent state updates in a higher level which can be expensive. It's also based on this assumption\n * that in the usage side there is no need for any control over resizing or even knowing the intermediate state.\n * Maybe a minSize and maxSize would be the extent of the required control over resizing. But anyway, this model\n * of keeping the size as a local state during a resize session is something that can be changed if needed.\n *\n * Features:\n * - Relative sizing (fraction of the container)\n * - Default size by content\n * - Change handling only when resize is done.\n *\n * TODO: max and min size not implemented\n * TODO: add support for uncontrolled version\n */\nexport const ThreeViewSplitter: React.FC<ThreeViewSplitterProps> = ({\n  orientation = \"horizontal\",\n  firstView,\n  firstSize,\n  lastView,\n  lastSize,\n  onFirstResize,\n  onLastResize,\n  resizerProps: resizerPropsOverrides = {},\n  innerView,\n  firstViewMinSize,\n  lastViewMinSize,\n  innerViewMinSize,\n  ...containerProps\n}: ThreeViewSplitterProps): React.ReactElement => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const firstViewRef = useRef<HTMLDivElement>(null);\n  const lastViewRef = useRef<HTMLDivElement>(null);\n  const [firstSizeState, setFirstSizeState] = useState<number | null>(null);\n  const [lastSizeState, setLastSizeState] = useState<number | null>(null);\n  const theme = useTheme() as Theme;\n\n  const value = <T1, T2>(horizontalValue: T1, verticalValue: T2) =>\n    orientation === \"horizontal\" ? horizontalValue : verticalValue;\n\n  const FirstResizer: React.ComponentType<ResizerProps> = value(\n    RightResizer,\n    BottomResizer\n  );\n  const SecondResizer: React.ComponentType<ResizerProps> = value(\n    LeftResizer,\n    TopResizer\n  );\n  const sizeStyleProp = value(\"width\", \"height\");\n  const minSizeStyleProp = value(\"minWidth\", \"minHeight\");\n\n  const resizerProps: ThreeViewSplitterProps[\"resizerProps\"] = {\n    background: theme.commonColors.contrastBorder,\n    size: 1,\n    ...resizerPropsOverrides,\n  };\n\n  const isFractionSize = (size: number) => size < 1;\n\n  const normalizeSize = (\n    size: number | undefined | null\n  ): CSSProperties[\"width\" | \"height\"] =>\n    size != null\n      ? isFractionSize(size)\n        ? `${size * 100}%`\n        : Math.round(size)\n      : undefined;\n\n  const getSize = (elem: HTMLElement): number =>\n    value(elem.offsetWidth, elem.offsetHeight);\n\n  const getNewSize = (currentSize: number, newSize: number) => {\n    if (currentSize != null && isFractionSize(currentSize)) {\n      if (!containerRef.current) {\n        throw new Error(\n          \"ThreeViewSplitter: Could not locate container to calculate fraction size\"\n        );\n      }\n      const containerSize = value(\n        containerRef.current.offsetWidth,\n        containerRef.current.offsetHeight\n      );\n      const newFractionSize = newSize / containerSize;\n      return newFractionSize < 1 ? newFractionSize : currentSize;\n    } else {\n      return Math.max(newSize, 1);\n    }\n  };\n\n  const getActualSize = (viewElem: HTMLElement | null): number | null => {\n    if (!containerRef.current || !viewElem) {\n      return null;\n    }\n    const actualSize = getSize(viewElem);\n    if (viewElem.style[sizeStyleProp]?.includes(\"%\")) {\n      return actualSize / getSize(containerRef.current);\n    }\n    return actualSize;\n  };\n\n  const currentLastSize = normalizeSize(lastSizeState ?? lastSize);\n  const currentFirstSize = normalizeSize(firstSizeState ?? firstSize);\n  return (\n    <StyledSplitterContainer\n      ref={containerRef}\n      orientation={orientation}\n      {...containerProps}\n    >\n      {firstView && (\n        <>\n          <div\n            ref={firstViewRef}\n            style={{\n              [sizeStyleProp]: currentFirstSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                (lastSizeState !== null ? currentFirstSize : undefined) ??\n                firstViewMinSize,\n            }}\n          >\n            {firstView}\n          </div>\n          <FirstResizer\n            onResizeStarted={() => {\n              const size = firstViewRef.current\n                ? getSize(firstViewRef.current)\n                : 0;\n              setFirstSizeState(firstSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (firstSizeState != null) {\n                setFirstSizeState(getNewSize(firstSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(firstViewRef.current);\n              if (actualSize !== null) {\n                onFirstResize?.(actualSize);\n              }\n              setFirstSizeState(null);\n            }}\n            {...resizerProps}\n          />\n        </>\n      )}\n      {innerView && (\n        <StyledSplitterInnerView\n          style={{\n            [minSizeStyleProp]: innerViewMinSize,\n          }}\n        >\n          {innerView}\n        </StyledSplitterInnerView>\n      )}\n      {lastView && (\n        <>\n          <SecondResizer\n            onResizeStarted={() => {\n              const size = getSize(lastViewRef.current!);\n              setLastSizeState(lastSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (lastSizeState != null) {\n                setLastSizeState(getNewSize(lastSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(lastViewRef.current);\n              if (actualSize !== null) {\n                onLastResize?.(actualSize);\n              }\n              setLastSizeState(null);\n            }}\n            {...resizerProps}\n          />\n          <div\n            ref={lastViewRef}\n            style={{\n              [sizeStyleProp]: currentLastSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                (firstSizeState !== null ? currentLastSize : undefined) ??\n                lastViewMinSize,\n            }}\n          >\n            {lastView}\n          </div>\n        </>\n      )}\n    </StyledSplitterContainer>\n  );\n};\n","import { isMac } from \"@react-aria/utils\";\nimport React, { HTMLProps, useRef } from \"react\";\nimport { css } from \"styled-components\";\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { Theme } from \"../Theme/Theme\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\nimport {\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { Overlay } from \"@react-aria/overlays\";\n\nconst FLOAT_WINDOW_MIN_WIDTH = 100;\nconst FLOAT_WINDOW_MIN_HEIGHT = 40; // in Intellij Platform it's zero but there is window frame which doesn't exist here\n\nconst StyledFloatView = styled.div`\n  box-sizing: border-box;\n  position: fixed;\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  // border color doesn't seem to be correct and needs more investigation. might be even os-specific and outside\n  // theme colors.\n  border: ${({ theme }) => `1px solid ${theme.color(\"Component.borderColor\")}`};\n  ${WINDOW_SHADOW};\n  ${isMac() &&\n  css<{ theme: Theme }>`\n    border-radius: 8px;\n  `}\n  z-index: 2;\n`;\n\n/**\n * Container for tool windows in float view mode. It handles some visual aspects like the border and shadow, as well as\n * UI interactions for changing the floatingBound of the tool window.\n */\nexport const FloatView: React.FC<\n  {\n    state: FloatWindowState;\n    onBoundsChange: (bounds: WindowBounds) => void;\n  } & Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">\n> = ({ children, state: { bounds }, onBoundsChange, ...otherProps }) => {\n  const ref = useRef(null);\n  const { bounds: boundsStyle, overlayInteractionHandlerProps } =\n    useResizableMovableOverlay(ref, {\n      bounds,\n      onBoundsChange,\n    });\n\n  return (\n    <Overlay>\n      <StyledFloatView\n        {...otherProps}\n        ref={ref}\n        style={{ ...otherProps.style, ...boundsStyle }}\n      >\n        <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n          <OverlayResizeHandles\n            minWidth={FLOAT_WINDOW_MIN_WIDTH}\n            minHeight={FLOAT_WINDOW_MIN_HEIGHT}\n          />\n          {children}\n        </OverlayInteractionHandler>\n      </StyledFloatView>\n    </Overlay>\n  );\n};\n","import { move } from \"ramda\";\nimport React, { HTMLProps, Key, useState } from \"react\";\nimport { FloatView } from \"./FloatView\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\n\n// NOTE: useStackedLayersState and useStackedLayers are generic but kept here since there is no other use case at the\n// moment. They should be moved to their own file(s) when/if other use case came up.\n\ninterface StackedLayersState<T> {\n  /**\n   * Sorted list of items representing layers.\n   */\n  sorted: T[];\n  /**\n   * A function to be used when the layer should be brought to front, typically based on some UI interaction.\n   */\n  bringToFront: (index: number) => void;\n}\n\n/**\n * State management for a stacked list of layers with **bring to front** functionality.\n */\nfunction useStackedLayersState<T, K = React.Key>(\n  /**\n   * A list of arbitrary items representing stacked layers.\n   */\n  items: T[],\n  /**\n   * A function for converting each item into a key which consistently identifies each item, in subsequent renders.\n   * It's used to maintain current sorting state. Although it can be of any type, it's usually a string or number.\n   */\n  getKey: (item: T) => K\n): StackedLayersState<T> {\n  // Local state for now, but can easily change to controllable if needed.\n  const [sortedKeys, setSortedKeys] = useState<K[]>([]);\n  const sorted = items.sort(\n    (a, b) => sortedKeys.indexOf(getKey(a)) - sortedKeys.indexOf(getKey(b))\n  );\n  return {\n    sorted,\n    bringToFront: (index: number) => {\n      setSortedKeys(move(index, -1, sorted).map(getKey));\n    },\n  };\n}\n\n/**\n * Given the state of a stacked list of layers, returns DOM props to be applied to each layer for interaction-based\n * \"bring to front\" behaviour.\n */\nfunction useStackedLayers<T>(state: StackedLayersState<T>): {\n  layersProps: Array<HTMLProps<HTMLElement>>;\n} {\n  return {\n    layersProps: state.sorted.map((_, index) => ({\n      onFocus: () => {\n        state.bringToFront(index);\n      },\n    })),\n  };\n}\n\n/**\n * Renders float tool windows.\n * - handles resize and move actions for float windows.\n * - handles layering of float tool windows.\n */\nexport function FloatToolWindows({\n  floatWindows = [],\n  onBoundsChange,\n  renderToolWindow,\n}: {\n  floatWindows: FloatWindowState[] | undefined;\n  onBoundsChange: (key: Key, bounds: WindowBounds) => void;\n  renderToolWindow: (key: Key) => React.ReactNode;\n}) {\n  const stackedFloatWindows = useStackedLayersState(\n    floatWindows,\n    ({ key }) => key\n  );\n  const { layersProps } = useStackedLayers(stackedFloatWindows);\n  // sorted list is used to render layers. We could as well use z-index and always render with the same order, but\n  // it doesn't really matter as long as key is set.\n  return (\n    <>\n      {stackedFloatWindows.sorted.map((toolWindow, index) => (\n        <FloatView\n          key={toolWindow.key}\n          state={toolWindow}\n          {...layersProps[index]}\n          onBoundsChange={(bounds) => onBoundsChange(toolWindow.key, bounds)}\n        >\n          {renderToolWindow(toolWindow.key)}\n        </FloatView>\n      ))}\n    </>\n  );\n}\n","import React, {\n  Key,\n  MutableRefObject,\n  RefObject,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"../utils/useLatest\";\nimport { DropPosition } from \"./createGetDropPosition\";\nimport { UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor } from \"./utils\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\ntype StripeLocation<T extends unknown> = {\n  index: number;\n  anchor: Anchor;\n  isSplit: boolean;\n};\ntype MovableStripeProps<T> = {\n  stripeElRef: React.RefObject<HTMLElement>;\n  getKey: (item: T) => Key;\n  anchor: Anchor;\n  mainItems: T[];\n  splitItems: T[];\n  createGetDropPosition: (\n    key: Key\n  ) => (draggedRect: Rect) => DropPosition | null;\n};\n\ntype MovableToolWindowStripeContextType<T> = {\n  addStripe: <T>(\n    id: string,\n    propsRef: MutableRefObject<MovableStripeProps<T>>\n  ) => () => void;\n  startMove: (id: string, args: { from: Rect; key: Key }) => void;\n  move: (args: { to: Rect }) => void;\n  endMove: () => void;\n  dropPosition: null | { id: string; dropPosition: DropPosition };\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n};\n\nexport type MovableToolWindowStripeProviderProps<T = unknown> = {\n  children: React.ReactNode;\n  onMove: (args: { from: StripeLocation<T>; to: StripeLocation<T> }) => void;\n};\n\nconst MovableToolWindowStripeContext =\n  React.createContext<MovableToolWindowStripeContextType<any> | null>(null);\n\n/**\n * A wrapper component to render around `ToolWindowStripe`s to make their button movable. Stripe buttons then become\n * draggable and can be moved either within the same `ToolWindowStripe` or across different ones.\n * @param onMove: called when a stripe button is moved from one anchor to another.\n * @param children: child element tree, containing one or more ToolWindowStripe elements. No need to be direct children.\n */\nexport const MovableToolWindowStripeProvider = <T extends unknown>({\n  onMove,\n  children,\n}: MovableToolWindowStripeProviderProps<T>) => {\n  const stripes = useRef<{\n    [id: string]: RefObject<MovableStripeProps<T>>;\n  }>({});\n  const [draggingRect, setDraggingRect] = useState<Rect | null>(null);\n  const [draggingKey, setDraggingKey] = useState<Key | null>(null);\n  const [dropPosition, setDropPosition] = useState<{\n    id: string;\n    dropPosition: DropPosition;\n  } | null>(null);\n  const getDropPositionRef = useRef<\n    (to: Rect) => {\n      id: string;\n      dropPosition: DropPosition;\n    } | null\n  >(() => null);\n  const moveStartLocationRef = useRef<null | {\n    id: string;\n    index: number;\n    anchor: Anchor;\n    isSplit: boolean;\n  }>(null);\n\n  const contextValue = useMemo(\n    (): MovableToolWindowStripeContextType<T> => ({\n      addStripe: (id, propsRef) => {\n        if (stripes.current[id]) {\n          console.error(`multiple stripes with the same id \"${id}`);\n        }\n        // @ts-expect-error\n        stripes.current[id] = propsRef;\n        return () => {\n          delete stripes.current[id];\n        };\n      },\n      startMove: (id, { from, key }) => {\n        const stripe = stripes.current[id]?.current;\n        if (!stripe) {\n          return;\n        }\n        const { stripeElRef } = stripe;\n        const stripeElement = stripeElRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n\n        // Running the following two state setters immediately affect the layout\n        // in a way that is necessary for drop position calculation, so the order\n        // is important\n        setDraggingRect(getItemRect(key).toJSON());\n        setDraggingKey(key);\n\n        const indexInMain = stripe.mainItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        const indexInSplit = stripe.splitItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        moveStartLocationRef.current = {\n          id,\n          anchor: stripe.anchor,\n          index: indexInMain > -1 ? indexInMain : indexInSplit,\n          isSplit: indexInSplit > -1,\n        };\n\n        const dropPositionGetters = Object.entries(stripes.current).map(\n          ([id, stripe]) =>\n            [id, stripe.current!.createGetDropPosition(key)] as const\n        );\n        const getDropPosition = (draggedRect: Rect) => {\n          for (const [id, getDropPosition] of dropPositionGetters) {\n            const dropPosition = getDropPosition(draggedRect);\n            if (dropPosition) {\n              return {\n                id,\n                dropPosition,\n              };\n            }\n          }\n          return null;\n        };\n\n        setDropPosition(getDropPosition(from));\n\n        getDropPositionRef.current = getDropPosition;\n      },\n      move: ({ to }) => {\n        setDropPosition(getDropPositionRef.current(to));\n      },\n      endMove: () => {\n        if (dropPosition && draggingKey) {\n          onMove({\n            from: moveStartLocationRef.current!,\n            to: {\n              anchor: dropPosition.id as Anchor /*FIXME*/,\n              index: dropPosition.dropPosition.index,\n              isSplit: dropPosition.dropPosition.split,\n            },\n          });\n        }\n        setDraggingKey(null);\n        setDropPosition(null);\n        setDraggingRect(null);\n      },\n      dropPosition,\n      draggingRect,\n      draggingKey,\n    }),\n    [dropPosition, draggingKey, draggingRect]\n  );\n\n  return (\n    <MovableToolWindowStripeContext.Provider value={contextValue}>\n      {children}\n    </MovableToolWindowStripeContext.Provider>\n  );\n};\n\nexport function useMovableStripeButtons<T>(props: MovableStripeProps<T>) {\n  // Seems reasonable to assume anchor is unique. Also current onMove signature is coupled with anchor, not a more generic id.\n  const id = props.anchor;\n  const context = useContext(MovableToolWindowStripeContext);\n  const latestPropsRef = useLatest(props);\n  useEffect(() => {\n    if (context) {\n      return context.addStripe(id, latestPropsRef);\n    }\n  }, [context, id]);\n\n  const getProps = (\n    key: Key\n  ): Pick<\n    Required<UseElementMoveOptions<unknown>>,\n    \"onMoveStart\" | \"onMove\" | \"onMoveEnd\"\n  > & { moveDisabled: boolean } => ({\n    moveDisabled: !context,\n    onMoveStart: ({ from }) => {\n      context?.startMove?.(id, { from, key });\n    },\n    onMove: ({ to }) => {\n      context?.move({ to });\n    },\n    onMoveEnd: () => {\n      context?.endMove();\n    },\n  });\n  return {\n    getProps,\n    draggingRect: context?.draggingRect ?? null,\n    dropPosition:\n      context?.dropPosition?.id === id\n        ? context?.dropPosition.dropPosition\n        : null,\n    draggingKey: context?.draggingKey ?? null,\n  };\n}\n","import { styled } from \"../styled\";\nimport { css } from \"styled-components\";\n\nconst TopStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: ts;\n`;\nconst BottomStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: bs;\n`;\nconst LeftStripe = styled.div`\n  grid-area: ls;\n`;\nconst RightStripe = styled.div`\n  grid-area: rs;\n`;\nconst InnerView = styled.div`\n  grid-area: main;\n  min-height: 0; // necessary to prevent overflow;\n  position: relative; // necessary for undock views which are absolute positioned\n  background: inherit;\n  min-width: 0; // very important for layout. If not set, resizing tool windows can cause weird scrollbar inside tool windows pane.\n`;\n\n/**\n * The container which renders top,bottom,left and right stripes with a centered content.\n * responsible only for the layout of the stripes and the centered content. layout doesn't\n * include the opened tool windows on different sides and is just about the stripes around\n * the center area.\n * It also supports toggling stripes visibility.\n */\nconst Shell = styled.div<{ hideStripes: boolean }>`\n  display: grid;\n  grid-template-columns: min-content auto min-content;\n  grid-template-rows: min-content auto min-content;\n  grid-template-areas:\n    \".   ts   .\"\n    \"ls main rs\"\n    \".   bs   .\";\n\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${({ hideStripes }) =>\n    hideStripes &&\n    css`\n      ${TopStripe},\n      ${BottomStripe}, \n      ${LeftStripe}, \n      ${RightStripe} {\n        display: none;\n      }\n    `}\n`;\n\nexport const StyledToolWindowOuterLayout = {\n  Shell,\n  TopStripe,\n  BottomStripe,\n  LeftStripe,\n  RightStripe,\n  InnerView,\n};\n","import { compose, filter, groupBy, map, pipe, prop, sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\nimport {\n  ToolWindowsState,\n  ToolWindowState,\n  ViewMode,\n} from \"./ToolWindowsState\";\n\ntype ToolWindowStateWithKey = { key: Key } & ToolWindowState;\n\nexport interface StripesState {\n  main: Key[];\n  split: Key[];\n  activeKeys: Key[];\n}\n\n/**\n * Represents UI state of the split view (aka secondary or side view) within a docked view at one of the four sides.\n */\ntype SideDockedSplitState = {\n  key: Key;\n  /**\n   * relative size of the split view inside a docked view. Note that this is intentionally a fraction size (0size<1),\n   * based on the expected behaviour. split views inside a docked view are not fixed sized and resizing the window\n   * affect their size. This is not the case for the docked views themselves inside the main layout, which have fixed\n   * size which is not affected by window resizing.\n   */\n  sizeFraction: number;\n};\n\n// A potential improvement for this and similar nullable types like SideDockedState.split might be to avoid null type\n// and have it like { open: false} | {open: true, ...relevantProps}\n// Not sure if it's really preferred in terms of usage in the react component.\nexport type SideDockedState = null | {\n  size: number;\n  mainKey: Key;\n  split: SideDockedSplitState | null;\n};\n\nexport type SideUnDockedState = null | {\n  size: number;\n  key: Key;\n};\n\nexport interface SideState {\n  docked: SideDockedState;\n  undocked: SideUnDockedState;\n  stripes: StripesState;\n}\n\nexport interface FloatWindowState {\n  key: Key;\n  bounds: Exclude<ToolWindowState[\"floatingBounds\"], undefined>;\n}\n\n/**\n * Derived from ToolWindowsState, it represents the same information in a away that is suitable for ToolWindows\n * component to render the layout.\n */\nexport interface ToolWindowsLayoutState {\n  left: SideState;\n  top: SideState;\n  right: SideState;\n  bottom: SideState;\n  floatWindows: Array<FloatWindowState>;\n  windows: Array<FloatWindowState>;\n}\n\ninterface ContainerSize {\n  width: number;\n  height: number;\n}\n\nconst getSizeInAnchor = (containerSize: ContainerSize, anchor: Anchor) =>\n  containerSize[isHorizontalToolWindow(anchor) ? \"height\" : \"width\"];\n\nconst mapToKey = map<ToolWindowStateWithKey, Key>(prop(\"key\"));\nconst sortAndMapToKey = compose(\n  mapToKey,\n  sortBy(({ order }: ToolWindowStateWithKey) => order)\n);\nconst filterMains = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => !isSplit\n);\nconst getMains = compose(sortAndMapToKey, filterMains);\nconst filterSplits = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => isSplit\n);\nconst filterVisible = (expectedViewMode: ViewMode | ViewMode[] = []) =>\n  filter<ToolWindowStateWithKey, \"array\">(\n    ({ viewMode, isVisible }: ToolWindowStateWithKey) =>\n      isVisible &&\n      ([] as ViewMode[]).concat(expectedViewMode).includes(viewMode)\n  );\nconst getSplits = compose(sortAndMapToKey, filterSplits);\n\nconst filterVisibleDocked = filterVisible([\"docked_unpinned\", \"docked_pinned\"]);\nconst filterVisibleUnDocked = filterVisible(\"undock\");\n\nconst getDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideDockedState => {\n  const docks = filterVisibleDocked(toolWindows);\n  const mains = filterMains(docks);\n  const splits = filterSplits(docks);\n  if (mains.length > 1 || splits.length > 1) {\n    throw new Error(\n      \"More than one visible docked window in a side is not possible\"\n    );\n  }\n  if (mains[0] || splits[0]) {\n    const weight = mains[0]?.weight || splits[0]?.weight;\n    return {\n      mainKey: mains[0]?.key || splits[0]?.key,\n      split:\n        mains[0]?.key && splits[0]?.key\n          ? {\n              key: splits[0].key,\n              sizeFraction: mains[0].weight\n                ? 1 - mains[0].sideWeight\n                : splits[0].sideWeight,\n            }\n          : null,\n      size: weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  return null;\n};\n\nconst getUnDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideUnDockedState => {\n  const windows = filterVisibleUnDocked(toolWindows);\n  if (windows.length === 1) {\n    return {\n      key: windows[0].key,\n      size: windows[0].weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  if (windows.length === 0) {\n    return null;\n  }\n  throw new Error(\n    \"More than one visible undocked window in a side is not possible\"\n  );\n};\n\nconst getSideState = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideState => ({\n  stripes: {\n    main: getMains(toolWindows),\n    split: getSplits(toolWindows),\n    activeKeys: mapToKey(toolWindows.filter(({ isVisible }) => isVisible)),\n  },\n  undocked: getUnDocked(anchor, containerSize, toolWindows),\n  docked: getDocked(anchor, containerSize, toolWindows),\n});\n\nconst DEFAULT_HEIGHT = 300;\nconst DEFAULT_WIDTH = 400;\nconst getFloatWindowState =\n  (containerSize: ContainerSize) =>\n  ({\n    floatingBounds: bounds = {\n      top: containerSize.height / 2 - DEFAULT_HEIGHT / 2,\n      left: containerSize.width / 2 - DEFAULT_WIDTH / 2,\n      height: DEFAULT_HEIGHT,\n      width: DEFAULT_WIDTH,\n    },\n    key,\n  }: ToolWindowStateWithKey): FloatWindowState => ({ bounds, key });\n\nconst getFloatWindowsState = (\n  viewMode: \"float\" | \"window\",\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n) =>\n  pipe(\n    filterVisible(viewMode),\n    map<ToolWindowStateWithKey, FloatWindowState>(\n      getFloatWindowState(containerSize)\n    )\n  )(toolWindows);\n\nexport function getToolWindowsLayoutState(\n  state: Readonly<ToolWindowsState>,\n  containerSize: ContainerSize,\n  /**\n   * list of valid window ids. If state contains window ids that are not included here, they will be excluded in\n   * the returned state object.\n   */\n  windowIds: string[] = Object.keys(state.windows)\n): ToolWindowsLayoutState {\n  const toolWindows = Object.keys(state.windows)\n    .filter(\n      (key) => windowIds.includes(key) && !state.removedFromSideBarIds.has(key)\n    )\n    .map((key) => ({\n      ...state.windows[key],\n      key,\n    }));\n  const {\n    top = [],\n    bottom = [],\n    left = [],\n    right = [],\n  } = groupBy(({ anchor }) => anchor, toolWindows);\n  return {\n    left: getSideState(\"left\", containerSize, left),\n    top: getSideState(\"top\", containerSize, top),\n    right: getSideState(\"right\", containerSize, right),\n    bottom: getSideState(\"bottom\", containerSize, bottom),\n    windows: getFloatWindowsState(\"window\", containerSize, toolWindows),\n    floatWindows: getFloatWindowsState(\"float\", containerSize, toolWindows),\n  };\n}\n","import { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { Key } from \"react\";\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface DropPosition {\n  index: number;\n  split: boolean;\n\n  relative?: {\n    placement: \"before\" | \"after\";\n    key: Key;\n  };\n}\n\n/**\n * TODO: Add a few words about what this function do.\n */\nexport const createGetDropPosition = <T extends any>({\n  anchor,\n  stripeElement,\n  splitItems,\n  mainItems,\n  getItemRect,\n  getKey,\n}: {\n  stripeElement: HTMLElement;\n  anchor: Anchor;\n  getItemRect: (key: Key) => Rect;\n  getKey: (key: T) => Key;\n  mainItems: T[];\n  splitItems: T[];\n}): ((draggedRect: Rect) => DropPosition | null) => {\n  // Note: It may be tempting to calculate stripe element boundaries just once\n  // here, since it's not supposed to change during a drag session, but it\n  // can change due to getting empty when the only button is being dragged out.\n  const getStripeRect = () => stripeElement.getBoundingClientRect();\n\n  const getCanDrop = (draggingRect: Rect) => {\n    const stripeRect = getStripeRect();\n    return (\n      draggingRect.right > stripeRect.left - stripeRect.width &&\n      draggingRect.left < stripeRect.right &&\n      draggingRect.bottom > stripeRect.top - stripeRect.height &&\n      draggingRect.top < stripeRect.bottom\n    );\n  };\n\n  const start = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.left : rect.top;\n  const end = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.right : rect.bottom;\n\n  const getKeyToOffsets = (items: T[]) => {\n    const keyToOffsets: Record<Key, { start: number; end: number }> = {};\n    items.forEach((item) => {\n      const key = getKey(item);\n      const boundingRect = getItemRect(key);\n      keyToOffsets[key] = {\n        start: start(boundingRect),\n        end: end(boundingRect),\n      };\n    });\n    return keyToOffsets;\n  };\n\n  const getDropPositions = (\n    items: T[],\n    split = false\n    // FIXME: score is a bad name. it's quite the opposite! the less means the higher score.\n  ): Array<DropPosition & { score: (rect: Rect) => number }> => {\n    const getRef = split ? end : start;\n    if (items.length === 0) {\n      // if the section is empty, we should still allow adding to it.\n      return [\n        {\n          index: 0,\n          split,\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - getRef(getStripeRect())),\n        },\n      ];\n    }\n    return items.flatMap((item, index) => {\n      const key = getKey(item);\n      return [\n        {\n          index,\n          split,\n          relative: { key, placement: \"before\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].start),\n        },\n        {\n          index: index + 1,\n          split,\n          relative: { key, placement: \"after\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].end),\n        },\n      ];\n    });\n  };\n\n  const keyToOffsets = getKeyToOffsets([...mainItems, ...splitItems]);\n\n  const dropPositions = [\n    ...getDropPositions(mainItems),\n    ...getDropPositions(splitItems, true),\n  ];\n\n  let lastDropPosition: DropPosition | null = null;\n  return (draggingRect: Rect) => {\n    if (!getCanDrop(draggingRect)) {\n      return null;\n    }\n    const result = dropPositions.reduce(\n      (bestMatch, candidate) => {\n        const score = candidate.score(draggingRect);\n        if (!bestMatch || score < bestMatch.score) {\n          return {\n            ...candidate,\n            score,\n          };\n        }\n        return bestMatch;\n      },\n      null as\n        | null\n        | (DropPosition & {\n            score: number;\n          })\n    );\n\n    if (!result) {\n      return null;\n    }\n    if (\n      result.split !== lastDropPosition?.split ||\n      result.index !== lastDropPosition?.index\n    ) {\n      lastDropPosition = result;\n    }\n    return lastDropPosition;\n  };\n};\n","import { StyledIconWrapper } from \"../Icon/StyledIconWrapper\";\nimport { styled } from \"../styled\";\nimport React from \"react\";\nimport { css } from \"styled-components\";\nimport { Anchor } from \"./utils\";\n\nexport interface StyledToolWindowStripeButtonProps {\n  anchor: Anchor;\n  active?: boolean;\n}\n\nexport const STRIPE_BUTTON_CROSS_PADDING = 2.5;\nexport const STRIPE_BUTTON_LINE_HEIGHT = \"1rem\";\n\nconst anchorStyles = ({ anchor }: { anchor: Anchor }) => {\n  const orientation =\n    anchor === \"left\" || anchor === \"right\" ? \"vertical\" : \"horizontal\";\n\n  return orientation === \"horizontal\"\n    ? css`\n        padding: ${STRIPE_BUTTON_CROSS_PADDING}px 10px;\n      `\n    : css`\n        padding: 10px ${STRIPE_BUTTON_CROSS_PADDING}px;\n        writing-mode: vertical-lr;\n        // writing-mode: sideways-lr is not supported anywhere other than FF, so, we need to rotate\n        transform: ${anchor === \"left\" ? \"rotateZ(180deg)\" : undefined};\n\n        // icons are not rotated like text in Intellij Platform implementation. It kind of makes sense.\n        ${StyledIconWrapper} {\n          transform: rotate(180deg);\n        }\n      `;\n};\n\nexport const StyledToolWindowStripeButton = styled.span<StyledToolWindowStripeButtonProps>`\n  box-sizing: border-box;\n  display: flex; // to allow icon and text alignment by default;\n  align-items: center;\n  cursor: default;\n  user-select: none;\n  overflow: hidden;\n  direction: ltr;\n  flex-shrink: 0;\n  font-size: 0.7rem;\n  line-height: ${STRIPE_BUTTON_LINE_HEIGHT}; // absolute value seems to be problematic when the base font size is changed\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedForeground\",\n          theme.dark ? \"rgb(255,255,255)\" : \"rgb(0,0,0)\"\n        )\n      : theme.color(\"*.foreground\")};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedBackground\",\n          theme.dark ? \"rgba(15,15,15,.332)\" : \"rgba(85,85,85,.332)\"\n        )\n      : undefined};\n\n  ${anchorStyles}\n  ${({ active }) =>\n    !active &&\n    css`\n      &:hover {\n        background: ${({ theme }) =>\n          theme.color(\n            \"ToolWindow.Button.hoverBackground\",\n            theme.dark ? \"rgba(15,15,15,.156)\" : \"rgba(85,85,85,.156)\"\n          )};\n      }\n    `};\n`;\n","import {\n  STRIPE_BUTTON_CROSS_PADDING,\n  STRIPE_BUTTON_LINE_HEIGHT,\n  StyledToolWindowStripeButton,\n} from \"./StyledToolWindowStripeButton\";\nimport { Anchor, isHorizontalToolWindow, theOtherSide } from \"./utils\";\nimport { css } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { styled } from \"../styled\";\nimport { Color } from \"../Theme/Color\";\n\nconst minHeight = `calc(${STRIPE_BUTTON_LINE_HEIGHT} + ${\n  2 * STRIPE_BUTTON_CROSS_PADDING + 1 /*border*/\n}px)`;\n\nconst anchorStyles = ({\n  anchor,\n  preventCollapse,\n}: StyledToolWindowStripeProps) =>\n  isHorizontalToolWindow(anchor)\n    ? css`\n        flex-direction: row;\n        width: 100%;\n        min-height: ${preventCollapse ? minHeight : \"fit-content\"};\n        ${StyledToolWindowStripeButton} {\n          height: 1.25rem;\n        }\n      `\n    : css`\n        flex-direction: column;\n        height: 100%;\n        min-width: ${preventCollapse ? minHeight : \"fit-content\"};\n        ${StyledToolWindowStripeButton} {\n          width: 1.25rem;\n        }\n      `;\nconst borderStyle = ({ anchor, theme }: { anchor: Anchor; theme: Theme }) =>\n  css`border-${theOtherSide(anchor)}: 1px solid ${\n    theme.commonColors.contrastBorder\n  }`;\n\nexport interface StyledToolWindowStripeProps {\n  anchor: Anchor;\n  highlighted?: boolean;\n  preventCollapse?: boolean;\n}\n\nexport const StyledToolWindowStripe = styled.div<StyledToolWindowStripeProps>`\n  box-sizing: border-box;\n  background: ${({ theme, highlighted }) =>\n    highlighted\n      ? Color.brighter(theme.commonColors.panelBackground)\n      : theme.commonColors.panelBackground};\n  display: inline-flex;\n  overflow: hidden;\n  ${borderStyle};\n  ${anchorStyles}\n`;\n\nexport const StyledSpacer = styled.div`\n  flex: 1;\n`;\n","import { RefObject } from \"react\";\nimport {\n  useMove,\n  UseMoveOptions,\n  XY,\n} from \"../utils/interaction-utils/useMove\";\nimport { findEffectiveBackgroundColor } from \"./findEffectiveBackgroundColor\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface UseElementMoveOptions<S>\n  extends Omit<UseMoveOptions<S>, \"onMoveStart\" | \"onMove\"> {\n  ref: RefObject<HTMLElement>;\n  /**\n   * if true a clone of the element is created and used as ghost.\n   * A function can be passed to customize the default ghost element or return a completely\n   * different one.\n   */\n  ghost?: boolean | ((defaultGhost: HTMLElement) => HTMLElement);\n\n  onMoveStart: (args: { from: Rect }) => S;\n  onMove: (args: { from: Rect; to: Rect; movement: XY; startState: S }) => void;\n}\n\n/**\n * Provides necessary event handling props to be applied on an element to make it movable.\n * It's implemented on top of {@link useMove}. The differences are:\n * - The signature of `onMoveStart`, `onMove` and `onMoveEnd` are changed to pass\n *   {@link Rect} instead of {@link XY}.\n * - rendering a ghost element.\n *\n * ## A note about ghost:\n * There is no easy way to create a snapshot image of an html element. Native drag and drop API\n * supports [setting drag\n * image](https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/setDragImage) but we are\n * not using drag events mainly because of not being able to customize the offset after which drag\n * should start. See {@link UseMoveOptions#dragThreshold dragThreshold} for more details. There are\n * some libraries like html2canvas for creating an image from an html element, but they are very\n * big and using them doesn't make sense at all from a value/cost ratio perspective. There might be\n * some ways of implementing custom move threshold on top of native drag events. For example by\n * delaying the call to setDragImage, but it needs more investigation. Also, not sure if opacity of\n * the ghost is something you can control when using setDragImage.\n **/\nexport function useElementMove<S>({\n  ref,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  ghost: ghostOption,\n  ...otherOptions\n}: UseElementMoveOptions<S>) {\n  return useMove({\n    ...otherOptions,\n    onMoveStart: () => {\n      const element = ref.current;\n      let ghost: HTMLElement | null = null;\n      if (!element) {\n        throw new Error(\n          \"Movement started but ref value is null. Make sure the passed ref is applied on the same element that other props are.\"\n        );\n      }\n      const updateGhostPosition = (rect: Rect) => {\n        if (ghost) {\n          ghost.style.left = `${rect.left}px`;\n          ghost.style.top = `${rect.top}px`;\n        }\n      };\n      const from: Rect = element.getBoundingClientRect();\n      if (ghostOption) {\n        const defaultGhost = createDefaultGhost(element);\n        ghost =\n          typeof ghostOption === \"function\"\n            ? ghostOption(defaultGhost) || defaultGhost\n            : defaultGhost;\n        ghost.style.position = \"fixed\";\n        document.body.append(ghost);\n        updateGhostPosition(from);\n      }\n      return {\n        ghost,\n        from,\n        updateGhostPosition,\n        startState: onMoveStart({ from }),\n      };\n    },\n    onMove: ({\n      movement,\n      startState: { from, updateGhostPosition, startState },\n    }) => {\n      const to: Rect = {\n        left: from.left + movement.x,\n        right: from.right + movement.x,\n        top: from.top + movement.y,\n        bottom: from.bottom + movement.y,\n        height: from.height,\n        width: from.width,\n      };\n      updateGhostPosition(to);\n      onMove({ from, to, movement, startState });\n    },\n    onMoveEnd: ({ startState: { ghost, startState } }) => {\n      ghost?.remove();\n      onMoveEnd?.({ startState });\n    },\n  });\n}\n\nfunction createDefaultGhost(element: HTMLElement) {\n  const ghost = element.cloneNode(true) as HTMLElement;\n  ghost.style.backgroundColor = findEffectiveBackgroundColor(element);\n  return ghost;\n}\n","import { Color } from \"../Theme/Color\";\n\n/**\n * Computes the effective background color of the element by blending translucent backgrounds of\n * the elements ancestors. It traverses up the parents, until reaches a solid background color.\n * all translucent backgrounds in between are blended with that solid color, with respect to their\n * transparency. It's meant to be used only for the simple cases where an element doesn't overflow\n * the parents. Obviously, in other cases there won't be one single effective background color\n * for the element.\n */\nexport function findEffectiveBackgroundColor(element: HTMLElement): string {\n  let elem: HTMLElement | null = element;\n  let colors: Color[] = [];\n  while (elem != null) {\n    const computedBackground = getComputedStyle(elem).backgroundColor;\n    if (computedBackground) {\n      const color = new Color(computedBackground);\n      colors.unshift(color);\n      if (color.a === 255) {\n        // if we've reached a solid color, we don't need to continue traversing ancestors\n        break;\n      }\n    }\n    elem = elem.parentElement;\n  }\n  return (\n    colors\n      .reduce<Color | null>((resultColor, nextColor) => {\n        return resultColor ? resultColor.blend(nextColor) : nextColor;\n      }, null)\n      ?.toString() || \"\"\n  );\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport React, { CSSProperties, HTMLAttributes, Key, useRef } from \"react\";\nimport { createGetDropPosition, DropPosition } from \"./createGetDropPosition\";\nimport { useMovableStripeButtons } from \"./MovableToolWindowStripeProvider\";\nimport { StyledSpacer, StyledToolWindowStripe } from \"./StyledToolWindowStripe\";\nimport { StyledToolWindowStripeButton } from \"./StyledToolWindowStripeButton\";\nimport { useElementMove, UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\ninterface ToolWindowStripeProps<T> {\n  anchor: Anchor;\n  items: T[];\n  splitItems?: T[];\n  getKey: (item: T) => Key;\n  renderItem: (item: T) => React.ReactNode;\n  selectedKeys?: Key[];\n  onItemPress?: (key: Key) => void;\n}\n\n/**\n * TODO: refactor to remove the key based interface.\n */\nexport function ToolWindowStripe<T>({\n  anchor,\n  items: mainItems,\n  renderItem: render,\n  splitItems = [],\n  selectedKeys = [],\n  onItemPress,\n  getKey,\n}: ToolWindowStripeProps<T>) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const { getProps, draggingRect, draggingKey, dropPosition } =\n    useMovableStripeButtons({\n      stripeElRef: containerRef,\n      getKey,\n      anchor,\n      mainItems,\n      splitItems,\n      createGetDropPosition: (key: Key) => {\n        const isNotCurrentItem = (anItem: T) => getKey(anItem) !== key;\n        const stripeElement = containerRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n        return createGetDropPosition({\n          stripeElement: stripeElement,\n          mainItems: mainItems.filter(isNotCurrentItem),\n          splitItems: splitItems.filter(isNotCurrentItem),\n          getKey,\n          anchor,\n          getItemRect,\n        });\n      },\n    });\n\n  const highlighted =\n    dropPosition != null &&\n    draggingKey != null &&\n    [...mainItems, ...splitItems].every((item) => getKey(item) !== draggingKey);\n\n  const renderItem = (item: T) => {\n    const key = getKey(item);\n\n    return (\n      <ToolWindowStripeButton\n        anchor={anchor}\n        key={key}\n        data-key={key}\n        style={{\n          ...getStripeButtonStyles({\n            key,\n            dropPosition,\n            anchor,\n            draggingRect,\n            draggingKey,\n          }),\n        }}\n        {...getProps(key)}\n        active={selectedKeys.includes(key)}\n        onPress={() => onItemPress?.(key)}\n      >\n        {render(item)}\n      </ToolWindowStripeButton>\n    );\n  };\n  return (\n    <>\n      <StyledToolWindowStripe\n        anchor={anchor}\n        preventCollapse={Boolean(dropPosition)}\n        highlighted={highlighted}\n        ref={containerRef}\n      >\n        {mainItems.map(renderItem)}\n        <StyledSpacer />\n        {splitItems.map(renderItem)}\n      </StyledToolWindowStripe>\n    </>\n  );\n}\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nfunction getStripeButtonStyles({\n  anchor,\n  key,\n  dropPosition,\n  draggingRect,\n  draggingKey,\n}: {\n  anchor: Anchor;\n  key: Key;\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n  dropPosition: DropPosition | null;\n}) {\n  const styles: CSSProperties = {\n    // transition: \"margin 100ms\", // maybe only when drag is in progress, if unwanted transition at drop\n  };\n  if (dropPosition?.relative?.key === key && draggingRect) {\n    const marginValue = isHorizontalToolWindow(anchor)\n      ? draggingRect.width\n      : draggingRect.height;\n\n    if (isHorizontalToolWindow(anchor)) {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginLeft\"\n          : \"marginRight\"\n      ] = marginValue;\n    } else {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginTop\"\n          : \"marginBottom\"\n      ] = marginValue;\n    }\n  }\n  if (key === draggingKey) {\n    styles.display = \"none\";\n  }\n  return styles;\n}\n\nfunction ToolWindowStripeButton<T, S>({\n  children,\n  anchor,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  onPress,\n  moveDisabled,\n  ...otherProps\n}: {\n  children: React.ReactNode;\n  anchor: Anchor;\n  style: CSSProperties;\n  active: boolean;\n  onPress: () => void;\n  moveDisabled?: boolean;\n  onMoveStart: UseElementMoveOptions<S>[\"onMoveStart\"];\n  onMove: UseElementMoveOptions<S>[\"onMove\"];\n  onMoveEnd: UseElementMoveOptions<S>[\"onMoveEnd\"];\n}) {\n  const ref = useRef<HTMLElement>(null);\n\n  // for some reason, usePress and useMove (used in useElementMove) are not compatible.\n  // it seems onMouseDown in useMove is not called, even when handlers are merged by mergeProps.\n  // FIXME: fix compatibility of useMove and usePress, and switch to usePress({ onPress })\n  const { pressProps } = {\n    pressProps: {\n      onPointerUp: onPress,\n      onMouseDown: (e) => {\n        e.preventDefault();\n      },\n    } as HTMLAttributes<HTMLElement>,\n  }; //usePress({ onPress });\n  const props = useElementMove({\n    ref,\n    disabled: moveDisabled,\n    dragThreshold: 7,\n    ghost: true,\n    onMoveStart,\n    onMove,\n    onMoveEnd,\n  });\n\n  return (\n    <StyledToolWindowStripeButton\n      anchor={anchor}\n      {...mergeProps(otherProps, pressProps, props)}\n      ref={ref}\n    >\n      {children}\n    </StyledToolWindowStripeButton>\n  );\n}\n","import React from \"react\";\nimport { css } from \"styled-components\";\nimport { ResizableView } from \"../ResizableView\";\nimport { styled } from \"../styled\";\nimport { SideUnDockedState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\nexport const StyledUndockSide = styled.div<{ anchor: Anchor }>`\n  position: absolute;\n  background: inherit;\n  z-index: 1;\n  ${({ anchor }) =>\n    isHorizontalToolWindow(anchor)\n      ? css`\n          left: 0;\n          right: 0;\n        `\n      : css`\n          top: 0;\n          bottom: 0;\n        `};\n  ${({ anchor }) =>\n    css`\n      ${anchor}: 0;\n    `};\n`;\n\nexport function UndockSide({\n  state,\n  anchor,\n  children,\n  onResize,\n}: {\n  state: Exclude<SideUnDockedState, null>;\n  anchor: Anchor;\n  children: React.ReactNode;\n  onResize: (size: number) => void;\n}) {\n  return (\n    state && (\n      <StyledUndockSide anchor={anchor}>\n        <ResizableView\n          orientation={\n            isHorizontalToolWindow(anchor) ? \"vertical\" : \"horizontal\"\n          }\n          resizerPlacement={\n            anchor === \"left\" || anchor === \"top\" ? \"after\" : \"before\"\n          }\n          size={state.size}\n          onResize={onResize}\n        >\n          {children}\n        </ResizableView>\n      </StyledUndockSide>\n    )\n  );\n}\n","import { indexBy } from \"ramda\";\nimport React, {\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n  Key,\n  useImperativeHandle,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nimport { ThreeViewSplitter } from \"../ThreeViewSplitter/ThreeViewSplitter\";\nimport { FocusScope } from \"../utils/FocusScope\";\nimport { FloatToolWindows } from \"./FloatToolWindows\";\nimport { MovableToolWindowStripeProvider } from \"./MovableToolWindowStripeProvider\";\nimport { StyledToolWindowOuterLayout } from \"./StyledToolWindowOuterLayout\";\nimport {\n  getToolWindowsLayoutState,\n  SideDockedState,\n  StripesState,\n  ToolWindowsLayoutState,\n} from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { ToolWindowsState } from \"./ToolWindowsState/ToolWindowsState\";\nimport { ToolWindowStateProvider } from \"./ToolWindowsState/ToolWindowStateProvider\";\nimport { ToolWindowStripe } from \"./ToolWindowStripe\";\nimport { UndockSide } from \"./UndockSide\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { useOnFocusLost } from \"./useOnFocusLost\";\nimport { useInteractOutside } from \"@react-aria/interactions\";\n\ninterface ToolWindow {\n  id: string;\n  toolbarButton: React.ReactNode;\n  content: React.ReactNode;\n}\n\nexport interface ToolWindowsProps {\n  children: React.ReactNode;\n  windows: ToolWindow[];\n  toolWindowsState: Readonly<ToolWindowsState>;\n  onToolWindowStateChange: (newState: ToolWindowsState) => void;\n\n  /**\n   * Whether stripe buttons should be hidden or not.\n   * `hideToolStripes` UISettings in Intellij Platform\n   */\n  hideToolWindowBars?: boolean;\n\n  /**\n   *\n   * `wideScreenSupport` in UISettings in Intellij Platform\n   */\n  useWidescreenLayout?: boolean;\n\n  /**\n   * min width applied to the main content (children).\n   * @default 50\n   */\n  mainContentMinWidth?: number;\n\n  height?: CSSProperties[\"height\"];\n  minHeight?: CSSProperties[\"minHeight\"];\n  margin?: CSSProperties[\"margin\"];\n\n  /**\n   * props to be passed to the container element.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"as\">;\n}\n\nexport interface ToolWindowRefValue {\n  focus(key: Key): void;\n  hasFocus(key: Key): void;\n  focusLastActiveWindow(): void;\n  focusMainContent(): void;\n  changeState(\n    updater: (currentState: Readonly<ToolWindowsState>) => ToolWindowsState\n  ): void;\n}\n\n/**\n * @constructor\n *\n * Corresponding to ToolWindowPane in Intellij Platform\n *\n * Known issues:\n * - in Firefox and Safari, left and right toolbars are not properly shown. Seems like a nasty bug, since adding and\n * then removing some min-width: fit-content style fixes it.\n * - in the dock view of a side, open only a window from the split ones. then open a window from main ones.\n *   focus is not moved to the just opened window. The reason is we rely on autofocusing and because the React tree\n *   changes for both windows, even the split one which was open will be unmounted and mounted again, and since it's\n *   placed after the main one, and hence mounted later, it will get the focus again. This becomes a bigger issue\n *   if the main one is unpinned, because it immediately gets closed after opening.\n *   Possible solutions:\n *   - make sure the split one won't unmount and mount again in such scenario.\n *   - decouple focusing logic from mounting logic, and only focus windows somehow, when the `isVisible` is changed\n *     from false to true, not when mounted.\n * - related to previous issue: open a tool window in split section of a side. set view mode for a tool window in main\n *   section of the same side to docked_unpinned. try to open the unpinned one while the split one is open. it doesn't\n *   work.\n */\nexport const ToolWindows = React.forwardRef(function ToolWindows(\n  {\n    hideToolWindowBars = false,\n    useWidescreenLayout = false,\n    height = \"100%\",\n    minHeight = \"0\",\n    toolWindowsState,\n    onToolWindowStateChange,\n    windows,\n    children,\n    mainContentMinWidth = 50,\n    containerProps = {},\n  }: ToolWindowsProps,\n  ref: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const windowsById = indexBy(({ id }) => id, windows);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const mainContentFocusScopeRef =\n    useRef<React.ComponentRef<typeof FocusScope>>(null);\n  const [layoutState, setLayoutState] = useState<ToolWindowsLayoutState>();\n  const windowFocusableRefs = useRef<{\n    [key: string]: React.RefObject<React.ComponentRef<typeof FocusScope>>;\n  }>({});\n\n  const latestRef = useLatest({ toolWindowsState, onToolWindowStateChange });\n\n  useLayoutEffect(() => {\n    const container = containerRef.current;\n    const _setLayoutState = () =>\n      setLayoutState(\n        getToolWindowsLayoutState(\n          toolWindowsState,\n          container!.getBoundingClientRect(),\n          windows.map(({ id }) => id)\n        )\n      );\n\n    // If container is rendered but has zero dimensions for any reason, we start observing size changes, until\n    // it's no longer collapsed. Note that we don't want to unconditionally observe resizes and update the layout state.\n    // because tool windows are not supposed to keep the fraction width as the window resizes. They are supposed to have\n    // a fixed width which is determined fraction-based, but only when the tool window is opened. In fact, updating the\n    // layout state, on each and every change to toolWindowsState is also not quite correct, as some state changes\n    // are unrelated and shouldn't cause a re-calculation of the size. FIXME: don't re-calculate fraction base sizes on\n    //  every state change.\n    if (container?.offsetWidth === 0 || container?.offsetHeight === 0) {\n      const observer = new ResizeObserver(([resize]) => {\n        if (resize.contentRect.width > 0 && resize.contentRect.height > 0) {\n          _setLayoutState();\n          observer.unobserve(container);\n        }\n      });\n      observer.observe(container);\n    }\n    _setLayoutState();\n  }, [toolWindowsState]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (key: Key) => {\n        windowFocusableRefs.current[key]?.current?.focus();\n      },\n      hasFocus: (key: Key) =>\n        document.activeElement?.closest(`[data-tool-window-id=\"${key}\"]`) !==\n        null,\n      focusLastActiveWindow: () => {\n        const { lastFocusedKey } = latestRef.current.toolWindowsState;\n        if (lastFocusedKey != null) {\n          if (\n            !latestRef.current.toolWindowsState.windows[lastFocusedKey]\n              .isVisible\n          ) {\n            latestRef.current.onToolWindowStateChange(\n              toolWindowsState.show(lastFocusedKey)\n            );\n          }\n          windowFocusableRefs.current[lastFocusedKey].current?.focus(true);\n        }\n      },\n      focusMainContent: () => {\n        mainContentFocusScopeRef.current?.focus();\n      },\n      changeState: (updater) => {\n        onToolWindowStateChange(updater(latestRef.current.toolWindowsState));\n      },\n    }),\n    []\n  );\n\n  const interactionOutsideRef = useRef(false);\n  useInteractOutside({\n    ref: containerRef,\n    onInteractOutsideStart: () => {\n      interactionOutsideRef.current = true;\n    },\n    onInteractOutside: () => {\n      interactionOutsideRef.current = false;\n    },\n  });\n\n  useOnFocusLost(({ focusReceivingElement }) => {\n    if (!focusReceivingElement && !interactionOutsideRef.current) {\n      mainContentFocusScopeRef.current?.focus();\n    }\n  }, containerRef);\n\n  // TODO: extract component candidate\n  const renderStripe = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: StripesState;\n  }) => (\n    <ToolWindowStripe\n      anchor={anchor}\n      items={state.main}\n      splitItems={state.split}\n      getKey={(item) => item}\n      renderItem={(item) => windowsById[item]?.toolbarButton}\n      onItemPress={(key) =>\n        onToolWindowStateChange(toolWindowsState.toggle(key))\n      }\n      selectedKeys={state.activeKeys}\n    />\n  );\n\n  const renderToolWindow = (key: Key) => {\n    if (!windowFocusableRefs.current[key]) {\n      windowFocusableRefs.current[key] = React.createRef();\n    }\n    return (\n      <div\n        style={{ all: \"unset\" }}\n        data-tool-window-id={key}\n        onFocus={() => {\n          onToolWindowStateChange(toolWindowsState.lastFocused(key));\n        }}\n      >\n        <FocusScope ref={windowFocusableRefs.current[key]}>\n          <ToolWindowStateProvider\n            id={key}\n            containerRef={containerRef}\n            mainContentFocusableRef={mainContentFocusScopeRef}\n            toolWindowsState={toolWindowsState}\n            onToolWindowStateChange={onToolWindowStateChange}\n          >\n            {windowsById[key]?.content}\n          </ToolWindowStateProvider>\n        </FocusScope>\n      </div>\n    );\n  };\n  // TODO: candidate for component extraction\n  const renderSideDockedView = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: SideDockedState;\n  }) => {\n    if (!state) {\n      return null;\n    }\n    return (\n      <ThreeViewSplitter\n        innerView={renderToolWindow(state.mainKey)}\n        innerViewMinSize={50}\n        lastView={state.split && renderToolWindow(state.split.key)}\n        lastSize={state.split?.sizeFraction}\n        onLastResize={(newSize) => {\n          onToolWindowStateChange(\n            toolWindowsState.resizeDockSplitView(anchor, newSize)\n          );\n        }}\n        orientation={isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\"}\n      />\n    );\n  };\n  const onDockResize = (anchor: Anchor) => (size: number) => {\n    const containerBounds = containerRef.current?.getBoundingClientRect();\n    // containerBounds should have value in normal course of events\n    if (containerBounds) {\n      onToolWindowStateChange(\n        toolWindowsState.resizeDock(anchor, size, containerBounds)\n      );\n    }\n  };\n  const getSplitViewProps = (\n    layoutState: ToolWindowsLayoutState,\n    orientation: \"horizontal\" | \"vertical\"\n  ) => {\n    const firstAnchor = orientation === \"horizontal\" ? \"left\" : \"top\";\n    const secondAnchor = orientation === \"horizontal\" ? \"right\" : \"bottom\";\n    return {\n      orientation,\n      firstView: renderSideDockedView({\n        anchor: firstAnchor,\n        state: layoutState[firstAnchor].docked,\n      }),\n      firstSize: layoutState[firstAnchor].docked?.size,\n      onFirstResize: onDockResize(firstAnchor),\n      lastView: renderSideDockedView({\n        anchor: secondAnchor,\n        state: layoutState[secondAnchor].docked,\n      }),\n      lastSize: layoutState[secondAnchor].docked?.size,\n      onLastResize: onDockResize(secondAnchor),\n    };\n  };\n  const renderInnerLayout = (layoutState: ToolWindowsLayoutState) => {\n    const horizontalSplitterProps = getSplitViewProps(\n      layoutState,\n      \"horizontal\"\n    );\n    const verticalSplitterProps = getSplitViewProps(layoutState, \"vertical\");\n\n    const [outerSplitterProps, innerSplitterProps] = useWidescreenLayout\n      ? [horizontalSplitterProps, verticalSplitterProps]\n      : [verticalSplitterProps, horizontalSplitterProps];\n\n    const undockLayers = ([\"left\", \"top\", \"right\", \"bottom\"] as const).map(\n      (anchor) => {\n        const state = layoutState[anchor].undocked;\n        return (\n          state && (\n            <UndockSide\n              key={anchor}\n              anchor={anchor}\n              state={state}\n              onResize={(size) => {\n                containerRef.current &&\n                  onToolWindowStateChange(\n                    toolWindowsState.resizeUndock(\n                      anchor,\n                      size,\n                      containerRef.current.getBoundingClientRect()\n                    )\n                  );\n              }}\n            >\n              {renderToolWindow(state.key)}\n            </UndockSide>\n          )\n        );\n      }\n    );\n\n    return (\n      <>\n        <MovableToolWindowStripeProvider\n          onMove={({ to, from }) => {\n            onToolWindowStateChange(\n              toolWindowsState.move(\n                layoutState[from.anchor].stripes[\n                  from.isSplit ? \"split\" : \"main\"\n                ][from.index],\n                { anchor: to.anchor, isSplit: to.isSplit },\n                to.index\n              )\n            );\n          }}\n        >\n          {/**\n           * ToolWindow bars, aka Stripes. Order of stripes is irrelevant for layout but relevant for\n           * priority when stripe buttons are moved across stripes.\n           * layout is handled by `StyledToolWindowOuterLayout`.\n           */}\n          <StyledToolWindowOuterLayout.LeftStripe>\n            {renderStripe({\n              anchor: \"left\",\n              state: layoutState[\"left\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.LeftStripe>\n          <StyledToolWindowOuterLayout.TopStripe>\n            {renderStripe({\n              anchor: \"top\",\n              state: layoutState[\"top\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.TopStripe>\n          <StyledToolWindowOuterLayout.RightStripe>\n            {renderStripe({\n              anchor: \"right\",\n              state: layoutState[\"right\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.RightStripe>\n          <StyledToolWindowOuterLayout.BottomStripe>\n            {renderStripe({\n              anchor: \"bottom\",\n              state: layoutState[\"bottom\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.BottomStripe>\n        </MovableToolWindowStripeProvider>\n        {/**\n         * The inner layout of the ToolWindow, including four tool windows and\n         * a main content in the center.\n         */}\n        <StyledToolWindowOuterLayout.InnerView>\n          <ThreeViewSplitter\n            {...outerSplitterProps}\n            innerView={\n              <ThreeViewSplitter\n                innerViewMinSize={mainContentMinWidth}\n                innerView={\n                  <FocusScope ref={mainContentFocusScopeRef}>\n                    {children}\n                  </FocusScope>\n                }\n                {...innerSplitterProps}\n              />\n            }\n          />\n          {undockLayers}\n          {\n            <FloatToolWindows\n              floatWindows={layoutState?.floatWindows}\n              renderToolWindow={renderToolWindow}\n              onBoundsChange={(key, bounds) =>\n                onToolWindowStateChange(\n                  toolWindowsState.setFloatingBound(key, bounds)\n                )\n              }\n            />\n          }\n        </StyledToolWindowOuterLayout.InnerView>\n      </>\n    );\n  };\n\n  return (\n    <StyledToolWindowOuterLayout.Shell\n      {...containerProps}\n      ref={containerRef}\n      /**\n       * Potential refactoring: hideStripes can also be handled by conditionally\n       * rendering tool window bars, instead of considering it as a feature of\n       * StyledToolWindowOuterLayout\n       **/\n      hideStripes={hideToolWindowBars}\n      style={{ height, minHeight, ...containerProps?.style }}\n    >\n      {layoutState && renderInnerLayout(layoutState)}\n    </StyledToolWindowOuterLayout.Shell>\n  );\n});\n","import { RefObject, useEffect } from \"react\";\n\n/**\n * Executes a callback function when focus is lost from the container element. i.e. when the currently focused element\n * was within the container and:\n * - The focus is going to an element outside the container, or\n * - The focus is about to get lost (i.e. go to `document.body`).\n *\n * Note: react-aria's `useFocusWithin` (and it's `onBlurWithin` option) can't be used, since (at least currently) it\n * doesn't cover the scenario where the focus is about to get lost due to the focused element getting unmounted.\n */\nexport function useOnFocusLost(\n  onFocusLost: (args: {\n    focusLosingElement: HTMLElement | null;\n    focusReceivingElement: Element | null;\n  }) => void,\n  containerRef: RefObject<HTMLElement>\n): void {\n  useEffect(() => {\n    const handleBodyFocus = (e: FocusEvent) => {\n      if (\n        e.target instanceof HTMLElement &&\n        containerRef.current?.contains(e.target) &&\n        (!e.relatedTarget || e.relatedTarget instanceof HTMLElement) &&\n        !containerRef.current?.contains(e.relatedTarget)\n      ) {\n        onFocusLost({\n          focusLosingElement: e.target,\n          focusReceivingElement: e.relatedTarget,\n        });\n      }\n    };\n    containerRef.current?.addEventListener(\"focusout\", handleBodyFocus);\n    return () => {\n      containerRef.current?.removeEventListener(\"focusout\", handleBodyFocus);\n    };\n  }, []);\n}\n","import React, { Key, RefObject, useContext, useMemo } from \"react\";\nimport { ToolWindowsProps } from \"../ToolWindows\";\nimport { ToolWindowState, ViewMode, WindowBounds } from \"./ToolWindowsState\";\nimport { Anchor } from \"../utils\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ntype ToolWindowStateContextValue = {\n  state: Readonly<ToolWindowState>;\n  hide: () => void;\n  remove: () => void;\n  blur: () => void;\n  focusMainContent: () => void;\n  moveToSide: (args: { anchor: Anchor; isSplit: boolean }) => void;\n  changeViewMode: (viewMode: ViewMode) => void;\n  stretchWidth: (value: number) => void;\n  stretchHeight: (value: number) => void;\n  setFloatingBounds: (bounds: WindowBounds) => void;\n};\nconst ToolWindowStateContext =\n  React.createContext<ToolWindowStateContextValue | null>(null);\n\n/**\n * Used in a tool window's UI tree, to get access to the tool window state and actions for changing it.\n */\nexport const useToolWindowState = () => {\n  const context = useContext(ToolWindowStateContext);\n  if (!context) {\n    throw new Error(\n      \"useToolWindowContext is meant to be used inside a tool window.\"\n    );\n  }\n  return context;\n};\n\n/**\n * Used in ToolWindows to provide tool window state and necessary actions as a context, which will be accessible\n * within the tool window content tree, via {@link useToolWindowState}\n */\nexport const ToolWindowStateProvider: React.FC<\n  {\n    id: Key;\n    containerRef: RefObject<HTMLElement>;\n    mainContentFocusableRef: RefObject<{ focus: () => void }>;\n  } & Pick<ToolWindowsProps, \"toolWindowsState\" | \"onToolWindowStateChange\">\n> = ({\n  toolWindowsState,\n  containerRef,\n  mainContentFocusableRef,\n  onToolWindowStateChange,\n  id,\n  children,\n}) => {\n  const blur = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.blur(id));\n  });\n  const hide = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.hide(id));\n  });\n  const remove = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.removeFromSidebar(id));\n  });\n  const focusMainContent = useEventCallback(() => {\n    mainContentFocusableRef.current?.focus();\n  });\n  const moveToSide = useEventCallback(\n    (side: { anchor: Anchor; isSplit: boolean }) => {\n      onToolWindowStateChange(toolWindowsState.move(id, side));\n    }\n  );\n  const changeViewMode = useEventCallback((viewMode: ViewMode) => {\n    onToolWindowStateChange(toolWindowsState.changeViewMode(id, viewMode));\n  });\n  const stretchWidth = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchWidth(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const stretchHeight = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchHeight(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const setFloatingBounds = useEventCallback((bounds: WindowBounds) => {\n    onToolWindowStateChange(toolWindowsState.setFloatingBound(id, bounds));\n  });\n  const contextValue = useMemo((): ToolWindowStateContextValue => {\n    const state = toolWindowsState.windows[id];\n    return {\n      state,\n      hide,\n      blur,\n      remove,\n      focusMainContent,\n      moveToSide,\n      changeViewMode,\n      stretchWidth,\n      stretchHeight,\n      setFloatingBounds,\n    };\n  }, [toolWindowsState, id]);\n  return (\n    <ToolWindowStateContext.Provider value={contextValue}>\n      {children}\n    </ToolWindowStateContext.Provider>\n  );\n};\n","import { clamp, curry, fromPairs, insert, mapObjIndexed, move } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\n\nexport type ViewMode =\n  | \"docked_pinned\"\n  | \"docked_unpinned\"\n  | \"undock\"\n  | \"float\"\n  /**\n   * @deprecated \"window\" ViewMode was initially added following the original impl. It doesn't seem reasonable to\n   * support it though. It's marked as deprecated to be removed in the future.\n   */\n  | \"window\";\n\nexport type WindowBounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * Data structure for keeping the state of a single tool window. very similar to WindowInfo in Intellij Platform\n *\n * A note about about the data structure:\n * Some fields like `isSplit`, `weight`, `floatingBound` are meaningful only\n * for a subset of viewModes. So it may be tempting to introduce a `viewMode`\n * type which minimally and more accurately describes the information\n * relevant for each viewMode. But it's not structured like that, and it's\n * orthogonal to viewMode, since we want to preserve the relevant information\n * for each viewMode, to be used when the viewMode is changed back.\n *\n * NOTE: consider renaming to `WindowState` to avoid confusion with `ToolWindowsState`\n */\nexport interface ToolWindowState {\n  /**\n   * The order of the tool window in its group. The group is specified by `anchor` and `isSplit`.\n   */\n  order: number;\n  /**\n   * Whether the tool window is visible (open) or not.\n   * NOTE: A maximum of 1 **docked** tool window within the same group (same `anchor` and `isSplit`) can be visible.\n   * You will get a render error in `ToolWindows` component otherwise.\n   */\n  isVisible: boolean;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered in the primary group, i.e. when\n   * `isSplit` is false\n   */\n  weight: number;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered in the secondary group. i.e.\n   * when `isSplit` is true.\n   */\n  sideWeight: number;\n  /**\n   * The side of the tool window, being \"left\", \"right\", \"top\" or \"bottom\"\n   */\n  anchor: Anchor;\n  /**\n   * Specifies whether the tool window should be shown in the split view, aka \"Secondary group\".\n   */\n  isSplit: boolean;\n  /**\n   * Tool windows view mode. See {@link ViewMode}\n   *\n   * NOTE: in Intellij Platform, there is a window `type` and also `docked` and\n   * `autoHide`.\n   * keeping one viewMode makes more sense and prevents invalid combinations\n   * like { type: \"window, \"docked\": true}, that would be unnecessarily allowed.\n   */\n  viewMode: ViewMode;\n  /**\n   * Boundaries of the tool window, when rendered in \"float\" view mode.\n   */\n  floatingBounds?: WindowBounds;\n}\n\nconst isDocked = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" ||\n  toolWindow.viewMode === \"docked_pinned\";\n\n/**\n * Determines whether the tool window should hide on focus. In the java implementation, it's a field on window\n * info instead of being a calculated field. We changed that to match viewMode with the 5 view modes that are possible\n * to choose from the UI, eliminating the combinations that are never allowed. If from UX perspective, having window\n * or float mode with autoHide feature is considered valid at some point, we may need to change the implementation\n * to something similar to the original implementation where isAutoHide and viewMode are separate.\n */\nconst isAutoHide = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" || toolWindow.viewMode === \"undock\";\n\nexport type SideInfo = Pick<ToolWindowState, \"anchor\" | \"isSplit\">;\nexport const areInSameSection = curry(\n  (window1: SideInfo, window2: SideInfo) =>\n    window1.anchor === window2.anchor && window1.isSplit === window2.isSplit\n);\n\nexport const getViewModeType = (viewMode: ViewMode) => {\n  if (viewMode === \"docked_pinned\" || viewMode === \"docked_unpinned\") {\n    return \"docked\";\n  }\n  if (viewMode === \"window\" || viewMode === \"float\") {\n    return \"float\";\n  }\n  return viewMode;\n};\ntype IdToWindowStateMap = Readonly<{\n  [key: string]: Readonly<ToolWindowState>;\n}>;\n\n/**\n * Represents UI state of a bunch of tool windows. What is rendered inside each window or toolbar button is irrelevant.\n *\n * TODO: document pros and cons of these two approaches\n * - Having a class for ToolWindowsState which keeps a readonly mapping of keys to window states.\n * - Having ToolWindowsState as an interface (a mapping from keys to window states), and a bunch of action functions\n *   which accept a window state and some arguments, and return a new window state.\n */\nexport class ToolWindowsState {\n  public readonly lastFocusedKey: Key | null;\n  public readonly removedFromSideBarIds: ReadonlySet<Key>;\n  private readonly layoutToRestore: IdToWindowStateMap;\n  constructor(\n    public readonly windows: IdToWindowStateMap,\n    {\n      lastFocusedKey = null,\n      layoutToRestore = {},\n      removedFromSideBarIds = [],\n    }: {\n      lastFocusedKey?: Key | null;\n      layoutToRestore?: IdToWindowStateMap;\n      removedFromSideBarIds?: Iterable<Key>;\n    } = {}\n  ) {\n    this.lastFocusedKey = lastFocusedKey;\n    this.layoutToRestore = layoutToRestore;\n    this.removedFromSideBarIds = new Set(removedFromSideBarIds);\n    // TODO: instead of keeping a set of removedFromSideBarIds showStripeButton can be a boolean on each window state.\n    //  if we want to avoid the invalid combination of `{ isVisible: true, showStripeButton: false }`, we can have a\n    //  a single property like : visibility: 'open' | 'closed' | 'removed'\n    const invalidWindows = Object.keys(this.windows).filter(\n      (key) =>\n        this.removedFromSideBarIds.has(key) && this.windows[key].isVisible\n    );\n    if (invalidWindows.length > 0) {\n      throw new Error(\n        `Invalid ToolWindowsState. The following windows are set as visible but are removed from the sidebar: ${invalidWindows}`\n      );\n    }\n  }\n\n  hide(targetKey: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow, key) =>\n      key === targetKey\n        ? {\n            ...toolWindow,\n            isVisible: false,\n          }\n        : toolWindow\n    );\n  }\n  hideAll(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) =>\n        getViewModeType(toolWindow.viewMode) === \"float\"\n          ? toolWindow\n          : {\n              ...toolWindow,\n              isVisible: false,\n            },\n      { layoutToRestore: this.windows }\n    );\n  }\n\n  /**\n   * Restores windows to the state before hideAll.\n   */\n  restoreWindows(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) => this.layoutToRestore[key] || toolWindow\n    );\n  }\n\n  lastFocused(key: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow) => toolWindow, {\n      lastFocusedKey: key,\n    });\n  }\n\n  show(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const closableViewModes: ViewMode[] = [];\n    if (target.viewMode === \"undock\") {\n      closableViewModes.push(\"undock\");\n    } else if (isDocked(target)) {\n      closableViewModes.push(\"docked_unpinned\", \"docked_pinned\", \"undock\");\n    }\n    return this.mapWindows(\n      (toolWindow, key) => {\n        if (key === targetKey) {\n          return {\n            ...toolWindow,\n            isVisible: true,\n          };\n        }\n        if (\n          toolWindow.isVisible &&\n          areInSameSection(target, toolWindow) &&\n          closableViewModes.includes(toolWindow.viewMode)\n        ) {\n          return { ...toolWindow, isVisible: false };\n        }\n        return toolWindow;\n      },\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds].filter(\n          (key) => key !== targetKey\n        ),\n      }\n    );\n  }\n\n  toggle(targetKey: Key): ToolWindowsState {\n    return this.windows[targetKey]?.isVisible\n      ? this.hide(targetKey)\n      : this.show(targetKey);\n  }\n\n  blur(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target || !isAutoHide(target)) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  // TODO: initiate floatingBound when changing viewMode to float or window and there is no previous floatingBound\n  changeViewMode(targetKey: Key, viewMode: ViewMode): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          viewMode,\n        };\n      }\n      const viewModeType = getViewModeType(toolWindow.viewMode);\n      if (\n        toolWindow.isVisible &&\n        viewModeType !== \"float\" &&\n        areInSameSection(toolWindow, target) &&\n        viewModeType === getViewModeType(viewMode)\n      ) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  move(targetKey: Key, index: number): ToolWindowsState;\n  move(targetKey: Key, side: SideInfo, index?: number): ToolWindowsState;\n  move(\n    targetKey: Key,\n    sideOrIndex: SideInfo | number,\n    index?: number\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const targetSide = typeof sideOrIndex === \"object\" ? sideOrIndex : target;\n    const targetIndex = typeof sideOrIndex === \"number\" ? sideOrIndex : index;\n    const targetSideWindows = Object.entries(this.windows).filter(([, value]) =>\n      areInSameSection(targetSide, value)\n    );\n    const indexInTargetSide = targetSideWindows.findIndex(\n      ([, window]) => window === target\n    );\n    const sortedTargetWindows: Array<[Key, ToolWindowState]> =\n      indexInTargetSide < 0\n        ? insert(\n            targetIndex ?? -1,\n            [targetKey, { ...target, ...targetSide }],\n            targetSideWindows\n          )\n        : move(\n            indexInTargetSide,\n            targetIndex ?? indexInTargetSide,\n            targetSideWindows\n          );\n    const newTargetSideWindows = fromPairs(\n      sortedTargetWindows.map(([key, value], index) => {\n        let newValue = value;\n        if (value.order !== index) {\n          newValue = { ...value, order: index };\n        }\n        const targetViewMode = getViewModeType(target.viewMode);\n        if (\n          key !== targetKey &&\n          target.isVisible &&\n          value.isVisible &&\n          targetViewMode !== \"float\" &&\n          getViewModeType(value.viewMode) === targetViewMode\n        ) {\n          newValue = { ...value, isVisible: false };\n        }\n        return [`${key}`, newValue];\n      })\n    );\n    return this.mapWindows((value, key) => newTargetSideWindows[key] || value);\n  }\n\n  stretchWidth(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"width\");\n  }\n\n  stretchHeight(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"height\");\n  }\n\n  setFloatingBound(\n    targetKey: Key,\n    floatingBounds: WindowBounds\n  ): ToolWindowsState {\n    return this.update(targetKey, \"floatingBounds\", floatingBounds);\n  }\n\n  removeFromSidebar(targetKey: Key): ToolWindowsState {\n    return this.mapWindows(\n      (state, key) =>\n        key === targetKey\n          ? {\n              ...state,\n              isVisible: false,\n            }\n          : state,\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds, targetKey],\n      }\n    );\n  }\n\n  mapWindows(\n    mapFn: (toolWindow: ToolWindowState, key: string) => ToolWindowState,\n    options: ConstructorParameters<typeof ToolWindowsState>[1] = {}\n  ) {\n    return new ToolWindowsState(mapObjIndexed(mapFn, this.windows), {\n      lastFocusedKey: this.lastFocusedKey,\n      layoutToRestore: this.layoutToRestore,\n      removedFromSideBarIds: this.removedFromSideBarIds,\n      ...options,\n    });\n  }\n\n  private update<K extends keyof ToolWindowState>(\n    targetKey: Key,\n    key: K,\n    value: ToolWindowState[K]\n  ) {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((window) => {\n      if (window === target) {\n        return {\n          ...window,\n          [key]: value,\n        };\n      }\n      return window;\n    });\n  }\n\n  private stretch(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number },\n    property: \"width\" | \"height\"\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const viewModeType = getViewModeType(target.viewMode);\n    if (viewModeType === \"float\") {\n      return this.mapWindows((window) => {\n        if (window === target) {\n          const currentFloatingBound = window.floatingBounds!;\n          return {\n            ...window,\n            floatingBounds: {\n              ...currentFloatingBound,\n              [property]: currentFloatingBound[property] + value,\n            },\n          };\n        }\n        return window;\n      });\n    }\n    const expectedProperty = isHorizontalToolWindow(target.anchor)\n      ? \"height\"\n      : \"width\";\n    if (expectedProperty !== property) {\n      return this;\n    }\n    const containerSize = containerBounds[property];\n    const newValue = containerSize * target.weight + value;\n    const isNewValueValid = clamp(0, containerSize, newValue) === newValue;\n    if (isNewValueValid) {\n      if (viewModeType === \"docked\") {\n        return this.resizeDock(target.anchor, newValue, containerBounds);\n      } else {\n        return this.resizeUndock(target.anchor, newValue, containerBounds);\n      }\n    }\n    return this;\n  }\n\n  resizeDock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(true, anchor, size, containerBounds);\n  }\n\n  resizeUndock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(false, anchor, size, containerBounds);\n  }\n\n  resizeDockSplitView(anchor: Anchor, weight: number): ToolWindowsState {\n    return this.mapWindows((window) => {\n      if (window.anchor === anchor && window.isVisible && isDocked(window)) {\n        return {\n          ...window,\n          sideWeight: window.isSplit ? weight : 1 - weight,\n        };\n      }\n      return window;\n    });\n  }\n\n  private resizeSide(\n    dock: boolean,\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.mapWindows((window) => {\n      const isInResizingView = dock\n        ? isDocked(window)\n        : window.viewMode === \"undock\";\n      if (window.anchor === anchor && isInResizingView && window.isVisible) {\n        const containerSize = !isHorizontalToolWindow(anchor)\n          ? containerBounds.width\n          : containerBounds.height;\n        return {\n          ...window,\n          weight: size / containerSize,\n        };\n      }\n      return window;\n    });\n  }\n}\n\nexport const toolWindowState = ({\n  viewMode = \"docked_pinned\",\n  ...inputs\n}: Partial<ToolWindowState> = {}): ToolWindowState => ({\n  anchor: \"left\",\n  isSplit: false,\n  viewMode: viewMode,\n  order: 1,\n  weight: 0.2,\n  sideWeight: 0.5,\n  isVisible: false,\n  floatingBounds:\n    getViewModeType(viewMode) === \"float\"\n      ? {\n          left: 300,\n          top: 300,\n          width: 600,\n          height: 300,\n        }\n      : undefined,\n  ...inputs,\n});\n","export type Anchor = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport const getAnchorOrientation = (\n  anchor: Anchor\n): \"horizontal\" | \"vertical\" =>\n  isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\";\n\nexport const isHorizontalToolWindow = (anchor: Anchor) =>\n  anchor === \"top\" || anchor === \"bottom\";\n\nexport const theOtherSide = (anchor: Anchor) =>\n  ({\n    left: \"right\" as const,\n    right: \"left\" as const,\n    top: \"bottom\" as const,\n    bottom: \"top\" as const,\n  }[anchor]);\n","import React, { RefObject, useEffect, useRef, useState } from \"react\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport { useOverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\nimport { useFocusForwarder } from \"@intellij-platform/core/utils/useFocusForwarder\";\n\nexport function useToolWindow(\n  {\n    containerRef,\n    contentRef,\n    focusableContentRef,\n  }: {\n    containerRef: RefObject<HTMLElement>;\n    contentRef: RefObject<Element>;\n    focusableContentRef: RefObject<{ focus: () => void }>;\n  },\n  { onFocusChange }: { onFocusChange?: (focused: boolean) => void } = {}\n) {\n  const [contentHasFocus, setContentHasFocus] = useState(false);\n  /**\n   * NOTE: useFocusWithin form @react-aria/interactions (at least until 3.5.1) has a couple of problem, because of which\n   * we may need to implement our own version of it.\n   * - It doesn't play nice with FocusScope with `contain` set to true. When something is blurred, FocusScope prevents\n   *   that by restoring focus back immediately. but the blur event is already caught by useFocusWithin. One solution\n   *   would be to change useFocusWithin implementation to ignore these blur events that are immediately followed\n   *   by a focus event that keeps the focus in.\n   * - useFocusWithin has an inconsistent behaviour when it comes to Portals. Since it uses react props for handling\n   *   focus and blur, the [react tree determines event bubbling](https://reactjs.org/docs/portals.html#event-bubbling-through-portals),\n   *   which can be a very nice feature, when an overlay (rendered in a portal) grabs the focus, which should still\n   *   be seen as \"within\". But the problems is that the current implementation uses DOM `.contains(e.relatedTarget)`\n   *   method to determine if focus is no longer within. First of all, using react tree or dom tree to determine \"within\"\n   *   can be seen as an option perhaps. Secondly, it should be consistent on focus and blur.\n   *\n   *   Right now these problems are no big deal. but it may become an issue when portals are used within the content\n   *   of the tool window.\n   *\n   * NOTE: In the original implementation, when a heading toolbar button opens a menu, and focus goes to menu, the\n   * header loses the focus appearance, ant it relies only on content having the focus.\n   */\n  const { focusWithinProps: contentFocusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setContentHasFocus,\n  });\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: onFocusChange,\n  });\n\n  const { toolWindowProps: autoHideProps } = useAutoHide();\n\n  const { focusForwarderProps } = useFocusForwarder({\n    forwardFocus: focusableContentRef.current?.focus,\n    ignoreFocusedDescendant: true,\n  });\n\n  // If there is no focusable content rendered in the tool window, nothing will be autofocused. In that case\n  // we will focus the tool window container itself as a fallback.\n  useEffect(() => {\n    if (\n      !document.activeElement ||\n      !containerRef.current?.contains(document.activeElement)\n    ) {\n      containerRef.current?.focus();\n    }\n  }, []);\n\n  const { moveHandleProps } = useOverlayMoveHandle();\n\n  return {\n    contentHasFocus,\n    toolWindowProps: mergeProps(\n      focusForwarderProps,\n      focusWithinProps,\n      autoHideProps,\n      {\n        tabIndex: -1,\n      }\n    ),\n    toolWindowContentProps: contentFocusWithinProps,\n    toolWindowHeaderProps: moveHandleProps,\n  };\n}\n\n/**\n * Applies the auto hide behaviour of tool window based on view mode information and by handling focus and blur events,\n * on the root tool window element. Returns the necessary props that should be applied to the root tool window element.\n * The implementation is not perfect and may not 100% match the original Intellij Platform implementation.\n * If this focus based implementation for auto hide proves to be fragile and not good enough in future,\n * an alternative approach would be to move auto hide logic to the state management logic as much as possible,\n * and limit the focus based auto-hiding to only when the focus goes within the main content area. That should have\n * less focus-related edge cases.\n * TODO: auto hide behaviour should be moved to the core ToolWindows API. ToolWindows now renders a FocusScope and\n * handles focus events on any tool window, to track last focused tool window.\n */\nfunction useAutoHide() {\n  const { blur } = useToolWindowState();\n  const hideTimeoutId = useRef<number | null>(null);\n  const { focusWithinProps: windowFocusWithinProps } = useFocusWithin({\n    onBlurWithin: (e) => {\n      // setTimeout and windowHasFocusRef is to work around the problem with useFocusWithin, described above.\n      hideTimeoutId.current = window.setTimeout(() => {\n        // Sometimes when the element is blurred, the subsequent focus that is triggered by FocusScope to keep the focus\n        // is a little delayed and therefore after the timeout reaches. It seem to happen only when a non-focusable\n        // area is clicked. We mitigate it by ignoring blur events where nothing is focused. It's not a problem\n        // at least with `DefaultToolWindow` implementation that uses a FocusScope.\n        const isSomethingElseFocused = e.relatedTarget;\n        if (isSomethingElseFocused) {\n          blur();\n        }\n      });\n    },\n    onFocusWithin: () => {\n      if (hideTimeoutId.current !== null) {\n        clearTimeout(hideTimeoutId.current);\n        hideTimeoutId.current = null;\n      }\n    },\n  });\n  return {\n    toolWindowProps: windowFocusWithinProps,\n  };\n}\n","import React from \"react\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport {\n  useAction,\n  useActionGroup,\n} from \"@intellij-platform/core/ActionSystem\";\nimport {\n  ActionItem,\n  ActionsMenu,\n} from \"@intellij-platform/core/ActionSystem/components\";\nimport {\n  MOVE_TO_ACTION_GROUP_ID,\n  TOOL_WINDOW_RESIZE_ACTION_GROUP_ID,\n  VIEW_MODE_ACTION_GROUP_ID,\n  ViewModeToActionId,\n} from \"./useToolWindowActions\";\nimport {\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n} from \"./ToolWindowActionIds\";\n\n/**\n * Tool window gear icon menu, with a set of default actions and some extra ones.\n * TODO: add support for extra actions when action system is progressed a little.\n */\nexport function ToolWindowSettingsIconMenu({\n  menuProps,\n}: {\n  menuProps: React.HTMLAttributes<HTMLElement>;\n}) {\n  const { state } = useToolWindowState();\n\n  const viewModeActionGroup = useActionGroup(VIEW_MODE_ACTION_GROUP_ID);\n  const moveToActionGroup = useActionGroup(MOVE_TO_ACTION_GROUP_ID);\n  const resizeActions = useActionGroup(TOOL_WINDOW_RESIZE_ACTION_GROUP_ID);\n  const maximizeAction = useAction(MAXIMIZE_TOOL_WINDOW_ACTION_ID);\n  const removeFromSideBarAction = useAction(\n    REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID\n  );\n  if (\n    !viewModeActionGroup ||\n    !moveToActionGroup ||\n    !resizeActions ||\n    !maximizeAction ||\n    !removeFromSideBarAction\n  ) {\n    throw new Error(\n      \"[ToolWindowSettingsIconMenu]: can't find tool window actions.\"\n    );\n  }\n\n  const gearIconActions: Array<ActionItem> = [\n    viewModeActionGroup,\n    moveToActionGroup,\n    {\n      id: \"resize\",\n      title: \"Resize\",\n      isPopup: true,\n      children: [...resizeActions.children, maximizeAction],\n    },\n    new DividerItem(),\n    removeFromSideBarAction,\n  ];\n  return (\n    <ActionsMenu\n      actions={gearIconActions}\n      menuProps={menuProps}\n      selectedKeys={[ViewModeToActionId[state.viewMode]]}\n    />\n  );\n}\n","import React, { HTMLProps } from \"react\";\nimport { IconButton } from \"@intellij-platform/core/IconButton\";\nimport { Toolbar } from \"@intellij-platform/core/Toolbar/Toolbar\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { MenuTrigger } from \"@intellij-platform/core/Menu/MenuTrigger\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledHorizontalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme/Theme\";\nimport { ToolWindowSettingsIconMenu } from \"./ToolWindowSettingsIconMenu\";\nimport {\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { ActionButton } from \"@intellij-platform/core/ActionSystem/components\";\n\nexport interface ToolWindowHeaderProps\n  extends Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\"> {\n  contentHasFocus?: boolean;\n  additionalActions?: React.ReactNode;\n}\n\nconst StyledToolWindowHeader = styled.div<{ active: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: end; // to have the content overflow from right, as the toolwindow shrinks. That will keep the left-most buttons in the view\n  padding: 0 2px 0 4px;\n  overflow: hidden; // for the negative margin applied on StyledToolWindowHeaderActions\n  border-bottom: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Header.borderColor\" as UnknownThemeProp<\"ToolWindow.Header.borderColor\">\n      ) ||\n      theme.color(\"DefaultTabs.borderColor\") ||\n      theme.commonColors.contrastBorder};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\"ToolWindow.Header.background\") ||\n        theme.color(\n          \"ToolWindow.header.active.background\" as UnknownThemeProp<\"ToolWindow.header.active.background\">\n        ) ||\n        \"#E2E6EC\"\n      : theme.color(\"ToolWindow.Header.inactiveBackground\") ||\n        theme.color(\"ToolWindow.Header.background\") ||\n        \"#ECECEC\"};\n`;\n\nconst StyledToolWindowHeaderActions = styled.div`\n  margin-right: -4px;\n`;\n\nconst StyledToolWindowHeaderContent = styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n  overflow: hidden;\n`;\n\nexport const DefaultToolWindowHeader: React.FC<ToolWindowHeaderProps> = ({\n  children,\n  additionalActions,\n  contentHasFocus = false,\n  ...otherProps\n}) => {\n  return (\n    <StyledToolWindowHeader active={contentHasFocus} {...otherProps}>\n      <StyledToolWindowHeaderContent>{children}</StyledToolWindowHeaderContent>\n      <StyledToolWindowHeaderActions>\n        <Toolbar>\n          {additionalActions && (\n            <>\n              {additionalActions}\n              <StyledHorizontalSeparator />\n            </>\n          )}\n          <ActionButton actionId={DOCK_TOOL_WINDOW_ACTION_ID} />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => {\n              return <ToolWindowSettingsIconMenu menuProps={menuProps} />;\n            }}\n          >\n            {(props, ref) => (\n              <TooltipTrigger tooltip={<ActionTooltip actionName=\"Options\" />}>\n                <IconButton {...props} ref={ref}>\n                  <PlatformIcon icon=\"general/gearPlain\" />\n                </IconButton>\n              </TooltipTrigger>\n            )}\n          </MenuTrigger>\n          <ActionButton actionId={HIDE_ACTIVE_WINDOW_ACTION_ID} />\n        </Toolbar>\n      </StyledToolWindowHeaderActions>\n    </StyledToolWindowHeader>\n  );\n};\n","import React, { useContext, useMemo, useRef } from \"react\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  FocusScope,\n  FocusScopeRef,\n} from \"@intellij-platform/core/utils/FocusScope\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { useToolWindow } from \"./useToolWindow\";\nimport { DefaultToolWindowHeader } from \"./DefaultToolWindowHeader\";\nimport { useToolWindowActions } from \"./useToolWindowActions\";\n\nexport interface DefaultToolWindowProps extends DOMProps {\n  /**\n   * title to be shown on the left side of the tool window header.\n   */\n  headerContent?: React.ReactNode;\n  /**\n   * additional action buttons to be rendered before the default gear and hide buttons.\n   */\n  additionalActions?: React.ReactNode;\n  /**\n   * Actions to be provided in the tool window, in addition to the default tool window actions.\n   */\n  actions?: ActionDefinition[];\n  /**\n   * The title of main part of the tool windows component. Used in tool window actions.\n   * @default \"Editor\"\n   */\n  mainContentTitle?: string;\n  onFocusChange?: (focused: boolean) => void;\n}\n\nconst StyledToolWindowContainer = styled.div`\n  outline: none;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  flex: 1;\n`;\nconst StyledToolWindowContent = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\ninterface DefaultToolWindowContextObj {\n  hasFocus?: boolean;\n}\n\nconst DefaultToolWindowContext =\n  React.createContext<DefaultToolWindowContextObj>({\n    hasFocus: false,\n  });\n\nexport const useDefaultToolWindowContext = () =>\n  useContext(DefaultToolWindowContext);\n/**\n * Default component for rendering the content of a tool window. It supports a header and a scrollable area.\n * The header supports showing a content, and some default+custom actions on the right.\n *\n * @see MultiContentToolWindow\n *\n * Remaining features:\n * - Additional gear menu actions.\n *\n */\nexport const DefaultToolWindow: React.FC<DefaultToolWindowProps> = ({\n  headerContent,\n  children,\n  additionalActions,\n  onFocusChange,\n  actions,\n  mainContentTitle = \"Editor\",\n  ...otherProps\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const focusableContentRef = useRef<FocusScopeRef>(null);\n  const {\n    // NOTE: we might as well use :focus-within and target StyledToolWindowHeader to set the background, but it's not\n    // a clear improvement.\n    contentHasFocus,\n    toolWindowProps,\n    toolWindowContentProps,\n    toolWindowHeaderProps,\n  } = useToolWindow(\n    { containerRef, contentRef, focusableContentRef },\n    {\n      onFocusChange,\n    }\n  );\n\n  const defaultToolWindowContext = useMemo(\n    () => ({\n      hasFocus: contentHasFocus,\n    }),\n    [contentHasFocus]\n  );\n  const activeToolWindowActionGroup = useToolWindowActions({\n    mainContentTitle,\n  });\n  const allActions = [activeToolWindowActionGroup, ...(actions || [])];\n\n  return (\n    <ActionsProvider actions={allActions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledToolWindowContainer\n          {...mergeProps(\n            toolWindowProps,\n            shortcutHandlerProps,\n            filterDOMProps(otherProps)\n          )}\n          ref={containerRef}\n        >\n          <DefaultToolWindowContext.Provider value={defaultToolWindowContext}>\n            <DefaultToolWindowHeader\n              additionalActions={additionalActions}\n              contentHasFocus={contentHasFocus}\n              {...toolWindowHeaderProps}\n            >\n              {headerContent}\n            </DefaultToolWindowHeader>\n            <StyledToolWindowContent\n              ref={contentRef}\n              {...toolWindowContentProps}\n            >\n              {/**\n               * FIXME: adding `contain` prevents focus from moving to another focus scope both with mouse and keyboard.\n               * If we want to follow the Intellij Platform behaviour exactly, we need a kind of focus containment, where\n               * focus is trapped only for keyboard interaction, and user can still move focus by clicking another scope.\n               * Maybe a custom useFocusContainment hook and a separate option for activating it on our own FocusScope.\n               */}\n              <FocusScope ref={focusableContentRef} autoFocus>\n                {children}\n              </FocusScope>\n            </StyledToolWindowContent>\n          </DefaultToolWindowContext.Provider>\n        </StyledToolWindowContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n","import React from \"react\";\nimport { Shortcut, useAction } from \"@intellij-platform/core/ActionSystem\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { getActivateToolWindowActionId } from \"./useToolWindowsActions\";\nimport styled from \"styled-components\";\n\nconst getToolWindowNumberFromShortcut = (shortcut: Shortcut): number | null => {\n  const num =\n    shortcut.type === \"keyboard\" &&\n    shortcut.firstKeyStroke.modifiers?.length === 1 &&\n    [\"Alt\", \"Meta\", \"Control\"].includes(shortcut.firstKeyStroke.modifiers[0]) &&\n    shortcut.firstKeyStroke.code.match(/^(Digit|Numpad)([0-9])$/)?.[2];\n  if (num) {\n    return parseInt(num);\n  }\n  return null;\n};\n\nconst StyledWrapper = styled.span`\n  display: flex;\n`;\n\n/**\n * Default UI for the toolbar button (aka. stripe button) of the tool window.\n * - Renders the title and icon for the tool window\n * - Optionally shows the number before the title, if a numeric shortcut is set for the corresponding ActivateToolWindow\n *   action, in the currently applied keymap.\n * - Adds an Action Tooltip\n */\nexport const DefaultToolWindowToolbarButton = ({\n  id,\n  title,\n  icon,\n  showNumber = true,\n}: {\n  id: React.Key;\n  title: string;\n  icon: React.ReactNode;\n  showNumber?: boolean;\n}) => {\n  const action = useAction(getActivateToolWindowActionId(`${id}`));\n\n  const number = action?.shortcuts\n    ?.map(getToolWindowNumberFromShortcut)\n    .find(Number.isInteger);\n  return (\n    <TooltipTrigger\n      tooltip={<ActionTooltip actionName={title} shortcut={action?.shortcut} />}\n    >\n      <StyledWrapper>\n        {icon}\n        &nbsp;\n        {number != null && showNumber ? (\n          <>\n            <u>{number}</u>:&nbsp;\n          </>\n        ) : null}\n        {title}\n      </StyledWrapper>\n    </TooltipTrigger>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { indexBy } from \"ramda\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  ToolWindowRefValue,\n  ToolWindows,\n  ToolWindowsProps,\n} from \"@intellij-platform/core/ToolWindows\";\nimport { useToolWindowsActions } from \"./useToolWindowsActions\";\nimport { DefaultToolWindowToolbarButton } from \"./DefaultToolWindowToolbarButton\";\nimport { ActionsProvider } from \"@intellij-platform/core/ActionSystem\";\n\ninterface DefaultToolWindow {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactNode;\n}\n\n/**\n * A wrapper around ToolWindows, which provides default actions. It also expects windows to have a `title` and an `icon`\n * instead of more generic `toolbarButton`. The `title` and `icon` are then used in toolbar button, and also in the\n * actions that are dynamically created for each window to toggle/focus the tool window.\n */\nexport const DefaultToolWindows = React.forwardRef(function DefaultToolWindows(\n  {\n    windows: toolWindows,\n    toolWindowsState,\n    showNumbers,\n    ...props\n  }: Omit<ToolWindowsProps, \"windows\"> & {\n    windows: DefaultToolWindow[];\n    showNumbers?: boolean;\n  },\n  forwardedRef: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const toolWindowsRef = useObjectRef(forwardedRef);\n  const windowById = indexBy(({ id }) => id, toolWindows);\n  const actions = useToolWindowsActions({\n    toolWindowsRef,\n    toolWindowsState,\n    getPresentation: (id) => windowById[id],\n  });\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <ToolWindows\n          {...props}\n          ref={toolWindowsRef}\n          toolWindowsState={toolWindowsState}\n          windows={toolWindows.map(({ id, icon, content, title }) => ({\n            id,\n            toolbarButton: (\n              <DefaultToolWindowToolbarButton\n                id={id}\n                icon={icon}\n                title={title}\n                showNumber={showNumbers}\n              />\n            ),\n            content,\n          }))}\n          containerProps={mergeProps(\n            props.containerProps || {},\n            shortcutHandlerProps\n          )}\n        />\n      )}\n    </ActionsProvider>\n  );\n});\n","import React, { Key, useEffect, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { DefaultToolWindow, DefaultToolWindowProps } from \"./DefaultToolWindow\";\nimport { TabItem } from \"../Tabs/TabItem\";\nimport { usePrevious } from \"../utils/usePrevious\";\nimport { ToolWindowTabs } from \"../Tabs/ToolWindowTabs/ToolWindowTabs\";\n\nexport interface MultiContentToolWindowProps\n  extends Pick<DefaultToolWindowProps, \"additionalActions\"> {\n  /**\n   * List of contents that will be accessible with a list of grouped or ungrouped tabs in the tool window header.\n   */\n  children:\n    | React.ReactElement<MultiContentToolWindowContentProps>[]\n    | React.ReactElement<MultiContentToolWindowContentProps>;\n  /**\n   * Key of currently active content\n   */\n  activeKey?: Key;\n  defaultActiveKey?: Key;\n  onActiveKeyChange?: (key: Key) => void;\n  /**\n   * If true, it groups tabs in a dropdown instead.\n   *\n   * @default false\n   */\n  groupTabs?: boolean;\n  /**\n   * The content shown as the title of the tool window, before content switcher (tabs or dropdown).\n   * For more control over header content, you can pass a function which accepts rendered content switcher,\n   * and then you can compose it with other content as you wish. Use case examples of function variant:\n   * - You want to render a title before the content switcher, and something after the tabs. Like a \"+\" button in\n   *   terminal.\n   * - You want to conditionally move inner-content header up to the tool window header, if there is only one tab. In\n   *   that case you don't need to render the content switcher at all. An example is the new design in the \"Run\"\n   *   tool window.\n   */\n  headerContent?:\n    | React.ReactNode\n    | ((props: { renderedViewSwitcher: React.ReactNode }) => React.ReactNode);\n}\n\n/**\n * Implemented on top of DefaultToolWindow, allows for multiple tabbed content within a tool window.\n * Remaining features:\n * - Although trivial, group tabs action in tool window header gear icon is intentionally left unimplemented for now,\n *   until an increment on action system is done.\n * - Grouped mode is not implemented currently, as we don't have a dropdown component. Though it seems it's just a\n *   MenuTrigger and some trigger with a arrow icon.\n */\nexport const MultiViewToolWindow = ({\n  groupTabs,\n  children,\n  headerContent,\n  ...props\n}: MultiContentToolWindowProps) => {\n  const [isToolWindowFocused, setToolWindowFocused] = useState(false);\n  const [activeKey, setActiveKey] = useControlledState(\n    props.activeKey!,\n    props.defaultActiveKey!,\n    props.onActiveKeyChange!\n  );\n  const contents = React.Children.toArray(children)\n    .filter(\n      (\n        child\n      ): child is React.ReactElement<MultiContentToolWindowContentProps> => {\n        const validChild =\n          React.isValidElement(child) &&\n          child.type === MultiContentToolWindowContent;\n        if (!validChild) {\n          // FIXME: only warn in dev mode\n          console.warn(\n            \"You are not supposed to render anything but MultiContentToolWindowContent inside MultiViewToolWindow. Rendered: \",\n            child\n          );\n        }\n        return validChild;\n      }\n    )\n    // The following map is because of what React.Children.toArray does to keys: https://stackoverflow.com/q/33791401/1493081\n    // It doesn't look like a good idea since and there might be better ways to fix this, or at least make sure it would\n    // work in all cases. FIXME\n    .map((content) => ({ ...content, key: `${content.key}`.slice(2) as Key }));\n  const renderContentSwitcher = () => {\n    if (groupTabs) {\n      console.error(\n        \"groupTab is not supported yet in MultiViewToolWindow. Will fallback to ungrouped tabs\"\n      );\n    }\n    return (\n      <ToolWindowTabs\n        noBorders\n        items={contents}\n        active={isToolWindowFocused}\n        selectedKey={activeKey}\n        onSelectionChange={setActiveKey}\n      >\n        {(item) => <TabItem key={item.key}>{item.props.tabContent}</TabItem>}\n      </ToolWindowTabs>\n    );\n  };\n  const renderedViewSwitcher = renderContentSwitcher();\n\n  // We set the active key if it's not set or is invalid. A common scenario is when tabs are closable, and when the\n  // active tab is closed. You would always want to previous tab to get activated in such cases, instead of the first\n  // one. By having the logic here, there is no need to repeat the same logic in each use case. Although, it can also\n  // be moved into a state management utility for tabs, maybe in the future.\n\n  const keys = contents.map(({ key }) => key);\n  const previousKeys = usePrevious(keys);\n  useEffect(() => {\n    if (!keys.includes(activeKey)) {\n      const newActiveKey = keys[previousKeys.indexOf(activeKey) - 1] ?? keys[0];\n      if (newActiveKey != undefined) {\n        setActiveKey(newActiveKey);\n      }\n    }\n  });\n\n  const activeContent = contents.find(\n    (content) => activeKey == undefined || activeKey === content.key\n  );\n  return (\n    <DefaultToolWindow\n      onFocusChange={setToolWindowFocused}\n      headerContent={\n        typeof headerContent === \"function\" ? (\n          headerContent({ renderedViewSwitcher })\n        ) : (\n          <>\n            {headerContent}\n            {renderedViewSwitcher}\n          </>\n        )\n      }\n      additionalActions={props.additionalActions}\n    >\n      {activeContent?.props.children}\n    </DefaultToolWindow>\n  );\n};\n\nexport interface MultiContentToolWindowContentProps {\n  key: Key;\n  /**\n   * Used in the corresponding tab.\n   */\n  tabContent: React.ReactNode;\n\n  children: React.ReactNode;\n}\n\nconst MultiContentToolWindowContent =\n  ({}: MultiContentToolWindowContentProps) => {\n    throw new Error(\n      \"MultiContentToolWindowContent is not meant to be rendered directly. You should only use it in MultiViewToolWindow\"\n    );\n  };\n\nMultiViewToolWindow.View = MultiContentToolWindowContent;\n","export const HIDE_ALL_WINDOWS_ACTION_ID = \"HideAllWindows\";\nexport const JUMP_TO_LAST_WINDOW_ACTION_ID = \"JumpToLastWindow\";\nexport const HIDE_ACTIVE_WINDOW_ACTION_ID = \"HideActiveWindow\";\nexport const MAXIMIZE_TOOL_WINDOW_ACTION_ID = \"MaximizeToolWindow\";\nexport const DOCK_TOOL_WINDOW_ACTION_ID = \"DockToolWindow\";\nexport const RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID = \"ResizeToolWindowRight\";\nexport const RESIZE_TOOL_WINDOW_LEFT_ACTION_ID = \"ResizeToolWindowLeft\";\nexport const RESIZE_TOOL_WINDOW_TOP_ACTION_ID = \"ResizeToolWindowTop\";\nexport const RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID = \"ResizeToolWindowBottom\";\nexport const DOCK_PINNED_MODE_ACTION_ID = \"DockPinnedMode\";\nexport const DOCK_UNPINNED_MODE_ACTION_ID = \"DockUnpinnedMode\";\nexport const UNDOCK_MODE_ACTION_ID = \"UndockMode\";\nexport const FLOAT_MODE_ACTION_ID = \"FloatMode\";\nexport const WINDOW_MODE_ACTION_ID = \"WindowMode\";\nexport const FOCUS_EDITOR_ACTION_ID = \"FocusEditor\";\nexport const REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID =\n  \"RemoveToolWindowFromSidebar\"; // doesn't show up in keymap. Not sure what the id is in the original impl.\n","import React from \"react\";\nimport {\n  Anchor,\n  isHorizontalToolWindow,\n  useToolWindowState,\n  ViewMode,\n} from \"@intellij-platform/core/ToolWindows\";\nimport { ActionDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport {\n  DOCK_PINNED_MODE_ACTION_ID,\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  DOCK_UNPINNED_MODE_ACTION_ID,\n  FLOAT_MODE_ACTION_ID,\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  UNDOCK_MODE_ACTION_ID,\n  WINDOW_MODE_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { ActionGroupDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport { useCreateDefaultActionGroup } from \"@intellij-platform/core/ActionSystem/components\";\n\n// Resize steps in Intellij Platform is calculated based on the size of a \"W\" character and some\n// configuration (ide.windowSystem.hScrollChars). Although it's technically feasible, it seems not necessary\nconst HEIGHT_RESIZE_STEP = 16 * 5;\nconst WIDTH_RESIZE_STEP = 13 * 5;\n\nexport const anchors: Array<{\n  anchor: Anchor;\n  isSplit: boolean;\n  id: string;\n}> = [\n  { id: \"moveToLeftTop\", anchor: \"left\", isSplit: false },\n  { id: \"moveToLeftBottom\", anchor: \"left\", isSplit: true },\n  { id: \"moveToBottomLeft\", anchor: \"bottom\", isSplit: false },\n  { id: \"moveToBottomRight\", anchor: \"bottom\", isSplit: true },\n  { id: \"moveToRightTop\", anchor: \"right\", isSplit: true },\n  { id: \"moveToRightBottom\", anchor: \"right\", isSplit: false },\n  { id: \"moveToTopRight\", anchor: \"top\", isSplit: true },\n  { id: \"moveToTopLeft\", anchor: \"top\", isSplit: false },\n];\n\nconst getAnchorName = ({\n  anchor,\n  isSplit,\n}: {\n  anchor: Anchor;\n  isSplit: boolean;\n}) =>\n  `${anchor[0].toUpperCase()}${anchor.slice(1)} ${\n    isHorizontalToolWindow(anchor)\n      ? isSplit\n        ? \"Right\"\n        : \"Left\"\n      : isSplit\n      ? \"Bottom\"\n      : \"Top\"\n  }`;\n\nexport const ViewModeToActionId: Record<ViewMode, string> = {\n  docked_pinned: DOCK_PINNED_MODE_ACTION_ID,\n  docked_unpinned: DOCK_UNPINNED_MODE_ACTION_ID,\n  undock: UNDOCK_MODE_ACTION_ID,\n  float: FLOAT_MODE_ACTION_ID,\n  window: WINDOW_MODE_ACTION_ID,\n};\n\nexport const VIEW_MODE_ACTION_GROUP_ID = \"TW.ViewModeGroup\";\nexport const MOVE_TO_ACTION_GROUP_ID = \"TW.MoveToGroup\";\nexport const TOOL_WINDOW_RESIZE_ACTION_GROUP_ID = \"ResizeToolWindowGroup\";\n\nexport function useToolWindowActions({\n  mainContentTitle,\n}: {\n  mainContentTitle: string;\n}): ActionGroupDefinition {\n  const {\n    stretchWidth,\n    stretchHeight,\n    changeViewMode,\n    moveToSide,\n    focusMainContent,\n    hide,\n    remove,\n    state,\n  } = useToolWindowState();\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n\n  const actions: ActionDefinition[] = [];\n  const activeToolWindowActionGroup = createDefaultActionGroup({\n    id: \"ActiveToolwindowGroup\",\n    title: \"Active Tool Window\",\n    children: actions,\n  });\n  if (!state) {\n    // FIXME: when window is removed, a last render happens with the new ToolWindowsState, which doesn't have state\n    //  for the removed tool window. Need to understand why that happens.\n    return activeToolWindowActionGroup;\n  }\n  const viewModeActionGroup = createDefaultActionGroup({\n    id: VIEW_MODE_ACTION_GROUP_ID,\n    title: \"View Mode\",\n    children: [\n      {\n        id: DOCK_PINNED_MODE_ACTION_ID,\n        title: \"Dock Pinned\",\n        actionPerformed: () => {\n          changeViewMode(\"docked_pinned\");\n        },\n      },\n      {\n        id: DOCK_UNPINNED_MODE_ACTION_ID,\n        title: \"Dock Unpinned\",\n        actionPerformed: () => {\n          changeViewMode(\"docked_unpinned\");\n        },\n      },\n      {\n        id: UNDOCK_MODE_ACTION_ID,\n        title: \"Undock\",\n        actionPerformed: () => {\n          changeViewMode(\"undock\");\n        },\n      },\n      {\n        id: FLOAT_MODE_ACTION_ID,\n        title: \"Float\",\n        actionPerformed: () => {\n          changeViewMode(\"float\");\n        },\n      },\n      {\n        id: WINDOW_MODE_ACTION_ID,\n        title: \"Window\",\n        actionPerformed: () => {\n          changeViewMode(\"window\");\n        },\n      },\n    ],\n  });\n  const moveToActionGroup = createDefaultActionGroup({\n    id: MOVE_TO_ACTION_GROUP_ID,\n    title: \"Move to\",\n    children: anchors.map(\n      (anchor): ActionDefinition => ({\n        id: `TW.MoveTo.${anchor.id}`,\n        title: getAnchorName(anchor),\n        icon: <PlatformIcon icon={`actions/${anchor.id}`} />,\n        isDisabled:\n          state.anchor === anchor.anchor && state.isSplit === anchor.isSplit,\n        actionPerformed: () => {\n          moveToSide(anchor);\n        },\n      })\n    ),\n  });\n  actions.push(\n    {\n      id: FOCUS_EDITOR_ACTION_ID,\n      title: `Focus ${mainContentTitle}`, // in intellij it says \"Focus Editor\" but it's not generic enough.\n      actionPerformed: () => {\n        focusMainContent();\n      },\n    },\n    {\n      id: HIDE_ACTIVE_WINDOW_ACTION_ID,\n      title: \"Hide\",\n      icon: <PlatformIcon icon=\"general/hideToolWindow\" />,\n      actionPerformed: () => {\n        hide();\n      },\n    },\n    {\n      id: MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n      title: \"Maximize Tool Window\", // Should be \"Restore Tool Window Size if the window is currently maximized\n      actionPerformed: () => {\n        // TODO(release): either remove the action or implement it\n        alert(\"Not implemented\");\n      },\n    },\n    {\n      id: REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n      title: \"Remove from Sidebar\",\n      actionPerformed: () => {\n        remove();\n      },\n    },\n    viewModeActionGroup,\n    moveToActionGroup\n  );\n  if (state.viewMode === \"float\") {\n    actions.push({\n      id: DOCK_TOOL_WINDOW_ACTION_ID,\n      title: \"Dock\",\n      icon: (\n        <PlatformIcon\n          icon={`actions/${\n            anchors.find(\n              ({ anchor, isSplit }) =>\n                anchor === state.anchor && isSplit === state.isSplit\n            )?.id\n          }`}\n        />\n      ),\n      actionPerformed: () => {\n        changeViewMode(\"docked_pinned\");\n      },\n    });\n  }\n  if (state.viewMode !== \"float\" && state.viewMode !== \"window\") {\n    const resizeGroup = createDefaultActionGroup({\n      id: TOOL_WINDOW_RESIZE_ACTION_GROUP_ID,\n      title: \"Resize\",\n      children: [],\n    });\n    if (isHorizontalToolWindow(state.anchor)) {\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n        title: \"Stretch to bottom\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"bottom\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      });\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n        title: \"Stretch to top\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"top\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      });\n    } else {\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n        title: \"Stretch to left\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"left\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      });\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n        title: \"Stretch to right\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"right\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      });\n    }\n    actions.push(resizeGroup);\n  }\n  return activeToolWindowActionGroup;\n}\n","import React from \"react\";\nimport { ActionDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport {\n  getViewModeType,\n  ToolWindowRefValue,\n  ToolWindowsState,\n} from \"@intellij-platform/core/ToolWindows\";\nimport {\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\n\ninterface DefaultToolWindowActionsProps {\n  toolWindowsState: Readonly<ToolWindowsState>;\n  toolWindowsRef: React.RefObject<ToolWindowRefValue>;\n  /**\n   * Used when creating ActivateToolWindow action for each tool window.\n   */\n  getPresentation?: (key: React.Key) =>\n    | {\n        title: string;\n        icon: React.ReactNode;\n      }\n    | undefined;\n}\n\nexport const getActivateToolWindowActionId = (id: string) =>\n  `Activate${id.replace(\" \", \"\")}Window`;\n\n/**\n * Provides default tool windows actions:\n * - Hide all tool windows\n * - Activate{id}Window action for each window\n * - Jump to last tool window\n *\n * @see also {@link DefaultToolWindows}\n */\nexport function useToolWindowsActions({\n  toolWindowsState,\n  toolWindowsRef,\n  getPresentation,\n}: DefaultToolWindowActionsProps) {\n  const isAnySideWindowWindowOpen = (state: Readonly<ToolWindowsState>) =>\n    Object.values(state.windows).some(\n      ({ isVisible, viewMode }) =>\n        isVisible && getViewModeType(viewMode) !== \"float\"\n    );\n  const windowIds = Object.keys(toolWindowsState.windows).map(\n    (key) => `${key}`\n  );\n  const activateToolWindowActions = windowIds.map(\n    (id: string, index): ActionDefinition => {\n      const { title, icon } = getPresentation?.(id) || {};\n      return {\n        id: getActivateToolWindowActionId(id),\n        title: title || `${getOrdinal(index)} window`,\n        icon,\n        description: `Activate ${title || getOrdinal(index)} window`,\n        actionPerformed: () => {\n          if (\n            toolWindowsState.windows[id]?.isVisible &&\n            !toolWindowsRef.current?.hasFocus(id)\n          ) {\n            toolWindowsRef.current?.focus(id);\n          } else {\n            toolWindowsRef.current?.changeState((state) => state.toggle(id));\n          }\n        },\n      };\n    }\n  );\n  const actions: ActionDefinition[] = [\n    ...activateToolWindowActions,\n    {\n      id: HIDE_ALL_WINDOWS_ACTION_ID,\n      title: isAnySideWindowWindowOpen(toolWindowsState)\n        ? \"Hide All Windows\"\n        : \"Restore windows\",\n      actionPerformed: () => {\n        toolWindowsRef.current?.changeState((state) => {\n          if (isAnySideWindowWindowOpen(state)) {\n            return state.hideAll();\n          } else {\n            return state.restoreWindows();\n          }\n        });\n        // Because windows have autofocus behaviour, a timeout is set. Not sure how reliable it is.\n        // TODO: replace effect-based auto focus behaviour with something better, maybe controlled by ToolWindows\n        //  component, and when a tool window is opened.\n        setTimeout(() => {\n          toolWindowsRef.current?.focusMainContent();\n        });\n      },\n    },\n    {\n      id: JUMP_TO_LAST_WINDOW_ACTION_ID,\n      title: \"Jump to Last Tool Window\",\n      isDisabled: toolWindowsState.lastFocusedKey == null,\n      actionPerformed: () => {\n        toolWindowsRef.current?.focusLastActiveWindow();\n      },\n    },\n  ];\n  return actions;\n}\n\nfunction getOrdinal(n: number) {\n  let ord = [\"st\", \"nd\", \"rd\"];\n  let exceptions = [11, 12, 13];\n  let nth =\n    ord[(n % 10) - 1] == undefined || exceptions.includes(n % 100)\n      ? \"th\"\n      : ord[(n % 10) - 1];\n  return n + nth;\n}\n","import React, {\n  CSSProperties,\n  MouseEvent,\n  useContext,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { styled, css } from \"../styled\";\nimport {\n  StyledHorizontalSeparator,\n  StyledSeparator,\n  StyledVerticalSeparator,\n} from \"../StyledSeparator\";\nimport { useOverflowObserver } from \"@intellij-platform/core/utils/overflow-utils/useOverflowObserver\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { Overlay, useOverlayPosition } from \"@react-aria/overlays\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/Popup\";\nimport { mergeProps } from \"@react-aria/utils\";\n\ntype ToolbarBorderProp =\n  | true\n  | \"horizontal\"\n  | \"vertical\"\n  | \"bottom\"\n  | \"top\"\n  | \"left\"\n  | \"right\";\n\nexport type ToolbarProps = {\n  children: React.ReactNode;\n  orientation?: \"vertical\" | \"horizontal\";\n  border?: ToolbarBorderProp;\n  style?: CSSProperties;\n  className?: string;\n} & (\n  | {\n      orientation: \"vertical\";\n    }\n  | {\n      orientation?: \"horizontal\";\n      /**\n       * Defines how the toolbar should handle its children when there is not enough room\n       * to fit all:\n       * - popup: the overflowed children will be hidden behind a show more arrow icon that\n       *   shows the rest of the items in a popup.\n       * - wrap: children will be wrapped so that they fit the available width/height\n       **/\n      overflowBehavior?: \"popup\" | \"wrap\";\n    }\n);\n\nconst borderStyle = ({ border }: { border?: ToolbarBorderProp }) =>\n  border &&\n  css`\n    border-style: solid;\n    border-color: ${({ theme }) => theme.commonColors.borderColor};\n    border-width: ${border === true ? \"1px\" : borderPropToCssProp[border]};\n  `;\n\nconst StyledToolbar = styled.div<{\n  border?: ToolbarBorderProp;\n}>`\n  display: inline-flex;\n  box-sizing: border-box;\n  overflow: hidden;\n  // NOTE: in the original implementation, there is no empty space between buttons, but buttons have kind of an\n  // invisible left padding, which is mouse-intractable, but doesn't visually seem a part of the button.\n  // Although implementable, it didn't seem necessary to follow the exact same thing. Margin should be fine.\n  gap: 4px;\n  ${borderStyle}\n  ${StyledSeparator}:first-child {\n    display: none;\n  }\n  ${StyledSeparator}:last-child {\n    display: none;\n  }\n`;\n\nconst borderPropToCssProp: Record<\n  Exclude<ToolbarBorderProp, boolean>,\n  CSSProperties[\"borderWidth\"]\n> = {\n  top: \"1px 0 0 0\",\n  bottom: \"0 0 1px 0\",\n  right: \"0 1px 0 0\",\n  left: \"0 0 0 1px\",\n  horizontal: \"0 1px\",\n  vertical: \"1px 0\",\n};\n\nconst SIDE_PADDING = 3;\nconst END_PADDING = 4;\n\nconst StyledShowMoreButton = styled.button`\n  all: unset;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  ${borderStyle};\n`;\n\nconst StyledHorizontalToolbar = styled(StyledToolbar)`\n  padding: ${SIDE_PADDING}px ${END_PADDING}px;\n  max-width: 100%;\n  /*noinspection CssInvalidPropertyValue*/\n  max-width: -webkit-fill-available;\n  ${StyledHorizontalSeparator} {\n    margin: 1px 0;\n  }\n  ${StyledShowMoreButton} {\n    margin-right: -${END_PADDING}px;\n  }\n`;\n\nconst StyledVerticalToolbar = styled(StyledToolbar)`\n  flex-direction: column;\n  max-height: 100%;\n  /*noinspection CssInvalidPropertyValue*/\n  max-height: -webkit-fill-available;\n  padding: ${END_PADDING}px ${SIDE_PADDING}px;\n  ${StyledVerticalSeparator} {\n    margin: 0 1px;\n  }\n  ${StyledShowMoreButton} {\n    margin-bottom: -${END_PADDING}px;\n  }\n`;\n\nconst StyledToolbarContent = styled.div<{\n  wrap?: boolean;\n  firstOverflowedIndex: number;\n}>`\n  box-sizing: inherit;\n  display: inherit;\n  flex-direction: inherit;\n  flex-wrap: ${({ wrap }) => (wrap ? \"wrap\" : \"nowrap\")};\n  gap: inherit;\n  max-height: inherit;\n  max-width: inherit;\n  min-height: 0;\n  min-width: 0;\n\n  ${({ firstOverflowedIndex }) =>\n    /**\n     * The hidden styles should be in a way that the hidden element:\n     * - occupies its space in the document layout.\n     * - doesn't capture mouse events. (e.g. a half-overflowing hidden element shouldn't show tooltip)\n     * - remains accessible to screen readers.\n     */\n    css`\n      > ${firstOverflowedIndex === 0\n          ? \"*\"\n          : `:nth-child(${firstOverflowedIndex}) ~ *`} {\n        opacity: 0 !important;\n        pointer-events: none !important;\n      }\n    `}\n`;\n// This can be used in other places if use-cases are raised for keeping orientation in the context.\nconst OrientationContext = React.createContext<\"horizontal\" | \"vertical\">(\n  \"horizontal\"\n);\n\n/**\n * ## Toolbar API/Implementation notes\n *\n * ### Handling Overflow\n *\n * Handling the overflow popup on DOM-level, allows for a simple and flexible implementation that doesn't\n * require any coupling between Toolbar and components like IconButton. Other components can also similarly be\n * rendered inside toolbar without adopting any specific API. It's worth noting that any generic approach based\n * on children react nodes instead of children DOM nodes will have many edge cases and will involve assumptions\n * that will limit the API of toolbar. Also, any approach based on moving dom nodes to the overflow popup will\n * conflict with React owning the DOM.\n *\n * #### Assumption\n *\n * Since the overflow popup renders the same `children`, and items in the toolbar and popup overflow are made\n * visible/hidden based on the index of DOM nodes, it's important than children deterministically results in the\n * same dom structure. i.e. if a component in children randomly renders different number of root dom nodes in\n * each render, it can cause issues in hiding/showing elements.\n *\n * ### Orientation\n * A few reasons for not having separate `HorizontalToolbar` and `VerticalToolbar` components instead of `Toolbar` with\n * `orientation` prop:\n * - From usage side, a single `Toolbar` component is considered a more discoverable API.\n * - Separate components would require abstracting common parts which unnecessarily adds to complexity.\n *   The amount of branching to handle the differences is considered ok, at the current state of the component.\n */\n\n/**\n * @description\n * A toolbar is a container for {@link IconButton} and similar UI components.\n *\n * ## Features:\n * - A toolbar can be horizontal or vertical\n * - When there is not enough space for all children, toolbar shows an arrow icon, which shows the overflowing\n *   items in a popup, upon mouseover.\n *   Optionally, overflow can be wrapped into multiple lines, in horizontal toolbars.\n *\n * @example\n * <Toolbar>\n *   <IconButton aria-label=\"Show Diff\">\n *     <PlatformIcon icon=\"actions/diff\" />\n *   </IconButton>\n *   </Toolbar>\n */\nexport const Toolbar: React.FC<ToolbarProps> = ({\n  border,\n  orientation = \"horizontal\",\n  ...props\n}): React.ReactElement => {\n  const overflowBehavior =\n    orientation === \"horizontal\" && \"overflowBehavior\" in props\n      ? props.overflowBehavior\n      : null;\n  const rootProps = { style: props.style, className: props.className };\n  const ref = useRef<HTMLDivElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const showMoreButtonRef = useRef<HTMLButtonElement>(null);\n  const StyledToolbar =\n    orientation === \"horizontal\"\n      ? StyledHorizontalToolbar\n      : StyledVerticalToolbar;\n  const { overflowedElements } = useOverflowObserver(ref, { threshold: 0.8 });\n  const [isOverflowPopupVisible, setOverflowPopupVisible] = useState(false);\n  const [popupHeight, setPopupHeight] = useState(30);\n  const [firstOverflowedChildIndex, setFirstOverflowedChildIndex] =\n    useState<number>(-1);\n  const firstOverflowedChildRef = useRef<HTMLElement | undefined>();\n\n  useLayoutEffect(() => {\n    if (ref.current) {\n      const childElements = [...ref.current.children].filter(\n        (node): node is HTMLElement => node instanceof HTMLElement\n      );\n      const firstOverflowedChild = childElements.findIndex((child) =>\n        overflowedElements.includes(child)\n      );\n      setFirstOverflowedChildIndex(firstOverflowedChild);\n      firstOverflowedChildRef.current = childElements[firstOverflowedChild];\n    }\n  }, [overflowedElements]);\n\n  useLayoutEffect(() => {\n    if (overlayRef.current && popupHeight !== overlayRef.current.offsetHeight) {\n      setPopupHeight(overlayRef.current.offsetHeight);\n    }\n  });\n\n  const { overlayProps } = useOverlayPosition({\n    isOpen: isOverflowPopupVisible,\n    placement: \"bottom left\",\n    offset:\n      // in lack of positioning options for aligning bottom and left of of the overflow popup with the bottom and left\n      // of the toolbar itself, we have to measure the popup height, and use offset to achieve the same\n      orientation === \"horizontal\"\n        ? -popupHeight + SIDE_PADDING + 1\n        : -popupHeight + 1,\n    crossOffset:\n      orientation === \"horizontal\" ? -(SIDE_PADDING + 2) : -(SIDE_PADDING + 1),\n    containerPadding: 0,\n    shouldFlip: false,\n    targetRef: orientation === \"horizontal\" ? ref : showMoreButtonRef,\n    overlayRef: overlayRef,\n    onClose: () => {\n      setOverflowPopupVisible(false);\n    },\n  });\n\n  const showOverflowPopup = () => {\n    setOverflowPopupVisible(true);\n  };\n\n  const toolbarProps = {\n    onMouseMove: (event: MouseEvent) => {\n      const firstOverflowedElement = firstOverflowedChildRef.current;\n      if (!firstOverflowedElement) {\n        return;\n      }\n      const shouldShow =\n        orientation === \"vertical\"\n          ? event.clientY > firstOverflowedElement.getBoundingClientRect().top\n          : event.clientX > firstOverflowedElement.getBoundingClientRect().left;\n      if (shouldShow !== isOverflowPopupVisible) {\n        setOverflowPopupVisible(shouldShow);\n      }\n    },\n    onMouseLeave: () => {\n      if (isOverflowPopupVisible) {\n        setOverflowPopupVisible(false);\n      }\n    },\n  };\n  const toolbarOverflowPopupProps = {\n    onMouseEnter: () => setOverflowPopupVisible(true),\n    onMouseLeave: () => setOverflowPopupVisible(false),\n  };\n  return (\n    <OrientationContext.Provider value={orientation}>\n      <StyledToolbar\n        border={border}\n        {...mergeProps(rootProps, toolbarProps)}\n        role=\"toolbar\"\n      >\n        <StyledToolbarContent\n          ref={ref}\n          role=\"presentation\"\n          firstOverflowedIndex={firstOverflowedChildIndex}\n          wrap={overflowBehavior === \"wrap\"}\n        >\n          {props.children}\n        </StyledToolbarContent>\n        {overflowedElements.length > 0 && (\n          <StyledShowMoreButton\n            ref={showMoreButtonRef}\n            tabIndex={-1}\n            onMouseEnter={showOverflowPopup}\n          >\n            <PlatformIcon icon=\"ide/link\" />\n          </StyledShowMoreButton>\n        )}\n      </StyledToolbar>\n      {isOverflowPopupVisible && overflowedElements.length > 0 && (\n        // Maybe more accessible to reuse the entire Popup here? it would require more flexible API to handle mouseleave though\n        // Note: we could also render the whole toolbar with the same props and only orientation being overwritten,\n        // but it has the risk of infinite overlay opening in some edge cases, and that level of generality doesn't\n        // seem to be necessary, at least at the moment.\n        <OrientationContext.Provider value=\"horizontal\">\n          <Overlay>\n            <StyledPopupContainer\n              ref={overlayRef}\n              {...mergeProps(overlayProps, toolbarOverflowPopupProps)}\n            >\n              <ToolbarInOverlay\n                border\n                firstVisibleIndex={\n                  orientation === \"vertical\"\n                    ? firstOverflowedChildIndex\n                    : undefined\n                }\n              >\n                {props.children}\n              </ToolbarInOverlay>\n            </StyledPopupContainer>\n          </Overlay>\n        </OrientationContext.Provider>\n      )}\n    </OrientationContext.Provider>\n  );\n};\n\nconst ToolbarInOverlay = styled(StyledHorizontalToolbar)<{\n  firstVisibleIndex?: number;\n}>`\n  ${({ firstVisibleIndex }) =>\n    firstVisibleIndex &&\n    css`\n      ${StyledSeparator}:nth-child(${firstVisibleIndex + 1}) {\n        display: none;\n      }\n      > :not(:nth-child(${firstVisibleIndex}) ~ *) {\n        display: none;\n      }\n    `};\n`;\n\n/**\n * Separator to be used between items in a toolbar.\n */\nexport const ToolbarSeparator = (): React.ReactElement => {\n  const orientation = useContext(OrientationContext);\n  return orientation === \"horizontal\" ? (\n    <StyledHorizontalSeparator />\n  ) : (\n    <StyledVerticalSeparator />\n  );\n};\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionHelpTooltipProps {\n  actionName: React.ReactNode;\n  helpText: React.ReactNode;\n  shortcut?: React.ReactNode;\n  link?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action Help\"\n * @see {@link ActionTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionHelpTooltip = ({\n  actionName,\n  helpText,\n  shortcut,\n  link,\n}: ActionHelpTooltipProps): JSX.Element => {\n  return (\n    <Tooltip multiline>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n      <Tooltip.Description>{helpText}</Tooltip.Description>\n      {link && <Tooltip.Link>{link}</Tooltip.Link>}\n    </Tooltip>\n  );\n};\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionTooltipProps {\n  actionName: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action\"\n * @see {@link ActionHelpTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionTooltip = ({\n  actionName,\n  shortcut,\n}: ActionTooltipProps): JSX.Element => {\n  return (\n    <Tooltip>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n    </Tooltip>\n  );\n};\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { TooltipTriggerProps as AriaTooltipTriggerProps } from \"@react-aria/tooltip\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { TooltipTriggerAndOverlay } from \"@intellij-platform/core/Tooltip/TooltipTriggerAndOverlay\";\nimport { AriaPositionProps, useOverlayPosition } from \"@react-aria/overlays\";\n\ninterface TooltipTriggerProps\n  extends Omit<AriaTooltipTriggerProps, \"trigger\">,\n    Pick<\n      AriaPositionProps,\n      \"placement\" | \"offset\" | \"crossOffset\" | \"shouldFlip\"\n    > {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n      ) => React.ReactNode);\n\n  /**\n   * Whether to show the tooltip on trigger's focus. By default, tooltip is shown only when the trigger\n   * is hovered, but it can improve accessibility to show the tooltip on focus as well.\n   */\n  showOnFocus?: boolean;\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}. Tooltip will be positioned based relative to the trigger.\n * The default tooltip positioning is based on cursor, which is implemented by {@link TooltipTrigger}\n */\nexport const PositionedTooltipTrigger = ({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  offset = 8,\n  showOnFocus,\n  ...props\n}: TooltipTriggerProps): JSX.Element => {\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const triggerRef = useRef<HTMLElement>(null);\n\n  const { overlayProps, updatePosition } = useOverlayPosition({\n    ...props,\n    overlayRef,\n    targetRef: triggerRef,\n    offset,\n    isOpen: state.isOpen,\n    onClose: state.close,\n  });\n\n  // A workaround for a mysterious issue that happens only in docusaurus build.\n  // The ref value is not up-to-date, when the effect runs.\n  // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n  useEffect(() => {\n    if (state.isOpen) {\n      requestAnimationFrame(updatePosition);\n    }\n  }, [state.isOpen]);\n\n  return (\n    <TooltipTriggerAndOverlay\n      tooltip={tooltip}\n      tooltipOverlayProps={overlayProps}\n      trigger={children}\n      state={state}\n      overlayRef={overlayRef}\n      triggerRef={triggerRef}\n      showOnFocus={showOnFocus}\n      isDisabled={props.isDisabled}\n    />\n  );\n};\n","import React, { ForwardedRef, useContext } from \"react\";\nimport { AriaTooltipProps, useTooltip } from \"@react-aria/tooltip\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { TooltipContext } from \"./TooltipContext\";\n\nexport interface TooltipProps extends Omit<AriaTooltipProps, \"isOpen\"> {\n  children: React.ReactNode;\n  multiline?: boolean;\n  className?: string;\n}\n\n// Providing default value for paddings, based on intellijlaf theme. In Intellij Platform, themes extend either\n// intellijlaf or darcula. Which means some properties can be omitted in the custom theme, relying on the values\n// in the base theme. This is not how theming works here, at the moment, and there are other similar issues, but\n// this is just a mitigation for one case, spacing in tooltip.\nconst DEFAULT_TEXT_BORDER_INSETS = \"0.5rem 0.8125rem 0.625rem 0.625rem\";\nconst DEFAULT_SMALL_TEXT_BORDER_INSETS = \"0.375rem 0.75rem 0.4375rem 0.625rem\";\n\nconst StyledTooltip = styled.div<{ multiline?: boolean }>`\n  box-sizing: content-box;\n  max-width: ${\n    /**\n     * Max width is meant to be set on the multiline description (which is not used in ActionTooltip which would\n     * be right according to [the specs](https://jetbrains.github.io/ui/controls/tooltip/#09)).\n     * But if set on `Tooltip.Description`, title and link can still make the tooltip grow more that the expected max\n     * width. So it makes more sense to set the max width on the container anyway. But since the value of the max width\n     * is meant to be for description we set the box-sizing to \"content-box\" to exclude container's padding in max-width\n     * calculation.\n     */\n    ({ theme, multiline }) =>\n      multiline\n        ? `${\n            theme.value<number>(\n              \"HelpTooltip.maxWidth\" as UnknownThemeProp<\"HelpTooltip.maxWidth\">\n            ) ?? 250\n          }px`\n        : null\n  };\n  white-space: ${({ multiline }) => (!multiline ? \"nowrap\" : null)};\n  display: inline-flex;\n  flex-direction: column;\n  gap: ${({ theme }) =>\n    theme.value<number>(\n      \"HelpToolTip.verticalGap\" as UnknownThemeProp<\"HelpToolTip.verticalGap\">\n    ) ?? 4}px;\n  background: ${({ theme }) =>\n    theme.color(\"ToolTip.background\", !theme.dark ? \"#f2f2f2\" : \"#3c3f41\")};\n  color: ${({ theme }) =>\n    theme.color(\"ToolTip.foreground\", !theme.dark ? \"#000\" : \"#bfbfbf\")};\n  padding: ${({ theme, multiline }) =>\n    multiline\n      ? theme.inset(\"HelpTooltip.defaultTextBorderInsets\") ||\n        DEFAULT_TEXT_BORDER_INSETS\n      : theme.inset(\"HelpTooltip.smallTextBorderInsets\") ||\n        DEFAULT_SMALL_TEXT_BORDER_INSETS};\n  line-height: 1.2;\n  border-style: solid;\n  border-width: ${({ theme }) =>\n    theme.value<boolean>(\"ToolTip.paintBorder\") ? \"1px\" : \"0px\"};\n  border-color: ${({ theme }) =>\n    theme.color(\"ToolTip.borderColor\", !theme.dark ? \"#adadad\" : \"#636569\")};\n  ${WINDOW_SHADOW};\n`;\n\nconst StyledShortcut = styled.kbd`\n  all: unset;\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.shortcutForeground\",\n      !theme.dark ? \"#787878\" : \"#999999\"\n    )};\n`;\n\nconst StyledHeader = styled.div`\n  font-size: ${({ theme }) => theme.fontSizeDelta(\"HelpTooltip.fontSizeDelta\")};\n  display: flex;\n  gap: 0.5rem;\n`;\nconst StyledDescription = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"Tooltip.infoForeground\" as UnknownThemeProp<\"Tooltip.infoForeground\">,\n      theme.commonColors.contextHelpForeground\n    )};\n  font-size: ${({ theme }) =>\n    theme.fontSizeDelta(\"HelpTooltip.descriptionSizeDelta\")};\n`;\n\nconst StyledLink = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.linkForeground\" as UnknownThemeProp<\"ToolTip.linkForeground\">,\n      theme.commonColors.linkForegroundEnabled\n    )};\n  a,\n  [role=\"link\"] {\n    // Maybe target Link instead, without important. It didn't work as expected, in the first try tho.\n    color: inherit !important;\n  }\n`;\n\n/**\n * Implements the UI of a Tooltip. For tooltip to be shown for a trigger, on hover, use {@link TooltipTrigger}.\n * The following components can be used to compose the content of a tooltip.\n * - {@link Tooltip.Header}\n * - {@link Tooltip.Description}\n * - {@link Tooltip.Link}\n * - {@link Tooltip.Shortcut}\n * Prefer using higher-level components like {@link HelpTooltip}, {@link ActionHelpTooltip} or {@link ActionTooltip}.\n * that ensure different pieces of tooltip content follow the\n * [design system recommendation](https://jetbrains.github.io/ui/controls/tooltip)\n *\n *\n * ### Reference:\n * Tooltip, Tooltip.* and TooltipTrigger are corresponding to [HelpTooltip](https://github.com/JetBrains/intellij-community/blob/854daf45b47a6ea9da0348978608bfbfe998d99c/platform/platform-api/src/com/intellij/ide/HelpTooltip.java#L102)\n * in the original impl.\n */\nconst Tooltip = React.forwardRef(function Tooltip(\n  { children, multiline, ...props }: TooltipProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref = useObjectRef(forwardedRef);\n  const { state, isInteractive } = useContext(TooltipContext) || {};\n  const { tooltipProps } = useTooltip(\n    props,\n    state\n      ? {\n          ...state,\n          // if the tooltip is not interactive, let it be closed even when it's hovered. That's the according to the reference impl.\n          open: isInteractive ? state?.open : () => {},\n        }\n      : state\n  );\n\n  return (\n    <StyledTooltip\n      multiline={multiline}\n      {...tooltipProps}\n      className={props.className}\n      ref={ref}\n    >\n      {children}\n    </StyledTooltip>\n  );\n});\n\nconst _Tooltip = Object.assign(Tooltip, {\n  Header: StyledHeader,\n  Shortcut: StyledShortcut,\n  Description: StyledDescription,\n  Link: StyledLink,\n});\n\nexport { _Tooltip as Tooltip };\n","import React from \"react\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\n\ninterface TooltipContextObject {\n  state: TooltipTriggerState;\n  isInteractive: boolean;\n}\n\nexport const TooltipContext = React.createContext<TooltipContextObject | null>(\n  null\n);\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { TooltipTriggerProps as AriaTooltipTriggerProps } from \"@react-aria/tooltip\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { useMouseEventOverlayPosition } from \"@intellij-platform/core/utils/useMouseEventOverlayPosition\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { TooltipTriggerAndOverlay } from \"@intellij-platform/core/Tooltip/TooltipTriggerAndOverlay\";\n\nexport interface TooltipTriggerProps\n  extends Omit<AriaTooltipTriggerProps, \"isOpen\" | \"defaultOpen\" | \"trigger\"> {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n      ) => React.ReactNode);\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}.\n * Showing tooltip on focus and controlled open state are not supported at the moment, based on how tooltip works in the\n * reference impl, and since tooltip is positioned based on cursor position. Positioning the tooltip based on cursor\n * position requires tooltip to be opened on hover. That's why neither controlling opened state nor showing the tooltip\n * on focus are supported here. {@link PositionedTooltipTrigger} allows for positioning the tooltip with respect to the\n * trigger element, and offers more options.\n */\nexport const TooltipTrigger = ({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  ...props\n}: TooltipTriggerProps): JSX.Element => {\n  const triggerRef = useRef<HTMLElement>(null);\n  const theme = useTheme();\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  const { overlayProps, updatePosition } = useMouseEventOverlayPosition({\n    overlayRef,\n    isOpen: state.isOpen,\n    placement: \"bottom left\",\n    shouldFlip: true,\n    offset: theme.value<number>(\"HelpTooltip.mouseCursorOffset\") ?? 20,\n  });\n\n  // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n  useEffect(() => {\n    if (state.isOpen) {\n      requestAnimationFrame(() => {\n        updatePosition();\n      });\n    }\n  }, [state.isOpen]);\n\n  return (\n    <TooltipTriggerAndOverlay\n      tooltip={tooltip}\n      tooltipOverlayProps={overlayProps}\n      trigger={children}\n      state={state}\n      overlayRef={overlayRef}\n      triggerRef={triggerRef}\n      /**\n       * If we want to support showing tooltip on focus, or if we want to allow controlled open state, we should let it\n       * be positioned by the trigger element in that case, rather than mouse position.\n       * One solution would be to use useOverlayPosition as well, and conditionally use the right `overlayProps`, based on\n       * whether the position determined by mouse is within `triggerRef.current?.getBoundingClientRect()`. Another way\n       * (maybe better) would be to have `useMouseEventOverlayPosition` accept `bounds` or `containerBounds`, which if\n       * passed, makes sure the position is kept within that boundary. Outside positions would be mapped to the closest\n       * point on the border of the boundary.\n       */\n      showOnFocus={false}\n      isDisabled={props.isDisabled}\n    />\n  );\n};\n","import React, {\n  HTMLAttributes,\n  HTMLProps,\n  ReactElement,\n  RefObject,\n  useState,\n} from \"react\";\nimport { useTooltipTrigger as useAriaTooltipTrigger } from \"@react-aria/tooltip\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\nimport { FocusableProvider } from \"@react-aria/focus\";\nimport { Overlay } from \"@react-aria/overlays\";\nimport { mergeProps, useLayoutEffect } from \"@react-aria/utils\";\nimport { TooltipContext } from \"@intellij-platform/core/Tooltip/TooltipContext\";\n\ninterface TooltipTriggerBaseProps {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * props to be applied on the tooltip overlay, for positioning.\n   */\n  tooltipOverlayProps: HTMLProps<HTMLDivElement>;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  trigger:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n      ) => React.ReactNode);\n\n  state: TooltipTriggerState;\n\n  showOnFocus?: boolean;\n\n  overlayRef: RefObject<HTMLDivElement>;\n  triggerRef: RefObject<HTMLElement>;\n  isDisabled?: boolean;\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}. It doesn't handle tooltip positioning, and so shouldn't be used\n * directly. {@param tooltipOverlayProps} should be used to apply the intended positioning.\n *\n * TODO: Implement timeout-based auto-hide (https://jetbrains.github.io/ui/controls/tooltip/#19)\n * TODO: shadow\n */\nexport const TooltipTriggerAndOverlay = ({\n  tooltip,\n  trigger,\n  state,\n  tooltipOverlayProps,\n  overlayRef,\n  triggerRef,\n  showOnFocus,\n  ...props\n}: TooltipTriggerBaseProps): JSX.Element => {\n  const [isInteractive, setInteractive] = useState(false);\n  const { triggerProps, tooltipProps } = useTooltipTrigger(\n    props,\n    // In Intellij Platform. The tooltip hides right away. We follow the same, unless the tooltip is interactive.\n    // Maybe something to rethink if it's worth following the reference impl for.\n    { ...state, close: isInteractive ? state.close : () => state.close(true) },\n    triggerRef\n  );\n\n  if (!showOnFocus) {\n    delete triggerProps.onFocus;\n  }\n\n  useLayoutEffect(() => {\n    setInteractive(\n      overlayRef.current?.querySelector(\n        'a, button, [role=\"button\"], [role=link]'\n      ) !== null\n    );\n  });\n  return (\n    <>\n      {normalizeChildren(trigger, { ...triggerProps, ref: triggerRef })}\n      {state.isOpen && !props.isDisabled && (\n        <Overlay>\n          <TooltipContext.Provider value={{ state, isInteractive }}>\n            <div\n              {...mergeProps(\n                tooltipOverlayProps,\n                // Is it ok to apply tooltip props on this wrapper?\n                tooltipProps\n              )}\n              ref={overlayRef}\n            >\n              {tooltip}\n            </div>\n          </TooltipContext.Provider>\n        </Overlay>\n      )}\n    </>\n  );\n};\n\nfunction normalizeChildren(\n  children: TooltipTriggerBaseProps[\"trigger\"],\n  triggerProps: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n) {\n  if (typeof children === \"function\") {\n    return children(triggerProps);\n  }\n  if (React.isValidElement(children) && typeof children.type === \"string\") {\n    return React.cloneElement(children, triggerProps);\n  }\n  return <FocusableProvider {...triggerProps}>{children}</FocusableProvider>;\n}\n\n/**\n * A wrapper around react-aria's useTooltipTrigger, adjusting it for Intellij Platform.\n */\nconst useTooltipTrigger: typeof useAriaTooltipTrigger = (props, state, ref) => {\n  const { triggerProps, tooltipProps } = useAriaTooltipTrigger(\n    props,\n    state,\n    ref\n  );\n  // onPointerDown returned from the underlying usePress stops propagation which messes with some usages of tooltip\n  // like in tab or tool window stripe button. We replace onPointerDown handler with a similar handler that closes\n  // the tooltip.\n  triggerProps.onPointerDown = () => {\n    if (!(ref.current instanceof HTMLInputElement)) {\n      state.close(true);\n    }\n  };\n  /**\n   * onMouseDown is preventDefault-ed which interferes with functionality of the tooltip trigger, in use cases like\n   * tool window stripe button. Note that since pointerDown is handled for calling the tooltip trigger's onPressStart\n   * handler (which hides the tooltip), there is no issue in excluding onMouseDown, because it's only used to preventDefault\n   * the event, because of some edge cases focus handling which is not our concern.\n   */\n  delete triggerProps.onMouseDown;\n\n  return {\n    triggerProps,\n    tooltipProps,\n  };\n};\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport interface ValidationTooltipProps {\n  children: React.ReactNode;\n  /**\n   * @default error\n   */\n  type?: \"error\" | \"warning\";\n}\n\nconst StyledValidationTooltip = styled(Tooltip)`\n  box-shadow: none;\n  padding: 0.25rem 0.5rem; // from ComponentValidator class in the reference impl\n  max-width: ${({ theme }) =>\n    `${theme.value<number>(\"ValidationTooltip.maxWidth\")}px`};\n  background: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.errorBackground\")};\n  border: 1px solid\n    ${({ theme }) => theme.color(\"ValidationTooltip.errorBorderColor\")};\n`;\n\nconst StyledWarningValidationTooltip = styled(StyledValidationTooltip)`\n  background: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.warningBackground\")};\n  border-color: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.warningBorderColor\")};\n`;\n\n/**\n * Tooltip to be used for validation error messages\n * @see https://jetbrains.github.io/ui/principles/validation_errors/\n */\nexport const ValidationTooltip = ({\n  type = \"error\",\n  children,\n}: ValidationTooltipProps): JSX.Element => {\n  const Component =\n    type === \"error\" ? StyledValidationTooltip : StyledWarningValidationTooltip;\n  return <Component multiline>{children}</Component>;\n};\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeNode } from \"../TreeNode\";\nimport { SpeedSearchItemHighlightsProvider } from \"@intellij-platform/core/CollectionSpeedSearch\";\n\nexport const SpeedSearchTreeNode = <T extends object>({\n  item,\n}: {\n  item: Node<T>;\n}) => {\n  return (\n    <SpeedSearchItemHighlightsProvider itemKey={item.key}>\n      <TreeNode key={item.key} item={item} />\n    </SpeedSearchItemHighlightsProvider>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { Virtualizer } from \"@react-aria/virtualizer\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport { SpeedSearchProps } from \"@intellij-platform/core/SpeedSearch\";\nimport { useCollectionRef } from \"@intellij-platform/core/Collections/useCollectionRef\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { StyledTree } from \"../StyledTree\";\nimport { SpeedSearchPopup } from \"../../SpeedSearch/SpeedSearchPopup\";\nimport { useTreeState } from \"../useTreeState\";\nimport { TreeProps } from \"../Tree\";\nimport { useTreeVirtualizer } from \"../useTreeVirtualizer\";\nimport { TreeContext } from \"../TreeContext\";\nimport { useSpeedSearchTree } from \"./useSpeedSearchTree\";\nimport { SpeedSearchTreeNode } from \"./SpeedSearchTreeNode\";\n\nexport type SpeedSearchTreeProps<T extends object> = TreeProps<T> &\n  SpeedSearchProps;\n\nexport const SpeedSearchTree = React.forwardRef(\n  <T extends object>(\n    { fillAvailableSpace = false, treeRef, ...props }: SpeedSearchTreeProps<T>,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) => {\n    const state = useTreeState(\n      { ...props, disallowEmptySelection: !props.allowEmptySelection },\n      treeRef\n    );\n    useCollectionRef(props, state);\n    const ref = useForwardedRef(forwardedRef);\n    const {\n      treeProps,\n      treeContext,\n      speedSearchContextValue,\n      searchPopupProps,\n    } = useSpeedSearchTree({ ...props, isVirtualized: true }, state, ref);\n\n    const { virtualizerProps } = useTreeVirtualizer({ state });\n\n    // NOTE: SpeedSearchPopup can be rendered as a portal with proper positioning (useOverlayPosition), if overflow\n    // issues required it.\n    return (\n      <TreeContext.Provider value={treeContext}>\n        <CollectionSpeedSearchContext.Provider value={speedSearchContextValue}>\n          <SpeedSearchPopup {...searchPopupProps} />\n          <StyledTree\n            as={Virtualizer}\n            ref={ref}\n            fillAvailableSpace={fillAvailableSpace}\n            {...virtualizerProps}\n            {...treeProps}\n          >\n            {(type: string, item: unknown) => (\n              <SpeedSearchTreeNode\n                key={(item as Node<T>).key}\n                item={item as Node<T>}\n              />\n            )}\n          </StyledTree>\n        </CollectionSpeedSearchContext.Provider>\n      </TreeContext.Provider>\n    );\n  }\n);\n","import { RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useCollectionSpeedSearch } from \"../../CollectionSpeedSearch/useCollectionSpeedSearch\";\nimport { SpeedSearchProps } from \"../../SpeedSearch/useSpeedSearch\";\nimport { TreeKeyboardDelegate } from \"../TreeKeyboardDelegate\";\nimport { SelectableTreeProps, useSelectableTree } from \"../useSelectableTree\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\ninterface UseSpeedSearchTreeProps<T>\n  extends SpeedSearchProps,\n    SelectableTreeProps<T> {}\n\nexport function useSpeedSearchTree<T>(\n  props: UseSpeedSearchTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const {\n    containerProps,\n    keyboardDelegate,\n    selectionManager,\n    speedSearch,\n    ...collectionSpeedSearch\n  } = useCollectionSpeedSearch({\n    collection: state.collection,\n    selectionManager: state.selectionManager,\n    stickySearch: props.stickySearch,\n    keyboardDelegate: new TreeKeyboardDelegate(\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    ref,\n    // TODO: maybe allow control over speed search via other props\n  });\n\n  // Speed search is cleared on \"Enter\" key. Alternatively we could wrap onAction and onToggle props\n  // but this seemed more reasonable\n  // NOTE: It may make sense for this behaviour to be pulled up to useCollectionSpeedSearch.\n  const { keyboardProps: speedSearchKeyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (\n        [\"Enter\", \"ArrowLeft\", \"ArrowRight\"].includes(e.key) &&\n        !hasAnyModifier(e)\n      ) {\n        speedSearch.clear();\n      } else {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  const { treeProps, ...selectableTree } = useSelectableTree(\n    { ...props, keyboardDelegate },\n    { ...state, selectionManager },\n    ref\n  );\n\n  return {\n    treeProps: mergeProps(treeProps, containerProps, speedSearchKeyboardProps),\n    ...collectionSpeedSearch,\n    ...selectableTree,\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { StyledList } from \"@intellij-platform/core/List/StyledList\";\n\nexport const StyledTree = styled(StyledList)`\n  background: ${({ theme }) => theme.color(\"Tree.background\")};\n`;\n","import React, { Key, MutableRefObject } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\n\nexport type TreeContextType<T> = {\n  state: TreeState<T>;\n  focused: boolean;\n  onActionRef: MutableRefObject<((key: Key) => void) | undefined>;\n};\n\nexport const TreeContext = React.createContext<TreeContextType<any> | null>(\n  null\n);\n","import { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key, RefObject } from \"react\";\n\nexport class TreeKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  constructor(\n    private collection: Collection<Node<T>>,\n    private disabledKeys: Set<Key>,\n    ref: RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super(collection, disabledKeys, ref, collator);\n  }\n\n  getKeyLeftOf(key: React.Key): React.Key {\n    const item = this.collection.getItem(key);\n    return item.parentKey ?? this.getKeyAbove(key);\n  }\n\n  getKeyRightOf(key: React.Key): React.Key {\n    return this.getKeyBelow(key);\n  }\n}\n","import { LafIcon } from \"../Icon\";\nimport React, { ComponentProps, useMemo } from \"react\";\nimport { styled } from \"../styled\";\n\nexport const TREE_ICON_SIZE = 16;\nconst StyledTreeNodeIcon = styled(LafIcon)`\n  margin-left: -20px;\n  margin-right: 4px;\n  margin-top: -1px; // the svg path seems to have uneven vertical padding. This is to compensate for that.\n  flex-shrink: 0;\n  align-self: center;\n`;\n\ntype TreeNodeIconProps = ComponentProps<typeof StyledTreeNodeIcon> & {\n  selected: boolean;\n  expanded: boolean;\n};\nconst getIcon = (selected: boolean, expanded: boolean) => {\n  const modifiers = { Selected: selected };\n  if (expanded) {\n    return {\n      themePath: selected ? \"Tree.expandedSelectedIcon\" : \"Tree.expandedIcon\",\n      iconPath: { name: \"treeExpanded\", modifiers },\n    };\n  }\n  if (!expanded) {\n    return {\n      themePath: selected ? \"Tree.collapsedSelectedIcon\" : \"Tree.collapsedIcon\",\n      iconPath: { name: \"treeCollapsed\", modifiers },\n    };\n  }\n};\n\nexport function TreeNodeIcon({\n  selected,\n  expanded,\n  ...props\n}: TreeNodeIconProps) {\n  const icon = useMemo(() => getIcon(selected, expanded), [selected, expanded]);\n  return (\n    <StyledTreeNodeIcon\n      icon={icon?.iconPath}\n      themePath={icon?.themePath}\n      size={TREE_ICON_SIZE}\n      {...props}\n    />\n  );\n}\n","import { Key } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { PressProps } from \"@react-aria/interactions\";\n\nexport function useTreeNodeToggleButton<T>({\n  collection,\n  toggleKey,\n  selectionManager,\n  key,\n}: { key: Key } & Pick<\n  TreeState<T>,\n  \"collection\" | \"toggleKey\" | \"selectionManager\"\n>): { treeNodeToggleButtonProps: PressProps } {\n  return {\n    treeNodeToggleButtonProps: {\n      preventFocusOnPress: true,\n      onPress: () => {\n        toggleKey(key);\n\n        // The rest is for deselecting selected descendants and selecting the toggled node, if there\n        // is at least one of such currently selected descendants. This is the exact behavior\n        // of Tree in Intellij Platform, and hence implemented here.\n        const selectedDescendantKeys = [\n          ...selectionManager.selectedKeys,\n        ].filter((key: Key) => {\n          let parentKey = collection.getItem(key)?.parentKey;\n          while (parentKey) {\n            if (parentKey === key) {\n              return true;\n            }\n            parentKey = collection.getItem(parentKey)?.parentKey;\n          }\n          return false;\n        });\n        selectedDescendantKeys.forEach((key) =>\n          selectionManager.toggleSelection(key)\n        );\n        // if any of the descendants are selected\n        if (\n          !selectionManager.isSelected(key) &&\n          selectedDescendantKeys.length > 0\n        ) {\n          selectionManager.toggleSelection(key);\n        }\n      },\n    },\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { TREE_ICON_SIZE } from \"./TreeNodeIcon\";\n\nexport const StyledTreeNode = styled(StyledListItem).attrs({ as: \"div\" })<{\n  level: number;\n}>`\n  // There are some theme properties for tree node padding (theme.ui.Tree.leftChildIndent and\n  // theme.ui.Tree.leftChildIndent), but they doesn't seem to be applicable.\n  padding-left: ${({ level }) => `${(level + 1) * TREE_ICON_SIZE + 8}px`};\n  padding-right: 0.25rem;\n  ${({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"Tree.foreground\" as UnknownThemeProp<\"Tree.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color = theme.asCurrentForeground(\n          theme.color(\n            \"Tree.selectionForeground\" as UnknownThemeProp<\"Tree.selectionForeground\">\n          ) || theme.commonColors.labelSelectedForeground\n        ) /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"Tree.selectionBackground\" as UnknownThemeProp<\"Tree.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"Tree.selectionInactiveForeground\" as UnknownThemeProp<\"Tree.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"Tree.selectionBackgroundInactive\" as UnknownThemeProp<\"Tree.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor,\n      color,\n    };\n  }}\n`;\n","import { usePress } from \"@react-aria/interactions\";\nimport { Node } from \"@react-types/shared\";\nimport React, { useContext, useRef } from \"react\";\nimport { ItemStateContext } from \"../Collections/ItemStateContext\";\nimport { TreeNodeIcon } from \"./TreeNodeIcon\";\nimport { useTreeNode } from \"./useTreeNode\";\nimport { useTreeNodeToggleButton } from \"./useTreeNodeToggleButton\";\nimport { TreeContext } from \"./TreeContext\";\nimport { StyledTreeNode } from \"@intellij-platform/core/Tree/StyledTreeNode\";\n\ntype TreeNodeProps<T> = {\n  item: Node<T>;\n  showAsFocused?: boolean;\n};\n\nexport function TreeNode<T>({ item }: TreeNodeProps<T>) {\n  const ref = useRef(null);\n  const {\n    state: {\n      collection,\n      selectionManager,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n    },\n    focused: containerFocused,\n    onActionRef: { current: onAction },\n  } = useContext(TreeContext)!;\n\n  const isSelected = selectionManager.isSelected(item.key);\n  const expanded = expandedKeys.has(item.key);\n  const isDisabled = disabledKeys.has(item.key);\n\n  const { pressProps: togglePressProps } = usePress({\n    ...useTreeNodeToggleButton({\n      key: item.key,\n      collection,\n      selectionManager,\n      toggleKey,\n    }).treeNodeToggleButtonProps,\n    isDisabled,\n  });\n\n  const { treeNodeProps } = useTreeNode({\n    item,\n    ref,\n    toggleKey,\n    onAction,\n    selectionManager,\n    disabled: isDisabled,\n  });\n\n  /**\n   * NOTE: TreeNode intentionally is not designed in a recursive way for two main reasons:\n   * - Performance\n   * - Better support for virtualization\n   * So instead of rendering TreeNode for childNodes, if the node is expanded, we expect parent\n   * to render children. It's not a layout issue since we don't need any nesting in terms of\n   * layout of nested items. In terms of layout, a tree will be rendered similar to a flat list,\n   * but with more indentation for nested nodes.\n   */\n  return (\n    <>\n      <StyledTreeNode\n        ref={ref}\n        {...treeNodeProps}\n        containerFocused={containerFocused}\n        disabled={isDisabled}\n        selected={isSelected}\n        aria-disabled={isDisabled}\n        aria-selected={isSelected}\n        level={item.level}\n      >\n        {[...item.childNodes].length > 0 && (\n          <TreeNodeIcon\n            selected={isSelected}\n            expanded={expanded}\n            {...togglePressProps}\n          />\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isSelected,\n            isContainerFocused: containerFocused,\n            node: item,\n          }}\n        >\n          {item.rendered}\n        </ItemStateContext.Provider>\n      </StyledTreeNode>\n    </>\n  );\n}\n","import { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { Node } from \"@react-types/shared\";\nimport { Key, RefObject } from \"react\";\n\nexport function useTreeNode<T>({\n  item,\n  ref,\n  selectionManager,\n  disabled,\n  toggleKey,\n  onAction,\n}: {\n  item: Node<T>;\n  ref: RefObject<HTMLElement>;\n  disabled: boolean;\n  toggleKey: (key: Key) => void;\n  onAction?: (key: Key) => void;\n  selectionManager: SelectionManager;\n}) {\n  const {\n    pressProps: { onKeyDown, ...pressProps },\n  } = usePress({\n    ...useSelectableItem({\n      key: item.key,\n      ref,\n      selectionManager,\n      isVirtualized: false,\n    }).itemProps,\n    isDisabled: disabled,\n    preventFocusOnPress: false,\n  });\n\n  const onDoubleClick = () => {\n    if ([...item.childNodes].length > 0) {\n      toggleKey(item.key);\n    } else {\n      onAction?.(item.key);\n    }\n  };\n  const ariaProps = {\n    role: \"treeitem\",\n  };\n\n  return {\n    treeNodeProps: mergeProps(pressProps, { onDoubleClick }, ariaProps),\n  };\n}\n","import React, { Key, RefObject, useMemo, useState } from \"react\";\nimport {\n  DOMProps,\n  KeyboardDelegate,\n  KeyboardEvent,\n  Node,\n} from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { TreeKeyboardDelegate } from \"./TreeKeyboardDelegate\";\nimport { useCollectionAutoScroll } from \"../Collections/useCollectionAutoScroll\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeContextType } from \"./TreeContext\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\nimport { FocusEvents } from \"@react-types/shared/src/events\";\nimport { FocusStrategy } from \"@react-types/shared/src/selection\";\n\nexport interface SelectableTreeProps<T>\n  extends DOMProps,\n    Omit<FocusEvents, \"onFocusChange\"> {\n  isVirtualized?: boolean;\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Called when the action associated with a leaf tree node should be taken.\n   * The exact UI interaction is abstracted away, but it's either Enter key or double click.\n   */\n  onAction?: (key: Key) => void;\n  onNodeKeyDown?: (event: KeyboardEvent, node: Node<T>) => void;\n\n  allowEmptySelection?: boolean;\n\n  autoFocus?: boolean | FocusStrategy;\n\n  showAsFocused?: boolean;\n}\n\n/**\n * NOTE: at the time of writing this hook, react-aria didn't have support for Tree. When useTree is implemented in\n * react-aria, it makes sense to refactor this and use that. There will still be something on top of it here.\n */\nexport function useSelectableTree<T>(\n  {\n    onAction,\n    onFocus,\n    onBlur,\n    autoFocus,\n    showAsFocused,\n    ...props\n  }: SelectableTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const domProps = filterDOMProps(props);\n  const collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n\n  const [focused, setFocused] = useState(false);\n  const {\n    collectionProps: {\n      // preventDefault in onMouseDown prevents collection from getting focused.\n      // Maybe it should be removed from useSelectableCollection, now that it lives here\n      onMouseDown,\n      onKeyDown: selectionKeyDown,\n      ...collectionProps\n    },\n  } = useSelectableCollection({\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    selectOnFocus: true,\n    autoFocus,\n    keyboardDelegate: useMemo(\n      () =>\n        props.keyboardDelegate ||\n        new TreeKeyboardDelegate(\n          state.collection,\n          state.disabledKeys,\n          ref,\n          collator\n        ),\n      [state.collection, state.disabledKeys, props.keyboardDelegate]\n    ),\n  });\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  useCollectionAutoScroll(\n    {\n      isVirtualized: props.isVirtualized,\n      selectionManager: state.selectionManager,\n    },\n    ref\n  );\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    const focusedKey = state.selectionManager.focusedKey;\n    if (focusedKey == null) {\n      event.continuePropagation();\n      return;\n    }\n    const item = state.collection.getItem(focusedKey);\n    const isExpandable = item.hasChildNodes;\n    const expanded = state.expandedKeys.has(focusedKey);\n    const isDisabled = state.disabledKeys.has(focusedKey);\n    if (isDisabled) {\n      event.continuePropagation();\n      return;\n    }\n\n    props?.onNodeKeyDown?.(event, item);\n\n    const shouldToggle =\n      !hasAnyModifier(event) &&\n      (event.key === \"Enter\" ||\n        (event.key === \"ArrowLeft\" && expanded) ||\n        (event.key === \"ArrowRight\" && !expanded));\n\n    if (isExpandable && shouldToggle) {\n      event.preventDefault();\n      state.toggleKey(focusedKey);\n    } else if (event.key === \"Enter\") {\n      onAction?.(focusedKey);\n    } else {\n      // selectionKeyDown currently doesn't report back if it handled the event or not. We could have conditionally\n      // continued propagation if the event was not handled. Then we could change Speed Search impl to only handle\n      // inputs when the propagation is not prevented.\n      // Also, selectionKeyDown is not accurate in handling actions like \"select all\". e.g. it takes 'cmd+shift+a' too,\n      // as select all which can conflict with action system. So we don't call it if there are multiple modifiers.\n      const hasAtMostOneModifier =\n        [event.metaKey, event.ctrlKey, event.shiftKey, event.altKey].filter(\n          (i) => i\n        ).length < 2;\n      if (hasAtMostOneModifier) {\n        selectionKeyDown?.(event);\n      }\n      event.continuePropagation();\n    }\n  };\n  const { keyboardProps } = useKeyboard({\n    onKeyDown,\n  });\n\n  //////////////////////////////// providing context value ////////////////////////////////\n  const onActionRef = useLatest(onAction);\n\n  const {\n    selectionManager,\n    collection,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n  } = state;\n  const treeContext = useMemo<TreeContextType<T>>(\n    () => ({\n      state: {\n        collection,\n        selectionManager,\n        expandedKeys,\n        disabledKeys,\n        toggleKey,\n      },\n      focused: Boolean(focused || showAsFocused),\n      onActionRef,\n    }),\n    [\n      selectionManager,\n      collection,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n      focused,\n      showAsFocused,\n      onActionRef,\n    ]\n  );\n  ////////////////////////////////////////////////////////////////////////////////////////\n\n  return {\n    // order of merging here is important. navigation handling should precede selection handling\n    treeProps: mergeProps(\n      focusWithinProps,\n      collectionProps,\n      keyboardProps,\n      domProps,\n      { onFocus, onBlur, role: \"tree\" }\n    ),\n    treeContext,\n    focused,\n  };\n}\n","//@ts-nocheck\n/**\n * Not exported from @react-stately/tree, but needed in the custom implementation of useTreeState\n */\n\nimport { Key } from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\n\nexport class TreeCollection<T> implements Collection<Node<T>> {\n  private keyMap: Map<Key, Node<T>> = new Map();\n  private iterable: Iterable<Node<T>>;\n  private firstKey: Key;\n  private lastKey: Key;\n\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys?: Set<Key> } = {}\n  ) {\n    this.iterable = nodes;\n    expandedKeys = expandedKeys || new Set();\n\n    let visit = (node: Node<T>) => {\n      this.keyMap.set(node.key, node);\n\n      if (\n        node.childNodes &&\n        (node.type === \"section\" || expandedKeys.has(node.key))\n      ) {\n        for (let child of node.childNodes) {\n          visit(child);\n        }\n      }\n    };\n\n    for (let node of nodes) {\n      visit(node);\n    }\n\n    let last: Node<T>;\n    let index = 0;\n    for (let [key, node] of this.keyMap) {\n      if (last) {\n        last.nextKey = key;\n        node.prevKey = last.key;\n      } else {\n        this.firstKey = key;\n        node.prevKey = undefined;\n      }\n\n      if (node.type === \"item\") {\n        node.index = index++;\n      }\n\n      last = node;\n\n      // Set nextKey as undefined since this might be the last node\n      // If it isn't the last node, last.nextKey will properly set at start of new loop\n      last.nextKey = undefined;\n    }\n\n    this.lastKey = last?.key;\n  }\n\n  *[Symbol.iterator]() {\n    yield* this.iterable;\n  }\n\n  get size() {\n    return this.keyMap.size;\n  }\n\n  getKeys() {\n    return this.keyMap.keys();\n  }\n\n  getKeyBefore(key: Key) {\n    let node = this.keyMap.get(key);\n    return node ? node.prevKey : null;\n  }\n\n  getKeyAfter(key: Key) {\n    let node = this.keyMap.get(key);\n    return node ? node.nextKey : null;\n  }\n\n  getFirstKey() {\n    return this.firstKey;\n  }\n\n  getLastKey() {\n    return this.lastKey;\n  }\n\n  getItem(key: Key) {\n    return this.keyMap.get(key);\n  }\n\n  at(idx: number) {\n    const keys = [...this.getKeys()];\n    return this.getItem(keys[idx]);\n  }\n}\n","import { Node } from \"@react-types/shared\";\nimport { Key } from \"react\";\n\n/**\n * given a node, returns keys of all consecutive single children\n */\nexport function getSingleChildrenKeys<T>(\n  node: Node<T> | null | undefined\n): Key[] {\n  return getSingleChildrenKeysRecursive(node, []);\n}\n\nfunction getSingleChildrenKeysRecursive<T>(\n  node: Node<T> | null | undefined,\n  previousKeys: Key[]\n): Key[] {\n  if (!node) {\n    return [];\n  }\n  const childNodesIterator: Iterator<\n    Node<T>,\n    Node<T> | undefined\n  > = node.childNodes[Symbol.iterator]();\n  const { value: firstChild, done } = childNodesIterator.next();\n  const noMoreChildren = done || childNodesIterator.next().value == null;\n  if (firstChild != null && noMoreChildren && isExpandable(firstChild)) {\n    return getSingleChildrenKeysRecursive(\n      firstChild,\n      previousKeys.concat((firstChild as Node<T>).key)\n    );\n  }\n  return previousKeys;\n}\n\nconst isExpandable = <T>(node: Node<T>) =>\n  node.hasChildNodes || !isEmptyIterable(node.childNodes);\n\nfunction isEmptyIterable(iterable: Iterable<unknown> | undefined | null) {\n  for (const _ of iterable || []) {\n    // eslint-disable-line no-unused-vars, no-unreachable-loop\n    return false;\n  }\n  return true;\n}\n","import {\n  MultipleSelectionState,\n  SelectionManager,\n  SelectionManagerOptions,\n} from \"@react-stately/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key } from \"react\";\n\nexport class TreeSelectionManager extends SelectionManager {\n  private readonly collection: Collection<Node<unknown>>;\n\n  constructor(\n    collection: Collection<Node<unknown>>,\n    state: MultipleSelectionState,\n    options?: SelectionManagerOptions\n  ) {\n    super(collection, state, options);\n    this.collection = collection;\n  }\n\n  expandSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      const { expandKeys } = this.getExpandAndShrinkKeys(node);\n      if (expandKeys.length > 0) {\n        this.setSelectedKeys([...this.selectedKeys, ...expandKeys]);\n      }\n    }\n  }\n  shrinkSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      const { shrinkKeys } = this.getExpandAndShrinkKeys(node);\n      if (shrinkKeys.length > 0) {\n        this.setSelectedKeys(\n          [...this.selectedKeys].filter((key) => !shrinkKeys.includes(key))\n        );\n      }\n    }\n  }\n\n  private getExpandAndShrinkKeys(node: Node<unknown>) {\n    return this.recursivelyGetExpandAndShrinkKeys(\n      node,\n      [...this.collection.getKeys()],\n      null\n    );\n  }\n  /**\n   * Starting from a node, traverses the tree up, until it reaches the root of the fully selected subtree that includes\n   * the starting node. The root itself may or may not be selected. Returns:\n   * - keys to be added to selection, when expanding selection\n   * - keys to be removed from selection, when shrinking selection\n   */\n  private recursivelyGetExpandAndShrinkKeys(\n    node: Node<unknown>,\n    keys: Array<Key>,\n    previousChild: Key | null\n  ): { expandKeys: Key[]; shrinkKeys: Key[] } {\n    const parent =\n      node && node.parentKey ? this.collection.getItem(node.parentKey) : null;\n    const newKeys = keys.filter((key) => key !== previousChild);\n    const parentDescendants = parent\n      ? getAllDescendants(parent, newKeys).map(({ key }) => key)\n      : this.getAllRoots().flatMap((key) =>\n          key !== node.key\n            ? getAllDescendants(this.collection.getItem(key), newKeys)\n                .map(({ key }) => key)\n                .concat(key)\n            : []\n        );\n    if (parent && parentDescendants.every((key) => this.isSelected(key))) {\n      return this.recursivelyGetExpandAndShrinkKeys(parent, keys, node.key);\n    }\n    const descendants = getAllDescendants(\n      node,\n      keys.filter((key) => key !== previousChild)\n    ).map(({ key }) => key);\n\n    return {\n      expandKeys: descendants.some((key) => !this.isSelected(key))\n        ? descendants\n        : !this.isSelected(node.key)\n        ? [node.key]\n        : parentDescendants,\n      shrinkKeys:\n        parentDescendants.length > 0 &&\n        parentDescendants.every((key) => this.isSelected(key))\n          ? parentDescendants\n          : this.isSelected(node.key) && previousChild\n          ? [node.key]\n          : descendants.filter((key) => this.isSelected(key)),\n    };\n  }\n\n  private getAllRoots() {\n    return [...this.collection.getKeys()].filter(\n      (key) => this.collection.getItem(key).parentKey == null\n    );\n  }\n}\n\nfunction getAllDescendants<T>(\n  node: Node<T>,\n  stopKeys: Array<React.Key>\n): Node<T>[] {\n  const childNodes = (node.hasChildNodes ? [...node.childNodes] : []).filter(\n    (node) => stopKeys.includes(node.key)\n  );\n  return node.hasChildNodes\n    ? childNodes.concat(\n        childNodes.map((node) => getAllDescendants(node, stopKeys)).flat()\n      )\n    : [];\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { TreeProps as _TreeProps, TreeState } from \"@react-stately/tree\";\nimport {\n  TreeRefValue,\n  useTreeRef,\n} from \"@intellij-platform/core/Tree/useTreeRef\";\nimport { ForwardedRef, Key, useEffect, useMemo } from \"react\";\nimport { useMultipleSelectionState } from \"@react-stately/selection\";\nimport { useCollection } from \"@react-stately/collections\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  CollectionCacheInvalidationProps,\n  useCollectionCacheInvalidation,\n} from \"@intellij-platform/core/Collections/useCollectionCacheInvalidation\";\nimport { TreeCollection as _TreeCollection } from \"./__copied__TreeCollection\";\nimport { getSingleChildrenKeys } from \"./getSingleChildrenKeys\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport class TreeCollection<T> extends _TreeCollection<T> {\n  public readonly rootKeys: Key[];\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys: Set<Key> }\n  ) {\n    super(nodes, { expandedKeys });\n    this.rootKeys = Array.from(nodes).map(({ key }) => key);\n  }\n\n  getAllExpandableKeys(): Set<Key> {\n    const rootNodes = this.rootKeys\n      .map((key) => this.getItem(key))\n      .filter(notNull);\n    return this.recursivelyAddExpandableKeys(rootNodes, new Set<Key>());\n  }\n\n  private recursivelyAddExpandableKeys(\n    nodes: Iterable<Node<T>>,\n    result: Set<Key>\n  ) {\n    for (const node of nodes) {\n      if (node?.hasChildNodes) {\n        result.add(node.key);\n        this.recursivelyAddExpandableKeys(node.childNodes, result);\n      }\n    }\n    return result;\n  }\n}\nexport interface TreeProps<T>\n  extends _TreeProps<T>,\n    CollectionCacheInvalidationProps {\n  childExpansionBehaviour?: \"multi\" | \"single\";\n}\n/**\n * Provides state management for tree-like components. Handles building a collection\n * of items from props, item expanded state, and manages multiple selection state.\n *\n * Similar to (and initially copied from) useTreeState from @react-stately/tree, but with the following changes:\n * - Supports exposing some imperative API via ref.\n *   Could be done via a wrapper too.\n * - Different onToggle implementation with two adjustments to match Intellij Platform:\n *   - Collapsing a key collapses all descendants as well.\n *   - Expanding a single-child node will recursively expand all single-child descendants.\n *   Couldn't be done with a wrapper in a clean and optimal way. Access to setExpandedKey is not provided. We would need\n *   to either maintain a new state for expanded keys and ignore the one returned from the wrapped hook, or\n *   inefficiently call the returned `toggleKey` function many times.\n * - Supports collection invalidation via CollectionCacheInvalidationProps\n *   Perhaps not the most important addition, but not possible to be done via a wrapper.\n * - Uses TreeSelectionManager instead of the default SelectionManager, which implements expand/shrink selection.\n *   Could be done in a wrapper, with a little hack. Would need to replace selection manager.\n * - returned `collection` is of type `TreeCollection` (which is an improved version of react-stately `TreeCollection`),\n *   instead of the more generic `Collection`.\n */\nexport function useTreeState<T extends object>(\n  { childExpansionBehaviour = \"multi\", ...props }: TreeProps<T>,\n  treeRef?: ForwardedRef<TreeRefValue>\n): TreeState<T> {\n  let [expandedKeys, setExpandedKeys] = useControlledState(\n    props.expandedKeys ? new Set(props.expandedKeys) : undefined!,\n    props.defaultExpandedKeys ? new Set(props.defaultExpandedKeys) : new Set(),\n    props.onExpandedChange!\n  );\n\n  let selectionState = useMultipleSelectionState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  let disabledKeys = useMemo(\n    () => (props.disabledKeys ? new Set(props.disabledKeys) : new Set<Key>()),\n    [props.disabledKeys]\n  );\n\n  const context = useCollectionCacheInvalidation(props);\n\n  // @ts-expect-error imprecise typing in @react-stately/selection\n  let tree = useCollection<T, TreeCollection<T>>(\n    props,\n    (nodes) => new TreeCollection(nodes, { expandedKeys }),\n    context,\n    [expandedKeys]\n  );\n\n  const selectionManager = new TreeSelectionManager(\n    tree as Collection<Node<T>>,\n    selectionState\n  );\n\n  useTreeRef({ selectionManager, setExpandedKeys, tree }, treeRef);\n\n  // Reset focused key if that item is deleted from the collection.\n  useEffect(() => {\n    if (\n      selectionState.focusedKey != null &&\n      !tree.getItem(selectionState.focusedKey)\n    ) {\n      // @ts-expect-error imprecise typing in @react-stately/selection\n      selectionState.setFocusedKey(null);\n    }\n  }, [tree, selectionState.focusedKey]);\n\n  const toggleKey = (key: Key) => {\n    let newExpandedKeys = toggleTreeNode(\n      tree as Collection<Node<T>>,\n      expandedKeys,\n      key\n    );\n    if (childExpansionBehaviour === \"single\") {\n      const expandedSiblings = getSiblings(tree, key).filter(\n        (aKey) => aKey !== key && expandedKeys.has(aKey)\n      );\n      newExpandedKeys = expandedSiblings.reduce((expandedKeys, expandedKey) => {\n        return toggleTreeNode(\n          tree as Collection<Node<T>>,\n          expandedKeys,\n          expandedKey\n        );\n      }, newExpandedKeys);\n    }\n    setExpandedKeys(newExpandedKeys);\n  };\n\n  return {\n    collection: tree as Collection<Node<T>>,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n    selectionManager,\n  };\n}\n\nfunction getChildItems<T>(node: Node<T>): Node<T>[] {\n  const childNodes = [...(node.childNodes || [])];\n  const childItems = childNodes.filter(({ type }) => type === \"item\");\n  const sectionItems = childNodes.filter(({ type }) => type === \"section\");\n\n  return childItems.concat(sectionItems.flatMap(getChildItems));\n}\n\nfunction getRootItemKeys(tree: TreeCollection<unknown>) {\n  return tree.rootKeys\n    .map((key) => tree.getItem(key))\n    .filter(notNull)\n    .flatMap(getChildItems)\n    .map(({ key }) => key);\n}\n/**\n * Returns the siblings of an item in tree, ignoring sections.\n * Disclaimer: The code is done quick and dirty and in a rush. Unpleasant code, good candidate for refactoring :D\n */\nfunction getSiblings(tree: TreeCollection<unknown>, key: Key): Key[] {\n  const parentKey = tree.getItem(key)?.parentKey;\n  if (!parentKey) {\n    return [...tree.rootKeys].concat(getRootItemKeys(tree));\n  }\n  let parent = parentKey ? tree.getItem(parentKey) : null;\n  if (parent?.type === \"item\") {\n    return getChildItems(parent).map(({ key }) => key);\n  }\n  const siblings: Key[] = [];\n  while (parent) {\n    siblings.push(...getChildItems(parent).map(({ key }) => key));\n    if (parent.type === \"section\") {\n      if (parent.parentKey) {\n        parent = tree.getItem(parent.parentKey);\n      } else {\n        siblings.push(...getRootItemKeys(tree));\n        parent = null;\n      }\n    } else {\n      parent = null;\n    }\n  }\n  return Array.from(new Set(siblings));\n}\nfunction toggleTreeNode(\n  tree: Collection<Node<unknown>>,\n  expandedKeys: Set<Key>,\n  key: Key\n): Set<Key> {\n  // toggling a non-expandable node should be no-op\n  if (!expandedKeys.has(key) && !tree.getItem(key).hasChildNodes) {\n    return expandedKeys;\n  }\n  const newKeys = toggleKey(expandedKeys, key);\n  // In Intellij impl, when a node is collapsed, all descendants are also collapsed. In other words, keys that are\n  // not a part of the list of visible nodes, will be excluded from the expanded keys, with the toggle action.\n  for (const aKey of newKeys) {\n    if (tree.getItem(aKey) == null) {\n      newKeys.delete(aKey);\n    }\n  }\n\n  // If we are toggling it open, expand all expandable single-child items\n  if (newKeys.has(key)) {\n    for (const aKey of getSingleChildrenKeys(tree.getItem(key))) {\n      newKeys.add(aKey);\n    }\n  }\n  return newKeys;\n}\n\nfunction toggleKey(set: Set<Key>, key: Key): Set<Key> {\n  let res = new Set(set);\n  if (res.has(key)) {\n    res.delete(key);\n  } else {\n    res.add(key);\n  }\n\n  return res;\n}\n","import { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { CacheInvalidationContext } from \"./Item\";\n\nexport interface CollectionCacheInvalidationProps {\n  /**\n   * Defines cache invalidation policy for items. By default, the render result is cached based on the item objects.\n   * This is equivalent of passing false or not passing anything for `cacheInvalidation`. If `true` is passed, it will\n   * always invalidate the render result, causing the collection to be recreated on each re-render. It can\n   * considerably affect performance in large collections. in addition to boolean value, an object with the list of\n   * invalidators can also be passed. renderer function is called each time any of the invalidators are changed.\n   * Think of it as [dependency array in react hooks](https://reactjs.org/docs/hooks-reference.html#usememo). Except\n   * that the length of the array can also safely change.\n   */\n  cacheInvalidation?: boolean | { invalidators: ReadonlyArray<unknown> };\n}\n\n/**\n * Allows cache invalidation options based on input props, for components that use collection\n */\nexport const useCollectionCacheInvalidation = ({\n  cacheInvalidation,\n}: CollectionCacheInvalidationProps): CacheInvalidationContext => {\n  const invalidators =\n    typeof cacheInvalidation === \"object\" ? cacheInvalidation.invalidators : [];\n  const lastInvalidators = usePrevious(invalidators);\n\n  const invalidated =\n    typeof cacheInvalidation === \"object\"\n      ? cacheInvalidation.invalidators.length !== lastInvalidators.length ||\n        cacheInvalidation.invalidators.some(\n          (anInvalidator, index) => anInvalidator !== lastInvalidators[index]\n        )\n      : cacheInvalidation;\n\n  return {\n    invalidated,\n  };\n};\n","import { ForwardedRef, Key, useImperativeHandle } from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeSelectionManager } from \"./TreeSelectionManager\";\nimport { TreeCollection } from \"./useTreeState\";\n\nexport interface TreeRefValue {\n  focus(key: Key): void;\n  replaceSelection(key: Key): void;\n\n  /**\n   * Extends selection to all siblings of the currently focused node.\n   */\n  expandSelection(): void;\n  /**\n   * Shrinks selection towards currently focused node.\n   */\n  shrinkSelection(): void;\n\n  expandAll(): void;\n  collapseAll(): void;\n}\n\n/**\n * Sets up a tree ref for imperatively working with tree from outside. For imperatively focusing, expanding to\n * specific key, etc.\n */\nexport function useTreeRef<T extends {}>(\n  props: {\n    tree: TreeCollection<T>;\n    selectionManager: TreeSelectionManager;\n    setExpandedKeys: (keys: Set<Key>) => void;\n  },\n  forwardedRef?: ForwardedRef<TreeRefValue>\n) {\n  const latestState = useLatest(props);\n\n  useImperativeHandle(\n    forwardedRef,\n    () => {\n      return {\n        replaceSelection: (key: Key) => {\n          latestState.current.selectionManager.replaceSelection(key);\n        },\n        focus: (key: Key) => {\n          const selectionManager = latestState.current.selectionManager;\n          selectionManager.setFocused(true);\n          /**\n           * NOTE: we set focus key to null and set it to key again, to make sure scroll into view works even when\n           * the key is currently focused but not in view. It wouldn't be needed if there was an imperative handle\n           * for scrolling an item into view, but it's only implemented in way that is reactive to changes to the\n           * focused key. {@see useCollectionAutoScroll}\n           */\n          // @ts-expect-error: setFocusedKey typing mistakenly doesn't accept null, while it should\n          selectionManager.setFocusedKey(null);\n          setTimeout(() => {\n            selectionManager.setFocusedKey(key);\n          });\n        },\n        expandSelection() {\n          latestState.current.selectionManager.expandSelection();\n        },\n        shrinkSelection() {\n          latestState.current.selectionManager.shrinkSelection();\n        },\n        expandAll() {\n          latestState.current.setExpandedKeys(\n            latestState.current.tree.getAllExpandableKeys()\n          );\n        },\n        collapseAll() {\n          const { tree, setExpandedKeys, selectionManager } =\n            latestState.current;\n          const focusedKey = selectionManager.focusedKey;\n          setExpandedKeys(new Set());\n\n          // Find the root node that is a grandparent of focused node, and focus/select it.\n          // NOTE: this behaviour of updating selection when nodes are collapsed is something to be fixed in general,\n          // and then this custom logic here would be not necessary.\n          if (focusedKey && !tree.rootKeys.includes(focusedKey)) {\n            let item = tree.getItem(focusedKey);\n            while (item?.parentKey != null) {\n              item = tree.getItem(item.parentKey);\n            }\n            if (item) {\n              selectionManager.setFocusedKey(item.key);\n              if (selectionManager.isSelected(focusedKey)) {\n                selectionManager.select(item.key);\n              }\n            }\n          }\n        },\n      };\n    },\n    []\n  );\n}\n","import { LayoutNode, ListLayout } from \"@react-stately/layout\";\nimport React, { Key } from \"react\";\nimport { InvalidationContext, Rect, Size } from \"@react-stately/virtualizer\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Extends `ListLayout` and allows items of the list to have width based on the content. `ListLayout` by default\n * sets width based on the virtualizer's visible rect. This means the overflow of list items will be clipped.\n * In `VariableWidthListLayout`, the width of the list depends on the content of the visible items.\n *\n * NOTE: At the time of writing this class, Virtualization in @react-aria and @react-stately don't have proper\n * documentation, and it wasn't clear if there could be better ways of letting list's width grow based on the content.\n * Also, this implementation currently lacks support for sections. `buildSection()` would most probably need to be\n * overridden like how `buildItem` is.\n */\nexport class VariableWidthListLayout<T> extends ListLayout<T> {\n  /**\n   * content width of items are stored here, if the content width is bigger than the Virtualizer's visible rect's width.\n   */\n  keyToWidth = new Map<Key, number>();\n  private visibleContentWidth: number = 0;\n\n  buildItem(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildItem(node, x, y);\n    if (this.visibleContentWidth) {\n      layoutNode.layoutInfo.rect.width = this.visibleContentWidth;\n    }\n    return layoutNode;\n  }\n\n  buildCollection(): LayoutNode[] {\n    this.visibleContentWidth = this.getVisibleContentWidth();\n    // in buildChild, if invalidateEverything is false and y is not changed, it will reuse the existing layoutInfo.\n    // which can be problematic, if it was created in a time when the visible content width was different.\n    // A more efficient approach (instead of rebuilding the whole collection), might be to set layout width to\n    // visibleContentWidth, in getVisibleLayoutInfos, if mutation is ok.\n    // UPDATE: using getFinalLayoutInfo seems to be a legitimate last minute way to mutate layout infos.\n    this.invalidateEverything =\n      this.contentSize?.width !== this.visibleContentWidth;\n    const layoutNodes = super.buildCollection();\n    this.contentSize.width = this.visibleContentWidth;\n    return layoutNodes;\n  }\n\n  shouldInvalidate(newRect: Rect, oldRect: Rect): boolean {\n    return (\n      super.shouldInvalidate(newRect, oldRect) ||\n      this.getVisibleContentWidth() !== this.visibleContentWidth\n    );\n  }\n\n  // Setting lastWidth doesn't seem to be important, but we set it based on the content anyway.\n  validate(invalidationContext: InvalidationContext<Node<T>, unknown>) {\n    super.validate(invalidationContext);\n    this.lastWidth = this.contentSize.width;\n  }\n\n  updateItemSize(key: React.Key, size: Size): boolean {\n    const changed = super.updateItemSize(key, size);\n    const layoutInfo = this.layoutInfos.get(key);\n    if (layoutInfo && size.width > this.contentSize.width) {\n      this.keyToWidth.set(key, size.width);\n      return true;\n    } else {\n      this.keyToWidth.delete(key);\n      return changed;\n    }\n  }\n\n  private getVisibleContentWidth() {\n    return Math.max(\n      this.virtualizer.visibleRect.width,\n      ...this.virtualizer.visibleViews.map((view) => {\n        const layoutInfo = view.layoutInfo;\n        const itemContentWidth =\n          layoutInfo && this.keyToWidth.get(layoutInfo.key);\n        if (\n          itemContentWidth &&\n          layoutInfo.rect.intersects(this.virtualizer.getVisibleRect())\n        ) {\n          return itemContentWidth;\n        }\n        return 0;\n      })\n    );\n  }\n}\n","import React, { HTMLAttributes, useMemo } from \"react\";\nimport { LayoutNode } from \"@react-stately/layout\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { VirtualizerProps } from \"@react-aria/virtualizer\";\nimport { LayoutInfo, Rect } from \"@react-stately/virtualizer\";\nimport { VariableWidthListLayout } from \"@intellij-platform/core/VariableWidthListLayout\";\n\nclass FlattenedTreeLayout<T> extends VariableWidthListLayout<T> {\n  buildChild(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildChild(node, x, y);\n    if (\n      node.parentKey &&\n      this.collection.getItem(node.parentKey)?.type === \"item\"\n    ) {\n      layoutNode.layoutInfo.parentKey = null;\n    }\n    return layoutNode;\n  }\n\n  getVisibleLayoutInfos(rect: Rect): LayoutInfo[] {\n    return super\n      .getVisibleLayoutInfos(rect)\n      .filter((layoutInfo) => this.collection.getItem(layoutInfo.key) != null);\n  }\n}\n\nexport const useTreeVirtualizer = <T extends object>({\n  state,\n}: {\n  state: TreeState<T>;\n}): {\n  virtualizerProps: Omit<\n    VirtualizerProps<any, unknown>,\n    \"children\" | keyof HTMLAttributes<HTMLElement>\n  >;\n} => {\n  const layout = useMemo(\n    () =>\n      new FlattenedTreeLayout({\n        /**\n         * there is currently no documentation available for these fields, but setting `rowHeight` enforces it, which\n         * wouldn't be good for custom tree UI with a different row height.\n         * wrong estimatedRowHeight seems to only affect small scrollbar position inaccuracy, which is a minor issue\n         * and not even noticeable in most cases. Also, it seems it slightly improves the performance if it exactly\n         * matches the real row height. But not even sure.\n         */\n        estimatedRowHeight: 20,\n      }),\n    []\n  );\n  layout.collection = state.collection;\n  layout.disabledKeys = state.disabledKeys;\n\n  return {\n    virtualizerProps: {\n      focusedKey: state.selectionManager.focusedKey,\n      collection: state.collection,\n      layout,\n      // Not clear how this sizeToFit is supposed to work, due to lack of documentation, but don't be tempted to\n      // think it solves the problem VariableWidthListLayout is trying to solve, because it doesn't :D\n      // Also, note that setting this to \"width\" prevents re-layout when container width is increased, which\n      // causes issues.\n      sizeToFit: \"height\",\n      scrollToItem: (key) => {\n        return layout.virtualizer.scrollToItem(key, {\n          shouldScrollX: false,\n          duration: 0,\n        });\n      },\n      scrollDirection: \"both\",\n    },\n  };\n};\n","import React, { RefObject } from \"react\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TreeRefValue } from \"@intellij-platform/core/Tree\";\n\n/**\n * Returns action definitions object for common tree actions\n * TODO: add example in docs\n */\nexport function useTreeActions({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): Array<ActionDefinition> {\n  return [\n    {\n      id: CommonActionId.EXPAND_ALL,\n      title: \"Expand All\",\n      icon: <PlatformIcon icon=\"actions/expandall\" />,\n      actionPerformed: () => {\n        treeRef.current?.expandAll();\n      },\n    },\n    {\n      id: CommonActionId.COLLAPSE_ALL,\n      title: \"Collapse All\",\n      icon: <PlatformIcon icon=\"actions/collapseall\" />,\n      actionPerformed: () => {\n        treeRef.current?.collapseAll();\n      },\n    },\n    {\n      id: CommonActionId.EXPAND_SELECTION,\n      title: \"Expand Selection\",\n      actionPerformed: () => {\n        treeRef.current?.expandSelection();\n      },\n    },\n    {\n      id: CommonActionId.SHRINK_SELECTION,\n      title: \"Shrink Selection\",\n      // TODO: disable if selection is only one item. Would need more data from treeRef. Maybe after treeRef is refactored\n      //  to implement/extend CollectionRef\n      actionPerformed: () => {\n        treeRef.current?.shrinkSelection();\n      },\n    },\n  ];\n}\n","import { Key } from \"react\";\n\ninterface SetState<T> {\n  items: Iterable<T>;\n\n  toggle(key: T): void;\n\n  add(...key: T[]): void;\n\n  delete(...key: T[]): void;\n}\n\nexport type SelectionState = \"NotSelected\" | \"Selected\" | \"PartiallySelected\";\n\nexport interface TreeModel<T, K = Key> {\n  rootNodes: ReadonlyArray<T>;\n  getChildren: (root: T) => ReadonlyArray<T> | /*for convenience*/ T | null;\n  getKey: (item: T) => K;\n}\n\nexport interface NestedSelectionState<T> {\n  getSelectionState: (item: T) => SelectionState;\n  toggle: (item: T) => void;\n}\n\nconst collectSelectableItems = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>\n) => {\n  const collectedItems: T[] = [];\n  collectSelectableItemsRecursive(item, getChildren, collectedItems);\n  return collectedItems;\n};\nconst collectSelectableItemsRecursive = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>,\n  collectedItems: T[] = []\n) => {\n  const children = getChildren(item);\n  if (children == null) {\n    collectedItems.push(item);\n  } else {\n    children.forEach((child) =>\n      collectSelectableItemsRecursive(child, getChildren, collectedItems)\n    );\n  }\n};\n\n// TODO: maybe change the interface to work with keys instead of items?\nexport class NestedSelection<T extends object, K = Key>\n  implements NestedSelectionState<T>\n{\n  cache = new WeakMap<T, SelectionState>();\n  constructor(private state: SetState<K>, private tree: TreeModel<T, K>) {\n    this.tree = tree;\n    this.state = state;\n  }\n\n  toggle(item: T) {\n    const children = this.tree.getChildren(item);\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    if (isSelectableNode) {\n      this.state.toggle(key);\n    } else {\n      const state = this.getSelectionState(item);\n      const itemsInSubtree = collectSelectableItems(item, (item) =>\n        normalizeChildren(this.tree.getChildren(item))\n      ).map(this.tree.getKey);\n      if (state === \"Selected\") {\n        this.state.delete(...itemsInSubtree);\n      } else {\n        this.state.add(...itemsInSubtree);\n      }\n    }\n  }\n\n  getSelectionState(item: T): SelectionState {\n    // caching can be refactored into a nice little decorator like WeakMapCached which would be applicable on a method\n    // with a single object argument.\n    const cachedState = this.cache.get(item);\n    if (cachedState) {\n      return cachedState;\n    }\n    const children = normalizeChildren(this.tree.getChildren(item));\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    let state: SelectionState;\n    if (isSelectableNode) {\n      state = [...this.state.items].includes(key) ? \"Selected\" : \"NotSelected\";\n    } else {\n      const allDescendantsStates = children.map((child) =>\n        this.getSelectionState(child)\n      );\n      if (allDescendantsStates.every((state) => state === \"NotSelected\")) {\n        state = \"NotSelected\";\n      } else {\n        state = allDescendantsStates.every((state) => state === \"Selected\")\n          ? \"Selected\"\n          : \"PartiallySelected\";\n      }\n    }\n    this.cache.set(item, state);\n    return state;\n  }\n}\n\nfunction normalizeChildren<T>(children: T | ReadonlyArray<T> | null) {\n  if (children) {\n    return ([] as ReadonlyArray<T>).concat(children);\n  }\n  return null;\n}\n","import React, { ForwardedRef } from \"react\";\nimport {\n  SpeedSearchTree,\n  SpeedSearchTreeProps,\n  TreeRefValue,\n} from \"@intellij-platform/core/Tree\";\nimport { NestedSelectionState } from \"./NestedSelection\";\n\n/**\n * Experimental wrapper component around SpeedSearchTree, which allows rendering {@link TreeNodeCheckbox} in nodes.\n *\n * See [design-decisions.md](../Tree/design-decisions.md) for more thoughts about how should different features\n * like this be supported.\n *\n * @alpha\n */\nexport const SpeedSearchTreeWithCheckboxes = React.forwardRef(\n  <T extends object>(\n    {\n      nestedSelection,\n      cacheInvalidation,\n      onNodeKeyDown,\n      ...props\n    }: SpeedSearchTreeProps<T> & {\n      nestedSelection: NestedSelectionState<T>;\n    },\n    ref: ForwardedRef<HTMLDivElement>\n  ): React.ReactElement => {\n    const otherInvalidators =\n      typeof cacheInvalidation === \"object\"\n        ? cacheInvalidation.invalidators\n        : [];\n    return (\n      <SpeedSearchTree\n        ref={ref}\n        {...props}\n        // instead of passing cacheInvalidation, a better approach could be to provide nestedSelection as context.\n        cacheInvalidation={{\n          invalidators: [nestedSelection, ...otherInvalidators],\n        }}\n        onNodeKeyDown={(event, item) => {\n          if (event.key === \" \") {\n            nestedSelection.toggle(item.value);\n          }\n          onNodeKeyDown?.(event, item);\n        }}\n      />\n    );\n  }\n);\n","import React, { useContext } from \"react\";\nimport { Checkbox } from \"@intellij-platform/core/Checkbox\";\nimport { TreeContext } from \"@intellij-platform/core/Tree/TreeContext\";\nimport { SelectionState } from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport styled from \"styled-components\";\n\nexport type TreeNodeCheckboxProps<T extends unknown> = {\n  selectionState?: SelectionState;\n  selectItemOnPress?: boolean;\n  onToggle: () => void;\n  // maybe a isDisabled prop to be merged with isDisabled from the item?\n};\n\nconst StyledCheckboxWrapper = styled.span`\n  margin-right: 0.125rem;\n  display: inline-flex;\n`;\n\n/**\n * Checkbox to be used with {@link SpeedSearchTreeWithCheckboxes}. `SpeedSearchTreeWithCheckboxes` doesn't add the\n * checkboxes by default to the nodes, which makes it more flexible in terms of which nodes should have checkbox, or\n * it's exact placement within the tree rows.\n *\n * TreeNodeCheckbox renders a Checkbox with a few extras:\n * - `aria-label` set based on the encompassing item's textValue\n * - `isSelected` and `isIndeterminate` set based on `selectionState`\n * - `isDisabled` is set based in disabled state of the item.\n * - The encompassing item will be selected upon press, if `selectItemOnPress` is `true` (default is `true`).\n * - Small styling adjustment achieved by a wrapper StyledListIconWrapper.\n *\n * @see SpeedSearchTreeWithCheckboxes\n * @see useNestedSelectionState\n *\n * NOTE: this component currently uses TreeContext, to get a hold of selectionManager. If a more abstract component\n * like CollectionCheckbox is needed in the future, we can refactor TreeContext also to something more abstract like\n * CollectionContext which is provided by all such components like List, Tree or Table.\n */\nexport const TreeNodeCheckbox = <T extends unknown>({\n  selectionState,\n  onToggle,\n  selectItemOnPress = true,\n}: TreeNodeCheckboxProps<T>) => {\n  const treeContext = useContext(TreeContext);\n  const itemContext = useContext(ItemStateContext);\n  if (!itemContext) {\n    throw new Error(\"TreeNodeCheckbox is rendered outside tree nodes.\");\n  }\n\n  return (\n    <StyledCheckboxWrapper>\n      <Checkbox\n        preventFocus\n        aria-label={`Select ${itemContext.node.textValue}`}\n        isSelected={selectionState === \"Selected\"}\n        isIndeterminate={selectionState === \"PartiallySelected\"}\n        isDisabled={itemContext.isDisabled}\n        onChange={() => {\n          onToggle();\n          // this if and the whole need for treeContext could be avoided if event.stopPropagation() was not hard coded\n          // in useToggle: https://github.com/adobe/react-spectrum/blob/0d007bca9417c4b7b86fafd5842871bf997bd4c0/packages/@react-aria/toggle/src/useToggle.ts#L46\n          // An improvement could be to replace Checkbox with CheckboxIcon, and simply handle press on it (potential TODO)\n          if (treeContext && itemContext && selectItemOnPress) {\n            treeContext.state.selectionManager.setFocusedKey(\n              itemContext.node.key\n            );\n            treeContext.state.selectionManager.setFocused(true);\n            treeContext.state.selectionManager.setSelectedKeys([\n              itemContext.node.key,\n            ]);\n          }\n        }}\n      />\n    </StyledCheckboxWrapper>\n  );\n};\n","import { Key, useMemo } from \"react\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { useControllableSet } from \"@intellij-platform/core/utils/useSet\";\nimport {\n  NestedSelection,\n  NestedSelectionState,\n  TreeModel,\n} from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\n\n/**\n * A state management util for a selectable list of items with an arbitrary nested grouping. In other words,\n * it manages selection of leaves in a tree.\n *\n * tree is represented as a `getChildren` function that returns children for a given root. if null is passed it\n * returns the top level nodes.\n * Important Note: the tree structure that can be generated by calling `getChildren` function is supposed to be\n * **immutable**. in other words, any change in the tree, should result in a new array of top level items.\n */\n\nexport const useNestedSelectionState = <T extends object, K = Key>(\n  tree: TreeModel<T, K>,\n  {\n    selectedKeys: selectedKeysProp,\n    defaultSelectedKeys,\n    onSelectedKeysChange,\n  }: ControlledStateProps<{\n    selectedKeys: Set<K>;\n  }>\n): NestedSelectionState<T> => {\n  const [selectedKeys, selectedKeysSetter] = useControllableSet(\n    selectedKeysProp!, // bad typing in useControlledState\n    defaultSelectedKeys || new Set(),\n    onSelectedKeysChange! // bad typing in useControlledState\n  );\n  const treeRef = useLatest(tree);\n\n  return useMemo(\n    () =>\n      new NestedSelection<T, K>(\n        { items: selectedKeys, ...selectedKeysSetter },\n        treeRef.current\n      ),\n    [selectedKeys, tree.rootNodes]\n  );\n};\n","export function isWordSeparator(c: string) {\n  return (\n    isWhitespace(c) || c == \"_\" || c == \"-\" || c == \":\" || c == \"+\" || c == \".\"\n  );\n}\n\nexport function isWhitespace(char: string): boolean {\n  return /^\\s*$/.test(char);\n}\n\nexport function isUpperCase(str: string) {\n  return str.toUpperCase() === str && str.toLowerCase() !== str;\n}\n","import { createRangesFromIndices, TextRange } from \"./TextRange\";\nimport {\n  isUpperCase,\n  isWhitespace,\n  isWordSeparator,\n} from \"./utils/string-utils\";\n\nfunction isMeaningfulChar(ch: string) {\n  return !isWordSeparator(ch) && !isWhitespace(ch);\n}\n\n// Simplified version of https://github.com/JetBrains/intellij-community/blob/master/platform/util/text-matching/src/com/intellij/psi/codeStyle/MinusculeMatcherImpl.java\nexport const minusculeMatch = (\n  input: string,\n  rawPattern: string\n): Array<TextRange> | null => {\n  const isStarts = input.split(\"\").map(isStart);\n  const pattern = rawPattern.split(\"\").filter(isMeaningfulChar).join(\"\");\n  const matches: Array<{ patternIndex: number; inputIndex: number }> = [];\n  let continuous = false;\n  let inputIndex = 0,\n    patternIndex = 0;\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    if (matches.length === pattern.length) {\n      return createRangesFromIndices(matches.map(({ inputIndex: i }) => i));\n    }\n    if (inputIndex > input.length - 1) {\n      if (matches.length > 0) {\n        // TODO: the same character match can be popped out and in several times, if something\n        //  is popped out, it should never be added back again, since it's already examined without\n        //  a full match.\n        const lastMatch = matches.pop()!;\n        inputIndex = lastMatch.inputIndex + 1;\n        patternIndex = lastMatch.patternIndex;\n        continue;\n      }\n      break;\n    }\n    if (!isMeaningfulChar(input[inputIndex])) {\n      inputIndex++;\n      continue;\n    }\n    if (\n      pattern[patternIndex].toLowerCase() === input[inputIndex].toLowerCase() &&\n      (continuous || isStarts[inputIndex] || matches.length === 0)\n    ) {\n      matches.push({ patternIndex, inputIndex });\n      continuous = true;\n      patternIndex++;\n      inputIndex++;\n    } else {\n      continuous = false;\n      inputIndex++;\n    }\n  }\n  return null;\n};\n\nfunction isStart(char: string, index: number, chars: string[]): boolean {\n  const previousChar = chars[index - 1];\n  return (\n    index === 0 ||\n    (isWordSeparator(previousChar) && !isWordSeparator(char)) ||\n    (isUpperCase(char) && !isUpperCase(previousChar))\n  );\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport React, {\n  FocusEvent,\n  HTMLAttributes,\n  Key,\n  KeyboardEvent,\n  RefObject,\n  useEffect,\n} from \"react\";\nimport { focusSafely, getFocusableTreeWalker } from \"@react-aria/focus\";\nimport { FocusStrategy, KeyboardDelegate } from \"@react-types/shared\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { MultipleSelectionManager } from \"@react-stately/selection\";\nimport { useLocale } from \"@react-aria/i18n\";\nimport { useTypeSelect } from \"@react-aria/selection\";\nimport { isCtrlKeyPressed } from \"../utils/keyboard-utils\";\n\ninterface SelectableCollectionOptions {\n  /**\n   * An interface for reading and updating multiple selection state.\n   */\n  selectionManager: MultipleSelectionManager;\n  /**\n   * A delegate object that implements behavior for keyboard focus movement.\n   */\n  keyboardDelegate: KeyboardDelegate;\n  /**\n   * The ref attached to the element representing the collection.\n   */\n  ref: RefObject<HTMLElement>;\n  /**\n   * Whether the collection or one of its items should be automatically focused upon render.\n   * @default false\n   */\n  autoFocus?: boolean | FocusStrategy;\n  /**\n   * Whether focus should wrap around when the end/start is reached.\n   * @default false\n   */\n  shouldFocusWrap?: boolean;\n  /**\n   * Whether the collection allows empty selection.\n   * @default false\n   */\n  disallowEmptySelection?: boolean;\n  /**\n   * Whether the collection allows the user to select all items via keyboard shortcut.\n   * @default false\n   */\n  disallowSelectAll?: boolean;\n  /**\n   * Whether selection should occur automatically on focus.\n   * @default false\n   */\n  selectOnFocus?: boolean;\n  /**\n   * Whether typeahead is disabled.\n   * @default false\n   */\n  disallowTypeAhead?: boolean;\n  /**\n   * Whether the collection items should use virtual focus instead of being focused directly.\n   */\n  shouldUseVirtualFocus?: boolean;\n  /**\n   * Whether navigation through tab key is enabled.\n   */\n  allowsTabNavigation?: boolean;\n}\n\ninterface SelectableCollectionAria {\n  /** Props for the collection element. */\n  collectionProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles interactions with selectable collections.\n */\nexport function useSelectableCollection(\n  options: SelectableCollectionOptions\n): SelectableCollectionAria {\n  let {\n    selectionManager: manager,\n    keyboardDelegate: delegate,\n    ref,\n    autoFocus = false,\n    shouldFocusWrap = false,\n    disallowEmptySelection = false,\n    disallowSelectAll = false,\n    selectOnFocus = false,\n    disallowTypeAhead = false,\n    shouldUseVirtualFocus,\n    allowsTabNavigation = false,\n  } = options;\n  let { direction } = useLocale();\n\n  let onKeyDown = (e: KeyboardEvent) => {\n    // Let child element (e.g. menu button) handle the event if the Alt key is pressed.\n    // Keyboard events bubble through portals. Don't handle keyboard events\n    // for elements outside the collection (e.g. menus).\n    if (e.altKey || !ref.current?.contains(e.target as HTMLElement)) {\n      return;\n    }\n\n    const navigateToKey = (\n      key: Key | undefined,\n      childFocus?: FocusStrategy\n    ) => {\n      if (key != null) {\n        manager.setFocusedKey(key, childFocus);\n\n        if (e.shiftKey && manager.selectionMode === \"multiple\") {\n          manager.extendSelection(key);\n        } else if (selectOnFocus) {\n          manager.replaceSelection(key);\n        }\n      }\n    };\n\n    switch (e.key) {\n      case \"ArrowDown\": {\n        if (delegate.getKeyBelow) {\n          e.preventDefault();\n          let nextKey =\n            manager.focusedKey != null\n              ? delegate.getKeyBelow(manager.focusedKey)\n              : delegate.getFirstKey?.();\n          if (nextKey == null && shouldFocusWrap) {\n            nextKey = delegate.getFirstKey?.(manager.focusedKey);\n          }\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      }\n      case \"ArrowUp\": {\n        if (delegate.getKeyAbove) {\n          e.preventDefault();\n          let nextKey =\n            manager.focusedKey != null\n              ? delegate.getKeyAbove(manager.focusedKey)\n              : delegate.getLastKey?.();\n          if (nextKey == null && shouldFocusWrap) {\n            nextKey = delegate.getLastKey?.(manager.focusedKey);\n          }\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      }\n      case \"ArrowLeft\": {\n        if (delegate.getKeyLeftOf) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyLeftOf(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey, direction === \"rtl\" ? \"first\" : \"last\");\n        }\n        break;\n      }\n      case \"ArrowRight\": {\n        if (delegate.getKeyRightOf) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyRightOf(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey, direction === \"rtl\" ? \"last\" : \"first\");\n        }\n        break;\n      }\n      case \"Home\":\n        if (delegate.getFirstKey) {\n          e.preventDefault();\n          let firstKey = delegate.getFirstKey(\n            manager.focusedKey,\n            isCtrlKeyPressed(e)\n          );\n          // @ts-expect-error ignored strictness error in copied code\n          manager.setFocusedKey(firstKey);\n          if (\n            isCtrlKeyPressed(e) &&\n            e.shiftKey &&\n            manager.selectionMode === \"multiple\"\n          ) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.extendSelection(firstKey);\n          } else if (selectOnFocus) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.replaceSelection(firstKey);\n          }\n        }\n        break;\n      case \"End\":\n        if (delegate.getLastKey) {\n          e.preventDefault();\n          let lastKey = delegate.getLastKey(\n            manager.focusedKey,\n            isCtrlKeyPressed(e)\n          );\n          // @ts-expect-error ignored strictness error in copied code\n          manager.setFocusedKey(lastKey);\n          if (\n            isCtrlKeyPressed(e) &&\n            e.shiftKey &&\n            manager.selectionMode === \"multiple\"\n          ) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.extendSelection(lastKey);\n          } else if (selectOnFocus) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.replaceSelection(lastKey);\n          }\n        }\n        break;\n      case \"PageDown\":\n        if (delegate.getKeyPageBelow) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyPageBelow(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      case \"PageUp\":\n        if (delegate.getKeyPageAbove) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyPageAbove(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      case \"a\":\n        if (\n          isCtrlKeyPressed(e) &&\n          manager.selectionMode === \"multiple\" &&\n          disallowSelectAll !== true\n        ) {\n          e.preventDefault();\n          manager.selectAll();\n        }\n        break;\n      case \"Escape\":\n        e.preventDefault();\n        if (!disallowEmptySelection) {\n          manager.clearSelection();\n        }\n        break;\n      case \"Tab\": {\n        if (!allowsTabNavigation) {\n          // There may be elements that are \"tabbable\" inside a collection (e.g. in a grid cell).\n          // However, collections should be treated as a single tab stop, with arrow key navigation internally.\n          // We don't control the rendering of these, so we can't override the tabIndex to prevent tabbing.\n          // Instead, we handle the Tab key, and move focus manually to the first/last tabbable element\n          // in the collection, so that the browser default behavior will apply starting from that element\n          // rather than the currently focused one.\n          if (e.shiftKey) {\n            ref.current.focus();\n          } else {\n            let walker = getFocusableTreeWalker(ref.current, {\n              tabbable: true,\n            });\n            let next: HTMLElement | undefined;\n            let last: HTMLElement;\n            do {\n              last = walker.lastChild() as HTMLElement;\n              if (last) {\n                next = last;\n              }\n            } while (last);\n\n            if (next && !next.contains(document.activeElement)) {\n              next.focus();\n            }\n          }\n          break;\n        }\n      }\n    }\n  };\n\n  let onFocus = (e: FocusEvent) => {\n    if (manager.isFocused) {\n      // If a focus event bubbled through a portal, reset focus state.\n      if (!e.currentTarget.contains(e.target)) {\n        manager.setFocused(false);\n      }\n\n      return;\n    }\n\n    // Focus events can bubble through portals. Ignore these events.\n    if (!e.currentTarget.contains(e.target)) {\n      return;\n    }\n\n    manager.setFocused(true);\n\n    if (manager.focusedKey == null) {\n      // If the user hasn't yet interacted with the collection, there will be no focusedKey set.\n      // Attempt to detect whether the user is tabbing forward or backward into the collection\n      // and either focus the first or last item accordingly.\n      let relatedTarget = e.relatedTarget as Element;\n      let key: Key | undefined;\n      if (\n        relatedTarget &&\n        e.currentTarget.compareDocumentPosition(relatedTarget) &\n          Node.DOCUMENT_POSITION_FOLLOWING\n      ) {\n        // @ts-expect-error ignored strictness error in copied code\n        key = manager.lastSelectedKey ?? delegate.getLastKey?.();\n      } else {\n        // @ts-expect-error ignored strictness error in copied code\n        key = manager.firstSelectedKey ?? delegate.getFirstKey?.();\n      }\n      if (key != null) {\n        manager.setFocusedKey(key);\n      }\n    }\n  };\n\n  let onBlur = (e: FocusEvent) => {\n    // Don't set blurred and then focused again if moving focus within the collection.\n    if (!e.currentTarget.contains(e.relatedTarget as HTMLElement)) {\n      manager.setFocused(false);\n    }\n  };\n\n  useEffect(() => {\n    if (autoFocus) {\n      let focusedKey = null;\n\n      // Check focus strategy to determine which item to focus\n      if (autoFocus === \"first\") {\n        focusedKey = delegate.getFirstKey?.();\n      }\n      if (autoFocus === \"last\") {\n        focusedKey = delegate.getLastKey?.();\n      }\n\n      // If there are any selected keys, make the first one the new focus target\n      let selectedKeys = manager.selectedKeys;\n      if (selectedKeys.size) {\n        focusedKey = selectedKeys.values().next().value;\n      }\n\n      manager.setFocused(true);\n      manager.setFocusedKey(focusedKey);\n\n      // If no default focus key is selected, focus the collection itself.\n      if (focusedKey == null && !shouldUseVirtualFocus && ref.current) {\n        focusSafely(ref.current);\n      }\n\n      ///////////////////////////////////////////////////// MODIFICATION ///////////////////////////////////////////////\n      // Fixing https://github.com/adobe/react-spectrum/issues/4391\n      if (\n        options.selectOnFocus &&\n        (autoFocus === \"first\" || autoFocus === \"last\")\n      ) {\n        manager.replaceSelection(focusedKey);\n      }\n      /////////////////////////////////////////////////// END OF MODIFICATION //////////////////////////////////////////\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  let handlers = {\n    onKeyDown,\n    onFocus,\n    onBlur,\n    onMouseDown(e: React.MouseEvent) {\n      // Prevent focus going to the collection when clicking on the scrollbar.\n      e.preventDefault();\n    },\n  };\n\n  let { typeSelectProps } = useTypeSelect({\n    keyboardDelegate: delegate,\n    selectionManager: manager,\n    onTypeSelect: selectOnFocus\n      ? (key) => {\n          manager.replaceSelection(key);\n        }\n      : undefined,\n  });\n\n  if (!disallowTypeAhead) {\n    handlers = mergeProps(typeSelectProps, handlers);\n  }\n\n  // If nothing is focused within the collection, make the collection itself tabbable.\n  // This will be marshalled to either the first or last item depending on where focus came from.\n  // If using virtual focus, don't set a tabIndex at all so that VoiceOver on iOS 14 doesn't try\n  // to move real DOM focus to the element anyway.\n  let tabIndex: number | undefined;\n  if (!shouldUseVirtualFocus) {\n    tabIndex = manager.focusedKey == null ? 0 : -1;\n  }\n\n  return {\n    collectionProps: {\n      ...handlers,\n      tabIndex,\n    },\n  };\n}\n","import { useSelectableItem as useOriginalSelectableItem } from \"@react-aria/selection\";\nimport { MouseEventHandler } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\n/**\n * A wrapper around useSelectableItem, which adjusts for intellij platform nuances:\n * - Selects item with right clicks as well, which allows ContextMenuContainer to be used with any collection component\n *   without the need for built-in context-menu support in such components. We won't need this if we move to a built-in\n *   context-menu support for List,Tree, etc.\n * @private\n */\nexport const useSelectableItem: typeof useOriginalSelectableItem = (\n  options\n) => {\n  const onContextMenu: MouseEventHandler<HTMLElement> = (e) => {\n    if (!options.selectionManager.isSelected(options.key)) {\n      options.selectionManager.select(options.key, {\n        type: \"press\",\n        pointerType: \"mouse\",\n        target: e.currentTarget,\n        shiftKey: e.shiftKey,\n        metaKey: e.metaKey,\n        ctrlKey: e.ctrlKey,\n        altKey: e.altKey,\n      });\n    }\n  };\n  const result = useOriginalSelectableItem(options);\n  return {\n    ...result,\n    itemProps: mergeProps(result.itemProps, { onContextMenu }),\n  };\n};\n","/**\n * Drop shadow of windows and other overlays.\n * The current value is not accurate and needs to be revisited. It should also be os-dependant.\n * FIXME: On windows, there is only a border-like shadow. No drop shadow\n * FIXME: On Mac, there is a border-like shadow and a drop shadow. the border-like shadow is missing in the current value\n */\nexport const WINDOW_SHADOW = \"box-shadow: 0 5px 15px rgb(0 0 0 / 30%)\";\n","import * as styledComponents from \"styled-components\";\nimport { ThemedStyledComponentsModule } from \"styled-components\";\nimport { Theme } from \"./Theme\";\nimport { KnownThemePropertyPath } from \"./Theme/types\";\n\ntype JuiStyledComponentsModule = ThemedStyledComponentsModule<\n  Theme<KnownThemePropertyPath>\n>;\n\nexport const styled =\n  styledComponents.default as JuiStyledComponentsModule[\"default\"];\nexport const useTheme =\n  styledComponents.useTheme as JuiStyledComponentsModule[\"useTheme\"];\nexport const css = styledComponents.css as JuiStyledComponentsModule[\"css\"];\nexport const ThemeConsumer =\n  styledComponents.ThemeConsumer as JuiStyledComponentsModule[\"ThemeConsumer\"];\n","import {\n  FocusManager,\n  focusSafely,\n  FocusScope as WrappedFocusScope,\n  FocusScopeProps,\n  useFocusManager,\n} from \"@react-aria/focus\";\nimport React, {\n  ForwardedRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useRef,\n} from \"react\";\n\ntype BetterFocusScopeProps = FocusScopeProps & {\n  /**\n   *\n   */\n  forceRestoreFocus?: boolean;\n};\nexport type FocusScopeRef = { focus: (forceFocusFirst?: boolean) => void };\n/**\n * A version of FocusScope which also allows for imperatively moving focus to the scope.\n * and has tiny patches/improvements\n * It's useful for\n */\nexport const FocusScope = React.forwardRef(function BetterFocusScope(\n  { children, forceRestoreFocus, ...otherProps }: BetterFocusScopeProps,\n  ref: ForwardedRef<FocusScopeRef>\n) {\n  const directChildRef = useRef<HTMLSpanElement>(null);\n  const focusManagerRef = useRef<FocusManager>(null);\n  useForceRestoreFocus(forceRestoreFocus);\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (forceFocusFirst?: boolean) => {\n        const focusManager = focusManagerRef.current;\n        const containerElement = directChildRef.current?.parentElement;\n        if (!focusManager) {\n          throw new Error(\"focus manager not found!\");\n        }\n        if (!containerElement) {\n          throw new Error(\"container element not found\");\n        }\n        if (forceFocusFirst) {\n          return focusManager.focusFirst();\n        }\n        const alreadyHasFocused =\n          document.activeElement &&\n          document.activeElement !== containerElement &&\n          containerElement.contains(document.activeElement);\n        if (!alreadyHasFocused) {\n          focusManager.focusNext({ tabbable: true });\n        }\n      },\n    }),\n    []\n  );\n\n  return (\n    <WrappedFocusScope {...otherProps}>\n      <GetFocusManager ref={focusManagerRef} />\n      <span data-focus-root-direct-child=\"\" hidden ref={directChildRef} />\n      {children}\n    </WrappedFocusScope>\n  );\n});\nconst GetFocusManager = React.forwardRef(function FocusScopeHandle(\n  props: {},\n  ref: ForwardedRef<FocusManager>\n) {\n  const focusManager = useFocusManager();\n  useImperativeHandle(ref, () => focusManager, [focusManager]);\n  return null;\n});\n\n/**\n * Kind of a patchy solution for focus restoration when currently focused element is in a different focus scope, but\n * we still want focus restoration to work. So far the only use case is in nested menu, which is rendered as a separate\n * overlay with a focus scope. If focus is within that submenu, when the menu is closed, the default `restoreFocus`\n * doesn't work because there is a check in useRestoreFocus, which requires the currently focused element to be in\n * the focus scope, to do the focus restoration:\n * https://github.com/adobe/react-spectrum/blob/e14523fedd93ac1a4ede355aed70988af572ae74/packages/%40react-aria/focus/src/FocusScope.tsx#L460\n */\nfunction useForceRestoreFocus(restoreFocus?: boolean) {\n  useLayoutEffect(() => {\n    let nodeToRestore = document.activeElement as HTMLElement;\n\n    return () => {\n      if (restoreFocus && nodeToRestore) {\n        requestAnimationFrame(() => {\n          if (document.body.contains(nodeToRestore)) {\n            focusSafely(nodeToRestore);\n          }\n        });\n      }\n    };\n  }, [restoreFocus]);\n}\n","/**\n * Properly typed filter function for filtering out null/undefined items in array.\n */\nexport const notNull = <T>(\n  item: T | undefined | null\n): item is NonNullable<T> => item != null;\n","/**\n * IMPORTANT: this is a copy of a non-exported file from @react-aria/interactions\n */\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { runAfterTransition } from \"@react-aria/utils\";\n\n// Safari on iOS starts selecting text on long press. The only way to avoid this, it seems,\n// is to add user-select: none to the entire page. Adding it to the pressable element prevents\n// that element from being selected, but nearby elements may still receive selection. We add\n// user-select: none on touch start, and remove it again on touch end to prevent this.\n// This must be implemented using global state to avoid race conditions between multiple elements.\n\n// There are three possible states due to the delay before removing user-select: none after\n// pointer up. The 'default' state always transitions to the 'disabled' state, which transitions\n// to 'restoring'. The 'restoring' state can either transition back to 'disabled' or 'default'.\ntype State = \"default\" | \"disabled\" | \"restoring\";\n\nlet state: State = \"default\";\nlet savedUserSelect = \"\";\n\nexport function disableTextSelection() {\n  if (state === \"default\") {\n    savedUserSelect = document.documentElement.style.webkitUserSelect;\n    document.documentElement.style.webkitUserSelect = \"none\";\n  }\n\n  state = \"disabled\";\n}\n\nexport function restoreTextSelection() {\n  // If the state is already default, there's nothing to do.\n  // If it is restoring, then there's no need to queue a second restore.\n  if (state !== \"disabled\") {\n    return;\n  }\n\n  state = \"restoring\";\n\n  // There appears to be a delay on iOS where selection still might occur\n  // after pointer up, so wait a bit before removing user-select.\n  setTimeout(() => {\n    // Wait for any CSS transitions to complete so we don't recompute style\n    // for the whole page in the middle of the animation and cause jank.\n    runAfterTransition(() => {\n      // Avoid race conditions\n      if (state === \"restoring\") {\n        if (document.documentElement.style.webkitUserSelect === \"none\") {\n          document.documentElement.style.webkitUserSelect =\n            savedUserSelect || \"\";\n        }\n\n        savedUserSelect = \"\";\n        state = \"default\";\n      }\n    });\n  }, 300);\n}\n","import React, { MouseEventHandler } from \"react\";\nimport { disableTextSelection, restoreTextSelection } from \"./textSelection\";\nimport { useLatest } from \"../useLatest\";\n\nexport type XY = { x: number; y: number };\nexport type UseMoveOptions<S> = {\n  /**\n   * the amount of movement (in pixels) after which the move should start. It prevents interference\n   * with simple click (or more generally, press) events, and provides better UX.\n   * @default 0\n   */\n  dragThreshold?: number;\n  disabled?: boolean;\n  onMoveStart: (args: { from: XY }) => S;\n  onMove: (args: { from: XY; to: XY; movement: XY; startState: S }) => void;\n  onMoveEnd?: (args: { startState: S }) => void;\n};\n\n// TODO: cleanup if unmount happens during drag.\n// TODO: Better even handling for touch devices?\n//  wrapping `useMove` from react-aria to just add support for movement threshold should be the\n//  way to go, but there are a few problems:\n//    - it seemed a little buggy in the example here: https://react-spectrum.adobe.com/react-aria/useMove.html\n//    - the API is not great in a sense that it only gives the diff in last movement.\n//      Also onMoveStart doesn't give the initial position, so it's not possible to even calculate\n//\n// TODO: move should be finished by pressing Escape. onMoveCancel maybe?\n/**\n * Similar to https://react-spectrum.adobe.com/react-aria/useMove.html, with slightly different\n * features and API.\n * NOTE: initially the API was designed in a way that onMove and onMove end callbacks were\n * returned from onMoveStart, instead of being directly passed in the options.\n * This would enable capturing the initial state of each move transaction, by defining whatever\n * variable in onMoveStart and closing over them by onMove and onMoveEnd.\n * The problem with this approach was that although you could capture the initial state of the\n * movement, by closure, any other variable in the outer scopes was also closed over, and you were\n * stuck with the values from the particular render in which the movement was started.\n * Of course, you could work around it by using refs, but it would be unintuitive.\n * So because of that issue, it's redesigned to have onMoveStart, onMove, and onMoveEnd all\n * directly passed as options, but you can return anything from `onMoveStart` which will be passed\n * to onMove and onMoveEnd as `startState`.\n */\nexport function useMove<S>({\n  dragThreshold = 0,\n  disabled,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n}: UseMoveOptions<S>): { onMouseDown?: MouseEventHandler } {\n  const handlersRef = useLatest({ onMove, onMoveEnd });\n\n  const onMouseDown = (event: React.MouseEvent) => {\n    disableTextSelection();\n    if (event.button !== 0) {\n      restoreTextSelection();\n      return;\n    }\n    const from = { x: event.pageX, y: event.pageY };\n    let dragStarted = false;\n    let startState: S;\n\n    const onMouseMove = (event: MouseEvent) => {\n      const { pageX: x, pageY: y } = event;\n      const movement = { x: x - from.x, y: y - from.y };\n      const isDraggedEnough =\n        Math.abs(movement.x) >= dragThreshold ||\n        Math.abs(movement.y) >= dragThreshold;\n      if (isDraggedEnough && !dragStarted) {\n        dragStarted = true;\n        startState = onMoveStart({ from });\n      }\n      if (dragStarted) {\n        handlersRef.current.onMove({\n          from,\n          to: { x: from.x + movement.x, y: from.y + movement.y },\n          movement,\n          startState,\n        });\n      }\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n\n    document.addEventListener(\n      \"mouseup\",\n      () => {\n        restoreTextSelection();\n        if (dragStarted) {\n          handlersRef.current.onMoveEnd?.({ startState });\n        }\n        document.removeEventListener(\"mousemove\", onMouseMove);\n      },\n      { once: true }\n    );\n  };\n  return disabled ? {} : { onMouseDown };\n}\n","import React from \"react\";\nimport { isMac } from \"@react-aria/utils\";\n\n/**\n * TODO: The current name is not accurate, and can be confusing. Rename to something better.\n */\nexport function isCtrlKeyPressed(\n  e: { metaKey: boolean; ctrlKey: boolean } | undefined\n) {\n  if (isMac()) {\n    return e?.metaKey;\n  }\n\n  return e?.ctrlKey;\n}\n\nexport function hasAnyModifier(e: KeyboardEvent | React.KeyboardEvent) {\n  return e.altKey || e.ctrlKey || e.metaKey || e.shiftKey;\n}\n","import { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport interface OverflowObserverRecord {\n  target: Element;\n  overflowedElements: Element[];\n  previouslyOverflowedElements: Element[];\n}\n\nexport type OverflowObserverCallback = (\n  change: OverflowObserverRecord,\n  observer: OverflowObserver\n) => void;\n\n/**\n * Allows observing the list of overflowing children of a given target element.\n * An `IntersectionObserver` is created for each target to observe the intersection between the target and each child\n * element. The child elements are observed/unobserved by the intersection observer as they are added/removed to the\n * DOM, which is observed using a `MutationObserver`.\n * `IntersectionObserver` options such as `rootMargin` are supported, to fine tune what should be considered as\n * overflowed.\n *\n * TODO: add a takeRecords method to allow processing pending mutations before disconnect\n * TODO: maybe add direction option?\n *\n */\nexport class OverflowObserver {\n  private mutationObserver: MutationObserver;\n  private data: Map<\n    Element,\n    {\n      intersectionObserver: IntersectionObserver;\n      currentOverflowElements: Element[];\n    }\n  > = new Map();\n\n  constructor(private callback: OverflowObserverCallback) {\n    this.mutationObserver = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        const target = mutation.target;\n        if (!(target instanceof Element)) {\n          return;\n        }\n        mutation.removedNodes.forEach((node) => {\n          if (node instanceof Element) {\n            this.data.get(target)?.intersectionObserver.unobserve(node);\n          }\n        });\n        mutation.addedNodes.forEach((node) => {\n          if (node instanceof Element) {\n            this.data.get(target)?.intersectionObserver.observe(node);\n          }\n        });\n      });\n    });\n  }\n\n  observe(target: Element, options: Omit<IntersectionObserverInit, \"root\">) {\n    this.data.get(target)?.intersectionObserver.disconnect();\n\n    const intersectionObserver = new IntersectionObserver(\n      (entries) => {\n        const data = this.data.get(target);\n        const newHiddenElements = entries\n          .map((entry) =>\n            !entry.isIntersecting && entry.target instanceof Element\n              ? entry.target\n              : undefined\n          )\n          .filter(notNull);\n        const newVisibleElements = entries\n          .map((entry) =>\n            entry.isIntersecting && entry.target instanceof Element\n              ? entry.target\n              : null\n          )\n          .filter(notNull);\n\n        //  Also cover this in Toolbar with a test case\n        const previouslyOverflowedElements =\n          data?.currentOverflowElements || [];\n        const overflowedElements = previouslyOverflowedElements\n          .filter((element) => !newVisibleElements.includes(element))\n          .concat(newHiddenElements)\n          .filter((element) => {\n            // In some cases some elements may be hidden by some styles (e.g. the first/last separator in a toolbar).\n            // It doesn't make sense to report them as overflowed.\n            const isHidden =\n              element instanceof HTMLElement &&\n              element.offsetWidth === 0 &&\n              element.offsetHeight === 0;\n            return !isHidden;\n          });\n        this.callback(\n          {\n            previouslyOverflowedElements,\n            overflowedElements: overflowedElements,\n            target,\n          },\n          this\n        );\n        if (data) {\n          data.currentOverflowElements = overflowedElements;\n        }\n      },\n      {\n        ...options,\n        root: target,\n      }\n    );\n    [...(target?.children || [])].forEach((childElement) => {\n      intersectionObserver.observe(childElement);\n    });\n    this.data.set(target, {\n      intersectionObserver,\n      currentOverflowElements: [],\n    });\n    this.mutationObserver.observe(target, {\n      childList: true,\n    });\n  }\n\n  unobserve(target: Element) {\n    this.data.get(target)?.intersectionObserver.disconnect();\n  }\n\n  disconnect() {\n    [...this.data.values()].forEach(({ intersectionObserver }) =>\n      intersectionObserver.disconnect()\n    );\n    this.data = new Map();\n    this.mutationObserver.disconnect();\n  }\n}\n","import { RefObject, useEffect, useState } from \"react\";\nimport { OverflowObserver } from \"@intellij-platform/core/utils/overflow-utils/OverflowObserver\";\n\n/**\n * Given a ref to a scrollable container, returns the child elements that are not completely visible and\n * are off view because of scroll.\n * @param scrollableContainerRef\n * @param threshold\n */\nexport function useOverflowObserver(\n  scrollableContainerRef: RefObject<HTMLElement>,\n  {\n    threshold = 0.9,\n    rootMargin = \"0px\",\n  }: Omit<IntersectionObserverInit, \"root\"> = {}\n) {\n  const [overflowedElements, setOverflowedElements] = useState<Element[]>([]);\n\n  useEffect(() => {\n    const overflowObserver = new OverflowObserver((change) => {\n      setOverflowedElements(change.overflowedElements);\n    });\n    overflowObserver.observe(scrollableContainerRef.current!, {\n      rootMargin,\n      threshold,\n    });\n    return () => {\n      overflowObserver.disconnect();\n    };\n  }, [\n    /**\n     * It's ok and needed to have the ref value as a dependency here. We don't know if ref is attached to different\n     * elements in each render, and it's ok that it's not a state, since we don't change it, and it's not supposed to\n     * change without a rerender\n     **/\n    scrollableContainerRef.current,\n  ]);\n\n  return {\n    overflowedElements,\n  };\n}\n","import { Key } from \"react\";\n\ntype TreeNodeFn<T> = (root: T) => null | readonly T[];\n\nexport const getExpandAllKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeNodeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key,\n  roots: T[]\n) => {\n  const keys: Key[] = roots.map(getKey);\n  const processItem = (node: T | null) => {\n    const children = node ? getChildren(node) : null;\n    if (node == null || !children) {\n      return;\n    }\n    keys.push(getKey(node));\n    children.forEach(processItem);\n  };\n  roots.map(getChildren).flat().forEach(processItem);\n  return keys;\n};\n\nexport const getExpandedToNodesKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeNodeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key,\n  roots: T[],\n  targetNodeKeys: Iterable<Key>\n) => {\n  const targetNodeKeySet = new Set(targetNodeKeys);\n  const expandedKeys: Key[] = [];\n  dfsVisit<T, boolean>(\n    getChildren,\n    (node, childValues) => {\n      const key = getKey(node);\n      const isExpanded: boolean =\n        childValues?.some((childValue) => childValue) ||\n        targetNodeKeySet.has(key);\n      if (isExpanded) {\n        expandedKeys.push(key);\n      }\n      return isExpanded;\n    },\n    roots\n  );\n  return expandedKeys;\n};\n\nexport const dfsVisit = <T, R>(\n  getChildren: TreeNodeFn<T>,\n  visit: (node: T, childrenValues: null | R[]) => R,\n  roots: T[]\n) => {\n  const dfs = (node: T): R => {\n    const children = getChildren(node);\n    const values = children?.map(dfs) ?? null;\n    return visit(node, values);\n  };\n  roots.forEach(dfs);\n};\n\nexport const bfsVisit = <T, R>(\n  getChildren: TreeNodeFn<T>,\n  visit: (node: T, parentValue: R | null) => R,\n  roots: T[]\n) => {\n  const bfs: typeof visit = (node, parentValue) => {\n    const result = visit(node, parentValue);\n    const children = getChildren(node);\n    children?.map((childNode) => bfs(childNode, result));\n    return result;\n  };\n  return roots.map((root) => bfs(root, null));\n};\n","import React, { useContext } from \"react\";\n\nexport const useContextOrThrow = <ContextType extends unknown>(\n  Context: React.Context<ContextType | null>,\n  nullErrorMessage: string\n) => {\n  const context = useContext<ContextType | null>(Context);\n\n  if (context == null) {\n    throw new Error(nullErrorMessage);\n  }\n\n  return context;\n};\n","import { useCallback, useLayoutEffect, useRef } from \"react\";\n\n/**\n * Interim solution for non-reactive callbacks, until\n * [useEvent](https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md) (or whatever it will end up being\n * called), becomes available.\n */\nexport function useEventCallback<T extends (...args: any[]) => any>(fn: T): T {\n  let ref = useRef<typeof fn>();\n  useLayoutEffect(() => {\n    ref.current = fn;\n  });\n  const callback = ((...args: Parameters<T>) =>\n    ref.current?.apply(null, args)) as T;\n  return useCallback<T>(callback, []);\n}\n","import { FocusEventHandler } from \"react\";\nimport { getFocusableTreeWalker } from \"@react-aria/focus\";\n\n/**\n * Provides a focus management mechanism for a container that doesn't retain focus but forwards it to its focusable\n * descendants. More specifically:\n * - When the container gets focused, it automatically focuses the first focusable child element.\n *   The {@param forwardFocus} parameter can be used to customize which element should receive focus.\n * - By default, focus is prevented from returning to the container itself when focus is being moved from a descendant\n *   to the container. {@param ignoreFocusedDescendant} can be set to `true`, to disable this behaviour.\n *   If {@param ignoreFocusedDescendant} is true, focus will be forcibly moved to the first element (or the element\n *   specified by {@param forwardFocus}) when the container gets focused.\n *\n * NOTE: This hook does not make the container element focusable. It only returns the focus event handler that should be\n * passed to the container.\n */\nexport function useFocusForwarder({\n  forwardFocus,\n  ignoreFocusedDescendant = false,\n}: {\n  /**\n   * Called when the container gets focused, to forward focus to the appropriate focusable child element.\n   * If not passed, focus is forwarded to the first focusable element, by default.\n   */\n  forwardFocus?: () => void;\n  ignoreFocusedDescendant?: boolean;\n} = {}) {\n  const onFocus: FocusEventHandler = (event) => {\n    if (event.target !== event.currentTarget) {\n      // only when this container is focused. not when anything inside is focused.\n      return;\n    }\n    const possiblyBlurredElement = event.relatedTarget;\n    if (\n      possiblyBlurredElement instanceof Element &&\n      event.currentTarget?.contains(possiblyBlurredElement) &&\n      !ignoreFocusedDescendant\n    ) {\n      // If anything inside the content is being blurred while the container is getting focused, we don't let focus\n      // go from that element, to the container.\n      if (possiblyBlurredElement instanceof HTMLElement) {\n        possiblyBlurredElement.focus();\n      }\n      return;\n    }\n    if (forwardFocus) {\n      forwardFocus();\n    } else {\n      (\n        getFocusableTreeWalker(event.currentTarget).firstChild() as HTMLElement\n      )?.focus();\n    }\n  };\n  return { focusForwarderProps: { onFocus } };\n}\n","import React, { useRef } from \"react\";\n\n/**\n * For when a component needs to forward ref, but it too needs to use the same ref. Since forwarded ref can be in form\n * of a callback too, this will normalize it as a RefObject.\n * NOTE: Should we keep the ref in state because of edge cases?\n */\nexport default function useForwardedRef<T>(\n  forwardedRef: React.Ref<T>\n): React.RefObject<T> {\n  const innerRef = useRef<T>(null);\n  React.useEffect(() => {\n    if (!forwardedRef) {\n      return;\n    }\n\n    if (typeof forwardedRef === \"function\") {\n      forwardedRef(innerRef.current);\n    } else {\n      (forwardedRef as React.MutableRefObject<T | null>).current =\n        innerRef.current;\n    }\n  });\n\n  return innerRef;\n}\n","import { useLayoutEffect, useRef } from \"react\";\n\nexport function useLatest<T>(value: T) {\n  const ref = useRef(value);\n  useLayoutEffect(() => {\n    ref.current = value;\n  });\n  return ref;\n}\n","import React, { useRef } from \"react\";\nimport { useLayoutEffect } from \"@react-aria/utils\";\nimport {\n  AriaPositionProps,\n  PositionAria,\n  useOverlayPosition,\n} from \"@react-aria/overlays\";\n\n/**\n * `useOverlayPosition` only supports positioning overlay relative to an element, at the moment.\n *  For context menu or tooltip, we may want to position the overlay based on the coordinates of the mouse event which\n *  has triggered the overlay.\n *  This hook wraps `useOverlayPosition`, and is very similar to it, but you don't need to pass `targetRef`. Instead,\n *  you have to call the updatePosition in the event handler that triggers the overlay, passing the `MouseEvent` object.\n *\n * This is hopefully a temporary solution to circumvents the limitation of `useOverlayPosition`, until it supports\n * non-element based positioning as well. It works by appending a dummy 1x1 px element to body and positioning it\n * based on React.MouseEvent objects. Then it uses a ref to that element as the `targetRef`, passed to `useOverlayPosition`\n *\n * @example\n * ```ts\n * const { updatePosition, overlyProps} = useMouseEventOverlayPosition({ overlayRef });\n *\n * const onContextMenu = (event: React.ReactEvent) => {\n *  updatePosition(event);\n *  // ...\n * }\n * ```\n */\nlet globalMoveHandler: null | ((e: MouseEvent) => void) = null;\nlet lastMouseClientPos = { x: 0, y: 0 };\n\nexport function useMouseEventOverlayPosition(\n  options: Omit<AriaPositionProps, \"targetRef\">\n): Omit<PositionAria, \"updatePosition\"> & {\n  updatePosition: (event?: React.MouseEvent) => void;\n} {\n  const targetRef = useRef<HTMLElement>(null);\n\n  useLayoutEffect(() => {\n    if (!globalMoveHandler) {\n      // After the first use of the hook, the listener will be attached forever. Not a big deal but can be improved.\n      globalMoveHandler = (e) => {\n        lastMouseClientPos = { x: e.clientX, y: e.clientY };\n      };\n      document.addEventListener(\"mousemove\", globalMoveHandler);\n    }\n    if (!targetRef.current) {\n      const fakeTarget = document.createElement(\"span\");\n      Object.assign(fakeTarget.style, {\n        width: \"0px\",\n        height: \"0px\",\n        pointerEvents: \"none\",\n        position: \"fixed\",\n        visibility: \"hidden\",\n      });\n      document.body.appendChild(fakeTarget);\n      // @ts-expect-error We intentionally don't pass null to generic argument, to not have it as a mutable nullable\n      // ref, since we are mimicking an element ref.\n      targetRef.current = fakeTarget;\n      return () => {\n        fakeTarget.remove();\n      };\n    }\n  }, []);\n\n  useLayoutEffect(() => {\n    if (options.isOpen && targetRef.current) {\n      targetRef.current.style.left = `${lastMouseClientPos.x}px`;\n      targetRef.current.style.top = `${lastMouseClientPos.y}px`;\n      updatePosition();\n    }\n  }, [options.isOpen, targetRef.current]);\n\n  const { updatePosition, ...result } = useOverlayPosition({\n    ...options,\n    targetRef,\n  });\n\n  return {\n    ...result,\n    /**\n     * Ref to be passed to be passed as targetRef\n     */\n    updatePosition: (e?: React.MouseEvent) => {\n      if (targetRef.current && e) {\n        targetRef.current.style.left = `${e.clientX}px`;\n        targetRef.current.style.top = `${e.clientY}px`;\n      }\n      updatePosition();\n    },\n  };\n}\n","import { useEffect, useRef } from \"react\";\n\nexport function usePrevious<T>(value: T): T {\n  const ref = useRef(value);\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n","export class ImmutableSet<T> implements ReadonlySet<T> {\n  readonly size: number;\n  private readonly set: ReadonlySet<T>;\n\n  constructor(values: Iterable<T>) {\n    this.set = new Set(values);\n    this.size = this.set.size;\n  }\n\n  add(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.add(item);\n      });\n    });\n  }\n\n  delete(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.delete(item);\n      });\n    });\n  }\n\n  toggle(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        if (!newValue.delete(item)) {\n          newValue.add(item);\n        }\n      });\n    });\n  }\n\n  clear(): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      newValue.clear();\n    });\n  }\n\n  private setValueWithMutation(\n    mutate: (newValue: Set<T>) => void\n  ): ImmutableSet<T> {\n    const newValue = new Set(this.set);\n    mutate(newValue);\n    return new ImmutableSet(newValue);\n  }\n\n  ////////////////////////////////////////////////// delegated methods /////////////////////////////////////////////////\n  forEach(...args: Parameters<ReadonlySet<T>[\"forEach\"]>): void {\n    return this.set.forEach(...args);\n  }\n\n  has(value: T): boolean {\n    return this.set.has(value);\n  }\n\n  [Symbol.iterator](): IterableIterator<T> {\n    return this.set[Symbol.iterator]();\n  }\n\n  entries(): IterableIterator<[T, T]> {\n    return this.set.entries();\n  }\n\n  keys(): IterableIterator<T> {\n    return this.set.keys();\n  }\n\n  values(): IterableIterator<T> {\n    return this.set.values();\n  }\n}\n","import { useControlledState } from \"@react-stately/utils\";\nimport { useMemo } from \"react\";\nimport { ImmutableSet } from \"./immutableSet\";\n\n/**\n * Creates map interface out of a setter of form (currentValue: Map) => Map\n * Use {@link useControllableSet} instead if you need a Set state in a React component.\n * This is useful for use outside React components, such as state management libraries.\n */\nexport const createSetInterface = <T>(\n  set: (value: (prevState: Set<T>) => Set<T>) => void\n) => ({\n  add: (...values: T[]) =>\n    set(\n      (currentValue) => new Set(new ImmutableSet(currentValue).add(...values))\n    ),\n  delete: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).delete(...values))\n    ),\n  clear: () =>\n    set((currentValue) => new Set(new ImmutableSet(currentValue).clear())),\n  toggle: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).toggle(...values))\n    ),\n});\n\nfunction useStateSetterForSet<T>(\n  setValue: (value: (prevState: Set<T>) => Set<T>, ...args: any[]) => void\n) {\n  return useMemo(() => createSetInterface(setValue), [setValue]);\n}\n\n/**\n * controllable state management for a Set. returns a tuple containing the value and an object with Set functions on it,\n * which would update the state.\n */\nexport const useControllableSet = <T>(\n  valueProp: Set<T> | undefined,\n  defaultValue: Set<T> = new Set(),\n  onChange: ((newValue: Set<T>) => void) | undefined\n) => {\n  const [value, setValue] = useControlledState(\n    valueProp!, // bad typing in useControlledState\n    defaultValue,\n    onChange! // bad typing in useControlledState\n  );\n\n  // @ts-expect-error FIXME https://github.com/adobe/react-spectrum/issues/2320\n  return [value, useStateSetterForSet(setValue)] as const;\n};\n"],"names":["LoadingGif","props","Img","src","darkSrc","Loading","styled","DefaultSuspense","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","darculaColorSchemeTokenRules","vsCodeTheme","scope","settings","flatMap","map","token","values","Object","keys","forEach","key","value","StyledEditor","MonacoEditor","Editor","editorTheme","monaco","useMonaco","theme","useTheme","themeName","setThemeName","useState","dark","useLayoutEffect","name","replace","editor","defineTheme","base","inherit","colors","rules","useEditorTheme","options","minimap","enabled","lineHeight","showFoldingControls","renderIndentGuides","overviewRulerBorder","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","persistentFsPreference","get","localStorage","getItem","set","setItem","switchToPersistentFS","log","getRootFS","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","read","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentState","selectorFamily","fileNames","all","fileName","type","basename","lastModification","mtimeMs","size","reloadFileFromDiskCallback","fetchFileContent","fileContent","encoding","atomFamily","default","effects","onSet","error","filterPath","includes","useLatestRecoilValue","recoilValue","state","setState","loadable","useRecoilValueLoadable","useEffect","contents","useRecoilInitialValue","recoilState","defaultValue","useRecoilCallback","snapshot","getLoadable","getValue","sampleRepos","JUI","url","Recoil","ExampleRepo","sampleRepo","currentProjectState","atom","projectFilePath","projectRelativePath","currentProjectFilesState","selector","project","projectFilesState","projectPath","files","addItem","item","childItems","push","relativePath","activePathsState","useActivePathsProvider","nullValue","focusedElement","setValue","useSetRecoilState","elementRef","useRef","current","currentValue","equals","onFocus","currentTarget","onBlur","relatedTarget","Element","closest","createFocusBasedSetterHook","temporaryTabsDefaultValue","sortWith","descend","file","endsWith","filter","slice","editorState","cursorPos","lineNumber","column","editorTabsState","activeEditorTabIndexState","activeEditorTabState","tabs","editorCursorPositionState","Position","editorRefState","useEditorStateManager","tabsState","setTabsState","useRecoilState","setActiveTabIndex","focus","valueOrThrow","select","index","closeTab","_","tabIndex","openPath","shouldFocus","findIndex","tab","newIndex","length","currentState","setTimeout","closePath","Math","max","closeOthersTabs","convertGitStatus","Array","isArray","asyncFilter","predicate","array","predicateResult","temporaryVcsMappingsDefaultState","dir","Boolean","vcs","vcsRootsState","vcsRootForFile","findRoot","fileStatusState","useUpdateFileStatus","repoRoot","getPromise","fileStatus","useUpdateVcsFileStatuses","transact_UNSTABLE","vcsDirectoryMappings","rows","statusMatrix","row","useStatusColor","FileStatusColor","color","useRecoilValue","useFileStatusColor","style","StatusColor","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","FileEditor","editorStateManager","activeTab","editorRef","active","setActive","hideAllAction","useAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","tabActionsRef","useLatest","setEditorRef","fileContentState","contentLoadable","setContent","updateFileStatus","setPosition","activePathsProviderProps","valueMaybe","StyledFileEditorContainer","mergeProps","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","PlatformIcon","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","onMount","monacoEditor","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","getPosition","onChange","newContent","FileEditorLoading","isUnderDarcula","commonColors","panelBackground","StyledXterm","XTerm","Terminal","input","setInput","xtermRef","useMemo","background","selection","fontFamily","letterSpacing","fontSize","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","write","ref","onData","data","charCodeAt","foldersOnTopState","expandedKeysState","Set","selectedKeysState","projectViewTreeRefState","React","dangerouslyAllowMutability","currentProjectTreeState","rootItems","mapItem","parent","node","dirNode","notNull","sortProjectTreeNodes","createProjectTree","sort","item1","item2","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","ProjectViewPane","setProjectViewTreeRef","projectTree","setExpandedKeys","selectedKeys","setSelectedKeys","sortItems","sortBy","a","identity","selectedKeysArray","i","SpeedSearchTree","fillAvailableSpace","autoFocus","selectionMode","onExpandedChange","undefined","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","selectPathInProjectView","selectOpenedFile","id","actionPerformed","isDisabled","description","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","actionId","CommonActionId","changeListsState","comment","changes","allChangesState","find","changeList","changeLists","flat","isAChange","head","workingDir","stage","refreshChangesCallback","gitRoots","root","pathname","theRest","workdir","after","isDir","before","useRefreshChanges","groupByDirectory","getPath","createDirectoryNode","shouldCollapseDirectories","nodes","pathToNodeCache","rootDirNodes","startsWith","reduce","prevNode","parentNodePath","isDirectoryNode","directoryNodes","uniq","collapseDirectories","createDirectorNode","child","changeBrowserNodeKey","getNodeKeyForChange","change","changeListNode","groupFn","changeNode","isGroupNode","isChangeNode","getChildren","groupings","isAvailable","repository","repositoryNode","directoryNode","isOpen","windowBounds","initiallyIncludedChanges","rootNodes","selectedChanges","changesTreeNodesState","some","rollbackViewState","initiallyExpandedKeys","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","showIgnoredFilesState","showRelatedFilesState","changesGroupingState","resolvedSelectedKeysState","bfsVisit","parentValue","selectedNodesState","byKey","changesUnderSelectedKeys","selectedNodes","allChanges","processNode","add","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysState","includedChangesState","includedChangeKeys","has","includedChangesNestedSelection","getCallback","NestedSelection","createSetInterface","getKey","availableGroupingsState","grouping","isRecoilValue","isActive","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","groupFns","groupChanges","fileCountsMap","Map","dfsVisit","childrenFileCount","fileCount","total","count","commitMessageSizeState","orientation","amendCommitState","commitMessageState","commitErrorMessageState","commitTaskIdState","changesFromActivePaths","activePaths","activePath","queueCheckInCallback","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","contextual","changesUnderSelection","changesBasedOnActivePaths","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","GIT_LOG_HIDE_BRANCHES","GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH","GIT_UPDATE_SELECTED","FOCUS_TEXT_FILTER","MATCH_CASE","REG_EXP","ChangesViewTreeContextMenu","ActionsMenu","DividerItem","StyledRepoColorSquare","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","Color","withTransparency","toString","currentForegroundAware","getTrackingBranch","localBranchName","mergeRef","git","remote","StorageFiles","persistentAtomEffect","componentName","refine","update","storageFile","WORKSPACE_FILE","itemKey","join","syncEffect","storeKey","syncDefault","readComponentState","DefaultValue","repoLocalBranchesState","branches","branch","trackingBranch","repoRemoteBranchesState","remotes","repoBranchesState","currentBranchName","repoCurrentBranchNameState","localBranches","currentBranch","remoteBranches","fullname","allBranchesState","branchForPathState","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","maybeArray","readBranchStorage","branchStorage","entry","list","toBranchStorage","branchesByType","groupBy","entries","branchInfoArrayChecker","object","union","literal","string","favoriteBranchesState","gitSettings","isFavoriteBranchState","branchInfo","isFavorite","excludedFromFavoriteBranchesState","isPredefinedAsFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","fileCountMsg","IntlMessageFormat","ChangeNodeHint","isGroupedByDirectory","nodeRenderers","rendered","format","directory","changelist","fontWeight","getChangeListTreeItemProps","nodeRenderer","dirCount","hasChildItems","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","selectionState","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","menuProps","GroupByActionButton","IconButton","isPressed","ChangesGroupByActionButton","availableGroupings","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","border","tasksState","firstTaskState","taskCountState","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","updates","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","finally","onFinished","useCancelTask","abort","commitSuccessfulMessage","useCommitChanges","refreshChanges","refreshFileStatus","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","oid","tree","blob","mode","newTreeOid","commitRef","commitFiles","message","author","email","part","StyledCommitMessageContainer","StyledCommitMessageTextArea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","commit","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","event","placeholder","Button","preventFocusOnPress","variant","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","Checkbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","amend","setAmend","ActionHelpTooltip","helpText","preventFocus","StyledContainer","StyledTreeViewWrapper","focusCommitMessage","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","commitMessageSize","setCommitMessageSize","treeActions","ThreeViewSplitter","innerView","ActionsProvider","shortcutHandlerProps","innerViewMinSize","lastView","lastSize","onLastResize","ChangesViewPane","refresh","TrackingBranchInfo","borderSpacing","mapping","COMMIT_TOOLWINDOW_ID","changesBranchesState","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","tabContent","UNSAFE_FocusRestoringSuspense","document","activeElement","HTMLElement","isConnected","StyledHeader","borderColor","StyledSpacer","StyledPlaceholderContainer","inactiveTextColor","CommitChangedFiles","CommitDetails","splitViewSizeState","VcsLogDetailsView","splitViewSize","setSplitViewSize","shortcut","flexShrink","firstSize","onFirstResize","firstView","StyledDropdownButton","label","disabled","focusRing","focused","StyledDropdownIcon","StyledValue","FocusableAutoHoverPlatformIcon","AutoHoverPlatformIcon","VcsFilterDropdown","onClear","menuTriggerProps","MenuTrigger","BareButton","hoverIcon","dateToString","date","getMonth","getDate","getFullYear","dateRangeToString","dateRange","from","to","vcsTabKeysState","vcsActiveTabKeyState","vcsTabTitleState","searchQuery","vcsLogFilter","user","parts","short","long","vcsLogTabShowBranches","matchCase","regExp","vcsLogFilterCurrentTab","mapObjIndexed","newValue","useResetFilters","reset","tabKey","StyledMenuIconButton","role","BranchFavoriteButton","onClick","isCurrent","onPointerUp","stopPropagation","hoverContainerSelector","BranchesFilterDropdown","selectedBranches","setSelectedBranches","resetBranches","useResetRecoilState","BranchesFilterMenu","onBranchesSelected","groupRepoRoots","repoRoots","repoGroupedAllBranches","allBranches","allRemoteBranches","allLocalBranches","setFavoriteBranches","remoteBranchesByRemote","createLocalBranchItems","renderBranchItem","SpeedSearchMenu","submenuBehavior","minWidth","Divider","origin","StyledSearchInput","SearchInput","searchHistoryState","VcsLogCommitsView","textFilterRef","searchInputRefState","setSearchQuery","setUser","resetUser","dateFilter","setDateFilter","resetDate","searchHistory","setSearchHistory","searchInputValue","setSearchInputValue","getActionShortcut","useGetActionShortcut","isRegExpOn","isMatchCaseOn","submitSearchQuery","createNewTab","newTabId","uuid","today","Date","sevenDaysAgo","setDate","yesterday","predefinedDateRanges","inputRef","onSubmit","addonAfter","excludeFromTabOrder","predefinedDateRange","CommitsTable","currentTabKey","resetFilters","getLocalBranchNodes","repoBranches","shouldGroupByDirectory","localBranchNodes","repos","groupNodesByDirectory","getRemoteBranchNodes","remoteBranchNodes","branchesTreeNodeState","branchTreeGroupingState","shouldGroupByRepository","isGroupByRepositoryAvailableState","branchesTreeRefState","BranchesGroupByActionButton","branchTreeNodeRenderers","toUpperCase","toLowerCase","localBranch","Tooltip","remoteBranch","StyledSearchIconContainer","BranchesTree","branchesTreeNodes","selectionManagerRef","isInputFocused","setInputFocused","setBranchFilter","collectionSearchInputProps","useCollectionSearchInput","collectionRef","selectionManager","_repo","keyToBranch","showAsFocused","DELETE_BRANCH_ACTION_ID","SHOW_BRANCH_DIFF_ACTION_ID","SHOW_MY_BRANCHES_ACTION_ID","FETCH_ACTION_ID","TOGGLE_FAVORITE_ACTION_ID","VcsBranchesView","useShortcutsOf","VcsLogBranchesViewToolbar","StyledToolbar","firstViewSizeState","lastViewSizeState","StyledToolWindowHeader","VersionControlToolWindow","tabKeys","activeTabKey","setActiveTabKey","activeKey","onActiveKeyChange","VcsToolWindowTabTitle","VcsTab","StyledExpandStripeButton","StyledShowBranchesButton","StyledShowBranchesButtonText","ShowBranchesButton","firstViewSize","setFirstViewSize","lastViewSize","setLastViewSize","hideBranches","toggleMatchCaseAction","toggleRegExpAction","useVcsLogsToolWindowActions","showBranches","setShowBranches","firstViewProps","firstViewMinSize","lastViewMinSize","ToolWindowTabContent","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","showStripeButton","validateBranchName","newBranchName","ILLEGAL_CHARS_PATTERN","RegExp","fill","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","close","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","ModalWindow","minHeight","WindowLayout","header","preventDefault","labelPlacement","footer","right","form","StyledTitle","branchesPopupSizeState","BranchesPopup","onClose","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","windowManager","useWindowManager","checkoutBranch","callbackInterface","reloadFileFromDisk","checkout","openedFiles","existingOpenedFile","Popup","interactions","bounds","onBoundsChange","interactionType","width","PopupLayout","hasControls","currentBounds","disabledKeys","operation","tryCheckout","Errors","Balloon","open","aRepoRoot","checkoutRemoteBranch","getSectionLabel","compareActions","mergeActions","favoriteBranchArgs","small","StyledDialog","WINDOW_SHADOW","StyledDialogHeader","StyledDialogContent","isSuccessfullyCloned","info","SampleRepoInitializer","repoUrl","cloneRepo","onProgress","clone","http","corsProxy","singleBranch","notified","useShowGitTipIfNeeded","refreshProjectFiles","useRecoilRefresher_UNSTABLE","refreshVcsRoots","refreshTemporaryVcsMappingsDefault","useRefreshVcsRoots","showSticky","loaded","phase","round","showProgressPanelState","tasksPopupBoundsState","StyledPopupTitle","TasksPopup","setShowProgressPanel","cancel","setBounds","left","innerWidth","top","innerHeight","nonDismissable","ProgressBar","margin","details","secondaryDetails","maxValue","button","ProgressBarStopButton","StatusBarProgress","dense","namePosition","Spacer","StyledProgressBarButton","StatusBarTaskProgressBar","firstTask","tasksCount","showProgressPanel","activeFileRepoRootState","activeFile","activeFileRepoBranchesState","activeFileRepoRoot","activeFileCurrentBranchState","activeFileRepoHeadState","detached","resolveRef","BranchPopupTrigger","gitRepoHead","StatusBarWidget","StyledLastMessage","IdeStatusBar","cursorPosition","maybeShowGitCloneTip","StatusBar","PopupTrigger","placement","onOpenChange","popup","RollbackTreeContextMenu","StyledFrame","contrastBorder","StyledLine","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","changesWithRepoRoots","groupedChanges","filepaths","resetIndex","useRollbackChanges","balloons","setOpen","display","flex","padding","flexDirection","toolWindowsState","ToolWindowsState","fromEntries","removedFromSideBarIds","tips","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsState","noContentHeight","otherProps","persistBounds","getInitBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","ActionItem","action","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","unshift","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","search","query","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","element","getItemText","renderItem","FileItem","matches","dirMatches","filenameMatches","splitWhen","match","titleMatches","filesSearchContributor","getProjectFiles","SearchEverywhereActionIds","StyledTab","selected","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","getShortcut","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","setFocusedKey","requestAnimationFrame","localActions","currentContributorIndex","contributorActions","Tabs","TabComponent","TabsComponent","contain","newPattern","newPatternContainsPrevious","onPatternChanged","List","shouldFocusWrap","limit","nextItem","itemWrapper","useProjectActions","openSearchEverywhere","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","projectFiles","roots","containsChange","relative","isPathInside","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","deleteChangeListMsg","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","autoSelect","useVcsActions","popupManager","usePopupManager","WORKSPACE_XML_PARSE_OPTIONS","attributeNamePrefix","ignoreAttributes","tagName","jPath","WORKSPACE_XML_BUILD_OPTIONS","readWorkspace","xmlParser","XMLParser","xmlData","workspace","parse","component","writeWorkspace","workspaceState","xmlString","XMLBuilder","build","storageFileMapping","PersistentStateProvider","containerDirectory","workspacePromiseRef","resolveStorageFile","getWorkspace","resolvedStorageFile","diff","changesByFile","components","componentState","splice","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","updateVcsFileStatuses","useInitializeVcs","useInitializeChanges","timeoutId","clearTimeout","usePersistenceFsNotification","useCapture","DefaultToolWindows","onToolWindowStateChange","newState","windows","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateVersionControlWindow","ActivateTerminalWindow","SafeDelete","App","KeymapProvider","BalloonManager","disablePortal","WindowManager","PopupManager","Provider","isActionGroup","isResolvedActionGroup","isActionGroupDefinition","shortcutString","isKeyMatch","keyStroke","loose","supportedModifiers","every","modifier","getModifierState","ActionsContext","generateId","ACTION_PROVIDER_ID_DATA_PREFIX","actionProvidersMap","parentContext","recursivelyCreateActions","actionIds","shortcuts","pick","actionProviderId","firstKeyActivatedShortcutsRef","secondStrokeResetTimerIdRef","onKeyDown","nativeEvent","location","repeat","secondKeyStroke","triggerAction","firstKeyMatches","isKeyboardShortcut","addEventListener","once","capture","useShortcuts","ACTION_PROVIDER_ID_ATTRIBUTE","delete","actionDefinitions","actionDefinition","firstShortcut","context","isMutableActionGroup","closestActionProvider","actionSets","dataset","dataKey","actionSet","useActions","usePerformAction","EXPAND_ALL","COLLAPSE_ALL","EXPAND_SELECTION","SHRINK_SELECTION","GO_TO_ACTION","GO_TO_FILE","SHOW_INTENTION_ACTIONS","EDIT_SOURCE","SHOW_SEARCH_HISTORY","KeymapContext","defaultKeymap","keymapProp","parentKeyMap","assign","create","actionButton","isAction","flatten","renderActionAsMenuItem","isGroup","isPopup","hasDivider","useCreateDefaultActionGroup","openActionsInPopup","groupDefinition","RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID","RESIZE_TOOL_WINDOW_LEFT_ACTION_ID","RESIZE_TOOL_WINDOW_TOP_ACTION_ID","RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID","MAXIMIZE_TOOL_WINDOW_ACTION_ID","FOCUS_EDITOR_ACTION_ID","HIDE_ACTIVE_WINDOW_ACTION_ID","JUMP_TO_LAST_WINDOW_ACTION_ID","defaultKeyToStr","Control","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Enter","Quote","Minus","Equal","Backspace","fromPairs","x","KeystrokeToString","isMac","separator","codeToStr","Alt","Shift","Meta","Escape","modifiersOrder","keystrokeToString","keystroke","b","useActionGroup","actionGroupId","bgColor","StyledHeaderActions","StyledBalloonContainer","StyledIconContainer","StyledBalloonHeader","StyledBalloonBody","lineClamp","StyledBalloonFooter","StyledToggleIconContainer","StyledToggleExpandButtonContainer","StyledToggleExpandButtonFooterContainer","BalloonContext","BalloonActionLink","args","iconProp","expanded","expandedProp","defaultExpanded","headerActions","bodyRef","expandable","setExpandable","setExpanded","useControlledState","maxLinesWhenNotExpanded","bodyElem","clientHeight","parseFloat","getComputedStyle","getNumLines","scrollHeight","iconType","effectiveExpanded","marginLeft","ToggleWrapper","Component","iconName","toggleIcon","className","NotImplementedFn","BalloonsContext","BalloonsContainer","StyledBalloonsStack","setBalloons","timeoutIdsRef","lastIdRef","api","timeout","aBalloon","balloon","aTimeoutId","notificationsStack","ReactDOM","elementType","buttonProps","useButton","domProps","filterDOMProps","StyledButton","variants","StyledWrapperLabel","StyledCheckboxLabelText","StyledInput","disableFocusAlwaysVisible","useToggleState","inputProps","useCheckbox","isFocusVisible","isFocused","focusProps","useFocusRing","focusDisabledProps","onFocusCapture","blur","pointerEvents","CheckboxIcon","Disabled","Selected","Focused","CollectionSpeedSearchContext","CollectionSpeedSearchItemContext","SpeedSearchItemHighlightsProvider","collection","highlightedRanges","speedSearchContext","useCollectionSpeedSearchResult","inputSelectionManager","speedSearch","focusBestMatch","searchTerm","getKeys","matchedRanges","wrappedSelectionManager","selectAll","createSpeedSearchSelectionManager","latestValues","matchedKeys","noneOfTheMatchesAreSelected","matchedKey","keyToFocus","firstRange","rangeA","rangeB","getLongestCommonPrefixMatch","passedFirstSelection","firstSelectedKey","getMatchToSelect","useCollectionSpeedSearch","stickySearch","keyboardDelegate","speedSearchStateProps","useSpeedSearchState","speedSearchSelectionManager","useSpeedSearch","speedSearchKeyboardDelegate","wrappedKeyboardDelegate","findFirstMatch","fromKey","direction","currentKey","getKeyAbove","getKeyBelow","getFirstKey","global","firstKey","getLastKey","lastKey","createSpeedSearchKeyboardDelegate","speedSearchContextValue","searchPopupProps","seq","this","_Divider","getCollectionNode","hasChildNodes","_Item","result","StatelyItem","originalShouldInvalidate","shouldInvalidate","invalidated","GAP","StyledHint","StyledGroup","Hint","Group","useCollectionAutoScroll","isVirtualized","focusedKey","querySelector","scrollIntoView","useCollectionRef","relayEventsToCollection","dispatchEvent","KeyboardEvent","onKeyUp","onKeyPress","StyledHoverContainer","StyledIconHoverContainer","amendName","LafIcon","themePath","resolvedIconPath","iconDescriptor","resolvedValue","findIconPath","useIconPath","useForwardedRef","useSvgIcon","iconNameOrPath","amendment","ext","getPlatformIconPath","darkIcon","darkPath","getDarkPath","fallbackPath","DEFAULT_ICON_SIZE","itemState","unmounted","loadingIcon","svg","getSvgIcon","svgElement","createElement","appendChild","outerHTML","randomPostfix","toFixed","matchAll","modifiedSvg","newId","replaceAll","makeIdsUnique","fetchIcon","theOld","theNew","str","replaced","replacedAgain","DEFAULT_MINIMUM_BUTTON_SIZE","NAVBAR_MINIMUM_BUTTON_SIZE","StyledIconButton","minSize","isPressedInput","onPressChange","onPressEnd","onPressStart","onPressUp","shouldCancelOnPointerExit","pressProps","usePress","ArrowIcon","noArrow","previouslyFocusedElementRef","StyledInputBox","invalid","StyledAddons","StyledRightAddons","StyledLeftAddons","addonBefore","inputRefProp","setIsFocused","focusWithinProps","useFocusWithin","onFocusWithinChange","spellCheck","onMouseDown","StyledLabel","StyledInputContainer","Label","StyledContextHelp","contextHelpForeground","StyledBoxAndContextHelpWrapper","contextHelp","fieldProps","errorMessageProps","labelProps","descriptionProps","useField","PositionedTooltipTrigger","crossOffset","showOnFocus","ValidationTooltip","delay","I","StyledLink","focusBorderColor","linkForegroundEnabled","labelable","interactionHandlers","focusRingClass","allowEmptySelection","disallowEmptySelection","useListState","listProps","useList","listItemRenderer","listFocused","ListDivider","useSeparator","separatorProps","ListItem","itemProps","useSelectableItem","containerFocused","StyledList","shouldForwardProp","prop","StyledListItem","labelForeground","asCurrentForeground","labelSelectedForeground","whiteSpace","paddingLeft","paddingRight","outline","cursor","StyledListSectionHeader","sectionHeader","renderSectionHeader","render","isSectionNode","childNodes","isDividerNode","selectOnFocus","disallowTypeAhead","shouldUseVirtualFocus","allowsTabNavigation","collator","useCollator","usage","sensitivity","delegate","ListKeyboardDelegate","collectionProps","useSelectableCollection","useSelectableList","setFocused","isEmpty","originalUseListState","selectionBehavior","useMenuTriggerState","overlayProps","overlayRef","positionProps","updatePosition","useMouseEventOverlayPosition","shouldFlip","offset","useOverlay","shouldCloseOnBlur","isKeyboardDismissDisabled","isDismissable","shouldCloseOnInteractOutside","areInNestedOverlays","onContextMenu","useContextMenu","allProps","MenuOverlay","restoreFocus","patchCollectionItem","partialNode","result2","partialChildNode","partialChildNodeWithoutType","PatchedItem","PatchedSection","Section","convertChildren","Item2","MenuOverlayContext","MenuContext","useMenu","onActionProp","menuContextValue","useMenuAria","useMenuState","patchCollectionProps","useTreeState","childExpansionBehaviour","expandedKey","onExpandedKeyChange","defaultExpandedKey","StyledMenu","renderMenuNodes","StyledMenuItemText","StyledMenuItemPlatformIcon","StyledMenuItemLafIcon","MenuItemContext","keyboardShortcutProps","useMenuItemLayout","MenuItem","nestedMenuRef","isExpanded","renderSubmenu","menuItemProps","hasSubmenu","ariaMenuItemProps","useMenuItemAria","onMouseEnter","onPointerEnter","onPointerDown","hoverProps","useHover","onHoverStart","isAnySubmenuOpen","parentKey","toggleKey","keyboardProps","togglePressProps","useMenuItem","useOverlayPosition","targetRef","MENU_VERTICAL_PADDING","MENU_BORDER_WIDTH","arrowProps","OverlayComponent","SimpleOverlay","parentState","rootKey","portalContainer","StyledMenuItemLayout","Content","Shortcut","useContextOrThrow","allowedIcon","forceRestoreFocus","align","positioningTargetRef","triggerRef","triggerProps","useMenuTrigger","ariaButtonProps","getPlacement","containerPadding","StyledItemsContainer","StyledSearchFieldWrapper","StyledSpeedSearchMenu","StyledVerticalSeparator","useSpeedSearchMenu","containerRef","speedSearchContainerProps","ListCollection","MenuKeyboardDelegate","contains","focusSafely","setSize","measureSize","offsetWidth","offsetHeight","isSearchActive","useResizeObserver","onResize","sizeStyleProps","maxHeight","emptyText","clear","SpeedSearchSubmenu","SpeedSearchMenuContent","menuRef","useSubmenuState","rootItem","submenuProps","useSubmenu","StyledMenuItem","StyledMenuItemIcon","StyledNestedArrow","highlightedStyle","defaultStyle","disabledStyle","useSubmenuAria","submenuBehaviorProps","Submenu","constructor","super","keyBelow","keyAbove","useKeyboard","continuePropagation","isFocusedRef","focusedKeyRef","defineProperties","SelectionManager","StyledMenuHeading","StyledMenuSectionItemsContainer","MenuSection","headingProps","groupProps","useMenuSection","heading","UNSAFE_React17SuspenseFix","measureContentSize","NullSuspenseFallback","afterUnsuspended","afterSuspended","afterSuspendedProp","afterUnsuspendedProp","StyledWindowUnderlay","StyledWindowContainer","StyledWindowInnerContainer","DEFAULT_WINDOW_MIN_WIDTH","DEFAULT_WINDOW_MIN_HEIGHT","WindowControllerContext","propsContext","underlayProps","usePreventScroll","modalProps","useModal","dialogProps","titleProps","useDialog","overlayInteractionHandlerProps","UNSAFE_measureContentSize","useResizableMovableOverlay","focusContainmentFixProps","lastFocusedElementRef","probablyFocusedElement","elementToFocus","useFocusContainmentFix","OverlayInteractionHandler","WindowContext","movable","OverlayResizeHandles","StyledFooter","hasBorder","StyledFooterSide","WindowFooter","StyledWindowTitle","WindowHeader","renderTitle","OverlayMoveHandle","moveHandleProps","StyledWindowFooter","StyledWindowContentWrapper","Footer","Header","WindowsContext","setWindows","newKeyRef","currentWindows","aWindow","ParentOverlayContext","Overlay","AriaOverlay","element1","element2","overlayRoot1","overlayRoot2","OverlayInteractionHandlerContext","useOverlayInteractionHandler","useOverlayMoveHandle","interactionHandler","finishInteraction","startInteraction","updateBounds","useMove","onMoveStart","onMove","startState","movement","y","onMoveEnd","overlayResizer","initialBoundsRef","bottom","newWidth","initialBounds","newHeight","getResizerProps","side","onResizeStarted","onResizeEnd","useOverlayResizer","withMinSize","getCenteredBounds","targetElement","targetBounds","getBoundingClientRect","ensureInViewport","gap","viewportWidth","viewportHeight","clamp","getContentSize","ceil","cloneNode","returnValue","removeChild","useContentSize","observe","measuredSizes","setMeasuredSizes","lastMeasuredSize","at","Size","isEqual","newSize","cancelAnimationFrame","measure","currentSize","aSize","debouncedMeasure","fnRef","currentTimeoutId","useCallback","useDebouncedCallback","mutationObserver","MutationObserver","subtree","childList","disconnect","width2","height2","inputBounds","defaultBounds","onBoundsChanging","observeContentResize","contentSize","currentInteraction","setCurrentInteraction","effectiveMinWidth","effectiveMinHeight","applyMinSize","getBounds","updatedBounds","partialBounds","centeredContentBounds","positioned","sized","StyledPopupContainer","StyledInnerContainer","DEFAULT_POPUP_MIN_WIDTH","DEFAULT_POPUP_MIN_HEIGHT","_Popup","allowScroll","positioning","positioningProp","onCloseProp","PopupControllerContext","useInteractOutside","onInteractOutsideStart","onInteractOutside","positionedBounds","pipe","focusForwarderProps","useFocusForwarder","titleId","useSlotId","useOverlayFocusContain","zIndex","propsArray","mergeNonNullProps","PopupContext","PopupHeader","Layout","StyledPopupHint","createContext","StyledPopupHeader","labelDisabledForeground","renderHeader","StyledPopupLayout","StyledPopupLayoutHeader","StyledPopupLayoutContent","StyledPopupLayoutFooter","PopupsContext","popups","setPopups","currentPopups","aPopup","wrappedPopup","useOverlayTriggerState","useOverlayTrigger","minValue","progressBarProps","useProgressBar","percentage","forcedDetails","setForcedDetails","setTooltip","contextValue","StyledProgressBarLabel","effectiveDetails","StyledProgressBarContainer","StyledProgressBarLineContainer","hasTopMargin","hasBottomMargin","StyledProgressBarTrack","indeterminate","StyledProgressBarProgress","showValueLabel","valueLabel","ProgressBarContext","StyledProgressBarDetails","getIndeterminateStartColor","getIndeterminateEndColor","indeterminateBackgroundAnimation","keyframes","useProgressBarIconButton","hoverTooltip","isHovered","useProgressBarPauseIconButton","paused","Container","LineContainer","Track","Progress","Details","ResizableView","resizerPlacement","BottomResizer","resizerProps","useBottomResizer","StyledHorizontalResizer","StyledHorizontalResizerArea","handleSize","HorizontalResizer","outerPadding","LeftResizer","useLeftResizer","RightResizer","useRightResizer","TopResizer","useTopResizer","StyledVerticalResizer","StyledVerticalResizerArea","VerticalResizer","useResizer","invert","dragThreshold","onHistoryItemSelected","historyButtonTitle","valueProp","inputContainerRef","isSearchHistoryOpen","setSearchHistoryOpen","showSearchHistoryAction","searchIcon","historyItemText","parseInt","historyItem","tooltipTriggerProps","StyledSearchIcon","StyledSpeedSearchInput","noMatch","getOutlineColor","StyledSearchText","SpeedSearchInput","clearButtonRef","SpeedSearchPopup","StyledSpeedSearchPopup","tooltipForeground","useGhostInput","valueRef","ctrlKey","metaKey","elem","isContentEditable","HTMLInputElement","HTMLTextAreaElement","sliceEnd","onActiveChange","setSearchTerm","defaultSearchTerm","onSearchTermChange","ghostInputKeydown","trimmedValue","trimStart","StyledStatusBar","StyledStatusBarLeft","StyledStatusBarRight","StyledStatusBarSection","StyledWrapper","StyledStatusBarWidget","StyledStatusBarIconWidget","inset","DarculaSeparatorUI","defaultSize","StyledSeparator","backgroundClip","boxSizing","StyledHorizontalSeparator","onUnpin","pinned","startIcon","endIcon","editorTabTheme","underlineHeight","underlinedTabInactiveBackground","underlinedTabBackground","hoverInactiveBackground","hoverBackground","inactiveUnderlineColor","underlineColor","underlinedTabInactiveForeground","underlinedTabForeground","StyledEditorTab","StyledDefaultTab","getTabThemeStyles","StyledEditorTabs","StyledDefaultTabs","getTabsThemeStyles","focusable","StyledTabItemLayout","iconStyle","StyledStartIconWrapper","StyledEndIconWrapper","TabContentLayout","horizontalOverflowIndicatorStyles","StyledHorizontalOverflowShadows","hasOverflowAtStart","hasOverflowAtEnd","Tab","forwardRef","shouldSelectOnPressUp","tabProps","useTab","scrollBarDisabledStyle","StyledTabList","multiRow","noOverflowMenu","noScroll","useTabListState","tabListProps","useTabList","scrolledIndicatorProps","hasOverflow","threshold","setHasOverflow","offsetLeft","scrollLeft","offsetRight","scrollWidth","offsetTop","scrollTop","offsetBottom","newHasOverflow","onScroll","useHasOverflow","overflowedElements","useOverflowObserver","overflowedKeys","scrollableContainer","selectedTabElement","TabsOverflowMenu","onSelect","setSelectedKey","menuItem","toolWindowTabTheme","StyledToolWindowTab","StyledToolWindowTabs","ToolWindowTabs","getAllRanges","ranges","gapRange","range","createRangesFromIndices","indices","lastRange","HighlightedMatch","highlighted","numberPattern","parseComponent","componentStr","min","parseHexRgba","parseShorthandHex","parseRgb","parseRgba","rgba","g","r","NaN","c","Number","isInteger","parseColorString","alpha","brighter","int","FACTOR","darker","blend","colorOrColorString","getBlendedValue","isNaN","padStart","StyledSplitterContainer","StyledSplitterInnerView","resizerPropsOverrides","firstViewRef","lastViewRef","firstSizeState","setFirstSizeState","lastSizeState","setLastSizeState","horizontalValue","verticalValue","FirstResizer","SecondResizer","sizeStyleProp","minSizeStyleProp","isFractionSize","normalizeSize","getSize","getNewSize","newFractionSize","getActualSize","viewElem","actualSize","currentLastSize","currentFirstSize","StyledFloatView","FloatView","boundsStyle","FloatToolWindows","floatWindows","renderToolWindow","stackedFloatWindows","sortedKeys","setSortedKeys","sorted","bringToFront","move","useStackedLayersState","layersProps","toolWindow","MovableToolWindowStripeContext","MovableToolWindowStripeProvider","stripes","draggingRect","setDraggingRect","draggingKey","setDraggingKey","dropPosition","setDropPosition","getDropPositionRef","moveStartLocationRef","addStripe","propsRef","startMove","stripe","stripeElRef","stripeElement","getItemRect","toJSON","indexInMain","mainItems","indexInSplit","splitItems","isSplit","dropPositionGetters","createGetDropPosition","getDropPosition","draggedRect","endMove","TopStripe","BottomStripe","LeftStripe","RightStripe","InnerView","StyledToolWindowOuterLayout","Shell","hideStripes","getSizeInAnchor","containerSize","isHorizontalToolWindow","mapToKey","sortAndMapToKey","compose","order","filterMains","getMains","filterSplits","filterVisible","expectedViewMode","viewMode","getSplits","filterVisibleDocked","filterVisibleUnDocked","getDocked","docks","mains","splits","mainKey","sizeFraction","sideWeight","getUnDocked","getSideState","main","activeKeys","undocked","docked","DEFAULT_HEIGHT","DEFAULT_WIDTH","getFloatWindowsState","floatingBounds","getFloatWindowState","getStripeRect","start","rect","end","getDropPositions","getRef","score","abs","keyToOffsets","boundingRect","getKeyToOffsets","dropPositions","lastDropPosition","stripeRect","getCanDrop","bestMatch","candidate","STRIPE_BUTTON_LINE_HEIGHT","StyledToolWindowStripeButton","StyledToolWindowStripe","theOtherSide","preventCollapse","useElementMove","ghost","ghostOption","otherOptions","updateGhostPosition","defaultGhost","computedBackground","parentElement","resultColor","nextColor","findEffectiveBackgroundColor","createDefaultGhost","append","ToolWindowStripe","onItemPress","getProps","latestPropsRef","moveDisabled","useMovableStripeButtons","isNotCurrentItem","anItem","ToolWindowStripeButton","getStripeButtonStyles","styles","marginValue","StyledUndockSide","UndockSide","ToolWindows","hideToolWindowBars","useWidescreenLayout","mainContentMinWidth","windowsById","indexBy","mainContentFocusScopeRef","layoutState","setLayoutState","windowFocusableRefs","latestRef","container","_setLayoutState","windowIds","getToolWindowsLayoutState","observer","ResizeObserver","contentRect","unobserve","focusLastActiveWindow","lastFocusedKey","focusMainContent","updater","interactionOutsideRef","onFocusLost","handleBodyFocus","focusLosingElement","focusReceivingElement","removeEventListener","useOnFocusLost","renderStripe","toolbarButton","lastFocused","FocusScope","ToolWindowStateProvider","mainContentFocusableRef","renderSideDockedView","resizeDockSplitView","onDockResize","containerBounds","resizeDock","getSplitViewProps","firstAnchor","secondAnchor","horizontalSplitterProps","verticalSplitterProps","outerSplitterProps","innerSplitterProps","undockLayers","resizeUndock","setFloatingBound","renderInnerLayout","ToolWindowStateContext","hide","removeFromSidebar","moveToSide","changeViewMode","stretchWidth","stretchHeight","setFloatingBounds","isDocked","areInSameSection","curry","window1","window2","getViewModeType","layoutToRestore","invalidWindows","targetKey","mapWindows","hideAll","restoreWindows","closableViewModes","viewModeType","sideOrIndex","targetSide","targetIndex","targetSideWindows","indexInTargetSide","sortedTargetWindows","insert","newTargetSideWindows","targetViewMode","stretch","mapFn","property","currentFloatingBound","resizeSide","dock","isInResizingView","inputs","useToolWindow","contentRef","focusableContentRef","onFocusChange","contentHasFocus","setContentHasFocus","contentFocusWithinProps","toolWindowProps","autoHideProps","hideTimeoutId","windowFocusWithinProps","onBlurWithin","onFocusWithin","useAutoHide","forwardFocus","ignoreFocusedDescendant","toolWindowContentProps","toolWindowHeaderProps","ToolWindowSettingsIconMenu","viewModeActionGroup","VIEW_MODE_ACTION_GROUP_ID","moveToActionGroup","MOVE_TO_ACTION_GROUP_ID","resizeActions","TOOL_WINDOW_RESIZE_ACTION_GROUP_ID","maximizeAction","removeFromSideBarAction","REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID","gearIconActions","ViewModeToActionId","StyledToolWindowHeaderActions","StyledToolWindowHeaderContent","DefaultToolWindowHeader","DOCK_TOOL_WINDOW_ACTION_ID","StyledToolWindowContainer","StyledToolWindowContent","DefaultToolWindowContext","mainContentTitle","defaultToolWindowContext","useToolWindowActions","getToolWindowNumberFromShortcut","DefaultToolWindowToolbarButton","showNumber","getActivateToolWindowActionId","number","showNumbers","toolWindowsRef","windowById","useToolWindowsActions","getPresentation","groupTabs","isToolWindowFocused","setToolWindowFocused","setActiveKey","defaultActiveKey","validChild","MultiContentToolWindowContent","renderedViewSwitcher","previousKeys","usePrevious","newActiveKey","activeContent","View","DOCK_PINNED_MODE_ACTION_ID","DOCK_UNPINNED_MODE_ACTION_ID","UNDOCK_MODE_ACTION_ID","FLOAT_MODE_ACTION_ID","WINDOW_MODE_ACTION_ID","anchors","getAnchorName","docked_pinned","docked_unpinned","undock","float","createDefaultActionGroup","activeToolWindowActionGroup","alert","resizeGroup","isAnySideWindowWindowOpen","getOrdinal","n","ord","borderStyle","borderPropToCssProp","StyledShowMoreButton","StyledHorizontalToolbar","StyledVerticalToolbar","StyledToolbarContent","wrap","firstOverflowedIndex","OrientationContext","overflowBehavior","rootProps","showMoreButtonRef","isOverflowPopupVisible","setOverflowPopupVisible","popupHeight","setPopupHeight","firstOverflowedChildIndex","setFirstOverflowedChildIndex","firstOverflowedChildRef","childElements","firstOverflowedChild","toolbarProps","onMouseMove","firstOverflowedElement","shouldShow","clientY","clientX","onMouseLeave","toolbarOverflowPopupProps","ToolbarInOverlay","firstVisibleIndex","ToolbarSeparator","link","multiline","useTooltipTriggerState","tooltipOverlayProps","trigger","StyledTooltip","StyledShortcut","fontSizeDelta","StyledDescription","isInteractive","TooltipContext","tooltipProps","useTooltip","_Tooltip","Description","TooltipTriggerAndOverlay","setInteractive","useTooltipTrigger","normalizeChildren","useAriaTooltipTrigger","StyledValidationTooltip","StyledWarningValidationTooltip","SpeedSearchTreeNode","TreeNode","treeProps","treeContext","useSpeedSearchTree","virtualizerProps","useTreeVirtualizer","TreeContext","StyledTree","Virtualizer","collectionSpeedSearch","TreeKeyboardDelegate","speedSearchKeyboardProps","hasAnyModifier","selectableTree","useSelectableTree","getKeyLeftOf","getKeyRightOf","StyledTreeNodeIcon","TreeNodeIcon","iconPath","getIcon","useTreeNodeToggleButton","treeNodeToggleButtonProps","selectedDescendantKeys","toggleSelection","StyledTreeNode","attrs","level","onActionRef","treeNodeProps","useTreeNode","selectionKeyDown","isExpandable","onNodeKeyDown","shouldToggle","shiftKey","Symbol","iterator","TreeCollection","keyMap","iterable","last","visit","nextKey","prevKey","getKeyBefore","getKeyAfter","idx","getSingleChildrenKeys","getSingleChildrenKeysRecursive","childNodesIterator","firstChild","done","noMoreChildren","isEmptyIterable","TreeSelectionManager","expandSelection","expandKeys","getExpandAndShrinkKeys","shrinkSelection","shrinkKeys","recursivelyGetExpandAndShrinkKeys","previousChild","newKeys","parentDescendants","getAllDescendants","getAllRoots","descendants","stopKeys","_TreeCollection","rootKeys","getAllExpandableKeys","recursivelyAddExpandableKeys","useMultipleSelectionState","cacheInvalidation","invalidators","lastInvalidators","anInvalidator","useCollectionCacheInvalidation","useCollection","latestState","expandAll","collapseAll","useTreeRef","newExpandedKeys","toggleTreeNode","expandedSiblings","getRootItemKeys","getChildItems","siblings","getSiblings","aKey","sectionItems","VariableWidthListLayout","ListLayout","keyToWidth","visibleContentWidth","buildItem","layoutNode","layoutInfo","buildCollection","getVisibleContentWidth","invalidateEverything","layoutNodes","newRect","oldRect","validate","invalidationContext","lastWidth","updateItemSize","changed","layoutInfos","virtualizer","visibleRect","visibleViews","view","itemContentWidth","intersects","getVisibleRect","FlattenedTreeLayout","buildChild","getVisibleLayoutInfos","layout","estimatedRowHeight","sizeToFit","scrollToItem","shouldScrollX","duration","scrollDirection","collectSelectableItemsRecursive","collectedItems","cache","WeakMap","itemsInSubtree","collectSelectableItems","cachedState","allDescendantsStates","otherInvalidators","StyledCheckboxWrapper","selectItemOnPress","itemContext","selectedKeysProp","defaultSelectedKeys","selectedKeysSetter","useControllableSet","isWordSeparator","isWhitespace","char","test","isUpperCase","isMeaningfulChar","ch","rawPattern","isStarts","isStart","continuous","inputIndex","patternIndex","lastMatch","chars","previousChar","manager","disallowSelectAll","useLocale","handlers","navigateToKey","childFocus","extendSelection","isCtrlKeyPressed","getKeyPageBelow","getKeyPageAbove","clearSelection","walker","getFocusableTreeWalker","tabbable","lastChild","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","lastSelectedKey","typeSelectProps","useTypeSelect","onTypeSelect","useOriginalSelectableItem","pointerType","styledComponents","ThemeConsumer","directChildRef","focusManagerRef","nodeToRestore","forceFocusFirst","focusManager","containerElement","focusFirst","focusNext","GetFocusManager","hidden","useFocusManager","savedUserSelect","restoreTextSelection","runAfterTransition","documentElement","webkitUserSelect","handlersRef","pageX","pageY","dragStarted","OverflowObserver","callback","mutations","mutation","removedNodes","intersectionObserver","addedNodes","IntersectionObserver","newHiddenElements","isIntersecting","newVisibleElements","previouslyOverflowedElements","currentOverflowElements","childElement","scrollableContainerRef","rootMargin","setOverflowedElements","overflowObserver","processItem","targetNodeKeys","targetNodeKeySet","childValues","childValue","dfs","bfs","childNode","Context","nullErrorMessage","apply","possiblyBlurredElement","innerRef","globalMoveHandler","lastMouseClientPos","fakeTarget","visibility","ImmutableSet","setValueWithMutation","mutate","useStateSetterForSet"],"sourceRoot":""}