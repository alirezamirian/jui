{"version":3,"file":"assets/js/2443.72e8a913.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/recoil-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/VersionControl/Changes/Change.ts","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/tree-utils/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/ChangeTreeNode.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodesResult.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/Project/persistence/persistentAtomEffect.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesViewTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/TrackingBranchInfo.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/styled-components.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DateRange.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/vcs-logs.state.ts","webpack://website/../example-app/src/VersionControl/refs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/readCommits.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/commit-utils.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/commitChangesTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/Changes/detectRenames.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/getCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/RefLabel.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/CommitDetails.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/VcsLogDetailsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogDropdown.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/BranchesFilterDropdown.tsx","webpack://website/../example-app/src/VersionControl/git-users.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableRow.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableViewOptionsMenuIconButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogCommitsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/branchTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/VcsBranchesView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/useCommitsTableActions.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.state.ts","webpack://website/../example-app/src/StatusBar/TasksPopup.tsx","webpack://website/../example-app/src/StatusBar/StatusBarTaskProgressBar.tsx","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/SampleRepoInitializer.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/BranchPopupTrigger.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/Project/persistence/PersistentStateProvider.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editor.lineHighlightBorder\": \"none\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  const fontSize = 13;\n  return (\n    <StyledEditor\n      {...props}\n      options={{\n        minimap: { enabled: false },\n        lineHeight: 22,\n        showFoldingControls: \"always\",\n        renderIndentGuides: true,\n        overviewRulerBorder: false,\n        fontFamily: \"JetBrains Mono\",\n        fontSize,\n        scrollbar: {\n          verticalScrollbarSize: 14,\n          horizontalScrollbarSize: 8,\n          verticalSliderSize: 8,\n          horizontalSliderSize: 8,\n          horizontal: \"auto\",\n          vertical: \"visible\",\n          alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n        },\n        ...props.options,\n      }}\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\nimport { BFSCallback } from \"browserfs/dist/node/core/file_system\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (persistentFsPreference.get() ===\n\"yes\"\n  ? createIndexedDBFS()\n  : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC = ({ children }) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import {\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { fs } from \"./fs\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\nimport { basename } from \"path\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  name: string;\n  path: string;\n  lastModification: number;\n  size: number;\n}\n\n/**\n * recoil atoms and selectors for keeping list and content of files in recoil state, for components that need on such\n * state.\n * NOTE: still not clear if we should be using atomFamily or selectorFamily for this. changing the current\n * implementation to atomFamily however is easy and side effect free.\n */\nexport const dirContentState = selectorFamily({\n  key: \"dirContents\",\n  get: (path: string) => async (): Promise<null | FsItem[]> => {\n    let fileNames: string[];\n    try {\n      fileNames = await fs.promises.readdir(path);\n    } catch (e) {\n      return null;\n    }\n    const stats = await Promise.all(\n      fileNames.map((fileName) => {\n        const filePath = `${path}/${fileName}`;\n        return fs.promises.stat(filePath).then((stat: Stats) => ({\n          ...stat,\n          type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n          filePath,\n        }));\n      })\n    );\n    return stats.map((stat) => ({\n      type: stat.type,\n      name: basename(stat.filePath),\n      path: stat.filePath,\n      lastModification: stat.mtimeMs,\n      size: stat.size,\n    }));\n  },\n});\n\n/**\n * recoil callback to refresh the file content recoil value of a give path.\n * The callback returns `true` the file exists and content is refreshed successfully, and `false otherwise.\n * @param set\n */\nexport const reloadFileFromDiskCallback =\n  ({ set }: CallbackInterface) =>\n  async (path: string) => {\n    try {\n      const content = await fetchFileContent(path);\n      set(fileContent(path), content);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\nconst fetchFileContent = async (\n  filepath: string | undefined\n): Promise<string> => {\n  if (!filepath) {\n    return \"\";\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n};\n\n/**\n * **Note**: Still not quite clear if we should use atom and [synchronize with source of truth (FS)][recoil-atom-effects],\n * or if we should use selector and refresh it when needed. We probably need a proper [VFS][vfs] implementation at\n * some point, which would be capable of tracking modifications, and setting up listeners for it, and then atoms, can\n * hold the states like directory content, with effects which uses the listener API.\n * A few things to consider in that regard:\n * - if modifications to files are not directly synchronized to fs, using isomorphic-git for updating the file status\n *   can be tricky, unless an FS implementation is provided which uses the file content that is not yet synced with\n *   the actual local FS. Maybe something like Intellij's VFS, can be implemented as a BrowserFS backend impl.\n *\n * **Note**: currently, only text file is supported, for simplicity.\n *\n * [recoil-atom-effects]: https://recoiljs.org/docs/guides/atom-effects#write-through-cache-example\n * [vfs]: https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html\n **/\nexport const fileContent = atomFamily<string, string | undefined>({\n  key: \"fileContent\",\n  default: fetchFileContent,\n  effects: (filepath) => [\n    ({ onSet }) => {\n      onSet((content) => {\n        if (filepath) {\n          // Should a sync API be used here?\n          fs.promises\n            .writeFile(filepath, content, \"utf8\")\n            .catch((e: unknown) => {\n              console.error(\"failed to sync the file back to the fs\", e);\n            });\n        }\n      });\n    },\n  ],\n});\n\nexport const useReloadFromDisk = (path: string) => {\n  return useRecoilRefresher_UNSTABLE(dirContentState(path));\n};\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import {\n  Loadable,\n  RecoilState,\n  RecoilValue,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { FocusEvent, useEffect, useRef, useState } from \"react\";\nimport { equals } from \"ramda\";\n\nexport const createFocusBasedSetterHook = <T extends unknown, N extends T = T>(\n  state: RecoilState<T>,\n  nullValue: N\n) => {\n  let focusedElement: Element | null = null;\n  return (value: T, name: string = \"unknown\") => {\n    const setValue = useSetRecoilState(state);\n    const elementRef = useRef<Element>();\n    useEffect(() => {\n      if (focusedElement === elementRef.current) {\n        setValue((currentValue) =>\n          equals(value, currentValue) ? currentValue : value\n        );\n      }\n    }, [value]);\n    return {\n      onFocus: (e: FocusEvent) => {\n        elementRef.current = e.currentTarget;\n        focusedElement = e.currentTarget;\n        setValue(value);\n      },\n      onBlur: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n      },\n    };\n  };\n};\n\n/**\n * Returns the latest value of a recoil value, or null, if the value is being loaded for the first time.\n * Useful for when stale data is ok, but may get synced soon.\n *\n * TODO: returning a tuple here is not the best API. Ideally we could have a fourth type of Lodable which would be\n *  similar to LoadingLoadale, but would hold a previous value as well. Then we could have a hook like similar to\n *  useRecoilValueLoadable, but returning that specific type of Loadable. The only difference with\n *  useRecoilValueLoadable would be calling getValue() would return the previous value if state is loading, making it\n *  easy to implement the common pattern of keeping the previous data plus a loading indicator, when new data is being\n *  loaded.\n */\nexport function useLatestRecoilValue<T>(\n  recoilValue: RecoilValue<T>\n): [T | null, Loadable<unknown>[\"state\"]] {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  return [\n    loadable.state === \"hasValue\" ? loadable.getValue() : state,\n    loadable.state,\n  ];\n}\n\n/**\n * Refreshes recoil value on mount\n */\nexport function useRefreshRecoilValueOnMount<T>(value: RecoilValue<T>) {\n  const refresh = useRecoilRefresher_UNSTABLE(value);\n  useEffect(() => {\n    refresh();\n  }, []);\n}\n\nexport function useRecoilInitialValue<T>(recoilState: RecoilState<T>): T;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: Exclude<T, undefined | null>\n): Exclude<T, undefined | null>;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: T\n) {\n  return useRecoilCallback(\n    ({ snapshot }) =>\n      () =>\n        snapshot.getLoadable(recoilState).getValue() ?? defaultValue,\n    []\n  );\n}\n","import {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"./project-utils\";\nimport { createFocusBasedSetterHook } from \"../recoil-utils\";\nimport path from \"path\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const sampleRepos = {\n  JUI: {\n    path: \"/workspace/jui\",\n    url: \"https://github.com/alirezamirian/jui.git\",\n  },\n  \"React Spectrum\": {\n    path: \"/workspace/react-spectrum\",\n    url: \"https://github.com/adobe/react-spectrum.git\",\n  },\n  Recoil: {\n    path: \"/workspace/recoil\",\n    url: \"https://github.com/facebookexperimental/Recoil.git\",\n  },\n  ExampleRepo: {\n    path: \"/workspace/example-repo\",\n    url: \"https://github.com/thurwitz/example-branches.git\",\n  },\n};\nconst sampleRepoKey: keyof typeof sampleRepos = \"JUI\";\n\n/**\n * temporary hard coded sample repo, until clone UI is implemented.\n */\nexport const sampleRepo = sampleRepos[sampleRepoKey];\n\nexport const currentProjectState = atom<Project>({\n  key: \"project\",\n  default: {\n    name: \"Workspace\",\n    path: \"/workspace\",\n  },\n});\n\nexport const projectFilePath = selectorFamily({\n  key: \"projectFilePath\",\n  get:\n    (projectRelativePath: string) =>\n    ({ get }) =>\n      path.join(get(currentProjectState).path, projectRelativePath),\n});\n\nexport const currentProjectFilesState = selector({\n  key: \"project.current.files\",\n  get: async ({ get }): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectState);\n    return get(projectFilesState(project.path));\n  },\n});\n\nexport const projectFilesState = selectorFamily({\n  key: \"project.files\",\n  get:\n    (\n      projectPath: string /* could be changed to project id, when project entity is more mature */\n    ) =>\n    async ({ get }): Promise<ProjectFsItem[]> => {\n      const items = get(dirContentState(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = get(dirContentState(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      (items || []).forEach((item) => addItem(item));\n      return files;\n    },\n});\n\nexport const useRefreshCurrentProjectFiles = () =>\n  useRecoilRefresher_UNSTABLE(currentProjectFilesState);\n\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsState = atom<string[]>({\n  key: \"project.activePaths\",\n  default: [],\n});\n\n/**\n * Sets the value of {@link activePathsState} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsState,\n  []\n);\n","import {\n  atom,\n  selector,\n  useRecoilCallback,\n  useRecoilState,\n  useSetRecoilState,\n} from \"recoil\";\nimport { Focusable } from \"../common-types\";\nimport { descend, sortWith } from \"ramda\";\nimport {\n  currentProjectFilesState,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Position } from \"monaco-editor\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n// settings.\nconst temporaryTabsDefaultValue = selector({\n  key: \"editor.tabs/Default\",\n  get: ({ get }) =>\n    sortWith(\n      [\n        // first README.md, then ts and js files.\n        descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n        descend((file) => file.path.endsWith(\".ts\")),\n        descend((file) => file.path.endsWith(\".js\")),\n      ],\n      get(currentProjectFilesState).filter((item) => item.type === \"file\")\n    )\n      .slice(0, 12)\n      // map project file to editor state object\n      .map((file) => ({\n        filePath: file.path,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n      })),\n});\n\n// it should become something under \"project\" state later.\nexport const editorTabsState = atom<EditorTabState[]>({\n  key: \"editor.tabs\",\n  default: temporaryTabsDefaultValue,\n});\n\nconst activeEditorTabIndexState = atom<number>({\n  key: \"editor.activeTabIndex\",\n  default: 0,\n});\n\nexport const activeEditorTabState = selector<EditorTabState | null>({\n  key: \"editor.activeTab\",\n  get: ({ get }) => {\n    const tabs = get(editorTabsState);\n    return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n  },\n});\n\nexport const editorCursorPositionState = atom<Position>({\n  key: \"editor.cursorPosition\",\n  default: new Position(0, 0),\n});\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefState = atom<null | Focusable>({\n  key: \"editor.focusHandle\",\n  default: null,\n});\n\nexport interface EditorStateManager {\n  tabs: EditorTabState[];\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOthersTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n}\n\n/**\n * TODO: refactor this to expose actions in a way that doesn't create dependency to state. A piece of UI that only\n *  needs to open a file in editor in response to some action (e.g. ProjectViewPane or ChangeViewTree) doesn't need to\n *  re-render on editor state changes\n */\nexport const useEditorStateManager = (): EditorStateManager => {\n  const [tabsState, setTabsState] = useRecoilState(editorTabsState);\n  const setActiveTabIndex = useSetRecoilState(activeEditorTabIndexState);\n  const focus = useRecoilCallback(\n    ({ snapshot }) =>\n      () => {\n        snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n      },\n    []\n  );\n\n  const select = (index: number) => {\n    setActiveTabIndex(index);\n  };\n  const closePath = (filePath: string) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      closeTab(index);\n      setActiveTabIndex(Math.max(index - 1, 0));\n    }\n  };\n  const openPath = (filePath: string, shouldFocus = true) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      select(index);\n    } else {\n      const newIndex = tabsState.length;\n      setTabsState((currentState) => [\n        ...currentState,\n        {\n          filePath,\n          editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n        },\n      ]);\n      select(newIndex);\n    }\n    if (shouldFocus) {\n      // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n      // event handler) is picked up by editor, adding unwanted new line.\n      setTimeout(focus);\n    }\n  };\n  const closeTab = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex !== index)\n    );\n  };\n  const closeOthersTabs = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex === index)\n    );\n  };\n  return {\n    tabs: tabsState,\n    // This should become an action. Something like \"open project file\", when action system is implemented.\n    openPath,\n    closePath,\n    closeTab,\n    closeOthersTabs,\n    select,\n  };\n};\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useSetRecoilState,\n} from \"recoil\";\nimport { sampleRepos } from \"../Project/project.state\";\nimport { findRoot, status, statusMatrix } from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport { useEffect } from \"react\";\nimport * as path from \"path\";\nimport { asyncFilter } from \"../async-utils\";\n\n// This should be refactored to have the configuration file(s) as the source of truth.\nconst temporaryVcsMappingsDefaultState = selector({\n  key: \"vcsRoots/temporaryDefault\",\n  get: async (): Promise<VcsDirectoryMapping[]> => {\n    return asyncFilter(\n      ({ dir }) => fs.promises.stat(dir).then(Boolean),\n      Object.values(sampleRepos).map(({ path }) => ({\n        dir: path,\n        vcs: \"git\",\n      }))\n    );\n  },\n});\n\n// FIXME: since the value of this atom comes from a selector, everytime it's called in a selector (which happens in\n//  many places), it will cause a page blink as some component is using a state that depends on this and the loading\n//  is not handled locally (by either a local Suspense or using useRecoilValueLoadable)\nexport const vcsRootsState = atom<VcsDirectoryMapping[]>({\n  key: \"vcsRoots\",\n  default: [],\n});\n\n/**\n * temporary(?) hook to refresh vcs roots\n */\nexport const useRefreshVcsRoots = () => {\n  const setVcsRoots = useSetRecoilState(vcsRootsState);\n  return () => {\n    asyncFilter(\n      ({ dir }) => fs.promises.stat(dir).then(Boolean),\n      Object.values(sampleRepos).map<VcsDirectoryMapping>(({ path }) => ({\n        dir: path,\n        vcs: \"git\",\n      }))\n    ).then((roots) => {\n      setVcsRoots(roots);\n    });\n  };\n};\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsRootForFile = selectorFamily<string | null, string>({\n  key: \"gitRootForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      return findRoot({ fs, filepath }).catch(() => null);\n    },\n});\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: Should it be an atom or selector?\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n */\nexport const fileStatusState = atomFamily<FileStatus, string>({\n  key: \"fileStatus\",\n  default: \"NOT_CHANGED\",\n});\n\nexport const useUpdateFileStatus = () =>\n  useRecoilCallback(\n    ({ snapshot, set }: CallbackInterface) =>\n      async (filepath: string) => {\n        const repoRoot = await snapshot.getPromise(vcsRootForFile(filepath));\n        if (repoRoot != null) {\n          console.time(`status ${filepath}`);\n          const fileStatus = await status({\n            fs,\n            dir: repoRoot,\n            filepath: path.relative(repoRoot, filepath),\n          });\n          console.timeEnd(`status ${filepath}`);\n          set(fileStatusState(filepath), convertGitStatus(fileStatus));\n        }\n      },\n    []\n  );\n\nexport const useUpdateVcsFileStatuses = () =>\n  useRecoilCallback(\n    ({ snapshot, transact_UNSTABLE }: CallbackInterface) =>\n      async () => {\n        const vcsDirectoryMappings = await snapshot.getPromise(vcsRootsState);\n        return Promise.all(\n          vcsDirectoryMappings\n            .filter(({ vcs }) => vcs === \"git\")\n            .map(async ({ dir }) => {\n              console.time(\"statusMatrix\");\n              const rows = await statusMatrix({ fs, dir });\n              console.timeEnd(\"statusMatrix\");\n              transact_UNSTABLE(({ set }) => {\n                rows.forEach((row) => {\n                  set(\n                    fileStatusState(`${dir}/${row[0]}`),\n                    convertGitStatus(row)\n                  );\n                });\n              });\n            })\n        );\n      },\n    []\n  );\n\nexport const useInitializeVcs = () => {\n  const updateVcsFileStatuses = useUpdateVcsFileStatuses();\n  useEffect(() => {\n    updateVcsFileStatuses().catch((e) => {\n      console.error(\"could not initialize VCS file statuses\", e);\n    });\n  }, []);\n};\n","import { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { useRecoilValue } from \"recoil\";\nimport { fileStatusState } from \"./file-status.state\";\nimport React from \"react\";\nimport { FileStatus } from \"./file-status\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const fileStatus = useRecoilValue(fileStatusState(filepath));\n  return useStatusColor(fileStatus);\n};\n\nexport const FileStatusColor: React.FC<{ filepath: string }> = ({\n  children,\n  filepath,\n}) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{ status: FileStatus }> = ({\n  children,\n  status,\n}) => {\n  const theme = useTheme() as Theme;\n  const color = theme.currentForegroundAware(useStatusColor(status));\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport {\n  useRecoilValue,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { Editor } from \"./Editor\";\nimport {\n  activeEditorTabState,\n  editorCursorPositionState,\n  editorRefState,\n  useEditorStateManager,\n} from \"./editor.state\";\nimport { fileContent } from \"../fs/fs.state\";\nimport { useUpdateFileStatus } from \"../VersionControl/file-status.state\";\nimport * as path from \"path\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useAction } from \"@intellij-platform/core\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\n\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const editorStateManager = useEditorStateManager();\n  const activeTab = useRecoilValue(activeEditorTabState);\n  const editorRef = useRef<editor.IEditor>();\n  const [active, setActive] = useState(false);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetRecoilState(editorCursorPositionState);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items),\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOthersTabs,\n  });\n\n  const setEditorRef = useSetRecoilState(editorRefState);\n\n  const fileContentState = fileContent(activeTab?.filePath);\n  const contentLoadable = useRecoilValueLoadable(fileContentState);\n  const setContent = useSetRecoilState(fileContentState);\n  const updateFileStatus = useUpdateFileStatus();\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (activeTab) {\n      updateFileStatus(activeTab.filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n  useEffect(() => {\n    editorRef.current?.focus();\n    if (activeTab?.editorState.cursorPos) {\n      editorRef.current?.setPosition(activeTab?.editorState.cursorPos);\n    }\n  }, [activeTab?.filePath]);\n\n  const activePathsProviderProps = useActivePathsProvider(\n    activeTab ? [activeTab.filePath] : []\n  );\n\n  const content = contentLoadable.valueMaybe();\n\n  return (\n    <StyledFileEditorContainer\n      {...mergeProps(activePathsProviderProps, {\n        onFocus: () => {\n          setActive(true);\n          setEditorRef({\n            focus: () => editorRef.current?.focus(),\n          });\n        },\n      })}\n    >\n      {editorStateManager.tabs.length > 0 && (\n        <ContextMenuContainer\n          renderMenu={() => (\n            <Menu\n              // TODO: detect which tab was triggering context menu and handle the action accordingly\n              //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n              //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n              //  modified to pass the MouseEvent object, in renderMenu.\n              onAction={notImplemented}\n            >\n              <Item key=\"close\">Close</Item>\n              <Item key=\"closeOthers\">Close Other tabs</Item>\n              <Item key=\"closeAll\">Close all tabs</Item>\n              <Item key=\"closeLeft\">Close tabs to the left</Item>\n              <Item key=\"closeRight\">Close tabs to the right</Item>\n            </Menu>\n          )}\n        >\n          <EditorTabs\n            items={editorStateManager.tabs}\n            active={active}\n            selectedKey={activeTab?.filePath}\n            onSelectionChange={(key) =>\n              editorStateManager.select(\n                editorStateManager.tabs.findIndex((tab) => tab.filePath === key)\n              )\n            }\n            noBorders\n          >\n            {(tab) => {\n              const filename = path.basename(tab.filePath);\n              const icon = <PlatformIcon icon={getIconForFile(tab.filePath)} />;\n              return (\n                <TabItem\n                  key={tab.filePath}\n                  textValue={filename}\n                  inOverflowMenu={\n                    <MenuItemLayout content={filename} icon={icon} />\n                  }\n                >\n                  <TooltipTrigger\n                    tooltip={<ActionTooltip actionName={tab.filePath} />}\n                  >\n                    <EditorTabContent\n                      icon={icon}\n                      title={\n                        <FileStatusColor filepath={tab.filePath}>\n                          {filename}\n                        </FileStatusColor>\n                      }\n                      closeButton={\n                        <TooltipTrigger\n                          tooltip={\n                            <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                          }\n                        >\n                          <TabCloseButton\n                            onPress={(e) => {\n                              if (e.altKey) {\n                                tabActionsRef.current.closeOthersTabs(\n                                  editorStateManager.tabs.indexOf(tab)\n                                );\n                              } else {\n                                tabActionsRef.current.closePath(tab.filePath);\n                              }\n                            }}\n                          />\n                        </TooltipTrigger>\n                      }\n                      containerProps={{\n                        onDoubleClick: () => {\n                          hideAllAction?.perform();\n                        },\n                      }}\n                    />\n                  </TooltipTrigger>\n                </TabItem>\n              );\n            }}\n          </EditorTabs>\n        </ContextMenuContainer>\n      )}\n      {activeTab &&\n        (typeof content === \"string\" ? (\n          <Editor\n            height=\"100%\"\n            path={activeTab.filePath}\n            onMount={(monacoEditor, monaco) => {\n              monacoEditor.focus();\n              enableJsx(monaco);\n              editorRef.current = monacoEditor;\n              monacoEditor.onDidChangeCursorPosition((e) => {\n                setCursorPositionState(e.position);\n              });\n              monacoEditor.onDidChangeModel(() => {\n                const position = editorRef.current?.getPosition();\n                if (position) {\n                  setCursorPositionState(position);\n                }\n              });\n            }}\n            onChange={updateContent}\n            value={content}\n          />\n        ) : (\n          content && \"UNSUPPORTED CONTENT\"\n        ))}\n      {contentLoadable.state === \"loading\" && <FileEditorLoading />}\n    </StyledFileEditorContainer>\n  );\n};\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  CallbackInterface,\n  GetRecoilValue,\n  selector,\n  useRecoilCallback,\n} from \"recoil\";\nimport { currentProjectState, Project } from \"../Project/project.state\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport { vcsRootsState } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom({\n  key: \"projectView.foldersOnTop\",\n  default: true,\n});\n\nexport const expandedKeysState = atom({\n  key: \"projectView.expandedKeys\",\n  default: selector({\n    key: \"projectView.expandedKeys/default\",\n    get: ({ get }) =>\n      new Set<Key>(\n        get(vcsRootsState).flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n      ),\n  }),\n});\n\nexport const selectedKeysState = atom<Selection>({\n  key: \"projectView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\nexport const projectViewTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"projectView.focusHandle\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const currentProjectTreeState = selector({\n  key: \"projectTree\",\n  get: ({ get }) => {\n    const project = get(currentProjectState);\n    return createProjectTree(project, get);\n  },\n});\n\ntype FilesTreeSort = \"name\"; // more to be added\n\n// TODO: add more sort options and add \"Tree Appearance\" option in Project tool window settings menu.\nexport const projectTreeSortState = atom<FilesTreeSort>({\n  key: \"project.tree.sort\",\n  default: \"name\",\n});\n\n/**\n * NOTE: using in-place native sort for performance.\n * See more https://www.measurethat.net/Benchmarks/Show/6698/0/ramda-sort-vs-js-native-sort\n */\nfunction sortProjectTreeNodes(items: FileTreeNode[]): void {\n  // TODO: add sortBy: FileTreeSort parameter\n  // TODO: add directoriesOnTop: boolean parameter\n  items.sort((item1, item2) => {\n    if (item1.name < item2.name) {\n      return -1;\n    }\n    if (item1.name > item2.name) {\n      return 1;\n    }\n    return 0;\n  });\n}\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: GetRecoilValue\n): Promise<ProjectTreeRoot> {\n  const rootItems = get(dirContentState(project.path));\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const node = {\n        ...item,\n        parent,\n      };\n      const dirNode: FileTreeDirNode = { ...node, children: [] };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          dirNode.children = (\n            await Promise.all(\n              (get(dirContentState(item.path)) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          sortProjectTreeNodes(dirNode.children);\n          return dirNode;\n        }\n        return null;\n      }\n      return node;\n    };\n\n  const children = (\n    await Promise.all((rootItems || []).map(mapItem(null)))\n  ).filter(notNull);\n  sortProjectTreeNodes(children);\n  return {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children,\n  };\n}\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for expanding to a certain path in project view.\n * @param snapshot\n * @param set\n */\nexport const expandToPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (path: string) => {\n    const expandedKeys = snapshot.getLoadable(expandedKeysState).valueOrThrow();\n    const keysToExpand = [\n      snapshot.getLoadable(currentProjectState).valueOrThrow().path,\n    ].concat(getParentPaths(path));\n    set(expandedKeysState, new Set([...expandedKeys, ...keysToExpand]));\n  };\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n * // TODO: open project view tool window if needed, when tool window state is also moved to recoil instead of local\n * //  state.\n */\nexport const selectKeyAndFocusCallback =\n  ({ snapshot }: CallbackInterface) =>\n  (key: Key) => {\n    const treeRef = snapshot\n      .getLoadable(projectViewTreeRefState)\n      .valueOrThrow()?.current;\n    treeRef?.replaceSelection(key);\n    treeRef?.focus(key);\n  };\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useRecoilCallback(expandToPathCallback, []);\n  const selectKeyAndFocus = useRecoilCallback(selectKeyAndFocusCallback, []);\n  return (path: string) => {\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","import {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectState,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeState,\n  expandedKeysState,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefState,\n  selectedKeysState,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useRecoilValue(currentProjectState);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetRecoilState(projectViewTreeRefState);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const projectTree = useRecoilValue(currentProjectTreeState);\n\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const foldersOnTop = useRecoilValue(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n\n  return (\n    <DefaultSuspense>\n      <SpeedSearchTree\n        treeRef={treeRef}\n        {...activePathsProviderProps}\n        items={[projectTree] as ProjectTreeNode[]}\n        onAction={(path) => {\n          editor.openPath(`${path}`);\n        }}\n        fillAvailableSpace\n        autoFocus\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n      >\n        {(item) => (\n          <Item\n            key={item.path}\n            textValue={item.name}\n            childItems={\n              \"children\" in item ? sortItems(item.children) : undefined\n            }\n          >\n            <ItemLayout>\n              {<ProjectViewNodeIcon node={item} />}\n              {item.type === \"project\" ? (\n                <>\n                  <b>\n                    <HighlightedTextValue />\n                  </b>\n                  <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                </>\n              ) : (\n                <FileTreeNodeText node={item} />\n              )}\n              {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n            </ItemLayout>\n          </Item>\n        )}\n      </SpeedSearchTree>\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport {\n  projectViewTreeRefState,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useRecoilValue(projectViewTreeRefState);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useRecoilValue(activeEditorTabState);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n  ];\n}\n","import { FileStatus } from \"../file-status\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n  content(): Promise<string>;\n};\n\nexport interface Change {\n  before?: Revision;\n  after?: Revision;\n}\nexport type ModificationChange = Required<Change>;\nexport type DeletionChange = {\n  before: Revision;\n  after: undefined;\n};\nexport type AdditionChange = {\n  before: undefined;\n  after: Revision;\n};\n\n/**\n * Experimenting a pattern of exporting both a type and a value under the same name, to collocate behavior and interface\n * while still using plain objects, to avoid caveats of using class.\n */\nexport class Change {\n  static path(change: Change): string {\n    return (change.after ?? change.before)?.path ?? \"\";\n  }\n  static type(\n    change: Change\n  ): // Making sure the return value is a subset of FileStatus\n  Extract<FileStatus, \"MODIFIED\" | \"ADDED\" | \"DELETED\"> {\n    if (change.after) {\n      if (change.before) {\n        return \"MODIFIED\";\n      }\n      return \"ADDED\";\n    }\n    return \"DELETED\";\n  }\n  static isAddition(change: Change): change is AdditionChange {\n    return Change.type(change) === \"ADDED\";\n  }\n  static isModification(change: Change): change is ModificationChange {\n    return Change.type(change) === \"MODIFIED\";\n  }\n  static isDeletion(change: Change): change is DeletionChange {\n    return Change.type(change) === \"DELETED\";\n  }\n  static isRename(change: Change): change is ModificationChange {\n    return (\n      Change.isModification(change) &&\n      change.before?.path !== change.after?.path\n    );\n  }\n}\n","import { atom, CallbackInterface, selector, useRecoilCallback } from \"recoil\";\nimport { checkout, resetIndex, statusMatrix, StatusRow } from \"isomorphic-git\";\nimport { useEffect } from \"react\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\n\nimport { fs } from \"../../fs/fs\";\nimport { reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport {\n  useUpdateFileStatus,\n  vcsRootForFile,\n  vcsRootsState,\n} from \"../file-status.state\";\nimport { Change } from \"./Change\";\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: Change[];\n}\n\nexport const changeListsState = atom<ChangeListObj[]>({\n  key: \"changelists.lists\",\n  default: [\n    {\n      id: \"some-UUID\",\n      name: \"Changes\",\n      comment: \"last modified commit message\",\n      changes: [],\n      active: true,\n    },\n    {\n      id: \"some-other-UUID\",\n      name: \"Some other changelist\",\n      comment: \"Some empty changelist for testing\",\n      changes: [],\n      active: false,\n    },\n  ],\n});\n\nexport const activeChangeListState = selector<ChangeListObj | null>({\n  key: \"changelists.lists/default\",\n  get: ({ get }) =>\n    get(changeListsState).find((changeList) => changeList.active) ?? null,\n});\n\nexport const allChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changelists.allChanges\",\n  get: ({ get }) =>\n    get(changeListsState)\n      .map((changeLists) => changeLists.changes)\n      .flat(),\n});\n\nconst isAChange = ([, head, workingDir, stage]: StatusRow): boolean =>\n  head !== 1 || workingDir !== 1 || stage !== 1;\n\nconst refreshChangesCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  async () => {\n    const gitRoots = (await snapshot.getPromise(vcsRootsState)).filter(\n      (root) => root.vcs === \"git\"\n    );\n    const allStatusMatrices = await Promise.all(\n      gitRoots.map(async ({ dir }) => {\n        const rows = await statusMatrix({ fs, dir });\n        return rows\n          .filter(isAChange)\n          .map(\n            ([pathname, ...theRest]) =>\n              [path.join(dir, pathname), ...theRest] as StatusRow\n          );\n      })\n    );\n    const unversionedPaths = []; // FIXME: handle unversioned files\n    const changes = allStatusMatrices.flat().map(\n      ([path, head, workdir, stage]): Change => ({\n        // FIXME: change object creation doesn't cover all kind of changes.\n        after: {\n          path,\n          isDir: false,\n          content(): Promise<string> {\n            throw new Error(\"Not implemented\");\n          },\n        },\n        before: {\n          path,\n          isDir: false,\n          content(): Promise<string> {\n            throw new Error(\"Not implemented\");\n          },\n        },\n      })\n    );\n\n    // FIXME: changes now all go to default change list on each refresh. fix it.\n    set(changeListsState, (changeLists) =>\n      changeLists.map((changeList) => {\n        if (changeList.active) {\n          return {\n            ...changeList,\n            changes,\n          };\n        }\n        return {\n          ...changeList,\n          changes: [],\n        };\n      })\n    );\n  };\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  const updateFileStatus = useUpdateFileStatus();\n  return useRecoilCallback(\n    (callbackInterface) => async (changes: readonly Change[]) => {\n      const { snapshot, set } = callbackInterface;\n      const reloadFileFromDisk = reloadFileFromDiskCallback(callbackInterface);\n\n      const changesWithRepoRoots = await Promise.all(\n        changes\n          .filter((change) => !change.after?.isDir)\n          .map(async (change) => {\n            const repoRoot = (await snapshot.getPromise(\n              vcsRootForFile(Change.path(change))\n            ))!; // FIXME: handle null\n            return {\n              repoRoot,\n              fullPath: Change.path(change),\n              relativePath: path.relative(repoRoot, Change.path(change)),\n            };\n          })\n      );\n      const groupedChanges = groupBy(\n        ({ repoRoot }) => repoRoot,\n        changesWithRepoRoots\n      );\n      await Promise.all(\n        Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n          await checkout({\n            fs,\n            dir: repoRoot,\n            force: true,\n            filepaths: items.map(({ relativePath }) => relativePath),\n          });\n          await Promise.all(\n            items.map(async ({ fullPath, relativePath }) => {\n              await resetIndex({ fs, dir: repoRoot, filepath: relativePath });\n              await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n              return updateFileStatus(fullPath);\n            })\n          );\n        })\n      );\n\n      // Remove all changes from changelists. It's much more efficient than refresh.\n      set(changeListsState, (changeLists) =>\n        changeLists.map((changeList) => {\n          return {\n            ...changeList,\n            changes: changeList.changes.filter(\n              (change) => !changes.includes(change)\n            ),\n          };\n        })\n      );\n    },\n    []\n  );\n};\n\nexport const useRefreshChanges = () =>\n  useRecoilCallback(refreshChangesCallback, []);\n\nexport const useSetActiveChangeList = () =>\n  useRecoilCallback(\n    ({ set, snapshot }) =>\n      (changeListId) => {\n        const changeLists = snapshot.getLoadable(changeListsState).getValue();\n        const targetChangeList = changeLists.find(\n          ({ id }) => id === changeListId\n        );\n        if (targetChangeList) {\n          set(\n            changeListsState,\n            changeLists.map((changeList) => ({\n              ...changeList,\n              active: changeList === targetChangeList,\n            }))\n          );\n        }\n        // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n      },\n    []\n  );\n\n// temporary, perhaps\nexport const useInitializeChanges = () => {\n  const refresh = useRefreshChanges();\n  useEffect(() => {\n    refresh().catch((e) => console.error(\"could not initialize changes\", e));\n  }, [refresh]);\n};\n","import { identity, uniq } from \"ramda\";\nimport { getParentPaths } from \"../file-utils\";\n\nexport interface DirectoryNode {\n  type: \"directory\";\n  dirPath: string;\n  parentNodePath: string;\n  children: ReadonlyArray<any>;\n}\n\ntype GroupByDirectorAdapter<T, D extends DirectoryNode> = {\n  shouldCollapseDirectories?: boolean;\n  getPath: (node: T) => string;\n  /**\n   * Maps each processed node. E.g. can be used to enrich nodes with grouping metadata.\n   * @example\n   * ```\n   * mapNode: (node) => ({...node, isGroupedByDirectory: true})\n   * ```\n   */\n  mapNode?: (node: T) => T;\n  createDirectoryNode?: (dirNode: DirectoryNode) => D;\n};\n/**\n * Exported only for tests.\n * @internal\n */\nexport const createGroupByDirectory =\n  <T, D extends DirectoryNode>({\n    getPath,\n    mapNode = identity,\n    createDirectoryNode = (i) => i as D,\n    shouldCollapseDirectories = false,\n  }: GroupByDirectorAdapter<T, D>) =>\n  (nodes: ReadonlyArray<T>): readonly D[] => {\n    const pathToNodeCache: Record<string, D> = {};\n    const rootDirNodes = nodes.map(mapNode).map((node) => {\n      const filepath = getPath(node);\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(\n        filepath.startsWith(\"/\") ? filepath : `/${filepath}`\n      ).reduce((prevNode: D | T, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = createDirectoryNode({\n            type: \"directory\",\n            dirPath,\n            parentNodePath: \"\",\n            children: [],\n          });\n        }\n        if (isDirectoryNode(prevNode)) {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      }, node) as D; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const directoryNodes = uniq(rootDirNodes);\n    return shouldCollapseDirectories\n      ? directoryNodes.map((node) =>\n          collapseDirectories(createDirectoryNode, node)\n        )\n      : directoryNodes;\n  };\n\nfunction isDirectoryNode<T, D extends DirectoryNode>(node: D | T): node is D {\n  return \"type\" in node && node.type === \"directory\";\n}\n\nfunction collapseDirectories<T, D extends DirectoryNode>(\n  createDirectorNode: Required<\n    GroupByDirectorAdapter<T, any>\n  >[\"createDirectoryNode\"],\n  dirNode: D\n): D {\n  let { children, dirPath, parentNodePath } = dirNode;\n  if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n    dirPath = dirNode.children[0].dirPath;\n    children = dirNode.children[0].children.map((child: D | T) =>\n      isDirectoryNode<T, D>(child)\n        ? collapseDirectories<T, D>(createDirectorNode, {\n            ...child,\n            parentNodePath: dirPath,\n          })\n        : child\n    );\n    return collapseDirectories<T, D>(\n      createDirectorNode,\n      createDirectorNode({\n        type: \"directory\",\n        dirPath,\n        parentNodePath,\n        children,\n      })\n    );\n  }\n  return {\n    ...dirNode,\n    children: children.map((child) =>\n      isDirectoryNode(child)\n        ? collapseDirectories<T, D>(createDirectorNode, child)\n        : child\n    ),\n  };\n}\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { Change } from \"../Change\";\n\nexport interface ChangesTreeNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface ChangesTreeGroupNode<\n  T extends string,\n  C extends ChangesTreeNode<any> = ChangesTreeNode<T>\n> extends ChangesTreeNode<T> {\n  children: ReadonlyArray<C>;\n}\n\nexport type GroupNodes<T extends ChangesTreeNode<any>> = Extract<\n  T,\n  ChangesTreeGroupNode<any>\n>;\n\nexport interface ChangeNode extends ChangesTreeNode<\"change\"> {\n  change: Change;\n  /**\n   * Whether to show the file path in front of the file name (in muted UI)\n   */\n  showPath?: boolean;\n}\n\nexport interface DirectoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"directory\", C> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"repo\", C> {\n  repository: VcsDirectoryMapping;\n}\n\n/**\n * Extends the type of changes tree nodes with additional (group) node types.\n */\nexport type ExtendedChangesTreeNode<G extends ChangesTreeGroupNode<any>> =\n  | ChangeNode\n  | RepositoryNode<G>\n  | DirectoryNode<G>\n  | G;\n\nexport type DefaultChangesTreeNode = ExtendedChangesTreeNode<never>;\nexport const changesTreeNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\n\nexport const getNodeKeyForChange = (change: Change) =>\n  changesTreeNodeKey(\"change\", Change.path(change));\nexport const changeNode = (change: Change, showPath = true): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n  showPath,\n});\nexport const directoryNode = <G extends ChangesTreeNode<any>>(\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly G[] = []\n): DirectoryNode<G> => ({\n  type: \"directory\",\n  key: changesTreeNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = <G extends ChangesTreeNode<any>>(\n  repository: VcsDirectoryMapping,\n  children: G[] = []\n): RepositoryNode<G> => ({\n  type: \"repo\",\n  key: changesTreeNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = <T extends ChangesTreeNode<any>>(\n  node: T\n): node is GroupNodes<T> => \"children\" in node;\nexport const isChangeNode = (node: ChangesTreeNode<any>): node is ChangeNode =>\n  node.type === \"change\";\nexport const isDirectoryNode = <G extends ChangesTreeNode<any>>(\n  node: ChangesTreeNode<any>\n): node is DirectoryNode<G> => node.type === \"directory\";\n\nexport const getChildren = <\n  T extends ChangesTreeNode<any> = DefaultChangesTreeNode\n>(\n  node: T\n): null | GroupNodes<T>[\"children\"] =>\n  isGroupNode(node) ? node.children : null;\n","import { GetRecoilValue, isRecoilValue, RecoilValue, selector } from \"recoil\";\n\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { createGroupByDirectory } from \"../../../tree-utils/groupByDirectory\";\nimport { Change } from \"../Change\";\nimport {\n  changeNode,\n  ChangeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  directoryNode,\n  DirectoryNode,\n  isChangeNode,\n  isGroupNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./ChangeTreeNode\";\n\nexport type MaybeRecoilValue<T> = T | RecoilValue<T>;\n\nexport type GroupFn<T extends ChangesTreeGroupNode<any>> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<\n  T extends ChangesTreeGroupNode<any>,\n  I = string\n> {\n  id: I;\n  title: string;\n  isAvailable: MaybeRecoilValue<boolean>;\n  groupFn: MaybeRecoilValue<GroupFn<T>>;\n}\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: selector({\n    key: \"repositoryGrouping/isAvailable\",\n    get: ({ get }) => get(vcsRootsState).length > 1,\n  }),\n  groupFn: selector({\n    key: \"repositoryGrouping/groupFn\",\n    get:\n      ({ get }: { get: GetRecoilValue }) =>\n      (nodes: ReadonlyArray<ChangeNode>) => {\n        const repos = get(vcsRootsState);\n        return repos.map(\n          (repository): RepositoryNode =>\n            repositoryNode(\n              repository,\n              nodes.filter((node) =>\n                (\n                  node.change.after?.path || node.change.before?.path\n                )?.startsWith(repository.dir)\n              )\n            )\n        );\n      },\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: true,\n  groupFn: createGroupByDirectory<ChangeNode, DirectoryNode>({\n    shouldCollapseDirectories: true,\n    createDirectoryNode: ({ dirPath, parentNodePath, children }) =>\n      directoryNode(dirPath, parentNodePath, children),\n    mapNode: (node) => changeNode(node.change, false),\n    getPath: (node) => {\n      return Change.path(node.change);\n    },\n  }),\n};\n\nexport const defaultChangeGroupings: ReadonlyArray<\n  ChangeGrouping<DirectoryNode | RepositoryNode, \"directory\" | \"repository\">\n> = [repositoryGrouping, directoryGrouping];\n\nexport const defaultChangeGroupingsState = selector<\n  ReadonlyArray<Omit<typeof defaultChangeGroupings[number], \"isAvailable\">>\n>({\n  key: \"changes.availableGroupings\",\n  get: ({ get }) =>\n    defaultChangeGroupings.filter((grouping) =>\n      isRecoilValue(grouping.isAvailable)\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    ),\n});\n\nexport const recursiveGrouping = <T extends ChangesTreeNode<any>>(\n  groupingFns: Array<GroupFn<any>> /* Typing could be improved? */,\n  nodes: ReadonlyArray<ChangeNode>\n): ReadonlyArray<T> | ReadonlyArray<ChangeNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes;\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n\n  const changeNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isChangeNode\n  );\n  const groupNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isGroupNode\n  );\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\nexport function getChangesGroupFn<G extends ChangesTreeGroupNode<any>>({\n  get,\n  isActive,\n  groupings,\n}: {\n  get: GetRecoilValue;\n  isActive: (groupingId: string) => MaybeRecoilValue<boolean>;\n  groupings: ReadonlyArray<ChangeGrouping<G, any>>;\n}) {\n  const resolve = <T>(value: MaybeRecoilValue<T>): T =>\n    isRecoilValue(value) ? get(value) : value;\n  const groupFns = groupings\n    .filter(\n      ({ id, isAvailable }) => resolve(isAvailable) && resolve(isActive(id))\n    )\n    .map(({ groupFn }) => {\n      return resolve(groupFn);\n    });\n  return (changes: readonly ChangeNode[]) =>\n    recursiveGrouping<G>(groupFns, changes);\n}\n","import { atom, selector } from \"recoil\";\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { Change } from \"../Change\";\n\nconst isOpen = atom<boolean>({\n  key: \"rollbackView.isOpen\",\n  default: false,\n});\nconst windowBounds = atom<Partial<Bounds>>({\n  key: \"rollbackView.windowBounds\",\n  default: { height: 500 },\n});\nconst initiallyIncludedChanges = atom<ReadonlyArray<Change>>({\n  key: \"rollbackView.initiallySelectedChanges\",\n  default: [],\n});\nconst rootNodes = selector({\n  key: \"rollbackView.includedRootNodes\",\n  get: ({ get }) => {\n    const selectedChanges = get(initiallyIncludedChanges);\n    const { rootNodes } = get(changesTreeNodesState);\n    return rootNodes.filter(\n      ({ changeList: { changes, active } }) =>\n        (selectedChanges.length === 0 && active) ||\n        selectedChanges.some((change) => changes.includes(change))\n    );\n  },\n});\nconst initiallyExpandedKeys = selector({\n  key: \"rollbackView.initiallyExpandedKeys\",\n  get: ({ get }) => {\n    const includedChanges = get(initiallyIncludedChanges);\n    const nodes = get(rootNodes);\n    const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n      (node) => (isGroupNode(node) ? node.children : null),\n      (node) => node.key,\n      nodes,\n      includedChanges.map(getNodeKeyForChange)\n    );\n    return new Set(\n      expandedKeys.length\n        ? expandedKeys\n        : getExpandAllKeys<ChangesViewTreeNode>(\n            (node) => (isGroupNode(node) ? node.children : null),\n            (node) => node.key,\n            nodes\n          )\n    );\n  },\n});\n\nexport const rollbackViewState = {\n  isOpen,\n  windowBounds,\n  initiallyExpandedKeys,\n  initiallyIncludedChanges,\n  rootNodes,\n};\n","import { Key } from \"react\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { ChangesTreeNode, getChildren } from \"./ChangeTreeNode\";\n\nexport function changesTreeNodesResult<\n  T extends ReadonlyArray<ChangesTreeNode<any>>\n>(\n  rootNodes: T\n): {\n  rootNodes: ReadonlyArray<T[number]>;\n  byKey: Map<Key, T[number]>;\n  expandAllKeys: Set<Key>;\n  fileCountsMap: Map<Key, number>;\n} {\n  const fileCountsMap = new Map();\n  const byKey = new Map();\n  const expandAllKeys = new Set<Key>();\n\n  dfsVisit<ChangesTreeNode<any>, number>(\n    getChildren,\n    (node, childrenFileCount) => {\n      byKey.set(node.key, node);\n      if (\"children\" in node) {\n        expandAllKeys.add(node.key);\n      }\n      if (!childrenFileCount) {\n        return 1;\n      }\n      const fileCount = childrenFileCount.reduce(\n        (total, count) => total + count,\n        0\n      );\n      fileCountsMap.set(node.key, fileCount);\n      return fileCount;\n    },\n    rootNodes\n  );\n  return { rootNodes, fileCountsMap, byKey, expandAllKeys };\n}\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { atom, atomFamily, CallbackInterface, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  allChangesState,\n  ChangeListObj,\n  changeListsState,\n} from \"../change-lists.state\";\nimport {\n  defaultChangeGroupings,\n  defaultChangeGroupingsState,\n  getChangesGroupFn,\n  GroupFn,\n} from \"../ChangesTree/changesGroupings\";\nimport {\n  bfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsState } from \"../../../Project/project.state\";\nimport {\n  ChangeNode,\n  changeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n  getNodeKeyForChange,\n  GroupNodes,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { Task } from \"../../../tasks\";\nimport { Change } from \"../Change\";\nimport { changesTreeNodesResult } from \"../ChangesTree/changesTreeNodesResult\";\n\nexport interface ChangeListNode<\n  C extends ChangesTreeNode<any> = ChangesViewTreeNode\n> extends ChangesTreeGroupNode<\"changelist\", C> {\n  changeList: ChangeListObj;\n}\n\nexport type ChangesViewTreeNode = ExtendedChangesTreeNode<ChangeListNode>;\n\nexport const changeListNode = (\n  changeList: ChangeListObj\n): ChangeListNode<ChangeNode> => ({\n  type: \"changelist\",\n  key: changesTreeNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: changeList.changes.map((change) => changeNode(change)),\n});\n\nexport const showIgnoredFilesState = atom({\n  key: \"changesView/showIgnoredFiles\",\n  default: false,\n});\n\nexport const showRelatedFilesState = atom({\n  key: \"changesView/showRelatedFiles\",\n  default: false,\n});\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = typeof defaultChangeGroupings[number][\"id\"];\n\nexport const changesGroupingActiveState = atomFamily<boolean, string>({\n  key: \"changesView/isGroupingActive\",\n  default: true, // it's false in IntelliJ\n});\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysState = atom<Selection>({\n  key: \"changesView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\n/**\n * Same as {@link selectedKeysState}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysState = selector<Set<Key>>({\n  key: \"changesView.resolvedSelectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectedKeysState);\n    if (selection === \"all\") {\n      const { rootNodes } = get(changesTreeNodesState);\n      return new Set(\n        bfsVisit<ChangesViewTreeNode, ChangesViewTreeNode[]>(\n          (node) => (\"children\" in node ? node.children : []),\n          (node, parentValue) => {\n            const nodes = parentValue ?? [];\n            nodes.push(node);\n            return nodes;\n          },\n          rootNodes\n        )\n          .flat()\n          .map((node) => node.key)\n      );\n    }\n    return selection;\n  },\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysState}\n */\nconst selectedNodesState = selector<ReadonlySet<ChangesViewTreeNode>>({\n  key: \"changesView.selectedNodes\",\n  get: ({ get }) => {\n    const selectedKeys = get(resolvedSelectedKeysState);\n    const { byKey } = get(changesTreeNodesState);\n    return new Set(\n      [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n    );\n  },\n});\n\nexport const changesUnderSelectedKeys = selector<ReadonlySet<Change>>({\n  key: \"changesView.selectedKeys.changes\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChanges: Set<Change> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  },\n});\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = selector<ReadonlySet<ChangeListObj>>({\n  key: \"changesView.selectedChangeLists\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChangeLists = get(changeListsState);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  },\n});\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysState = atom<Set<string>>({\n  key: \"changesView.includedChangeKeys\",\n  default: new Set<string>([]),\n});\n\nexport const includedChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changesView.includedChanges\",\n  get: ({ get }) => {\n    const includedChangeKeys = get(includedChangeKeysState);\n    const allChanges = get(allChangesState);\n    return allChanges.filter((change) =>\n      includedChangeKeys.has(getNodeKeyForChange(change))\n    );\n  },\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelection = selector<\n  NestedSelectionState<ChangesViewTreeNode>\n>({\n  key: \"changesView.selectedChanges.nestedSelectionState\",\n  get: ({ get, getCallback }) => {\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedChangeKeys = get(includedChangeKeysState);\n    const setSelectedKeys = getCallback(\n      ({ set }) =>\n        (setValue: (currentValue: Set<string>) => Set<string>) =>\n          set(includedChangeKeysState, setValue)\n    );\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface(setSelectedKeys),\n      },\n      {\n        rootNodes,\n        getChildren: (item: ChangesViewTreeNode) =>\n          isGroupNode<ChangesViewTreeNode>(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n});\n\nexport const expandedKeysState = atom<Selection>({\n  key: \"changesView.expandedKeys\",\n  default: selector({\n    key: \"changesView.expandedKeys/temporaryDefault\",\n    get: ({ get }) => {\n      return new Set<Key>(\n        get(changesTreeNodesState)\n          .rootNodes.map((node) => [\n            node.key,\n            ...node.children.map((child) => child.key),\n          ])\n          .flat()\n      );\n    },\n  }),\n});\n\nexport const changesViewGroupingsState = selector({\n  key: \"changes.groupings\",\n  get: ({ get, getCallback }) =>\n    get(defaultChangeGroupingsState).map((grouping) => ({\n      ...grouping,\n      isActive: get(changesGroupingActiveState(grouping.id)),\n    })),\n});\n\nconst groupChildren = <\n  T extends ChangesTreeGroupNode<any, ChangeNode>,\n  G extends ChangesTreeNode<any>\n>(\n  node: T,\n  groupFn: (\n    nodes: ReadonlyArray<ChangeNode>\n  ) => ReturnType<GroupFn<GroupNodes<G>>> | ReadonlyArray<ChangeNode>\n) => ({\n  ...node,\n  children: groupFn(node.children),\n});\n\nexport const changesTreeNodesState = selector<{\n  rootNodes: ReadonlyArray<ChangeListNode>;\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, ChangesViewTreeNode>;\n}>({\n  key: \"changesView.treeNodes\",\n  get: ({ get, getCallback }) => {\n    const changeListNodes = sortBy(\n      ({ active }) => !active,\n      get(changeListsState)\n    ).map(changeListNode);\n    const groupFn = getChangesGroupFn({\n      get,\n      groupings: defaultChangeGroupings,\n      isActive: changesGroupingActiveState,\n    });\n    const rootNodes = changeListNodes.map((changeListNode) =>\n      groupChildren(changeListNode, groupFn)\n    );\n    return changesTreeNodesResult(rootNodes);\n  },\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily<\n  number,\n  \"horizontal\" | \"vertical\"\n>({\n  key: \"changesView/splitter/commitMessageSize\",\n  default: (orientation) => (orientation === \"horizontal\" ? 0.4 : 0.3),\n});\n/**\n * Whether --amend should be used for commit.\n */\nexport const amendCommitState = atom({\n  key: \"changesView/amendCommit\",\n  default: false,\n  // TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n  // it should add a record to the commit message history and switch the message. When toggled to false,\n  // last entry in history should be back again. There is currently no history :D\n});\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageState = atom({\n  key: \"changesView/commitMessage\",\n  default: \"\",\n});\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageState = atom({\n  key: \"changesView/commitErrorMessage\",\n  default: \"\",\n});\n\nexport const commitTaskIdState = atom<Task[\"id\"] | null>({\n  key: \"changesView/commitTaskId\",\n  default: null,\n});\n\nexport const changesFromActivePaths = selector({\n  key: \"changesView/changesFromActivePaths\",\n  get: ({ get }) => {\n    const activePaths = get(activePathsState);\n    return get(allChangesState).filter((change) =>\n      activePaths.some((activePath) =>\n        Change.path(change).startsWith(activePath)\n      )\n    );\n  },\n});\n\n/**\n * Recoil callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = ({ set, snapshot }: CallbackInterface) => {\n  /**\n   * @param paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  return (paths?: string[]) => {\n    const changes = paths\n      ? snapshot\n          .getLoadable(allChangesState)\n          .getValue()\n          .filter((change) =>\n            paths.some((activePath) =>\n              Change.path(change).startsWith(activePath)\n            )\n          )\n      : snapshot.getLoadable(changesFromActivePaths).getValue();\n\n    const includedChangeKeys = changes.map(getNodeKeyForChange);\n    set(includedChangeKeysState, new Set(includedChangeKeys));\n    if (includedChangeKeys.length > 0) {\n      const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n        (node) =>\n          isGroupNode<ChangesViewTreeNode>(node) ? node.children : null,\n        (node) => node.key,\n        snapshot.getLoadable(changesTreeNodesState).getValue().rootNodes,\n        includedChangeKeys\n      );\n      set(expandedKeysState, (currentExpandedKeys) => {\n        return new Set([\n          ...(currentExpandedKeys !== \"all\"\n            ? currentExpandedKeys\n            : new Set<Key>()),\n          ...expandedKeys,\n        ]);\n      });\n      set(selectedKeysState, new Set([includedChangeKeys[0]]));\n    }\n  };\n};\n\nexport const openRollbackWindowForSelectionCallback = ({\n  set,\n  snapshot,\n}: CallbackInterface) => {\n  /**\n   * If contextual is true, changes related to {@link activePathsState} will be preselected.\n   */\n  return (contextual = true) => {\n    const activePaths = snapshot.getLoadable(activePathsState).getValue();\n    const changesUnderSelection = snapshot\n      .getLoadable(changesUnderSelectedKeys)\n      .getValue();\n    const changesBasedOnActivePaths =\n      contextual && activePaths.length > 0\n        ? snapshot.getLoadable(changesFromActivePaths).getValue()\n        : null;\n    set(\n      rollbackViewState.initiallyIncludedChanges,\n      changesBasedOnActivePaths ?? [...changesUnderSelection]\n    );\n    set(rollbackViewState.isOpen, true);\n  };\n};\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n\n  GIT_LOG_HIDE_BRANCHES: \"Git.Log.Hide.Branches\",\n  GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH:\n    \"Git.Log.Branches.Navigate.Log.To.Selected.Branch\",\n  GIT_UPDATE_SELECTED: \"Git.Update.Selected\",\n\n  FOCUS_TEXT_FILTER: \"Vcs.Log.FocusTextFilter\",\n  MATCH_CASE: \"Vcs.Log.MatchCaseAction\",\n  REG_EXP: \"Vcs.Log.EnableFilterByRegexAction\",\n  COPY_REVISION_NUMBER: \"Vcs.CopyRevisionNumberAction\",\n  LOG_REFRESH: \"Vcs.Log.Refresh\",\n  SHOW_DETAILS: \"Vcs.Log.ShowDetailsAction\",\n};\n","import { useRecoilValue } from \"recoil\";\nimport { selectedKeysState } from \"./ChangesView.state\";\nimport { DividerItem, useAction } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Context menu\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(VcsActionIds.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { Checker } from \"@recoiljs/refine\";\nimport { syncEffect } from \"recoil-sync\";\nimport { DefaultValue } from \"recoil\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nexport type PersistentAtomEffectArgs<C, A> = {\n  read: (componentState: C) => Promise<A> | A;\n  update: (value: A) => (componentState: C) => C;\n  refine: Checker<A>;\n  componentName: string;\n  storageFile?: string;\n};\n\nexport function persistentAtomEffect<A, C>({\n  componentName,\n  refine,\n  read,\n  update,\n  storageFile = StorageFiles.WORKSPACE_FILE,\n}: PersistentAtomEffectArgs<C, A>) {\n  const itemKey = [storageFile, componentName].join(\"|\");\n  return syncEffect<A>({\n    storeKey: \"ProjectWorkspace\",\n    itemKey,\n    syncDefault: false,\n    read: async ({ read: readComponentState }) => {\n      return read((await readComponentState(itemKey)) as C);\n    },\n    write: ({ write, read }, value) => {\n      if (!(value instanceof DefaultValue)) {\n        write(itemKey, update(value));\n      }\n    },\n    refine,\n  });\n}\n","import { equals, groupBy } from \"ramda\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilValue,\n} from \"recoil\";\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\n\nimport { fs } from \"../../fs/fs\";\nimport { vcsRootForFile, vcsRootsState } from \"../file-status.state\";\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsState } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { persistentAtomEffect } from \"../../Project/persistence/persistentAtomEffect\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\nexport type BranchType = \"LOCAL\" | \"REMOTE\";\n\nexport type BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesState = selectorFamily<LocalBranch[], string>({\n  key: \"vcs/repoLocalBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({}) => {\n      const branches = await git.listBranches({ fs, dir: repoRoot });\n      return Promise.all(\n        branches.map(async (branch) => ({\n          name: branch,\n          trackingBranch: await getTrackingBranch({\n            fs,\n            dir: repoRoot,\n            localBranchName: branch,\n          }),\n        }))\n      );\n    },\n});\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesState = selectorFamily({\n  key: \"vcs/repoRemoteBranches\",\n  get: (repoRoot: string) => async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  },\n});\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesState = selectorFamily<RepoBranches, string>({\n  key: \"vcs/repoBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({ get }) => {\n      const currentBranchName = get(repoCurrentBranchNameState(repoRoot));\n      const localBranches = get(repoLocalBranchesState(repoRoot));\n      return {\n        repoRoot,\n        currentBranch:\n          localBranches.find((branch) => branch.name === currentBranchName) ||\n          null,\n        localBranches: localBranches,\n        remoteBranches: get(repoRemoteBranchesState(repoRoot)),\n      };\n    },\n});\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameState = selectorFamily({\n  key: \"vcs/repoCurrentBranch\",\n  get: (repoRoot: string) => () => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  },\n});\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesState = selector<RepoBranches[]>({\n  key: \"vcs/allBranches\",\n  get: ({ get }) => {\n    const repoRoots = get(vcsRootsState);\n    return repoRoots.map(({ dir: repoRoot }) =>\n      get(repoBranchesState(repoRoot))\n    );\n  },\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathState = selectorFamily<string | null, string>({\n  key: \"gitBranchForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      const root = get(vcsRootForFile(filepath));\n      return root\n        ? get(repoBranchesState(root)).currentBranch?.name || null\n        : null;\n    },\n});\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\ntype MaybeArray<T> = Array<T> | T;\nconst maybeArray = <T>(input: MaybeArray<T> | undefined): Array<T> =>\n  Array.isArray(input) ? input : input ? [input] : [];\ninterface BranchStorage {\n  map: MaybeArray<{\n    entry: {\n      \"@type\": \"LOCAL\" | \"REMOTE\";\n      value: {\n        list: MaybeArray<{\n          \"branch-info\": {\n            \"@repo\": string;\n            \"@source\": string;\n          };\n        }>;\n      };\n    };\n  }>;\n}\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\ninterface GitSettingsStorage {\n  \"favorite-branches\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n  \"exclude-from-favorite\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n}\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    maybeArray(branchStorage?.map).flatMap<BranchInfo>((entry) =>\n      maybeArray(entry?.entry.value.list).map(\n        ({ \"branch-info\": { \"@source\": branchName, \"@repo\": repoRoot } }) => ({\n          branchType: entry?.entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction toBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      entry: {\n        \"@type\": branchType as BranchType,\n        value: {\n          list: branches.map((branch) => ({\n            \"branch-info\": {\n              \"@repo\": branch.repoRoot,\n              \"@source\": branch.branchName,\n            },\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: entries,\n  };\n}\n\nconst branchInfoArrayChecker = array(\n  object({\n    branchType: union(literal(\"LOCAL\"), literal(\"REMOTE\")),\n    branchName: string(),\n    repoRoot: string(),\n  })\n);\n\nconst favoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"favorite-branches\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nexport const isFavoriteBranchState = selectorFamily({\n  key: \"vcs/branches/isFavorite\",\n  get:\n    (branchInfo: BranchInfo) =>\n    ({ get }) => {\n      return isFavorite(\n        get(favoriteBranchesState),\n        get(excludedFromFavoriteBranchesState),\n        branchInfo\n      );\n    },\n});\n\nconst excludedFromFavoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite-excluded\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"exclude-from-favorite\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      (\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          snapshot.getLoadable(favoriteBranchesState).getValue(),\n          snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesState, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesState, add);\n          }\n        } else {\n          set(favoriteBranchesState, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesState, add);\n          }\n        }\n      },\n    []\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useRecoilValue(favoriteBranchesState);\n  const excludedFromFavoriteBranches = useRecoilValue(\n    excludedFromFavoriteBranchesState\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string, checkout: boolean = true) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            refresh(repoBranchesState(repoRoot));\n          }\n        );\n      },\n    []\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useRecoilCallback(\n    ({ refresh, snapshot }) =>\n      async (repoRoot: string, branchName: string, newBranchName: string) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            snapshot.getLoadable(favoriteBranchesState).getValue(),\n            snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n    []\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (repoRoot: string, branchName: string, remote?: string) => {\n        const { refresh, snapshot, set } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        refresh(dirContentState(repoRoot));\n        const openedFiles = snapshot.getLoadable(editorTabsState).getValue();\n        const existingOpenedFile = await asyncFilter(\n          ({ filePath }) => reloadFileFromDisk(filePath),\n          openedFiles\n        );\n        set(editorTabsState, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n    []\n  );\n}\n\nexport function useDeleteBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string) => {\n        return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n          refresh(repoBranchesState(repoRoot));\n        });\n      },\n    []\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathState } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useRecoilValue(branchForPathState(repo.dir));\n  return <>{branch}</>;\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React, { ForwardedRef, HTMLAttributes } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.2rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useRecoilValue(vcsRootsState).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = React.forwardRef(\n  (\n    {\n      rootPath,\n      ...props\n    }: {\n      rootPath: string;\n    } & HTMLAttributes<HTMLSpanElement>,\n    ref: ForwardedRef<HTMLElement>\n  ) => (\n    <StyledRepoColorSquare\n      ref={ref}\n      {...props}\n      style={{ ...props.style, backgroundColor: useRepoRootColor(rootPath) }}\n    />\n  )\n);\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(\n      // FIXME: color-mix algorithm used here seems to be different from how colors are mixed in the reference impl.\n      `color-mix(in srgb, ${theme.color(\n        \"VersionControl.Log.Commit.currentBranchBackground\",\n        theme.dark ? \"rgb(63, 71, 73)\" : \"rgb(228, 250, 255)\"\n      )}, ${theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )} ${\n        (theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08) * 100\n      }%)`\n    )};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport path, { basename } from \"path\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { RepoColorIcon } from \"../StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"../StyledCurrentBranchTag\";\nimport { Change } from \"../Change\";\nimport {\n  ChangeNode,\n  ChangesTreeNode,\n  DefaultChangesTreeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./ChangeTreeNode\";\nimport { StatusColor } from \"../../FileStatusColor\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\nexport type NodeRenderer<T extends ChangesTreeNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nexport function formatFileCount(fileCount: number) {\n  return fileCountMsg.format({ fileCount });\n}\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeRenderer: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  return (\n    <ItemLayout.Hint>\n      {node.showPath && path.dirname(Change.path(node.change))}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeRenderer: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(Change.path(node.change)),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(Change.path(node.change))} />\n      <StatusColor status={Change.type(node.change)}>\n        <HighlightedTextValue />\n      </StatusColor>\n      {Change.isRename(node.change) &&\n        ` - renamed from ${basename(node.change.before.path)}`}\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\ntype NodeRenderersMap<T extends ChangesTreeNode<any>> = {\n  [type in T[\"type\"]]: NodeRenderer<T & { type: type }>;\n};\n\nconst defaultNodeRenderers: NodeRenderersMap<DefaultChangesTreeNode> = {\n  repo: repoNodeRenderer,\n  directory: directoryNodeRenderer,\n  change: changeNodeRenderer,\n};\n\nexport const simpleGroupingRenderer =\n  <T extends ChangesTreeNode<any>>(\n    getText: (node: T) => string\n  ): NodeRenderer<T> =>\n  (node, { fileCount }) => ({\n    textValue: getText(node),\n    rendered: (\n      <ItemLayout>\n        <HighlightedTextValue />\n        <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      </ItemLayout>\n    ),\n  });\n\nexport const createChangesTreeNodeRenderer = <T extends ChangesTreeNode<any>>(\n  renderers: Omit<\n    NodeRenderersMap<T>,\n    keyof NodeRenderersMap<DefaultChangesTreeNode>\n  >,\n  /**\n   * Not so nice signature, but couldn't make it work with a single argument in a way that:\n   * - allows for optionally overriding the default renderers\n   * - infers the type of the resulting renderer based on additional keys passed in `renderers`\n   */\n  defaultRendererOverrides?: Partial<NodeRenderersMap<DefaultChangesTreeNode>>\n) => {\n  const nodeRenderers: NodeRenderersMap<T> = {\n    ...defaultNodeRenderers,\n    ...defaultRendererOverrides,\n    ...renderers,\n  };\n  const getItemProps = ({\n    node,\n    fileCountsMap,\n  }: {\n    node: T;\n    fileCountsMap: Map<Key, number>;\n  }): ItemProps<T> & { key: Key } => {\n    // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n    // to node types\n    const nodeRenderer: NodeRenderer<T> =\n      nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n    const { textValue, rendered } = nodeRenderer(node, {\n      fileCount: fileCountsMap.get(node.key) || 0,\n      dirCount: 0, // It seems it's only used for ignored files subtree\n    });\n    return {\n      key: node.key,\n      childItems: isGroupNode(node) ? (node.children as T[]) : [],\n      hasChildItems: isGroupNode(node) && node.children?.length > 0,\n      textValue,\n      children: rendered,\n    };\n  };\n  return {\n    getItemProps,\n    getTextValue: (\n      node: T,\n      { fileCountsMap }: { fileCountsMap: Map<Key, number> }\n    ) => {\n      const nodeRenderer: NodeRenderer<T> =\n        nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n      return nodeRenderer(node, {\n        fileCount: fileCountsMap.get(node.key) || 0,\n        dirCount: 0, // It seems it's only used for ignored files subtree\n      }).textValue;\n    },\n    itemRenderer:\n      ({ fileCountsMap }: { fileCountsMap: Map<Key, number> }) =>\n      (node: T) =>\n        <Item {...getItemProps({ node, fileCountsMap })} />,\n  };\n};\n","import { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { ChangeListNode, ChangesViewTreeNode } from \"./ChangesView.state\";\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n} from \"../ChangesTree/changesTreeNodeRenderers\";\n\nconst changeListNodeRenderer: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}{\" \"}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nexport const changesViewTreeNodeRenderer =\n  createChangesTreeNodeRenderer<ChangesViewTreeNode>({\n    changelist: changeListNodeRenderer,\n  });\n","import React, { Key, RefObject } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n  expandedKeysState,\n  includedChangesNestedSelection,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { Change } from \"../Change\";\nimport { isGroupNode } from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"./changesViewTreeNodeRenderer\";\n\nfunction findPathsUnderNode(node: ChangesViewTreeNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [Change.path(node.change)];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } = useRecoilValue(\n    changesTreeNodesState\n  );\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const nestedSelection = useRecoilValue(includedChangesNestedSelection);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useRecoilCallback(\n    ({ snapshot }) =>\n      (key: Key) => {\n        const changeNode = snapshot\n          .getLoadable(changesTreeNodesState)\n          .getValue()\n          .byKey.get(key);\n        if (changeNode?.type === \"change\") {\n          openPath(Change.path(changeNode.change));\n        }\n        return changeNode;\n      },\n    []\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        treeRef={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = changesViewTreeNodeRenderer.getItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  IconButtonWithMenu,\n  PlatformIcon,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu menuProps={menuProps} actions={actions} />\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionTooltip,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\ninterface Grouping<K extends string> {\n  id: K;\n  title: string;\n  isActive: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function GroupByActionButton<K extends string>({\n  groupings,\n  onToggle,\n}: {\n  groupings: Array<Grouping<K>>;\n  onToggle: (id: K) => void;\n}) {\n  //  TODO: Generalize and make action\n  if (groupings.length === 1 && groupings[0].icon) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={`Group By ${groupings[0].title}`} />\n        }\n      >\n        <IconButton\n          isPressed={groupings[0].isActive}\n          onPress={() => onToggle(groupings[0].id)}\n        >\n          {groupings[0].icon}\n        </IconButton>\n      </TooltipTrigger>\n    );\n  }\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            <Menu\n              {...menuProps}\n              selectedKeys={groupings\n                .filter(({ isActive }) => isActive)\n                .map(({ id }) => id)}\n              onAction={(key) => {\n                const id = groupings.find(({ id }) => id === key)?.id;\n                if (id) {\n                  onToggle(id);\n                }\n              }}\n            >\n              <Section title=\"Group By\">\n                {groupings.map(({ id, title }) => (\n                  <Item key={id}>{title}</Item>\n                ))}\n              </Section>\n            </Menu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../../GroupByActionButton\";\nimport {\n  changesViewGroupingsState,\n  changesGroupingActiveState,\n  GroupingIds,\n} from \"../ChangesView.state\";\n\nexport const ChangesGroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const groupings = useRecoilValue(changesViewGroupingsState);\n\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: GroupingIds) => {\n        set(changesGroupingActiveState(id), (value) => !value);\n      },\n    []\n  );\n\n  return <GroupByActionButton groupings={groupings} onToggle={toggleGroup} />;\n};\n","import React from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport {\n  showIgnoredFilesState,\n  showRelatedFilesState,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useRecoilState(\n    showRelatedFilesState\n  );\n  const [showIgnoredFiles, setShowIgnoredFiles] = useRecoilState(\n    showIgnoredFilesState\n  );\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { ChangesGroupByActionButton } from \"./ActionButtons/ChangesGroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\nimport React from \"react\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar border=\"bottom\">\n      <ActionButton actionId={VcsActionIds.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <ChangesGroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { atom, selector, useRecoilCallback, useSetRecoilState } from \"recoil\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksState = atom<Task[]>({\n  key: \"tasks.list\",\n  default: [],\n});\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskState = selector<Task | null>({\n  key: \"tasks.first\",\n  get: ({ get }) => get(tasksState)[0],\n});\n\n/**\n * Optimized recoil value to get the number of tasks, if the tasks are not needed.\n */\nexport const taskCountState = selector<number>({\n  key: \"tasks.count\",\n  get: ({ get }) => get(tasksState).length,\n});\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetRecoilState(tasksState);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useRecoilCallback(({ snapshot }) => (id: Task[\"id\"]) => {\n    const task = snapshot\n      .getLoadable(tasksState)\n      .getValue()\n      .find((task) => task.id === id);\n    if (task) {\n      task.abortController.abort();\n    }\n  });\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useRecoilCallback } from \"recoil\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport React from \"react\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useUpdateVcsFileStatuses,\n  vcsRootForFile,\n} from \"../../file-status.state\";\nimport { useRefreshChanges } from \"../change-lists.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdState } from \"./ChangesView.state\";\nimport { Change } from \"../Change\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshChanges = useRefreshChanges();\n  const refreshFileStatus = useUpdateVcsFileStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useRecoilCallback(\n    ({ snapshot, set }) =>\n      (changes: readonly Change[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = Change.path(change);\n                      const repoRoot = snapshot\n                        .getLoadable(vcsRootForFile(filePath))\n                        .getValue();\n                      const content = await fs.promises.readFile(filePath);\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      files: updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                  }\n                )\n              ).then(\n                () => {\n                  // TODO: file status state and changes state separately use statusMatrix. It can be refactored for\n                  //  changes to be based on file status state.\n                  refreshChanges().catch(console.error);\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdState, null);\n            },\n          }\n        );\n        set(commitTaskIdState, taskId);\n      },\n    [refreshChanges]\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n * TODO: support removing files by null as content\n */\nexport async function commitFiles({\n  files,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  files: { [filePath: string]: Uint8Array };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(files).map(async ([filePath, blob]) => {\n      const entry = entries.find(({ path }) => path === filePath);\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n    })\n  );\n\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(files).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitState,\n  commitErrorMessageState,\n  commitMessageState,\n  commitTaskIdState,\n  includedChangesState,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useRecoilState(commitMessageState);\n  const commit = useCommitChanges();\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useRecoilState(\n    commitErrorMessageState\n  );\n  const commitTaskId = useRecoilValue(commitTaskIdState);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useRecoilCallback(({ snapshot }) => {\n    const includedChanges = snapshot\n      .getLoadable(includedChangesState)\n      .getValue();\n    const commitMessage = snapshot.getLoadable(commitMessageState).getValue();\n    return () => {\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (snapshot.getLoadable(amendCommitState).getValue()) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    };\n  }, []);\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n        >\n          Commit\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented}>\n          Commit and Push...\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { StatusColor } from \"../FileStatusColor\";\nimport { Change } from \"./Change\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<Change>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => Change.type(change) === \"MODIFIED\"\n  ).length;\n  const addedCount = changes.filter(\n    (change) => Change.type(change) === \"ADDED\"\n  ).length;\n  const deletedCount = changes.filter(\n    (change) => Change.type(change) === \"DELETED\"\n  ).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitState, includedChangesState } from \"./ChangesView.state\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useRecoilValue(includedChangesState);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useRecoilState(amendCommitState);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={setAmend}\n              preventFocus\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { useRecoilState } from \"recoil\";\n\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport React, { useRef } from \"react\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const [commitMessageSize, setCommitMessageSize] = useRecoilState(\n    commitMessageSizeState(orientation)\n  );\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={treeActions}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React, { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { useRefreshChanges } from \"../change-lists.state\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const refresh = useRefreshChanges();\n  useEffect(() => {\n    refresh();\n  }, []);\n  return (\n    <StyledContainer>\n      <ChangesViewSplitter />\n    </StyledContainer>\n  );\n};\n","import path from \"path\";\nimport React from \"react\";\n\nimport { LocalBranch } from \"./Branches/branches.state\";\n\nexport function TrackingBranchInfo({\n  branches,\n}: {\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n}) {\n  return (\n    <table style={{ borderSpacing: 0 }}>\n      {branches.map(({ branch, repoRoot }) => {\n        const mapping = branch.trackingBranch\n          ? `${branch.name}  ${branch.trackingBranch}`\n          : branches.length > 1\n          ? `${branch.name} (no tracking branch)`\n          : \"No tracking branch\";\n\n        return branches.length > 1 ? (\n          <tr key={repoRoot}>\n            <td>{path.basename(repoRoot)}: &nbsp;</td>\n            <td>{mapping}</td>\n          </tr>\n        ) : (\n          <tr key={repoRoot}>\n            <td>{mapping}</td>\n          </tr>\n        );\n      })}\n    </table>\n  );\n}\n","import React from \"react\";\nimport { selector, useRecoilValue } from \"recoil\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { allChangesState } from \"./Changes/change-lists.state\";\nimport { vcsRootForFile } from \"./file-status.state\";\nimport { LocalBranch, repoBranchesState } from \"./Branches/branches.state\";\nimport { changesGroupingActiveState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { TrackingBranchInfo } from \"./TrackingBranchInfo\";\nimport { Change } from \"./Changes/Change\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesState = selector({\n  key: \"vcs/commitToolWindow/changedRepos\",\n  get: ({ get }): Array<{ repoRoot: string; branch: LocalBranch }> => {\n    const changesRepoRoots = get(allChangesState)\n      .map((change) => get(vcsRootForFile(Change.path(change))))\n      .filter(notNull);\n\n    return changesRepoRoots\n      .map((repoRoot) => {\n        const branch = get(repoBranchesState(repoRoot)).currentBranch;\n        return branch\n          ? {\n              repoRoot,\n              branch,\n            }\n          : null;\n      })\n      .filter(notNull);\n  },\n});\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useRecoilValue(\n    changesGroupingActiveState(\"repository\")\n  );\n  const changesBranches = useRecoilValue(changesBranchesState);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={changesBranches} />}\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledHeader = styled.div`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  height: 2.0625rem;\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n  flex-shrink: 0;\n`;\nexport const StyledSpacer = styled.div`\n  flex-grow: 1;\n`;\nexport const StyledPlaceholderContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n  align-items: center;\n  gap: 0.25rem;\n  min-height: 37%;\n  overflow: hidden;\n`;\n","export type DateRange = { from?: Date; to?: Date };\nexport const dateToString = (date: Date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date\n    .getFullYear()\n    .toString()\n    .slice(-2)}`;\n};\nexport const dateRangeToString = (dateRange: DateRange): string => {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n};\n","import { mapObjIndexed } from \"ramda\";\nimport {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  RecoilState,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\n\nimport { DateRange, dateRangeToString } from \"./DateRange\";\n\nexport const vcsTabKeysState = atom<string[]>({\n  key: \"vcs/log/tabs/keys\",\n  default: [\"MAIN\"],\n});\n\nexport const vcsActiveTabKeyState = atom<string>({\n  key: \"vcs/log/tabs/activeKey\",\n  default: \"MAIN\",\n});\n\n/**\n * The title of a VCS log tab\n */\nexport const vcsTabTitleState = selectorFamily({\n  key: \"vcs/logs/tab/title\",\n  get:\n    (key: string) =>\n    ({ get }) => {\n      const searchQuery = get(vcsLogFilter.searchQuery(key));\n      const user = get(vcsLogFilter.user(key));\n      const date = get(vcsLogFilter.date(key));\n      const branches = get(vcsLogFilter.branch(key));\n      const parts: { short: string; long: string }[] = [];\n\n      if (branches?.length > 0) {\n        parts.push({\n          short: branches.join(\", \"),\n          long: `on ${branches.join(\", \")}`,\n        });\n      }\n      if (date) {\n        parts.push({\n          short: dateRangeToString(date),\n          long: `made ${dateRangeToString(date)}`,\n        });\n      }\n      if (searchQuery) {\n        parts.push({\n          short: `'${searchQuery}'`,\n          long: `containing '${searchQuery}'`,\n        });\n      }\n      if (user) {\n        parts.push({\n          short: user,\n          long: `by ${user}`,\n        });\n      }\n\n      return `Log${parts.length > 0 ? \": \" : \"\"}${\n        parts.length === 1\n          ? parts[0].short\n          : parts.map((part) => part.long).join(\" \")\n      }`;\n    },\n});\n\nconst tabStats: Array<(tabKey: string) => RecoilState<unknown>> = [];\n\n/**\n * marks a recoil state as a piece of state for VCS log tabs, so that it's cleaned up when the tab is closed.\n * @param someAtomFamily\n */\nexport const vcsLogTabState = <T extends (tabKey: string) => RecoilState<any>>(\n  someAtomFamily: T\n): T => {\n  tabStats.push(someAtomFamily);\n  return someAtomFamily;\n};\n\n/**\n * Whether branches filter is visible for a VCS log tab\n */\nexport const vcsLogTabShowBranches = vcsLogTabState(\n  atomFamily<boolean, string>({\n    key: \"vcs/logs/filter/showBranches\",\n    default: false,\n  })\n);\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetails = vcsLogTabState(\n  atomFamily<boolean, string>({\n    key: \"vcs/logs/showCommitDetails\",\n    default: true,\n  })\n);\n\nexport const CURRENT_USER_FILTER_VALUE = \"*\";\nexport const vcsLogFilter = {\n  /**\n   * The state of search query, for a VCS log tab\n   */\n  searchQuery: vcsLogTabState(\n    atomFamily<string, string>({\n      key: \"vcs/logs/filter/searchQuery\",\n      default: \"\",\n    })\n  ),\n  /**\n   * The state of whether \"match case\" is on the search query, for a VCS log tab\n   */\n  matchCase: vcsLogTabState(\n    atomFamily<boolean, string>({\n      key: \"vcs/logs/filter/matchCase\",\n      default: false,\n    })\n  ),\n  /**\n   * The state of whether \"regexp\" is on the search query, for a VCS log tab\n   */\n  regExp: vcsLogTabState(\n    atomFamily<boolean, string>({\n      key: \"vcs/logs/filter/regExp\",\n      default: false,\n    })\n  ),\n  /**\n   * The state of user filter, for a VCS log tab\n   */\n  user: vcsLogTabState(\n    atomFamily<string | null, string>({\n      key: \"vcs/logs/filter/user\",\n      default: null,\n    })\n  ),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  date: atomFamily<DateRange | null, string>({\n    key: \"vcs/logs/filter/date\",\n    default: null,\n  }),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  branch: vcsLogTabState(\n    atomFamily<string[], string>({\n      key: \"vcs/logs/filter/branch\",\n      default: [],\n    })\n  ),\n};\n\ntype FamilyToAtom<F> = F extends (param: any) => RecoilState<infer S>\n  ? RecoilState<S>\n  : never;\n\ntype VcsLogFilter = typeof vcsLogFilter;\n\nexport const vcsLogFilterCurrentTab = mapObjIndexed((atomFamily, key) => {\n  return selector({\n    key: `vcs/logs/currentTabFilter/${key}`,\n    get: ({ get }) =>\n      get(atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>),\n    set: ({ set, get }, newValue) => {\n      set(\n        atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>,\n        newValue\n      );\n    },\n  });\n}, vcsLogFilter) as {\n  [key in keyof VcsLogFilter]: FamilyToAtom<VcsLogFilter[key]>;\n};\n\nexport const useResetFilters = () =>\n  useRecoilCallback(\n    ({ reset }) =>\n      (tabKey: string) => {\n        Object.values(vcsLogFilter)\n          .map((state) => state(tabKey))\n          .forEach(reset);\n      },\n    []\n  );\n\nconst closeTabCallback =\n  ({ set, snapshot, reset }: CallbackInterface) =>\n  (tabKey: string) => {\n    const tabs = snapshot.getLoadable(vcsTabKeysState).getValue();\n    const currentActiveTabKey = snapshot\n      .getLoadable(vcsActiveTabKeyState)\n      .getValue();\n    if (currentActiveTabKey === tabKey) {\n      // make sure the active tab key remains valid, by switching to previous tab. In the reference implementation\n      // the previously activated tab will be activated instead of the previous one index-wise, but it's a\n      // negligible and easy-to-fix difference.\n      set(\n        vcsActiveTabKeyState,\n        tabs[tabs.findIndex((key) => key === tabKey) - 1] || tabs[0]\n      );\n    }\n    set(vcsTabKeysState, (keys) => keys.filter((key) => key !== tabKey));\n    tabStats.forEach((state) => reset(state(tabKey)));\n  };\n\nexport function useCloseVcsTab() {\n  return useRecoilCallback(closeTabCallback, []);\n}\n","import { selectorFamily } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport const resolvedRefState = selectorFamily<\n  string,\n  { repoRoot: string; ref: string }\n>({\n  key: \"vcs/resolved-branche-ref\",\n  get:\n    ({ repoRoot, ref }: { repoRoot: string; ref: string }) =>\n    () => {\n      return git.resolveRef({ fs, dir: repoRoot, ref, depth: 3 });\n    },\n});\n","import git, { ReadCommitResult } from \"isomorphic-git\";\nimport { sort } from \"ramda\";\n\ntype Fs = Parameters<typeof git[\"readCommit\"]>[0][\"fs\"];\n\nconst cache = {};\nexport const commitDateComparator = (\n  a: ReadCommitResult,\n  b: ReadCommitResult\n) => b.commit.committer.timestamp - a.commit.committer.timestamp;\n\ntype CommitWithMeta = {\n  repoPath: string;\n  /**\n   * refs this commit contains in\n   */\n  containingRefs: Set<string>;\n  readCommitResult: ReadCommitResult;\n};\n\ntype RepoDescriptor = {\n  repoPath: string;\n  isBare?: boolean;\n};\n/**\n * Similar to git.log(...), but:\n * - supports multiple repos and multiple refs per repo.\n * - for each commit, includes the list of refs the commit is a part of\n * Commits are sorted by commit time, from new to old.\n */\nexport async function readCommits(\n  fs: Fs,\n  ...sources: Array<\n    RepoDescriptor & {\n      refs: string[];\n    }\n  >\n) {\n  const allCommits: Array<CommitWithMeta> = [];\n  const commitsMap: Record<string, CommitWithMeta> = {};\n  let commitsToProcess: Array<CommitWithMeta & RepoDescriptor> = [];\n\n  commitsToProcess.forEach((item) => {\n    commitsMap[item.readCommitResult.oid] = item;\n  });\n  const initialCommits = await Promise.all(\n    sources.flatMap(({ refs, repoPath, isBare }) =>\n      refs.map(async (ref) => {\n        const commit = await git\n          .resolveRef({\n            ...getCommonArgs({ repoPath, isBare }),\n            ref,\n            depth: 3,\n          })\n          .then((oid) =>\n            git.readCommit({\n              ...getCommonArgs({ repoPath, isBare }),\n              oid,\n            })\n          );\n        return { repoPath, isBare, commit, refs: new Set([ref]) };\n      })\n    )\n  );\n\n  sort(\n    ({ commit: c1 }, { commit: c2 }) => commitDateComparator(c1, c2),\n    initialCommits\n  ).forEach(({ commit, refs, repoPath, isBare }) =>\n    addCommit({ repoPath, isBare }, commit, -1, refs)\n  );\n\n  while (commitsToProcess.length > 0) {\n    const {\n      readCommitResult: latestCommit,\n      repoPath,\n      isBare,\n      containingRefs,\n    } = commitsToProcess.shift()!; // non-null assertion because of length>0;\n    allCommits.push({\n      repoPath,\n      readCommitResult: latestCommit,\n      containingRefs: containingRefs,\n    });\n    const parentCommits = await Promise.all(\n      latestCommit.commit.parent.map((oid) =>\n        git.readCommit({\n          ...getCommonArgs({ repoPath, isBare }),\n          oid,\n        })\n      )\n    );\n    // insert new parents in the right place so that commitsToProcess remains sorted.\n    parentCommits.forEach((commit) => {\n      const index = commitsToProcess.findIndex(\n        ({ readCommitResult: aCommit }) =>\n          commitDateComparator(aCommit, commit) > 0\n      );\n      addCommit({ repoPath, isBare }, commit, index, containingRefs);\n    });\n  }\n  return allCommits;\n\n  function addCommit(\n    { repoPath, isBare }: RepoDescriptor,\n    commit: ReadCommitResult,\n    index: number,\n    refs: Set<string>\n  ) {\n    if (commitsMap[commit.oid]) {\n      commitsMap[commit.oid].containingRefs = new Set([\n        ...commitsMap[commit.oid].containingRefs,\n        ...refs,\n      ]);\n    } else {\n      const entry: CommitWithMeta & RepoDescriptor = {\n        readCommitResult: commit,\n        containingRefs: commitsMap[commit.oid]\n          ? new Set([...commitsMap[commit.oid].containingRefs, ...refs])\n          : refs,\n        repoPath,\n        isBare,\n      };\n      commitsMap[commit.oid] = entry;\n      commitsToProcess.splice(\n        index >= 0 ? index : commitsToProcess.length,\n        0,\n        entry\n      );\n    }\n  }\n  function getCommonArgs({\n    repoPath,\n    isBare,\n  }: {\n    repoPath: string;\n    isBare?: boolean;\n  }) {\n    return {\n      fs,\n      cache,\n      [isBare ? \"gitdir\" : \"dir\"]: repoPath,\n    };\n  }\n}\n","import { ReadCommitResult } from \"isomorphic-git\";\nimport { atom, atomFamily, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { allBranchesState } from \"../../Branches/branches.state\";\nimport { resolvedRefState } from \"../../refs.state\";\nimport { readCommits } from \"./readCommits\";\nimport { GitRef } from \"../GitRef\";\nimport { indexBy } from \"ramda\";\n\nfunction match(\n  input: string,\n  query: string,\n  flags: { matchCase?: boolean; regExp?: boolean } = {}\n) {\n  if (flags.regExp) {\n    return new RegExp(query, flags.matchCase ? \"\" : \"i\").test(input);\n  }\n  if (!flags.matchCase) {\n    return input.toLowerCase().includes(query.toLowerCase());\n  }\n  return input.includes(query);\n}\n\ntype CommitLogItem = {\n  readCommitResult: ReadCommitResult;\n  containingRefs: Set<string>;\n  repoPath: string;\n};\n\nexport const allCommitsState = selector<Array<CommitLogItem>>({\n  key: \"vcs/allRepoCommits\",\n  get: ({ get }) =>\n    // TODO: readCommit can take too long. Suspending anything that depends on it leads to poor UX. would be nicer\n    //  to have the state updated (like an atom instead of selector) when commits are read, instead of query inside\n    //  the selector. But the challenge is that it does depend on another piece of state, allBranchesState\n    readCommits(\n      fs,\n      ...get(allBranchesState).map(\n        ({ repoRoot, localBranches, remoteBranches }) => ({\n          repoPath: repoRoot,\n          refs: [\"HEAD\"]\n            .concat(localBranches.map((branch) => branch.name))\n            .concat(\n              remoteBranches.map((branch) => `${branch.remote}/${branch.name}`)\n            ),\n        })\n      )\n    ),\n});\n\nexport const commitsTableRowsState = selector({\n  key: \"vcs/log/rows\",\n  get: ({ get }) => {\n    const searchQuery = get(vcsLogFilterCurrentTab.searchQuery);\n    const branches = get(vcsLogFilterCurrentTab.branch);\n    const flags = {\n      matchCase: get(vcsLogFilterCurrentTab.matchCase),\n      regExp: get(vcsLogFilterCurrentTab.regExp),\n    };\n    const dateFilter = get(vcsLogFilterCurrentTab.date);\n\n    const rows = get(allCommitsState)\n      .filter(\n        ({ containingRefs }) =>\n          !branches?.length ||\n          branches.some((branch) => containingRefs.has(branch))\n      )\n      .filter(\n        ({ readCommitResult: { commit } }) =>\n          (!dateFilter?.from ||\n            commit.author.timestamp * 1000 > dateFilter.from.getTime()) &&\n          (!dateFilter?.to ||\n            commit.author.timestamp * 1000 < dateFilter.to.getTime())\n      )\n      .filter(\n        ({ readCommitResult: { commit } }) =>\n          !searchQuery ||\n          match(commit.message, searchQuery, flags) ||\n          match(commit.tree, searchQuery, { matchCase: false })\n      );\n    return {\n      rows,\n      byOid: indexBy(({ readCommitResult: commit }) => commit.oid, rows),\n    };\n  },\n});\n\nexport const allResolvedRefsState = selector({\n  key: \"vcs/logs/all-refs\",\n  get: ({ get }) => {\n    const repoBranches = get(allBranchesState);\n    const refs: Record<string, GitRef[]> = {};\n    const addRef = (ref: string, value: GitRef) => {\n      refs[ref] = refs[ref] || [];\n      refs[ref].push(value);\n    };\n    repoBranches.forEach(({ repoRoot }) => {\n      addRef(get(resolvedRefState({ repoRoot, ref: \"HEAD\" })), {\n        type: \"head\",\n        name: \"HEAD\",\n      });\n    });\n    repoBranches.forEach(({ repoRoot, localBranches, currentBranch }) => {\n      localBranches.forEach((branch) => {\n        addRef(get(resolvedRefState({ repoRoot, ref: branch.name })), {\n          type: \"localBranch\",\n          name: branch.name,\n          isCurrent: currentBranch?.name === branch.name,\n          trackingBranch: branch.trackingBranch,\n        });\n      });\n    });\n    repoBranches.forEach(({ repoRoot, remoteBranches }) =>\n      remoteBranches.forEach((branch) => {\n        const branchName = `${branch.remote}/${branch.name}`;\n        addRef(get(resolvedRefState({ repoRoot, ref: branchName })), {\n          type: \"remoteBranch\",\n          name: branchName,\n        });\n      })\n    );\n    return refs;\n  },\n});\n\n/**\n * selection state of the commits table\n * TODO: make it per-tab\n */\nexport const commitsSelectionState = atom<Selection>({\n  key: \"vcs/log/commits/selection\",\n  default: new Set([]),\n});\n\n/**\n * OIDs of the selected commits in commits table.\n */\nexport const selectedCommitOids = selector({\n  key: `${commitsSelectionState.key}/keys`,\n  get: ({ get }) => {\n    const selection = get(commitsSelectionState);\n    if (selection === \"all\") {\n      return get(commitsTableRowsState).rows.map(\n        ({ readCommitResult: { oid } }) => oid\n      );\n    }\n    return [...selection].map((i) => `${i}`);\n  },\n});\n\nexport const selectedCommitsState = selector({\n  key: `${commitsSelectionState.key}/items`,\n  get: ({ get }) =>\n    get(selectedCommitOids).map((oid) => get(commitsTableRowsState).byOid[oid]),\n});\n\n/**\n * Selected commit in the commits table. The first row, if multiple rows are selected\n */\nexport const selectedCommitState = selector({\n  key: \"vcs/log/details/selectedCommit\",\n  get: ({ get }) => {\n    const oid = get(selectedCommitOids)[0];\n    return (oid && get(commitsTableRowsState).byOid[oid]) || null;\n  },\n});\n\nexport const vcsTableShowCommitTimestampState = atom<boolean>({\n  key: \"vcs/log/commits/showCommitTimestamp\",\n  default: false,\n});\n\nexport const vcsTableReferencesOnTheLeftState = atom<boolean>({\n  key: \"vcs/log/commits/referencesOnTheLeft\",\n  default: false,\n});\n\nexport const vcsTableHighlightMyCommitsState = atom<boolean>({\n  key: \"vcs/log/commits/highlightMyCommits\",\n  default: false,\n});\n\nexport const authorColumn = {\n  id: \"Default.Author\",\n  name: \"Author\",\n};\nexport const hashColumn = {\n  id: \"Default.Hash\",\n  name: \"Hash\",\n};\n\nexport const dateColumn = {\n  id: \"Date.Date\",\n  name: \"Date\",\n};\n\nconst defaultVisibleColumns = [authorColumn.id, dateColumn.id];\nexport const vcsTableColumnsVisibilityState = atomFamily<boolean, string>({\n  key: \"vcs/log/commits/highlightMyCommits\",\n  default: (id) => defaultVisibleColumns.includes(id),\n});\n","import React from \"react\";\n\nexport const parseCommitMessage = (commitMessage: string) => {\n  const lines = commitMessage.split(\"\\n\");\n  const bodyLines = lines.slice(1);\n  return {\n    subject: lines[0],\n    bodyAsString: bodyLines.join(\"\\n\"),\n    body: (\n      <>\n        {bodyLines.map((line, index) => (\n          <React.Fragment key={index}>\n            {index > 0 && <br />}\n            {line}\n          </React.Fragment>\n        ))}\n      </>\n    ),\n  };\n};\n\nexport function shortenOid(oid: string) {\n  return oid.slice(0, 8);\n}\n\nconst commitDateTimeFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitTimeFormatter = new Intl.DateTimeFormat([], {\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitDateFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n});\n\nexport function formatCommitDateTime(date: Date | number) {\n  return commitDateTimeFormatter.format(date).replace(\" \", \"\");\n}\n\nexport function formatCommitDate(date: Date | number) {\n  return commitDateFormatter.format(date);\n}\n\nexport function formatCommitTime(date: Date | number) {\n  return commitTimeFormatter.format(date).replace(\" \", \"\");\n}\n","import path from \"path\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n  simpleGroupingRenderer,\n} from \"../../Changes/ChangesTree/changesTreeNodeRenderers\";\nimport { RepositoryNode } from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { shortenOid } from \"../commit-utils\";\nimport {\n  CommitChangesTreeNode,\n  CommitParentChangeTreeNode,\n} from \"./CommitsChangedFiles.state\";\n\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst commitParentNodeRenderer = simpleGroupingRenderer(\n  (node: CommitParentChangeTreeNode) =>\n    `Changes to ${shortenOid(path.basename(node.oid))} ${node.subject.slice(\n      0,\n      50\n    )}`\n);\nexport const commitChangesTreeNodeRenderer =\n  createChangesTreeNodeRenderer<CommitChangesTreeNode>(\n    {\n      commitParent: commitParentNodeRenderer,\n    },\n    {\n      repo: repoNodeRenderer,\n    }\n  );\n","import { diffLines } from \"diff\";\nimport { Change } from \"./Change\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\n// Read more: https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage\nconst DEFAULT_SIMILARITY_INDEX = 50;\n\n/**\n * Given a list of changes, detects renames based on the change in the content of changes where only `before` or\n * `after` is present, and consolidates them into one change, making it count as a rename.\n * @param changes\n */\nexport async function detectRenames(\n  changes: ReadonlyArray<Change>\n): Promise<Change[]> {\n  const deletions: Change[] = changes.filter(\n    (change) => Change.type(change) === \"DELETED\"\n  );\n  const additions: Change[] = changes.filter(\n    (change) => Change.type(change) === \"ADDED\"\n  );\n\n  const contents = new Map<Change, { before: string; after: string }>();\n  await Promise.all(\n    [...deletions, ...additions].map(async (change) => {\n      contents.set(change, {\n        before: (await change.before?.content()) ?? \"\",\n        after: (await change.after?.content()) ?? \"\",\n      });\n    })\n  );\n\n  const foundRenames: Change[] = [];\n  return changes\n    .map((change): Change | null => {\n      if (foundRenames.includes(change)) {\n        return null;\n      }\n      const type = Change.type(change);\n      if (type === \"DELETED\") {\n        for (const candidate of additions) {\n          const similarity = computeSimilarity(\n            contents.get(candidate)?.after || \"\",\n            contents.get(change)?.before || \"\"\n          );\n          if (similarity >= DEFAULT_SIMILARITY_INDEX) {\n            foundRenames.push(candidate);\n            additions.splice(additions.indexOf(candidate), 1);\n            return {\n              before: change.before,\n              after: candidate.after,\n            };\n          }\n        }\n      }\n      if (type === \"ADDED\") {\n        for (const candidate of deletions) {\n          const similarity = computeSimilarity(\n            contents.get(candidate)?.before || \"\",\n            contents.get(change)?.after || \"\"\n          );\n          if (similarity >= DEFAULT_SIMILARITY_INDEX) {\n            deletions.splice(deletions.indexOf(candidate), 1);\n            foundRenames.push(candidate);\n            return {\n              before: candidate.before,\n              after: change.after,\n            };\n          }\n        }\n      }\n      return change;\n    })\n    .filter(notNull);\n}\n\n// Function to compute similarity\nfunction computeSimilarity(file1Content: string, file2Content: string) {\n  const changes = diffLines(file1Content, file2Content);\n  const { unchanged, total } = changes.reduce(\n    ({ total, unchanged }, change) => {\n      const count = change.count ?? 0;\n\n      return {\n        total: total + count,\n        unchanged: unchanged + (!change.added && !change.removed ? count : 0),\n      };\n    },\n    { total: 0, unchanged: 0 }\n  );\n  return 100 * (unchanged / total);\n}\n","import git from \"isomorphic-git\";\nimport path from \"path\";\n\nimport { Change, Revision } from \"../../Changes/Change\";\nimport { detectRenames } from \"../../Changes/detectRenames\";\n\nconst cache = {}; // FIXME: find a better caching strategy. Per project?\nexport async function getCommitChanges({\n  fromRef,\n  toRef,\n  ...params\n}: {\n  dir?: string;\n  gitdir?: string;\n  fromRef: string;\n  toRef: string;\n} & Pick<Parameters<typeof git[\"walk\"]>[0], \"fs\" | \"dir\" | \"gitdir\">): Promise<\n  Change[]\n> {\n  let items: Change[] = await git.walk({\n    ...params,\n    cache,\n    trees: [git.TREE({ ref: fromRef }), git.TREE({ ref: toRef })],\n    map: async function map(\n      filepath,\n      [before, after]\n    ): Promise<null | boolean | Change> {\n      const afterOid = await after?.oid();\n      const beforeOid = await before?.oid();\n      const afterType = await after?.type();\n      const beforeType = await before?.type();\n      if (afterOid === beforeOid) {\n        return null;\n      }\n      const afterRevision: Revision = {\n        path: path.join(params.dir || \"\", filepath),\n        isDir: afterType === \"tree\",\n        content: async () =>\n          new TextDecoder().decode(\n            (await after?.content()) ?? new Uint8Array()\n          ),\n      };\n      const beforeRevision: Revision = {\n        path: path.join(params.dir || \"\" || \"\", filepath),\n        isDir: beforeType === \"tree\",\n        content: async () =>\n          new TextDecoder().decode(\n            (await before?.content()) ?? new Uint8Array()\n          ),\n      };\n      const type = afterType ?? beforeType;\n      return (\n        type === \"blob\" && {\n          ...(afterOid ? { after: afterRevision } : null),\n          ...(beforeOid ? { before: beforeRevision } : null),\n        }\n      );\n    },\n  });\n\n  return await detectRenames(\n    (items || []).filter((item: boolean | Change) => item)\n  );\n}\n","import React, { Key, RefObject } from \"react\";\nimport { atom, atomFamily, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport { sortTreeNodesInPlace } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport {\n  defaultChangeGroupings,\n  directoryGrouping,\n  getChangesGroupFn,\n} from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changeNode,\n  ChangesTreeGroupNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n} from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { changesTreeNodesResult } from \"../../Changes/ChangesTree/changesTreeNodesResult\";\nimport { ChangeListObj } from \"../../Changes/change-lists.state\";\nimport {\n  commitsTableRowsState,\n  selectedCommitsState,\n} from \"../CommitsView/CommitsTable.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\nimport { getCommitChanges } from \"./getCommitChanges\";\n\nexport const changesGroupingActiveState = atomFamily<boolean, string>({\n  key: \"vcs/log/commits/changes/isGroupingActive\",\n  default: (id) => id === directoryGrouping.id,\n});\n\nexport const commitChangesTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"vcs/log/commits/changes/treeRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const expandedKeysState = atom<Set<Key>>({\n  key: \"vcs/log/commits/changes/expandedKeys\",\n  default: new Set(),\n});\n\nexport const selectionState = atom<Selection>({\n  key: \"vcs/log/commits/changes/selectedKeys\",\n  default: new Set(),\n});\n\nconst COMMIT_PARENT_ID = \"commitParent\";\n\nexport type CommitChangesTreeNode =\n  ExtendedChangesTreeNode<CommitParentChangeTreeNode>;\nexport interface CommitParentChangeTreeNode\n  extends ChangesTreeGroupNode<typeof COMMIT_PARENT_ID, CommitChangesTreeNode> {\n  changeList: ChangeListObj;\n  oid: string;\n  subject: string;\n}\n/**\n * Changes corresponding to the currently selected commits.\n * NOTE: it could be refactored into a selectorFamily, where the selected OIds are\n * passed as parameter, which would allow for caching the result, as the selector\n * would not be reevaluated when the only selection is changed, and the state\n * of the table is not changed.\n */\nexport const changedFilesState = selector({\n  key: \"vcs/log/commits/selection/changes\",\n  get: async ({ get }) => {\n    const selectedCommits = get(selectedCommitsState);\n    const commitLogItem = selectedCommits[0]; // FIXME: take all selected commits into account\n    const { byOid } = get(commitsTableRowsState);\n    const toRef = commitLogItem?.readCommitResult?.oid;\n    if (toRef) {\n      const groupFn = getChangesGroupFn({\n        get,\n        groupings: defaultChangeGroupings,\n        isActive: changesGroupingActiveState,\n      });\n\n      const rootNodes = await Promise.all(\n        commitLogItem?.readCommitResult.commit.parent.map((parent) =>\n          getCommitChanges({\n            fs,\n            fromRef: parent,\n            toRef,\n            dir: commitLogItem.repoPath,\n          }).then(\n            (changes) =>\n              ({\n                type: COMMIT_PARENT_ID,\n                key: changesTreeNodeKey(COMMIT_PARENT_ID, parent),\n                oid: parent,\n                subject: byOid[parent]?.readCommitResult.commit.message || \"\",\n                children: groupFn([...changes].map((node) => changeNode(node))),\n              } as CommitParentChangeTreeNode)\n          )\n        )\n      );\n      const { expandAllKeys, fileCountsMap, ...result } =\n        changesTreeNodesResult(\n          rootNodes.length === 1\n            ? rootNodes[0].children\n            : rootNodes.filter(({ children }) => children.length > 0)\n        );\n\n      type Writeable<T> = { -readonly [P in keyof T]: T[P] };\n      sortTreeNodesInPlace(\n        (node) =>\n          commitChangesTreeNodeRenderer\n            .getTextValue(node, { fileCountsMap })\n            .toLowerCase(),\n        {\n          // cheating with the types by removing readonly constraints to use the inplace sort tree util.\n          // it should be ok, since the ReadonlyArray is only a compile-time thing.\n          roots: result.rootNodes as Writeable<typeof result.rootNodes>,\n          getChildren: (node) =>\n            \"children\" in node\n              ? (node.children as Writeable<typeof node.children>)\n              : null,\n        }\n      );\n\n      return {\n        ...result,\n        fileCountsMap,\n        expandAllKeys: new Set(\n          [...expandAllKeys].filter(\n            (key) => !`${key}`.startsWith(COMMIT_PARENT_ID)\n          )\n        ),\n      };\n    }\n    return null;\n  },\n});\n","import React, { HTMLAttributes, ReactNode, useEffect, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useRecoilValueLoadable } from \"recoil\";\n\nimport {\n  HelpTooltip,\n  PlatformIcon,\n  PositionedTooltipTrigger,\n  SpeedSearchTree,\n  styled,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { selectedCommitsState } from \"../CommitsView/CommitsTable.state\";\nimport {\n  changedFilesState,\n  commitChangesTreeRefState,\n  expandedKeysState,\n  selectionState,\n} from \"./CommitsChangedFiles.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\n\nconst DEFAULT_LOADING_DELAY_MS = 500; // To be shared later in more places.\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  inset: 0;\n  gap: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n/**\n * TODO: handle multiple selected commits (check Changes.ShowChangesFromParents https://github.com/JetBrains/intellij-community/blob/ac57611a0612bd65ba2a19c841a4f95b40591134/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/frame/VcsLogChangesBrowser.java#L255-L254)\n */\nexport function CommitChangedFiles({\n  treeShortcutHandlerProps,\n}: {\n  treeShortcutHandlerProps: HTMLAttributes<HTMLElement>;\n}) {\n  const [selectedCommits] = useLatestRecoilValue(selectedCommitsState);\n  const treeRef = useRecoilValue(commitChangesTreeRefState);\n  const nothingSelected = !selectedCommits?.length;\n  const stateLoadable = useRecoilValueLoadable(changedFilesState);\n  const state = stateLoadable.valueMaybe();\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selection, setSelection] = useRecoilState(selectionState);\n\n  useEffect(() => {\n    // TODO: expanded keys are supposed to be set based on selected keys\n    setExpandedKeys(state?.expandAllKeys ?? new Set());\n    setSelection(new Set());\n    // FIXME: with this being in an effect here, closing and reopening the toolwindow will\n    //  reset the selection, making selection state be effectively like a local state.\n  }, [state]);\n\n  if (nothingSelected) {\n    return (\n      <StyledPlaceholderContainer>\n        Select commits to to view changes\n      </StyledPlaceholderContainer>\n    );\n  }\n  return (\n    <div\n      {...treeShortcutHandlerProps}\n      style={{\n        height: \"-webkit-fill-available\",\n        marginBottom: \"1rem\",\n        position: \"relative\",\n      }}\n    >\n      {stateLoadable.state === \"loading\" && (\n        <Delayed>\n          <StyledLoadingWrapper>\n            <LoadingGif style={{ width: \"1.5rem\" }} />\n            Loading...\n          </StyledLoadingWrapper>\n        </Delayed>\n      )}\n      {state && (\n        <SpeedSearchTree\n          treeRef={treeRef}\n          items={state.rootNodes}\n          selectionMode=\"multiple\"\n          expandedKeys={expandedKeys}\n          onExpandedChange={setExpandedKeys}\n          selectedKeys={selection}\n          onSelectionChange={setSelection}\n          fillAvailableSpace\n        >\n          {commitChangesTreeNodeRenderer.itemRenderer({\n            fileCountsMap: state.fileCountsMap,\n          })}\n        </SpeedSearchTree>\n      )}\n      {selectedCommits.length > 1 && (\n        <PositionedTooltipTrigger\n          placement=\"top\"\n          tooltip={\n            <HelpTooltip\n              helpText={\n                <>\n                  Showing diff for more than one commit is not currently\n                  supported. Only the first selected commit is taken into\n                  account.\n                </>\n              }\n            ></HelpTooltip>\n          }\n        >\n          {(props) => (\n            <span\n              {...props}\n              style={{\n                position: \"absolute\",\n                right: \"0.5rem\",\n                bottom: \"0.5rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/warning\" />\n            </span>\n          )}\n        </PositionedTooltipTrigger>\n      )}\n    </div>\n  );\n}\n\nfunction Delayed({ children }: { children: ReactNode }) {\n  const [waitedEnough, setWaitedEnough] = useState(false);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setWaitedEnough(true);\n    }, DEFAULT_LOADING_DELAY_MS);\n    return () => clearTimeout(timer);\n  }, []);\n  if (waitedEnough) {\n    return <>{children}</>;\n  }\n  return null;\n}\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { StyledCurrentBranchTag } from \"../Changes/StyledCurrentBranchTag\";\nimport { GitRef } from \"./GitRef\";\n\nconst labelIcon = (\n  <path\n    fill=\"currentColor\"\n    d=\"M4.2 4.8 C4.8627 4.8 5.4 5.3373 5.4 6 C5.4 6.6627 4.8627 7.2 4.2 7.2 C3.5373 7.2 3 6.6627 3 6 C3 5.3373 3.5373 4.8 4.2 4.8 ZM0.6 2.4 L0.6 7.2 L7.8 14.4 L12.6 9.6 L5.4 2.4 Z\"\n  />\n);\nconst vcsLogStandardColors = {\n  TIP: { light: \"#ffd100\", dark: \"#e1c731\" },\n  LEAF: { light: \"#8a2d6b\", dark: \"#c31e8c\" },\n  BRANCH: { light: \"#3cb45c\", dark: \"#3cb45c\" },\n  BRANCH_REF: { light: \"#9f79b5\", dark: \"#9f79b5\" },\n  TAG: { light: \"#7a7a7a\", dark: \"#999999\" },\n};\nconst gitLogColors: Record<GitRef[\"type\"], (args: { theme: Theme }) => string> =\n  {\n    head: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.headIconColor\",\n        vcsLogStandardColors.TIP\n      ),\n    localBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.localBranchIconColor\",\n        vcsLogStandardColors.BRANCH\n      ),\n    remoteBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.remoteBranchIconColor\",\n        vcsLogStandardColors.BRANCH_REF\n      ),\n    tag: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.tagIconColor\",\n        vcsLogStandardColors.TAG\n      ),\n  };\n\nconst StyledRef = styled(StyledCurrentBranchTag)`\n  border-radius: 3px;\n  align-items: stretch;\n  font-size: 0.75rem;\n`;\n\nconst StyledLabelSvg = styled.svg.attrs({ viewBox: \"0 0 14.5 14.5\" })<{\n  type: GitRef[\"type\"];\n}>`\n  width: 1rem;\n  height: 1rem;\n  stroke: rgba(0, 0, 0, 0.25);\n  stroke-width: 0.5px;\n  color: ${({ type, theme }) => gitLogColors[type]({ theme })};\n  z-index: 1; // for the right vertical order of grouped labels\n  &:not(:first-child) {\n    margin-right: -11px;\n  }\n`;\n\nconst StyledRefIconGroup = styled.span`\n  display: inline-flex;\n  flex-direction: row-reverse;\n`;\n\nconst StyledLabelText = styled.span`\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\n\nexport function RefIcon({ type }: { type: GitRef[\"type\"] }) {\n  return <StyledLabelSvg type={type}>{labelIcon}</StyledLabelSvg>;\n}\n\nexport function RefIconGroup({ types }: { types: Array<GitRef[\"type\"]> }) {\n  return (\n    <StyledRefIconGroup>\n      {types.map((type, index) => (\n        <StyledLabelSvg key={index} type={type}>\n          {labelIcon}\n        </StyledLabelSvg>\n      ))}\n    </StyledRefIconGroup>\n  );\n}\nexport function RefLabel({\n  types,\n  children,\n}: {\n  types: Array<GitRef[\"type\"]>;\n  children: React.ReactNode;\n}) {\n  return (\n    <StyledRef>\n      <RefIconGroup types={types} />\n      <StyledLabelText>{children}</StyledLabelText>\n    </StyledRef>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport { useRecoilValue } from \"recoil\";\nimport React, { ReactNode } from \"react\";\n\nimport { Link, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport {\n  formatCommitDate,\n  formatCommitTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\nimport {\n  allResolvedRefsState,\n  selectedCommitState,\n} from \"../CommitsView/CommitsTable.state\";\nimport { RefIconGroup } from \"../RefLabel\";\nimport { GitRef } from \"../GitRef\";\n\nconst StyledContainer = styled.div`\n  padding: 0.875rem;\n  cursor: default;\n`;\nconst StyledCommitMessage = styled.div`\n  font-family: \"JetBrains Mono\", monospace;\n  line-height: 1.125rem;\n  margin-bottom: 1.25rem;\n  margin-right: 1.1875rem;\n`;\n\nconst StyledCommitMessageHeader = styled.div`\n  font-weight: bold;\n`;\nconst StyledCommitterInfo = styled.div`\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n`;\n\nconst StyledCommitInfoRow = styled.div`\n  line-height: 1.2;\n  display: flex;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\nconst StyledRepoColorIcon = styled(RepoColorIcon)`\n  align-self: start;\n`;\n\nconst StyledRefsContainer = styled.span`\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\n\nexport function CommitDetails() {\n  const [firstSelectedCommit] = useLatestRecoilValue(selectedCommitState);\n  const [allResolvedRefs] = useLatestRecoilValue(allResolvedRefsState);\n  const isMultiRepo = useRecoilValue(vcsRootsState).length > 0;\n  if (!firstSelectedCommit) {\n    return (\n      <StyledPlaceholderContainer>\n        No commits selected\n      </StyledPlaceholderContainer>\n    );\n  }\n\n  const {\n    readCommitResult: { commit, oid },\n    containingRefs,\n    repoPath,\n  } = firstSelectedCommit;\n  const { subject, body } = parseCommitMessage(commit.message);\n  const committerInfo: ReactNode[] = [];\n  if (commit.committer.name !== commit.author.name) {\n    committerInfo.push(\n      <React.Fragment key={commit.committer.email}>\n        by {commit.committer.name} <EmailLink email={commit.committer.email} />\n      </React.Fragment>\n    );\n  }\n  if (commit.committer.timestamp !== commit.author.timestamp) {\n    committerInfo.push(formatDateAndTime(commit.committer.timestamp * 1000));\n  }\n  const refs = allResolvedRefs?.[oid] || [];\n  const refsByType = groupBy((ref) => ref.type, refs);\n  return (\n    <StyledContainer>\n      <StyledCommitMessage>\n        <StyledCommitMessageHeader>{subject}</StyledCommitMessageHeader>\n        {body}\n      </StyledCommitMessage>\n      <StyledCommitInfoRow>\n        {isMultiRepo && (\n          <TooltipTrigger tooltip={<Tooltip>{repoPath}</Tooltip>}>\n            {(props) => <StyledRepoColorIcon {...props} rootPath={repoPath} />}\n          </TooltipTrigger>\n        )}\n        <div>\n          {`${shortenOid(oid)} ${commit.author.name} `}\n          <EmailLink email={commit.author.email} />{\" \"}\n          {`${formatDateAndTime(new Date(commit.author.timestamp * 1000))}`}\n          {committerInfo.length > 0 && (\n            <StyledCommitterInfo>committed {committerInfo}</StyledCommitterInfo>\n          )}\n        </div>\n      </StyledCommitInfoRow>\n      {refs.length > 0 && (\n        <StyledRefsContainer>\n          <RefGroup refs={refsByType.head} />\n          <RefGroup refs={refsByType.localBranch} />\n          <RefGroup refs={refsByType.remoteBranch} />\n          <RefGroup refs={refsByType.tag} />\n        </StyledRefsContainer>\n      )}\n      <div>\n        {/*TODO: collapsing and \"Show more\"*/}\n        In {containingRefs.size} branches: {[...containingRefs].join(\", \")}\n      </div>\n    </StyledContainer>\n  );\n}\n\nconst StyledRefWithIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n`;\nfunction RefGroup({ refs }: { refs: undefined | GitRef[] }) {\n  return refs?.length ? (\n    <>\n      {refs.map((ref, index) => {\n        const name = `${ref.name}${index === refs.length - 1 ? \"\" : \",\"}`;\n        return index === 0 ? (\n          <StyledRefWithIcon>\n            <RefIconGroup types={refs.map(({ type }) => type).slice(0, 2)} />\n            {name}\n          </StyledRefWithIcon>\n        ) : (\n          // span is needed for the right flex-wrap behavior\n          <span>{name}</span>\n        );\n      })}\n    </>\n  ) : null;\n}\n\nfunction EmailLink({ email }: { email: string }) {\n  return (\n    <a href={`mailto:${email}`} style={{ all: \"unset\" }}>\n      <Link>{`<${email}>`}</Link>\n    </a>\n  );\n}\n\nfunction formatDateAndTime(date: Date | number) {\n  return `on ${formatCommitDate(date)} at ${formatCommitTime(date)}`;\n}\n","import React from \"react\";\nimport {\n  atom,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionButton,\n  ActionsProvider,\n  ActionTooltip,\n  CommonActionId,\n  Divider,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  PlatformIcon,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  ThreeViewSplitter,\n  Toolbar,\n  TooltipTrigger,\n  useAction,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { CommitChangedFiles } from \"../CommitChanges/CommitsChangedFiles\";\nimport { CommitDetails } from \"./CommitDetails\";\nimport { defaultChangeGroupings } from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changesGroupingActiveState,\n  commitChangesTreeRefState,\n} from \"../CommitChanges/CommitsChangedFiles.state\";\nimport { vcsLogTabShowCommitDetails } from \"../vcs-logs.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nconst splitViewSizeState = atom({\n  key: \"vcs/toolwindow/splitViewSize\",\n  default: 0.5,\n});\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport function VcsLogDetailsView({ tabKey }: { tabKey: string }) {\n  const [splitViewSize, setSplitViewSize] = useRecoilState(splitViewSizeState);\n  const isDetailsVisible = useRecoilValue(vcsLogTabShowCommitDetails(tabKey));\n  const toggleDetailsAction = useAction(VcsActionIds.SHOW_DETAILS);\n\n  const toggleGroupBy = useRecoilCallback(({ set }) => (id: string) => {\n    set(changesGroupingActiveState(id), (currentValue) => !currentValue);\n  });\n  const groupByMenuItems = defaultChangeGroupings\n    .filter((grouping) =>\n      useRecoilValue(changesGroupingActiveState(grouping.id))\n    )\n    .map((grouping) => ({\n      title: grouping.title,\n      key: `groupBy:${grouping.id}`,\n    }));\n  const groupBySelectedKeys = groupByMenuItems.map(({ key }) => key);\n\n  const treeRef = useRecoilValue(commitChangesTreeRefState);\n  const actions = useTreeActions({ treeRef });\n\n  const selectedKeys = [\n    ...groupBySelectedKeys,\n    ...(isDetailsVisible ? [VcsActionIds.SHOW_DETAILS] : []),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer>\n          <StyledHeader>\n            <Toolbar>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Show Diff\" shortcut=\"D\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon={\"actions/diff.svg\"} />\n                </IconButton>\n              </TooltipTrigger>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Revert Selected Changes\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon=\"actions/rollback.svg\" />\n                </IconButton>\n              </TooltipTrigger>\n              <IconButtonWithMenu\n                renderMenu={({ menuProps }) => {\n                  return (\n                    <SpeedSearchMenu\n                      {...menuProps}\n                      selectedKeys={selectedKeys}\n                      onAction={(key) => {\n                        const groupByItem = groupByMenuItems.find(\n                          (item) => item.key === key\n                        );\n                        if (groupByItem) {\n                          toggleGroupBy(`${key}`.split(\":\")[1]);\n                        } else if (key === toggleDetailsAction?.id) {\n                          toggleDetailsAction?.perform();\n                        } else {\n                          notImplemented();\n                        }\n                      }}\n                    >\n                      <Section title=\"Group By\">\n                        {groupByMenuItems.map((item) => (\n                          <Item key={item.key}>{item.title}</Item>\n                        ))}\n                      </Section>\n                      <Divider />\n                      <Section title=\"Layout\">\n                        {toggleDetailsAction ? (\n                          <Item key={toggleDetailsAction?.id}>\n                            {toggleDetailsAction.title}\n                          </Item>\n                        ) : (\n                          (null as any)\n                        )}\n                        <Item>Show Diff Preview</Item>\n                      </Section>\n                    </SpeedSearchMenu>\n                  );\n                }}\n              >\n                <PlatformIcon icon=\"actions/groupBy.svg\" />\n              </IconButtonWithMenu>\n            </Toolbar>\n            <StyledSpacer />\n            <Toolbar style={{ flexShrink: 0 }}>\n              <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n              <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n            </Toolbar>\n          </StyledHeader>\n          <div style={{ flex: 1, minHeight: 0 }}>\n            {isDetailsVisible ? (\n              <ThreeViewSplitter\n                orientation=\"vertical\"\n                firstSize={splitViewSize}\n                onFirstResize={setSplitViewSize}\n                firstViewMinSize={10}\n                firstView={\n                  <CommitChangedFiles\n                    treeShortcutHandlerProps={shortcutHandlerProps}\n                  />\n                }\n                innerView={<CommitDetails />}\n              />\n            ) : (\n              <CommitChangedFiles\n                treeShortcutHandlerProps={shortcutHandlerProps}\n              />\n            )}\n          </div>\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  BareButton,\n  MenuTrigger,\n  MenuTriggerProps,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledDropdownButton = styled.button`\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding-left: 0.25rem;\n  cursor: pointer;\n  background: ${({ theme }) => theme.color(\"ComboBoxButton.background\")};\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n\n  line-height: 1.5;\n  border-radius: 0.25rem;\n  white-space: nowrap;\n  border: 2px solid transparent;\n  &:hover {\n    color: ${({ theme }) => theme.color(\"*.foreground\")};\n  }\n  &:focus-visible {\n    border-color: ${({ theme }) =>\n      theme.commonColors.focusRing({ focused: true })};\n  }\n`;\n\nconst StyledDropdownIcon = styled.span`\n  margin-left: -1px;\n  line-height: 1.2;\n`;\n\nconst StyledValue = styled.span`\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  max-width: 8.25rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst FocusableAutoHoverPlatformIcon = styled(AutoHoverPlatformIcon)`\n  &:focus-visible {\n    outline: 2px solid\n      ${({ theme }) => theme.commonColors.focusRing({ focused: true })};\n    outline-offset: -2px;\n  }\n`;\nexport function VcsFilterDropdown({\n  label,\n  value,\n  onClear,\n  ...menuTriggerProps\n}: Omit<MenuTriggerProps, \"children\"> & {\n  label: React.ReactNode;\n  value?: React.ReactNode;\n  onClear?: () => void;\n}) {\n  return (\n    <MenuTrigger {...menuTriggerProps}>\n      {(props, ref) => (\n        <StyledDropdownButton {...props} ref={ref}>\n          {label}\n          {value ? (\n            <>\n              : <StyledValue>{value}</StyledValue>\n              <BareButton onPress={onClear}>\n                <FocusableAutoHoverPlatformIcon\n                  icon=\"actions/close\"\n                  hoverIcon=\"actions/closeHovered\"\n                />\n              </BareButton>\n            </>\n          ) : (\n            <StyledDropdownIcon>\n              <PlatformIcon icon=\"general/arrowDownSmall.svg\" />\n            </StyledDropdownIcon>\n          )}\n        </StyledDropdownButton>\n      )}\n    </MenuTrigger>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport React, { HTMLAttributes, useEffect, useState } from \"react\";\nimport {\n  selector,\n  useRecoilState,\n  useRecoilValue,\n  useResetRecoilState,\n} from \"recoil\";\nimport {\n  Divider,\n  Item,\n  MenuItemLayout,\n  SpeedSearchMenu,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  allBranchesState,\n  BranchType,\n  useFavoriteBranches,\n} from \"../../Branches/branches.state\";\nimport { BranchFavoriteButton } from \"../../Branches/BranchFavoriteButton\";\nimport { vcsLogFilter } from \"../vcs-logs.state\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\n\nexport function BranchesFilterDropdown({ tabKey }: { tabKey: string }) {\n  const [selectedBranches, setSelectedBranches] = useRecoilState(\n    vcsLogFilter.branch(tabKey)\n  );\n  const resetBranches = useResetRecoilState(vcsLogFilter.branch(tabKey));\n\n  return (\n    <VcsFilterDropdown\n      value={selectedBranches.length > 0 ? selectedBranches.join(\"|\") : null}\n      onClear={resetBranches}\n      renderMenu={({ menuProps }) => (\n        <BranchesFilterMenu\n          menuProps={menuProps}\n          onBranchesSelected={setSelectedBranches}\n        />\n      )}\n      label=\"Branch\"\n    />\n  );\n}\n\nconst groupRepoRoots = (\n  branches: Array<{ branchName: string; repoRoot: string }>\n) =>\n  Object.entries(groupBy(({ branchName }) => branchName, branches)).map(\n    ([branchName, items]) => ({\n      branchName,\n      repoRoots: items.map((item) => item.repoRoot),\n    })\n  );\n/**\n * Unique list of all local and remote branches of all repositories.\n * Each branch has a list of repos which indicates the list of repository roots the branch appears in.\n */\nconst repoGroupedAllBranches = selector({\n  key: \"vcs/allBranchesRepoConsolidated\",\n  get: ({ get }) => {\n    const allBranches = get(allBranchesState);\n    const allRemoteBranches = allBranches.flatMap(\n      ({ remoteBranches, repoRoot }) =>\n        remoteBranches.map((branch) => ({\n          repoRoot,\n          branchName: `${branch.remote}/${branch.name}`,\n        }))\n    );\n    const allLocalBranches = allBranches.flatMap(\n      ({ localBranches, repoRoot }) =>\n        localBranches.map((branch) => ({\n          repoRoot,\n          branchName: branch.name,\n        }))\n    );\n    return {\n      localBranches: groupRepoRoots(allLocalBranches),\n      remoteBranches: groupRepoRoots(allRemoteBranches),\n    };\n  },\n});\n\ntype BranchMenuItem = {\n  branchType: BranchType;\n  branchName: string;\n  repoRoots: string[];\n};\n\nfunction BranchesFilterMenu({\n  menuProps,\n  onBranchesSelected,\n}: {\n  onBranchesSelected: (branches: string[]) => void;\n  menuProps: HTMLAttributes<HTMLElement>;\n}) {\n  const [favoriteBranches, setFavoriteBranches] = useState<BranchMenuItem[]>(\n    []\n  );\n  const { toggleFavorite, isFavorite } = useFavoriteBranches();\n  const { localBranches, remoteBranches } = useRecoilValue(\n    repoGroupedAllBranches\n  );\n\n  const remoteBranchesByRemote = groupBy(\n    ({ branchName }) => branchName.split(\"/\")[0],\n    remoteBranches\n  );\n\n  // The list of favorite branches is calculated on render, and is intentionally not updated. This behavior is copied\n  // from the reference implementation. Probably in order to not have items jump in and out of the menu, when branches\n  // are marked/unmarked as favorite. One improvement (?) here is that isFavorite state is always correct, as opposed\n  // to the reference implementation where (at least currently) the state of favorite icon is not kept up-to-date.\n  useEffect(() => {\n    const createLocalBranchItems = (\n      branchType: BranchType,\n      branches: Array<{ branchName: string; repoRoots: string[] }>\n    ): BranchMenuItem[] => {\n      return branches\n        .filter(({ branchName, repoRoots }) =>\n          repoRoots.some((repoRoot) =>\n            isFavorite({ branchType, branchName, repoRoot })\n          )\n        )\n        .map(({ branchName, repoRoots }) => ({\n          branchType,\n          branchName,\n          repoRoots,\n        }));\n    };\n\n    setFavoriteBranches(\n      [\n        {\n          branchType: \"LOCAL\",\n          branchName: \"HEAD\",\n          repoRoots: [],\n        } as BranchMenuItem,\n      ]\n        .concat(createLocalBranchItems(\"LOCAL\", localBranches))\n        .concat(createLocalBranchItems(\"REMOTE\", remoteBranches))\n    );\n  }, []);\n\n  const renderBranchItem = ({\n    branchName,\n    branchType,\n    repoRoots,\n  }: BranchMenuItem) => (\n    <Item key={`branch:${branchName}`} textValue={branchName}>\n      <MenuItemLayout\n        content={branchName}\n        icon={\n          <BranchFavoriteButton\n            isFavorite={\n              branchName === \"HEAD\" ||\n              repoRoots.some((repoRoot) =>\n                isFavorite({\n                  branchType,\n                  repoRoot,\n                  branchName,\n                })\n              )\n            }\n            onClick={() => {\n              if (branchName !== \"HEAD\") {\n                repoRoots.forEach((repoRoot) => {\n                  toggleFavorite({\n                    branchType,\n                    repoRoot,\n                    branchName,\n                  });\n                });\n              }\n            }}\n          />\n        }\n      />\n    </Item>\n  );\n  return (\n    <SpeedSearchMenu\n      {...menuProps}\n      submenuBehavior=\"toggleOnPress\"\n      autoFocus=\"first\"\n      minWidth={250}\n      onAction={(key) => {\n        const [type, value] = `${key}`.split(\":\");\n        if (type === \"branch\" && value) {\n          onBranchesSelected([value]);\n        } else if (type === \"favorites\") {\n          onBranchesSelected(\n            favoriteBranches.map(({ branchName }) => branchName)\n            // we could have filtered the ones that are actually favorite at this point, but not doing so to follow\n            // the original implementation, even though it's a little questionable.\n          );\n        } else if (type === \"select\") {\n          notImplemented(); // TODO\n        }\n      }}\n    >\n      {[\n        <Item key=\"select\">Select...</Item>,\n        <Item key=\"favorites\">Favorites</Item>,\n        ...favoriteBranches.map(renderBranchItem),\n        <Divider />,\n        <Item key=\"local\" title=\"Local\">\n          {localBranches.map(({ branchName, repoRoots }) =>\n            renderBranchItem({ branchType: \"LOCAL\", branchName, repoRoots })\n          )}\n        </Item>,\n        ...Object.entries(remoteBranchesByRemote).map(([origin, branches]) => (\n          <Item key={`remote:${origin}`} title={`${origin}/...`}>\n            {branches.map(({ branchName, repoRoots }) =>\n              renderBranchItem({ branchType: \"REMOTE\", branchName, repoRoots })\n            )}\n          </Item>\n        )),\n      ]}\n    </SpeedSearchMenu>\n  );\n}\n","import { selectorFamily } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport type GitUser = { name: string; email: string };\n\nexport function areUsersEqual(\n  user1: GitUser | null | undefined,\n  user2: GitUser | null | undefined\n): boolean {\n  return (\n    Boolean(user1) &&\n    user1?.email === user2?.email &&\n    user1?.name === user2?.name\n  );\n}\nexport function areSamePerson(user1: GitUser, user2: GitUser): boolean {\n  return (\n    getNameInStandardForm(user1.name) === getNameInStandardForm(user2.name)\n  );\n}\nconst NAME_PATTERN = \"(\\\\w+)[\\\\p{Punct}\\\\s](\\\\w+)\";\n\nfunction getNameInStandardForm(name: string) {\n  const firstAndLastName = getFirstAndLastName(name);\n  if (firstAndLastName != null) {\n    const [firstName, lastName] = firstAndLastName;\n    return firstName.toLowerCase() + \" \" + lastName.toLowerCase(); // synonyms detection is currently english-only\n  }\n  return nameToLowerCase(name);\n}\n\nconst PRINTABLE_ASCII_PATTERN = \"[ -~]*\";\nfunction nameToLowerCase(name: string) {\n  if (!name.match(PRINTABLE_ASCII_PATTERN)) return name;\n  return name.toLowerCase();\n}\nfunction getFirstAndLastName(name: string) {\n  const matches = name.match(NAME_PATTERN);\n  if (matches) {\n    return [matches[1], matches[2]];\n  }\n  return null;\n}\nexport const gitRepoUserState = selectorFamily<GitUser, string>({\n  key: \"vcs/repo-user\",\n  get: (repoRoot: string) => async () => {\n    const name = await git.getConfig({ fs, dir: repoRoot, path: \"user.name\" });\n    const email = await git.getConfig({\n      fs,\n      dir: repoRoot,\n      path: \"user.email\",\n    });\n    return {\n      name: name ?? \"\",\n      email: email ?? \"\",\n    };\n  },\n});\n","import React, { CSSProperties, RefObject, useMemo } from \"react\";\nimport { css, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { ReadCommitResult } from \"isomorphic-git\";\n\nimport { GitRef } from \"../GitRef\";\nimport { RefLabel, RefIcon } from \"../RefLabel\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityState,\n  vcsTableHighlightMyCommitsState,\n  vcsTableReferencesOnTheLeftState,\n  vcsTableShowCommitTimestampState,\n} from \"./CommitsTable.state\";\nimport {\n  areSamePerson,\n  gitRepoUserState,\n  GitUser,\n} from \"../../git-users.state\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsLogFilterCurrentTab,\n} from \"../vcs-logs.state\";\nimport {\n  formatCommitDateTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\n\nconst StyledCommitRow = styled.div`\n  display: flex;\n  height: 1.5rem;\n  align-items: center;\n  width: 100%;\n  --column-width-1: 130px;\n  --column-width-2: 130px;\n  --column-width-3: 70px;\n`;\nconst StyledCommitCell = styled.div`\n  overflow: hidden;\n  padding-left: 0.25rem;\n`;\n\nconst StyledRefsContainer = styled.div<{ asOverlay?: boolean }>`\n  ${({ asOverlay }) =>\n    !asOverlay\n      ? css`\n          position: absolute;\n          right: 0;\n          top: 1px;\n          max-width: calc(100% - 100px);\n        `\n      : css`\n          flex-shrink: 0;\n        `};\n\n  display: flex;\n  gap: 0.25rem;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(theme.color(\"List.background\"))};\n`;\nconst StyledMessageContainer = styled.div`\n  position: relative;\n  display: flex;\n  gap: 0.25rem;\n`;\n\nconst StyledRefTooltipRow = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0.25rem;\n  font-size: 0.75rem;\n`;\nconst useCurrentUserHighlightStyle = ({\n  repoRoot,\n  author,\n}: {\n  repoRoot: string;\n  author: GitUser;\n}): CSSProperties => {\n  const currentUser = useRecoilValue(gitRepoUserState(repoRoot));\n  const shouldHighlightCurrentUserCommits = useRecoilValue(\n    vcsTableHighlightMyCommitsState\n  );\n  // for now assuming only a single table can be visible, and that's current tab's.\n  const userFilter = useRecoilValue(vcsLogFilterCurrentTab.user);\n  // single user case is not considered a special case, like it is in the original impl\n  const shouldHighlight =\n    shouldHighlightCurrentUserCommits &&\n    userFilter !== CURRENT_USER_FILTER_VALUE &&\n    areSamePerson(currentUser, author);\n\n  return { fontWeight: shouldHighlight ? \"bold\" : undefined };\n};\n\nexport function CommitsTableRow({\n  refs,\n  readCommitResult: {\n    oid,\n    commit: { author, committer, message },\n  },\n  repoRoot,\n}: {\n  repoRoot: string;\n  readCommitResult: ReadCommitResult;\n  refs: GitRef[] | undefined;\n}) {\n  const showCommitTimestamp = useRecoilValue(vcsTableShowCommitTimestampState);\n  const referencesOnTheLeft = useRecoilValue(vcsTableReferencesOnTheLeftState);\n  const isAuthorVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(authorColumn.id)\n  );\n  const isDateVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(dateColumn.id)\n  );\n  const isHashVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(hashColumn.id)\n  );\n\n  const highlightStyles = useCurrentUserHighlightStyle({ author, repoRoot });\n  return (\n    <StyledCommitRow>\n      <StyledCommitCell style={{ flexBasis: \"0%\", flexGrow: 1, flexShrink: 1 }}>\n        <StyledMessageContainer>\n          {refs && <CommitRefs onLeft={referencesOnTheLeft} refs={refs} />}\n          <span style={highlightStyles}>\n            {parseCommitMessage(message).subject}\n          </span>\n        </StyledMessageContainer>\n      </StyledCommitCell>\n      {isAuthorVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-1)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {author.name}\n          {committer.name !== author.name && \"*\"}\n        </StyledCommitCell>\n      )}\n      {isDateVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-2)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {formatCommitDateTime(\n            (showCommitTimestamp ? committer : author).timestamp * 1000\n          )}\n        </StyledCommitCell>\n      )}\n      {isHashVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-3)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {shortenOid(oid)}\n        </StyledCommitCell>\n      )}\n    </StyledCommitRow>\n  );\n}\n\nfunction refKey(ref: GitRef) {\n  return `${ref.type}${ref.name}`;\n}\n\nfunction CommitRefs({ refs, onLeft }: { refs: GitRef[]; onLeft?: boolean }) {\n  const { filteredRefs } = useMemo(() => {\n    const headIsOnABranch = refs.some(\n      (ref) => ref.type === \"localBranch\" && ref.isCurrent\n    );\n    return {\n      filteredRefs: refs.filter(\n        (ref) =>\n          !(\n            (ref.type === \"head\" && headIsOnABranch) ||\n            (ref.type === \"remoteBranch\" &&\n              refs.find(\n                (aBranch) =>\n                  aBranch.type === \"localBranch\" &&\n                  aBranch.trackingBranch === ref.name\n              ))\n          )\n      ),\n    };\n  }, [refs]);\n\n  return (\n    <TooltipTrigger\n      placement=\"bottom\"\n      delay={800}\n      isDisabled={refs.length < 2}\n      tooltip={\n        <Tooltip withPointer>\n          {refs.map((ref) => (\n            <StyledRefTooltipRow key={refKey(ref)}>\n              <RefIcon type={ref.type} />\n              {ref.name}\n            </StyledRefTooltipRow>\n          ))}\n        </Tooltip>\n      }\n    >\n      {({ ref, ...tooltipTriggerProps }) => (\n        <StyledRefsContainer\n          ref={ref as RefObject<HTMLDivElement>}\n          asOverlay={onLeft}\n          {...tooltipTriggerProps}\n        >\n          {filteredRefs\n            .filter(\n              (ref) =>\n                ref.type !== \"remoteBranch\" ||\n                !refs.find(\n                  (aBranch) =>\n                    aBranch.type === \"localBranch\" &&\n                    aBranch.trackingBranch === ref.name\n                )\n            )\n            .map((ref) => {\n              let name = ref.name;\n              const types: GitRef[\"type\"][] = [ref.type];\n              if (ref.type === \"localBranch\" && ref.trackingBranch) {\n                types.unshift(\"remoteBranch\");\n                name = `${ref.trackingBranch.split(\"/\")[0]} & ${ref.name}`;\n              }\n              if (ref.type === \"localBranch\" && ref.isCurrent) {\n                types.push(\"head\");\n              }\n              return (\n                <RefLabel key={refKey(ref)} types={types}>\n                  {name}\n                </RefLabel>\n              );\n            })}\n        </StyledRefsContainer>\n      )}\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { Item, Link, List, ProgressBar, styled } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { useResetFilters, vcsActiveTabKeyState } from \"../vcs-logs.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport { CommitsTableRow } from \"./CommitsTableRow\";\nimport { GitRef } from \"../GitRef\";\nimport {\n  allResolvedRefsState,\n  commitsSelectionState,\n  commitsTableRowsState,\n} from \"./CommitsTable.state\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\n\n// const StyledList = styled(List)`\n//   display: grid;\n//   grid-template-columns: repeat(3, auto); /* Define 3 columns */\n//\n//   ${StyledListItem} {\n//     display: contents;\n//   }\n// ` as typeof List;\n\nconst StyledProgressBar = styled(ProgressBar)`\n  position: absolute;\n  width: 100%;\n  z-index: 1;\n`;\nconst StyledContainer = styled.div`\n  position: relative;\n  min-height: 0;\n  flex: 1;\n  ${StyledListItem} {\n    // the default \"min-width: min-content\", which is necessary for sizing overlays (e.g. Popup) containing list/tree,\n    // results in horizontally scrollable table. Probably not an issue when a proper Table component is implemented.\n    min-width: unset;\n  }\n`;\n\nconst ResolvedRefsContext = React.createContext<Record<string, GitRef[]>>({});\nexport function CommitsTable() {\n  const currentTabKey = useRecoilValue(vcsActiveTabKeyState);\n  const resetFilters = useResetFilters();\n\n  const [result, commitRowsState] = useLatestRecoilValue(commitsTableRowsState);\n  const rows = result?.rows;\n  const [allResolvedRefs] = useLatestRecoilValue(allResolvedRefsState);\n  const [selectedCommits, setSelectedCommits] = useRecoilState(\n    commitsSelectionState\n  );\n\n  return (\n    <ResolvedRefsContext.Provider value={allResolvedRefs ?? {}}>\n      <StyledContainer>\n        {commitRowsState === \"loading\" && (\n          <StyledProgressBar aria-label=\"Loading commits\" isIndeterminate />\n        )}\n        {rows && rows.length > 0 && (\n          <List\n            items={rows}\n            fillAvailableSpace\n            selectionMode=\"multiple\"\n            selectedKeys={selectedCommits}\n            onSelectionChange={setSelectedCommits}\n            estimatedItemHeight={24}\n          >\n            {({ readCommitResult, repoPath }) => (\n              <Item\n                key={readCommitResult.oid}\n                textValue={readCommitResult.commit.message}\n              >\n                {/* Using context here due to rendering optimizations of collection API */}\n                <ResolvedRefsContext.Consumer>\n                  {(refs) => (\n                    <CommitsTableRow\n                      readCommitResult={readCommitResult}\n                      repoRoot={repoPath}\n                      refs={refs[readCommitResult.oid]}\n                    />\n                  )}\n                </ResolvedRefsContext.Consumer>\n              </Item>\n            )}\n          </List>\n        )}\n        {commitRowsState === \"hasValue\" && rows && rows.length === 0 && (\n          <StyledPlaceholderContainer>\n            No commits matching filters\n            <Link onPress={() => resetFilters(currentTabKey)}>\n              Reset filters\n            </Link>\n          </StyledPlaceholderContainer>\n        )}\n      </StyledContainer>\n    </ResolvedRefsContext.Provider>\n  );\n}\n","import React from \"react\";\nimport { RecoilState, useRecoilState } from \"recoil\";\nimport {\n  ActionTooltip,\n  IconButtonWithMenu,\n  Item,\n  PlatformIcon,\n  Section,\n  SpeedSearchMenu,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityState,\n  vcsTableHighlightMyCommitsState,\n  vcsTableReferencesOnTheLeftState,\n  vcsTableShowCommitTimestampState,\n} from \"./CommitsTable.state\";\n\ntype ToggleDef = {\n  name: string;\n  state: RecoilState<boolean>;\n};\nconst showToggleDefs = [\n  { name: \"Commit Timestamp\", state: vcsTableShowCommitTimestampState },\n  { name: \"References on the Left\", state: vcsTableReferencesOnTheLeftState },\n];\nconst highlightToggleDefs = [\n  { name: \"My Commits\", state: vcsTableHighlightMyCommitsState },\n];\nconst columnToggleDefs = [authorColumn, hashColumn, dateColumn].map(\n  ({ name, id }) => ({\n    name,\n    state: vcsTableColumnsVisibilityState(id),\n  })\n);\nconst useToggleDef = (item: ToggleDef) => {\n  const [value, set] = useRecoilState(item.state);\n  return { ...item, key: item.state.key.replace(/\"/g, \"_\"), value, set };\n};\n\nexport function CommitsTableViewOptionsMenuIconButton() {\n  const showToggles = showToggleDefs.map(useToggleDef);\n  const highlightToggles = highlightToggleDefs.map(useToggleDef);\n  const columnToggles = columnToggleDefs.map(useToggleDef);\n\n  const allToggles = showToggles.concat(highlightToggles).concat(columnToggles);\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            // TODO: keep menu open when (certain) items are toggled. Search for closeOnSelect TODO in menu\n            <SpeedSearchMenu\n              {...menuProps}\n              selectedKeys={allToggles\n                .filter(({ value }) => value)\n                .map(({ key }) => key)}\n              onAction={(key) => {\n                const toggle = allToggles.find(\n                  ({ key: toggleKey }) => toggleKey === key\n                );\n                if (toggle) {\n                  toggle.set((value) => !value);\n                } else {\n                  notImplemented();\n                }\n              }}\n            >\n              <Section title=\"Show\">\n                <Item>Compact References View</Item>\n                <Item>Tag Names</Item>\n                <Item>Long Edges</Item>\n                {\n                  showToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item title=\"Columns\">\n                  {\n                    columnToggles.map(({ name, key }) => (\n                      <Item key={key}>{name}</Item>\n                    )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                  }\n                </Item>\n              </Section>\n              <Section title=\"Highlight\">\n                {\n                  highlightToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item>Merge Commits</Item>\n                <Item>Current Branch</Item>\n                <Item>Not Cherry-Picked Commits</Item>\n              </Section>\n            </SpeedSearchMenu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { v4 as uuid } from \"uuid\";\nimport React, { useEffect, useState } from \"react\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  IconButton,\n  Item,\n  Menu,\n  PlatformIcon,\n  SearchInput,\n  styled,\n  StyledHoverContainer,\n  Toolbar,\n  ToolbarSeparator,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport {\n  atom,\n  RecoilState,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n  useResetRecoilState,\n} from \"recoil\";\nimport { searchInputRefState } from \"../VersionControlToolWindow\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsTabKeysState,\n} from \"../vcs-logs.state\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { DateRange, dateToString } from \"../DateRange\";\nimport { BranchesFilterDropdown } from \"./BranchesFilterDropdown\";\nimport { CommitsTable } from \"./CommitsTable\";\nimport { CommitsTableViewOptionsMenuIconButton } from \"./CommitsTableViewOptionsMenuIconButton\";\n\nconst StyledSearchInput = styled(SearchInput)`\n  border-radius: 2px;\n  width: 219px;\n  margin-right: 0.0625rem;\n  margin-left: 0.2rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst searchHistoryState = atom<string[]>({\n  key: \"vcs/toolwindow/searchHistory\",\n  default: [], // TODO: add an effect to persist it under application level other.xml file under\n  // PropertyService component's \"Vcs.Log.Text.Filter.History\" property\n});\n\nexport function VcsLogCommitsView({ tabKey }: { tabKey: string }) {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const [searchQuery, setSearchQuery] = useRecoilState(\n    vcsLogFilter.searchQuery(tabKey)\n  );\n  const [user, setUser] = useRecoilState(vcsLogFilter.user(tabKey));\n  const resetUser = useResetRecoilState(vcsLogFilter.user(tabKey));\n  const [dateFilter, setDateFilter] = useRecoilState(vcsLogFilter.date(tabKey));\n  const resetDate = useResetRecoilState(vcsLogFilter.date(tabKey));\n  const [searchHistory, setSearchHistory] = useRecoilState(searchHistoryState);\n  const [searchInputValue, setSearchInputValue] = useState(searchQuery);\n  const getActionShortcut = useGetActionShortcut();\n  const isRegExpOn = useRecoilValue(vcsLogFilter.regExp(tabKey));\n  const isMatchCaseOn = useRecoilValue(vcsLogFilter.matchCase(tabKey));\n  const submitSearchQuery = (value = searchInputValue) => {\n    setSearchQuery(value);\n    if (value && !searchHistory.includes(value)) {\n      setSearchHistory((searchHistory) => [\n        value,\n        ...searchHistory.filter((item) => item !== value),\n      ]);\n    }\n  };\n\n  useEffect(() => {\n    setSearchInputValue(searchQuery);\n  }, [searchQuery]);\n\n  const createNewTab = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        const newTabId = uuid();\n        set(vcsTabKeysState, (value) => [...value, newTabId]);\n        Object.values(vcsLogFilter).forEach(\n          (filterState: (tabKey: string) => RecoilState<any>) => {\n            set(\n              filterState(newTabId),\n              snapshot\n                .getLoadable(\n                  filterState(\n                    snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n                  )\n                )\n                .getValue()\n            );\n          }\n        );\n        set(vcsActiveTabKeyState, newTabId);\n      },\n    []\n  );\n  const today = new Date();\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(today.getDate() - 7);\n  const yesterday = new Date();\n  yesterday.setDate(today.getDate() - 1);\n  const predefinedDateRanges = [\n    {\n      name: \"Last 24 hours\",\n      value: { from: yesterday },\n    },\n    {\n      name: \"Last 7 days\",\n      value: { from: sevenDaysAgo },\n    },\n  ];\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName=\"Text or Hash Filter\"\n              shortcut={getActionShortcut(VcsActionIds.FOCUS_TEXT_FILTER)}\n            />\n          }\n        >\n          <StyledSearchInput\n            inputRef={textFilterRef}\n            value={searchInputValue}\n            onChange={setSearchInputValue}\n            onSubmit={submitSearchQuery}\n            onBlur={() => submitSearchQuery()}\n            onClear={() => submitSearchQuery(\"\")}\n            searchHistory={searchHistory}\n            addonAfter={\n              <>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.REG_EXP}\n                >\n                  <AutoHoverPlatformIcon\n                    icon={\n                      isRegExpOn ? \"actions/regexSelected\" : \"actions/regex\"\n                    }\n                    hoverIcon={\n                      isRegExpOn\n                        ? \"actions/regexSelected\"\n                        : \"actions/regexHovered\"\n                    }\n                  />\n                </StyledHoverContainer>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.MATCH_CASE}\n                >\n                  {isMatchCaseOn ? (\n                    <PlatformIcon icon=\"actions/matchCaseSelected\" />\n                  ) : (\n                    <AutoHoverPlatformIcon\n                      icon=\"actions/matchCase\"\n                      hoverIcon=\"actions/matchCaseHovered\"\n                    />\n                  )}\n                </StyledHoverContainer>\n              </>\n            }\n          />\n        </TooltipTrigger>\n        <Toolbar>\n          <BranchesFilterDropdown tabKey={tabKey} />\n          <VcsFilterDropdown\n            value={user === CURRENT_USER_FILTER_VALUE ? \"me\" : user}\n            onClear={resetUser}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  if (key === \"select\") {\n                    return notImplemented();\n                  }\n                  setUser(`${key}`);\n                }}\n              >\n                <Item key=\"select\">Select...</Item>\n                <Item key={CURRENT_USER_FILTER_VALUE}>me</Item>\n              </Menu>\n            )}\n            label=\"User\"\n          />\n          <VcsFilterDropdown\n            value={dateFilter && dateRangeToString(dateFilter)}\n            onClear={resetDate}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  const predefinedDateRange = predefinedDateRanges.find(\n                    ({ name }) => name === key\n                  );\n                  if (predefinedDateRange) {\n                    setDateFilter(predefinedDateRange.value);\n                  } else {\n                    notImplemented();\n                  }\n                }}\n              >\n                {[\n                  <Item key=\"select\">Select...</Item>,\n                  ...predefinedDateRanges.map(({ name }) => (\n                    <Item key={name}>{name}</Item>\n                  )),\n                ]}\n              </Menu>\n            )}\n            label=\"Date\"\n          />\n          <VcsFilterDropdown\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Select in...</Item>\n                <Item>Select in Tree...</Item>\n              </Menu>\n            )}\n            label=\"Paths\"\n          />\n          <ToolbarSeparator />\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Open New Git Log Tab\" />}\n          >\n            <IconButton aria-label=\"Checkout\" onPress={createNewTab}>\n              <PlatformIcon icon=\"actions/openNewTab.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <ActionButton actionId={VcsActionIds.LOG_REFRESH} />\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Cherry-Pick\" />}>\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/cherryPick.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <CommitsTableViewOptionsMenuIconButton />\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip actionName=\"Go To Hash/Branch/Tag\" shortcut=\"F\" />\n            }\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/find\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n      </StyledHeader>\n      <CommitsTable />\n    </StyledContainer>\n  );\n}\n\nfunction dateRangeToString(dateRange: DateRange): string {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n}\n","import { basename } from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, atomFamily, isRecoilValue, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { PlatformIcon, TreeRefValue } from \"@intellij-platform/core\";\n\nimport {\n  allBranchesState,\n  BranchType,\n  isFavoriteBranchState,\n  LocalBranch,\n  RemoteBranch,\n  RepoBranches,\n} from \"../../Branches/branches.state\";\nimport {\n  DirectoryNode,\n  createGroupByDirectory,\n} from \"../../../tree-utils/groupByDirectory\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { vcsLogTabState } from \"../vcs-logs.state\";\n\ntype LocalBranchNode = {\n  type: \"localBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is current branch in at least one repo\n   */\n  isCurrent: boolean;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n};\ntype RemoteBranchNode = {\n  type: \"remoteBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n  branches: Array<{ repoRoot: string; branch: RemoteBranch }>;\n};\ntype BranchDirectoryNode = DirectoryNode & {\n  children: readonly AnyBranchTreeNode[];\n};\ntype RepositoryNode = {\n  type: \"repository\";\n  key: string;\n  repoRoot: string;\n  children: ReadonlyArray<LocalBranchNode | RemoteBranchNode | DirectoryNode>;\n};\nexport type AnyBranchTreeNode =\n  | {\n      type: \"head\";\n    }\n  | {\n      type: \"branchType\";\n      branchType: BranchType;\n      children: readonly AnyBranchTreeNode[];\n    }\n  | RepositoryNode\n  | BranchDirectoryNode\n  | LocalBranchNode\n  | RemoteBranchNode;\n\nfunction getLocalBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allLocalBranches = repoBranches.flatMap(\n    ({ repoRoot, localBranches, currentBranch }) =>\n      localBranches.map((branch) => ({\n        repoRoot,\n        isCurrent: currentBranch?.name === branch.name,\n        branch,\n      }))\n  );\n  const localBranchNodes = Object.entries(\n    groupBy(({ branch }) => branch.name, allLocalBranches)\n  ).map<LocalBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"localBranch\",\n      key: `localBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"LOCAL\",\n          branchName: branch.name,\n        })\n      ),\n      isCurrent: branches.some(({ isCurrent }) => isCurrent),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(localBranchNodes);\n  }\n  return localBranchNodes;\n}\n\nfunction getRemoteBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allRemoteBranches = repoBranches.flatMap(\n    ({ repoRoot, remoteBranches }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branch,\n      }))\n  );\n  const remoteBranchNodes = Object.entries(\n    groupBy(\n      ({ branch }) => `${branch.remote}/${branch.name}`,\n      allRemoteBranches\n    )\n  ).map<RemoteBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"remoteBranch\",\n      key: `remoteBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"REMOTE\",\n          branchName: branch.name,\n        })\n      ),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(remoteBranchNodes);\n  }\n  return remoteBranchNodes;\n}\n\nexport const branchesTreeNodeState = selector({\n  key: \"vcs/logs/branchesTree/nodes\",\n  get: ({ get }): AnyBranchTreeNode[] => {\n    // TODO: sorting. favorite should be on top. Others should be alphabetical\n    const repoBranches = get(allBranchesState);\n    const shouldGroupByDirectory = get(branchTreeGroupingState(\"directory\"));\n    const shouldGroupByRepository =\n      get(isGroupByRepositoryAvailableState) &&\n      get(branchTreeGroupingState(\"repository\"));\n\n    return [\n      { type: \"head\" },\n      {\n        type: \"branchType\",\n        branchType: \"LOCAL\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `LOCAL:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getLocalBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getLocalBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n      {\n        type: \"branchType\",\n        branchType: \"REMOTE\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `REMOTE:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getRemoteBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getRemoteBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n    ];\n  },\n});\nconst groupNodesByDirectory = createGroupByDirectory<\n  LocalBranchNode | RemoteBranchNode,\n  BranchDirectoryNode\n>({\n  shouldCollapseDirectories: false,\n  getPath: (node) => node.name,\n});\nexport const branchTreeGroupingState = atomFamily<\n  boolean,\n  \"directory\" | \"repository\"\n>({\n  key: \"vcs/logs/branchesTree/grouping\",\n  default: true,\n});\nexport const isGroupByRepositoryAvailableState = selector<boolean>({\n  key: \"vcs/logs/branchesTree/grouping/repo/available\",\n  get: ({ get }) => get(vcsRootsState).length > 1,\n});\nexport const branchesTreeRefState = vcsLogTabState(\n  atomFamily<RefObject<TreeRefValue>, string>({\n    key: \"vcs/logs/branchesTree/ref\",\n    default: React.createRef(),\n    dangerouslyAllowMutability: true,\n  })\n);\nexport const selectedKeysState = vcsLogTabState(\n  atomFamily<Selection, string>({\n    key: \"vcs/logs/branchesTree/selectedKeys\",\n    default: new Set(),\n  })\n);\nexport const expandedKeysState = vcsLogTabState(\n  atomFamily<Set<Key>, string>({\n    key: \"vcs/logs/branchesTree/expandedKeys\",\n    default: new Set(),\n  })\n);\n\nexport const searchInputState = vcsLogTabState(\n  atomFamily<string, string>({\n    key: \"vcs/logs/branchesTree/searchInput\",\n    default: \"\",\n  })\n);\n\nconst groupings = [\n  {\n    id: \"directory\" as const,\n    title: \"Directory\",\n    icon: <PlatformIcon icon=\"actions/GroupByPackage.svg\" />,\n    isActive: branchTreeGroupingState(\"directory\"),\n    isAvailable: true,\n  },\n  {\n    id: \"repository\" as const,\n    title: \"Repository\",\n    isActive: branchTreeGroupingState(\"repository\"),\n    isAvailable: isGroupByRepositoryAvailableState,\n  },\n];\nexport const availableGroupingsState = selector({\n  key: \"vcs/logs/branchesTree/availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        ...grouping,\n        isActive: get(branchTreeGroupingState(grouping.id)),\n      })),\n});\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../GroupByActionButton\";\nimport {\n  availableGroupingsState,\n  branchTreeGroupingState,\n} from \"./BranchesTree.state\";\n\nexport function BranchesGroupByActionButton() {\n  //  TODO: Generalize and convert to actions\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: \"directory\" | \"repository\") => {\n        set(branchTreeGroupingState(id), (value) => !value);\n      },\n    []\n  );\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n}\n","import { basename } from \"path\";\nimport React from \"react\";\nimport { ItemElement } from \"@react-types/shared/src/collections\";\nimport {\n  ActionTooltip,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { TrackingBranchInfo } from \"../../TrackingBranchInfo\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { AnyBranchTreeNode } from \"./BranchesTree.state\";\n\nexport const branchTreeNodeRenderers: {\n  [nodeType in AnyBranchTreeNode[\"type\"]]: (\n    node: AnyBranchTreeNode & { type: nodeType }\n  ) => ItemElement<AnyBranchTreeNode>;\n} = {\n  branchType: (node) => {\n    return (\n      <Item\n        key={`${node.type}:${node.branchType}`}\n        textValue={wordCase(node.branchType)}\n        childItems={node.children}\n      >\n        <HighlightedTextValue />\n      </Item>\n    );\n  },\n  localBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={node.branches} />}\n              ></ActionTooltip>\n            }\n          >\n            {(props) => (\n              <ItemLayout.Group {...props}>\n                {node.isCurrent ? (\n                  <TooltipTrigger\n                    tooltip={\n                      <Tooltip>\n                        Current {node.isFavorite && \"favorite \"}branch\n                      </Tooltip>\n                    }\n                  >\n                    {(props) => (\n                      <ItemLayout.Group {...props}>\n                        <PlatformIcon\n                          icon={\n                            node.isFavorite\n                              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n                              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n                          }\n                        />\n                      </ItemLayout.Group>\n                    )}\n                  </TooltipTrigger>\n                ) : (\n                  <PlatformIcon icon=\"vcs/branchNode\" />\n                )}\n                <HighlightedTextValue />\n                {node.repos && (\n                  <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n                )}\n              </ItemLayout.Group>\n            )}\n          </TooltipTrigger>\n        </ItemLayout>\n      </Item>\n    );\n  },\n  remoteBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <PlatformIcon\n            icon={node.isFavorite ? \"nodes/favorite.svg\" : \"vcs/branchNode\"}\n          />\n          <HighlightedTextValue />\n          {node.repos && (\n            <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n          )}\n        </ItemLayout>\n      </Item>\n    );\n  },\n  repository: (node) => (\n    <Item\n      key={`${node.key}`}\n      textValue={basename(node.repoRoot)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <RepoColorIcon rootPath={node.repoRoot} />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  directory: (node) => (\n    <Item\n      key={`${node.type}_${node.parentNodePath}${node.dirPath}`}\n      textValue={basename(node.dirPath)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <PlatformIcon icon=\"nodes/folder.svg\" />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  head: (node) => (\n    <Item key={`${node.type}`} textValue=\"HEAD (Current Branch)\">\n      <HighlightedTextValue />\n    </Item>\n  ),\n};\n\nfunction wordCase(input: string): string {\n  return input[0].toUpperCase() + input.slice(1).toLowerCase();\n}\n\nexport const keyToBranch = (key: string): string | null => {\n  const [type, _repo, branchName] = key.split(\":\");\n  if (type === \"head\") {\n    return \"HEAD\";\n  }\n  if (type === \"localBranch\" || type === \"remoteBranch\") {\n    return branchName ?? null;\n  }\n  return null;\n};\n","import React, { useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport {\n  PlatformIcon,\n  SpeedSearchTree,\n  styled,\n  useCollectionSearchInput,\n} from \"@intellij-platform/core\";\n\nimport {\n  branchTreeNodeRenderers,\n  keyToBranch,\n} from \"./branchTreeNodeRenderers\";\nimport {\n  branchesTreeNodeState,\n  branchesTreeRefState,\n  expandedKeysState,\n  searchInputState,\n  selectedKeysState,\n} from \"./BranchesTree.state\";\nimport { StyledHeader } from \"../styled-components\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst StyledSearchInput = styled.input`\n  all: unset;\n  flex: 1;\n  align-self: stretch;\n`;\nconst StyledContainer = styled.div`\n  min-width: 0; // don't outgrow the container\n  flex-grow: 1; // fill the available space\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledSearchIconContainer = styled.span`\n  display: inline-flex;\n  margin-top: -0.0625rem;\n  margin-left: 0.7rem;\n  margin-right: 0.25rem;\n  cursor: text;\n`;\n\nexport function BranchesTree({ tabKey }: { tabKey: string }) {\n  const branchesTreeNodes = useRecoilValue(branchesTreeNodeState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(\n    selectedKeysState(tabKey)\n  );\n  const [expandedKeys, setExpandedKeys] = useRecoilState(\n    expandedKeysState(tabKey)\n  );\n  const [searchTerm, setSearchTerm] = useRecoilState(searchInputState(tabKey));\n  const treeRef = useRecoilValue(branchesTreeRefState(tabKey));\n  const ref = useRef<HTMLDivElement>(null);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const selectionManagerRef = useRef<TreeSelectionManager>(null);\n  const [isInputFocused, setInputFocused] = useState(false);\n  const setBranchFilter = useSetRecoilState(vcsLogFilterCurrentTab.branch);\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef: ref,\n    selectionManager: selectionManagerRef.current,\n  });\n  /**\n   * TODO: remaining from search:\n   * - Make the search input red when there is no match\n   * - filter non-matching tree nodes out\n   * - search in the whole tree, not just nodes that are currently visible based on expandedKeys\n   *   - update expanded keys to show matches, as a side effect, every time matches are updated.\n   * The above items are postponed to think more about flexibility of SpeedSearchTree API.\n   * Some rough thoughts about different approaches:\n   * - Provide generic tree utilities to search in the whole tree. In SpeedSearchTree allow for full control over\n   * `matches`. It will be in usage side that matches are calculated based on search input value, and passed to\n   * SpeedSearchTree as an input.\n   * - In SpeedSearchTree, allow for passing a custom search function, which would accept the tree collection object,\n   *   the search query, and the default match function (minusculeMatch).\n   * - Make Tree more flexible or introduce a more flexible base component, so that speed search for tree can be\n   *   implementated in a more composable way. Tree (or TreeBase) would accept props for intercepting `state` creation,\n   *   and it would also allow passing additional props to the tree container. Then a more generic CollectionSpeedSearch\n   *   component would offer options on how to control and customize speed search, and would return props to be passed\n   *   to collection components.\n   */\n\n  // FIXME: selectedKeys and expandedKeys can become invalid due to changes in nodes, which makes the tree view\n  //  not react to the key events. Ideally, the tree view should be robust regarding invalid keys, and otherwise\n  //  the keys should be validated everytime nodes change.\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <StyledSearchIconContainer>\n          <PlatformIcon icon=\"actions/search\" />\n        </StyledSearchIconContainer>\n        {/* FIXME: tabIndex -1 is a workaround to not get the input focused when the toolwindow opens. Not ideal.*/}\n        <StyledSearchInput\n          ref={searchInputRef}\n          tabIndex={-1}\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          {...mergeProps(collectionSearchInputProps, {\n            onFocus: () => {\n              setInputFocused(true);\n            },\n            onBlur: () => {\n              setInputFocused(false);\n            },\n          })}\n        />\n      </StyledHeader>\n      <SpeedSearchTree\n        ref={ref}\n        treeRef={treeRef}\n        selectionManagerRef={selectionManagerRef}\n        items={branchesTreeNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onAction={(key) => {\n          const branch = keyToBranch(`${key}`);\n          if (branch) {\n            setBranchFilter([branch]);\n          }\n        }}\n        fillAvailableSpace\n        // speed search related props\n        showAsFocused={isInputFocused}\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        keepSearchActiveOnBlur\n        hideSpeedSearchPopup\n        isSearchActive\n      >\n        {(node) => {\n          // @ts-expect-error we need to somehow infer the type of `node.type`\n          return branchTreeNodeRenderers[node.type](node);\n        }}\n      </SpeedSearchTree>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  PlatformIcon,\n  Toolbar,\n  ToolbarSeparator,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { BranchesGroupByActionButton } from \"./BranchesGroupByActionButton\";\nimport { BranchesTree } from \"./BranchesTree\";\nimport { branchesTreeRefState } from \"./BranchesTree.state\";\n\nconst DELETE_BRANCH_ACTION_ID = \"Git.DeleteBranch\";\nconst SHOW_BRANCH_DIFF_ACTION_ID = \"Git.Compare.With.Current\";\nconst SHOW_MY_BRANCHES_ACTION_ID = \"Git.Show.My.Branches\";\nconst FETCH_ACTION_ID = \"Git.Fetch\";\nconst TOGGLE_FAVORITE_ACTION_ID = \"Git.Toggle.Favorite\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  height: 100%;\n`;\n\nexport function VcsBranchesView({ tabKey }: { tabKey: string }) {\n  const treeRef = useRecoilValue(branchesTreeRefState(tabKey));\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.GIT_UPDATE_SELECTED,\n      title: \"Update Selected\",\n      icon: <PlatformIcon icon=\"actions/checkOut\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: DELETE_BRANCH_ACTION_ID,\n      title: \"Delete branch\",\n      icon: <PlatformIcon icon=\"actions/gc\" />,\n      useShortcutsOf: \"SafeDelete\",\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_BRANCH_DIFF_ACTION_ID,\n      title: \"Compare with current\",\n      icon: <PlatformIcon icon=\"actions/diff\" />,\n      useShortcutsOf: VcsActionIds.SHOW_DIFF,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_MY_BRANCHES_ACTION_ID,\n      title: \"Show My Branches\",\n      icon: <PlatformIcon icon=\"actions/find\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: FETCH_ACTION_ID,\n      title: \"Fetch All Remotes\",\n      icon: <PlatformIcon icon=\"vcs/fetch\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: TOGGLE_FAVORITE_ACTION_ID,\n      title: \"Mark/Unmark as Favorite\",\n      icon: <PlatformIcon icon=\"nodes/favorite\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer {...shortcutHandlerProps}>\n          <VcsLogBranchesViewToolbar />\n          <BranchesTree tabKey={tabKey} />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst StyledToolbar = styled(Toolbar)`\n  height: 100%;\n  flex-shrink: 0;\n`;\n\nfunction VcsLogBranchesViewToolbar() {\n  return (\n    <StyledToolbar border=\"right\" orientation=\"vertical\">\n      <ActionButton actionId={VcsActionIds.GIT_LOG_HIDE_BRANCHES} />\n      <ToolbarSeparator />\n      {/*FIXME: replace this with a separate \"new branch from\" action*/}\n      <ActionButton actionId={VcsActionIds.GIT_CREATE_NEW_BRANCH} />\n      <ActionButton actionId={VcsActionIds.GIT_UPDATE_SELECTED} />\n      <ActionButton actionId={DELETE_BRANCH_ACTION_ID} />\n      <ActionButton actionId={SHOW_BRANCH_DIFF_ACTION_ID} />\n      <ActionButton actionId={SHOW_MY_BRANCHES_ACTION_ID} />\n      <ActionButton actionId={FETCH_ACTION_ID} />\n      <ActionButton actionId={TOGGLE_FAVORITE_ACTION_ID} />\n      <ActionButton\n        actionId={VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH}\n      />\n      <ToolbarSeparator />\n      <BranchesGroupByActionButton />\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </StyledToolbar>\n  );\n}\n","import { useRecoilCallback } from \"recoil\";\nimport React from \"react\";\nimport copyToClipboard from \"clipboard-copy\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  allCommitsState,\n  commitsSelectionState,\n  selectedCommitOids,\n} from \"./CommitsTable.state\";\n\nexport const useCommitsTableActions = (): ActionDefinition[] => {\n  const copyRevisionNumber = useRecoilCallback(\n    ({ snapshot }) =>\n      () => {\n        const selectedCommits = snapshot\n          .getLoadable(selectedCommitOids)\n          .getValue();\n        copyToClipboard(selectedCommits.join(\" \")).catch(console.error);\n      },\n    []\n  );\n\n  const refreshLog = useRecoilCallback(\n    ({ refresh }) =>\n      () => {\n        refresh(allCommitsState);\n      },\n    []\n  );\n\n  return [\n    {\n      id: VcsActionIds.COPY_REVISION_NUMBER,\n      title: \"Copy Revision Number\",\n      icon: <PlatformIcon icon=\"actions/copy.svg\" />,\n      useShortcutsOf: CommonActionId.COPY_REFERENCE,\n      actionPerformed: copyRevisionNumber,\n    },\n    {\n      id: VcsActionIds.LOG_REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      useShortcutsOf: CommonActionId.REFRESH,\n      actionPerformed: () => {\n        refreshLog();\n      },\n    },\n  ];\n};\n","import React, { RefObject } from \"react\";\nimport {\n  atom,\n  RecoilState,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionTooltip,\n  MultiViewToolWindow,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n  TooltipTrigger,\n  ToolWindowTabContent,\n} from \"@intellij-platform/core\";\n\nimport { VcsLogDetailsView } from \"./DetailsView/VcsLogDetailsView\";\nimport { VcsLogCommitsView } from \"./CommitsView/VcsLogCommitsView\";\nimport { VcsBranchesView } from \"./BranchesView/VcsBranchesView\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  useCloseVcsTab,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsLogTabShowBranches,\n  vcsLogTabShowCommitDetails,\n  vcsTabKeysState,\n  vcsTabTitleState,\n} from \"./vcs-logs.state\";\nimport { useCommitsTableActions } from \"./CommitsView/useCommitsTableActions\";\n\nexport const VERSION_CONTROL_TOOLWINDOW_ID = \"Version Control\";\n\nconst firstViewSizeState = atom({\n  key: \"vcs/toolwindow/firstViewSize\",\n  default: 0.25,\n});\nconst lastViewSizeState = atom({\n  key: \"vcs/toolwindow/lastViewSize\",\n  default: 0.35,\n});\n\nconst StyledToolWindowHeader = styled.span`\n  margin: 0 0.5rem 0 0.125rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  :focus-visible {\n    outline: none;\n  }\n`;\n\nexport const searchInputRefState = atom<RefObject<HTMLInputElement>>({\n  key: \"vcs/toolWindow/searchInputRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const VersionControlToolWindow = () => {\n  const tabKeys = useRecoilValue(vcsTabKeysState);\n  const [activeTabKey, setActiveTabKey] = useRecoilState(vcsActiveTabKeyState);\n  return (\n    <MultiViewToolWindow\n      headerContent={<StyledToolWindowHeader>Git:</StyledToolWindowHeader>}\n      activeKey={activeTabKey}\n      onActiveKeyChange={(key) => setActiveTabKey(`${key}`)}\n    >\n      {tabKeys.map((key) => (\n        <MultiViewToolWindow.View\n          tabContent={<VcsToolWindowTabTitle tabKey={key} />}\n          key={key}\n        >\n          <VcsTab tabKey={key} />\n        </MultiViewToolWindow.View>\n      ))}\n    </MultiViewToolWindow>\n  );\n};\n\nconst StyledExpandStripeButton = styled.button.attrs({ tabIndex: -1 })`\n  box-sizing: border-box;\n  all: unset;\n  width: 1.71875rem;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.625rem;\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  :disabled {\n    color: ${({ theme }) => theme.color(\"Button.disabledText\")};\n  }\n  &:hover {\n    background: ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Button.hoverBackground\",\n        theme.dark ? \"#0f0f0f28\" : \"#55555528\"\n      )};\n  }\n`;\nconst StyledShowBranchesButton = styled(StyledExpandStripeButton)`\n  border-right: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nconst StyledShowBranchesButtonText = styled.span`\n  writing-mode: vertical-lr;\n  transform: rotateZ(180deg);\n  font-size: 0.6875rem;\n`;\n\nfunction ShowBranchesButton({ onPress }: { onPress: () => void }) {\n  return (\n    <StyledShowBranchesButton onClick={onPress}>\n      <PlatformIcon icon=\"actions/arrowExpand\" />\n      <StyledShowBranchesButtonText>Branches</StyledShowBranchesButtonText>\n    </StyledShowBranchesButton>\n  );\n}\n\nfunction VcsTab({ tabKey }: { tabKey: string }) {\n  const [firstViewSize, setFirstViewSize] = useRecoilState(firstViewSizeState);\n  const [lastViewSize, setLastViewSize] = useRecoilState(lastViewSizeState);\n\n  const actions = useVcsLogsToolWindowActions();\n  const [showBranches, setShowBranches] = useRecoilState(\n    vcsLogTabShowBranches(tabKey)\n  );\n\n  const firstViewProps: Partial<ThreeViewSplitterProps> = showBranches\n    ? {\n        firstView: <VcsBranchesView tabKey={tabKey} />,\n        firstSize: firstViewSize,\n        onFirstResize: setFirstViewSize,\n        firstViewMinSize: 85,\n      }\n    : {};\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        // tabIndex is added to make the whole container focusable, which means the focus can go away from the currently\n        // focused element, when background is clicked. This is to follow the original implementation.\n        <StyledContainer\n          {...shortcutHandlerProps}\n          tabIndex={showBranches ? -1 : 0}\n        >\n          {!showBranches && (\n            <ShowBranchesButton onPress={() => setShowBranches(true)} />\n          )}\n          <ThreeViewSplitter\n            {...firstViewProps}\n            innerView={<VcsLogCommitsView tabKey={tabKey} />}\n            innerViewMinSize={200}\n            lastView={<VcsLogDetailsView tabKey={tabKey} />}\n            lastSize={lastViewSize}\n            onLastResize={setLastViewSize}\n            lastViewMinSize={40}\n          />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nfunction useToggleCurrentTabSettings(\n  toggleState: (activeTab: string) => RecoilState<boolean>\n) {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          toggleState(snapshot.getLoadable(vcsActiveTabKeyState).getValue()),\n          (value) => !value\n        );\n      },\n    []\n  );\n}\n\nfunction useVcsLogsToolWindowActions() {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const hideBranches = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          vcsLogTabShowBranches(\n            snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n          ),\n          // Would be nicer to have the action toggle, but prioritized matching the reference impl here.\n          false\n        );\n      },\n    []\n  );\n\n  const toggleMatchCase = useToggleCurrentTabSettings(vcsLogFilter.matchCase);\n  const toggleRegExp = useToggleCurrentTabSettings(vcsLogFilter.regExp);\n  const toggleDetails = useToggleCurrentTabSettings(vcsLogTabShowCommitDetails);\n\n  const actions: ActionDefinition[] = [\n    ...useCommitsTableActions(),\n    {\n      id: VcsActionIds.FOCUS_TEXT_FILTER,\n      title: \"Focus Text Filter\",\n      actionPerformed: () => {\n        textFilterRef.current?.focus();\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_HIDE_BRANCHES,\n      title: \"Hide Git Branches\",\n      icon: <PlatformIcon icon=\"actions/arrowCollapse\" />,\n      actionPerformed: hideBranches,\n    },\n    {\n      id: VcsActionIds.MATCH_CASE,\n      title: \"Match Case\",\n      icon: <PlatformIcon icon=\"actions/matchCase.svg\" />,\n      actionPerformed: toggleMatchCase,\n    },\n    {\n      id: VcsActionIds.REG_EXP,\n      title: \"Regex\",\n      icon: <PlatformIcon icon=\"actions/regex\" />,\n      actionPerformed: toggleRegExp,\n    },\n    {\n      id: VcsActionIds.SHOW_DETAILS,\n      title: \"Show Details\",\n      description: \"Display details panel\",\n      actionPerformed: toggleDetails,\n    },\n  ];\n  return actions;\n}\n\nfunction VcsToolWindowTabTitle({ tabKey }: { tabKey: string }) {\n  const closeTab = useCloseVcsTab();\n  return (\n    <ToolWindowTabContent\n      title={useRecoilValue(vcsTabTitleState(tabKey))}\n      closeButton={\n        tabKey !== \"MAIN\" && (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Close Tab\" />}>\n            <TabCloseButton onPress={() => closeTab(tabKey)} />\n          </TooltipTrigger>\n        )\n      }\n    />\n  );\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\n\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\nimport {\n  VERSION_CONTROL_TOOLWINDOW_ID,\n  VersionControlToolWindow,\n} from \"../VersionControl/VersionControlToolWindow/VersionControlToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  showStripeButton?: boolean;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({ anchor: \"left\", isVisible: false }),\n  },\n  {\n    id: VERSION_CONTROL_TOOLWINDOW_ID,\n    title: \"Version Control\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowChanges\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <VersionControlToolWindow />\n      </Suspense>\n    ),\n    showStripeButton: false,\n    initialState: toolWindowState({\n      anchor: \"bottom\",\n      weight: 0.35,\n    }),\n  },\n];\n","import { atom } from \"recoil\";\nimport { Bounds } from \"@intellij-platform/core\";\n\nexport const showProgressPanelState = atom({\n  key: \"ide.statusbar.showProgressPanel\",\n  default: false,\n});\nexport const tasksPopupBoundsState = atom<Bounds | null>({\n  key: \"ide.statusbar.tasksPopup\",\n  default: null,\n});\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport {\n  IconButton,\n  PlatformIcon,\n  Popup,\n  ProgressBar,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { tasksState, useCancelTask } from \"../tasks\";\nimport {\n  showProgressPanelState,\n  tasksPopupBoundsState,\n} from \"./IdeStatusBar.state\";\n\nconst StyledPopupTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport function TasksPopup() {\n  const setShowProgressPanel = useSetRecoilState(showProgressPanelState);\n  const tasks = useRecoilValue(tasksState);\n  const cancel = useCancelTask();\n  const [bounds, setBounds] = useRecoilState(tasksPopupBoundsState);\n\n  return (\n    <Popup\n      bounds={\n        // Maybe it would be a nicer UX to not fix height, and let it be based on content, but tried to mimic the\n        // original impl, where the height is fixed. The only improvement over the original impl is that the default\n        // height (in case of no persisted bounds), would depend on the content, and it will remain based on content,\n        // as long as the bounds is not changed manually by the user.\n        bounds || {\n          width: 300,\n          // TODO: allow for positioning based on right and/or bottom\n          left: window.innerWidth - 300 - /* distance to right edge */ 150,\n          top:\n            window.innerHeight -\n            tasks.length * 80 - // progress bars\n            30 - // header\n            100, // distance to bottom edge,\n        }\n      }\n      onBoundsChange={(bounds) => {\n        setBounds(bounds);\n      }}\n      minHeight={100}\n      minWidth={300}\n      nonDismissable\n      interactions=\"all\"\n    >\n      <Popup.Layout\n        header={\n          <Popup.Header hasControls>\n            <StyledPopupTitle>Background Tasks</StyledPopupTitle>\n            <TooltipTrigger tooltip={<Tooltip>Hide</Tooltip>}>\n              <IconButton\n                preventFocusOnPress\n                excludeFromTabOrder\n                onPress={() => setShowProgressPanel(false)}\n              >\n                <PlatformIcon icon=\"general/hideToolWindow\" />\n              </IconButton>\n            </TooltipTrigger>\n          </Popup.Header>\n        }\n        content={\n          <>\n            {tasks.map((task, index) => (\n              <React.Fragment key={task.id}>\n                <ProgressBar\n                  style={{ margin: \".5rem 0.75rem\" }}\n                  name={task.title}\n                  isIndeterminate={task.progress.isIndeterminate}\n                  aria-label={`Progress of ${task.title}`}\n                  details={\n                    task.progress.text ||\n                    (task.progress.secondaryText ? <>&nbsp;</> : undefined)\n                  }\n                  secondaryDetails={task.progress.secondaryText}\n                  value={task.progress.fraction}\n                  maxValue={1}\n                  button={\n                    task.isCancelable && (\n                      <ProgressBarStopButton onPress={() => cancel(task.id)} />\n                    )\n                  }\n                />\n                {tasks[index + 1] && <StyledVerticalSeparator />}\n              </React.Fragment>\n            ))}\n          </>\n        }\n      />\n    </Popup>\n  );\n}\n","import styled from \"styled-components\";\nimport {\n  BareButton,\n  Link,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { firstTaskState, taskCountState, useCancelTask } from \"../tasks\";\nimport { showProgressPanelState } from \"./IdeStatusBar.state\";\nimport React, { useEffect } from \"react\";\nimport { TasksPopup } from \"./TasksPopup\";\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\nconst StyledProgressBarButton = styled.span`\n  cursor: pointer;\n\n  ${ProgressBar.Container} {\n    cursor: unset;\n  }\n`;\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nexport const StatusBarTaskProgressBar = () => {\n  const firstTask = useRecoilValue(firstTaskState);\n  const tasksCount = useRecoilValue(taskCountState);\n  const cancel = useCancelTask();\n  const [showProgressPanel, setShowProgressPanel] = useRecoilState(\n    showProgressPanelState\n  );\n\n  // When there is no tasks, switch back to not showing the panel.\n  useEffect(() => {\n    if (tasksCount === 0) {\n      setShowProgressPanel(false);\n    }\n  }, [tasksCount]);\n\n  return (\n    <>\n      {firstTask && !showProgressPanel && (\n        <TooltipTrigger\n          tooltip={\n            <Tooltip>{`${firstTask.title}. Click to see all running background tasks.`}</Tooltip>\n          }\n        >\n          <BareButton\n            preventFocusOnPress\n            excludeFromTabOrder\n            onPress={() => {\n              setShowProgressPanel(true);\n            }}\n          >\n            <StyledProgressBarButton>\n              <StatusBarProgress\n                name={firstTask.progress.text || firstTask.title}\n                isIndeterminate={firstTask.progress.isIndeterminate}\n                value={firstTask.progress.fraction}\n                maxValue={1}\n                button={\n                  <>\n                    {/*  {task.canPause && (\n                      <ProgressBarPauseButton\n                        small\n                        paused={false}\n                        onPausedChange={() => {}}\n                      />\n                    )}*/}\n                    {firstTask.isCancelable && (\n                      <TooltipTrigger tooltip={<Tooltip>Cancel</Tooltip>}>\n                        <ProgressBarStopButton\n                          small\n                          onPress={() => cancel(firstTask.id)}\n                        />\n                      </TooltipTrigger>\n                    )}\n                  </>\n                }\n              />\n            </StyledProgressBarButton>\n          </BareButton>\n        </TooltipTrigger>\n      )}\n      {(tasksCount > 1 || showProgressPanel) && (\n        <>\n          <Spacer />\n          <Link\n            onPress={() =>\n              setShowProgressPanel((currentValue) => !currentValue)\n            }\n          >\n            {showProgressPanel ? \"Hide processes\" : \"Show all\"} ({tasksCount})\n          </Link>\n        </>\n      )}\n      {showProgressPanel && tasksCount > 0 && <TasksPopup />}\n    </>\n  );\n};\n","import { resolveRef } from \"isomorphic-git\";\nimport { selector } from \"recoil\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsRootForFile, vcsRootsState } from \"./file-status.state\";\nimport {\n  branchForPathState,\n  RepoBranches,\n  repoBranchesState,\n} from \"./Branches/branches.state\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootState = selector({\n  key: \"vcs/activeFileRepo\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    const activeFileRepo = activeFile && get(vcsRootForFile(activeFile));\n    return activeFileRepo ?? get(vcsRootsState)[0]?.dir;\n  },\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesState = selector<RepoBranches>({\n  key: \"vcs/activeFileRepoBranches\",\n  get: ({ get }) => {\n    const activeFileRepoRoot = get(activeFileRepoRootState);\n    return get(repoBranchesState(activeFileRepoRoot));\n  },\n});\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchState = selector({\n  key: \"vcs/activeFileCurrentBranch\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    return activeFile ? branchForPathState(activeFile) : null;\n  },\n});\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadState = selector({\n  key: \"vcs/activeFileRepoHead\",\n  get: async ({ get }) => {\n    const branch = get(activeFileCurrentBranchState);\n    if (branch) {\n      return {\n        detached: false,\n        head: branch,\n      };\n    }\n    const repoRoot = get(activeFileRepoRootState);\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  },\n});\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport { repoBranchesState, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useRecoilValue(repoBranchesState(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"invalid\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                errorMessage={\n                  error && validationState === \"invalid\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  IconButton,\n  Toolbar,\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport {\n  allBranchesState,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useRecoilState } from \"recoil\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>({\n  key: \"branchesPopup.bounds\",\n  default: undefined,\n});\n\nexport function BranchesPopup({ onClose }: { onClose: () => void }) {\n  const [repoBranches] = useLatestRecoilValue(allBranchesState);\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] =\n    useRecoilState(branchesPopupSizeState);\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  // useRefreshRecoilValueOnMount(allBranchesState);\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      onClose();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={onClose}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport { sampleRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { clone } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport styled from \"styled-components\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core\";\n\nconst StyledDialog = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${WINDOW_SHADOW};\n  text-align: center;\n  line-height: 1.5;\n`;\nconst StyledDialogHeader = styled.div`\n  background: ${({ theme }) => theme.color(\"Popup.Header.activeBackground\")};\n  padding: 4px;\n  text-align: center;\n`;\nconst StyledDialogContent = styled.div`\n  padding: 8px 16px;\n`;\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nexport const SampleRepoInitializer: React.FC = ({ children }) => {\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function init(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl });\n      }\n    }\n\n    init(sampleRepo.path, sampleRepo.url)\n      .then(() => {\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      })\n      .catch((e) => {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      });\n  }, []);\n\n  if (state === \"uninitialized\") {\n    return null;\n  }\n  if (state === \"initialized\") {\n    return <>{children}</>;\n  }\n  return (\n    <div style={{ minHeight: \"100vh\", position: \"relative\" }}>\n      <StyledDialog>\n        <StyledDialogHeader>Cloning sample repo</StyledDialogHeader>\n        <StyledDialogContent>\n          {state === \"cloning\" ? (\n            <>\n              Cloning <b>{sampleRepo.url}</b>. <br />\n              It may take several seconds.\n            </>\n          ) : (\n            <>Something went wrong!</>\n          )}\n        </StyledDialogContent>\n      </StyledDialog>\n    </div>\n  );\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n} from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\nimport {\n  sampleRepos,\n  useRefreshCurrentProjectFiles,\n} from \"../Project/project.state\";\nimport { cloneRepo, isSuccessfullyCloned } from \"../SampleRepoInitializer\";\nimport React from \"react\";\nimport { useRefreshVcsRoots } from \"./file-status.state\";\nimport { useRecoilCallback } from \"recoil\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n  const refreshProjectFiles = useRefreshCurrentProjectFiles();\n  const refreshVcsRoots = useRefreshVcsRoots();\n\n  return useRecoilCallback(\n    ({ reset }) =>\n      async () => {\n        const cloned = await isSuccessfullyCloned(sampleRepos.ExampleRepo.path);\n        if (!cloned && !notified) {\n          notified = true;\n          balloonManager.showSticky({\n            title: \"Clone another repo\",\n            icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n            body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n            actions: (\n              <>\n                <BalloonActionLink\n                  onPress={() => {\n                    runTask(\n                      {\n                        title: `Cloning source repository ${sampleRepos.ExampleRepo.url}`,\n                      },\n                      {\n                        run: async ({\n                          setIndeterminate,\n                          setFraction,\n                          setSecondaryText,\n                        }) => {\n                          await cloneRepo({\n                            dir: sampleRepos.ExampleRepo.path,\n                            url: sampleRepos.ExampleRepo.url,\n                            onProgress: (progress) => {\n                              if (progress.total) {\n                                const fraction =\n                                  progress.loaded / progress.total;\n                                setFraction(fraction);\n                                setSecondaryText(\n                                  `${progress.phase}: ${Math.round(\n                                    fraction * 100\n                                  )}% ${progress.loaded}/${progress.total}`\n                                );\n                              } else {\n                                setSecondaryText(progress.phase);\n                                setIndeterminate(true);\n                              }\n                            },\n                          }).then(\n                            () => {\n                              refreshVcsRoots();\n                              refreshProjectFiles(); // FIXME: flashes the whole page\n                            },\n                            (e) => {\n                              balloonManager.show({\n                                icon: \"Error\",\n                                title: \"Clone failed\",\n                                body: `Failed to clone git repo \"${sampleRepos.ExampleRepo.url} into ${sampleRepos.ExampleRepo.path}: ${e}\"`,\n                              });\n                            }\n                          );\n                        },\n                      }\n                    );\n                  }}\n                >\n                  Clone example-repo\n                </BalloonActionLink>\n              </>\n            ),\n          });\n        }\n      },\n    []\n  );\n};\n","import {\n  ActionTooltip,\n  PlatformIcon,\n  PopupTrigger,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { activeFileRepoHeadState } from \"../VersionControl/active-file.state\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\n\nexport function BranchPopupTrigger() {\n  const [gitRepoHead] = useLatestRecoilValue(activeFileRepoHeadState);\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    gitRepoHead && (\n      <PopupTrigger\n        placement=\"top\"\n        onOpenChange={(isOpen) => {\n          if (!isOpen) {\n            setTimeout(maybeShowGitCloneTip, 500);\n          }\n        }}\n        popup={({ close }) => <BranchesPopup onClose={close} />}\n      >\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={\n                gitRepoHead.detached\n                  ? \"Git: Detached HEAD doesn't point to any branch\"\n                  : `Git Branch: ${gitRepoHead.head}`\n              }\n            />\n          }\n        >\n          <StatusBarWidget\n            icon={\n              <PlatformIcon\n                icon={\n                  gitRepoHead.detached\n                    ? \"general/warning.svg\"\n                    : \"vcs/branch.svg\"\n                }\n              />\n            }\n            label={gitRepoHead.head.slice(\n              0,\n              gitRepoHead.detached ? 8 : undefined\n            )}\n          />\n        </TooltipTrigger>\n      </PopupTrigger>\n    )\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\n\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { StatusBarTaskProgressBar } from \"./StatusBarTaskProgressBar\";\nimport { BranchPopupTrigger } from \"./BranchPopupTrigger\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\nexport const IdeStatusBar = () => {\n  const cursorPosition = useRecoilValue(editorCursorPositionState);\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarTaskProgressBar />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <BranchPopupTrigger />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  IconButton,\n  IconButtonWithMenu,\n  ActionsProvider,\n  Toolbar,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n  ActionButton,\n} from \"@intellij-platform/core\";\n\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { allChangesState, useRollbackChanges } from \"../change-lists.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { defaultChangeGroupings } from \"../ChangesTree/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"../ChangesView/changesViewTreeNodeRenderer\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  line-height: 2;\n  padding-left: 0.5rem;\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useRecoilValue(\n    rollbackViewState.initiallyExpandedKeys\n  );\n  const initiallyIncludedChangeKeys = useRecoilValue(\n    rollbackViewState.initiallyIncludedChanges\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [windowBounds, setWindowBounds] = useRecoilState(\n    rollbackViewState.windowBounds\n  );\n  const rootNodes = useRecoilValue(rollbackViewState.rootNodes);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<ChangesViewTreeNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetRecoilState(rollbackViewState.isOpen);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              defaultChangeGroupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      treeRef={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = changesViewTreeNodeRenderer.getItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \"0 .75rem\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox isDisabled>\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close}>Cancel</Button>\n                  <Button\n                    variant=\"default\"\n                    onPress={() => {\n                      rollbackChanges(includedChanges)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"recoil\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsState = atom({\n  key: \"toolWindows\",\n  default: new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    ),\n    {\n      removedFromSideBarIds: toolWindows\n        .filter(({ showStripeButton }) => showStripeButton === false)\n        .map(({ id }) => id),\n    }\n  ),\n});\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom, atomFamily } from \"recoil\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom({\n    key: \"search.everywhere.isOpen\",\n    default: false,\n  }),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>({\n    key: \"search.everywhere.tab\",\n    default: \"All\",\n  }),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element>({\n    key: \"search.everywhere.contextElement\",\n    default: undefined,\n  }),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily<string, string>({\n    key: \"search.everywhere.initialQuery\",\n    default: \"\",\n  }),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>({\n    key: \"search.everywhere.bounds\",\n    default: null,\n  }),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { RecoilState, useSetRecoilState } from \"recoil\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsState,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of a recoil state.\n   */\n  persistedBoundsState: RecoilState<Partial<Bounds> | null>;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetRecoilState(persistedBoundsState);\n  const getInitBounds = useRecoilInitialValue(persistedBoundsState, {\n    top: 150,\n    height: Math.max(200, window.innerHeight - 300),\n  });\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(getInitBounds);\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 0.9375rem;\n  margin-right: 0.25rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useRecoilValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = file.name;\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback } from \"recoil\";\nimport {\n  currentProjectFilesState,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const getProjectFiles = useRecoilCallback(\n      ({ snapshot }) =>\n        () =>\n          snapshot.getLoadable(currentProjectFilesState).getValue(),\n      []\n    );\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        getProjectFiles()\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useCollectionSearchInput,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetRecoilState(searchEverywhereState.isOpen);\n  const [tab, setTab] = useRecoilState(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useRecoilInitialValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetRecoilState(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const collectionRef = useRef<HTMLDivElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef,\n    selectionManager: selectionManagerRef.current,\n  });\n\n  const tips = useTips();\n\n  return (\n    <ContentAwarePopup\n      persistedBoundsState={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        {...collectionSearchInputProps}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        ref={collectionRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        showAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={(key) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            setSearchResultLimit(\n                              (limit) => limit + SEARCH_RESULT_LIMIT\n                            );\n                            const nextItem =\n                              searchResult[visibleSearchResult.length + 1];\n                            if (nextItem) {\n                              // nextItem is expected to always have value\n\n                              // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n                              // if we want to avoid setTimeout\n                              setTimeout(() => {\n                                setSelectedKeys(new Set([nextItem.key]));\n                                selectionManagerRef.current?.setFocusedKey(\n                                  nextItem.key\n                                );\n                              });\n                            }\n                          } else {\n                            close();\n                            // Making sure the popup is fully closed before the new action is performed. One edge case that can\n                            // make a difference is actions like FindAction that open the same popup. By performing an action\n                            // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n                            // won't get any feedback when choosing such actions.\n                            setTimeout(() => {\n                              const itemWrapper = searchResult.find(\n                                (item) => item.key === key\n                              );\n                              itemWrapper?.contributor.processSelectedItem(\n                                itemWrapper.item\n                              );\n                              /**\n                               * The 50ms timeout is a workaround for an issue in FocusScope:\n                               * restoreFocus only works if the previously focused element is in the dom, when the focus\n                               * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n                               * window, which has a focus scope, when the window is opened, the currently focused\n                               * element (which will be the one to restore focus to), is search everywhere dialog, which\n                               * is immediately closed. So when the modal window is closed, it tries to move focus back\n                               * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n                               * track a chain of nodes to restore focus to.\n                               * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n                               * is closed, and then the actions is performed, for focus restoration to work.\n                               */\n                            }, 50);\n                          }\n                        }}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          return (\n                            <Item\n                              key={key}\n                              textValue={contributor.getItemText(item)}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import { useRecoilCallback } from \"recoil\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core\";\n\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useRecoilCallback(\n    ({ set }) =>\n      ({ element }: ActionContext, tab: string) => {\n        if (element) {\n          set(searchEverywhereState.isOpen, true);\n          set(searchEverywhereState.tab, tab);\n          set(searchEverywhereState.contextElement, element);\n        }\n      },\n    []\n  );\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changeListsUnderSelection,\n  changesTreeNodesState,\n  changesUnderSelectedKeys,\n  ChangesViewTreeNode,\n  expandedKeysState,\n  includedChangeKeysState,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysState,\n} from \"./ChangesView/ChangesView.state\";\nimport {\n  allChangesState,\n  useRefreshChanges,\n  useSetActiveChangeList,\n} from \"./change-lists.state\";\nimport path from \"path\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsState,\n  currentProjectFilesState,\n} from \"../../Project/project.state\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport { getNodeKeyForChange, isGroupNode } from \"./ChangesTree/ChangeTreeNode\";\nimport { Change } from \"./Change\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useRecoilCallback(\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  const refresh = useRefreshChanges();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useRecoilCallback(queueCheckInCallback, []);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useRecoilValue(activePathsState);\n  const projectFiles = useRecoilValue(currentProjectFilesState);\n  const roots = activePaths.filter(\n    (path) =>\n      !activePaths.find(\n        (activePath) => path !== activePath && path.startsWith(activePath)\n      )\n  );\n\n  const isDir = projectFiles.find(\n    (item) => path.dirname(item.path).startsWith(roots[0]) // This is not quite accurate!\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, Change.path(change)))\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: isDir\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useRecoilCallback(\n    ({ snapshot, set }) =>\n      () => {\n        const includedChangesKeys = snapshot\n          .getLoadable(includedChangeKeysState)\n          .getValue();\n        let keyToSelect = includedChangesKeys.values().next().value;\n        if (includedChangesKeys.size === 0) {\n          const allKeys = snapshot\n            .getLoadable(allChangesState)\n            .getValue()\n            .map(getNodeKeyForChange);\n          set(includedChangeKeysState, new Set(allKeys));\n          keyToSelect = allKeys[0];\n        }\n        if (keyToSelect) {\n          const { rootNodes } = snapshot\n            .getLoadable(changesTreeNodesState)\n            .getValue();\n          set(\n            expandedKeysState,\n            new Set([\n              ...snapshot.getLoadable(expandedKeysState).getValue(),\n              ...getExpandedToNodesKeys(\n                (node) => (isGroupNode(node) ? node.children : null),\n                (node) => node.key,\n                rootNodes as ChangesViewTreeNode[],\n                [keyToSelect]\n              ),\n            ])\n          );\n          set(selectedKeysState, new Set([keyToSelect]));\n        }\n      },\n    []\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        if (!change.after?.isDir) {\n          editorStateManager.openPath(\n            Change.path(change),\n            index === arr.length - 1\n          );\n        }\n      });\n    },\n  };\n}\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChangeLists = useRecoilValue(changeListsUnderSelection);\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  if (selectedChanges.size > 0) {\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { activeFileRepoBranchesState } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport { Errors } from \"isomorphic-git\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useRecoilValue(activeFileRepoBranchesState);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"invalid\" : \"valid\";\n\n  const create = () => {\n    if (isValid) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              errorMessage={\n                validationState === \"invalid\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"invalid\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n\n  return [\n    ...useChangesViewActionDefinitions(),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup onClose={close} />);\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH,\n      title: \"Navigate Log to Selected Branch Head\",\n      useShortcutsOf: \"SelectIn\",\n      icon: <PlatformIcon icon=\"general/locate.svg\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n  ];\n}\n","import {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { useEffect, useRef } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { RecoilSync } from \"recoil-sync\";\n\nimport { fs } from \"../../fs/fs\";\nimport { ensureDir } from \"../../fs/fs-utils\";\nimport { currentProjectState } from \"../project.state\";\nimport { StorageFiles } from \"./persistentAtomEffect\";\n\ntype ComponentState = { [key: string]: unknown; \"@name\": string };\ntype WorkspaceState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\n\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\n\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nasync function readWorkspace(\n  storageFile: string\n): Promise<null | WorkspaceState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const workspaceFileExists = await fs.promises.exists(storageFile);\n  if (!workspaceFileExists) {\n    return null;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = xmlParser.parse(xmlData);\n  workspace.project = workspace.project || {};\n  workspace.project.component = workspace.project.component || {\n    component: [],\n  };\n  return workspace;\n}\nasync function writeWorkspace(\n  storageFile: string,\n  workspaceState: WorkspaceState\n): Promise<void> {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n\n  const xmlString = xmlBuilder.build(workspaceState);\n  await ensureDir(fs.promises, path.dirname(storageFile));\n  await fs.promises.writeFile(storageFile, xmlString);\n}\n\nconst storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n\nexport function PersistentStateProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const containerDirectory = path.join(\n    useRecoilValue(currentProjectState).path,\n    \".idea\"\n  );\n  const workspacePromiseRef = useRef<{\n    [key: string]: Promise<WorkspaceState | null>;\n  }>({});\n\n  const resolveStorageFile = (storageFile: string) =>\n    path.join(\n      containerDirectory,\n      storageFileMapping[storageFile] || storageFile\n    );\n\n  const getWorkspace = (storageFile: string) => {\n    // FIXME: caching the first read can cause issues when multiple writes happen, where they override each other.\n    const resolvedStorageFile = resolveStorageFile(storageFile);\n    if (!workspacePromiseRef.current[resolvedStorageFile]) {\n      workspacePromiseRef.current[resolvedStorageFile] =\n        readWorkspace(resolvedStorageFile);\n    }\n    return workspacePromiseRef.current[resolvedStorageFile];\n  };\n\n  // preload common storage files\n  useEffect(() => {\n    getWorkspace(StorageFiles.WORKSPACE_FILE);\n  }, []);\n\n  return (\n    <RecoilSync\n      storeKey=\"ProjectWorkspace\"\n      read={async (key: string) => {\n        const [storageFile, componentName] = key.split(\"|\");\n        const workspace = await getWorkspace(storageFile);\n        return workspace?.project.component.find(\n          ({ \"@name\": name }) => name === componentName\n        );\n      }}\n      write={async ({ diff }) => {\n        const changesByFile = groupBy(\n          ({ storageFile }) => storageFile,\n          [...diff.entries()].map(([key, value]) => {\n            const [storageFile, componentName] = key.split(\"|\");\n            return {\n              storageFile,\n              componentName,\n              value,\n            };\n          })\n        );\n\n        for (const storageFile in changesByFile) {\n          const changes = changesByFile[storageFile];\n          const workspace: WorkspaceState = (await readWorkspace(\n            storageFile\n          )) || {\n            \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n            project: { \"@version\": \"4\", component: [] },\n          };\n          for (const { value, componentName } of changes) {\n            const components = workspace.project.component;\n            const index = components.findIndex(\n              ({ \"@name\": name }) => name === componentName\n            );\n            const componentState =\n              typeof value === \"function\"\n                ? value(components[index] || null)\n                : (value as object);\n            components.splice(index, index >= 0 ? 1 : 0, {\n              \"@name\": componentName,\n              ...componentState,\n            });\n          }\n          await writeWorkspace(resolveStorageFile(storageFile), workspace);\n        }\n      }}\n    >\n      {children}\n    </RecoilSync>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + Math.round(num / 20) + 1;\n}\n","import React, { CSSProperties, RefObject, useEffect } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useBalloonManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport {\n  useInitializeVcs,\n  useRefreshVcsRoots,\n} from \"../VersionControl/file-status.state\";\nimport { toolWindows } from \"./toolWindows\";\nimport { useInitializeChanges } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsState } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { PersistentStateProvider } from \"./persistence/PersistentStateProvider\";\nimport { useTestActions } from \"../testActions/useTestActions\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({\n  height,\n  toolWindowRef,\n}: {\n  height: CSSProperties[\"height\"];\n  toolWindowRef: RefObject<ToolWindowRefValue>;\n}) => {\n  const [state, setState] = useRecoilState(toolWindowsState);\n  const isRollbackWindowOpen = useRecoilValue(rollbackViewState.isOpen);\n  const isSearchEveryWhereOpen = useRecoilValue(searchEverywhereState.isOpen);\n  const refreshVcsRoots = useRefreshVcsRoots();\n\n  useEffect(() => {\n    refreshVcsRoots();\n  }, []);\n  useInitializeVcs();\n  useInitializeChanges();\n  usePersistenceFsNotification();\n  _balloonManagerRef.value = useBalloonManager();\n\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n\n  return (\n    <PersistentStateProvider>\n      <StyledWindowFrame style={{ height }}>\n        <ActionsProvider\n          actions={allActions}\n          useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n        >\n          {({ shortcutHandlerProps }) => (\n            <>\n              <DefaultToolWindows\n                ref={toolWindowRef}\n                toolWindowsState={state}\n                onToolWindowStateChange={(newState) => {\n                  setState(newState);\n                }}\n                windows={toolWindows}\n                containerProps={shortcutHandlerProps}\n              >\n                <FileEditor />\n              </DefaultToolWindows>\n              <IdeStatusBar />\n            </>\n          )}\n        </ActionsProvider>\n\n        {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n        {isRollbackWindowOpen && <RollbackWindow />}\n      </StyledWindowFrame>\n    </PersistentStateProvider>\n  );\n};\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport interface ProcessState {\n  state:\n    | \"STARTED\"\n    | \"PAUSED\"\n    | \"PAUSING\"\n    | \"CANCELED\"\n    | \"CANCELING\"\n    | \"FINISHED\";\n  /**\n   * between 1 and 100\n   */\n  progress: number;\n  isIndeterminate: boolean;\n  name: string;\n  details: string;\n  onCancel?: () => void;\n  onPause?: () => void;\n}\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateVersionControlWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit9\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n  [VcsActionIds.FOCUS_TEXT_FILTER]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyL\",\n      },\n    },\n  ],\n  SafeDelete: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n};\n","import * as path from \"path\";\nimport React, { CSSProperties, useRef } from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  BalloonManager,\n  KeymapProvider,\n  PopupManager,\n  ToolWindowRefValue,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { SampleRepoInitializer } from \"./SampleRepoInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport { ToolWindowsRefContext } from \"./Project/useToolWindowManager\";\nimport \"./jetbrains-mono-font.css\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({ height }: { height?: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <SampleRepoInitializer>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <RecoilRoot>\n              <BalloonManager disablePortal>\n                <WindowManager>\n                  <PopupManager>\n                    {/* disablePortal to make example app more portable*/}\n                    <ToolWindowsRefContext.Provider value={toolWindowRef}>\n                      <Project height={height} toolWindowRef={toolWindowRef} />\n                    </ToolWindowsRefContext.Provider>\n                  </PopupManager>\n                </WindowManager>\n              </BalloonManager>\n            </RecoilRoot>\n          </KeymapProvider>\n        </SampleRepoInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n"],"names":["LoadingGif","props","Img","src","darkSrc","Loading","styled","DefaultSuspense","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","darculaColorSchemeTokenRules","vsCodeTheme","scope","settings","flatMap","map","token","values","Object","keys","forEach","key","value","StyledEditor","MonacoEditor","Editor","editorTheme","monaco","useMonaco","theme","useTheme","themeName","setThemeName","useState","dark","useLayoutEffect","name","replace","editor","defineTheme","base","inherit","colors","rules","useEditorTheme","options","minimap","enabled","lineHeight","showFoldingControls","renderIndentGuides","overviewRulerBorder","fontFamily","fontSize","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","persistentFsPreference","get","localStorage","getItem","set","setItem","switchToPersistentFS","log","getRootFS","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","read","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentState","selectorFamily","fileNames","all","fileName","type","basename","lastModification","mtimeMs","size","reloadFileFromDiskCallback","fetchFileContent","fileContent","encoding","atomFamily","default","effects","onSet","error","filterPath","includes","useLatestRecoilValue","recoilValue","state","setState","loadable","useRecoilValueLoadable","useEffect","contents","getValue","useRecoilInitialValue","recoilState","defaultValue","useRecoilCallback","snapshot","getLoadable","sampleRepos","JUI","url","Recoil","ExampleRepo","sampleRepo","currentProjectState","atom","projectFilePath","projectRelativePath","currentProjectFilesState","selector","project","projectFilesState","projectPath","files","addItem","item","childItems","push","relativePath","activePathsState","useActivePathsProvider","nullValue","focusedElement","setValue","useSetRecoilState","elementRef","useRef","current","currentValue","equals","onFocus","currentTarget","onBlur","relatedTarget","Element","closest","createFocusBasedSetterHook","temporaryTabsDefaultValue","sortWith","descend","file","endsWith","filter","slice","editorState","cursorPos","lineNumber","column","editorTabsState","activeEditorTabIndexState","activeEditorTabState","tabs","editorCursorPositionState","Position","editorRefState","useEditorStateManager","tabsState","setTabsState","useRecoilState","setActiveTabIndex","focus","valueOrThrow","select","index","closeTab","_","tabIndex","openPath","shouldFocus","findIndex","tab","newIndex","length","currentState","setTimeout","closePath","Math","max","closeOthersTabs","convertGitStatus","Array","isArray","asyncFilter","predicate","array","predicateResult","dir","Boolean","vcs","vcsRootsState","useRefreshVcsRoots","setVcsRoots","roots","vcsRootForFile","findRoot","fileStatusState","useUpdateFileStatus","repoRoot","getPromise","fileStatus","useUpdateVcsFileStatuses","transact_UNSTABLE","vcsDirectoryMappings","rows","statusMatrix","row","useStatusColor","FileStatusColor","color","useRecoilValue","useFileStatusColor","style","StatusColor","currentForegroundAware","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","FileEditor","editorStateManager","activeTab","editorRef","active","setActive","hideAllAction","useAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","tabActionsRef","useLatest","setEditorRef","fileContentState","contentLoadable","setContent","updateFileStatus","setPosition","activePathsProviderProps","valueMaybe","StyledFileEditorContainer","mergeProps","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","PlatformIcon","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","onMount","monacoEditor","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","getPosition","onChange","newContent","FileEditorLoading","isUnderDarcula","commonColors","panelBackground","StyledXterm","XTerm","Terminal","input","setInput","xtermRef","useMemo","background","selection","letterSpacing","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","write","ref","onData","data","charCodeAt","foldersOnTopState","expandedKeysState","Set","selectedKeysState","projectViewTreeRefState","React","dangerouslyAllowMutability","currentProjectTreeState","rootItems","mapItem","parent","node","dirNode","notNull","sortProjectTreeNodes","createProjectTree","sort","item1","item2","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","ProjectViewPane","setProjectViewTreeRef","projectTree","setExpandedKeys","selectedKeys","setSelectedKeys","sortItems","sortBy","a","identity","selectedKeysArray","i","SpeedSearchTree","fillAvailableSpace","autoFocus","selectionMode","onExpandedChange","undefined","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","selectPathInProjectView","selectOpenedFile","id","actionPerformed","isDisabled","description","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","actionId","CommonActionId","Change","change","after","before","isModification","changeListsState","comment","changes","allChangesState","find","changeList","changeLists","flat","isAChange","head","workingDir","stage","refreshChangesCallback","gitRoots","root","pathname","theRest","workdir","isDir","useRefreshChanges","createGroupByDirectory","getPath","mapNode","createDirectoryNode","shouldCollapseDirectories","nodes","pathToNodeCache","rootDirNodes","startsWith","reduce","prevNode","parentNodePath","isDirectoryNode","directoryNodes","uniq","collapseDirectories","createDirectorNode","child","changesTreeNodeKey","getNodeKeyForChange","changeNode","showPath","isGroupNode","isChangeNode","getChildren","repositoryGrouping","isAvailable","groupFn","repository","repositoryNode","directoryGrouping","directoryNode","defaultChangeGroupings","defaultChangeGroupingsState","grouping","isRecoilValue","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","getChangesGroupFn","isActive","groupings","groupFns","isOpen","windowBounds","initiallyIncludedChanges","rootNodes","selectedChanges","changesTreeNodesState","some","rollbackViewState","initiallyExpandedKeys","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","changesTreeNodesResult","fileCountsMap","Map","byKey","expandAllKeys","dfsVisit","childrenFileCount","add","fileCount","total","count","changeListNode","showIgnoredFilesState","showRelatedFilesState","changesGroupingActiveState","resolvedSelectedKeysState","bfsVisit","parentValue","selectedNodesState","changesUnderSelectedKeys","selectedNodes","allChanges","processNode","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysState","includedChangesState","includedChangeKeys","has","includedChangesNestedSelection","getCallback","NestedSelection","createSetInterface","getKey","changesViewGroupingsState","changeListNodes","groupChildren","commitMessageSizeState","orientation","amendCommitState","commitMessageState","commitErrorMessageState","commitTaskIdState","changesFromActivePaths","activePaths","activePath","queueCheckInCallback","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","contextual","changesUnderSelection","changesBasedOnActivePaths","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","GIT_LOG_HIDE_BRANCHES","GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH","GIT_UPDATE_SELECTED","FOCUS_TEXT_FILTER","MATCH_CASE","REG_EXP","COPY_REVISION_NUMBER","LOG_REFRESH","SHOW_DETAILS","ChangesViewTreeContextMenu","ActionsMenu","DividerItem","getTrackingBranch","localBranchName","mergeRef","git","remote","StorageFiles","persistentAtomEffect","componentName","refine","update","storageFile","WORKSPACE_FILE","itemKey","join","syncEffect","storeKey","syncDefault","readComponentState","DefaultValue","repoLocalBranchesState","branches","branch","trackingBranch","repoRemoteBranchesState","remotes","repoBranchesState","currentBranchName","repoCurrentBranchNameState","localBranches","currentBranch","remoteBranches","fullname","allBranchesState","branchForPathState","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","maybeArray","readBranchStorage","branchStorage","entry","list","toBranchStorage","branchesByType","groupBy","entries","branchInfoArrayChecker","object","union","literal","string","favoriteBranchesState","gitSettings","isFavoriteBranchState","branchInfo","isFavorite","excludedFromFavoriteBranchesState","isPredefinedAsFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","StyledRepoColorSquare","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","currentBackgroundAware","fileCountMsg","IntlMessageFormat","formatFileCount","format","ChangeNodeHint","defaultNodeRenderers","rendered","directory","isRename","createChangesTreeNodeRenderer","renderers","defaultRendererOverrides","nodeRenderers","getItemProps","nodeRenderer","dirCount","hasChildItems","getTextValue","itemRenderer","changesViewTreeNodeRenderer","changelist","fontWeight","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","selectionState","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","menuProps","GroupByActionButton","IconButton","isPressed","ChangesGroupByActionButton","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","border","tasksState","firstTaskState","taskCountState","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","updates","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","finally","onFinished","useCancelTask","abort","commitSuccessfulMessage","useCommitChanges","refreshChanges","refreshFileStatus","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","oid","tree","blob","mode","newTreeOid","commitRef","commitFiles","message","author","email","part","StyledCommitMessageContainer","StyledCommitMessageTextArea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","commit","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","event","placeholder","Button","preventFocusOnPress","variant","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","Checkbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","amend","setAmend","ActionHelpTooltip","helpText","preventFocus","StyledContainer","StyledTreeViewWrapper","focusCommitMessage","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","commitMessageSize","setCommitMessageSize","treeActions","ThreeViewSplitter","innerView","ActionsProvider","shortcutHandlerProps","innerViewMinSize","lastView","lastSize","onLastResize","ChangesViewPane","refresh","TrackingBranchInfo","borderSpacing","mapping","COMMIT_TOOLWINDOW_ID","changesBranchesState","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","tabContent","UNSAFE_FocusRestoringSuspense","document","activeElement","HTMLElement","isConnected","StyledHeader","borderColor","StyledSpacer","StyledPlaceholderContainer","inactiveTextColor","dateToString","date","getMonth","getDate","getFullYear","toString","dateRangeToString","dateRange","from","to","vcsTabKeysState","vcsActiveTabKeyState","vcsTabTitleState","searchQuery","vcsLogFilter","user","parts","short","long","tabStats","vcsLogTabState","someAtomFamily","vcsLogTabShowBranches","vcsLogTabShowCommitDetails","matchCase","regExp","vcsLogFilterCurrentTab","mapObjIndexed","newValue","closeTabCallback","reset","tabKey","resolvedRefState","depth","cache","commitDateComparator","b","committer","timestamp","match","query","flags","RegExp","test","toLowerCase","allCommitsState","allCommits","commitsMap","commitsToProcess","readCommitResult","sources","initialCommits","refs","repoPath","isBare","getCommonArgs","c1","c2","addCommit","latestCommit","containingRefs","shift","aCommit","splice","commitsTableRowsState","dateFilter","getTime","byOid","indexBy","allResolvedRefsState","repoBranches","addRef","isCurrent","commitsSelectionState","selectedCommitOids","selectedCommitsState","selectedCommitState","vcsTableShowCommitTimestampState","vcsTableReferencesOnTheLeftState","vcsTableHighlightMyCommitsState","authorColumn","hashColumn","dateColumn","defaultVisibleColumns","vcsTableColumnsVisibilityState","parseCommitMessage","lines","bodyLines","subject","bodyAsString","line","shortenOid","commitDateTimeFormatter","Intl","DateTimeFormat","day","month","year","hour","minute","hour12","commitTimeFormatter","commitDateFormatter","getText","commitChangesTreeNodeRenderer","commitParent","computeSimilarity","file1Content","file2Content","diffLines","unchanged","added","removed","getCommitChanges","fromRef","toRef","trees","afterOid","beforeOid","afterType","beforeType","afterRevision","TextDecoder","decode","Uint8Array","beforeRevision","deletions","additions","foundRenames","candidate","detectRenames","commitChangesTreeRefState","COMMIT_PARENT_ID","changedFilesState","commitLogItem","result","sortTreeNodesInPlace","StyledLoadingWrapper","CommitChangedFiles","treeShortcutHandlerProps","selectedCommits","nothingSelected","stateLoadable","setSelection","marginBottom","Delayed","width","PositionedTooltipTrigger","placement","HelpTooltip","right","bottom","waitedEnough","setWaitedEnough","timer","clearTimeout","labelIcon","fill","d","vcsLogStandardColors","light","gitLogColors","localBranch","remoteBranch","tag","StyledRef","StyledLabelSvg","viewBox","StyledRefIconGroup","StyledLabelText","RefIcon","RefIconGroup","types","RefLabel","StyledCommitMessage","StyledCommitMessageHeader","StyledCommitterInfo","label","disabled","StyledCommitInfoRow","StyledRepoColorIcon","StyledRefsContainer","CommitDetails","firstSelectedCommit","allResolvedRefs","isMultiRepo","committerInfo","EmailLink","formatDateAndTime","refsByType","Tooltip","Date","RefGroup","StyledRefWithIcon","href","formatCommitDate","formatCommitTime","splitViewSizeState","VcsLogDetailsView","splitViewSize","setSplitViewSize","isDetailsVisible","toggleDetailsAction","toggleGroupBy","groupByMenuItems","groupBySelectedKeys","shortcut","SpeedSearchMenu","Divider","flexShrink","flex","minHeight","firstSize","onFirstResize","firstViewMinSize","firstView","StyledDropdownButton","focusRing","focused","StyledDropdownIcon","StyledValue","FocusableAutoHoverPlatformIcon","AutoHoverPlatformIcon","VcsFilterDropdown","onClear","menuTriggerProps","MenuTrigger","BareButton","hoverIcon","StyledMenuIconButton","role","BranchFavoriteButton","onClick","onPointerUp","stopPropagation","hoverContainerSelector","BranchesFilterDropdown","selectedBranches","setSelectedBranches","resetBranches","useResetRecoilState","BranchesFilterMenu","onBranchesSelected","groupRepoRoots","repoRoots","repoGroupedAllBranches","allBranches","allRemoteBranches","allLocalBranches","setFavoriteBranches","remoteBranchesByRemote","createLocalBranchItems","renderBranchItem","submenuBehavior","minWidth","origin","NAME_PATTERN","getNameInStandardForm","firstAndLastName","matches","getFirstAndLastName","firstName","lastName","PRINTABLE_ASCII_PATTERN","nameToLowerCase","gitRepoUserState","StyledCommitRow","StyledCommitCell","asOverlay","StyledMessageContainer","StyledRefTooltipRow","useCurrentUserHighlightStyle","currentUser","shouldHighlightCurrentUserCommits","userFilter","user2","CommitsTableRow","showCommitTimestamp","referencesOnTheLeft","isAuthorVisible","isDateVisible","isHashVisible","highlightStyles","flexBasis","flexGrow","CommitRefs","onLeft","refKey","filteredRefs","headIsOnABranch","aBranch","delay","withPointer","tooltipTriggerProps","unshift","StyledProgressBar","ProgressBar","StyledListItem","ResolvedRefsContext","CommitsTable","currentTabKey","resetFilters","commitRowsState","setSelectedCommits","Provider","List","estimatedItemHeight","Consumer","showToggleDefs","highlightToggleDefs","columnToggleDefs","useToggleDef","CommitsTableViewOptionsMenuIconButton","showToggles","highlightToggles","columnToggles","allToggles","toggleKey","StyledSearchInput","SearchInput","searchHistoryState","VcsLogCommitsView","textFilterRef","searchInputRefState","setSearchQuery","setUser","resetUser","setDateFilter","resetDate","searchHistory","setSearchHistory","searchInputValue","setSearchInputValue","getActionShortcut","useGetActionShortcut","isRegExpOn","isMatchCaseOn","submitSearchQuery","createNewTab","newTabId","uuid","filterState","today","sevenDaysAgo","setDate","yesterday","predefinedDateRanges","inputRef","onSubmit","addonAfter","excludeFromTabOrder","predefinedDateRange","getLocalBranchNodes","shouldGroupByDirectory","localBranchNodes","repos","groupNodesByDirectory","getRemoteBranchNodes","remoteBranchNodes","branchesTreeNodeState","branchTreeGroupingState","shouldGroupByRepository","isGroupByRepositoryAvailableState","branchesTreeRefState","searchInputState","availableGroupingsState","BranchesGroupByActionButton","availableGroupings","branchTreeNodeRenderers","toUpperCase","StyledSearchIconContainer","BranchesTree","branchesTreeNodes","searchTerm","setSearchTerm","searchInputRef","selectionManagerRef","isInputFocused","setInputFocused","setBranchFilter","collectionSearchInputProps","useCollectionSearchInput","collectionRef","selectionManager","_repo","keyToBranch","showAsFocused","onSearchTermChange","keepSearchActiveOnBlur","hideSpeedSearchPopup","isSearchActive","DELETE_BRANCH_ACTION_ID","SHOW_BRANCH_DIFF_ACTION_ID","SHOW_MY_BRANCHES_ACTION_ID","FETCH_ACTION_ID","TOGGLE_FAVORITE_ACTION_ID","VcsBranchesView","useShortcutsOf","VcsLogBranchesViewToolbar","StyledToolbar","useCommitsTableActions","copyRevisionNumber","copyToClipboard","refreshLog","firstViewSizeState","lastViewSizeState","StyledToolWindowHeader","VersionControlToolWindow","tabKeys","activeTabKey","setActiveTabKey","activeKey","onActiveKeyChange","VcsToolWindowTabTitle","VcsTab","StyledExpandStripeButton","StyledShowBranchesButton","StyledShowBranchesButtonText","ShowBranchesButton","firstViewSize","setFirstViewSize","lastViewSize","setLastViewSize","hideBranches","toggleMatchCase","useToggleCurrentTabSettings","toggleRegExp","toggleDetails","useVcsLogsToolWindowActions","showBranches","setShowBranches","firstViewProps","lastViewMinSize","toggleState","ToolWindowTabContent","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","showStripeButton","showProgressPanelState","tasksPopupBoundsState","StyledPopupTitle","TasksPopup","setShowProgressPanel","cancel","bounds","setBounds","Popup","left","innerWidth","top","innerHeight","onBoundsChange","nonDismissable","interactions","header","hasControls","margin","details","secondaryDetails","maxValue","button","ProgressBarStopButton","StatusBarProgress","dense","namePosition","Spacer","StyledProgressBarButton","StatusBarTaskProgressBar","firstTask","tasksCount","showProgressPanel","small","activeFileRepoRootState","activeFile","activeFileRepoBranchesState","activeFileRepoRoot","activeFileCurrentBranchState","activeFileRepoHeadState","detached","resolveRef","validateBranchName","newBranchName","ILLEGAL_CHARS_PATTERN","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","close","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","ModalWindow","WindowLayout","preventDefault","labelPlacement","footer","form","StyledTitle","branchesPopupSizeState","BranchesPopup","onClose","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","windowManager","useWindowManager","checkoutBranch","callbackInterface","reloadFileFromDisk","checkout","openedFiles","existingOpenedFile","interactionType","PopupLayout","currentBounds","disabledKeys","operation","tryCheckout","Errors","Balloon","open","aRepoRoot","checkoutRemoteBranch","getSectionLabel","compareActions","mergeActions","favoriteBranchArgs","StyledDialog","WINDOW_SHADOW","StyledDialogHeader","StyledDialogContent","isSuccessfullyCloned","info","SampleRepoInitializer","repoUrl","cloneRepo","onProgress","clone","http","corsProxy","singleBranch","notified","useShowGitTipIfNeeded","refreshProjectFiles","useRecoilRefresher_UNSTABLE","refreshVcsRoots","showSticky","loaded","phase","round","BranchPopupTrigger","gitRepoHead","maybeShowGitCloneTip","PopupTrigger","onOpenChange","popup","StatusBarWidget","StyledLastMessage","IdeStatusBar","cursorPosition","StatusBar","RollbackTreeContextMenu","StyledFrame","contrastBorder","StyledLine","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","changesWithRepoRoots","groupedChanges","filepaths","resetIndex","useRollbackChanges","balloons","setOpen","display","padding","flexDirection","toolWindowsState","ToolWindowsState","fromEntries","removedFromSideBarIds","tips","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsState","noContentHeight","otherProps","persistBounds","getInitBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","ActionItem","action","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","search","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","element","getItemText","renderItem","FileItem","dirMatches","filenameMatches","splitWhen","titleMatches","filesSearchContributor","getProjectFiles","SearchEverywhereActionIds","StyledTab","selected","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","getShortcut","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","setFocusedKey","requestAnimationFrame","localActions","currentContributorIndex","contributorActions","Tabs","TabComponent","TabsComponent","contain","newPattern","newPatternContainsPrevious","onPatternChanged","shouldFocusWrap","limit","nextItem","itemWrapper","useProjectActions","openSearchEverywhere","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","projectFiles","containsChange","relative","isPathInside","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","deleteChangeListMsg","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","autoSelect","useVcsActions","popupManager","usePopupManager","WORKSPACE_XML_PARSE_OPTIONS","attributeNamePrefix","ignoreAttributes","tagName","jPath","WORKSPACE_XML_BUILD_OPTIONS","readWorkspace","xmlParser","XMLParser","xmlData","workspace","parse","component","writeWorkspace","workspaceState","xmlString","XMLBuilder","build","storageFileMapping","PersistentStateProvider","containerDirectory","workspacePromiseRef","resolveStorageFile","getWorkspace","resolvedStorageFile","diff","changesByFile","components","componentState","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","updateVcsFileStatuses","useInitializeVcs","useInitializeChanges","timeoutId","usePersistenceFsNotification","useCapture","DefaultToolWindows","onToolWindowStateChange","newState","windows","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateVersionControlWindow","ActivateTerminalWindow","SafeDelete","App","KeymapProvider","BalloonManager","disablePortal","WindowManager","PopupManager"],"sourceRoot":""}