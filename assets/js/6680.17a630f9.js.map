{"version":3,"file":"assets/js/6680.17a630f9.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesGroupings.ts","webpack://website/../example-app/src/TreeUtils/tree-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/CurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActions.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/SampleRepoInitializer.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx","webpack://website/../jui/src/ActionButton/ActionButton.tsx","webpack://website/../jui/src/ActionButtonWithMenu/ActionButtonWithMenu.tsx","webpack://website/../jui/src/ActionSystem/useShortcut.ts","webpack://website/../jui/src/ActionSystem/ActionsProvider.tsx","webpack://website/../jui/src/ActionSystem/CommonActionIds.ts","webpack://website/../jui/src/ActionSystem/defaultKeymap.tsx","webpack://website/../jui/src/ActionSystem/KeymapProvider.tsx","webpack://website/../jui/src/ActionSystem/Shortcut.ts","webpack://website/../jui/src/ActionSystem/components/ActionsMenu.tsx","webpack://website/../jui/src/ActionSystem/components/ActionButton.tsx","webpack://website/../jui/src/ActionSystem/components/index.ts","webpack://website/../jui/src/ActionSystem/shortcutToString.ts","webpack://website/../jui/src/ActionSystem/useActionGroup.tsx","webpack://website/../jui/src/ActionToolbar/ActionToolbar.tsx","webpack://website/../jui/src/Balloon/Balloon.styled.tsx","webpack://website/../jui/src/Balloon/Balloon.tsx","webpack://website/../jui/src/Balloon/BalloonsProvider.tsx","webpack://website/../jui/src/Balloon/StyledBalloonsStack.tsx","webpack://website/../jui/src/Button/BareButton.tsx","webpack://website/../jui/src/Button/StyledButton.tsx","webpack://website/../jui/src/Button/Button.tsx","webpack://website/../jui/src/Checkbox/Checkbox.tsx","webpack://website/../jui/src/Checkbox/CheckboxIcon.tsx","webpack://website/../jui/src/CollectionSpeedSearch/CollectionSpeedSearchContext.tsx","webpack://website/../jui/src/CollectionSpeedSearch/HighlightedTextValue.tsx","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchSelectionManager.ts","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearch.ts","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearchResult.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchKeyboardDelegate.ts","webpack://website/../jui/src/Collections/Divider.ts","webpack://website/../jui/src/Collections/Item.ts","webpack://website/../jui/src/Collections/ItemLayout.tsx","webpack://website/../jui/src/Collections/SelectionAwareSpan.tsx","webpack://website/../jui/src/Collections/useCollectionAutoScroll.ts","webpack://website/../jui/src/Icon/AutoHoverPlatformIcon.tsx","webpack://website/../jui/src/Icon/LafIcon.tsx","webpack://website/../jui/src/Img.tsx","webpack://website/../jui/src/Link/StyledLink.tsx","webpack://website/../jui/src/Link/Link.tsx","webpack://website/../jui/src/List/ListDivider.tsx","webpack://website/../jui/src/List/StyledList.tsx","webpack://website/../jui/src/List/StyledListItem.tsx","webpack://website/../jui/src/Menu/ContextMenuContainer.tsx","webpack://website/../jui/src/Menu/StyledMenu.tsx","webpack://website/../jui/src/Menu/StyledMenuItem.tsx","webpack://website/../jui/src/Menu/MenuItem.tsx","webpack://website/../jui/src/Menu/MenuSection.tsx","webpack://website/../jui/src/Menu/Menu.tsx","webpack://website/../jui/src/Menu/MenuItemLayout.tsx","webpack://website/../jui/src/Menu/MenuOverlay.tsx","webpack://website/../jui/src/Menu/MenuTrigger.tsx","webpack://website/../jui/src/Menu/useContextMenu.tsx","webpack://website/../jui/src/ModalWindow/ModalWindow.tsx","webpack://website/../jui/src/ModalWindow/WindowLayout.tsx","webpack://website/../jui/src/ProgressBar/ProgressBar.tsx","webpack://website/../jui/src/ProgressBar/ProgressBarPauseButton.tsx","webpack://website/../jui/src/ProgressBar/ProgressBarStopButton.tsx","webpack://website/../jui/src/ResizableView.tsx","webpack://website/../jui/src/Resizer/BottomResizer.tsx","webpack://website/../jui/src/Resizer/HorizontalResizer.tsx","webpack://website/../jui/src/Resizer/LeftResizer.tsx","webpack://website/../jui/src/Resizer/RightResizer.tsx","webpack://website/../jui/src/Resizer/TopResizer.tsx","webpack://website/../jui/src/Resizer/VerticalResizer.tsx","webpack://website/../jui/src/Resizer/useResizer.ts","webpack://website/../jui/src/SpeedSearch/SpeedSearchPopup.tsx","webpack://website/../jui/src/SpeedSearch/useGhostInput.tsx","webpack://website/../jui/src/SpeedSearch/useSpeedSearch.tsx","webpack://website/../jui/src/StatusBar/StatusBar.tsx","webpack://website/../jui/src/StatusBar/StatusBarWidget.tsx","webpack://website/../jui/src/StyledSeparator.tsx","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabContent.tsx","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTab.ts","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTabs.ts","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabs.tsx","webpack://website/../jui/src/Tabs/StyledDefaultTab.ts","webpack://website/../jui/src/Tabs/StyledDefaultTabs.ts","webpack://website/../jui/src/Tabs/TabCloseButton.tsx","webpack://website/../jui/src/Tabs/TabContentLayout.tsx","webpack://website/../jui/src/Tabs/TabItem.tsx","webpack://website/../jui/src/Tabs/TabTheme.ts","webpack://website/../jui/src/Tabs/StyledHorizontalOverflowShadows.tsx","webpack://website/../jui/src/Tabs/Tab.tsx","webpack://website/../jui/src/Tabs/Tabs.tsx","webpack://website/../jui/src/Tabs/useIsScrolled.tsx","webpack://website/../jui/src/Tabs/useCollectionOverflowObserver.tsx","webpack://website/../jui/src/Tabs/TabsOverflowMenu.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTab.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTabs.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabs.tsx","webpack://website/../jui/src/TextRange.ts","webpack://website/../jui/src/TextWithHighlights/TextWithHighlights.tsx","webpack://website/../jui/src/ThreeViewSplitter/ThreeViewSplitter.tsx","webpack://website/../jui/src/ToolWindows/FloatView.tsx","webpack://website/../jui/src/ToolWindows/FloatToolWindows.tsx","webpack://website/../jui/src/ToolWindows/MovableToolWindowStripeProvider.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowOuterLayout.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsLayoutState.ts","webpack://website/../jui/src/ToolWindows/createGetDropPosition.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripeButton.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/useElementMove.tsx","webpack://website/../jui/src/ToolWindows/findEffectiveBackgroundColor.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/UndockSide.tsx","webpack://website/../jui/src/ToolWindows/ToolWindows.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowStateProvider.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsState.ts","webpack://website/../jui/src/ToolWindows/utils.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowSettingsIconMenu.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowHeader.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowToolbarButton.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindows.tsx","webpack://website/../jui/src/ToolWindowsImpl/MultiViewToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowActionIds.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowActions.tsx","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowsActions.tsx","webpack://website/../jui/src/Tooltip/ActionHelpTooltip.tsx","webpack://website/../jui/src/Tooltip/ActionTooltip.tsx","webpack://website/../jui/src/Tooltip/Tooltip.tsx","webpack://website/../jui/src/Tooltip/TooltipContext.tsx","webpack://website/../jui/src/Tooltip/TooltipTrigger.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTreeNode.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTree.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/useSpeedSearchTree.ts","webpack://website/../jui/src/Tree/StyledTree.tsx","webpack://website/../jui/src/Tree/TreeContext.tsx","webpack://website/../jui/src/Tree/TreeKeyboardDelegate.tsx","webpack://website/../jui/src/Tree/TreeNodeIcon.tsx","webpack://website/../jui/src/Tree/useTreeNodeToggleButton.tsx","webpack://website/../jui/src/Tree/StyledTreeNode.tsx","webpack://website/../jui/src/Tree/TreeNode.tsx","webpack://website/../jui/src/Tree/useTreeNode.tsx","webpack://website/../jui/src/Tree/useSelectableTree.tsx","webpack://website/../jui/src/Tree/useTreeRef.tsx","webpack://website/../jui/src/Tree/__copied__TreeCollection.ts","webpack://website/../jui/src/Tree/getSingleChildrenKeys.ts","webpack://website/../jui/src/Tree/TreeSelectionManager.ts","webpack://website/../jui/src/utils/array-utils.ts","webpack://website/../jui/src/Tree/useTreeState.ts","webpack://website/../jui/src/Collections/useCollectionCacheInvalidation.ts","webpack://website/../jui/src/VariableWidthListLayout.tsx","webpack://website/../jui/src/Tree/useTreeVirtualizer.tsx","webpack://website/../jui/src/TreeActions/useTreeActions.tsx","webpack://website/../jui/src/TreeCheckboxes/NestedSelection.ts","webpack://website/../jui/src/TreeCheckboxes/SpeedSearchTreeWithCheckboxes.tsx","webpack://website/../jui/src/TreeCheckboxes/TreeNodeCheckbox.tsx","webpack://website/../jui/src/TreeCheckboxes/useNestedSelectionState.ts","webpack://website/../jui/src/Window/WindowInteractionHandler.tsx","webpack://website/../jui/src/Window/WindowMoveHandle.tsx","webpack://website/../jui/src/Window/WindowResizeHandles.tsx","webpack://website/../jui/src/Window/useResizableMovableWindow.tsx","webpack://website/../jui/src/utils/string-utils.ts","webpack://website/../jui/src/minusculeMatch.ts","webpack://website/../jui/src/selection/useSelectableCollection.ts","webpack://website/../jui/src/selection/useSelectableItem.tsx","webpack://website/../jui/src/style-constants.ts","webpack://website/../jui/src/utils/FocusScope.tsx","webpack://website/../jui/src/utils/interaction-utils/textSelection.ts","webpack://website/../jui/src/utils/interaction-utils/useMove.tsx","webpack://website/../jui/src/utils/keyboard-utils.ts","webpack://website/../jui/src/utils/useContextOrThrow.tsx","webpack://website/../jui/src/utils/useEventCallback.ts","webpack://website/../jui/src/utils/useLatest.ts","webpack://website/../jui/src/utils/useMouseEventOverlayPosition.tsx","webpack://website/../jui/src/utils/usePrevious.ts","webpack://website/../jui/src/utils/immutableSet.ts","webpack://website/../jui/src/utils/useSet.ts"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif: React.FC = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] = vsCodeTheme.tokenColors.flatMap(\n  ({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n);\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editor.lineHighlightBorder\": \"none\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  return (\n    <StyledEditor\n      {...props}\n      options={{\n        minimap: { enabled: false },\n        lineHeight: 20,\n        showFoldingControls: \"always\",\n        renderIndentGuides: true,\n        scrollbar: {\n          verticalScrollbarSize: 10,\n          verticalSliderSize: 7,\n        },\n        ...props.options,\n      }}\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport { BFSCallback } from \"browserfs/src/core/file_system\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\n\nwindow.BrowserFS = BrowserFS;\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify(fsm);\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs\n    .exists(filepath)\n    // sometimes it throws boolean instead of returning :|\n    .catch((e) => (typeof e === \"boolean\" ? e : Promise.reject(e)));\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (persistentFsPreference.get() ===\n\"yes\"\n  ? createIndexedDBFS()\n  : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC = ({ children }) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import {\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { fs } from \"./fs\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  path: string;\n  size: number;\n}\n\n/**\n * recoil atoms and selectors for keeping list and content of files in recoil state, for components that need on such\n * state.\n * NOTE: still not clear if we should be using atomFamily or selectorFamily for this. changing the current\n * implementation to atomFamily however is easy and side effect free.\n */\nexport const dirContentState = selectorFamily({\n  key: \"dirContents\",\n  get: (path: string) => async (): Promise<null | FsItem[]> => {\n    let fileNames: string[];\n    try {\n      fileNames = await fs.promises.readdir(path);\n    } catch (e) {\n      return null;\n    }\n    const stats = await Promise.all(\n      fileNames.map((fileName) => {\n        const filePath = `${path}/${fileName}`;\n        return fs.promises.stat(filePath).then((stat) => ({\n          ...stat,\n          type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n          filePath,\n        }));\n      })\n    );\n    return stats.map((stat) => ({\n      type: stat.type,\n      path: stat.filePath,\n      size: stat.size,\n    }));\n  },\n});\n\nexport const reloadFileFromDiskCallback = ({\n  set,\n}: CallbackInterface) => async (path: string) =>\n  set(fileContent(path), await fetchFileContent(path));\n\nconst fetchFileContent = async (filepath: string) => {\n  if (!filepath) {\n    return \"\";\n  }\n  // @ts-expect-error return type is wrong\n  return fs.promises.readFile(filepath, {\n    encoding: \"utf8\",\n  }) as Promise<string>;\n};\n\n/**\n * **Note**: Still not quite clear if we should use atom and [synchronize with source of truth (FS)][recoil-atom-effects],\n * or if we should use selector and refresh it when needed. We probably need a proper [VFS][vfs] implementation at\n * some point, which would be capable of tracking modifications, and setting up listeners for it, and then atoms, can\n * hold the states like directory content, with effects which uses the listener API.\n * A few things to consider in that regard:\n * - if modifications to files are not directly synchronized to fs, using isomorphic-git for updating the file status\n *   can be tricky, unless an FS implementation is provided which uses the file content that is not yet synced with\n *   the actual local FS. Maybe something like Intellij's VFS, can be implemented as a BrowserFS backend impl.\n *\n * **Note**: currently, only text file is supported, for simplicity.\n *\n * [recoil-atom-effects]: https://recoiljs.org/docs/guides/atom-effects#write-through-cache-example\n * [vfs]: https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html\n **/\nexport const fileContent = atomFamily<string, string>({\n  key: \"fileContent\",\n  default: fetchFileContent,\n  effects: (filepath) => [\n    ({ onSet }) => {\n      onSet((content) => {\n        // Should a sync API be used here?\n        fs.promises\n          .writeFile(\n            filepath,\n            // @ts-expect-error: string should also be acceptable. Seems like bad typing\n            content,\n            { encoding: \"utf8\" }\n          )\n          .catch((e) => {\n            console.error(\"failed to sync the file back to the fs\", e);\n          });\n      });\n    },\n  ],\n});\n\nexport const useReloadFromDisk = (path: string) => {\n  return useRecoilRefresher_UNSTABLE(dirContentState(path));\n};\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import { atom, selector, selectorFamily } from \"recoil\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"./project-utils\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\n\nconst sampleRepos = {\n  JUI: {\n    path: \"/workspace/jui\",\n    url: \"https://github.com/alirezamirian/jui.git\",\n  },\n  \"React Spectrum\": {\n    path: \"/workspace/react-spectrum\",\n    url: \"https://github.com/adobe/react-spectrum.git\",\n  },\n  Recoil: {\n    path: \"/workspace/recoil\",\n    url: \"https://github.com/facebookexperimental/Recoil.git\",\n  },\n};\nconst sampleRepoKey: keyof typeof sampleRepos = \"JUI\";\n\n/**\n * temporary hard coded sample repo, until clone UI is implemented.\n */\nexport const sampleRepo = sampleRepos[sampleRepoKey];\n\nexport const currentProjectState = atom<Project>({\n  key: \"project\",\n  default: {\n    name: sampleRepoKey,\n    path: sampleRepo.path,\n  },\n});\n\nexport const projectFilePath = selectorFamily({\n  key: \"projectFilePath\",\n  get: (projectRelativePath: string) => ({ get }) =>\n    `${get(currentProjectState).path}/${projectRelativePath}`,\n});\n\nexport const currentProjectFilesState = selector({\n  key: \"projectFiles\",\n  get: async ({ get }): Promise<FsItem[]> => {\n    const project = get(currentProjectState);\n    const items = get(dirContentState(project.path));\n    const files: FsItem[] = [];\n    const addItem = (item: FsItem) => {\n      if (item.type === \"dir\" && filterPath(item)) {\n        const childItems = get(dirContentState(item.path));\n        if (childItems) {\n          childItems.map(addItem);\n        }\n      } else {\n        files.push(item);\n      }\n    };\n    (items || []).forEach((item) => addItem(item));\n    return files;\n  },\n});\n","import {\n  atom,\n  selector,\n  useRecoilCallback,\n  useRecoilState,\n  useSetRecoilState,\n} from \"recoil\";\nimport { Focusable } from \"../common-types\";\nimport { descend, sortWith } from \"ramda\";\nimport {\n  currentProjectFilesState,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Position } from \"monaco-editor\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n// settings.\nconst temporaryTabsDefaultValue = selector({\n  key: \"editor.tabs/Default\",\n  get: ({ get }) =>\n    sortWith(\n      [\n        // first README.md, then ts and js files.\n        descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n        descend((file) => file.path.endsWith(\".ts\")),\n        descend((file) => file.path.endsWith(\".js\")),\n      ],\n      get(currentProjectFilesState).filter((item) => item.type === \"file\")\n    )\n      .slice(0, 12)\n      // map project file to editor state object\n      .map((file) => ({\n        filePath: file.path,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n      })),\n});\n\n// it should become something under \"project\" state later.\nconst editorTabsState = atom<EditorTabState[]>({\n  key: \"editor.tabs\",\n  default: temporaryTabsDefaultValue,\n});\n\nconst activeEditorTabIndexState = atom<number>({\n  key: \"editor.activeTabIndex\",\n  default: 0,\n});\n\nexport const activeEditorTabState = selector({\n  key: \"editor.activeTab\",\n  get: ({ get }) => get(editorTabsState)[get(activeEditorTabIndexState)],\n});\n\nexport const editorCursorPositionState = atom<Position>({\n  key: \"editor.cursorPosition\",\n  default: new Position(0, 0),\n});\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefState = atom<null | Focusable>({\n  key: \"editor.focusHandle\",\n  default: null,\n});\n\nexport interface EditorStateManager {\n  tabs: EditorTabState[];\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOthersTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n}\n\nexport const useEditorStateManager = (): EditorStateManager => {\n  const [tabsState, setTabsState] = useRecoilState(editorTabsState);\n  const setActiveTabIndex = useSetRecoilState(activeEditorTabIndexState);\n  const focus = useRecoilCallback(\n    ({ snapshot }) => () => {\n      snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n    },\n    []\n  );\n\n  const select = (index: number) => {\n    setActiveTabIndex(index);\n  };\n  const closePath = (filePath: string) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      closeTab(index);\n      setActiveTabIndex(Math.max(index - 1, 0));\n    }\n  };\n  const openPath = (filePath: string, shouldFocus = true) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      select(index);\n    } else {\n      const newIndex = tabsState.length;\n      setTabsState((currentState) => [\n        ...currentState,\n        {\n          filePath,\n          editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n        },\n      ]);\n      select(newIndex);\n    }\n    if (shouldFocus) {\n      focus();\n    }\n  };\n  const closeTab = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex !== index)\n    );\n  };\n  const closeOthersTabs = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex === index)\n    );\n  };\n  return {\n    tabs: tabsState,\n    // This should become an action. Something like \"open project file\", when action system is implemented.\n    openPath,\n    closePath,\n    closeTab,\n    closeOthersTabs,\n    select,\n  };\n};\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  GetRecoilValue,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\nimport { currentProjectState } from \"../Project/project.state\";\nimport { status, statusMatrix } from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport { useEffect } from \"react\";\nimport * as path from \"path\";\n\nconst temporaryVcsMappingsDefault = ({\n  get,\n}: {\n  get: GetRecoilValue;\n}): VcsDirectoryMapping[] => [\n  {\n    dir: get(currentProjectState).path,\n    vcs: \"git\",\n  },\n];\n\n// This should be refactored to have the configuration file(s) as the source of truth.\nexport const vcsRootsState = atom<VcsDirectoryMapping[]>({\n  key: \"vcsRoots\",\n  default: selector({\n    key: \"vcsRoots/temporaryDefault\",\n    get: temporaryVcsMappingsDefault,\n  }),\n});\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const VcsRootForFile = selectorFamily<string | null, string>({\n  key: \"gitRootForFile\",\n  get: (filepath: string) => ({ get }) =>\n    get(vcsRootsState).find((root) => filepath.startsWith(root.dir))?.dir ??\n    null,\n});\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: Should it be an atom or selector?\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n */\nexport const fileStatusState = atomFamily<FileStatus, string>({\n  key: \"fileStatus\",\n  default: \"NOT_CHANGED\",\n});\n\nexport const useUpdateFileStatus = () =>\n  useRecoilCallback(\n    ({ snapshot, set }: CallbackInterface) => async (filepath: string) => {\n      const repoRoot = await snapshot.getPromise(VcsRootForFile(filepath));\n      if (repoRoot != null) {\n        console.time(`status ${filepath}`);\n        const fileStatus = await status({\n          fs,\n          dir: repoRoot,\n          filepath: path.relative(repoRoot, filepath),\n        });\n        console.timeEnd(`status ${filepath}`);\n        set(fileStatusState(filepath), convertGitStatus(fileStatus));\n      }\n    },\n    []\n  );\n\nexport const useUpdateVcsFileStatuses = () =>\n  useRecoilCallback(\n    ({ snapshot, transact_UNSTABLE }: CallbackInterface) => async () => {\n      const vcsDirectoryMappings = await snapshot.getPromise(vcsRootsState);\n      return Promise.all(\n        vcsDirectoryMappings\n          .filter(({ vcs }) => vcs === \"git\")\n          .map(async ({ dir }) => {\n            console.time(\"statusMatrix\");\n            const rows = await statusMatrix({ fs, dir });\n            console.timeEnd(\"statusMatrix\");\n            transact_UNSTABLE(({ set }) => {\n              rows.forEach((row) => {\n                set(fileStatusState(`${dir}/${row[0]}`), convertGitStatus(row));\n              });\n            });\n          })\n      );\n    },\n    []\n  );\n\nexport const useInitializeVcs = () => {\n  const updateVcsFileStatuses = useUpdateVcsFileStatuses();\n  useEffect(() => {\n    updateVcsFileStatuses().catch((e) => {\n      console.error(\"could not initialize VCS file statuses\", e);\n    });\n  }, []);\n};\n","import { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { useRecoilValue } from \"recoil\";\nimport { fileStatusState } from \"./file-status.state\";\nimport React from \"react\";\nimport { FileStatus } from \"./file-status\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const fileStatus = useRecoilValue(fileStatusState(filepath));\n  return useStatusColor(fileStatus);\n};\n\nexport const FileStatusColor: React.FC<{ filepath: string }> = ({\n  children,\n  filepath,\n}) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{ status: FileStatus }> = ({\n  children,\n  status,\n}) => {\n  const color = useStatusColor(status);\n  return <span style={{ color }}>{children}</span>;\n};\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport {\n  useRecoilValue,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { Editor } from \"./Editor\";\nimport {\n  activeEditorTabState,\n  editorCursorPositionState,\n  editorRefState,\n  useEditorStateManager,\n} from \"./editor.state\";\nimport { fileContent } from \"../fs/fs.state\";\nimport { useUpdateFileStatus } from \"../VersionControl/file-status.state\";\nimport * as path from \"path\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useAction } from \"@intellij-platform/core\";\n\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const editorStateManager = useEditorStateManager();\n  const activeTab = useRecoilValue(activeEditorTabState);\n  const editorRef = useRef<editor.IEditor>();\n  const [active, setActive] = useState(false);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetRecoilState(editorCursorPositionState);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items),\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOthersTabs,\n  });\n\n  const setEditorRef = useSetRecoilState(editorRefState);\n\n  const fileContentState = fileContent(activeTab?.filePath);\n  const contentLoadable = useRecoilValueLoadable(fileContentState);\n  const setContent = useSetRecoilState(fileContentState);\n  const updateFileStatus = useUpdateFileStatus();\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    updateFileStatus(activeTab.filePath).catch((e) => {\n      console.error(\"Could not update file status\", e);\n    });\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n  useEffect(() => {\n    editorRef.current?.focus();\n    if (activeTab?.editorState.cursorPos) {\n      editorRef.current?.setPosition(activeTab?.editorState.cursorPos);\n    }\n  }, [activeTab?.filePath]);\n\n  const content = contentLoadable.valueMaybe();\n\n  return (\n    <StyledFileEditorContainer\n      onFocus={() => {\n        setActive(true);\n        setEditorRef({\n          focus: () => editorRef.current?.focus(),\n        });\n      }}\n    >\n      {editorStateManager.tabs.length > 0 && (\n        <ContextMenuContainer\n          renderMenu={() => (\n            <Menu\n              onAction={() => {\n                // TODO: detect which tab was triggering context menu and handle the action accordingly\n                //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n                //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n                //  modified to pass the MouseEvent object, in renderMenu.\n                alert(\"not implemented!\");\n              }}\n            >\n              <Item key=\"close\">Close</Item>\n              <Item key=\"closeOthers\">Close Other tabs</Item>\n              <Item key=\"closeAll\">Close all tabs</Item>\n              <Item key=\"closeLeft\">Close tabs to the left</Item>\n              <Item key=\"closeRight\">Close tabs to the right</Item>\n            </Menu>\n          )}\n        >\n          <EditorTabs\n            items={editorStateManager.tabs}\n            active={active}\n            selectedKey={activeTab?.filePath}\n            onSelectionChange={(key) =>\n              editorStateManager.select(\n                editorStateManager.tabs.findIndex((tab) => tab.filePath === key)\n              )\n            }\n            noBorders\n          >\n            {(tab) => {\n              const filename = path.basename(tab.filePath);\n              const icon = <PlatformIcon icon={getIconForFile(tab.filePath)} />;\n              return (\n                <TabItem\n                  key={tab.filePath}\n                  textValue={filename}\n                  inOverflowMenu={\n                    <MenuItemLayout content={filename} icon={icon} />\n                  }\n                >\n                  <TooltipTrigger\n                    tooltip={<ActionTooltip actionName={tab.filePath} />}\n                  >\n                    <EditorTabContent\n                      icon={icon}\n                      title={\n                        <FileStatusColor filepath={tab.filePath}>\n                          {filename}\n                        </FileStatusColor>\n                      }\n                      closeButton={\n                        <TooltipTrigger\n                          tooltip={\n                            <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                          }\n                        >\n                          <TabCloseButton\n                            onPress={(e) => {\n                              if (e.altKey) {\n                                tabActionsRef.current.closeOthersTabs(\n                                  editorStateManager.tabs.indexOf(tab)\n                                );\n                              } else {\n                                tabActionsRef.current.closePath(tab.filePath);\n                              }\n                            }}\n                          />\n                        </TooltipTrigger>\n                      }\n                      containerProps={{\n                        onDoubleClick: () => {\n                          hideAllAction?.actionPerformed();\n                        },\n                      }}\n                    />\n                  </TooltipTrigger>\n                </TabItem>\n              );\n            }}\n          </EditorTabs>\n        </ContextMenuContainer>\n      )}\n      {activeTab &&\n        (typeof content === \"string\" ? (\n          <Editor\n            height=\"100%\"\n            path={activeTab.filePath}\n            onMount={(monacoEditor, monaco) => {\n              monacoEditor.focus();\n              enableJsx(monaco);\n              editorRef.current = monacoEditor;\n              monacoEditor.onDidChangeCursorPosition((e) => {\n                setCursorPositionState(e.position);\n              });\n              monacoEditor.onDidChangeModel(() => {\n                const position = editorRef.current?.getPosition();\n                if (position) {\n                  setCursorPositionState(position);\n                }\n              });\n            }}\n            onChange={updateContent}\n            value={content}\n          />\n        ) : (\n          content && \"UNSUPPORTED CONTENT\"\n        ))}\n      {contentLoadable.state === \"loading\" && <FileEditorLoading />}\n    </StyledFileEditorContainer>\n  );\n};\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { atom, CallbackInterface, selector, useRecoilCallback } from \"recoil\";\nimport { checkout, resetIndex, statusMatrix, StatusRow } from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport {\n  useUpdateFileStatus,\n  VcsRootForFile,\n  vcsRootsState,\n} from \"../file-status.state\";\nimport { useEffect } from \"react\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { reloadFileFromDiskCallback } from \"../../fs/fs.state\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n};\n\nexport interface Change {\n  before: Revision;\n  after: Revision;\n}\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: Change[];\n}\n\nexport const changeListsState = atom<ChangeListObj[]>({\n  key: \"changelists.lists\",\n  default: [\n    {\n      id: \"some-UUID\",\n      name: \"Changes\",\n      comment: \"last modified commit message\",\n      changes: [],\n      active: true,\n    },\n    {\n      id: \"some-other-UUID\",\n      name: \"Some other changelist\",\n      comment: \"Some empty changelist for testing\",\n      changes: [],\n      active: false,\n    },\n  ],\n});\n\nexport const activeChangeListState = selector<ChangeListObj | null>({\n  key: \"changelists.lists/default\",\n  get: ({ get }) =>\n    get(changeListsState).find((changeList) => changeList.active) ?? null,\n});\n\nexport const allChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changelists.allChanges\",\n  get: ({ get }) =>\n    get(changeListsState)\n      .map((changeLists) => changeLists.changes)\n      .flat(),\n});\n\nconst isAChange = ([, head, workingDir, stage]: StatusRow): boolean =>\n  head !== 1 || workingDir !== 1 || stage !== 1;\n\nconst refreshChanges = ({ snapshot, set }: CallbackInterface) => async () => {\n  const gitRoots = (await snapshot.getPromise(vcsRootsState)).filter(\n    (root) => root.vcs === \"git\"\n  );\n  const allStatusMatrices = await Promise.all(\n    gitRoots.map(async ({ dir }) => {\n      const rows = await statusMatrix({ fs, dir });\n      return rows\n        .filter(isAChange)\n        .map(\n          ([pathname, ...theRest]) =>\n            [path.join(dir, pathname), ...theRest] as StatusRow\n        );\n    })\n  );\n  const unversionedPaths = []; // FIXME: handle unversioned files\n  const changes = allStatusMatrices\n    .flat()\n    .map(([path, head, workdir, stage]) => ({\n      // FIXME: change object creation doesn't cover all kind of changes.\n      after: { path, isDir: false },\n      before: { path, isDir: false },\n    }));\n\n  // FIXME: changes now all go to default change list on each refresh. fix it.\n  set(changeListsState, (changeLists) =>\n    changeLists.map((changeList) => {\n      if (changeList.active) {\n        console.log(changes);\n        return {\n          ...changeList,\n          changes,\n        };\n      }\n      return {\n        ...changeList,\n        changes: [],\n      };\n    })\n  );\n};\n\nexport interface ChangeListManager {\n  addChangeList(name: string, comment: string): void;\n  removeChangeList(id: string): void;\n  editChangeList(\n    id: string,\n    edits: { name?: string; comment?: string; active?: boolean }\n  ): void;\n  setActiveChangeList(id: string): void;\n  mergeChangeLists(sourceId: string, targetId: string): void;\n  moveChange(change: Change, toChangeListId: string): void;\n  refresh(): Promise<void>;\n  rollback(changes: readonly Change[]): Promise<void>;\n}\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  const updateFileStatus = useUpdateFileStatus();\n  return useRecoilCallback(\n    (callbackInterface) => async (changes: readonly Change[]) => {\n      const { snapshot, set } = callbackInterface;\n      const reloadFileFromDisk = reloadFileFromDiskCallback(callbackInterface);\n\n      const changesWithRepoRoots = await Promise.all(\n        changes\n          .filter((change) => !change.after.isDir)\n          .map(async (change) => {\n            const repoRoot = (await snapshot.getPromise(\n              VcsRootForFile(change.after.path)\n            ))!; // FIXME: handle null\n            return {\n              repoRoot,\n              fullPath: change.after.path,\n              relativePath: path.relative(repoRoot, change.after.path),\n            };\n          })\n      );\n      const groupedChanges = groupBy(\n        ({ repoRoot }) => repoRoot,\n        changesWithRepoRoots\n      );\n      await Promise.all(\n        Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n          await checkout({\n            fs,\n            dir: repoRoot,\n            force: true,\n            filepaths: items.map(({ relativePath }) => relativePath),\n          });\n          await Promise.all(\n            items.map(async ({ fullPath, relativePath }) => {\n              await resetIndex({ fs, dir: repoRoot, filepath: relativePath });\n              await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n              return updateFileStatus(fullPath);\n            })\n          );\n        })\n      );\n\n      // Remove all changes from changelists. It's much more efficient than refresh.\n      set(changeListsState, (changeLists) =>\n        changeLists.map((changeList) => {\n          return {\n            ...changeList,\n            changes: changeList.changes.filter(\n              (change) => !changes.includes(change)\n            ),\n          };\n        })\n      );\n    },\n    []\n  );\n};\n\n/**\n * Exposes actions related to managing change lists, such as CRUD on change lists or refreshing the list of changes, etc.\n * NOTE: ChangeListManager is not used to get the list of changes or change lists, etc. that is to prevent unnecessary\n * re-renders when a component only needs to perform actions related to change lists, without caring about the state\n * of change lists. to get the list of change lists or active change list or list of all changes, there are several\n * other recoil values that can be used simply by `useRecoilValue` hook. of course setting those recoil values\n * is not expected to be done directly via recoil API, and can be prevented by not exposing the atoms/selectors\n * directly, and exposing small hooks that would simply call useRecoilValue.\n */\nexport const useChangeListManager = (): ChangeListManager => {\n  const refresh = useRecoilCallback(refreshChanges, []);\n  const rollback = useRollbackChanges();\n\n  const addChangeList = (name: string, comment: string) => {\n    throw new Error(\"Not implemented\");\n  };\n  const editChangeList = (\n    id: string,\n    edits: { name?: string; comment?: string; active?: boolean }\n  ) => {\n    throw new Error(\"Not implemented\");\n  };\n  const mergeChangeLists = (sourceId: string, targetId: string) => {\n    throw new Error(\"Not implemented\");\n  };\n  const moveChange = (change: Change, toChangeListId: string) => {\n    throw new Error(\"Not implemented\");\n  };\n  const removeChangeList = (id: string) => {\n    throw new Error(\"Not implemented\");\n  };\n  const setActiveChangeList = (id: string) => {\n    throw new Error(\"Not implemented\");\n  };\n  return {\n    addChangeList,\n    editChangeList,\n    mergeChangeLists,\n    moveChange,\n    removeChangeList,\n    setActiveChangeList,\n    refresh,\n    rollback,\n  };\n};\n\n// temporary, perhaps\nexport const useInitializeChanges = () => {\n  const { refresh } = useChangeListManager();\n  useEffect(() => {\n    refresh().catch((e) => console.error(\"could not initialize changes\", e));\n  }, [refresh]);\n};\n","import { constSelector, GetRecoilValue, selector } from \"recoil\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { uniq } from \"ramda\";\nimport {\n  ChangeGrouping,\n  ChangeNode,\n  DirectoryNode,\n  directoryNode,\n  isDirectoryNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./ChangesView.state\";\nimport { getParentPaths } from \"../../../file-utils\";\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: selector({\n    key: \"repositoryGrouping/isAvailable\",\n    get: ({ get }) => get(vcsRootsState).length > 0,\n  }),\n  groupFn: selector({\n    key: \"repositoryGrouping/groupFn\",\n    get: ({ get }: { get: GetRecoilValue }) => (\n      nodes: ReadonlyArray<ChangeNode>\n    ) => {\n      const repos = get(vcsRootsState);\n      return repos.map(\n        (repository): RepositoryNode => {\n          return repositoryNode(\n            repository,\n            nodes.filter((node) =>\n              (node.change.after?.path || node.change.before?.path).startsWith(\n                repository.dir\n              )\n            )\n          );\n        }\n      );\n    },\n  }),\n};\n\nconst directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: constSelector(true),\n  groupFn: (nodes: ReadonlyArray<ChangeNode>) => {\n    const pathToNodeCache: Record<string, DirectoryNode> = {};\n    const rootDirNodes = nodes.map((node) => {\n      if (node.change.after.isDir) {\n        throw new Error(\"isDir=true is not supported for changes ATM!\");\n      }\n      const filepath = node.change.after.path;\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(filepath).reduce(\n        (prevNode: DirectoryNode | ChangeNode, dirPath) => {\n          if (!pathToNodeCache[dirPath]) {\n            pathToNodeCache[dirPath] = directoryNode(dirPath, \"\");\n          }\n          if (prevNode.type === \"directory\") {\n            prevNode.parentNodePath = dirPath;\n          }\n          const dirNode = pathToNodeCache[dirPath];\n          dirNode.children = dirNode.children.includes(prevNode)\n            ? dirNode.children\n            : [prevNode, ...dirNode.children];\n          return dirNode;\n        },\n        node\n      ) as DirectoryNode; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const collapseDirectories = (dirNode: DirectoryNode): DirectoryNode => {\n      let { children, dirPath } = dirNode;\n      if (\n        dirNode.children.length === 1 &&\n        isDirectoryNode(dirNode.children[0])\n      ) {\n        children = dirNode.children[0].children;\n        dirPath = dirNode.children[0].dirPath;\n      }\n      return {\n        ...dirNode,\n        dirPath,\n        children: children.map((child) =>\n          isDirectoryNode(child) ? collapseDirectories(child) : child\n        ),\n      };\n    };\n    return uniq(rootDirNodes).map(collapseDirectories);\n  },\n};\n\nexport const groupings = [repositoryGrouping, directoryGrouping];\n","import { Key } from \"react\";\n\ntype TreeFn<T> = (root: T | null) => null | readonly T[];\n\nexport const getExpandAllKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key\n) => {\n  const roots = getChildren(null) || [];\n  const keys: Key[] = roots.map(getKey);\n  const processItem = (node: T | null) => {\n    const children = node ? getChildren(node) : null;\n    if (node == null || !children) {\n      return;\n    }\n    keys.push(getKey(node));\n    children.forEach(processItem);\n  };\n  roots.map(getChildren).flat().forEach(processItem);\n  return keys;\n};\n\nexport const dfsVisit = <T, R>(\n  getChildren: TreeFn<T>,\n  visit: (node: T, childrenValues: null | R[]) => R\n) => {\n  const nodes = getChildren(null) || [];\n  const dfs = (node: T): R => {\n    const children = getChildren(node);\n    const values = children?.map(dfs) ?? null;\n    return visit(node, values);\n  };\n  nodes.forEach(dfs);\n};\n","import { atom, selector } from \"recoil\";\nimport { Change } from \"../change-lists.state\";\nimport {\n  AnyNode,\n  changesTreeNodesState,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { Key } from \"react\";\nimport { dfsVisit, getExpandAllKeys } from \"../../../TreeUtils/tree-utils\";\nimport { Bounds, getDefaultBounds } from \"@intellij-platform/core/Window\";\n\nconst isOpen = atom<boolean>({\n  key: \"rollbackView.isOpen\",\n  default: false,\n});\nconst windowBounds = atom<Bounds>({\n  key: \"rollbackView.windowBounds\",\n  default: new Promise((resolve) => resolve(getDefaultBounds(500, 500))),\n});\nconst initiallyIncludedChanges = atom<ReadonlyArray<Change>>({\n  key: \"rollbackView.initiallySelectedChanges\",\n  default: [],\n});\nconst rootNodes = selector({\n  key: \"rollbackView.includedRootNodes\",\n  get: ({ get }) => {\n    const selectedChanges = get(initiallyIncludedChanges);\n    const { rootNodes } = get(changesTreeNodesState);\n    return rootNodes.filter(\n      ({ changeList: { changes, active } }) =>\n        (selectedChanges.length === 0 && active) ||\n        selectedChanges.some((change) => changes.includes(change))\n    );\n  },\n});\nconst initiallyExpandedKeys = selector({\n  key: \"rollbackView.initiallyExpandedKeys\",\n  get: ({ get }) => {\n    const includedChanges = get(initiallyIncludedChanges);\n    const nodes = get(rootNodes);\n    const expandedKeys: Key[] = [];\n    dfsVisit<AnyNode, boolean>(\n      (node) => (node ? (isGroupNode(node) ? node.children : null) : nodes),\n      (node, childValues) => {\n        const isExpanded: boolean =\n          childValues?.some((childValue) => childValue) ||\n          includedChanges.map(getNodeKeyForChange).includes(node.key);\n        if (isExpanded && isGroupNode(node)) {\n          expandedKeys.push(node.key);\n        }\n        return isExpanded;\n      }\n    );\n    return new Set(\n      expandedKeys.length\n        ? expandedKeys\n        : getExpandAllKeys<AnyNode>(\n            (node) =>\n              node == null ? nodes : isGroupNode(node) ? node.children : null,\n            (node) => node.key\n          )\n    );\n  },\n});\n\nexport const rollbackViewState = {\n  isOpen,\n  windowBounds,\n  initiallyExpandedKeys,\n  initiallyIncludedChanges,\n  rootNodes,\n};\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  isRecoilValue,\n  RecoilValue,\n  selector,\n} from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { Key } from \"react\";\nimport {\n  allChangesState,\n  Change,\n  ChangeListObj,\n  changeListsState,\n} from \"../change-lists.state\";\nimport { groupings } from \"./changesGroupings\";\nimport { VcsDirectoryMapping } from \"../../file-status\";\nimport { dfsVisit } from \"../../../TreeUtils/tree-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\n\nexport interface ChangeBrowserNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface GroupNode<T extends string> extends ChangeBrowserNode<T> {\n  children: ReadonlyArray<AnyNode>;\n}\n\nexport interface ChangeNode extends ChangeBrowserNode<\"change\"> {\n  change: Change;\n}\n\nexport interface ChangeListNode extends GroupNode<\"changelist\"> {\n  changeList: ChangeListObj;\n}\n\nexport interface DirectoryNode extends GroupNode<\"directory\"> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode extends GroupNode<\"repo\"> {\n  repository: VcsDirectoryMapping;\n}\n\nexport type AnyGroupNode = ChangeListNode | RepositoryNode | DirectoryNode;\nexport type AnyNode = AnyGroupNode | ChangeNode;\n\ntype MaybeRecoilValue<T> = T | RecoilValue<T>;\n\nexport type GroupFn<T extends AnyGroupNode> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<T extends AnyGroupNode, I = string> {\n  id: I;\n  title: string;\n  isAvailable: MaybeRecoilValue<boolean>;\n  groupFn: MaybeRecoilValue<GroupFn<T>>;\n}\n\nexport const currentBranchState = atomFamily<string, string>({\n  key: \"vcs/currentBranchName\",\n  default: \"master\",\n  // TODO: effect for syncing (when toolWindow state changes?)\n});\n\nexport const showIgnoredFilesState = atom({\n  key: \"changesView/showIgnoredFiles\",\n  default: false,\n});\n\nexport const showRelatedFilesState = atom({\n  key: \"changesView/showRelatedFiles\",\n  default: false,\n});\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = typeof groupings[number][\"id\"];\n\nexport const changesGroupingState = atomFamily<boolean, GroupingIds>({\n  key: \"changesView/grouping\",\n  default: true, // it's false in IntelliJ\n});\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysState = atom<Selection>({\n  key: \"changesView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\nexport const changesUnderSelectedKeys = selector<ReadonlyArray<Change>>({\n  key: \"changesView.selectedKeys.changes\",\n  get: ({ get }) => {\n    const selectedKeys = get(selectedKeysState);\n    const { byKey } = get(changesTreeNodesState);\n    if (selectedKeys === \"all\") {\n      return get(allChangesState);\n    }\n    const allChanges: Change[] = [];\n    const processNode = (node: AnyNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.push(node.change);\n      }\n      if (isGroupNode(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    [...selectedKeys].map((key) => byKey.get(key)).forEach(processNode);\n    return allChanges;\n  },\n});\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysState = atom<Set<string>>({\n  key: \"changesView.includedChangeKeys\",\n  default: new Set<string>([]),\n});\n\nexport const includedChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changesView.includedChanges\",\n  get: ({ get }) => {\n    const includedChangeKeys = get(includedChangeKeysState);\n    const allChanges = get(allChangesState);\n    return allChanges.filter((change) =>\n      includedChangeKeys.has(getNodeKeyForChange(change))\n    );\n  },\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelection = selector<\n  NestedSelectionState<AnyNode>\n>({\n  key: \"changesView.selectedChanges.nestedSelectionState\",\n  get: ({ get, getCallback }) => {\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedChangeKeys = get(includedChangeKeysState);\n    const setSelectedKeys = getCallback(\n      ({ set }) => (setValue: (currentValue: Set<string>) => Set<string>) =>\n        set(includedChangeKeysState, setValue)\n    );\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface(setSelectedKeys),\n      },\n      {\n        rootNodes,\n        getChildren: (item: AnyNode) =>\n          isGroupNode(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n});\n\nexport const expandedKeysState = atom<Selection>({\n  key: \"changesView.expandedKeys\",\n  default: selector({\n    key: \"changesView.expandedKeys/temporaryDefault\",\n    get: ({ get }) => {\n      return new Set<Key>(\n        get(changesTreeNodesState)\n          .rootNodes.map((node) => [\n            node.key,\n            ...node.children.map((child) => child.key),\n          ])\n          .flat()\n      );\n    },\n  }),\n});\n\nexport const availableGroupingsState = selector({\n  key: \"changes.availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        grouping,\n        isActive: get(changesGroupingState(grouping.id)),\n      })),\n});\n\nconst changeBrowserNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\n\nexport const getNodeKeyForChange = (change: Change) =>\n  changeBrowserNodeKey(\"change\", change.after.path);\n\nexport const changeNode = (change: Change): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n});\n\nexport const changeListNode = (\n  changeList: ChangeListObj,\n  groupFn: GroupFn<any> = (i) => i\n): ChangeListNode => ({\n  type: \"changelist\",\n  key: changeBrowserNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: groupFn(changeList.changes.map((change) => changeNode(change))),\n});\n\nexport const directoryNode = (\n  dirPath: string,\n  parentNodePath: string,\n  children: AnyNode[] = []\n): DirectoryNode => ({\n  type: \"directory\",\n  key: changeBrowserNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\n\nexport const repositoryNode = (\n  repository: VcsDirectoryMapping,\n  children: AnyNode[] = []\n): RepositoryNode => ({\n  type: \"repo\",\n  key: changeBrowserNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\n\nexport const isGroupNode = (\n  node: ChangeBrowserNode<any>\n): node is GroupNode<any> => \"children\" in node;\n\nconst isChangeNode = (node: ChangeBrowserNode<any>): node is ChangeNode =>\n  node.type === \"change\";\n\nexport const isDirectoryNode = (node: AnyNode): node is DirectoryNode =>\n  node.type === \"directory\";\n\nconst recursiveGrouping = (\n  groupingFns: Array<GroupFn<AnyGroupNode>>,\n  nodes: ReadonlyArray<ChangeBrowserNode<any>>\n): ReadonlyArray<AnyGroupNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes as ReadonlyArray<AnyGroupNode>; // can we avoid explicit cast?\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n  const changeNodes = nodes.filter(isChangeNode);\n  const groupNodes = nodes.filter(isGroupNode);\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups;\n};\n\nconst getChildren = (node: AnyNode) =>\n  isGroupNode(node) ? node.children : null;\n\nexport const changesTreeNodesState = selector<{\n  rootNodes: ChangeListNode[];\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, AnyNode>;\n}>({\n  key: \"changesView.treeNodes\",\n  get: ({ get }) => {\n    const resolve = <T>(value: MaybeRecoilValue<T>): T =>\n      isRecoilValue(value) ? get(value) : value;\n    const changeLists = get(changeListsState);\n    const groupFns = get(availableGroupingsState)\n      .filter(({ isActive }) => isActive)\n      .map(({ grouping }) => {\n        return resolve(grouping.groupFn);\n      });\n\n    const groupChanges = (changes: readonly ChangeNode[]) =>\n      recursiveGrouping(groupFns, changes);\n\n    const rootNodes = changeLists.map((changeList) =>\n      changeListNode(changeList, groupChanges)\n    );\n    const fileCountsMap = new Map();\n    const byKey = new Map();\n    const getFileCount = (node: GroupNode<any>): number => {\n      return node.children.reduce(\n        (totalSum, child) =>\n          totalSum + (isGroupNode(child) ? getFileCount(child) : 1),\n        0\n      );\n    };\n    dfsVisit<AnyNode, number>(\n      (root) => (root === null ? rootNodes : getChildren(root)),\n      (node, childrenFileCount) => {\n        byKey.set(node.key, node);\n        if (!childrenFileCount) {\n          return 1;\n        }\n        const fileCount = childrenFileCount.reduce(\n          (total, count) => total + count,\n          0\n        );\n        fileCountsMap.set(node.key, fileCount);\n        return fileCount;\n      }\n    );\n    return { rootNodes, fileCountsMap, byKey };\n  },\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily<\n  number,\n  \"horizontal\" | \"vertical\"\n>({\n  key: \"changesView/splitter/commitMessageSize\",\n  default: (orientation) => (orientation === \"horizontal\" ? 0.4 : 0.3),\n});\n/**\n * Whether --amend should be used for commit.\n */\nexport const amendCommitState = atom({\n  key: \"changesView/amendCommit\",\n  default: false,\n  // TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n  // it should add a record to the commit message history and switch the message. When toggled to false,\n  // last entry in history should be back again. There is currently no history :D\n});\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageState = atom({\n  key: \"changesView/commitMessage\",\n  default: \"\",\n});\n\nexport const openRollbackWindowForSelectionCallback = ({\n  set,\n  snapshot,\n}: CallbackInterface) => () => {\n  const changesUnderSelection = snapshot\n    .getLoadable(changesUnderSelectedKeys)\n    .getValue();\n  set(rollbackViewState.initiallyIncludedChanges, changesUnderSelection);\n  set(rollbackViewState.isOpen, true);\n};\n","import { useRecoilCallback, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport {\n  changesUnderSelectedKeys,\n  getNodeKeyForChange,\n  includedChangeKeysState,\n  openRollbackWindowForSelectionCallback,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { useChangeViewContext } from \"./ChangesViewSplitter\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n  const setIncludedChangeKeys = useSetRecoilState(includedChangeKeysState);\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  const disabledKeys = [\"moveToChangelist\"];\n  const { focusCommitMessage } = useChangeViewContext();\n  const editorStateManager = useEditorStateManager();\n  const openRollbackWindowForSelection = useRecoilCallback(\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  if (selectedChanges.length === 0) {\n    disabledKeys.push(\"commit\");\n  }\n\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={(key) => {\n        switch (key) {\n          case \"commit\":\n            setIncludedChangeKeys(\n              new Set(selectedChanges.map(getNodeKeyForChange))\n            );\n            focusCommitMessage();\n            break;\n          case \"rollback\":\n            openRollbackWindowForSelection();\n            break;\n          case \"jumpToSource\":\n            selectedChanges.forEach((change, index, arr) => {\n              if (!change.after.isDir) {\n                editorStateManager.openPath(\n                  change.after.path,\n                  index === arr.length - 1\n                );\n              }\n            });\n            break;\n        }\n      }}\n    >\n      <Item key=\"commit\" textValue=\"Commit\">\n        Commit file{selectedChanges.length > 1 ? \"s\" : \"\"}...\n      </Item>\n      <Item key=\"rollback\" textValue=\"Rollback\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/rollback.svg\"} />}\n          content=\"Rollback...\"\n        />\n      </Item>\n      <Item key=\"moveToChangelist\">Move to another Changelist...</Item>\n      <Item key=\"jumpToSource\" textValue=\"Jump to source\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/editSource.svg\"} />}\n          content=\"Jump to source\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.1rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useRecoilValue(vcsRootsState).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = ({ rootPath }: { rootPath: string }) => (\n  <StyledRepoColorSquare\n    style={{ backgroundColor: useRepoRootColor(rootPath) }}\n  />\n);\n","import React from \"react\";\nimport {\n  Color,\n  SelectionAwareSpan,\n  styled,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled(SelectionAwareSpan)`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    new Color(\n      theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )\n    )\n      .withTransparency(\n        theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08\n      )\n      .toString()};\n  color: ${({ theme }) =>\n    theme.color(\n      \"VersionControl.RefLabel.foreground\" as UnknownThemeProp<\"VersionControl.RefLabel.foreground\">,\n      theme.dark ? \"#909090\" : \"#7a7a7a\"\n    )};\n`;\n","import React from \"react\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { currentBranchState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { useRecoilValue } from \"recoil\";\n\nexport const CurrentBranchName = ({ repo }: { repo?: VcsDirectoryMapping }) => {\n  const branch = useRecoilValue(currentBranchState(repo?.dir ?? \"\"));\n  return <>{branch}</>;\n};\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport {\n  AnyNode,\n  ChangeBrowserNode,\n  ChangeListNode,\n  ChangeNode,\n  changesGroupingState,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./ChangesView.state\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport path from \"path\";\nimport {\n  HighlightedTextValue,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { RepoColorIcon } from \"./StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"./StyledCurrentBranchTag\";\nimport { CurrentBranchName } from \"../../CurrentBranchName\";\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { useRecoilValue } from \"recoil\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\ntype NodeRenderer<T extends ChangeBrowserNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\nconst repoNodeItemProps: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{fileCountMsg.format({ fileCount })}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <CurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeItemProps: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.relative(node.parentNodePath, node.dirPath),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{fileCountMsg.format({ fileCount })}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst changeListNodeItemProps: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {fileCountMsg.format({ fileCount })}{\" \"}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  const isGroupedByDirectory = useRecoilValue(\n    changesGroupingState(\"directory\")\n  );\n  return (\n    <ItemLayout.Hint>\n      {!isGroupedByDirectory && path.dirname(node.change.after.path)}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeItemProps: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(node.change.after.path),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(node.change.after.path)} />\n      <HighlightedTextValue />\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\nconst nodeRenderers: {\n  [type in AnyNode[\"type\"]]: NodeRenderer<AnyNode & { type: type }>;\n} = {\n  repo: repoNodeItemProps,\n  directory: directoryNodeItemProps,\n  changelist: changeListNodeItemProps,\n  change: changeNodeItemProps,\n};\n\nexport const getChangeListTreeItemProps = ({\n  node,\n  fileCountsMap,\n}: {\n  node: AnyNode;\n  fileCountsMap: Map<Key, number>;\n}): ItemProps<AnyNode> & { key: Key } => {\n  // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n  // to node types\n  const nodeRenderer: NodeRenderer<any> /* FIXME: why is any needed? */ =\n    nodeRenderers[node.type];\n  const { textValue, rendered } = nodeRenderer(node, {\n    fileCount: fileCountsMap.get(node.key) || 0,\n    dirCount: 0, // It seems it's only used for ignored files subtree\n  });\n  return {\n    key: node.key,\n    childItems: isGroupNode(node) ? node.children : [],\n    hasChildItems: isGroupNode(node) && node.children?.length > 0,\n    textValue,\n    children: rendered,\n  };\n};\n","import React, { RefObject } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesState,\n  expandedKeysState,\n  includedChangesNestedSelection,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { getChangeListTreeItemProps } from \"./changesTreeNodeRenderers\";\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const nestedSelection = useRecoilValue(includedChangesNestedSelection);\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        ref={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n      >\n        {(node) => {\n          const props = getChangeListTreeItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionButtonWithMenu,\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  return (\n    <ActionButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          onAction={(key) => {\n            alert(\"Not implemented\");\n          }}\n        >\n          <Item key=\"new\">\n            <MenuItemLayout\n              content=\"New Changelist...\"\n              icon={<PlatformIcon icon=\"general/add.svg\" />}\n            />\n          </Item>\n          <Item key=\"edit\">\n            <MenuItemLayout\n              content=\"Edit Changelist...\"\n              icon={<PlatformIcon icon=\"actions/edit.svg\" />}\n            />\n          </Item>\n          <Item key=\"delete\">\n            <MenuItemLayout\n              content=\"Delete Changelist\"\n              icon={<PlatformIcon icon=\"general/remove.svg\" />}\n            />\n          </Item>\n          <Item key=\"moveToAnotherChangelist\">\n            <MenuItemLayout content=\"Move Files to Another Changelist...\" />\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </ActionButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport {\n  availableGroupingsState,\n  changesGroupingState,\n  GroupingIds,\n} from \"../ChangesView.state\";\nimport {\n  ActionButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n} from \"@intellij-platform/core\";\n\nexport const GroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  const toggleGroup = useRecoilCallback(\n    ({ set }) => (id: GroupingIds) => {\n      set(changesGroupingState(id), (value) => !value);\n    },\n    []\n  );\n\n  return (\n    <ActionButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={availableGroupings\n            .filter(({ isActive }) => isActive)\n            .map(({ grouping }) => grouping.id)}\n          onAction={(key) => {\n            const id = availableGroupings.find(\n              ({ grouping }) => grouping.id === key\n            )?.grouping.id;\n            if (id) {\n              toggleGroup(id);\n            }\n          }}\n        >\n          <Section title=\"Group By\">\n            {availableGroupings.map(({ grouping }) => (\n              <Item key={grouping.id}>{grouping.title}</Item>\n            ))}\n          </Section>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/groupBy.svg\" />\n    </ActionButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport {\n  showIgnoredFilesState,\n  showRelatedFilesState,\n} from \"../ChangesView.state\";\nimport {\n  ActionButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useRecoilState(\n    showRelatedFilesState\n  );\n  const [showIgnoredFiles, setShowIgnoredFiles] = useRecoilState(\n    showIgnoredFilesState\n  );\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <ActionButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </ActionButtonWithMenu>\n  );\n};\n","import { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback } from \"recoil\";\nimport { openRollbackWindowForSelectionCallback } from \"./ChangesView/ChangesView.state\";\nimport { useChangeListManager } from \"./change-lists.state\";\n\nexport const ChangesViewActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n};\n\nexport const useChangesViewActions = (): Record<string, ActionDefinition> => {\n  const openRollbackWindow = useRecoilCallback(\n    // FIXME: selection should be used to pre-include changes based on \"active path\" context, which can come from editor\n    //  projects pane, changes view, etc.\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  const { refresh } = useChangeListManager();\n\n  return {\n    [ChangesViewActionIds.ROLLBACK]: {\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: openRollbackWindow,\n    },\n    [ChangesViewActionIds.REFRESH]: {\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    [ChangesViewActionIds.SHOW_DIFF]: {\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: () => alert(\"Not implemented\"),\n    },\n    [ChangesViewActionIds.SHELVE_SILENTLY]: {\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: () => alert(\"Not implemented\"),\n    },\n  };\n};\n","import {\n  ActionToolbar,\n  ActionToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { GroupByActionButton } from \"./ActionButtons/GroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\nimport React from \"react\";\nimport { Action } from \"@intellij-platform/core/ActionSystem/components\";\nimport { ChangesViewActionIds } from \"../useChangesViewActions\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <ActionToolbar hasBorder>\n      <Action.Button actionId={ChangesViewActionIds.REFRESH} />\n      <Action.Button actionId={ChangesViewActionIds.ROLLBACK} />\n      <Action.Button actionId={ChangesViewActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <Action.Button actionId={ChangesViewActionIds.SHELVE_SILENTLY} />\n      <ActionToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <GroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <Action.Button actionId={CommonActionId.EXPAND_ALL} />\n      <Action.Button actionId={CommonActionId.COLLAPSE_ALL} />\n    </ActionToolbar>\n  );\n}\n","import React from \"react\";\nimport { Change } from \"./change-lists.state\";\nimport { StatusColor } from \"../FileStatusColor\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<Change>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => change.after.path && change.before.path\n  ).length;\n  const addedCount = changes.filter(\n    (change) => change.after.path && !change.before.path\n  ).length;\n  const deletedCount = changes.filter(\n    (change) => change.before.path && !change.after.path\n  ).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionHelpTooltip,\n  ActionsProvider,\n  ActionTooltip,\n  Button,\n  Checkbox,\n  getAnchorOrientation,\n  PlatformIcon,\n  ThreeViewSplitter,\n  TooltipTrigger,\n  TreeRefValue,\n  useDefaultToolWindowContext,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  amendCommitState,\n  commitMessageSizeState,\n  commitMessageState,\n  includedChangesState,\n} from \"./ChangesView.state\";\nimport React, { useContext, useImperativeHandle, useRef } from \"react\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { ChangesSummary } from \"../ChangesSummary\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\n\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\n\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\n\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) => theme.color(\"Panel.background\")};\n  z-index: 1;\n`;\n\nconst ChangeViewContext = React.createContext({\n  focusCommitMessage: () => {},\n});\n\nexport const useChangeViewContext = () => useContext(ChangeViewContext);\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const [commitMessageSize, setCommitMessageSize] = useRecoilState(\n    commitMessageSizeState(orientation)\n  );\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  return (\n    <ChangeViewContext.Provider\n      value={{\n        focusCommitMessage: () => {\n          setTimeout(() => {\n            editorRef.current?.focus();\n          });\n        },\n      }}\n    >\n      <ThreeViewSplitter\n        orientation={orientation}\n        innerView={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <ChangesViewToolbar />\n                <StyledTreeViewWrapper>\n                  <ChangeViewTree treeRef={treeRef} />\n                </StyledTreeViewWrapper>\n                <CommitActionsRow />\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        innerViewMinSize={50}\n        lastView={<CommitMessageEditorAndButtons editorRef={editorRef} />}\n        lastSize={commitMessageSize}\n        onLastResize={setCommitMessageSize}\n      />\n    </ChangeViewContext.Provider>\n  );\n};\n\nconst ChangesViewChangesSummary = () => {\n  const changes = useRecoilValue(includedChangesState);\n  return <ChangesSummary changes={changes} />;\n};\n\nfunction CommitActionsRow() {\n  const [amend, setAmend] = useRecoilState(amendCommitState);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={setAmend}\n              preventFocus\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <ActionButton onPress={() => alert(\"Not implemented\")}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </ActionButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <ActionButton isDisabled onPress={() => alert(\"Not implemented\")}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </ActionButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n\nfunction CommitMessageEditorAndButtons({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useRecoilState(commitMessageState);\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={() => {}}\n        >\n          Commit\n        </Button>\n        <Button preventFocusOnPress onPress={() => alert(\"Not implemented\")}>\n          Commit and Push...\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React, { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { useChangeListManager } from \"../change-lists.state\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const { refresh } = useChangeListManager();\n  useEffect(() => {\n    refresh();\n  }, []);\n  // FIXME: Rollback window should be moved to upper levels. It should not be coupled with the changes view pane UI\n  return (\n    <StyledContainer>\n      <ChangesViewSplitter />\n    </StyledContainer>\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, CallbackInterface, GetRecoilValue, selector } from \"recoil\";\nimport { currentProjectState, Project } from \"../Project/project.state\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport * as path from \"path\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom({\n  key: \"projectView.foldersOnTop\",\n  default: true,\n});\n\nexport const expandedKeysState = atom({\n  key: \"projectView.expandedKeys\",\n  default: selector({\n    key: \"projectView.expandedKeys/default\",\n    get: ({ get }) => new Set<Key>([get(currentProjectState).path]),\n  }),\n});\n\nexport const selectedKeysState = atom<Selection>({\n  key: \"projectView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\nexport const projectViewTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"projectView.focusHandle\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const currentProjectTreeState = selector({\n  key: \"projectTree\",\n  get: ({ get }) => {\n    const project = get(currentProjectState);\n    return createProjectTree(project, get);\n  },\n});\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: GetRecoilValue\n): Promise<ProjectTreeRoot> {\n  const rootItems = await get(dirContentState(project.path));\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode> => {\n      const name = path.basename(item.path);\n      const node = {\n        ...item,\n        name,\n        parent,\n      };\n      const dirNode: FileTreeDirNode = { ...node, children: [] };\n      if (item.type === \"dir\") {\n        dirNode.children = await Promise.all(\n          ((await get(dirContentState(item.path))) ?? ([] as FsItem[])).map(\n            mapItem(dirNode)\n          )\n        );\n      }\n      return item.type === \"dir\" ? dirNode : node;\n    };\n\n  return {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children: await Promise.all(\n      (rootItems || []).filter(filterPath).map(mapItem(null))\n    ),\n  };\n}\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for expanding to a certain path in project view.\n * @param snapshot\n * @param set\n */\nexport const expandToPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (path: string) => {\n    const expandedKeys = snapshot.getLoadable(expandedKeysState).valueOrThrow();\n    const keysToExpand = [\n      snapshot.getLoadable(currentProjectState).valueOrThrow().path,\n    ].concat(getParentPaths(path));\n    set(expandedKeysState, new Set([...expandedKeys, ...keysToExpand]));\n  };\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n * // TODO: open project view tool window if needed, when tool window state is also moved to recoil instead of local\n * //  state.\n */\nexport const selectKeyAndFocusCallback =\n  ({ snapshot }: CallbackInterface) =>\n  (key: Key) => {\n    const treeRef = snapshot\n      .getLoadable(projectViewTreeRefState)\n      .valueOrThrow()?.current;\n    treeRef?.replaceSelection(key);\n    treeRef?.focus(key);\n  };\n","import {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport { currentProjectState } from \"../Project/project.state\";\nimport {\n  currentProjectTreeState,\n  expandedKeysState,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefState,\n  selectedKeysState,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useRecoilValue(currentProjectState);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetRecoilState(projectViewTreeRefState);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const projectTree = useRecoilValue(currentProjectTreeState);\n\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const foldersOnTop = useRecoilValue(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  return (\n    <DefaultSuspense>\n      <SpeedSearchTree\n        ref={treeRef}\n        items={[projectTree] as ProjectTreeNode[]}\n        onAction={(path) => {\n          editor.openPath(`${path}`);\n        }}\n        fillAvailableSpace\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n      >\n        {(item) => (\n          <Item\n            key={item.path}\n            textValue={item.name}\n            childItems={\n              \"children\" in item ? sortItems(item.children) : undefined\n            }\n          >\n            <ItemLayout>\n              {<ProjectViewNodeIcon node={item} />}\n              {item.type === \"project\" ? (\n                <>\n                  <b>\n                    <HighlightedTextValue />\n                  </b>\n                  <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                </>\n              ) : (\n                <FileTreeNodeText node={item} />\n              )}\n              {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n            </ItemLayout>\n          </Item>\n        )}\n      </SpeedSearchTree>\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { Action } from \"@intellij-platform/core/ActionSystem/components\";\n\nimport {\n  expandToPathCallback,\n  projectViewTreeRefState,\n  selectKeyAndFocusCallback,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useRecoilValue(projectViewTreeRefState);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={{ ...actions, ...projectViewActions }}\n      additionalActions={\n        <>\n          <Action.Button actionId={SELECT_IN_PROJECT_VIEW} />\n          <Action.Button actionId={CommonActionId.EXPAND_ALL} />\n          <Action.Button actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Record<string, ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useRecoilValue(activeEditorTabState);\n\n  const expandToOpenedFile = useRecoilCallback(expandToPathCallback, []);\n  const selectKeyAndFocus = useRecoilCallback(selectKeyAndFocusCallback, []);\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      expandToOpenedFile(activeTab.filePath);\n      selectKeyAndFocus(activeTab.filePath);\n    }\n  };\n\n  return {\n    [SELECT_IN_PROJECT_VIEW]: {\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n  };\n}\n","import React from \"react\";\nimport {\n  DefaultToolWindow,\n  MultiViewToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\nimport { Terminal } from \"../Terminal\";\nimport { ChangesViewPane } from \"../VersionControl/Changes/ChangesView/ChangesViewPane\";\nimport { CurrentBranchName } from \"../VersionControl/CurrentBranchName\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: \"Commit\",\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <MultiViewToolWindow>\n        <MultiViewToolWindow.View\n          tabContent={\n            <>\n              Commit to <CurrentBranchName />\n            </>\n          }\n          key=\"commit\"\n        >\n          <ChangesViewPane />\n        </MultiViewToolWindow.View>\n      </MultiViewToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"left\", isVisible: false }),\n  },\n];\n","import { atom } from \"recoil\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsState = atom({\n  key: \"toolWindows\",\n  default: new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    )\n  ),\n});\n","import { atom, useSetRecoilState } from \"recoil\";\nimport { BalloonActionLink, useBalloons } from \"@intellij-platform/core\";\nimport React, { useEffect } from \"react\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport path from \"path\";\n\nexport interface ProcessState {\n  state:\n    | \"STARTED\"\n    | \"PAUSED\"\n    | \"PAUSING\"\n    | \"CANCELED\"\n    | \"CANCELING\"\n    | \"FINISHED\";\n  /**\n   * between 1 and 100\n   */\n  progress: number;\n  isIndeterminate: boolean;\n  name: string;\n  details: string;\n  onCancel?: () => void;\n  onPause?: () => void;\n}\n\nexport const switchToPersistentFsProcess = atom<ProcessState | null>({\n  key: \"switchToPersistentFsProcess\",\n  default: null,\n});\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloons();\n  const setProcessState = useSetRecoilState(switchToPersistentFsProcess);\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body:\n            \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  const token = new CAF.cancelToken();\n                  setProcessState({\n                    details: \"Copying ...\",\n                    isIndeterminate: true,\n                    state: \"STARTED\",\n                    progress: 0,\n                    onCancel: () => {\n                      token.abort(\"canceled\");\n                    },\n                    name: \"Switching to IndexedDB FS\",\n                  });\n                  const update = (updates: Partial<ProcessState>) =>\n                    setProcessState((state) =>\n                      state ? { ...state, ...updates } : null\n                    );\n                  switchToPersistentFS({\n                    cancelSignal: token.signal,\n                    onCopy: (filepath) => {\n                      update({ name: `Copying ${path.dirname(filepath)}` });\n                    },\n                  })\n                    .then(() => {\n                      persistentFsPreference.set(\"yes\");\n                    })\n                    .catch((e) => {\n                      if (e !== \"canceled\") {\n                        console.error(\n                          \"Error during switch to persistent FS:\",\n                          e\n                        );\n                      }\n                    })\n                    .finally(() => {\n                      setProcessState(null);\n                    });\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  ProgressBar,\n  ProgressBarPauseButton,\n  ProgressBarStopButton,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { useRecoilValue } from \"recoil\";\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { currentBranchState } from \"../VersionControl/Changes/ChangesView/ChangesView.state\";\nimport { switchToPersistentFsProcess } from \"../usePersistenceFsNotification\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\n\nconst StatusBarProcess = () => {\n  const process = useRecoilValue(switchToPersistentFsProcess);\n\n  return (\n    process && (\n      <ProgressBar\n        name={process.name}\n        isIndeterminate={process.isIndeterminate}\n        value={process.progress}\n        dense\n        namePosition=\"side\"\n        width={146}\n        button={\n          <>\n            {process.onPause && (\n              <ProgressBarPauseButton\n                small\n                paused={false}\n                onPausedChange={() => {}}\n              />\n            )}\n            {process.onCancel && (\n              <ProgressBarStopButton small onPress={process.onCancel} />\n            )}\n          </>\n        }\n      />\n    )\n  );\n};\n\nexport const IdeStatusBar = () => {\n  const cursorPosition = useRecoilValue(editorCursorPositionState);\n  const currentBranch = useRecoilValue(currentBranchState(\"\" /*FIXME*/));\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={() => alert(\"Not implemented\")}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarProcess />}\n          <StatusBarWidget\n            onPress={() => alert(\"Not implemented\")}\n            label=\"LF\"\n          />\n          <StatusBarWidget\n            onPress={() => alert(\"Not implemented\")}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={() => {\n                  alert(\"Not implemented\");\n                }}\n              >\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={() => {\n                  alert(\"Not implemented\");\n                }}\n              >\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <StatusBarWidget\n            icon={<PlatformIcon icon=\"vcs/branch.svg\" />}\n            label={currentBranch}\n          />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={() => {\n        alert(\"Not implemented\");\n      }}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  ActionButton,\n  ActionButtonWithMenu,\n  ActionsProvider,\n  ActionToolbar,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloons,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport { Action } from \"@intellij-platform/core/ActionSystem/components\";\n\nimport {\n  AnyNode,\n  changesTreeNodesState,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { getChangeListTreeItemProps } from \"../ChangesView/changesTreeNodeRenderers\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { allChangesState, useChangeListManager } from \"../change-lists.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { groupings } from \"../ChangesView/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  line-height: 2;\n  padding-left: 0.5rem;\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useRecoilValue(\n    rollbackViewState.initiallyExpandedKeys\n  );\n  const initiallyIncludedChangeKeys = useRecoilValue(\n    rollbackViewState.initiallyIncludedChanges\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [windowBounds, setWindowBounds] = useRecoilState(\n    rollbackViewState.windowBounds\n  );\n  const rootNodes = useRecoilValue(rollbackViewState.rootNodes);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set<Key>());\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<AnyNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const changeListManager = useChangeListManager();\n  const balloons = useBalloons();\n  const setOpen = useSetRecoilState(rollbackViewState.isOpen);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n\n  return (\n    <ModalWindow\n      title=\"Rollback changes\"\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      footer={\n        <>\n          <div\n            style={{\n              padding: \"0 .75rem\",\n              display: \"flex\",\n              flexDirection: \"column\",\n            }}\n          >\n            <StyledLine>\n              <ChangesSummary changes={includedChanges} />\n            </StyledLine>\n            <Checkbox isDisabled>\n              Delete local copies of the added files\n            </Checkbox>\n          </div>\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  onPress={() => {\n                    changeListManager\n                      .rollback(includedChanges)\n                      .catch((e) => {\n                        balloons.show({\n                          title: \"Reverting changes failed\",\n                          icon: \"Error\",\n                          body: \"Could not revert selected changes. See console for more info\",\n                        });\n                        console.error(\"Git revert error:\", e);\n                      })\n                      .finally(close);\n                  }}\n                >\n                  Rollback\n                </Button>\n              </>\n            }\n          />\n        </>\n      }\n    >\n      <ActionsProvider actions={treeActions}>\n        {({ shortcutHandlerProps }) => (\n          <StyledContainer {...shortcutHandlerProps}>\n            <div style={{ display: \"flex\" }}>\n              <ActionToolbar>\n                <ActionButton isDisabled>\n                  <PlatformIcon icon=\"actions/diff\" />\n                </ActionButton>\n                <ActionButtonWithMenu\n                  renderMenu={({ menuProps }) => (\n                    <Menu\n                      {...menuProps}\n                      selectedKeys={[] /* FIXME */}\n                      onAction={(key) => {\n                        // FIXME\n                        alert(\"not implemented\");\n                      }}\n                    >\n                      <Section title=\"Group By\">\n                        {\n                          // FIXME\n                          groupings.map((grouping) => (\n                            <Item key={grouping.id}>{grouping.title}</Item>\n                          ))\n                        }\n                      </Section>\n                    </Menu>\n                  )}\n                >\n                  <PlatformIcon icon=\"actions/groupBy.svg\" />\n                </ActionButtonWithMenu>\n              </ActionToolbar>\n              <span style={{ flex: 1 }} />\n              <ActionToolbar>\n                <Action.Button actionId={CommonActionId.EXPAND_ALL} />\n                <Action.Button actionId={CommonActionId.COLLAPSE_ALL} />\n              </ActionToolbar>\n            </div>\n\n            <StyledFrame>\n              <ContextMenuContainer\n                renderMenu={() => <RollbackTreeContextMenu />}\n                style={{ height: \"100%\" }}\n              >\n                <SpeedSearchTreeWithCheckboxes\n                  ref={treeRef}\n                  items={rootNodes}\n                  selectionMode=\"multiple\"\n                  selectedKeys={selectedKeys}\n                  onSelectionChange={setSelectedKeys}\n                  expandedKeys={expandedKeys}\n                  onExpandedChange={setExpandedKeys}\n                  nestedSelection={nestedSelection}\n                  fillAvailableSpace\n                >\n                  {(node) => {\n                    const props = getChangeListTreeItemProps({\n                      node,\n                      fileCountsMap,\n                    });\n                    return (\n                      <Item {...props}>\n                        {node.children?.length !== 0 && (\n                          <TreeNodeCheckbox\n                            selectionState={nestedSelection.getSelectionState(\n                              node\n                            )}\n                            onToggle={() => nestedSelection.toggle(node)}\n                          />\n                        )}\n                        {props.children}\n                      </Item>\n                    );\n                  }}\n                </SpeedSearchTreeWithCheckboxes>\n              </ContextMenuContainer>\n            </StyledFrame>\n          </StyledContainer>\n        )}\n      </ActionsProvider>\n    </ModalWindow>\n  );\n}\n","import { ActionsProvider, DefaultToolWindows } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { useInitializeVcs } from \"../VersionControl/file-status.state\";\nimport { toolWindows } from \"./toolWindows\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { toolWindowsState } from \"./toolWindows.state\";\nimport { useInitializeChanges } from \"../VersionControl/Changes/change-lists.state\";\nimport styled from \"styled-components\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { useChangesViewActions } from \"../VersionControl/Changes/useChangesViewActions\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = () => {\n  const [state, setState] = useRecoilState(toolWindowsState);\n  const isRollbackWindowOpen = useRecoilValue(rollbackViewState.isOpen);\n\n  useInitializeVcs();\n  useInitializeChanges();\n  usePersistenceFsNotification();\n\n  const allActions = {\n    ...useChangesViewActions(),\n  };\n\n  return (\n    <StyledWindowFrame>\n      <ActionsProvider actions={allActions}>\n        {({ shortcutHandlerProps }) => (\n          <DefaultToolWindows\n            toolWindowsState={state}\n            onToolWindowStateChange={(newState) => {\n              setState(newState);\n            }}\n            windows={toolWindows}\n            containerProps={shortcutHandlerProps}\n          >\n            <FileEditor />\n          </DefaultToolWindows>\n        )}\n      </ActionsProvider>\n\n      <IdeStatusBar />\n      {isRollbackWindowOpen && <RollbackWindow />}\n    </StyledWindowFrame>\n  );\n};\n","import React, { useEffect, useState } from \"react\";\nimport { sampleRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { clone } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport styled from \"styled-components\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core\";\n\nconst StyledDialog = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${WINDOW_SHADOW};\n  text-align: center;\n  line-height: 1.5;\n`;\nconst StyledDialogHeader = styled.div`\n  background: ${({ theme }) => theme.color(\"Popup.Header.activeBackground\")};\n  padding: 4px;\n  text-align: center;\n`;\nconst StyledDialogContent = styled.div`\n  padding: 8px 16px;\n`;\n\nasync function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nexport const SampleRepoInitializer: React.FC = ({ children }) => {\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function init(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo(dir, repoUrl);\n      }\n    }\n\n    init(sampleRepo.path, sampleRepo.url)\n      .then(() => {\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      })\n      .catch((e) => {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      });\n  }, []);\n\n  if (state === \"uninitialized\") {\n    return null;\n  }\n  if (state === \"initialized\") {\n    return <>{children}</>;\n  }\n  return (\n    <div style={{ minHeight: \"100vh\", position: \"relative\" }}>\n      <StyledDialog>\n        <StyledDialogHeader>Cloning sample repo</StyledDialogHeader>\n        <StyledDialogContent>\n          {state === \"cloning\" ? (\n            <>\n              Cloning <b>{sampleRepo.url}</b>. <br />\n              It may take several seconds.\n            </>\n          ) : (\n            <>Something went wrong!</>\n          )}\n        </StyledDialogContent>\n      </StyledDialog>\n    </div>\n  );\n};\n\nasync function cloneRepo(dir: string, repoUrl: string) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url: repoUrl,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    singleBranch: true,\n  });\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { ChangesViewActionIds } from \"./VersionControl/Changes/useChangesViewActions\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [ChangesViewActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [ChangesViewActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [ChangesViewActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [ChangesViewActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n};\n","import React from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport { BalloonsProvider, KeymapProvider } from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { SampleRepoInitializer } from \"./SampleRepoInitializer\";\nimport { WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = () => {\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <SampleRepoInitializer>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <RecoilRoot>\n              <BalloonsProvider disablePortal>\n                {/* disablePortal to make example app more portable*/}\n                <Project />\n              </BalloonsProvider>\n            </RecoilRoot>\n          </KeymapProvider>\n        </SampleRepoInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n","import { PressProps, usePress } from \"@react-aria/interactions\";\nimport React, { ForwardedRef, HTMLProps } from \"react\";\nimport { styled } from \"../styled\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface ActionButtonProps\n  extends PressProps,\n    // Maybe we should allow any arbitrary HTMLProps<HTMLButtonElement> props, instead of whitelisting?\n    Pick<HTMLProps<HTMLElement>, \"onFocus\" | \"onBlur\"> {\n  children?: React.ReactNode;\n  minSize?: number;\n  /**\n   * Whether the button should be focusable by pressing tab. The default is true for action buttons, which means they\n   * are not included in the tab order.\n   */\n  excludeFromTabOrder?: boolean;\n}\n\nexport const DEFAULT_MINIMUM_BUTTON_SIZE = 22;\nexport const NAVBAR_MINIMUM_BUTTON_SIZE = 20;\n\nexport const StyledActionButton = styled.button<{ minSize: number }>`\n  position: relative; // to allow absolutely positioned overlays like an dropdown icon at the bottom right corner\n  background: none;\n  color: inherit;\n  border: 1px solid transparent;\n  border-radius: 3px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-height: ${({ minSize }) => `${minSize}px`};\n  min-width: ${({ minSize }) => `${minSize}px`};\n  padding: 0;\n  margin: 0;\n  &:disabled {\n    opacity: 0.25; // not quite accurate implementation. There might be better ways to style disabled state.\n  }\n  &:hover:not(:disabled),\n  &:focus:not(:disabled) /* in intellij platform, the button doesn't grab the focus after being active. This is not the case in web,\n  for better accessibility. But there is no existing UI spec for it in intellij platform obviously. So for now, we\n  fallback to the same UI as hover state. Perhaps it can be improved with a opacity or something.*/ {\n    outline: none;\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBackground\", \"#DFDFDF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBorderColor\", \"#DFDFDF\")};\n  }\n  &:active:not(:disabled),\n  &.active:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBorderColor\", \"#CFCFCF\")};\n  }\n`;\n\nexport const ActionButton = React.forwardRef(function ActionButton(\n  {\n    minSize = DEFAULT_MINIMUM_BUTTON_SIZE,\n    preventFocusOnPress = true,\n    excludeFromTabOrder = true,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    ...otherProps\n  }: ActionButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  // FIXME: use useButton\n\n  const ref = useObjectRef(forwardedRef);\n  const { focusableProps } = useFocusable({ isDisabled }, ref);\n  const { pressProps, isPressed } = usePress({\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    preventFocusOnPress,\n  });\n\n  return (\n    <StyledActionButton\n      className={isPressed ? \"active\" : \"\"}\n      disabled={isDisabled}\n      {...mergeProps(pressProps, otherProps, focusableProps)}\n      minSize={minSize}\n      tabIndex={excludeFromTabOrder && !isDisabled ? -1 : undefined}\n      ref={ref}\n    />\n  );\n});\n","import React, { useRef } from \"react\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionButtonProps,\n} from \"@intellij-platform/core/ActionButton\";\nimport { MenuTrigger, MenuTriggerProps } from \"@intellij-platform/core/Menu\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst ArrowIcon = styled(PlatformIcon)`\n  position: absolute;\n  right: 1px;\n  bottom: 1px;\n`;\n\ntype ActionButtonWithMenuProps = ActionButtonProps &\n  Pick<MenuTriggerProps, \"renderMenu\"> & {\n    /**\n     * whether the default arrow should be removed or not. false by default.\n     */\n    noArrow?: boolean;\n  };\n/**\n * Renders an ActionButton which opens a menu. by default a down arrow icon is shown as an overlay on the rendered\n * icon, but it can be disabled by passing `noArrow`. It also restores the focus to the previously focused element,\n * when the menu is closed.\n * @param renderMenu: render prop for rendering the menu\n * @param children: the content of the action button\n * @param noArrow: whether the default arrow should be removed or not. false by default.\n * @param buttonProps: the rest of the props that will be passed down to ActionButton\n *\n * TODO: Add story and write test for focus restoration, noArrow, and basic functionality.\n */\nexport const ActionButtonWithMenu = ({\n  renderMenu,\n  children,\n  noArrow = false,\n  ...buttonProps\n}: ActionButtonWithMenuProps) => {\n  const previouslyFocusedElementRef = useRef<HTMLElement>();\n  return (\n    <MenuTrigger\n      renderMenu={renderMenu}\n      onOpenChange={(open) => {\n        if (!open && previouslyFocusedElementRef.current) {\n          previouslyFocusedElementRef.current.focus();\n        }\n      }}\n    >\n      {(props, ref) => (\n        <ActionButton\n          {...mergeProps(buttonProps, props, {\n            onFocus: (e: FocusEvent) => {\n              if (e.relatedTarget && e.relatedTarget instanceof HTMLElement) {\n                previouslyFocusedElementRef.current = e.relatedTarget;\n              }\n            },\n          })}\n          ref={ref}\n        >\n          {children}\n          {!noArrow && <ArrowIcon icon=\"general/dropdown.svg\" />}\n        </ActionButton>\n      )}\n    </MenuTrigger>\n  );\n};\n","import React, { KeyboardEventHandler, useRef } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  isKeyboardShortcut,\n  KeyboardShortcut,\n  KeyStroke,\n  Shortcut,\n  supportedModifiers,\n} from \"./Shortcut\";\n\nexport function useShortcuts(\n  shortcuts: { [actionId: string]: ReadonlyArray<Shortcut> },\n  onAction: (\n    actionId: string,\n    args: { event: React.MouseEvent | React.KeyboardEvent }\n  ) => void | boolean\n) {\n  const firstKeyActivatedShortcutsRef = useRef<\n    Array<{ actionId: string; shortcut: KeyboardShortcut }>\n  >([]);\n  const secondStrokeResetTimerIdRef = useRef<number | null>(null);\n  const onKeyDown: KeyboardEventHandler = useEventCallback((e) => {\n    if (isModifierOnly(e.nativeEvent) || e.repeat) {\n      return;\n    }\n    // firstKeyActivatedShortcutsRef will be re-adjusted in any case. Cleaning whatever scheduled reset\n    if (secondStrokeResetTimerIdRef.current !== null) {\n      window.clearTimeout(secondStrokeResetTimerIdRef.current);\n    }\n\n    function triggerAction(actionId: string) {\n      const result = onAction(actionId, { event: e });\n      if (result !== false) {\n        // TODO: make sure about how propagation should be stopped and/or controlled\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }\n    // If there are keyboard shortcuts that are half way handled (first keystroke triggered already, and we are within\n    // the valid wait for the second keystroke), they should be prioritized over first keystroke matching.\n    if (firstKeyActivatedShortcutsRef.current.length > 0) {\n      firstKeyActivatedShortcutsRef.current.some(({ shortcut, actionId }) => {\n        if (isKeyMatch(shortcut.secondKeyStroke, e, true)) {\n          triggerAction(actionId);\n          return true;\n        }\n      });\n      firstKeyActivatedShortcutsRef.current = [];\n    } else {\n      const firstKeyMatches = Object.entries(shortcuts)\n        .flatMap(([actionId, shortcuts]) =>\n          shortcuts.map((shortcut) => ({ actionId, shortcut }))\n        )\n        .filter(\n          (\n            input\n          ): input is {\n            actionId: string;\n            shortcut: KeyboardShortcut;\n          } => isKeyboardShortcut(input.shortcut)\n        )\n        .filter(({ shortcut }) => isKeyMatch(shortcut.firstKeyStroke, e));\n\n      firstKeyActivatedShortcutsRef.current = firstKeyMatches.filter(\n        ({ shortcut, actionId }) => shortcut.secondKeyStroke\n      );\n\n      if (firstKeyActivatedShortcutsRef.current.length > 0) {\n        secondStrokeResetTimerIdRef.current = window.setTimeout(() => {\n          firstKeyActivatedShortcutsRef.current = [];\n        }, 2000);\n        document.addEventListener(\n          \"keydown\",\n          () => {\n            document.addEventListener(\n              \"keyup\",\n              () => {\n                firstKeyActivatedShortcutsRef.current = [];\n              },\n              { once: true }\n            );\n          },\n          //  by passing capture: true, we skip the current keydown event, since it's already passed capture phase\n          { once: true, capture: true }\n        );\n      } else if (firstKeyMatches.length > 0) {\n        triggerAction(firstKeyMatches[0].actionId);\n      }\n    }\n  });\n  const shortcutHandlerProps = {\n    onKeyDown,\n  };\n  return { shortcutHandlerProps };\n}\n\nconst isKeyMatch = (\n  keyStroke: KeyStroke | undefined,\n  e: React.KeyboardEvent,\n  loose?: boolean\n) =>\n  e.code === keyStroke?.code &&\n  (loose ? keyStroke.modifiers || [] : supportedModifiers).every(\n    (modifier) =>\n      e.getModifierState(modifier) ===\n      Boolean(keyStroke.modifiers?.includes(modifier))\n  );\n\nfunction isModifierOnly(event: KeyboardEvent) {\n  return event.location === 1 || event.location === 2;\n}\n","import { useKeymap } from \"@intellij-platform/core/ActionSystem/KeymapProvider\";\nimport { mapObjIndexed, pick } from \"ramda\";\nimport React, { HTMLAttributes, useContext } from \"react\";\nimport { shortcutToString } from \"@intellij-platform/core/ActionSystem/shortcutToString\";\nimport { useShortcuts } from \"@intellij-platform/core/ActionSystem/useShortcut\";\nimport { Shortcut } from \"@intellij-platform/core/ActionSystem/Shortcut\";\n\nexport interface ActionDefinition {\n  title: string;\n  actionPerformed: () => void;\n  icon?: React.ReactNode;\n  description?: string;\n  isDisabled?: boolean;\n}\nexport interface Action extends ActionDefinition {\n  id: string;\n  /**\n   * shortcuts assigned to this action based on the keymap context\n   */\n  shortcuts: readonly Shortcut[] | undefined;\n  /**\n   * string representation of the shortcuts\n   */\n  shortcut: string | undefined;\n}\n\ninterface ActionsProviderProps {\n  actions: {\n    [actionId: string]: ActionDefinition;\n  };\n  children: (args: {\n    shortcutHandlerProps: HTMLAttributes<HTMLElement>;\n  }) => React.ReactElement;\n}\n\nconst ActionsContext = React.createContext<{\n  [actionId: string]: Action;\n}>({});\n\nexport function ActionsProvider(props: ActionsProviderProps): JSX.Element {\n  const parentContext = useContext(ActionsContext);\n  const keymap = useKeymap();\n  const actionIds = Object.keys(props.actions);\n  const shortcuts = pick(actionIds, keymap || {});\n\n  const { shortcutHandlerProps } = useShortcuts(shortcuts, (actionId) => {\n    props.actions[actionId]?.actionPerformed();\n  });\n\n  const actions = mapObjIndexed((value, actionId): Action => {\n    const shortcuts = keymap?.[actionId];\n    const firstShortcut = shortcuts?.[0];\n    return {\n      id: actionId,\n      ...value,\n      shortcuts,\n      shortcut: firstShortcut ? shortcutToString(firstShortcut) : undefined, // Maybe it should be all shortcuts?\n    };\n  }, props.actions);\n  return (\n    <ActionsContext.Provider value={{ ...parentContext, ...actions }}>\n      {props.children({ shortcutHandlerProps })}\n    </ActionsContext.Provider>\n  );\n}\n\nexport function useActions(): Record<string, Action> {\n  return useContext(ActionsContext);\n}\n\nexport const useAction = (actionId: string): Action | null => {\n  return useActions()[actionId];\n};\n","export const CommonActionId = {\n  EXPAND_ALL: \"ExpandAll\",\n  COLLAPSE_ALL: \"CollapseAll\",\n  EXPAND_SELECTION: \"EditorSelectWord\",\n  SHRINK_SELECTION: \"EditorUnSelectWord\",\n};\n","import { Keymap } from \"@intellij-platform/core/ActionSystem/KeymapProvider\";\nimport {\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  // For some reason importing from shorter paths doesn't work as expected in cypress ¯\\_(ツ)_/¯\n  // Weirdly, `import *` works in that case.\n} from \"@intellij-platform/core/ToolWindowsImpl/ToolWindowActionIds\";\nimport { CommonActionId } from \"@intellij-platform/core/ActionSystem/CommonActionIds\";\n\n// TODO: OS specific defaults\n// TODO: extract and export action ids\n// NOTE: defaultKeymap doesn't belong to ActionSystem semantically. Would be something to be moved to a separate module\nexport const defaultKeymap: Keymap = {\n  [RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowRight\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_LEFT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowLeft\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_TOP_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowUp\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowDown\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [MAXIMIZE_TOOL_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Quote\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [FOCUS_EDITOR_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n      },\n    },\n  ],\n  [HIDE_ACTIVE_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n        modifiers: [\"Shift\"],\n      },\n    },\n  ],\n  [HIDE_ALL_WINDOWS_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [JUMP_TO_LAST_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowUp\",\n      },\n    },\n  ],\n  [CommonActionId.SHRINK_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n  ],\n  [CommonActionId.COLLAPSE_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n};\n","import React, { useContext } from \"react\";\nimport { Shortcut } from \"@intellij-platform/core/ActionSystem/Shortcut\";\nimport { defaultKeymap } from \"@intellij-platform/core/ActionSystem/defaultKeymap\";\n\nexport interface Keymap {\n  [actionId: string]: ReadonlyArray<Shortcut>;\n}\n\nexport const KeymapContext = React.createContext<Keymap | null>(defaultKeymap);\n\nexport const KeymapProvider: React.FC<{ keymap: Keymap }> = ({\n  keymap: keymapProp,\n  children,\n}) => {\n  const parentKeyMap = useContext(KeymapContext);\n  const keymap = Object.assign(Object.create(parentKeyMap), keymapProp);\n  return (\n    <KeymapContext.Provider value={keymap}>{children}</KeymapContext.Provider>\n  );\n};\n\nexport const useKeymap = () => useContext(KeymapContext);\n","type ShortcutType = \"mouse\" | \"keyboard\";\nexport type KeyStrokeModifier = \"Alt\" | \"Shift\" | \"Meta\" | \"Control\";\n\nexport interface KeyStroke {\n  /**\n   * {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key}\n   */\n  code: string;\n  modifiers?: Array<KeyStrokeModifier>;\n}\n\ninterface ShortcutBase {\n  type: ShortcutType;\n}\n\ninterface MouseShortcut extends ShortcutBase {\n  type: \"mouse\";\n}\n\nexport interface KeyboardShortcut extends ShortcutBase {\n  type: \"keyboard\";\n  firstKeyStroke: KeyStroke;\n  secondKeyStroke?: KeyStroke;\n}\n\nexport type Shortcut = MouseShortcut | KeyboardShortcut;\n\nexport const isKeyboardShortcut = (\n  shortcut: Shortcut\n): shortcut is KeyboardShortcut => shortcut.type === \"keyboard\";\n\nexport const supportedModifiers: KeyStrokeModifier[] = [\n  \"Alt\",\n  \"Meta\",\n  \"Shift\",\n  \"Control\",\n];\n","import React from \"react\";\nimport { flatten } from \"ramda\";\nimport { Menu, MenuItemLayout } from \"@intellij-platform/core/Menu\";\nimport {\n  Divider,\n  DividerItem,\n  Item,\n} from \"@intellij-platform/core/Collections\";\nimport { Action, ActionDefinition } from \"../ActionsProvider\";\n\ninterface ActionGroup\n  extends Pick<ActionDefinition, \"icon\" | \"title\" | \"isDisabled\"> {\n  id: string;\n  actions: Action[];\n}\nexport type ActionItem = ActionGroup | Action | DividerItem;\n\nfunction isAction(item: ActionItem): item is Action {\n  return \"actionPerformed\" in item;\n}\nfunction isGroup(item: ActionItem): item is ActionGroup {\n  return \"actions\" in item;\n}\nfunction isActionOrGroup(item: ActionItem): item is Action | ActionGroup {\n  return isAction(item) || isGroup(item);\n}\n\n/**\n * Given a nested list of resolved actions, renders a menu corresponding to them.\n */\nexport function ActionsMenu({\n  actions,\n  selectedKeys,\n  menuProps,\n}: {\n  actions: Array<ActionItem>;\n  selectedKeys: string[];\n  menuProps: React.HTMLAttributes<HTMLElement>;\n}) {\n  const allActions = getAllActionsRecursive(actions);\n  const disabledKeys = allActions\n    .filter(({ isDisabled }) => isDisabled)\n    .map(({ id }) => id);\n\n  return (\n    <Menu\n      {...menuProps}\n      onAction={(key) => {\n        const action = allActions.find(({ id }) => id === key);\n        if (action && isAction(action)) {\n          action.actionPerformed();\n        }\n      }}\n      selectedKeys={selectedKeys} // FIXME: keep isSelected on actions (toggle action)?\n      disabledKeys={disabledKeys}\n      items={actions}\n      autoFocus\n    >\n      {(action) => {\n        if (action instanceof DividerItem) {\n          return <Divider />;\n        }\n        return (\n          <Item\n            key={action.id}\n            textValue={action.title}\n            childItems={isGroup(action) ? action.actions : undefined}\n          >\n            <MenuItemLayout\n              content={action.title}\n              icon={action.icon}\n              shortcut={isAction(action) ? action.shortcut : undefined}\n            />\n          </Item>\n        );\n      }}\n    </Menu>\n  );\n}\n\nfunction getAllActionsRecursive(items: ActionItem[]): Action[] {\n  return flatten(\n    items\n      .filter(isActionOrGroup)\n      .map((item) => (isGroup(item) ? item.actions : item))\n  );\n}\n","import React from \"react\";\nimport { useAction } from \"@intellij-platform/core/ActionSystem\";\nimport { ActionButton as ActionButtonUI } from \"@intellij-platform/core/ActionButton\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport const ActionButton = ({\n  actionId,\n  children,\n}: {\n  actionId: string;\n  /**\n   * Content to show if `action.icon` is not set.\n   */\n  children?: React.ReactNode;\n}): JSX.Element => {\n  const action = useAction(actionId);\n  if (!action) {\n    return <></>;\n  }\n  const actionButton = (\n    <ActionButtonUI\n      onPress={action.actionPerformed}\n      isDisabled={action.isDisabled}\n    >\n      {action.icon || children}\n    </ActionButtonUI>\n  );\n  if (action.title) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={action.title} shortcut={action.shortcut} />\n        }\n      >\n        {actionButton}\n      </TooltipTrigger>\n    );\n  }\n  return actionButton;\n};\n","import { ActionButton } from \"./ActionButton\";\nimport { ActionsMenu } from \"./ActionsMenu\";\n\nexport const Action = {\n  Button: ActionButton,\n  Menu: ActionsMenu,\n};\n","import { fromPairs } from \"ramda\";\nimport { isMac } from \"@react-aria/utils\";\nimport {\n  isKeyboardShortcut,\n  KeyStroke,\n  KeyStrokeModifier,\n  Shortcut,\n} from \"./Shortcut\";\nimport {\n  KeyboardEventKey,\n  LinuxDeadKeys,\n  NumericKeypadKeys,\n  UpperAlpha,\n} from \"./KeyboardEventKey\";\n\nconst defaultKeyToStr: {\n  [key in Exclude<\n    KeyStrokeModifier | KeyboardEventKey,\n    LinuxDeadKeys | UpperAlpha | NumericKeypadKeys\n  >]: string;\n} = {\n  Control: \"Ctrl\",\n  \" \": \"Space\",\n  ArrowDown: \"↓\",\n  ArrowUp: \"↑\",\n  ArrowLeft: \"←\",\n  ArrowRight: \"→\",\n  Enter: \"⏎\",\n  Quote: \"'\",\n  Minus: \"-\",\n  Equal: \"+\",\n  // lowercase to uppercase map\n  ...fromPairs(\n    Array.from(Array(26))\n      .map((e, i) => i + \"a\".charCodeAt(0))\n      .map((x) => String.fromCharCode(x))\n      .map((a) => [a, a.toUpperCase()])\n  ),\n};\nconst KeystrokeToString: {\n  separator: string;\n  codeToStr: Record<KeyStrokeModifier | KeyboardEventKey, string>;\n} = isMac()\n  ? {\n      separator: \"\",\n      codeToStr: {\n        ...defaultKeyToStr,\n        Alt: \"⌥\",\n        Shift: \"⇧\",\n        Meta: \"⌘\",\n        Control: \"^\",\n        Escape: \"⎋\",\n      },\n    }\n  : {\n      separator: \"+\",\n      codeToStr: defaultKeyToStr,\n    };\nexport const keystrokeToString = (keystroke: KeyStroke) => {\n  return [...(keystroke.modifiers || []), keystroke.code]\n    .map((code) => KeystrokeToString.codeToStr[code] || code)\n    .map((code) => code.replace(/^(Key|Digit|Numpad)(.)$/, \"$2\"))\n    .join(KeystrokeToString.separator);\n};\nexport const shortcutToString = (shortcut: Shortcut) => {\n  if (isKeyboardShortcut(shortcut)) {\n    return [shortcut.firstKeyStroke, shortcut.secondKeyStroke]\n      .filter((i): i is KeyStroke => i != undefined)\n      .map(keystrokeToString)\n      .join(\", \");\n  }\n  throw new Error(\"Not implemented yet\");\n};\n","import { useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\nimport { Action, useActions } from \"./ActionsProvider\";\n\n// TODO: support multi-level grouping\nexport const useActionGroup = (actionIds: string[]): Action[] => {\n  const actionContext = useActions();\n  const keymap = useKeymap();\n  return actionIds\n    .filter((actionId) => actionContext[actionId])\n    .map((actionId) => {\n      const action = actionContext[actionId];\n      const shortcut = keymap?.[actionId]?.[0];\n      return {\n        ...action,\n        id: actionId,\n        shortcut: shortcut ? shortcutToString(shortcut) : undefined,\n      };\n    });\n};\n","import { Theme } from \"@intellij-platform/core/Theme\";\nimport React, { useContext } from \"react\";\nimport { StyledActionButton } from \"../ActionButton\";\nimport { styled } from \"../styled\";\nimport {\n  StyledHorizontalSeparator,\n  StyledVerticalSeparator,\n} from \"../StyledSeparator\";\n\ninterface ActionToolbarProps {\n  orientation?: \"vertical\" | \"horizontal\";\n  /**\n   * Whether to include a border to the bottom/right the toolbar, or not.\n   */\n  hasBorder?: boolean;\n}\nconst StyledActionToolbar = styled.div`\n  display: flex;\n`;\n\nconst getBorder = ({\n  theme,\n  hasBorder,\n}: {\n  theme: Theme;\n  hasBorder?: boolean;\n}) =>\n  hasBorder\n    ? `1px solid ${theme.color(\n        \"Borders.color\",\n        theme.dark ? \"rgb(50,50,50)\" : \"rgb(192, 192, 192)\"\n      )}`\n    : \"none\";\nconst StyledHorizontalActionToolbar = styled(StyledActionToolbar)<{\n  hasBorder?: boolean;\n}>`\n  padding: 2px;\n  border-bottom: ${getBorder};\n  ${StyledHorizontalSeparator} {\n    margin: 1px 2px;\n  }\n  // NOTE: in the original implementation, there is no empty space between buttons, but buttons have kind of an\n  // invisible left padding, which is mouse-intractable, but doesn't visually seem a part of the button.\n  // Although implementable, it didn't seem necessary to follow the exact same thing. Margin should be fine.\n  ${StyledActionButton} {\n    margin: 0 2px 0 2px;\n  }\n`;\n\nconst StyledVerticalActionToolbar = styled(StyledActionToolbar)<{\n  hasBorder?: boolean;\n}>`\n  flex-direction: column;\n  padding: 0 2px;\n  border-right: ${getBorder};\n\n  ${StyledVerticalSeparator} {\n    margin: 4px 1px;\n  }\n  ${StyledActionButton} {\n    margin: 2px 0 1px 0;\n  }\n`;\n\n// This can be used in other places if use-cases are raised for keeping orientation in the context.\nconst OrientationContext = React.createContext<\"horizontal\" | \"vertical\">(\n  \"horizontal\"\n);\n\n/**\n * Remaining features:\n * - overflow behaviour:\n *   - wrap. like main action toolbar.\n *   - hidden, shown by arrow. Similar to actions in Git->Log. Note that the behaviour for horizontal and vertical\n *     modes are different apparently.\n */\nexport const ActionToolbar: React.FC<ActionToolbarProps> = ({\n  orientation = \"horizontal\",\n  hasBorder = false,\n  children,\n}): React.ReactElement => {\n  return (\n    <OrientationContext.Provider value={orientation}>\n      {orientation === \"horizontal\" ? (\n        <StyledHorizontalActionToolbar hasBorder={hasBorder}>\n          {children}\n        </StyledHorizontalActionToolbar>\n      ) : (\n        <StyledVerticalActionToolbar hasBorder={hasBorder}>\n          {children}\n        </StyledVerticalActionToolbar>\n      )}\n    </OrientationContext.Provider>\n  );\n};\n\n/**\n * Separator to be used between action buttons in an action toolbar.\n */\nexport const ActionToolbarSeparator = (): React.ReactElement => {\n  const orientation = useContext(OrientationContext);\n  return orientation === \"horizontal\" ? (\n    <StyledHorizontalSeparator />\n  ) : (\n    <StyledVerticalSeparator />\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledHoverContainer } from \"@intellij-platform/core/Icon\";\n\nconst CORNER_RADIUS = 12; // it used to be 8. After introduction of Notifications tool window, it's 12\n\nconst bgColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\n    \"Notification.background\",\n    !theme.dark ? \"rgb(242,242,242)\" : \"#4E5052\"\n  );\n\nexport const StyledHeaderActions = styled.div`\n  position: absolute;\n  right: 0;\n  top: 0;\n  background: inherit;\n  padding: 0.375rem 0.5rem 0;\n  &::before {\n    content: \"\";\n    position: absolute;\n    right: 100%;\n    background: linear-gradient(90deg, transparent, ${bgColor});\n    width: 20px;\n    height: 100%;\n    z-index: 1;\n    top: 0;\n  }\n`;\n\nexport const StyledBalloonContainer = styled.div`\n  line-height: 1.2;\n  box-sizing: border-box;\n  overflow: hidden; // header actions overflows a little at the top right rounded corner\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); // shadow doesn't seem to be themed\n  padding: 0.5rem 0;\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"Notification.borderColor\",\n        !theme.dark ? \"#B2B2B2CD\" : \"#565A5CCD\"\n      )};\n  border-radius: ${({ theme }) =>\n    `${\n      (theme.value<number>(\n        \"Notification.arc\" as UnknownThemeProp<\"Notification.arc\">\n      ) ?? CORNER_RADIUS) / 2\n    }px`};\n  //display: inline-flex;\n  width: 23.3125rem;\n  position: relative;\n  background-color: ${bgColor};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Notification.foreground\",\n      !theme.dark ? \"#000\" : \"rgb(191,191,191)\"\n    )};\n\n  ${StyledHeaderActions} {\n    display: none;\n  }\n  &:hover ${StyledHeaderActions} {\n    display: initial;\n  }\n`;\n\nexport const StyledIconContainer = styled.span`\n  position: absolute;\n  left: 0.75rem;\n  top: 0.5rem;\n`;\n\nexport const StyledBalloonHeader = styled.div`\n  line-height: 1rem;\n  font-weight: bold;\n  margin: 0 2.125rem 0.25rem;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis; // this is not the case in original impl, but it's a clear improvement\n`;\n\nexport const StyledBalloonBody = styled.div<{\n  lineClamp: number | false;\n}>`\n  margin: 0 2.125rem 0 2.125rem;\n  line-height: 1rem;\n  display: inline;\n  -webkit-line-clamp: ${({ lineClamp }) => lineClamp};\n  word-break: ${({ lineClamp }) => lineClamp === 1 && \"break-all\"};\n  text-overflow: ellipsis;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  word-wrap: break-word;\n`;\n\nexport const StyledBalloonFooter = styled.div`\n  margin: 0.375rem 1.875rem 0 2.125rem;\n  display: inline-flex;\n  white-space: nowrap;\n  overflow: hidden;\n  gap: 1rem;\n\n  // could be -webkit-fill-available too, if it has good support. Probably it doesn't tho\n  max-width: calc(100% - 3.5rem);\n`;\n\nexport const StyledToggleIconContainer = styled.span`\n  display: inline-flex;\n  position: absolute;\n  right: 0.5rem;\n  bottom: 0;\n  background-color: ${bgColor};\n  padding-left: 0.5rem;\n`;\n\nexport const StyledToggleExpandButtonContainer = styled(StyledHoverContainer)`\n  display: block;\n  position: relative; // for icon absolute positioning\n  cursor: pointer;\n  flex: 1;\n`;\n\nexport const StyledToggleExpandButtonFooterContainer = styled(\n  StyledToggleExpandButtonContainer\n)`\n  min-height: 1.5rem;\n  margin: -0.5rem 0;\n  position: relative;\n  z-index: 1;\n  ${StyledToggleIconContainer} {\n    bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter} {\n    margin-top: 0.875rem;\n    margin-bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter}:hover + * .icon[data-hover] {\n    display: none;\n  }\n  ${StyledBalloonFooter}:hover + * .icon {\n    display: unset;\n  }\n`;\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\nimport { IconProps } from \"@intellij-platform/core/Icon/IconProps\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  StyledBalloonBody,\n  StyledBalloonContainer,\n  StyledBalloonFooter,\n  StyledBalloonHeader,\n  StyledHeaderActions,\n  StyledIconContainer,\n  StyledToggleExpandButtonContainer,\n  StyledToggleExpandButtonFooterContainer,\n  StyledToggleIconContainer,\n} from \"@intellij-platform/core/Balloon/Balloon.styled\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { Link } from \"@intellij-platform/core/Link\";\n\nexport type BalloonProps = ControlledStateProps<{ expanded: boolean }> &\n  DOMProps & {\n    /**\n     * Icon rendered in the top left\n     */\n    icon?: \"Info\" | \"Warning\" | \"Error\" | React.ReactElement<IconProps>;\n    /**\n     * Rendered beside close button. Can be used for rendering a \"notification settings\" icon button.\n     */\n    headerActions?: React.ReactNode;\n    /**\n     * Called when the close button is clicked. If not passed, close button will not be rendered.\n     */\n    onClose?: () => void;\n    /**\n     * Actions rendered in the footer.\n     */\n    actions?: React.ReactNode;\n  } & (\n    | {\n        title?: React.ReactNode;\n        body: React.ReactNode;\n      }\n    | {\n        title: React.ReactNode;\n        body?: React.ReactNode;\n      }\n  );\n\ntype BalloonContextObj = {\n  onClose?: () => void;\n};\nconst BalloonContext = React.createContext<BalloonContextObj | null>(null);\n\n/**\n * A tiny wrapper around {@link Link} component, to be used for actions in Balloon.\n * It closes the balloon when pressed.\n */\nexport const BalloonActionLink: typeof Link = React.forwardRef(\n  ({ onPress, ...props }, ref) => {\n    const context = useContext(BalloonContext);\n    if (context === null) {\n      throw new Error(\n        \"BalloonActionLink should only be rendered inside Balloon notifications\"\n      );\n    }\n    return (\n      <Link\n        ref={ref}\n        {...props}\n        onPress={(...args) => {\n          context?.onClose?.();\n          return onPress?.(...args);\n        }}\n      />\n    );\n  }\n);\n/**\n * [Balloon notification](https://jetbrains.github.io/ui/controls/balloon/) UI.\n *\n * Notes and TODO:\n * - Add support for \"error\" variant: https://github.com/JetBrains/intellij-community/blob/48c024fcd38bd8d1eccdada05489a8952a494270/platform/platform-impl/src/com/intellij/diagnostic/IdeMessagePanel.java#L215\n * - Add support for timeout. Although if the auto close behaviour is only timeout-based, maybe there is not much value in adding a prop for it and calling onClose on timeout.\n * - BalloonActions component to be used for rendering a bunch of links in the actions. It should encapsulate the\n *   behaviour of moving actions into a menu when there is not enough room.\n */\nexport const Balloon = ({\n  icon: iconProp = \"Info\",\n  expanded: expandedProp,\n  defaultExpanded = false,\n  onExpandedChange,\n  title,\n  headerActions,\n  onClose,\n  body,\n  actions,\n  ...containerProps\n}: BalloonProps): React.ReactElement => {\n  const bodyRef = useRef<HTMLDivElement>(null);\n  const [expandable, setExpandable] = useState(false);\n  const [expanded, setExpanded] = useControlledState(\n    expandedProp!,\n    defaultExpanded,\n    onExpandedChange!\n  );\n  const maxLinesWhenNotExpanded = 1 + (title ? 0 : 1) + (actions ? 0 : 1);\n\n  useEffect(() => {\n    const bodyElem = bodyRef.current;\n    if (bodyElem) {\n      setExpandable(\n        expanded\n          ? getNumLines(bodyElem) > maxLinesWhenNotExpanded\n          : bodyElem.scrollHeight > bodyElem.clientHeight\n      );\n    } else {\n      setExpandable(false);\n    }\n  }, [expanded]);\n  const validIconTypes = [\"Error\", \"Warning\", \"Info\"] as const;\n  const icon =\n    typeof iconProp === \"string\" ? (\n      <PlatformIcon\n        icon={`general/notification${validIconTypes.find(\n          (iconType, index, arr) =>\n            iconType === iconProp || index === arr.length - 1\n        )}.svg`}\n      />\n    ) : (\n      iconProp\n    );\n  // @ts-expect-error support for callback updater is removed from useControlledState. https://github.com/adobe/react-spectrum/issues/2320\n  const toggle = () => setExpanded((expanded) => !expanded);\n\n  const effectiveExpanded = expanded && Boolean(body);\n\n  return (\n    <BalloonContext.Provider value={{ onClose }}>\n      <StyledBalloonContainer data-testid=\"balloon\" {...containerProps}>\n        <StyledIconContainer>{icon}</StyledIconContainer>\n        {title && <StyledBalloonHeader>{title}</StyledBalloonHeader>}\n        <StyledHeaderActions>\n          {headerActions}\n          {onClose && (\n            <AutoHoverPlatformIcon\n              icon=\"ide/notification/close.svg\"\n              onClick={onClose}\n              role=\"button\"\n              data-testid=\"close-btn\"\n              style={{ marginLeft: \"0.75rem\" }}\n            />\n          )}\n        </StyledHeaderActions>\n        {body && (\n          <ToggleWrapper\n            expanded={effectiveExpanded}\n            enabled={expandable && !effectiveExpanded}\n            onToggle={toggle}\n          >\n            <StyledBalloonBody\n              lineClamp={!effectiveExpanded && maxLinesWhenNotExpanded}\n              ref={bodyRef}\n            >\n              {body}\n            </StyledBalloonBody>\n          </ToggleWrapper>\n        )}\n        <ToggleWrapper\n          expanded={effectiveExpanded}\n          enabled={expandable && effectiveExpanded}\n          onToggle={toggle}\n          Component={StyledToggleExpandButtonFooterContainer}\n        >\n          {actions && (\n            <StyledBalloonFooter onClick={(e) => e.stopPropagation()}>\n              {actions}\n            </StyledBalloonFooter>\n          )}\n        </ToggleWrapper>\n      </StyledBalloonContainer>\n    </BalloonContext.Provider>\n  );\n};\n\n/**\n * If enabled wraps its children in a clickable area (with the expand/collapse arrow),f for toggling expanded state.\n */\nconst ToggleWrapper: React.FC<{\n  enabled: boolean;\n  expanded: boolean;\n  Component?: typeof StyledToggleExpandButtonContainer;\n  onToggle: () => void;\n}> = ({\n  children,\n  onToggle,\n  expanded,\n  enabled,\n  Component = StyledToggleExpandButtonContainer,\n}) => {\n  const iconName = expanded ? \"collapse\" : \"expand\";\n  const toggleIcon = (\n    <StyledToggleIconContainer>\n      <AutoHoverPlatformIcon\n        icon={`ide/notification/${iconName}.svg`}\n        className=\"icon\"\n      />\n    </StyledToggleIconContainer>\n  );\n\n  return enabled ? (\n    <Component\n      onClick={onToggle}\n      role=\"button\"\n      data-testid={`${expanded ? \"collapse\" : \"expand\"}-btn`}\n    >\n      {children}\n      {toggleIcon}\n    </Component>\n  ) : (\n    <>{children}</>\n  );\n};\n\n/**\n * Based on the computed line-height and clientHeight of the element, returns the number of lines of the content.\n */\nfunction getNumLines(bodyElem: Element) {\n  return (\n    bodyElem.clientHeight / parseFloat(getComputedStyle(bodyElem).lineHeight)\n  );\n}\n","import React, {\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Balloon, BalloonProps } from \"./Balloon\";\nimport { StyledBalloonsStack } from \"./StyledBalloonsStack\";\n\ntype ShowProps = Pick<\n  BalloonProps,\n  \"title\" | \"icon\" | \"body\" | \"actions\" | \"headerActions\"\n>;\n\ninterface BalloonsAPI {\n  /**\n   * Shows a Balloon notification on the bottom left of the screen.\n   * @param props: Props to pass to the Balloon component\n   * @param [autoHideTimeout=10_000] timeout in ms for hiding the balloon notification.\n   * @returns hide function, in case the notification can expire for some reason.\n   */\n  show(props: ShowProps, autoHideTimeout?: number): () => void;\n  showSticky(props: ShowProps): () => void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\"You must render a BalloonsProvider...\");\n};\n\nconst BalloonsContext = React.createContext<BalloonsAPI>({\n  show: NotImplementedFn,\n  showSticky: NotImplementedFn,\n});\n\nexport const useBalloons = (): BalloonsAPI => useContext(BalloonsContext);\n\ntype BalloonElement = ReactElement<BalloonProps, typeof Balloon>;\n\nexport interface BalloonsProviderProps {\n  disablePortal?: boolean;\n  BalloonsContainer?: React.ElementType;\n}\n\n/**\n * Enables imperative API (via {@link useBalloons}) for showing Balloon notifications on the bottom right of the screen.\n * It renders notifications in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n * @param disablePortal: if `true`, the container for notifications will not be rendered in a portal\n * @param BalloonsContainer: container component for the notifications. It's {@link StyledBalloonsStack} by default.\n *\n * TODO: fade in/out transition. Notes:\n *  - Doesn't seem fade-in is needed. Tho it's much easier than fade-out, as it can be achieved with a css animation.\n *  - Fade out should happen only when the balloon is being hidden by timeout.\n * TODO: Support for maximum number of notifications and showing \"x more notification(s)\" button if the limit exceeds\n */\n\nexport const BalloonsProvider: React.FC<BalloonsProviderProps> = ({\n  children,\n  disablePortal,\n  BalloonsContainer = StyledBalloonsStack,\n}) => {\n  const [balloons, setBalloons] = useState<Array<BalloonElement>>([]);\n  const timeoutIdsRef = useRef<number[]>([]);\n  const lastIdRef = useRef<number>(0);\n\n  const api = useMemo<BalloonsAPI>(() => {\n    const show: BalloonsAPI[\"show\"] = (props, timeout = 10_000) => {\n      lastIdRef.current++;\n      const onClose = () => {\n        setBalloons((balloons) =>\n          balloons.filter((aBalloon) => aBalloon !== balloon)\n        );\n      };\n      const balloon = (\n        <Balloon\n          key={lastIdRef.current}\n          {...props}\n          title={props.title} // TS acts unreasonable without this\n          onClose={onClose}\n        />\n      );\n      setBalloons((balloons) => {\n        if (timeout > 0) {\n          const timeoutId = window.setTimeout(() => {\n            onClose();\n            timeoutIdsRef.current = timeoutIdsRef.current.filter(\n              (aTimeoutId) => aTimeoutId !== timeoutId\n            );\n          }, timeout);\n          timeoutIdsRef.current = [...timeoutIdsRef.current, timeoutId];\n        }\n        return balloons.concat(balloon);\n      });\n      return onClose;\n    };\n    return {\n      show,\n      showSticky: (props) => show(props, 0),\n    };\n  }, []);\n\n  // clear timeouts when unmounted\n  useEffect(() => {\n    return () => {\n      timeoutIdsRef.current.forEach((id) => {\n        window.clearTimeout(id);\n      });\n    };\n  }, []);\n\n  const notificationsStack = (\n    <BalloonsContainer\n      style={{ position: disablePortal ? \"absolute\" : undefined }}\n    >\n      {balloons}\n    </BalloonsContainer>\n  );\n\n  return (\n    <BalloonsContext.Provider value={api}>\n      {children}\n      {disablePortal\n        ? notificationsStack\n        : ReactDOM.createPortal(notificationsStack, document.body)}\n    </BalloonsContext.Provider>\n  );\n};\n","import styled from \"styled-components\";\nimport { StyledBalloonContainer } from \"@intellij-platform/core/Balloon/Balloon.styled\";\n\n/**\n * Container component for stacking a number of Balloons in an overlay placed on the bottom right of where it's rendered.\n */\nexport const StyledBalloonsStack = styled.div`\n  position: fixed;\n  z-index: 1;\n  bottom: 42px;\n  right: 26px;\n  ${StyledBalloonContainer} {\n    margin-bottom: 12px;\n  }\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { AriaBaseButtonProps, ButtonProps } from \"@react-types/button\";\n\nexport interface BareButtonProps extends AriaBaseButtonProps, ButtonProps {\n  children: React.ReactElement;\n}\n\n/**\n * A component to make arbitrary content an accessible button which is also able to be a tooltip trigger.\n */\nexport const BareButton: React.FC<BareButtonProps> = React.forwardRef(\n  function BareButton(props: BareButtonProps, ref: ForwardedRef<HTMLElement>) {\n    const { buttonProps } = useButton(props, useObjectRef(ref));\n    const domProps = filterDOMProps(props);\n    const { autoFocus } = props;\n\n    return React.cloneElement(\n      props.children,\n      mergeProps(domProps, buttonProps, { autoFocus, ref })\n    );\n  }\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport const StyledButton = styled.button<{ disabled?: boolean }>`\n  box-sizing: border-box;\n  min-width: 4.5rem; // https://jetbrains.github.io/ui/controls/button/#28\n  padding: 0.25rem 0.875rem; // https://jetbrains.github.io/ui/controls/button/#28\n  font-family: inherit;\n  background-color: ${({ theme, disabled }) =>\n    disabled ? \"transparent\" : theme.color(\"Button.startBackground\")};\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"Button.disabledText\")\n      : theme.color(\n          \"Button.foreground\" as UnknownThemeProp<\"Button.foreground\">\n        )};\n  border: 1px solid\n    ${({ theme, disabled }) =>\n      disabled\n        ? theme.color(\"Button.disabledBorderColor\")\n        : theme.color(\"Button.startBorderColor\")};\n  border-radius: ${({ theme }) =>\n    (theme.value<number>(\"Button.arc\") ?? 6) / 2}px;\n  box-shadow: ${({ theme }) =>\n    theme.value(\"Button.paintShadow\")\n      ? `0 0 0 ${theme.value(\"Button.shadowWidth\") ?? 2}px ${\n          theme.color(\"Button.shadowColor\") ?? // Button.darcula.shadowColor default is skipped.\n          (theme.dark ? \"#36363680\" : \"#a6a6a633\")\n        }`\n      : \"\"};\n  white-space: nowrap; // https://jetbrains.github.io/ui/controls/button/#29\n\n  flex-shrink: 0; // button should not shrink when rendered in a flex container\n\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.focusedBorderColor\", \"#87afda\")};\n    outline: none;\n    box-shadow: ${({ theme }) =>\n      `0 0 0 2px ${\n        // NOTE: by not using the second argument for default value, we prioritize *.focusColor over the rest.\n        theme.color(\"Component.focusColor\") ??\n        theme.color(\n          \"Focus.borderColor\" as UnknownThemeProp<\"Focus.borderColor\">,\n          \"#8ab2eb\"\n        )\n      }`};\n  }\n`;\nexport const StyledDefaultButton = styled(StyledButton)`\n  background-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBackground\", \"#384f6b\")};\n  color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.foreground\")};\n  border-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBorderColor\", \"#BFBFBF\")};\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.default.focusedBorderColor\", \"#87afda\")};\n  }\n`;\n\nexport const StyledIconButton = styled(StyledButton)`\n  border-radius: 1000px;\n  padding: 0;\n  line-height: 0;\n  min-width: 0;\n  height: 1.5rem;\n  width: 1.5rem;\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { AriaButtonProps } from \"@react-types/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  StyledButton,\n  StyledDefaultButton,\n  StyledIconButton,\n} from \"@intellij-platform/core/Button/StyledButton\";\n\ntype ButtonVariant = \"default\" | \"icon\";\nexport interface ButtonProps extends AriaButtonProps {\n  variant?: ButtonVariant; // can allow for custom (styled) component too if needed.\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n}\n\nconst variants: { [key in ButtonVariant]: typeof StyledButton } = {\n  default: StyledDefaultButton,\n  icon: StyledIconButton,\n};\n\n/**\n * https://jetbrains.github.io/ui/controls/button/\n *\n * TODO:\n * - Support for \"default\" button behaviour. it's kind of similar to a <button type=\"submit\" /> in html, but textarea\n * behaviour is different from what is explained here: https://jetbrains.github.io/ui/controls/button/#16\n * Cmd+Enter should always trigger onPress. Plus, maybe it should work independent of \"form\" being used? or maybe it's\n * not a big deal to expect an ancestor \"form\" element, when variant is \"default\"?\n * - Support for mnemonic\n * - \"Default\" style differences in Windows.\n * - Gradient colors (low hanging fruit, but negligible added value).\n *\n * Known issues:\n * - In the original impl, default button looks the same as normal button, when focus is not within the same area that\n * the button is. For example in the commit tool window, \"Commit\" button which is default, is not blue, unless the\n * \"Commit\" tool window is focused. This particular case can easily be achieved by conditionally setting variant to,\n * \"default\" based on tool window focus state, which is accessible via useDefaultToolWindowContext(), if\n * DefaultToolWindow is used. But we need to see if the same requirement exists in various places.\n * NOTE: this item is related to the first item in the to-do list above. There can be a container kind of component,\n * which enables \"default\" behaviour and look. Maybe it can be FocusScope or at least related to FocusScope.\n * - In the original impl, there is no visual clue for pressed state, which is poor accessibility. For now, the same\n * behaviour is followed here too. But we may reconsider deviating from the original impl for an improvement here.\n *\n */\nexport const Button: React.FC<ButtonProps> = React.forwardRef(function Button(\n  { variant, ...props }: ButtonProps,\n  ref: ForwardedRef<HTMLElement>\n) {\n  const { buttonProps } = useButton(props, useObjectRef(ref));\n  const domProps = filterDOMProps(props);\n  const { autoFocus } = props;\n\n  const Component = (variant && variants[variant]) || StyledButton;\n  return (\n    <Component {...mergeProps(domProps, buttonProps, { autoFocus })}>\n      {props.children}\n    </Component>\n  );\n});\n","import React, { HTMLProps, ReactNode } from \"react\";\nimport { useToggleState } from \"@react-stately/toggle\";\nimport { VisuallyHidden } from \"@react-aria/visually-hidden\";\nimport { useCheckbox } from \"@react-aria/checkbox\";\nimport {\n  AriaLabelingProps,\n  FocusableDOMProps,\n  FocusableProps,\n  InputBase,\n} from \"@react-types/shared\";\nimport { useFocusRing } from \"@react-aria/focus\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { CheckboxIcon } from \"./CheckboxIcon\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface CheckboxProps\n  extends InputBase,\n    FocusableDOMProps,\n    AriaLabelingProps,\n    FocusableProps {\n  /**\n   * If set to true, the checkbox won't be focusable.\n   * Common use cases:\n   * - When checkbox is rendered in a focusable container, like a list item where the focus should not be taken away\n   *   from that container.\n   * - \"Amend\" checkbox in \"Commit\" tool window. The focus is kept in the commit message or changes tree, perhaps, for\n   *   a questionably better UX.\n   * Note: Passing {@link excludeFromTabOrder} will still let the checkbox be focusable, while `preventFocus`, doesn't\n   * let the component get focused at all.\n   * TODO(potential): it might be nicer to have a `preventFocusOnPress` prop consistent with ActionButton, instead.\n   *  In that case preventing focus completely would be achieved with `preventFocusOnPres` and `excludeFromTabOrder`.\n   */\n  preventFocus?: boolean;\n\n  /**\n   * By default, focus ring is always shown when the checkbox is focused, independent of the interaction method.\n   * if set to false, the focus will be only visible if the interaction is done via keyboard or screen readers.\n   * Similar to how [:focus-visible](https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible) works.\n   */\n  disableFocusAlwaysVisible?: boolean;\n\n  /**\n   * Indeterminism is presentational only.\n   * The indeterminate visual representation remains regardless of user interaction.\n   */\n  isIndeterminate?: boolean;\n\n  /**\n   * The label for the element.\n   */\n  children?: ReactNode;\n\n  /**\n   * Whether the element should be selected (uncontrolled).\n   */\n  defaultSelected?: boolean;\n  /**\n   * Whether the element should be selected (controlled).\n   */\n  isSelected?: boolean;\n  /**\n   * Handler that is called when the element's selection state changes.\n   */\n  onChange?: (isSelected: boolean) => void;\n  /**\n   * The value of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefvalue).\n   */\n  value?: string;\n  /**\n   * The name of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefname).\n   */\n  name?: string;\n\n  className?: string; // to support styled-components\n}\n\nconst StyledWrapperLabel = styled.label`\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst StyledCheckboxLabelText = styled.span<{\n  isDisabled: boolean | undefined;\n}>`\n  margin-left: 0.25rem;\n  color: ${({ theme, isDisabled }) =>\n    isDisabled\n      ? theme.color(\n          \"CheckBox.disabledText\" as UnknownThemeProp<\"CheckBox.disabledText\">,\n          \"#808080\" /* this default value was a bit tricky. Still not clear from where it comes in darcular \n          theme when there is no clue of Checkbox.disabledText or *.disabledText. Note that using \n          CheckBox.disabledForeground is not a good option, because it's something other than #808080 for darcula */\n        )\n      : theme.color(\"*.foreground\")};\n`;\n\n/**\n * Checkbox component to be used with or without a label.\n *\n * While the checkbox without the label + preventFocus makes it usable in tree/list, it might be more optimized to\n * use a more lightweight component like ListItemCheckbox, which uses CheckboxIcon with a simple press handle. Without\n * any input, state, etc.\n */\nexport const Checkbox = ({\n  preventFocus,\n  className,\n  disableFocusAlwaysVisible,\n  ...props\n}: CheckboxProps) => {\n  const state = useToggleState(props);\n  const ref = React.useRef<HTMLInputElement>(null);\n  const { inputProps } = useCheckbox(props, state, ref);\n\n  const { isFocusVisible, isFocused, focusProps } = useFocusRing({\n    autoFocus: props.autoFocus,\n  });\n  const { pressProps: wrapperPressProps, isPressed } = usePress({});\n\n  const focusDisabledProps: Pick<\n    HTMLProps<HTMLInputElement>,\n    \"onFocusCapture\" | \"tabIndex\"\n  > = preventFocus\n    ? {\n        onFocusCapture: (event) => {\n          event.stopPropagation();\n          event.preventDefault();\n          if (event.relatedTarget instanceof HTMLElement) {\n            event.relatedTarget.focus();\n          } else {\n            event.target.blur();\n          }\n        },\n        tabIndex: -1,\n      }\n    : {};\n\n  return (\n    <StyledWrapperLabel {...mergeProps(wrapperPressProps, { className })}>\n      <VisuallyHidden>\n        <input\n          {...mergeProps(inputProps, focusProps, focusDisabledProps)}\n          ref={ref}\n        />\n      </VisuallyHidden>\n      <CheckboxIcon\n        isIndeterminate={props.isIndeterminate}\n        isFocused={\n          disableFocusAlwaysVisible\n            ? isFocusVisible\n            : (!preventFocus && isPressed) || isFocused\n        }\n        isSelected={props.isIndeterminate || state.isSelected}\n        isDisabled={props.isDisabled}\n        aria-hidden=\"true\"\n        style={{\n          pointerEvents: \"none\",\n        }}\n      />\n      {props.children && (\n        <StyledCheckboxLabelText isDisabled={props.isDisabled}>\n          {props.children}\n        </StyledCheckboxLabelText>\n      )}\n    </StyledWrapperLabel>\n  );\n};\n","import React, { ComponentProps } from \"react\";\nimport { LafIcon } from \"@intellij-platform/core/Icon\";\n\n/**\n * Renders checkbox UI in different states (focused, selected, indeterminate, etc.), without having anything to do\n * with the interactions\n */\nexport const CheckboxIcon = ({\n  isDisabled,\n  isFocused,\n  isIndeterminate,\n  isSelected,\n  ...otherProps\n}: Omit<ComponentProps<typeof LafIcon>, \"size\" | \"icon\"> & {\n  isIndeterminate: boolean | undefined;\n  isFocused: boolean;\n  isDisabled: boolean | undefined;\n  isSelected: boolean;\n}) => {\n  return (\n    <LafIcon\n      {...otherProps}\n      size={20}\n      icon={{\n        name: isIndeterminate ? \"checkBoxIndeterminate\" : \"checkBox\",\n        modifiers: {\n          Disabled: isDisabled,\n          Selected: isSelected || isIndeterminate,\n          Focused: isFocused,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { CollectionSpeedSearchMatches } from \"./useCollectionSpeedSearchResult\";\n\nexport type CollectionSpeedSearchContextValue = {\n  matches: CollectionSpeedSearchMatches;\n  collection: Collection<Node<unknown>>;\n};\n\nexport const CollectionSpeedSearchContext =\n  React.createContext<CollectionSpeedSearchContextValue | null>(null);\n","import React, { Key, useContext } from \"react\";\nimport { TextWithHighlights } from \"@intellij-platform/core/TextWithHighlights/TextWithHighlights\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch/CollectionSpeedSearchContext\";\n\ntype CollectionSpeedSearchItemContextValue = {\n  text: string;\n  highlightedRanges: null | TextRange[];\n};\n\nconst CollectionSpeedSearchItemContext = React.createContext<null | CollectionSpeedSearchItemContextValue>(\n  null\n);\n\nexport const SpeedSearchItemHighlightsProvider: React.FC<{ itemKey: Key }> = ({\n  children,\n  itemKey,\n}) => {\n  const context = useContext(CollectionSpeedSearchContext);\n  if (!context) {\n    throw new Error(\n      `SpeedSearchItemProvider is only meant to be rendered by collection components with speed search. \n      CollectionSpeedSearchContext is expected to be rendered as a wrapper around all items.`\n    );\n  }\n  const item = context.collection.getItem(itemKey);\n  const text = item?.textValue;\n  if (!text && item?.props.textValue === undefined) {\n    console.warn(\n      \"no textValue specified on Item. When using SpeedSearch, you need to specify textValue for item, which will be the basis for search\"\n    );\n  }\n  return (\n    <CollectionSpeedSearchItemContext.Provider\n      value={{\n        highlightedRanges: context.matches.get(itemKey) || null,\n        text: text,\n      }}\n    >\n      {children}\n    </CollectionSpeedSearchItemContext.Provider>\n  );\n};\n\n/**\n * Used inside Item content, to render the textValue of the Item, potentially with highlighted ranges if it's a match\n * in current search.\n */\nexport const HighlightedTextValue = function ({\n  Component = \"span\",\n}: {\n  /**\n   * When rendering in a flex parent (which is the case for tree or list), rendering a container is necessary to have\n   * the right spacing around highlights, when the highlighter span is immediately followed or proceeded by a white\n   * space. By default, a \"span\" is rendered.\n   */\n  Component?: React.ElementType;\n}) {\n  const speedSearchContext = React.useContext(CollectionSpeedSearchItemContext);\n  if (!speedSearchContext) {\n    throw new Error(\n      \"HighlightedTextValue should be rendered only in items of a speed search enabled collection component\"\n    );\n  }\n  const { highlightedRanges, text } = speedSearchContext;\n  return (\n    <Component>\n      {highlightedRanges ? (\n        <TextWithHighlights highlights={highlightedRanges}>\n          {text}\n        </TextWithHighlights>\n      ) : (\n        text\n      )}\n    </Component>\n  );\n};\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { Key } from \"react\";\n\nexport function createSpeedSearchSelectionManager(\n  wrappedSelectionManager: SelectionManager,\n  matches: Map<Key, unknown /* We don't care what a match is here */> | null\n): SelectionManager {\n  return Object.create(wrappedSelectionManager, {\n    selectAll: {\n      value: () => {\n        if (matches) {\n          // @ts-expect-error: state is private and there is no API on SelectionManager for bulk\n          // setting selected keys (which would ideally check for not selecting disabled keys internally).\n          const state = wrappedSelectionManager.state;\n          state.setSelectedKeys(\n            new Set(\n              [...matches.keys()].filter((key) => !state.disabledKeys.has(key))\n            )\n          );\n        } else {\n          wrappedSelectionManager.selectAll();\n        }\n      },\n    },\n  });\n}\n","import { Collection, KeyboardDelegate, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport {\n  SpeedSearchStateProps,\n  useSpeedSearch,\n  useSpeedSearchState,\n} from \"../SpeedSearch/useSpeedSearch\";\nimport { useCollectionSpeedSearchResult } from \"./useCollectionSpeedSearchResult\";\nimport { useMemo } from \"react\";\nimport { createSpeedSearchKeyboardDelegate } from \"./createSpeedSearchKeyboardDelegate\";\n\n/**\n * Given a `collection`, a `selectionManager` and a `keyboardDelegate`, it returns:\n * - `speedSearch`: search term, if speed search is active or not, and the matched keys\n * - `matches`: A Set of matched keys, or `null` if speed search is not active\n * - `containerProps`: The props you need to pass to the collection container element to enable\n * speedSearch on it.\n * - `selectionManager`: a selection manager in which select all is overridden to only select\n * matched items if speed search is active.\n * - `keyboardDelegate`: a keyboard delegate in which limits navigation to matched items, when\n * speed search is active.\n *\n * Speed search options, including the ones for optionally controlling the state of the speed search\n * are also accepted in inputs.\n */\nexport function useCollectionSpeedSearch<T>({\n  collection,\n  selectionManager,\n  stickySearch,\n  keyboardDelegate,\n  ...speedSearchStateProps\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  stickySearch?: boolean;\n} & SpeedSearchStateProps) {\n  const speedSearch = useSpeedSearchState(speedSearchStateProps); // maybe allow control over state\n  // via props?\n\n  const {\n    matches,\n    selectionManager: speedSearchSelectionManager,\n  } = useCollectionSpeedSearchResult({\n    collection,\n    selectionManager,\n    speedSearch,\n  });\n  const { containerProps } = useSpeedSearch({ stickySearch }, speedSearch);\n  const speedSearchKeyboardDelegate = useMemo(\n    () =>\n      createSpeedSearchKeyboardDelegate(\n        keyboardDelegate,\n        speedSearch.active ? matches : null\n      ),\n    [speedSearch.active, keyboardDelegate, matches]\n  );\n\n  // Doesn't seem necessary to wrap with useMemo, but can be rethink-ed\n  const speedSearchContextValue = { matches, collection };\n\n  return {\n    containerProps,\n    selectionManager: speedSearchSelectionManager,\n    keyboardDelegate: speedSearchKeyboardDelegate,\n    speedSearch: {\n      ...speedSearch,\n      matches,\n    },\n    searchPopupProps: {\n      active: speedSearch.active,\n      match: matches.size > 0,\n      children: speedSearch.searchTerm,\n    },\n    speedSearchContextValue,\n  };\n}\n","import { Key, useEffect, useMemo } from \"react\";\nimport { minusculeMatch } from \"../minusculeMatch\";\nimport { SpeedSearchState } from \"../SpeedSearch/useSpeedSearch\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { createSpeedSearchSelectionManager } from \"./createSpeedSearchSelectionManager\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nexport type CollectionSpeedSearchMatches = Map<Key, TextRange[]>;\n\nexport function useCollectionSpeedSearchResult<T>({\n  collection,\n  selectionManager,\n  speedSearch,\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  speedSearch: SpeedSearchState;\n}) {\n  const { searchTerm, active } = speedSearch;\n\n  /**\n   * Note: when a component is implemented using react-aria's useCollection, any re-render of that component causes\n   * a new collection. That's because prop.children is normally an inline function, and therefore the collection is\n   * re-created: https://github.com/adobe/react-spectrum/blob/4a1cff846018e449487ccf54d7474bdfa4d4f57c/packages/@react-stately/collections/src/useCollection.ts#L29\n   * This means we will unnecessarily perform the search in such cases. it might be a non-issue, but if it turned out\n   * to be an issue, a sub-optimum improvement would be to use `collection.size` as a dependency instead of `collection`,\n   * assuming that searchable text in collections won't change, and assuming that the important changes (search-wise)\n   * will usually involve a size change in the collection.\n   */\n  const result = useMemo(() => {\n    const matches: CollectionSpeedSearchMatches = new Map(); // maybe make it nullable makes more sense\n    if (speedSearch.active) {\n      // it's important not to iterate on items, since they can be nested.\n      [...collection.getKeys()]\n        .map((key) => collection.getItem(key))\n        .filter(({ type }) => type === \"item\")\n        .forEach((item) => {\n          const matchedRanges = minusculeMatch(item.textValue, searchTerm);\n          if (matchedRanges) {\n            matches.set(item.key, matchedRanges);\n          }\n        });\n    }\n\n    return {\n      matches,\n      selectionManager: createSpeedSearchSelectionManager(\n        selectionManager,\n        active ? matches : null\n      ),\n    };\n  }, [searchTerm, collection, active]);\n\n  const latestValues = useLatest({ ...result, collection });\n\n  // On every query change, if the current selection doesn't include any of the matched items, move selection to the\n  // first matched item.\n  useEffect(() => {\n    const { selectionManager, matches, collection } = latestValues.current;\n    const matchedKeys = [...matches.keys()];\n    const noneOfTheMatchesAreSelected = !matchedKeys.some((matchedKey) =>\n      selectionManager.isSelected(matchedKey)\n    );\n\n    if (matchedKeys.length > 0 && noneOfTheMatchesAreSelected) {\n      const newSelectedKey = getMatchToSelect({\n        collection,\n        selectionManager,\n        matchedKeys,\n      });\n\n      selectionManager.setFocusedKey(newSelectedKey);\n      selectionManager.replaceSelection(newSelectedKey);\n    }\n  }, [\n    searchTerm,\n    latestValues /*it's a ref object, so no harm in listing it here to comply with rules of hooks*/,\n  ]);\n  return result;\n}\n\n/**\n * given a non-empty array of matched keys, returns the one that should be selected\n */\nfunction getMatchToSelect({\n  collection,\n  selectionManager,\n  matchedKeys,\n}: {\n  collection: Collection<Node<unknown>>;\n  selectionManager: SelectionManager;\n  matchedKeys: Key[];\n}): Key {\n  let passedFirstSelection = false;\n  for (const key of collection.getKeys()) {\n    if (key === selectionManager.firstSelectedKey) {\n      passedFirstSelection = true;\n    }\n    if (passedFirstSelection && matchedKeys.includes(key)) {\n      return key;\n    }\n  }\n  return matchedKeys[0];\n}\n","import React, { Key } from \"react\";\nimport { KeyboardDelegate } from \"@react-types/shared\";\n\n/**\n * Creates a new KeyboardDelegate in which keyKeyBelow and getKeyAbove are overridden in a way that\n * navigation is limited to matched items.\n * Note: select all action is not handled in KeyboardDelegate.\n * Note: when virtualization is added, this probably need to change, like how it's handled\n * in `useListBoxLayout` in react spectrum.\n */\nexport function createSpeedSearchKeyboardDelegate(\n  wrappedKeyboardDelegate: KeyboardDelegate,\n  matches: Map<Key, unknown /*We don't care what a match is, here*/> | null\n): KeyboardDelegate {\n  // TODO: page up and down deactivate speed search. If we want that, we can pass the speedSearch\n  //  object too. but doesn't seem like the best way to do it, even it the same behavior is expected\n  return Object.create(wrappedKeyboardDelegate, {\n    getKeyBelow: {\n      value: (key: React.Key): React.Key | undefined => {\n        let keyBelow = wrappedKeyboardDelegate.getKeyBelow?.(key);\n        while (keyBelow != null) {\n          if (!matches || matches.has(keyBelow)) {\n            return keyBelow;\n          }\n          keyBelow = wrappedKeyboardDelegate.getKeyBelow?.(keyBelow);\n        }\n        return keyBelow ?? undefined;\n      },\n    },\n    getKeyAbove: {\n      value: (key: React.Key): React.Key | undefined => {\n        let keyAfter = wrappedKeyboardDelegate.getKeyAbove?.(key);\n        while (keyAfter != null) {\n          if (!matches || matches.has(keyAfter)) {\n            return keyAfter;\n          }\n          keyAfter = wrappedKeyboardDelegate.getKeyAbove?.(keyAfter);\n        }\n        return keyAfter ?? undefined;\n      },\n    },\n  });\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { PartialNode } from \"@react-stately/collections\";\n\ninterface DividerProps {}\nfunction Divider({}: DividerProps): ReactElement {\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  return null as any;\n}\n// We don't want getCollectionNode to show up in the type definition\nlet _Divider = Divider as (props: DividerProps) => JSX.Element;\nexport { _Divider as Divider };\n\nDivider.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>\n): Generator<PartialNode<T>> {\n  let rendered = null;\n\n  yield {\n    type: \"divider\",\n    element: null as any, // to prevent check on key, which is not necessary for divider\n    props: props,\n    rendered,\n    hasChildNodes: false,\n  };\n};\n\n/**\n * To be used in dynamic collections, just to provide a key and make it easy to check in the render\n * function to figure out what to render (an Item or a Divider)\n */\nexport class DividerItem {\n  private static seq = 0;\n  key = \"divider_\" + DividerItem.seq++;\n  get id() {\n    return this.key;\n  }\n}\n","import React, { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { Item as StatelyItem, PartialNode } from \"@react-stately/collections\";\n\n// noinspection JSUnusedLocalSymbols\n/**\n * Item for collection components, which by default disables caching, unless `invalidated` prop is set to false on the\n * context passed to useCollection. Control over cache invalidation policy can be enabled by using\n * `useCollectionCacheInvalidation` for creating such context object.\n */\nfunction Item<T>(props: ItemProps<T>): ReactElement {\n  return (null as any) as React.ReactElement;\n}\n\nexport type CacheInvalidationContext = { invalidated?: boolean };\n\n// We don't want getCollectionNode to show up in the type definition\nlet _Item = Item as <T>(props: ItemProps<T>) => JSX.Element;\nexport { _Item as Item };\n\n/**\n * @private @preapproved\n */\nItem.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: CacheInvalidationContext\n): Generator<PartialNode<T>> {\n  const itemGenerator: Generator<\n    PartialNode<T>\n  > = (StatelyItem as any).getCollectionNode(props, context);\n  const result = itemGenerator.next().value;\n  const originalShouldInvalidate = result.shouldInvalidate;\n  result.shouldInvalidate = (context: CacheInvalidationContext) =>\n    originalShouldInvalidate?.(context) || context.invalidated;\n  yield result;\n};\n","import React from \"react\";\nimport { styled } from \"../styled\";\nimport { SelectionAwareSpan } from \"@intellij-platform/core/Collections/SelectionAwareSpan\";\n\nconst StyledItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  padding-right: 0.25rem;\n  gap: 0.2rem;\n`;\n\nconst StyledHint = styled(SelectionAwareSpan)`\n  display: inline-flex;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  padding-left: 0.1rem;\n`;\n\n/**\n * Generic layout component capturing common use cases of tree or list items.\n * It handles the spacing between parts, and provides styled components for parts that need specific styling.\n * For more flexibility over the order of various pieces of content in list/tree items, there is no specific props\n * for parts. Different parts should just be rendered in children.\n *\n * @example\n * ```tsx\n * <ItemLayout>\n *   <PlatformIcon icon=\"nodes/folder\" />\n *   <HighlightedTextValue />\n *   <ItemLayout.Hint>~/workspace/jui</ItemLayout.Hint>\n * </ItemLayout>\n * ```\n * @beta\n */\nexport const ItemLayout = ({ children }: { children: React.ReactNode }) => {\n  return <StyledItemLayout>{children}</StyledItemLayout>;\n};\n\n/**\n * A more subtle text usually rendered next to the main text in the item.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Hint = StyledHint;\n","import React, { useContext } from \"react\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\n\n/**\n * Overrides color to a legible one, if the tree/list item (in which this span is rendered) is selected.\n * Can be used as base of styled components for specific item parts in lists and tree with a custom color.\n * @alpha\n */\nexport const SelectionAwareSpan: React.FC<{ className?: string }> = ({\n  children,\n  className,\n}) => {\n  const { isSelected, isFocused } = useContext(ItemStateContext) || {\n    isSelected: false,\n    isFocused: false,\n  };\n  return (\n    <span\n      className={className}\n      style={{ color: isSelected && isFocused ? \"inherit\" : undefined }}\n    >\n      {children}\n    </span>\n  );\n};\n","import { RefObject, useEffect } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { scrollIntoView } from \"@react-aria/utils\";\n\ntype CollectionAutoScrollProps = {\n  isVirtualized?: boolean;\n  selectionManager: SelectionManager;\n};\n\nexport function useCollectionAutoScroll(\n  { isVirtualized, selectionManager }: CollectionAutoScrollProps,\n  ref: RefObject<HTMLElement>\n) {\n  // If not virtualized, scroll the focused element into view when the focusedKey changes.\n  // When virtualized, Virtualizer handles this internally.\n  useEffect(() => {\n    if (!isVirtualized && selectionManager.focusedKey && ref?.current) {\n      let element = ref.current.querySelector(\n        `[data-key=\"${selectionManager.focusedKey}\"]`\n      ) as HTMLElement;\n      if (element) {\n        scrollIntoView(ref.current, element);\n      }\n    }\n  }, [isVirtualized, ref, selectionManager.focusedKey]);\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, { ForwardedRef } from \"react\";\nimport { amendName, PlatformIcon, PlatformIconProps } from \"./PlatformIcon\";\n\nexport const StyledHoverContainer = styled.span`\n  .icon[data-hover] {\n    display: none;\n  }\n  &:hover {\n    .icon {\n      display: none;\n    }\n    .icon[data-hover] {\n      display: inline-flex;\n    }\n  }\n`;\n\nconst StyledIconHoverContainer = styled(StyledHoverContainer)`\n  display: inline-flex;\n`;\n\n/**\n * A common use case for PlatformIcons is to have a default icon and a hover icon.\n * This component captures that simple use case, by rendering both icons, and hiding one based on a hover selector.\n * If the hover-able element is a parent of the icon, and not the icon itself, one can use `StyledHoverContainer`,\n * for that parent element:\n * const SomeParent = styled(StyledHoverContainer)`...`;\n * <SomeParent><AutoHoverPlatformIcon icon=\"...\" /></SomeParent>\n *\n * Now the hover icon is shown when the parent is hovered, instead of the icon itself.\n *\n */\nexport const AutoHoverPlatformIcon = React.forwardRef(\n  function AutoHoverPlatformIcon(\n    {\n      hoverIcon,\n      ...props\n    }: PlatformIconProps & {\n      /**\n       * The icon to be used when hovered. If not provided, it will be the \"somethingHovered\" where \"something\" is the `icon`\n       */\n      hoverIcon?: string;\n    },\n    ref: ForwardedRef<HTMLSpanElement>\n  ) {\n    const className = `icon ${props.className || \"\"}`;\n    return (\n      <StyledIconHoverContainer ref={ref}>\n        <PlatformIcon {...props} className={className} />\n        <PlatformIcon\n          {...props}\n          className={className}\n          icon={hoverIcon ?? amendName(props.icon, \"Hover\")}\n          data-hover\n        />\n      </StyledIconHoverContainer>\n    );\n  }\n);\n","import useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport React, { ForwardedRef } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\ninterface IconModifiers {\n  Selected?: boolean;\n  Focused?: boolean;\n  Disabled?: boolean;\n  Editable?: boolean;\n  Pressed?: boolean;\n}\n\nexport interface ThemeIconProps extends IconProps {\n  /**\n   * Icon which will be resolved against the default icon location based on theme type\n   */\n  icon: string | { name: string; modifiers: IconModifiers };\n\n  /**\n   * A theme key that can optionally override the icon.\n   */\n  themePath?: string;\n}\n\nconst ICONS_DIR_PREFIX = \"com/intellij/ide/ui/laf/icons/\";\n\n// Similar to LafIconLookup\nfunction findIconPath(\n  theme: Theme,\n  name: string,\n  modifiers: IconModifiers = {}\n) {\n  const basePath = `${ICONS_DIR_PREFIX}${\n    theme.isUnderDarcula() ? \"darcula/\" : \"intellij/\"\n  }`;\n  const suffix = ([\n    \"Editable\",\n    \"Selected\",\n    \"Pressed\",\n    \"Focused\",\n    \"Disabled\",\n  ] as Array<keyof typeof modifiers>).reduce(\n    (soFar, modifier) => soFar + (modifiers[modifier] ? modifier : \"\"),\n    \"\"\n  );\n  return `${basePath}${name}${suffix}.svg`;\n}\n\nfunction useIconPath(\n  iconDescriptor: string | { name: string; modifiers?: IconModifiers },\n  themePath?: string\n) {\n  const theme = useTheme() as Theme; // TODO: investigate why useTheme is typed like this\n  const resolvedValue = themePath && theme.value(themePath);\n  if (resolvedValue) {\n    return resolvedValue;\n  }\n  const { modifiers = {}, name } =\n    typeof iconDescriptor === \"string\"\n      ? { name: iconDescriptor }\n      : iconDescriptor;\n  return findIconPath(theme, name, modifiers);\n}\n\nexport const LafIcon = React.forwardRef(\n  (\n    { themePath, icon, size, ...props }: ThemeIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const resolvedIconPath = useIconPath(icon, themePath);\n\n    const ref = useForwardedRef(forwardedRef);\n    useSvgIcon({ path: `platform/platform-impl/src/${resolvedIconPath}` }, ref);\n    return <StyledIconWrapper {...props} ref={ref} size={size} />;\n  }\n);\n","import React, { ComponentProps } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"./Theme/Theme\";\n\ninterface Props extends ComponentProps<\"img\"> {\n  /**\n   * src for when a dark theme is active. if `darkSrc` doesn't have a non-empty string value, src will be used both\n   * for dark and light themes.\n   */\n  darkSrc?: string;\n}\n/**\n * Same as default `img`, but theme aware. Meaning that you can specify different sources for normal and dark mode.\n */\nexport const Img: React.FC<Props> = ({ darkSrc, ...props }) => {\n  const theme = useTheme() as Theme;\n  if (theme.dark) {\n    return <img {...props} src={darkSrc || props.src} />;\n  }\n  return <img {...props} />;\n};\n","import { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nconst getDefaultLinkColor = ({ theme }: { theme: Theme }) =>\n  theme.commonColors.linkForegroundEnabled;\n\nexport const StyledLink = styled.a`\n  cursor: pointer;\n  text-decoration: none;\n  outline: none;\n  // &:focus-visible didn't work as expected, so FocusRing is used\n  &.focus-visible {\n    outline: 1px solid\n      ${({ theme }) =>\n        theme.color(\n          \"Link.focusedBorderColor\" as UnknownThemeProp<\"Link.focusedBorderColor\">,\n          theme.commonColors.focusBorderColor\n        )};\n    border-radius: 2px; // Registry.intValue(\"ide.link.button.focus.round.arc\", 4)\n  }\n  color: ${getDefaultLinkColor};\n\n  &:hover,\n  &.hover /* for testing purposes*/ {\n    text-decoration: underline;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.hoverForeground\",\n        theme.color(\n          \"link.hover.foreground\" as UnknownThemeProp<\"link.hover.foreground\">,\n          \"\" /*FIXME: check*/\n        )\n      )};\n  }\n  &:active,\n  &.active {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.pressedForeground\",\n        theme.color(\n          \"link.pressed.foreground\" as UnknownThemeProp<\"link.pressed.foreground\">,\n          !theme.dark ? \"#F00000\" : \"#BA6F25\"\n        )\n      )};\n  }\n  &:disabled,\n  &.disabled {\n    cursor: default;\n    text-decoration: none;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.disabledForeground\" as UnknownThemeProp<\"Link.disabledForeground\">,\n        theme.color(\n          \"Label.disabledForeground\",\n          theme.color(\"Label.disabledText\", \"#999\")\n        )\n      )};\n  }\n  // We may need to refine this to allow passing visited as a prop for links that don't have href, and not apply the\n  // styles in that case, since it seems no href is considered visited by default. Although, in all main themes\n  // Link.visitedForeground is set to the default link color.\n  &:visited,\n  &.visited {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.visitedForeground\",\n        theme.color(\n          \"link.visited.foreground\" as UnknownThemeProp<\"link.visited.foreground\">,\n          !theme.dark ? \"#800080\" : \"#9776A9\"\n        )\n      )};\n  }\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { AriaLinkProps } from \"@react-types/link\";\nimport { useLink } from \"@react-aria/link\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { FocusRing } from \"@react-aria/focus\";\nimport { StyledLink } from \"@intellij-platform/core/Link/StyledLink\";\n\nexport type LinkProps = AriaLinkProps & {\n  isDisabled?: boolean;\n  className?: string;\n  children: React.ReactNode;\n};\n\n/**\n * A focusable span in style of [Link](https://jetbrains.github.io/ui/controls/link/) and with accessibility role of link.\n *\n * TODO and known issues:\n * - in the reference impl, Space presses the link, Enter doesn't. It's vice versa here, because of how usePress is implemented.\n * - Support for External links\n * - Support for Anchor elements?\n *\n * Unknowns:\n * - What are ActionLink and DefaultLinkButtonUI?\n * - What is HyperLinkLabel compared to LabelLink (which was looked into in implementation of this component)?\n */\nexport const Link = React.forwardRef(\n  (\n    props: LinkProps,\n    forwardedRef: ForwardedRef<HTMLAnchorElement>\n  ): React.ReactElement => {\n    const ref = useForwardedRef(forwardedRef);\n    const { linkProps, isPressed } = useLink(\n      { ...props, elementType: \"span\" },\n      ref\n    );\n    return (\n      <FocusRing focusRingClass=\"focus-visible\">\n        <StyledLink\n          {...linkProps}\n          as=\"span\"\n          ref={ref}\n          // maybe use clsx\n          className={`${props.isDisabled ? \"disabled\" : \"\"} ${\n            isPressed ? \"active\" : \"\"\n          } ${props.className || \"\"}`}\n        >\n          {props.children}\n        </StyledLink>\n      </FocusRing>\n    );\n  }\n);\n","import React from \"react\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { useSeparator } from \"@react-aria/separator\";\n\nexport const ListDivider: React.FC = () => {\n  return (\n    <StyledVerticalSeparator\n      as={\"li\"}\n      {...useSeparator({ orientation: \"vertical\" })}\n    />\n  );\n};\n","import { css } from \"styled-components\";\nimport { styled } from \"../styled\";\n\nexport const StyledList = styled.ul<{ fillAvailableSpace?: boolean }>`\n  padding: 0;\n  margin: 0;\n  list-style: none;\n  max-height: 100%;\n  overflow: auto;\n  color: ${({ theme }) => theme.color(\"*.textForeground\")};\n  outline: none;\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      height: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n    `}\n  background: ${({ theme }) => theme.color(\"List.background\")};\n`;\n","import { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"../styled\";\n\nexport type StyledListItemProps = {\n  containerFocused: boolean;\n  selected: boolean;\n  disabled: boolean;\n};\n\nexport const StyledListItem = styled.li<StyledListItemProps>(\n  ({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"List.foreground\" as UnknownThemeProp<\"List.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color =\n          theme.color(\n            \"List.selectionForeground\" as UnknownThemeProp<\"List.selectionForeground\">\n          ) ||\n          theme.commonColors\n            .labelSelectedForeground /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"List.selectionBackground\" as UnknownThemeProp<\"List.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"List.selectionInactiveForeground\" as UnknownThemeProp<\"List.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"List.selectionBackgroundInactive\" as UnknownThemeProp<\"List.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor,\n      color,\n      position: \"relative\",\n      display: \"flex\",\n      whiteSpace: \"nowrap\",\n      paddingLeft: 8, // themed?\n      lineHeight: \"20px\",\n      outline: \"none\",\n      cursor: \"default\",\n      minWidth: \"min-content\", // ?\n    };\n  }\n);\n","import React, { HTMLAttributes, HTMLProps } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { OverlayTriggerProps } from \"@react-types/overlays\";\n\nimport { useContextMenu } from \"./useContextMenu\";\nimport { MenuOverlay } from \"./MenuOverlay\";\n\ninterface ContextMenuContainerProps extends HTMLProps<HTMLDivElement> {\n  /**\n   * Will be called to return the Menu when context menu is triggered. Use {@link Menu} component to render a menu.\n   */\n  renderMenu: () => React.ReactNode;\n  /**\n   * If children is a function, context menu props is passed to it, to be passed to the underlying element.\n   * Otherwise, a div container will be rendered.\n   */\n  children:\n    | React.ReactNode\n    | ((props: HTMLAttributes<HTMLElement>) => React.ReactNode);\n}\n\n/**\n * A generic container for context menu. It's the same as a normal div, only with an additional `renderMenu` prop,\n * to be used to render context menu, when it's triggered.\n * Closes the menu when a menu action is triggered.\n */\nexport const ContextMenuContainer = ({\n  children,\n  renderMenu,\n  ...props\n}: ContextMenuContainerProps) => {\n  const state = useMenuTriggerState({} as OverlayTriggerProps);\n\n  const { overlayProps, containerProps, overlayRef } = useContextMenu(\n    {},\n    state\n  );\n  const allProps = mergeProps(props, containerProps);\n  return (\n    <>\n      {typeof children === \"function\" ? (\n        children(allProps)\n      ) : (\n        <div {...allProps}>{children}</div>\n      )}\n      <MenuOverlay\n        state={state}\n        overlayRef={overlayRef}\n        overlayProps={overlayProps}\n        restoreFocus\n      >\n        {renderMenu()}\n      </MenuOverlay>\n    </>\n  );\n};\n","import { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { UnknownThemeProp } from \"../Theme/Theme\";\n\nexport const MENU_VERTICAL_PADDING = 5;\nexport const MENU_BORDER_WIDTH = 1;\n\nexport const StyledMenu = styled.ul`\n  font-size: 0.87rem;\n  margin: 0;\n  padding: ${MENU_VERTICAL_PADDING}px 0;\n  outline: none;\n  list-style: none;\n  width: fit-content;\n  min-width: 100px;\n  // Border doesn't seem to be painted in the original impl. IdeaPopupMenuUI.isUnderPopup(c) seemed to return false\n  // in all cases. More info: https://github.com/JetBrains/intellij-community/blob/c5ece483811a3ab546fc3880225efb02cc8b94dd/platform/platform-impl/src/com/intellij/ide/ui/laf/darcula/ui/DarculaPopupMenuBorder.java#L24\n  /*  border: ${MENU_BORDER_WIDTH}px solid\n    ${({ theme }) =>\n    theme.color(\"Menu.borderColor\", !theme.dark ? \"#CDCDCD\" : \"#515151\")};*/\n  ${WINDOW_SHADOW};\n  background: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.background\" as UnknownThemeProp<\"PopupMenu.background\">\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.foreground\" as UnknownThemeProp<\"PopupMenu.foreground\">\n    )};\n\n  ${StyledVerticalSeparator} {\n    background-color: ${({ theme }) => theme.color(\"Menu.separatorColor\")};\n    height: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.height\") ?? 3}px`};\n    padding: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.stripeIndent\") ?? 1}px 0`};\n    margin: ${({ theme }) =>\n      `0 ${theme.value(\"PopupMenuSeparator.withToEdge\") ?? 1}px`};\n  }\n`;\n","import { css } from \"styled-components\";\nimport { styled } from \"../styled\";\nimport { UnknownThemeProp } from \"../Theme/Theme\";\n\nexport const StyledMenuItem = styled.li<{\n  isDisabled: boolean;\n  isActive: boolean;\n}>`\n  position: relative; // for being able to position arrow icon absolutely\n  outline: none;\n  cursor: default;\n  white-space: nowrap;\n  color: ${({ isActive, isDisabled, theme }) => {\n    if (isDisabled) {\n      return theme.color(\"MenuItem.disabledForeground\");\n    }\n    if (isActive) {\n      return theme.color(\n        \"MenuItem.selectionForeground\" as UnknownThemeProp<\"MenuItem.selectionForeground\">\n      );\n    }\n    return theme.color(\n      \"MenuItem.foreground\" as UnknownThemeProp<\"MenuItem.foreground\">\n    );\n  }};\n  ${({ isActive, theme }) =>\n    isActive &&\n    css`\n      background: ${theme.color(\n        \"MenuItem.selectionBackground\" as UnknownThemeProp<\"MenuItem.selectionBackground\">\n      )};\n      color: ${undefined};\n    `}\n  // would be nice to have a visual clue for focus visible state, but it's not like that in intellij platform\n  //border-left: 3px solid transparent;\n  //&:focus-visible {\n  //  border-left: 3px solid rgba(255, 255, 255, 0.1);\n  //}\n  padding: 0 20px 0 27px;\n  line-height: 1.5; // to make the item have the right height\n  display: flex;\n  align-items: center;\n`;\n","import React, { Key } from \"react\";\nimport { useHover, useKeyboard } from \"@react-aria/interactions\";\nimport { useMenuItem } from \"@react-aria/menu\";\nimport { OverlayContainer, useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { Item } from \"@react-stately/collections\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { Node } from \"@react-types/shared\";\nimport { FocusScope } from \"@intellij-platform/core/utils/FocusScope\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\n\nimport { LafIcon, PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\nimport { Menu } from \"./Menu\";\nimport { MENU_BORDER_WIDTH, MENU_VERTICAL_PADDING } from \"./StyledMenu\";\nimport { StyledMenuItem } from \"./StyledMenuItem\";\n\nexport interface MenuItemProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  onAction?: (key: Key) => void;\n  onSubmenuClose?: () => void;\n  expandOn?: \"hover\" | \"press\";\n}\n\nconst StyledNestedArrow = styled.span`\n  margin-right: -11px;\n  margin-left: 11px;\n  display: inline-flex; // to make it not take more height than the icon\n`;\n\nconst StyledSelectedMark = styled.span`\n  position: absolute;\n  left: 4px;\n  top: 50%;\n  transform: translateY(-50%);\n  display: inline-flex; // to make it not take more height than the icon\n`;\n\nconst StyledMenuItemText = styled.span`\n  flex: 1;\n`;\n\nconst StyledMenuItemPlatformIcon = styled(PlatformIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nconst StyledMenuItemLafIcon = styled(LafIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nexport function MenuItem<T>({\n  item,\n  state,\n  onAction,\n  expandOn,\n}: MenuItemProps<T>) {\n  // Get props for the menu item element\n  const ref = React.useRef<HTMLLIElement>(null);\n  const nestedMenuRef = React.useRef<HTMLDivElement>(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const isSelected = state.selectionManager.selectedKeys.has(item.key);\n  const isFocused = state.selectionManager.focusedKey === item.key;\n\n  const { menuItemProps } = useMenuItem(\n    {\n      key: item.key,\n      isDisabled,\n      onAction: !item.hasChildNodes ? onAction : undefined,\n    },\n    state,\n    ref\n  );\n\n  const maybeOpenSubmenu = () => {\n    // Not the best way to clear expandedKeys, but current implementation of tree state only allows toggling keys\n    state.expandedKeys.forEach((key) => {\n      state.toggleKey(key);\n    });\n    if (item.hasChildNodes) {\n      state.toggleKey(item.key);\n    }\n  };\n\n  const { hoverProps } = useHover({\n    isDisabled: isDisabled || expandOn !== \"hover\",\n    onHoverStart: () => {\n      maybeOpenSubmenu();\n    },\n  });\n\n  const { keyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if ([\"ArrowRight\", \"Enter\", \" \"].includes(e.key)) {\n        maybeOpenSubmenu();\n      } else {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  let { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: ref,\n    overlayRef: nestedMenuRef,\n    placement: \"right top\",\n    shouldFlip: true,\n    onClose: () => {\n      console.log(\"on close\");\n    },\n    offset: 0,\n    crossOffset: -(MENU_VERTICAL_PADDING + MENU_BORDER_WIDTH),\n    isOpen: isExpanded,\n  });\n\n  const { subMenuProps } = useSubmenu({\n    onClose: () => {\n      state.toggleKey(item.key);\n      // setting focus with selection manager didn't work. Perhaps because of patchy implementation of nested menus\n      ref.current?.focus();\n    },\n  });\n\n  return (\n    <>\n      <StyledMenuItem\n        {...mergeProps(menuItemProps, hoverProps, keyboardProps)}\n        isDisabled={isDisabled}\n        isActive={isFocused}\n        ref={ref}\n      >\n        {isSelected && (\n          <StyledSelectedMark>\n            <StyledMenuItemLafIcon\n              icon={{\n                name: \"checkmark\",\n                modifiers: { Selected: isFocused },\n              }}\n            />\n          </StyledSelectedMark>\n        )}\n        <ItemStateContext.Provider\n          value={{ isDisabled, isFocused, isSelected, node: item }}\n        >\n          {typeof item.rendered === \"string\" ? (\n            <StyledMenuItemText>{item.rendered}</StyledMenuItemText>\n          ) : (\n            item.rendered\n          )}\n        </ItemStateContext.Provider>\n        {item.hasChildNodes && (\n          <StyledNestedArrow>\n            <StyledMenuItemPlatformIcon icon=\"icons/ide/menuArrow\" />\n          </StyledNestedArrow>\n        )}\n      </StyledMenuItem>\n      {isExpanded && (\n        /**\n         * A note about using OverlayContainer and FocusScope here:\n         * If sub-menu is not rendered in a portal, useOverlayPosition doesn't work properly and the submenu may\n         * be rendered offscreen. Worse, it may introduce scroll in body (or some scrollable ancestor), which will\n         * trigger a scroll event which closes the menu if the menu is rendered in an overlay (like in MenuTrigger),\n         * which is almost always the case.\n         * So we need to render in a portal and that's done by OverlayContainer. We also need to render a FocusScope,\n         * because now that we are rendering in a portal, we are dom-wise outside the focus scope of the menu in\n         * MenuTrigger (or any other implementation that renders menu in an overlay with a focus scope), and therefore\n         * the autofocus behaviour for the nested menu doesn't work. That's because FocusScope works based on dom\n         * tree, not react tree. Although it's not clear why this problem persists while `contain` is not set on the\n         * FocusScope in MenuTrigger.\n         * So we need focus scope. Rendering a FocusScope here messes with the `restoreFocus` behaviour of the one\n         * in MenuTrigger, and that's why `forceRestoreFocus` is introduced in the locally implemented FocusScope.\n         * In a nutshell:\n         * Positioning -> need for OverlayContainer\n         * using OverlayContainer -> need for FocusScope\n         * FocusScope -> problem in focus restoration in MenuTrigger -> forceRestoreFocus as a patchy solution.\n         */\n        <OverlayContainer>\n          <FocusScope>\n            <div\n              ref={nestedMenuRef}\n              {...mergeProps(positionProps, subMenuProps)}\n            >\n              <Menu\n                aria-label={item[\"aria-label\"] || item.textValue}\n                items={item.childNodes}\n                disabledKeys={state.disabledKeys}\n                selectedKeys={state.selectionManager.selectedKeys}\n                onAction={onAction}\n                autoFocus\n              >\n                {(childItem) => {\n                  // FIXME: This is not complete and doesn't support section and divider\n                  return (\n                    <Item\n                      childItems={childItem.childNodes}\n                      hasChildItems={childItem.hasChildNodes}\n                      textValue={childItem.textValue}\n                    >\n                      {childItem.rendered}\n                    </Item>\n                  );\n                }}\n              </Menu>\n            </div>\n          </FocusScope>\n        </OverlayContainer>\n      )}\n    </>\n  );\n}\n\nconst useSubmenu = ({ onClose }: { onClose: () => void }) => {\n  const { keyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (e.key === \"ArrowLeft\" || e.key === \"Escape\") {\n        onClose();\n      } else if (![\"ArrowUp\", \"ArrowDown\"].includes(e.key)) {\n        e.continuePropagation();\n      }\n    },\n  });\n  return { subMenuProps: keyboardProps };\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, { Key } from \"react\";\nimport { useMenuSection } from \"@react-aria/menu\";\nimport { MenuItem } from \"@intellij-platform/core/Menu/MenuItem\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\n\nexport interface MenuSectionProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  onAction?: (key: Key) => void;\n  expandOn?: \"hover\" | \"press\";\n}\n\nconst StyledMenuHeading = styled.li`\n  cursor: default;\n  padding: 2px 0 2px 12px;\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.disabledForeground\"\n    )}; // TODO: make sure about it. It's probably not correct color\n`;\n\nconst StyledMenuSectionItemsContainer = styled.ul`\n  padding: 0;\n  margin: 0;\n`;\n\nexport const MenuSection = <T extends unknown>({\n  item,\n  state,\n  onAction,\n  expandOn,\n}: MenuSectionProps<T>): React.ReactElement => {\n  let { itemProps, headingProps, groupProps } = useMenuSection({\n    heading: item.rendered,\n    \"aria-label\": item[\"aria-label\"],\n  });\n\n  return (\n    <>\n      <li {...itemProps}>\n        {item.rendered && (\n          <StyledMenuHeading {...headingProps}>\n            {item.rendered}\n          </StyledMenuHeading>\n        )}\n        <StyledMenuSectionItemsContainer {...groupProps}>\n          {[...item.childNodes].map((node) => {\n            return (\n              <MenuItem\n                key={node.key}\n                item={node}\n                state={state}\n                onAction={onAction}\n                expandOn={expandOn}\n              />\n            );\n          })}\n        </StyledMenuSectionItemsContainer>\n      </li>\n    </>\n  );\n};\n","import React, { Key, useContext, useEffect } from \"react\";\nimport { useMenu } from \"@react-aria/menu\";\nimport { AriaMenuProps } from \"@react-types/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { ListDivider } from \"../List/ListDivider\"; // shared dependency between list and menu, that could be lifted up\nimport { useTreeState } from \"../Tree/useTreeState\"; // shared dependency between tree and menu, that could be lifted up\nimport { MenuItem } from \"./MenuItem\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { MenuSection } from \"./MenuSection\";\n\nexport interface MenuProps<T>\n  extends Omit<\n    AriaMenuProps<T>,\n    // selection is not properly supported for nested menus. Plus, it's not even that meaningful for a nested menu\n    // at least the way it's implemented now.\n    | \"onSelectionChange\"\n    | \"defaultSelectedKeys\"\n    | \"selectionMode\"\n    | \"disallowEmptySelection\"\n  > {\n  /**\n   * Indicates currently expanded menu item (controlled).\n   */\n  expandedKey?: Key;\n  /**\n   * Called when expanded menu item is changed by user interaction, which can be either hovering over the menu item\n   * if `expandOn` is \"focus\", or clicking on the menu item (when `expandOn` is \"press\").\n   */\n  onExpandedKeyChange?: (expandedKey: Key) => void;\n  defaultExpandedKey?: Key;\n  expandOn?: \"hover\" | \"press\"; // hover delay doesn't seem to be needed as an option\n}\n\n/**\n * Can be provided by the overlay where the menu is rendered in. If provided, menu will call the provided close function\n * on actions. Note that there is no `closeOnSelect` option as of now, on this context, since no use case seems to exist\n * for keeping the menu overlay open after a menu item is selected.\n * **Update**: there are use cases where the menu is not closed after an item is clicked. Most of the toggle-able\n * actions (the ones with a checkmark) seem to be like this.\n * TODO: Make \"close on selection\" more flexible. Some ideas:\n *  - instead of calling close, pass it to `onAction` handler. Then on each action, one would need to call close if\n *    needed.\n *  - Offer a `MenuItem` component to be used instead of generic `Item`, where it accepts `closeOnSelect` boolean, which\n *    is true by default.\n *  - pass a `keepOpen` function to `onAction`.\n *  - Allow signaling whether the menu should kept open, via the returned value of onAction. e.g. return false means keep open.\n *  Last two suggestions are based on the assumption that most of the menu items are not selectable.\n *  Note that MenuOverlayContext could be used directly in action handlers too, but baking it into the menu makes it\n *  much more convenient, which seems more important than breaking the nice separation between Menu and MenuTrigger.\n */\nexport const MenuOverlayContext = React.createContext({ close: () => {} });\n\n/**\n * UI for menus which are normally shown in a popover. Being rendered as an overlay is not handled here.\n * Also there is no coupling with any higher level entity like \"Action\", since this is just for the UI layer.\n * Something like ActionMenu which creates a menu out of a list of actions can be implemented on top of this.\n *\n * @example\n *  <Menu>\n *    <Item>Item one</Item>\n *    <Item>\n *      <MenuItemLayout\n *        icon={<PlatformIcon icon={\"actions/copy\"} />}\n *        content=\"Copy\"\n *        shortcut={\"⌘C\"} />\n *    </Item>\n *  </Menu>\n *\n *  Current issues and limitations:\n *  - Divider in sub-menu's is not supported. because of a constraint in @react-stately/collections, which results in\n *    this error: Unsupported type <Divider> in <Item>. Only <Item> is supported. Maybe supporting section would\n *    be a workaround for it.\n *  - when a parent menu item which has an open submenu is hovered, it gets focus.\n *\n *  TODO:\n *  - [Least important] pass aria props to icon, keyboard shortcut, and content part of menu item. Maybe a context\n *    can be provided for it from menu item, which also exposes state like selected.\n */\nexport function Menu<T extends object>({\n  expandOn = \"hover\",\n  ...props\n}: MenuProps<T>) {\n  const { close } = useContext(MenuOverlayContext);\n  const onAction: MenuProps<T>[\"onAction\"] = (...args) => {\n    close();\n    return props.onAction?.(...args);\n  };\n  if (expandOn === \"press\") {\n    // The only discovered use case so far is in \"Branches\" menu. Perhaps it's not even implemented as a Menu\n    // in Intellij Platform, but it seems it very well can be, by supporting expand on press.\n    throw new Error(\"expanding menu items only on press is not supported yet.\");\n  }\n  // Create state based on the incoming props\n  let state = useTreeState({\n    ...props,\n    expandedKeys: props.expandedKey ? [props.expandedKey] : undefined,\n    onExpandedChange: ([firstKey]) => props?.onExpandedKeyChange?.(firstKey),\n    defaultExpandedKeys: props.defaultExpandedKey\n      ? [props.defaultExpandedKey]\n      : undefined,\n  });\n\n  // Get props for the menu element\n  let ref = React.useRef<HTMLUListElement>(null);\n  let { menuProps } = useMenu(props, state, ref);\n\n  useEffect(() => {\n    if (props.autoFocus) {\n      setTimeout(() => {\n        // we need this hack until the nested menu is properly supported. That's because when the element is hovered\n        // it sets the focus key, which will move focus to that item.\n        ref.current?.focus();\n      });\n    }\n  }, [props.autoFocus]);\n  return (\n    <StyledMenu {...menuProps} ref={ref}>\n      {[...state.collection].map((item: Node<T>) => {\n        switch (item.type) {\n          case \"item\":\n            return (\n              <MenuItem\n                key={item.key}\n                item={item}\n                state={state}\n                expandOn={expandOn}\n                onAction={onAction}\n              />\n            );\n          case \"section\":\n            // Maybe something like \"Branches\" menu needs titled sections.\n            return (\n              <MenuSection\n                key={item.key}\n                item={item}\n                state={state}\n                expandOn={expandOn}\n                onAction={onAction}\n              />\n            );\n          case \"divider\":\n            return <ListDivider key={item.key} />;\n        }\n      })}\n    </StyledMenu>\n  );\n}\n","import React from \"react\";\nimport { ItemStateContext } from \"../Collections/ItemStateContext\";\nimport { styled } from \"../styled\";\nimport { UnknownThemeProp } from \"../Theme/Theme\";\nimport { useContextOrThrow } from \"../utils/useContextOrThrow\";\n\ninterface MenuItemLayoutProps {\n  icon?: React.ReactNode;\n  content: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\nconst StyledMenuItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  flex: 1; // to make sure it takes as much space as available in the menu item row, so that the suffix (shortcut) is pushed to the right\n`;\nconst Content = styled.span`\n  flex: 1;\n`;\n\nconst Icon = styled.span`\n  display: inline-flex; // prevents unwanted increased height\n  min-width: 16px;\n  margin-right: 5px;\n  margin-left: -21px;\n`;\n\nconst Shortcut = styled.kbd<{ selected: boolean }>`\n  font-family: system-ui, sans-serif;\n  margin-left: 30px;\n  margin-right: -0.625rem;\n  color: ${({ theme, selected }) =>\n    selected\n      ? theme.color(\n          \"MenuItem.selectionForeground\" as UnknownThemeProp<\"MenuItem.selectionForeground\">\n        )\n      : theme.color(\"MenuItem.acceleratorForeground\")};\n`;\n\nexport const MenuItemLayout = ({\n  content,\n  shortcut,\n  icon,\n}: MenuItemLayoutProps) => {\n  const { isFocused, isSelected } = useContextOrThrow(\n    ItemStateContext,\n    \"MenuItemLayout is meant to be rendered in Item component in Menus\"\n  );\n  return (\n    <StyledMenuItemLayout>\n      <Icon>{!isSelected && icon}</Icon>\n      <Content>{content}</Content>\n      {shortcut && <Shortcut selected={isFocused}>{shortcut}</Shortcut>}\n    </StyledMenuItemLayout>\n  );\n};\n","import React, { HTMLProps } from \"react\";\nimport { MenuTriggerState } from \"@react-stately/menu\";\nimport { OverlayContainer } from \"@react-aria/overlays\";\nimport { FocusScope } from \"@intellij-platform/core/utils/FocusScope\";\nimport { MenuOverlayContext } from \"@intellij-platform/core/Menu/Menu\";\n\n/**\n * Overlay container for menu. Extracted into a separate component, to be used by components like MenuTrigger or\n * ContextMenuContainer, that need to render a menu as an overlay.\n * @private\n */\nexport function MenuOverlay({\n  children,\n  restoreFocus,\n  overlayProps,\n  overlayRef,\n  state,\n}: {\n  children: React.ReactNode;\n  restoreFocus?: boolean;\n  overlayProps: HTMLProps<HTMLDivElement>;\n  overlayRef: React.Ref<HTMLDivElement>;\n  state: MenuTriggerState;\n}) {\n  if (!state.isOpen) {\n    return null;\n  }\n  return (\n    <OverlayContainer>\n      <FocusScope\n        restoreFocus={restoreFocus}\n        forceRestoreFocus={restoreFocus}\n        autoFocus\n      >\n        <MenuOverlayContext.Provider value={state}>\n          <div {...overlayProps} ref={overlayRef}>\n            {children}\n          </div>\n        </MenuOverlayContext.Provider>\n      </FocusScope>\n    </OverlayContainer>\n  );\n}\n","import React, { HTMLProps, RefObject } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { useMenuTrigger } from \"@react-aria/menu\";\nimport { useOverlay, useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { MenuTriggerProps as AriaMenuTriggerProps } from \"@react-types/menu\";\n\nimport { MenuOverlay } from \"./MenuOverlay\";\n\nexport interface MenuTriggerProps\n  extends Omit<AriaMenuTriggerProps, \"closeOnSelect\"> {\n  restoreFocus?: boolean;\n  children: (\n    props: HTMLProps<HTMLElement>,\n    ref: RefObject<any> // Using a generic didn't seem to work for some reason\n  ) => React.ReactNode;\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean;\n  renderMenu: (props: {\n    menuProps: React.HTMLAttributes<HTMLElement>;\n  }) => React.ReactNode;\n}\n\n// FIXME: Escape doesn't close the menu\n// FIXME: Focus is not restored if nested menu are opened. It may be solved by using useOverlay and closing submenu in click outside.\n// FIXME: use PressResponder and replace render prop children with a normal react dom children. Issues with current impl:\n//  disabled trigger doesn't work as expected. props passed to children fn is html props, which is limiting for button\n//  components that don't accept arbitrary dom props.\n/**\n * Makes its children a trigger for a menu, rendered via {@link MenuTriggerProps#renderMenu} prop.\n * Closes the menu when a menu action is triggered.\n */\nexport const MenuTrigger: React.FC<MenuTriggerProps> = ({\n  children,\n  renderMenu,\n  direction = \"bottom\",\n  align = \"start\",\n  shouldFlip = true,\n  restoreFocus = true,\n  preventFocusOnPress = true,\n  ...otherProps\n}) => {\n  const menuTriggerProps: AriaMenuTriggerProps = {\n    ...otherProps,\n    direction,\n    align,\n    shouldFlip,\n  };\n  const state = useMenuTriggerState(menuTriggerProps);\n  const triggerRef = React.useRef(null);\n  const overlayRef = React.useRef(null);\n  // FIXME: Menu props is not used, but it's just about labelBy and id. Only needed for accessibility, but it would\n  //  require a `renderMenu` prop, instead of `menu`.\n  const { menuTriggerProps: triggerProps, menuProps } = useMenuTrigger(\n    { type: \"menu\" },\n    state,\n    triggerRef\n  );\n  const { buttonProps } = useButton(\n    {\n      ...triggerProps,\n      // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n      preventFocusOnPress,\n    },\n    triggerRef\n  );\n  const { overlayProps } = useOverlay(\n    {\n      onClose: () => {\n        return state.close();\n      },\n      shouldCloseOnBlur: false,\n      isOpen: state.isOpen,\n      isKeyboardDismissDisabled: false,\n      isDismissable: true,\n      shouldCloseOnInteractOutside: (element) => {\n        // FIXME: this is kind of hacky and should be removed when nested menu is properly supported\n        return !element.matches(\"[role=menu] *\");\n      },\n    },\n    overlayRef\n  );\n\n  const { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: triggerRef,\n    overlayRef,\n    placement: getPlacement(direction, align),\n    shouldFlip,\n    offset: 0,\n    containerPadding: 0,\n    isOpen: state.isOpen,\n  });\n\n  return (\n    <>\n      {children(buttonProps, triggerRef)}\n      <MenuOverlay\n        overlayProps={mergeProps(overlayProps, positionProps)}\n        overlayRef={overlayRef}\n        state={state}\n        restoreFocus={restoreFocus}\n      >\n        {renderMenu({ menuProps })}\n      </MenuOverlay>\n    </>\n  );\n};\n\nfunction getPlacement(\n  direction: Required<AriaMenuTriggerProps>[\"direction\"],\n  align: Required<AriaMenuTriggerProps>[\"align\"]\n) {\n  switch (direction) {\n    case \"left\":\n    case \"right\":\n    case \"start\":\n    case \"end\":\n      return `${direction} ${align === \"end\" ? \"bottom\" : \"top\"}` as const;\n    case \"bottom\":\n    case \"top\":\n    default:\n      return `${direction} ${align}` as const;\n  }\n}\n","import React, { useRef } from \"react\";\nimport { MenuTriggerState } from \"@react-stately/menu\";\nimport { useOverlay } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMouseEventOverlayPosition } from \"@intellij-platform/core/utils/useMouseEventOverlayPosition\";\n\n/**\n * Functionality and accessibility of context menu.\n */\nexport const useContextMenu = (\n  { isDisabled = false }: { isDisabled?: boolean },\n  state: MenuTriggerState\n) => {\n  /**\n   * NOTE: not using useMenuTrigger because:\n   * - There is no option to have a trigger like this: \"right click + long press only by touch\" which seems to be the\n   *   reasonable trigger for context menu. If we want to use it just for long press, we could disable it if it's not\n   *   a touch device, but that would be suboptimal, since both touch and mouse can be available, and it should depend\n   *   not on availability of touch, but on the triggered event type. Plus, isDisabled is broken in v<3.5.0\n   * - It's not quite clear at the moment, if the aria attributes that useMenuTrigger sets would be applicable in case\n   *   of this context menu component too. the trigger is not the container. For example, if there is a list rendered\n   *   inside, the selected item would be the trigger. Maybe even this component, as a container for context menu\n   *   is not the best way to allow for context menu, when comes to a11y concerns. For now, we skip a11y props of the\n   *   trigger. A11y props of the menu itself (e.g. aria-label) would also be up to the usage of this component.\n   *\n   *   TODO: add support for long touch\n   */\n  const onContextMenu = (e: React.MouseEvent<HTMLElement>) => {\n    e.preventDefault();\n    // NOTE: we can't use offsetX/offsetY, because it would depend on the exact target that was clicked.\n    if (!state.isOpen) {\n      state.open(null);\n    }\n    updatePosition(e);\n  };\n\n  const overlayRef = useRef(null);\n\n  const {\n    overlayProps: positionProps,\n    updatePosition,\n  } = useMouseEventOverlayPosition({\n    overlayRef,\n    placement: \"bottom start\",\n    // shouldFlip should be false, but it doesn't work as expected. Overlay container is rendered within the view port\n    // but the menu overflows from the overlay container\n    shouldFlip: true,\n    offset: -8,\n    isOpen: state.isOpen,\n  });\n  const { overlayProps } = useOverlay(\n    {\n      onClose: () => {\n        return state.close();\n      },\n      shouldCloseOnBlur: false,\n      isOpen: state.isOpen,\n      isKeyboardDismissDisabled: false,\n      isDismissable: true,\n      shouldCloseOnInteractOutside: (element) => {\n        // FIXME: this is kind of hacky and should be removed when nested menu is properly supported\n        return !element.matches(\"[role=menu] *\");\n      },\n    },\n    overlayRef\n  );\n\n  const containerProps: React.HTMLAttributes<HTMLElement> = isDisabled\n    ? {}\n    : { onContextMenu };\n  return {\n    /**\n     * props to be applied on the container element which is supposed to have the context menu\n     */\n    containerProps,\n    /**\n     * The ref to be applied on the menu overlay wrapper. It's usually an input instead of an output in similar\n     * react-aria hooks, but it seemed unnecessary here.\n     */\n    overlayRef,\n    /**\n     * props to be applied on the menu overlay wrapper.\n     */\n    overlayProps: mergeProps(overlayProps, positionProps),\n  };\n};\n","import React, { HTMLAttributes } from \"react\";\nimport {\n  OverlayContainer,\n  useModal,\n  useOverlay,\n  usePreventScroll,\n} from \"@react-aria/overlays\";\nimport { FocusScope } from \"@react-aria/focus\";\nimport { useDialog } from \"@react-aria/dialog\";\nimport { AriaDialogProps } from \"@react-types/dialog\"; // temporary phantom dependency\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport {\n  Bounds,\n  useResizableMovableWindow,\n  WindowInteractionHandler,\n  WindowMoveHandle,\n  WindowResizeHandles,\n} from \"@intellij-platform/core/Window\";\n\nexport interface ModalWindowProps extends AriaDialogProps {\n  children: React.ReactNode;\n  title: React.ReactNode; // Maybe string here since it's a special case in the original impl, where title is OS-handled and can only be a string\n  /**\n   * An area at the bottom of the window which is not scrolled as opposed to `children`. Use {@link WindowLayout.Footer}\n   * for rendering the common layout of a window footer.\n   */\n  footer?: React.ReactNode;\n  onClose?: () => void;\n  /**\n   * @default \"all\"\n   */\n  interactions?: \"all\" | \"move\" | \"none\";\n  defaultBounds?: Bounds;\n  bounds?: Bounds;\n  onBoundsChange?: (bounds: Bounds) => void;\n  minWidth?: number;\n  minHeight?: number;\n  /**\n   * For performance reason, window bounds is kept in a local state during a resize or move interaction, and\n   * `onBoundsChange` is called once at the end of interaction. `interceptInteraction` gives a chance of rectifying\n   * bounds changes during an interaction to for example apply custom size/placement constraints.\n   */\n  interceptInteraction?: (\n    newBounds: Bounds,\n    interactionType: \"move\" | \"resize\"\n  ) => Bounds;\n}\n\nconst StyledWindowTitle = styled.h1`\n  margin: 0;\n  text-align: center;\n  font-size: 13px; // not rem! intentional\n  line-height: 20px;\n  cursor: default;\n  user-select: none;\n  padding: 0 8px;\n`;\n\nconst StyledWindowUnderlay = styled.div`\n  position: fixed;\n  z-index: 1000; // FIXME: z-index should not be hard-coded like this\n  inset: 0;\n`;\nconst StyledWindowContainer = styled.div`\n  position: absolute;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  border-radius: 8px;\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n  outline: 1px solid #555; // FIXME\n`;\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledWindowInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst StyledWindowContentWrapper = styled.div`\n  overflow: auto;\n  flex: 1;\n`;\n\nconst StyledWindowFooter = styled.div`\n  min-height: min-content;\n`;\n\nexport const ModalWindowInner = ({\n  interactions = \"all\",\n  footer,\n  ...props\n}: ModalWindowProps): React.ReactElement => {\n  const { title, children } = props;\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { overlayProps, underlayProps } = useOverlay(\n    {\n      isOpen: true, // maybe allow rendering closed window? :-?\n      onClose: props.onClose,\n      isDismissable: false,\n      isKeyboardDismissDisabled: false,\n      shouldCloseOnBlur: false,\n    },\n    ref\n  );\n  usePreventScroll();\n  const { modalProps } = useModal();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  const { bounds, windowInteractionHandlerProps } = useResizableMovableWindow(\n    props\n  );\n\n  const renderTitle = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledWindowTitle {...mergeProps(titleProps, otherProps)}>\n      {title || <>&nbsp;</>}\n    </StyledWindowTitle>\n  );\n\n  return (\n    <StyledWindowUnderlay {...underlayProps}>\n      <WindowInteractionHandler {...windowInteractionHandlerProps}>\n        <FocusScope contain restoreFocus autoFocus>\n          <StyledWindowContainer\n            {...mergeProps(overlayProps, dialogProps, modalProps)}\n            style={bounds}\n            ref={ref}\n          >\n            <StyledWindowInnerContainer>\n              {interactions !== \"none\" ? (\n                <WindowMoveHandle>\n                  {({ moveHandleProps }) => renderTitle(moveHandleProps)}\n                </WindowMoveHandle>\n              ) : (\n                renderTitle()\n              )}\n              <StyledWindowContentWrapper>\n                {children}\n              </StyledWindowContentWrapper>\n              {footer && <StyledWindowFooter>{footer}</StyledWindowFooter>}\n            </StyledWindowInnerContainer>\n            {interactions === \"all\" && (\n              <WindowResizeHandles\n                minWidth={props.minWidth}\n                minHeight={props.minHeight}\n              />\n            )}\n          </StyledWindowContainer>\n        </FocusScope>\n      </WindowInteractionHandler>\n    </StyledWindowUnderlay>\n  );\n};\n\n/**\n * A movable/resizable modal window. The window header which holds the title, can be used to drag the window around.\n * In the reference impl, modal windows are os-native, and contain os-level buttons for minimize/close/maximise, which\n * are not relevant here since they wouldn't be os-native windows. A close button is still relevant (and kind of\n * necessary) and will be added in next iterations.\n *\n * The content container doesn't come with any padding. Other related components should be used for common layouts in\n * modal windows.\n * Example use cases: Window for git operations such as push, update, revert, new branch, etc.\n *\n * ![img.png](https://user-images.githubusercontent.com/3150694/181095858-968c5c66-2ae7-4e40-84e3-e6df43cd4aa4.png)\n *\n * NOTE: The part regarding rendering WindowInteractionHandler, and rendering as a dialog with a focus scope, in an\n * overlay container could be extracted into a component which is then used to create custom resizable/movable overlay\n * dialogs, like \"Branches\", or \"Search Everywhere\".\n *\n * TODO: support sizing the window based on minimum/natural size the content requires.\n * TODO: show close button (maybe os-aware styles?)\n * TODO: imperative API for opening a stack of windows (it may be not needed)\n *\n */\nexport const ModalWindow = (props: ModalWindowProps) => (\n  <OverlayContainer>\n    <ModalWindowInner {...props} />\n  </OverlayContainer>\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\n\nconst StyledFooter = styled.div<{ hasBorder?: boolean }>`\n  padding: 0.625rem 0.875rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-top: 1px solid transparent;\n  border-color: ${({ hasBorder, theme }) =>\n    hasBorder && theme.commonColors.contrastBorder};\n`;\nconst StyledFooterSide = styled.div`\n  display: flex;\n  gap: 0.625rem;\n`;\n\n/**\n * Implements the common layout for window footer, to be used in {@link ModalWindowProps#footer}.\n * Footer has a left and a right side. There is a standard gap between the children of each side.\n */\nfunction Footer({\n  left,\n  right,\n  hasBorder,\n}: {\n  /**\n   * The content to go to the left side the footer. A help icon button is very common on the left side.\n   */\n  left?: React.ReactNode;\n  /**\n   * The content to go to the right side the footer. {@link Button}s are usually used inside the right content\n   */\n  right?: React.ReactNode;\n  /**\n   * Whether to show top border for footer or not\n   */\n  hasBorder?: boolean;\n}) {\n  return (\n    <StyledFooter hasBorder={hasBorder}>\n      <StyledFooterSide>{left}</StyledFooterSide>\n      <StyledFooterSide>{right}</StyledFooterSide>\n    </StyledFooter>\n  );\n}\n\nexport const WindowLayout = {\n  Footer,\n};\n","import React, {\n  CSSProperties,\n  HTMLAttributes,\n  Ref,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { keyframes } from \"styled-components\";\nimport { useProgressBar } from \"@react-aria/progress\";\nimport { AriaProgressBarProps } from \"@react-types/progress\";\nimport { PressProps, useHover } from \"@react-aria/interactions\";\nimport { useButton } from \"@react-aria/button\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\n\nexport interface ProgressBarProps extends Omit<AriaProgressBarProps, \"label\"> {\n  /**\n   * Process name, shown above or to the left of the progress bar. Placement is controlled by {@link namePosition}.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-name\n   */\n  name?: React.ReactNode;\n\n  /**\n   * Process name position with respect to the progress bar.\n   * If `namePosition` is \"side\", {@link name} is **not** automatically appended with a colon.\n   * @default \"top\"\n   */\n  namePosition?: \"side\" | \"top\";\n\n  /**\n   * Process details, placed bellow the progress bar, with a de-emphasized color.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-details\n   */\n  details?: React.ReactNode;\n\n  /**\n   * A second line of details. Not an officially documented feature, but it's supported in the reference impl.\n   */\n  secondaryDetails?: React.ReactNode;\n\n  /**\n   * Placed next to and aligned with the progress bar, used for\n   * [process control](https://jetbrains.github.io/ui/controls/progress_bar/#process-control) buttons.\n   */\n  button?: React.ReactNode;\n\n  /**\n   * Progress bar track width.\n   */\n  width?: CSSProperties[\"width\"];\n\n  /**\n   * Not supported in [the official specs](https://jetbrains.github.io/ui/controls/progress_bar/#25), but the progress\n   * bar in status bar has a denser spacing. It still won't be a pixel perfect match with the progress bar in the\n   * status bar.\n   */\n  dense?: boolean;\n\n  style?: HTMLAttributes<unknown>[\"style\"];\n  className?: HTMLAttributes<unknown>[\"className\"];\n}\n\ninterface ProgressBarContextObj {\n  setForcedDetails: (details: string | null) => void;\n  setTooltip: (tooltip: string | null) => void;\n}\n\n/**\n * @see https://jetbrains.github.io/ui/controls/progress_bar/\n * @see https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/platform-api/src/com/intellij/openapi/ui/panel/ProgressPanelBuilder.java\n *\n * Known issues:\n * There are a couple of UI issues because of the current layout (which can be improved probably):\n * - max-width of the label and details, it's not necessarily aligned with the the progressbar track, because they don't\n *   share the same container\n * - when label is on the side, details is aligned with the label, instead of the progressbar track.\n */\nexport const ProgressBar = ({\n  value = 0,\n  maxValue = 100,\n  minValue = 0,\n  name,\n  namePosition = \"top\",\n  details,\n  secondaryDetails,\n  button,\n  width,\n  dense,\n  className,\n  style,\n  ...props\n}: ProgressBarProps): React.ReactElement => {\n  const { progressBarProps, labelProps } = useProgressBar({\n    ...props,\n    label: name,\n    value,\n    maxValue,\n    minValue,\n  });\n  const percentage = (100 * (value / maxValue)).toFixed(0);\n  const [forcedDetails, setForcedDetails] = useState<null | string>(\"\");\n  const [tooltip, setTooltip] = useState<null | string>(\"\");\n\n  const contextValue: ProgressBarContextObj = useMemo(\n    () => ({\n      setForcedDetails,\n      setTooltip,\n    }),\n    []\n  );\n  const label = (\n    <StyledProgressBarLabel {...labelProps}>{name}</StyledProgressBarLabel>\n  );\n  const effectiveDetails = details ? tooltip || forcedDetails || details : null;\n  return (\n    <StyledProgressBarContainer style={style} className={className}>\n      {namePosition === \"top\" && label}\n      <StyledProgressBarLineContainer\n        dense={dense}\n        hasTopMargin={Boolean(name) && namePosition === \"top\"}\n        hasBottomMargin={Boolean(effectiveDetails)}\n      >\n        {namePosition === \"side\" && label}\n        <StyledProgressBarTrack\n          style={{ width }}\n          {...progressBarProps}\n          indeterminate={props.isIndeterminate}\n        >\n          {!props.isIndeterminate && (\n            <StyledProgressBarProgress style={{ width: `${percentage}%` }} />\n          )}\n        </StyledProgressBarTrack>\n        {props.showValueLabel && (\n          <span>{props.valueLabel ?? `${percentage}%`}</span>\n        )}\n        <ProgressBarContext.Provider value={contextValue}>\n          {button}\n        </ProgressBarContext.Provider>\n      </StyledProgressBarLineContainer>\n      <StyledProgressBarDetails>{effectiveDetails}</StyledProgressBarDetails>\n      <StyledProgressBarDetails>{secondaryDetails}</StyledProgressBarDetails>\n    </StyledProgressBarContainer>\n  );\n};\n\nconst ProgressBarContext = React.createContext<null | ProgressBarContextObj>(\n  null\n);\n\nconst StyledProgressBarContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.labelForeground /* TODO: check*/};\n  cursor: default; // prevent cursor on text\n`;\n\nconst StyledProgressBarLineContainer = styled.div<{\n  dense?: boolean;\n  hasTopMargin?: boolean;\n  hasBottomMargin?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  gap: ${({ dense }) => (dense ? \"0.5rem\" : \"0.625rem\")};\n  height: 4px;\n  // spacing is based on the reference impl and figma designs. top and bottom spacing is inverted in the spec document\n  // figma: https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-(Community)?node-id=75426%3A16650\n  // spec document: https://jetbrains.github.io/ui/controls/progress_bar/#25\n  margin-top: ${({ hasTopMargin }) => hasTopMargin && \"0.375rem\"};\n  margin-bottom: ${({ hasBottomMargin }) => hasBottomMargin && \"0.25rem\"};\n`;\n\nconst StyledProgressBarLabel = styled.div`\n  white-space: nowrap;\n  max-width: calc(100% - 2rem);\n  overflow: hidden;\n`;\n\nconst StyledProgressBarDetails = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n  font-size: 0.82em;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 2rem); // not the best way\n`;\n\nconst StyledProgressBarTrack = styled.div<{ indeterminate?: boolean }>`\n  height: inherit;\n  border-radius: 2px;\n  overflow: hidden;\n  display: flex;\n\n  // In case used in flex layout\n  min-width: 0;\n  flex: 1;\n\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.trackColor\",\n      theme.dark ? \"rgb(85,85,85)\" : \"rgb(196,196,196)\"\n    )};\n  ${({ indeterminate }) =>\n    indeterminate &&\n    css`\n      background: linear-gradient(\n        90deg,\n        ${getIndeterminateStartColor} 0%,\n        ${getIndeterminateEndColor} 50%,\n        ${getIndeterminateStartColor} 100%\n      );\n      background-size: 96px auto;\n      animation: 800ms ${indeterminateBackgroundAnimation} linear infinite;\n    `}\n`;\n\nconst getIndeterminateStartColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateStartColor\");\nconst getIndeterminateEndColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateEndColor\");\n\nconst indeterminateBackgroundAnimation = keyframes`\n  0% {\n    background-position: 0;\n  }\n  100% {\n    background-position: 96px;\n  }\n`;\n\nconst StyledProgressBarProgress = styled.div`\n  height: 100%;\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.progressColor\",\n      theme.dark ? \"rgb(160,160,160)\" : \"rgb(128,128,128)\"\n    )};\n`;\n\ntype ProgressBarIconButtonProps = Pick<PressProps, \"onPress\"> & {\n  hoverTooltip: string;\n};\n\n/**\n * Accessibility and functionality of progress bar icon buttons\n * @private maybe?\n */\nexport function useProgressBarIconButton(\n  { onPress, hoverTooltip }: ProgressBarIconButtonProps,\n  ref: Ref<HTMLElement>\n) {\n  const { buttonProps } = useButton(\n    {\n      onPress,\n      elementType: \"span\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: it works, but it's intentionally excluded from the type.\n      preventFocusOnPress: true,\n    },\n    ref\n  );\n  const context = useContext(ProgressBarContext);\n  const { hoverProps, isHovered } = useHover({});\n  useEffect(() => {\n    context?.setTooltip(isHovered ? hoverTooltip : null);\n  }, [hoverTooltip, isHovered]);\n  return {\n    buttonProps: mergeProps(buttonProps, hoverProps),\n  };\n}\n\n/**\n * @private maybe?\n * */\nexport function useProgressBarPauseIconButton(\n  { paused, ...props }: ProgressBarIconButtonProps & { paused: boolean },\n  ref: Ref<HTMLElement>\n) {\n  const context = useContext(ProgressBarContext);\n  useEffect(() => {\n    context?.setForcedDetails(paused ? \"Paused\" : null);\n  }, [paused]);\n  return useProgressBarIconButton(props, ref);\n}\n","import React, { useRef } from \"react\";\nimport { AutoHoverPlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { useProgressBarPauseIconButton } from \"./ProgressBar\";\n\ninterface ProgressBarPauseButtonProps {\n  /**\n   * Whether progress is paused.\n   */\n  paused: boolean;\n  /**\n   * Called when progress is paused or resumed.\n   * @param paused `true` when progress is being paused. `false` when resumed.\n   */\n  onPausedChange: (paused: boolean) => void | Promise<unknown>;\n\n  /**\n   * whether small icon should be used.\n   */\n  small?: boolean;\n}\n\n/**\n * Pause/Resume icon button for progress bar, to be used in {@link ProgressBarProps#button}.\n */\nexport const ProgressBarPauseButton = ({\n  paused,\n  onPausedChange,\n  small,\n}: ProgressBarPauseButtonProps) => {\n  const ref = useRef<HTMLSpanElement>(null);\n  const { buttonProps } = useProgressBarPauseIconButton(\n    {\n      onPress: () => onPausedChange(!paused),\n      hoverTooltip: paused ? \"Resume\" : \"Pause\",\n      paused,\n    },\n    ref\n  );\n  return (\n    <AutoHoverPlatformIcon\n      {...buttonProps}\n      icon={\n        paused\n          ? `process/progressResume${small ? \"Small\" : \"\"}.svg`\n          : `process/progressPause${small ? \"Small\" : \"\"}.svg`\n      }\n    />\n  );\n};\n","import React, { useRef } from \"react\";\nimport { AutoHoverPlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { useProgressBarIconButton } from \"./ProgressBar\";\n\ninterface ProgressBarCancelButtonProps {\n  /**\n   * whether small icon should be used.\n   */\n  small?: boolean;\n  onPress: () => void;\n}\n\n/**\n * Stop (cancel) icon button for progress bar, to be used in {@link ProgressBarProps#button}.\n */\nexport const ProgressBarStopButton = ({\n  small,\n  onPress,\n}: ProgressBarCancelButtonProps) => {\n  const ref = useRef<HTMLSpanElement>(null);\n  const { buttonProps } = useProgressBarIconButton(\n    { onPress, hoverTooltip: \"Cancel\" },\n    ref\n  );\n  return (\n    <AutoHoverPlatformIcon\n      ref={ref}\n      {...buttonProps}\n      icon={`process/stop${small ? \"Small\" : \"\"}.svg`}\n      hoverIcon={`process/stop${small ? \"Small\" : \"\"}Hovered.svg`}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n} from \"./ThreeViewSplitter/ThreeViewSplitter\";\n\ntype ResizableViewProps = Omit<\n  ThreeViewSplitterProps,\n  | \"innerView\"\n  | \"firstView\"\n  | \"firstSize\"\n  | \"onFirstResize\"\n  | \"lastView\"\n  | \"lastSize\"\n  | \"onLastResize\"\n> & {\n  children: React.ReactNode;\n  onResize: ThreeViewSplitterProps[\"onFirstResize\"];\n  size: ThreeViewSplitterProps[\"firstSize\"];\n  /**\n   * Whether the resizer should be placed at before or after the resizable view.\n   */\n  resizerPlacement?: \"before\" | \"after\";\n};\n/**\n * A single resizable view, built on top of {@link ThreeViewSplitter}, just to provide better prop interface.\n * Like `ThreeViewSplitter` it supports \"horizontal\" or \"vertical orientations. There is an extra `resizerPlacement`\n * prop which determines where the resizer should be placed in relation with the view. When set to \"before\" the view\n * will be resizable from the start (\"left\" or \"top\"). When set to \"after\" the view will be resizable from end (\"right\"\n * or \"bottom\"). Default is \"after\"\n */\nexport const ResizableView = ({\n  children,\n  size,\n  onResize,\n  resizerPlacement = \"after\",\n  ...props\n}: ResizableViewProps) => (\n  <ThreeViewSplitter\n    {...(resizerPlacement === \"after\"\n      ? { firstView: children, firstSize: size, onFirstResize: onResize }\n      : { lastView: children, lastSize: size, onLastResize: onResize })}\n    {...props}\n  />\n);\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useBottomResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will increase/decrease the height\n */\nexport const BottomResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useBottomResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype HorizontalResizerViewProps = ResizerViewProps<\"horizontal\">;\n\nconst StyledHorizontalResizer = styled.div`\n  top: 0;\n  height: 100%;\n  width: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledHorizontalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: HorizontalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  width: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  height: 100%;\n  left: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a horizontal layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const HorizontalResizer: React.FC<HorizontalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"col\",\n  children,\n  style = {},\n  resizerProps,\n}) => {\n  return (\n    <StyledHorizontalResizer\n      {...resizerProps}\n      style={{ ...style, background, width: size }}\n    >\n      {children}\n      <StyledHorizontalResizerArea handleSize={outerPadding} cursor={cursor} />\n    </StyledHorizontalResizer>\n  );\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useLeftResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the left side of the resizable view. i.e.\n * moving mouse to right/left will decrease/increase the width\n */\nexport const LeftResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useLeftResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useRightResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the right side of the resizable view. i.e.\n * moving mouse to right/left will increase/decrease the width\n */\nexport const RightResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useRightResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useTopResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will decrease/increase the height\n */\nexport const TopResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useTopResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype VerticalResizerViewProps = ResizerViewProps<\"vertical\">;\n\nconst StyledVerticalResizer = styled.div`\n  width: 100%;\n  height: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledVerticalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: VerticalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  height: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  width: 100%;\n  top: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a vertical layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const VerticalResizer: React.FC<VerticalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"row\",\n  resizerProps,\n  children,\n  style = {},\n}) => (\n  <StyledVerticalResizer\n    {...resizerProps}\n    style={{ ...style, background, height: size }}\n  >\n    {children}\n    <StyledVerticalResizerArea handleSize={outerPadding} cursor={cursor} />\n  </StyledVerticalResizer>\n);\n","import { useMove } from \"../utils/interaction-utils/useMove\";\nimport { ResizerProps } from \"./ResizerProps\";\n\ntype UseResizerProps = Pick<\n  ResizerProps,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n>;\n\nexport type ResizerViewProps<O = \"horizontal\" | \"vertical\"> = Omit<\n  ResizerProps<O>,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n> &\n  ReturnType<typeof useResizer>;\n\nconst useResizer = (\n  orientation: \"horizontal\" | \"vertical\",\n  invert: boolean,\n  { onResizeStarted, onResize, onResizeEnd }: UseResizerProps\n) => {\n  const props = useMove({\n    dragThreshold: 0,\n    onMoveStart: () => onResizeStarted() || 0,\n    onMoveEnd: () => onResizeEnd?.(),\n    onMove: ({ movement, startState }) =>\n      onResize(\n        startState +\n          (invert ? -1 : +1) *\n            movement[orientation === \"horizontal\" ? \"x\" : \"y\"]\n      ),\n  });\n  return {\n    resizerProps: props,\n  };\n};\n\nexport const useLeftResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", true, props);\n};\n\nexport const useRightResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", false, props);\n};\n\nexport const useTopResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", true, props);\n};\n\nexport const useBottomResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", false, props);\n};\n","import { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React from \"react\";\nimport { styled } from \"../styled\";\n\nexport interface SpeedSearchPopupProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 10px;\n  vertical-align: middle;\n`;\n\n/**\n * The little popup view shown at the top left corner of list, tree, etc., which shows the search\n * query.\n */\nexport const SpeedSearchPopup = React.forwardRef<\n  HTMLElement,\n  SpeedSearchPopupProps\n>(({ active, match, children }, ref) =>\n  active ? (\n    <StyledSpeedSearchPopup ref={ref} match={match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      {(children || \"\").replace(/ /g, \"\\u00A0\")}\n    </StyledSpeedSearchPopup>\n  ) : null\n);\n\nconst StyledSpeedSearchPopup = styled.span<{ match?: boolean }>`\n  // ref: https://github.com/JetBrains/intellij-community/blob/e3c7d96daba1d5d84d5650bde6c220aed225bfda/platform/platform-impl/src/com/intellij/ui/SpeedSearchBase.java#L53-L53\n  box-sizing: border-box;\n  position: absolute;\n  background: ${({ theme }) =>\n    theme.color(\n      \"SpeedSearch.background\",\n      theme.dark ? \"rgb(111,111,111)\" : \"#fff\"\n    )};\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"SpeedSearch.borderColor\",\n        theme.dark ? \"rgb(64, 64, 64)\" : \"rgb(192, 192, 192)\"\n      )};\n  color: ${({ match, theme }) =>\n    match\n      ? theme.color(\n          \"SpeedSearch.foreground\",\n          theme.commonColors.tooltipForeground\n        )\n      : theme.color(\"SpeedSearch.errorForeground\", theme.commonColors.red)};\n  z-index: 1;\n  padding: 3px 7px;\n  height: 25px;\n  line-height: 1.2;\n  transform: translateY(-100%);\n`;\n","import React, { useRef } from \"react\";\n\nfunction isTypeableElement(elem: HTMLElement): boolean {\n  const nonTypeableInputTypes: Array<HTMLInputElement[\"type\"]> = [\n    \"checkbox\",\n    \"radio\",\n    \"button\",\n  ];\n  return (\n    elem.isContentEditable ||\n    (elem instanceof HTMLInputElement &&\n      !nonTypeableInputTypes.includes(elem.type)) ||\n    elem instanceof HTMLTextAreaElement\n  );\n}\n\n/**\n * Main use case is for a list of item, which can have keyboard focus, be filterable and capture\n * typing if the corresponding keyboard events are not happening on an inner element (like an input)\n * that already handles typing.\n * @param value\n * @param onChange\n * TODO: add support for removing word by word by alt+backspace like native text fields.\n * TODO: add support for removing the whole content by command/ctrl+backspace.\n */\nexport function useGhostInput({\n  value,\n  onChange,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n}) {\n  const valueRef = useRef(value);\n  valueRef.current = value;\n  const onKeyDown = (event: React.KeyboardEvent | KeyboardEvent) => {\n    if (\n      !event.ctrlKey &&\n      !event.altKey &&\n      !event.metaKey &&\n      (!(event.target instanceof HTMLElement) ||\n        !isTypeableElement(event.target))\n    ) {\n      if (event.key.length === 1) {\n        // Seems reasonable to prevent default here generally, but the specific case this is added for is the space key,\n        // scrolling the page.\n        event.preventDefault();\n        return onChange(`${valueRef.current}${event.key}`);\n      }\n      if (event.key === \"Backspace\") {\n        const sliceEnd = event.metaKey ? 0 : -1;\n        onChange(valueRef.current.slice(0, sliceEnd));\n      }\n    }\n  };\n  return { onKeyDown } as const;\n}\n","import { useGhostInput } from \"./useGhostInput\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { ControlledStateProps } from \"../type-utils\";\n\nexport interface SpeedSearchState {\n  active: boolean;\n  setActive: (value: boolean) => void;\n  searchTerm: string;\n  setSearchTerm: (value: string) => void;\n}\n\nexport interface SpeedSearchStateProps\n  extends ControlledStateProps<{\n    searchTerm: string;\n    active: boolean;\n  }> {}\n\nexport function useSpeedSearchState(\n  props: SpeedSearchStateProps\n): SpeedSearchState {\n  const [active, setActive] = useControlledState(\n    props.active!,\n    props.active || false,\n    props.onActiveChange!\n  );\n  const [searchTerm, setSearchTerm] = useControlledState(\n    props.searchTerm!,\n    props.defaultSearchTerm || \"\",\n    props.onSearchTermChange!\n  );\n\n  return {\n    active: active,\n    searchTerm,\n    setActive,\n    setSearchTerm,\n  };\n}\n\nexport interface SpeedSearchProps {\n  stickySearch?: boolean;\n}\n\n/**\n * TODO: description\n * IMPORTANT: making the container element focusable is not a part of this hook. But it's a prerequisite for it to work.\n * Previously, a tabIndex:-1 was passed as a container prop, but it turns out it's not that simple. For collections for\n * example we usually want tab index to be 0 once it's not focused and then when an item is focused, we want it to be\n * -1, and such kind of logics are handled in their respective hooks. So, making the container focusable and how to do\n * it is NOT this hook's responsibility anymore.\n */\nexport function useSpeedSearch(\n  { stickySearch }: SpeedSearchProps,\n  { searchTerm, active, setActive, setSearchTerm }: SpeedSearchState\n) {\n  const { onKeyDown: ghostInputKeydown } = useGhostInput({\n    value: searchTerm,\n    onChange: (value) => {\n      const trimmedValue = value.trimStart();\n      setSearchTerm(trimmedValue);\n      if (!active && trimmedValue !== \"\") {\n        setActive(true);\n      }\n    },\n  });\n  const clear = () => {\n    setSearchTerm(\"\");\n    setActive(false);\n  };\n\n  const {\n    keyboardProps: { onKeyDown, onKeyUp },\n  } = useKeyboard({\n    onKeyDown: (e) => {\n      if (e.key === \"Escape\") {\n        if (searchTerm) {\n          clear();\n          return;\n        }\n      } else {\n        ghostInputKeydown(e);\n      }\n      e.continuePropagation();\n    },\n  });\n\n  const {\n    focusWithinProps: { onFocus, onBlur },\n  } = useFocusWithin({\n    onFocusWithinChange: (focused) => {\n      if (!focused && !stickySearch) {\n        clear();\n      }\n    },\n  });\n\n  return {\n    containerProps: {\n      onFocus,\n      onBlur,\n      onKeyDown,\n      onKeyUp,\n    },\n  };\n}\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface StatusBarProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n}\n\n/**\n * Status bar rendered at the bottom of the main window. In the reference implementation, there are three slots for\n * content: left, right and center. It doesn't seem center is really necessary, so only left and right are supported\n * for now.\n * @param left content on the left side of the status bar.\n * @param right content on the right side of the status bar. Typically, a bunch of {@link StatusBarWidget}s\n */\nexport const StatusBar = ({\n  left,\n  right,\n}: StatusBarProps): React.ReactElement => {\n  return (\n    <StyledStatusBar>\n      <StyledStatusBarLeft>{left}</StyledStatusBarLeft>\n      <StyledStatusBarRight>{right}</StyledStatusBarRight>\n    </StyledStatusBar>\n  );\n};\n\nconst StyledStatusBar = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.25rem;\n  display: flex;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between; // because there is left and right sides\n  background-color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.background\" as UnknownThemeProp<\"StatusBar.background\">,\n      theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)\n    ) || \"#fff\"};\n  color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.Widget.foreground\" as UnknownThemeProp<\"StatusBar.Widget.foreground\">,\n      theme.commonColors.labelForeground\n    )};\n  border-top: 1px solid\n    ${({ theme }) => theme.color(\"StatusBar.borderColor\", \"rgb(145, 145, 145)\")};\n  height: calc(1.25rem + 1px /* border*/);\n  line-height: 1.25rem;\n  font-size: 0.656rem; // not verified\n  cursor: default;\n`;\n\nconst StyledStatusBarSection = styled.div`\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n`;\n\nconst StyledStatusBarRight = styled(StyledStatusBarSection)`\n  flex-shrink: 0;\n`;\nconst StyledStatusBarLeft = styled(StyledStatusBarSection)`\n  flex-shrink: 1;\n  min-width: 0;\n  overflow: hidden;\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { PressProps, usePress } from \"@react-aria/interactions\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface StatusBarWidgetProps extends PressProps {\n  label?: React.ReactNode;\n  icon?: React.ReactNode;\n}\n\n/**\n * Status bar button (aka widget), with the right hover and pressed appearance.\n * It doesn't get focused when pressed, and is excluded from tab order.\n * Disabled style is not couldn't be found, so it's skipped at the moment.\n */\nexport const StatusBarWidget = React.forwardRef(function StatusBarWidget(\n  props: StatusBarWidgetProps,\n  ref: ForwardedRef<HTMLSpanElement>\n) {\n  // Maybe it's better for a11y to use useButton, or at least use button element?\n  const { pressProps, isPressed } = usePress({\n    ...props,\n    preventFocusOnPress: true,\n  });\n\n  const StyledWrapper = props.label\n    ? StyledStatusBarWidget\n    : StyledStatusBarIconWidget;\n  return (\n    <StyledWrapper\n      {...pressProps}\n      className={isPressed ? \"pressed\" : \"\"}\n      ref={ref}\n    >\n      {props.icon}\n      {props.icon && props.label && (\n        <>&nbsp;</> //not the nicest way to handle spacing!\n      )}\n      {props.label}\n    </StyledWrapper>\n  );\n});\n\nconst StyledStatusBarWidget = styled.span`\n  display: inline-flex;\n  align-items: center;\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.375rem\"};\n  height: 1.125rem;\n  white-space: nowrap;\n  &:hover {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverBackground\" as UnknownThemeProp<\"StatusBar.Widget.hoverBackground\">,\n        theme.color(\"ActionButton.hoverBackground\", \"#dfdfdf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverForeground\" as UnknownThemeProp<\"StatusBar.Widget.hoverForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n  &.pressed {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedBackground\" as UnknownThemeProp<\"StatusBar.Widget.pressedBackground\">,\n        theme.color(\"ActionButton.pressedBackground\", \"#cfcfcf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedForeground\" as UnknownThemeProp<\"StatusBar.Widget.pressedForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n`;\n\nconst StyledStatusBarIconWidget = styled(StyledStatusBarWidget)`\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.25rem\"};\n`;\n","import React from \"react\";\nimport { styled } from \"./styled\";\n\ntype SeparatorUI = {\n  STRIPE_INDENT: number;\n  STRIPE_WIDTH: number;\n};\n\n// based on implementation in com.intellij.ide.ui.laf.darcula.ui.DarculaSeparatorUI, which seems to be used for all themes\nconst DarculaSeparatorUI: SeparatorUI = {\n  STRIPE_INDENT: 1,\n  STRIPE_WIDTH: 1,\n};\n\nconst defaultSize =\n  2 * DarculaSeparatorUI.STRIPE_INDENT + DarculaSeparatorUI.STRIPE_WIDTH;\n\nconst StyledSeparator = styled.hr(({ theme }) => ({\n  backgroundColor: theme.color(\n    \"Separator.separatorColor\",\n    theme.dark ? \"#cdcdcd\" : \"#515151\"\n  ),\n  backgroundClip: \"content-box\",\n  boxSizing: \"border-box\",\n  margin: 0,\n  border: \"none\",\n  flexShrink: 0,\n}));\n\nexport const StyledHorizontalSeparator = styled(StyledSeparator)`\n  height: inherit; // should it be auto?\n  padding: 0 ${DarculaSeparatorUI.STRIPE_INDENT}px;\n  width: ${defaultSize}px;\n`;\nexport const StyledVerticalSeparator = styled(StyledSeparator)`\n  width: auto;\n  padding: ${DarculaSeparatorUI.STRIPE_INDENT}px 0;\n  height: ${defaultSize}px;\n`;\n","import React from \"react\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport {\n  TabContentLayout,\n  TabItemLayoutProps,\n} from \"@intellij-platform/core/Tabs/TabContentLayout\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { BareButton } from \"@intellij-platform/core/Button\";\n\ninterface EditorTabContentProps {\n  icon: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button, shown in place of \"pin\" button if not pinned. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <EditorTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^⇧F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactElement;\n  onUnpin?: () => void;\n  pinned?: boolean;\n  containerProps?: TabItemLayoutProps[\"containerProps\"];\n}\n/**\n * For rendering the content of Editor tabs. supports for file icon which is shown on the left and close or unpin\n * button shown on the right.\n */\nexport const EditorTabContent = ({\n  icon,\n  title,\n  closeButton,\n  onUnpin,\n  pinned,\n  containerProps,\n}: EditorTabContentProps) => {\n  return (\n    <TabContentLayout\n      startIcon={icon}\n      title={title}\n      containerProps={containerProps}\n      endIcon={\n        pinned ? (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Unpin Tab\" />}>\n            <BareButton onPress={onUnpin}>\n              <PlatformIcon icon=\"actions/pinTab\" />\n            </BareButton>\n          </TooltipTrigger>\n        ) : (\n          closeButton\n        )\n      }\n    />\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const editorTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"EditorTabs.borderColor\"),\n  underlineHeight: theme.value<number>(\"EditorTabs.underlineHeight\"),\n  background: theme.color(\"EditorTabs.background\"),\n  underlinedTabInactiveBackground: theme.color(\n    \"EditorTabs.underlinedTabBackground\" // that's correctly not underlinedTabInactiveBackground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabBackground: theme.color(\"EditorTabs.underlinedTabBackground\"), // TODO: use EditorColorsScheme when available\n  hoverInactiveBackground: theme.color(\n    \"EditorTabs.hoverInactiveBackground\" as UnknownThemeProp<\"EditorTabs.hoverInactiveBackground\">\n  ),\n  hoverBackground: theme.color(\"EditorTabs.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\"EditorTabs.inactiveUnderlineColor\"), // TODO: use EditorColorsScheme when available\n  underlineColor: theme.color(\"EditorTabs.underlineColor\"), // TODO: use EditorColorsScheme when available\n\n  underlinedTabInactiveForeground: theme.color(\n    \"EditorTabs.underlinedTabForeground\" // that's correctly not underlinedTabInactiveForeground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabForeground: theme.color(\"EditorTabs.underlinedTabForeground\"), // TODO: use EditorColorsScheme when available\n});\nexport const StyledEditorTab = styled(StyledDefaultTab)`\n  font-size: 0.7rem;\n  ${({ theme }) => getTabThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { editorTabTheme } from \"./StyledEditorTab\";\n\nexport const StyledEditorTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledEditorTab } from \"./StyledEditorTab\";\nimport { StyledEditorTabs } from \"./StyledEditorTabs\";\nimport React from \"react\";\n\nexport type EditorTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const EditorTabs = <T extends object>(props: EditorTabsProps<T>) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledEditorTab}\n    TabsComponent={StyledEditorTabs}\n    focusable={false}\n  />\n);\n","import { getTabThemeStyles } from \"./TabTheme\";\nimport { styled } from \"../styled\";\nimport { Theme, UnknownThemeProp } from \"../Theme\";\n\nexport type StyledTabProps = {\n  selected?: boolean;\n  disabled?: boolean;\n  active?: boolean;\n};\n\nconst defaultTabTheme = ({ theme }: { theme: Theme }) =>\n  getTabThemeStyles({\n    underlineHeight: theme.value<number>(\"DefaultTabs.underlineHeight\") ?? 3,\n    inactiveUnderlineColor: theme.color(\n      \"DefaultTabs.inactiveUnderlineColor\",\n      theme.dark ? \"#747a80\" : \"#9ca7b8\"\n    ),\n    underlineColor: theme.color(\n      \"DefaultTabs.underlineColor\",\n      theme.dark ? \"#4A88C7\" : \"#4083C9\"\n    ),\n\n    underlinedTabInactiveForeground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveForeground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveForeground\">\n    ),\n    underlinedTabForeground: theme.color(\"DefaultTabs.underlinedTabForeground\"),\n\n    background: theme.color(\n      \"DefaultTabs.background\",\n      theme.dark ? \"#3C3F41\" : \"#ECECEC\"\n    ),\n    underlinedTabInactiveBackground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveBackground\">\n    ),\n    underlinedTabBackground: theme.color(\n      \"DefaultTabs.underlinedTabBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabBackground\">\n    ),\n    hoverInactiveBackground: theme.color(\n      \"DefaultTabs.hoverInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.hoverInactiveBackground\">,\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n    hoverBackground: theme.color(\n      \"DefaultTabs.hoverBackground\",\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n  });\n\nexport const StyledDefaultTab = styled.div<StyledTabProps>`\n  box-sizing: border-box;\n  display: inline-flex;\n  letter-spacing: 0.015rem;\n  font-size: 0.85rem;\n  cursor: default;\n  white-space: nowrap;\n\n  // spacing\n  padding: 0 0.5rem;\n  line-height: 1.7rem; // vertical spacing handled by line-height\n\n  // disabled state doesn't seem to be supported in Intellij Platform at all.\n  opacity: ${({ disabled }) => (disabled ? \".5\" : \"1\")};\n  color: ${({ theme }) =>\n    theme.color(\n      \"DefaultTabs.foreground\" as UnknownThemeProp<\"DefaultTabs.foreground\">\n    )};\n\n  position: relative;\n  &::after {\n    content: \"\";\n    position: absolute;\n    width: 100%;\n    left: 0;\n    bottom: 0;\n  }\n\n  ${defaultTabTheme};\n`;\n","import { Theme } from \"../Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"./TabTheme\";\n\nconst defaultTabsTheme = ({ theme }: { theme: Theme }) =>\n  getTabsThemeStyles({\n    borderColor: theme.color(\n      \"DefaultTabs.borderColor\",\n      theme.commonColors.contrastBorder\n    ),\n    background: theme.color(\"DefaultTabs.background\"),\n  });\n\nexport const StyledDefaultTabs = styled.div<{ noBorders?: boolean }>`\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  border-style: solid;\n  border-width: ${({ noBorders }) => (noBorders ? \"0\" : \"1px 0\")};\n\n  ${defaultTabsTheme};\n`;\n","import React from \"react\";\nimport { BareButton, BareButtonProps } from \"@intellij-platform/core/Button\";\nimport { PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\n\nconst StyledIconWrapper = styled.span`\n  display: inherit;\n  .icon.hover {\n    display: none;\n  }\n  &:hover {\n    .icon {\n      display: none;\n    }\n    .icon.hover {\n      display: unset;\n    }\n  }\n`;\n/**\n * Close button for Tab\n */\nexport const TabCloseButton = (props: Omit<BareButtonProps, \"children\">) => {\n  // using useHover proved to be unstable.\n  return (\n    <BareButton {...props}>\n      <StyledIconWrapper>\n        <PlatformIcon icon={\"actions/closeHovered\"} className=\"icon hover\" />\n        <PlatformIcon icon={\"actions/close\"} className=\"icon\" />\n      </StyledIconWrapper>\n    </BareButton>\n  );\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { css, styled } from \"../styled\";\nimport { useFocusable } from \"@react-aria/focus\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\n\nconst StyledTabItemLayout = styled.div`\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst iconStyle = css`\n  display: inline-flex; // without this, the wrapper takes the full height, causing icon to be placed on top\n  margin-top: -0.1rem; // seems necessary for pixel perfect match with the original impl\n`;\n\nconst StyledStartIconWrapper = styled.span`\n  ${iconStyle};\n  margin-right: 0.25rem;\n`;\n\nconst StyledEndIconWrapper = styled.span`\n  ${iconStyle};\n  margin-left: 0.25rem;\n  margin-right: -0.25rem; // default padding of the tab should be a little reduced when close icon is there.\n  border-radius: 16px;\n`;\n\nexport interface TabItemLayoutProps {\n  /**\n   * the icon placed before the text.\n   */\n  startIcon?: React.ReactNode;\n  /**\n   * title of the tab. Normally just a string\n   */\n  title?: React.ReactNode;\n  /**\n   * the icon placed after the text. Typical use cases: close or pin icon.\n   */\n  endIcon?: React.ReactNode;\n\n  /**\n   * Generic HTML props passed to the container div.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n}\n\n/**\n * Helper component for rendering the common layout of tab content.\n */\nexport const TabContentLayout = React.forwardRef(\n  (\n    { startIcon, title, endIcon, containerProps = {} }: TabItemLayoutProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    // To allow tooltip be used easily. TooltipTrigger passes props via FocusableContext.\n    const { focusableProps } = useFocusable({}, useObjectRef(ref));\n    return (\n      <StyledTabItemLayout\n        {...mergeProps(focusableProps, containerProps)}\n        ref={ref}\n      >\n        {startIcon && (\n          <StyledStartIconWrapper>{startIcon}</StyledStartIconWrapper>\n        )}\n        {title}\n        {endIcon && <StyledEndIconWrapper>{endIcon}</StyledEndIconWrapper>}\n      </StyledTabItemLayout>\n    );\n  }\n);\n","import { ItemProps } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport React from \"react\";\n\nexport interface TabItemProps extends ItemProps<never> {\n  /**\n   * Determines how the tab item should look when rendered as a menu item in overflow menu.\n   * If not passed, `textValue` will be used.\n   * @example\n   * <TabItem\n   *   key={tab.id}\n   *   textValue={tab.title}\n   *   inOverflowMenu={\n   *     <MenuItemLayout content={tab.title} icon={icon} />\n   *   }\n   *  >\n   *   <TabContentLayout startIcon={icon} title={tab.title} />\n   * </TabItem>\n   */\n  inOverflowMenu?: React.ReactNode;\n}\n\n/**\n * Same as {@link Item}, but allows for specifying the tab content for when it's rendered in the overflow menu item.\n */\nexport const TabItem: (props: TabItemProps) => React.ReactElement = Item;\n","import { css } from \"@intellij-platform/core/styled\";\nimport { StyledTabProps } from \"./StyledDefaultTab\";\n\n/**\n * Describes theme-able properties of a tab, which can then be passed to {@link getTabThemeStyles}\n */\nexport interface TabTheme {\n  underlineHeight?: number;\n\n  borderColor?: string;\n\n  inactiveUnderlineColor?: string;\n  underlineColor?: string;\n\n  underlinedTabInactiveForeground?: string;\n  underlinedTabForeground?: string;\n\n  background?: string;\n  underlinedTabBackground?: string;\n  underlinedTabInactiveBackground?: string;\n  hoverInactiveBackground?: string;\n  hoverBackground?: string;\n  inactiveColoredTabBackground?: string; // not used for now\n}\n\nexport const getTabsThemeStyles = ({\n  background,\n  borderColor,\n}: Pick<TabTheme, \"background\" | \"borderColor\">) => css`\n  border-color: ${borderColor};\n  background: ${background};\n`;\n\n/**\n * Converts tab theme properties to a chunk of style that can be dropped in a styled version of StyledDefaultTab\n *\n * @example\n * ```ts\n * const StyledCustomTab = styled(StyledDefaultTab)`\n *   ${getTabThemeStyles({background: 'red'})}\n * `\n * ```\n */\nexport const getTabThemeStyles = ({\n  underlineHeight,\n\n  background,\n  underlinedTabBackground,\n  underlinedTabInactiveBackground,\n  hoverInactiveBackground,\n  hoverBackground,\n\n  underlinedTabForeground,\n  underlinedTabInactiveForeground,\n\n  inactiveUnderlineColor,\n  underlineColor,\n}: TabTheme) =>\n  css<StyledTabProps>`\n    // active indicator\n    &::after {\n      height: ${underlineHeight != null ? `${underlineHeight}px` : undefined};\n      background-color: ${({ selected }) => selected && inactiveUnderlineColor};\n      background-color: ${({ selected, active }) =>\n        selected && active && underlineColor};\n    }\n\n    // foreground rules\n    color: ${({ selected }) => selected && underlinedTabInactiveForeground};\n    color: ${({ selected, active }) =>\n      selected && active && underlinedTabForeground};\n\n    //  background rules\n    background: ${background};\n    background: ${({ selected }) =>\n      selected && underlinedTabInactiveBackground};\n    background: ${({ selected, active }) =>\n      selected && active && underlinedTabBackground};\n\n    ${({ disabled, active }) =>\n      !disabled &&\n      css`\n        &:hover,\n        &.hover /* for testing purposes */ {\n          background: ${hoverInactiveBackground};\n          background: ${active && hoverBackground};\n        }\n      `}\n  `;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\ninterface Props {\n  hasOverflowAtStart: boolean;\n  hasOverflowAtEnd: boolean;\n}\n\nconst horizontalOverflowIndicatorStyles = css`\n  content: \"\";\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 10px;\n  z-index: 1;\n`;\nexport const StyledHorizontalOverflowShadows = styled.div<Props>`\n  position: relative; // for overflow indicator (pseudo-)elements to be positioned absolute\n\n  /* FIXME: find out what color, width and gradient parameters are used in the original implementation */\n  ${({ hasOverflowAtStart }) =>\n    hasOverflowAtStart &&\n    css`\n      ::before {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        left: 0;\n      }\n    `};\n  ${({ hasOverflowAtEnd }) =>\n    hasOverflowAtEnd &&\n    css`\n      ::after {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          -90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        right: 0;\n      }\n    `};\n`;\n","import { useTab } from \"@react-aria/tabs\";\nimport { TabListState } from \"@react-stately/tabs\";\nimport { Node } from \"@react-types/shared\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport React, { useEffect } from \"react\";\n\ntype TabProps<T extends object> = {\n  state: TabListState<object>;\n  item: Node<T>;\n  intersectionObserver: IntersectionObserver | null;\n  /**\n   * {@see TabsProps#focusable}\n   */\n  focusable?: boolean;\n  /**\n   * {@see TabsProps#active}\n   */\n  active?: boolean;\n  Component?: typeof StyledDefaultTab;\n};\n\nexport const Tab = <T extends object>({\n  state,\n  item,\n  focusable,\n  active,\n  Component = StyledDefaultTab,\n  intersectionObserver,\n}: TabProps<T>): React.ReactElement => {\n  const { key, rendered } = item;\n  const ref = React.useRef(null);\n  const {\n    tabProps: {\n      /**\n       * by extracting out tabIndex, all keyboard support of the tabs is disabled, since we prevent the tab from being\n       * focusable.\n       */\n      tabIndex,\n      ...tabProps\n    },\n  } = useTab({ key }, state, ref);\n  const isSelected = state.selectedKey === key;\n  const isDisabled = state.disabledKeys.has(key);\n  useIntersectionObserver(ref, intersectionObserver);\n\n  return (\n    <Component\n      {...tabProps}\n      tabIndex={focusable ? tabIndex : undefined}\n      ref={ref}\n      active={active}\n      selected={isSelected}\n      disabled={isDisabled}\n    >\n      {rendered}\n    </Component>\n  );\n};\n\nfunction useIntersectionObserver(\n  ref: React.MutableRefObject<null>,\n  intersectionObserver: IntersectionObserver | null\n) {\n  useEffect(() => {\n    const element = ref.current;\n    if (element) {\n      intersectionObserver?.observe(element);\n      return () => {\n        intersectionObserver?.unobserve(element);\n      };\n    }\n  }, [intersectionObserver]);\n}\n","import React, { Key, useEffect } from \"react\";\nimport { useTabList } from \"@react-aria/tabs\";\nimport { filterDOMProps, mergeProps, scrollIntoView } from \"@react-aria/utils\";\nimport { useTabListState } from \"@react-stately/tabs\";\nimport { AriaTabListProps } from \"@react-types/tabs\";\nimport { StyledHorizontalOverflowShadows } from \"./StyledHorizontalOverflowShadows\";\nimport { TabsOverflowMenu } from \"./TabsOverflowMenu\";\nimport { useCollectionOverflowObserver } from \"./useCollectionOverflowObserver\";\nimport { useIsScrolled } from \"./useIsScrolled\";\nimport { styled, css } from \"@intellij-platform/core/styled\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport { StyledDefaultTabs } from \"./StyledDefaultTabs\";\nimport { Tab } from \"./Tab\";\n\nexport type TabsProps<T> = Omit<\n  AriaTabListProps<T>,\n  \"orientation\" | \"isDisabled\" | \"\"\n> & {\n  /**\n   * Whether tabs should be focusable or not. By default, following the Intellij Platform implementation, tabs are\n   * not focusable and therefore lack the keyboard accessibility support specified in WAI-ARIA.\n   * You can change this default behaviour and make the tabs keyboard accessible by passing `focusable`.\n   * focus styles are not perfect at the moment, since it's not considered an important feature.\n   * @default false\n   */\n  focusable?: boolean;\n\n  /**\n   * Enables \"active\" style on tabs. Is usually related to a container having focus.\n   */\n  active?: boolean;\n\n  /**\n   * If set to true, tabs will be wrapped into multiple rows if needed.\n   * NOTE: In the original implementation, in multi row mode, rows are separated by a border. It's not easy to achieve\n   * this when we are implementing this feature with a simple `flex-wrap: wrap` css rule. It doesn't seem that\n   * important, but we can achieve something similar by some css tricks like the ones suggested here:\n   * https://stackoverflow.com/questions/36128333/row-lines-for-flex-container-css\n   * @default false\n   */\n  multiRow?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * If set to true and multiRow is not true, it will prevent horizontal scroll of tabs. Depending on the value of\n   * In this case:\n   * - if {@link noOverflowMenu} is not set to true, tabs that can't be fitted into the available space will be\n   *   accessible via an overflow menu.\n   * - if {@link noOverflowMenu} is set to true, the tabs will be fitted into the available space, and they will\n   *   be shrunk when needed.\n   *\n   * @todo: not implemented yet.\n   * @default false\n   */\n  noScroll?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * When set to true, tabs that couldn't be fitted into the available space, are either shrunk (if {@link noScroll}\n   * is set to true), or are just accessible by scroll.\n   */\n  noOverflowMenu?: boolean;\n\n  /**\n   * Removes the top and bottom border when passed.\n   * It's still not clear whether such option makes sense or not, but\n   * at least in common use cases like in tool windows, it seems borders are already there and there should be a way\n   * of removing tab borders. On the other hand, when Tabs is used without any assumption about the surrounding UI,\n   * it kind of makes sense to have the top and bottom borders by default. So that's why this is made an option for\n   * now, maybe until things are clearer.\n   *\n   * @default false\n   */\n  noBorders?: boolean;\n\n  TabsComponent?: typeof StyledDefaultTabs;\n  /**\n   *\n   */\n  TabComponent?: typeof StyledDefaultTab;\n};\n\nconst scrollBarDisabledStyle = css`\n  -ms-overflow-style: none; /* for Internet Explorer, Edge */\n  scrollbar-width: none; /* for Firefox */\n  &::-webkit-scrollbar {\n    /* for Chrome/Safari/Webkit */\n    display: none;\n  }\n`;\n\nconst StyledTabList = styled.div<{ multiRow?: boolean }>`\n  display: flex;\n  flex-wrap: ${({ multiRow }) => (multiRow ? \"wrap\" : \"nowrap\")};\n  overflow: auto;\n\n  ${scrollBarDisabledStyle};\n`;\n\n/**\n *\n * TODO: add support for overflow:\n *  - have vertical scroll also scroll tabs\n *  - add support for re-reordering tabs.\n *  - FIX: When a tab that was not selected is removed, selection should not change. It now changes to the tab before the removed one.\n */\nexport const Tabs = <T extends object>({\n  focusable,\n  active,\n  TabComponent,\n  TabsComponent = StyledDefaultTabs,\n  multiRow,\n  noOverflowMenu,\n  noScroll,\n  noBorders,\n  ...props\n}: TabsProps<T>): React.ReactElement => {\n  const state = useTabListState(props);\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { tabListProps } = useTabList(props, state, ref);\n\n  const { scrolledIndicatorProps, isScrolled } = useIsScrolled({ ref });\n  const {\n    overflowedKeys,\n    intersectionObserver,\n  } = useCollectionOverflowObserver(ref);\n\n  useEffect(() => {\n    if (!noScroll) {\n      const scrollableContainer = ref.current;\n      const selectedTabElement = scrollableContainer?.querySelector(\n        `[data-key=\"${state.selectedKey}\"]`\n      ) as HTMLElement;\n      if (scrollableContainer && selectedTabElement) {\n        scrollIntoView(scrollableContainer, selectedTabElement);\n      }\n    } else {\n      // TODO maybe? sample use case: project tool window tabs, when not grouped.\n    }\n  }, [state.selectedKey]);\n  const onOverflowMenuItemSelected = (key: Key) => {\n    state.setSelectedKey(key);\n  };\n  if (noScroll) {\n    throw new Error(\"noScroll is not supported yet.\");\n  }\n  return (\n    <TabsComponent noBorders={noBorders} {...filterDOMProps(props)}>\n      <StyledHorizontalOverflowShadows\n        hasOverflowAtStart={isScrolled.left}\n        hasOverflowAtEnd={isScrolled.right}\n        style={{ minWidth: 0 }}\n      >\n        <StyledTabList\n          {...mergeProps(tabListProps, scrolledIndicatorProps)}\n          multiRow={multiRow}\n          ref={ref}\n        >\n          {[...state.collection].map((item) => (\n            <Tab\n              key={item.key}\n              item={item}\n              state={state}\n              focusable={focusable}\n              active={active}\n              Component={TabComponent}\n              intersectionObserver={intersectionObserver}\n            />\n          ))}\n        </StyledTabList>\n      </StyledHorizontalOverflowShadows>\n      {!noOverflowMenu && (\n        <TabsOverflowMenu\n          collection={state.collection}\n          overflowedKeys={overflowedKeys}\n          onSelect={onOverflowMenuItemSelected}\n        />\n      )}\n    </TabsComponent>\n  );\n};\n","import { RefObject, UIEventHandler, useEffect, useState } from \"react\";\n\nexport function useIsScrolled<T extends HTMLElement>({\n  threshold = 5,\n  ref,\n}: {\n  threshold?: number;\n  ref: RefObject<T>;\n}) {\n  const [isScrolled, setIsScrolled] = useState({\n    left: false,\n    right: false,\n    top: false,\n    bottom: false,\n  });\n\n  const update = () => {\n    const element = ref.current;\n    if (element) {\n      const offsetLeft = element.scrollLeft;\n      const offsetRight =\n        element.scrollWidth - (element.offsetWidth + element.scrollLeft);\n      const offsetTop = element.scrollTop;\n      const offsetBottom =\n        element.scrollHeight - (element.offsetHeight + element.scrollTop);\n      const newIsScrolled = {\n        top: offsetTop >= threshold,\n        bottom: offsetBottom >= threshold,\n        left: offsetLeft >= threshold,\n        right: offsetRight >= threshold,\n      };\n      if (\n        isScrolled.top !== isScrolled.top ||\n        isScrolled.bottom !== newIsScrolled.bottom ||\n        isScrolled.left !== newIsScrolled.left ||\n        isScrolled.right !== newIsScrolled.right\n      ) {\n        setIsScrolled(newIsScrolled);\n      }\n    }\n  };\n  useEffect(update);\n\n  return {\n    scrolledIndicatorProps: {\n      onScroll: update as UIEventHandler<T>,\n    },\n    isScrolled,\n  };\n}\n","import { Key, RefObject, useEffect, useState } from \"react\";\n\n/**\n * Given a ref to a scrollable container of collection items, returns the keys that are not completely visible and\n * are off view because of scroll. It relies on data-key property of observed elements.\n * @param scrollableItemsContainerRef\n * @param threshold\n */\nexport function useCollectionOverflowObserver(\n  scrollableItemsContainerRef: RefObject<HTMLElement>,\n  { threshold = 0.9 }: { threshold?: number } = {}\n) {\n  const [\n    intersectionObserver,\n    setIntersectionObserver,\n  ] = useState<IntersectionObserver | null>(null);\n  const [overflowedKeys, setOverflowedKeys] = useState<Set<Key>>(new Set());\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const newHiddenKeys = entries\n          .map((entry) =>\n            !entry.isIntersecting && entry.target instanceof HTMLElement\n              ? entry.target.dataset.key\n              : undefined\n          )\n          .filter<string>((val): val is string => Boolean(val));\n        const newVisibleKeys = entries\n          .map((entry) =>\n            entry.isIntersecting && entry.target instanceof HTMLElement\n              ? entry.target.dataset.key\n              : null\n          )\n          .filter<string>((val): val is string => Boolean(val));\n\n        setOverflowedKeys(\n          (currentOverflowMenuKeys) =>\n            new Set(\n              [...currentOverflowMenuKeys]\n                .filter((key) => !newVisibleKeys.includes(`${key}`))\n                .concat(newHiddenKeys)\n            )\n        );\n      },\n      {\n        root: scrollableItemsContainerRef.current,\n        rootMargin: \"0px\",\n        threshold,\n      }\n    );\n    setIntersectionObserver(observer);\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  return {\n    intersectionObserver,\n    overflowedKeys,\n  };\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { ActionButton } from \"@intellij-platform/core/ActionButton\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React, { Key } from \"react\";\n\nexport const TabsOverflowMenu = <T extends unknown>({\n  collection,\n  overflowedKeys,\n  onSelect,\n}: {\n  collection: Collection<Node<T>>;\n  overflowedKeys: Set<Key>;\n  onSelect: (key: Key) => void;\n}) => (\n  <>\n    {overflowedKeys.size > 0 && (\n      <MenuTrigger\n        align=\"end\"\n        renderMenu={({ menuProps }) => {\n          const items: Iterable<Node<unknown>> = [\n            ...collection,\n          ].filter((menuItem) => overflowedKeys.has(menuItem.key));\n          return (\n            <Menu\n              {...menuProps}\n              onAction={(key) => {\n                onSelect(key);\n              }}\n              items={items}\n            >\n              {(item) => (\n                <Item key={item.key} textValue={item.textValue}>\n                  {item.props.inOverflowMenu || item.textValue}\n                </Item>\n              )}\n            </Menu>\n          );\n        }}\n      >\n        {(props, ref) => (\n          <ActionButton {...props} ref={ref}>\n            <PlatformIcon icon=\"actions/findAndShowNextMatches\" />\n          </ActionButton>\n        )}\n      </MenuTrigger>\n    )}\n  </>\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const toolWindowTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"ToolWindow.HeaderTab.borderColor\"),\n  underlineHeight: theme.value<number>(\"ToolWindow.HeaderTab.underlineHeight\"),\n  background: \"transparent\",\n  underlinedTabInactiveBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabInactiveBackground\"\n  ),\n  underlinedTabBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabBackground\"\n  ),\n  hoverInactiveBackground:\n    theme.color(\"ToolWindow.HeaderTab.hoverInactiveBackground\") ??\n    theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  hoverBackground: theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\n    \"ToolWindow.HeaderTab.inactiveUnderlineColor\"\n  ),\n  underlineColor: theme.color(\"ToolWindow.HeaderTab.underlineColor\"),\n\n  underlinedTabInactiveForeground:\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabInactiveForeground\") ??\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabForeground\"),\n  underlinedTabForeground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabForeground\"\n  ),\n});\nexport const StyledToolWindowTab = styled(StyledDefaultTab)`\n  padding: 0 0.7rem;\n  ${({ theme }) => getTabThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { toolWindowTabTheme } from \"./StyledToolWindowTab\";\n\nexport const StyledToolWindowTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import React from \"react\";\nimport { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledToolWindowTab } from \"./StyledToolWindowTab\";\nimport { StyledToolWindowTabs } from \"./StyledToolWindowTabs\";\n\ntype ToolWindowTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const ToolWindowTabs = <T extends object>(\n  props: ToolWindowTabsProps<T>\n) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledToolWindowTab}\n    TabsComponent={StyledToolWindowTabs}\n    focusable={false}\n  />\n);\n","export type TextRange = { from: number; to: number };\n\nexport function isEmptyRange(range: TextRange) {\n  return range.from > range.to;\n}\n\nexport function getAllRanges(\n  ranges: TextRange[],\n  length: number\n): Array<[TextRange, boolean]> {\n  const result: Array<[TextRange, boolean]> = [];\n  if (!ranges?.length) {\n    return [[{ from: 0, to: length - 1 }, false]];\n  }\n  if (ranges[0].from > 0) {\n    result.push([{ from: 0, to: ranges[0].from - 1 }, false]);\n  }\n  ranges.forEach(({ from, to }, index) => {\n    result.push([{ from, to }, true]);\n    const gapRange: TextRange = ranges[index + 1]\n      ? { from: to + 1, to: ranges[index + 1].from - 1 }\n      : { from: to + 1, to: length - 1 };\n    if (!isEmptyRange(gapRange)) {\n      result.push([gapRange, false]);\n    }\n  });\n  return result;\n}\n\nexport function createRangesFromIndices(indices: number[]): TextRange[] {\n  return indices.reduce((ranges, index) => {\n    const lastRange = ranges.slice(-1)[0];\n    if (lastRange?.to === index - 1) {\n      return [...ranges.slice(0, -1), { from: lastRange.from, to: index }];\n    }\n    return [...ranges, { from: index, to: index }];\n  }, [] as TextRange[]);\n}\n","import React from \"react\";\nimport { getAllRanges, TextRange } from \"../TextRange\";\nimport { styled } from \"../styled\";\n\nconst HighlightedMatch = styled.span`\n  background: ${({ theme }) =>\n    `linear-gradient(${theme.color(\n      \"SearchMatch.startBackground\",\n      \"#ffeaa2b3\"\n    )}, ${theme.color(\"SearchMatch.endBackground\", \"#ffd042b3\")})`};\n  color: #000;\n  border-radius: 3px;\n`;\n\n/**\n * Renders the children (which must be a string), with highlights wrapped in spans with the highlight style.\n * Note: this component doesn't render a container. It just highlights the specified ranges.\n */\nexport function TextWithHighlights({\n  children,\n  highlights,\n}: {\n  children: string;\n  highlights: TextRange[] | null;\n}): React.ReactElement {\n  const parts: Array<[TextRange, boolean]> = highlights\n    ? getAllRanges(highlights, children.length)\n    : [[{ from: 0, to: children.length }, false]];\n  return (\n    <>\n      {parts.map(([{ from, to }, highlighted]) => {\n        const text = children.slice(from, to + 1);\n        return (\n          // TODO: key\n          <React.Fragment key={`${from}_${to}`}>\n            {highlighted ? <HighlightedMatch>{text}</HighlightedMatch> : text}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n","import React, { CSSProperties, useRef, useState } from \"react\";\nimport styled, { useTheme } from \"styled-components\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport { ResizerProps } from \"../Resizer/ResizerProps\";\nimport { Theme } from \"../Theme/Theme\";\n\n/**\n * Props are named mostly based on ThreeComponentsSplitter in Intellij Platform.\n */\nexport interface ThreeViewSplitterProps {\n  orientation?: \"horizontal\" | \"vertical\";\n  resizerProps?: Partial<\n    Omit<ResizerProps, \"onResize\" | \"onResizeStarted\" | \"onResizeEnd\">\n  >;\n  innerView?: React.ReactNode;\n  innerViewMinSize?: number;\n  firstView?: React.ReactNode;\n  firstSize?: number | null;\n  lastView?: React.ReactNode;\n  lastSize?: number | null;\n  onFirstResize?: (size: number) => void;\n  onLastResize?: (size: number) => void;\n  style?: CSSProperties;\n  className?: string;\n}\n\nconst StyledSplitterContainer = styled.div<{\n  orientation: \"horizontal\" | \"vertical\";\n}>`\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  flex-direction: ${({ orientation }) =>\n    orientation === \"vertical\" ? \"column\" : \"row\"};\n`;\n\nconst StyledSplitterInnerView = styled.div`\n  // The default overflow visible should be changed obviously. Not sure if there is any layout implication\n  // in using 'auto' instead of hidden, to provide scroll behaviour by default, but even if we realize later\n  // that we need to set overflow to hidden here, we can have scrollable content inside the inner view via an\n  // intermediate element inside the inner view, with overflow set to auto and width set to 100%.\n  overflow: auto;\n  flex: 1;\n`;\n/**\n * Corresponding to\n * [ThreeComponentsSplitter](https://github.com/JetBrains/intellij-community/blob/58dbd93e9ea527987466072fa0bfbf70864cd35f/platform/platform-api/src/com/intellij/openapi/ui/ThreeComponentsSplitter.java#L40-L40)\n * `firstView` and `lastView` are optional, and if not provided, the corresponding resizer is not rendered.\n * innerView is supposed to fill the remaining space, while firstView and lastView have specific sizes.\n * size changes in a resize interaction is not reported and is handled by local state in the component. That's\n * to prevent frequent state updates in a higher level which can be expensive. It's also based on this assumption\n * that in the usage side there is no need for any control over resizing or even knowing the intermediate state.\n * Maybe a minSize and maxSize would be the extent of the required control over resizing. But anyway, this model\n * of keeping the size as a local state during a resize session is something that can be changed if needed.\n *\n * Features:\n * - Relative sizing (fraction of the container)\n * - Default size by content\n * - Change handling only when resize is done.\n *\n * TODO: max and min size not implemented\n * TODO: add support for uncontrolled version\n */\nexport const ThreeViewSplitter: React.FC<ThreeViewSplitterProps> = ({\n  orientation = \"horizontal\",\n  firstView,\n  firstSize,\n  lastView,\n  lastSize,\n  onFirstResize,\n  onLastResize,\n  resizerProps: resizerPropsOverrides = {},\n  innerView,\n  innerViewMinSize,\n  ...containerProps\n}: ThreeViewSplitterProps): React.ReactElement => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const firstViewRef = useRef<HTMLDivElement>(null);\n  const lastViewRef = useRef<HTMLDivElement>(null);\n  const [firstSizeState, setFirstSizeState] = useState<number | null>(null);\n  const [lastSizeState, setLastSizeState] = useState<number | null>(null);\n  const theme = useTheme() as Theme;\n\n  const value = <T1, T2>(horizontalValue: T1, verticalValue: T2) =>\n    orientation === \"horizontal\" ? horizontalValue : verticalValue;\n\n  const FirstResizer: React.ComponentType<ResizerProps> = value(\n    RightResizer,\n    BottomResizer\n  );\n  const SecondResizer: React.ComponentType<ResizerProps> = value(\n    LeftResizer,\n    TopResizer\n  );\n  const sizeStyleProp = value(\"width\", \"height\");\n  const minSizeStyleProp = value(\"minWidth\", \"minHeight\");\n\n  const resizerProps: ThreeViewSplitterProps[\"resizerProps\"] = {\n    background: theme.commonColors.contrastBorder,\n    size: 1,\n    ...resizerPropsOverrides,\n  };\n\n  const isFractionSize = (size: number) => size < 1;\n\n  const normalizeSize = (\n    size: number | undefined | null\n  ): CSSProperties[\"width\" | \"height\"] =>\n    size != null\n      ? isFractionSize(size)\n        ? `${size * 100}%`\n        : Math.round(size)\n      : undefined;\n\n  const getSize = (elem: HTMLElement): number =>\n    value(elem.offsetWidth, elem.offsetHeight);\n\n  const getNewSize = (currentSize: number, newSize: number) => {\n    if (currentSize != null && isFractionSize(currentSize)) {\n      if (!containerRef.current) {\n        throw new Error(\n          \"ThreeViewSplitter: Could not locate container to calculate fraction size\"\n        );\n      }\n      const containerSize = value(\n        containerRef.current.offsetWidth,\n        containerRef.current.offsetHeight\n      );\n      const newFractionSize = newSize / containerSize;\n      return newFractionSize < 1 ? newFractionSize : currentSize;\n    } else {\n      return Math.max(newSize, 1);\n    }\n  };\n\n  const getActualSize = (viewElem: HTMLElement | null): number | null => {\n    if (!containerRef.current || !viewElem) {\n      return null;\n    }\n    const actualSize = getSize(viewElem);\n    if (viewElem.style[sizeStyleProp]?.includes(\"%\")) {\n      return actualSize / getSize(containerRef.current);\n    }\n    return actualSize;\n  };\n\n  const currentLastSize = normalizeSize(lastSizeState ?? lastSize);\n  const currentFirstSize = normalizeSize(firstSizeState ?? firstSize);\n  return (\n    <StyledSplitterContainer\n      ref={containerRef}\n      orientation={orientation}\n      {...containerProps}\n    >\n      {firstView && (\n        <>\n          <div\n            ref={firstViewRef}\n            style={{\n              [sizeStyleProp]: currentFirstSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                lastSizeState !== null ? currentFirstSize : undefined,\n            }}\n          >\n            {firstView}\n          </div>\n          <FirstResizer\n            onResizeStarted={() => {\n              const size = getSize(firstViewRef.current!);\n              setFirstSizeState(firstSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (firstSizeState != null) {\n                setFirstSizeState(getNewSize(firstSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(firstViewRef.current);\n              if (actualSize !== null) {\n                onFirstResize?.(actualSize);\n              }\n              setFirstSizeState(null);\n            }}\n            {...resizerProps}\n          />\n        </>\n      )}\n      {innerView && (\n        <StyledSplitterInnerView\n          style={{\n            [value(\"minWidth\", \"minHeight\")]: innerViewMinSize,\n          }}\n        >\n          {innerView}\n        </StyledSplitterInnerView>\n      )}\n      {lastView && (\n        <>\n          <SecondResizer\n            onResizeStarted={() => {\n              const size = getSize(lastViewRef.current!);\n              setLastSizeState(lastSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (lastSizeState != null) {\n                setLastSizeState(getNewSize(lastSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(lastViewRef.current);\n              if (actualSize !== null) {\n                onLastResize?.(actualSize);\n              }\n              setLastSizeState(null);\n            }}\n            {...resizerProps}\n          />\n          <div\n            ref={lastViewRef}\n            style={{\n              [sizeStyleProp]: currentLastSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                firstSizeState !== null ? currentLastSize : undefined,\n            }}\n          >\n            {lastView}\n          </div>\n        </>\n      )}\n    </StyledSplitterContainer>\n  );\n};\n","import { isMac } from \"@react-aria/utils\";\nimport React, { HTMLProps } from \"react\";\nimport { css } from \"styled-components\";\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { Theme } from \"../Theme/Theme\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\nimport {\n  useResizableMovableWindow,\n  WindowResizeHandles,\n  WindowInteractionHandler,\n} from \"@intellij-platform/core/Window\";\n\nconst StyledFloatView = styled.div`\n  position: absolute;\n  background: inherit;\n  // border color doesn't seem to be correct and needs more investigation. might be even os-specific and outside\n  // theme colors.\n  border: ${({ theme }) => `1px solid ${theme.color(\"Component.borderColor\")}`};\n  ${WINDOW_SHADOW};\n  ${isMac() &&\n  css<{ theme: Theme }>`\n    border-radius: 8px;\n  `}\n  z-index: 2;\n`;\n\n/**\n * Container for tool windows in float view mode. It handles some visual aspects like the border and shadow, as well as\n * UI interactions for changing the floatingBound of the tool window.\n */\nexport const FloatView: React.FC<\n  {\n    state: FloatWindowState;\n    onBoundsChange: (bounds: WindowBounds) => void;\n  } & Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">\n> = ({ children, state: { bounds }, onBoundsChange, ...otherProps }) => {\n  const {\n    bounds: effectiveBounds,\n    windowInteractionHandlerProps,\n  } = useResizableMovableWindow({\n    bounds,\n    onBoundsChange,\n  });\n\n  return (\n    <StyledFloatView\n      {...otherProps}\n      style={{ ...otherProps.style, ...effectiveBounds }}\n    >\n      <WindowInteractionHandler {...windowInteractionHandlerProps}>\n        <WindowResizeHandles />\n        {children}\n      </WindowInteractionHandler>\n    </StyledFloatView>\n  );\n};\n","import { move } from \"ramda\";\nimport React, { HTMLProps, Key, useState } from \"react\";\nimport { FloatView } from \"./FloatView\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\n\n// NOTE: useStackedLayersState and useStackedLayers are generic but kept here since there is no other use case at the\n// moment. They should be moved to their own file(s) when/if other use case came up.\n\ninterface StackedLayersState<T> {\n  /**\n   * Sorted list of items representing layers.\n   */\n  sorted: T[];\n  /**\n   * A function to be used when the layer should be brought to front, typically based on some UI interaction.\n   */\n  bringToFront: (index: number) => void;\n}\n\n/**\n * State management for a stacked list of layers with **bring to front** functionality.\n */\nfunction useStackedLayersState<T, K = React.Key>(\n  /**\n   * A list of arbitrary items representing stacked layers.\n   */\n  items: T[],\n  /**\n   * A function for converting each item into a key which consistently identifies each item, in subsequent renders.\n   * It's used to maintain current sorting state. Although it can be of any type, it's usually a string or number.\n   */\n  getKey: (item: T) => K\n): StackedLayersState<T> {\n  // Local state for now, but can easily change to controllable if needed.\n  const [sortedKeys, setSortedKeys] = useState<K[]>([]);\n  const sorted = items.sort(\n    (a, b) => sortedKeys.indexOf(getKey(a)) - sortedKeys.indexOf(getKey(b))\n  );\n  return {\n    sorted,\n    bringToFront: (index: number) => {\n      setSortedKeys(move(index, -1, sorted).map(getKey));\n    },\n  };\n}\n\n/**\n * Given the state of a stacked list of layers, returns DOM props to be applied to each layer for interaction-based\n * \"bring to front\" behaviour.\n */\nfunction useStackedLayers<T>(\n  state: StackedLayersState<T>\n): { layersProps: Array<HTMLProps<HTMLElement>> } {\n  return {\n    layersProps: state.sorted.map((_, index) => ({\n      onFocus: () => {\n        state.bringToFront(index);\n      },\n    })),\n  };\n}\n\n/**\n * Renders float tool windows.\n * - handles resize and move actions for float windows.\n * - handles layering of float tool windows.\n */\nexport function FloatToolWindows({\n  floatWindows = [],\n  onBoundsChange,\n  renderToolWindow,\n}: {\n  floatWindows: FloatWindowState[] | undefined;\n  onBoundsChange: (key: Key, bounds: WindowBounds) => void;\n  renderToolWindow: (key: Key) => React.ReactNode;\n}) {\n  const stackedFloatWindows = useStackedLayersState(\n    floatWindows,\n    ({ key }) => key\n  );\n  const { layersProps } = useStackedLayers(stackedFloatWindows);\n  // sorted list is used to render layers. We could as well use z-index and always render with the same order, but\n  // it doesn't really matter as long as key is set.\n  return (\n    <>\n      {stackedFloatWindows.sorted.map((toolWindow, index) => (\n        <FloatView\n          key={toolWindow.key}\n          state={toolWindow}\n          {...layersProps[index]}\n          onBoundsChange={(bounds) => onBoundsChange(toolWindow.key, bounds)}\n        >\n          {renderToolWindow(toolWindow.key)}\n        </FloatView>\n      ))}\n    </>\n  );\n}\n","import React, {\n  Key,\n  MutableRefObject,\n  RefObject,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"../utils/useLatest\";\nimport { DropPosition } from \"./createGetDropPosition\";\nimport { UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor } from \"./utils\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\ntype StripeLocation<T extends unknown> = {\n  index: number;\n  anchor: Anchor;\n  isSplit: boolean;\n};\ntype MovableStripeProps<T> = {\n  stripeElRef: React.RefObject<HTMLElement>;\n  getKey: (item: T) => Key;\n  anchor: Anchor;\n  mainItems: T[];\n  splitItems: T[];\n  createGetDropPosition: (\n    key: Key\n  ) => (draggedRect: Rect) => DropPosition | null;\n};\n\ntype MovableToolWindowStripeContextType<T> = {\n  addStripe: <T>(\n    id: string,\n    propsRef: MutableRefObject<MovableStripeProps<T>>\n  ) => () => void;\n  startMove: (id: string, args: { from: Rect; key: Key }) => void;\n  move: (args: { to: Rect }) => void;\n  endMove: () => void;\n  dropPosition: null | { id: string; dropPosition: DropPosition };\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n};\n\nexport type MovableToolWindowStripeProviderProps<T = unknown> = {\n  children: React.ReactNode;\n  onMove: (args: { from: StripeLocation<T>; to: StripeLocation<T> }) => void;\n};\n\nconst MovableToolWindowStripeContext = React.createContext<MovableToolWindowStripeContextType<any> | null>(\n  null\n);\n\n/**\n * A wrapper component to render around `ToolWindowStripe`s to make their button movable. Stripe buttons then become\n * draggable and can be moved either within the same `ToolWindowStripe` or across different ones.\n * @param onMove: called when a stripe button is moved from one anchor to another.\n * @param children: child element tree, containing one or more ToolWindowStripe elements. No need to be direct children.\n */\nexport const MovableToolWindowStripeProvider = <T extends unknown>({\n  onMove,\n  children,\n}: MovableToolWindowStripeProviderProps<T>) => {\n  const stripes = useRef<{\n    [id: string]: RefObject<MovableStripeProps<T>>;\n  }>({});\n  const [draggingRect, setDraggingRect] = useState<Rect | null>(null);\n  const [draggingKey, setDraggingKey] = useState<Key | null>(null);\n  const [dropPosition, setDropPosition] = useState<{\n    id: string;\n    dropPosition: DropPosition;\n  } | null>(null);\n  const getDropPositionRef = useRef<\n    (\n      to: Rect\n    ) => {\n      id: string;\n      dropPosition: DropPosition;\n    } | null\n  >(() => null);\n  const moveStartLocationRef = useRef<null | {\n    id: string;\n    index: number;\n    anchor: Anchor;\n    isSplit: boolean;\n  }>(null);\n\n  const contextValue = useMemo(\n    (): MovableToolWindowStripeContextType<T> => ({\n      addStripe: (id, propsRef) => {\n        if (stripes.current[id]) {\n          console.error(`multiple stripes with the same id \"${id}`);\n        }\n        // @ts-expect-error\n        stripes.current[id] = propsRef;\n        return () => {\n          delete stripes.current[id];\n        };\n      },\n      startMove: (id, { from, key }) => {\n        const stripe = stripes.current[id]?.current;\n        if (!stripe) {\n          return;\n        }\n        const { stripeElRef } = stripe;\n        const stripeElement = stripeElRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n\n        // Running the following two state setters immediately affect the layout\n        // in a way that is necessary for drop position calculation, so the order\n        // is important\n        setDraggingRect(getItemRect(key).toJSON());\n        setDraggingKey(key);\n\n        const indexInMain = stripe.mainItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        const indexInSplit = stripe.splitItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        moveStartLocationRef.current = {\n          id,\n          anchor: stripe.anchor,\n          index: indexInMain > -1 ? indexInMain : indexInSplit,\n          isSplit: indexInSplit > -1,\n        };\n\n        const dropPositionGetters = Object.entries(stripes.current).map(\n          ([id, stripe]) =>\n            [id, stripe.current!.createGetDropPosition(key)] as const\n        );\n        const getDropPosition = (draggedRect: Rect) => {\n          for (const [id, getDropPosition] of dropPositionGetters) {\n            const dropPosition = getDropPosition(draggedRect);\n            if (dropPosition) {\n              return {\n                id,\n                dropPosition,\n              };\n            }\n          }\n          return null;\n        };\n\n        setDropPosition(getDropPosition(from));\n\n        getDropPositionRef.current = getDropPosition;\n      },\n      move: ({ to }) => {\n        setDropPosition(getDropPositionRef.current(to));\n      },\n      endMove: () => {\n        if (dropPosition && draggingKey) {\n          onMove({\n            from: moveStartLocationRef.current!,\n            to: {\n              anchor: dropPosition.id as Anchor /*FIXME*/,\n              index: dropPosition.dropPosition.index,\n              isSplit: dropPosition.dropPosition.split,\n            },\n          });\n        }\n        setDraggingKey(null);\n        setDropPosition(null);\n        setDraggingRect(null);\n      },\n      dropPosition,\n      draggingRect,\n      draggingKey,\n    }),\n    [dropPosition, draggingKey, draggingRect]\n  );\n\n  return (\n    <MovableToolWindowStripeContext.Provider value={contextValue}>\n      {children}\n    </MovableToolWindowStripeContext.Provider>\n  );\n};\n\nexport function useMovableStripeButtons<T>(props: MovableStripeProps<T>) {\n  // Seems reasonable to assume anchor is unique. Also current onMove signature is coupled with anchor, not a more generic id.\n  const id = props.anchor;\n  const context = useContext(MovableToolWindowStripeContext);\n  const latestPropsRef = useLatest(props);\n  useEffect(() => {\n    if (context) {\n      return context.addStripe(id, latestPropsRef);\n    }\n  }, [context, id]);\n\n  const getProps = (\n    key: Key\n  ): Pick<\n    Required<UseElementMoveOptions<unknown>>,\n    \"onMoveStart\" | \"onMove\" | \"onMoveEnd\"\n  > & { moveDisabled: boolean } => ({\n    moveDisabled: !context,\n    onMoveStart: ({ from }) => {\n      context?.startMove?.(id, { from, key });\n    },\n    onMove: ({ to }) => {\n      context?.move({ to });\n    },\n    onMoveEnd: () => {\n      context?.endMove();\n    },\n  });\n  return {\n    getProps,\n    draggingRect: context?.draggingRect ?? null,\n    dropPosition:\n      context?.dropPosition?.id === id\n        ? context?.dropPosition.dropPosition\n        : null,\n    draggingKey: context?.draggingKey ?? null,\n  };\n}\n","import { styled } from \"../styled\";\nimport { css } from \"styled-components\";\n\nconst TopStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: ts;\n`;\nconst BottomStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: bs;\n`;\nconst LeftStripe = styled.div`\n  grid-area: ls;\n`;\nconst RightStripe = styled.div`\n  grid-area: rs;\n`;\nconst InnerView = styled.div`\n  grid-area: main;\n  min-height: 0; // necessary to prevent overflow;\n  position: relative; // necessary for undock views which are absolute positioned\n  background: inherit;\n  min-width: 0; // very important for layout. If not set, resizing tool windows can cause weird scrollbar inside tool windows pane.\n`;\n\n/**\n * The container which renders top,bottom,left and right stripes with a centered content.\n * responsible only for the layout of the stripes and the centered content. layout doesn't\n * include the opened tool windows on different sides and is just about the stripes around\n * the center area.\n * It also supports toggling stripes visibility.\n */\nconst Shell = styled.div<{ hideStripes: boolean }>`\n  display: grid;\n  grid-template-columns: min-content auto min-content;\n  grid-template-rows: min-content auto min-content;\n  grid-template-areas:\n    \".   ts   .\"\n    \"ls main rs\"\n    \".   bs   .\";\n\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${({ hideStripes }) =>\n    hideStripes &&\n    css`\n      ${TopStripe},\n      ${BottomStripe}, \n      ${LeftStripe}, \n      ${RightStripe} {\n        display: none;\n      }\n    `}\n`;\n\nexport const StyledToolWindowOuterLayout = {\n  Shell,\n  TopStripe,\n  BottomStripe,\n  LeftStripe,\n  RightStripe,\n  InnerView,\n};\n","import { compose, filter, groupBy, map, pipe, prop, sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\nimport {\n  ToolWindowsState,\n  ToolWindowState,\n  ViewMode,\n} from \"./ToolWindowsState\";\n\ntype ToolWindowStateWithKey = { key: Key } & ToolWindowState;\n\nexport interface StripesState {\n  main: Key[];\n  split: Key[];\n  activeKeys: Key[];\n}\n\n/**\n * Represents UI state of the split view (aka secondary or side view) within a docked view at one of the four sides.\n */\ntype SideDockedSplitState = {\n  key: Key;\n  /**\n   * relative size of the split view inside a docked view. Note that this is intentionally a fraction size (0≤size<1),\n   * based on the expected behaviour. split views inside a docked view are not fixed sized and resizing the window\n   * affect their size. This is not the case for the docked views themselves inside the main layout, which have fixed\n   * size which is not affected by window resizing.\n   */\n  sizeFraction: number;\n};\n\n// A potential improvement for this and similar nullable types like SideDockedState.split might be to avoid null type\n// and have it like { open: false} | {open: true, ...relevantProps}\n// Not sure if it's really preferred in terms of usage in the react component.\nexport type SideDockedState = null | {\n  size: number;\n  mainKey: Key;\n  split: SideDockedSplitState | null;\n};\n\nexport type SideUnDockedState = null | {\n  size: number;\n  key: Key;\n};\n\nexport interface SideState {\n  docked: SideDockedState;\n  undocked: SideUnDockedState;\n  stripes: StripesState;\n}\n\nexport interface FloatWindowState {\n  key: Key;\n  bounds: Exclude<ToolWindowState[\"floatingBounds\"], undefined>;\n}\n\n/**\n * Derived from ToolWindowsState, it represents the same information in a away that is suitable for ToolWindows\n * component to render the layout.\n */\nexport interface ToolWindowsLayoutState {\n  left: SideState;\n  top: SideState;\n  right: SideState;\n  bottom: SideState;\n  floatWindows: Array<FloatWindowState>;\n  windows: Array<FloatWindowState>;\n}\n\ninterface ContainerSize {\n  width: number;\n  height: number;\n}\n\nconst getSizeInAnchor = (containerSize: ContainerSize, anchor: Anchor) =>\n  containerSize[isHorizontalToolWindow(anchor) ? \"height\" : \"width\"];\n\nconst mapToKey = map<ToolWindowStateWithKey, Key>(prop(\"key\"));\nconst sortAndMapToKey = compose(\n  mapToKey,\n  sortBy(({ order }: ToolWindowStateWithKey) => order)\n);\nconst filterMains = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => !isSplit\n);\nconst getMains = compose(sortAndMapToKey, filterMains);\nconst filterSplits = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => isSplit\n);\nconst filterVisible = (expectedViewMode: ViewMode | ViewMode[] = []) =>\n  filter<ToolWindowStateWithKey, \"array\">(\n    ({ viewMode, isVisible }: ToolWindowStateWithKey) =>\n      isVisible &&\n      ([] as ViewMode[]).concat(expectedViewMode).includes(viewMode)\n  );\nconst getSplits = compose(sortAndMapToKey, filterSplits);\n\nconst filterVisibleDocked = filterVisible([\"docked_unpinned\", \"docked_pinned\"]);\nconst filterVisibleUnDocked = filterVisible(\"undock\");\n\nconst getDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideDockedState => {\n  const docks = filterVisibleDocked(toolWindows);\n  const mains = filterMains(docks);\n  const splits = filterSplits(docks);\n  if (mains.length > 1 || splits.length > 1) {\n    throw new Error(\n      \"More than one visible docked window in a side is not possible\"\n    );\n  }\n  if (mains[0] || splits[0]) {\n    const weight = mains[0]?.weight || splits[0]?.weight;\n    return {\n      mainKey: mains[0]?.key || splits[0]?.key,\n      split:\n        mains[0]?.key && splits[0]?.key\n          ? {\n              key: splits[0].key,\n              sizeFraction: mains[0].weight\n                ? 1 - mains[0].sideWeight\n                : splits[0].sideWeight,\n            }\n          : null,\n      size: weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  return null;\n};\n\nconst getUnDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideUnDockedState => {\n  const windows = filterVisibleUnDocked(toolWindows);\n  if (windows.length === 1) {\n    return {\n      key: windows[0].key,\n      size: windows[0].weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  if (windows.length === 0) {\n    return null;\n  }\n  throw new Error(\n    \"More than one visible undocked window in a side is not possible\"\n  );\n};\n\nconst getSideState = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideState => ({\n  stripes: {\n    main: getMains(toolWindows),\n    split: getSplits(toolWindows),\n    activeKeys: mapToKey(toolWindows.filter(({ isVisible }) => isVisible)),\n  },\n  undocked: getUnDocked(anchor, containerSize, toolWindows),\n  docked: getDocked(anchor, containerSize, toolWindows),\n});\n\nconst DEFAULT_HEIGHT = 300;\nconst DEFAULT_WIDTH = 400;\nconst getFloatWindowState =\n  (containerSize: ContainerSize) =>\n  ({\n    floatingBounds: bounds = {\n      top: containerSize.height / 2 - DEFAULT_HEIGHT / 2,\n      left: containerSize.width / 2 - DEFAULT_WIDTH / 2,\n      height: DEFAULT_HEIGHT,\n      width: DEFAULT_WIDTH,\n    },\n    key,\n  }: ToolWindowStateWithKey): FloatWindowState => ({ bounds, key });\n\nconst getFloatWindowsState = (\n  viewMode: \"float\" | \"window\",\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n) =>\n  pipe(\n    filterVisible(viewMode),\n    map<ToolWindowStateWithKey, FloatWindowState>(\n      getFloatWindowState(containerSize)\n    )\n  )(toolWindows);\n\nexport function getToolWindowsLayoutState(\n  state: Readonly<ToolWindowsState>,\n  containerSize: ContainerSize,\n  /**\n   * list of valid window ids. If state contains window ids that are not included here, they will be excluded in\n   * the returned state object.\n   */\n  windowIds: string[] = Object.keys(state.windows)\n): ToolWindowsLayoutState {\n  const toolWindows = Object.keys(state.windows)\n    .filter(\n      (key) => windowIds.includes(key) && !state.removedFromSideBarIds.has(key)\n    )\n    .map((key) => ({\n      ...state.windows[key],\n      key,\n    }));\n  const {\n    top = [],\n    bottom = [],\n    left = [],\n    right = [],\n  } = groupBy(({ anchor }) => anchor, toolWindows);\n  return {\n    left: getSideState(\"left\", containerSize, left),\n    top: getSideState(\"top\", containerSize, top),\n    right: getSideState(\"right\", containerSize, right),\n    bottom: getSideState(\"bottom\", containerSize, bottom),\n    windows: getFloatWindowsState(\"window\", containerSize, toolWindows),\n    floatWindows: getFloatWindowsState(\"float\", containerSize, toolWindows),\n  };\n}\n","import { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { Key } from \"react\";\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface DropPosition {\n  index: number;\n  split: boolean;\n\n  relative?: {\n    placement: \"before\" | \"after\";\n    key: Key;\n  };\n}\n\n/**\n * TODO: Add a few words about what this function do.\n */\nexport const createGetDropPosition = <T extends any>({\n  anchor,\n  stripeElement,\n  splitItems,\n  mainItems,\n  getItemRect,\n  getKey,\n}: {\n  stripeElement: HTMLElement;\n  anchor: Anchor;\n  getItemRect: (key: Key) => Rect;\n  getKey: (key: T) => Key;\n  mainItems: T[];\n  splitItems: T[];\n}): ((draggedRect: Rect) => DropPosition | null) => {\n  // Note: It may be tempting to calculate stripe element boundaries just once\n  // here, since it's not supposed to change during a drag session, but it\n  // can change due to getting empty when the only button is being dragged out.\n  const getStripeRect = () => stripeElement.getBoundingClientRect();\n\n  const getCanDrop = (draggingRect: Rect) => {\n    const stripeRect = getStripeRect();\n    return (\n      draggingRect.right > stripeRect.left - stripeRect.width &&\n      draggingRect.left < stripeRect.right &&\n      draggingRect.bottom > stripeRect.top - stripeRect.height &&\n      draggingRect.top < stripeRect.bottom\n    );\n  };\n\n  const start = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.left : rect.top;\n  const end = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.right : rect.bottom;\n\n  const getKeyToOffsets = (items: T[]) => {\n    const keyToOffsets: Record<Key, { start: number; end: number }> = {};\n    items.forEach((item) => {\n      const key = getKey(item);\n      const boundingRect = getItemRect(key);\n      keyToOffsets[key] = {\n        start: start(boundingRect),\n        end: end(boundingRect),\n      };\n    });\n    return keyToOffsets;\n  };\n\n  const getDropPositions = (\n    items: T[],\n    split = false\n    // FIXME: score is a bad name. it's quite the opposite! the less means the higher score.\n  ): Array<DropPosition & { score: (rect: Rect) => number }> => {\n    const getRef = split ? end : start;\n    if (items.length === 0) {\n      // if the section is empty, we should still allow adding to it.\n      return [\n        {\n          index: 0,\n          split,\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - getRef(getStripeRect())),\n        },\n      ];\n    }\n    return items.flatMap((item, index) => {\n      const key = getKey(item);\n      return [\n        {\n          index,\n          split,\n          relative: { key, placement: \"before\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].start),\n        },\n        {\n          index: index + 1,\n          split,\n          relative: { key, placement: \"after\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].end),\n        },\n      ];\n    });\n  };\n\n  const keyToOffsets = getKeyToOffsets([...mainItems, ...splitItems]);\n\n  const dropPositions = [\n    ...getDropPositions(mainItems),\n    ...getDropPositions(splitItems, true),\n  ];\n\n  let lastDropPosition: DropPosition | null = null;\n  return (draggingRect: Rect) => {\n    if (!getCanDrop(draggingRect)) {\n      return null;\n    }\n    const result = dropPositions.reduce(\n      (bestMatch, candidate) => {\n        const score = candidate.score(draggingRect);\n        if (!bestMatch || score < bestMatch.score) {\n          return {\n            ...candidate,\n            score,\n          };\n        }\n        return bestMatch;\n      },\n      null as\n        | null\n        | (DropPosition & {\n            score: number;\n          })\n    );\n\n    if (!result) {\n      return null;\n    }\n    if (\n      result.split !== lastDropPosition?.split ||\n      result.index !== lastDropPosition?.index\n    ) {\n      lastDropPosition = result;\n    }\n    return lastDropPosition;\n  };\n};\n","import { StyledIconWrapper } from \"../Icon/StyledIconWrapper\";\nimport { styled } from \"../styled\";\nimport React from \"react\";\nimport { css } from \"styled-components\";\nimport { Anchor } from \"./utils\";\n\nexport interface StyledToolWindowStripeButtonProps {\n  anchor: Anchor;\n  active?: boolean;\n}\n\nexport const STRIPE_BUTTON_CROSS_PADDING = 2.5;\nexport const STRIPE_BUTTON_LINE_HEIGHT = \"1rem\";\n\nconst anchorStyles = ({ anchor }: { anchor: Anchor }) => {\n  const orientation =\n    anchor === \"left\" || anchor === \"right\" ? \"vertical\" : \"horizontal\";\n\n  return orientation === \"horizontal\"\n    ? css`\n        padding: ${STRIPE_BUTTON_CROSS_PADDING}px 10px;\n      `\n    : css`\n        padding: 10px ${STRIPE_BUTTON_CROSS_PADDING}px;\n        writing-mode: vertical-lr;\n        // writing-mode: sideways-lr is not supported anywhere other than FF, so, we need to rotate\n        transform: ${anchor === \"left\" ? \"rotateZ(180deg)\" : undefined};\n\n        // icons are not rotated like text in Intellij Platform implementation. It kind of makes sense.\n        ${StyledIconWrapper} {\n          transform: rotate(180deg);\n        }\n      `;\n};\n\nexport const StyledToolWindowStripeButton = styled.span<StyledToolWindowStripeButtonProps>`\n  box-sizing: border-box;\n  display: flex; // to allow icon and text alignment by default;\n  align-items: center;\n  cursor: default;\n  user-select: none;\n  overflow: hidden;\n  direction: ltr;\n  flex-shrink: 0;\n  font-size: 0.7rem;\n  line-height: ${STRIPE_BUTTON_LINE_HEIGHT}; // absolute value seems to be problematic when the base font size is changed\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedForeground\",\n          theme.dark ? \"rgb(255,255,255)\" : \"rgb(0,0,0)\"\n        )\n      : theme.color(\"*.foreground\")};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedBackground\",\n          theme.dark ? \"rgba(15,15,15,.332)\" : \"rgba(85,85,85,.332)\"\n        )\n      : undefined};\n\n  ${anchorStyles}\n  ${({ active }) =>\n    !active &&\n    css`\n      &:hover {\n        background: ${({ theme }) =>\n          theme.color(\n            \"ToolWindow.Button.hoverBackground\",\n            theme.dark ? \"rgba(15,15,15,.156)\" : \"rgba(85,85,85,.156)\"\n          )};\n      }\n    `};\n`;\n","import {\n  STRIPE_BUTTON_CROSS_PADDING,\n  STRIPE_BUTTON_LINE_HEIGHT,\n} from \"./StyledToolWindowStripeButton\";\nimport { Anchor, isHorizontalToolWindow, theOtherSide } from \"./utils\";\nimport { css } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { styled } from \"../styled\";\nimport { Color } from \"../Theme/Color\";\n\nconst minHeight = `calc(${STRIPE_BUTTON_LINE_HEIGHT} + ${\n  2 * STRIPE_BUTTON_CROSS_PADDING + 1 /*border*/\n}px)`;\n\nconst anchorStyles = ({\n  anchor,\n  preventCollapse,\n}: StyledToolWindowStripeProps) =>\n  isHorizontalToolWindow(anchor)\n    ? css`\n        flex-direction: row;\n        width: 100%;\n        min-height: ${preventCollapse ? minHeight : \"fit-content\"};\n      `\n    : css`\n        flex-direction: column;\n        height: 100%;\n        min-width: ${preventCollapse ? minHeight : \"fit-content\"};\n      `;\nconst borderStyle = ({ anchor, theme }: { anchor: Anchor; theme: Theme }) =>\n  css`border-${theOtherSide(anchor)}: 1px solid ${\n    theme.commonColors.contrastBorder\n  }`;\n\nexport interface StyledToolWindowStripeProps {\n  anchor: Anchor;\n  highlighted?: boolean;\n  preventCollapse?: boolean;\n}\n\nexport const StyledToolWindowStripe = styled.div<StyledToolWindowStripeProps>`\n  box-sizing: border-box;\n  background: ${({ theme, highlighted }) =>\n    highlighted\n      ? Color.brighter(theme.commonColors.panelBackground)\n      : theme.commonColors.panelBackground};\n  display: inline-flex;\n  overflow: hidden;\n  ${borderStyle};\n  ${anchorStyles}\n`;\n\nexport const StyledSpacer = styled.div`\n  flex: 1;\n`;\n","import { RefObject } from \"react\";\nimport {\n  useMove,\n  UseMoveOptions,\n  XY,\n} from \"../utils/interaction-utils/useMove\";\nimport { findEffectiveBackgroundColor } from \"./findEffectiveBackgroundColor\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface UseElementMoveOptions<S>\n  extends Omit<UseMoveOptions<S>, \"onMoveStart\" | \"onMove\"> {\n  ref: RefObject<HTMLElement>;\n  /**\n   * if true a clone of the element is created and used as ghost.\n   * A function can be passed to customize the default ghost element or return a completely\n   * different one.\n   */\n  ghost?: boolean | ((defaultGhost: HTMLElement) => HTMLElement);\n\n  onMoveStart: (args: { from: Rect }) => S;\n  onMove: (args: { from: Rect; to: Rect; movement: XY; startState: S }) => void;\n}\n\n/**\n * Provides necessary event handling props to be applied on an element to make it movable.\n * It's implemented on top of {@link useMove}. The differences are:\n * - The signature of `onMoveStart`, `onMove` and `onMoveEnd` are changed to pass\n *   {@link Rect} instead of {@link XY}.\n * - rendering a ghost element.\n *\n * ## A note about ghost:\n * There is no easy way to create a snapshot image of an html element. Native drag and drop API\n * supports [setting drag\n * image](https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/setDragImage) but we are\n * not using drag events mainly because of not being able to customize the offset after which drag\n * should start. See {@link UseMoveOptions#dragThreshold dragThreshold} for more details. There are\n * some libraries like html2canvas for creating an image from an html element, but they are very\n * big and using them doesn't make sense at all from a value/cost ratio perspective. There might be\n * some ways of implementing custom move threshold on top of native drag events. For example by\n * delaying the call to setDragImage, but it needs more investigation. Also, not sure if opacity of\n * the ghost is something you can control when using setDragImage.\n **/\nexport function useElementMove<S>({\n  ref,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  ghost: ghostOption,\n  ...otherOptions\n}: UseElementMoveOptions<S>) {\n  return useMove({\n    ...otherOptions,\n    onMoveStart: () => {\n      const element = ref.current;\n      let ghost: HTMLElement | null = null;\n      if (!element) {\n        throw new Error(\n          \"Movement started but ref value is null. Make sure the passed ref is applied on the same element that other props are.\"\n        );\n      }\n      const updateGhostPosition = (rect: Rect) => {\n        if (ghost) {\n          ghost.style.left = `${rect.left}px`;\n          ghost.style.top = `${rect.top}px`;\n        }\n      };\n      const from: Rect = element.getBoundingClientRect();\n      if (ghostOption) {\n        const defaultGhost = createDefaultGhost(element);\n        ghost =\n          typeof ghostOption === \"function\"\n            ? ghostOption(defaultGhost) || defaultGhost\n            : defaultGhost;\n        ghost.style.position = \"fixed\";\n        document.body.append(ghost);\n        updateGhostPosition(from);\n      }\n      return {\n        ghost,\n        from,\n        updateGhostPosition,\n        startState: onMoveStart({ from }),\n      };\n    },\n    onMove: ({\n      movement,\n      startState: { from, updateGhostPosition, startState },\n    }) => {\n      const to: Rect = {\n        left: from.left + movement.x,\n        right: from.right + movement.x,\n        top: from.top + movement.y,\n        bottom: from.bottom + movement.y,\n        height: from.height,\n        width: from.width,\n      };\n      updateGhostPosition(to);\n      onMove({ from, to, movement, startState });\n    },\n    onMoveEnd: ({ startState: { ghost, startState } }) => {\n      ghost?.remove();\n      onMoveEnd?.({ startState });\n    },\n  });\n}\n\nfunction createDefaultGhost(element: HTMLElement) {\n  const ghost = element.cloneNode(true) as HTMLElement;\n  ghost.style.backgroundColor = findEffectiveBackgroundColor(element);\n  return ghost;\n}\n","import { Color } from \"../Theme/Color\";\n\n/**\n * Computes the effective background color of the element by blending translucent backgrounds of\n * the elements ancestors. It traverses up the parents, until reaches a solid background color.\n * all translucent backgrounds in between are blended with that solid color, with respect to their\n * transparency. It's meant to be used only for the simple cases where an element doesn't overflow\n * the parents. Obviously, in other cases there won't be one single effective background color\n * for the element.\n */\nexport function findEffectiveBackgroundColor(element: HTMLElement): string {\n  let elem: HTMLElement | null = element;\n  let colors: Color[] = [];\n  while (elem != null) {\n    const computedBackground = getComputedStyle(elem).backgroundColor;\n    if (computedBackground) {\n      const color = new Color(computedBackground);\n      colors.unshift(color);\n      if (color.a === 255) {\n        // if we've reached a solid color, we don't need to continue traversing ancestors\n        break;\n      }\n    }\n    elem = elem.parentElement;\n  }\n  return (\n    colors\n      .reduce<Color | null>((resultColor, nextColor) => {\n        return resultColor ? resultColor.blend(nextColor) : nextColor;\n      }, null)\n      ?.toString() || \"\"\n  );\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport React, { CSSProperties, HTMLAttributes, Key, useRef } from \"react\";\nimport { createGetDropPosition, DropPosition } from \"./createGetDropPosition\";\nimport { useMovableStripeButtons } from \"./MovableToolWindowStripeProvider\";\nimport { StyledSpacer, StyledToolWindowStripe } from \"./StyledToolWindowStripe\";\nimport { StyledToolWindowStripeButton } from \"./StyledToolWindowStripeButton\";\nimport { useElementMove, UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\ninterface ToolWindowStripeProps<T> {\n  anchor: Anchor;\n  items: T[];\n  splitItems?: T[];\n  getKey: (item: T) => Key;\n  renderItem: (item: T) => React.ReactNode;\n  selectedKeys?: Key[];\n  onItemPress?: (key: Key) => void;\n}\n\n/**\n * TODO: refactor to remove the key based interface.\n */\nexport function ToolWindowStripe<T>({\n  anchor,\n  items: mainItems,\n  renderItem: render,\n  splitItems = [],\n  selectedKeys = [],\n  onItemPress,\n  getKey,\n}: ToolWindowStripeProps<T>) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const {\n    getProps,\n    draggingRect,\n    draggingKey,\n    dropPosition,\n  } = useMovableStripeButtons({\n    stripeElRef: containerRef,\n    getKey,\n    anchor,\n    mainItems,\n    splitItems,\n    createGetDropPosition: (key: Key) => {\n      const isNotCurrentItem = (anItem: T) => getKey(anItem) !== key;\n      const stripeElement = containerRef.current!;\n      const getItemRect = (key: Key) =>\n        stripeElement\n          .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n          .getBoundingClientRect();\n      return createGetDropPosition({\n        stripeElement: stripeElement,\n        mainItems: mainItems.filter(isNotCurrentItem),\n        splitItems: splitItems.filter(isNotCurrentItem),\n        getKey,\n        anchor,\n        getItemRect,\n      });\n    },\n  });\n\n  const highlighted =\n    dropPosition != null &&\n    draggingKey != null &&\n    [...mainItems, ...splitItems].every((item) => getKey(item) !== draggingKey);\n\n  const renderItem = (item: T) => {\n    const key = getKey(item);\n\n    return (\n      <ToolWindowStripeButton\n        anchor={anchor}\n        key={key}\n        data-key={key}\n        style={{\n          ...getStripeButtonStyles({\n            key,\n            dropPosition,\n            anchor,\n            draggingRect,\n            draggingKey,\n          }),\n        }}\n        {...getProps(key)}\n        active={selectedKeys.includes(key)}\n        onPress={() => onItemPress?.(key)}\n      >\n        {render(item)}\n      </ToolWindowStripeButton>\n    );\n  };\n  return (\n    <>\n      <StyledToolWindowStripe\n        anchor={anchor}\n        preventCollapse={Boolean(dropPosition)}\n        highlighted={highlighted}\n        ref={containerRef}\n      >\n        {mainItems.map(renderItem)}\n        <StyledSpacer />\n        {splitItems.map(renderItem)}\n      </StyledToolWindowStripe>\n    </>\n  );\n}\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nfunction getStripeButtonStyles({\n  anchor,\n  key,\n  dropPosition,\n  draggingRect,\n  draggingKey,\n}: {\n  anchor: Anchor;\n  key: Key;\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n  dropPosition: DropPosition | null;\n}) {\n  const styles: CSSProperties = {\n    // transition: \"margin 100ms\", // maybe only when drag is in progress, if unwanted transition at drop\n  };\n  if (dropPosition?.relative?.key === key && draggingRect) {\n    const marginValue = isHorizontalToolWindow(anchor)\n      ? draggingRect.width\n      : draggingRect.height;\n\n    if (isHorizontalToolWindow(anchor)) {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginLeft\"\n          : \"marginRight\"\n      ] = marginValue;\n    } else {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginTop\"\n          : \"marginBottom\"\n      ] = marginValue;\n    }\n  }\n  if (key === draggingKey) {\n    styles.display = \"none\";\n  }\n  return styles;\n}\n\nfunction ToolWindowStripeButton<T, S>({\n  children,\n  anchor,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  onPress,\n  moveDisabled,\n  ...otherProps\n}: {\n  children: React.ReactNode;\n  anchor: Anchor;\n  style: CSSProperties;\n  active: boolean;\n  onPress: () => void;\n  moveDisabled?: boolean;\n  onMoveStart: UseElementMoveOptions<S>[\"onMoveStart\"];\n  onMove: UseElementMoveOptions<S>[\"onMove\"];\n  onMoveEnd: UseElementMoveOptions<S>[\"onMoveEnd\"];\n}) {\n  const ref = useRef<HTMLElement>(null);\n\n  // for some reason, usePress and useMove (used in useElementMove) are not compatible.\n  // it seems onMouseDown in useMove is not called, even when handlers are merged by mergeProps.\n  // FIXME: fix compatibility of useMove and usePress, and switch to usePress({ onPress })\n  const { pressProps } = {\n    pressProps: {\n      onPointerUp: onPress,\n    } as HTMLAttributes<HTMLElement>,\n  }; //usePress({ onPress });\n  const props = useElementMove({\n    ref,\n    disabled: moveDisabled,\n    dragThreshold: 7,\n    ghost: true,\n    onMoveStart,\n    onMove,\n    onMoveEnd,\n  });\n\n  return (\n    <StyledToolWindowStripeButton\n      anchor={anchor}\n      {...mergeProps(otherProps, pressProps, props)}\n      ref={ref}\n    >\n      {children}\n    </StyledToolWindowStripeButton>\n  );\n}\n","import React from \"react\";\nimport { css } from \"styled-components\";\nimport { ResizableView } from \"../ResizableView\";\nimport { styled } from \"../styled\";\nimport { SideUnDockedState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\nexport const StyledUndockSide = styled.div<{ anchor: Anchor }>`\n  position: absolute;\n  background: inherit;\n  z-index: 1;\n  ${({ anchor }) =>\n    isHorizontalToolWindow(anchor)\n      ? css`\n          left: 0;\n          right: 0;\n        `\n      : css`\n          top: 0;\n          bottom: 0;\n        `};\n  ${({ anchor }) =>\n    css`\n      ${anchor}: 0;\n    `};\n`;\n\nexport function UndockSide({\n  state,\n  anchor,\n  children,\n  onResize,\n}: {\n  state: Exclude<SideUnDockedState, null>;\n  anchor: Anchor;\n  children: React.ReactNode;\n  onResize: (size: number) => void;\n}) {\n  return (\n    state && (\n      <StyledUndockSide anchor={anchor}>\n        <ResizableView\n          orientation={\n            isHorizontalToolWindow(anchor) ? \"vertical\" : \"horizontal\"\n          }\n          resizerPlacement={\n            anchor === \"left\" || anchor === \"top\" ? \"after\" : \"before\"\n          }\n          size={state.size}\n          onResize={onResize}\n        >\n          {children}\n        </ResizableView>\n      </StyledUndockSide>\n    )\n  );\n}\n","import React, {\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n  Key,\n  useImperativeHandle,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { FocusScope as AriaFocusScope } from \"@react-aria/focus\";\nimport { ThreeViewSplitter } from \"../ThreeViewSplitter/ThreeViewSplitter\";\nimport { FocusScope } from \"../utils/FocusScope\";\nimport { FloatToolWindows } from \"./FloatToolWindows\";\nimport { MovableToolWindowStripeProvider } from \"./MovableToolWindowStripeProvider\";\nimport { StyledToolWindowOuterLayout } from \"./StyledToolWindowOuterLayout\";\nimport {\n  getToolWindowsLayoutState,\n  SideDockedState,\n  StripesState,\n  ToolWindowsLayoutState,\n} from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { ToolWindowsState } from \"./ToolWindowsState/ToolWindowsState\";\nimport { ToolWindowStateProvider } from \"./ToolWindowsState/ToolWindowStateProvider\";\nimport { ToolWindowStripe } from \"./ToolWindowStripe\";\nimport { UndockSide } from \"./UndockSide\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { indexBy } from \"ramda\";\n\ninterface ToolWindow {\n  id: string;\n  toolbarButton: React.ReactNode;\n  content: React.ReactNode;\n}\n\nexport interface ToolWindowsProps {\n  children: React.ReactNode;\n  windows: ToolWindow[];\n  toolWindowsState: Readonly<ToolWindowsState>;\n  onToolWindowStateChange: (newState: ToolWindowsState) => void;\n\n  /**\n   * Whether stripe buttons should be hidden or not.\n   * `hideToolStripes` UISettings in Intellij Platform\n   */\n  hideToolWindowBars?: boolean;\n\n  /**\n   *\n   * `wideScreenSupport` in UISettings in Intellij Platform\n   */\n  useWidescreenLayout?: boolean;\n\n  /**\n   * min width applied to the main content (children).\n   * @default 50\n   */\n  mainContentMinWidth?: number;\n\n  height?: CSSProperties[\"height\"];\n  minHeight?: CSSProperties[\"minHeight\"];\n  margin?: CSSProperties[\"margin\"];\n\n  /**\n   * props to be passed to the container element.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"as\">;\n}\n\nexport interface ToolWindowRefValue {\n  focus(key: Key): void;\n  hasFocus(key: Key): void;\n  focusLastActiveWindow(): void;\n  focusMainContent(): void;\n  changeState(\n    updater: (currentState: Readonly<ToolWindowsState>) => ToolWindowsState\n  ): void;\n}\n\n/**\n * @constructor\n *\n * Corresponding to ToolWindowPane in Intellij Platform\n *\n * Known issues:\n * - in Firefox and Safari, left and right toolbars are not properly shown. Seems like a nasty bug, since adding and\n * then removing some min-width: fit-content style fixes it.\n * - in the dock view of a side, open only a window from the split ones. then open a window from main ones.\n *   focus is not moved to the just opened window. The reason is we rely on autofocusing and because the React tree\n *   changes for both windows, even the split one which was open will be unmounted and mounted again, and since it's\n *   placed after the main one, and hence mounted later, it will get the focus again. This becomes a bigger issue\n *   if the main one is unpinned, because it immediately gets closed after opening.\n *   Possible solutions:\n *   - make sure the split one won't unmount and mount again in such scenario.\n *   - decouple focusing logic from mounting logic, and only focus windows somehow, when the `isVisible` is changed\n *     from false to true, not when mounted.\n * - related to previous issue: open a tool window in split section of a side. set view mode for a tool window in main\n *   section of the same side to docked_unpinned. try to open the unpinned one while the split one is open. it doesn't\n *   work.\n */\nexport const ToolWindows = React.forwardRef(function ToolWindows(\n  {\n    hideToolWindowBars = false,\n    useWidescreenLayout = false,\n    height = \"100%\",\n    minHeight = \"0\",\n    toolWindowsState,\n    onToolWindowStateChange,\n    windows,\n    children,\n    mainContentMinWidth = 50,\n    containerProps,\n  }: ToolWindowsProps,\n  ref: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const windowsById = indexBy(({ id }) => id, windows);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const mainContentFocusScopeRef =\n    useRef<React.ComponentRef<typeof FocusScope>>(null);\n  const [layoutState, setLayoutState] = useState<ToolWindowsLayoutState>();\n  const windowFocusableRefs = useRef<{\n    [key: string]: React.RefObject<React.ComponentRef<typeof FocusScope>>;\n  }>({});\n\n  const latestRef = useLatest({ toolWindowsState, onToolWindowStateChange });\n\n  useLayoutEffect(() => {\n    setLayoutState(\n      getToolWindowsLayoutState(\n        toolWindowsState,\n        containerRef.current!.getBoundingClientRect(),\n        windows.map(({ id }) => id)\n      )\n    );\n  }, [toolWindowsState]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (key: Key) => {\n        windowFocusableRefs.current[key].current?.focus();\n      },\n      hasFocus: (key: Key) =>\n        document.activeElement?.closest(`[data-tool-window-id=\"${key}\"]`) !==\n        null,\n      focusLastActiveWindow: () => {\n        const { lastFocusedKey } = latestRef.current.toolWindowsState;\n        if (lastFocusedKey != null) {\n          if (\n            !latestRef.current.toolWindowsState.windows[lastFocusedKey]\n              .isVisible\n          ) {\n            latestRef.current.onToolWindowStateChange(\n              toolWindowsState.show(lastFocusedKey)\n            );\n          }\n          windowFocusableRefs.current[lastFocusedKey].current?.focus(true);\n        }\n      },\n      focusMainContent: () => {\n        mainContentFocusScopeRef.current?.focus();\n      },\n      changeState: (updater) => {\n        onToolWindowStateChange(updater(latestRef.current.toolWindowsState));\n      },\n    }),\n    []\n  );\n\n  // TODO: extract component candidate\n  const renderStripe = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: StripesState;\n  }) => (\n    <ToolWindowStripe\n      anchor={anchor}\n      items={state.main}\n      splitItems={state.split}\n      getKey={(item) => item}\n      renderItem={(item) => windowsById[item]?.toolbarButton}\n      onItemPress={(key) =>\n        onToolWindowStateChange(toolWindowsState.toggle(key))\n      }\n      selectedKeys={state.activeKeys}\n    />\n  );\n\n  const renderToolWindow = (key: Key) => {\n    if (!windowFocusableRefs.current[key]) {\n      windowFocusableRefs.current[key] = React.createRef();\n    }\n    return (\n      <div\n        style={{ all: \"unset\" }}\n        data-tool-window-id={key}\n        onFocus={() => {\n          onToolWindowStateChange(toolWindowsState.lastFocused(key));\n        }}\n      >\n        <FocusScope ref={windowFocusableRefs.current[key]}>\n          <ToolWindowStateProvider\n            id={key}\n            containerRef={containerRef}\n            mainContentFocusableRef={mainContentFocusScopeRef}\n            toolWindowsState={toolWindowsState}\n            onToolWindowStateChange={onToolWindowStateChange}\n          >\n            {windowsById[key]?.content}\n          </ToolWindowStateProvider>\n        </FocusScope>\n      </div>\n    );\n  };\n  // TODO: candidate for component extraction\n  const renderSideDockedView = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: SideDockedState;\n  }) => {\n    if (!state) {\n      return null;\n    }\n    return (\n      <ThreeViewSplitter\n        innerView={renderToolWindow(state.mainKey)}\n        innerViewMinSize={50}\n        lastView={state.split && renderToolWindow(state.split.key)}\n        lastSize={state.split?.sizeFraction}\n        onLastResize={(newSize) => {\n          onToolWindowStateChange(\n            toolWindowsState.resizeDockSplitView(anchor, newSize)\n          );\n        }}\n        orientation={isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\"}\n      />\n    );\n  };\n  const onDockResize = (anchor: Anchor) => (size: number) => {\n    const containerBounds = containerRef.current?.getBoundingClientRect();\n    // containerBounds should have value in normal course of events\n    if (containerBounds) {\n      onToolWindowStateChange(\n        toolWindowsState.resizeDock(anchor, size, containerBounds)\n      );\n    }\n  };\n  const getSplitViewProps = (\n    layoutState: ToolWindowsLayoutState,\n    orientation: \"horizontal\" | \"vertical\"\n  ) => {\n    const firstAnchor = orientation === \"horizontal\" ? \"left\" : \"top\";\n    const secondAnchor = orientation === \"horizontal\" ? \"right\" : \"bottom\";\n    return {\n      orientation,\n      firstView: renderSideDockedView({\n        anchor: firstAnchor,\n        state: layoutState[firstAnchor].docked,\n      }),\n      firstSize: layoutState[firstAnchor].docked?.size,\n      onFirstResize: onDockResize(firstAnchor),\n      lastView: renderSideDockedView({\n        anchor: secondAnchor,\n        state: layoutState[secondAnchor].docked,\n      }),\n      lastSize: layoutState[secondAnchor].docked?.size,\n      onLastResize: onDockResize(secondAnchor),\n    };\n  };\n  const renderInnerLayout = (layoutState: ToolWindowsLayoutState) => {\n    const horizontalSplitterProps = getSplitViewProps(\n      layoutState,\n      \"horizontal\"\n    );\n    const verticalSplitterProps = getSplitViewProps(layoutState, \"vertical\");\n\n    const [outerSplitterProps, innerSplitterProps] = useWidescreenLayout\n      ? [horizontalSplitterProps, verticalSplitterProps]\n      : [verticalSplitterProps, horizontalSplitterProps];\n\n    const undockLayers = ([\"left\", \"top\", \"right\", \"bottom\"] as const).map(\n      (anchor) => {\n        const state = layoutState[anchor].undocked;\n        return (\n          state && (\n            <UndockSide\n              key={anchor}\n              anchor={anchor}\n              state={state}\n              onResize={(size) => {\n                containerRef.current &&\n                  onToolWindowStateChange(\n                    toolWindowsState.resizeUndock(\n                      anchor,\n                      size,\n                      containerRef.current.getBoundingClientRect()\n                    )\n                  );\n              }}\n            >\n              {renderToolWindow(state.key)}\n            </UndockSide>\n          )\n        );\n      }\n    );\n\n    return (\n      <>\n        <MovableToolWindowStripeProvider\n          onMove={({ to, from }) => {\n            onToolWindowStateChange(\n              toolWindowsState.move(\n                layoutState[from.anchor].stripes[\n                  from.isSplit ? \"split\" : \"main\"\n                ][from.index],\n                { anchor: to.anchor, isSplit: to.isSplit },\n                to.index\n              )\n            );\n          }}\n        >\n          {/**\n           * ToolWindow bars, aka Stripes. Order of stripes is irrelevant for layout but relevant for\n           * priority when stripe buttons are moved across stripes.\n           * layout is handled by `StyledToolWindowOuterLayout`.\n           */}\n          <StyledToolWindowOuterLayout.LeftStripe>\n            {renderStripe({\n              anchor: \"left\",\n              state: layoutState[\"left\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.LeftStripe>\n          <StyledToolWindowOuterLayout.TopStripe>\n            {renderStripe({\n              anchor: \"top\",\n              state: layoutState[\"top\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.TopStripe>\n          <StyledToolWindowOuterLayout.RightStripe>\n            {renderStripe({\n              anchor: \"right\",\n              state: layoutState[\"right\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.RightStripe>\n          <StyledToolWindowOuterLayout.BottomStripe>\n            {renderStripe({\n              anchor: \"bottom\",\n              state: layoutState[\"bottom\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.BottomStripe>\n        </MovableToolWindowStripeProvider>\n        {/**\n         * The inner layout of the ToolWindow, including four tool windows and\n         * a main content in the center.\n         */}\n        <StyledToolWindowOuterLayout.InnerView>\n          <ThreeViewSplitter\n            {...outerSplitterProps}\n            innerView={\n              <ThreeViewSplitter\n                innerViewMinSize={mainContentMinWidth}\n                innerView={\n                  <FocusScope ref={mainContentFocusScopeRef}>\n                    {children}\n                  </FocusScope>\n                }\n                {...innerSplitterProps}\n              />\n            }\n          />\n          {undockLayers}\n          {\n            <FloatToolWindows\n              floatWindows={layoutState?.floatWindows}\n              renderToolWindow={renderToolWindow}\n              onBoundsChange={(key, bounds) =>\n                onToolWindowStateChange(\n                  toolWindowsState.setFloatingBound(key, bounds)\n                )\n              }\n            />\n          }\n        </StyledToolWindowOuterLayout.InnerView>\n      </>\n    );\n  };\n  return (\n    /**\n     * About FocusScope:\n     * When focus is within the ToolWindows, clicking on non-focusable parts of the UI should not make the focus get\n     * lost. That's especially important with the top level actions being handled on a wrapper around ToolWindows.\n     * Because if the focus goes to body, keyboard events are no longer handled, with the way action system is currently\n     * implemented.\n     * AriaFocusScope provides a somewhat accurate behaviour, but it might also be too much, and we can consider\n     * a more light-weight approach. Issues with the current usage of AriaFocus:\n     * - FocusScope traverses the dom tree to find focusable elements, and it might come with considerable performance\n     *   penalty at this place. Something to be investigated more.\n     * - When the focus is lost, e.g. the active tool window closes, FocusScope moves focus to the **first** focusable\n     *  element, whereas in the reference implementation of Tool Windows, the focus goes to the main content (usually\n     *  the editor).\n     *  TODO: investigate alternative approaches for focus handling here.\n     */\n    <AriaFocusScope contain>\n      <StyledToolWindowOuterLayout.Shell\n        {...containerProps}\n        ref={containerRef}\n        /**\n         * Potential refactoring: hideStripes can also be handled by conditionally\n         * rendering tool window bars, instead of considering it as a feature of\n         * StyledToolWindowOuterLayout\n         **/\n        hideStripes={hideToolWindowBars}\n        style={{ height, minHeight, ...containerProps?.style }}\n      >\n        {layoutState && renderInnerLayout(layoutState)}\n      </StyledToolWindowOuterLayout.Shell>\n    </AriaFocusScope>\n  );\n});\n","import React, { Key, RefObject, useContext, useMemo } from \"react\";\nimport { ToolWindowsProps } from \"../ToolWindows\";\nimport { ToolWindowState, ViewMode, WindowBounds } from \"./ToolWindowsState\";\nimport { Anchor } from \"../utils\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ntype ToolWindowStateContextValue = {\n  state: Readonly<ToolWindowState>;\n  hide: () => void;\n  remove: () => void;\n  blur: () => void;\n  focusMainContent: () => void;\n  moveToSide: (args: { anchor: Anchor; isSplit: boolean }) => void;\n  changeViewMode: (viewMode: ViewMode) => void;\n  stretchWidth: (value: number) => void;\n  stretchHeight: (value: number) => void;\n  setFloatingBounds: (bounds: WindowBounds) => void;\n};\nconst ToolWindowStateContext =\n  React.createContext<ToolWindowStateContextValue | null>(null);\n\n/**\n * Used in a tool window's UI tree, to get access to the tool window state and actions for changing it.\n */\nexport const useToolWindowState = () => {\n  const context = useContext(ToolWindowStateContext);\n  if (!context) {\n    throw new Error(\n      \"useToolWindowContext is meant to be used inside a tool window.\"\n    );\n  }\n  return context;\n};\n\n/**\n * Used in ToolWindows to provide tool window state and necessary actions as a context, which will be accessible\n * within the tool window content tree, via {@link useToolWindowState}\n */\nexport const ToolWindowStateProvider: React.FC<\n  {\n    id: Key;\n    containerRef: RefObject<HTMLElement>;\n    mainContentFocusableRef: RefObject<{ focus: () => void }>;\n  } & Pick<ToolWindowsProps, \"toolWindowsState\" | \"onToolWindowStateChange\">\n> = ({\n  toolWindowsState,\n  containerRef,\n  mainContentFocusableRef,\n  onToolWindowStateChange,\n  id,\n  children,\n}) => {\n  const blur = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.blur(id));\n  });\n  const hide = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.hide(id));\n  });\n  const remove = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.removeFromSidebar(id));\n  });\n  const focusMainContent = useEventCallback(() => {\n    mainContentFocusableRef.current?.focus();\n  });\n  const moveToSide = useEventCallback(\n    (side: { anchor: Anchor; isSplit: boolean }) => {\n      onToolWindowStateChange(toolWindowsState.move(id, side));\n    }\n  );\n  const changeViewMode = useEventCallback((viewMode: ViewMode) => {\n    onToolWindowStateChange(toolWindowsState.changeViewMode(id, viewMode));\n  });\n  const stretchWidth = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchWidth(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const stretchHeight = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchHeight(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const setFloatingBounds = useEventCallback((bounds: WindowBounds) => {\n    onToolWindowStateChange(toolWindowsState.setFloatingBound(id, bounds));\n  });\n  const contextValue = useMemo((): ToolWindowStateContextValue => {\n    const state = toolWindowsState.windows[id];\n    return {\n      state,\n      hide,\n      blur,\n      remove,\n      focusMainContent,\n      moveToSide,\n      changeViewMode,\n      stretchWidth,\n      stretchHeight,\n      setFloatingBounds,\n    };\n  }, [toolWindowsState, id]);\n  return (\n    <ToolWindowStateContext.Provider value={contextValue}>\n      {children}\n    </ToolWindowStateContext.Provider>\n  );\n};\n","import { clamp, curry, fromPairs, insert, mapObjIndexed, move } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\n\nexport type ViewMode =\n  | \"docked_pinned\"\n  | \"docked_unpinned\"\n  | \"undock\"\n  | \"float\"\n  /**\n   * @deprecated \"window\" ViewMode was initially added following the original impl. It doesn't seem reasonable to\n   * support it though. It's marked as deprecated to be removed in the future.\n   */\n  | \"window\";\n\nexport type WindowBounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * Data structure for keeping the state of a single tool window. very similar to WindowInfo in Intellij Platform\n *\n * A note about about the data structure:\n * Some fields like `isSplit`, `weight`, `floatingBound` are meaningful only\n * for a subset of viewModes. So it may be tempting to introduce a `viewMode`\n * type which minimally and more accurately describes the information\n * relevant for each viewMode. But it's not structured like that, and it's\n * orthogonal to viewMode, since we want to preserve the relevant information\n * for each viewMode, to be used when the viewMode is changed back.\n *\n * NOTE: consider renaming to `WindowState` to avoid confusion with `ToolWindowsState`\n */\nexport interface ToolWindowState {\n  /**\n   * The order of the tool window in its group. The group is specified by `anchor` and `isSplit`.\n   */\n  order: number;\n  /**\n   * Whether the tool window is visible (open) or not.\n   * NOTE: A maximum of 1 **docked** tool window within the same group (same `anchor` and `isSplit`) can be visible.\n   * You will get a render error in `ToolWindows` component otherwise.\n   */\n  isVisible: boolean;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered is primary group, i.e. when\n   * `isSplit` is false\n   */\n  weight: number;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered is the secondary group. i.e.\n   * when `isSplit` is true.\n   */\n  sideWeight: number;\n  /**\n   * The side of the tool window, being \"left\", \"right\", \"top\" or \"bottom\"\n   */\n  anchor: Anchor;\n  /**\n   * Specifies whether the tool window should be shown in the split view, aka \"Secondary group\".\n   */\n  isSplit: boolean;\n  /**\n   * Tool windows view mode. See {@link ViewMode}\n   *\n   * NOTE: in Intellij Platform, there is a window `type` and also `docked` and\n   * `autoHide`.\n   * keeping one viewMode makes more sense and prevents invalid combinations\n   * like { type: \"window, \"docked\": true}, that would be unnecessarily allowed.\n   */\n  viewMode: ViewMode;\n  /**\n   * Boundaries of the tool window, when rendered in \"float\" view mode.\n   */\n  floatingBounds?: WindowBounds;\n}\n\nconst isDocked = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" ||\n  toolWindow.viewMode === \"docked_pinned\";\n\n/**\n * Determines whether the tool window should hide on focus. In the java implementation, it's a field on window\n * info instead of being a calculated field. We changed that to match viewMode with the 5 view modes that are possible\n * to choose from the UI, eliminating the combinations that are never allowed. If from UX perspective, having window\n * or float mode with autoHide feature is considered valid at some point, we may need to change the implementation\n * to something similar to the original implementation where isAutoHide and viewMode are separate.\n */\nconst isAutoHide = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" || toolWindow.viewMode === \"undock\";\n\nexport type SideInfo = Pick<ToolWindowState, \"anchor\" | \"isSplit\">;\nexport const areInSameSection = curry(\n  (window1: SideInfo, window2: SideInfo) =>\n    window1.anchor === window2.anchor && window1.isSplit === window2.isSplit\n);\n\nexport const getViewModeType = (viewMode: ViewMode) => {\n  if (viewMode === \"docked_pinned\" || viewMode === \"docked_unpinned\") {\n    return \"docked\";\n  }\n  if (viewMode === \"window\" || viewMode === \"float\") {\n    return \"float\";\n  }\n  return viewMode;\n};\ntype IdToWindowStateMap = Readonly<{\n  [key: string]: Readonly<ToolWindowState>;\n}>;\n\n/**\n * Represents UI state of a bunch of tool windows. What is rendered inside each window or toolbar button is irrelevant.\n *\n * TODO: document pros and cons of these two approaches\n * - Having a class for ToolWindowsState which keeps a readonly mapping of keys to window states.\n * - Having ToolWindowsState as an interface (a mapping from keys to window states), and a bunch of action functions\n *   which accept a window state and some arguments, and return a new window state.\n */\nexport class ToolWindowsState {\n  public readonly lastFocusedKey: Key | null;\n  public readonly removedFromSideBarIds: ReadonlySet<Key>;\n  private readonly layoutToRestore: IdToWindowStateMap;\n  constructor(\n    public readonly windows: IdToWindowStateMap,\n    {\n      lastFocusedKey = null,\n      layoutToRestore = {},\n      removedFromSideBarIds = [],\n    }: {\n      lastFocusedKey?: Key | null;\n      layoutToRestore?: IdToWindowStateMap;\n      removedFromSideBarIds?: Iterable<Key>;\n    } = {}\n  ) {\n    this.lastFocusedKey = lastFocusedKey;\n    this.layoutToRestore = layoutToRestore;\n    this.removedFromSideBarIds = new Set(removedFromSideBarIds);\n    const invalidWindows = Object.keys(this.windows).filter(\n      (key) =>\n        this.removedFromSideBarIds.has(key) && this.windows[key].isVisible\n    );\n    if (invalidWindows.length > 0) {\n      throw new Error(\n        `Invalid ToolWindowsState. The following windows are set as visible but are removed from the sidebar: ${invalidWindows}`\n      );\n    }\n  }\n\n  hide(targetKey: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow, key) =>\n      key === targetKey\n        ? {\n            ...toolWindow,\n            isVisible: false,\n          }\n        : toolWindow\n    );\n  }\n  hideAll(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) =>\n        getViewModeType(toolWindow.viewMode) === \"float\"\n          ? toolWindow\n          : {\n              ...toolWindow,\n              isVisible: false,\n            },\n      { layoutToRestore: this.windows }\n    );\n  }\n\n  /**\n   * Restores windows to the state before hideAll.\n   */\n  restoreWindows(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) => this.layoutToRestore[key] || toolWindow\n    );\n  }\n\n  lastFocused(key: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow) => toolWindow, {\n      lastFocusedKey: key,\n    });\n  }\n\n  show(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const closableViewModes: ViewMode[] = [];\n    if (target.viewMode === \"undock\") {\n      closableViewModes.push(\"undock\");\n    } else if (isDocked(target)) {\n      closableViewModes.push(\"docked_unpinned\", \"docked_pinned\", \"undock\");\n    }\n    return this.mapWindows(\n      (toolWindow, key) => {\n        if (key === targetKey) {\n          return {\n            ...toolWindow,\n            isVisible: true,\n          };\n        }\n        if (\n          toolWindow.isVisible &&\n          areInSameSection(target, toolWindow) &&\n          closableViewModes.includes(toolWindow.viewMode)\n        ) {\n          return { ...toolWindow, isVisible: false };\n        }\n        return toolWindow;\n      },\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds].filter(\n          (key) => key !== targetKey\n        ),\n      }\n    );\n  }\n\n  toggle(targetKey: Key): ToolWindowsState {\n    return this.windows[targetKey]?.isVisible\n      ? this.hide(targetKey)\n      : this.show(targetKey);\n  }\n\n  blur(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target || !isAutoHide(target)) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  // TODO: initiate floatingBound when changing viewMode to float or window and there is no previous floatingBound\n  changeViewMode(targetKey: Key, viewMode: ViewMode): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          viewMode,\n        };\n      }\n      const viewModeType = getViewModeType(toolWindow.viewMode);\n      if (\n        toolWindow.isVisible &&\n        viewModeType !== \"float\" &&\n        areInSameSection(toolWindow, target) &&\n        viewModeType === getViewModeType(viewMode)\n      ) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  move(targetKey: Key, index: number): ToolWindowsState;\n  move(targetKey: Key, side: SideInfo, index?: number): ToolWindowsState;\n  move(\n    targetKey: Key,\n    sideOrIndex: SideInfo | number,\n    index?: number\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const targetSide = typeof sideOrIndex === \"object\" ? sideOrIndex : target;\n    const targetIndex = typeof sideOrIndex === \"number\" ? sideOrIndex : index;\n    const targetSideWindows = Object.entries(this.windows).filter(([, value]) =>\n      areInSameSection(targetSide, value)\n    );\n    const indexInTargetSide = targetSideWindows.findIndex(\n      ([, window]) => window === target\n    );\n    const sortedTargetWindows: Array<[Key, ToolWindowState]> =\n      indexInTargetSide < 0\n        ? insert(\n            targetIndex ?? -1,\n            [targetKey, { ...target, ...targetSide }],\n            targetSideWindows\n          )\n        : move(\n            indexInTargetSide,\n            targetIndex ?? indexInTargetSide,\n            targetSideWindows\n          );\n    const newTargetSideWindows = fromPairs(\n      sortedTargetWindows.map(([key, value], index) => {\n        let newValue = value;\n        if (value.order !== index) {\n          newValue = { ...value, order: index };\n        }\n        const targetViewMode = getViewModeType(target.viewMode);\n        if (\n          key !== targetKey &&\n          target.isVisible &&\n          value.isVisible &&\n          targetViewMode !== \"float\" &&\n          getViewModeType(value.viewMode) === targetViewMode\n        ) {\n          newValue = { ...value, isVisible: false };\n        }\n        return [`${key}`, newValue];\n      })\n    );\n    return this.mapWindows((value, key) => newTargetSideWindows[key] || value);\n  }\n\n  stretchWidth(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"width\");\n  }\n\n  stretchHeight(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"height\");\n  }\n\n  setFloatingBound(\n    targetKey: Key,\n    floatingBounds: WindowBounds\n  ): ToolWindowsState {\n    return this.update(targetKey, \"floatingBounds\", floatingBounds);\n  }\n\n  removeFromSidebar(targetKey: Key): ToolWindowsState {\n    return this.mapWindows(\n      (state, key) =>\n        key === targetKey\n          ? {\n              ...state,\n              isVisible: false,\n            }\n          : state,\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds, targetKey],\n      }\n    );\n  }\n\n  mapWindows(\n    mapFn: (toolWindow: ToolWindowState, key: string) => ToolWindowState,\n    options: ConstructorParameters<typeof ToolWindowsState>[1] = {}\n  ) {\n    return new ToolWindowsState(mapObjIndexed(mapFn, this.windows), {\n      lastFocusedKey: this.lastFocusedKey,\n      layoutToRestore: this.layoutToRestore,\n      removedFromSideBarIds: this.removedFromSideBarIds,\n      ...options,\n    });\n  }\n\n  private update<K extends keyof ToolWindowState>(\n    targetKey: Key,\n    key: K,\n    value: ToolWindowState[K]\n  ) {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((window) => {\n      if (window === target) {\n        return {\n          ...window,\n          [key]: value,\n        };\n      }\n      return window;\n    });\n  }\n\n  private stretch(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number },\n    property: \"width\" | \"height\"\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const viewModeType = getViewModeType(target.viewMode);\n    if (viewModeType === \"float\") {\n      return this.mapWindows((window) => {\n        if (window === target) {\n          const currentFloatingBound = window.floatingBounds!;\n          return {\n            ...window,\n            floatingBounds: {\n              ...currentFloatingBound,\n              [property]: currentFloatingBound[property] + value,\n            },\n          };\n        }\n        return window;\n      });\n    }\n    const expectedProperty = isHorizontalToolWindow(target.anchor)\n      ? \"height\"\n      : \"width\";\n    if (expectedProperty !== property) {\n      return this;\n    }\n    const containerSize = containerBounds[property];\n    const newValue = containerSize * target.weight + value;\n    const isNewValueValid = clamp(0, containerSize, newValue) === newValue;\n    if (isNewValueValid) {\n      if (viewModeType === \"docked\") {\n        return this.resizeDock(target.anchor, newValue, containerBounds);\n      } else {\n        return this.resizeUndock(target.anchor, newValue, containerBounds);\n      }\n    }\n    return this;\n  }\n\n  resizeDock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(true, anchor, size, containerBounds);\n  }\n\n  resizeUndock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(false, anchor, size, containerBounds);\n  }\n\n  resizeDockSplitView(anchor: Anchor, weight: number): ToolWindowsState {\n    return this.mapWindows((window) => {\n      if (window.anchor === anchor && window.isVisible && isDocked(window)) {\n        return {\n          ...window,\n          sideWeight: window.isSplit ? weight : 1 - weight,\n        };\n      }\n      return window;\n    });\n  }\n\n  private resizeSide(\n    dock: boolean,\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.mapWindows((window) => {\n      const isInResizingView = dock\n        ? isDocked(window)\n        : window.viewMode === \"undock\";\n      if (window.anchor === anchor && isInResizingView && window.isVisible) {\n        const containerSize = !isHorizontalToolWindow(anchor)\n          ? containerBounds.width\n          : containerBounds.height;\n        return {\n          ...window,\n          weight: size / containerSize,\n        };\n      }\n      return window;\n    });\n  }\n}\n\nexport const toolWindowState = ({\n  viewMode = \"docked_pinned\",\n  ...inputs\n}: Partial<ToolWindowState> = {}): ToolWindowState => ({\n  anchor: \"left\",\n  isSplit: false,\n  viewMode: viewMode,\n  order: 1,\n  weight: 0.2,\n  sideWeight: 0.5,\n  isVisible: false,\n  floatingBounds:\n    getViewModeType(viewMode) === \"float\"\n      ? {\n          left: 300,\n          top: 300,\n          width: 600,\n          height: 300,\n        }\n      : undefined,\n  ...inputs,\n});\n","export type Anchor = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport const getAnchorOrientation = (\n  anchor: Anchor\n): \"horizontal\" | \"vertical\" =>\n  isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\";\n\nexport const isHorizontalToolWindow = (anchor: Anchor) =>\n  anchor === \"top\" || anchor === \"bottom\";\n\nexport const theOtherSide = (anchor: Anchor) =>\n  ({\n    left: \"right\" as const,\n    right: \"left\" as const,\n    top: \"bottom\" as const,\n    bottom: \"top\" as const,\n  }[anchor]);\n","import React, {\n  FocusEventHandler,\n  RefObject,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport { useWindowMoveHandle } from \"@intellij-platform/core/Window\";\n\nexport function useToolWindow(\n  {\n    containerRef,\n    contentRef,\n    focusableContentRef,\n  }: {\n    containerRef: RefObject<HTMLElement>;\n    contentRef: RefObject<Element>;\n    focusableContentRef: RefObject<{ focus: () => void }>;\n  },\n  { onFocusChange }: { onFocusChange?: (focused: boolean) => void } = {}\n) {\n  const [contentHasFocus, setContentHasFocus] = useState(false);\n  /**\n   * NOTE: useFocusWithin form @react-aria/interactions (at least until 3.5.1) has a couple of problem, because of which\n   * we may need to implement our own version of it.\n   * - It doesn't play nice with FocusScope with `contain` set to true. When something is blurred, FocusScope prevents\n   *   that by restoring focus back immediately. but the blur event is already caught by useFocusWithin. One solution\n   *   would be to change useFocusWithin implementation to ignore these blur events that are immediately followed\n   *   by a focus event that keeps the focus in.\n   * - useFocusWithin has an inconsistent behaviour when it comes to Portals. Since it uses react props for handling\n   *   focus and blur, the [react tree determines event bubbling](https://reactjs.org/docs/portals.html#event-bubbling-through-portals),\n   *   which can be a very nice feature, when an overlay (rendered in a portal) grabs the focus, which should still\n   *   be seen as \"within\". But the problems is that the current implementation uses DOM `.contains(e.relatedTarget)`\n   *   method to determine if focus is no longer within. First of all, using react tree or dom tree to determine \"within\"\n   *   can be seen as an option perhaps. Secondly, it should be consistent on focus and blur.\n   *\n   *   Right now these problems are no big deal. but it may become an issue when portals are used within the content\n   *   of the tool window.\n   *\n   * NOTE: In the original implementation, when a heading toolbar button opens a menu, and focus goes to menu, the\n   * header loses the focus appearance, ant it relies only on content having the focus.\n   */\n  const { focusWithinProps: contentFocusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setContentHasFocus,\n  });\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: onFocusChange,\n  });\n\n  const { toolWindowProps: autoHideProps } = useAutoHide();\n\n  const { focusDelegatorProps } = useFocusDelegator({\n    focusableContentRef: focusableContentRef,\n    ref: containerRef,\n  });\n\n  // If there is no focusable content rendered in the tool window, nothing will be autofocused. In that case\n  // we will focus the tool window container itself as a fallback.\n  useEffect(() => {\n    if (\n      !document.activeElement ||\n      !containerRef.current?.contains(document.activeElement)\n    ) {\n      containerRef.current?.focus();\n    }\n  }, []);\n\n  const { moveHandleProps } = useWindowMoveHandle();\n\n  return {\n    contentHasFocus,\n    toolWindowProps: mergeProps(\n      focusDelegatorProps,\n      focusWithinProps,\n      autoHideProps,\n      {\n        tabIndex: -1,\n      }\n    ),\n    toolWindowContentProps: contentFocusWithinProps,\n    toolWindowHeaderProps: moveHandleProps,\n  };\n}\n\n/**\n * Applies the auto hide behaviour of tool window based on view mode information and by handling focus and blur events,\n * on the root tool window element. Returns the necessary props that should be applied to the root tool window element.\n * The implementation is not perfect and may not 100% match the original Intellij Platform implementation.\n * If this focus based implementation for auto hide proves to be fragile and not good enough in future,\n * an alternative approach would be to move auto hide logic to the state management logic as much as possible,\n * and limit the focus based auto-hiding to only when the focus goes within the main content area. That should have\n * less focus-related edge cases.\n * TODO: auto hide behaviour should be moved to the core ToolWindows API. ToolWindows now renders a FocusScope and\n * handles focus events on any tool window, to track last focused tool window.\n */\nfunction useAutoHide() {\n  const { blur } = useToolWindowState();\n  const hideTimeoutId = useRef<number | null>(null);\n  const { focusWithinProps: windowFocusWithinProps } = useFocusWithin({\n    onBlurWithin: (e) => {\n      // setTimeout and windowHasFocusRef is to work around the problem with useFocusWithin, described above.\n      hideTimeoutId.current = window.setTimeout(() => {\n        // Sometimes when the element is blurred, the subsequent focus that is triggered by FocusScope to keep the focus\n        // is a little delayed and therefore after the timeout reaches. It seem to happen only when a non-focusable\n        // area is clicked. We mitigate it by ignoring blur events where nothing is focused. It's not a problem\n        // at least with `DefaultToolWindow` implementation that uses a FocusScope.\n        const isSomethingElseFocused = e.relatedTarget;\n        if (isSomethingElseFocused) {\n          blur();\n        }\n      });\n    },\n    onFocusWithin: () => {\n      if (hideTimeoutId.current !== null) {\n        clearTimeout(hideTimeoutId.current);\n        hideTimeoutId.current = null;\n      }\n    },\n  });\n  return {\n    toolWindowProps: windowFocusWithinProps,\n  };\n}\n\n/**\n * Allows for having a focus scope (or simply a focusable element) get focused in a broader container,\n * by handling the focus element on the container, and forwarding the focus onto the target focus scope or element,\n * if currently focused element is not within that boundary.\n * Ensuring the container element is focusable is not something this hook does.\n */\nfunction useFocusDelegator({\n  ref,\n  focusableContentRef,\n}: {\n  ref: React.RefObject<Element>;\n  focusableContentRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const onFocus: FocusEventHandler = (event) => {\n    if (event.target !== event.currentTarget) {\n      // only when this container is focused. not when anything inside is focused.\n      return;\n    }\n    const possiblyBlurredElement = event.relatedTarget;\n    if (\n      possiblyBlurredElement instanceof Element &&\n      ref.current?.contains(possiblyBlurredElement) &&\n      event.currentTarget !== ref.current\n    ) {\n      // if anything inside the content is being blurred while the container is getting focused, don't do anything\n      // let the focus stay where it is.\n      return;\n    }\n    focusableContentRef.current?.focus();\n  };\n  return { focusDelegatorProps: { onFocus } };\n}\n","import React from \"react\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport {\n  Action,\n  useAction,\n  useActionGroup,\n} from \"@intellij-platform/core/ActionSystem\";\nimport {\n  ActionItem,\n  ActionsMenu,\n} from \"@intellij-platform/core/ActionSystem/components/ActionsMenu\";\nimport {\n  MOVE_TO_ACTION_GROUP,\n  VIEW_MODE_ACTION_IDS,\n  ViewModeToActionId,\n} from \"./useToolWindowActions\";\nimport { REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID } from \"./ToolWindowActionIds\";\n\n/**\n * Tool window gear icon menu, with a set of default actions and some extra ones.\n * TODO: add support for extra actions when action system is progressed a little.\n */\nexport function ToolWindowSettingsIconMenu({\n  menuProps,\n}: {\n  menuProps: React.HTMLAttributes<HTMLElement>;\n}) {\n  const { state } = useToolWindowState();\n\n  const viewModeActions: Action[] = useActionGroup(VIEW_MODE_ACTION_IDS);\n  const moveToActions: Action[] = useActionGroup(MOVE_TO_ACTION_GROUP);\n\n  const resizeActions: Action[] = useActionGroup([\n    \"ResizeToolWindowLeft\",\n    \"ResizeToolWindowRight\",\n    \"ResizeToolWindowTop\",\n    \"ResizeToolWindowBottom\",\n    \"MaximizeToolWindow\",\n  ]);\n  const removeFromSideBarAction = useAction(\n    REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID\n  )!;\n  const gearIconActions: Array<ActionItem> = [\n    {\n      id: \"viewMode\",\n      title: \"View Mode\",\n      actions: viewModeActions,\n    },\n    {\n      id: \"moveTo\",\n      title: \"Move to\",\n      actions: moveToActions,\n    },\n    { id: \"resize\", title: \"Resize\", actions: resizeActions },\n    new DividerItem(),\n    removeFromSideBarAction,\n  ];\n  return (\n    <ActionsMenu\n      actions={gearIconActions}\n      menuProps={menuProps}\n      selectedKeys={[ViewModeToActionId[state.viewMode]]}\n    />\n  );\n}\n","import React, { HTMLProps } from \"react\";\nimport { ActionButton } from \"@intellij-platform/core/ActionButton\";\nimport { ActionToolbar } from \"@intellij-platform/core/ActionToolbar/ActionToolbar\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { MenuTrigger } from \"@intellij-platform/core/Menu/MenuTrigger\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledHorizontalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme/Theme\";\nimport { Action } from \"@intellij-platform/core/ActionSystem/components\";\nimport { ToolWindowSettingsIconMenu } from \"./ToolWindowSettingsIconMenu\";\nimport {\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\n\nexport interface ToolWindowHeaderProps\n  extends Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\"> {\n  contentHasFocus?: boolean;\n  additionalActions?: React.ReactNode;\n}\n\nconst StyledToolWindowHeader = styled.div<{ active: boolean }>`\n  display: flex;\n  align-items: center;\n  padding: 0 2px 0 4px;\n  overflow: hidden; // for the negative margin applied on StyledToolWindowHeaderActions\n  border-bottom: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Header.borderColor\" as UnknownThemeProp<\"ToolWindow.Header.borderColor\">\n      ) ||\n      theme.color(\"DefaultTabs.borderColor\") ||\n      theme.commonColors.contrastBorder};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\"ToolWindow.Header.background\") ||\n        theme.color(\n          \"ToolWindow.header.active.background\" as UnknownThemeProp<\"ToolWindow.header.active.background\">\n        ) ||\n        \"#E2E6EC\"\n      : theme.color(\"ToolWindow.Header.inactiveBackground\") ||\n        theme.color(\"ToolWindow.Header.background\") ||\n        \"#ECECEC\"};\n`;\n\nconst StyledToolWindowHeaderActions = styled.div`\n  margin-right: -4px;\n`;\n\nconst StyledToolWindowHeaderContent = styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n`;\n\nexport const DefaultToolWindowHeader: React.FC<ToolWindowHeaderProps> = ({\n  children,\n  additionalActions,\n  contentHasFocus = false,\n  ...otherProps\n}) => {\n  return (\n    <StyledToolWindowHeader active={contentHasFocus} {...otherProps}>\n      <StyledToolWindowHeaderContent>{children}</StyledToolWindowHeaderContent>\n      <StyledToolWindowHeaderActions>\n        <ActionToolbar>\n          {additionalActions && (\n            <>\n              {additionalActions}\n              <StyledHorizontalSeparator />\n            </>\n          )}\n          <Action.Button actionId={DOCK_TOOL_WINDOW_ACTION_ID} />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => {\n              return <ToolWindowSettingsIconMenu menuProps={menuProps} />;\n            }}\n          >\n            {(props, ref) => (\n              <TooltipTrigger tooltip={<ActionTooltip actionName=\"Options\" />}>\n                <ActionButton {...props} ref={ref}>\n                  <PlatformIcon icon=\"general/gearPlain\" />\n                </ActionButton>\n              </TooltipTrigger>\n            )}\n          </MenuTrigger>\n          <Action.Button actionId={HIDE_ACTIVE_WINDOW_ACTION_ID} />\n        </ActionToolbar>\n      </StyledToolWindowHeaderActions>\n    </StyledToolWindowHeader>\n  );\n};\n","import React, { useContext, useMemo, useRef } from \"react\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { FocusScope } from \"@intellij-platform/core/utils/FocusScope\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { useToolWindow } from \"./useToolWindow\";\nimport { DefaultToolWindowHeader } from \"./DefaultToolWindowHeader\";\nimport { useToolWindowActions } from \"./useToolWindowActions\";\n\nexport interface DefaultToolWindowProps extends DOMProps {\n  /**\n   * title to be shown on the left side of the tool window header.\n   */\n  headerContent?: React.ReactNode;\n  /**\n   * additional action buttons to be rendered before the default gear and hide buttons.\n   */\n  additionalActions?: React.ReactNode;\n  /**\n   * Actions to be provided in the tool window, in addition to the default tool window actions.\n   */\n  actions?: Record<string, ActionDefinition>;\n  onFocusChange?: (focused: boolean) => void;\n}\n\nconst StyledToolWindowContainer = styled.div`\n  outline: none;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  flex: 1;\n`;\nconst StyledToolWindowContent = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\ninterface DefaultToolWindowContextObj {\n  hasFocus?: boolean;\n}\n\nconst DefaultToolWindowContext =\n  React.createContext<DefaultToolWindowContextObj>({\n    hasFocus: false,\n  });\n\nexport const useDefaultToolWindowContext = () =>\n  useContext(DefaultToolWindowContext);\n/**\n * Default component for rendering the content of a tool window. It supports a header and a scrollable area.\n * The header supports showing a content, and some default+custom actions on the right.\n *\n * @see MultiContentToolWindow\n *\n * Remaining features:\n * - Additional gear menu actions.\n *\n */\nexport const DefaultToolWindow: React.FC<DefaultToolWindowProps> = ({\n  headerContent,\n  children,\n  additionalActions,\n  onFocusChange,\n  actions,\n  ...otherProps\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const focusableContentRef = useRef<{ focus: () => void }>(null);\n  const {\n    // NOTE: we might as well use :focus-within and target StyledToolWindowHeader to set the background, but it's not\n    // a clear improvement.\n    contentHasFocus,\n    toolWindowProps,\n    toolWindowContentProps,\n    toolWindowHeaderProps,\n  } = useToolWindow(\n    { containerRef, contentRef, focusableContentRef },\n    {\n      onFocusChange,\n    }\n  );\n\n  const defaultToolWindowContext = useMemo(\n    () => ({\n      hasFocus: contentHasFocus,\n    }),\n    [contentHasFocus]\n  );\n  const toolWindowActions = useToolWindowActions();\n  const allActions = {\n    ...toolWindowActions,\n    ...actions,\n  };\n\n  return (\n    <ActionsProvider actions={allActions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledToolWindowContainer\n          {...mergeProps(\n            toolWindowProps,\n            shortcutHandlerProps,\n            filterDOMProps(otherProps)\n          )}\n          ref={containerRef}\n        >\n          <DefaultToolWindowContext.Provider value={defaultToolWindowContext}>\n            <DefaultToolWindowHeader\n              additionalActions={additionalActions}\n              contentHasFocus={contentHasFocus}\n              {...toolWindowHeaderProps}\n            >\n              {headerContent}\n            </DefaultToolWindowHeader>\n            <StyledToolWindowContent\n              ref={contentRef}\n              {...toolWindowContentProps}\n            >\n              {/**\n               * FIXME: adding `contain` prevents focus from moving to another focus scope both with mouse and keyboard.\n               * If we want to follow the Intellij Platform behaviour exactly, we need a kind of focus containment, where\n               * focus is trapped only for keyboard interaction, and user can still move focus by clicking another scope.\n               * Maybe a custom useFocusContainment hook and a separate option for activating it on our own FocusScope.\n               */}\n              <FocusScope ref={focusableContentRef} autoFocus>\n                {children}\n              </FocusScope>\n            </StyledToolWindowContent>\n          </DefaultToolWindowContext.Provider>\n        </StyledToolWindowContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n","import React from \"react\";\nimport { Shortcut, useAction } from \"@intellij-platform/core/ActionSystem\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { getActivateToolWindowActionId } from \"./useToolWindowsActions\";\n\nconst getToolWindowNumberFromShortcut = (shortcut: Shortcut): number | null => {\n  const num =\n    shortcut.type === \"keyboard\" &&\n    shortcut.firstKeyStroke.modifiers?.length === 1 &&\n    [\"Alt\", \"Meta\", \"Control\"].includes(shortcut.firstKeyStroke.modifiers[0]) &&\n    shortcut.firstKeyStroke.code.match(/^(Digit|Numpad)([0-9])$/)?.[2];\n  if (num) {\n    return parseInt(num);\n  }\n  return null;\n};\n\n/**\n * Default UI for the toolbar button (aka. stripe button) of the tool window.\n * - Renders the title and icon for the tool window\n * - Optionally shows the number before the title, if a numeric shortcut is set for the corresponding ActivateToolWindow\n *   action, in the currently applied keymap.\n * - Adds an Action Tooltip\n */\nexport const DefaultToolWindowToolbarButton = ({\n  id,\n  title,\n  icon,\n  showNumber = true,\n}: {\n  id: React.Key;\n  title: string;\n  icon: React.ReactNode;\n  showNumber?: boolean;\n}) => {\n  const action = useAction(getActivateToolWindowActionId(`${id}`));\n\n  const number = action?.shortcuts\n    ?.map(getToolWindowNumberFromShortcut)\n    .find(Number.isInteger);\n  return (\n    <TooltipTrigger\n      tooltip={<ActionTooltip actionName={title} shortcut={action?.shortcut} />}\n    >\n      <span>\n        {icon}\n        &nbsp;\n        {number != null && showNumber ? (\n          <>\n            <u>{number}</u>:&nbsp;\n          </>\n        ) : null}\n        {title}\n      </span>\n    </TooltipTrigger>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { indexBy } from \"ramda\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  ToolWindowRefValue,\n  ToolWindows,\n  ToolWindowsProps,\n} from \"@intellij-platform/core/ToolWindows\";\nimport { useToolWindowsActions } from \"./useToolWindowsActions\";\nimport { DefaultToolWindowToolbarButton } from \"./DefaultToolWindowToolbarButton\";\nimport { ActionsProvider } from \"@intellij-platform/core/ActionSystem\";\n\ninterface DefaultToolWindow {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactNode;\n}\n\n/**\n * A wrapper around ToolWindows, which provides default actions. It also expects windows to have a `title` and an `icon`\n * instead of more generic `toolbarButton`. The `title` and `icon` are then used in toolbar button, and also in the\n * actions that are dynamically created for each window to toggle/focus the tool window.\n */\nexport const DefaultToolWindows = React.forwardRef(function DefaultToolWindows(\n  {\n    windows: toolWindows,\n    toolWindowsState,\n    showNumbers,\n    ...props\n  }: Omit<ToolWindowsProps, \"windows\"> & {\n    windows: DefaultToolWindow[];\n    showNumbers?: boolean;\n  },\n  forwardedRef: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const toolWindowsRef = useObjectRef(forwardedRef);\n  const windowById = indexBy(({ id }) => id, toolWindows);\n  const actions = useToolWindowsActions({\n    toolWindowsRef,\n    toolWindowsState,\n    getPresentation: (id) => windowById[id],\n  });\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <ToolWindows\n          {...props}\n          ref={toolWindowsRef}\n          toolWindowsState={toolWindowsState}\n          windows={toolWindows.map(({ id, icon, content, title }) => ({\n            id,\n            toolbarButton: (\n              <DefaultToolWindowToolbarButton\n                id={id}\n                icon={icon}\n                title={title}\n                showNumber={showNumbers}\n              />\n            ),\n            content,\n          }))}\n          containerProps={mergeProps(\n            shortcutHandlerProps,\n            props.containerProps || {}\n          )}\n        />\n      )}\n    </ActionsProvider>\n  );\n});\n","import React, { Key, useEffect, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { DefaultToolWindow, DefaultToolWindowProps } from \"./DefaultToolWindow\";\nimport { TabItem } from \"../Tabs/TabItem\";\nimport { usePrevious } from \"../utils/usePrevious\";\nimport { ToolWindowTabs } from \"../Tabs/ToolWindowTabs/ToolWindowTabs\";\n\nexport interface MultiContentToolWindowProps\n  extends Pick<DefaultToolWindowProps, \"additionalActions\"> {\n  /**\n   * List of contents that will be accessible with a list of grouped or ungrouped tabs in the tool window header.\n   */\n  children:\n    | React.ReactElement<MultiContentToolWindowContentProps>[]\n    | React.ReactElement<MultiContentToolWindowContentProps>;\n  /**\n   * Key of currently active content\n   */\n  activeKey?: Key;\n  defaultActiveKey?: Key;\n  onActiveKeyChange?: (key: Key) => void;\n  /**\n   * If true, it groups tabs in a dropdown instead.\n   *\n   * @default false\n   */\n  groupTabs?: boolean;\n  /**\n   * The content shown as the title of the tool window, before content switcher (tabs or dropdown).\n   * For more control over header content, you can pass a function which accepts rendered content switcher,\n   * and then you can compose it with other content as you wish. Use case examples of function variant:\n   * - You want to render a title before the content switcher, and something after the tabs. Like a \"+\" button in\n   *   terminal.\n   * - You want to conditionally move inner-content header up to the tool window header, if there is only one tab. In\n   *   that case you don't need to render the content switcher at all. An example is the new design in the \"Run\"\n   *   tool window.\n   */\n  headerContent?:\n    | React.ReactNode\n    | ((props: { renderedViewSwitcher: React.ReactNode }) => React.ReactNode);\n}\n\n/**\n * Implemented on top of DefaultToolWindow, allows for multiple tabbed content within a tool window.\n * Remaining features:\n * - Although trivial, group tabs action in tool window header gear icon is intentionally left unimplemented for now,\n *   until an increment on action system is done.\n * - Grouped mode is not implemented currently, as we don't have a dropdown component. Though it seems it's just a\n *   MenuTrigger and some trigger with a arrow icon.\n */\nexport const MultiViewToolWindow = ({\n  groupTabs,\n  children,\n  headerContent,\n  ...props\n}: MultiContentToolWindowProps) => {\n  const [isToolWindowFocused, setToolWindowFocused] = useState(false);\n  const [activeKey, setActiveKey] = useControlledState(\n    props.activeKey!,\n    props.defaultActiveKey!,\n    props.onActiveKeyChange!\n  );\n  const contents = React.Children.toArray(children)\n    .filter(\n      (\n        child\n      ): child is React.ReactElement<MultiContentToolWindowContentProps> => {\n        const validChild =\n          React.isValidElement(child) &&\n          child.type === MultiContentToolWindowContent;\n        if (!validChild) {\n          // FIXME: only warn in dev mode\n          console.warn(\n            \"You are not supposed to render anything but MultiContentToolWindowContent inside MultiViewToolWindow. Rendered: \",\n            child\n          );\n        }\n        return validChild;\n      }\n    )\n    // The following map is because of what React.Children.toArray does to keys: https://stackoverflow.com/q/33791401/1493081\n    // It doesn't look like a good idea since and there might be better ways to fix this, or at least make sure it would\n    // work in all cases. FIXME\n    .map((content) => ({ ...content, key: `${content.key}`.slice(2) as Key }));\n  const renderContentSwitcher = () => {\n    if (groupTabs) {\n      console.error(\n        \"groupTab is not supported yet in MultiViewToolWindow. Will fallback to ungrouped tabs\"\n      );\n    }\n    return (\n      <ToolWindowTabs\n        noBorders\n        items={contents}\n        active={isToolWindowFocused}\n        selectedKey={activeKey}\n        onSelectionChange={setActiveKey}\n      >\n        {(item) => <TabItem key={item.key}>{item.props.tabContent}</TabItem>}\n      </ToolWindowTabs>\n    );\n  };\n  const renderedViewSwitcher = renderContentSwitcher();\n\n  // We set the active key if it's not set or is invalid. A common scenario is when tabs are closable, and when the\n  // active tab is closed. You would always want to previous tab to get activated in such cases, instead of the first\n  // one. By having the logic here, there is no need to repeat the same logic in each use case. Although, it can also\n  // be moved into a state management utility for tabs, maybe in the future.\n\n  const keys = contents.map(({ key }) => key);\n  const previousKeys = usePrevious(keys);\n  useEffect(() => {\n    if (!keys.includes(activeKey)) {\n      const newActiveKey = keys[previousKeys.indexOf(activeKey) - 1] ?? keys[0];\n      if (newActiveKey != undefined) {\n        setActiveKey(newActiveKey);\n      }\n    }\n  });\n\n  const activeContent = contents.find(\n    (content) => activeKey == undefined || activeKey === content.key\n  );\n  return (\n    <DefaultToolWindow\n      onFocusChange={setToolWindowFocused}\n      headerContent={\n        typeof headerContent === \"function\" ? (\n          headerContent({ renderedViewSwitcher })\n        ) : (\n          <>\n            {headerContent}\n            {renderedViewSwitcher}\n          </>\n        )\n      }\n      additionalActions={props.additionalActions}\n    >\n      {activeContent?.props.children}\n    </DefaultToolWindow>\n  );\n};\n\nexport interface MultiContentToolWindowContentProps {\n  key: Key;\n  /**\n   * Used in the corresponding tab.\n   */\n  tabContent: React.ReactNode;\n\n  children: React.ReactNode;\n}\n\nconst MultiContentToolWindowContent =\n  ({}: MultiContentToolWindowContentProps) => {\n    throw new Error(\n      \"MultiContentToolWindowContent is not meant to be rendered directly. You should only use it in MultiViewToolWindow\"\n    );\n  };\n\nMultiViewToolWindow.View = MultiContentToolWindowContent;\n","export const HIDE_ALL_WINDOWS_ACTION_ID = \"HideAllWindows\";\nexport const JUMP_TO_LAST_WINDOW_ACTION_ID = \"JumpToLastWindow\";\nexport const HIDE_ACTIVE_WINDOW_ACTION_ID = \"HideActiveWindow\";\nexport const MAXIMIZE_TOOL_WINDOW_ACTION_ID = \"MaximizeToolWindow\";\nexport const DOCK_TOOL_WINDOW_ACTION_ID = \"DockToolWindow\";\nexport const RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID = \"ResizeToolWindowRight\";\nexport const RESIZE_TOOL_WINDOW_LEFT_ACTION_ID = \"ResizeToolWindowLeft\";\nexport const RESIZE_TOOL_WINDOW_TOP_ACTION_ID = \"ResizeToolWindowTop\";\nexport const RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID = \"ResizeToolWindowBottom\";\nexport const DOCK_PINNED_MODE_ACTION_ID = \"DockPinnedMode\";\nexport const DOCK_UNPINNED_MODE_ACTION_ID = \"DockUnpinnedMode\";\nexport const UNDOCK_MODE_ACTION_ID = \"UndockMode\";\nexport const FLOAT_MODE_ACTION_ID = \"FloatMode\";\nexport const WINDOW_MODE_ACTION_ID = \"WindowMode\";\nexport const FOCUS_EDITOR_ACTION_ID = \"FocusEditor\";\nexport const REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID =\n  \"RemoveToolWindowFromSidebar\"; // doesn't show up in keymap. Not sure what the id is in the original impl.\n","import React from \"react\";\nimport { zipObj } from \"ramda\";\nimport {\n  Anchor,\n  isHorizontalToolWindow,\n  useToolWindowState,\n  ViewMode,\n} from \"@intellij-platform/core/ToolWindows\";\nimport { ActionDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport {\n  DOCK_PINNED_MODE_ACTION_ID,\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  DOCK_UNPINNED_MODE_ACTION_ID,\n  FLOAT_MODE_ACTION_ID,\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  UNDOCK_MODE_ACTION_ID,\n  WINDOW_MODE_ACTION_ID,\n} from \"./ToolWindowActionIds\";\n\n// Resize steps in Intellij Platform is calculated based on the size of a \"W\" character and some\n// configuration (ide.windowSystem.hScrollChars). Although it's technically feasible, it seems not necessary\nconst HEIGHT_RESIZE_STEP = 16 * 5;\nconst WIDTH_RESIZE_STEP = 13 * 5;\n\nexport const anchors: Array<{\n  anchor: Anchor;\n  isSplit: boolean;\n  id: string;\n}> = [\n  { id: \"moveToLeftTop\", anchor: \"left\", isSplit: false },\n  { id: \"moveToLeftBottom\", anchor: \"left\", isSplit: true },\n  { id: \"moveToBottomLeft\", anchor: \"bottom\", isSplit: false },\n  { id: \"moveToBottomRight\", anchor: \"bottom\", isSplit: true },\n  { id: \"moveToRightTop\", anchor: \"right\", isSplit: true },\n  { id: \"moveToRightBottom\", anchor: \"right\", isSplit: false },\n  { id: \"moveToTopRight\", anchor: \"top\", isSplit: true },\n  { id: \"moveToTopLeft\", anchor: \"top\", isSplit: false },\n];\n\nconst getAnchorName = ({\n  anchor,\n  isSplit,\n}: {\n  anchor: Anchor;\n  isSplit: boolean;\n}) =>\n  `${anchor[0].toUpperCase()}${anchor.slice(1)} ${\n    isHorizontalToolWindow(anchor)\n      ? isSplit\n        ? \"Right\"\n        : \"Left\"\n      : isSplit\n      ? \"Bottom\"\n      : \"Top\"\n  }`;\n\nexport const ViewModeToActionId: Record<ViewMode, string> = {\n  docked_pinned: DOCK_PINNED_MODE_ACTION_ID,\n  docked_unpinned: DOCK_UNPINNED_MODE_ACTION_ID,\n  undock: UNDOCK_MODE_ACTION_ID,\n  float: FLOAT_MODE_ACTION_ID,\n  window: WINDOW_MODE_ACTION_ID,\n};\n\nexport const VIEW_MODE_ACTION_IDS = Object.values(ViewModeToActionId);\n\nexport const MOVE_TO_ACTION_GROUP = anchors.map(\n  (anchor) => `TW.MoveTo.${anchor.id}`\n);\n\nexport function useToolWindowActions(): { [key: string]: ActionDefinition } {\n  const {\n    stretchWidth,\n    stretchHeight,\n    changeViewMode,\n    moveToSide,\n    focusMainContent,\n    hide,\n    remove,\n    state,\n  } = useToolWindowState();\n\n  if (!state) {\n    // FIXME: when window is removed, a last render happens with the new ToolWindowsState, which doesn't have state\n    //  for the removed tool window. Need to understand why that happens.\n    return {};\n  }\n  const actions: { [key: string]: ActionDefinition } = {\n    [DOCK_PINNED_MODE_ACTION_ID]: {\n      title: \"Dock Pinned\",\n      actionPerformed: () => {\n        changeViewMode(\"docked_pinned\");\n      },\n    },\n    [DOCK_UNPINNED_MODE_ACTION_ID]: {\n      title: \"Dock Unpinned\",\n      actionPerformed: () => {\n        changeViewMode(\"docked_unpinned\");\n      },\n    },\n    [UNDOCK_MODE_ACTION_ID]: {\n      title: \"Undock\",\n      actionPerformed: () => {\n        changeViewMode(\"undock\");\n      },\n    },\n    [FLOAT_MODE_ACTION_ID]: {\n      title: \"Float\",\n      actionPerformed: () => {\n        changeViewMode(\"float\");\n      },\n    },\n    [WINDOW_MODE_ACTION_ID]: {\n      title: \"Window\",\n      actionPerformed: () => {\n        changeViewMode(\"window\");\n      },\n    },\n    ...zipObj(\n      MOVE_TO_ACTION_GROUP,\n      anchors.map(\n        (anchor): ActionDefinition => ({\n          title: getAnchorName(anchor),\n          icon: <PlatformIcon icon={`actions/${anchor.id}`} />,\n          isDisabled:\n            state.anchor === anchor.anchor && state.isSplit === anchor.isSplit,\n          actionPerformed: () => {\n            moveToSide(anchor);\n          },\n        })\n      )\n    ),\n    [FOCUS_EDITOR_ACTION_ID]: {\n      title: \"Escape\", // in intellij it says \"Focus Editor\" but it's not generic enough.\n      actionPerformed: () => {\n        focusMainContent();\n      },\n    },\n    [HIDE_ACTIVE_WINDOW_ACTION_ID]: {\n      title: \"Hide\",\n      icon: <PlatformIcon icon=\"general/hideToolWindow\" />,\n      actionPerformed: () => {\n        hide();\n      },\n    },\n    [MAXIMIZE_TOOL_WINDOW_ACTION_ID]: {\n      title: \"Maximize Tool Window\", // Should be \"Restore Tool Window Size if the window is currently maximized\n      actionPerformed: () => {\n        // TODO(release): either remove the action or implement it\n        alert(\"Not implemented\");\n      },\n    },\n    [REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID]: {\n      title: \"Remove from Sidebar\",\n      actionPerformed: () => {\n        remove();\n      },\n    },\n  };\n  if (state.viewMode === \"float\") {\n    actions[DOCK_TOOL_WINDOW_ACTION_ID] = {\n      title: \"Dock\",\n      icon: (\n        <PlatformIcon\n          icon={`actions/${\n            anchors.find(\n              ({ anchor, isSplit }) =>\n                anchor === state.anchor && isSplit === state.isSplit\n            )?.id\n          }`}\n        />\n      ),\n      actionPerformed: () => {\n        changeViewMode(\"docked_pinned\");\n      },\n    };\n  }\n  if (state.viewMode !== \"float\" && state.viewMode !== \"window\") {\n    if (isHorizontalToolWindow(state.anchor)) {\n      actions[RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID] = {\n        title: \"Stretch to bottom\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"bottom\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      };\n      actions[RESIZE_TOOL_WINDOW_TOP_ACTION_ID] = {\n        title: \"Stretch to top\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"top\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      };\n    } else {\n      actions[RESIZE_TOOL_WINDOW_LEFT_ACTION_ID] = {\n        title: \"Stretch to left\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"left\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      };\n      actions[RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID] = {\n        title: \"Stretch to right\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"right\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      };\n    }\n  }\n  return actions;\n}\n","import React from \"react\";\nimport { ActionDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport {\n  getViewModeType,\n  ToolWindowRefValue,\n  ToolWindowsState,\n} from \"@intellij-platform/core/ToolWindows\";\nimport {\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { zipObj } from \"ramda\";\n\ninterface DefaultToolWindowActionsProps {\n  toolWindowsState: Readonly<ToolWindowsState>;\n  toolWindowsRef: React.RefObject<ToolWindowRefValue>;\n  /**\n   * Used when creating ActivateToolWindow action for each tool window.\n   */\n  getPresentation?: (key: React.Key) =>\n    | {\n        title: string;\n        icon: React.ReactNode;\n      }\n    | undefined;\n}\n\nexport const getActivateToolWindowActionId = (id: string) =>\n  `Activate${id.replace(\" \", \"\")}Window`;\n\n/**\n * Provides default tool windows actions:\n * - Hide all tool windows\n * - Activate{id}Window action for each window\n * - Jump to last tool window\n *\n * @see also {@link DefaultToolWindows}\n */\nexport function useToolWindowsActions({\n  toolWindowsState,\n  toolWindowsRef,\n  getPresentation,\n}: DefaultToolWindowActionsProps) {\n  const isAnySideWindowWindowOpen = (state: Readonly<ToolWindowsState>) =>\n    Object.values(state.windows).some(\n      ({ isVisible, viewMode }) =>\n        isVisible && getViewModeType(viewMode) !== \"float\"\n    );\n  const windowIds = Object.keys(toolWindowsState.windows).map(\n    (key) => `${key}`\n  );\n  const activateToolWindowActions = zipObj(\n    windowIds.map(getActivateToolWindowActionId),\n    windowIds.map((id: string, index): ActionDefinition => {\n      const { title, icon } = getPresentation?.(id) || {};\n      return {\n        title: title || `${getOrdinal(index)} window`,\n        icon,\n        description: `Activate ${title || getOrdinal(index)} window`,\n        actionPerformed: () => {\n          if (\n            toolWindowsState.windows[id]?.isVisible &&\n            !toolWindowsRef.current?.hasFocus(id)\n          ) {\n            toolWindowsRef.current?.focus(id);\n          } else {\n            toolWindowsRef.current?.changeState((state) => state.toggle(id));\n          }\n        },\n      };\n    })\n  );\n  const actions: Record<string, ActionDefinition> = {\n    ...activateToolWindowActions,\n    [HIDE_ALL_WINDOWS_ACTION_ID]: {\n      title: isAnySideWindowWindowOpen(toolWindowsState)\n        ? \"Hide All Windows\"\n        : \"Restore windows\",\n      actionPerformed: () => {\n        toolWindowsRef.current?.changeState((state) => {\n          if (isAnySideWindowWindowOpen(state)) {\n            return state.hideAll();\n          } else {\n            return state.restoreWindows();\n          }\n        });\n        // Because windows have autofocus behaviour, a timeout is set. Not sure how reliable it is.\n        // TODO: replace effect-based auto focus behaviour with something better, maybe controlled by ToolWindows\n        //  component, and when a tool window is opened.\n        setTimeout(() => {\n          toolWindowsRef.current?.focusMainContent();\n        });\n      },\n    },\n    [JUMP_TO_LAST_WINDOW_ACTION_ID]: {\n      title: \"Jump to Last Tool Window\",\n      isDisabled: toolWindowsState.lastFocusedKey == null,\n      actionPerformed: () => {\n        toolWindowsRef.current?.focusLastActiveWindow();\n      },\n    },\n  };\n  return actions;\n}\n\nfunction getOrdinal(n: number) {\n  let ord = [\"st\", \"nd\", \"rd\"];\n  let exceptions = [11, 12, 13];\n  let nth =\n    ord[(n % 10) - 1] == undefined || exceptions.includes(n % 100)\n      ? \"th\"\n      : ord[(n % 10) - 1];\n  return n + nth;\n}\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionHelpTooltipProps {\n  actionName: React.ReactNode;\n  helpText: React.ReactNode;\n  shortcut?: React.ReactNode;\n  link?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action Help\"\n * @see {@link ActionTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionHelpTooltip = ({\n  actionName,\n  helpText,\n  shortcut,\n  link,\n}: ActionHelpTooltipProps): JSX.Element => {\n  return (\n    <Tooltip multiline>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n      <Tooltip.Description>{helpText}</Tooltip.Description>\n      {link && <Tooltip.Link>{link}</Tooltip.Link>}\n    </Tooltip>\n  );\n};\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionTooltipProps {\n  actionName: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action\"\n * @see {@link ActionHelpTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionTooltip = ({\n  actionName,\n  shortcut,\n}: ActionTooltipProps): JSX.Element => {\n  return (\n    <Tooltip>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n    </Tooltip>\n  );\n};\n","import React, { ForwardedRef, useContext } from \"react\";\nimport { AriaTooltipProps, useTooltip } from \"@react-aria/tooltip\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { TooltipContext } from \"./TooltipContext\";\n\nexport interface TooltipProps extends Omit<AriaTooltipProps, \"isOpen\"> {\n  children: React.ReactNode;\n  multiline?: boolean;\n}\n\nconst StyledTooltip = styled.div<{ multiline?: boolean }>`\n  box-sizing: content-box;\n  max-width: ${\n    /**\n     * Max width is meant to be set on the multiline description (which is not used in ActionTooltip which would\n     * be right according to [the specs](https://jetbrains.github.io/ui/controls/tooltip/#09)).\n     * But if set on `Tooltip.Description`, title and link can still make the tooltip grow more that the expected max\n     * width. So it makes more sense to set the max width on the container anyway. But since the value of the max width\n     * is meant to be for description we set the box-sizing to \"content-box\" to exclude container's padding in max-width\n     * calculation.\n     */\n    ({ theme, multiline }) =>\n      multiline\n        ? `${\n            theme.value<number>(\n              \"HelpTooltip.maxWidth\" as UnknownThemeProp<\"HelpTooltip.maxWidth\">\n            ) ?? 250\n          }px`\n        : null\n  };\n  white-space: ${({ multiline }) => (!multiline ? \"nowrap\" : null)};\n  display: inline-flex;\n  flex-direction: column;\n  gap: ${({ theme }) =>\n    theme.value<number>(\n      \"HelpToolTip.verticalGap\" as UnknownThemeProp<\"HelpToolTip.verticalGap\">\n    ) ?? 4}px;\n  background: ${({ theme }) =>\n    theme.color(\"ToolTip.background\", !theme.dark ? \"#f2f2f2\" : \"#3c3f41\")};\n  color: ${({ theme }) =>\n    theme.color(\"ToolTip.foreground\", !theme.dark ? \"#000\" : \"#bfbfbf\")};\n  padding: ${({ theme, multiline }) =>\n    multiline\n      ? theme.inset(\"HelpTooltip.defaultTextBorderInsets\")\n      : theme.inset(\"HelpTooltip.smallTextBorderInsets\")};\n  line-height: 1.2;\n  border-style: solid;\n  border-width: ${({ theme }) =>\n    theme.value<boolean>(\"ToolTip.paintBorder\") ? \"1px\" : \"0px\"};\n  border-color: ${({ theme }) =>\n    theme.color(\"ToolTip.borderColor\", !theme.dark ? \"#adadad\" : \"#636569\")};\n  ${WINDOW_SHADOW};\n`;\n\nconst StyledShortcut = styled.kbd`\n  all: unset;\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.shortcutForeground\",\n      !theme.dark ? \"#787878\" : \"#999999\"\n    )};\n`;\n\nconst StyledHeader = styled.div`\n  font-size: ${({ theme }) => theme.fontSizeDelta(\"HelpTooltip.fontSizeDelta\")};\n  display: flex;\n  gap: 0.5rem;\n`;\nconst StyledDescription = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"Tooltip.infoForeground\" as UnknownThemeProp<\"Tooltip.infoForeground\">,\n      theme.commonColors.contextHelpForeground\n    )};\n  font-size: ${({ theme }) =>\n    theme.fontSizeDelta(\"HelpTooltip.descriptionSizeDelta\")};\n`;\n\nconst StyledLink = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.linkForeground\" as UnknownThemeProp<\"ToolTip.linkForeground\">,\n      theme.commonColors.linkForegroundEnabled\n    )};\n  a,\n  [role=\"link\"] {\n    // Maybe target Link instead, without important. It didn't work as expected, in the first try tho.\n    color: inherit !important;\n  }\n`;\n\n/**\n * Implements the UI of a Tooltip. For tooltip to be shown for a trigger, on hover, use {@link TooltipTrigger}.\n * The following components can be used to compose the content of a tooltip.\n * - {@link Tooltip.Header}\n * - {@link Tooltip.Description}\n * - {@link Tooltip.Link}\n * - {@link Tooltip.Shortcut}\n * Prefer using higher-level components like {@link HelpTooltip}, {@link ActionHelpTooltip} or {@link ActionTooltip}.\n * that ensure different pieces of tooltip content follow the\n * [design system recommendation](https://jetbrains.github.io/ui/controls/tooltip)\n *\n *\n * ### Reference:\n * Tooltip, Tooltip.* and TooltipTrigger are corresponding to [HelpTooltip](https://github.com/JetBrains/intellij-community/blob/854daf45b47a6ea9da0348978608bfbfe998d99c/platform/platform-api/src/com/intellij/ide/HelpTooltip.java#L102)\n * in the original impl.\n */\nconst Tooltip = React.forwardRef(function Tooltip(\n  { children, multiline, ...props }: TooltipProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref = useObjectRef(forwardedRef);\n  const { state, isInteractive } = useContext(TooltipContext) || {};\n  const { tooltipProps } = useTooltip(\n    props,\n    state\n      ? {\n          ...state,\n          // if the tooltip is not interactive, let it be closed even when it's hovered. That's the according to the reference impl.\n          open: isInteractive ? state?.open : () => {},\n        }\n      : state\n  );\n\n  return (\n    <StyledTooltip multiline={multiline} {...tooltipProps} ref={ref}>\n      {children}\n    </StyledTooltip>\n  );\n});\n\nconst _Tooltip = Object.assign(Tooltip, {\n  Header: StyledHeader,\n  Shortcut: StyledShortcut,\n  Description: StyledDescription,\n  Link: StyledLink,\n});\n\nexport { _Tooltip as Tooltip };\n","import React from \"react\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\n\ninterface TooltipContextObject {\n  state: TooltipTriggerState;\n  isInteractive: boolean;\n}\n\nexport const TooltipContext = React.createContext<TooltipContextObject | null>(\n  null\n);\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  TooltipTriggerProps as AriaTooltipTriggerProps,\n  useTooltipTrigger as useAriaTooltipTrigger,\n} from \"@react-aria/tooltip\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { FocusableProvider } from \"@react-aria/focus\";\nimport { useMouseEventOverlayPosition } from \"@intellij-platform/core/utils/useMouseEventOverlayPosition\";\nimport { OverlayContainer } from \"@react-aria/overlays\";\nimport { mergeProps, useLayoutEffect } from \"@react-aria/utils\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { TooltipContext } from \"@intellij-platform/core/Tooltip/TooltipContext\";\n\ninterface TooltipTriggerProps\n  extends Omit<AriaTooltipTriggerProps, \"isOpen\" | \"defaultOpen\" | \"trigger\"> {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n      ) => React.ReactNode);\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}.\n * Showing tooltip on focus and controlled open state are not supported at the moment, based on how tooltip works in the\n * reference impl. This may be revisited in the future.\n *\n * TODO: Implement timeout-based auto-hide (https://jetbrains.github.io/ui/controls/tooltip/#19)\n * TODO: HelpTooltip implements different types of Alignment, one of which is \"Cursor\". Maybe we can do the same. It may\n *   also help with the challenges in supporting \"tooltip on focus\" and \"controlled state\".\n */\nexport const TooltipTrigger = ({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  ...props\n}: TooltipTriggerProps): JSX.Element => {\n  const theme = useTheme();\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const triggerRef = useRef<HTMLElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  const [isInteractive, setInteractive] = useState(false);\n  const {\n    /**\n     * onMouseDown is preventDefault-ed which interferes with functionality of the tooltip trigger, in use cases like\n     * tool window stripe button. Note that since pointerDown is handled for calling the tooltip trigger's onPressStart\n     * handler (which hides the tooltip), there is no issue in excluding onMouseDown, because it's only used to preventDefault\n     * the event, because of some edge cases focus handling which is not our concern.\n     */\n    triggerProps: { onMouseDown, ...triggerProps },\n    tooltipProps,\n  } = useTooltipTrigger(\n    props,\n    // In Intellij Platform. The tooltip hides right away. We follow the same, unless the tooltip is interactive.\n    // Maybe something to rethink if it's worth following the reference impl for.\n    { ...state, close: isInteractive ? state.close : () => state.close(true) },\n    triggerRef\n  );\n  const { overlayProps } = useMouseEventOverlayPosition({\n    overlayRef,\n    // targetRef: triggerRef,\n    isOpen: state.isOpen,\n    placement: \"bottom left\",\n    shouldFlip: true,\n    offset: theme.value<number>(\"HelpTooltip.mouseCursorOffset\") ?? 20,\n  });\n  useLayoutEffect(() => {\n    setInteractive(\n      overlayRef.current?.querySelector(\n        'a, button, [role=\"button\"], [role=link]'\n      ) !== null\n    );\n  });\n  return (\n    <>\n      {normalizeChildren(children, { ...triggerProps, ref: triggerRef })}\n      {state.isOpen && (\n        <OverlayContainer>\n          <TooltipContext.Provider value={{ state, isInteractive }}>\n            <div\n              {...mergeProps(\n                overlayProps,\n                // Not sure if it's ok to apply tooltip props on this wrapper, but it probably is.\n                tooltipProps\n              )}\n              ref={overlayRef}\n            >\n              {tooltip}\n            </div>\n          </TooltipContext.Provider>\n        </OverlayContainer>\n      )}\n    </>\n  );\n};\n\nfunction normalizeChildren(\n  children: Pick<TooltipTriggerProps, \"children\">[\"children\"],\n  triggerProps: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n) {\n  if (typeof children === \"function\") {\n    return children(triggerProps);\n  }\n  if (React.isValidElement(children) && typeof children.type === \"string\") {\n    return React.cloneElement(children, triggerProps);\n  }\n  return <FocusableProvider {...triggerProps}>{children}</FocusableProvider>;\n}\n\n/**\n * A wrapper around react-aria's useTooltipTrigger, adjusting it for Intellij Platform.\n */\nconst useTooltipTrigger: typeof useAriaTooltipTrigger = (props, state, ref) => {\n  const {\n    /**\n     * Excluding onFocus, because in the original impl, tooltip is not shown upon focus. It's probably nicer to have\n     * the tooltip shown on focused tho, and it's something to revisit in the future.\n     * If we want to support showing tooltip on focus, or if we want to allow controlled open state, we should let it\n     * be positioned by the trigger element in that case, rather than mouse position.\n     * One solution would be to use useOverlayPosition as well, and conditionally use the right `overlayProps`, based on\n     * whether the position determined by mouse is within `triggerRef.current?.getBoundingClientRect()`. Another way\n     * (maybe better) would be to have `useMouseEventOverlayPosition` accept `bounds` or `containerBounds`, which if\n     * passed, makes sure the position is kept within that boundary. Outside positions would be mapped to the closest\n     * point on the border of the boundary.\n     */\n    triggerProps: { onFocus, ...triggerProps },\n    tooltipProps,\n  } = useAriaTooltipTrigger(props, state, ref);\n  // onPointerDown returned from the underlying usePress stops propagation which messes with some usages of tooltip\n  // like in tab or tool window stripe button. We replace onPointerDown handler with a similar handler that closes\n  // the tooltip.\n  triggerProps.onPointerDown = () => {\n    state.close(true);\n  };\n  return {\n    triggerProps,\n    tooltipProps,\n  };\n};\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeNode } from \"../TreeNode\";\nimport { SpeedSearchItemHighlightsProvider } from \"@intellij-platform/core/CollectionSpeedSearch\";\n\nexport const SpeedSearchTreeNode = <T extends object>({\n  item,\n  alwaysShowAsFocused,\n}: {\n  item: Node<T>;\n  alwaysShowAsFocused?: boolean;\n}) => (\n  <SpeedSearchItemHighlightsProvider itemKey={item.key}>\n    <TreeNode\n      key={item.key}\n      item={item}\n      alwaysShowAsFocused={alwaysShowAsFocused}\n    />\n  </SpeedSearchItemHighlightsProvider>\n);\n","import React, { ForwardedRef, useRef } from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { Virtualizer } from \"@react-aria/virtualizer\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport { SpeedSearchProps } from \"@intellij-platform/core/SpeedSearch\";\nimport { TreeRefValue } from \"../useTreeRef\";\nimport { StyledTree } from \"../StyledTree\";\nimport { SpeedSearchPopup } from \"../../SpeedSearch/SpeedSearchPopup\";\nimport { useTreeState } from \"../useTreeState\";\nimport { TreeProps } from \"../Tree\";\nimport { useTreeVirtualizer } from \"../useTreeVirtualizer\";\nimport { TreeContext } from \"../TreeContext\";\nimport { useSpeedSearchTree } from \"./useSpeedSearchTree\";\nimport { SpeedSearchTreeNode } from \"./SpeedSearchTreeNode\";\n\nexport type SpeedSearchTreeProps<T extends object> = TreeProps<T> &\n  SpeedSearchProps;\n\nexport const SpeedSearchTree = React.forwardRef(\n  <T extends object>(\n    {\n      fillAvailableSpace = false,\n      alwaysShowAsFocused = false,\n      ...props\n    }: SpeedSearchTreeProps<T>,\n    forwardedRef: ForwardedRef<TreeRefValue>\n  ) => {\n    const state = useTreeState(\n      { ...props, disallowEmptySelection: !props.allowEmptySelection },\n      forwardedRef\n    );\n    const ref = useRef<HTMLDivElement>(null);\n    const {\n      treeProps,\n      treeContext,\n      speedSearchContextValue,\n      searchPopupProps,\n    } = useSpeedSearchTree({ ...props, isVirtualized: true }, state, ref);\n\n    const { virtualizerProps } = useTreeVirtualizer({ state });\n\n    // NOTE: SpeedSearchPopup can be rendered as a portal with proper positioning (useOverlayPosition), if overflow\n    // issues required it.\n    return (\n      <TreeContext.Provider value={treeContext}>\n        <CollectionSpeedSearchContext.Provider value={speedSearchContextValue}>\n          <SpeedSearchPopup {...searchPopupProps} />\n          <StyledTree\n            as={Virtualizer}\n            ref={ref}\n            fillAvailableSpace={fillAvailableSpace}\n            {...virtualizerProps}\n            {...treeProps}\n          >\n            {(type: string, item: unknown) => (\n              <SpeedSearchTreeNode\n                key={(item as Node<T>).key}\n                item={item as Node<T>}\n                alwaysShowAsFocused={alwaysShowAsFocused}\n              />\n            )}\n          </StyledTree>\n        </CollectionSpeedSearchContext.Provider>\n      </TreeContext.Provider>\n    );\n  }\n);\n","import { RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useCollectionSpeedSearch } from \"../../CollectionSpeedSearch/useCollectionSpeedSearch\";\nimport { SpeedSearchProps } from \"../../SpeedSearch/useSpeedSearch\";\nimport { TreeKeyboardDelegate } from \"../TreeKeyboardDelegate\";\nimport { SelectableTreeProps, useSelectableTree } from \"../useSelectableTree\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\ninterface UseSpeedSearchTreeProps<T>\n  extends SpeedSearchProps,\n    SelectableTreeProps<T> {}\n\nexport function useSpeedSearchTree<T>(\n  props: UseSpeedSearchTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const {\n    containerProps,\n    keyboardDelegate,\n    selectionManager,\n    speedSearch,\n    ...collectionSpeedSearch\n  } = useCollectionSpeedSearch({\n    collection: state.collection,\n    selectionManager: state.selectionManager,\n    stickySearch: props.stickySearch,\n    keyboardDelegate: new TreeKeyboardDelegate(\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    // TODO: maybe allow control over speed search via other props\n  });\n\n  // Speed search is cleared on \"Enter\" key. Alternatively we could wrap onAction and onToggle props\n  // but this seemed more reasonable\n  // NOTE: It may make sense for this behaviour to be pulled up to useCollectionSpeedSearch.\n  const { keyboardProps: speedSearchKeyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (\n        [\"Enter\", \"ArrowLeft\", \"ArrowRight\"].includes(e.key) &&\n        !hasAnyModifier(e)\n      ) {\n        speedSearch.setSearchTerm(\"\");\n        speedSearch.setActive(false);\n      } else {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  const { treeProps, ...selectableTree } = useSelectableTree(\n    { ...props, keyboardDelegate },\n    { ...state, selectionManager },\n    ref\n  );\n\n  return {\n    treeProps: mergeProps(treeProps, containerProps, speedSearchKeyboardProps),\n    ...collectionSpeedSearch,\n    ...selectableTree,\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { StyledList } from \"@intellij-platform/core/List/StyledList\";\n\nexport const StyledTree = styled(StyledList)`\n  background: ${({ theme }) => theme.color(\"Tree.background\")};\n`;\n","import React, { Key, MutableRefObject } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\n\nexport type TreeContextType<T> = {\n  state: TreeState<T>;\n  focused: boolean;\n  onActionRef: MutableRefObject<((key: Key) => void) | undefined>;\n};\n\nexport const TreeContext = React.createContext<TreeContextType<any> | null>(\n  null\n);\n","import { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key, RefObject } from \"react\";\n\nexport class TreeKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  constructor(\n    private collection: Collection<Node<T>>,\n    private disabledKeys: Set<Key>,\n    ref: RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super(collection, disabledKeys, ref, collator);\n  }\n\n  getKeyLeftOf(key: React.Key): React.Key {\n    const item = this.collection.getItem(key);\n    return item.parentKey ?? this.getKeyAbove(key);\n  }\n\n  getKeyRightOf(key: React.Key): React.Key {\n    return this.getKeyBelow(key);\n  }\n}\n","import { LafIcon } from \"../Icon\";\nimport React, { ComponentProps, useMemo } from \"react\";\nimport { styled } from \"../styled\";\n\nexport const TREE_ICON_SIZE = 16;\nconst StyledTreeNodeIcon = styled(LafIcon)`\n  margin-left: -20px;\n  margin-right: 4px;\n  margin-top: -1px; // the svg path seems to have uneven vertical padding. This is to compensate for that.\n  flex-shrink: 0;\n  align-self: center;\n`;\n\ntype TreeNodeIconProps = ComponentProps<typeof StyledTreeNodeIcon> & {\n  selected: boolean;\n  expanded: boolean;\n};\nconst getIcon = (selected: boolean, expanded: boolean) => {\n  const modifiers = { Selected: selected };\n  if (expanded) {\n    return {\n      themePath: selected ? \"Tree.expandedSelectedIcon\" : \"Tree.expandedIcon\",\n      iconPath: { name: \"treeExpanded\", modifiers },\n    };\n  }\n  if (!expanded) {\n    return {\n      themePath: selected ? \"Tree.collapsedSelectedIcon\" : \"Tree.collapsedIcon\",\n      iconPath: { name: \"treeCollapsed\", modifiers },\n    };\n  }\n};\n\nexport function TreeNodeIcon({\n  selected,\n  expanded,\n  ...props\n}: TreeNodeIconProps) {\n  const icon = useMemo(() => getIcon(selected, expanded), [selected, expanded]);\n  return (\n    <StyledTreeNodeIcon\n      icon={icon?.iconPath}\n      themePath={icon?.themePath}\n      size={TREE_ICON_SIZE}\n      {...props}\n    />\n  );\n}\n","import { Key } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { PressProps } from \"@react-aria/interactions\";\n\nexport function useTreeNodeToggleButton<T>({\n  collection,\n  toggleKey,\n  selectionManager,\n  key,\n}: { key: Key } & Pick<\n  TreeState<T>,\n  \"collection\" | \"toggleKey\" | \"selectionManager\"\n>): { treeNodeToggleButtonProps: PressProps } {\n  return {\n    treeNodeToggleButtonProps: {\n      preventFocusOnPress: true,\n      onPress: () => {\n        toggleKey(key);\n\n        // The rest is for deselecting selected descendants and selecting the toggled node, if there\n        // is at least one of such currently selected descendants. This is the exact behavior\n        // of Tree in Intellij Platform, and hence implemented here.\n        const selectedDescendantKeys = [\n          ...selectionManager.selectedKeys,\n        ].filter((key: Key) => {\n          let parentKey = collection.getItem(key)?.parentKey;\n          while (parentKey) {\n            if (parentKey === key) {\n              return true;\n            }\n            parentKey = collection.getItem(parentKey)?.parentKey;\n          }\n          return false;\n        });\n        selectedDescendantKeys.forEach((key) =>\n          selectionManager.toggleSelection(key)\n        );\n        // if any of the descendants are selected\n        if (\n          !selectionManager.isSelected(key) &&\n          selectedDescendantKeys.length > 0\n        ) {\n          selectionManager.toggleSelection(key);\n        }\n      },\n    },\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { TREE_ICON_SIZE } from \"./TreeNodeIcon\";\n\nexport const StyledTreeNode = styled(StyledListItem).attrs({ as: \"div\" })<{\n  level: number;\n}>`\n  // There are some theme properties for tree node padding (theme.ui.Tree.leftChildIndent and\n  // theme.ui.Tree.leftChildIndent), but they doesn't seem to be applicable.\n  padding-left: ${({ level }) => `${(level + 1) * TREE_ICON_SIZE + 8}px`};\n  ${({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"Tree.foreground\" as UnknownThemeProp<\"Tree.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color =\n          theme.color(\n            \"Tree.selectionForeground\" as UnknownThemeProp<\"Tree.selectionForeground\">\n          ) ||\n          theme.commonColors\n            .labelSelectedForeground /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"Tree.selectionBackground\" as UnknownThemeProp<\"Tree.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"Tree.selectionInactiveForeground\" as UnknownThemeProp<\"Tree.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"Tree.selectionBackgroundInactive\" as UnknownThemeProp<\"Tree.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor,\n      color,\n    };\n  }}\n`;\n","import { usePress } from \"@react-aria/interactions\";\nimport { Node } from \"@react-types/shared\";\nimport React, { useContext, useRef } from \"react\";\nimport { ItemStateContext } from \"../Collections/ItemStateContext\";\nimport { TreeNodeIcon } from \"./TreeNodeIcon\";\nimport { useTreeNode } from \"./useTreeNode\";\nimport { useTreeNodeToggleButton } from \"./useTreeNodeToggleButton\";\nimport { TreeContext } from \"./TreeContext\";\nimport { StyledTreeNode } from \"@intellij-platform/core/Tree/StyledTreeNode\";\n\ntype TreeNodeProps<T> = {\n  item: Node<T>;\n  alwaysShowAsFocused?: boolean;\n};\n\nexport function TreeNode<T>({\n  item,\n  alwaysShowAsFocused = false,\n}: TreeNodeProps<T>) {\n  const ref = useRef(null);\n  const {\n    state: {\n      collection,\n      selectionManager,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n    },\n    focused: containerFocused,\n    onActionRef: { current: onAction },\n  } = useContext(TreeContext)!;\n\n  const isSelected = selectionManager.isSelected(item.key);\n  const expanded = expandedKeys.has(item.key);\n  const isDisabled = disabledKeys.has(item.key);\n\n  const { pressProps: togglePressProps } = usePress({\n    ...useTreeNodeToggleButton({\n      key: item.key,\n      collection,\n      selectionManager,\n      toggleKey,\n    }).treeNodeToggleButtonProps,\n    isDisabled,\n  });\n\n  const { treeNodeProps } = useTreeNode({\n    item,\n    ref,\n    toggleKey,\n    onAction,\n    selectionManager,\n    disabled: isDisabled,\n  });\n\n  /**\n   * NOTE: TreeNode intentionally is not designed in a recursive way for two main reasons:\n   * - Performance\n   * - Better support for virtualization\n   * So instead of rendering TreeNode for childNodes, if the node is expanded, we expect parent\n   * to render children. It's not a layout issue since we don't need any nesting in terms of\n   * layout of nested items. In terms of layout, a tree will be rendered similar to a flat list,\n   * but with more indentation for nested nodes.\n   */\n  return (\n    <>\n      <StyledTreeNode\n        ref={ref}\n        {...treeNodeProps}\n        containerFocused={containerFocused || alwaysShowAsFocused}\n        disabled={isDisabled}\n        selected={isSelected}\n        aria-disabled={isDisabled}\n        aria-selected={isSelected}\n        level={item.level}\n      >\n        {[...item.childNodes].length > 0 && (\n          <TreeNodeIcon\n            selected={isSelected}\n            expanded={expanded}\n            {...togglePressProps}\n          />\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isSelected,\n            isFocused: containerFocused,\n            node: item,\n          }}\n        >\n          {item.rendered}\n        </ItemStateContext.Provider>\n      </StyledTreeNode>\n    </>\n  );\n}\n","import { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { Node } from \"@react-types/shared\";\nimport { Key, RefObject } from \"react\";\n\nexport function useTreeNode<T>({\n  item,\n  ref,\n  selectionManager,\n  disabled,\n  toggleKey,\n  onAction,\n}: {\n  item: Node<T>;\n  ref: RefObject<HTMLElement>;\n  disabled: boolean;\n  toggleKey: (key: Key) => void;\n  onAction?: (key: Key) => void;\n  selectionManager: SelectionManager;\n}) {\n  const {\n    pressProps: { onKeyDown, ...pressProps },\n  } = usePress({\n    ...useSelectableItem({\n      key: item.key,\n      ref,\n      selectionManager,\n      isVirtualized: false,\n    }).itemProps,\n    isDisabled: disabled,\n    preventFocusOnPress: false,\n  });\n\n  const onDoubleClick = () => {\n    if ([...item.childNodes].length > 0) {\n      toggleKey(item.key);\n    } else {\n      onAction?.(item.key);\n    }\n  };\n  const ariaProps = {\n    role: \"treeitem\",\n  };\n\n  return {\n    treeNodeProps: mergeProps(pressProps, { onDoubleClick }, ariaProps),\n  };\n}\n","import React, { Key, RefObject, useMemo, useState } from \"react\";\nimport {\n  DOMProps,\n  KeyboardDelegate,\n  KeyboardEvent,\n  Node,\n} from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { TreeKeyboardDelegate } from \"./TreeKeyboardDelegate\";\nimport { useCollectionAutoScroll } from \"../Collections/useCollectionAutoScroll\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeContextType } from \"./TreeContext\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\nexport interface SelectableTreeProps<T> extends DOMProps {\n  isVirtualized?: boolean;\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Called when the action associated with a leaf tree node should be taken.\n   * The exact UI interaction is abstracted away, but it's either Enter key or double click.\n   */\n  onAction?: (key: Key) => void;\n  onNodeKeyDown?: (event: KeyboardEvent, node: Node<T>) => void;\n\n  allowEmptySelection?: boolean;\n}\n\n/**\n * NOTE: at the time of writing this hook, react-aria didn't have support for Tree. When useTree is implemented in\n * react-aria, it makes sense to refactor this and use that. There will still be something on top of it here.\n */\nexport function useSelectableTree<T>(\n  { onAction, ...props }: SelectableTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const domProps = filterDOMProps(props);\n  const collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n\n  const [focused, setFocused] = useState(false);\n  const {\n    collectionProps: {\n      // preventDefault in onMouseDown prevents collection from getting focused.\n      // Maybe it should be removed from useSelectableCollection, now that it lives here\n      onMouseDown,\n      onKeyDown: selectionKeyDown,\n      ...collectionProps\n    },\n  } = useSelectableCollection({\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    selectOnFocus: true,\n    keyboardDelegate: useMemo(\n      () =>\n        props.keyboardDelegate ||\n        new TreeKeyboardDelegate(\n          state.collection,\n          state.disabledKeys,\n          ref,\n          collator\n        ),\n      [state.collection, state.disabledKeys, props.keyboardDelegate]\n    ),\n  });\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  useCollectionAutoScroll(\n    {\n      isVirtualized: props.isVirtualized,\n      selectionManager: state.selectionManager,\n    },\n    ref\n  );\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    const focusedKey = state.selectionManager.focusedKey;\n    if (focusedKey == null) {\n      return;\n    }\n    const item = state.collection.getItem(focusedKey);\n    const isExpandable = item.hasChildNodes;\n    const expanded = state.expandedKeys.has(focusedKey);\n    const isDisabled = state.disabledKeys.has(focusedKey);\n    if (isDisabled) {\n      event.continuePropagation();\n      return;\n    }\n\n    props?.onNodeKeyDown?.(event, item);\n\n    const shouldToggle =\n      !hasAnyModifier(event) &&\n      (event.key === \"Enter\" ||\n        (event.key === \"ArrowLeft\" && expanded) ||\n        (event.key === \"ArrowRight\" && !expanded));\n\n    if (isExpandable && shouldToggle) {\n      event.preventDefault();\n      state.toggleKey(focusedKey);\n    } else if (event.key === \"Enter\") {\n      onAction?.(focusedKey);\n    } else {\n      // selectionKeyDown currently doesn't report back if it handled the event or not. We could have conditionally\n      // continued propagation if the event was not handled. Then we could change Speed Search impl to only handle\n      // inputs when the propagation is not prevented.\n      selectionKeyDown?.(event);\n      event.continuePropagation();\n    }\n  };\n  const { keyboardProps } = useKeyboard({\n    onKeyDown,\n  });\n\n  //////////////////////////////// providing context value ////////////////////////////////\n  const onActionRef = useLatest(onAction);\n\n  const {\n    selectionManager,\n    collection,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n  } = state;\n  const treeContext = useMemo<TreeContextType<T>>(\n    () => ({\n      state: {\n        collection,\n        selectionManager,\n        expandedKeys,\n        disabledKeys,\n        toggleKey,\n      },\n      focused,\n      onActionRef,\n    }),\n    [\n      selectionManager,\n      collection,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n      focused,\n      onActionRef,\n    ]\n  );\n  ////////////////////////////////////////////////////////////////////////////////////////\n\n  return {\n    // order of merging here is important. navigation handling should precede selection handling\n    treeProps: mergeProps(\n      focusWithinProps,\n      collectionProps,\n      keyboardProps,\n      domProps\n    ),\n    treeContext,\n    focused,\n  };\n}\n","import { ForwardedRef, Key, useImperativeHandle } from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeSelectionManager } from \"./TreeSelectionManager\";\nimport { TreeCollection } from \"./useTreeState\";\n\nexport interface TreeRefValue {\n  focus(key: Key): void;\n  replaceSelection(key: Key): void;\n\n  /**\n   * Extends selection to all siblings of the currently focused node.\n   */\n  expandSelection(): void;\n  /**\n   * Shrinks selection towards currently focused node.\n   */\n  shrinkSelection(): void;\n\n  expandAll(): void;\n  collapseAll(): void;\n}\n\n/**\n * Sets up a tree ref for imperatively working with tree from outside. For imperatively focusing, expanding to\n * specific key, etc.\n */\nexport function useTreeRef<T extends {}>(\n  props: {\n    tree: TreeCollection<T>;\n    selectionManager: TreeSelectionManager;\n    setExpandedKeys: (keys: Set<Key>) => void;\n  },\n  forwardedRef?: ForwardedRef<TreeRefValue>\n) {\n  const latestState = useLatest(props);\n\n  useImperativeHandle(\n    forwardedRef,\n    () => {\n      return {\n        replaceSelection: (key: Key) => {\n          latestState.current.selectionManager.replaceSelection(key);\n        },\n        focus: (key: Key) => {\n          const selectionManager = latestState.current.selectionManager;\n          selectionManager.setFocused(true);\n          /**\n           * NOTE: we set focus key to null and set it to key again, to make sure scroll into view works even when\n           * the key is currently focused but not in view. It wouldn't be needed if there was an imperative handle\n           * for scrolling an item into view, but it's only implemented in way that is reactive to changes to the\n           * focused key. {@see useCollectionAutoScroll}\n           */\n          // @ts-expect-error: setFocusedKey typing mistakenly doesn't accept null, while it should\n          selectionManager.setFocusedKey(null);\n          setTimeout(() => {\n            selectionManager.setFocusedKey(key);\n          });\n        },\n        expandSelection() {\n          latestState.current.selectionManager.expandSelection();\n        },\n        shrinkSelection() {\n          latestState.current.selectionManager.shrinkSelection();\n        },\n        expandAll() {\n          latestState.current.setExpandedKeys(\n            latestState.current.tree.getAllExpandableKeys()\n          );\n        },\n        collapseAll() {\n          const { tree, setExpandedKeys, selectionManager } =\n            latestState.current;\n          const focusedKey = selectionManager.focusedKey;\n          setExpandedKeys(new Set());\n\n          // Find the root node that is a grandparent of focused node, and focus/select it.\n          // NOTE: this behaviour of updating selection when nodes are collapsed is something to be fixed in general,\n          // and then this custom logic here would be not necessary.\n          if (focusedKey && !tree.rootKeys.includes(focusedKey)) {\n            let item = tree.getItem(focusedKey);\n            while (item?.parentKey != null) {\n              item = tree.getItem(item.parentKey);\n            }\n            if (item) {\n              selectionManager.setFocusedKey(item.key);\n              if (selectionManager.isSelected(focusedKey)) {\n                selectionManager.select(item.key);\n              }\n            }\n          }\n        },\n      };\n    },\n    []\n  );\n}\n","//@ts-nocheck\n/**\n * Not exported from @react-stately/tree, but needed in the custom implementation of useTreeState\n */\n\nimport { Key } from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\n\nexport class TreeCollection<T> implements Collection<Node<T>> {\n  private keyMap: Map<Key, Node<T>> = new Map();\n  private iterable: Iterable<Node<T>>;\n  private firstKey: Key;\n  private lastKey: Key;\n\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys?: Set<Key> } = {}\n  ) {\n    this.iterable = nodes;\n    expandedKeys = expandedKeys || new Set();\n\n    let visit = (node: Node<T>) => {\n      this.keyMap.set(node.key, node);\n\n      if (\n        node.childNodes &&\n        (node.type === \"section\" || expandedKeys.has(node.key))\n      ) {\n        for (let child of node.childNodes) {\n          visit(child);\n        }\n      }\n    };\n\n    for (let node of nodes) {\n      visit(node);\n    }\n\n    let last: Node<T>;\n    let index = 0;\n    for (let [key, node] of this.keyMap) {\n      if (last) {\n        last.nextKey = key;\n        node.prevKey = last.key;\n      } else {\n        this.firstKey = key;\n        node.prevKey = undefined;\n      }\n\n      if (node.type === \"item\") {\n        node.index = index++;\n      }\n\n      last = node;\n\n      // Set nextKey as undefined since this might be the last node\n      // If it isn't the last node, last.nextKey will properly set at start of new loop\n      last.nextKey = undefined;\n    }\n\n    this.lastKey = last?.key;\n  }\n\n  *[Symbol.iterator]() {\n    yield* this.iterable;\n  }\n\n  get size() {\n    return this.keyMap.size;\n  }\n\n  getKeys() {\n    return this.keyMap.keys();\n  }\n\n  getKeyBefore(key: Key) {\n    let node = this.keyMap.get(key);\n    return node ? node.prevKey : null;\n  }\n\n  getKeyAfter(key: Key) {\n    let node = this.keyMap.get(key);\n    return node ? node.nextKey : null;\n  }\n\n  getFirstKey() {\n    return this.firstKey;\n  }\n\n  getLastKey() {\n    return this.lastKey;\n  }\n\n  getItem(key: Key) {\n    return this.keyMap.get(key);\n  }\n\n  at(idx: number) {\n    const keys = [...this.getKeys()];\n    return this.getItem(keys[idx]);\n  }\n}\n","import { Node } from \"@react-types/shared\";\nimport { Key } from \"react\";\n\n/**\n * given a node, returns keys of all consecutive single children\n */\nexport function getSingleChildrenKeys<T>(\n  node: Node<T> | null | undefined\n): Key[] {\n  return getSingleChildrenKeysRecursive(node, []);\n}\n\nfunction getSingleChildrenKeysRecursive<T>(\n  node: Node<T> | null | undefined,\n  previousKeys: Key[]\n): Key[] {\n  if (!node) {\n    return [];\n  }\n  const childNodesIterator: Iterator<\n    Node<T>,\n    Node<T> | undefined\n  > = node.childNodes[Symbol.iterator]();\n  const { value: firstChild, done } = childNodesIterator.next();\n  const noMoreChildren = done || childNodesIterator.next().value == null;\n  if (firstChild != null && noMoreChildren && isExpandable(firstChild)) {\n    return getSingleChildrenKeysRecursive(\n      firstChild,\n      previousKeys.concat((firstChild as Node<T>).key)\n    );\n  }\n  return previousKeys;\n}\n\nconst isExpandable = <T>(node: Node<T>) =>\n  node.hasChildNodes || !isEmptyIterable(node.childNodes);\n\nfunction isEmptyIterable(iterable: Iterable<unknown> | undefined | null) {\n  for (const _ of iterable || []) {\n    // eslint-disable-line no-unused-vars, no-unreachable-loop\n    return false;\n  }\n  return true;\n}\n","import {\n  MultipleSelectionState,\n  SelectionManager,\n  SelectionManagerOptions,\n} from \"@react-stately/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key } from \"react\";\n\nexport class TreeSelectionManager extends SelectionManager {\n  private readonly collection: Collection<Node<unknown>>;\n\n  constructor(\n    collection: Collection<Node<unknown>>,\n    state: MultipleSelectionState,\n    options?: SelectionManagerOptions\n  ) {\n    super(collection, state, options);\n    this.collection = collection;\n  }\n\n  expandSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      const { expandKeys } = this.getExpandAndShrinkKeys(node);\n      if (expandKeys.length > 0) {\n        this.setSelectedKeys([...this.selectedKeys, ...expandKeys]);\n      }\n    }\n  }\n  shrinkSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      const { shrinkKeys } = this.getExpandAndShrinkKeys(node);\n      if (shrinkKeys.length > 0) {\n        this.setSelectedKeys(\n          [...this.selectedKeys].filter((key) => !shrinkKeys.includes(key))\n        );\n      }\n    }\n  }\n\n  private getExpandAndShrinkKeys(node: Node<unknown>) {\n    return this.recursivelyGetExpandAndShrinkKeys(\n      node,\n      [...this.collection.getKeys()],\n      null\n    );\n  }\n  /**\n   * Starting from a node, traverses the tree up, until it reaches the root of the fully selected subtree that includes\n   * the starting node. The root itself may or may not be selected. Returns:\n   * - keys to be added to selection, when expanding selection\n   * - keys to be removed from selection, when shrinking selection\n   */\n  private recursivelyGetExpandAndShrinkKeys(\n    node: Node<unknown>,\n    keys: Array<Key>,\n    previousChild: Key | null\n  ): { expandKeys: Key[]; shrinkKeys: Key[] } {\n    const parent =\n      node && node.parentKey ? this.collection.getItem(node.parentKey) : null;\n    const newKeys = keys.filter((key) => key !== previousChild);\n    const parentDescendants = parent\n      ? getAllDescendants(parent, newKeys).map(({ key }) => key)\n      : this.getAllRoots().flatMap((key) =>\n          key !== node.key\n            ? getAllDescendants(this.collection.getItem(key), newKeys)\n                .map(({ key }) => key)\n                .concat(key)\n            : []\n        );\n    if (parent && parentDescendants.every((key) => this.isSelected(key))) {\n      return this.recursivelyGetExpandAndShrinkKeys(parent, keys, node.key);\n    }\n    const descendants = getAllDescendants(\n      node,\n      keys.filter((key) => key !== previousChild)\n    ).map(({ key }) => key);\n\n    return {\n      expandKeys: descendants.some((key) => !this.isSelected(key))\n        ? descendants\n        : !this.isSelected(node.key)\n        ? [node.key]\n        : parentDescendants,\n      shrinkKeys: parentDescendants.every((key) => this.isSelected(key))\n        ? parentDescendants\n        : this.isSelected(node.key) && previousChild\n        ? [node.key]\n        : descendants.filter((key) => this.isSelected(key)),\n    };\n  }\n\n  private getAllRoots() {\n    return [...this.collection.getKeys()].filter(\n      (key) => this.collection.getItem(key).parentKey == null\n    );\n  }\n}\n\nfunction getAllDescendants<T>(\n  node: Node<T>,\n  stopKeys: Array<React.Key>\n): Node<T>[] {\n  const childNodes = (node.hasChildNodes ? [...node.childNodes] : []).filter(\n    (node) => stopKeys.includes(node.key)\n  );\n  return node.hasChildNodes\n    ? childNodes.concat(\n        childNodes.map((node) => getAllDescendants(node, stopKeys)).flat()\n      )\n    : [];\n}\n","/**\n * Properly typed filter function for filtering out null/undefined items in array.\n */\nexport const notNull = <T>(\n  item: T | undefined | null\n): item is NonNullable<T> => item != null;\n","import { Collection, Node } from \"@react-types/shared\";\nimport { TreeProps as _TreeProps, TreeState } from \"@react-stately/tree\";\nimport {\n  TreeRefValue,\n  useTreeRef,\n} from \"@intellij-platform/core/Tree/useTreeRef\";\nimport { ForwardedRef, Key, useEffect, useMemo } from \"react\";\nimport { useMultipleSelectionState } from \"@react-stately/selection\";\nimport { useCollection } from \"@react-stately/collections\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  CollectionCacheInvalidationProps,\n  useCollectionCacheInvalidation,\n} from \"@intellij-platform/core/Collections/useCollectionCacheInvalidation\";\nimport { TreeCollection as _TreeCollection } from \"./__copied__TreeCollection\";\nimport { getSingleChildrenKeys } from \"./getSingleChildrenKeys\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport class TreeCollection<T> extends _TreeCollection<T> {\n  public readonly rootKeys: Key[];\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys: Set<Key> }\n  ) {\n    super(nodes, { expandedKeys });\n    this.rootKeys = Array.from(nodes).map(({ key }) => key);\n  }\n\n  getAllExpandableKeys(): Set<Key> {\n    const rootNodes = this.rootKeys\n      .map((key) => this.getItem(key))\n      .filter(notNull);\n    return this.recursivelyAddExpandableKeys(rootNodes, new Set<Key>());\n  }\n\n  private recursivelyAddExpandableKeys(\n    nodes: Iterable<Node<T>>,\n    result: Set<Key>\n  ) {\n    for (const node of nodes) {\n      if (node?.hasChildNodes) {\n        result.add(node.key);\n        this.recursivelyAddExpandableKeys(node.childNodes, result);\n      }\n    }\n    return result;\n  }\n}\nexport interface TreeProps<T>\n  extends _TreeProps<T>,\n    CollectionCacheInvalidationProps {}\n/**\n * Provides state management for tree-like components. Handles building a collection\n * of items from props, item expanded state, and manages multiple selection state.\n *\n * Similar to (and initially copied from) useTreeState from @react-stately/tree, but with the following changes:\n * - Supports exposing some imperative API via ref.\n *   Could be done via a wrapper too.\n * - Different onToggle implementation with two adjustments to match Intellij Platform:\n *   - Collapsing a key collapses all descendants as well.\n *   - Expanding a single-child node will recursively expand all single-child descendants.\n *   Couldn't be done with a wrapper in a clean and optimal way. Access to setExpandedKey is not provided. We would need\n *   to either maintain a new state for expanded keys and ignore the one returned from the wrapped hook, or\n *   inefficiently call the returned `toggleKey` function many times.\n * - Supports collection invalidation via CollectionCacheInvalidationProps\n *   Perhaps not the most important addition, but not possible to be done via a wrapper.\n * - Uses TreeSelectionManager instead of the default SelectionManager, which implements expand/shrink selection.\n *   Could be done in a wrapper, with a little hack. Would need to replace selection manager.\n * - returned `collection` is of type `TreeCollection` (which is an improved version of react-stately `TreeCollection`),\n *   instead of the more generic `Collection`.\n */\nexport function useTreeState<T extends object>(\n  props: TreeProps<T>,\n  treeRef?: ForwardedRef<TreeRefValue>\n): TreeState<T> {\n  let [expandedKeys, setExpandedKeys] = useControlledState(\n    props.expandedKeys ? new Set(props.expandedKeys) : undefined!,\n    props.defaultExpandedKeys ? new Set(props.defaultExpandedKeys) : new Set(),\n    props.onExpandedChange!\n  );\n\n  let selectionState = useMultipleSelectionState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  let disabledKeys = useMemo(\n    () => (props.disabledKeys ? new Set(props.disabledKeys) : new Set<Key>()),\n    [props.disabledKeys]\n  );\n\n  const context = useCollectionCacheInvalidation(props);\n\n  // @ts-expect-error imprecise typing in @react-stately/selection\n  let tree = useCollection<T, TreeCollection<T>>(\n    props,\n    (nodes) => new TreeCollection(nodes, { expandedKeys }),\n    context,\n    [expandedKeys]\n  );\n\n  const selectionManager = new TreeSelectionManager(\n    tree as Collection<Node<T>>,\n    selectionState\n  );\n\n  useTreeRef({ selectionManager, setExpandedKeys, tree }, treeRef);\n\n  // Reset focused key if that item is deleted from the collection.\n  useEffect(() => {\n    if (\n      selectionState.focusedKey != null &&\n      !tree.getItem(selectionState.focusedKey)\n    ) {\n      // @ts-expect-error imprecise typing in @react-stately/selection\n      selectionState.setFocusedKey(null);\n    }\n  }, [tree, selectionState.focusedKey]);\n\n  const onToggle = (key: Key) => {\n    // @ts-expect-error: callback syntax is not officially supported by @react-stately/utils.\n    // more info: https://github.com/adobe/react-spectrum/issues/2320\n    // But we rely on it in Menu, because of how it's implemented currently. Alternative solutions to Menu's problem:\n    // - Expose setExpandedKeys to let Menu not just toggle keys, but to collapse some item and expand another in one go.\n    // - Add an option for collapsing same level items when an item is being toggled open. (menu/accordion behavior)\n    setExpandedKeys((expandedKeys) =>\n      toggleTreeNode(tree as Collection<Node<T>>, expandedKeys, key)\n    );\n  };\n\n  return {\n    collection: tree as Collection<Node<T>>,\n    expandedKeys,\n    disabledKeys,\n    toggleKey: onToggle,\n    selectionManager,\n  };\n}\nfunction toggleTreeNode(\n  tree: Collection<Node<unknown>>,\n  expandedKeys: Set<Key>,\n  key: Key\n): Set<Key> {\n  const newKeys = toggleKey(expandedKeys, key);\n  // In Intellij impl, when a node is collapsed, all descendants are also collapsed. In other words, keys that are\n  // not a part of the list of visible nodes, will be excluded from the expanded keys, with the toggle action.\n  for (const aKey of newKeys) {\n    if (tree.getItem(aKey) == null) {\n      newKeys.delete(aKey);\n    }\n  }\n\n  // If we are toggling it open, expand all expandable single-child items\n  if (newKeys.has(key)) {\n    for (const aKey of getSingleChildrenKeys(tree.getItem(key))) {\n      newKeys.add(aKey);\n    }\n  }\n  return newKeys;\n}\n\nfunction toggleKey(set: Set<Key>, key: Key): Set<Key> {\n  let res = new Set(set);\n  if (res.has(key)) {\n    res.delete(key);\n  } else {\n    res.add(key);\n  }\n\n  return res;\n}\n","import { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { CacheInvalidationContext } from \"./Item\";\n\nexport interface CollectionCacheInvalidationProps {\n  /**\n   * Defines cache invalidation policy for items. By default, the render result is cached based on the item objects.\n   * This is equivalent of passing false or not passing anything for `cacheInvalidation`. If `true` is passed, it will\n   * always invalidate the render result, causing the collection to be recreated on each re-render. It can\n   * considerably affect performance in large collections. in addition to boolean value, an object with the list of\n   * invalidators can also be passed. renderer function is called each time any of the invalidators are changed.\n   * Think of it as [dependency array in react hooks](https://reactjs.org/docs/hooks-reference.html#usememo). Except\n   * that the length of the array can also safely change.\n   */\n  cacheInvalidation?: boolean | { invalidators: ReadonlyArray<unknown> };\n}\n\n/**\n * Allows cache invalidation options based on input props, for components that use collection\n */\nexport const useCollectionCacheInvalidation = ({\n  cacheInvalidation,\n}: CollectionCacheInvalidationProps): CacheInvalidationContext => {\n  const invalidators =\n    typeof cacheInvalidation === \"object\" ? cacheInvalidation.invalidators : [];\n  const lastInvalidators = usePrevious(invalidators);\n\n  const invalidated =\n    typeof cacheInvalidation === \"object\"\n      ? cacheInvalidation.invalidators.length !== lastInvalidators.length ||\n        cacheInvalidation.invalidators.some(\n          (anInvalidator, index) => anInvalidator !== lastInvalidators[index]\n        )\n      : cacheInvalidation;\n\n  return {\n    invalidated,\n  };\n};\n","import { LayoutNode, ListLayout } from \"@react-stately/layout\";\nimport React, { Key } from \"react\";\nimport { InvalidationContext, Rect, Size } from \"@react-stately/virtualizer\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Extends `ListLayout` and allows items of the list to have width based on the content. `ListLayout` by default\n * sets width based on the virtualizer's visible rect. This means the overflow of list items will be clipped.\n * In `VariableWidthListLayout`, the width of the list depends on the content of the visible items.\n *\n * NOTE: At the time of writing this class, Virtualization in @react-aria and @react-stately don't have proper\n * documentation, and it wasn't clear if there could be better ways of letting list's width grow based on the content.\n * Also, this implementation currently lacks support for sections. `buildSection()` would most probably need to be\n * overridden like how `buildItem` is.\n */\nexport class VariableWidthListLayout<T> extends ListLayout<T> {\n  /**\n   * content width of items are stored here, if the content width is bigger than the Virtualizer's visible rect's width.\n   */\n  keyToWidth = new Map<Key, number>();\n  private visibleContentWidth: number = 0;\n\n  buildItem(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildItem(node, x, y);\n    if (this.visibleContentWidth) {\n      layoutNode.layoutInfo.rect.width = this.visibleContentWidth;\n    }\n    return layoutNode;\n  }\n\n  buildCollection(): LayoutNode[] {\n    this.visibleContentWidth = this.getVisibleContentWidth();\n    // in buildChild, if invalidateEverything is false and y is not changed, it will reuse the existing layoutInfo.\n    // which can be problematic, if it was created in a time when the visible content width was different.\n    // A more efficient approach (instead of rebuilding the whole collection), might be to set layout width to\n    // visibleContentWidth, in getVisibleLayoutInfos, if mutation is ok.\n    // UPDATE: using getFinalLayoutInfo seems to be a legitimate last minute way to mutate layout infos.\n    this.invalidateEverything =\n      this.contentSize?.width !== this.visibleContentWidth;\n    const layoutNodes = super.buildCollection();\n    this.contentSize.width = this.visibleContentWidth;\n    return layoutNodes;\n  }\n\n  shouldInvalidate(newRect: Rect, oldRect: Rect): boolean {\n    return (\n      super.shouldInvalidate(newRect, oldRect) ||\n      this.getVisibleContentWidth() !== this.visibleContentWidth\n    );\n  }\n\n  // Setting lastWidth doesn't seem to be important, but we set it based on the content anyway.\n  validate(invalidationContext: InvalidationContext<Node<T>, unknown>) {\n    super.validate(invalidationContext);\n    this.lastWidth = this.contentSize.width;\n  }\n\n  updateItemSize(key: React.Key, size: Size): boolean {\n    const changed = super.updateItemSize(key, size);\n    const layoutInfo = this.layoutInfos.get(key);\n    if (layoutInfo && size.width > this.contentSize.width) {\n      this.keyToWidth.set(key, size.width);\n      return true;\n    } else {\n      this.keyToWidth.delete(key);\n      return changed;\n    }\n  }\n\n  private getVisibleContentWidth() {\n    return Math.max(\n      this.virtualizer.visibleRect.width,\n      ...this.virtualizer.visibleViews.map((view) => {\n        const layoutInfo = view.layoutInfo;\n        const itemContentWidth =\n          layoutInfo && this.keyToWidth.get(layoutInfo.key);\n        if (\n          itemContentWidth &&\n          layoutInfo.rect.intersects(this.virtualizer.getVisibleRect())\n        ) {\n          return itemContentWidth;\n        }\n        return 0;\n      })\n    );\n  }\n}\n","import React, { HTMLAttributes, useMemo } from \"react\";\nimport { LayoutNode } from \"@react-stately/layout\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { VirtualizerProps } from \"@react-aria/virtualizer\";\nimport { LayoutInfo, Rect } from \"@react-stately/virtualizer\";\nimport { VariableWidthListLayout } from \"@intellij-platform/core/VariableWidthListLayout\";\n\nclass FlattenedTreeLayout<T> extends VariableWidthListLayout<T> {\n  buildChild(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildChild(node, x, y);\n    if (\n      node.parentKey &&\n      this.collection.getItem(node.parentKey)?.type === \"item\"\n    ) {\n      layoutNode.layoutInfo.parentKey = null;\n    }\n    return layoutNode;\n  }\n\n  getVisibleLayoutInfos(rect: Rect): LayoutInfo[] {\n    return super\n      .getVisibleLayoutInfos(rect)\n      .filter((layoutInfo) => this.collection.getItem(layoutInfo.key) != null);\n  }\n}\n\nexport const useTreeVirtualizer = <T extends object>({\n  state,\n}: {\n  state: TreeState<T>;\n}): {\n  virtualizerProps: Omit<\n    VirtualizerProps<any, unknown>,\n    \"children\" | keyof HTMLAttributes<HTMLElement>\n  >;\n} => {\n  const layout = useMemo(\n    () =>\n      new FlattenedTreeLayout({\n        /**\n         * there is currently no documentation available for these fields, but setting `rowHeight` enforces it, which\n         * wouldn't be good for custom tree UI with a different row height.\n         * wrong estimatedRowHeight seems to only affect small scrollbar position inaccuracy, which is a minor issue\n         * and not even noticeable in most cases. Also, it seems it slightly improves the performance if it exactly\n         * matches the real row height. But not even sure.\n         */\n        estimatedRowHeight: 20,\n      }),\n    []\n  );\n  layout.collection = state.collection;\n  layout.disabledKeys = state.disabledKeys;\n\n  return {\n    virtualizerProps: {\n      focusedKey: state.selectionManager.focusedKey,\n      collection: state.collection,\n      layout,\n      // Not clear how this sizeToFit is supposed to work, due to lack of documentation, but don't be tempted to\n      // think it solves the problem VariableWidthListLayout is trying to solve, because it doesn't :D\n      // Also, note that setting this to \"width\" prevents re-layout when container width is increased, which\n      // causes issues.\n      sizeToFit: \"height\",\n      scrollToItem: (key) => {\n        return layout.virtualizer.scrollToItem(key, {\n          shouldScrollX: false,\n          duration: 0,\n        });\n      },\n      scrollDirection: \"both\",\n    },\n  };\n};\n","import React, { RefObject } from \"react\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TreeRefValue } from \"@intellij-platform/core/Tree\";\n\n/**\n * Returns action definitions object for common tree actions\n * TODO: add example in docs\n */\nexport function useTreeActions({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): Record<string, ActionDefinition> {\n  return {\n    [CommonActionId.EXPAND_ALL]: {\n      title: \"Expand All\",\n      icon: <PlatformIcon icon=\"actions/expandall\" />,\n      actionPerformed: () => {\n        treeRef.current?.expandAll();\n      },\n    },\n    [CommonActionId.COLLAPSE_ALL]: {\n      title: \"Collapse All\",\n      icon: <PlatformIcon icon=\"actions/collapseall\" />,\n      actionPerformed: () => {\n        treeRef.current?.collapseAll();\n      },\n    },\n    [CommonActionId.EXPAND_SELECTION]: {\n      title: \"Expand Selection\",\n      actionPerformed: () => {\n        treeRef.current?.expandSelection();\n      },\n    },\n    [CommonActionId.SHRINK_SELECTION]: {\n      title: \"Shrink Selection\",\n      actionPerformed: () => {\n        treeRef.current?.shrinkSelection();\n      },\n    },\n  };\n}\n","import { Key } from \"react\";\n\ninterface SetState<T> {\n  items: Iterable<T>;\n\n  toggle(key: T): void;\n\n  add(...key: T[]): void;\n\n  delete(...key: T[]): void;\n}\n\nexport type SelectionState = \"NotSelected\" | \"Selected\" | \"PartiallySelected\";\n\nexport interface TreeModel<T, K = Key> {\n  rootNodes: ReadonlyArray<T>;\n  getChildren: (root: T) => ReadonlyArray<T> | /*for convenience*/ T | null;\n  getKey: (item: T) => K;\n}\n\nexport interface NestedSelectionState<T> {\n  getSelectionState: (item: T) => SelectionState;\n  toggle: (item: T) => void;\n}\n\nconst collectSelectableItems = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>\n) => {\n  const collectedItems: T[] = [];\n  collectSelectableItemsRecursive(item, getChildren, collectedItems);\n  return collectedItems;\n};\nconst collectSelectableItemsRecursive = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>,\n  collectedItems: T[] = []\n) => {\n  const children = getChildren(item);\n  if (children == null) {\n    collectedItems.push(item);\n  } else {\n    children.forEach((child) =>\n      collectSelectableItemsRecursive(child, getChildren, collectedItems)\n    );\n  }\n};\n\n// TODO: maybe change the interface to work with keys instead of items?\nexport class NestedSelection<T extends object, K = Key>\n  implements NestedSelectionState<T> {\n  cache = new WeakMap<T, SelectionState>();\n  constructor(private state: SetState<K>, private tree: TreeModel<T, K>) {\n    this.tree = tree;\n    this.state = state;\n  }\n\n  toggle(item: T) {\n    const children = this.tree.getChildren(item);\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    if (isSelectableNode) {\n      this.state.toggle(key);\n    } else {\n      const state = this.getSelectionState(item);\n      const itemsInSubtree = collectSelectableItems(item, (item) =>\n        normalizeChildren(this.tree.getChildren(item))\n      ).map(this.tree.getKey);\n      if (state === \"Selected\") {\n        this.state.delete(...itemsInSubtree);\n      } else {\n        this.state.add(...itemsInSubtree);\n      }\n    }\n  }\n\n  getSelectionState(item: T): SelectionState {\n    // caching can be refactored into a nice little decorator like WeakMapCached which would be applicable on a method\n    // with a single object argument.\n    const cachedState = this.cache.get(item);\n    if (cachedState) {\n      return cachedState;\n    }\n    const children = normalizeChildren(this.tree.getChildren(item));\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    let state: SelectionState;\n    if (isSelectableNode) {\n      state = [...this.state.items].includes(key) ? \"Selected\" : \"NotSelected\";\n    } else {\n      const allDescendantsStates = children.map((child) =>\n        this.getSelectionState(child)\n      );\n      if (allDescendantsStates.every((state) => state === \"NotSelected\")) {\n        state = \"NotSelected\";\n      } else {\n        state = allDescendantsStates.every((state) => state === \"Selected\")\n          ? \"Selected\"\n          : \"PartiallySelected\";\n      }\n    }\n    this.cache.set(item, state);\n    return state;\n  }\n}\n\nfunction normalizeChildren<T>(children: T | ReadonlyArray<T> | null) {\n  if (children) {\n    return ([] as ReadonlyArray<T>).concat(children);\n  }\n  return null;\n}\n","import React, { ForwardedRef } from \"react\";\nimport {\n  SpeedSearchTree,\n  SpeedSearchTreeProps,\n  TreeRefValue,\n} from \"@intellij-platform/core/Tree\";\nimport { NestedSelectionState } from \"./NestedSelection\";\n\n/**\n * Experimental wrapper component around SpeedSearchTree, which allows rendering {@link TreeNodeCheckbox} in nodes.\n *\n * See [design-decisions.md](../Tree/design-decisions.md) for more thoughts about how should different features\n * like this be supported.\n *\n * @alpha\n */\nexport const SpeedSearchTreeWithCheckboxes = React.forwardRef(\n  <T extends object>(\n    {\n      nestedSelection,\n      cacheInvalidation,\n      onNodeKeyDown,\n      ...props\n    }: SpeedSearchTreeProps<T> & {\n      nestedSelection: NestedSelectionState<T>;\n    },\n    ref: ForwardedRef<TreeRefValue>\n  ): React.ReactElement => {\n    const otherInvalidators =\n      typeof cacheInvalidation === \"object\"\n        ? cacheInvalidation.invalidators\n        : [];\n    return (\n      <SpeedSearchTree\n        ref={ref}\n        {...props}\n        // instead of passing cacheInvalidation, a better approach could be to provide nestedSelection as context.\n        cacheInvalidation={{\n          invalidators: [nestedSelection, ...otherInvalidators],\n        }}\n        onNodeKeyDown={(event, item) => {\n          if (event.key === \" \") {\n            nestedSelection.toggle(item.value);\n          }\n          onNodeKeyDown?.(event, item);\n        }}\n      />\n    );\n  }\n);\n","import React, { useContext } from \"react\";\nimport { Checkbox } from \"@intellij-platform/core/Checkbox\";\nimport { TreeContext } from \"@intellij-platform/core/Tree/TreeContext\";\nimport { SelectionState } from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport styled from \"styled-components\";\n\nexport type TreeNodeCheckboxProps<T extends unknown> = {\n  selectionState?: SelectionState;\n  selectItemOnPress?: boolean;\n  onToggle: () => void;\n  // maybe a isDisabled prop to be merged with isDisabled from the item?\n};\n\nconst StyledCheckboxWrapper = styled.span`\n  margin-right: 0.125rem;\n  display: inline-flex;\n`;\n\n/**\n * Checkbox to be used with {@link SpeedSearchTreeWithCheckboxes}. `SpeedSearchTreeWithCheckboxes` doesn't add the\n * checkboxes by default to the nodes, which makes it more flexible in terms of which nodes should have checkbox, or\n * it's exact placement within the tree rows.\n *\n * TreeNodeCheckbox renders a Checkbox with a few extras:\n * - `aria-label` set based on the encompassing item's textValue\n * - `isSelected` and `isIndeterminate` set based on `selectionState`\n * - `isDisabled` is set based in disabled state of the item.\n * - The encompassing item will be selected upon press, if `selectItemOnPress` is `true` (default is `true`).\n * - Small styling adjustment achieved by a wrapper StyledListIconWrapper.\n *\n * @see SpeedSearchTreeWithCheckboxes\n * @see useNestedSelectionState\n *\n * NOTE: this component currently uses TreeContext, to get a hold of selectionManager. If a more abstract component\n * like CollectionCheckbox is needed in the future, we can refactor TreeContext also to something more abstract like\n * CollectionContext which is provided by all such components like List, Tree or Table.\n */\nexport const TreeNodeCheckbox = <T extends unknown>({\n  selectionState,\n  onToggle,\n  selectItemOnPress = true,\n}: TreeNodeCheckboxProps<T>) => {\n  const treeContext = useContext(TreeContext);\n  const itemContext = useContext(ItemStateContext);\n  if (!itemContext) {\n    throw new Error(\"TreeNodeCheckbox is rendered outside tree nodes.\");\n  }\n\n  return (\n    <StyledCheckboxWrapper>\n      <Checkbox\n        preventFocus\n        aria-label={`Select ${itemContext.node.textValue}`}\n        isSelected={selectionState === \"Selected\"}\n        isIndeterminate={selectionState === \"PartiallySelected\"}\n        isDisabled={itemContext.isDisabled}\n        onChange={() => {\n          onToggle();\n          // this if and the whole need for treeContext could be avoided if event.stopPropagation() was not hard coded\n          // in useToggle: https://github.com/adobe/react-spectrum/blob/0d007bca9417c4b7b86fafd5842871bf997bd4c0/packages/@react-aria/toggle/src/useToggle.ts#L46\n          // An improvement could be to replace Checkbox with CheckboxIcon, and simply handle press on it (potential TODO)\n          if (treeContext && itemContext && selectItemOnPress) {\n            treeContext.state.selectionManager.setFocusedKey(\n              itemContext.node.key\n            );\n            treeContext.state.selectionManager.setFocused(true);\n            treeContext.state.selectionManager.setSelectedKeys([\n              itemContext.node.key,\n            ]);\n          }\n        }}\n      />\n    </StyledCheckboxWrapper>\n  );\n};\n","import { Key, useMemo } from \"react\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { useControllableSet } from \"@intellij-platform/core/utils/useSet\";\nimport {\n  NestedSelection,\n  NestedSelectionState,\n  TreeModel,\n} from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\n\n/**\n * A state management util for a selectable list of items with an arbitrary nested grouping. In other words,\n * it manages selection of leaves in a tree.\n *\n * tree is represented as a `getChildren` function that returns children for a given root. if null is passed it\n * returns the top level nodes.\n * Important Note: the tree structure that can be generated by calling `getChildren` function is supposed to be\n * **immutable**. in other words, any change in the tree, should result in a new array of top level items.\n */\n\nexport const useNestedSelectionState = <T extends object, K = Key>(\n  tree: TreeModel<T, K>,\n  {\n    selectedKeys: selectedKeysProp,\n    defaultSelectedKeys,\n    onSelectedKeysChange,\n  }: ControlledStateProps<{\n    selectedKeys: Set<K>;\n  }>\n): NestedSelectionState<T> => {\n  const [selectedKeys, selectedKeysSetter] = useControllableSet(\n    selectedKeysProp!, // bad typing in useControlledState\n    defaultSelectedKeys || new Set(),\n    onSelectedKeysChange! // bad typing in useControlledState\n  );\n  const treeRef = useLatest(tree);\n\n  return useMemo(\n    () =>\n      new NestedSelection<T, K>(\n        { items: selectedKeys, ...selectedKeysSetter },\n        treeRef.current\n      ),\n    [selectedKeys, tree.rootNodes]\n  );\n};\n","import React, { useContext } from \"react\";\n\nexport type Bounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * TODO(docs): add a few words about this abstraction and it's use.\n */\nexport type WindowInteractionHandlerProps = {\n  /**\n   * Signals start of a UI interaction like resize or move, in which window bounds change.\n   */\n  startInteraction: () => Bounds;\n  /**\n   * Used to update bounds state during a UI interaction.\n   */\n  updateBounds: (bounds: Bounds) => void;\n  /**\n   * Signals end of a UI interaction.\n   */\n  finishInteraction: () => void;\n};\n\nconst WindowInteractionHandlerContext = React.createContext<WindowInteractionHandlerProps | null>(\n  null\n);\n\n/**\n * Provides the context used by components like {@link WindowMoveHandle} and {@link WindowResizeHandles} that provide\n * user interactions that change the boundary of the window they are rendered in.\n * Use {@link useResizableMovableWindow} which implements an efficient state management for window bounds and returns\n * props to be passed to `WindowInteractionHandler`:\n *\n * @example\n *\n * const {\n *    bounds, // Bounds to be applied to the window element.\n *    windowInteractionHandlerProps,\n *  } = useResizableMovableWindow(props);\n *\n * return (\n *   <WindowInteractionHandler {...windowInteractionHandlerProps}>\n *     <div style={effectiveBounds}>...</div>\n *   </WindowInteractionHandler>\n * );\n *\n * @see useResizableMovableWindow\n */\nexport const WindowInteractionHandler = ({\n  children,\n  ...props\n}: WindowInteractionHandlerProps & { children: React.ReactNode }) => {\n  return (\n    <WindowInteractionHandlerContext.Provider value={props}>\n      {children}\n    </WindowInteractionHandlerContext.Provider>\n  );\n};\n\nexport const useWindowInteractionHandler = () =>\n  useContext(WindowInteractionHandlerContext);\n","import { useMove } from \"../utils/interaction-utils/useMove\";\nimport { useWindowInteractionHandler } from \"./WindowInteractionHandler\";\nimport React from \"react\";\n\n/**\n * Used for making a dom element a move handle for the window it's being rendered in.\n * It uses the context provided by {@link WindowInteractionHandler}, and returns props to be applied on a dom element to\n * make it a move handle for the window it's being rendered in.\n *\n * @see WindowMoveHandle\n */\nexport function useWindowMoveHandle() {\n  const interactionHandler = useWindowInteractionHandler();\n  if (!interactionHandler) {\n    return { moveHandleProps: {} };\n  }\n  const {\n    finishInteraction,\n    startInteraction,\n    updateBounds,\n  } = interactionHandler;\n\n  const moveProps = useMove({\n    onMoveStart: () => {\n      return startInteraction();\n    },\n    onMove: ({ startState, movement }) => {\n      updateBounds({\n        ...startState,\n        top: startState.top + movement.y,\n        left: startState.left + movement.x,\n      });\n    },\n    onMoveEnd: () => {\n      finishInteraction();\n    },\n  });\n  return { moveHandleProps: moveProps || {} };\n}\n\n/**\n * Used for making a dom element a move handle for the window it's being rendered in.\n * It uses the context provided by {@link WindowInteractionHandler}. A render function is expected as `children`. It's\n * passed the event handlers that need to be applied on a dom element to make it a move handle for the window it's being\n * rendered in.\n */\nexport const WindowMoveHandle = ({\n  children,\n}: {\n  children: (\n    props: ReturnType<typeof useWindowMoveHandle>\n  ) => React.ReactElement;\n}) => {\n  return children(useWindowMoveHandle());\n};\n","import React, { useRef } from \"react\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport {\n  HorizontalResizerProps,\n  VerticalResizerProps,\n} from \"../Resizer/ResizerProps\";\nimport {\n  Bounds,\n  useWindowInteractionHandler,\n} from \"./WindowInteractionHandler\";\n\nconst FLOAT_WINDOW_MIN_WIDTH = 100;\nconst FLOAT_WINDOW_MIN_HEIGHT = 40; // in Intellij Platform it's zero but there is window frame which doesn't exist here\ntype WindowResizeHandlesProps = {\n  minWidth?: number;\n  minHeight?: number;\n};\n\n/**\n * Renders invisible resize handles at the edges of the window it's rendered in. It uses the context provided by\n * {@link WindowInteractionHandler} to resize the window when the handles are used.\n */\nexport function WindowResizeHandles(props: WindowResizeHandlesProps) {\n  const windowResizer = useWindowResizer(props);\n  return (\n    windowResizer && (\n      <>\n        <RightResizer {...windowResizer.getResizerProps(\"right\")} />\n        <LeftResizer {...windowResizer.getResizerProps(\"left\")} />\n        <TopResizer {...windowResizer.getResizerProps(\"top\")} />\n        <BottomResizer {...windowResizer.getResizerProps(\"bottom\")} />\n      </>\n    )\n  );\n}\n\n/**\n * window resizing logic and state. When resizing is in progress, the source of truth is a local state, for performance\n * reasons. When the resize is done (e.g. by mouse being released), `onBoundsChange` is called with the new bounds.\n */\nfunction useWindowResizer({\n  minWidth = FLOAT_WINDOW_MIN_WIDTH,\n  minHeight = FLOAT_WINDOW_MIN_HEIGHT,\n}: WindowResizeHandlesProps = {}) {\n  const initialBoundsRef = useRef<Bounds>({\n    top: 0,\n    height: 0,\n    width: 0,\n    left: 0,\n  });\n  const interactionHandler = useWindowInteractionHandler();\n  if (!interactionHandler) {\n    return null;\n  }\n  const {\n    finishInteraction,\n    startInteraction,\n    updateBounds,\n  } = interactionHandler;\n\n  const onResize = {\n    right: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        width: Math.max(minWidth, initialBoundsRef.current.width + size),\n      }),\n    bottom: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        height: Math.max(minHeight, initialBoundsRef.current.height + size),\n      }),\n    left: (size: number) => {\n      const newWidth = Math.max(\n        minWidth,\n        initialBoundsRef.current.width + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        left: initialBounds.left + initialBounds.width - newWidth,\n        width: newWidth,\n      });\n    },\n    top: (size: number) => {\n      const newHeight = Math.max(\n        minHeight,\n        initialBoundsRef.current.height + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        top: initialBounds.top + initialBounds.height - newHeight,\n        height: newHeight,\n      });\n    },\n  };\n\n  function getResizerProps(side: \"left\" | \"right\"): HorizontalResizerProps;\n  function getResizerProps(side: \"top\" | \"bottom\"): VerticalResizerProps;\n  function getResizerProps(\n    side: \"left\" | \"right\" | \"top\" | \"bottom\"\n  ): HorizontalResizerProps | VerticalResizerProps {\n    const horizontal = side === \"left\" || side === \"right\";\n    return {\n      size: 1,\n      cursor: horizontal ? \"ew\" : \"ns\",\n      onResizeStarted: () => {\n        initialBoundsRef.current = startInteraction();\n      },\n      onResize: onResize[side],\n      onResizeEnd: finishInteraction,\n      style: { position: \"absolute\", [side]: 0 },\n    };\n  }\n\n  return {\n    getResizerProps,\n  };\n}\n","import { useRef, useState } from \"react\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  Bounds,\n  WindowInteractionHandlerProps,\n} from \"./WindowInteractionHandler\";\nimport { ModalWindowProps } from \"@intellij-platform/core/ModalWindow\";\nimport { clamp } from \"ramda\";\n\nexport interface UseResizableMovableWindowOptions\n  extends ControlledStateProps<{ bounds: Bounds }> {\n  /**\n   * Allows validating/intercepting bound changes during an interaction.\n   */\n  interceptInteraction?: (\n    newBounds: Bounds,\n    /**\n     * Whether the interaction is a \"move\" or \"resize\" considering the initial bounds when interaction was started.\n     */\n    interactionType: \"move\" | \"resize\"\n  ) => Bounds;\n}\n/**\n * TODO: description\n * TODO: rename to something better :D\n * TODO: maybe an option like ensureInViewport that would move the final bound into the viewport (if necessary), when\n *  calling onBoundsChange at the end of an interaction. That's important because if move handle(s) (usually rendered\n *  at the top of the window) are out of reach, there would be no way back.\n */\nexport function useResizableMovableWindow({\n  bounds: boundsProp,\n  defaultBounds,\n  onBoundsChange,\n  interceptInteraction = (i) => i,\n}: UseResizableMovableWindowOptions) {\n  const [bounds, setBounds] = useControlledState(\n    boundsProp!,\n    defaultBounds || getDefaultBounds(),\n    onBoundsChange!\n  );\n  const initialBoundsRef = useRef<null | Bounds>(null);\n  // local state of bounds for when window is in a UI interaction, like movement or resize with mouse.\n  // We don't want to update the state in the higher levels repeatedly in such transactions, and we just want to\n  // trigger on update when the UI interaction is done.\n  // It's maintained during a UI interaction and then reset to null.\n  const [currentInteractionBounds, setCurrentInteractionBounds] =\n    useState<null | Bounds>(null);\n  const onInteractionEnd = () => {\n    if (currentInteractionBounds) {\n      setBounds(currentInteractionBounds);\n    }\n    setCurrentInteractionBounds(null);\n  };\n  const effectiveBounds = currentInteractionBounds || bounds;\n  const windowInteractionHandlerProps: WindowInteractionHandlerProps = {\n    startInteraction: () => {\n      setCurrentInteractionBounds(bounds);\n      initialBoundsRef.current = bounds;\n      return bounds;\n    },\n    updateBounds: (bounds) => {\n      setCurrentInteractionBounds(\n        interceptInteraction(\n          bounds,\n          bounds.width === initialBoundsRef.current?.width &&\n            bounds.height === initialBoundsRef.current?.height\n            ? \"move\"\n            : \"resize\"\n        )\n      );\n    },\n    finishInteraction: onInteractionEnd,\n  };\n  return { bounds: effectiveBounds, windowInteractionHandlerProps };\n}\n\nexport function getDefaultBounds(\n  width: number = Math.max(window.innerWidth / 3, 300),\n  height: number = Math.max(window.innerHeight / 3, 200)\n): Bounds {\n  return {\n    left: (window.innerWidth - width) / 2,\n    top: (window.innerHeight - height) / 2,\n    width,\n    height,\n  };\n}\n\n/**\n * A helper function to create interaction interceptor which ensures bounds are contained within a container.\n *\n * @example\n * const ensureInViewPort = containedWithin({left: 0, top: 0, width: window.innerWidth, height: window.innerHeight})\n *\n * useResizableMovableWindow({ interceptInteraction: ensureInViewPort});\n */\nexport const containedWithin =\n  (containerBounds: Bounds): ModalWindowProps[\"interceptInteraction\"] =>\n  (bounds, interactionType) => {\n    if (interactionType === \"move\") {\n      const left = clamp(\n        containerBounds.left,\n        containerBounds.left + containerBounds.width - bounds.width,\n        bounds.left\n      );\n      const top = clamp(\n        containerBounds.top,\n        containerBounds.top + containerBounds.height - bounds.height,\n        bounds.top\n      );\n      return {\n        ...bounds,\n        left,\n        top,\n      };\n    } else if (interactionType === \"resize\") {\n      const left = Math.max(containerBounds.left, bounds.left);\n      const top = Math.max(containerBounds.top, bounds.top);\n      // the logic here seems unnecessarily complicated\n      return {\n        left,\n        top,\n        width:\n          bounds.width -\n          Math.max(\n            0,\n            bounds.left +\n              bounds.width -\n              (containerBounds.left + containerBounds.width)\n          ) -\n          (left - bounds.left),\n        height:\n          bounds.height -\n          Math.max(\n            0,\n            bounds.top +\n              bounds.height -\n              (containerBounds.top + containerBounds.height)\n          ) -\n          (top - bounds.top),\n      };\n    }\n    return bounds;\n  };\n","export function isWordSeparator(c: string) {\n  return (\n    isWhitespace(c) || c == \"_\" || c == \"-\" || c == \":\" || c == \"+\" || c == \".\"\n  );\n}\n\nexport function isWhitespace(char: string): boolean {\n  return /^\\s*$/.test(char);\n}\n\nexport function isUpperCase(str: string) {\n  return str.toUpperCase() === str && str.toLowerCase() !== str;\n}\n","import { createRangesFromIndices, TextRange } from \"./TextRange\";\nimport {\n  isUpperCase,\n  isWhitespace,\n  isWordSeparator,\n} from \"./utils/string-utils\";\n\nfunction isMeaningfulChar(ch: string) {\n  return !isWordSeparator(ch) && !isWhitespace(ch);\n}\n\n// Simplified version of https://github.com/JetBrains/intellij-community/blob/master/platform/util/text-matching/src/com/intellij/psi/codeStyle/MinusculeMatcherImpl.java\nexport const minusculeMatch = (\n  input: string,\n  rawPattern: string\n): Array<TextRange> | null => {\n  const isStarts = input.split(\"\").map(isStart);\n  const pattern = rawPattern.split(\"\").filter(isMeaningfulChar).join(\"\");\n  const matches: Array<{ patternIndex: number; inputIndex: number }> = [];\n  let continuous = false;\n  let inputIndex = 0,\n    patternIndex = 0;\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    if (matches.length === pattern.length) {\n      return createRangesFromIndices(matches.map(({ inputIndex: i }) => i));\n    }\n    if (inputIndex > input.length - 1) {\n      if (matches.length > 0) {\n        // TODO: the same character match can be popped out and in several times, if something\n        //  is popped out, it should never be added back again, since it's already examined without\n        //  a full match.\n        const lastMatch = matches.pop()!;\n        inputIndex = lastMatch.inputIndex + 1;\n        patternIndex = lastMatch.patternIndex;\n        continue;\n      }\n      break;\n    }\n    if (!isMeaningfulChar(input[inputIndex])) {\n      inputIndex++;\n      continue;\n    }\n    if (\n      pattern[patternIndex].toLowerCase() === input[inputIndex].toLowerCase() &&\n      (continuous || isStarts[inputIndex] || matches.length === 0)\n    ) {\n      matches.push({ patternIndex, inputIndex });\n      continuous = true;\n      patternIndex++;\n      inputIndex++;\n    } else {\n      continuous = false;\n      inputIndex++;\n    }\n  }\n  return null;\n};\n\nfunction isStart(char: string, index: number, chars: string[]): boolean {\n  const previousChar = chars[index - 1];\n  return (\n    index === 0 ||\n    (isWordSeparator(previousChar) && !isWordSeparator(char)) ||\n    (isUpperCase(char) && !isUpperCase(previousChar))\n  );\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport React, {\n  FocusEvent,\n  HTMLAttributes,\n  Key,\n  KeyboardEvent,\n  RefObject,\n  useEffect,\n} from \"react\";\nimport { focusSafely, getFocusableTreeWalker } from \"@react-aria/focus\";\nimport { FocusStrategy, KeyboardDelegate } from \"@react-types/shared\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { MultipleSelectionManager } from \"@react-stately/selection\";\nimport { useLocale } from \"@react-aria/i18n\";\nimport { useTypeSelect } from \"@react-aria/selection\";\nimport { isCtrlKeyPressed } from \"../utils/keyboard-utils\";\n\ninterface SelectableCollectionOptions {\n  /**\n   * An interface for reading and updating multiple selection state.\n   */\n  selectionManager: MultipleSelectionManager;\n  /**\n   * A delegate object that implements behavior for keyboard focus movement.\n   */\n  keyboardDelegate: KeyboardDelegate;\n  /**\n   * The ref attached to the element representing the collection.\n   */\n  ref: RefObject<HTMLElement>;\n  /**\n   * Whether the collection or one of its items should be automatically focused upon render.\n   * @default false\n   */\n  autoFocus?: boolean | FocusStrategy;\n  /**\n   * Whether focus should wrap around when the end/start is reached.\n   * @default false\n   */\n  shouldFocusWrap?: boolean;\n  /**\n   * Whether the collection allows empty selection.\n   * @default false\n   */\n  disallowEmptySelection?: boolean;\n  /**\n   * Whether the collection allows the user to select all items via keyboard shortcut.\n   * @default false\n   */\n  disallowSelectAll?: boolean;\n  /**\n   * Whether selection should occur automatically on focus.\n   * @default false\n   */\n  selectOnFocus?: boolean;\n  /**\n   * Whether typeahead is disabled.\n   * @default false\n   */\n  disallowTypeAhead?: boolean;\n  /**\n   * Whether the collection items should use virtual focus instead of being focused directly.\n   */\n  shouldUseVirtualFocus?: boolean;\n  /**\n   * Whether navigation through tab key is enabled.\n   */\n  allowsTabNavigation?: boolean;\n}\n\ninterface SelectableCollectionAria {\n  /** Props for the collection element. */\n  collectionProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles interactions with selectable collections.\n */\nexport function useSelectableCollection(\n  options: SelectableCollectionOptions\n): SelectableCollectionAria {\n  let {\n    selectionManager: manager,\n    keyboardDelegate: delegate,\n    ref,\n    autoFocus = false,\n    shouldFocusWrap = false,\n    disallowEmptySelection = false,\n    disallowSelectAll = false,\n    selectOnFocus = false,\n    disallowTypeAhead = false,\n    shouldUseVirtualFocus,\n    allowsTabNavigation = false,\n  } = options;\n  let { direction } = useLocale();\n\n  let onKeyDown = (e: KeyboardEvent) => {\n    // Let child element (e.g. menu button) handle the event if the Alt key is pressed.\n    // Keyboard events bubble through portals. Don't handle keyboard events\n    // for elements outside the collection (e.g. menus).\n    if (e.altKey || !ref.current?.contains(e.target as HTMLElement)) {\n      return;\n    }\n\n    const navigateToKey = (\n      key: Key | undefined,\n      childFocus?: FocusStrategy\n    ) => {\n      if (key != null) {\n        manager.setFocusedKey(key, childFocus);\n\n        if (e.shiftKey && manager.selectionMode === \"multiple\") {\n          manager.extendSelection(key);\n        } else if (selectOnFocus) {\n          manager.replaceSelection(key);\n        }\n      }\n    };\n\n    switch (e.key) {\n      case \"ArrowDown\": {\n        if (delegate.getKeyBelow) {\n          e.preventDefault();\n          let nextKey =\n            manager.focusedKey != null\n              ? delegate.getKeyBelow(manager.focusedKey)\n              : delegate.getFirstKey?.();\n          if (nextKey == null && shouldFocusWrap) {\n            nextKey = delegate.getFirstKey?.(manager.focusedKey);\n          }\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      }\n      case \"ArrowUp\": {\n        if (delegate.getKeyAbove) {\n          e.preventDefault();\n          let nextKey =\n            manager.focusedKey != null\n              ? delegate.getKeyAbove(manager.focusedKey)\n              : delegate.getLastKey?.();\n          if (nextKey == null && shouldFocusWrap) {\n            nextKey = delegate.getLastKey?.(manager.focusedKey);\n          }\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      }\n      case \"ArrowLeft\": {\n        if (delegate.getKeyLeftOf) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyLeftOf(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey, direction === \"rtl\" ? \"first\" : \"last\");\n        }\n        break;\n      }\n      case \"ArrowRight\": {\n        if (delegate.getKeyRightOf) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyRightOf(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey, direction === \"rtl\" ? \"last\" : \"first\");\n        }\n        break;\n      }\n      case \"Home\":\n        if (delegate.getFirstKey) {\n          e.preventDefault();\n          let firstKey = delegate.getFirstKey(\n            manager.focusedKey,\n            isCtrlKeyPressed(e)\n          );\n          // @ts-expect-error ignored strictness error in copied code\n          manager.setFocusedKey(firstKey);\n          if (\n            isCtrlKeyPressed(e) &&\n            e.shiftKey &&\n            manager.selectionMode === \"multiple\"\n          ) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.extendSelection(firstKey);\n          } else if (selectOnFocus) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.replaceSelection(firstKey);\n          }\n        }\n        break;\n      case \"End\":\n        if (delegate.getLastKey) {\n          e.preventDefault();\n          let lastKey = delegate.getLastKey(\n            manager.focusedKey,\n            isCtrlKeyPressed(e)\n          );\n          // @ts-expect-error ignored strictness error in copied code\n          manager.setFocusedKey(lastKey);\n          if (\n            isCtrlKeyPressed(e) &&\n            e.shiftKey &&\n            manager.selectionMode === \"multiple\"\n          ) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.extendSelection(lastKey);\n          } else if (selectOnFocus) {\n            // @ts-expect-error ignored strictness error in copied code\n            manager.replaceSelection(lastKey);\n          }\n        }\n        break;\n      case \"PageDown\":\n        if (delegate.getKeyPageBelow) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyPageBelow(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      case \"PageUp\":\n        if (delegate.getKeyPageAbove) {\n          e.preventDefault();\n          let nextKey = delegate.getKeyPageAbove(manager.focusedKey);\n          // @ts-expect-error ignored strictness error in copied code\n          navigateToKey(nextKey);\n        }\n        break;\n      case \"a\":\n        if (\n          isCtrlKeyPressed(e) &&\n          manager.selectionMode === \"multiple\" &&\n          disallowSelectAll !== true\n        ) {\n          e.preventDefault();\n          manager.selectAll();\n        }\n        break;\n      case \"Escape\":\n        e.preventDefault();\n        if (!disallowEmptySelection) {\n          manager.clearSelection();\n        }\n        break;\n      case \"Tab\": {\n        if (!allowsTabNavigation) {\n          // There may be elements that are \"tabbable\" inside a collection (e.g. in a grid cell).\n          // However, collections should be treated as a single tab stop, with arrow key navigation internally.\n          // We don't control the rendering of these, so we can't override the tabIndex to prevent tabbing.\n          // Instead, we handle the Tab key, and move focus manually to the first/last tabbable element\n          // in the collection, so that the browser default behavior will apply starting from that element\n          // rather than the currently focused one.\n          if (e.shiftKey) {\n            ref.current.focus();\n          } else {\n            let walker = getFocusableTreeWalker(ref.current, {\n              tabbable: true,\n            });\n            let next: HTMLElement | undefined;\n            let last: HTMLElement;\n            do {\n              last = walker.lastChild() as HTMLElement;\n              if (last) {\n                next = last;\n              }\n            } while (last);\n\n            if (next && !next.contains(document.activeElement)) {\n              next.focus();\n            }\n          }\n          break;\n        }\n      }\n    }\n  };\n\n  let onFocus = (e: FocusEvent) => {\n    if (manager.isFocused) {\n      // If a focus event bubbled through a portal, reset focus state.\n      if (!e.currentTarget.contains(e.target)) {\n        manager.setFocused(false);\n      }\n\n      return;\n    }\n\n    // Focus events can bubble through portals. Ignore these events.\n    if (!e.currentTarget.contains(e.target)) {\n      return;\n    }\n\n    manager.setFocused(true);\n\n    if (manager.focusedKey == null) {\n      // If the user hasn't yet interacted with the collection, there will be no focusedKey set.\n      // Attempt to detect whether the user is tabbing forward or backward into the collection\n      // and either focus the first or last item accordingly.\n      let relatedTarget = e.relatedTarget as Element;\n      let key: Key | undefined;\n      if (\n        relatedTarget &&\n        e.currentTarget.compareDocumentPosition(relatedTarget) &\n          Node.DOCUMENT_POSITION_FOLLOWING\n      ) {\n        // @ts-expect-error ignored strictness error in copied code\n        key = manager.lastSelectedKey ?? delegate.getLastKey?.();\n      } else {\n        // @ts-expect-error ignored strictness error in copied code\n        key = manager.firstSelectedKey ?? delegate.getFirstKey?.();\n      }\n      if (key != null) {\n        manager.setFocusedKey(key);\n      }\n    }\n  };\n\n  let onBlur = (e: FocusEvent) => {\n    // Don't set blurred and then focused again if moving focus within the collection.\n    if (!e.currentTarget.contains(e.relatedTarget as HTMLElement)) {\n      manager.setFocused(false);\n    }\n  };\n\n  useEffect(() => {\n    if (autoFocus) {\n      let focusedKey = null;\n\n      // Check focus strategy to determine which item to focus\n      if (autoFocus === \"first\") {\n        focusedKey = delegate.getFirstKey?.();\n      }\n      if (autoFocus === \"last\") {\n        focusedKey = delegate.getLastKey?.();\n      }\n\n      // If there are any selected keys, make the first one the new focus target\n      let selectedKeys = manager.selectedKeys;\n      if (selectedKeys.size) {\n        focusedKey = selectedKeys.values().next().value;\n      }\n\n      manager.setFocused(true);\n      manager.setFocusedKey(focusedKey);\n\n      // If no default focus key is selected, focus the collection itself.\n      if (focusedKey == null && !shouldUseVirtualFocus && ref.current) {\n        focusSafely(ref.current);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  let handlers = {\n    onKeyDown,\n    onFocus,\n    onBlur,\n    onMouseDown(e: React.MouseEvent) {\n      // Prevent focus going to the collection when clicking on the scrollbar.\n      e.preventDefault();\n    },\n  };\n\n  let { typeSelectProps } = useTypeSelect({\n    keyboardDelegate: delegate,\n    selectionManager: manager,\n    onTypeSelect: selectOnFocus\n      ? (key) => {\n          manager.replaceSelection(key);\n        }\n      : undefined,\n  });\n\n  if (!disallowTypeAhead) {\n    handlers = mergeProps(typeSelectProps, handlers);\n  }\n\n  // If nothing is focused within the collection, make the collection itself tabbable.\n  // This will be marshalled to either the first or last item depending on where focus came from.\n  // If using virtual focus, don't set a tabIndex at all so that VoiceOver on iOS 14 doesn't try\n  // to move real DOM focus to the element anyway.\n  let tabIndex: number | undefined;\n  if (!shouldUseVirtualFocus) {\n    tabIndex = manager.focusedKey == null ? 0 : -1;\n  }\n\n  return {\n    collectionProps: {\n      ...handlers,\n      tabIndex,\n    },\n  };\n}\n","import { useSelectableItem as useOriginalSelectableItem } from \"@react-aria/selection\";\nimport { MouseEventHandler } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\n/**\n * A wrapper around useSelectableItem, which adjusts for intellij platform nuances:\n * - Selects item with right clicks as well, which allows ContextMenuContainer to be used with any collection component\n *   without the need for built-in context-menu support in such components. We won't need this if we move to a built-in\n *   context-menu support for List,Tree, etc.\n * @private\n */\nexport const useSelectableItem: typeof useOriginalSelectableItem = (\n  options\n) => {\n  const onContextMenu: MouseEventHandler<HTMLElement> = (e) => {\n    if (!options.selectionManager.isSelected(options.key)) {\n      options.selectionManager.select(options.key, {\n        type: \"press\",\n        pointerType: \"mouse\",\n        target: e.currentTarget,\n        shiftKey: e.shiftKey,\n        metaKey: e.metaKey,\n        ctrlKey: e.ctrlKey,\n        altKey: e.altKey,\n      });\n    }\n  };\n  const result = useOriginalSelectableItem(options);\n  return {\n    ...result,\n    itemProps: mergeProps(result.itemProps, { onContextMenu }),\n  };\n};\n","/**\n * Drop shadow of windows and other overlays.\n * The current value is not accurate and needs to be revisited. It should also be os-dependant.\n * FIXME: On windows, there is only a border-like shadow. No drop shadow\n * FIXME: On Mac, there is a border-like shadow and a drop shadow. the border-like shadow is missing in the current value\n */\nexport const WINDOW_SHADOW = \"box-shadow: 0 5px 15px rgb(0 0 0 / 30%)\";\n","import {\n  FocusManager,\n  focusSafely,\n  FocusScope as WrappedFocusScope,\n  FocusScopeProps,\n  useFocusManager,\n} from \"@react-aria/focus\";\nimport React, {\n  ForwardedRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useRef,\n} from \"react\";\n\ntype BetterFocusScopeProps = FocusScopeProps & {\n  /**\n   *\n   */\n  forceRestoreFocus?: boolean;\n};\n/**\n * A version of FocusScope which also allows for imperatively moving focus to the scope.\n * and has tiny patches/improvements\n * It's useful for\n */\nexport const FocusScope = React.forwardRef(function BetterFocusScope(\n  { children, forceRestoreFocus, ...otherProps }: BetterFocusScopeProps,\n  ref: ForwardedRef<{ focus: (forceFocusFirst?: boolean) => void }>\n) {\n  const directChildRef = useRef<HTMLSpanElement>(null);\n  const focusManagerRef = useRef<FocusManager>(null);\n  useForceRestoreFocus(forceRestoreFocus);\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (forceFocusFirst?: boolean) => {\n        const focusManager = focusManagerRef.current;\n        const containerElement = directChildRef.current?.parentElement;\n        if (!focusManager) {\n          throw new Error(\"focus manager not found!\");\n        }\n        if (!containerElement) {\n          throw new Error(\"container element not found\");\n        }\n        if (forceFocusFirst) {\n          return focusManager.focusFirst();\n        }\n        const alreadyHasFocused =\n          document.activeElement &&\n          document.activeElement !== containerElement &&\n          containerElement.contains(document.activeElement);\n        if (!alreadyHasFocused) {\n          focusManager.focusNext({ tabbable: true });\n        }\n      },\n    }),\n    []\n  );\n\n  return (\n    <WrappedFocusScope {...otherProps}>\n      <GetFocusManager ref={focusManagerRef} />\n      <span data-focus-root-direct-child=\"\" hidden ref={directChildRef} />\n      {children}\n    </WrappedFocusScope>\n  );\n});\nconst GetFocusManager = React.forwardRef(function FocusScopeHandle(\n  props: {},\n  ref: ForwardedRef<FocusManager>\n) {\n  const focusManager = useFocusManager();\n  useImperativeHandle(ref, () => focusManager, [focusManager]);\n  return null;\n});\n\n/**\n * Kind of a patchy solution for focus restoration when currently focused element is in a different focus scope, but\n * we still want focus restoration to work. So far the only use case is in nested menu, which is rendered as a separate\n * overlay with a focus scope. If focus is within that submenu, when the menu is closed, the default `restoreFocus`\n * doesn't work because there is a check in useRestoreFocus, which requires the currently focused element to be in\n * the focus scope, to do the focus restoration:\n * https://github.com/adobe/react-spectrum/blob/e14523fedd93ac1a4ede355aed70988af572ae74/packages/%40react-aria/focus/src/FocusScope.tsx#L460\n */\nfunction useForceRestoreFocus(restoreFocus?: boolean) {\n  useLayoutEffect(() => {\n    let nodeToRestore = document.activeElement as HTMLElement;\n\n    return () => {\n      if (restoreFocus && nodeToRestore) {\n        requestAnimationFrame(() => {\n          if (document.body.contains(nodeToRestore)) {\n            focusSafely(nodeToRestore);\n          }\n        });\n      }\n    };\n  }, [restoreFocus]);\n}\n","/**\n * IMPORTANT: this is a copy of a non-exported file from @react-aria/interactions\n */\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { runAfterTransition } from \"@react-aria/utils\";\n\n// Safari on iOS starts selecting text on long press. The only way to avoid this, it seems,\n// is to add user-select: none to the entire page. Adding it to the pressable element prevents\n// that element from being selected, but nearby elements may still receive selection. We add\n// user-select: none on touch start, and remove it again on touch end to prevent this.\n// This must be implemented using global state to avoid race conditions between multiple elements.\n\n// There are three possible states due to the delay before removing user-select: none after\n// pointer up. The 'default' state always transitions to the 'disabled' state, which transitions\n// to 'restoring'. The 'restoring' state can either transition back to 'disabled' or 'default'.\ntype State = \"default\" | \"disabled\" | \"restoring\";\n\nlet state: State = \"default\";\nlet savedUserSelect = \"\";\n\nexport function disableTextSelection() {\n  if (state === \"default\") {\n    savedUserSelect = document.documentElement.style.webkitUserSelect;\n    document.documentElement.style.webkitUserSelect = \"none\";\n  }\n\n  state = \"disabled\";\n}\n\nexport function restoreTextSelection() {\n  // If the state is already default, there's nothing to do.\n  // If it is restoring, then there's no need to queue a second restore.\n  if (state !== \"disabled\") {\n    return;\n  }\n\n  state = \"restoring\";\n\n  // There appears to be a delay on iOS where selection still might occur\n  // after pointer up, so wait a bit before removing user-select.\n  setTimeout(() => {\n    // Wait for any CSS transitions to complete so we don't recompute style\n    // for the whole page in the middle of the animation and cause jank.\n    runAfterTransition(() => {\n      // Avoid race conditions\n      if (state === \"restoring\") {\n        if (document.documentElement.style.webkitUserSelect === \"none\") {\n          document.documentElement.style.webkitUserSelect =\n            savedUserSelect || \"\";\n        }\n\n        savedUserSelect = \"\";\n        state = \"default\";\n      }\n    });\n  }, 300);\n}\n","import React, { MouseEventHandler } from \"react\";\nimport { disableTextSelection, restoreTextSelection } from \"./textSelection\";\nimport { useLatest } from \"../useLatest\";\n\nexport type XY = { x: number; y: number };\nexport type UseMoveOptions<S> = {\n  /**\n   * the amount of movement (in pixels) after which the move should start. It prevents interference\n   * with simple click (or more generally, press) events, and provides better UX.\n   * @default 0\n   */\n  dragThreshold?: number;\n  disabled?: boolean;\n  onMoveStart: (args: { from: XY }) => S;\n  onMove: (args: { from: XY; to: XY; movement: XY; startState: S }) => void;\n  onMoveEnd?: (args: { startState: S }) => void;\n};\n\n// TODO: cleanup if unmount happens during drag.\n// TODO: Better even handling for touch devices?\n//  wrapping `useMove` from react-aria to just add support for movement threshold should be the\n//  way to go, but there are a few problems:\n//    - it seemed a little buggy in the example here: https://react-spectrum.adobe.com/react-aria/useMove.html\n//    - the API is not great in a sense that it only gives the diff in last movement.\n//      Also onMoveStart doesn't give the initial position, so it's not possible to even calculate\n//\n// TODO: move should be finished by pressing Escape. onMoveCancel maybe?\n/**\n * Similar to https://react-spectrum.adobe.com/react-aria/useMove.html, with slightly different\n * features and API.\n * NOTE: initially the API was designed in a way that onMove and onMove end callbacks were\n * returned from onMoveStart, instead of being directly passed in the options.\n * This would enable capturing the initial state of each move transaction, by defining whatever\n * variable in onMoveStart and closing over them by onMove and onMoveEnd.\n * The problem with this approach was that although you could capture the initial state of the\n * movement, by closure, any other variable in the outer scopes was also closed over, and you were\n * stuck with the values from the particular render in which the movement was started.\n * Of course, you could work around it by using refs, but it would be unintuitive.\n * So because of that issue, it's redesigned to have onMoveStart, onMove, and onMoveEnd all\n * directly passed as options, but you can return anything from `onMoveStart` which will be passed\n * to onMove and onMoveEnd as `startState`.\n */\nexport function useMove<S>({\n  dragThreshold = 0,\n  disabled,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n}: UseMoveOptions<S>): { onMouseDown?: MouseEventHandler } {\n  const handlersRef = useLatest({ onMove, onMoveEnd });\n\n  const onMouseDown = (event: React.MouseEvent) => {\n    disableTextSelection();\n    const from = { x: event.pageX, y: event.pageY };\n    let dragStarted = false;\n    let startState: S;\n\n    const onMouseMove = (event: MouseEvent) => {\n      const { pageX: x, pageY: y } = event;\n      const movement = { x: x - from.x, y: y - from.y };\n      const isDraggedEnough =\n        Math.abs(movement.x) >= dragThreshold ||\n        Math.abs(movement.y) >= dragThreshold;\n      if (isDraggedEnough && !dragStarted) {\n        dragStarted = true;\n        startState = onMoveStart({ from });\n      }\n      if (dragStarted) {\n        handlersRef.current.onMove({\n          from,\n          to: { x: from.x + movement.x, y: from.y + movement.y },\n          movement,\n          startState,\n        });\n      }\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n\n    document.addEventListener(\n      \"mouseup\",\n      () => {\n        restoreTextSelection();\n        if (dragStarted) {\n          handlersRef.current.onMoveEnd?.({ startState });\n        }\n        document.removeEventListener(\"mousemove\", onMouseMove);\n      },\n      { once: true }\n    );\n  };\n  return disabled ? {} : { onMouseDown };\n}\n","import React from \"react\";\nimport { isMac } from \"@react-aria/utils\";\n\nexport function isCtrlKeyPressed(\n  e: { metaKey: boolean; ctrlKey: boolean } | undefined\n) {\n  if (isMac()) {\n    return e?.metaKey;\n  }\n\n  return e?.ctrlKey;\n}\n\nexport function hasAnyModifier(e: KeyboardEvent | React.KeyboardEvent) {\n  return e.altKey || e.ctrlKey || e.metaKey || e.shiftKey;\n}\n","import React, { useContext } from \"react\";\n\nexport const useContextOrThrow = <ContextType extends unknown>(\n  Context: React.Context<ContextType | null>,\n  nullErrorMessage: string\n) => {\n  const context = useContext<ContextType | null>(Context);\n\n  if (context == null) {\n    throw new Error(nullErrorMessage);\n  }\n\n  return context;\n};\n","import { useCallback, useLayoutEffect, useRef } from \"react\";\n\n/**\n * Interim solution for non-reactive callbacks, until\n * [useEvent](https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md) (or whatever it will end up being\n * called), becomes available.\n */\nexport function useEventCallback<A, R>(\n  fn: (...args: A[]) => R\n): (...args: A[]) => R | undefined {\n  let ref = useRef<typeof fn>();\n  useLayoutEffect(() => {\n    ref.current = fn;\n  });\n  return useCallback((...args) => ref.current?.apply(null, args), []);\n}\n","import { useRef } from \"react\";\n\nexport function useLatest<T>(value: T) {\n  const ref = useRef(value);\n  // FIXME: With concurrent features enabled, it's not safe to update ref value at render phase.\n  //  Should be safe to update the value in a layoutEffect instead, but usages should be checked after the refactoring\n  ref.current = value;\n  return ref;\n}\n","import React, { useRef } from \"react\";\nimport { useLayoutEffect } from \"@react-aria/utils\";\nimport {\n  AriaPositionProps,\n  PositionAria,\n  useOverlayPosition,\n} from \"@react-aria/overlays\";\n\n/**\n * `useOverlayPosition` only supports positioning overlay relative to an element, at the moment.\n *  For context menu or tooltip, we may want to position the overlay based on the coordinates of the mouse event which\n *  has triggered the overlay.\n *  This hook wraps `useOverlayPosition`, and is very similar to it, but you don't need to pass `targetRef`. Instead,\n *  you have to call the updatePosition in the event handler that triggers the overlay, passing the `MouseEvent` object.\n *\n * This is hopefully a temporary solution to circumvents the limitation of `useOverlayPosition`, until it supports\n * non-element based positioning as well. It works by appending a dummy 1x1 px element to body and positioning it\n * based on React.MouseEvent objects. Then it uses a ref to that element as the `targetRef`, passed to `useOverlayPosition`\n *\n * @example\n * ```ts\n * const { updatePosition, overlyProps} = useMouseEventOverlayPosition({ overlayRef });\n *\n * const onContextMenu = (event: React.ReactEvent) => {\n *  updatePosition(event);\n *  // ...\n * }\n * ```\n */\nlet globalMoveHandler: null | ((e: MouseEvent) => void) = null;\nlet lastMouseClientPos = { x: 0, y: 0 };\n\nexport function useMouseEventOverlayPosition(\n  options: Omit<AriaPositionProps, \"targetRef\">\n): Omit<PositionAria, \"updatePosition\"> & {\n  updatePosition: (event?: React.MouseEvent) => void;\n} {\n  const targetRef = useRef<HTMLElement>(null);\n\n  useLayoutEffect(() => {\n    if (!globalMoveHandler) {\n      // After the first use of the hook, the listener will be attached forever. Not a big deal but can be improved.\n      globalMoveHandler = (e) => {\n        lastMouseClientPos = { x: e.clientX, y: e.clientY };\n      };\n      document.addEventListener(\"mousemove\", globalMoveHandler);\n    }\n    if (!targetRef.current) {\n      const fakeTarget = document.createElement(\"span\");\n      Object.assign(fakeTarget.style, {\n        width: \"0px\",\n        height: \"0px\",\n        pointerEvents: \"none\",\n        position: \"fixed\",\n        visibility: \"hidden\",\n      });\n      document.body.appendChild(fakeTarget);\n      // @ts-expect-error We intentionally don't pass null to generic argument, to not have it as a mutable nullable\n      // ref, since we are mimicking an element ref.\n      targetRef.current = fakeTarget;\n      return () => {\n        fakeTarget.remove();\n      };\n    }\n  }, []);\n\n  useLayoutEffect(() => {\n    if (options.isOpen && targetRef.current) {\n      targetRef.current.style.left = `${lastMouseClientPos.x}px`;\n      targetRef.current.style.top = `${lastMouseClientPos.y}px`;\n      updatePosition();\n    }\n  }, [options.isOpen, targetRef.current]);\n\n  const { updatePosition, ...result } = useOverlayPosition({\n    ...options,\n    targetRef,\n  });\n\n  return {\n    ...result,\n    /**\n     * Ref to be passed to be passed as targetRef\n     */\n    updatePosition: (e?: React.MouseEvent) => {\n      if (targetRef.current && e) {\n        targetRef.current.style.left = `${e.clientX}px`;\n        targetRef.current.style.top = `${e.clientY}px`;\n      }\n      updatePosition();\n    },\n  };\n}\n","import { useEffect, useRef } from \"react\";\n\nexport function usePrevious<T>(value: T): T {\n  const ref = useRef(value);\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n","export class ImmutableSet<T> implements ReadonlySet<T> {\n  readonly size: number;\n  private readonly set: ReadonlySet<T>;\n\n  constructor(values: Iterable<T>) {\n    this.set = new Set(values);\n    this.size = this.set.size;\n  }\n\n  add(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.add(item);\n      });\n    });\n  }\n\n  delete(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.delete(item);\n      });\n    });\n  }\n\n  toggle(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        if (!newValue.delete(item)) {\n          newValue.add(item);\n        }\n      });\n    });\n  }\n\n  clear(): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      newValue.clear();\n    });\n  }\n\n  private setValueWithMutation(\n    mutate: (newValue: Set<T>) => void\n  ): ImmutableSet<T> {\n    const newValue = new Set(this.set);\n    mutate(newValue);\n    return new ImmutableSet(newValue);\n  }\n\n  ////////////////////////////////////////////////// delegated methods /////////////////////////////////////////////////\n  forEach(...args: Parameters<ReadonlySet<T>[\"forEach\"]>): void {\n    return this.set.forEach(...args);\n  }\n\n  has(value: T): boolean {\n    return this.set.has(value);\n  }\n\n  [Symbol.iterator](): IterableIterator<T> {\n    return this.set[Symbol.iterator]();\n  }\n\n  entries(): IterableIterator<[T, T]> {\n    return this.set.entries();\n  }\n\n  keys(): IterableIterator<T> {\n    return this.set.keys();\n  }\n\n  values(): IterableIterator<T> {\n    return this.set.values();\n  }\n}\n","import { useControlledState } from \"@react-stately/utils\";\nimport { useMemo } from \"react\";\nimport { ImmutableSet } from \"./immutableSet\";\n\n/**\n * Creates map interface out of a setter of form (currentValue: Map) => Map\n * Use {@link useControllableSet} instead if you need a Set state in a React component.\n * This is useful for use outside React components, such as state management libraries.\n */\nexport const createSetInterface = <T>(\n  set: (value: (prevState: Set<T>) => Set<T>) => void\n) => ({\n  add: (...values: T[]) =>\n    set(\n      (currentValue) => new Set(new ImmutableSet(currentValue).add(...values))\n    ),\n  delete: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).delete(...values))\n    ),\n  clear: () =>\n    set((currentValue) => new Set(new ImmutableSet(currentValue).clear())),\n  toggle: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).toggle(...values))\n    ),\n});\n\nfunction useStateSetterForSet<T>(\n  setValue: (value: (prevState: Set<T>) => Set<T>, ...args: any[]) => void\n) {\n  return useMemo(() => createSetInterface(setValue), [setValue]);\n}\n\n/**\n * controllable state management for a Set. returns a tuple containing the value and an object with Set functions on it,\n * which would update the state.\n */\nexport const useControllableSet = <T>(\n  valueProp: Set<T> | undefined,\n  defaultValue: Set<T> = new Set(),\n  onChange: ((newValue: Set<T>) => void) | undefined\n) => {\n  const [value, setValue] = useControlledState(\n    valueProp!, // bad typing in useControlledState\n    defaultValue,\n    onChange! // bad typing in useControlledState\n  );\n\n  // @ts-expect-error FIXME https://github.com/adobe/react-spectrum/issues/2320\n  return [value, useStateSetterForSet(setValue)] as const;\n};\n"],"names":["LoadingGif","props","Img","src","darkSrc","Loading","styled","DefaultSuspense","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","darculaColorSchemeTokenRules","vsCodeTheme","scope","settings","flatMap","map","token","values","Object","keys","forEach","key","value","StyledEditor","MonacoEditor","Editor","editorTheme","monaco","useMonaco","theme","useTheme","themeName","setThemeName","useState","dark","useLayoutEffect","name","replace","editor","defineTheme","base","inherit","colors","rules","useEditorTheme","options","minimap","enabled","lineHeight","showFoldingControls","renderIndentGuides","scrollbar","verticalScrollbarSize","verticalSliderSize","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","window","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","exists","catch","e","dirPath","code","mkdir","Error","persistentFsPreference","get","localStorage","getItem","set","setItem","switchToPersistentFS","log","getRootFS","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","read","wrapPromise","createInMemoryFS","theFs","WaitForFs","dirContentState","selectorFamily","fileNames","all","fileName","filePath","type","size","fetchFileContent","encoding","fileContent","atomFamily","default","effects","onSet","error","filterPath","includes","sampleRepo","url","currentProjectState","atom","projectFilePath","projectRelativePath","currentProjectFilesState","selector","project","files","addItem","item","childItems","push","temporaryTabsDefaultValue","sortWith","descend","file","endsWith","filter","slice","editorState","cursorPos","lineNumber","column","editorTabsState","activeEditorTabIndexState","activeEditorTabState","editorCursorPositionState","Position","editorRefState","useEditorStateManager","tabsState","setTabsState","useRecoilState","setActiveTabIndex","useSetRecoilState","focus","useRecoilCallback","snapshot","getLoadable","valueOrThrow","select","index","closeTab","_","tabIndex","tabs","openPath","shouldFocus","findIndex","tab","newIndex","length","currentState","closePath","Math","max","closeOthersTabs","convertGitStatus","Array","isArray","vcsRootsState","dir","vcs","VcsRootForFile","find","root","startsWith","fileStatusState","useUpdateFileStatus","repoRoot","getPromise","fileStatus","useInitializeVcs","updateVcsFileStatuses","transact_UNSTABLE","vcsDirectoryMappings","rows","statusMatrix","row","useEffect","useStatusColor","FileStatusColor","color","useRecoilValue","useFileStatusColor","style","StatusColor","FileEditor","editorStateManager","activeTab","editorRef","useRef","active","setActive","hideAllAction","useAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","tabActionsRef","useLatest","setEditorRef","fileContentState","contentLoadable","useRecoilValueLoadable","setContent","updateFileStatus","current","setPosition","valueMaybe","StyledFileEditorContainer","onFocus","ContextMenuContainer","renderMenu","Menu","onAction","alert","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","icon","PlatformIcon","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","title","closeButton","TabCloseButton","onPress","altKey","indexOf","containerProps","onDoubleClick","actionPerformed","height","onMount","monacoEditor","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","getPosition","onChange","newContent","state","FileEditorLoading","isUnderDarcula","commonColors","panelBackground","StyledXterm","XTerm","Terminal","input","setInput","xtermRef","useMemo","background","selection","fontFamily","letterSpacing","fontSize","cursorStyle","cursorBlink","cursorWidth","rendererType","setTimeout","terminal","resize","write","ref","onData","data","charCodeAt","changeListsState","id","comment","changes","allChangesState","changeList","changeLists","flat","isAChange","head","workingDir","stage","refreshChanges","gitRoots","pathname","theRest","workdir","after","isDir","before","useRollbackChanges","callbackInterface","reloadFileFromDisk","reloadFileFromDiskCallback","changesWithRepoRoots","change","relativePath","groupedChanges","groupBy","entries","checkout","filepaths","resetIndex","useChangeListManager","addChangeList","editChangeList","edits","mergeChangeLists","sourceId","targetId","moveChange","toChangeListId","removeChangeList","setActiveChangeList","refresh","rollback","groupings","isAvailable","groupFn","nodes","repository","repositoryNode","node","constSelector","pathToNodeCache","rootDirNodes","reduce","prevNode","directoryNode","parentNodePath","dirNode","collapseDirectories","isDirectoryNode","child","uniq","dfsVisit","getChildren","visit","dfs","isOpen","windowBounds","getDefaultBounds","initiallyIncludedChanges","rootNodes","selectedChanges","changesTreeNodesState","some","initiallyExpandedKeys","includedChanges","expandedKeys","isGroupNode","childValues","isExpanded","childValue","getNodeKeyForChange","Set","getKey","roots","processItem","getExpandAllKeys","rollbackViewState","currentBranchState","showIgnoredFilesState","showRelatedFilesState","changesGroupingState","selectedKeysState","changesUnderSelectedKeys","selectedKeys","byKey","allChanges","processNode","includedChangeKeysState","includedChangesState","includedChangeKeys","has","includedChangesNestedSelection","getCallback","setSelectedKeys","setValue","NestedSelection","createSetInterface","expandedKeysState","availableGroupingsState","grouping","isRecoilValue","isActive","changeBrowserNodeKey","changeListNode","i","changeNode","isChangeNode","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","groupFns","groupChanges","fileCountsMap","Map","childrenFileCount","fileCount","total","count","commitMessageSizeState","orientation","amendCommitState","commitMessageState","openRollbackWindowForSelectionCallback","changesUnderSelection","getValue","ChangesViewTreeContextMenu","setIncludedChangeKeys","disabledKeys","focusCommitMessage","useChangeViewContext","openRollbackWindowForSelection","arr","StyledRepoColorSquare","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","SelectionAwareSpan","Color","withTransparency","toString","CurrentBranchName","repo","branch","fileCountMsg","IntlMessageFormat","ChangeNodeHint","isGroupedByDirectory","ItemLayout","nodeRenderers","rendered","HighlightedTextValue","format","directory","changelist","fontWeight","undefined","getChangeListTreeItemProps","nodeRenderer","dirCount","hasChildItems","ChangeViewTree","treeRef","setExpandedKeys","nestedSelection","SpeedSearchTreeWithCheckboxes","selectionMode","onExpandedChange","fillAvailableSpace","TreeNodeCheckbox","selectionState","getSelectionState","onToggle","toggle","ChangeListsActionButton","ActionButtonWithMenu","menuProps","GroupByActionButton","availableGroupings","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewActionIds","useChangesViewActions","openRollbackWindow","ChangesViewToolbar","ActionToolbar","hasBorder","actionId","CommonActionId","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledContainer","StyledTreeViewWrapper","StyledActionsRow","StyledAmendCheckbox","Checkbox","StyledCommitMessageContainer","StyledCommitMessageTextArea","StyledCommitActionsRow","StyledChangesSummaryContainer","ChangeViewContext","React","useContext","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","commitMessageSize","setCommitMessageSize","treeActions","useTreeActions","Provider","ThreeViewSplitter","innerView","ActionsProvider","actions","shortcutHandlerProps","CommitActionsRow","innerViewMinSize","lastView","CommitMessageEditorAndButtons","lastSize","onLastResize","ChangesViewChangesSummary","amend","setAmend","ActionHelpTooltip","helpText","isSelected","preventFocus","ActionButton","isDisabled","commitMessageTextAreaRef","commitMessage","setCommitMessage","hasFocus","useDefaultToolWindowContext","useImperativeHandle","event","placeholder","Button","preventFocusOnPress","variant","ChangesViewPane","foldersOnTopState","projectViewTreeRefState","dangerouslyAllowMutability","currentProjectTreeState","rootItems","mapItem","parent","createProjectTree","expandToPathCallback","keysToExpand","selectKeyAndFocusCallback","replaceSelection","ProjectViewPane","setProjectViewTreeRef","projectTree","sortItems","sortBy","a","identity","SpeedSearchTree","ProjectViewNodeIcon","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","ItemStateContext","isFocused","nodeTypeIconMap","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","projectViewActions","expandToOpenedFile","selectKeyAndFocus","selectOpenedFile","description","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","toolWindows","initialState","toolWindowState","isVisible","weight","MultiViewToolWindow","tabContent","toolWindowsState","ToolWindowsState","fromEntries","switchToPersistentFsProcess","usePersistenceFsNotification","balloons","useBalloons","setProcessState","timeoutId","showSticky","body","Balloon","details","isIndeterminate","progress","onCancel","abort","signal","updates","finally","clearTimeout","StyledLastMessage","StatusBarProcess","process","ProgressBar","dense","namePosition","width","button","onPause","ProgressBarPauseButton","P","small","paused","onPausedChange","ProgressBarStopButton","IdeStatusBar","cursorPosition","currentBranch","StatusBar","left","role","onClick","right","StatusBarWidget","label","MenuTrigger","Divider","RollbackTreeContextMenu","StyledFrame","contrastBorder","StyledLine","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","setWindowBounds","useNestedSelectionState","onSelectedKeysChange","changeListManager","setOpen","close","ModalWindow","onClose","bounds","onBoundsChange","minHeight","footer","padding","display","flexDirection","WindowLayout","show","flex","StyledWindowFrame","Project","setState","isRollbackWindowOpen","useInitializeChanges","allActions","DefaultToolWindows","onToolWindowStateChange","newState","windows","StyledDialog","WINDOW_SHADOW","StyledDialogHeader","StyledDialogContent","SampleRepoInitializer","repoUrl","info","isSuccessfullyCloned","clone","http","corsProxy","singleBranch","cloneRepo","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateTerminalWindow","App","KeymapProvider","keymap","BalloonsProvider","disablePortal","DEFAULT_MINIMUM_BUTTON_SIZE","NAVBAR_MINIMUM_BUTTON_SIZE","StyledActionButton","minSize","forwardedRef","excludeFromTabOrder","isPressed","isPressedInput","onPressChange","onPressEnd","onPressStart","onPressUp","shouldCancelOnPointerExit","otherProps","useObjectRef","focusableProps","useFocusable","pressProps","usePress","className","disabled","mergeProps","ArrowIcon","noArrow","buttonProps","previouslyFocusedElementRef","onOpenChange","open","relatedTarget","HTMLElement","isKeyMatch","keyStroke","loose","supportedModifiers","every","modifier","getModifierState","Boolean","ActionsContext","parentContext","useKeymap","actionIds","shortcuts","pick","firstKeyActivatedShortcutsRef","secondStrokeResetTimerIdRef","onKeyDown","useEventCallback","nativeEvent","location","repeat","shortcut","secondKeyStroke","triggerAction","firstKeyMatches","isKeyboardShortcut","document","addEventListener","once","capture","stopPropagation","preventDefault","useShortcuts","mapObjIndexed","firstShortcut","shortcutToString","useActions","EXPAND_ALL","COLLAPSE_ALL","EXPAND_SELECTION","SHRINK_SELECTION","defaultKeymap","RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID","RESIZE_TOOL_WINDOW_LEFT_ACTION_ID","RESIZE_TOOL_WINDOW_TOP_ACTION_ID","RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID","MAXIMIZE_TOOL_WINDOW_ACTION_ID","FOCUS_EDITOR_ACTION_ID","HIDE_ACTIVE_WINDOW_ACTION_ID","JUMP_TO_LAST_WINDOW_ACTION_ID","KeymapContext","keymapProp","parentKeyMap","assign","create","isAction","isGroup","isActionOrGroup","ActionsMenu","flatten","action","autoFocus","DividerItem","actionButton","Action","defaultKeyToStr","Control","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Enter","Quote","Minus","Equal","fromPairs","from","x","String","fromCharCode","toUpperCase","KeystrokeToString","isMac","separator","codeToStr","Alt","Shift","Meta","Escape","keystrokeToString","keystroke","join","useActionGroup","actionContext","StyledActionToolbar","getBorder","StyledHorizontalActionToolbar","StyledHorizontalSeparator","StyledVerticalActionToolbar","StyledVerticalSeparator","OrientationContext","ActionToolbarSeparator","bgColor","StyledHeaderActions","StyledBalloonContainer","StyledIconContainer","StyledBalloonHeader","StyledBalloonBody","lineClamp","StyledBalloonFooter","StyledToggleIconContainer","StyledToggleExpandButtonContainer","StyledHoverContainer","StyledToggleExpandButtonFooterContainer","BalloonContext","BalloonActionLink","context","args","iconProp","expanded","expandedProp","defaultExpanded","headerActions","bodyRef","expandable","setExpandable","setExpanded","useControlledState","maxLinesWhenNotExpanded","bodyElem","clientHeight","parseFloat","getComputedStyle","getNumLines","scrollHeight","iconType","effectiveExpanded","marginLeft","ToggleWrapper","Component","iconName","toggleIcon","NotImplementedFn","BalloonsContext","BalloonsContainer","StyledBalloonsStack","setBalloons","timeoutIdsRef","lastIdRef","api","timeout","aBalloon","balloon","aTimeoutId","notificationsStack","ReactDOM","BareButton","useButton","domProps","filterDOMProps","StyledButton","variants","StyledWrapperLabel","StyledCheckboxLabelText","disableFocusAlwaysVisible","useToggleState","inputProps","useCheckbox","isFocusVisible","focusProps","useFocusRing","wrapperPressProps","focusDisabledProps","onFocusCapture","blur","pointerEvents","CheckboxIcon","Disabled","Selected","Focused","CollectionSpeedSearchContext","CollectionSpeedSearchItemContext","SpeedSearchItemHighlightsProvider","itemKey","collection","text","highlightedRanges","matches","speedSearchContext","highlights","createSpeedSearchSelectionManager","wrappedSelectionManager","selectAll","useCollectionSpeedSearch","selectionManager","stickySearch","keyboardDelegate","speedSearchStateProps","speedSearch","useSpeedSearchState","speedSearchSelectionManager","searchTerm","result","getKeys","matchedRanges","minusculeMatch","latestValues","matchedKeys","noneOfTheMatchesAreSelected","matchedKey","newSelectedKey","passedFirstSelection","firstSelectedKey","getMatchToSelect","setFocusedKey","useCollectionSpeedSearchResult","useSpeedSearch","speedSearchKeyboardDelegate","wrappedKeyboardDelegate","getKeyBelow","keyBelow","getKeyAbove","keyAfter","createSpeedSearchKeyboardDelegate","speedSearchContextValue","searchPopupProps","match","_Divider","getCollectionNode","element","hasChildNodes","seq","this","_Item","StatelyItem","next","originalShouldInvalidate","shouldInvalidate","invalidated","StyledItemLayout","StyledHint","inactiveTextColor","Hint","useCollectionAutoScroll","isVirtualized","focusedKey","querySelector","scrollIntoView","StyledIconHoverContainer","AutoHoverPlatformIcon","hoverIcon","amendName","LafIcon","themePath","resolvedIconPath","iconDescriptor","resolvedValue","soFar","findIconPath","useIconPath","useForwardedRef","useSvgIcon","StyledLink","focusBorderColor","linkForegroundEnabled","Link","linkProps","useLink","elementType","focusRingClass","ListDivider","useSeparator","StyledList","StyledListItem","containerFocused","selected","labelForeground","labelSelectedForeground","whiteSpace","paddingLeft","outline","cursor","minWidth","useMenuTriggerState","overlayProps","overlayRef","useContextMenu","allProps","restoreFocus","StyledMenu","StyledMenuItem","StyledNestedArrow","StyledSelectedMark","StyledMenuItemText","StyledMenuItemPlatformIcon","StyledMenuItemLafIcon","MenuItem","expandOn","nestedMenuRef","menuItemProps","useMenuItem","maybeOpenSubmenu","toggleKey","hoverProps","useHover","onHoverStart","keyboardProps","useKeyboard","continuePropagation","positionProps","useOverlayPosition","targetRef","placement","shouldFlip","offset","crossOffset","subMenuProps","useSubmenu","FocusScope","childNodes","childItem","StyledMenuHeading","StyledMenuSectionItemsContainer","MenuSection","itemProps","headingProps","groupProps","useMenuSection","heading","MenuOverlayContext","useTreeState","expandedKey","firstKey","onExpandedKeyChange","defaultExpandedKey","useMenu","StyledMenuItemLayout","Content","Icon","Shortcut","useContextOrThrow","MenuOverlay","forceRestoreFocus","direction","align","menuTriggerProps","triggerRef","triggerProps","useMenuTrigger","useOverlay","shouldCloseOnBlur","isKeyboardDismissDisabled","isDismissable","shouldCloseOnInteractOutside","getPlacement","containerPadding","updatePosition","useMouseEventOverlayPosition","onContextMenu","StyledWindowTitle","StyledWindowUnderlay","StyledWindowContainer","StyledWindowInnerContainer","StyledWindowContentWrapper","StyledWindowFooter","ModalWindowInner","interactions","underlayProps","usePreventScroll","modalProps","useModal","dialogProps","titleProps","useDialog","windowInteractionHandlerProps","useResizableMovableWindow","renderTitle","contain","moveHandleProps","StyledFooter","StyledFooterSide","Footer","maxValue","minValue","secondaryDetails","progressBarProps","labelProps","useProgressBar","percentage","toFixed","forcedDetails","setForcedDetails","setTooltip","contextValue","StyledProgressBarLabel","effectiveDetails","StyledProgressBarContainer","StyledProgressBarLineContainer","hasTopMargin","hasBottomMargin","StyledProgressBarTrack","indeterminate","StyledProgressBarProgress","showValueLabel","valueLabel","ProgressBarContext","StyledProgressBarDetails","contextHelpForeground","getIndeterminateStartColor","getIndeterminateEndColor","indeterminateBackgroundAnimation","keyframes","useProgressBarIconButton","hoverTooltip","isHovered","useProgressBarPauseIconButton","ResizableView","onResize","resizerPlacement","firstView","firstSize","onFirstResize","BottomResizer","onResizeEnd","onResizeStarted","resizerProps","useBottomResizer","StyledHorizontalResizer","StyledHorizontalResizerArea","handleSize","HorizontalResizer","outerPadding","LeftResizer","useLeftResizer","RightResizer","useRightResizer","TopResizer","useTopResizer","StyledVerticalResizer","StyledVerticalResizerArea","VerticalResizer","useResizer","invert","useMove","dragThreshold","onMoveStart","onMoveEnd","onMove","movement","startState","StyledSearchIcon","SpeedSearchPopup","StyledSpeedSearchPopup","tooltipForeground","useGhostInput","valueRef","ctrlKey","metaKey","elem","isContentEditable","HTMLInputElement","HTMLTextAreaElement","sliceEnd","onActiveChange","setSearchTerm","defaultSearchTerm","onSearchTermChange","ghostInputKeydown","trimmedValue","trimStart","clear","onKeyUp","focusWithinProps","onBlur","useFocusWithin","onFocusWithinChange","focused","StyledStatusBar","StyledStatusBarLeft","StyledStatusBarRight","StyledStatusBarSection","StyledWrapper","StyledStatusBarWidget","StyledStatusBarIconWidget","inset","DarculaSeparatorUI","defaultSize","StyledSeparator","backgroundClip","boxSizing","margin","border","flexShrink","onUnpin","pinned","startIcon","endIcon","editorTabTheme","borderColor","underlineHeight","underlinedTabInactiveBackground","underlinedTabBackground","hoverInactiveBackground","hoverBackground","inactiveUnderlineColor","underlineColor","underlinedTabInactiveForeground","underlinedTabForeground","StyledEditorTab","StyledDefaultTab","getTabThemeStyles","StyledEditorTabs","StyledDefaultTabs","getTabsThemeStyles","Tabs","TabComponent","TabsComponent","focusable","StyledIconWrapper","StyledTabItemLayout","iconStyle","StyledStartIconWrapper","StyledEndIconWrapper","TabContentLayout","horizontalOverflowIndicatorStyles","StyledHorizontalOverflowShadows","hasOverflowAtStart","hasOverflowAtEnd","Tab","intersectionObserver","tabProps","useTab","observe","unobserve","useIntersectionObserver","scrollBarDisabledStyle","StyledTabList","multiRow","noOverflowMenu","noScroll","useTabListState","tabListProps","useTabList","scrolledIndicatorProps","isScrolled","threshold","setIsScrolled","top","bottom","update","offsetLeft","scrollLeft","offsetRight","scrollWidth","offsetWidth","offsetTop","scrollTop","offsetBottom","offsetHeight","newIsScrolled","onScroll","useIsScrolled","overflowedKeys","scrollableItemsContainerRef","setIntersectionObserver","setOverflowedKeys","observer","IntersectionObserver","newHiddenKeys","entry","isIntersecting","dataset","val","newVisibleKeys","currentOverflowMenuKeys","rootMargin","disconnect","useCollectionOverflowObserver","scrollableContainer","selectedTabElement","TabsOverflowMenu","onSelect","setSelectedKey","menuItem","toolWindowTabTheme","StyledToolWindowTab","StyledToolWindowTabs","ToolWindowTabs","getAllRanges","ranges","to","gapRange","range","createRangesFromIndices","indices","lastRange","HighlightedMatch","TextWithHighlights","parts","highlighted","StyledSplitterContainer","StyledSplitterInnerView","resizerPropsOverrides","containerRef","firstViewRef","lastViewRef","firstSizeState","setFirstSizeState","lastSizeState","setLastSizeState","horizontalValue","verticalValue","FirstResizer","SecondResizer","sizeStyleProp","minSizeStyleProp","isFractionSize","normalizeSize","round","getSize","getNewSize","currentSize","newSize","newFractionSize","getActualSize","viewElem","actualSize","currentLastSize","currentFirstSize","StyledFloatView","FloatView","effectiveBounds","WindowInteractionHandler","WindowResizeHandles","FloatToolWindows","floatWindows","renderToolWindow","stackedFloatWindows","sortedKeys","setSortedKeys","sorted","sort","b","bringToFront","move","useStackedLayersState","layersProps","toolWindow","MovableToolWindowStripeContext","MovableToolWindowStripeProvider","stripes","draggingRect","setDraggingRect","draggingKey","setDraggingKey","dropPosition","setDropPosition","getDropPositionRef","moveStartLocationRef","addStripe","propsRef","startMove","stripe","stripeElRef","stripeElement","getBoundingClientRect","getItemRect","toJSON","indexInMain","mainItems","indexInSplit","splitItems","isSplit","dropPositionGetters","createGetDropPosition","getDropPosition","draggedRect","endMove","TopStripe","BottomStripe","LeftStripe","RightStripe","InnerView","StyledToolWindowOuterLayout","Shell","hideStripes","getSizeInAnchor","containerSize","isHorizontalToolWindow","mapToKey","prop","sortAndMapToKey","compose","order","filterMains","getMains","filterSplits","filterVisible","expectedViewMode","viewMode","getSplits","filterVisibleDocked","filterVisibleUnDocked","getDocked","docks","mains","splits","mainKey","sizeFraction","sideWeight","getUnDocked","getSideState","main","activeKeys","undocked","docked","DEFAULT_HEIGHT","DEFAULT_WIDTH","getFloatWindowsState","pipe","floatingBounds","getFloatWindowState","getStripeRect","start","rect","end","getDropPositions","getRef","score","abs","relative","keyToOffsets","boundingRect","getKeyToOffsets","dropPositions","lastDropPosition","stripeRect","getCanDrop","bestMatch","candidate","STRIPE_BUTTON_LINE_HEIGHT","StyledToolWindowStripeButton","StyledToolWindowStripe","theOtherSide","preventCollapse","StyledSpacer","useElementMove","ghost","ghostOption","otherOptions","updateGhostPosition","defaultGhost","cloneNode","computedBackground","unshift","parentElement","resultColor","nextColor","blend","findEffectiveBackgroundColor","createDefaultGhost","append","y","remove","ToolWindowStripe","renderItem","render","onItemPress","getProps","latestPropsRef","moveDisabled","useMovableStripeButtons","isNotCurrentItem","anItem","ToolWindowStripeButton","getStripeButtonStyles","styles","marginValue","onPointerUp","StyledUndockSide","UndockSide","ToolWindows","hideToolWindowBars","useWidescreenLayout","mainContentMinWidth","windowsById","indexBy","mainContentFocusScopeRef","layoutState","setLayoutState","windowFocusableRefs","latestRef","windowIds","removedFromSideBarIds","getToolWindowsLayoutState","activeElement","closest","focusLastActiveWindow","lastFocusedKey","focusMainContent","changeState","updater","renderStripe","toolbarButton","lastFocused","ToolWindowStateProvider","mainContentFocusableRef","renderSideDockedView","resizeDockSplitView","onDockResize","containerBounds","resizeDock","getSplitViewProps","firstAnchor","secondAnchor","horizontalSplitterProps","verticalSplitterProps","outerSplitterProps","innerSplitterProps","undockLayers","resizeUndock","setFloatingBound","renderInnerLayout","ToolWindowStateContext","hide","removeFromSidebar","moveToSide","side","changeViewMode","stretchWidth","container","stretchHeight","setFloatingBounds","isDocked","areInSameSection","curry","window1","window2","getViewModeType","constructor","layoutToRestore","invalidWindows","targetKey","mapWindows","hideAll","restoreWindows","closableViewModes","viewModeType","sideOrIndex","targetSide","targetIndex","targetSideWindows","indexInTargetSide","sortedTargetWindows","insert","newTargetSideWindows","newValue","targetViewMode","stretch","mapFn","property","currentFloatingBound","clamp","resizeSide","dock","isInResizingView","inputs","useToolWindow","contentRef","focusableContentRef","onFocusChange","contentHasFocus","setContentHasFocus","contentFocusWithinProps","toolWindowProps","autoHideProps","hideTimeoutId","windowFocusWithinProps","onBlurWithin","onFocusWithin","useAutoHide","focusDelegatorProps","currentTarget","possiblyBlurredElement","Element","contains","useFocusDelegator","useWindowMoveHandle","toolWindowContentProps","toolWindowHeaderProps","ToolWindowSettingsIconMenu","viewModeActions","VIEW_MODE_ACTION_IDS","moveToActions","MOVE_TO_ACTION_GROUP","resizeActions","removeFromSideBarAction","REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID","gearIconActions","ViewModeToActionId","StyledToolWindowHeader","StyledToolWindowHeaderActions","StyledToolWindowHeaderContent","DefaultToolWindowHeader","DOCK_TOOL_WINDOW_ACTION_ID","StyledToolWindowContainer","StyledToolWindowContent","DefaultToolWindowContext","defaultToolWindowContext","useToolWindowActions","getToolWindowNumberFromShortcut","num","parseInt","DefaultToolWindowToolbarButton","showNumber","getActivateToolWindowActionId","number","Number","isInteger","showNumbers","toolWindowsRef","windowById","useToolWindowsActions","getPresentation","groupTabs","isToolWindowFocused","setToolWindowFocused","activeKey","setActiveKey","defaultActiveKey","onActiveKeyChange","contents","validChild","MultiContentToolWindowContent","renderedViewSwitcher","previousKeys","usePrevious","newActiveKey","activeContent","View","DOCK_PINNED_MODE_ACTION_ID","DOCK_UNPINNED_MODE_ACTION_ID","UNDOCK_MODE_ACTION_ID","FLOAT_MODE_ACTION_ID","WINDOW_MODE_ACTION_ID","anchors","getAnchorName","docked_pinned","docked_unpinned","undock","float","zipObj","isAnySideWindowWindowOpen","getOrdinal","n","ord","link","multiline","StyledTooltip","StyledShortcut","StyledHeader","fontSizeDelta","StyledDescription","Tooltip","isInteractive","TooltipContext","tooltipProps","useTooltip","_Tooltip","Header","Description","delay","useTooltipTriggerState","setInteractive","onMouseDown","useTooltipTrigger","normalizeChildren","useAriaTooltipTrigger","onPointerDown","SpeedSearchTreeNode","alwaysShowAsFocused","TreeNode","disallowEmptySelection","allowEmptySelection","treeProps","treeContext","useSpeedSearchTree","virtualizerProps","useTreeVirtualizer","TreeContext","StyledTree","Virtualizer","collectionSpeedSearch","TreeKeyboardDelegate","speedSearchKeyboardProps","hasAnyModifier","selectableTree","useSelectableTree","ListKeyboardDelegate","collator","super","getKeyLeftOf","parentKey","getKeyRightOf","StyledTreeNodeIcon","TreeNodeIcon","iconPath","getIcon","useTreeNodeToggleButton","treeNodeToggleButtonProps","selectedDescendantKeys","toggleSelection","StyledTreeNode","attrs","level","onActionRef","togglePressProps","treeNodeProps","useSelectableItem","useTreeNode","useCollator","usage","sensitivity","setFocused","collectionProps","selectionKeyDown","useSelectableCollection","selectOnFocus","isExpandable","onNodeKeyDown","shouldToggle","useTreeRef","latestState","expandSelection","shrinkSelection","expandAll","tree","getAllExpandableKeys","collapseAll","rootKeys","Symbol","iterator","TreeCollection","keyMap","iterable","last","nextKey","prevKey","lastKey","getKeyBefore","getKeyAfter","getFirstKey","getLastKey","at","idx","getSingleChildrenKeys","getSingleChildrenKeysRecursive","childNodesIterator","firstChild","done","noMoreChildren","isEmptyIterable","TreeSelectionManager","SelectionManager","expandKeys","getExpandAndShrinkKeys","shrinkKeys","recursivelyGetExpandAndShrinkKeys","previousChild","newKeys","parentDescendants","getAllDescendants","getAllRoots","descendants","stopKeys","notNull","_TreeCollection","recursivelyAddExpandableKeys","add","useMultipleSelectionState","selectionBehavior","cacheInvalidation","invalidators","lastInvalidators","anInvalidator","useCollectionCacheInvalidation","useCollection","delete","aKey","toggleTreeNode","VariableWidthListLayout","ListLayout","keyToWidth","visibleContentWidth","buildItem","layoutNode","layoutInfo","buildCollection","getVisibleContentWidth","invalidateEverything","contentSize","layoutNodes","newRect","oldRect","validate","invalidationContext","lastWidth","updateItemSize","changed","layoutInfos","virtualizer","visibleRect","visibleViews","view","itemContentWidth","intersects","getVisibleRect","FlattenedTreeLayout","buildChild","getVisibleLayoutInfos","layout","estimatedRowHeight","sizeToFit","scrollToItem","shouldScrollX","duration","scrollDirection","collectSelectableItemsRecursive","collectedItems","cache","WeakMap","itemsInSubtree","collectSelectableItems","cachedState","allDescendantsStates","otherInvalidators","StyledCheckboxWrapper","selectItemOnPress","itemContext","selectedKeysProp","defaultSelectedKeys","selectedKeysSetter","useControllableSet","WindowInteractionHandlerContext","useWindowInteractionHandler","interactionHandler","finishInteraction","startInteraction","updateBounds","WindowMoveHandle","FLOAT_WINDOW_MIN_WIDTH","FLOAT_WINDOW_MIN_HEIGHT","windowResizer","initialBoundsRef","newWidth","initialBounds","newHeight","getResizerProps","useWindowResizer","boundsProp","defaultBounds","interceptInteraction","setBounds","currentInteractionBounds","setCurrentInteractionBounds","innerWidth","innerHeight","isWordSeparator","c","isWhitespace","char","test","isUpperCase","str","toLowerCase","isMeaningfulChar","ch","rawPattern","isStarts","isStart","pattern","continuous","inputIndex","patternIndex","lastMatch","chars","previousChar","manager","delegate","shouldFocusWrap","disallowSelectAll","disallowTypeAhead","shouldUseVirtualFocus","allowsTabNavigation","useLocale","focusSafely","handlers","navigateToKey","childFocus","shiftKey","extendSelection","isCtrlKeyPressed","getKeyPageBelow","getKeyPageAbove","clearSelection","walker","getFocusableTreeWalker","tabbable","lastChild","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","lastSelectedKey","typeSelectProps","useTypeSelect","onTypeSelect","useOriginalSelectableItem","pointerType","directChildRef","focusManagerRef","nodeToRestore","requestAnimationFrame","forceFocusFirst","focusManager","containerElement","focusFirst","focusNext","GetFocusManager","hidden","useFocusManager","savedUserSelect","handlersRef","documentElement","webkitUserSelect","pageX","pageY","dragStarted","onMouseMove","runAfterTransition","removeEventListener","Context","nullErrorMessage","useCallback","apply","globalMoveHandler","lastMouseClientPos","clientX","clientY","fakeTarget","createElement","visibility","appendChild","ImmutableSet","setValueWithMutation","mutate","currentValue","useStateSetterForSet","valueProp","defaultValue"],"sourceRoot":""}