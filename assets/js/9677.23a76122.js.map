{"version":3,"file":"assets/js/9677.23a76122.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/recoil-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/change-view-nodes.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/Project/persistence/persistentAtomEffect.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/SampleRepoInitializer.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/Project/persistence/PersistentStateProvider.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif: React.FC = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editor.lineHighlightBorder\": \"none\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  return (\n    <StyledEditor\n      {...props}\n      options={{\n        minimap: { enabled: false },\n        lineHeight: 20,\n        showFoldingControls: \"always\",\n        renderIndentGuides: true,\n        overviewRulerBorder: false,\n        scrollbar: {\n          verticalScrollbarSize: 14,\n          horizontalScrollbarSize: 8,\n          verticalSliderSize: 8,\n          horizontalSliderSize: 8,\n          horizontal: \"auto\",\n          vertical: \"visible\",\n          alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n        },\n        ...props.options,\n      }}\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport { BFSCallback } from \"browserfs/src/core/file_system\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (persistentFsPreference.get() ===\n\"yes\"\n  ? createIndexedDBFS()\n  : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC = ({ children }) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import {\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { fs } from \"./fs\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  path: string;\n  size: number;\n}\n\n/**\n * recoil atoms and selectors for keeping list and content of files in recoil state, for components that need on such\n * state.\n * NOTE: still not clear if we should be using atomFamily or selectorFamily for this. changing the current\n * implementation to atomFamily however is easy and side effect free.\n */\nexport const dirContentState = selectorFamily({\n  key: \"dirContents\",\n  get: (path: string) => async (): Promise<null | FsItem[]> => {\n    let fileNames: string[];\n    try {\n      fileNames = await fs.promises.readdir(path);\n    } catch (e) {\n      return null;\n    }\n    const stats = await Promise.all(\n      fileNames.map((fileName) => {\n        const filePath = `${path}/${fileName}`;\n        return fs.promises.stat(filePath).then((stat: Stats) => ({\n          ...stat,\n          type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n          filePath,\n        }));\n      })\n    );\n    return stats.map((stat) => ({\n      type: stat.type,\n      path: stat.filePath,\n      size: stat.size,\n    }));\n  },\n});\n\n/**\n * recoil callback to refresh the file content recoil value of a give path.\n * The callback returns `true` the file exists and content is refreshed successfully, and `false otherwise.\n * @param set\n */\nexport const reloadFileFromDiskCallback =\n  ({ set }: CallbackInterface) =>\n  async (path: string) => {\n    try {\n      const content = await fetchFileContent(path);\n      set(fileContent(path), content);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\nconst fetchFileContent = async (\n  filepath: string | undefined\n): Promise<string> => {\n  if (!filepath) {\n    return \"\";\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n};\n\n/**\n * **Note**: Still not quite clear if we should use atom and [synchronize with source of truth (FS)][recoil-atom-effects],\n * or if we should use selector and refresh it when needed. We probably need a proper [VFS][vfs] implementation at\n * some point, which would be capable of tracking modifications, and setting up listeners for it, and then atoms, can\n * hold the states like directory content, with effects which uses the listener API.\n * A few things to consider in that regard:\n * - if modifications to files are not directly synchronized to fs, using isomorphic-git for updating the file status\n *   can be tricky, unless an FS implementation is provided which uses the file content that is not yet synced with\n *   the actual local FS. Maybe something like Intellij's VFS, can be implemented as a BrowserFS backend impl.\n *\n * **Note**: currently, only text file is supported, for simplicity.\n *\n * [recoil-atom-effects]: https://recoiljs.org/docs/guides/atom-effects#write-through-cache-example\n * [vfs]: https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html\n **/\nexport const fileContent = atomFamily<string, string | undefined>({\n  key: \"fileContent\",\n  default: fetchFileContent,\n  effects: (filepath) => [\n    ({ onSet }) => {\n      onSet((content) => {\n        if (filepath) {\n          // Should a sync API be used here?\n          fs.promises\n            .writeFile(filepath, content, \"utf8\")\n            .catch((e: unknown) => {\n              console.error(\"failed to sync the file back to the fs\", e);\n            });\n        }\n      });\n    },\n  ],\n});\n\nexport const useReloadFromDisk = (path: string) => {\n  return useRecoilRefresher_UNSTABLE(dirContentState(path));\n};\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import {\n  RecoilState,\n  RecoilValue,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { FocusEvent, useEffect, useRef, useState } from \"react\";\nimport { equals } from \"ramda\";\n\nexport const createFocusBasedSetterHook =\n  <T extends unknown, N extends T = T>(state: RecoilState<T>, nullValue: N) =>\n  (value: T) => {\n    const setValue = useSetRecoilState(state);\n    const isFocusedRef = useRef(false);\n    useEffect(() => {\n      if (isFocusedRef.current) {\n        setValue((currentValue) =>\n          equals(value, currentValue) ? currentValue : value\n        );\n      }\n    }, [value]);\n    return {\n      onFocus: () => {\n        setValue(value);\n        isFocusedRef.current = true;\n      },\n      onBlur: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n        isFocusedRef.current = false;\n      },\n    };\n  };\n\n/**\n * Returns the latest value of a recoil value, or null, if the value is being loaded for the first time.\n * Useful for when stale data is ok, but may get synced soon.\n */\nexport function useLatestRecoilValue<T>(recoilValue: RecoilValue<T>): T | null {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  return state;\n}\n\n/**\n * Refreshes recoil value on mount\n */\nexport function useRefreshRecoilValueOnMount<T>(value: RecoilValue<T>) {\n  const refresh = useRecoilRefresher_UNSTABLE(value);\n  useEffect(() => {\n    refresh();\n  }, []);\n}\n\nexport function useRecoilInitialValue<T>(recoilState: RecoilState<T>): T;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: Exclude<T, undefined | null>\n): Exclude<T, undefined | null>;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: T\n) {\n  return useRecoilCallback(\n    ({ snapshot }) =>\n      () =>\n        snapshot.getLoadable(recoilState).getValue() ?? defaultValue,\n    []\n  );\n}\n","import {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"./project-utils\";\nimport { createFocusBasedSetterHook } from \"../recoil-utils\";\nimport path from \"path\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const sampleRepos = {\n  JUI: {\n    path: \"/workspace/jui\",\n    url: \"https://github.com/alirezamirian/jui.git\",\n  },\n  \"React Spectrum\": {\n    path: \"/workspace/react-spectrum\",\n    url: \"https://github.com/adobe/react-spectrum.git\",\n  },\n  Recoil: {\n    path: \"/workspace/recoil\",\n    url: \"https://github.com/facebookexperimental/Recoil.git\",\n  },\n  ExampleRepo: {\n    path: \"/workspace/example-repo\",\n    url: \"https://github.com/thurwitz/example-branches.git\",\n  },\n};\nconst sampleRepoKey: keyof typeof sampleRepos = \"JUI\";\n\n/**\n * temporary hard coded sample repo, until clone UI is implemented.\n */\nexport const sampleRepo = sampleRepos[sampleRepoKey];\n\nexport const currentProjectState = atom<Project>({\n  key: \"project\",\n  default: {\n    name: \"Workspace\",\n    path: \"/workspace\",\n  },\n});\n\nexport const projectFilePath = selectorFamily({\n  key: \"projectFilePath\",\n  get:\n    (projectRelativePath: string) =>\n    ({ get }) =>\n      path.join(get(currentProjectState).path, projectRelativePath),\n});\n\nexport const currentProjectFilesState = selector({\n  key: \"project.current.files\",\n  get: async ({ get }): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectState);\n    return get(projectFilesState(project.path));\n  },\n});\n\nexport const projectFilesState = selectorFamily({\n  key: \"project.files\",\n  get:\n    (\n      projectPath: string /* could be changed to project id, when project entity is more mature */\n    ) =>\n    async ({ get }): Promise<ProjectFsItem[]> => {\n      const items = get(dirContentState(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = get(dirContentState(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      (items || []).forEach((item) => addItem(item));\n      return files;\n    },\n});\n\nexport const useRefreshCurrentProjectFiles = () =>\n  useRecoilRefresher_UNSTABLE(currentProjectFilesState);\n\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsState = atom<string[]>({\n  key: \"project.activePaths\",\n  default: [],\n});\n\n/**\n * Sets the value of {@link activePathsState} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsState,\n  []\n);\n","import {\n  atom,\n  selector,\n  useRecoilCallback,\n  useRecoilState,\n  useSetRecoilState,\n} from \"recoil\";\nimport { Focusable } from \"../common-types\";\nimport { descend, sortWith } from \"ramda\";\nimport {\n  currentProjectFilesState,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Position } from \"monaco-editor\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n// settings.\nconst temporaryTabsDefaultValue = selector({\n  key: \"editor.tabs/Default\",\n  get: ({ get }) =>\n    sortWith(\n      [\n        // first README.md, then ts and js files.\n        descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n        descend((file) => file.path.endsWith(\".ts\")),\n        descend((file) => file.path.endsWith(\".js\")),\n      ],\n      get(currentProjectFilesState).filter((item) => item.type === \"file\")\n    )\n      .slice(0, 12)\n      // map project file to editor state object\n      .map((file) => ({\n        filePath: file.path,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n      })),\n});\n\n// it should become something under \"project\" state later.\nexport const editorTabsState = atom<EditorTabState[]>({\n  key: \"editor.tabs\",\n  default: temporaryTabsDefaultValue,\n});\n\nconst activeEditorTabIndexState = atom<number>({\n  key: \"editor.activeTabIndex\",\n  default: 0,\n});\n\nexport const activeEditorTabState = selector<EditorTabState | null>({\n  key: \"editor.activeTab\",\n  get: ({ get }) => {\n    const tabs = get(editorTabsState);\n    return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n  },\n});\n\nexport const editorCursorPositionState = atom<Position>({\n  key: \"editor.cursorPosition\",\n  default: new Position(0, 0),\n});\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefState = atom<null | Focusable>({\n  key: \"editor.focusHandle\",\n  default: null,\n});\n\nexport interface EditorStateManager {\n  tabs: EditorTabState[];\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOthersTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n}\n\n/**\n * TODO: refactor this to expose actions in a way that doesn't create dependency to state. A piece of UI that only\n *  needs to open a file in editor in response to some action (e.g. ProjectViewPane or ChangeViewTree) doesn't need to\n *  re-render on editor state changes\n */\nexport const useEditorStateManager = (): EditorStateManager => {\n  const [tabsState, setTabsState] = useRecoilState(editorTabsState);\n  const setActiveTabIndex = useSetRecoilState(activeEditorTabIndexState);\n  const focus = useRecoilCallback(\n    ({ snapshot }) =>\n      () => {\n        snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n      },\n    []\n  );\n\n  const select = (index: number) => {\n    setActiveTabIndex(index);\n  };\n  const closePath = (filePath: string) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      closeTab(index);\n      setActiveTabIndex(Math.max(index - 1, 0));\n    }\n  };\n  const openPath = (filePath: string, shouldFocus = true) => {\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      select(index);\n    } else {\n      const newIndex = tabsState.length;\n      setTabsState((currentState) => [\n        ...currentState,\n        {\n          filePath,\n          editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n        },\n      ]);\n      select(newIndex);\n    }\n    if (shouldFocus) {\n      // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n      // event handler) is picked up by editor, adding unwanted new line.\n      setTimeout(focus);\n    }\n  };\n  const closeTab = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex !== index)\n    );\n  };\n  const closeOthersTabs = (index: number) => {\n    setTabsState((tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex === index)\n    );\n  };\n  return {\n    tabs: tabsState,\n    // This should become an action. Something like \"open project file\", when action system is implemented.\n    openPath,\n    closePath,\n    closeTab,\n    closeOthersTabs,\n    select,\n  };\n};\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useResetRecoilState,\n} from \"recoil\";\nimport { sampleRepos } from \"../Project/project.state\";\nimport { findRoot, status, statusMatrix } from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport { useEffect } from \"react\";\nimport * as path from \"path\";\nimport { asyncFilter } from \"../async-utils\";\n\n// This should be refactored to have the configuration file(s) as the source of truth.\nconst temporaryVcsMappingsDefaultState = selector({\n  key: \"vcsRoots/temporaryDefault\",\n  get: async (): Promise<VcsDirectoryMapping[]> => {\n    return asyncFilter(\n      ({ dir }) => fs.promises.stat(dir).then(Boolean),\n      Object.values(sampleRepos).map(({ path }) => ({\n        dir: path,\n        vcs: \"git\",\n      }))\n    );\n  },\n});\nexport const vcsRootsState = atom<VcsDirectoryMapping[]>({\n  key: \"vcsRoots\",\n  default: temporaryVcsMappingsDefaultState,\n});\n\n/**\n * temporary(?) hook to refresh vcs roots\n */\nexport const useRefreshVcsRoots = () => {\n  const refreshTemporaryVcsMappingsDefault = useRecoilRefresher_UNSTABLE(\n    temporaryVcsMappingsDefaultState\n  );\n  const refreshVcsRoots = useResetRecoilState(vcsRootsState);\n  return () => {\n    refreshTemporaryVcsMappingsDefault();\n    refreshVcsRoots();\n  };\n};\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsRootForFile = selectorFamily<string | null, string>({\n  key: \"gitRootForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      return findRoot({ fs, filepath }).catch(() => null);\n    },\n});\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: Should it be an atom or selector?\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n */\nexport const fileStatusState = atomFamily<FileStatus, string>({\n  key: \"fileStatus\",\n  default: \"NOT_CHANGED\",\n});\n\nexport const useUpdateFileStatus = () =>\n  useRecoilCallback(\n    ({ snapshot, set }: CallbackInterface) =>\n      async (filepath: string) => {\n        const repoRoot = await snapshot.getPromise(vcsRootForFile(filepath));\n        if (repoRoot != null) {\n          console.time(`status ${filepath}`);\n          const fileStatus = await status({\n            fs,\n            dir: repoRoot,\n            filepath: path.relative(repoRoot, filepath),\n          });\n          console.timeEnd(`status ${filepath}`);\n          set(fileStatusState(filepath), convertGitStatus(fileStatus));\n        }\n      },\n    []\n  );\n\nexport const useUpdateVcsFileStatuses = () =>\n  useRecoilCallback(\n    ({ snapshot, transact_UNSTABLE }: CallbackInterface) =>\n      async () => {\n        const vcsDirectoryMappings = await snapshot.getPromise(vcsRootsState);\n        return Promise.all(\n          vcsDirectoryMappings\n            .filter(({ vcs }) => vcs === \"git\")\n            .map(async ({ dir }) => {\n              console.time(\"statusMatrix\");\n              const rows = await statusMatrix({ fs, dir });\n              console.timeEnd(\"statusMatrix\");\n              transact_UNSTABLE(({ set }) => {\n                rows.forEach((row) => {\n                  set(\n                    fileStatusState(`${dir}/${row[0]}`),\n                    convertGitStatus(row)\n                  );\n                });\n              });\n            })\n        );\n      },\n    []\n  );\n\nexport const useInitializeVcs = () => {\n  const updateVcsFileStatuses = useUpdateVcsFileStatuses();\n  useEffect(() => {\n    updateVcsFileStatuses().catch((e) => {\n      console.error(\"could not initialize VCS file statuses\", e);\n    });\n  }, []);\n};\n","import { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { useRecoilValue } from \"recoil\";\nimport { fileStatusState } from \"./file-status.state\";\nimport React from \"react\";\nimport { FileStatus } from \"./file-status\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const fileStatus = useRecoilValue(fileStatusState(filepath));\n  return useStatusColor(fileStatus);\n};\n\nexport const FileStatusColor: React.FC<{ filepath: string }> = ({\n  children,\n  filepath,\n}) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{ status: FileStatus }> = ({\n  children,\n  status,\n}) => {\n  const color = useStatusColor(status);\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport {\n  useRecoilValue,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { Editor } from \"./Editor\";\nimport {\n  activeEditorTabState,\n  editorCursorPositionState,\n  editorRefState,\n  useEditorStateManager,\n} from \"./editor.state\";\nimport { fileContent } from \"../fs/fs.state\";\nimport { useUpdateFileStatus } from \"../VersionControl/file-status.state\";\nimport * as path from \"path\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useAction } from \"@intellij-platform/core\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\n\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const editorStateManager = useEditorStateManager();\n  const activeTab = useRecoilValue(activeEditorTabState);\n  const editorRef = useRef<editor.IEditor>();\n  const [active, setActive] = useState(false);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetRecoilState(editorCursorPositionState);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items),\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOthersTabs,\n  });\n\n  const setEditorRef = useSetRecoilState(editorRefState);\n\n  const fileContentState = fileContent(activeTab?.filePath);\n  const contentLoadable = useRecoilValueLoadable(fileContentState);\n  const setContent = useSetRecoilState(fileContentState);\n  const updateFileStatus = useUpdateFileStatus();\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (activeTab) {\n      updateFileStatus(activeTab.filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n  useEffect(() => {\n    editorRef.current?.focus();\n    if (activeTab?.editorState.cursorPos) {\n      editorRef.current?.setPosition(activeTab?.editorState.cursorPos);\n    }\n  }, [activeTab?.filePath]);\n\n  const activePathsProviderProps = useActivePathsProvider(\n    activeTab ? [activeTab.filePath] : []\n  );\n\n  const content = contentLoadable.valueMaybe();\n\n  return (\n    <StyledFileEditorContainer\n      {...mergeProps(activePathsProviderProps, {\n        onFocus: () => {\n          setActive(true);\n          setEditorRef({\n            focus: () => editorRef.current?.focus(),\n          });\n        },\n      })}\n    >\n      {editorStateManager.tabs.length > 0 && (\n        <ContextMenuContainer\n          renderMenu={() => (\n            <Menu\n              // TODO: detect which tab was triggering context menu and handle the action accordingly\n              //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n              //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n              //  modified to pass the MouseEvent object, in renderMenu.\n              onAction={notImplemented}\n            >\n              <Item key=\"close\">Close</Item>\n              <Item key=\"closeOthers\">Close Other tabs</Item>\n              <Item key=\"closeAll\">Close all tabs</Item>\n              <Item key=\"closeLeft\">Close tabs to the left</Item>\n              <Item key=\"closeRight\">Close tabs to the right</Item>\n            </Menu>\n          )}\n        >\n          <EditorTabs\n            items={editorStateManager.tabs}\n            active={active}\n            selectedKey={activeTab?.filePath}\n            onSelectionChange={(key) =>\n              editorStateManager.select(\n                editorStateManager.tabs.findIndex((tab) => tab.filePath === key)\n              )\n            }\n            noBorders\n          >\n            {(tab) => {\n              const filename = path.basename(tab.filePath);\n              const icon = <PlatformIcon icon={getIconForFile(tab.filePath)} />;\n              return (\n                <TabItem\n                  key={tab.filePath}\n                  textValue={filename}\n                  inOverflowMenu={\n                    <MenuItemLayout content={filename} icon={icon} />\n                  }\n                >\n                  <TooltipTrigger\n                    tooltip={<ActionTooltip actionName={tab.filePath} />}\n                  >\n                    <EditorTabContent\n                      icon={icon}\n                      title={\n                        <FileStatusColor filepath={tab.filePath}>\n                          {filename}\n                        </FileStatusColor>\n                      }\n                      closeButton={\n                        <TooltipTrigger\n                          tooltip={\n                            <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                          }\n                        >\n                          <TabCloseButton\n                            onPress={(e) => {\n                              if (e.altKey) {\n                                tabActionsRef.current.closeOthersTabs(\n                                  editorStateManager.tabs.indexOf(tab)\n                                );\n                              } else {\n                                tabActionsRef.current.closePath(tab.filePath);\n                              }\n                            }}\n                          />\n                        </TooltipTrigger>\n                      }\n                      containerProps={{\n                        onDoubleClick: () => {\n                          hideAllAction?.perform();\n                        },\n                      }}\n                    />\n                  </TooltipTrigger>\n                </TabItem>\n              );\n            }}\n          </EditorTabs>\n        </ContextMenuContainer>\n      )}\n      {activeTab &&\n        (typeof content === \"string\" ? (\n          <Editor\n            height=\"100%\"\n            path={activeTab.filePath}\n            onMount={(monacoEditor, monaco) => {\n              monacoEditor.focus();\n              enableJsx(monaco);\n              editorRef.current = monacoEditor;\n              monacoEditor.onDidChangeCursorPosition((e) => {\n                setCursorPositionState(e.position);\n              });\n              monacoEditor.onDidChangeModel(() => {\n                const position = editorRef.current?.getPosition();\n                if (position) {\n                  setCursorPositionState(position);\n                }\n              });\n            }}\n            onChange={updateContent}\n            value={content}\n          />\n        ) : (\n          content && \"UNSUPPORTED CONTENT\"\n        ))}\n      {contentLoadable.state === \"loading\" && <FileEditorLoading />}\n    </StyledFileEditorContainer>\n  );\n};\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  CallbackInterface,\n  GetRecoilValue,\n  selector,\n  useRecoilCallback,\n} from \"recoil\";\nimport { currentProjectState, Project } from \"../Project/project.state\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport * as path from \"path\";\nimport { vcsRootsState } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom({\n  key: \"projectView.foldersOnTop\",\n  default: true,\n});\n\nexport const expandedKeysState = atom({\n  key: \"projectView.expandedKeys\",\n  default: selector({\n    key: \"projectView.expandedKeys/default\",\n    get: ({ get }) =>\n      new Set<Key>(\n        get(vcsRootsState).flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n      ),\n  }),\n});\n\nexport const selectedKeysState = atom<Selection>({\n  key: \"projectView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\nexport const projectViewTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"projectView.focusHandle\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const currentProjectTreeState = selector({\n  key: \"projectTree\",\n  get: ({ get }) => {\n    const project = get(currentProjectState);\n    return createProjectTree(project, get);\n  },\n});\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: GetRecoilValue\n): Promise<ProjectTreeRoot> {\n  const rootItems = get(dirContentState(project.path));\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const name = path.basename(item.path);\n      const node = {\n        ...item,\n        name,\n        parent,\n      };\n      const dirNode: FileTreeDirNode = { ...node, children: [] };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          dirNode.children = (\n            await Promise.all(\n              (get(dirContentState(item.path)) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          return dirNode;\n        }\n        return null;\n      }\n      return node;\n    };\n\n  return {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children: (await Promise.all((rootItems || []).map(mapItem(null)))).filter(\n      notNull\n    ),\n  };\n}\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for expanding to a certain path in project view.\n * @param snapshot\n * @param set\n */\nexport const expandToPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (path: string) => {\n    const expandedKeys = snapshot.getLoadable(expandedKeysState).valueOrThrow();\n    const keysToExpand = [\n      snapshot.getLoadable(currentProjectState).valueOrThrow().path,\n    ].concat(getParentPaths(path));\n    set(expandedKeysState, new Set([...expandedKeys, ...keysToExpand]));\n  };\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n * // TODO: open project view tool window if needed, when tool window state is also moved to recoil instead of local\n * //  state.\n */\nexport const selectKeyAndFocusCallback =\n  ({ snapshot }: CallbackInterface) =>\n  (key: Key) => {\n    const treeRef = snapshot\n      .getLoadable(projectViewTreeRefState)\n      .valueOrThrow()?.current;\n    treeRef?.replaceSelection(key);\n    treeRef?.focus(key);\n  };\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useRecoilCallback(expandToPathCallback, []);\n  const selectKeyAndFocus = useRecoilCallback(selectKeyAndFocusCallback, []);\n  return (path: string) => {\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","import {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectState,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeState,\n  expandedKeysState,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefState,\n  selectedKeysState,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useRecoilValue(currentProjectState);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetRecoilState(projectViewTreeRefState);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const projectTree = useRecoilValue(currentProjectTreeState);\n\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const foldersOnTop = useRecoilValue(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n\n  return (\n    <DefaultSuspense>\n      <SpeedSearchTree\n        ref={treeRef}\n        {...activePathsProviderProps}\n        items={[projectTree] as ProjectTreeNode[]}\n        onAction={(path) => {\n          editor.openPath(`${path}`);\n        }}\n        fillAvailableSpace\n        autoFocus\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n      >\n        {(item) => (\n          <Item\n            key={item.path}\n            textValue={item.name}\n            childItems={\n              \"children\" in item ? sortItems(item.children) : undefined\n            }\n          >\n            <ItemLayout>\n              {<ProjectViewNodeIcon node={item} />}\n              {item.type === \"project\" ? (\n                <>\n                  <b>\n                    <HighlightedTextValue />\n                  </b>\n                  <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                </>\n              ) : (\n                <FileTreeNodeText node={item} />\n              )}\n              {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n            </ItemLayout>\n          </Item>\n        )}\n      </SpeedSearchTree>\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport {\n  projectViewTreeRefState,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useRecoilValue(projectViewTreeRefState);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useRecoilValue(activeEditorTabState);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n  ];\n}\n","import { atom, CallbackInterface, selector, useRecoilCallback } from \"recoil\";\nimport { checkout, resetIndex, statusMatrix, StatusRow } from \"isomorphic-git\";\nimport { useEffect } from \"react\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\n\nimport { fs } from \"../../fs/fs\";\nimport { reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport {\n  useUpdateFileStatus,\n  vcsRootForFile,\n  vcsRootsState,\n} from \"../file-status.state\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n};\n\nexport interface Change {\n  before: Revision;\n  after: Revision;\n}\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: Change[];\n}\n\nexport const changeListsState = atom<ChangeListObj[]>({\n  key: \"changelists.lists\",\n  default: [\n    {\n      id: \"some-UUID\",\n      name: \"Changes\",\n      comment: \"last modified commit message\",\n      changes: [],\n      active: true,\n    },\n    {\n      id: \"some-other-UUID\",\n      name: \"Some other changelist\",\n      comment: \"Some empty changelist for testing\",\n      changes: [],\n      active: false,\n    },\n  ],\n});\n\nexport const activeChangeListState = selector<ChangeListObj | null>({\n  key: \"changelists.lists/default\",\n  get: ({ get }) =>\n    get(changeListsState).find((changeList) => changeList.active) ?? null,\n});\n\nexport const allChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changelists.allChanges\",\n  get: ({ get }) =>\n    get(changeListsState)\n      .map((changeLists) => changeLists.changes)\n      .flat(),\n});\n\nconst isAChange = ([, head, workingDir, stage]: StatusRow): boolean =>\n  head !== 1 || workingDir !== 1 || stage !== 1;\n\nconst refreshChangesCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  async () => {\n    const gitRoots = (await snapshot.getPromise(vcsRootsState)).filter(\n      (root) => root.vcs === \"git\"\n    );\n    const allStatusMatrices = await Promise.all(\n      gitRoots.map(async ({ dir }) => {\n        const rows = await statusMatrix({ fs, dir });\n        return rows\n          .filter(isAChange)\n          .map(\n            ([pathname, ...theRest]) =>\n              [path.join(dir, pathname), ...theRest] as StatusRow\n          );\n      })\n    );\n    const unversionedPaths = []; // FIXME: handle unversioned files\n    const changes = allStatusMatrices\n      .flat()\n      .map(([path, head, workdir, stage]) => ({\n        // FIXME: change object creation doesn't cover all kind of changes.\n        after: { path, isDir: false },\n        before: { path, isDir: false },\n      }));\n\n    // FIXME: changes now all go to default change list on each refresh. fix it.\n    set(changeListsState, (changeLists) =>\n      changeLists.map((changeList) => {\n        if (changeList.active) {\n          return {\n            ...changeList,\n            changes,\n          };\n        }\n        return {\n          ...changeList,\n          changes: [],\n        };\n      })\n    );\n  };\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  const updateFileStatus = useUpdateFileStatus();\n  return useRecoilCallback(\n    (callbackInterface) => async (changes: readonly Change[]) => {\n      const { snapshot, set } = callbackInterface;\n      const reloadFileFromDisk = reloadFileFromDiskCallback(callbackInterface);\n\n      const changesWithRepoRoots = await Promise.all(\n        changes\n          .filter((change) => !change.after.isDir)\n          .map(async (change) => {\n            const repoRoot = (await snapshot.getPromise(\n              vcsRootForFile(change.after.path)\n            ))!; // FIXME: handle null\n            return {\n              repoRoot,\n              fullPath: change.after.path,\n              relativePath: path.relative(repoRoot, change.after.path),\n            };\n          })\n      );\n      const groupedChanges = groupBy(\n        ({ repoRoot }) => repoRoot,\n        changesWithRepoRoots\n      );\n      await Promise.all(\n        Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n          await checkout({\n            fs,\n            dir: repoRoot,\n            force: true,\n            filepaths: items.map(({ relativePath }) => relativePath),\n          });\n          await Promise.all(\n            items.map(async ({ fullPath, relativePath }) => {\n              await resetIndex({ fs, dir: repoRoot, filepath: relativePath });\n              await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n              return updateFileStatus(fullPath);\n            })\n          );\n        })\n      );\n\n      // Remove all changes from changelists. It's much more efficient than refresh.\n      set(changeListsState, (changeLists) =>\n        changeLists.map((changeList) => {\n          return {\n            ...changeList,\n            changes: changeList.changes.filter(\n              (change) => !changes.includes(change)\n            ),\n          };\n        })\n      );\n    },\n    []\n  );\n};\n\nexport const useRefreshChanges = () =>\n  useRecoilCallback(refreshChangesCallback, []);\n\nexport const useSetActiveChangeList = () =>\n  useRecoilCallback(\n    ({ set, snapshot }) =>\n      (changeListId) => {\n        const changeLists = snapshot.getLoadable(changeListsState).getValue();\n        const targetChangeList = changeLists.find(\n          ({ id }) => id === changeListId\n        );\n        if (targetChangeList) {\n          set(\n            changeListsState,\n            changeLists.map((changeList) => ({\n              ...changeList,\n              active: changeList === targetChangeList,\n            }))\n          );\n        }\n        // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n      },\n    []\n  );\n\n// temporary, perhaps\nexport const useInitializeChanges = () => {\n  const refresh = useRefreshChanges();\n  useEffect(() => {\n    refresh().catch((e) => console.error(\"could not initialize changes\", e));\n  }, [refresh]);\n};\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { Change, ChangeListObj } from \"../change-lists.state\";\nimport { GroupFn } from \"./ChangesView.state\";\n\nexport interface ChangeBrowserNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface GroupNode<T extends string> extends ChangeBrowserNode<T> {\n  children: ReadonlyArray<AnyNode>;\n}\n\nexport interface ChangeNode extends ChangeBrowserNode<\"change\"> {\n  change: Change;\n}\n\nexport interface ChangeListNode extends GroupNode<\"changelist\"> {\n  changeList: ChangeListObj;\n}\n\nexport interface DirectoryNode extends GroupNode<\"directory\"> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode extends GroupNode<\"repo\"> {\n  repository: VcsDirectoryMapping;\n}\n\nexport type AnyGroupNode = ChangeListNode | RepositoryNode | DirectoryNode;\nexport type AnyNode = AnyGroupNode | ChangeNode;\nconst changeBrowserNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\nexport const getNodeKeyForChange = (change: Change) =>\n  changeBrowserNodeKey(\"change\", change.after.path);\nexport const changeNode = (change: Change): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n});\nexport const changeListNode = (\n  changeList: ChangeListObj,\n  groupFn: GroupFn<any> = (i) => i\n): ChangeListNode => ({\n  type: \"changelist\",\n  key: changeBrowserNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: groupFn(changeList.changes.map((change) => changeNode(change))),\n});\nexport const directoryNode = (\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly AnyNode[] = []\n): DirectoryNode => ({\n  type: \"directory\",\n  key: changeBrowserNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = (\n  repository: VcsDirectoryMapping,\n  children: AnyNode[] = []\n): RepositoryNode => ({\n  type: \"repo\",\n  key: changeBrowserNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = (\n  node: ChangeBrowserNode<any>\n): node is GroupNode<any> => \"children\" in node;\nexport const isChangeNode = (\n  node: ChangeBrowserNode<any>\n): node is ChangeNode => node.type === \"change\";\nexport const isDirectoryNode = (node: AnyNode): node is DirectoryNode =>\n  node.type === \"directory\";\nexport const getChildren = (node: AnyNode) =>\n  isGroupNode(node) ? node.children : null;\n","import { constSelector, GetRecoilValue, selector } from \"recoil\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { ChangeGrouping } from \"./ChangesView.state\";\nimport { groupByDirectory } from \"./groupByDirectory\";\nimport {\n  ChangeNode,\n  DirectoryNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./change-view-nodes\";\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: selector({\n    key: \"repositoryGrouping/isAvailable\",\n    get: ({ get }) => get(vcsRootsState).length > 0,\n  }),\n  groupFn: selector({\n    key: \"repositoryGrouping/groupFn\",\n    get:\n      ({ get }: { get: GetRecoilValue }) =>\n      (nodes: ReadonlyArray<ChangeNode>) => {\n        const repos = get(vcsRootsState);\n        return repos.map((repository): RepositoryNode => {\n          return repositoryNode(\n            repository,\n            nodes.filter((node) =>\n              (node.change.after?.path || node.change.before?.path)?.startsWith(\n                repository.dir\n              )\n            )\n          );\n        });\n      },\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: constSelector(true),\n  groupFn: groupByDirectory,\n};\n\nexport const groupings = [repositoryGrouping, directoryGrouping];\n","import { groupBy, identity, memoizeWith, uniq } from \"ramda\";\nimport { getParentPaths } from \"../../../file-utils\";\nimport {\n  AnyNode,\n  ChangeNode,\n  DirectoryNode,\n  directoryNode,\n  isDirectoryNode,\n} from \"./change-view-nodes\";\n\n/**\n * Exported only for tests.\n * @internal\n */\nexport const groupByDirectory = (\n  nodes: ReadonlyArray<ChangeNode>\n): DirectoryNode[] => {\n  const pathToNodeCache: Record<string, DirectoryNode> = {};\n  const rootDirNodes = nodes.map((node) => {\n    if (node.change.after.isDir) {\n      throw new Error(\"isDir=true is not supported for changes ATM!\");\n    }\n    const filepath = node.change.after.path;\n    // noinspection UnnecessaryLocalVariableJS\n    const rootDirNode = getParentPaths(filepath).reduce(\n      (prevNode: DirectoryNode | ChangeNode, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = directoryNode(dirPath, \"\");\n        }\n        if (prevNode.type === \"directory\") {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      },\n      node\n    ) as DirectoryNode; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n    // whether the array can be empty might be something to consider and guard against\n    return rootDirNode;\n  });\n  const collapseDirectories = (dirNode: DirectoryNode): DirectoryNode => {\n    let { children, dirPath, parentNodePath } = dirNode;\n    if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n      dirPath = dirNode.children[0].dirPath;\n      children = dirNode.children[0].children.map((child) =>\n        isDirectoryNode(child)\n          ? collapseDirectories({\n              ...child,\n              parentNodePath: dirPath,\n            })\n          : child\n      );\n      return collapseDirectories(\n        directoryNode(dirPath, parentNodePath, children)\n      );\n    }\n    return {\n      ...dirNode,\n      children: children.map((child) =>\n        isDirectoryNode(child) ? collapseDirectories(child) : child\n      ),\n    };\n  };\n  return uniq(rootDirNodes).map(collapseDirectories);\n};\n","import { atom, selector } from \"recoil\";\nimport { Change } from \"../change-lists.state\";\nimport { changesTreeNodesState } from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  AnyNode,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesView/change-view-nodes\";\n\nconst isOpen = atom<boolean>({\n  key: \"rollbackView.isOpen\",\n  default: false,\n});\nconst windowBounds = atom<Partial<Bounds>>({\n  key: \"rollbackView.windowBounds\",\n  default: { height: 500 },\n});\nconst initiallyIncludedChanges = atom<ReadonlyArray<Change>>({\n  key: \"rollbackView.initiallySelectedChanges\",\n  default: [],\n});\nconst rootNodes = selector({\n  key: \"rollbackView.includedRootNodes\",\n  get: ({ get }) => {\n    const selectedChanges = get(initiallyIncludedChanges);\n    const { rootNodes } = get(changesTreeNodesState);\n    return rootNodes.filter(\n      ({ changeList: { changes, active } }) =>\n        (selectedChanges.length === 0 && active) ||\n        selectedChanges.some((change) => changes.includes(change))\n    );\n  },\n});\nconst initiallyExpandedKeys = selector({\n  key: \"rollbackView.initiallyExpandedKeys\",\n  get: ({ get }) => {\n    const includedChanges = get(initiallyIncludedChanges);\n    const nodes = get(rootNodes);\n    const expandedKeys = getExpandedToNodesKeys<AnyNode>(\n      (node) => (isGroupNode(node) ? node.children : null),\n      (node) => node.key,\n      nodes,\n      includedChanges.map(getNodeKeyForChange)\n    );\n    return new Set(\n      expandedKeys.length\n        ? expandedKeys\n        : getExpandAllKeys<AnyNode>(\n            (node) => (isGroupNode(node) ? node.children : null),\n            (node) => node.key,\n            nodes\n          )\n    );\n  },\n});\n\nexport const rollbackViewState = {\n  isOpen,\n  windowBounds,\n  initiallyExpandedKeys,\n  initiallyIncludedChanges,\n  rootNodes,\n};\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  isRecoilValue,\n  RecoilValue,\n  selector,\n} from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  allChangesState,\n  Change,\n  ChangeListObj,\n  changeListsState,\n} from \"../change-lists.state\";\nimport { groupings } from \"./changesGroupings\";\nimport {\n  bfsVisit,\n  dfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsState } from \"../../../Project/project.state\";\nimport {\n  AnyGroupNode,\n  AnyNode,\n  ChangeBrowserNode,\n  ChangeListNode,\n  changeListNode,\n  ChangeNode,\n  getChildren,\n  getNodeKeyForChange,\n  GroupNode,\n  isChangeNode,\n  isGroupNode,\n} from \"./change-view-nodes\";\nimport { Task } from \"../../../tasks\";\n\ntype MaybeRecoilValue<T> = T | RecoilValue<T>;\n\nexport type GroupFn<T extends AnyGroupNode> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<T extends AnyGroupNode, I = string> {\n  id: I;\n  title: string;\n  isAvailable: MaybeRecoilValue<boolean>;\n  groupFn: MaybeRecoilValue<GroupFn<T>>;\n}\nexport const showIgnoredFilesState = atom({\n  key: \"changesView/showIgnoredFiles\",\n  default: false,\n});\n\nexport const showRelatedFilesState = atom({\n  key: \"changesView/showRelatedFiles\",\n  default: false,\n});\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = typeof groupings[number][\"id\"];\n\nexport const changesGroupingState = atomFamily<boolean, GroupingIds>({\n  key: \"changesView/grouping\",\n  default: true, // it's false in IntelliJ\n});\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysState = atom<Selection>({\n  key: \"changesView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\n/**\n * Same as {@link selectedKeysState}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysState = selector<Set<Key>>({\n  key: \"changesView.resolvedSelectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectedKeysState);\n    if (selection === \"all\") {\n      const { rootNodes } = get(changesTreeNodesState);\n      return new Set(\n        bfsVisit<AnyNode, AnyNode[]>(\n          (node) => (isGroupNode(node) ? node.children : []),\n          (node, parentValue) => {\n            const nodes = parentValue ?? [];\n            nodes.push(node);\n            return nodes;\n          },\n          rootNodes\n        )\n          .flat()\n          .map((node) => node.key)\n      );\n    }\n    return selection;\n  },\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysState}\n */\nconst selectedNodesState = selector<ReadonlySet<AnyNode>>({\n  key: \"changesView.selectedNodes\",\n  get: ({ get }) => {\n    const selectedKeys = get(resolvedSelectedKeysState);\n    const { byKey } = get(changesTreeNodesState);\n    return new Set(\n      [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n    );\n  },\n});\n\nexport const changesUnderSelectedKeys = selector<ReadonlySet<Change>>({\n  key: \"changesView.selectedKeys.changes\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChanges: Set<Change> = new Set();\n    const processNode = (node: AnyNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  },\n});\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = selector<ReadonlySet<ChangeListObj>>({\n  key: \"changesView.selectedChangeLists\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChangeLists = get(changeListsState);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: AnyNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  },\n});\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysState = atom<Set<string>>({\n  key: \"changesView.includedChangeKeys\",\n  default: new Set<string>([]),\n});\n\nexport const includedChangesState = selector<ReadonlyArray<Change>>({\n  key: \"changesView.includedChanges\",\n  get: ({ get }) => {\n    const includedChangeKeys = get(includedChangeKeysState);\n    const allChanges = get(allChangesState);\n    return allChanges.filter((change) =>\n      includedChangeKeys.has(getNodeKeyForChange(change))\n    );\n  },\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelection = selector<\n  NestedSelectionState<AnyNode>\n>({\n  key: \"changesView.selectedChanges.nestedSelectionState\",\n  get: ({ get, getCallback }) => {\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedChangeKeys = get(includedChangeKeysState);\n    const setSelectedKeys = getCallback(\n      ({ set }) =>\n        (setValue: (currentValue: Set<string>) => Set<string>) =>\n          set(includedChangeKeysState, setValue)\n    );\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface(setSelectedKeys),\n      },\n      {\n        rootNodes,\n        getChildren: (item: AnyNode) =>\n          isGroupNode(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n});\n\nexport const expandedKeysState = atom<Selection>({\n  key: \"changesView.expandedKeys\",\n  default: selector({\n    key: \"changesView.expandedKeys/temporaryDefault\",\n    get: ({ get }) => {\n      return new Set<Key>(\n        get(changesTreeNodesState)\n          .rootNodes.map((node) => [\n            node.key,\n            ...node.children.map((child) => child.key),\n          ])\n          .flat()\n      );\n    },\n  }),\n});\n\nexport const availableGroupingsState = selector({\n  key: \"changes.availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        grouping,\n        isActive: get(changesGroupingState(grouping.id)),\n      })),\n});\n\nconst recursiveGrouping = (\n  groupingFns: Array<GroupFn<AnyGroupNode>>,\n  nodes: ReadonlyArray<ChangeBrowserNode<any>>\n): ReadonlyArray<AnyGroupNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes as ReadonlyArray<AnyGroupNode>; // can we avoid explicit cast?\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n  const changeNodes = nodes.filter(isChangeNode);\n  const groupNodes = nodes.filter(isGroupNode);\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\nexport const changesTreeNodesState = selector<{\n  rootNodes: ChangeListNode[];\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, AnyNode>;\n}>({\n  key: \"changesView.treeNodes\",\n  get: ({ get }) => {\n    const resolve = <T>(value: MaybeRecoilValue<T>): T =>\n      isRecoilValue(value) ? get(value) : value;\n    const changeLists = get(changeListsState);\n    const groupFns = get(availableGroupingsState)\n      .filter(({ isActive }) => isActive)\n      .map(({ grouping }) => {\n        return resolve(grouping.groupFn);\n      });\n\n    const groupChanges = (changes: readonly ChangeNode[]) =>\n      recursiveGrouping(groupFns, changes);\n\n    const rootNodes = sortBy(({ active }) => !active, changeLists).map(\n      (changeList) => changeListNode(changeList, groupChanges)\n    );\n    const fileCountsMap = new Map();\n    const byKey = new Map();\n    const getFileCount = (node: GroupNode<any>): number => {\n      return node.children.reduce(\n        (totalSum, child) =>\n          totalSum + (isGroupNode(child) ? getFileCount(child) : 1),\n        0\n      );\n    };\n    dfsVisit<AnyNode, number>(\n      getChildren,\n      (node, childrenFileCount) => {\n        byKey.set(node.key, node);\n        if (!childrenFileCount) {\n          return 1;\n        }\n        const fileCount = childrenFileCount.reduce(\n          (total, count) => total + count,\n          0\n        );\n        fileCountsMap.set(node.key, fileCount);\n        return fileCount;\n      },\n      rootNodes\n    );\n    return { rootNodes, fileCountsMap, byKey };\n  },\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily<\n  number,\n  \"horizontal\" | \"vertical\"\n>({\n  key: \"changesView/splitter/commitMessageSize\",\n  default: (orientation) => (orientation === \"horizontal\" ? 0.4 : 0.3),\n});\n/**\n * Whether --amend should be used for commit.\n */\nexport const amendCommitState = atom({\n  key: \"changesView/amendCommit\",\n  default: false,\n  // TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n  // it should add a record to the commit message history and switch the message. When toggled to false,\n  // last entry in history should be back again. There is currently no history :D\n});\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageState = atom({\n  key: \"changesView/commitMessage\",\n  default: \"\",\n});\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageState = atom({\n  key: \"changesView/commitErrorMessage\",\n  default: \"\",\n});\n\nexport const commitTaskIdState = atom<Task[\"id\"] | null>({\n  key: \"changesView/commitTaskId\",\n  default: null,\n});\n\nexport const changesFromActivePaths = selector({\n  key: \"changesView/changesFromActivePaths\",\n  get: ({ get }) => {\n    const activePaths = get(activePathsState);\n    return get(allChangesState).filter((change) =>\n      activePaths.some((activePath) => change.after.path.startsWith(activePath))\n    );\n  },\n});\n\n/**\n * Recoil callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = ({ set, snapshot }: CallbackInterface) => {\n  /**\n   * @param paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  return (paths?: string[]) => {\n    const changes = paths\n      ? snapshot\n          .getLoadable(allChangesState)\n          .getValue()\n          .filter((change) =>\n            paths.some((activePath) => change.after.path.startsWith(activePath))\n          )\n      : snapshot.getLoadable(changesFromActivePaths).getValue();\n\n    const includedChangeKeys = changes.map(getNodeKeyForChange);\n    set(includedChangeKeysState, new Set(includedChangeKeys));\n    if (includedChangeKeys.length > 0) {\n      const expandedKeys = getExpandedToNodesKeys<AnyNode>(\n        (node) => (isGroupNode(node) ? node.children : null),\n        (node) => node.key,\n        snapshot.getLoadable(changesTreeNodesState).getValue().rootNodes,\n        includedChangeKeys\n      );\n      set(expandedKeysState, (currentExpandedKeys) => {\n        return new Set([\n          ...(currentExpandedKeys !== \"all\"\n            ? currentExpandedKeys\n            : new Set<Key>()),\n          ...expandedKeys,\n        ]);\n      });\n      set(selectedKeysState, new Set([includedChangeKeys[0]]));\n    }\n  };\n};\n\nexport const openRollbackWindowForSelectionCallback = ({\n  set,\n  snapshot,\n}: CallbackInterface) => {\n  /**\n   * If contextual is true, changes related to {@link activePathsState} will be preselected.\n   */\n  return (contextual = true) => {\n    const activePaths = snapshot.getLoadable(activePathsState).getValue();\n    const changesUnderSelection = snapshot\n      .getLoadable(changesUnderSelectedKeys)\n      .getValue();\n    const changesBasedOnActivePaths =\n      contextual && activePaths.length > 0\n        ? snapshot.getLoadable(changesFromActivePaths).getValue()\n        : null;\n    set(\n      rollbackViewState.initiallyIncludedChanges,\n      changesBasedOnActivePaths ?? [...changesUnderSelection]\n    );\n    set(rollbackViewState.isOpen, true);\n  };\n};\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n};\n","import { useRecoilValue } from \"recoil\";\nimport { selectedKeysState } from \"./ChangesView.state\";\nimport { DividerItem, useAction } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Context menu\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(VcsActionIds.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.1rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useRecoilValue(vcsRootsState).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = ({ rootPath }: { rootPath: string }) => (\n  <StyledRepoColorSquare\n    style={{ backgroundColor: useRepoRootColor(rootPath) }}\n  />\n);\n","import React from \"react\";\nimport { Color, styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    new Color(\n      theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )\n    )\n      .withTransparency(\n        theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08\n      )\n      .toString()};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { Checker } from \"@recoiljs/refine\";\nimport { syncEffect } from \"recoil-sync\";\nimport { DefaultValue } from \"recoil\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nexport type PersistentAtomEffectArgs<C, A> = {\n  read: (componentState: C) => Promise<A> | A;\n  update: (value: A) => (componentState: C) => C;\n  refine: Checker<A>;\n  componentName: string;\n  storageFile?: string;\n};\n\nexport function persistentAtomEffect<A, C>({\n  componentName,\n  refine,\n  read,\n  update,\n  storageFile = StorageFiles.WORKSPACE_FILE,\n}: PersistentAtomEffectArgs<C, A>) {\n  const itemKey = [storageFile, componentName].join(\"|\");\n  return syncEffect<A>({\n    storeKey: \"ProjectWorkspace\",\n    itemKey,\n    syncDefault: false,\n    read: async ({ read: readComponentState }) => {\n      return read((await readComponentState(itemKey)) as C);\n    },\n    write: ({ write, read }, value) => {\n      if (!(value instanceof DefaultValue)) {\n        write(itemKey, update(value));\n      }\n    },\n    refine,\n  });\n}\n","import { equals, groupBy } from \"ramda\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilValue,\n} from \"recoil\";\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\n\nimport { fs } from \"../../fs/fs\";\nimport { vcsRootForFile, vcsRootsState } from \"../file-status.state\";\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsState } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { persistentAtomEffect } from \"../../Project/persistence/persistentAtomEffect\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\ntype BranchType = \"LOCAL\" | \"REMOTE\";\n\ntype BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesState = selectorFamily<LocalBranch[], string>({\n  key: \"vcs/repoLocalBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({}) => {\n      const branches = await git.listBranches({ fs, dir: repoRoot });\n      return Promise.all(\n        branches.map(async (branch) => ({\n          name: branch,\n          trackingBranch: await getTrackingBranch({\n            fs,\n            dir: repoRoot,\n            localBranchName: branch,\n          }),\n        }))\n      );\n    },\n});\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesState = selectorFamily({\n  key: \"vcs/repoRemoteBranches\",\n  get: (repoRoot: string) => async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  },\n});\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesState = selectorFamily<RepoBranches, string>({\n  key: \"vcs/repoBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({ get }) => {\n      const currentBranchName = get(repoCurrentBranchNameState(repoRoot));\n      const localBranches = get(repoLocalBranchesState(repoRoot));\n      return {\n        repoRoot,\n        currentBranch:\n          localBranches.find((branch) => branch.name === currentBranchName) ||\n          null,\n        localBranches: localBranches,\n        remoteBranches: get(repoRemoteBranchesState(repoRoot)),\n      };\n    },\n});\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameState = selectorFamily({\n  key: \"vcs/repoCurrentBranch\",\n  get: (repoRoot: string) => () => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  },\n});\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesState = selector<RepoBranches[]>({\n  key: \"vcs/allBranches\",\n  get: ({ get }) => {\n    const repoRoots = get(vcsRootsState);\n    return repoRoots.map(({ dir: repoRoot }) =>\n      get(repoBranchesState(repoRoot))\n    );\n  },\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathState = selectorFamily<string | null, string>({\n  key: \"gitBranchForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      const root = get(vcsRootForFile(filepath));\n      return root\n        ? get(repoBranchesState(root)).currentBranch?.name || null\n        : null;\n    },\n});\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\ntype MaybeArray<T> = Array<T> | T;\nconst maybeArray = <T>(input: MaybeArray<T> | undefined): Array<T> =>\n  Array.isArray(input) ? input : input ? [input] : [];\ninterface BranchStorage {\n  map: MaybeArray<{\n    entry: {\n      \"@type\": \"LOCAL\" | \"REMOTE\";\n      value: {\n        list: MaybeArray<{\n          \"branch-info\": {\n            \"@repo\": string;\n            \"@source\": string;\n          };\n        }>;\n      };\n    };\n  }>;\n}\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\ninterface GitSettingsStorage {\n  \"favorite-branches\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n  \"exclude-from-favorite\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n}\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    maybeArray(branchStorage?.map).flatMap<BranchInfo>((entry) =>\n      maybeArray(entry?.entry.value.list).map(\n        ({ \"branch-info\": { \"@source\": branchName, \"@repo\": repoRoot } }) => ({\n          branchType: entry?.entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction toBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      entry: {\n        \"@type\": branchType as BranchType,\n        value: {\n          list: branches.map((branch) => ({\n            \"branch-info\": {\n              \"@repo\": branch.repoRoot,\n              \"@source\": branch.branchName,\n            },\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: entries,\n  };\n}\n\nconst branchInfoArrayChecker = array(\n  object({\n    branchType: union(literal(\"LOCAL\"), literal(\"REMOTE\")),\n    branchName: string(),\n    repoRoot: string(),\n  })\n);\nconst favoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"favorite-branches\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nconst excludedFromFavoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite-excluded\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"exclude-from-favorite\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      (\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          snapshot.getLoadable(favoriteBranchesState).getValue(),\n          snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesState, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesState, add);\n          }\n        } else {\n          set(favoriteBranchesState, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesState, add);\n          }\n        }\n      },\n    []\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useRecoilValue(favoriteBranchesState);\n  const excludedFromFavoriteBranches = useRecoilValue(\n    excludedFromFavoriteBranchesState\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string, checkout: boolean = true) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            refresh(repoBranchesState(repoRoot));\n          }\n        );\n      },\n    []\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useRecoilCallback(\n    ({ refresh, snapshot }) =>\n      async (repoRoot: string, branchName: string, newBranchName: string) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            snapshot.getLoadable(favoriteBranchesState).getValue(),\n            snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n    []\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (repoRoot: string, branchName: string, remote?: string) => {\n        const { refresh, snapshot, set } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        refresh(dirContentState(repoRoot));\n        const openedFiles = snapshot.getLoadable(editorTabsState).getValue();\n        const existingOpenedFile = await asyncFilter(\n          ({ filePath }) => reloadFileFromDisk(filePath),\n          openedFiles\n        );\n        set(editorTabsState, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n    []\n  );\n}\n\nexport function useDeleteBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string) => {\n        return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n          refresh(repoBranchesState(repoRoot));\n        });\n      },\n    []\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathState } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useRecoilValue(branchForPathState(repo.dir));\n  return <>{branch}</>;\n};\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport { changesGroupingState } from \"./ChangesView.state\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport path from \"path\";\nimport {\n  HighlightedTextValue,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { RepoColorIcon } from \"./StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"./StyledCurrentBranchTag\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  AnyNode,\n  ChangeBrowserNode,\n  ChangeListNode,\n  ChangeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./change-view-nodes\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\ntype NodeRenderer<T extends ChangeBrowserNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\nconst repoNodeItemProps: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{fileCountMsg.format({ fileCount })}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeItemProps: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{fileCountMsg.format({ fileCount })}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst changeListNodeItemProps: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {fileCountMsg.format({ fileCount })}{\" \"}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  const isGroupedByDirectory = useRecoilValue(\n    changesGroupingState(\"directory\")\n  );\n  return (\n    <ItemLayout.Hint>\n      {!isGroupedByDirectory && path.dirname(node.change.after.path)}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeItemProps: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(node.change.after.path),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(node.change.after.path)} />\n      <HighlightedTextValue />\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\nconst nodeRenderers: {\n  [type in AnyNode[\"type\"]]: NodeRenderer<AnyNode & { type: type }>;\n} = {\n  repo: repoNodeItemProps,\n  directory: directoryNodeItemProps,\n  changelist: changeListNodeItemProps,\n  change: changeNodeItemProps,\n};\n\nexport const getChangeListTreeItemProps = ({\n  node,\n  fileCountsMap,\n}: {\n  node: AnyNode;\n  fileCountsMap: Map<Key, number>;\n}): ItemProps<AnyNode> & { key: Key } => {\n  // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n  // to node types\n  const nodeRenderer: NodeRenderer<any> /* FIXME: why is any needed? */ =\n    nodeRenderers[node.type];\n  const { textValue, rendered } = nodeRenderer(node, {\n    fileCount: fileCountsMap.get(node.key) || 0,\n    dirCount: 0, // It seems it's only used for ignored files subtree\n  });\n  return {\n    key: node.key,\n    childItems: isGroupNode(node) ? node.children : [],\n    hasChildItems: isGroupNode(node) && node.children?.length > 0,\n    textValue,\n    children: rendered,\n  };\n};\n","import React, { Key, RefObject } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesState,\n  expandedKeysState,\n  includedChangesNestedSelection,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { getChangeListTreeItemProps } from \"./changesTreeNodeRenderers\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { AnyNode, isGroupNode } from \"./change-view-nodes\";\n\nfunction findPathsUnderNode(node: AnyNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [node.change.after.path];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } = useRecoilValue(\n    changesTreeNodesState\n  );\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const nestedSelection = useRecoilValue(includedChangesNestedSelection);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useRecoilCallback(\n    ({ snapshot }) =>\n      (key: Key) => {\n        const change = snapshot\n          .getLoadable(changesTreeNodesState)\n          .getValue()\n          .byKey.get(key);\n        if (change?.type === \"change\") {\n          openPath(change.change.after.path);\n        }\n        return change;\n      },\n    []\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        ref={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = getChangeListTreeItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  IconButtonWithMenu,\n  PlatformIcon,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu menuProps={menuProps} actions={actions} />\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport {\n  availableGroupingsState,\n  changesGroupingState,\n  GroupingIds,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n} from \"@intellij-platform/core\";\n\nexport const GroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: GroupingIds) => {\n        set(changesGroupingState(id), (value) => !value);\n      },\n    []\n  );\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={availableGroupings\n            .filter(({ isActive }) => isActive)\n            .map(({ grouping }) => grouping.id)}\n          onAction={(key) => {\n            const id = availableGroupings.find(\n              ({ grouping }) => grouping.id === key\n            )?.grouping.id;\n            if (id) {\n              toggleGroup(id);\n            }\n          }}\n        >\n          <Section title=\"Group By\">\n            {availableGroupings.map(({ grouping }) => (\n              <Item key={grouping.id}>{grouping.title}</Item>\n            ))}\n          </Section>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/groupBy.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport {\n  showIgnoredFilesState,\n  showRelatedFilesState,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useRecoilState(\n    showRelatedFilesState\n  );\n  const [showIgnoredFiles, setShowIgnoredFiles] = useRecoilState(\n    showIgnoredFilesState\n  );\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { GroupByActionButton } from \"./ActionButtons/GroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\nimport React from \"react\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar hasBorder>\n      <ActionButton actionId={VcsActionIds.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <GroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { atom, selector, useRecoilCallback, useSetRecoilState } from \"recoil\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksState = atom<Task[]>({\n  key: \"tasks.list\",\n  default: [],\n});\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskState = selector<Task | null>({\n  key: \"tasks.first\",\n  get: ({ get }) => get(tasksState)[0],\n});\n\n/**\n * Optimized recoil value to get the number of tasks, if the tasks are not needed.\n */\nexport const taskCountState = selector<number>({\n  key: \"tasks.count\",\n  get: ({ get }) => get(tasksState).length,\n});\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetRecoilState(tasksState);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useRecoilCallback(({ snapshot }) => (id: Task[\"id\"]) => {\n    const task = snapshot\n      .getLoadable(tasksState)\n      .getValue()\n      .find((task) => task.id === id);\n    if (task) {\n      task.abortController.abort();\n    }\n  });\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useRecoilCallback } from \"recoil\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useUpdateVcsFileStatuses,\n  vcsRootForFile,\n} from \"../../file-status.state\";\nimport { Change, useRefreshChanges } from \"../change-lists.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdState } from \"./ChangesView.state\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshChanges = useRefreshChanges();\n  const refreshFileStatus = useUpdateVcsFileStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useRecoilCallback(\n    ({ snapshot, set }) =>\n      (changes: readonly Change[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = change.after.path;\n                      const repoRoot = snapshot\n                        .getLoadable(vcsRootForFile(filePath))\n                        .getValue();\n                      const content = await fs.promises.readFile(filePath);\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      files: updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                  }\n                )\n              ).then(\n                () => {\n                  // TODO: file status state and changes state separately use statusMatrix. It can be refactored for\n                  //  changes to be based on file status state.\n                  refreshChanges().catch(console.error);\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdState, null);\n            },\n          }\n        );\n        set(commitTaskIdState, taskId);\n      },\n    [refreshChanges]\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n * TODO: support removing files by null as content\n */\nexport async function commitFiles({\n  files,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  files: { [filePath: string]: Uint8Array };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(files).map(async ([filePath, blob]) => {\n      const entry = entries.find(({ path }) => path === filePath);\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n    })\n  );\n\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(files).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitState,\n  commitErrorMessageState,\n  commitMessageState,\n  commitTaskIdState,\n  includedChangesState,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useRecoilState(commitMessageState);\n  const commit = useCommitChanges();\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useRecoilState(\n    commitErrorMessageState\n  );\n  const commitTaskId = useRecoilValue(commitTaskIdState);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useRecoilCallback(({ snapshot }) => {\n    const includedChanges = snapshot\n      .getLoadable(includedChangesState)\n      .getValue();\n    const commitMessage = snapshot.getLoadable(commitMessageState).getValue();\n    return () => {\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (snapshot.getLoadable(amendCommitState).getValue()) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    };\n  }, []);\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n        >\n          Commit\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented}>\n          Commit and Push...\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { Change } from \"./change-lists.state\";\nimport { StatusColor } from \"../FileStatusColor\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<Change>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => change.after.path && change.before.path\n  ).length;\n  const addedCount = changes.filter(\n    (change) => change.after.path && !change.before.path\n  ).length;\n  const deletedCount = changes.filter(\n    (change) => change.before.path && !change.after.path\n  ).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitState, includedChangesState } from \"./ChangesView.state\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useRecoilValue(includedChangesState);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useRecoilState(amendCommitState);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={setAmend}\n              preventFocus\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { useRecoilState } from \"recoil\";\n\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport React, { useRef } from \"react\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const [commitMessageSize, setCommitMessageSize] = useRecoilState(\n    commitMessageSizeState(orientation)\n  );\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={treeActions}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React, { useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { useRefreshChanges } from \"../change-lists.state\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const refresh = useRefreshChanges();\n  useEffect(() => {\n    refresh();\n  }, []);\n  return (\n    <StyledContainer>\n      <ChangesViewSplitter />\n    </StyledContainer>\n  );\n};\n","import React from \"react\";\nimport path from \"path\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { RecoilValue, selector, useRecoilValue } from \"recoil\";\nimport { allChangesState } from \"./Changes/change-lists.state\";\nimport { vcsRootForFile } from \"./file-status.state\";\nimport { repoBranchesState } from \"./Branches/branches.state\";\nimport { changesGroupingState } from \"./Changes/ChangesView/ChangesView.state\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesState = selector({\n  key: \"vcs/commitToolWindow/changedRepos\",\n  get: ({ get }) => {\n    const changesRepoRoots = get(allChangesState)\n      .map((change) => get(vcsRootForFile(change.after.path)))\n      .filter(notNull);\n\n    return changesRepoRoots.map((repoRoot) => ({\n      repoRoot,\n      branch: get(repoBranchesState(repoRoot)).currentBranch,\n    }));\n  },\n});\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useRecoilValue(\n    changesGroupingState(\"repository\")\n  );\n  const changesBranches = useRecoilValue(changesBranchesState);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={\n                  <ChangesBranches changesBranches={changesBranches} />\n                }\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n\ntype RecoilValueType<T extends RecoilValue<any>> = T extends RecoilValue<\n  infer R\n>\n  ? R\n  : never;\n\nfunction ChangesBranches({\n  changesBranches,\n}: {\n  changesBranches: RecoilValueType<typeof changesBranchesState>;\n}) {\n  return (\n    <table>\n      {changesBranches\n        .map(({ branch, repoRoot }) => {\n          if (branch) {\n            const mapping = branch.trackingBranch\n              ? `${branch.name} → ${branch.trackingBranch}`\n              : changesBranches.length > 1\n              ? `${branch.name} (no tracking branch)`\n              : \"No tracking branch\";\n\n            return changesBranches.length > 1 ? (\n              <tr key={repoRoot}>\n                <td>{path.basename(repoRoot)}: &nbsp;</td>\n                <td>{mapping}</td>\n              </tr>\n            ) : (\n              <tr key={repoRoot}>\n                <td>{mapping}</td>\n              </tr>\n            );\n          }\n          return null;\n        })\n        .filter(notNull)}\n    </table>\n  );\n}\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\n\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({ anchor: \"left\", isVisible: false }),\n  },\n];\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport { repoBranchesState, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useRecoilValue(repoBranchesState(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"invalid\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                errorMessage={\n                  error && validationState === \"invalid\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  IconButton,\n  Toolbar,\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport {\n  allBranchesState,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useRecoilState } from \"recoil\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>({\n  key: \"branchesPopup.bounds\",\n  default: undefined,\n});\n\nexport function BranchesPopup({ onClose }: { onClose: () => void }) {\n  const repoBranches = useLatestRecoilValue(allBranchesState);\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] =\n    useRecoilState(branchesPopupSizeState);\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  // useRefreshRecoilValueOnMount(allBranchesState);\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      onClose();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={onClose}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import { resolveRef } from \"isomorphic-git\";\nimport { selector } from \"recoil\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsRootForFile, vcsRootsState } from \"./file-status.state\";\nimport {\n  branchForPathState,\n  RepoBranches,\n  repoBranchesState,\n} from \"./Branches/branches.state\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootState = selector({\n  key: \"vcs/activeFileRepo\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    const activeFileRepo = activeFile && get(vcsRootForFile(activeFile));\n    return activeFileRepo ?? get(vcsRootsState)[0]?.dir;\n  },\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesState = selector<RepoBranches>({\n  key: \"vcs/activeFileRepoBranches\",\n  get: ({ get }) => {\n    const activeFileRepoRoot = get(activeFileRepoRootState);\n    return get(repoBranchesState(activeFileRepoRoot));\n  },\n});\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchState = selector({\n  key: \"vcs/activeFileCurrentBranch\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    return activeFile ? branchForPathState(activeFile) : null;\n  },\n});\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadState = selector({\n  key: \"vcs/activeFileRepoHead\",\n  get: async ({ get }) => {\n    const branch = get(activeFileCurrentBranchState);\n    if (branch) {\n      return {\n        detached: false,\n        head: branch,\n      };\n    }\n    const repoRoot = get(activeFileRepoRootState);\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  },\n});\n","import React, { useEffect, useState } from \"react\";\nimport { sampleRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { clone } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport styled from \"styled-components\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core\";\n\nconst StyledDialog = styled.div`\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${WINDOW_SHADOW};\n  text-align: center;\n  line-height: 1.5;\n`;\nconst StyledDialogHeader = styled.div`\n  background: ${({ theme }) => theme.color(\"Popup.Header.activeBackground\")};\n  padding: 4px;\n  text-align: center;\n`;\nconst StyledDialogContent = styled.div`\n  padding: 8px 16px;\n`;\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nexport const SampleRepoInitializer: React.FC = ({ children }) => {\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function init(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl });\n      }\n    }\n\n    init(sampleRepo.path, sampleRepo.url)\n      .then(() => {\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      })\n      .catch((e) => {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      });\n  }, []);\n\n  if (state === \"uninitialized\") {\n    return null;\n  }\n  if (state === \"initialized\") {\n    return <>{children}</>;\n  }\n  return (\n    <div style={{ minHeight: \"100vh\", position: \"relative\" }}>\n      <StyledDialog>\n        <StyledDialogHeader>Cloning sample repo</StyledDialogHeader>\n        <StyledDialogContent>\n          {state === \"cloning\" ? (\n            <>\n              Cloning <b>{sampleRepo.url}</b>. <br />\n              It may take several seconds.\n            </>\n          ) : (\n            <>Something went wrong!</>\n          )}\n        </StyledDialogContent>\n      </StyledDialog>\n    </div>\n  );\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n} from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\nimport {\n  sampleRepos,\n  useRefreshCurrentProjectFiles,\n} from \"../Project/project.state\";\nimport { cloneRepo, isSuccessfullyCloned } from \"../SampleRepoInitializer\";\nimport React from \"react\";\nimport { useRefreshVcsRoots } from \"./file-status.state\";\nimport { useRecoilCallback } from \"recoil\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n  const refreshProjectFiles = useRefreshCurrentProjectFiles();\n  const refreshVcsRoots = useRefreshVcsRoots();\n\n  return useRecoilCallback(\n    ({ reset }) =>\n      async () => {\n        const cloned = await isSuccessfullyCloned(sampleRepos.ExampleRepo.path);\n        if (!cloned && !notified) {\n          notified = true;\n          balloonManager.showSticky({\n            title: \"Clone another repo\",\n            icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n            body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n            actions: (\n              <>\n                <BalloonActionLink\n                  onPress={() => {\n                    runTask(\n                      {\n                        title: `Cloning source repository ${sampleRepos.ExampleRepo.url}`,\n                      },\n                      {\n                        run: async ({\n                          setIndeterminate,\n                          setFraction,\n                          setSecondaryText,\n                        }) => {\n                          await cloneRepo({\n                            dir: sampleRepos.ExampleRepo.path,\n                            url: sampleRepos.ExampleRepo.url,\n                            onProgress: (progress) => {\n                              if (progress.total) {\n                                const fraction =\n                                  progress.loaded / progress.total;\n                                setFraction(fraction);\n                                setSecondaryText(\n                                  `${progress.phase}: ${Math.round(\n                                    fraction * 100\n                                  )}% ${progress.loaded}/${progress.total}`\n                                );\n                              } else {\n                                setSecondaryText(progress.phase);\n                                setIndeterminate(true);\n                              }\n                            },\n                          }).then(\n                            () => {\n                              refreshVcsRoots();\n                              refreshProjectFiles(); // FIXME: flashes the whole page\n                            },\n                            (e) => {\n                              balloonManager.show({\n                                icon: \"Error\",\n                                title: \"Clone failed\",\n                                body: `Failed to clone git repo \"${sampleRepos.ExampleRepo.url} into ${sampleRepos.ExampleRepo.path}: ${e}\"`,\n                              });\n                            }\n                          );\n                        },\n                      }\n                    );\n                  }}\n                >\n                  Clone example-repo\n                </BalloonActionLink>\n              </>\n            ),\n          });\n        }\n      },\n    []\n  );\n};\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  ActionTooltip,\n  Divider,\n  Item,\n  Link,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  PopupTrigger,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  StatusBar,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { activeFileRepoHeadState } from \"../VersionControl/active-file.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\nimport { firstTaskState, taskCountState, useCancelTask } from \"../tasks\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\n\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nconst StatusBarProcess = () => {\n  const firstTask = useRecoilValue(firstTaskState);\n  const tasksCount = useRecoilValue(taskCountState);\n  const cancel = useCancelTask();\n\n  return (\n    <>\n      {firstTask && (\n        <StatusBarProgress\n          name={firstTask.progress.text || firstTask.title}\n          isIndeterminate={firstTask.progress.isIndeterminate}\n          value={firstTask.progress.fraction}\n          maxValue={1}\n          button={\n            <>\n              {/*\n              {task.canPause && (\n                <ProgressBarPauseButton\n                  small\n                  paused={false}\n                  onPausedChange={() => {}}\n                />\n              )}\n              */}\n              {firstTask.isCancelable && (\n                <ProgressBarStopButton\n                  small\n                  onPress={() => cancel(firstTask.id)}\n                />\n              )}\n            </>\n          }\n        />\n      )}\n      {tasksCount > 1 && (\n        <>\n          <Spacer />\n          <Link onPress={notImplemented}>Show all ({tasksCount})</Link>\n        </>\n      )}\n    </>\n  );\n};\n\nexport const IdeStatusBar = () => {\n  const cursorPosition = useRecoilValue(editorCursorPositionState);\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarProcess />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <PopupTrigger\n            placement=\"top\"\n            onOpenChange={(isOpen) => {\n              if (!isOpen) {\n                setTimeout(maybeShowGitCloneTip, 500);\n              }\n            }}\n            popup={({ close }) => <BranchesPopup onClose={close} />}\n          >\n            <BranchPopupTrigger />\n          </PopupTrigger>\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n\nfunction BranchPopupTrigger() {\n  const gitRepoHead = useLatestRecoilValue(activeFileRepoHeadState);\n\n  return (\n    gitRepoHead && (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip\n            actionName={\n              gitRepoHead.detached\n                ? \"Git: Detached HEAD doesn't point to any branch\"\n                : `Git Branch: ${gitRepoHead.head}`\n            }\n          />\n        }\n      >\n        <StatusBarWidget\n          icon={\n            <PlatformIcon\n              icon={\n                gitRepoHead.detached ? \"general/warning.svg\" : \"vcs/branch.svg\"\n              }\n            />\n          }\n          label={gitRepoHead.head.slice(\n            0,\n            gitRepoHead.detached ? 8 : undefined\n          )}\n        />\n      </TooltipTrigger>\n    )\n  );\n}\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  IconButton,\n  IconButtonWithMenu,\n  ActionsProvider,\n  Toolbar,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n  ActionButton,\n} from \"@intellij-platform/core\";\n\nimport { changesTreeNodesState } from \"../ChangesView/ChangesView.state\";\nimport { getChangeListTreeItemProps } from \"../ChangesView/changesTreeNodeRenderers\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { allChangesState, useRollbackChanges } from \"../change-lists.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { groupings } from \"../ChangesView/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  AnyNode,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesView/change-view-nodes\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  line-height: 2;\n  padding-left: 0.5rem;\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useRecoilValue(\n    rollbackViewState.initiallyExpandedKeys\n  );\n  const initiallyIncludedChangeKeys = useRecoilValue(\n    rollbackViewState.initiallyIncludedChanges\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [windowBounds, setWindowBounds] = useRecoilState(\n    rollbackViewState.windowBounds\n  );\n  const rootNodes = useRecoilValue(rollbackViewState.rootNodes);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<AnyNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetRecoilState(rollbackViewState.isOpen);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              groupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      ref={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = getChangeListTreeItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \"0 .75rem\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox isDisabled>\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close}>Cancel</Button>\n                  <Button\n                    variant=\"default\"\n                    onPress={() => {\n                      rollbackChanges(includedChanges)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"recoil\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsState = atom({\n  key: \"toolWindows\",\n  default: new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    )\n  ),\n});\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom, atomFamily } from \"recoil\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom({\n    key: \"search.everywhere.isOpen\",\n    default: false,\n  }),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>({\n    key: \"search.everywhere.tab\",\n    default: \"All\",\n  }),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element>({\n    key: \"search.everywhere.contextElement\",\n    default: undefined,\n  }),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily<string, string>({\n    key: \"search.everywhere.initialQuery\",\n    default: \"\",\n  }),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>({\n    key: \"search.everywhere.bounds\",\n    default: null,\n  }),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { RecoilState, useSetRecoilState } from \"recoil\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsState,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of a recoil state.\n   */\n  persistedBoundsState: RecoilState<Partial<Bounds> | null>;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetRecoilState(persistedBoundsState);\n  const getInitBounds = useRecoilInitialValue(persistedBoundsState, {\n    top: 150,\n    height: Math.max(200, window.innerHeight - 300),\n  });\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(getInitBounds);\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 1.125rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useRecoilValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = path.basename(file.relativePath);\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback } from \"recoil\";\nimport {\n  currentProjectFilesState,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const getProjectFiles = useRecoilCallback(\n      ({ snapshot }) =>\n        () =>\n          snapshot.getLoadable(currentProjectFilesState).getValue(),\n      []\n    );\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        getProjectFiles()\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useCollectionSearchInput,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetRecoilState(searchEverywhereState.isOpen);\n  const [tab, setTab] = useRecoilState(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useRecoilInitialValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetRecoilState(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const collectionRef = useRef<HTMLUListElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const { collectionSearchInputProps } = useCollectionSearchInput({\n    collectionRef,\n    selectionManager: selectionManagerRef.current,\n  });\n\n  const tips = useTips();\n\n  return (\n    <ContentAwarePopup\n      persistedBoundsState={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        {...collectionSearchInputProps}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        ref={collectionRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        alwaysShowAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={(key) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            setSearchResultLimit(\n                              (limit) => limit + SEARCH_RESULT_LIMIT\n                            );\n                            const nextItem =\n                              searchResult[visibleSearchResult.length + 1];\n                            if (nextItem) {\n                              // nextItem is expected to always have value\n\n                              // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n                              // if we want to avoid setTimeout\n                              setTimeout(() => {\n                                setSelectedKeys(new Set([nextItem.key]));\n                                selectionManagerRef.current?.setFocusedKey(\n                                  nextItem.key\n                                );\n                              });\n                            }\n                          } else {\n                            close();\n                            // Making sure the popup is fully closed before the new action is performed. One edge case that can\n                            // make a difference is actions like FindAction that open the same popup. By performing an action\n                            // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n                            // won't get any feedback when choosing such actions.\n                            setTimeout(() => {\n                              const itemWrapper = searchResult.find(\n                                (item) => item.key === key\n                              );\n                              itemWrapper?.contributor.processSelectedItem(\n                                itemWrapper.item\n                              );\n                              /**\n                               * The 50ms timeout is a workaround for an issue in FocusScope:\n                               * restoreFocus only works if the previously focused element is in the dom, when the focus\n                               * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n                               * window, which has a focus scope, when the window is opened, the currently focused\n                               * element (which will be the one to restore focus to), is search everywhere dialog, which\n                               * is immediately closed. So when the modal window is closed, it tries to move focus back\n                               * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n                               * track a chain of nodes to restore focus to.\n                               * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n                               * is closed, and then the actions is performed, for focus restoration to work.\n                               */\n                            }, 50);\n                          }\n                        }}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          return (\n                            <Item\n                              key={key}\n                              textValue={contributor.getItemText(item)}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import { useRecoilCallback } from \"recoil\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core\";\n\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useRecoilCallback(\n    ({ set }) =>\n      ({ element }: ActionContext, tab: string) => {\n        if (element) {\n          set(searchEverywhereState.isOpen, true);\n          set(searchEverywhereState.tab, tab);\n          set(searchEverywhereState.contextElement, element);\n        }\n      },\n    []\n  );\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changeListsUnderSelection,\n  changesTreeNodesState,\n  changesUnderSelectedKeys,\n  expandedKeysState,\n  includedChangeKeysState,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysState,\n} from \"./ChangesView/ChangesView.state\";\nimport {\n  allChangesState,\n  useRefreshChanges,\n  useSetActiveChangeList,\n} from \"./change-lists.state\";\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsState,\n  currentProjectFilesState,\n} from \"../../Project/project.state\";\nimport path from \"path\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport {\n  AnyNode,\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"./ChangesView/change-view-nodes\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useRecoilCallback(\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  const refresh = useRefreshChanges();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useRecoilCallback(queueCheckInCallback, []);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useRecoilValue(activePathsState);\n  const projectFiles = useRecoilValue(currentProjectFilesState);\n  const roots = activePaths.filter(\n    (path) =>\n      !activePaths.find(\n        (activePath) => path !== activePath && path.startsWith(activePath)\n      )\n  );\n\n  const isDir = projectFiles.find(\n    (item) => path.dirname(item.path).startsWith(roots[0]) // This is not quite accurate!\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, change.after.path))\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: isDir\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useRecoilCallback(\n    ({ snapshot, set }) =>\n      () => {\n        const includedChangesKeys = snapshot\n          .getLoadable(includedChangeKeysState)\n          .getValue();\n        let keyToSelect = includedChangesKeys.values().next().value;\n        if (includedChangesKeys.size === 0) {\n          const allKeys = snapshot\n            .getLoadable(allChangesState)\n            .getValue()\n            .map(getNodeKeyForChange);\n          set(includedChangeKeysState, new Set(allKeys));\n          keyToSelect = allKeys[0];\n        }\n        if (keyToSelect) {\n          const { rootNodes } = snapshot\n            .getLoadable(changesTreeNodesState)\n            .getValue();\n          set(\n            expandedKeysState,\n            new Set([\n              ...snapshot.getLoadable(expandedKeysState).getValue(),\n              ...getExpandedToNodesKeys(\n                (node) => (isGroupNode(node) ? node.children : null),\n                (node) => node.key,\n                rootNodes as AnyNode[],\n                [keyToSelect]\n              ),\n            ])\n          );\n          set(selectedKeysState, new Set([keyToSelect]));\n        }\n      },\n    []\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        if (!change.after.isDir) {\n          editorStateManager.openPath(\n            change.after.path,\n            index === arr.length - 1\n          );\n        }\n      });\n    },\n  };\n}\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChangeLists = useRecoilValue(changeListsUnderSelection);\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  if (selectedChanges.size > 0) {\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { activeFileRepoBranchesState } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport { Errors } from \"isomorphic-git\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useRecoilValue(activeFileRepoBranchesState);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"invalid\" : \"valid\";\n\n  const create = () => {\n    if (isValid) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              errorMessage={\n                validationState === \"invalid\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"invalid\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n\n  return [\n    ...useChangesViewActionDefinitions(),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup onClose={close} />);\n      },\n    },\n  ];\n}\n","import {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { useEffect, useRef } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { RecoilSync } from \"recoil-sync\";\n\nimport { fs } from \"../../fs/fs\";\nimport { ensureDir } from \"../../fs/fs-utils\";\nimport { currentProjectState } from \"../project.state\";\nimport { StorageFiles } from \"./persistentAtomEffect\";\n\ntype ComponentState = { [key: string]: unknown; \"@name\": string };\ntype WorkspaceState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\n\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\n\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nasync function readWorkspace(\n  storageFile: string\n): Promise<null | WorkspaceState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const workspaceFileExists = await fs.promises.exists(storageFile);\n  if (!workspaceFileExists) {\n    return null;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = xmlParser.parse(xmlData);\n  workspace.project = workspace.project || {};\n  workspace.project.component = workspace.project.component || {\n    component: [],\n  };\n  return workspace;\n}\nasync function writeWorkspace(\n  storageFile: string,\n  workspaceState: WorkspaceState\n): Promise<void> {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n\n  const xmlString = xmlBuilder.build(workspaceState);\n  await ensureDir(fs.promises, path.dirname(storageFile));\n  await fs.promises.writeFile(storageFile, xmlString);\n}\n\nconst storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n\nexport function PersistentStateProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const containerDirectory = path.join(\n    useRecoilValue(currentProjectState).path,\n    \".idea\"\n  );\n  const workspacePromiseRef = useRef<{\n    [key: string]: Promise<WorkspaceState | null>;\n  }>({});\n\n  const resolveStorageFile = (storageFile: string) =>\n    path.join(\n      containerDirectory,\n      storageFileMapping[storageFile] || storageFile\n    );\n\n  const getWorkspace = (storageFile: string) => {\n    // FIXME: caching the first read can cause issues when multiple writes happen, where they override each other.\n    const resolvedStorageFile = resolveStorageFile(storageFile);\n    if (!workspacePromiseRef.current[resolvedStorageFile]) {\n      workspacePromiseRef.current[resolvedStorageFile] =\n        readWorkspace(resolvedStorageFile);\n    }\n    return workspacePromiseRef.current[resolvedStorageFile];\n  };\n\n  // preload common storage files\n  useEffect(() => {\n    getWorkspace(StorageFiles.WORKSPACE_FILE);\n  }, []);\n\n  return (\n    <RecoilSync\n      storeKey=\"ProjectWorkspace\"\n      read={async (key: string) => {\n        const [storageFile, componentName] = key.split(\"|\");\n        const workspace = await getWorkspace(storageFile);\n        return workspace?.project.component.find(\n          ({ \"@name\": name }) => name === componentName\n        );\n      }}\n      write={async ({ diff }) => {\n        const changesByFile = groupBy(\n          ({ storageFile }) => storageFile,\n          [...diff.entries()].map(([key, value]) => {\n            const [storageFile, componentName] = key.split(\"|\");\n            return {\n              storageFile,\n              componentName,\n              value,\n            };\n          })\n        );\n\n        for (const storageFile in changesByFile) {\n          const changes = changesByFile[storageFile];\n          const workspace: WorkspaceState = (await readWorkspace(\n            storageFile\n          )) || {\n            \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n            project: { \"@version\": \"4\", component: [] },\n          };\n          for (const { value, componentName } of changes) {\n            const components = workspace.project.component;\n            const index = components.findIndex(\n              ({ \"@name\": name }) => name === componentName\n            );\n            const componentState =\n              typeof value === \"function\"\n                ? value(components[index] || null)\n                : (value as object);\n            components.splice(index, index >= 0 ? 1 : 0, {\n              \"@name\": componentName,\n              ...componentState,\n            });\n          }\n          await writeWorkspace(resolveStorageFile(storageFile), workspace);\n        }\n      }}\n    >\n      {children}\n    </RecoilSync>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + num / 20 + 1;\n}\n","import React, { CSSProperties, RefObject } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useBalloonManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { useInitializeVcs } from \"../VersionControl/file-status.state\";\nimport { toolWindows } from \"./toolWindows\";\nimport { useInitializeChanges } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsState } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { PersistentStateProvider } from \"./persistence/PersistentStateProvider\";\nimport { useTestActions } from \"../testActions/useTestActions\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({\n  height,\n  toolWindowRef,\n}: {\n  height: CSSProperties[\"height\"];\n  toolWindowRef: RefObject<ToolWindowRefValue>;\n}) => {\n  const [state, setState] = useRecoilState(toolWindowsState);\n  const isRollbackWindowOpen = useRecoilValue(rollbackViewState.isOpen);\n  const isSearchEveryWhereOpen = useRecoilValue(searchEverywhereState.isOpen);\n\n  useInitializeVcs();\n  useInitializeChanges();\n  usePersistenceFsNotification();\n  _balloonManagerRef.value = useBalloonManager();\n\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n\n  return (\n    <PersistentStateProvider>\n      <StyledWindowFrame style={{ height }}>\n        <ActionsProvider\n          actions={allActions}\n          useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n        >\n          {({ shortcutHandlerProps }) => (\n            <>\n              <DefaultToolWindows\n                ref={toolWindowRef}\n                toolWindowsState={state}\n                onToolWindowStateChange={(newState) => {\n                  setState(newState);\n                }}\n                windows={toolWindows}\n                containerProps={shortcutHandlerProps}\n              >\n                <FileEditor />\n              </DefaultToolWindows>\n              <IdeStatusBar />\n            </>\n          )}\n        </ActionsProvider>\n\n        {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n        {isRollbackWindowOpen && <RollbackWindow />}\n      </StyledWindowFrame>\n    </PersistentStateProvider>\n  );\n};\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport interface ProcessState {\n  state:\n    | \"STARTED\"\n    | \"PAUSED\"\n    | \"PAUSING\"\n    | \"CANCELED\"\n    | \"CANCELING\"\n    | \"FINISHED\";\n  /**\n   * between 1 and 100\n   */\n  progress: number;\n  isIndeterminate: boolean;\n  name: string;\n  details: string;\n  onCancel?: () => void;\n  onPause?: () => void;\n}\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n};\n","import React, { CSSProperties, useRef } from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  BalloonManager,\n  KeymapProvider,\n  PopupManager,\n  ToolWindowRefValue,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { SampleRepoInitializer } from \"./SampleRepoInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport { ToolWindowsRefContext } from \"./Project/useToolWindowManager\";\nimport * as path from \"path\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({ height }: { height?: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <SampleRepoInitializer>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <RecoilRoot>\n              <BalloonManager disablePortal>\n                <WindowManager>\n                  <PopupManager>\n                    {/* disablePortal to make example app more portable*/}\n                    <ToolWindowsRefContext.Provider value={toolWindowRef}>\n                      <Project height={height} toolWindowRef={toolWindowRef} />\n                    </ToolWindowsRefContext.Provider>\n                  </PopupManager>\n                </WindowManager>\n              </BalloonManager>\n            </RecoilRoot>\n          </KeymapProvider>\n        </SampleRepoInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n"],"names":["LoadingGif","props","Img","src","darkSrc","Loading","styled","DefaultSuspense","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","darculaColorSchemeTokenRules","vsCodeTheme","scope","settings","flatMap","map","token","values","Object","keys","forEach","key","value","StyledEditor","MonacoEditor","Editor","editorTheme","monaco","useMonaco","theme","useTheme","themeName","setThemeName","useState","dark","useLayoutEffect","name","replace","editor","defineTheme","base","inherit","colors","rules","useEditorTheme","options","minimap","enabled","lineHeight","showFoldingControls","renderIndentGuides","overviewRulerBorder","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","persistentFsPreference","get","localStorage","getItem","set","setItem","switchToPersistentFS","log","getRootFS","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","read","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentState","selectorFamily","fileNames","all","fileName","type","size","reloadFileFromDiskCallback","fetchFileContent","fileContent","encoding","atomFamily","default","effects","onSet","error","filterPath","includes","useLatestRecoilValue","recoilValue","state","setState","loadable","useRecoilValueLoadable","useEffect","contents","useRecoilInitialValue","recoilState","defaultValue","useRecoilCallback","snapshot","getLoadable","getValue","sampleRepos","JUI","url","Recoil","ExampleRepo","sampleRepo","currentProjectState","atom","projectFilePath","projectRelativePath","currentProjectFilesState","selector","project","projectFilesState","projectPath","files","addItem","item","childItems","push","relativePath","activePathsState","useActivePathsProvider","nullValue","setValue","useSetRecoilState","isFocusedRef","useRef","current","currentValue","equals","onFocus","onBlur","relatedTarget","Element","closest","temporaryTabsDefaultValue","sortWith","descend","file","endsWith","filter","slice","editorState","cursorPos","lineNumber","column","editorTabsState","activeEditorTabIndexState","activeEditorTabState","tabs","editorCursorPositionState","Position","editorRefState","useEditorStateManager","tabsState","setTabsState","useRecoilState","setActiveTabIndex","focus","valueOrThrow","select","index","closeTab","_","tabIndex","openPath","shouldFocus","findIndex","tab","newIndex","length","currentState","setTimeout","closePath","Math","max","closeOthersTabs","convertGitStatus","Array","isArray","asyncFilter","predicate","array","predicateResult","temporaryVcsMappingsDefaultState","dir","Boolean","vcs","vcsRootsState","vcsRootForFile","findRoot","fileStatusState","useUpdateFileStatus","repoRoot","getPromise","fileStatus","useUpdateVcsFileStatuses","transact_UNSTABLE","vcsDirectoryMappings","rows","statusMatrix","row","useStatusColor","FileStatusColor","color","useRecoilValue","useFileStatusColor","style","StatusColor","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","FileEditor","editorStateManager","activeTab","editorRef","active","setActive","hideAllAction","useAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","tabActionsRef","useLatest","setEditorRef","fileContentState","contentLoadable","setContent","updateFileStatus","setPosition","activePathsProviderProps","valueMaybe","StyledFileEditorContainer","mergeProps","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","PlatformIcon","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","onMount","monacoEditor","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","getPosition","onChange","newContent","FileEditorLoading","isUnderDarcula","commonColors","panelBackground","StyledXterm","XTerm","Terminal","input","setInput","xtermRef","useMemo","background","selection","fontFamily","letterSpacing","fontSize","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","write","ref","onData","data","charCodeAt","foldersOnTopState","expandedKeysState","Set","selectedKeysState","projectViewTreeRefState","React","dangerouslyAllowMutability","currentProjectTreeState","rootItems","mapItem","parent","node","dirNode","notNull","createProjectTree","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","ProjectViewPane","setProjectViewTreeRef","projectTree","setExpandedKeys","selectedKeys","setSelectedKeys","sortItems","sortBy","a","identity","selectedKeysArray","i","SpeedSearchTree","fillAvailableSpace","autoFocus","selectionMode","onExpandedChange","undefined","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","selectPathInProjectView","selectOpenedFile","id","actionPerformed","isDisabled","description","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","actionId","CommonActionId","changeListsState","comment","changes","allChangesState","find","changeList","changeLists","flat","isAChange","head","workingDir","stage","refreshChangesCallback","gitRoots","root","pathname","theRest","workdir","after","isDir","before","useRefreshChanges","changeBrowserNodeKey","getNodeKeyForChange","change","changeListNode","groupFn","changeNode","directoryNode","parentNodePath","isGroupNode","isChangeNode","isDirectoryNode","getChildren","groupings","isAvailable","nodes","repository","repositoryNode","startsWith","constSelector","pathToNodeCache","rootDirNodes","reduce","prevNode","collapseDirectories","child","uniq","isOpen","windowBounds","initiallyIncludedChanges","rootNodes","selectedChanges","changesTreeNodesState","some","rollbackViewState","initiallyExpandedKeys","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","showIgnoredFilesState","showRelatedFilesState","changesGroupingState","resolvedSelectedKeysState","bfsVisit","parentValue","selectedNodesState","byKey","changesUnderSelectedKeys","selectedNodes","allChanges","processNode","add","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysState","includedChangesState","includedChangeKeys","has","includedChangesNestedSelection","getCallback","NestedSelection","createSetInterface","getKey","availableGroupingsState","grouping","isRecoilValue","isActive","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","groupFns","groupChanges","fileCountsMap","Map","dfsVisit","childrenFileCount","fileCount","total","count","commitMessageSizeState","orientation","amendCommitState","commitMessageState","commitErrorMessageState","commitTaskIdState","changesFromActivePaths","activePaths","activePath","queueCheckInCallback","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","contextual","changesUnderSelection","changesBasedOnActivePaths","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","ChangesViewTreeContextMenu","ActionsMenu","DividerItem","StyledRepoColorSquare","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","Color","withTransparency","toString","currentForegroundAware","getTrackingBranch","localBranchName","mergeRef","git","remote","StorageFiles","persistentAtomEffect","componentName","refine","update","storageFile","WORKSPACE_FILE","itemKey","join","syncEffect","storeKey","syncDefault","readComponentState","DefaultValue","repoLocalBranchesState","branches","branch","trackingBranch","repoRemoteBranchesState","remotes","repoBranchesState","currentBranchName","repoCurrentBranchNameState","localBranches","currentBranch","remoteBranches","fullname","allBranchesState","branchForPathState","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","maybeArray","readBranchStorage","branchStorage","entry","list","toBranchStorage","branchesByType","groupBy","entries","branchInfoArrayChecker","object","union","literal","string","favoriteBranchesState","gitSettings","excludedFromFavoriteBranchesState","isPredefinedAsFavorite","isFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","fileCountMsg","IntlMessageFormat","ChangeNodeHint","isGroupedByDirectory","nodeRenderers","rendered","format","directory","changelist","fontWeight","getChangeListTreeItemProps","nodeRenderer","dirCount","hasChildItems","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","selectionState","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","menuProps","GroupByActionButton","availableGroupings","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","hasBorder","tasksState","firstTaskState","taskCountState","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","updates","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","finally","onFinished","commitSuccessfulMessage","useCommitChanges","refreshChanges","refreshFileStatus","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","oid","tree","blob","mode","newTreeOid","commitRef","commitFiles","message","author","email","part","StyledCommitMessageContainer","StyledCommitMessageTextArea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","commit","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","event","placeholder","Button","preventFocusOnPress","variant","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","Checkbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","amend","setAmend","ActionHelpTooltip","helpText","preventFocus","IconButton","StyledContainer","StyledTreeViewWrapper","focusCommitMessage","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","commitMessageSize","setCommitMessageSize","treeActions","ThreeViewSplitter","innerView","ActionsProvider","shortcutHandlerProps","innerViewMinSize","lastView","lastSize","onLastResize","ChangesViewPane","refresh","COMMIT_TOOLWINDOW_ID","changesBranchesState","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","tabContent","ChangesBranches","mapping","UNSAFE_FocusRestoringSuspense","focusedElement","document","activeElement","HTMLElement","isConnected","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","validateBranchName","newBranchName","remoteBranch","ILLEGAL_CHARS_PATTERN","RegExp","fill","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","close","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","ModalWindow","minWidth","minHeight","WindowLayout","header","onSubmit","preventDefault","labelPlacement","label","newValue","footer","right","form","StyledMenuIconButton","role","BranchFavoriteButton","onClick","isCurrent","onPointerUp","stopPropagation","AutoHoverPlatformIcon","hoverIcon","hoverContainerSelector","StyledHeader","StyledTitle","branchesPopupSizeState","BranchesPopup","onClose","repoBranches","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","windowManager","useWindowManager","checkoutBranch","callbackInterface","reloadFileFromDisk","checkout","openedFiles","existingOpenedFile","Popup","interactions","bounds","onBoundsChange","interactionType","width","PopupLayout","hasControls","currentBounds","SpeedSearchMenu","submenuBehavior","disabledKeys","operation","tryCheckout","Errors","Balloon","open","aRepoRoot","checkoutRemoteBranch","getSectionLabel","compareActions","Divider","mergeActions","favoriteBranchArgs","shortcut","small","activeFileRepoRootState","activeFile","activeFileRepoBranchesState","activeFileRepoRoot","activeFileCurrentBranchState","activeFileRepoHeadState","detached","resolveRef","StyledDialog","WINDOW_SHADOW","StyledDialogHeader","StyledDialogContent","isSuccessfullyCloned","info","SampleRepoInitializer","repoUrl","cloneRepo","onProgress","clone","http","corsProxy","singleBranch","notified","useShowGitTipIfNeeded","refreshProjectFiles","useRecoilRefresher_UNSTABLE","refreshVcsRoots","refreshTemporaryVcsMappingsDefault","useResetRecoilState","useRefreshVcsRoots","reset","showSticky","loaded","phase","round","StyledLastMessage","StatusBarProgress","ProgressBar","dense","namePosition","Spacer","StatusBarProcess","firstTask","tasksCount","cancel","abort","maxValue","button","ProgressBarStopButton","IdeStatusBar","cursorPosition","maybeShowGitCloneTip","StatusBar","left","StatusBarWidget","MenuTrigger","PopupTrigger","placement","onOpenChange","popup","BranchPopupTrigger","gitRepoHead","RollbackTreeContextMenu","StyledFrame","contrastBorder","StyledLine","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","changesWithRepoRoots","groupedChanges","filepaths","resetIndex","useRollbackChanges","balloons","setOpen","display","flex","padding","flexDirection","toolWindowsState","ToolWindowsState","fromEntries","tips","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsState","noContentHeight","otherProps","persistBounds","getInitBounds","top","innerHeight","setBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","inactiveTextColor","StyledSpacer","ActionItem","action","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","unshift","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","search","query","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","element","getItemText","renderItem","FileItem","matches","dirMatches","filenameMatches","splitWhen","match","from","titleMatches","to","filesSearchContributor","getProjectFiles","SearchEverywhereActionIds","StyledTab","selected","disabled","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","getShortcut","useGetActionShortcut","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","selectionManagerRef","setFocusedKey","requestAnimationFrame","localActions","currentContributorIndex","contributorActions","collectionRef","collectionSearchInputProps","useCollectionSearchInput","selectionManager","Tabs","TabComponent","TabsComponent","Tooltip","margin","contain","newPattern","newPatternContainsPrevious","onPatternChanged","currentTarget","List","alwaysShowAsFocused","shouldFocusWrap","limit","nextItem","itemWrapper","useProjectActions","openSearchEverywhere","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","projectFiles","roots","containsChange","relative","isPathInside","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","deleteChangeListMsg","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","autoSelect","useVcsActions","popupManager","usePopupManager","WORKSPACE_XML_PARSE_OPTIONS","attributeNamePrefix","ignoreAttributes","tagName","jPath","WORKSPACE_XML_BUILD_OPTIONS","readWorkspace","xmlParser","XMLParser","xmlData","workspace","parse","component","writeWorkspace","workspaceState","xmlString","XMLBuilder","build","storageFileMapping","PersistentStateProvider","containerDirectory","workspacePromiseRef","resolveStorageFile","getWorkspace","resolvedStorageFile","diff","changesByFile","components","componentState","splice","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","updateVcsFileStatuses","useInitializeVcs","useInitializeChanges","timeoutId","clearTimeout","usePersistenceFsNotification","useCapture","DefaultToolWindows","onToolWindowStateChange","newState","windows","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateTerminalWindow","App","KeymapProvider","BalloonManager","disablePortal","WindowManager","PopupManager","Provider"],"sourceRoot":""}