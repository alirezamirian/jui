{"version":3,"file":"258.561a9d74.iframe.bundle.js","mappings":";;;;AAgDA","sources":["webpack://@intellij-platform/core/./src/Menu/MenuOverlayFromOrigin.tsx"],"sourcesContent":["import React, { ForwardedRef, useEffect, useMemo } from \"react\";\nimport {\n  MenuOverlay,\n  MenuOverlayProps,\n} from \"@intellij-platform/core/Menu/MenuOverlay\";\nimport { useOverlayPositionFromOrigin } from \"@intellij-platform/core/Menu/useOverlayPositionFromOrigin\";\nimport { getScrollParent, isScrollable, useObjectRef } from \"@react-aria/utils\";\nimport { createGlobalStyle } from \"styled-components\";\n\ninterface MenuOverlayFromOriginProps\n  extends Pick<MenuOverlayProps, \"onClose\" | \"defaultAutoFocus\"> {\n  /**\n   * Origin point within the viewport, based on which the menu overlay should be positioned.\n   * Any pointer/mouse event, or a plain object with clientX and clientY can be passed.\n   */\n  origin:\n    | {\n        /**\n         * Horizontal coordinate of the origin point within the viewport.\n         * See {@link MouseEvent.clientX}\n         */\n        clientX: number;\n        /**\n         * Vertical coordinate of the origin point within the viewport.\n         * See {@link MouseEvent.clientX}\n         */\n        clientY: number;\n\n        /**\n         * Origin's target element.\n         * Used to find the scrollable parent and disable scrolling while\n         * the overlay is rendered.\n         */\n        target?: EventTarget | HTMLElement | null;\n      }\n    | undefined;\n  children: React.ReactNode;\n}\n\nconst DisableScrollStyles = createGlobalStyle`\n  .disable-scroll {\n      overflow: hidden !important;\n  }\n`;\n\n/**\n * Menu overlay position based on an origin point on the screen.\n * Useful when the menu is opened by a pointer event.\n */\nexport const MenuOverlayFromOrigin = React.forwardRef(\n  function MenuOverlayFromOrigin(\n    { children, origin, ...otherProps }: MenuOverlayFromOriginProps,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) {\n    const overlayRef = useObjectRef(forwardedRef);\n    const { positionProps } = useOverlayPositionFromOrigin({\n      overlayRef,\n      origin,\n      containerPadding: { x: 0, y: 4 },\n    });\n\n    const scrollParent: null | Element = useMemo(() => {\n      if (!(origin?.target instanceof HTMLElement)) {\n        return null;\n      }\n      return isScrollable(origin.target)\n        ? origin.target\n        : getScrollParent(origin.target);\n    }, [origin?.target]);\n\n    useEffect(() => {\n      // Known issue: closing contextmenu causes a jump in scroll (see project view in example app)\n      // It's an issue that existed before the change to disable scroll when the contextmenu is open,\n      // so it should not have anythign to do with changing overflow hidden when the menu is open.\n      scrollParent?.classList?.add(\"disable-scroll\");\n      return () => {\n        scrollParent?.classList?.remove(\"disable-scroll\");\n      };\n    }, []);\n\n    return (\n      <>\n        <DisableScrollStyles />\n        {Boolean(origin) && (\n          <MenuOverlay\n            overlayProps={positionProps}\n            overlayRef={overlayRef}\n            restoreFocus\n            {...otherProps}\n          >\n            {children}\n          </MenuOverlay>\n        )}\n      </>\n    );\n  }\n);\n"],"names":[],"sourceRoot":""}