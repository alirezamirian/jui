{"version":3,"file":"assets/js/2892.57d9c84d.js","mappings":"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","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/atom-utils/atomWithRefresh.ts","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/atom-utils/focus-based-atom-utils.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/atom-utils/useStableSetAtom.ts","webpack://website/../example-app/src/persistence/atomWithPersistence.ts","webpack://website/../example-app/src/persistence/schema-utils.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/EditorZeroState.tsx","webpack://website/../example-app/src/appActionIds.ts","webpack://website/../example-app/src/Editor/editorActionIds.ts","webpack://website/../example-app/src/Editor/useEditorActionGroup.tsx","webpack://website/../example-app/src/atom-utils/atomWithGetCallback.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/atom-utils/unwrapLatestWithLoading.ts","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/Project/projectActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectViewContextMenu.tsx","webpack://website/../example-app/src/atom-utils/unwrapLatest.ts","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/HelpButton.tsx","webpack://website/../example-app/src/path-utils.ts","webpack://website/../example-app/src/Project/fs-operations.ts","webpack://website/../example-app/src/atom-utils/isAtom.ts","webpack://website/../example-app/src/actionAtom.ts","webpack://website/../example-app/src/ProjectView/actions/deleteAction.tsx","webpack://website/../example-app/src/ProjectView/actions/copyAction.tsx","webpack://website/../example-app/src/ProjectView/actions/cutAction.tsx","webpack://website/../example-app/src/ProjectView/actions/pasteAction.tsx","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/Delayed.tsx","webpack://website/../example-app/src/VersionControl/Changes/Change.ts","webpack://website/../example-app/src/VersionControl/Changes/changes.state.ts","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/tree-utils/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/ChangeTreeNode.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodesResult.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesViewTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/refs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DateRange.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/vcs-logs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/readCommits.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useChangesViewActions.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewZeroState.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/TrackingBranchInfo.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/styled-components.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/commit-utils.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/commitChangesTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/getCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/Changes/detectRenames.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/RefLabel.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/CommitDetails.tsx","webpack://website/../example-app/src/useRedefineAction.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/VcsLogDetailsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogDropdown.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/BranchesFilterDropdown.tsx","webpack://website/../example-app/src/VersionControl/git-users.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableRow.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableViewOptionsMenuIconButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogCommitsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/branchTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/VcsBranchesView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/useCommitsTableActions.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindowZeroState.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.state.ts","webpack://website/../example-app/src/StatusBar/TasksPopup.tsx","webpack://website/../example-app/src/StatusBar/StatusBarTaskProgressBar.tsx","webpack://website/../example-app/src/atom-utils/latestDefinedValue.ts","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/BranchPopupTrigger.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/VersionControl/gitAddCallback.tsx","webpack://website/../example-app/src/Project/actions/NewItemPopup.tsx","webpack://website/../example-app/src/Project/actions/createFileAction.tsx","webpack://website/../example-app/src/useCancelableAsyncCallback.ts","webpack://website/../example-app/src/Project/actions/createDirectoryAction.tsx","webpack://website/../example-app/src/Project/actions/copyFilename.tsx","webpack://website/../example-app/src/Project/actions/copyAbsolutePath.tsx","webpack://website/../example-app/src/VersionControl/actions/copyPathFromRepositoryRoot.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/actions/gitAddAction.tsx","webpack://website/../example-app/src/VersionControl/actions/gitInitAction.tsx","webpack://website/../example-app/src/VersionControl/gitRememberedInputs.state.ts","webpack://website/../example-app/src/ProjectInitializer.tsx","webpack://website/../example-app/src/VersionControl/actions/getInputCursorOffset.ts","webpack://website/../example-app/src/VersionControl/actions/PathInputField.tsx","webpack://website/../example-app/src/VersionControl/actions/gitCloneAction.tsx","webpack://website/../example-app/src/VersionControl/useClone.ts","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx","webpack://website/../../node_modules/monaco-editor/esm/vs/base/common/worker/ lazy ^.*$ namespace object","webpack://website/../../node_modules/monaco-editor/esm/vs/editor/common/services/ lazy ^.*$ namespace object"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { atom, type WritableAtom } from \"jotai\";\n\ntype Read<Value, Args extends unknown[], Result> = WritableAtom<\n  Value,\n  Args,\n  Result\n>[\"read\"];\ntype Write<Value, Args extends unknown[], Result> = WritableAtom<\n  Value,\n  Args,\n  Result\n>[\"write\"];\n\n/**\n * A mapping from atom values to their refreshable atom dependencies used to recursively refresh\n * upstream atoms when refreshing an atom.\n */\nconst refreshDepsMap = new WeakMap<{}, Set<WritableAtom<unknown, [], void>>>();\n/**\n * The set of refreshable atoms, used to recognize refreshable dependencies of each refreshable atom.\n */\nconst refreshableAtoms = new WeakSet();\n\n/**\n * Similar to {@link https://jotai.org/docs/utilities/resettable#atomwithrefresh atomWithRefresh}\n * but acting like recoil's selector refresh functionality.\n * In recoil refreshing a selector not only refreshes selectors that depend on it but also\n * all upstream dependencies (i.e., selectors used within the refreshed selector).\n *\n * @see https://github.com/facebookexperimental/Recoil/issues/1677\n */\nexport function atomWithRefresh<Value, Args extends unknown[], Result>(\n  read: Read<Value, Args, Result>,\n  write: Write<Value, Args, Result>\n): WritableAtom<Value, Args | [], Result | void>;\n\nexport function atomWithRefresh<Value>(\n  read: Read<Value, [], void>\n): WritableAtom<Value, [], void>;\n\nexport function atomWithRefresh<Value, Args extends unknown[], Result>(\n  read: Read<Value, Args, Result>,\n  write?: Write<Value, Args, Result>\n) {\n  const refreshAtom = atom(0);\n  const refreshableAtom = atom(\n    (get, options) => {\n      get(refreshAtom);\n      const deps = new Set<WritableAtom<unknown, [], void>>();\n\n      const value = read((...args) => {\n        const atom = args[0];\n        if (refreshableAtoms.has(atom)) {\n          deps.add(atom as WritableAtom<unknown, [], void>);\n        }\n        return get(...args);\n      }, options as never);\n      refreshDepsMap.set(value, deps);\n      return value;\n    },\n    (get, set, ...args: Args) => {\n      if (args.length === 0) {\n        const currentValue = get(refreshableAtom);\n        for (const dep of refreshDepsMap.get(currentValue) ?? []) {\n          set(dep); // refreshing refreshable dependencies first\n        }\n        set(refreshAtom, (c) => c + 1);\n      } else if (write) {\n        return write(get, set, ...args);\n      }\n    }\n  );\n  refreshableAtoms.add(refreshableAtom);\n  return refreshableAtom;\n}\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\nimport { BFSCallback } from \"browserfs/dist/node/core/file_system\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { fs } from \"./fs\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\n/**\n * Similar to `fs.mkdir(dirPath, {recursive: true})`. `recursive` is not supported in the\n * currently used fs implementations.\n */\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n\n/**\n * A wrapper around stat which doesn't throw if nothing exists at the input pathname.\n * It provides a more ergonomic signature for use cases where it's required to know if\n * a file or directory exists on the pathname, distinguishing the two cases.\n */\nexport const stat = (pathname: string) =>\n  fs.promises.stat(pathname).catch(() => null);\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (\n  persistentFsPreference.get() === \"yes\"\n    ? createIndexedDBFS()\n    : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC<{ children?: React.ReactNode }> = ({\n  children,\n}) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import { basename } from \"path\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\nimport { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, atomWithLazy } from \"jotai/utils\";\nimport { atomWithRefresh } from \"../atom-utils/atomWithRefresh\";\nimport { fs } from \"./fs\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  name: string;\n  path: string;\n  lastModification: number;\n  size: number;\n}\n\nconst getDirContent = async (path: string): Promise<null | FsItem[]> => {\n  let fileNames: string[];\n  try {\n    fileNames = await fs.promises.readdir(path);\n  } catch (e) {\n    return null;\n  }\n  const stats = await Promise.all(\n    fileNames.map((fileName) => {\n      const filePath = `${path}/${fileName}`;\n      return fs.promises.stat(filePath).then((stat: Stats) => ({\n        ...stat,\n        type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n        filePath,\n      }));\n    })\n  );\n  return stats.map((stat) => ({\n    type: stat.type,\n    name: basename(stat.filePath),\n    path: stat.filePath,\n    lastModification: stat.mtimeMs,\n    size: stat.size,\n  }));\n};\n\n/**\n * List files and directories in a given directory.\n */\nexport const dirContentAtom = atomFamily((path: string) => {\n  const atom = atomWithRefresh(() => {\n    return getDirContent(path);\n  });\n  atom.debugLabel = `DirContent(${path})`;\n  return atom;\n});\n\n/**\n * atom callback to refresh the file content atom value of a give path.\n * The callback returns `true` the file exists, and content is refreshed successfully, and `false otherwise.\n * @deprecated use set(fileContent(path)) directly\n */\nexport const reloadFileFromDiskCallback =\n  (_get: Getter, set: Setter) => async (path: string) => {\n    await set(fileContentAtom(path));\n  };\n\n/**\n * **Note**: currently, only text files are supported, for simplicity.\n **/\nexport const fileContentAtom = atomFamily((filepath: string | null) => {\n  const readFile = async (): Promise<string | null> => {\n    if (!filepath) {\n      return \"\";\n    }\n    const exists = await fs.promises.exists(filepath);\n    if (!exists) {\n      return null;\n    }\n    // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n    return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n  };\n  const fileContentAtom = atomWithLazy(readFile);\n  return atom(\n    async (get): Promise<string | null> => get(fileContentAtom),\n    async (_get, set, ...args: [string | undefined | null] | []) => {\n      const content = args[0] ?? \"\";\n      if (args.length === 0) {\n        // refresh\n        return set(fileContentAtom, readFile());\n      }\n      set(fileContentAtom, Promise.resolve(content));\n      // TODO: check if the file content was changed externally,\n      //  keep track of it in a state\n      //  (so a dialog can be shown to confirm actions such as \"Overwrite\" or \"Reload from disk\"\n      //  and add an `overwrite` argument here to be used when overwrite is used.\n      if (filepath) {\n        // this could also be an effect on fileContentAtom, avoiding this write function (and the wrapper atom),\n        // but:\n        // A: something similar to Recoil's onSet() didn't seem straightforward with jotai-effect\n        // B: we want to support refreshing when content is not passed (similar to how atomWithRefresh works)\n        await fs.promises\n          .writeFile(filepath, content ?? \"\", \"utf8\")\n          .catch((e: unknown) => {\n            // TODO: what to do if writing file fails? undo setting atom content?\n            console.error(\"failed to sync the file back to the fs\", e);\n          });\n      }\n    }\n  );\n});\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"Git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","import { DOMAttributes, FocusEvent, useEffect, useRef } from \"react\";\nimport { PrimitiveAtom } from \"jotai\";\nimport { equals } from \"ramda\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\n\nimport { useStableSetAtom } from \"./useStableSetAtom\";\n\nexport const createFocusBasedSetterHook = <T extends unknown, N extends T = T>(\n  atom: PrimitiveAtom<T>,\n  nullValue: N\n) => {\n  let focusedElement: Element | null = null;\n  return (value: T, name: string = \"unknown\") => {\n    const setValue = useStableSetAtom(atom);\n    const elementRef = useRef<Element>();\n    useEffect(() => {\n      if (focusedElement === elementRef.current) {\n        setValue((currentValue) => {\n          return equals(value, currentValue) ? currentValue : value;\n        });\n      }\n    }, [value]);\n    return useFocusWithin({\n      onFocusWithin: (e: FocusEvent) => {\n        elementRef.current = e.currentTarget;\n        focusedElement = e.currentTarget;\n        setValue(value);\n      },\n      onBlurWithin: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container], [role=menu]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n      },\n    }).focusWithinProps as Pick<DOMAttributes<Element>, \"onFocus\" | \"onBlur\">;\n  };\n};\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { createRef, MutableRefObject } from \"react\";\nimport {\n  AlertDialogApi,\n  PopupManagerAPI,\n  WindowManagerAPI,\n} from \"@intellij-platform/core\";\n\nimport { dirContentAtom, FsItem } from \"../fs/fs.state\";\nimport { createFocusBasedSetterHook } from \"../atom-utils/focus-based-atom-utils\";\nimport { filterPath } from \"./project-utils\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const autoClonedRepo = {\n  path: \"/workspace/jui\",\n  url: \"https://github.com/alirezamirian/jui.git\",\n};\n\nexport const defaultProject = {\n  name: \"Workspace\",\n  path: \"/workspace\",\n};\nexport const currentProjectAtom = atom<Project>(defaultProject);\n\nexport const projectFilePath = atomFamily((projectRelativePath: string) =>\n  atom((get) => path.join(get(currentProjectAtom).path, projectRelativePath))\n);\n\nexport const currentProjectFilesAtom = atom(\n  async (get): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectAtom);\n    return get(projectFilesAtom(project.path));\n  }\n);\n\nconst projectFilesAtom = atomFamily(\n  (\n    projectPath: string /* could be changed to project id, when project entity is more mature */\n  ) =>\n    atom(async (get): Promise<ProjectFsItem[]> => {\n      const items = await get(dirContentAtom(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = async (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = await get(dirContentAtom(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      await Promise.all((items || []).map((item) => addItem(item)));\n      return files;\n    })\n);\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsAtom = atom<string[]>([]);\n\nexport const activePathExistsAtom = atom(\n  (get) => get(activePathsAtom).length > 0\n);\n\n/**\n * Sets the value of {@link activePathsAtom} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsAtom,\n  []\n);\n\n/**\n * Ref to the popup manager of the current project.\n * TODO(multi-project): either:\n *  - introduce project-level store provider, to keep such states per project.\n *  - maybe better, add a feature to the action system, where ActionProvider can define additional contextual properties\n *    to be made available in `context` when calling `actionPerformed` method. The biggest challenge for a nice\n *    implementation of such feature is static type safety.\n */\nexport const projectPopupManagerRefAtom = atom<\n  MutableRefObject<PopupManagerAPI | null>\n>(createRef<PopupManagerAPI | null>());\n\nexport const windowManagerRefAtom = atom<\n  MutableRefObject<WindowManagerAPI | null>\n>(createRef<WindowManagerAPI | null>());\n\nexport const alertDialogRefAtom = atom<MutableRefObject<AlertDialogApi | null>>(\n  createRef<AlertDialogApi | null>()\n);\n","import { PrimitiveAtom, useSetAtom, useStore } from \"jotai\";\nimport { useCallback } from \"react\";\n\ntype Options = Parameters<typeof useStore>[0];\ntype SetAtom<Args extends unknown[], Result> = (...args: Args) => Result;\n\n/**\n * unlike recoil, and unlike React state setter, jotai's state setter returned from\n * useSetAtom always causes a rerender even if the current value is returned\n * from the updater function passed to the setter.\n * That can cause infinite rerender.\n * useStableSetAtom is a drop-in replacement for useSetAtom for primitive atoms,\n * which doesn't set state if the new value is the same as the old value.\n */\nexport function useStableSetAtom<T>(\n  atom: PrimitiveAtom<T>,\n  options?: Options\n): SetAtom<[T | ((currentValue: T) => T)], void> {\n  const store = useStore(options);\n  const setAtom = useSetAtom<PrimitiveAtom<T>>(atom);\n\n  return useCallback(\n    (value) => {\n      const currentValue = store.get(atom);\n      const newValue =\n        typeof value === \"function\"\n          ? (value as (currentValue: T) => T)(currentValue) // why is casting needed?\n          : value;\n      if (newValue !== currentValue) {\n        setAtom(newValue);\n      }\n      return newValue;\n    },\n    [useSetAtom, store]\n  );\n}\n","import { atom, SetStateAction, WritableAtom } from \"jotai\";\nimport { atomEffect } from \"jotai-effect\";\nimport { atomFamily } from \"jotai/utils\";\nimport {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { identity } from \"ramda\";\nimport { z, ZodType } from \"zod\";\nimport { fs } from \"../fs/fs\";\nimport { currentProjectAtom } from \"../Project/project.state\";\nimport { fileContentAtom } from \"../fs/fs.state\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nconst storagePaths = atomFamily((storageFile: string) =>\n  atom((get) => {\n    const storageFileDir = path.join(get(currentProjectAtom).path, \".idea\");\n\n    return path.join(\n      storageFileDir,\n      storageFileMapping[storageFile] || storageFile\n    );\n  })\n);\n\nconst PERSISTENCE_WRITE_TIMEOUT = 1000;\n\nconst persistentStateStoreAtoms = atomFamily((storageFile: string) => {\n  const cacheAtom = atom<PersistedState | null>(null);\n  const storageContentAtom = atom((get) =>\n    readStorageFile(get(storagePaths(storageFile)))\n  );\n  let fsWriteTimer: ReturnType<(typeof window)[\"setTimeout\"]> | null = null;\n  return atom(\n    (get): Promise<PersistedState> | PersistedState =>\n      get(cacheAtom) ?? get(storageContentAtom),\n    async (get, set, update: (state: PersistedState) => PersistedState) => {\n      const storageFilepath = get(storagePaths(storageFile));\n      const state: PersistedState =\n        get(cacheAtom) ?? (await get(storageContentAtom));\n      set(cacheAtom, (currentState) => update(currentState ?? state));\n\n      // basic throttling\n      if (fsWriteTimer !== null) {\n        clearTimeout(fsWriteTimer);\n      }\n      fsWriteTimer = setTimeout(() => {\n        set(fileContentAtom(storageFilepath), serializeState(get(cacheAtom)!));\n      }, PERSISTENCE_WRITE_TIMEOUT);\n    }\n  );\n});\n\ntype PersistedStateAtom<Value> = WritableAtom<\n  Promise<Value | undefined>,\n  [{ type: \"update\"; value: Value }],\n  Promise<void>\n>;\n\ntype WithOptionalArrays<T> = T extends {}\n  ? {\n      [K in keyof T]: T[K] extends Array<infer Item>\n        ? WithOptionalArrays<T[K]> | WithOptionalArrays<Item>\n        : WithOptionalArrays<T[K]>;\n    }\n  : T extends Array<infer I>\n  ? T | I\n  : T;\n\nfunction createPersistedStateAtom<\n  Schema extends ZodType<any, any, WithOptionalArrays<any>>,\n  Value extends object\n>({\n  storageFile = StorageFiles.WORKSPACE_FILE,\n  componentName,\n  schema,\n  ...args\n}: {\n  componentName: string;\n  schema: Schema extends ZodType<infer Output, any, infer Input>\n    ? WithOptionalArrays<Output> extends Input\n      ? Schema\n      : ` If you see this error, it means the schema produces an array somewhere but doesn't expect singular value in the input. Look for usages of z.array() and replace them with maybeArray() utility `\n    : never;\n  storageFile?: string;\n} & (\n  | {}\n  | {\n      read: (\n        componentState: Schema[\"_output\"] | undefined\n      ) => Value | Promise<Value> | undefined;\n      write: (\n        value: Value,\n        componentState: Schema[\"_output\"]\n      ) => Schema[\"_output\"];\n    }\n)): PersistedStateAtom<Value> {\n  const write = \"write\" in args ? args.write : (v: Value) => v;\n  const read = \"read\" in args ? args.read : identity;\n\n  return atom(\n    async (get): Promise<Value | undefined> => {\n      const state = await get(persistentStateStoreAtoms(storageFile));\n      const componentState = state?.project.component.find(\n        (component): component is Schema[\"_output\"] & ComponentState =>\n          component[\"@name\"] === componentName\n      );\n      const output = schema.safeParse(componentState);\n      if (output.error) {\n        console.error(\n          `Error parsing persisted state for component ${componentName} in file ${storageFile}:`,\n          output.error\n        );\n      }\n      return (await read(output.data)) ?? undefined;\n    },\n    async (get, set, action: { type: \"update\"; value: Value }) => {\n      if (action.type === \"update\") {\n        return set(persistentStateStoreAtoms(storageFile), (state) => {\n          const { value } = action;\n          const components = [...state.project.component];\n          const index = components.findIndex(\n            (component) => component[\"@name\"] === componentName\n          );\n          components.splice(index, index >= 0 ? 1 : 0, {\n            \"@name\": componentName,\n            ...write(value as Value, components[index]),\n          });\n          return {\n            ...state,\n            project: {\n              ...state.project,\n              component: components,\n            },\n          };\n        });\n      }\n    }\n  );\n}\n\nexport function atomWithPersistence<\n  Schema extends ZodType<any, any, WithOptionalArrays<any>>,\n  Value extends object\n>(\n  initialValue: Value,\n  config: Parameters<typeof createPersistedStateAtom<Schema, Value>>[0]\n) {\n  const baseAtom = atom<Value>(initialValue);\n\n  const persistenceAtom = createPersistedStateAtom<Schema, Value>(config);\n  const syncEffect = atomEffect((get, set) => {\n    get.peek(persistenceAtom).then((persistedValue) => {\n      if (persistedValue !== undefined) {\n        set(baseAtom, persistedValue);\n      }\n    });\n  });\n  return atom<Value, [SetStateAction<Value>], Promise<void>>(\n    (get) => {\n      get(syncEffect);\n      return get(baseAtom);\n    },\n    async (get, set, action: SetStateAction<Value>) => {\n      const newValue =\n        typeof action === \"function\"\n          ? (action as (currentValue: Value) => Value)(await get(baseAtom))\n          : action;\n      set(baseAtom, newValue);\n      await set(persistenceAtom, { type: \"update\", value: newValue });\n    }\n  );\n}\n\n// TODO: make a test suite for persistent atoms using the examples like the ones below\n//  to cover:\n//  - read/write working as expected\n//  - Atoms rendering expectations.\n//    updating state of a component should not rerender the other persisted in the same file\n//  - ideally the expected type errors in read/write and type arguments\nexport const testAtom = atomWithPersistence(\n  { x: 2 },\n  {\n    componentName: \"test\",\n    storageFile: \"test.xml\",\n    schema: z.object({ whatever: z.number() }).optional(),\n    read: (s) => ({ x: s?.whatever ?? 2 }),\n    write: (v, s) => ({ ...s, whatever: v.x }),\n  }\n);\n\nexport const testAtom2 = atomWithPersistence(\n  { y: 3 },\n  {\n    componentName: \"test2\",\n    storageFile: \"test.xml\",\n    schema: z.object({ y: z.number() }).optional(),\n  }\n);\n\nexport type ComponentState = { \"@name\": string };\nexport type PersistedState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nconst EMPTY_STORAGE_STATE = {\n  \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n  project: { \"@version\": \"4\", component: [] as ComponentState[] },\n} as const;\n\nexport async function readStorageFile(\n  storageFile: string\n): Promise<PersistedState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const storageFileExists = await fs.promises.exists(storageFile);\n  if (!storageFileExists) {\n    return EMPTY_STORAGE_STATE;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = Object.assign(\n    { ...EMPTY_STORAGE_STATE },\n    xmlParser.parse(xmlData)\n  );\n  workspace.project.component = workspace.project.component ?? [];\n  return workspace;\n}\n\nfunction serializeState(state: PersistedState): string {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n  return xmlBuilder.build(state);\n}\n\nexport const storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n","import { z, ZodEnum, ZodString, ZodType } from \"zod\";\n\nexport const maybeArray = <T extends ZodType>(type: T) =>\n  z\n    .union([type, type.array()])\n    .transform((value): T[\"_output\"][] =>\n      Array.isArray(value) ? value : [value]\n    );\n\n/**\n * schema for map objects persisted in intellij IDE setting files.\n */\nexport const map = <K extends ZodString | ZodEnum<any>, V extends ZodType>(\n  keyAttribute: K,\n  value: V\n) =>\n  z.object({\n    entry: maybeArray(\n      z.object({\n        \"@type\": keyAttribute,\n        value,\n      })\n    ),\n  });\n\n/**\n * schema for list objects persisted in intellij IDE setting files.\n */\nexport const list = <T extends ZodType, K extends string>(\n  item: T,\n  itemTagName: K\n) => {\n  const itemSchema = maybeArray(item);\n  return z.object({\n    [itemTagName]: itemSchema,\n  } as { [KK in K]: typeof itemSchema });\n};\n","import { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, useAtomCallback } from \"jotai/utils\";\nimport { withAtomEffect } from \"jotai-effect\";\nimport git, { findRoot, statusMatrix } from \"isomorphic-git\";\nimport { z } from \"zod\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport * as path from \"path\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { atomWithRefresh } from \"../atom-utils/atomWithRefresh\";\nimport { atomWithPersistence } from \"../persistence/atomWithPersistence\";\nimport { maybeArray } from \"../persistence/schema-utils\";\n\n/**\n * git.status function has an issue with newly added files. it returns \"*added\" for both of these cases:\n * - file is untracked, not yet staged (as the documentation says)\n * - file is staged, but modified in working directory (AM)\n * Here is where it seems to have wrong logic:\n * https://github.com/isomorphic-git/isomorphic-git/blob/d631f8e56a5504b10ffc1b35589b1a5b0b2f9e74/src/api/status.js#L135\n\n */\nconst status = async ({\n  filepath,\n  ...args\n}: Parameters<(typeof git)[\"status\"]>[0]) => {\n  return git\n    .statusMatrix({ ...args, filepaths: [filepath] })\n    .then((rows) => rows[0]);\n};\n\nconst TMP_findGitRoots = () =>\n  Promise.all(\n    [\"/workspace/jui\", \"/workspace\"].map(async (dir) => {\n      const exists = await fs.promises.exists(dir);\n      if (exists) {\n        return git.findRoot({ fs, filepath: dir }).catch(() => null);\n      }\n    })\n  ).then((roots) => {\n    return [...new Set(roots.filter(notNull))].map<VcsDirectoryMapping>(\n      (dir) => ({\n        dir,\n        vcs: \"Git\",\n      })\n    );\n  });\n\nconst vcsDirectoryMappingsSchema = z\n  .object({\n    mapping: maybeArray(\n      z.object({\n        \"@directory\": z.string(),\n        \"@vcs\": z.enum([\"Git\"]),\n      })\n    ).optional(),\n  })\n  .optional();\ntype VcsDirectoryMappingStorage =\n  (typeof vcsDirectoryMappingsSchema)[\"_output\"];\n\nexport const vcsRootsAtom = atomWithPersistence(\n  [] as ReadonlyArray<VcsDirectoryMapping>,\n  {\n    componentName: \"VcsDirectoryMappings\",\n    schema: vcsDirectoryMappingsSchema,\n    storageFile: \"vcs.xml\",\n    read: (state) => {\n      // TODO: translate project dir to $PROJECT_DIR$\n      return (\n        state?.mapping?.map((item) => ({\n          dir: item[\"@directory\"],\n          vcs: item[\"@vcs\"],\n        })) ?? TMP_findGitRoots()\n      );\n    },\n    write: (value, state): VcsDirectoryMappingStorage => ({\n      ...(state || {}),\n      mapping:\n        value?.map(({ vcs, dir }) => ({\n          \"@directory\": dir,\n          \"@vcs\": vcs,\n        })) ?? [],\n    }),\n  }\n);\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsFootForFileAtom = atomFamily((filepath: string) =>\n  atom(() => {\n    // FIXME: use vcsRoots.\n    // return get(vcsRootsState).find(\n    //   (root) => root.vcs === \"Git\" && isParentPath(root.dir, filepath)\n    // )?.dir ?? null;\n    // function isParentPath(parent: string, dir: string) {\n    //   const relative = path.relative(parent, dir);\n    //   return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n    // }\n    return findRoot({ fs, filepath }).catch(() => null);\n  })\n);\n\ntype RepoStatus = {\n  [relativeFilePath: string]: FileStatus;\n};\n\nconst fetchRepoStatusFromFs = async (repoDir: string) => {\n  console.time(`statusMatrix ${repoDir}`);\n  const rows = await statusMatrix({ fs, dir: repoDir });\n  console.timeEnd(`statusMatrix ${repoDir}`);\n  const result: RepoStatus = {};\n  rows.forEach((row) => {\n    result[row[0]] = convertGitStatus(row);\n  });\n  return result;\n};\n\n/**\n * A mapping from relative file paths to file status, calculated efficiently for all files in a repo.\n * It's a writable sync atom to allow updating it for a single file when the status of a file is changed.\n * It could have been an async atom wrapped by {@link unwrapLatestWithLoading}, which would simplify\n * keeping the loading state per repo while the latest sync value is always available, but note that\n * we want it to be writable as well, since in many scenarios a single file changes and the repo\n * status can be patched with that single change, instead of being fully recalculated.\n */\nexport const repoStatusAtoms = atomFamily((repoDir: string) => {\n  const targetAtom = atom<RepoStatus>({});\n  return withAtomEffect(targetAtom, (_get, set) => {\n    fetchRepoStatusFromFs(repoDir).then((repoStatus) => {\n      set(targetAtom, repoStatus);\n    });\n  });\n});\n\nexport const isRepoStatusUpdatingAtom = atomFamily((_repoRoot: string) =>\n  atom(false)\n);\n\nexport const isAnyRepoStatusUpdatingAtom = atom<boolean>((get) =>\n  get(vcsRootsAtom).some(({ dir }) => get(isRepoStatusUpdatingAtom(dir)))\n);\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n * NOTE: Do **not** refresh `fileStatusAtom`s directly to update file status, as it may update status for\n * the entire repo (if {@link repoStatusAtoms} is not yet written into), which is not very efficient.\n * use {@link useRefreshFileStatus} or {@link refreshFileStatusCallback} to efficiently refresh\n * the status of a single file.\n */\nexport const fileStatusAtoms = atomFamily((filepath: string) =>\n  atomWithRefresh(async (get): Promise<FileStatus> => {\n    const repoRoot = await get(vcsFootForFileAtom(filepath));\n    if (repoRoot) {\n      const relativePath = path.relative(repoRoot, filepath);\n      const repoStatus = get(repoStatusAtoms(repoRoot));\n      if (!repoStatus[relativePath]) {\n        console.log(\n          \"file status missing in repo status state, fetching individually\",\n          filepath\n        );\n      }\n      return (\n        repoStatus[relativePath] ??\n        // TODO(jotai): files that are initially shown in project view all hit this individual status checking code\n        //  It gets pretty slow when multiple calls to status are made simultaneously.\n        //  the entire file status state could use some refactoring to improve such cases.\n        convertGitStatus(\n          await status({\n            fs,\n            dir: repoRoot,\n            filepath: relativePath,\n          })\n        )\n      );\n    }\n    return \"NOT_CHANGED\";\n  })\n);\n\n/**\n * Adds a file or directory to git index\n */\nexport const refreshFileStatusCallback = async (\n  get: Getter,\n  set: Setter,\n  fullPath: string\n) => {\n  const repoRoot = await get(vcsFootForFileAtom(fullPath));\n  if (repoRoot) {\n    const relativePath = path.relative(repoRoot, fullPath);\n    const rows = await git.statusMatrix({\n      fs,\n      dir: repoRoot,\n      filepaths: [relativePath],\n    });\n    set(repoStatusAtoms(repoRoot), (statusMap) => {\n      const newStatusMap = {\n        ...statusMap,\n      };\n      if (rows.length === 0) {\n        // if file is removed and doesn't exist in HEAD, it will not appear on the status matrix\n        delete newStatusMap[relativePath];\n      }\n      rows.forEach((row) => {\n        newStatusMap[row[0]] = convertGitStatus(row);\n      });\n      return newStatusMap;\n    });\n  }\n};\n\nexport const useRefreshFileStatus = (): ((\n  absoluteFilepath: string\n) => Promise<void>) => useAtomCallback(refreshFileStatusCallback);\n\nexport const refreshRepoStatusesCallback = async (get: Getter, set: Setter) => {\n  get(vcsRootsAtom)?.forEach(({ dir }) => {\n    set(isRepoStatusUpdatingAtom(dir), true);\n    fetchRepoStatusFromFs(dir)\n      .then((repoStatus) => {\n        console.log(\"setting repo status for git dirs:\", dir, repoStatus);\n        set(repoStatusAtoms(dir), repoStatus);\n      })\n      .finally(() => {\n        set(isRepoStatusUpdatingAtom(dir), false);\n      });\n  });\n};\nexport const useRefreshRepoStatuses = () =>\n  useAtomCallback(refreshRepoStatusesCallback);\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { fileStatusAtoms } from \"./file-status.state\";\nimport { FileStatus } from \"./file-status\";\nimport { unwrap } from \"jotai/utils\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const fileStatus = useAtomValue(unwrap(fileStatusAtoms(filepath)));\n  return useStatusColor(fileStatus ?? \"NOT_CHANGED\");\n};\n\nexport const FileStatusColor: React.FC<{\n  filepath: string;\n  children?: React.ReactNode;\n}> = ({ children, filepath }) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{\n  status: FileStatus;\n  children?: React.ReactNode;\n}> = ({ children, status }) => {\n  const theme = useTheme() as Theme;\n  const color = theme.currentForegroundAware(useStatusColor(status));\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n * FIXME(multi-project): this should be scoped to project\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\n\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import React from \"react\";\nimport {\n  CommonActionId,\n  styled,\n  useAction,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nconst StyledContainer = styled.div.attrs({ tabIndex: -1 })`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n  justify-content: center;\n  padding: 0 25%;\n  font-size: 1rem;\n  outline: none;\n`;\n\nconst StyledLine = styled.div`\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n`;\n\nconst StyledShortcut = styled.div`\n  color: ${({ theme }) => theme.commonColors.linkForegroundEnabled};\n`;\n\nexport function EditorZeroState() {\n  return (\n    <StyledContainer>\n      <ActionTip actionId={CommonActionId.GO_TO_FILE} />\n      <ActionTip actionId={CommonActionId.GO_TO_ACTION} />\n    </StyledContainer>\n  );\n}\n\nfunction ActionTip({ actionId }: { actionId: string }) {\n  const getShortcut = useGetActionShortcut();\n  const action = useAction(actionId);\n  return (\n    <StyledLine>\n      {action?.title}\n      <StyledShortcut>{getShortcut(actionId)}</StyledShortcut>\n    </StyledLine>\n  );\n}\n","export const AppActionIds = {\n  PASTE_MULTIPLE: \"PasteMultiple\",\n  GENERATE: \"Generate\",\n};\n","export const editorActionIds = {\n  EXPAND_REGION: \"ExpandRegion\",\n  EXPAND_REGION_RECURSIVELY: \"ExpandRegionRecursively\",\n  EXPAND_ALL_REGIONS: \"ExpandAllRegions\",\n  EXPAND_ALL_TO_LEVEL: \"ExpandToLevel\",\n  EXPAND_ALL_TO_LEVEL1: \"ExpandToLevel1\",\n  EXPAND_ALL_TO_LEVEL2: \"ExpandToLevel2\",\n  EXPAND_ALL_TO_LEVEL3: \"ExpandToLevel3\",\n  EXPAND_ALL_TO_LEVEL4: \"ExpandToLevel4\",\n  EXPAND_ALL_TO_LEVEL5: \"ExpandToLevel5\",\n  COLLAPSE_REGION: \"CollapseRegion\",\n  COLLAPSE_REGION_RECURSIVELY: \"CollapseRegionRecursively\",\n  COLLAPSE_ALL_REGIONS: \"CollapseAllRegions\",\n  COLLAPSE_DOC_COMMENTS: \"CollapseDocComments\",\n  TOGGLE_FOLDING: \"ToggleFolding\",\n  EDITOR_LANG_POPUP_MENU: \"EditorLangPopupMenu\",\n  CompareClipboardWithSelection: \"CompareClipboardWithSelection\",\n};\n","import React, { MutableRefObject } from \"react\";\nimport copyToClipboard from \"clipboard-copy\";\nimport { editor } from \"monaco-editor\";\nimport {\n  ActionContext,\n  ActionGroupDefinition,\n  CommonActionId,\n  PlatformIcon,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { AppActionIds } from \"../appActionIds\";\nimport { editorActionIds } from \"./editorActionIds\";\n\nexport function useEditorActionGroup(\n  editorRef: MutableRefObject<editor.ICodeEditor | undefined>\n): ActionGroupDefinition {\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const editor = editorRef.current;\n  const selection = editor?.getSelection();\n\n  const selectedText = selection // FIXME: needs to become reactive\n    ? editor?.getModel()?.getValueInRange(selection)\n    : \"\";\n\n  return createDefaultActionGroup({\n    id: \"EditorPopupMenu\",\n    title: \"Editor Popup Menu\",\n    description: \"Editor Popup Menu\",\n    children: (\n      [\n        createDefaultActionGroup({\n          id: \"ShowIntentionsGroup\",\n          title: \"Show Intentions Group\",\n          isSearchable: false,\n          menuPresentation: \"section\",\n          children: [\n            {\n              id: \"ShowIntentionActions\",\n              title: \"Show Context Actions\",\n              icon: <PlatformIcon icon=\"actions/intentionBulbGrey.svg\" />,\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        selectedText\n          ? {\n              id: CommonActionId.COPY,\n              title: \"Copy\",\n              icon: <PlatformIcon icon=\"actions/copy\" />,\n              actionPerformed: () => {\n                const selection = editor?.getSelection();\n                const selectedText = selection\n                  ? editor?.getModel()?.getValueInRange(selection)\n                  : \"\";\n                if (selectedText) {\n                  copyToClipboard(selectedText);\n                }\n              },\n            }\n          : null,\n        {\n          id: CommonActionId.PASTE,\n          title: \"Paste\",\n          icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n          actionPerformed: () => {\n            // Note: There doesn't seem to be a way to trigger the default paste action\n            // (without prompting for clipboard API), from a menu UI.\n            // So, selecting \"Paste\" menu item will ask for clipboard permission, and\n            // that's the same in the default Monaco context menu as well.\n            // The difference here is that pasting with ctrl+V works without permission\n            // by default, but because we are handling ctrl+V through the keymap,\n            // even pasting by the shortcut will require permission now.\n            editor?.focus();\n            editor?.trigger(\n              \"keyboard\",\n              \"editor.action.clipboardPasteAction\",\n              {}\n            );\n          },\n        },\n        createDefaultActionGroup({\n          id: \"Copy.Paste.Special\",\n          title: \"Copy / Paste Special\",\n          description: \"Copy / Paste Special Editor Actions\",\n          menuPresentation: \"submenu\",\n          children: [\n            {\n              id: CommonActionId.COPY_REFERENCE,\n              title: \"Copy Reference\",\n              description:\n                \"Copy reference to selected class, method or function, or a relative path to selected file\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n            {\n              // TODO: this action should be scoped to the entire app.\n              //  move it when referencing actions in groups is possible\n              id: AppActionIds.PASTE_MULTIPLE,\n              title: \"Paste from history\",\n              description: \"Paste from recent clipboards\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        \"divider\",\n        createDefaultActionGroup({\n          id: \"FoldingGroup\",\n          title: \"Folding\",\n          menuPresentation: \"submenu\",\n          children: [\n            {\n              id: editorActionIds.EXPAND_REGION,\n              title: \"Expand\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfold\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.EXPAND_REGION_RECURSIVELY,\n              title: \"Expand Recursively\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfoldRecursively\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.EXPAND_ALL_REGIONS,\n              title: \"Expand All\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfoldAll\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            {\n              id: editorActionIds.COLLAPSE_REGION,\n              title: \"Collapse\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(source(context), \"editor.fold\", {});\n              },\n            },\n            {\n              id: editorActionIds.COLLAPSE_REGION_RECURSIVELY,\n              title: \"Collapse Recursively\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldRecursively\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.COLLAPSE_ALL_REGIONS,\n              title: \"Collapse All\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldAll\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            createDefaultActionGroup({\n              id: editorActionIds.EXPAND_ALL_TO_LEVEL,\n              title: \"Expand all to level\",\n              menuPresentation: \"submenu\",\n              children: ([1, 2, 3, 4, 5] as const).map((level) => ({\n                id: editorActionIds[`EXPAND_ALL_TO_LEVEL${level}`],\n                title: `${level}`,\n                actionPerformed: (context) => {\n                  editorRef.current?.trigger(\n                    source(context),\n                    `editor.foldLevel${level}`,\n                    {}\n                  );\n                },\n              })),\n            }),\n            \"divider\",\n            {\n              id: editorActionIds.COLLAPSE_DOC_COMMENTS,\n              title: \"Collapse Doc Comments\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldAllBlockComments\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            {\n              id: editorActionIds.TOGGLE_FOLDING,\n              title: \"Toggle Folding\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.toggleFold\",\n                  {}\n                );\n              },\n            },\n          ],\n        }),\n        createDefaultActionGroup({\n          id: \"EditorLangPopupMenu\",\n          title: \"EditorLangPopupMenu\",\n          menuPresentation: \"section\",\n          children: [\n            {\n              id: AppActionIds.GENERATE,\n              title: \"Generate...\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        \"divider\",\n        {\n          id: editorActionIds.CompareClipboardWithSelection,\n          title: \"Compare with Clipboard\",\n          description: \"Compare current selection with clipboard\",\n          icon: <PlatformIcon icon=\"actions/diffWithClipboard.svg\" />,\n          actionPerformed: () => {\n            notImplemented();\n          },\n        },\n      ] as const\n    ).filter(notNull),\n  });\n}\n\nfunction source(context: ActionContext): \"keyboard\" | \"mouse\" | \"\" {\n  if (!context.event) {\n    return \"\";\n  }\n  return context.event?.type?.includes(\"key\") ? \"keyboard\" : \"mouse\";\n}\n","import { atom, Getter, Setter } from \"jotai\";\n\ntype GetCallback = <Args extends unknown[], Result>(\n  callback: (get: Getter, set: Setter, ...args: Args) => Result\n) => (...args: Args) => Result;\ntype ReadWithGetCallback<Value, SetSelf = never> = (\n  get: Getter,\n  options: {\n    readonly signal: AbortSignal;\n    readonly setSelf: SetSelf;\n    readonly getCallback: GetCallback;\n  }\n) => Value;\n\nconst getCallbackAtom = atom<GetCallback, [], { get: Getter; set: Setter }>(\n  (_get, { setSelf }) => {\n    return (callback) => {\n      return (...args) => {\n        const { get, set } = setSelf();\n        return callback(get, set, ...args);\n      };\n    };\n  },\n  (get, set) => ({ get, set })\n);\n\nexport const atomWithGetCallback = <Value>(\n  read: ReadWithGetCallback<Value>\n) => {\n  return atom((get, options) => {\n    const getCallback = get(getCallbackAtom);\n    return read(\n      get,\n      Object.assign(options, {\n        getCallback,\n      }) /* spreading over options calls getter for setSelf and signal, so we fall back to mutating the passed option */\n    );\n  });\n};\n","import { atom, Getter, Setter, useAtomValue } from \"jotai\";\nimport { withAtomEffect } from \"jotai-effect\";\nimport { descend, sortWith } from \"ramda\";\nimport { Position } from \"monaco-editor\";\n\nimport {\n  currentProjectFilesAtom,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Focusable } from \"../common-types\";\nimport { atomWithGetCallback } from \"../atom-utils/atomWithGetCallback\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// it should become something under \"project\" state later.\nexport const editorTabsAtom = withAtomEffect(\n  atom<ReadonlyArray<EditorTabState>>([]),\n  (get, set) => {\n    // in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n    // settings.\n    // an effect is used to set the intial value instead of using the selector directly in default value,\n    // because otherwise the atom will be linked to the selector (and dynamically updated) until the state is set\n    // which can lead to inconsistent behavior based on whether anything in tabs state is changed or not.\n    get.peek(currentProjectFilesAtom).then((currentProjectFiles) => {\n      set(\n        editorTabsAtom,\n        sortWith(\n          [\n            // first README.md, then ts and js files.\n            descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n            descend((file) => file.path.endsWith(\".ts\")),\n            descend((file) => file.path.endsWith(\".js\")),\n          ],\n          currentProjectFiles.filter((item) => item.type === \"file\")\n        )\n          .filter((file) => !file.path.includes(\".idea\"))\n          .slice(0, 12)\n          // map project file to editor state object\n          .map((file) => ({\n            filePath: file.path,\n            editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n          }))\n      );\n    });\n  }\n);\n\nconst activeEditorTabIndexState = atom<number>(0);\n\nexport const activeEditorTabAtom = atom<EditorTabState | null>((get) => {\n  const tabs = get(editorTabsAtom);\n  return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n});\n\nexport const editorCursorPositionState = atom<Position>(new Position(0, 0));\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefAtom = atom<null | Focusable>(null);\n\nexport interface EditorStateManager {\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOtherTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n  focus(): void;\n}\n\nconst openPathCallback = (\n  get: Getter,\n  set: Setter,\n  filePath: string,\n  shouldFocus = true\n) => {\n  const tabsState = get(editorTabsAtom);\n  const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n  const select = (index: number) => {\n    set(activeEditorTabIndexState, index);\n  };\n  const focus = () => {\n    get(editorRefAtom)?.focus();\n  };\n  if (index > -1) {\n    select(index);\n  } else {\n    const newIndex = tabsState.length;\n    set(editorTabsAtom, (currentState) => [\n      ...currentState,\n      {\n        filePath,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n      },\n    ]);\n    select(newIndex);\n  }\n  if (shouldFocus) {\n    // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n    // event handler) is picked up by editor, adding unwanted new line.\n    setTimeout(focus);\n  }\n};\n\nconst closeCallback = (_get: Getter, set: Setter, index: number) =>\n  set(editorTabsAtom, (tabsState) =>\n    tabsState.filter((_, tabIndex) => tabIndex !== index)\n  );\n\nconst closePathCallback = (get: Getter, set: Setter, filePath: string) => {\n  const index = get(editorTabsAtom).findIndex(\n    (tab) => tab.filePath === filePath\n  );\n  if (index > -1) {\n    closeCallback(get, set, index);\n    set(activeEditorTabIndexState, Math.max(index - 1, 0));\n  }\n};\n\nconst closeOtherTabsCallback = (get: Getter, set: Setter, index: number) => {\n  set(editorTabsAtom, (tabsState) =>\n    tabsState.filter((_, tabIndex) => tabIndex === index)\n  );\n};\n\nconst selectTabCallback = (get: Getter, set: Setter, index: number) => {\n  const numTabs = get(editorTabsAtom).length;\n  if (index >= 0 && index < numTabs) {\n    set(activeEditorTabIndexState, index);\n  }\n};\n\nconst focusTabCallback = (get: Getter, set: Setter) => {\n  get(editorRefAtom)?.focus();\n};\n\nexport const editorManagerAtom = atomWithGetCallback(\n  (_get, { getCallback }): EditorStateManager => {\n    // TODO: create an action for opening in editor (jump to source)\n    return {\n      openPath: getCallback(openPathCallback),\n      closeTab: getCallback(closeCallback),\n      select: getCallback(selectTabCallback),\n      focus: getCallback(focusTabCallback),\n      closeOtherTabs: getCallback(closeOtherTabsCallback),\n      closePath: getCallback(closePathCallback),\n    };\n  }\n);\n\n/**\n * Gives access to editor state manager, in React components. returns a stable editor manager object,\n * that won't cause re-rendering based on editor state changes.\n */\nexport const useEditorStateManager = (): EditorStateManager =>\n  useAtomValue(editorManagerAtom);\n\n/**\n * Gives access to editor state and also the manager, as a tuple, analogous to how useState returns\n * a tuple for the state and the setter. Only the setter is an interface.\n */\nexport const useEditorState = (): readonly [\n  readonly EditorTabState[],\n  EditorStateManager\n] => {\n  return [\n    useAtomValue(editorTabsAtom),\n    useAtomValue(editorManagerAtom),\n  ] as const;\n};\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      const bracketColor = theme.dark ? \"#dcdcdc\" : \"#000\";\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n              \"editorBracketHighlight.foreground1\": bracketColor,\n              \"editorBracketHighlight.foreground2\": bracketColor,\n              \"editorBracketHighlight.foreground3\": bracketColor,\n              \"editorBracketHighlight.foreground4\": bracketColor,\n              \"editorBracketMatch.background\": \"#43454b\", // in new UI\n              \"editorBracketMatch.border\": \"#00000000\", // in new UI\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  const fontSize = 13;\n  return (\n    <StyledEditor\n      {...props}\n      options={\n        {\n          minimap: { enabled: false },\n          lineHeight: 22,\n          showFoldingControls: \"always\",\n          guides: {\n            indentation: true,\n          },\n          overviewRulerBorder: false,\n          fontFamily: \"JetBrains Mono\",\n          fontSize,\n          scrollbar: {\n            verticalScrollbarSize: 14,\n            horizontalScrollbarSize: 8,\n            verticalSliderSize: 8,\n            horizontalSliderSize: 8,\n            horizontal: \"auto\",\n            vertical: \"visible\",\n            alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n          },\n          ...props.options,\n        } as EditorProps[\"options\"]\n      }\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","import { atom, Atom } from \"jotai\";\nimport { unwrap } from \"jotai/utils\";\nimport { Primitive } from \"zod\";\n\ntype WithLoading<T> = { value: T; isLoading: boolean };\n\nfunction getCached<T, K = object | Primitive>(\n  c: () => T,\n  m: K extends object ? WeakMap<K, T> : Map<K, T>,\n  k: K\n): T {\n  return (m.has(k) ? m : m.set(k, c())).get(k) as T;\n}\n\nconst cache1 = new WeakMap();\nconst memo2 = <T>(\n  create: () => T,\n  dep1: object,\n  dep2: object | Primitive\n): T => {\n  const cache2 = getCached(\n    () => (typeof dep2 === \"object\" ? new WeakMap() : new Map()),\n    cache1,\n    dep1\n  );\n  return getCached(create, cache2, dep2);\n};\nconst nullObj = {};\n\nexport function unwrapLatestWithLoading<T>(\n  anAtom: Atom<Promise<T>>\n): Atom<WithLoading<T> | Promise<WithLoading<T>>>;\nexport function unwrapLatestWithLoading<T>(\n  anAtom: Atom<Promise<T>>,\n  defaultValue: Exclude<Awaited<T>, undefined>\n): Atom<WithLoading<T>>;\nexport function unwrapLatestWithLoading<T>(\n  anAtom: Atom<Promise<T>>,\n  defaultValue?: Awaited<T>\n): Atom<WithLoading<T> | Promise<WithLoading<T>>> {\n  return memo2(\n    () => {\n      const freshAtom = atom(async (get) => ({\n        value: await get(anAtom),\n        isLoading: false,\n      }));\n      const unwrappedAtom = unwrap(freshAtom, (prev) => {\n        const fallback = prev === undefined ? defaultValue : prev.value;\n        return fallback !== undefined\n          ? { value: fallback, isLoading: true }\n          : undefined;\n      });\n      return atom((get) => get(unwrappedAtom) ?? get(freshAtom));\n    },\n    anAtom,\n    defaultValue ?? nullObj\n  );\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuOverlayFromOrigin,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useAction,\n  useActionGroup,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useRef, useState } from \"react\";\nimport { atom, useAtomValue, useSetAtom } from \"jotai\";\nimport * as path from \"path\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { fileContentAtom } from \"../fs/fs.state\";\nimport { useRefreshFileStatus } from \"../VersionControl/file-status.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { EditorZeroState } from \"./EditorZeroState\";\nimport { useEditorActionGroup } from \"./useEditorActionGroup\";\nimport {\n  activeEditorTabAtom,\n  editorCursorPositionState,\n  editorRefAtom,\n  useEditorState,\n} from \"./editor.state\";\nimport { Editor } from \"./Editor\";\nimport { unwrapLatestWithLoading } from \"../atom-utils/unwrapLatestWithLoading\";\n\nconst editorFullStateAtom = unwrapLatestWithLoading(\n  atom(async (get) => {\n    const activeEditorTab = get(activeEditorTabAtom);\n    return {\n      ...activeEditorTab,\n      content: await get(fileContentAtom(activeEditorTab?.filePath ?? null)),\n    };\n  })\n);\n\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const [editorTabs, editorStateManager] = useEditorState();\n  const editorRef = useRef<editor.ICodeEditor>();\n  const [active, setActive] = useState(false);\n  const [contextMenu, setContextMenu] =\n    useState<editor.IEditorMouseEvent | null>(null);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetAtom(editorCursorPositionState);\n\n  const {\n    value: { content, filePath },\n    isLoading: isContentLoading,\n  } = useAtomValue(editorFullStateAtom);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items)\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOtherTabs,\n  });\n\n  const setEditorRef = useSetAtom(editorRefAtom);\n\n  const setContent = useSetAtom(fileContentAtom(filePath ?? null));\n  const updateFileStatus = useRefreshFileStatus();\n\n  const editorActionGroupDefinition = useEditorActionGroup(editorRef);\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (filePath) {\n      updateFileStatus(filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n\n  const activePathsProviderProps = useActivePathsProvider(\n    filePath ? [filePath] : []\n  );\n\n  return (\n    <ActionsProvider actions={[editorActionGroupDefinition]}>\n      {({ shortcutHandlerProps }) => (\n        <StyledFileEditorContainer\n          {...mergeProps(activePathsProviderProps, shortcutHandlerProps, {\n            onFocus: () => {\n              setActive(true);\n              setEditorRef({\n                focus: () => editorRef.current?.focus(),\n              });\n            },\n          })}\n        >\n          {editorTabs.length > 0 ? (\n            <>\n              <ContextMenuContainer\n                renderMenu={() => (\n                  <Menu\n                    // TODO: detect which tab was triggering context menu and handle the action accordingly\n                    //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n                    //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n                    //  modified to pass the MouseEvent object, in renderMenu.\n                    onAction={notImplemented}\n                  >\n                    <Item key=\"close\">Close</Item>\n                    <Item key=\"closeOthers\">Close Other tabs</Item>\n                    <Item key=\"closeAll\">Close all tabs</Item>\n                    <Item key=\"closeLeft\">Close tabs to the left</Item>\n                    <Item key=\"closeRight\">Close tabs to the right</Item>\n                  </Menu>\n                )}\n              >\n                <EditorTabs\n                  items={editorTabs}\n                  active={active}\n                  selectedKey={filePath}\n                  onSelectionChange={(key) => {\n                    editorStateManager.select(\n                      editorTabs.findIndex((tab) => tab.filePath === key)\n                    );\n                  }}\n                  noBorders\n                >\n                  {(tab) => {\n                    const filename = path.basename(tab.filePath);\n                    const icon = (\n                      <PlatformIcon icon={getIconForFile(tab.filePath)} />\n                    );\n                    return (\n                      <TabItem\n                        key={tab.filePath}\n                        textValue={filename}\n                        inOverflowMenu={\n                          <MenuItemLayout content={filename} icon={icon} />\n                        }\n                      >\n                        <TooltipTrigger\n                          tooltip={<ActionTooltip actionName={tab.filePath} />}\n                        >\n                          <EditorTabContent\n                            icon={icon}\n                            title={\n                              <FileStatusColor filepath={tab.filePath}>\n                                {filename}\n                              </FileStatusColor>\n                            }\n                            closeButton={\n                              <TooltipTrigger\n                                tooltip={\n                                  <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                                }\n                              >\n                                <TabCloseButton\n                                  onPress={(e) => {\n                                    if (e.altKey) {\n                                      tabActionsRef.current.closeOthersTabs(\n                                        editorTabs.indexOf(tab)\n                                      );\n                                    } else {\n                                      tabActionsRef.current.closePath(\n                                        tab.filePath\n                                      );\n                                    }\n                                  }}\n                                />\n                              </TooltipTrigger>\n                            }\n                            containerProps={{\n                              onDoubleClick: () => {\n                                hideAllAction?.perform();\n                              },\n                            }}\n                          />\n                        </TooltipTrigger>\n                      </TabItem>\n                    );\n                  }}\n                </EditorTabs>\n              </ContextMenuContainer>\n              {typeof content === \"string\" ? (\n                /**\n                 * ## Note\n                 * TLDR: Keeping the editor mounted when filePath changes is intentional and does matter.\n                 *\n                 * Whether the editor component is kept mounted as tabs change or not has nuances that can lead to minor\n                 * focus issues. For example calling editorStateManager.focus() may do nothing if the editor is unmounted due\n                 * to filePath being changed. focusing editor in createFile action is an example of such case. It also affects\n                 * certain focus management code within the FileEditor. For example, focusing the editor on tab changes will\n                 * be necessary if the editor remounts with each file change. Or autofocus behavior of the editor can be\n                 * done on the onMount callback of the Editor component, if it's only mounted once. But the same code leads\n                 * to focus issues if the editor is mounted on active tab changes, when they are not done via the tab UI,\n                 * but as a side effect of another action like opening a file via Project tool window.\n                 *\n                 */\n                <Editor\n                  height=\"100%\"\n                  path={filePath}\n                  options={{ contextmenu: false }}\n                  onMount={(monacoEditor, monaco) => {\n                    monacoEditor.focus();\n                    monacoEditor.onContextMenu((c) => {\n                      c.event.preventDefault();\n                      // opening contextmenu async, because otherwise the editor takes the focus back\n                      // from the menu, right after it's opened.\n                      Promise.resolve().then(() => {\n                        setContextMenu(c);\n                      });\n                    });\n                    monacoEditor.onDidScrollChange(() => {\n                      // It doesn't seem easy to disable scroll on Monaco editor, so just closing the context menu on\n                      // scroll, just like the default Monaco context menu.\n                      setContextMenu(null);\n                    });\n                    enableJsx(monaco);\n                    editorRef.current = monacoEditor;\n                    monacoEditor.onDidChangeCursorPosition((e) => {\n                      setCursorPositionState(e.position);\n                    });\n                    monacoEditor.onDidChangeModel(() => {\n                      // TODO: set the editor tab state, and add an atom effect to persist whole editor state across loads\n                    });\n                  }}\n                  onChange={updateContent}\n                  value={content ?? \"\"}\n                />\n              ) : (\n                content && \"UNSUPPORTED CONTENT\"\n              )}\n            </>\n          ) : (\n            <EditorZeroState />\n          )}\n          {isContentLoading && <FileEditorLoading />}\n          {contextMenu && (\n            <MenuOverlayFromOrigin\n              origin={contextMenu.event.browserEvent}\n              onClose={() => setContextMenu(null)}\n            >\n              <EditorActionGroupMenu />\n            </MenuOverlayFromOrigin>\n          )}\n        </StyledFileEditorContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n\nfunction EditorActionGroupMenu() {\n  const actionGroup = useActionGroup(\"EditorPopupMenu\");\n  if (!actionGroup) {\n    return null; // Replace with a placeholder \"Nothing to show\" menu\n  }\n  return (\n    <ActionGroupMenu actionGroup={actionGroup}>\n      {(menuProps) => (\n        <Menu\n          autoFocus={\n            // To avoid autofocusing the first item.\n            true\n          }\n          {...menuProps}\n        />\n      )}\n    </ActionGroupMenu>\n  );\n}\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, Getter, Setter } from \"jotai\";\nimport { atomWithDefault, useAtomCallback } from \"jotai/utils\";\nimport { currentProjectAtom, Project } from \"../Project/project.state\";\nimport { dirContentAtom, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport { vcsRootsAtom } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom(true);\n\nexport const expandedKeysAtom = atomWithDefault(\n  (get) =>\n    new Set<Key>(\n      get(vcsRootsAtom)\n        .flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n        .concat(get(currentProjectAtom).path)\n    )\n);\n\nexport const selectionAtom = atom<Selection>(new Set<Key>([]));\n\nexport const selectedNodesAtom = atom(\n  async (get): Promise<ReadonlyArray<ProjectTreeNode>> => {\n    const selection = get(selectionAtom);\n    const nodesByKey = (await get(currentProjectTreeAtom)).byKey;\n    const selectedKeys = selection === \"all\" ? nodesByKey.keys() : selection;\n    return [...selectedKeys]\n      .map((key) => nodesByKey.get(`${key}`))\n      .filter(notNull);\n  }\n);\n\nexport const projectViewTreeRefAtom = atom<RefObject<TreeRefValue>>(\n  React.createRef<TreeRefValue>()\n);\n\nexport const currentProjectTreeAtom = atom((get) => {\n  const project = get(currentProjectAtom);\n  return createProjectTree(project, get);\n});\n\ntype FilesTreeSort = \"name\"; // more to be added\n\n// TODO: add more sort options and add \"Tree Appearance\" option in Project tool window settings menu.\nexport const projectTreeSortAtom = atom<FilesTreeSort>(\"name\");\n\n/**\n * NOTE: using in-place native sort for performance.\n * See more https://www.measurethat.net/Benchmarks/Show/6698/0/ramda-sort-vs-js-native-sort\n */\nfunction sortProjectTreeNodes(items: FileTreeNode[]): void {\n  // TODO: add sortBy: FileTreeSort parameter\n  // TODO: add directoriesOnTop: boolean parameter\n  items.sort((item1, item2) => {\n    if (item1.name < item2.name) {\n      return -1;\n    }\n    if (item1.name > item2.name) {\n      return 1;\n    }\n    return 0;\n  });\n}\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: Getter\n): Promise<{ root: ProjectTreeRoot; byKey: Map<string, ProjectTreeNode> }> {\n  const rootItems = await get(dirContentAtom(project.path));\n  const byKey = new Map<string, ProjectTreeNode>();\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const node = {\n        ...item,\n        parent,\n      };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          const dirNode: FileTreeDirNode = { ...node, children: [] };\n          dirNode.children = (\n            await Promise.all(\n              ((await get(dirContentAtom(item.path))) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          sortProjectTreeNodes(dirNode.children);\n          byKey.set(dirNode.path, dirNode);\n          return dirNode;\n        }\n        return null;\n      }\n      byKey.set(node.path, node);\n      return node;\n    };\n\n  const children = (\n    await Promise.all((rootItems || []).map(mapItem(null)))\n  ).filter(notNull);\n  sortProjectTreeNodes(children);\n  const root: ProjectTreeNode = {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children,\n  };\n  byKey.set(root.path, root);\n  return { root, byKey };\n}\n\n/**\n * atom callback for expanding to a certain path in project view.\n */\nexport const expandToPathCallback = (\n  get: Getter,\n  set: Setter,\n  path: string\n) => {\n  const expandedKeys = get(expandedKeysAtom);\n  const keysToExpand = [get(currentProjectAtom).path].concat(\n    getParentPaths(path)\n  );\n  set(expandedKeysAtom, new Set([...expandedKeys, ...keysToExpand]));\n};\n\n/**\n * a function to be passed to useAtomCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n */\nexport const selectKeyAndFocusCallback = (\n  get: Getter,\n  set: Setter,\n  key: Key\n) => {\n  const treeRef = get(projectViewTreeRefAtom)?.current;\n  treeRef?.replaceSelection(key);\n  treeRef?.focus(key);\n};\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useAtomCallback(expandToPathCallback);\n  const selectKeyAndFocus = useAtomCallback(selectKeyAndFocusCallback);\n  return (path: string) => {\n    // TODO: open project view tool window if needed\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","export const projectActionIds = {\n  NewElement: \"NewElement\",\n  NewFile: \"NewFile\",\n  NewDir: \"NewDir\",\n  CopyReferencePopupGroup: \"CopyReferencePopupGroup\",\n  CopyPaths: \"CopyPaths\",\n  CopyFileReference: \"CopyFileReference\",\n  CopyAbsolutePath: \"CopyAbsolutePath\",\n  CopySourceRootPath: \"CopySourceRootPath\",\n  CopyFileName: \"CopyFileName\",\n};\n","import {\n  ActionContext,\n  ActionsMenu,\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport React from \"react\";\nimport { projectActionIds } from \"../Project/projectActionIds\";\n\nexport function ProjectViewContextMenu({\n  getActionContext,\n}: {\n  getActionContext: () => ActionContext;\n}) {\n  return (\n    <ActionsMenu\n      aria-label=\"Project Tree actions\"\n      actionContext={getActionContext}\n      actions={[\n        {\n          ...useAction(projectActionIds.NewElement)!,\n          title: \"New\",\n          shortcut: undefined,\n        },\n        new DividerItem(),\n        useAction(CommonActionId.CUT),\n        useAction(CommonActionId.COPY),\n        useAction(projectActionIds.CopyReferencePopupGroup),\n        useAction(CommonActionId.PASTE),\n        new DividerItem(),\n        useAction(CommonActionId.DELETE),\n        new DividerItem(),\n      ].filter(notNull)}\n    />\n  );\n}\n","import { atom, Atom } from \"jotai\";\nimport { unwrap } from \"jotai/utils\";\n\n/**\n * Returns a memoized version of the input function based on it's single argument.\n * Useful for making an atom wrapper pure (by caching the output based on input),\n * to make it usable directly inside components without useMemo.\n * @param fn\n */\nconst memoized = <Fn extends (...args: any[]) => any>(fn: Fn): Fn => {\n  const _cache = new WeakMap<Parameters<Fn>[0], ReturnType<Fn>>();\n  return ((arg1: Parameters<Fn>[0]) => {\n    let result = _cache.get(arg1);\n    if (result === undefined) {\n      result = fn(arg1);\n      _cache.set(arg1, result!);\n    }\n    return result;\n  }) as Fn;\n};\n/**\n * Creates an atom that suspends rendering only the first time `anAtom` is\n * being resolved.\n * In subsequent resolutions of `anAtom`, the resulting atom will unwrap to the\n * latest resolved value.\n */\nexport const unwrapLatest = memoized(\n  <T>(anAtom: Atom<Promise<T>>): Atom<T | Promise<T>> => {\n    const unwrappedAtom = unwrap(anAtom, (prev) => prev);\n    return atom((get) => get(unwrappedAtom) ?? get(anAtom));\n  }\n);\n/**\n * Creates an atom that unwraps an async atom to its latest resolved value,\n * or `null` when the value is being resolved for the first time.\n */\nexport const unwrapLatestOrNull = memoized(\n  <T>(anAtom: Atom<Promise<T>>): Atom<T | null> =>\n    unwrap(anAtom, (prev) => prev ?? null)\n);\n","import {\n  ActionContext,\n  ContextMenuContainer,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectAtom,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeAtom,\n  expandedKeysAtom,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefAtom,\n  selectionAtom,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { ProjectViewContextMenu } from \"./ProjectViewContextMenu\";\n\nimport { unwrapLatest } from \"../atom-utils/unwrapLatest\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useAtomValue(currentProjectAtom);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetAtom(projectViewTreeRefAtom);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const treeState = useAtomValue(unwrapLatest(currentProjectTreeAtom));\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtom);\n  const [selectedKeys, setSelectedKeys] = useAtom(selectionAtom);\n  const foldersOnTop = useAtom(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contextMenuTargetKey = useRef<string | undefined>();\n\n  /**\n   * A (temporary?) non-straightforward way to position popups (action groups with \"none\" menuPresentation\")\n   * relative to the tree node content.\n   * It's implemented like this because the context menu API at the moment is too generic and disconnected from\n   * components like Tree.\n   * At minimum, this logic here can be extracted into a wrapper like TreeContextMenuContainer for reusability.\n   */\n  const getActionContext = (): ActionContext => {\n    return {\n      element:\n        containerRef.current?.querySelector(\n          `[data-key=\"${contextMenuTargetKey.current}\"]`\n        ) ?? null,\n      event: null,\n    };\n  };\n\n  return (\n    <DefaultSuspense>\n      {treeState.root && (\n        <ContextMenuContainer\n          ref={containerRef}\n          style={{ height: \"100%\" }}\n          onOpen={({ target }) =>\n            (contextMenuTargetKey.current =\n              target?.closest<HTMLElement>(\"[data-key]\")?.dataset.key)\n          }\n          renderMenu={() => {\n            return (\n              <ProjectViewContextMenu getActionContext={getActionContext} />\n            );\n          }}\n        >\n          <SpeedSearchTree\n            aria-label=\"Project structure tree\"\n            treeRef={treeRef}\n            {...activePathsProviderProps}\n            items={[treeState.root] as ProjectTreeNode[]}\n            onAction={(path) => {\n              editor.openPath(`${path}`);\n            }}\n            fillAvailableSpace\n            autoFocus\n            selectionMode=\"multiple\"\n            selectedKeys={selectedKeys}\n            onSelectionChange={setSelectedKeys}\n            expandedKeys={expandedKeys}\n            onExpandedChange={setExpandedKeys}\n          >\n            {(item) => (\n              <Item\n                key={item.path}\n                textValue={item.name}\n                childItems={\n                  \"children\" in item ? sortItems(item.children) : undefined\n                }\n              >\n                <ItemLayout>\n                  {<ProjectViewNodeIcon node={item} />}\n                  {item.type === \"project\" ? (\n                    <>\n                      <b>\n                        <HighlightedTextValue />\n                      </b>\n                      <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                    </>\n                  ) : (\n                    <FileTreeNodeText node={item} />\n                  )}\n                  {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n                </ItemLayout>\n              </Item>\n            )}\n          </SpeedSearchTree>\n        </ContextMenuContainer>\n      )}\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","import React from \"react\";\nimport {\n  Button,\n  ButtonProps,\n  HelpTooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nexport function HelpButton({\n  tooltip = \"Show help contents\",\n  ...props\n}: Omit<ButtonProps, \"variant\" | \"children\"> & { tooltip?: string }) {\n  return (\n    <TooltipTrigger tooltip={<HelpTooltip helpText={tooltip} />}>\n      <Button\n        variant=\"icon\"\n        aria-label=\"Help\"\n        aria-description=\"Show help contents\"\n        {...props}\n      >\n        <span style={{ fontSize: 18 }}>?</span>\n      </Button>\n    </TooltipTrigger>\n  );\n}\n","import path from \"path\";\nimport { identity } from \"ramda\";\n\nexport function isParentPath(parent: string, dir: string) {\n  return dir.startsWith(parent + path.sep); // is this good enough, or do we need the code below?\n  // const relative = path.relative(parent, dir);\n  // return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n}\n\n/**\n * Given a list of paths, returns a subset of them, where nested paths are removed.\n * @example findRoots(['/a/b/c/x.txt', '/a/b', '/a/b/c', '/a/b/y.ts']); // ['/a/b']\n * @example findRoots([{p: '/a/b'}, {p: '/a'}]); // [{p: '/a'}]\n */\nexport function findRootPaths(paths: readonly string[]): string[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string\n): T[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string = identity as (obj: T) => string\n): T[] {\n  return objects.filter((obj) => {\n    const thePath = getPath(obj);\n    return !objects.find(\n      (anObject) => anObject !== obj && isParentPath(getPath(anObject), thePath)\n    );\n  });\n}\n","import { Getter, Setter } from \"jotai\";\nimport {\n  refreshFileStatusCallback,\n  vcsFootForFileAtom,\n} from \"../VersionControl/file-status.state\";\nimport { editorManagerAtom } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\nimport git from \"isomorphic-git\";\nimport path from \"path\";\nimport { dirContentAtom, fileContentAtom } from \"../fs/fs.state\";\nimport { ensureDir } from \"../fs/fs-utils\";\n\nexport const deleteFileCallback = async (\n  get: Getter,\n  set: Setter,\n  filepath: string\n) => {\n  try {\n    await fs.promises.unlink(filepath);\n    const repoDir = await get(vcsFootForFileAtom(filepath));\n    if (repoDir) {\n      await git.remove({\n        fs,\n        dir: repoDir,\n        filepath: path.relative(repoDir, filepath),\n      });\n      await refreshFileStatusCallback(get, set, filepath); // TODO(fs.watch): better done separately using fs.watch\n    }\n  } catch (e) {\n    console.error(`error in deleting file ${filepath}`, e);\n  } finally {\n    const editor = get(editorManagerAtom);\n    editor.closePath(filepath); // TODO(fs.watch): better done as an effect on editorState, using fs.watch. But fs.watch is not available at the moment.\n    set(dirContentAtom(path.dirname(filepath))); // TODO(fs.watch): better done separately using fs.watch\n    set(fileContentAtom(filepath)); // TODO(fs.watch): better done separately using fs.watch\n  }\n};\n\nexport const deleteFilesCallback = async (\n  get: Getter,\n  set: Setter,\n  filePaths: string[]\n) => {\n  // TODO: use task API\n  // An attempt to make this transactional failed, since it requires passing `set` and `reset` from transact function\n  // to deleteFileCallback, and {...callbackInterface, set, reset} didn't work , since callbackInterface is a proxy object\n  return Promise.all(\n    filePaths.map((filePath) => deleteFileCallback(get, set, filePath))\n  );\n};\n\nexport const deleteDirCallback = async (\n  get: Getter,\n  set: Setter,\n  dir: string\n) => {\n  // TODO: use task API\n  const recursivelyDeleteDir = async (dirname: string) => {\n    const pathnames = await fs.promises.readdir(dirname);\n    await Promise.all(\n      pathnames.map(async (pathname) => {\n        const fullpath = path.resolve(dirname, pathname);\n        const stat = await fs.promises.stat(fullpath);\n        if (stat.isFile()) {\n          // potential improvement: refreshing dir content could wait until all files are deleted.\n          await deleteFileCallback(get, set, fullpath);\n        } else if (stat.isDirectory()) {\n          await recursivelyDeleteDir(fullpath);\n        }\n      })\n    );\n    await fs.promises.rmdir(dirname);\n    set(dirContentAtom(dir));\n  };\n  try {\n    await recursivelyDeleteDir(dir);\n  } catch (e) {\n    console.error(`error in deleting directory ${dir}`, e);\n  } finally {\n    set(dirContentAtom(path.dirname(dir))); // TODO(fs.watch): better done separately using fs.watch\n  }\n};\n\nexport const createFileCallback = async (\n  get: Getter,\n  set: Setter,\n  destinationDir: string,\n  filename: string\n) => {\n  const filePath = path.join(destinationDir, filename);\n  await ensureDir(fs.promises, path.dirname(filePath));\n  if (await fs.promises.exists(filePath)) {\n    throw new Error(`File ${filePath} already exists`);\n  }\n  await fs.promises.writeFile(filePath, \"\", \"utf-8\");\n  set(fileContentAtom(filePath)); // TODO(fs.watch): better done in an atom effect\n  get(editorManagerAtom).openPath(filePath);\n  await refreshFileStatusCallback(get, set, filePath);\n  set(dirContentAtom(destinationDir));\n};\n\nexport const createDirectoryCallback = async (\n  _get: Getter,\n  set: Setter,\n  destination: string,\n  dirPath: string\n) => {\n  const fullpath = path.join(destination, dirPath);\n  if (await fs.promises.exists(fullpath)) {\n    throw new Error(`File ${fullpath} already exists`);\n  }\n  await ensureDir(fs.promises, fullpath);\n  set(dirContentAtom(destination));\n};\n","import { Atom } from \"jotai\";\n\nexport type MaybeAtom<T> = T | Atom<T>;\nexport type MaybeAtomAsync<T> = T | Atom<T | Promise<T>>;\n\nexport const isAtom = <T>(value: MaybeAtom<T>): value is Atom<T> =>\n  typeof value === \"object\" && value !== null && \"read\" in value;\n","import { atom, Getter, Setter, WritableAtom } from \"jotai\";\nimport { unwrap } from \"jotai/utils\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { isAtom, MaybeAtom, MaybeAtomAsync } from \"./atom-utils/isAtom\";\n\ntype PerformActionArgs = Parameters<ActionDefinition[\"actionPerformed\"]>;\n/**\n *\n */\nexport const actionAtom = <T>({\n  isSearchable: isSearchableValue,\n  isDisabled: isDisabledValue,\n  actionPerformed,\n  ...params\n}: Omit<ActionDefinition, \"actionPerformed\" | \"isDisabled\" | \"isSearchable\"> & {\n  actionPerformed: (\n    state: { get: Getter; set: Setter },\n    ...args: PerformActionArgs\n  ) => void | Promise<void>;\n  isDisabled?: MaybeAtomAsync<boolean>;\n  isSearchable?: MaybeAtomAsync<boolean>;\n}): WritableAtom<ActionDefinition, PerformActionArgs, Promise<void>> => {\n  const isDisabled = isAtom(isDisabledValue)\n    ? unwrap(isDisabledValue, () => true)\n    : isDisabledValue;\n  const isSearchable = isAtom(isSearchableValue)\n    ? unwrap(isSearchableValue, () => false)\n    : isSearchableValue;\n\n  return atom(\n    (get, { setSelf }): ActionDefinition => {\n      const resolve = <T>(maybeAtom: MaybeAtom<T> | undefined) => {\n        return isAtom(maybeAtom) ? get(maybeAtom) : maybeAtom;\n      };\n\n      return {\n        ...params,\n        isDisabled: resolve(isDisabled),\n        isSearchable: resolve(isSearchable),\n        actionPerformed: setSelf,\n      };\n    },\n    async (get, set, ...args: PerformActionArgs) => {\n      return actionPerformed({ get, set }, ...args);\n    }\n  );\n};\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport React from \"react\";\n\nimport {\n  Button,\n  Checkbox,\n  CommonActionId,\n  ModalWindow,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { HelpButton } from \"../../HelpButton\";\nimport {\n  activePathExistsAtom,\n  alertDialogRefAtom,\n  windowManagerRefAtom,\n} from \"../../Project/project.state\";\nimport { selectedNodesAtom } from \"../ProjectView.state\";\nimport { findRootPaths } from \"../../path-utils\";\nimport {\n  deleteDirCallback,\n  deleteFilesCallback,\n} from \"../../Project/fs-operations\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { actionAtom } from \"../../actionAtom\";\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nconst dirCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 directory}\n    other {# directories}\n  }`,\n  \"en-US\"\n);\n\nexport const deleteActionAtom = actionAtom({\n  id: CommonActionId.DELETE,\n  title: \"Delete\",\n  description: \"Delete selected item\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get, set }) => {\n    const selectedNodes = await get(selectedNodesAtom);\n    const windowManager = get(windowManagerRefAtom).current;\n    const alertDialog = get(alertDialogRefAtom).current;\n    if (selectedNodes.length === 0) {\n      return;\n    }\n    const nodesToDelete = findRootPaths(selectedNodes, (node) => node.path);\n    const filePaths = nodesToDelete\n      .filter((node) => node.type === \"file\")\n      .map((node) => node.path);\n    const directories = nodesToDelete\n      .filter((node) => node.type === \"project\" || node.type === \"dir\")\n      .map((node) => node.path);\n\n    if (directories.length > 0) {\n      const singleDirName =\n        directories.length === 1 && filePaths.length === 0\n          ? path.basename(directories[0])\n          : null;\n\n      const confirmed = await alertDialog?.confirm({\n        title: \"Delete\",\n        okText: \"Delete\",\n        message: (\n          <div style={{ width: 354 }}>\n            Delete{\" \"}\n            {singleDirName\n              ? `\"${singleDirName}\"`\n              : [\n                  { count: directories.length, message: dirCountMsg },\n                  { count: filePaths.length, message: fileCountMsg },\n                ]\n                  .filter(({ count }) => count > 0)\n                  .map(({ message, count }) => message.format({ count }))\n                  .join(\" and \")}\n            ?\n            <br />\n            All files and subdirectories in\n            {singleDirName\n              ? ` \"${singleDirName}\" `\n              : \" the selected directories \"}\n            will be deleted. <br />\n            You might not be able to fully undo this operation!\n          </div>\n        ),\n      });\n      if (confirmed) {\n        await Promise.all([\n          ...directories.map((pathname) =>\n            deleteDirCallback(get, set, pathname)\n          ),\n          deleteFilesCallback(get, set, filePaths),\n        ]);\n      }\n    } else {\n      windowManager\n        ?.open<boolean>(({ close }) => (\n          <DeleteFilesConfirmationDialog filePaths={filePaths} close={close} />\n        ))\n        .then((confirmed) => {\n          if (confirmed) {\n            requestAnimationFrame(() => {\n              // It's important that the focus is restored to the previously focused item, which typically is the\n              // file in project view, that's being deleted.\n              // If the file is deleted before the focus is restored, the DOM element that was going to be focused\n              // will be removed by the time focus restoration logic runs.\n              // Even though `windowManager.open()` was changed to return a promise which is supposed to be resolved\n              // **after** the modal window is closed,\n              // in the CI environment the focus is not properly restored.\n              // In lack of a better solution, the deletion is done async with a setTimeout.\n              deleteFilesCallback(get, set, filePaths);\n            });\n          }\n        });\n    }\n  },\n});\n\nfunction DeleteFilesConfirmationDialog({\n  close,\n  filePaths,\n}: {\n  close: (confirmed?: true) => void;\n  filePaths: string[];\n}) {\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Delete\"\n        content={\n          <form\n            id=\"delete_dialog_form\"\n            onSubmit={(e) => {\n              e.preventDefault();\n            }}\n            style={{\n              padding: \"0.75rem 1rem\",\n            }}\n          >\n            <div style={{ marginBottom: \".5rem\" }}>\n              {filePaths.length === 1\n                ? `Delete file \"${path.basename(filePaths[0])}\"`\n                : `Delete ${filePaths.length} files`}\n              ?\n            </div>\n            <div\n              style={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                gap: \"0.25rem\",\n              }}\n            >\n              <Checkbox isDisabled>Safe delete (with usage search)</Checkbox>\n              <div style={{ display: \"flex\", gap: \"1rem\" }}>\n                <Checkbox isDisabled>Search in comments and strings</Checkbox>\n                <Checkbox isDisabled>Search for text occurrences</Checkbox>\n              </div>\n            </div>\n          </form>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<HelpButton onPress={() => notImplemented()}></HelpButton>}\n            right={\n              <>\n                <Button onPress={() => close()}>Cancel</Button>\n                <Button\n                  autoFocus\n                  type=\"submit\"\n                  form=\"delete_dialog_form\" // Using form in absence of built-in support for default button\n                  variant=\"default\"\n                  onPress={() => {\n                    close(true);\n                  }}\n                >\n                  Ok\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport { atom } from \"jotai\";\nimport { CommonActionId, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsAtom } from \"../../Project/project.state\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyActionAtom = actionAtom({\n  id: CommonActionId.COPY,\n  title: \"Copy\",\n  description: \"Copy to clipboard\",\n  icon: <PlatformIcon icon=\"actions/copy\" />,\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async () => {\n    notImplemented();\n  },\n});\n","import React from \"react\";\nimport { atom } from \"jotai\";\nimport { CommonActionId, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsAtom } from \"../../Project/project.state\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const cutActionAtom = actionAtom({\n  id: CommonActionId.CUT,\n  title: \"Cut\",\n  description: \"Cut to clipboard\",\n  icon: <PlatformIcon icon=\"actions/menu-cut\" />,\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async () => {\n    notImplemented();\n  },\n});\n","import React from \"react\";\nimport { atom } from \"jotai\";\nimport { CommonActionId, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsAtom } from \"../../Project/project.state\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const pasteActionAtom = actionAtom({\n  id: CommonActionId.PASTE,\n  title: \"Paste\",\n  description: \"Paste from clipboard\",\n  icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async () => {\n    notImplemented();\n  },\n});\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\n\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport {\n  projectViewTreeRefAtom,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabAtom } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\nimport { deleteActionAtom } from \"./actions/deleteAction\";\nimport { copyActionAtom } from \"./actions/copyAction\";\nimport { cutActionAtom } from \"./actions/cutAction\";\nimport { pasteActionAtom } from \"./actions/pasteAction\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useAtomValue(projectViewTreeRefAtom);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useAtomValue(activeEditorTabAtom);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n    useAtomValue(deleteActionAtom), // could have been on project level, if it could handle delete in editor as well\n    useAtomValue(cutActionAtom),\n    useAtomValue(copyActionAtom),\n    useAtomValue(pasteActionAtom),\n  ].filter(notNull);\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React, { ReactNode, useEffect, useState } from \"react\";\n\nconst DEFAULT_LOADING_DELAY_MS = 500; // To be shared later in more places.\nexport function Delayed({ children }: { children: ReactNode }) {\n  const [waitedEnough, setWaitedEnough] = useState(false);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setWaitedEnough(true);\n    }, DEFAULT_LOADING_DELAY_MS);\n    return () => clearTimeout(timer);\n  }, []);\n  if (waitedEnough) {\n    return <>{children}</>;\n  }\n  return null;\n}\n","import { FileStatus } from \"../file-status\";\nimport { dirname } from \"path\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n  hash?: string;\n  content(): Promise<string>;\n};\n\ndeclare const __tag: unique symbol;\n\ntype ChangeVariant<T extends { type: string }> = T & {\n  /**\n   * A non-exported tag is used to make opaque types that can only be created by Change function, following\n   * \"parse, don't validate\" rule, enforcing certain rules that defines the change type based on the\n   * presence and properties of the before and after revisions.\n   */\n  readonly [__tag]: any;\n};\n\n/**\n * Represents a file being moved from one directory to another, which may or may not have been renamed too.\n */\nexport type MoveChange = ChangeVariant<{\n  type: \"MOVED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being renamed withing the same directory.\n */\nexport type RenameChange = ChangeVariant<{\n  type: \"RENAMED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being changed, but not moved or renamed.\n */\nexport type ModificationChange = ChangeVariant<{\n  type: \"MODIFIED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a path being deleted.\n */\nexport type DeletionChange = ChangeVariant<{\n  type: \"DELETED\";\n  before: Revision;\n}>;\n\n/**\n * Represents a new file\n */\nexport type AdditionChange = ChangeVariant<{\n  type: \"ADDED\";\n  after: Revision;\n}>;\n\n/**\n * Represents an unversioned (new) file. In git terms, a file that doesn't exist in index or HEAD.\n */\nexport type UnversionedChange = ChangeVariant<{\n  type: \"UNVERSIONED\";\n  after: Revision;\n}>;\n\nexport type AnyChange =\n  | AdditionChange\n  | MoveChange\n  | RenameChange\n  | ModificationChange\n  | DeletionChange\n  | UnversionedChange;\n\nconst Tagged = <T>(change: T): T & { [__tag]: any } =>\n  change as T & { [__tag]: any };\n\n/**\n * Creates change objects from before and after revisions. It creates the right type of change\n * depending on the presence and properties of `before` and `after` revisions.\n * Note: Use Change.Unversioned(revision) to create unversioned changes.\n */\nexport function Change(before: null, after: Revision): Readonly<AdditionChange>;\nexport function Change(before: Revision, after: null): Readonly<DeletionChange>;\nexport function Change(\n  before: Revision,\n  after: Revision\n): Readonly<ModificationChange | RenameChange | MoveChange>;\nexport function Change(\n  before: Revision | null,\n  after: Revision | null\n): AnyChange {\n  if (after) {\n    if (!before) {\n      return Tagged({\n        type: \"ADDED\",\n        after,\n      });\n    }\n    if (before.path !== after.path) {\n      if (dirname(before.path) === dirname(after.path)) {\n        return Tagged({\n          type: \"RENAMED\",\n          before,\n          after,\n        });\n      } else {\n        return Tagged({\n          type: \"MOVED\",\n          before,\n          after,\n        });\n      }\n    }\n    return Tagged({\n      type: \"MODIFIED\",\n      before,\n      after,\n    });\n  } else {\n    return Tagged({\n      type: \"DELETED\",\n      before: before!, // \"!\" because typescript has an issue recognizing after and before can't be null simultaneously\n    });\n  }\n}\n\n/**\n * Creates an unversioned change object\n */\nChange.Unversioned = (revision: Revision): UnversionedChange => {\n  return Tagged({\n    type: \"UNVERSIONED\",\n    after: revision,\n  });\n};\n\nconst changeToFileStatus: Record<AnyChange[\"type\"], FileStatus> = {\n  ADDED: \"ADDED\",\n  DELETED: \"DELETED\",\n  MOVED: \"MODIFIED\",\n  RENAMED: \"MODIFIED\",\n  MODIFIED: \"MODIFIED\",\n  UNVERSIONED: \"UNKNOWN\",\n};\n\n/**\n * @returns {@link FileStatus} corresponding to the change type\n */\nChange.fileStatus = function (change: AnyChange): FileStatus {\n  return changeToFileStatus[change.type] ?? \"NOT_CHANGED\";\n};\n\n/**\n * @returns the `after` path if the change is not a deletion, and `before` path, otherwise.\n */\nChange.path = function (change: AnyChange): string {\n  return Change.revision(change).path;\n};\n\nChange.content = function (change: AnyChange): Promise<string> {\n  if (\"after\" in change) {\n    return change.after.content();\n  }\n  if (\"before\" in change) {\n    return change.before.content();\n  }\n  return Promise.resolve(\"\");\n};\n\n/**\n * type-guard returning filter for addition change\n */\nChange.isAddition = function (change: AnyChange): change is AdditionChange {\n  return change.type === \"ADDED\";\n};\n\n/**\n * type-guard returning filter for deletion change\n */\nChange.isDeletion = function (change: AnyChange): change is DeletionChange {\n  return change.type === \"DELETED\";\n};\n\n/**\n * type-guard returning filter for rename change\n */\nChange.isRename = function (change: AnyChange): change is RenameChange {\n  return change.type === \"RENAMED\";\n};\n\n/**\n * type-guard returning filter for move change\n */\nChange.isMove = function (change: AnyChange): change is MoveChange {\n  return change.type === \"MOVED\";\n};\n\n/**\n * type-guard returning filter for modification change.\n */\nChange.isModified = function (change: AnyChange): change is ModificationChange {\n  return change.type === \"MODIFIED\";\n};\n\n/**\n * type-guard returning filter for unversioned change.\n */\nChange.isUnversioned = function (\n  change: AnyChange\n): change is UnversionedChange {\n  return change.type === \"UNVERSIONED\";\n};\n\n/**\n * @returns the `after` revision if the change is not a deletion, and `before` revision, otherwise.\n */\nChange.revision = function (change: AnyChange): Revision {\n  return \"after\" in change ? change.after : change.before;\n};\n\nChange.equals = function (a: AnyChange, b: AnyChange): boolean {\n  const sameBefore =\n    \"before\" in a && \"before\" in b\n      ? revisionEquals(a.before, b.before)\n      : \"before\" in a === \"before\" in b;\n  const sameAfter =\n    \"after\" in a && \"after\" in b\n      ? revisionEquals(a.after, b.after)\n      : \"after\" in a === \"after\" in b;\n  return sameBefore && sameAfter;\n};\n\nfunction revisionEquals(a: Revision, b: Revision) {\n  return a?.path === b?.path && a.isDir === b.isDir;\n}\n","import { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, useAtomCallback } from \"jotai/utils\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport git, { checkout, resetIndex } from \"isomorphic-git\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { dirContentAtom, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { fs } from \"../../fs/fs\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { editorManagerAtom } from \"../../Editor/editor.state\";\nimport {\n  refreshFileStatusCallback,\n  repoStatusAtoms,\n  vcsFootForFileAtom,\n  vcsRootsAtom,\n} from \"../file-status.state\";\nimport { AnyChange, Change } from \"./Change\";\n\nconst repoChangesAtoms = atomFamily((repoDir: string) =>\n  atom((get): AnyChange[] =>\n    Object.entries(get(repoStatusAtoms(repoDir)))\n      .map<AnyChange | null>(([filename, status]) => {\n        const revision = {\n          path: path.join(repoDir, filename),\n          isDir: false,\n          content(): Promise<string> {\n            throw new Error(\"Not implemented\");\n          },\n        };\n        if (status === \"ADDED\") {\n          return Change(null, revision);\n        } else if (status === \"MODIFIED\") {\n          return Change(revision, revision);\n        } else if (status === \"DELETED\") {\n          return Change(revision, null);\n        } else if (status === \"UNKNOWN\") {\n          return Change.Unversioned(revision);\n        } else {\n          return null;\n        }\n      })\n      .filter(notNull)\n  )\n);\n\nexport const allChangesAtom = atom<ReadonlyArray<AnyChange>>((get) => {\n  return get(vcsRootsAtom)\n    .map(({ dir }) => get(repoChangesAtoms(dir)))\n    .flat();\n});\n\nconst rollbackChangesCallback = async (\n  get: Getter,\n  set: Setter,\n  changes: readonly AnyChange[],\n  deleteAddedFiles?: boolean\n) => {\n  const reloadFileFromDisk = reloadFileFromDiskCallback(get, set);\n\n  const changesWithRepoRoots = (\n    await Promise.all(\n      changes\n        .filter((change) => !Change.revision(change).isDir)\n        .map(async (change) => {\n          const repoRoot = await get(vcsFootForFileAtom(Change.path(change)));\n          if (repoRoot) {\n            return {\n              repoRoot,\n              change,\n              relativePath: path.relative(repoRoot, Change.path(change)),\n            };\n          }\n        })\n    )\n  ).filter(notNull);\n  const groupedChanges = groupBy(\n    ({ repoRoot }) => repoRoot,\n    changesWithRepoRoots\n  );\n  await Promise.all(\n    Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n      const { toReset = [], toCheckout = [] } = groupBy(\n        ({ change: { type } }) =>\n          type !== \"ADDED\" || deleteAddedFiles ? \"toCheckout\" : \"toReset\",\n        items\n      );\n      await Promise.allSettled(\n        toReset.map(({ relativePath }) =>\n          resetIndex({\n            fs,\n            dir: repoRoot,\n            filepath: relativePath,\n          })\n        )\n      );\n      if (toCheckout.length > 0) {\n        const resolvedHead = await git\n          .resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" })\n          .catch(() => null);\n        if (resolvedHead) {\n          await checkout({\n            fs,\n            dir: repoRoot,\n            force: true,\n            filepaths: toCheckout.map(\n              ({ relativePath, change: { type } }) => relativePath\n            ),\n          });\n        } else {\n          // if the repository is just created, HEAD is not resolved, and checkout() throws, so we delete files\n          // manually in that case.\n          // TODO: another use case is detached HEAD, and it may need to be handled for non-addition changes?\n          await Promise.all(\n            toCheckout\n              .filter(({ change }) => change.type === \"ADDED\")\n              .map(({ change }) => {\n                const fullPath = Change.path(change);\n                return fs.promises.unlink(fullPath);\n              })\n          );\n        }\n      }\n      if (deleteAddedFiles) {\n        const editor = get(editorManagerAtom);\n        changes.filter(Change.isAddition).forEach((change) => {\n          editor.closePath(Change.path(change)); // FIXME(fs.watch)\n        });\n      }\n\n      // FIXME(fs.watch)\n      const changedDirectories = findRootPaths(\n        items.flatMap(({ change }) => {\n          if (change.type === \"MODIFIED\") {\n            // minor optimization\n            return [];\n          }\n          if (change.type === \"MOVED\") {\n            return [change.before.path, change.after.path];\n          }\n          return Change.path(change);\n        })\n      ).map(path.dirname);\n      changedDirectories.forEach((pathToRefresh) =>\n        set(dirContentAtom(pathToRefresh))\n      );\n\n      await Promise.allSettled(\n        items.map(async ({ relativePath, change }) => {\n          const fullPath = Change.path(change);\n          await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n          await resetIndex({\n            fs,\n            dir: repoRoot,\n            filepath: relativePath,\n          });\n          await refreshFileStatusCallback(get, set, fullPath);\n        })\n      );\n    })\n  );\n};\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  return useAtomCallback(rollbackChangesCallback);\n};\n","import { atom as jotaiAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { useCallback, useEffect } from \"react\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { allChangesAtom } from \"./changes.state\";\nimport { AnyChange, Change, UnversionedChange } from \"./Change\";\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: ReadonlyArray<AnyChange>;\n}\n\nexport const changeListsAtom = jotaiAtom<ChangeListObj[]>([\n  {\n    id: \"some-UUID\",\n    name: \"Changes\",\n    comment: \"last modified commit message\",\n    changes: [],\n    active: true,\n  },\n  {\n    id: \"some-other-UUID\",\n    name: \"Some other changelist\",\n    comment: \"Some empty changelist for testing\",\n    changes: [],\n    active: false,\n  },\n]);\n\nexport const activeChangeListState = jotaiAtom<ChangeListObj | null>(\n  (get) => get(changeListsAtom).find((changeList) => changeList.active) ?? null\n);\n\nexport const unversionedChangesAtom = jotaiAtom<UnversionedChange[]>((get) =>\n  get(allChangesAtom).filter(Change.isUnversioned)\n);\n\nexport const useSetActiveChangeList = () =>\n  useAtomCallback(\n    useCallback((get, set, changeListId: string) => {\n      const changeLists = get(changeListsAtom);\n      const targetChangeList = changeLists.find(\n        ({ id }) => id === changeListId\n      );\n      if (targetChangeList) {\n        set(\n          changeListsAtom,\n          changeLists.map((changeList) => ({\n            ...changeList,\n            active: changeList === targetChangeList,\n          }))\n        );\n      }\n      // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n    }, [])\n  );\n\n/**\n * Helper component that keeps change lists state up-to-date with respect to changes.\n * It must be rendered at top level. Reasons for the unconventional implementation as a component\n * that must be rendered in top level:\n * - The *effects* API in recoil doesn't allow for this use case where one atom needs to be kept valid/up-to-date\n *   based on another atom. Changes here is the source of truth. Any removed changes should be removed from\n *   changelist(s) too, and any new change should be added to the active changelist\n * - The state of change lists is **not** just a 1:1 function of changes. So it can't be a selector. How changes are\n *   grouped in different lists is something that must have its own source of truth, but it needs validation,\n *   every time changes are added/removed.\n *   TODO(jotai): The limitation mentioned above doesn't exist in Jotai. Refactor.\n */\nexport function SyncChangeListsState() {\n  const changes = useAtomValue(allChangesAtom);\n  const setChangeLists = useSetAtom(changeListsAtom);\n  useEffect(() => {\n    setChangeLists((changeLists) => {\n      const trackedChanges = changes.filter(\n        (change) => !Change.isUnversioned(change)\n      );\n      const updatedChangeLists = changeLists.map((changeList) => {\n        return {\n          ...changeList,\n          changes: changeList.changes\n            .map((change) =>\n              trackedChanges.find((aChange) => Change.equals(aChange, change))\n            )\n            .filter(notNull),\n        };\n      });\n      const existingChanges = updatedChangeLists.flatMap(\n        ({ changes }) => changes\n      );\n      const newChanges = trackedChanges.filter(\n        (change) =>\n          !existingChanges.find((anExistingChange) =>\n            Change.equals(change, anExistingChange)\n          )\n      );\n      const activeChangeList =\n        updatedChangeLists.find(({ active }) => active) ??\n        updatedChangeLists[0];\n      activeChangeList.changes.push(...newChanges);\n      return updatedChangeLists;\n    });\n  }, [changes]);\n  return null;\n}\n","import { identity, uniq } from \"ramda\";\nimport { getParentPaths } from \"../file-utils\";\n\nexport interface DirectoryNode {\n  type: \"directory\";\n  dirPath: string;\n  parentNodePath: string;\n  children: ReadonlyArray<any>;\n}\n\ntype GroupByDirectorAdapter<T, D extends DirectoryNode> = {\n  shouldCollapseDirectories?: boolean;\n  getPath: (node: T) => string;\n  /**\n   * Maps each processed node. E.g. can be used to enrich nodes with grouping metadata.\n   * @example\n   * ```\n   * mapNode: (node) => ({...node, isGroupedByDirectory: true})\n   * ```\n   */\n  mapNode?: (node: T) => T;\n  createDirectoryNode?: (dirNode: DirectoryNode) => D;\n};\n/**\n * Exported only for tests.\n * @internal\n */\nexport const createGroupByDirectory =\n  <T, D extends DirectoryNode>({\n    getPath,\n    mapNode = identity,\n    createDirectoryNode = (i) => i as D,\n    shouldCollapseDirectories = false,\n  }: GroupByDirectorAdapter<T, D>) =>\n  (nodes: ReadonlyArray<T>): readonly D[] => {\n    const pathToNodeCache: Record<string, D> = {};\n    const rootDirNodes = nodes.map(mapNode).map((node) => {\n      const filepath = getPath(node);\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(\n        filepath.startsWith(\"/\") ? filepath : `/${filepath}`\n      ).reduce((prevNode: D | T, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = createDirectoryNode({\n            type: \"directory\",\n            dirPath,\n            parentNodePath: \"\",\n            children: [],\n          });\n        }\n        if (isDirectoryNode(prevNode)) {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      }, node) as D; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const directoryNodes = uniq(rootDirNodes);\n    return shouldCollapseDirectories\n      ? directoryNodes.map((node) =>\n          collapseDirectories(createDirectoryNode, node)\n        )\n      : directoryNodes;\n  };\n\nfunction isDirectoryNode<T, D extends DirectoryNode>(node: D | T): node is D {\n  return \"type\" in node && node.type === \"directory\";\n}\n\nfunction collapseDirectories<T, D extends DirectoryNode>(\n  createDirectorNode: Required<\n    GroupByDirectorAdapter<T, any>\n  >[\"createDirectoryNode\"],\n  dirNode: D\n): D {\n  let { children, dirPath, parentNodePath } = dirNode;\n  if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n    dirPath = dirNode.children[0].dirPath;\n    children = dirNode.children[0].children.map((child: D | T) =>\n      isDirectoryNode<T, D>(child)\n        ? collapseDirectories<T, D>(createDirectorNode, {\n            ...child,\n            parentNodePath: dirPath,\n          })\n        : child\n    );\n    return collapseDirectories<T, D>(\n      createDirectorNode,\n      createDirectorNode({\n        type: \"directory\",\n        dirPath,\n        parentNodePath,\n        children,\n      })\n    );\n  }\n  return {\n    ...dirNode,\n    children: children.map((child) =>\n      isDirectoryNode(child)\n        ? collapseDirectories<T, D>(createDirectorNode, child)\n        : child\n    ),\n  };\n}\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  ADD_UNVERSIONED: \"ChangesView.AddUnversioned\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n  GROUP_BY_DIRECTORY: \"ChangesView.GroupBy.Directory\",\n  GIT_ADD: \"Git.Add\",\n  GIT_INIT: \"Git.Init\",\n  GIT_CLONE: \"Git.Clone\",\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n\n  GIT_LOG_HIDE_BRANCHES: \"Git.Log.Hide.Branches\",\n  GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH:\n    \"Git.Log.Branches.Navigate.Log.To.Selected.Branch\",\n  GIT_UPDATE_SELECTED: \"Git.Update.Selected\",\n\n  FOCUS_TEXT_FILTER: \"Vcs.Log.FocusTextFilter\",\n  MATCH_CASE: \"Vcs.Log.MatchCaseAction\",\n  REG_EXP: \"Vcs.Log.EnableFilterByRegexAction\",\n  COPY_REVISION_NUMBER: \"Vcs.CopyRevisionNumberAction\",\n  LOG_REFRESH: \"Vcs.Log.Refresh\",\n  SHOW_DETAILS: \"Vcs.Log.ShowDetailsAction\",\n  SHOW_DIFF_PREVIEW: \"Vcs.Log.ShowDiffPreview\",\n  PRESENTATION_SETTINGS: \"Vcs.PresentationSettings\",\n  FILE_HISTORY_PRESENTATION_SETTINGS: \"Vcs.FileHistory.PresentationSettings\",\n\n  CopyPathFromRepositoryRootProvider: \"CopyPathFromRepositoryRootProvider\",\n};\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { AnyChange, Change } from \"../Change\";\n\nexport interface ChangesTreeNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface ChangesTreeGroupNode<\n  T extends string,\n  C extends ChangesTreeNode<any> = ChangesTreeNode<T>\n> extends ChangesTreeNode<T> {\n  children: ReadonlyArray<C>;\n}\n\nexport type GroupNodes<T extends ChangesTreeNode<any>> = Extract<\n  T,\n  ChangesTreeGroupNode<any>\n>;\n\nexport interface ChangeNode extends ChangesTreeNode<\"change\"> {\n  change: AnyChange;\n  /**\n   * Whether to show the file path in front of the file name (in muted UI)\n   */\n  showPath?: boolean;\n}\n\nexport interface DirectoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"directory\", C> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"repo\", C> {\n  repository: VcsDirectoryMapping;\n}\n\n/**\n * Extends the type of changes tree nodes with additional (group) node types.\n */\nexport type ExtendedChangesTreeNode<G extends ChangesTreeGroupNode<any>> =\n  | ChangeNode\n  | RepositoryNode<G>\n  | DirectoryNode<G>\n  | G;\n\nexport type DefaultChangesTreeNode = ExtendedChangesTreeNode<never>;\nexport const changesTreeNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\n\nexport const getNodeKeyForChange = (change: AnyChange) =>\n  changesTreeNodeKey(\"change\", Change.path(change));\nexport const changeNode = (change: AnyChange, showPath = true): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n  showPath,\n});\nexport const directoryNode = <G extends ChangesTreeNode<any>>(\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly G[] = [],\n  keyPrefix: string = \"\"\n): DirectoryNode<G> => ({\n  type: \"directory\",\n  key: keyPrefix + changesTreeNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = <G extends ChangesTreeNode<any>>(\n  repository: VcsDirectoryMapping,\n  children: G[] = []\n): RepositoryNode<G> => ({\n  type: \"repo\",\n  key: changesTreeNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = <T extends ChangesTreeNode<any>>(\n  node: T\n): node is GroupNodes<T> => \"children\" in node;\nexport const isChangeNode = (node: ChangesTreeNode<any>): node is ChangeNode =>\n  node.type === \"change\";\nexport const isDirectoryNode = <G extends ChangesTreeNode<any>>(\n  node: ChangesTreeNode<any>\n): node is DirectoryNode<G> => node.type === \"directory\";\n\nexport const getChildren = <\n  T extends ChangesTreeNode<any> = DefaultChangesTreeNode\n>(\n  node: T\n): null | GroupNodes<T>[\"children\"] =>\n  isGroupNode(node) ? node.children : null;\n","import { atom, Atom, Getter } from \"jotai\";\n\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport { createGroupByDirectory } from \"../../../tree-utils/groupByDirectory\";\nimport { isAtom, MaybeAtom } from \"../../../atom-utils/isAtom\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { Change } from \"../Change\";\nimport {\n  changeNode,\n  ChangeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  directoryNode,\n  DirectoryNode,\n  isChangeNode,\n  isGroupNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./ChangeTreeNode\";\n\nexport type GroupFn<T extends ChangesTreeGroupNode<any>> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<\n  T extends ChangesTreeGroupNode<any>,\n  I = string\n> {\n  id: I;\n  title: string;\n  isAvailable: MaybeAtom<boolean>;\n  useShortcutOf?: string;\n  groupFn: MaybeAtom<GroupFn<T>>;\n}\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: atom((get) => get(vcsRootsAtom).length > 1),\n  groupFn: atom((get) => (nodes: ReadonlyArray<ChangeNode>) => {\n    const repos = get(vcsRootsAtom);\n    return repos.map(\n      (repository): RepositoryNode =>\n        repositoryNode(\n          repository,\n          nodes.filter((node) =>\n            Change.path(node.change)?.startsWith(repository.dir)\n          )\n        )\n    );\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: true,\n  useShortcutOf: VcsActionIds.GROUP_BY_DIRECTORY,\n  groupFn: createGroupByDirectory<ChangeNode, DirectoryNode>({\n    shouldCollapseDirectories: true,\n    createDirectoryNode: ({ dirPath, parentNodePath, children }) =>\n      directoryNode(dirPath, parentNodePath, children),\n    mapNode: (node) => changeNode(node.change, false),\n    getPath: (node) => Change.path(node.change),\n  }),\n};\n\nexport const defaultChangeGroupings: ReadonlyArray<\n  ChangeGrouping<DirectoryNode | RepositoryNode, \"directory\" | \"repository\">\n> = [repositoryGrouping, directoryGrouping];\n\nexport const defaultChangeGroupingsAtom = atom<\n  ReadonlyArray<Omit<(typeof defaultChangeGroupings)[number], \"isAvailable\">>\n>((get) =>\n  defaultChangeGroupings.filter((grouping) =>\n    isAtom(grouping.isAvailable)\n      ? get(grouping.isAvailable)\n      : grouping.isAvailable\n  )\n);\n\nexport const recursiveGrouping = <T extends ChangesTreeNode<any>>(\n  groupingFns: Array<GroupFn<any>> /* Typing could be improved? */,\n  nodes: ReadonlyArray<ChangeNode>\n): ReadonlyArray<T> | ReadonlyArray<ChangeNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes;\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n\n  const changeNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isChangeNode\n  );\n  const groupNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isGroupNode\n  );\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\n/**\n * returns a function that accepts a `keyPrefix` and creates change grouping function based on the\n * passed {@param groupings}, in a way that the key of each grouping node is prefixed with the `keyPrefix`.\n * Useful for grouping changes under some root nodes with potentially overlapping groups. E.g. the same\n * folder or repository node may appear under different changeLists.\n */\nexport const getPrefixedChangesGroupFn =\n  <G extends ChangesTreeGroupNode<any>>({\n    get,\n    isActive,\n    groupings,\n  }: {\n    get: Getter;\n    isActive: (groupingId: string) => MaybeAtom<boolean>;\n    groupings: ReadonlyArray<ChangeGrouping<G, any>>;\n  }) =>\n  (keyPrefix: string) => {\n    const resolve = <T>(value: Atom<T> | T): T =>\n      isAtom(value) ? get(value) : value;\n    const groupFns = groupings\n      .filter(\n        ({ id, isAvailable }) => resolve(isAvailable) && resolve(isActive(id))\n      )\n      .map(({ groupFn }) => {\n        return resolve(groupFn);\n      })\n      .map<GroupFn<any>>((groupFn) =>\n        keyPrefix\n          ? (...args) =>\n              groupFn(...args).map((group) => ({\n                ...group,\n                key: `${keyPrefix}:${group.key}`,\n              }))\n          : groupFn\n      );\n    return (changes: readonly ChangeNode[]) =>\n      recursiveGrouping<G>(groupFns, changes);\n  };\n\nexport const getChangesGroupFn = (\n  ...args: Parameters<typeof getPrefixedChangesGroupFn>\n) => getPrefixedChangesGroupFn(...args)(\"\");\n","import { atom } from \"jotai\";\nimport {\n  changesTreeNodesAtom,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { AnyChange } from \"../Change\";\n\nconst isOpenAtom = atom<boolean>(false);\nconst windowBoundsAtom = atom<Partial<Bounds>>({ height: 500 });\nconst initiallyIncludedChangesAtom = atom<ReadonlyArray<AnyChange>>([]);\nconst rootNodesAtom = atom((get) => {\n  const selectedChanges = get(initiallyIncludedChangesAtom);\n  const { rootNodes } = get(changesTreeNodesAtom);\n  const includedRootNodes = rootNodes.filter(\n    (node) =>\n      node.type === \"changelist\" &&\n      selectedChanges.some((change) => node.changeList.changes.includes(change))\n  );\n  if (includedRootNodes.length === 0) {\n    return rootNodes.filter(\n      (node) => node.type === \"changelist\" && node.changeList.active\n    );\n  }\n  return includedRootNodes;\n});\n\nconst initiallyExpandedKeysAtom = atom((get) => {\n  const includedChanges = get(initiallyIncludedChangesAtom);\n  const nodes = get(rootNodesAtom);\n  const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n    (node) => (isGroupNode(node) ? node.children : null),\n    (node) => node.key,\n    nodes,\n    includedChanges.map(getNodeKeyForChange)\n  );\n  return new Set(\n    expandedKeys.length\n      ? expandedKeys\n      : getExpandAllKeys<ChangesViewTreeNode>(\n          (node) => (isGroupNode(node) ? node.children : null),\n          (node) => node.key,\n          nodes\n        )\n  );\n});\n\nexport const rollbackViewState = {\n  isOpenAtom,\n  windowBoundsAtom,\n  initiallyExpandedKeysAtom,\n  initiallyIncludedChangesAtom,\n  rootNodesAtom,\n};\n","import { Key } from \"react\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { ChangesTreeNode, getChildren } from \"./ChangeTreeNode\";\n\nexport function changesTreeNodesResult<\n  T extends ReadonlyArray<ChangesTreeNode<any>>\n>(\n  rootNodes: T\n): {\n  rootNodes: ReadonlyArray<T[number]>;\n  byKey: Map<Key, T[number]>;\n  expandAllKeys: Set<Key>;\n  fileCountsMap: Map<Key, number>;\n} {\n  const fileCountsMap = new Map();\n  const byKey = new Map();\n  const expandAllKeys = new Set<Key>();\n\n  dfsVisit<ChangesTreeNode<any>, number>(\n    getChildren,\n    (node, childrenFileCount) => {\n      byKey.set(node.key, node);\n      if (\"children\" in node) {\n        expandAllKeys.add(node.key);\n      }\n      if (!childrenFileCount) {\n        return 1;\n      }\n      const fileCount = childrenFileCount.reduce(\n        (total, count) => total + count,\n        0\n      );\n      fileCountsMap.set(node.key, fileCount);\n      return fileCount;\n    },\n    rootNodes\n  );\n  return { rootNodes, fileCountsMap, byKey, expandAllKeys };\n}\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { atom, Getter, Setter } from \"jotai\";\nimport { atomFamily, atomWithDefault } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  ChangeListObj,\n  changeListsAtom,\n  unversionedChangesAtom,\n} from \"../change-lists.state\";\nimport {\n  defaultChangeGroupings,\n  defaultChangeGroupingsAtom,\n  getPrefixedChangesGroupFn,\n  GroupFn,\n} from \"../ChangesTree/changesGroupings\";\nimport {\n  bfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsAtom } from \"../../../Project/project.state\";\nimport {\n  ChangeNode,\n  changeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n  getNodeKeyForChange,\n  GroupNodes,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { Task } from \"../../../tasks\";\nimport { AnyChange, Change } from \"../Change\";\nimport { changesTreeNodesResult } from \"../ChangesTree/changesTreeNodesResult\";\nimport { allChangesAtom } from \"../changes.state\";\nimport { withAtomEffect } from \"jotai-effect\";\n\nexport interface ChangeListNode<\n  C extends ChangesTreeNode<any> = ChangesViewTreeNode\n> extends ChangesTreeGroupNode<\"changelist\", C> {\n  changeList: ChangeListObj;\n}\nexport interface UnversionedChangesNode<\n  C extends ChangesTreeNode<any> = ChangeNode\n> extends ChangesTreeGroupNode<\"unversioned\", C> {}\n\nexport type ChangesViewTreeNode = ExtendedChangesTreeNode<\n  ChangeListNode | UnversionedChangesNode\n>;\n\nexport const changeListNode = (\n  changeList: ChangeListObj\n): ChangeListNode<ChangeNode> => ({\n  type: \"changelist\",\n  key: changesTreeNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: changeList.changes.map((change) => changeNode(change)),\n});\n\nexport const showIgnoredFilesAtom = atom(false);\n\nexport const showRelatedFilesAtom = atom(false);\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = (typeof defaultChangeGroupings)[number][\"id\"];\n\nexport const changesGroupingActiveState = atomFamily(\n  (name: string) => atom(true) // it's false in IntelliJ\n);\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysAtom = atom<Selection>(new Set<Key>([]));\n\n/**\n * Same as {@link selectedKeysAtom}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysAtom = atom<Set<Key>>((get) => {\n  const selection = get(selectedKeysAtom);\n  if (selection === \"all\") {\n    const { rootNodes } = get(changesTreeNodesAtom);\n    return new Set(\n      bfsVisit<ChangesViewTreeNode, ChangesViewTreeNode[]>(\n        (node) => (\"children\" in node ? node.children : []),\n        (node, parentValue) => {\n          const nodes = parentValue ?? [];\n          nodes.push(node);\n          return nodes;\n        },\n        rootNodes\n      )\n        .flat()\n        .map((node) => node.key)\n    );\n  }\n  return selection;\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysAtom}\n */\nconst selectedNodesAtom = atom<ReadonlySet<ChangesViewTreeNode>>((get) => {\n  const selectedKeys = get(resolvedSelectedKeysAtom);\n  const { byKey } = get(changesTreeNodesAtom);\n  return new Set(\n    [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n  );\n});\n\nexport const changesUnderSelectedKeysAtom = atom<ReadonlySet<AnyChange>>(\n  (get) => {\n    const selectedNodes = get(selectedNodesAtom);\n    const allChanges: Set<AnyChange> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  }\n);\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = atom<ReadonlySet<ChangeListObj>>(\n  (get) => {\n    const selectedNodes = get(selectedNodesAtom);\n    const allChangeLists = get(changeListsAtom);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  }\n);\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysAtom = atom<Set<string>>(new Set<string>([]));\n\nexport const includedChangesAtom = atom<ReadonlyArray<AnyChange>>((get) => {\n  const includedChangeKeys = get(includedChangeKeysAtom);\n  const allChanges = get(allChangesAtom);\n  return allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelectionAtom = atom<\n  NestedSelectionState<ChangesViewTreeNode>,\n  [(currentValue: Set<string>) => Set<string>],\n  void\n>(\n  (get, { setSelf }) => {\n    const { rootNodes } = get(changesTreeNodesAtom);\n    const includedChangeKeys = get(includedChangeKeysAtom);\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface<string>(setSelf),\n      },\n      {\n        rootNodes,\n        getChildren: (item: ChangesViewTreeNode) =>\n          isGroupNode<ChangesViewTreeNode>(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n  (_get, set, updater: (currentValue: Set<string>) => Set<string>) => {\n    set(includedChangeKeysAtom, updater);\n  }\n);\n\nexport const expandedKeysAtom = atomWithDefault(\n  (get) =>\n    new Set<Key>(\n      get(changesTreeNodesAtom)\n        .rootNodes.map((node) => [\n          node.key,\n          ...node.children.map((child) => child.key),\n        ])\n        .flat()\n    )\n);\n\nexport const changesViewGroupingsState = atom((get) =>\n  get(defaultChangeGroupingsAtom).map((grouping) => ({\n    ...grouping,\n    isActive: get(changesGroupingActiveState(grouping.id)),\n  }))\n);\n\nconst groupChildren = <\n  T extends ChangesTreeGroupNode<any, ChangeNode>,\n  G extends ChangesTreeNode<any>\n>(\n  node: T,\n  groupFn: (\n    nodes: ReadonlyArray<ChangeNode>\n  ) => ReturnType<GroupFn<GroupNodes<G>>> | ReadonlyArray<ChangeNode>\n) => ({\n  ...node,\n  children: groupFn(node.children),\n});\n\nexport const changesTreeNodesAtom = atom<{\n  rootNodes: ReadonlyArray<ChangeListNode | UnversionedChangesNode>;\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, ChangesViewTreeNode>;\n}>((get) => {\n  const changeListNodes = sortBy(\n    ({ active }) => !active,\n    get(changeListsAtom)\n  ).map(changeListNode);\n  const prefixedGroupFn = getPrefixedChangesGroupFn({\n    get,\n    groupings: defaultChangeGroupings,\n    isActive: changesGroupingActiveState,\n  });\n  const unversionedChanges = get(unversionedChangesAtom);\n  const rootNodes: Array<ChangeListNode | UnversionedChangesNode> =\n    changeListNodes.map((changeListNode) =>\n      groupChildren(changeListNode, prefixedGroupFn(changeListNode.key))\n    );\n  if (unversionedChanges.length > 0) {\n    const unversionedChangesNode: UnversionedChangesNode = {\n      key: \"unversioned\",\n      type: \"unversioned\",\n      children: unversionedChanges.map((change) => changeNode(change)),\n    };\n    rootNodes.push(\n      groupChildren(unversionedChangesNode, prefixedGroupFn(\"unversioned\"))\n    );\n  }\n  return changesTreeNodesResult(rootNodes);\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily(\n  (orientation: \"horizontal\" | \"vertical\") =>\n    atom(orientation === \"horizontal\" ? 0.4 : 0.3)\n);\n/**\n * Whether --amend should be used for commit.\n */\n// TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n// it should add a record to the commit message history and switch the message. When toggled to false,\n// last entry in history should be back again. There is currently no history :D\nexport const amendCommitAtom = atom(false);\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageAtom = atom(\"\");\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageAtom = atom(\"\");\n\nexport const commitTaskIdAtom = atom<Task[\"id\"] | null>(null);\n\nexport const changesFromActivePathsAtom = atom((get) => {\n  const activePaths = get(activePathsAtom);\n  return get(allChangesAtom).filter((change) =>\n    activePaths.some((activePath) => Change.path(change).startsWith(activePath))\n  );\n});\n/**\n * Atom callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = (\n  get: Getter,\n  set: Setter,\n  /**\n   * paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  paths?: string[]\n) => {\n  const changes = paths\n    ? get(allChangesAtom).filter((change) =>\n        paths.some((activePath) => Change.path(change).startsWith(activePath))\n      )\n    : get(changesFromActivePathsAtom);\n\n  const includedChangeKeys = changes.map(getNodeKeyForChange);\n  set(includedChangeKeysAtom, new Set(includedChangeKeys));\n  if (includedChangeKeys.length > 0) {\n    const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n      (node) => (isGroupNode<ChangesViewTreeNode>(node) ? node.children : null),\n      (node) => node.key,\n      get(changesTreeNodesAtom).rootNodes,\n      includedChangeKeys\n    );\n    set(expandedKeysAtom, (currentExpandedKeys) => {\n      return new Set([\n        ...(currentExpandedKeys ?? new Set<Key>()),\n        ...expandedKeys,\n      ]);\n    });\n    set(selectedKeysAtom, new Set([includedChangeKeys[0]]));\n  }\n};\n\n/**\n * If contextual is true, changes related to {@link activePathsAtom} will be preselected.\n */\nexport const openRollbackWindowForSelectionCallback = (\n  get: Getter,\n  set: Setter,\n  contextual = true\n) => {\n  const activePaths = get(activePathsAtom);\n  const changesUnderSelection = get(changesUnderSelectedKeysAtom);\n  const changesBasedOnActivePaths =\n    contextual && activePaths.length > 0\n      ? get(changesFromActivePathsAtom)\n      : null;\n  set(\n    rollbackViewState.initiallyIncludedChangesAtom,\n    changesBasedOnActivePaths ?? [...changesUnderSelection]\n  );\n  set(rollbackViewState.isOpenAtom, true);\n};\n","import { useAtomValue } from \"jotai\";\nimport { selectedKeysAtom } from \"./ChangesView.state\";\nimport {\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useAtomValue(selectedKeysAtom);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Changes actions\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(CommonActionId.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: readonly T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { equals, groupBy } from \"ramda\";\nimport { useCallback } from \"react\";\nimport { atomFamily, useAtomCallback } from \"jotai/utils\";\nimport { atom, Getter, Setter, useAtomValue } from \"jotai\";\nimport { focusAtom } from \"jotai-optics\";\n\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\nimport { z } from \"zod\";\n\nimport { fs } from \"../../fs/fs\";\nimport { atomWithRefresh } from \"../../atom-utils/atomWithRefresh\";\nimport { vcsFootForFileAtom, vcsRootsAtom } from \"../file-status.state\";\nimport { dirContentAtom, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsAtom } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { atomWithPersistence } from \"../../persistence/atomWithPersistence\";\nimport { list, map } from \"../../persistence/schema-utils\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\nexport type BranchType = \"LOCAL\" | \"REMOTE\";\n\nexport type BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesAtom = atomFamily((repoRoot: string) =>\n  atomWithRefresh(async ({}): Promise<LocalBranch[]> => {\n    const branches = await git.listBranches({ fs, dir: repoRoot });\n    return Promise.all(\n      branches.map(async (branch) => ({\n        name: branch,\n        trackingBranch: await getTrackingBranch({\n          fs,\n          dir: repoRoot,\n          localBranchName: branch,\n        }),\n      }))\n    );\n  })\n);\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesAtoms = atomFamily((repoRoot: string) =>\n  atomWithRefresh(async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  })\n);\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesAtom = atomFamily((repoRoot: string) =>\n  atomWithRefresh(async (get) => {\n    const currentBranchName = await get(repoCurrentBranchNameAtom(repoRoot));\n    let localBranches = await get(repoLocalBranchesAtom(repoRoot));\n    if (localBranches.length === 0 && currentBranchName) {\n      // When a repo is initialized and before the first commit, no branch is returned when listing branches.\n      // See more: https://github.com/isomorphic-git/isomorphic-git/issues/1650\n      localBranches = localBranches.concat({\n        name: currentBranchName,\n        trackingBranch: null,\n      });\n    }\n    return {\n      repoRoot,\n      currentBranch:\n        localBranches.find((branch) => branch.name === currentBranchName) ||\n        null,\n      localBranches: localBranches,\n      remoteBranches: await get(repoRemoteBranchesAtoms(repoRoot)),\n    };\n  })\n);\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameAtom = atomFamily((repoRoot: string) =>\n  atomWithRefresh(() => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  })\n);\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesAtom = atom(async (get): Promise<RepoBranches[]> => {\n  const repoRoots = get(vcsRootsAtom);\n  return Promise.all(\n    repoRoots.map(({ dir: repoRoot }) => get(repoBranchesAtom(repoRoot)))\n  );\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathAtoms = atomFamily((filepath: string) =>\n  atom(async (get): Promise<string | null> => {\n    const root = await get(vcsFootForFileAtom(filepath));\n    const repoRoot = root ? await get(repoBranchesAtom(root)) : null;\n    console.log(`repo root for ${filepath}`, root, root && repoRoot);\n    return root ? repoRoot?.currentBranch?.name || null : null;\n  })\n);\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    branchStorage?.map.entry.flatMap<BranchInfo>((entry) =>\n      entry?.value.list[\"branch-info\"].map(\n        ({ \"@source\": branchName, \"@repo\": repoRoot }) => ({\n          branchType: entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction writeBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      \"@type\": branchType as BranchType,\n      value: {\n        list: {\n          \"branch-info\": branches.map((branch) => ({\n            \"@repo\": branch.repoRoot,\n            \"@source\": branch.branchName,\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: {\n      entry: entries,\n    },\n  };\n}\n\nconst branchStorage = z.object({\n  \"branch-storage\": z.object({\n    map: map(\n      z.enum([\"LOCAL\", \"REMOTE\"]),\n      z.object({\n        list: list(\n          z.object({\n            \"@repo\": z.string(),\n            \"@source\": z.string(),\n          }),\n          \"branch-info\"\n        ),\n      })\n    ),\n  }),\n});\n\ntype BranchStorage = (typeof branchStorage)[\"_output\"][\"branch-storage\"];\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\nexport const gitSettingsSchema = z\n  .object({\n    \"favorite-branches\": branchStorage.optional(),\n    \"exclude-from-favorite\": branchStorage.optional(),\n  })\n  .optional();\n\ntype GitSettings = {\n  branches: ReadonlyArray<BranchInfo>;\n  excludedBranches: ReadonlyArray<BranchInfo>;\n};\n\nconst gitSettingsAtom = atomWithPersistence(\n  { branches: [], excludedBranches: [] },\n  {\n    schema: gitSettingsSchema,\n    componentName: \"Git.Settings\",\n    read: (componentState): GitSettings => {\n      return {\n        branches: readBranchStorage(\n          componentState?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        ),\n        excludedBranches: readBranchStorage(\n          componentState?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        ),\n      };\n    },\n    write: (value, state) => {\n      const newState = {\n        ...state,\n      };\n      // empty objects or arrays convert into empty tag, which then gets deserialized as string\n      // it's not convenient to make sure empty objects are not included, and it's not even type safe\n      // so maybe a better solution would be to handle deserialization from empty string too, with a custom\n      // object() (similar to maybeArray utility), that would be able to deserialize from empty string,\n      // and would used instead of z.object().\n      // Type safety could also be implemented the same way it's done for maybeArray, to make sure everywhere that\n      // an object with all-optional properties exist, empty string is also allowed in the input type.\n      if (value.branches.length > 0) {\n        newState[\"favorite-branches\"] = {\n          \"branch-storage\": writeBranchStorage(value.branches),\n        };\n      } else {\n        delete newState[\"favorite-branches\"];\n      }\n      if (value.excludedBranches.length > 0) {\n        newState[\"exclude-from-favorite\"] = {\n          \"branch-storage\": writeBranchStorage(value.excludedBranches),\n        };\n      } else {\n        delete newState[\"exclude-from-favorite\"];\n      }\n      return newState;\n    },\n  }\n);\n\nconst favoriteBranchesAtom = focusAtom(gitSettingsAtom, (optic) =>\n  optic.prop(\"branches\")\n);\n\nconst excludedFromFavoriteBranchesAtom = focusAtom(gitSettingsAtom, (optic) =>\n  optic.prop(\"excludedBranches\")\n);\n\nexport const isFavoriteBranchAtoms = atomFamily(\n  (branchInfo: BranchInfo) =>\n    atom((get) => {\n      return isFavorite(\n        get(favoriteBranchesAtom),\n        get(excludedFromFavoriteBranchesAtom),\n        branchInfo\n      );\n    }),\n  equals\n);\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useAtomCallback(\n    useCallback(\n      (\n        get,\n        set,\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          get(favoriteBranchesAtom),\n          get(excludedFromFavoriteBranchesAtom),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesAtom, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesAtom, add);\n          }\n        } else {\n          set(favoriteBranchesAtom, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesAtom, add);\n          }\n        }\n      },\n      []\n    )\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useAtomValue(favoriteBranchesAtom);\n  const excludedFromFavoriteBranches = useAtomValue(\n    excludedFromFavoriteBranchesAtom\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useAtomCallback(\n    useCallback(\n      (\n        _get,\n        set,\n        repoRoot: string,\n        branchName: string,\n        checkout: boolean = true\n      ) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            set(repoBranchesAtom(repoRoot));\n          }\n        );\n      },\n      []\n    )\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useAtomCallback(\n    useCallback(\n      async (\n        get,\n        set,\n        repoRoot: string,\n        branchName: string,\n        newBranchName: string\n      ) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        set(repoBranchesAtom(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            get(favoriteBranchesAtom),\n            get(excludedFromFavoriteBranchesAtom),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n      []\n    )\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useAtomCallback(\n    useCallback(\n      async (\n        get: Getter,\n        set: Setter,\n        repoRoot: string,\n        branchName: string,\n        remote?: string\n      ) => {\n        const reloadFileFromDisk = reloadFileFromDiskCallback(get, set);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        console.log(`checked out branch ${branchName}`);\n        set(repoBranchesAtom(repoRoot));\n        set(dirContentAtom(repoRoot));\n        const openedFiles = get(editorTabsAtom);\n        const existingOpenedFile = await asyncFilter(async ({ filePath }) => {\n          const exists = await fs.promises.exists(filePath); // should it be fs directly?\n          // the file content for files not open in the editor also need to be updated. TODO(fs.watch)\n          console.log(`updating the content of the file ${filePath}`, exists);\n          if (exists) {\n            await reloadFileFromDisk(filePath);\n          }\n          return exists;\n        }, openedFiles);\n        set(editorTabsAtom, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n      []\n    )\n  );\n}\n\nexport function useDeleteBranch() {\n  return useAtomCallback(\n    useCallback((_get, set, repoRoot: string, branchName: string) => {\n      return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n        set(repoBranchesAtom(repoRoot));\n      });\n    }, [])\n  );\n}\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathAtoms } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useAtomValue(branchForPathAtoms(repo.dir));\n  return <>{branch}</>;\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React, { ForwardedRef, HTMLAttributes } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { vcsRootsAtom } from \"../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.2rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useAtomValue(vcsRootsAtom).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = React.forwardRef(\n  (\n    {\n      rootPath,\n      ...props\n    }: {\n      rootPath: string;\n    } & HTMLAttributes<HTMLSpanElement>,\n    ref: ForwardedRef<HTMLElement>\n  ) => (\n    <StyledRepoColorSquare\n      ref={ref}\n      {...props}\n      style={{ ...props.style, backgroundColor: useRepoRootColor(rootPath) }}\n    />\n  )\n);\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(\n      // FIXME: color-mix algorithm used here seems to be different from how colors are mixed in the reference impl.\n      `color-mix(in srgb, ${theme.color(\n        \"VersionControl.Log.Commit.currentBranchBackground\",\n        theme.dark ? \"rgb(63, 71, 73)\" : \"rgb(228, 250, 255)\"\n      )}, ${theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )} ${\n        (theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08) * 100\n      }%)`\n    )};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport path from \"path\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { RepoColorIcon } from \"../StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"../StyledCurrentBranchTag\";\nimport { Change } from \"../Change\";\nimport {\n  ChangeNode,\n  ChangesTreeNode,\n  DefaultChangesTreeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./ChangeTreeNode\";\nimport { StatusColor } from \"../../FileStatusColor\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\nexport type NodeRenderer<T extends ChangesTreeNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nexport function formatFileCount(fileCount: number) {\n  return fileCountMsg.format({ fileCount });\n}\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeRenderer: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  return (\n    <ItemLayout.Hint>\n      {node.showPath && path.dirname(Change.path(node.change))}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeRenderer: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(Change.path(node.change)),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(Change.path(node.change))} />\n      <StatusColor status={Change.fileStatus(node.change)}>\n        <HighlightedTextValue />\n      </StatusColor>\n      {Change.isRename(node.change)\n        ? ` - renamed from ${path.basename(node.change.before.path)}`\n        : Change.isMove(node.change) &&\n          ` - moved from ${path\n            .relative(\n              path.dirname(node.change.after.path),\n              path.dirname(node.change.before.path)\n            )\n            .replace(/(\\.\\.\\/){2,}[!.]/g, \"..\")}/`}\n\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\ntype NodeRenderersMap<T extends ChangesTreeNode<any>> = {\n  [type in T[\"type\"]]: NodeRenderer<T & { type: type }>;\n};\n\nconst defaultNodeRenderers: NodeRenderersMap<DefaultChangesTreeNode> = {\n  repo: repoNodeRenderer,\n  directory: directoryNodeRenderer,\n  change: changeNodeRenderer,\n};\n\nexport const simpleGroupingRenderer =\n  <T extends ChangesTreeNode<any>>(\n    getText: (node: T) => string\n  ): NodeRenderer<T> =>\n  (node, { fileCount }) => ({\n    textValue: getText(node),\n    rendered: (\n      <ItemLayout>\n        <HighlightedTextValue />\n        <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      </ItemLayout>\n    ),\n  });\n\nexport const createChangesTreeNodeRenderer = <T extends ChangesTreeNode<any>>(\n  renderers: Omit<\n    NodeRenderersMap<T>,\n    keyof NodeRenderersMap<DefaultChangesTreeNode>\n  >,\n  /**\n   * Not so nice signature, but couldn't make it work with a single argument in a way that:\n   * - allows for optionally overriding the default renderers\n   * - infers the type of the resulting renderer based on additional keys passed in `renderers`\n   */\n  defaultRendererOverrides?: Partial<NodeRenderersMap<DefaultChangesTreeNode>>\n) => {\n  const nodeRenderers: NodeRenderersMap<T> = {\n    ...defaultNodeRenderers,\n    ...defaultRendererOverrides,\n    ...renderers,\n  };\n  const getItemProps = ({\n    node,\n    fileCountsMap,\n  }: {\n    node: T;\n    fileCountsMap: Map<Key, number>;\n  }): ItemProps<T> & { key: Key } => {\n    // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n    // to node types\n    const nodeRenderer: NodeRenderer<T> =\n      nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n    const { textValue, rendered } = nodeRenderer(node, {\n      fileCount: fileCountsMap.get(node.key) || 0,\n      dirCount: 0, // It seems it's only used for ignored files subtree\n    });\n    return {\n      key: node.key,\n      childItems: isGroupNode(node) ? (node.children as T[]) : [],\n      hasChildItems: isGroupNode(node) && node.children?.length > 0,\n      textValue,\n      children: rendered,\n    };\n  };\n  return {\n    getItemProps,\n    getTextValue: (\n      node: T,\n      { fileCountsMap }: { fileCountsMap: Map<Key, number> }\n    ) => {\n      const nodeRenderer: NodeRenderer<T> =\n        nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n      return nodeRenderer(node, {\n        fileCount: fileCountsMap.get(node.key) || 0,\n        dirCount: 0, // It seems it's only used for ignored files subtree\n      }).textValue;\n    },\n    itemRenderer:\n      ({ fileCountsMap }: { fileCountsMap: Map<Key, number> }) =>\n      (node: T) =>\n        <Item {...getItemProps({ node, fileCountsMap })} />,\n  };\n};\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n} from \"../ChangesTree/changesTreeNodeRenderers\";\nimport { isAnyRepoStatusUpdatingAtom } from \"../../file-status.state\";\nimport { Delayed } from \"../../../Delayed\";\nimport {\n  ChangeListNode,\n  ChangesViewTreeNode,\n  UnversionedChangesNode,\n} from \"./ChangesView.state\";\n\nconst changeListNodeRenderer: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nconst unversionedChangesNodeRenderer: NodeRenderer<UnversionedChangesNode> = (\n  _node,\n  { fileCount }\n) => ({\n  textValue: \"Unversioned Files\",\n  rendered: (\n    <ItemLayout>\n      <HighlightedTextValue />\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nfunction LoadingText() {\n  const loading = useAtomValue(isAnyRepoStatusUpdatingAtom);\n  return <>{loading && <Delayed>, updating...</Delayed>}</>;\n}\n\nexport const changesViewTreeNodeRenderer =\n  createChangesTreeNodeRenderer<ChangesViewTreeNode>({\n    changelist: changeListNodeRenderer,\n    unversioned: unversionedChangesNodeRenderer,\n  });\n","import React, { Key, RefObject, useCallback } from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesAtom,\n  ChangesViewTreeNode,\n  expandedKeysAtom,\n  includedChangesNestedSelectionAtom,\n  selectedKeysAtom,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { Change } from \"../Change\";\nimport { isGroupNode } from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"./changesViewTreeNodeRenderer\";\n\nfunction findPathsUnderNode(node: ChangesViewTreeNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [Change.path(node.change)];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } =\n    useAtomValue(changesTreeNodesAtom);\n  const [selectedKeys, setSelectedKeys] = useAtom(selectedKeysAtom);\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtom);\n  const nestedSelection = useAtomValue(includedChangesNestedSelectionAtom);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useAtomCallback(\n    useCallback((get, _set, key: Key) => {\n      const changeNode = get(changesTreeNodesAtom).byKey.get(key);\n      if (changeNode?.type === \"change\") {\n        openPath(Change.path(changeNode.change));\n      }\n      return changeNode;\n    }, [])\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        aria-label=\"Commit changes tree\" // no aria-label in the reference impl\n        treeRef={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = changesViewTreeNodeRenderer.getItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionsMenu,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu actions={actions}>\n          {(actionMenuProps) => (\n            <SpeedSearchMenu {...menuProps} {...actionMenuProps} />\n          )}\n        </ActionsMenu>\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionTooltip,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\ninterface Grouping<K extends string> {\n  id: K;\n  title: string;\n  isActive: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function GroupByActionButton<K extends string>({\n  groupings,\n  onToggle,\n}: {\n  groupings: Array<Grouping<K>>;\n  onToggle: (id: K) => void;\n}) {\n  //  TODO: Generalize and make action\n  if (groupings.length === 1 && groupings[0].icon) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={`Group By ${groupings[0].title}`} />\n        }\n      >\n        <IconButton\n          isPressed={groupings[0].isActive}\n          onPress={() => onToggle(groupings[0].id)}\n        >\n          {groupings[0].icon}\n        </IconButton>\n      </TooltipTrigger>\n    );\n  }\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            <Menu\n              {...menuProps}\n              selectedKeys={groupings\n                .filter(({ isActive }) => isActive)\n                .map(({ id }) => id)}\n              onAction={(key) => {\n                const id = groupings.find(({ id }) => id === key)?.id;\n                if (id) {\n                  onToggle(id);\n                }\n              }}\n            >\n              <Section title=\"Group By\">\n                {groupings.map(({ id, title }) => (\n                  <Item key={id}>{title}</Item>\n                ))}\n              </Section>\n            </Menu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport React, { useCallback } from \"react\";\n\nimport { GroupByActionButton } from \"../../../../GroupByActionButton\";\nimport {\n  changesGroupingActiveState,\n  changesViewGroupingsState,\n  GroupingIds,\n} from \"../ChangesView.state\";\n\nexport const ChangesGroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const groupings = useAtomValue(changesViewGroupingsState);\n\n  const toggleGroup = useAtomCallback(\n    useCallback((_get, set, id: GroupingIds) => {\n      set(changesGroupingActiveState(id), (value) => !value);\n    }, [])\n  );\n\n  return <GroupByActionButton groupings={groupings} onToggle={toggleGroup} />;\n};\n","import React from \"react\";\nimport { useAtom } from \"jotai\";\nimport {\n  showIgnoredFilesAtom,\n  showRelatedFilesAtom,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useAtom(showRelatedFilesAtom);\n  const [showIgnoredFiles, setShowIgnoredFiles] = useAtom(showIgnoredFilesAtom);\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { ChangesGroupByActionButton } from \"./ActionButtons/ChangesGroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar border=\"bottom\">\n      <ActionButton actionId={CommonActionId.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <ChangesGroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { atom, useSetAtom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { useCallback } from \"react\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksAtom = atom<Task[]>([]);\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskAtom = atom<Task | null>((get) => get(tasksAtom)[0]);\n\n/**\n * Optimized state of the number of tasks, if the tasks are not needed.\n */\nexport const taskCountAtom = atom<number>((get) => get(tasksAtom).length);\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetAtom(tasksAtom);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useAtomCallback(\n    useCallback((get, _set, id: Task[\"id\"]) => {\n      const task = get(tasksAtom).find((task) => task.id === id);\n      if (task) {\n        task.abortController.abort();\n      }\n    }, [])\n  );\n","import { atomFamily } from \"jotai/utils\";\nimport git from \"isomorphic-git\";\nimport { equals } from \"ramda\";\nimport { atomWithRefresh } from \"../atom-utils/atomWithRefresh\";\nimport { fs } from \"../fs/fs\";\n\nexport const resolvedRefAtoms = atomFamily(\n  ({ repoRoot, ref }: { repoRoot: string; ref: string }) =>\n    atomWithRefresh(() => {\n      return git.resolveRef({ fs, dir: repoRoot, ref, depth: 3 });\n    }),\n  equals\n);\n","export type DateRange = { from?: Date; to?: Date };\nexport const dateToString = (date: Date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date\n    .getFullYear()\n    .toString()\n    .slice(-2)}`;\n};\nexport const dateRangeToString = (dateRange: DateRange): string => {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n};\n","import { mapObjIndexed } from \"ramda\";\nimport { Atom, atom, Getter, Setter, WritableAtom } from \"jotai\";\nimport { atomFamily, atomWithReset, RESET, useAtomCallback } from \"jotai/utils\";\nimport { useCallback } from \"react\";\nimport { DateRange, dateRangeToString } from \"./DateRange\";\n\nexport const vcsTabKeysAtom = atom<string[]>([\"MAIN\"]);\n\nexport const vcsActiveTabKeyAtom = atom<string>(\"MAIN\");\n\n/**\n * The title of a VCS log tab\n */\nexport const vcsTabTitleAtoms = atomFamily((key: string) =>\n  atom((get) => {\n    const searchQuery = get(vcsLogFilter.searchQuery(key));\n    const user = get(vcsLogFilter.user(key));\n    const date = get(vcsLogFilter.date(key));\n    const branches = get(vcsLogFilter.branch(key));\n    const parts: { short: string; long: string }[] = [];\n\n    if (branches?.length > 0) {\n      parts.push({\n        short: branches.join(\", \"),\n        long: `on ${branches.join(\", \")}`,\n      });\n    }\n    if (date) {\n      parts.push({\n        short: dateRangeToString(date),\n        long: `made ${dateRangeToString(date)}`,\n      });\n    }\n    if (searchQuery) {\n      parts.push({\n        short: `'${searchQuery}'`,\n        long: `containing '${searchQuery}'`,\n      });\n    }\n    if (user) {\n      parts.push({\n        short: user,\n        long: `by ${user}`,\n      });\n    }\n\n    return `Log${parts.length > 0 ? \": \" : \"\"}${\n      parts.length === 1\n        ? parts[0].short\n        : parts.map((part) => part.long).join(\" \")\n    }`;\n  })\n);\n\nconst tabAtomFamilies: Array<\n  ReturnType<typeof atomFamily<string, Atom<unknown>>>\n> = [];\n\n/**\n * creates an atomFamily to keep a piece of state for VCS log tabs.\n * It keeps track of all pieces of state for each tab to be cleaned up when the tab is closed.\n */\nexport const vcsLogAtomFamily = <T>(defaultValue: T) => {\n  const result = atomFamily((_tab: string) => atomWithReset<T>(defaultValue));\n  tabAtomFamilies.push(result);\n  return result;\n};\n\n/**\n * Whether branches filter is visible for a VCS log tab\n */\nexport const vcsLogTabShowBranchesAtoms = vcsLogAtomFamily(false);\n\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsAtoms = vcsLogAtomFamily(true);\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsInCurrentTabAtom = atom((get) =>\n  get(vcsLogTabShowCommitDetailsAtoms(get(vcsActiveTabKeyAtom)))\n);\n\nexport const CURRENT_USER_FILTER_VALUE = \"*\";\nexport const vcsLogFilter = {\n  /**\n   * The state of search query, for a VCS log tab\n   */\n  searchQuery: vcsLogAtomFamily(\"\"),\n  /**\n   * The state of whether \"match case\" is on the search query, for a VCS log tab\n   */\n  matchCase: vcsLogAtomFamily(false),\n  /**\n   * The state of whether \"regexp\" is on the search query, for a VCS log tab\n   */\n  regExp: vcsLogAtomFamily(false),\n  /**\n   * The state of user filter, for a VCS log tab\n   */\n  user: vcsLogAtomFamily<string | null>(null),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  date: vcsLogAtomFamily<DateRange | null>(null),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  branch: vcsLogAtomFamily<string[]>([]),\n};\n\nexport const vcsLogFilterCurrentTab = mapObjIndexed((atomFamily, key) => {\n  return atom(\n    (get) => get(atomFamily(get(vcsActiveTabKeyAtom)) as Atom<unknown>),\n    (get, set, newValue) => {\n      set(\n        atomFamily(get(vcsActiveTabKeyAtom)) as WritableAtom<\n          unknown,\n          unknown[],\n          unknown\n        >,\n        newValue\n      );\n    }\n  );\n}, vcsLogFilter) as {\n  [key in keyof typeof vcsLogFilter]: ReturnType<(typeof vcsLogFilter)[key]>;\n};\n\nexport const useResetFilters = () =>\n  useAtomCallback(\n    useCallback((get, set, tabKey: string) => {\n      Object.values(vcsLogFilter)\n        .map((getAtom) => getAtom(tabKey))\n        .forEach((atom) =>\n          set(atom as WritableAtom<unknown, [typeof RESET], unknown>, RESET)\n        );\n    }, [])\n  );\n\nconst closeTabCallback = (get: Getter, set: Setter, tabKey: string) => {\n  const tabs = get(vcsTabKeysAtom);\n  const currentActiveTabKey = get(vcsActiveTabKeyAtom);\n  if (currentActiveTabKey === tabKey) {\n    // make sure the active tab key remains valid, by switching to previous tab. In the reference implementation\n    // the previously activated tab will be activated instead of the previous one index-wise, but it's a\n    // negligible and easy-to-fix difference.\n    set(\n      vcsActiveTabKeyAtom,\n      tabs[tabs.findIndex((key) => key === tabKey) - 1] || tabs[0]\n    );\n  }\n  set(vcsTabKeysAtom, (keys) => keys.filter((key) => key !== tabKey));\n  tabAtomFamilies.forEach((atomFamily) => atomFamily.remove(tabKey));\n};\n\nexport function useCloseVcsTab() {\n  return useAtomCallback(closeTabCallback);\n}\n","import git, { ReadCommitResult } from \"isomorphic-git\";\nimport { sort } from \"ramda\";\n\ntype Fs = Parameters<typeof git[\"readCommit\"]>[0][\"fs\"];\n\nconst cache = {};\nexport const commitDateComparator = (\n  a: ReadCommitResult,\n  b: ReadCommitResult\n) => b.commit.committer.timestamp - a.commit.committer.timestamp;\n\ntype CommitWithMeta = {\n  repoPath: string;\n  /**\n   * refs this commit contains in\n   */\n  containingRefs: Set<string>;\n  readCommitResult: ReadCommitResult;\n};\n\ntype RepoDescriptor = {\n  repoPath: string;\n  isBare?: boolean;\n};\n/**\n * Similar to git.log(...), but:\n * - supports multiple repos and multiple refs per repo.\n * - for each commit, includes the list of refs the commit is a part of\n * Commits are sorted by commit time, from new to old.\n */\nexport async function readCommits(\n  fs: Fs,\n  ...sources: Array<\n    RepoDescriptor & {\n      refs: string[];\n    }\n  >\n) {\n  const allCommits: Array<CommitWithMeta> = [];\n  const commitsMap: Record<string, CommitWithMeta> = {};\n  let commitsToProcess: Array<CommitWithMeta & RepoDescriptor> = [];\n\n  commitsToProcess.forEach((item) => {\n    commitsMap[item.readCommitResult.oid] = item;\n  });\n  const initialCommits = await Promise.all(\n    sources.flatMap(({ refs, repoPath, isBare }) =>\n      refs.map(async (ref) => {\n        const commit = await git\n          .resolveRef({\n            ...getCommonArgs({ repoPath, isBare }),\n            ref,\n            depth: 3,\n          })\n          .then((oid) =>\n            git.readCommit({\n              ...getCommonArgs({ repoPath, isBare }),\n              oid,\n            })\n          );\n        return { repoPath, isBare, commit, refs: new Set([ref]) };\n      })\n    )\n  );\n\n  sort(\n    ({ commit: c1 }, { commit: c2 }) => commitDateComparator(c1, c2),\n    initialCommits\n  ).forEach(({ commit, refs, repoPath, isBare }) =>\n    addCommit({ repoPath, isBare }, commit, -1, refs)\n  );\n\n  while (commitsToProcess.length > 0) {\n    const {\n      readCommitResult: latestCommit,\n      repoPath,\n      isBare,\n      containingRefs,\n    } = commitsToProcess.shift()!; // non-null assertion because of length>0;\n    allCommits.push({\n      repoPath,\n      readCommitResult: latestCommit,\n      containingRefs: containingRefs,\n    });\n    const parentCommits = await Promise.all(\n      latestCommit.commit.parent.map((oid) =>\n        git.readCommit({\n          ...getCommonArgs({ repoPath, isBare }),\n          oid,\n        })\n      )\n    );\n    // insert new parents in the right place so that commitsToProcess remains sorted.\n    parentCommits.forEach((commit) => {\n      const index = commitsToProcess.findIndex(\n        ({ readCommitResult: aCommit }) =>\n          commitDateComparator(aCommit, commit) > 0\n      );\n      addCommit({ repoPath, isBare }, commit, index, containingRefs);\n    });\n  }\n  return allCommits;\n\n  function addCommit(\n    { repoPath, isBare }: RepoDescriptor,\n    commit: ReadCommitResult,\n    index: number,\n    refs: Set<string>\n  ) {\n    if (commitsMap[commit.oid]) {\n      commitsMap[commit.oid].containingRefs = new Set([\n        ...commitsMap[commit.oid].containingRefs,\n        ...refs,\n      ]);\n    } else {\n      const entry: CommitWithMeta & RepoDescriptor = {\n        readCommitResult: commit,\n        containingRefs: commitsMap[commit.oid]\n          ? new Set([...commitsMap[commit.oid].containingRefs, ...refs])\n          : refs,\n        repoPath,\n        isBare,\n      };\n      commitsMap[commit.oid] = entry;\n      commitsToProcess.splice(\n        index >= 0 ? index : commitsToProcess.length,\n        0,\n        entry\n      );\n    }\n  }\n  function getCommonArgs({\n    repoPath,\n    isBare,\n  }: {\n    repoPath: string;\n    isBare?: boolean;\n  }) {\n    return {\n      fs,\n      cache,\n      [isBare ? \"gitdir\" : \"dir\"]: repoPath,\n    };\n  }\n}\n","import { ReadCommitResult } from \"isomorphic-git\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\nimport { indexBy } from \"ramda\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { atomWithRefresh } from \"../../../atom-utils/atomWithRefresh\";\nimport { allBranchesAtom } from \"../../Branches/branches.state\";\nimport { resolvedRefAtoms } from \"../../refs.state\";\nimport { GitRef } from \"../GitRef\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { readCommits } from \"./readCommits\";\n\nfunction match(\n  input: string,\n  query: string,\n  flags: { matchCase?: boolean; regExp?: boolean } = {}\n) {\n  if (flags.regExp) {\n    return new RegExp(query, flags.matchCase ? \"\" : \"i\").test(input);\n  }\n  if (!flags.matchCase) {\n    return input.toLowerCase().includes(query.toLowerCase());\n  }\n  return input.includes(query);\n}\n\ntype CommitLogItem = {\n  readCommitResult: ReadCommitResult;\n  containingRefs: Set<string>;\n  repoPath: string;\n};\n\nexport const allCommitsAtom = atomWithRefresh<Promise<Array<CommitLogItem>>>(\n  async (get) => {\n    // TODO: readCommit can take too long. Suspending anything that depends on it leads to poor UX. would be nicer\n    //  to have the state updated (like an atom instead of selector) when commits are read, instead of query inside\n    //  the selector. But the challenge is that it does depend on another piece of state, allBranchesState\n    return readCommits(\n      fs,\n      ...(await get(allBranchesAtom)).map(\n        ({ repoRoot, localBranches, remoteBranches }) => ({\n          repoPath: repoRoot,\n          refs: [\"HEAD\"]\n            .concat(localBranches.map((branch) => branch.name))\n            .concat(\n              remoteBranches.map((branch) => `${branch.remote}/${branch.name}`)\n            ),\n        })\n      )\n    );\n  }\n);\n\nexport const commitsTableRowsAtom = atom(async (get) => {\n  const searchQuery = get(vcsLogFilterCurrentTab.searchQuery);\n  const branches = get(vcsLogFilterCurrentTab.branch);\n  const flags = {\n    matchCase: get(vcsLogFilterCurrentTab.matchCase),\n    regExp: get(vcsLogFilterCurrentTab.regExp),\n  };\n  const dateFilter = get(vcsLogFilterCurrentTab.date);\n\n  const rows = (await get(allCommitsAtom))\n    .filter(\n      ({ containingRefs }) =>\n        !branches?.length ||\n        branches.some((branch) => containingRefs.has(branch))\n    )\n    .filter(\n      ({ readCommitResult: { commit } }) =>\n        (!dateFilter?.from ||\n          commit.author.timestamp * 1000 > dateFilter.from.getTime()) &&\n        (!dateFilter?.to ||\n          commit.author.timestamp * 1000 < dateFilter.to.getTime())\n    )\n    .filter(\n      ({ readCommitResult: { commit } }) =>\n        !searchQuery ||\n        match(commit.message, searchQuery, flags) ||\n        match(commit.tree, searchQuery, { matchCase: false })\n    );\n\n  return {\n    rows,\n    byOid: indexBy(({ readCommitResult: commit }) => commit.oid, rows),\n  };\n});\n\nexport const allResolvedRefsAtom = atom(async (get) => {\n  const repoBranches = await get(allBranchesAtom);\n  const refs: Record<string, GitRef[]> = {};\n  const addRef = (ref: string, value: GitRef) => {\n    refs[ref] = refs[ref] || [];\n    refs[ref].push(value);\n  };\n  (\n    await Promise.all(\n      repoBranches.map(({ repoRoot }) =>\n        get(resolvedRefAtoms({ repoRoot, ref: \"HEAD\" }))\n      )\n    )\n  ).forEach((resolvedRef) => {\n    addRef(resolvedRef, {\n      type: \"head\",\n      name: \"HEAD\",\n    });\n  });\n  for (const { repoRoot, localBranches, currentBranch } of repoBranches) {\n    for (const branch of localBranches) {\n      addRef(await get(resolvedRefAtoms({ repoRoot, ref: branch.name })), {\n        type: \"localBranch\",\n        name: branch.name,\n        isCurrent: currentBranch?.name === branch.name,\n        trackingBranch: branch.trackingBranch,\n      });\n    }\n  }\n  for (const { repoRoot, remoteBranches } of repoBranches) {\n    for (const branch of remoteBranches) {\n      const branchName = `${branch.remote}/${branch.name}`;\n      addRef(await get(resolvedRefAtoms({ repoRoot, ref: branchName })), {\n        type: \"remoteBranch\",\n        name: branchName,\n      });\n    }\n  }\n  return refs;\n});\n\n/**\n * selection state of the commits table\n * TODO: make it per-tab\n */\nexport const commitsSelectionAtom = atom<Selection>(new Set([]));\n\n/**\n * OIDs of the selected commits in commits table.\n */\nexport const selectedCommitOids = atom(async (get) => {\n  const selection = get(commitsSelectionAtom);\n  if (selection === \"all\") {\n    return (await get(commitsTableRowsAtom)).rows.map(\n      ({ readCommitResult: { oid } }) => oid\n    );\n  }\n  return [...selection].map((i) => `${i}`);\n});\n\nexport const selectedCommitsAtom = atom(async (get) =>\n  Promise.all(\n    (await get(selectedCommitOids)).map(\n      async (oid) => (await get(commitsTableRowsAtom)).byOid[oid]\n    )\n  )\n);\n\n/**\n * Selected commit in the commits table. The first row, if multiple rows are selected\n */\nexport const selectedCommitAtom = atom(async (get) => {\n  const oid = (await get(selectedCommitOids))[0];\n  return (oid && (await get(commitsTableRowsAtom)).byOid[oid]) || null;\n});\n\nexport const vcsTableShowCommitTimestampAtom = atom<boolean>(false);\n\nexport const vcsTableReferencesOnTheLeftAtom = atom<boolean>(false);\n\nexport const vcsTableHighlightMyCommitsAtom = atom<boolean>(false);\n\nexport const authorColumn = {\n  id: \"Default.Author\",\n  name: \"Author\",\n};\nexport const hashColumn = {\n  id: \"Default.Hash\",\n  name: \"Hash\",\n};\n\nexport const dateColumn = {\n  id: \"Date.Date\",\n  name: \"Date\",\n};\n\nconst defaultVisibleColumns = [authorColumn.id, dateColumn.id];\nexport const vcsTableColumnsVisibilityAtoms = atomFamily((id: string) =>\n  atom<boolean>(defaultVisibleColumns.includes(id))\n);\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useCallback } from \"react\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useRefreshRepoStatuses,\n  vcsFootForFileAtom,\n} from \"../../file-status.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdAtom } from \"./ChangesView.state\";\nimport { AnyChange, Change } from \"../Change\";\nimport { resolvedRefAtoms } from \"../../refs.state\";\nimport { repoCurrentBranchNameAtom } from \"../../Branches/branches.state\";\nimport { allCommitsAtom } from \"../../VersionControlToolWindow/CommitsView/CommitsTable.state\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshFileStatus = useRefreshRepoStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useAtomCallback(\n    useCallback(\n      (get, set, changes: readonly AnyChange[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = Change.path(change);\n                      const repoRoot = await get(vcsFootForFileAtom(filePath));\n                      const content = (await fs.promises.exists(filePath))\n                        ? await fs.promises.readFile(filePath)\n                        : null;\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array | null;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                    const currentBranch = await get(\n                      repoCurrentBranchNameAtom(repoRoot)\n                    );\n                    if (currentBranch) {\n                      set(\n                        resolvedRefAtoms({\n                          repoRoot,\n                          ref: currentBranch,\n                        })\n                      );\n                    }\n                    set(resolvedRefAtoms({ repoRoot, ref: \"HEAD\" }));\n                  }\n                )\n              ).then(\n                () => {\n                  set(allCommitsAtom); // maybe a more efficient way to update only the newly added commit, when\n                  // allCommitsState is refactored to allow that\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdAtom, null);\n            },\n          }\n        );\n        set(commitTaskIdAtom, taskId);\n      },\n      []\n    )\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n */\nexport async function commitFiles({\n  updates,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  /**\n   * A mapping from file paths to either:\n   * - the new content of the file that should be committed, in form of a Uint8Array blob\n   * - null, indicating the files should be removed\n   */\n  updates: { [filePath: string]: Uint8Array | null };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  let containsChange = false;\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(updates).map(async ([filePath, blob]) => {\n      const index = entries.findIndex(({ path }) => path === filePath);\n      if (blob == null) {\n        // null indicates removed file\n        if (index > -1) {\n          containsChange = true;\n          entries.splice(index, 1);\n        }\n        return;\n      }\n      const entry = entries[index];\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n      containsChange = true;\n    })\n  );\n\n  if (!containsChange) {\n    throw new Error(\"Nothing to commit!\");\n  }\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(updates).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n} from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitAtom,\n  commitErrorMessageAtom,\n  commitMessageAtom,\n  commitTaskIdAtom,\n  includedChangesAtom,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useAtom(commitMessageAtom);\n  const commit = useCommitChanges();\n  const amend = useAtomValue(amendCommitAtom);\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useAtom(commitErrorMessageAtom);\n  const commitTaskId = useAtomValue(commitTaskIdAtom);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useAtomCallback(\n    useCallback((get) => {\n      const includedChanges = get(includedChangesAtom);\n      const commitMessage = get(commitMessageAtom);\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (get(amendCommitAtom)) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    }, [])\n  );\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n          mnemonic=\"i\"\n        >\n          {amend ? \"Amend Commit\" : \"Commit\"}\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented} mnemonic=\"P\">\n          {amend ? \"Amend Commit and Push...\" : \"Commit and Push...\"}\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { StatusColor } from \"../FileStatusColor\";\nimport { AnyChange, Change } from \"./Change\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<AnyChange>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => Change.fileStatus(change) === \"MODIFIED\"\n  ).length;\n  const addedCount = changes.filter(Change.isAddition).length;\n  const deletedCount = changes.filter(Change.isDeletion).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitAtom, includedChangesAtom } from \"./ChangesView.state\";\nimport { focusCommitMessage } from \"./ChangesViewSplitter\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useAtomValue(includedChangesAtom);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useAtom(amendCommitAtom);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={(value) => {\n                setAmend(value);\n                // TODO: alternate commit message between the latest commit message and the last edited message.\n                focusCommitMessage();\n              }}\n              preventFocus\n              mnemonic=\"m\"\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React from \"react\";\nimport { atom, useAtomValue } from \"jotai\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { useRefreshRepoStatuses } from \"../../file-status.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { actionAtom } from \"../../../actionAtom\";\nimport { alertDialogRefAtom } from \"../../../Project/project.state\";\nimport { deleteFilesCallback } from \"../../../Project/fs-operations\";\nimport { Change } from \"../Change\";\nimport { useSetActiveChangeList } from \"../change-lists.state\";\nimport {\n  changeListsUnderSelection,\n  changesUnderSelectedKeysAtom,\n} from \"./ChangesView.state\";\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\n\nconst selectedFilesCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 selected file}\n    other {# selected files}\n  }`,\n  \"en-US\"\n);\n\nconst deletablePathsUnderChangesTreeSelectionState = atom((get) =>\n  [...get(changesUnderSelectedKeysAtom).values()]\n    .filter((change) => change.type !== \"DELETED\")\n    .map(Change.path)\n);\n\nconst deleteActionAtom = actionAtom({\n  id: CommonActionId.DELETE,\n  title: \"Delete\",\n  description: \"Delete selected item\",\n  isDisabled: atom(\n    (get) => get(deletablePathsUnderChangesTreeSelectionState).length === 0\n  ),\n  actionPerformed: async ({ get, set }) => {\n    const pathsToDelete = get(deletablePathsUnderChangesTreeSelectionState);\n\n    const alertDialog = get(alertDialogRefAtom).current;\n    if (pathsToDelete.length === 0) {\n      return;\n    }\n    const confirmed = await alertDialog?.confirm({\n      title: \"Delete\",\n      okText: \"Delete\",\n      message: (\n        <div\n          style={{ width: 354 }}\n        >{`Are you sure you want to delete ${selectedFilesCountMsg.format({\n          count: pathsToDelete.length,\n        })}?`}</div>\n      ),\n    });\n    if (confirmed) {\n      console.log(`deleting ${pathsToDelete}`);\n      await deleteFilesCallback(get, set, pathsToDelete);\n    }\n  },\n});\n\nexport function useChangesViewActions() {\n  const selectedChangeLists = useAtomValue(changeListsUnderSelection);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  const actions: ActionDefinition[] = [\n    {\n      id: CommonActionId.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    useAtomValue(deleteActionAtom),\n  ];\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    // FIXME: action should be scoped to change lists tree\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  return actions;\n}\n","import React, { useRef } from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { isAnyRepoStatusUpdatingAtom } from \"../../file-status.state\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\nimport { useChangesViewActions } from \"./useChangesViewActions\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n  position: relative;\n`;\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  right: 0.125rem;\n  top: 0.125rem;\n  z-index: 1;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const updating = useAtomValue(isAnyRepoStatusUpdatingAtom);\n  const [commitMessageSize, setCommitMessageSize] = useAtom(\n    commitMessageSizeState(orientation)\n  );\n  const changesViewActions = useChangesViewActions();\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={[...treeActions, ...changesViewActions]}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                {updating && (\n                  <Delayed>\n                    <StyledLoadingWrapper>\n                      <LoadingGif />\n                    </StyledLoadingWrapper>\n                  </Delayed>\n                )}\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function ChangesViewZeroState() {\n  const performAction = usePerformAction();\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To commit changes,{\" \"}\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        For recent changes, see{\" \"}\n        <Link onPress={notImplemented}>Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useAtomValue } from \"jotai\";\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { ChangesViewZeroState } from \"./ChangesViewZeroState\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const vcsRoots = useAtomValue(vcsRootsAtom);\n  return (\n    <StyledContainer>\n      {vcsRoots.length > 0 ? <ChangesViewSplitter /> : <ChangesViewZeroState />}\n    </StyledContainer>\n  );\n};\n","import path from \"path\";\nimport React from \"react\";\n\nimport { LocalBranch } from \"./Branches/branches.state\";\n\nexport function TrackingBranchInfo({\n  branches,\n}: {\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n}) {\n  return (\n    <table style={{ borderSpacing: 0 }}>\n      {branches.map(({ branch, repoRoot }) => {\n        const mapping = branch.trackingBranch\n          ? `${branch.name}  ${branch.trackingBranch}`\n          : branches.length > 1\n          ? `${branch.name} (no tracking branch)`\n          : \"No tracking branch\";\n\n        return branches.length > 1 ? (\n          <tr key={repoRoot}>\n            <td>{path.basename(repoRoot)}: &nbsp;</td>\n            <td>{mapping}</td>\n          </tr>\n        ) : (\n          <tr key={repoRoot}>\n            <td>{mapping}</td>\n          </tr>\n        );\n      })}\n    </table>\n  );\n}\n","import React from \"react\";\nimport { atom, useAtomValue } from \"jotai\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { vcsFootForFileAtom } from \"./file-status.state\";\nimport { LocalBranch, repoBranchesAtom } from \"./Branches/branches.state\";\nimport { changesGroupingActiveState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { TrackingBranchInfo } from \"./TrackingBranchInfo\";\nimport { Change } from \"./Changes/Change\";\nimport { allChangesAtom } from \"./Changes/changes.state\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesAtom = atom(\n  async (get): Promise<Array<{ repoRoot: string; branch: LocalBranch }>> => {\n    const changesRepoRoots = (\n      await Promise.all(\n        get(allChangesAtom).map((change) =>\n          get(vcsFootForFileAtom(Change.path(change)))\n        )\n      )\n    ).filter(notNull);\n\n    return (\n      await Promise.all(\n        changesRepoRoots.map(async (repoRoot) => {\n          const branch = (await get(repoBranchesAtom(repoRoot))).currentBranch;\n          return branch\n            ? {\n                repoRoot,\n                branch,\n              }\n            : null;\n        })\n      )\n    ).filter(notNull);\n  }\n);\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useAtomValue(\n    changesGroupingActiveState(\"repository\")\n  );\n  const changesBranches = useAtomValue(changesBranchesAtom);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={changesBranches} />}\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledHeader = styled.div`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  height: 2.0625rem;\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n  flex-shrink: 0;\n`;\nexport const StyledSpacer = styled.div`\n  flex-grow: 1;\n`;\nexport const StyledPlaceholderContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n  align-items: center;\n  gap: 0.25rem;\n  min-height: 37%;\n  overflow: hidden;\n`;\n","import React from \"react\";\n\nexport const parseCommitMessage = (commitMessage: string) => {\n  const lines = commitMessage.split(\"\\n\");\n  const bodyLines = lines.slice(1);\n  return {\n    subject: lines[0],\n    bodyAsString: bodyLines.join(\"\\n\"),\n    body: (\n      <>\n        {bodyLines.map((line, index) => (\n          <React.Fragment key={index}>\n            {index > 0 && <br />}\n            {line}\n          </React.Fragment>\n        ))}\n      </>\n    ),\n  };\n};\n\nexport function shortenOid(oid: string) {\n  return oid.slice(0, 8);\n}\n\nconst commitDateTimeFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitTimeFormatter = new Intl.DateTimeFormat([], {\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitDateFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n});\n\nexport function formatCommitDateTime(date: Date | number) {\n  return commitDateTimeFormatter.format(date).replace(\" \", \"\");\n}\n\nexport function formatCommitDate(date: Date | number) {\n  return commitDateFormatter.format(date);\n}\n\nexport function formatCommitTime(date: Date | number) {\n  return commitTimeFormatter.format(date).replace(\" \", \"\");\n}\n","import path from \"path\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n  simpleGroupingRenderer,\n} from \"../../Changes/ChangesTree/changesTreeNodeRenderers\";\nimport { RepositoryNode } from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { shortenOid } from \"../commit-utils\";\nimport {\n  CommitChangesTreeNode,\n  CommitParentChangeTreeNode,\n} from \"./CommitsChangedFiles.state\";\n\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst commitParentNodeRenderer = simpleGroupingRenderer(\n  (node: CommitParentChangeTreeNode) =>\n    `Changes to ${shortenOid(path.basename(node.oid))} ${node.subject.slice(\n      0,\n      50\n    )}`\n);\nexport const commitChangesTreeNodeRenderer =\n  createChangesTreeNodeRenderer<CommitChangesTreeNode>(\n    {\n      commitParent: commitParentNodeRenderer,\n    },\n    {\n      repo: repoNodeRenderer,\n    }\n  );\n","import git from \"isomorphic-git\";\nimport path from \"path\";\n\nimport { AnyChange, Change, Revision } from \"../../Changes/Change\";\n\nconst cache = {}; // FIXME: find a better caching strategy. Per project?\nexport async function getCommitChanges({\n  fromRef,\n  toRef,\n  ...params\n}: {\n  dir?: string;\n  gitdir?: string;\n  fromRef: string;\n  toRef: string;\n} & Pick<Parameters<typeof git[\"walk\"]>[0], \"fs\" | \"dir\" | \"gitdir\">): Promise<\n  AnyChange[]\n> {\n  let items: AnyChange[] = await git.walk({\n    ...params,\n    cache,\n    trees: [git.TREE({ ref: fromRef }), git.TREE({ ref: toRef })],\n    map: async function map(\n      filepath,\n      [before, after]\n    ): Promise<null | boolean | AnyChange> {\n      const afterOid = await after?.oid();\n      const beforeOid = await before?.oid();\n      const afterType = await after?.type();\n      const beforeType = await before?.type();\n      if (afterOid === beforeOid) {\n        return null;\n      }\n      const afterRevision: Revision | null = afterOid\n        ? {\n            hash: afterOid,\n            path: path.join(params.dir || \"\", filepath),\n            isDir: afterType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await after?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const beforeRevision: Revision | null = beforeOid\n        ? {\n            hash: beforeOid,\n            path: path.join(params.dir || \"\" || \"\", filepath),\n            isDir: beforeType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await before?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const change: AnyChange | null =\n        afterRevision || beforeRevision\n          ? // @ts-expect-error ts can't tell that the signature matches\n            Change(beforeRevision, afterRevision)\n          : null;\n      return change && !Change.revision(change).isDir\n        ? change\n        : // returning null will cause the git.walk not to continue traversing the tree\n          false;\n    },\n  });\n\n  return (items || []).filter((item: boolean | AnyChange) => item);\n}\n","import { diffLines } from \"diff\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { AdditionChange, AnyChange, Change, DeletionChange } from \"./Change\";\n\n// Read more: https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage\nconst DEFAULT_SIMILARITY_INDEX = 50;\n\n/**\n * Given a list of changes, detects renames based on the change in the content of changes where only `before` or\n * `after` is present, and consolidates them into one change, making it count as a rename.\n * @param changes\n */\nexport async function detectRenames(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  return detectRenamesBasedOnContent(detectRenamesBasedOnHash(changes));\n}\n\nfunction detectRenamesBasedOnHash(\n  changes: ReadonlyArray<AnyChange>\n): AnyChange[] {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  return mergeRenames(\n    new Map<DeletionChange, { to: AdditionChange }>(\n      deletions\n        .map((deletion) => {\n          const match = additions.find(\n            ({ after: { hash } }) => hash === deletion.before.hash\n          );\n          if (match) {\n            return [deletion, { to: match }] as const;\n          }\n          return null;\n        })\n        .filter(notNull)\n    ),\n    changes\n  );\n}\n\nasync function detectRenamesBasedOnContent(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  const contents = new Map<AnyChange, string>();\n  const getContent = async (change: AnyChange): Promise<string> => {\n    if (!contents.get(change)) {\n      contents.set(change, await Change.content(change));\n    }\n    return contents.get(change) ?? \"\";\n  };\n  const renameMapping = new Map<\n    DeletionChange,\n    { similarity: number; to: AdditionChange }\n  >();\n  await Promise.all(\n    deletions.map(async (deletion) => {\n      return Promise.all(\n        additions.map(async (addition) => {\n          const similarity = await computeSimilarity(\n            await getContent(deletion),\n            await getContent(addition)\n          );\n          const currentCandidate = renameMapping.get(deletion);\n          if (\n            similarity >= DEFAULT_SIMILARITY_INDEX &&\n            (!currentCandidate || similarity > currentCandidate.similarity)\n          ) {\n            renameMapping.set(deletion, { similarity, to: addition });\n          }\n        })\n      );\n    })\n  );\n  return mergeRenames(renameMapping, changes);\n}\n\nfunction mergeRenames(\n  renameMapping: Map<DeletionChange, { to: AdditionChange }>,\n  changes: ReadonlyArray<AnyChange>\n) {\n  const renamedChanges: AnyChange[] = [...renameMapping.values()].map(\n    (rename) => rename.to\n  );\n  return changes\n    .map((change) => {\n      if (Change.isDeletion(change)) {\n        const candidate = renameMapping.get(change);\n        if (candidate) {\n          return Change(change.before, candidate?.to.after);\n        }\n      }\n      return change;\n    })\n    .filter((change) => !renamedChanges.includes(change));\n}\n\n/**\n * Computes similarity to two strings (typically file contents), and returns a similarity score,\n * similar to [git's similarity index](https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage)\n * based on diff computed on a line basis.\n *\n * Note on performance:\n * diff computation can be quite heavy, so it's at least made async not to block the main thread. Further improvement\n * could be moving it to a worker thread.\n * Several alternatives are tested with no luck:\n * - fast-diff: It turned out to be much slower than diff\n * - fast-myers-diff: doesn't seem to support line diffing, or maybe it does but it wasn't straightforward, so skipped it.\n * - detect-rename: too slow!\n */\nasync function computeSimilarity(file1Content: string, file2Content: string) {\n  return new Promise<number>((resolve, reject) => {\n    diffLines(file1Content, file2Content, (err, value = []) => {\n      if (err) {\n        return reject(err);\n      }\n      const { unchanged, total } = value.reduce(\n        ({ total, unchanged }, change) => {\n          const count = change.count ?? 0;\n\n          return {\n            total: total + count,\n            unchanged:\n              unchanged + (!change.added && !change.removed ? count : 0),\n          };\n        },\n        { total: 0, unchanged: 0 }\n      );\n      resolve(100 * (unchanged / total));\n    });\n  });\n}\n","import React, { Key, RefObject } from \"react\";\nimport { atom, Getter } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport { sortTreeNodesInPlace } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport {\n  defaultChangeGroupings,\n  directoryGrouping,\n  getChangesGroupFn,\n} from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changeNode,\n  ChangesTreeGroupNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n} from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { changesTreeNodesResult } from \"../../Changes/ChangesTree/changesTreeNodesResult\";\nimport { ChangeListObj } from \"../../Changes/change-lists.state\";\nimport {\n  commitsTableRowsAtom,\n  selectedCommitsAtom,\n} from \"../CommitsView/CommitsTable.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\nimport { getCommitChanges } from \"./getCommitChanges\";\nimport { detectRenames } from \"../../Changes/detectRenames\";\nimport { equals } from \"ramda\";\n\nexport const changesGroupingActiveAtoms = atomFamily((id: string) =>\n  atom(id === directoryGrouping.id)\n);\n\nexport const commitChangesTreeRefAtom = atom<RefObject<TreeRefValue>>(\n  React.createRef<TreeRefValue>()\n);\n\nexport const expandedKeysAtom = atom<Set<Key>>(new Set<Key>());\n\nexport const selectionAtom = atom<Selection>(new Set<Key>());\n\nconst COMMIT_PARENT_ID = \"commitParent\";\n\nexport type CommitChangesTreeNode =\n  ExtendedChangesTreeNode<CommitParentChangeTreeNode>;\nexport interface CommitParentChangeTreeNode\n  extends ChangesTreeGroupNode<typeof COMMIT_PARENT_ID, CommitChangesTreeNode> {\n  changeList: ChangeListObj;\n  oid: string;\n  subject: string;\n}\n\ntype CommitDiffParams = Pick<\n  Parameters<typeof getCommitChanges>[0],\n  \"fromRef\" | \"toRef\" | \"dir\"\n>;\nconst commitsDiffWithoutRenamesAtoms = atomFamily(\n  (params: CommitDiffParams) =>\n    atom(() =>\n      getCommitChanges({\n        fs,\n        ...params,\n      })\n    ),\n  equals\n);\n\nconst commitsDiffAtoms = atomFamily(\n  (params: CommitDiffParams) =>\n    atom(async (get) =>\n      detectRenames(await get(commitsDiffWithoutRenamesAtoms(params)))\n    ),\n  equals\n);\n\nconst getChangedFilesAtom =\n  (atomForCommitsDiff: typeof commitsDiffAtoms) => async (get: Getter) => {\n    const selectedCommits = await get(selectedCommitsAtom);\n    const commitLogItem = selectedCommits[0]; // FIXME: take all selected commits into account\n    const { byOid } = await get(commitsTableRowsAtom);\n    const toRef = commitLogItem?.readCommitResult?.oid;\n    const parents = commitLogItem?.readCommitResult.commit.parent;\n    if (toRef && parents) {\n      const groupFn = getChangesGroupFn({\n        get,\n        groupings: defaultChangeGroupings,\n        isActive: changesGroupingActiveAtoms,\n      });\n      const rootNodes = await Promise.all(\n        parents?.map(\n          async (parent) =>\n            ({\n              type: COMMIT_PARENT_ID,\n              key: changesTreeNodeKey(COMMIT_PARENT_ID, parent),\n              oid: parent,\n              subject: byOid[parent]?.readCommitResult.commit.message || \"\",\n              children: groupFn(\n                [\n                  ...(await get(\n                    atomForCommitsDiff({\n                      toRef,\n                      fromRef: parent,\n                      dir: commitLogItem.repoPath,\n                    })\n                  )),\n                ].map((node) => changeNode(node))\n              ),\n            } as CommitParentChangeTreeNode)\n        )\n      );\n\n      const { expandAllKeys, fileCountsMap, ...result } =\n        changesTreeNodesResult(\n          rootNodes.length === 1\n            ? rootNodes[0].children\n            : rootNodes.filter(({ children }) => children.length > 0)\n        );\n\n      type Writeable<T> = { -readonly [P in keyof T]: T[P] };\n      sortTreeNodesInPlace(\n        (node) =>\n          (node.type === \"directory\" ? \"a_\" : \"b_\") +\n          commitChangesTreeNodeRenderer\n            .getTextValue(node, { fileCountsMap })\n            .toLowerCase(),\n        {\n          // cheating with the types by removing readonly constraints to use the inplace sort tree util.\n          // it should be ok, since the ReadonlyArray is only a compile-time thing.\n          roots: result.rootNodes as Writeable<typeof result.rootNodes>,\n          getChildren: (node) =>\n            \"children\" in node\n              ? (node.children as Writeable<typeof node.children>)\n              : null,\n        }\n      );\n\n      return {\n        ...result,\n        fileCountsMap,\n        expandAllKeys: new Set(\n          [...expandAllKeys].filter(\n            (key) => !`${key}`.startsWith(COMMIT_PARENT_ID)\n          )\n        ),\n      };\n    }\n    return null;\n  };\n\n/**\n * Changes corresponding to the currently selected commits, before rename detection, which can be slow.\n */\nexport const changedFilesWithoutRenamesAtom = atom(\n  getChangedFilesAtom(commitsDiffWithoutRenamesAtoms)\n);\n\n/**\n * Changes corresponding to the currently selected commits.\n */\nexport const changedFilesAtom = atom(getChangedFilesAtom(commitsDiffAtoms));\n","import React, { HTMLAttributes, useEffect } from \"react\";\nimport { atom, Atom, useAtom, useAtomValue } from \"jotai\";\nimport { loadable } from \"jotai/utils\";\n\nimport {\n  HelpTooltip,\n  PlatformIcon,\n  PositionedTooltipTrigger,\n  SpeedSearchTree,\n  styled,\n} from \"@intellij-platform/core\";\n\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { selectedCommitsAtom } from \"../CommitsView/CommitsTable.state\";\nimport {\n  changedFilesAtom,\n  changedFilesWithoutRenamesAtom,\n  commitChangesTreeRefAtom,\n  expandedKeysAtom,\n  selectionAtom,\n} from \"./CommitsChangedFiles.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  inset: 0;\n  gap: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst loadableChangedFilesAtom = [\n  changedFilesAtom,\n  changedFilesWithoutRenamesAtom,\n].map(loadable);\n\nconst changedFilesLoadableAtom = atom((get) => {\n  return get(\n    loadableChangedFilesAtom.find((atom) => get(atom).state === \"hasData\") ??\n      loadableChangedFilesAtom.slice(-1)[0]\n  );\n});\n\n/**\n * TODO: handle multiple selected commits (check Changes.ShowChangesFromParents https://github.com/JetBrains/intellij-community/blob/ac57611a0612bd65ba2a19c841a4f95b40591134/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/frame/VcsLogChangesBrowser.java#L255-L254)\n */\nexport function CommitChangedFiles({\n  treeShortcutHandlerProps,\n}: {\n  treeShortcutHandlerProps: HTMLAttributes<HTMLElement>;\n}) {\n  const selectedCommits = useAtomValue(unwrapLatestOrNull(selectedCommitsAtom));\n  const treeRef = useAtomValue(commitChangesTreeRefAtom);\n  const nothingSelected = !selectedCommits?.length;\n\n  const stateLoadable = useAtomValue(changedFilesLoadableAtom);\n  const state = stateLoadable.state === \"hasData\" ? stateLoadable.data : null;\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtom);\n  const [selection, setSelection] = useAtom(selectionAtom);\n\n  useEffect(() => {\n    // TODO: expanded keys are supposed to be set based on selected keys\n    setExpandedKeys(state?.expandAllKeys ?? new Set());\n    setSelection(new Set());\n    // FIXME: with this being in an effect here, closing and reopening the toolwindow will\n    //  reset the selection, making selection state be effectively like a local state.\n  }, [stateLoadable.state]);\n\n  if (nothingSelected) {\n    return (\n      <StyledPlaceholderContainer>\n        Select commits to to view changes\n      </StyledPlaceholderContainer>\n    );\n  }\n  return (\n    <div\n      {...treeShortcutHandlerProps}\n      style={{\n        height: \"-webkit-fill-available\",\n        position: \"relative\",\n      }}\n    >\n      {stateLoadable.state === \"loading\" && (\n        <Delayed>\n          <StyledLoadingWrapper>\n            <LoadingGif style={{ width: \"1.5rem\" }} />\n            Loading...\n          </StyledLoadingWrapper>\n        </Delayed>\n      )}\n      {state && (\n        <SpeedSearchTree\n          aria-label=\"Commit changes\"\n          treeRef={treeRef}\n          items={state.rootNodes}\n          selectionMode=\"multiple\"\n          expandedKeys={expandedKeys}\n          onExpandedChange={setExpandedKeys}\n          selectedKeys={selection}\n          onSelectionChange={setSelection}\n          style={{ paddingBottom: \"1rem\" }}\n          fillAvailableSpace\n        >\n          {commitChangesTreeNodeRenderer.itemRenderer({\n            fileCountsMap: state.fileCountsMap,\n          })}\n        </SpeedSearchTree>\n      )}\n      {selectedCommits.length > 1 && (\n        <PositionedTooltipTrigger\n          placement=\"top\"\n          tooltip={\n            <HelpTooltip\n              helpText={\n                <>\n                  Showing diff for more than one commit is not currently\n                  supported. Only the first selected commit is taken into\n                  account.\n                </>\n              }\n            ></HelpTooltip>\n          }\n        >\n          {(props) => (\n            <span\n              {...props}\n              style={{\n                position: \"absolute\",\n                right: \"0.5rem\",\n                bottom: \"0.5rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/warning\" />\n            </span>\n          )}\n        </PositionedTooltipTrigger>\n      )}\n    </div>\n  );\n}\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { StyledCurrentBranchTag } from \"../Changes/StyledCurrentBranchTag\";\nimport { GitRef } from \"./GitRef\";\n\nconst labelIcon = (\n  <path\n    fill=\"currentColor\"\n    d=\"M4.2 4.8 C4.8627 4.8 5.4 5.3373 5.4 6 C5.4 6.6627 4.8627 7.2 4.2 7.2 C3.5373 7.2 3 6.6627 3 6 C3 5.3373 3.5373 4.8 4.2 4.8 ZM0.6 2.4 L0.6 7.2 L7.8 14.4 L12.6 9.6 L5.4 2.4 Z\"\n  />\n);\nconst vcsLogStandardColors = {\n  TIP: { light: \"#ffd100\", dark: \"#e1c731\" },\n  LEAF: { light: \"#8a2d6b\", dark: \"#c31e8c\" },\n  BRANCH: { light: \"#3cb45c\", dark: \"#3cb45c\" },\n  BRANCH_REF: { light: \"#9f79b5\", dark: \"#9f79b5\" },\n  TAG: { light: \"#7a7a7a\", dark: \"#999999\" },\n};\nconst gitLogColors: Record<GitRef[\"type\"], (args: { theme: Theme }) => string> =\n  {\n    head: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.headIconColor\",\n        vcsLogStandardColors.TIP\n      ),\n    localBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.localBranchIconColor\",\n        vcsLogStandardColors.BRANCH\n      ),\n    remoteBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.remoteBranchIconColor\",\n        vcsLogStandardColors.BRANCH_REF\n      ),\n    tag: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.tagIconColor\",\n        vcsLogStandardColors.TAG\n      ),\n  };\n\nconst StyledRef = styled(StyledCurrentBranchTag)`\n  border-radius: 3px;\n  align-items: stretch;\n  font-size: 0.75rem;\n`;\n\nconst StyledLabelSvg = styled.svg.attrs({ viewBox: \"0 0 14.5 14.5\" })<{\n  type: GitRef[\"type\"];\n}>`\n  width: 1rem;\n  height: 1rem;\n  stroke: rgba(0, 0, 0, 0.25);\n  stroke-width: 0.5px;\n  color: ${({ type, theme }) => gitLogColors[type]({ theme })};\n  z-index: 1; // for the right vertical order of grouped labels\n  &:not(:first-child) {\n    margin-right: -11px;\n  }\n`;\n\nconst StyledRefIconGroup = styled.span`\n  display: inline-flex;\n  flex-direction: row-reverse;\n`;\n\nconst StyledLabelText = styled.span`\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\n\nexport function RefIcon({ type }: { type: GitRef[\"type\"] }) {\n  return <StyledLabelSvg type={type}>{labelIcon}</StyledLabelSvg>;\n}\n\nexport function RefIconGroup({ types }: { types: Array<GitRef[\"type\"]> }) {\n  return (\n    <StyledRefIconGroup>\n      {types.map((type, index) => (\n        <StyledLabelSvg key={index} type={type}>\n          {labelIcon}\n        </StyledLabelSvg>\n      ))}\n    </StyledRefIconGroup>\n  );\n}\nexport function RefLabel({\n  types,\n  children,\n}: {\n  types: Array<GitRef[\"type\"]>;\n  children: React.ReactNode;\n}) {\n  return (\n    <StyledRef>\n      <RefIconGroup types={types} />\n      <StyledLabelText>{children}</StyledLabelText>\n    </StyledRef>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport { useAtomValue } from \"jotai\";\nimport React, { ReactNode } from \"react\";\n\nimport { Link, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport {\n  formatCommitDate,\n  formatCommitTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\nimport {\n  allResolvedRefsAtom,\n  selectedCommitAtom,\n} from \"../CommitsView/CommitsTable.state\";\nimport { RefIconGroup } from \"../RefLabel\";\nimport { GitRef } from \"../GitRef\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nconst StyledContainer = styled.div`\n  padding: 0.875rem;\n  cursor: default;\n`;\nconst StyledCommitMessage = styled.div`\n  font-family: \"JetBrains Mono\", monospace;\n  line-height: 1.125rem;\n  margin-bottom: 1.25rem;\n  margin-right: 1.1875rem;\n`;\n\nconst StyledCommitMessageHeader = styled.div`\n  font-weight: bold;\n`;\nconst StyledCommitterInfo = styled.div`\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n`;\n\nconst StyledCommitInfoRow = styled.div`\n  line-height: 1.2;\n  display: flex;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\nconst StyledRepoColorIcon = styled(RepoColorIcon)`\n  align-self: start;\n`;\n\nconst StyledRefsContainer = styled.span`\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\n\nexport function CommitDetails() {\n  const firstSelectedCommit = useAtomValue(\n    unwrapLatestOrNull(selectedCommitAtom)\n  );\n  const allResolvedRefs = useAtomValue(unwrapLatestOrNull(allResolvedRefsAtom));\n  const isMultiRepo = useAtomValue(vcsRootsAtom).length > 0;\n  if (!firstSelectedCommit) {\n    return (\n      <StyledPlaceholderContainer>\n        No commits selected\n      </StyledPlaceholderContainer>\n    );\n  }\n\n  const {\n    readCommitResult: { commit, oid },\n    containingRefs,\n    repoPath,\n  } = firstSelectedCommit;\n  const { subject, body } = parseCommitMessage(commit.message);\n  const committerInfo: ReactNode[] = [];\n  if (commit.committer.name !== commit.author.name) {\n    committerInfo.push(\n      <React.Fragment key={commit.committer.email}>\n        by {commit.committer.name} <EmailLink email={commit.committer.email} />\n      </React.Fragment>\n    );\n  }\n  if (commit.committer.timestamp !== commit.author.timestamp) {\n    committerInfo.push(formatDateAndTime(commit.committer.timestamp * 1000));\n  }\n  const refs = allResolvedRefs?.[oid] || [];\n  const refsByType = groupBy((ref) => ref.type, refs);\n  return (\n    <StyledContainer>\n      <StyledCommitMessage>\n        <StyledCommitMessageHeader>{subject}</StyledCommitMessageHeader>\n        {body}\n      </StyledCommitMessage>\n      <StyledCommitInfoRow>\n        {isMultiRepo && (\n          <TooltipTrigger tooltip={<Tooltip>{repoPath}</Tooltip>}>\n            {(props) => <StyledRepoColorIcon {...props} rootPath={repoPath} />}\n          </TooltipTrigger>\n        )}\n        <div>\n          {`${shortenOid(oid)} ${commit.author.name} `}\n          <EmailLink email={commit.author.email} />{\" \"}\n          {`${formatDateAndTime(new Date(commit.author.timestamp * 1000))}`}\n          {committerInfo.length > 0 && (\n            <StyledCommitterInfo>committed {committerInfo}</StyledCommitterInfo>\n          )}\n        </div>\n      </StyledCommitInfoRow>\n      {refs.length > 0 && (\n        <StyledRefsContainer>\n          <RefGroup refs={refsByType.head} />\n          <RefGroup refs={refsByType.localBranch} />\n          <RefGroup refs={refsByType.remoteBranch} />\n          <RefGroup refs={refsByType.tag} />\n        </StyledRefsContainer>\n      )}\n      <div>\n        {/*TODO: collapsing and \"Show more\"*/}\n        In {containingRefs.size} branches: {[...containingRefs].join(\", \")}\n      </div>\n    </StyledContainer>\n  );\n}\n\nconst StyledRefWithIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n`;\nfunction RefGroup({ refs }: { refs: undefined | GitRef[] }) {\n  return refs?.length ? (\n    <>\n      {refs.map((ref, index) => {\n        const name = `${ref.name}${index === refs.length - 1 ? \"\" : \",\"}`;\n        return index === 0 ? (\n          <StyledRefWithIcon>\n            <RefIconGroup types={refs.map(({ type }) => type).slice(0, 2)} />\n            {name}\n          </StyledRefWithIcon>\n        ) : (\n          // span is needed for the right flex-wrap behavior\n          <span>{name}</span>\n        );\n      })}\n    </>\n  ) : null;\n}\n\nfunction EmailLink({ email }: { email: string }) {\n  return (\n    <a href={`mailto:${email}`} style={{ all: \"unset\" }}>\n      <Link>{`<${email}>`}</Link>\n    </a>\n  );\n}\n\nfunction formatDateAndTime(date: Date | number) {\n  return `on ${formatCommitDate(date)} at ${formatCommitTime(date)}`;\n}\n","import { useMemo } from \"react\";\nimport { ActionDefinition, useActions } from \"@intellij-platform/core\";\n\n/**\n * Currently, action groups are expected to **define** the child actions, instead of just referencing already defined\n * actions. In such model, where groups are not just a grouping of existing actions, this hook allows for redefining\n * existing actions to be used within a group. Kind of a temporary solution while action system evolves.\n */\nexport function useRedefineAction(\n  actionId: string,\n  newId: string\n): ActionDefinition | null {\n  const actions = useActions();\n  const action = actions.find(({ id }) => id === actionId);\n\n  return useMemo(() => {\n    if (!action) {\n      return null;\n    }\n    const { perform, id, ...commonProperties } = action;\n    return {\n      ...commonProperties,\n      id: newId,\n      useShortcutsOf: id,\n      isSearchable: false,\n      actionPerformed: (context) => {\n        perform(context);\n      },\n    };\n  }, [action]);\n}\n","import React, { HTMLAttributes, useCallback } from \"react\";\nimport { Atom, atom, useAtom, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\n\nimport {\n  ActionButton,\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  CommonActionId,\n  IconButton,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  styled,\n  ThreeViewSplitter,\n  Toolbar,\n  TooltipTrigger,\n  useActionGroup,\n  useCreateDefaultActionGroup,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { CommitChangedFiles } from \"../CommitChanges/CommitsChangedFiles\";\nimport { CommitDetails } from \"./CommitDetails\";\nimport { defaultChangeGroupings } from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changesGroupingActiveAtoms,\n  commitChangesTreeRefAtom,\n} from \"../CommitChanges/CommitsChangedFiles.state\";\nimport {\n  vcsLogTabShowCommitDetailsInCurrentTabAtom,\n  vcsLogTabShowCommitDetailsAtoms,\n} from \"../vcs-logs.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { useRedefineAction } from \"../../../useRedefineAction\";\n\nimport { isAtom } from \"../../../atom-utils/isAtom\";\n\nconst splitViewSizeState = atom(0.5);\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst groupingAtom = atom((get) => {\n  const groupings = defaultChangeGroupings.filter((grouping) =>\n    isAtom(grouping.isAvailable)\n      ? get(grouping.isAvailable)\n      : grouping.isAvailable\n  );\n  return groupings.map((grouping) => ({\n    ...grouping,\n    key: `groupBy:${grouping.id}`,\n    isActive: get(changesGroupingActiveAtoms(grouping.id)),\n  }));\n});\n\nconst GROUP_BY_ACTION_GROUP_ID = \"Vcs.log.detailsView.groupBy\";\nconst LAYOUT_ACTION_GROUP_ID = \"Vcs.log.detailsView.layout\";\nconst VIEW_OPTIONS_ACTION_GROUP_ID = \"Vcs.log.detailsView.viewOptions\";\nconst SHOW_DETAILS_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DETAILS}`;\nconst SHOW_DIFF_PREVIEW_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DIFF_PREVIEW}`;\n\nconst groupingActionId = (grouping: { id: string }) => {\n  return `Vcs.log.detailsView.groupBy.${grouping.id}`;\n};\n\nexport function VcsLogDetailsView({ tabKey }: { tabKey: string }) {\n  const [splitViewSize, setSplitViewSize] = useAtom(splitViewSizeState);\n  const isDetailsVisible = useAtomValue(\n    vcsLogTabShowCommitDetailsAtoms(tabKey)\n  );\n  const toggleGroupBy = useAtomCallback(\n    useCallback((get, set, id: string) => {\n      set(changesGroupingActiveAtoms(id), (currentValue) => !currentValue);\n    }, [])\n  );\n  const createActionGroup = useCreateDefaultActionGroup();\n  const availableGroupings = useAtomValue(groupingAtom);\n\n  const treeRef = useAtomValue(commitChangesTreeRefAtom);\n  const actions = [\n    createActionGroup({\n      id: VIEW_OPTIONS_ACTION_GROUP_ID,\n      title: \"View Options\",\n      icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n      children: [\n        createActionGroup({\n          id: GROUP_BY_ACTION_GROUP_ID,\n          title: \"Group By\",\n          menuPresentation: \"titledSection\",\n          icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n\n          children: availableGroupings.map((grouping) => ({\n            id: groupingActionId(grouping),\n            useShortcutsOf: grouping.useShortcutOf,\n            title: grouping.title,\n            actionPerformed: () => {\n              toggleGroupBy(grouping.id);\n            },\n          })),\n        }),\n        createActionGroup({\n          id: LAYOUT_ACTION_GROUP_ID,\n          menuPresentation: \"titledSection\",\n          title: \"Layout\",\n          children: [\n            useRedefineAction(\n              VcsActionIds.SHOW_DETAILS,\n              SHOW_DETAILS_ACTION_ID\n            ),\n            useRedefineAction(\n              VcsActionIds.SHOW_DIFF_PREVIEW,\n              SHOW_DIFF_PREVIEW_ACTION_ID\n            ),\n          ].filter(notNull),\n        }),\n      ],\n    }),\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer>\n          <StyledHeader>\n            <Toolbar>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Show Diff\" shortcut=\"D\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon={\"actions/diff.svg\"} />\n                </IconButton>\n              </TooltipTrigger>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Revert Selected Changes\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon=\"actions/rollback.svg\" />\n                </IconButton>\n              </TooltipTrigger>\n              <IconButtonWithMenu\n                renderMenu={({ menuProps }) => {\n                  return (\n                    <VcsLogsDetailsViewOptionsMenu menuProps={menuProps} />\n                  );\n                }}\n              >\n                <PlatformIcon icon=\"actions/groupBy.svg\" />\n              </IconButtonWithMenu>\n            </Toolbar>\n            <StyledSpacer />\n            <Toolbar style={{ flexShrink: 0 }}>\n              <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n              <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n            </Toolbar>\n          </StyledHeader>\n          <div style={{ flex: 1, minHeight: 0 }}>\n            {isDetailsVisible ? (\n              <ThreeViewSplitter\n                orientation=\"vertical\"\n                firstSize={splitViewSize}\n                onFirstResize={setSplitViewSize}\n                firstViewMinSize={10}\n                firstView={\n                  <CommitChangedFiles\n                    treeShortcutHandlerProps={shortcutHandlerProps}\n                  />\n                }\n                innerView={<CommitDetails />}\n              />\n            ) : (\n              <CommitChangedFiles\n                treeShortcutHandlerProps={shortcutHandlerProps}\n              />\n            )}\n          </div>\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst toggleActionAtoms: { [actionId: string]: Atom<boolean> } = {\n  [SHOW_DETAILS_ACTION_ID]: vcsLogTabShowCommitDetailsInCurrentTabAtom,\n  ...Object.fromEntries(\n    defaultChangeGroupings.map((grouping) => [\n      groupingActionId(grouping),\n      changesGroupingActiveAtoms(grouping.id),\n    ])\n  ),\n};\n\nconst selectedKeysAtom = atom((get) =>\n  Object.entries(toggleActionAtoms)\n    .filter(([, state]) => get(state))\n    .map(([actionId]) => actionId)\n);\n\nfunction VcsLogsDetailsViewOptionsMenu({\n  menuProps,\n}: {\n  menuProps: Omit<HTMLAttributes<HTMLDivElement>, \"autoFocus\">;\n}) {\n  const group = useActionGroup(VIEW_OPTIONS_ACTION_GROUP_ID);\n  const selectedKeys = useAtomValue(selectedKeysAtom);\n  return (\n    group && (\n      <ActionGroupMenu actionGroup={group}>\n        {(actionMenuProps) => (\n          <SpeedSearchMenu\n            {...menuProps}\n            {...actionMenuProps}\n            selectedKeys={selectedKeys}\n          />\n        )}\n      </ActionGroupMenu>\n    )\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  BareButton,\n  MenuTrigger,\n  MenuTriggerProps,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledDropdownButton = styled.button`\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding-left: 0.25rem;\n  cursor: pointer;\n  background: transparent;\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n\n  line-height: 1.5;\n  border-radius: 0.25rem;\n  white-space: nowrap;\n  border: 2px solid transparent;\n  &:hover {\n    color: ${({ theme }) => theme.color(\"*.foreground\")};\n  }\n  &:focus-visible {\n    border-color: ${({ theme }) =>\n      theme.commonColors.focusRing({ focused: true })};\n  }\n`;\n\nconst StyledDropdownIcon = styled.span`\n  margin-left: -1px;\n  line-height: 1.2;\n`;\n\nconst StyledValue = styled.span`\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  max-width: 8.25rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst FocusableAutoHoverPlatformIcon = styled(AutoHoverPlatformIcon)`\n  &:focus-visible {\n    outline: 2px solid\n      ${({ theme }) => theme.commonColors.focusRing({ focused: true })};\n    outline-offset: -2px;\n  }\n`;\nexport function VcsFilterDropdown({\n  label,\n  value,\n  onClear,\n  ...menuTriggerProps\n}: Omit<MenuTriggerProps, \"children\"> & {\n  label: React.ReactNode;\n  value?: React.ReactNode;\n  onClear?: () => void;\n}) {\n  return (\n    <MenuTrigger {...menuTriggerProps}>\n      {(props, ref) => (\n        <StyledDropdownButton {...props} ref={ref}>\n          {label}\n          {value ? (\n            <>\n              : <StyledValue>{value}</StyledValue>\n              <BareButton onPress={onClear}>\n                <FocusableAutoHoverPlatformIcon\n                  icon=\"actions/close\"\n                  hoverIcon=\"actions/closeHovered\"\n                />\n              </BareButton>\n            </>\n          ) : (\n            <StyledDropdownIcon>\n              <PlatformIcon icon=\"general/arrowDownSmall.svg\" />\n            </StyledDropdownIcon>\n          )}\n        </StyledDropdownButton>\n      )}\n    </MenuTrigger>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport React, { HTMLAttributes, useEffect, useState } from \"react\";\nimport { atom, useAtom, useAtomValue } from \"jotai\";\nimport { useResetAtom } from \"jotai/utils\";\nimport {\n  Divider,\n  Item,\n  MenuItemLayout,\n  SpeedSearchMenu,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  allBranchesAtom,\n  BranchType,\n  useFavoriteBranches,\n} from \"../../Branches/branches.state\";\nimport { BranchFavoriteButton } from \"../../Branches/BranchFavoriteButton\";\nimport { vcsLogFilter } from \"../vcs-logs.state\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nexport function BranchesFilterDropdown({ tabKey }: { tabKey: string }) {\n  const [selectedBranches, setSelectedBranches] = useAtom(\n    vcsLogFilter.branch(tabKey)\n  );\n  const resetBranches = useResetAtom(vcsLogFilter.branch(tabKey));\n\n  return (\n    <VcsFilterDropdown\n      value={selectedBranches.length > 0 ? selectedBranches.join(\"|\") : null}\n      onClear={resetBranches}\n      renderMenu={({ menuProps }) => (\n        <BranchesFilterMenu\n          menuProps={menuProps}\n          onBranchesSelected={setSelectedBranches}\n        />\n      )}\n      label=\"Branch\"\n    />\n  );\n}\n\nconst groupRepoRoots = (\n  branches: Array<{ branchName: string; repoRoot: string }>\n) =>\n  Object.entries(groupBy(({ branchName }) => branchName, branches)).map(\n    ([branchName, items]) => ({\n      branchName,\n      repoRoots: items.map((item) => item.repoRoot),\n    })\n  );\n/**\n * Unique list of all local and remote branches of all repositories.\n * Each branch has a list of repos which indicates the list of repository roots the branch appears in.\n */\nconst repoGroupedAllBranchesState = atom(async (get) => {\n  const allBranches = await get(allBranchesAtom);\n  const allRemoteBranches = allBranches.flatMap(\n    ({ remoteBranches, repoRoot }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branchName: `${branch.remote}/${branch.name}`,\n      }))\n  );\n  const allLocalBranches = allBranches.flatMap(({ localBranches, repoRoot }) =>\n    localBranches.map((branch) => ({\n      repoRoot,\n      branchName: branch.name,\n    }))\n  );\n  return {\n    localBranches: groupRepoRoots(allLocalBranches),\n    remoteBranches: groupRepoRoots(allRemoteBranches),\n  };\n});\n\ntype BranchMenuItem = {\n  branchType: BranchType;\n  branchName: string;\n  repoRoots: string[];\n};\n\nfunction BranchesFilterMenu({\n  menuProps,\n  onBranchesSelected,\n}: {\n  onBranchesSelected: (branches: string[]) => void;\n  menuProps: Omit<HTMLAttributes<HTMLElement>, \"autoFocus\">;\n}) {\n  const [favoriteBranches, setFavoriteBranches] = useState<BranchMenuItem[]>(\n    []\n  );\n  const { toggleFavorite, isFavorite } = useFavoriteBranches();\n  const repoGroupedAllBranches = useAtomValue(\n    unwrapLatestOrNull(repoGroupedAllBranchesState)\n  );\n  const { localBranches = [], remoteBranches = [] } =\n    repoGroupedAllBranches || {};\n\n  const remoteBranchesByRemote = groupBy(\n    ({ branchName }) => branchName.split(\"/\")[0],\n    remoteBranches\n  );\n\n  // The list of favorite branches is calculated on render, and is intentionally not updated. This behavior is copied\n  // from the reference implementation. Probably in order to not have items jump in and out of the menu, when branches\n  // are marked/unmarked as favorite. One improvement (?) here is that isFavorite state is always correct, as opposed\n  // to the reference implementation where (at least currently) the state of favorite icon is not kept up-to-date.\n  useEffect(() => {\n    const createLocalBranchItems = (\n      branchType: BranchType,\n      branches: Array<{ branchName: string; repoRoots: string[] }>\n    ): BranchMenuItem[] => {\n      return branches\n        .filter(({ branchName, repoRoots }) =>\n          repoRoots.some((repoRoot) =>\n            isFavorite({ branchType, branchName, repoRoot })\n          )\n        )\n        .map(({ branchName, repoRoots }) => ({\n          branchType,\n          branchName,\n          repoRoots,\n        }));\n    };\n\n    setFavoriteBranches(\n      [\n        {\n          branchType: \"LOCAL\",\n          branchName: \"HEAD\",\n          repoRoots: [],\n        } as BranchMenuItem,\n      ]\n        .concat(createLocalBranchItems(\"LOCAL\", localBranches))\n        .concat(createLocalBranchItems(\"REMOTE\", remoteBranches))\n    );\n  }, []);\n\n  const renderBranchItem = ({\n    branchName,\n    branchType,\n    repoRoots,\n  }: BranchMenuItem) => (\n    <Item key={`branch:${branchName}`} textValue={branchName}>\n      <MenuItemLayout\n        content={branchName}\n        icon={\n          <BranchFavoriteButton\n            isFavorite={\n              branchName === \"HEAD\" ||\n              repoRoots.some((repoRoot) =>\n                isFavorite({\n                  branchType,\n                  repoRoot,\n                  branchName,\n                })\n              )\n            }\n            onClick={() => {\n              if (branchName !== \"HEAD\") {\n                repoRoots.forEach((repoRoot) => {\n                  toggleFavorite({\n                    branchType,\n                    repoRoot,\n                    branchName,\n                  });\n                });\n              }\n            }}\n          />\n        }\n      />\n    </Item>\n  );\n  return (\n    <SpeedSearchMenu\n      {...menuProps}\n      submenuBehavior=\"toggleOnPress\"\n      autoFocus=\"first\"\n      minWidth={250}\n      onAction={(key) => {\n        const [type, value] = `${key}`.split(\":\");\n        if (type === \"branch\" && value) {\n          onBranchesSelected([value]);\n        } else if (type === \"favorites\") {\n          onBranchesSelected(\n            favoriteBranches.map(({ branchName }) => branchName)\n            // we could have filtered the ones that are actually favorite at this point, but not doing so to follow\n            // the original implementation, even though it's a little questionable.\n          );\n        } else if (type === \"select\") {\n          notImplemented(); // TODO\n        }\n      }}\n    >\n      {[\n        <Item key=\"select\">Select...</Item>,\n        <Item key=\"favorites\">Favorites</Item>,\n        ...favoriteBranches.map(renderBranchItem),\n        <Divider />,\n        <Item key=\"local\" title=\"Local\">\n          {localBranches.map(({ branchName, repoRoots }) =>\n            renderBranchItem({ branchType: \"LOCAL\", branchName, repoRoots })\n          )}\n        </Item>,\n        ...Object.entries(remoteBranchesByRemote).map(([origin, branches]) => (\n          <Item key={`remote:${origin}`} title={`${origin}/...`}>\n            {branches.map(({ branchName, repoRoots }) =>\n              renderBranchItem({ branchType: \"REMOTE\", branchName, repoRoots })\n            )}\n          </Item>\n        )),\n      ]}\n    </SpeedSearchMenu>\n  );\n}\n","import { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport type GitUser = { name: string; email: string };\n\nexport function areUsersEqual(\n  user1: GitUser | null | undefined,\n  user2: GitUser | null | undefined\n): boolean {\n  return (\n    Boolean(user1) &&\n    user1?.email === user2?.email &&\n    user1?.name === user2?.name\n  );\n}\nexport function areSamePerson(user1: GitUser, user2: GitUser): boolean {\n  return (\n    getNameInStandardForm(user1.name) === getNameInStandardForm(user2.name)\n  );\n}\nconst NAME_PATTERN = \"(\\\\w+)[\\\\p{Punct}\\\\s](\\\\w+)\";\n\nfunction getNameInStandardForm(name: string) {\n  const firstAndLastName = getFirstAndLastName(name);\n  if (firstAndLastName != null) {\n    const [firstName, lastName] = firstAndLastName;\n    return firstName.toLowerCase() + \" \" + lastName.toLowerCase(); // synonyms detection is currently english-only\n  }\n  return nameToLowerCase(name);\n}\n\nconst PRINTABLE_ASCII_PATTERN = \"[ -~]*\";\nfunction nameToLowerCase(name: string) {\n  if (!name.match(PRINTABLE_ASCII_PATTERN)) return name;\n  return name.toLowerCase();\n}\nfunction getFirstAndLastName(name: string) {\n  const matches = name.match(NAME_PATTERN);\n  if (matches) {\n    return [matches[1], matches[2]];\n  }\n  return null;\n}\nexport const gitRepoUserAtoms = atomFamily((repoRoot: string) =>\n  atom<Promise<GitUser>>(async () => {\n    const name = await git.getConfig({ fs, dir: repoRoot, path: \"user.name\" });\n    const email = await git.getConfig({\n      fs,\n      dir: repoRoot,\n      path: \"user.email\",\n    });\n    return {\n      name: name ?? \"\",\n      email: email ?? \"\",\n    };\n  })\n);\n","import React, { CSSProperties, RefObject, useMemo } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { css, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\n\nimport { ReadCommitResult } from \"isomorphic-git\";\nimport { GitRef } from \"../GitRef\";\nimport { RefIcon, RefLabel } from \"../RefLabel\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityAtoms,\n  vcsTableHighlightMyCommitsAtom,\n  vcsTableReferencesOnTheLeftAtom,\n  vcsTableShowCommitTimestampAtom,\n} from \"./CommitsTable.state\";\nimport {\n  areSamePerson,\n  gitRepoUserAtoms,\n  GitUser,\n} from \"../../git-users.state\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsLogFilterCurrentTab,\n} from \"../vcs-logs.state\";\nimport {\n  formatCommitDateTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\n\nconst StyledCommitRow = styled.div`\n  display: flex;\n  height: 1.5rem;\n  align-items: center;\n  width: 100%;\n  --column-width-1: 130px;\n  --column-width-2: 130px;\n  --column-width-3: 70px;\n`;\nconst StyledCommitCell = styled.div`\n  overflow: hidden;\n  padding-left: 0.25rem;\n`;\n\nconst StyledRefsContainer = styled.div<{ asOverlay?: boolean }>`\n  ${({ asOverlay }) =>\n    !asOverlay\n      ? css`\n          position: absolute;\n          right: 0;\n          top: 1px;\n          max-width: calc(100% - 100px);\n        `\n      : css`\n          flex-shrink: 0;\n        `};\n\n  display: flex;\n  gap: 0.25rem;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(theme.color(\"List.background\"))};\n`;\nconst StyledMessageContainer = styled.div`\n  position: relative;\n  display: flex;\n  gap: 0.25rem;\n`;\n\nconst StyledRefTooltipRow = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0.25rem;\n  font-size: 0.75rem;\n`;\nconst useCurrentUserHighlightStyle = ({\n  repoRoot,\n  author,\n}: {\n  repoRoot: string;\n  author: GitUser;\n}): CSSProperties => {\n  const currentUser = useAtomValue(gitRepoUserAtoms(repoRoot));\n  const shouldHighlightCurrentUserCommits = useAtomValue(\n    vcsTableHighlightMyCommitsAtom\n  );\n  // for now assuming only a single table can be visible, and that's current tab's.\n  const userFilter = useAtomValue(vcsLogFilterCurrentTab.user);\n  // single user case is not considered a special case, like it is in the original impl\n  const shouldHighlight =\n    shouldHighlightCurrentUserCommits &&\n    userFilter !== CURRENT_USER_FILTER_VALUE &&\n    areSamePerson(currentUser, author);\n\n  return { fontWeight: shouldHighlight ? \"bold\" : undefined };\n};\n\nexport function CommitsTableRow({\n  refs,\n  readCommitResult: {\n    oid,\n    commit: { author, committer, message },\n  },\n  repoRoot,\n}: {\n  repoRoot: string;\n  readCommitResult: ReadCommitResult;\n  refs: GitRef[] | undefined;\n}) {\n  const showCommitTimestamp = useAtomValue(vcsTableShowCommitTimestampAtom);\n  const referencesOnTheLeft = useAtomValue(vcsTableReferencesOnTheLeftAtom);\n  const isAuthorVisible = useAtomValue(\n    vcsTableColumnsVisibilityAtoms(authorColumn.id)\n  );\n  const isDateVisible = useAtomValue(\n    vcsTableColumnsVisibilityAtoms(dateColumn.id)\n  );\n  const isHashVisible = useAtomValue(\n    vcsTableColumnsVisibilityAtoms(hashColumn.id)\n  );\n\n  const highlightStyles = useCurrentUserHighlightStyle({ author, repoRoot });\n  return (\n    <StyledCommitRow>\n      <StyledCommitCell style={{ flexBasis: \"0%\", flexGrow: 1, flexShrink: 1 }}>\n        <StyledMessageContainer>\n          {refs && <CommitRefs onLeft={referencesOnTheLeft} refs={refs} />}\n          <span style={highlightStyles}>\n            {parseCommitMessage(message).subject}\n          </span>\n        </StyledMessageContainer>\n      </StyledCommitCell>\n      {isAuthorVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-1)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {author.name}\n          {committer.name !== author.name && \"*\"}\n        </StyledCommitCell>\n      )}\n      {isDateVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-2)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {formatCommitDateTime(\n            (showCommitTimestamp ? committer : author).timestamp * 1000\n          )}\n        </StyledCommitCell>\n      )}\n      {isHashVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-3)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {shortenOid(oid)}\n        </StyledCommitCell>\n      )}\n    </StyledCommitRow>\n  );\n}\n\nfunction refKey(ref: GitRef) {\n  return `${ref.type}${ref.name}`;\n}\n\nfunction CommitRefs({ refs, onLeft }: { refs: GitRef[]; onLeft?: boolean }) {\n  const { filteredRefs } = useMemo(() => {\n    const headIsOnABranch = refs.some(\n      (ref) => ref.type === \"localBranch\" && ref.isCurrent\n    );\n    return {\n      filteredRefs: refs.filter(\n        (ref) =>\n          !(\n            (ref.type === \"head\" && headIsOnABranch) ||\n            (ref.type === \"remoteBranch\" &&\n              refs.find(\n                (aBranch) =>\n                  aBranch.type === \"localBranch\" &&\n                  aBranch.trackingBranch === ref.name\n              ))\n          )\n      ),\n    };\n  }, [refs]);\n\n  return (\n    <TooltipTrigger\n      placement=\"bottom\"\n      delay={800}\n      isDisabled={refs.length < 2}\n      tooltip={\n        <Tooltip withPointer>\n          {refs.map((ref) => (\n            <StyledRefTooltipRow key={refKey(ref)}>\n              <RefIcon type={ref.type} />\n              {ref.name}\n            </StyledRefTooltipRow>\n          ))}\n        </Tooltip>\n      }\n    >\n      {({ ref, ...tooltipTriggerProps }) => (\n        <StyledRefsContainer\n          ref={ref as RefObject<HTMLDivElement>}\n          asOverlay={onLeft}\n          {...tooltipTriggerProps}\n        >\n          {filteredRefs\n            .filter(\n              (ref) =>\n                ref.type !== \"remoteBranch\" ||\n                !refs.find(\n                  (aBranch) =>\n                    aBranch.type === \"localBranch\" &&\n                    aBranch.trackingBranch === ref.name\n                )\n            )\n            .map((ref) => {\n              let name = ref.name;\n              const types: GitRef[\"type\"][] = [ref.type];\n              if (ref.type === \"localBranch\" && ref.trackingBranch) {\n                types.unshift(\"remoteBranch\");\n                name = `${ref.trackingBranch.split(\"/\")[0]} & ${ref.name}`;\n              }\n              if (ref.type === \"localBranch\" && ref.isCurrent) {\n                types.push(\"head\");\n              }\n              return (\n                <RefLabel key={refKey(ref)} types={types}>\n                  {name}\n                </RefLabel>\n              );\n            })}\n        </StyledRefsContainer>\n      )}\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { Item, Link, List, ProgressBar, styled } from \"@intellij-platform/core\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { useResetFilters, vcsActiveTabKeyAtom } from \"../vcs-logs.state\";\nimport { GitRef } from \"../GitRef\";\nimport { CommitsTableRow } from \"./CommitsTableRow\";\nimport {\n  allResolvedRefsAtom,\n  commitsSelectionAtom,\n  commitsTableRowsAtom,\n} from \"./CommitsTable.state\";\nimport { unwrapLatestWithLoading } from \"../../../atom-utils/unwrapLatestWithLoading\";\n\n// const StyledList = styled(List)`\n//   display: grid;\n//   grid-template-columns: repeat(3, auto); /* Define 3 columns */\n//\n//   ${StyledListItem} {\n//     display: contents;\n//   }\n// ` as typeof List;\n\nconst StyledProgressBar = styled(ProgressBar)`\n  position: absolute;\n  width: 100%;\n  z-index: 1;\n`;\nconst StyledContainer = styled.div`\n  position: relative;\n  min-height: 0;\n  flex: 1;\n  ${StyledListItem} {\n    // the default \"min-width: min-content\", which is necessary for sizing overlays (e.g. Popup) containing list/tree,\n    // results in horizontally scrollable table. Probably not an issue when a proper Table component is implemented.\n    min-width: unset;\n  }\n`;\nconst ResolvedRefsContext = React.createContext<Record<string, GitRef[]>>({});\nexport function CommitsTable() {\n  const currentTabKey = useAtomValue(vcsActiveTabKeyAtom);\n  const resetFilters = useResetFilters();\n\n  const { value: result, isLoading } = useAtomValue(\n    unwrapLatestWithLoading(commitsTableRowsAtom, null)\n  );\n\n  const rows = result?.rows;\n  const allResolvedRefs = useAtomValue(unwrapLatestOrNull(allResolvedRefsAtom));\n  const [selectedCommits, setSelectedCommits] = useAtom(commitsSelectionAtom);\n\n  return (\n    <ResolvedRefsContext.Provider value={allResolvedRefs ?? {}}>\n      <StyledContainer>\n        {isLoading && (\n          <StyledProgressBar aria-label=\"Loading commits\" isIndeterminate />\n        )}\n        {rows && rows.length > 0 && (\n          <List\n            aria-label=\"Commits list\"\n            items={rows}\n            fillAvailableSpace\n            selectionMode=\"multiple\"\n            selectedKeys={selectedCommits}\n            onSelectionChange={setSelectedCommits}\n            estimatedItemHeight={24}\n          >\n            {({ readCommitResult, repoPath }) => (\n              <Item\n                key={readCommitResult.oid}\n                textValue={readCommitResult.commit.message}\n              >\n                {/* Using context here due to rendering optimizations of collection API */}\n                <ResolvedRefsContext.Consumer>\n                  {(refs) => (\n                    <CommitsTableRow\n                      readCommitResult={readCommitResult}\n                      repoRoot={repoPath}\n                      refs={refs[readCommitResult.oid]}\n                    />\n                  )}\n                </ResolvedRefsContext.Consumer>\n              </Item>\n            )}\n          </List>\n        )}\n        {rows && rows.length === 0 && (\n          <StyledPlaceholderContainer>\n            No commits matching filters\n            <Link onPress={() => resetFilters(currentTabKey)}>\n              Reset filters\n            </Link>\n          </StyledPlaceholderContainer>\n        )}\n      </StyledContainer>\n    </ResolvedRefsContext.Provider>\n  );\n}\n","import React from \"react\";\nimport { PrimitiveAtom, useAtom } from \"jotai\";\nimport {\n  ActionTooltip,\n  IconButtonWithMenu,\n  Item,\n  PlatformIcon,\n  Section,\n  SpeedSearchMenu,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityAtoms,\n  vcsTableHighlightMyCommitsAtom,\n  vcsTableReferencesOnTheLeftAtom,\n  vcsTableShowCommitTimestampAtom,\n} from \"./CommitsTable.state\";\n\ntype ToggleDef = {\n  name: string;\n  key: string;\n  atom: PrimitiveAtom<boolean>;\n};\nconst showToggleDefs = [\n  {\n    key: \"commitTimestamp\",\n    name: \"Commit Timestamp\",\n    atom: vcsTableShowCommitTimestampAtom,\n  },\n  {\n    key: \"referencesOnLeft\",\n    name: \"References on the Left\",\n    atom: vcsTableReferencesOnTheLeftAtom,\n  },\n];\n\nconst highlightToggleDefs = [\n  {\n    key: \"myCommits\",\n    name: \"My Commits\",\n    atom: vcsTableHighlightMyCommitsAtom,\n  },\n];\nconst columnToggleDefs = [authorColumn, hashColumn, dateColumn].map(\n  ({ name, id }) => ({\n    name,\n    key: id,\n    atom: vcsTableColumnsVisibilityAtoms(id),\n  })\n);\nconst useToggleDef = (item: ToggleDef) => {\n  const [value, set] = useAtom(item.atom);\n  return { ...item, value, set };\n};\n\nexport function CommitsTableViewOptionsMenuIconButton() {\n  const showToggles = showToggleDefs.map(useToggleDef);\n  const highlightToggles = highlightToggleDefs.map(useToggleDef);\n  const columnToggles = columnToggleDefs.map(useToggleDef);\n\n  const allToggles = showToggles.concat(highlightToggles).concat(columnToggles);\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            // TODO: keep menu open when (certain) items are toggled. Search for closeOnSelect TODO in menu\n            <SpeedSearchMenu\n              {...menuProps}\n              selectedKeys={allToggles\n                .filter(({ value }) => value)\n                .map(({ name }) => name)}\n              onAction={(key) => {\n                const toggle = allToggles.find(\n                  ({ name: toggleKey }) => toggleKey === key\n                );\n                if (toggle) {\n                  toggle.set((value) => !value);\n                } else {\n                  notImplemented();\n                }\n              }}\n            >\n              <Section title=\"Show\">\n                <Item>Compact References View</Item>\n                <Item>Tag Names</Item>\n                <Item>Long Edges</Item>\n                {\n                  showToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item title=\"Columns\">\n                  {\n                    columnToggles.map(({ name, key }) => (\n                      <Item key={key}>{name}</Item>\n                    )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                  }\n                </Item>\n              </Section>\n              <Section title=\"Highlight\">\n                {\n                  highlightToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item>Merge Commits</Item>\n                <Item>Current Branch</Item>\n                <Item>Not Cherry-Picked Commits</Item>\n              </Section>\n            </SpeedSearchMenu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { v4 as uuid } from \"uuid\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  IconButton,\n  Item,\n  Menu,\n  PlatformIcon,\n  SearchInput,\n  styled,\n  StyledHoverContainer,\n  Toolbar,\n  ToolbarSeparator,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport { atom, useAtom, useAtomValue, WritableAtom } from \"jotai\";\nimport { useAtomCallback, useResetAtom } from \"jotai/utils\";\nimport { searchInputRefAtom } from \"../VersionControlToolWindow\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsActiveTabKeyAtom,\n  vcsLogFilter,\n  vcsTabKeysAtom,\n} from \"../vcs-logs.state\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { DateRange, dateToString } from \"../DateRange\";\nimport { BranchesFilterDropdown } from \"./BranchesFilterDropdown\";\nimport { CommitsTable } from \"./CommitsTable\";\nimport { CommitsTableViewOptionsMenuIconButton } from \"./CommitsTableViewOptionsMenuIconButton\";\n\nconst StyledSearchInput = styled(SearchInput)`\n  border-radius: 2px;\n  width: 219px;\n  margin-right: 0.0625rem;\n  margin-left: 0.2rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\n// TODO: add an effect to persist it under application level other.xml file under\n// PropertyService component's \"Vcs.Log.Text.Filter.History\" property\nconst searchHistoryState = atom<string[]>([]);\n\nexport function VcsLogCommitsView({ tabKey }: { tabKey: string }) {\n  const textFilterRef = useAtomValue(searchInputRefAtom);\n  const [searchQuery, setSearchQuery] = useAtom(\n    vcsLogFilter.searchQuery(tabKey)\n  );\n  const [user, setUser] = useAtom(vcsLogFilter.user(tabKey));\n  const resetUser = useResetAtom(vcsLogFilter.user(tabKey));\n  const [dateFilter, setDateFilter] = useAtom(vcsLogFilter.date(tabKey));\n  const resetDate = useResetAtom(vcsLogFilter.date(tabKey));\n  const [searchHistory, setSearchHistory] = useAtom(searchHistoryState);\n  const [searchInputValue, setSearchInputValue] = useState(searchQuery);\n  const getActionShortcut = useGetActionShortcut();\n  const isRegExpOn = useAtomValue(vcsLogFilter.regExp(tabKey));\n  const isMatchCaseOn = useAtomValue(vcsLogFilter.matchCase(tabKey));\n  const submitSearchQuery = (value = searchInputValue) => {\n    setSearchQuery(value);\n    if (value && !searchHistory.includes(value)) {\n      setSearchHistory((searchHistory) => [\n        value,\n        ...searchHistory.filter((item) => item !== value),\n      ]);\n    }\n  };\n\n  useEffect(() => {\n    setSearchInputValue(searchQuery);\n  }, [searchQuery]);\n\n  const createNewTab = useAtomCallback(\n    useCallback((get, set) => {\n      const newTabId = uuid();\n      set(vcsTabKeysAtom, (value) => [...value, newTabId]);\n      Object.values(vcsLogFilter).forEach(\n        (\n          getTabFilterAtom: (tabKey: string) => WritableAtom<any, any, void>\n        ) => {\n          // TODO(jotai): using jotai utils like [split](https://jotai.org/docs/utilities/split) might simplify vcs log tabs state management\n          set(\n            getTabFilterAtom(newTabId),\n            get(getTabFilterAtom(get(vcsActiveTabKeyAtom)))\n          );\n        }\n      );\n      set(vcsActiveTabKeyAtom, newTabId);\n    }, [])\n  );\n  const today = new Date();\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(today.getDate() - 7);\n  const yesterday = new Date();\n  yesterday.setDate(today.getDate() - 1);\n  const predefinedDateRanges = [\n    {\n      name: \"Last 24 hours\",\n      value: { from: yesterday },\n    },\n    {\n      name: \"Last 7 days\",\n      value: { from: sevenDaysAgo },\n    },\n  ];\n\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName=\"Text or Hash Filter\"\n              shortcut={getActionShortcut(VcsActionIds.FOCUS_TEXT_FILTER)}\n            />\n          }\n        >\n          <StyledSearchInput\n            inputRef={textFilterRef}\n            value={searchInputValue}\n            onChange={setSearchInputValue}\n            onSubmit={submitSearchQuery}\n            onBlur={() => submitSearchQuery()}\n            onClear={() => submitSearchQuery(\"\")}\n            searchHistory={searchHistory}\n            addonAfter={\n              <>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.REG_EXP}\n                >\n                  <AutoHoverPlatformIcon\n                    icon={\n                      isRegExpOn ? \"actions/regexSelected\" : \"actions/regex\"\n                    }\n                    hoverIcon={\n                      isRegExpOn\n                        ? \"actions/regexSelected\"\n                        : \"actions/regexHovered\"\n                    }\n                  />\n                </StyledHoverContainer>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.MATCH_CASE}\n                >\n                  {isMatchCaseOn ? (\n                    <PlatformIcon icon=\"actions/matchCaseSelected\" />\n                  ) : (\n                    <AutoHoverPlatformIcon\n                      icon=\"actions/matchCase\"\n                      hoverIcon=\"actions/matchCaseHovered\"\n                    />\n                  )}\n                </StyledHoverContainer>\n              </>\n            }\n          />\n        </TooltipTrigger>\n        <Toolbar>\n          <BranchesFilterDropdown tabKey={tabKey} />\n          <VcsFilterDropdown\n            value={user === CURRENT_USER_FILTER_VALUE ? \"me\" : user}\n            onClear={resetUser}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  if (key === \"select\") {\n                    return notImplemented();\n                  }\n                  setUser(`${key}`);\n                }}\n              >\n                <Item key=\"select\">Select...</Item>\n                <Item key={CURRENT_USER_FILTER_VALUE}>me</Item>\n              </Menu>\n            )}\n            label=\"User\"\n          />\n          <VcsFilterDropdown\n            value={dateFilter && dateRangeToString(dateFilter)}\n            onClear={resetDate}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  const predefinedDateRange = predefinedDateRanges.find(\n                    ({ name }) => name === key\n                  );\n                  if (predefinedDateRange) {\n                    setDateFilter(predefinedDateRange.value);\n                  } else {\n                    notImplemented();\n                  }\n                }}\n              >\n                {[\n                  <Item key=\"select\">Select...</Item>,\n                  ...predefinedDateRanges.map(({ name }) => (\n                    <Item key={name}>{name}</Item>\n                  )),\n                ]}\n              </Menu>\n            )}\n            label=\"Date\"\n          />\n          <VcsFilterDropdown\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Select in...</Item>\n                <Item>Select in Tree...</Item>\n              </Menu>\n            )}\n            label=\"Paths\"\n          />\n          <ToolbarSeparator />\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Open New Git Log Tab\" />}\n          >\n            <IconButton aria-label=\"Checkout\" onPress={createNewTab}>\n              <PlatformIcon icon=\"actions/openNewTab.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <ActionButton actionId={VcsActionIds.LOG_REFRESH} />\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Cherry-Pick\" />}>\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/cherryPick.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <CommitsTableViewOptionsMenuIconButton />\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip actionName=\"Go To Hash/Branch/Tag\" shortcut=\"F\" />\n            }\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/find\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n      </StyledHeader>\n      <CommitsTable />\n    </StyledContainer>\n  );\n}\n\nfunction dateRangeToString(dateRange: DateRange): string {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n}\n","import { basename } from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\nimport { Selection } from \"@react-types/shared\";\nimport { PlatformIcon, TreeRefValue } from \"@intellij-platform/core\";\n\nimport {\n  allBranchesAtom,\n  BranchType,\n  isFavoriteBranchAtoms,\n  LocalBranch,\n  RemoteBranch,\n  RepoBranches,\n} from \"../../Branches/branches.state\";\nimport {\n  createGroupByDirectory,\n  DirectoryNode,\n} from \"../../../tree-utils/groupByDirectory\";\nimport { vcsRootsAtom } from \"../../file-status.state\";\nimport { vcsLogAtomFamily } from \"../vcs-logs.state\";\n\ntype LocalBranchNode = {\n  type: \"localBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is current branch in at least one repo\n   */\n  isCurrent: boolean;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n};\ntype RemoteBranchNode = {\n  type: \"remoteBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n  branches: Array<{ repoRoot: string; branch: RemoteBranch }>;\n};\ntype BranchDirectoryNode = DirectoryNode & {\n  children: readonly AnyBranchTreeNode[];\n};\ntype RepositoryNode = {\n  type: \"repository\";\n  key: string;\n  repoRoot: string;\n  children: ReadonlyArray<LocalBranchNode | RemoteBranchNode | DirectoryNode>;\n};\nexport type AnyBranchTreeNode =\n  | {\n      type: \"head\";\n    }\n  | {\n      type: \"branchType\";\n      branchType: BranchType;\n      children: readonly AnyBranchTreeNode[];\n    }\n  | RepositoryNode\n  | BranchDirectoryNode\n  | LocalBranchNode\n  | RemoteBranchNode;\n\nfunction getLocalBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allLocalBranches = repoBranches.flatMap(\n    ({ repoRoot, localBranches, currentBranch }) =>\n      localBranches.map((branch) => ({\n        repoRoot,\n        isCurrent: currentBranch?.name === branch.name,\n        branch,\n      }))\n  );\n  const localBranchNodes = Object.entries(\n    groupBy(({ branch }) => branch.name, allLocalBranches)\n  ).map<LocalBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"localBranch\",\n      key: `localBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchAtoms({\n          repoRoot,\n          branchType: \"LOCAL\",\n          branchName: branch.name,\n        })\n      ),\n      isCurrent: branches.some(({ isCurrent }) => isCurrent),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(localBranchNodes);\n  }\n  return localBranchNodes;\n}\n\nfunction getRemoteBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allRemoteBranches = repoBranches.flatMap(\n    ({ repoRoot, remoteBranches }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branch,\n      }))\n  );\n  const remoteBranchNodes = Object.entries(\n    groupBy(\n      ({ branch }) => `${branch.remote}/${branch.name}`,\n      allRemoteBranches\n    )\n  ).map<RemoteBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"remoteBranch\",\n      key: `remoteBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchAtoms({\n          repoRoot,\n          branchType: \"REMOTE\",\n          branchName: branch.name,\n        })\n      ),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(remoteBranchNodes);\n  }\n  return remoteBranchNodes;\n}\n\nexport const branchesTreeNodeAtom = atom(\n  async (get): Promise<AnyBranchTreeNode[]> => {\n    // TODO: sorting. favorite should be on top. Others should be alphabetical\n    const repoBranches = await get(allBranchesAtom);\n    const shouldGroupByDirectory = get(branchTreeGroupingAtoms(\"directory\"));\n    const shouldGroupByRepository =\n      get(isGroupByRepositoryAvailableAtom) &&\n      get(branchTreeGroupingAtoms(\"repository\"));\n\n    return [\n      { type: \"head\" },\n      {\n        type: \"branchType\",\n        branchType: \"LOCAL\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `LOCAL:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getLocalBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getLocalBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n      {\n        type: \"branchType\",\n        branchType: \"REMOTE\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `REMOTE:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getRemoteBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getRemoteBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n    ];\n  }\n);\nconst groupNodesByDirectory = createGroupByDirectory<\n  LocalBranchNode | RemoteBranchNode,\n  BranchDirectoryNode\n>({\n  shouldCollapseDirectories: false,\n  getPath: (node) => node.name,\n});\n\nexport const branchTreeGroupingAtoms = atomFamily(\n  (_param: \"directory\" | \"repository\") => atom(false)\n);\n\nexport const isGroupByRepositoryAvailableAtom = atom<boolean>(\n  (get) => get(vcsRootsAtom).length > 1\n);\n\nexport const branchesTreeRefAtoms = vcsLogAtomFamily(\n  React.createRef<TreeRefValue>()\n);\n\nexport const selectedKeysAtoms = vcsLogAtomFamily<Selection>(new Set<Key>());\n\nexport const expandedKeysAtoms = vcsLogAtomFamily(new Set<Key>());\n\nexport const searchInputAtoms = vcsLogAtomFamily(\"\");\n\nconst groupings = [\n  {\n    id: \"directory\" as const,\n    title: \"Directory\",\n    icon: <PlatformIcon icon=\"actions/GroupByPackage.svg\" />,\n    isActive: branchTreeGroupingAtoms(\"directory\"),\n    isAvailable: true,\n  },\n  {\n    id: \"repository\" as const,\n    title: \"Repository\",\n    isActive: branchTreeGroupingAtoms(\"repository\"),\n    isAvailable: isGroupByRepositoryAvailableAtom,\n  },\n];\n\nexport const availableGroupingsAtom = atom((get) =>\n  groupings\n    .filter((grouping) =>\n      typeof grouping.isAvailable !== \"boolean\"\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    )\n    .map((grouping) => ({\n      ...grouping,\n      isActive: get(branchTreeGroupingAtoms(grouping.id)),\n    }))\n);\n","import React, { useCallback } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\n\nimport { GroupByActionButton } from \"../../../GroupByActionButton\";\nimport {\n  availableGroupingsAtom,\n  branchTreeGroupingAtoms,\n} from \"./BranchesTree.state\";\n\nexport function BranchesGroupByActionButton() {\n  //  TODO: Generalize and convert to actions\n  const toggleGroup = useAtomCallback(\n    useCallback(\n      (get, set) => (id: \"directory\" | \"repository\") => {\n        set(branchTreeGroupingAtoms(id), (value) => !value);\n      },\n      []\n    )\n  );\n  const availableGroupings = useAtomValue(availableGroupingsAtom);\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n}\n","import { basename } from \"path\";\nimport React from \"react\";\nimport { ItemElement } from \"@react-types/shared/src/collections\";\nimport {\n  ActionTooltip,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { TrackingBranchInfo } from \"../../TrackingBranchInfo\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { AnyBranchTreeNode } from \"./BranchesTree.state\";\n\nexport const branchTreeNodeRenderers: {\n  [nodeType in AnyBranchTreeNode[\"type\"]]: (\n    node: AnyBranchTreeNode & { type: nodeType }\n  ) => ItemElement<AnyBranchTreeNode>;\n} = {\n  branchType: (node) => {\n    return (\n      <Item\n        key={`${node.type}:${node.branchType}`}\n        textValue={wordCase(node.branchType)}\n        childItems={node.children}\n      >\n        <HighlightedTextValue />\n      </Item>\n    );\n  },\n  localBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={node.branches} />}\n              ></ActionTooltip>\n            }\n          >\n            {(props) => (\n              <ItemLayout.Group {...props}>\n                {node.isCurrent ? (\n                  <TooltipTrigger\n                    tooltip={\n                      <Tooltip>\n                        Current {node.isFavorite && \"favorite \"}branch\n                      </Tooltip>\n                    }\n                  >\n                    {(props) => (\n                      <ItemLayout.Group {...props}>\n                        <PlatformIcon\n                          icon={\n                            node.isFavorite\n                              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n                              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n                          }\n                        />\n                      </ItemLayout.Group>\n                    )}\n                  </TooltipTrigger>\n                ) : (\n                  <PlatformIcon icon=\"vcs/branchNode\" />\n                )}\n                <HighlightedTextValue />\n                {node.repos && (\n                  <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n                )}\n              </ItemLayout.Group>\n            )}\n          </TooltipTrigger>\n        </ItemLayout>\n      </Item>\n    );\n  },\n  remoteBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <PlatformIcon\n            icon={node.isFavorite ? \"nodes/favorite.svg\" : \"vcs/branchNode\"}\n          />\n          <HighlightedTextValue />\n          {node.repos && (\n            <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n          )}\n        </ItemLayout>\n      </Item>\n    );\n  },\n  repository: (node) => (\n    <Item\n      key={`${node.key}`}\n      textValue={basename(node.repoRoot)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <RepoColorIcon rootPath={node.repoRoot} />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  directory: (node) => (\n    <Item\n      key={`${node.type}_${node.parentNodePath}${node.dirPath}`}\n      textValue={basename(node.dirPath)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <PlatformIcon icon=\"nodes/folder.svg\" />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  head: (node) => (\n    <Item key={`${node.type}`} textValue=\"HEAD (Current Branch)\">\n      <HighlightedTextValue />\n    </Item>\n  ),\n};\n\nfunction wordCase(input: string): string {\n  return input[0].toUpperCase() + input.slice(1).toLowerCase();\n}\n\nexport const keyToBranch = (key: string): string | null => {\n  const [type, _repo, branchName] = key.split(\":\");\n  if (type === \"head\") {\n    return \"HEAD\";\n  }\n  if (type === \"localBranch\" || type === \"remoteBranch\") {\n    return branchName ?? null;\n  }\n  return null;\n};\n","import React, { useRef, useState } from \"react\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { PlatformIcon, SpeedSearchTree, styled } from \"@intellij-platform/core\";\n\nimport {\n  branchTreeNodeRenderers,\n  keyToBranch,\n} from \"./branchTreeNodeRenderers\";\nimport {\n  branchesTreeNodeAtom,\n  branchesTreeRefAtoms,\n  expandedKeysAtoms,\n  searchInputAtoms,\n  selectedKeysAtoms,\n} from \"./BranchesTree.state\";\nimport { StyledHeader } from \"../styled-components\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\n\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nconst StyledSearchInput = styled.input`\n  all: unset;\n  flex: 1;\n  align-self: stretch;\n`;\nconst StyledContainer = styled.div`\n  min-width: 0; // don't outgrow the container\n  flex-grow: 1; // fill the available space\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledSearchIconContainer = styled.span`\n  display: inline-flex;\n  margin-top: -0.0625rem;\n  margin-left: 0.7rem;\n  margin-right: 0.25rem;\n  cursor: text;\n`;\n\nexport function BranchesTree({ tabKey }: { tabKey: string }) {\n  const branchesTreeNodes = useAtomValue(\n    unwrapLatestOrNull(branchesTreeNodeAtom)\n  );\n  const [selectedKeys, setSelectedKeys] = useAtom(selectedKeysAtoms(tabKey));\n  const [expandedKeys, setExpandedKeys] = useAtom(expandedKeysAtoms(tabKey));\n  const [searchTerm, setSearchTerm] = useAtom(searchInputAtoms(tabKey));\n  const treeRef = useAtomValue(branchesTreeRefAtoms(tabKey));\n  const ref = useRef<HTMLDivElement>(null);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setInputFocused] = useState(false);\n  const setBranchFilter = useSetAtom(vcsLogFilterCurrentTab.branch);\n  const onAction = (key: React.Key) => {\n    const branch = keyToBranch(`${key}`);\n    if (branch) {\n      setBranchFilter([branch]);\n    }\n  };\n\n  /**\n   * TODO: remaining from search:\n   * - Make the search input red when there is no match\n   * - filter non-matching tree nodes out\n   * - search in the whole tree, not just nodes that are currently visible based on expandedKeys\n   *   - update expanded keys to show matches, as a side effect, every time matches are updated.\n   * The above items are postponed to think more about flexibility of SpeedSearchTree API.\n   * Some rough thoughts about different approaches:\n   * - Provide generic tree utilities to search in the whole tree. In SpeedSearchTree allow for full control over\n   * `matches`. It will be in usage side that matches are calculated based on search input value, and passed to\n   * SpeedSearchTree as an input.\n   * - In SpeedSearchTree, allow for passing a custom search function, which would accept the tree collection object,\n   *   the search query, and the default match function (minusculeMatch).\n   * - Make Tree more flexible or introduce a more flexible base component, so that speed search for tree can be\n   *   implementated in a more composable way. Tree (or TreeBase) would accept props for intercepting `state` creation,\n   *   and it would also allow passing additional props to the tree container. Then a more generic CollectionSpeedSearch\n   *   component would offer options on how to control and customize speed search, and would return props to be passed\n   *   to collection components.\n   */\n\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <StyledSearchIconContainer>\n          <PlatformIcon icon=\"actions/search\" />\n        </StyledSearchIconContainer>\n        {/* FIXME: tabIndex -1 is a workaround to not get the input focused when the toolwindow opens. Not ideal.*/}\n        <StyledSearchInput\n          ref={searchInputRef}\n          tabIndex={-1}\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          onFocus={() => {\n            setInputFocused(true);\n          }}\n          onBlur={() => {\n            setInputFocused(false);\n          }}\n        />\n      </StyledHeader>\n      <SpeedSearchTree\n        ref={ref}\n        treeRef={treeRef}\n        focusProxyRef={searchInputRef}\n        items={branchesTreeNodes ?? []}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onAction={onAction}\n        fillAvailableSpace\n        // speed search related props\n        showAsFocused={isInputFocused}\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        keepSearchActiveOnBlur\n        hideSpeedSearchPopup\n        isSearchActive\n      >\n        {(node) => {\n          // @ts-expect-error we need to somehow infer the type of `node.type`\n          return branchTreeNodeRenderers[node.type](node);\n        }}\n      </SpeedSearchTree>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  PlatformIcon,\n  Toolbar,\n  ToolbarSeparator,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { BranchesGroupByActionButton } from \"./BranchesGroupByActionButton\";\nimport { BranchesTree } from \"./BranchesTree\";\nimport { branchesTreeRefAtoms } from \"./BranchesTree.state\";\n\nconst DELETE_BRANCH_ACTION_ID = \"Git.DeleteBranch\";\nconst SHOW_BRANCH_DIFF_ACTION_ID = \"Git.Compare.With.Current\";\nconst SHOW_MY_BRANCHES_ACTION_ID = \"Git.Show.My.Branches\";\nconst FETCH_ACTION_ID = \"Git.Fetch\";\nconst TOGGLE_FAVORITE_ACTION_ID = \"Git.Toggle.Favorite\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  height: 100%;\n`;\n\nexport function VcsBranchesView({ tabKey }: { tabKey: string }) {\n  const treeRef = useAtomValue(branchesTreeRefAtoms(tabKey));\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.GIT_UPDATE_SELECTED,\n      title: \"Update Selected\",\n      icon: <PlatformIcon icon=\"actions/checkOut\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: DELETE_BRANCH_ACTION_ID,\n      title: \"Delete branch\",\n      icon: <PlatformIcon icon=\"actions/gc\" />,\n      useShortcutsOf: \"SafeDelete\",\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_BRANCH_DIFF_ACTION_ID,\n      title: \"Compare with current\",\n      icon: <PlatformIcon icon=\"actions/diff\" />,\n      useShortcutsOf: VcsActionIds.SHOW_DIFF,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_MY_BRANCHES_ACTION_ID,\n      title: \"Show My Branches\",\n      icon: <PlatformIcon icon=\"actions/find\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: FETCH_ACTION_ID,\n      title: \"Fetch All Remotes\",\n      icon: <PlatformIcon icon=\"vcs/fetch\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: TOGGLE_FAVORITE_ACTION_ID,\n      title: \"Mark/Unmark as Favorite\",\n      icon: <PlatformIcon icon=\"nodes/favorite\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer {...shortcutHandlerProps}>\n          <VcsLogBranchesViewToolbar />\n          <BranchesTree tabKey={tabKey} />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst StyledToolbar = styled(Toolbar)`\n  height: 100%;\n  flex-shrink: 0;\n`;\n\nfunction VcsLogBranchesViewToolbar() {\n  return (\n    <StyledToolbar border=\"right\" orientation=\"vertical\">\n      <ActionButton actionId={VcsActionIds.GIT_LOG_HIDE_BRANCHES} />\n      <ToolbarSeparator />\n      {/*FIXME: replace this with a separate \"new branch from\" action*/}\n      <ActionButton actionId={VcsActionIds.GIT_CREATE_NEW_BRANCH} />\n      <ActionButton actionId={VcsActionIds.GIT_UPDATE_SELECTED} />\n      <ActionButton actionId={DELETE_BRANCH_ACTION_ID} />\n      <ActionButton actionId={SHOW_BRANCH_DIFF_ACTION_ID} />\n      <ActionButton actionId={SHOW_MY_BRANCHES_ACTION_ID} />\n      <ActionButton actionId={FETCH_ACTION_ID} />\n      <ActionButton actionId={TOGGLE_FAVORITE_ACTION_ID} />\n      <ActionButton\n        actionId={VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH}\n      />\n      <ToolbarSeparator />\n      <BranchesGroupByActionButton />\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </StyledToolbar>\n  );\n}\n","import copyToClipboard from \"clipboard-copy\";\nimport { useAtomValue } from \"jotai\";\nimport React from \"react\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { allCommitsAtom, selectedCommitOids } from \"./CommitsTable.state\";\nimport { actionAtom } from \"../../../actionAtom\";\n\nconst refreshLogAction = actionAtom({\n  id: VcsActionIds.LOG_REFRESH,\n  title: \"Refresh\",\n  icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n  useShortcutsOf: CommonActionId.REFRESH,\n  actionPerformed: ({ set }) => {\n    set(allCommitsAtom);\n  },\n});\n\nconst copyRevisionNumberAction = actionAtom({\n  id: VcsActionIds.COPY_REVISION_NUMBER,\n  title: \"Copy Revision Number\",\n  icon: <PlatformIcon icon=\"actions/copy.svg\" />,\n  useShortcutsOf: CommonActionId.COPY_REFERENCE,\n  actionPerformed: async ({ get }) => {\n    const selectedCommits = await get(selectedCommitOids);\n    copyToClipboard(selectedCommits.join(\" \")).catch(console.error);\n  },\n});\n\nexport const useCommitsTableActions = (): ActionDefinition[] => {\n  return [\n    useAtomValue(copyRevisionNumberAction),\n    useAtomValue(refreshLogAction),\n  ];\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function VersionControlToolWindowZeroState() {\n  const performAction = usePerformAction();\n\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To track changes to code:\n        <br />\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        <Link onPress={notImplemented}>Use Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React, { RefObject } from \"react\";\nimport { atom, useAtom, useAtomValue } from \"jotai\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionTooltip,\n  DefaultToolWindow,\n  MultiViewToolWindow,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n  TooltipTrigger,\n  ToolWindowTabContent,\n} from \"@intellij-platform/core\";\n\nimport { VcsLogDetailsView } from \"./DetailsView/VcsLogDetailsView\";\nimport { VcsLogCommitsView } from \"./CommitsView/VcsLogCommitsView\";\nimport { VcsBranchesView } from \"./BranchesView/VcsBranchesView\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  useCloseVcsTab,\n  vcsActiveTabKeyAtom,\n  vcsLogFilter,\n  vcsLogTabShowBranchesAtoms,\n  vcsLogTabShowCommitDetailsAtoms,\n  vcsTabKeysAtom,\n  vcsTabTitleAtoms,\n} from \"./vcs-logs.state\";\nimport { useCommitsTableActions } from \"./CommitsView/useCommitsTableActions\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { vcsRootsAtom } from \"../file-status.state\";\nimport { VersionControlToolWindowZeroState } from \"./VersionControlToolWindowZeroState\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const VERSION_CONTROL_TOOLWINDOW_ID = \"Version Control\";\n\nconst firstViewSizeState = atom(0.25);\nconst lastViewSizeState = atom(0.35);\n\nconst StyledToolWindowHeader = styled.span`\n  margin: 0 0.5rem 0 0.125rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  :focus-visible {\n    outline: none;\n  }\n`;\n\nexport const searchInputRefAtom = atom<RefObject<HTMLInputElement>>(\n  React.createRef<HTMLInputElement>()\n);\n\nexport const VersionControlToolWindow = () => {\n  const tabKeys = useAtomValue(vcsTabKeysAtom);\n  const [activeTabKey, setActiveTabKey] = useAtom(vcsActiveTabKeyAtom);\n  const repos = useAtomValue(vcsRootsAtom);\n\n  return repos.length > 0 ? (\n    <MultiViewToolWindow\n      headerContent={<StyledToolWindowHeader>Git:</StyledToolWindowHeader>}\n      activeKey={activeTabKey}\n      onActiveKeyChange={(key) => setActiveTabKey(`${key}`)}\n    >\n      {tabKeys.map((key) => (\n        <MultiViewToolWindow.View\n          tabContent={<VcsToolWindowTabTitle tabKey={key} />}\n          key={key}\n        >\n          <VcsTab tabKey={key} />\n        </MultiViewToolWindow.View>\n      ))}\n    </MultiViewToolWindow>\n  ) : (\n    <DefaultToolWindow headerContent=\"Version Control\">\n      <VersionControlToolWindowZeroState />\n    </DefaultToolWindow>\n  );\n};\n\nconst StyledExpandStripeButton = styled.button.attrs({ tabIndex: -1 })`\n  box-sizing: border-box;\n  all: unset;\n  width: 1.71875rem;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.625rem;\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  :disabled {\n    color: ${({ theme }) => theme.color(\"Button.disabledText\")};\n  }\n  &:hover {\n    background: ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Button.hoverBackground\",\n        theme.dark ? \"#0f0f0f28\" : \"#55555528\"\n      )};\n  }\n`;\nconst StyledShowBranchesButton = styled(StyledExpandStripeButton)`\n  border-right: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nconst StyledShowBranchesButtonText = styled.span`\n  writing-mode: vertical-lr;\n  transform: rotateZ(180deg);\n  font-size: 0.6875rem;\n`;\n\nfunction ShowBranchesButton({ onPress }: { onPress: () => void }) {\n  return (\n    <StyledShowBranchesButton onClick={onPress}>\n      <PlatformIcon icon=\"actions/arrowExpand\" />\n      <StyledShowBranchesButtonText>Branches</StyledShowBranchesButtonText>\n    </StyledShowBranchesButton>\n  );\n}\n\nfunction VcsTab({ tabKey }: { tabKey: string }) {\n  const [firstViewSize, setFirstViewSize] = useAtom(firstViewSizeState);\n  const [lastViewSize, setLastViewSize] = useAtom(lastViewSizeState);\n\n  const actions = useVcsLogsToolWindowActions();\n  const [showBranches, setShowBranches] = useAtom(\n    vcsLogTabShowBranchesAtoms(tabKey)\n  );\n\n  const firstViewProps: Partial<ThreeViewSplitterProps> = showBranches\n    ? {\n        firstView: <VcsBranchesView tabKey={tabKey} />,\n        firstSize: firstViewSize,\n        onFirstResize: setFirstViewSize,\n        firstViewMinSize: 85,\n      }\n    : {};\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        // tabIndex is added to make the whole container focusable, which means the focus can go away from the currently\n        // focused element, when background is clicked. This is to follow the original implementation.\n        <StyledContainer\n          {...shortcutHandlerProps}\n          tabIndex={showBranches ? -1 : 0}\n        >\n          {!showBranches && (\n            <ShowBranchesButton onPress={() => setShowBranches(true)} />\n          )}\n          <ThreeViewSplitter\n            {...firstViewProps}\n            innerView={<VcsLogCommitsView tabKey={tabKey} />}\n            innerViewMinSize={200}\n            lastView={<VcsLogDetailsView tabKey={tabKey} />}\n            lastSize={lastViewSize}\n            onLastResize={setLastViewSize}\n            lastViewMinSize={40}\n          />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst toggleMatchCaseAction = actionAtom({\n  id: VcsActionIds.MATCH_CASE,\n  title: \"Match Case\",\n  icon: <PlatformIcon icon=\"actions/matchCase.svg\" />,\n  actionPerformed: ({ get, set }) => {\n    set(vcsLogFilter.matchCase(get(vcsActiveTabKeyAtom)), (value) => !value);\n  },\n});\n\nconst hideBranchesAction = actionAtom({\n  id: VcsActionIds.GIT_LOG_HIDE_BRANCHES,\n  title: \"Hide Git Branches\",\n  icon: <PlatformIcon icon=\"actions/arrowCollapse\" />,\n  actionPerformed: ({ get, set }) => {\n    set(\n      vcsLogTabShowBranchesAtoms(get(vcsActiveTabKeyAtom)),\n      // Would be nicer to have the action toggle, but prioritized matching the reference impl here.\n      false\n    );\n  },\n});\n\nconst toggleRegExpAction = actionAtom({\n  id: VcsActionIds.REG_EXP,\n  title: \"Regex\",\n  icon: <PlatformIcon icon=\"actions/regex\" />,\n  actionPerformed: ({ get, set }) => {\n    set(vcsLogFilter.regExp(get(vcsActiveTabKeyAtom)), (value) => !value);\n  },\n});\n\nconst toggleDetailsAction = actionAtom({\n  id: VcsActionIds.SHOW_DETAILS,\n  title: \"Show Details\",\n  description: \"Display details panel\",\n  actionPerformed: ({ get, set }) => {\n    set(\n      vcsLogTabShowCommitDetailsAtoms(get(vcsActiveTabKeyAtom)),\n      (value) => !value\n    );\n  },\n});\n\nconst focusTextFilterAction = actionAtom({\n  id: VcsActionIds.FOCUS_TEXT_FILTER,\n  title: \"Focus Text Filter\",\n  actionPerformed: ({ get }) => {\n    get(searchInputRefAtom).current?.focus();\n  },\n});\n\nconst showDiffPreviewAction = {\n  id: VcsActionIds.SHOW_DIFF_PREVIEW,\n  title: \"Show Diff Preview\",\n  description: \"Show Diff Preview Panel\",\n  actionPerformed: () => notImplemented(),\n};\n\nfunction useVcsLogsToolWindowActions() {\n  const actions: ActionDefinition[] = [\n    ...useCommitsTableActions(),\n    useAtomValue(focusTextFilterAction),\n    useAtomValue(hideBranchesAction),\n    useAtomValue(toggleMatchCaseAction),\n    useAtomValue(toggleRegExpAction),\n    useAtomValue(toggleDetailsAction),\n    showDiffPreviewAction,\n  ];\n  return actions;\n}\n\nfunction VcsToolWindowTabTitle({ tabKey }: { tabKey: string }) {\n  const closeTab = useCloseVcsTab();\n  return (\n    <ToolWindowTabContent\n      title={useAtomValue(vcsTabTitleAtoms(tabKey))}\n      closeButton={\n        tabKey !== \"MAIN\" && (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Close Tab\" />}>\n            <TabCloseButton onPress={() => closeTab(tabKey)} />\n          </TooltipTrigger>\n        )\n      }\n    />\n  );\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\n\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\nimport {\n  VERSION_CONTROL_TOOLWINDOW_ID,\n  VersionControlToolWindow,\n} from \"../VersionControl/VersionControlToolWindow/VersionControlToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  showStripeButton?: boolean;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"left\",\n      isSplit: true, // Default is false in the original impl.\n      isVisible: false,\n    }),\n  },\n  {\n    id: VERSION_CONTROL_TOOLWINDOW_ID,\n    title: \"Version Control\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowChanges\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <VersionControlToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"bottom\",\n      weight: 0.35,\n    }),\n  },\n];\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom } from \"jotai\";\n\nexport const showProgressPanelAtom = atom(false);\nexport const tasksPopupBoundsAtom = atom<Bounds | null>(null);\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport {\n  IconButton,\n  PlatformIcon,\n  Popup,\n  ProgressBar,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { tasksAtom, useCancelTask } from \"../tasks\";\nimport {\n  showProgressPanelAtom,\n  tasksPopupBoundsAtom,\n} from \"./IdeStatusBar.state\";\n\nconst StyledPopupTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport function TasksPopup() {\n  const setShowProgressPanel = useSetAtom(showProgressPanelAtom);\n  const tasks = useAtomValue(tasksAtom);\n  const cancel = useCancelTask();\n  const [bounds, setBounds] = useAtom(tasksPopupBoundsAtom);\n\n  return (\n    <Popup\n      bounds={\n        // Maybe it would be a nicer UX to not fix height, and let it be based on content, but tried to mimic the\n        // original impl, where the height is fixed. The only improvement over the original impl is that the default\n        // height (in case of no persisted bounds), would depend on the content, and it will remain based on content,\n        // as long as the bounds is not changed manually by the user.\n        bounds || {\n          width: 300,\n          // TODO: allow for positioning based on right and/or bottom\n          left: window.innerWidth - 300 - /* distance to right edge */ 150,\n          top:\n            window.innerHeight -\n            tasks.length * 80 - // progress bars\n            30 - // header\n            100, // distance to bottom edge,\n        }\n      }\n      onBoundsChange={(bounds) => {\n        setBounds(bounds);\n      }}\n      minHeight={100}\n      minWidth={300}\n      nonDismissable\n      interactions=\"all\"\n    >\n      <Popup.Layout\n        header={\n          <Popup.Header hasControls>\n            <StyledPopupTitle>Background Tasks</StyledPopupTitle>\n            <TooltipTrigger tooltip={<Tooltip>Hide</Tooltip>}>\n              <IconButton\n                preventFocusOnPress\n                excludeFromTabOrder\n                onPress={() => setShowProgressPanel(false)}\n              >\n                <PlatformIcon icon=\"general/hideToolWindow\" />\n              </IconButton>\n            </TooltipTrigger>\n          </Popup.Header>\n        }\n        content={\n          <>\n            {tasks.map((task, index) => (\n              <React.Fragment key={task.id}>\n                <ProgressBar\n                  style={{ margin: \".5rem 0.75rem\" }}\n                  name={task.title}\n                  isIndeterminate={task.progress.isIndeterminate}\n                  aria-label={`Progress of ${task.title}`}\n                  details={\n                    task.progress.text ||\n                    (task.progress.secondaryText ? <>&nbsp;</> : undefined)\n                  }\n                  secondaryDetails={task.progress.secondaryText}\n                  value={task.progress.fraction}\n                  maxValue={1}\n                  button={\n                    task.isCancelable && (\n                      <ProgressBarStopButton onPress={() => cancel(task.id)} />\n                    )\n                  }\n                />\n                {tasks[index + 1] && <StyledVerticalSeparator />}\n              </React.Fragment>\n            ))}\n          </>\n        }\n      />\n    </Popup>\n  );\n}\n","import styled from \"styled-components\";\nimport {\n  BareButton,\n  Link,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport { firstTaskAtom, taskCountAtom, useCancelTask } from \"../tasks\";\nimport { showProgressPanelAtom } from \"./IdeStatusBar.state\";\nimport React, { useEffect } from \"react\";\nimport { TasksPopup } from \"./TasksPopup\";\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\nconst StyledProgressBarButton = styled.span`\n  cursor: pointer;\n\n  ${ProgressBar.Container} {\n    cursor: unset;\n  }\n`;\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nexport const StatusBarTaskProgressBar = () => {\n  const firstTask = useAtomValue(firstTaskAtom);\n  const tasksCount = useAtomValue(taskCountAtom);\n  const cancel = useCancelTask();\n  const [showProgressPanel, setShowProgressPanel] = useAtom(\n    showProgressPanelAtom\n  );\n\n  // When there is no tasks, switch back to not showing the panel.\n  useEffect(() => {\n    if (tasksCount === 0) {\n      setShowProgressPanel(false);\n    }\n  }, [tasksCount]);\n\n  return (\n    <>\n      {firstTask && !showProgressPanel && (\n        <TooltipTrigger\n          tooltip={\n            <Tooltip>{`${firstTask.title}. Click to see all running background tasks.`}</Tooltip>\n          }\n        >\n          <BareButton\n            preventFocusOnPress\n            excludeFromTabOrder\n            onPress={() => {\n              setShowProgressPanel(true);\n            }}\n          >\n            <StyledProgressBarButton>\n              <StatusBarProgress\n                name={firstTask.progress.text || firstTask.title}\n                isIndeterminate={firstTask.progress.isIndeterminate}\n                value={firstTask.progress.fraction}\n                maxValue={1}\n                button={\n                  <>\n                    {/*  {task.canPause && (\n                      <ProgressBarPauseButton\n                        small\n                        paused={false}\n                        onPausedChange={() => {}}\n                      />\n                    )}*/}\n                    {firstTask.isCancelable && (\n                      <TooltipTrigger tooltip={<Tooltip>Cancel</Tooltip>}>\n                        <ProgressBarStopButton\n                          small\n                          onPress={() => cancel(firstTask.id)}\n                        />\n                      </TooltipTrigger>\n                    )}\n                  </>\n                }\n              />\n            </StyledProgressBarButton>\n          </BareButton>\n        </TooltipTrigger>\n      )}\n      {(tasksCount > 1 || showProgressPanel) && (\n        <>\n          <Spacer />\n          <Link\n            onPress={() =>\n              setShowProgressPanel((currentValue) => !currentValue)\n            }\n          >\n            {showProgressPanel ? \"Hide processes\" : \"Show all\"} ({tasksCount})\n          </Link>\n        </>\n      )}\n      {showProgressPanel && tasksCount > 0 && <TasksPopup />}\n    </>\n  );\n};\n","import { Atom } from \"jotai\";\nimport { selectAtom } from \"jotai/utils\";\n\n/**\n * Returns an atom that holds the latest defined (not `null` or `undefined`)\n * value of the input atom.\n * Useful for when the value can change to null/undefined and the previous\n * non-null value should still be used.\n * For example, the git branches widget shows the current branch of the file\n * that's currently opened in the editor.\n * But when all editor tabs are closed,\n * or when the currently opened tab is not a file from any repo,\n * the git branches trigger keeps showing the branches of the repository\n * from which a file was last opened.\n */\nexport const latestDefinedValue = <V>(atom: Atom<V>) =>\n  selectAtom<V, V>(atom, (value, prevValue) => {\n    return value instanceof Promise\n      ? (Promise.all([value, prevValue]).then(\n          ([value, prevValue]) => value ?? prevValue ?? value\n        ) as V & Promise<unknown>)\n      : value ?? prevValue ?? value;\n  });\n","import { resolveRef } from \"isomorphic-git\";\nimport { atom } from \"jotai\";\n\nimport { activeEditorTabAtom } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsFootForFileAtom, vcsRootsAtom } from \"./file-status.state\";\nimport {\n  branchForPathAtoms,\n  RepoBranches,\n  repoBranchesAtom,\n} from \"./Branches/branches.state\";\n\nimport { latestDefinedValue } from \"../atom-utils/latestDefinedValue\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootAtom = atom((get) => {\n  const activeFile = get(activeEditorTabAtom)?.filePath;\n  const activeFileRepo = activeFile && get(vcsFootForFileAtom(activeFile));\n  return activeFileRepo ?? get(vcsRootsAtom)[0]?.dir;\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesAtom = atom<Promise<RepoBranches | null>>(\n  async (get) => {\n    const activeFileRepoRoot = await get(activeFileRepoRootAtom);\n    return activeFileRepoRoot\n      ? get(repoBranchesAtom(activeFileRepoRoot))\n      : null;\n  }\n);\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchAtom = latestDefinedValue(\n  atom(async (get) => {\n    const activeFile = get(activeEditorTabAtom)?.filePath;\n    return activeFile ? get(branchForPathAtoms(activeFile)) : null;\n  })\n);\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadAtom = atom(async (get) => {\n  const branch = await get(activeFileCurrentBranchAtom);\n  if (branch) {\n    return {\n      detached: false,\n      head: branch,\n    };\n  }\n  const repoRoot = await get(activeFileRepoRootAtom);\n  if (repoRoot) {\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  }\n  return null;\n});\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches | null,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches?.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches?.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { repoBranchesAtom, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useAtomValue(repoBranchesAtom(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"error\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                validationMessage={\n                  error && validationState === \"error\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  IconButton,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  Toolbar,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport {\n  allBranchesAtom,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useAtom, useAtomValue } from \"jotai\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nimport { unwrapLatestOrNull } from \"../../atom-utils/unwrapLatest\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>(undefined);\n\nexport function BranchesPopup({ close }: { close: () => void }) {\n  const repoBranches = useAtomValue(unwrapLatestOrNull(allBranchesAtom));\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] = useAtom(\n    branchesPopupSizeState\n  );\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      close();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={close}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { vcsRootsAtom } from \"./file-status.state\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const vcsRoots = useAtomValue(vcsRootsAtom);\n  const performAction = usePerformAction();\n\n  return async () => {\n    if (vcsRoots.length < 2 && !notified) {\n      notified = true;\n      balloonManager.showSticky({\n        title: \"Clone another repository\",\n        icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n        body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n        actions: (\n          <>\n            <BalloonActionLink\n              onPress={() => {\n                performAction(\"ExampleApp.cloneExampleRepo\");\n              }}\n            >\n              Clone another repo\n            </BalloonActionLink>\n          </>\n        ),\n      });\n    }\n  };\n};\n","import { useAtomValue } from \"jotai\";\nimport React from \"react\";\n\nimport {\n  ActionTooltip,\n  PlatformIcon,\n  PopupTrigger,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { activeFileRepoHeadAtom } from \"../VersionControl/active-file.state\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\n\nimport { unwrapLatestOrNull } from \"../atom-utils/unwrapLatest\";\n\nexport function BranchPopupTrigger() {\n  const gitRepoHead = useAtomValue(unwrapLatestOrNull(activeFileRepoHeadAtom));\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    gitRepoHead && (\n      <PopupTrigger\n        placement=\"top\"\n        onOpenChange={(isOpen) => {\n          if (!isOpen) {\n            setTimeout(maybeShowGitCloneTip, 500);\n          }\n        }}\n        popup={({ close }) => <BranchesPopup close={close} />}\n      >\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={\n                gitRepoHead.detached\n                  ? \"Git: Detached HEAD doesn't point to any branch\"\n                  : `Git Branch: ${gitRepoHead.head}`\n              }\n            />\n          }\n        >\n          <StatusBarWidget\n            icon={\n              <PlatformIcon\n                icon={\n                  gitRepoHead.detached\n                    ? \"general/warning.svg\"\n                    : \"vcs/branch.svg\"\n                }\n              />\n            }\n            label={gitRepoHead.head.slice(\n              0,\n              gitRepoHead.detached ? 8 : undefined\n            )}\n          />\n        </TooltipTrigger>\n      </PopupTrigger>\n    )\n  );\n}\n","import React from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport styled from \"styled-components\";\nimport {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\n\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { StatusBarTaskProgressBar } from \"./StatusBarTaskProgressBar\";\nimport { BranchPopupTrigger } from \"./BranchPopupTrigger\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\nexport const IdeStatusBar = () => {\n  const cursorPosition = useAtomValue(editorCursorPositionState);\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarTaskProgressBar />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <BranchPopupTrigger />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useAtom, useAtomValue, useSetAtom } from \"jotai\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  ActionButton,\n  ActionsProvider,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  Toolbar,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport {\n  changesTreeNodesAtom,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { defaultChangeGroupings } from \"../ChangesTree/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"../ChangesView/changesViewTreeNodeRenderer\";\nimport { allChangesAtom, useRollbackChanges } from \"../changes.state\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  &:not(:empty) {\n    line-height: 1.5;\n    padding-left: 0.375rem;\n    margin-bottom: 0.75rem;\n  }\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useAtomValue(\n    rollbackViewState.initiallyExpandedKeysAtom\n  );\n  const initiallyIncludedChangeKeys = useAtomValue(\n    rollbackViewState.initiallyIncludedChangesAtom\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useAtomValue(changesTreeNodesAtom);\n  const [windowBounds, setWindowBounds] = useAtom(\n    rollbackViewState.windowBoundsAtom\n  );\n  const rootNodes = useAtomValue(rollbackViewState.rootNodesAtom);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<ChangesViewTreeNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useAtomValue(allChangesAtom);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetAtom(rollbackViewState.isOpenAtom);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n  const [deleteAddedFiles, setDeleteAddedFiles] = useState(false);\n\n  const atLeastOneNewFileSelected = includedChanges.some(\n    (change) => change.type === \"ADDED\"\n  );\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              defaultChangeGroupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      treeRef={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = changesViewTreeNodeRenderer.getItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \".5rem 0.75rem 0\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox\n                isDisabled={!atLeastOneNewFileSelected}\n                isSelected={deleteAddedFiles}\n                onChange={setDeleteAddedFiles}\n                mnemonic=\"D\"\n              >\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close} mnemonic=\"C\">\n                    Close\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    mnemonic=\"R\"\n                    isDisabled={includedChanges.length === 0}\n                    onPress={() => {\n                      rollbackChanges(includedChanges, deleteAddedFiles)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"jotai\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsStateAtom = atom(\n  new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    ),\n    {\n      removedFromSideBarIds: toolWindows\n        .filter(({ showStripeButton }) => showStripeButton === false)\n        .map(({ id }) => id),\n    }\n  )\n);\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom } from \"jotai\";\nimport { atomFamily } from \"jotai/utils\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom(false),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>(\"All\"),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element | null>(null),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily((tab: string) => atom(\"\")),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>(null),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useAtomValue, useSetAtom, WritableAtom } from \"jotai\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsAtom,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of an atom.\n   */\n  persistedBoundsAtom: WritableAtom<\n    Partial<Bounds> | null,\n    [Partial<Bounds> | null],\n    void\n  >;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetAtom(persistedBoundsAtom);\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(\n    useAtomValue(persistedBoundsAtom) ?? {\n      top: 150,\n      height: Math.max(200, window.innerHeight - 300),\n    }\n  );\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 0.9375rem;\n  margin-right: 0.25rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useAtomValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = file.name;\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React, { useEffect, useRef } from \"react\";\nimport { Atom, useAtomValue, useStore } from \"jotai\";\nimport {\n  currentProjectFilesAtom,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\nimport { unwrapLatestOrNull } from \"../../../atom-utils/unwrapLatest\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const projectFiles =\n      useAtomValue(unwrapLatestOrNull(currentProjectFilesAtom)) ?? [];\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        projectFiles\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useAtom, useSetAtom, useAtomValue } from \"jotai\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetAtom(searchEverywhereState.isOpen);\n  const [tab, setTab] = useAtom(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useAtomValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetAtom(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const onAction = (key: React.Key) => {\n    if (key === LOAD_MORE_ITEM_KEY) {\n      setSearchResultLimit((limit) => limit + SEARCH_RESULT_LIMIT);\n      const nextItem = searchResult[visibleSearchResult.length + 1];\n      if (nextItem) {\n        // nextItem is expected to always have value\n\n        // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n        // if we want to avoid setTimeout\n        setTimeout(() => {\n          setSelectedKeys(new Set([nextItem.key]));\n          selectionManagerRef.current?.setFocusedKey(nextItem.key);\n        });\n      }\n    } else {\n      close();\n      // Making sure the popup is fully closed before the new action is performed. One edge case that can\n      // make a difference is actions like FindAction that open the same popup. By performing an action\n      // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n      // won't get any feedback when choosing such actions.\n      setTimeout(() => {\n        const itemWrapper = searchResult.find((item) => item.key === key);\n        itemWrapper?.contributor.processSelectedItem(itemWrapper.item);\n        /**\n         * The 50ms timeout is a workaround for an issue in FocusScope:\n         * restoreFocus only works if the previously focused element is in the dom, when the focus\n         * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n         * window, which has a focus scope, when the window is opened, the currently focused\n         * element (which will be the one to restore focus to), is search everywhere dialog, which\n         * is immediately closed. So when the modal window is closed, it tries to move focus back\n         * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n         * track a chain of nodes to restore focus to.\n         * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n         * is closed, and then the actions is performed, for focus restoration to work.\n         */\n      }, 50);\n    }\n  };\n\n  const tips = useTips();\n  return (\n    <ContentAwarePopup\n      persistedBoundsAtom={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        ref={searchInputRef}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        focusProxyRef={searchInputRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        showAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={onAction}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          const itemText = contributor.getItemText(item);\n                          return (\n                            <Item\n                              key={key}\n                              textValue={itemText}\n                              aria-label={itemText}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import git from \"isomorphic-git\";\nimport { Getter, Setter } from \"jotai\";\nimport path from \"path\";\nimport { fs } from \"../fs/fs\";\nimport { refreshFileStatusCallback } from \"./file-status.state\";\n\nexport const gitAddCallback = async (\n  get: Getter,\n  set: Setter,\n  filepath: string\n) => {\n  const dir = await git.findRoot({ fs, filepath });\n  await git.add({ fs, dir, filepath: path.relative(dir, filepath) });\n  await refreshFileStatusCallback(get, set, filepath);\n};\n","import {\n  Input,\n  Popup,\n  PopupLayout,\n  PositionedTooltipTrigger,\n  styled,\n  ValidationTooltip,\n} from \"@intellij-platform/core\";\nimport React, { ChangeEvent, useState } from \"react\";\n\nconst StyledInput = styled(Input)`\n  width: 20.5rem;\n  /**\n     * To have the validation box shadow not clipped by the popup.\n     * Maybe it should be an option on input to make sure margin is always in sync with the box-shadow thickness\n     */\n  margin: 3px;\n\n  input {\n    padding-top: 1px;\n    padding-bottom: 1px;\n  }\n`;\nconst StyledHeader = styled(Popup.Header)`\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.border()};\n`;\n\n/**\n * A simple Popup with an input, used in actions such as create file, or create directory\n */\nexport function NewItemPopup({\n  title,\n  inputName = \"Name\",\n  onSubmit,\n  validationMessage,\n  validationType = \"error\",\n  value,\n  onChange,\n}: {\n  inputName?: string;\n  title: React.ReactNode;\n  onSubmit: () => void;\n  value: string;\n  onChange: (newValue: string) => void;\n  validationMessage?: string;\n  validationType?: \"error\" | \"warning\";\n}) {\n  const [hideMessage, setHideMessage] = useState(false);\n  return (\n    <Popup>\n      <PopupLayout\n        header={<StyledHeader>{title}</StyledHeader>}\n        content={\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              onSubmit();\n            }}\n            onMouseDown={() => {\n              setHideMessage(true);\n            }}\n          >\n            <PositionedTooltipTrigger\n              isOpen={Boolean(validationMessage) && !hideMessage}\n              placement=\"top start\"\n              offset={6}\n              crossOffset={-6}\n              tooltip={\n                <ValidationTooltip type={validationType}>\n                  {validationMessage}\n                </ValidationTooltip>\n              }\n            >\n              <StyledInput\n                appearance=\"embedded\"\n                validationState={validationMessage ? validationType : undefined}\n                placeholder={inputName}\n                value={value}\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                  setHideMessage(false);\n                  onChange(e.target.value);\n                }}\n              />\n            </PositionedTooltipTrigger>\n          </form>\n        }\n      />\n    </Popup>\n  );\n}\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport React, { useCallback, useState } from \"react\";\nimport {\n  ActionDefinition,\n  Button,\n  Checkbox,\n  ModalWindow,\n  PlatformIcon,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { editorManagerAtom } from \"../../Editor/editor.state\";\nimport {\n  activePathExistsAtom,\n  activePathsAtom,\n  projectPopupManagerRefAtom,\n  windowManagerRefAtom,\n} from \"../project.state\";\nimport { vcsFootForFileAtom } from \"../../VersionControl/file-status.state\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { createFileCallback } from \"../fs-operations\";\nimport { gitAddCallback } from \"../../VersionControl/gitAddCallback\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { actionAtom } from \"../../actionAtom\";\n\n// TODO: expand to and select the new file in the project tree, if the action is initiated from projects view.\nexport const createFileActionAtom = actionAtom({\n  id: projectActionIds.NewFile,\n  icon: <PlatformIcon icon=\"fileTypes/text\" />,\n  title: \"File\",\n  description: \"Create new file\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get }) => {\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n    const popupManager = get(projectPopupManagerRefAtom).current;\n\n    // TODO: open a dialog and let the user choose the destination if, multiple paths are active\n    const destinationDir = (\n      await fs.promises.stat(activePaths[0])\n    ).isDirectory()\n      ? activePaths[0]\n      : path.dirname(activePaths[0]);\n\n    if (!popupManager) {\n      throw new Error(\"Could not find popup manager\");\n    }\n\n    popupManager.show(({ close }) => (\n      <NewFilePopup close={close} destinationDir={destinationDir} />\n    ));\n  },\n});\n\nfunction NewFilePopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createFile = useAtomCallback(\n    useCallback(\n      async (get, set, destination: string, filename: string) => {\n        const fullpath = path.join(destination, filename);\n        const editorManager = get(editorManagerAtom);\n        const windowManager = get(windowManagerRefAtom).current;\n        const repoDir = await get(vcsFootForFileAtom(fullpath));\n        await createFileCallback(get, set, destination, filename);\n        // TODO: select it in the Project tool window, if it was created from the Project tool window\n        close();\n        editorManager.focus();\n        // Hacky approach to fix an edge case where the editor is not rendered already (no open tabs), and\n        // so will be focused with a little delay. For the focus to go back to the editor after AddFileToGitWindow\n        // is closed, without any extra focus management, we need to make sure the editor is focused before the\n        // modal window is opened, so it restores to the editor.\n        await waitUntil(\n          () => document.activeElement instanceof HTMLTextAreaElement\n        );\n        if (repoDir) {\n          windowManager?.open(({ close }) => (\n            <AddFileToGitWindow filepath={fullpath} close={close} />\n          ));\n        }\n      },\n      [close]\n    )\n  );\n  const [filename, setFilename] = useState(\"\");\n  const [validationMessage, setValidationMessage] = useState(\"\");\n  const submit = async () => {\n    const fullPath = path.join(destinationDir, filename);\n    const stats = await stat(fullPath);\n    if (stats?.isFile()) {\n      setValidationMessage(\n        `A file with the name '${path.basename(filename)}' already exists`\n      );\n    } else if (stats?.isDirectory()) {\n      setValidationMessage(\n        `A directory with the name '${path.basename(filename)}' already exists`\n      );\n    } else {\n      await createFile(destinationDir, filename);\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New File\"\n      onSubmit={() => {\n        if (filename) {\n          submit(); // error handling?\n        }\n      }}\n      value={filename}\n      onChange={(newValue) => {\n        setValidationMessage(\"\");\n        setFilename(newValue);\n      }}\n      validationMessage={validationMessage}\n    />\n  );\n}\n\nfunction AddFileToGitWindow({\n  close,\n  filepath,\n}: {\n  close: () => void;\n  filepath: string;\n}) {\n  const addToGit = useAtomCallback(gitAddCallback);\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Add File to Git\"\n        content={\n          <>\n            <div\n              style={{\n                display: \"flex\",\n                gap: \"1rem\",\n                padding: \"0.75rem 0.75rem 0rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/questionDialog.svg\" size={32} />\n              <div>\n                Do you want to add the following file to Git?\n                <br />\n                {filepath}\n                <br />\n                <br />\n                If you choose Cancel, you can still add it later manually.\n              </div>\n            </div>\n          </>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<Checkbox isDisabled>Don't ask again</Checkbox>}\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  autoFocus\n                  variant=\"default\"\n                  onPress={() => {\n                    addToGit(filepath).then(close);\n                  }}\n                >\n                  Add\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function waitUntil(criteria: () => boolean, timeoutInMs = 2000) {\n  if (criteria() || timeoutInMs < 0) {\n    return;\n  }\n  await new Promise((resolve) => setTimeout(resolve, 50));\n  await waitUntil(criteria, timeoutInMs - 50);\n}\n","import { useRef } from \"react\";\n// @ts-expect-error caf package doesn't come with typing, and @types/caf doesn't exist at the moment\nimport { CAF } from \"caf\";\n\n/**\n * A utility to avoid race condition in async flows that should be triggered based on some user interaction.\n * Accepts a generator function representing a cancelable async flow. Each `yield` expression is a potential point of\n * cancellation, and the last invocation always cancels previous in progress invocations (if any).\n * Based on [Cancelable Async Flows](https://github.com/getify/CAF#cancelable-async-flows-caf)\n */\nexport const useCancelableAsyncCallback = <A extends any[]>(\n  asyncCallback: (...args: A) => Generator\n) => {\n  const cancelToken = useRef<null | { abort: () => void; signal: unknown }>(\n    null\n  );\n\n  const callbackRef = useRef(asyncCallback);\n  callbackRef.current = asyncCallback;\n\n  return (...args: any[]) => {\n    cancelToken.current?.abort();\n    cancelToken.current = new CAF.cancelToken();\n\n    CAF(function (signal: unknown, ...args: A): unknown {\n      return callbackRef.current(...args);\n    })(cancelToken.current, ...args);\n  };\n};\n","import path from \"path\";\nimport { atom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport React, { useEffect, useState } from \"react\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { useCancelableAsyncCallback } from \"../../useCancelableAsyncCallback\";\nimport {\n  activePathExistsAtom,\n  activePathsAtom,\n  projectPopupManagerRefAtom,\n} from \"../project.state\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { createDirectoryCallback } from \"../fs-operations\";\nimport { actionAtom } from \"../../actionAtom\";\n\n// TODO: expand to and select the new directory in the project tree\nexport const createDirectoryActionAtom = actionAtom({\n  id: projectActionIds.NewDir,\n  icon: <PlatformIcon icon={DIR_ICON} />,\n  title: \"Directory\",\n  description: \"Create new directory\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)), // TODO: disable action when multiple paths are selected and none of them are directories\n  actionPerformed: async ({ get }) => {\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n    const popupManager = get(projectPopupManagerRefAtom).current;\n\n    // TODO: open a dialog and let the user choose the destination if, multiple dirs are active\n    const destinationDir = (\n      await fs.promises.stat(activePaths[0])\n    ).isDirectory()\n      ? activePaths[0]\n      : path.dirname(activePaths[0]);\n\n    if (!popupManager) {\n      throw new Error(\"Could not find popup manager\");\n    }\n\n    popupManager.show(({ close }) => (\n      <NewDirectoryPopup close={close} destinationDir={destinationDir} />\n    ));\n  },\n});\n\nfunction NewDirectoryPopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createDirectory = useAtomCallback(createDirectoryCallback);\n\n  const [dirName, setDirName] = useState(\"\");\n\n  const [validationResult, setValidationResult] = useState<{\n    type: \"error\" | \"warning\";\n    message: string;\n  } | null>(null);\n\n  const updateValidation = useCancelableAsyncCallback(function* (\n    destinationDir: string,\n    dirName: string\n  ) {\n    setValidationResult(\n      (yield validate(destinationDir, dirName)) as Awaited<\n        ReturnType<typeof validate>\n      >\n    );\n  });\n  useEffect(() => {\n    updateValidation(destinationDir, dirName);\n  }, [destinationDir, dirName]);\n\n  const submit = async () => {\n    const error = await validate(destinationDir, dirName);\n    if (error == null) {\n      await createDirectory(destinationDir, dirName);\n      close();\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New Directory\"\n      onSubmit={() => {\n        if (dirName) {\n          submit(); // error handling?\n        }\n      }}\n      value={dirName}\n      onChange={setDirName}\n      validationMessage={validationResult?.message}\n      validationType={validationResult?.type}\n    />\n  );\n}\n\nconst validate = async function (\n  destinationDir: string,\n  dirName: string\n): Promise<{ type: \"error\" | \"warning\"; message: string } | null> {\n  const fullPath = path.join(destinationDir, dirName);\n  if (!dirName) {\n    return null;\n  }\n  if (dirName.includes(\".\")) {\n    return {\n      type: \"warning\",\n      message: `Note: \".\" in the name is treated as a regular character. Use \"/\" instead if you mean to create nested directories`,\n    };\n  }\n  let stats = await stat(fullPath);\n  if (stats?.isFile()) {\n    return {\n      type: \"error\",\n      message: `A file with the name '${dirName}' already exists`,\n    };\n  } else if (stats?.isDirectory()) {\n    return {\n      type: \"error\",\n      message: `A directory with the name '${dirName}' already exists`,\n    };\n  }\n  return null;\n};\n","import { atom } from \"jotai\";\n\nimport { activePathExistsAtom, activePathsAtom } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyFilenameActionAtom = actionAtom({\n  id: projectActionIds.CopyFileName,\n  title: \"File Name\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get }) => {\n    notImplemented();\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n  },\n});\n","import { atom } from \"jotai\";\nimport { activePathExistsAtom, activePathsAtom } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyAbsolutePathActionAtom = actionAtom({\n  id: projectActionIds.CopyAbsolutePath,\n  title: \"Absolute Path\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  useShortcutsOf: \"CopyPaths\",\n  actionPerformed: async ({ get }) => {\n    notImplemented();\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n  },\n});\n","import { atom } from \"jotai\";\n\nimport {\n  activePathExistsAtom,\n  activePathsAtom,\n} from \"../../Project/project.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const copyPathFromRepositoryRootActionAtom = actionAtom({\n  id: VcsActionIds.CopyPathFromRepositoryRootProvider,\n  title: \"Path From Repository Root\",\n  isDisabled: atom((get) => !get(activePathExistsAtom)),\n  actionPerformed: async ({ get }) => {\n    notImplemented();\n    const activePaths = get(activePathsAtom);\n    if (activePaths.length === 0) {\n      return;\n    }\n  },\n});\n","import { Getter, Setter, useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\n\nimport { createFileActionAtom } from \"./actions/createFileAction\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { createDirectoryActionAtom } from \"./actions/createDirectoryAction\";\nimport { projectActionIds } from \"./projectActionIds\";\nimport { copyFilenameActionAtom } from \"./actions/copyFilename\";\nimport { copyAbsolutePathActionAtom } from \"./actions/copyAbsolutePath\";\nimport { copyPathFromRepositoryRootActionAtom } from \"../VersionControl/actions/copyPathFromRepositoryRoot\";\n\nconst openSearchEverywhereCallback = (\n  _get: Getter,\n  set: Setter,\n  { element }: ActionContext,\n  tab: string\n) => {\n  if (element) {\n    set(searchEverywhereState.isOpen, true);\n    set(searchEverywhereState.tab, tab);\n    set(searchEverywhereState.contextElement, element);\n  }\n};\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useAtomCallback(openSearchEverywhereCallback);\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const newFileAction = useAtomValue(createFileActionAtom);\n  const newDirectoryAction = useAtomValue(createDirectoryActionAtom);\n  const newElementActionGroup = createDefaultActionGroup({\n    id: projectActionIds.NewElement,\n    title: \"New...\",\n    description: \"Create new class, interface, file or directory\",\n    isSearchable: true,\n    children: [newFileAction, newDirectoryAction],\n  });\n\n  const copyReferencePopupGroup = createDefaultActionGroup({\n    id: projectActionIds.CopyReferencePopupGroup,\n    title: \"Copy Path/Reference...\",\n    menuPresentation: \"none\",\n    children: [\n      // TODO: CopyFileReferences action group popup is not the default popup, it shows the copyable value as a hint\n      //  segment in each menu item. A custom actionPerformed should be implemented.\n      createDefaultActionGroup({\n        id: projectActionIds.CopyFileReference,\n        title: \"Copy File Reference\", // in the original impl, there is no title\n        isSearchable: false,\n        menuPresentation: \"section\",\n        children: [\n          // FIXME: actions are not triggered via UI\n          useAtomValue(copyAbsolutePathActionAtom),\n          useAtomValue(copyFilenameActionAtom),\n          // FIXME: should be able to define divider here\n          // new Divider(),\n          useAtomValue(copyPathFromRepositoryRootActionAtom),\n        ],\n      }),\n    ],\n  });\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n    newElementActionGroup,\n    copyReferencePopupGroup,\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React, { useCallback } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport path from \"path\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changesTreeNodesAtom,\n  changesUnderSelectedKeysAtom,\n  ChangesViewTreeNode,\n  expandedKeysAtom,\n  includedChangeKeysAtom,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysAtom,\n} from \"./ChangesView/ChangesView.state\";\nimport { allChangesAtom } from \"./changes.state\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsAtom,\n  currentProjectFilesAtom,\n} from \"../../Project/project.state\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport { getNodeKeyForChange, isGroupNode } from \"./ChangesTree/ChangeTreeNode\";\nimport { Change } from \"./Change\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { useRefreshRepoStatuses } from \"../file-status.state\";\nimport { activeChangeListState } from \"./change-lists.state\";\n\nimport { unwrapLatestOrNull } from \"../../atom-utils/unwrapLatest\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useAtomCallback(\n    openRollbackWindowForSelectionCallback\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh VCS Changes\",\n      description: \"Refresh VCS Changes\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useAtomCallback(queueCheckInCallback);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useAtomValue(activePathsAtom);\n  const projectFiles = useAtomValue(\n    unwrapLatestOrNull(currentProjectFilesAtom)\n  );\n  const roots = findRootPaths(activePaths);\n\n  const allChanges = useAtomValue(allChangesAtom);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, Change.path(change)))\n  );\n\n  // The logic here is a little better than the reference impl, which itself is inconsistent in project view\n  // and in Changes view (aka commit view).\n  const isDirectory = (path: string) =>\n    projectFiles?.some((item) => item.type === \"dir\" && item.path === path);\n  const selectedPathsAreDirectories = roots.every(isDirectory);\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: selectedPathsAreDirectories\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useAtomCallback(\n    useCallback((get, set) => {\n      const includedChangesKeys = get(includedChangeKeysAtom);\n      let keyToSelect = includedChangesKeys.values().next().value;\n      if (includedChangesKeys.size === 0) {\n        const allKeys = get(activeChangeListState)?.changes.map(\n          getNodeKeyForChange\n        );\n        set(includedChangeKeysAtom, new Set(allKeys));\n        keyToSelect = allKeys?.[0];\n      }\n      if (keyToSelect) {\n        const { rootNodes } = get(changesTreeNodesAtom);\n        set(\n          expandedKeysAtom,\n          new Set([\n            ...get(expandedKeysAtom),\n            ...getExpandedToNodesKeys(\n              (node) => (isGroupNode(node) ? node.children : null),\n              (node) => node.key,\n              rootNodes as ChangesViewTreeNode[],\n              [keyToSelect]\n            ),\n          ])\n        );\n        set(selectedKeysAtom, new Set([keyToSelect]));\n      }\n    }, [])\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useAtomValue(changesUnderSelectedKeysAtom);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        const changePath = Change.path(change);\n        if (!changePath) {\n          editorStateManager.openPath(changePath, index === arr.length - 1);\n        }\n      });\n    },\n  };\n}\n\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChanges = useAtomValue(changesUnderSelectedKeysAtom);\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n  if (selectedChanges.size > 0) {\n    // FIXME: should use active paths, not selection\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useAtomValue } from \"jotai\";\nimport { Errors } from \"isomorphic-git\";\nimport { activeFileRepoBranchesAtom } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useAtomValue(activeFileRepoBranchesAtom);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches?.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"error\" : \"valid\";\n\n  const create = () => {\n    if (isValid && branches?.repoRoot) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              validationMessage={\n                validationState === \"error\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"error\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"jotai\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport git from \"isomorphic-git\";\nimport { PlatformIcon } from \"@intellij-platform/core\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { fileStatusAtoms, vcsFootForFileAtom } from \"../file-status.state\";\nimport { fs } from \"../../fs/fs\";\nimport path from \"path\";\nimport { activePathsAtom } from \"../../Project/project.state\";\nimport { gitAddCallback } from \"../gitAddCallback\";\nimport { actionAtom } from \"../../actionAtom\";\n\nconst pathsToAddAtom = atom<Promise<string[]>>(async (get) => {\n  return asyncFilter(async (activePath): Promise<boolean> => {\n    const repoDir = await get(vcsFootForFileAtom(activePath));\n    if (repoDir) {\n      const isIgnored = await git.isIgnored({\n        fs,\n        dir: repoDir,\n        filepath: path.relative(repoDir, activePath),\n      });\n      const isFile = await fs.promises\n        .stat(activePath)\n        .then((stat) => stat.isFile())\n        .catch(() => false);\n      const isUnchangedFile =\n        isFile && (await get(fileStatusAtoms(activePath))) === \"NOT_CHANGED\";\n      return !isIgnored && !isUnchangedFile; // logic checked with the behavior of the reference impl\n    }\n    return false;\n  }, get(activePathsAtom));\n});\n\nconst gitAddDisabledAtom = atom(\n  async (get) => (await get(pathsToAddAtom)).length === 0\n);\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status, though.\n * TODO: task API can be used to make this a task.\n */\nexport const gitAddActionAtom = actionAtom({\n  id: VcsActionIds.GIT_ADD,\n  title: \"Add\",\n  icon: <PlatformIcon icon=\"general/add.svg\" />,\n  useShortcutsOf: VcsActionIds.ADD_UNVERSIONED,\n  isDisabled: gitAddDisabledAtom,\n  actionPerformed: async ({ get, set }) => {\n    const pathsToAdd = await get(pathsToAddAtom);\n    await Promise.all(\n      pathsToAdd.map((aPath) => gitAddCallback(get, set, aPath))\n    );\n  },\n});\n","import git from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport {\n  activePathsAtom,\n  currentProjectAtom,\n} from \"../../Project/project.state\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  refreshRepoStatusesCallback,\n  vcsRootsAtom,\n} from \"../file-status.state\";\nimport { actionAtom } from \"../../actionAtom\";\nimport { stat } from \"../../fs/fs-utils\";\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status.\n * TODO: task API can be used to make this a task.\n */\nexport const gitInitActionAtom = actionAtom({\n  id: VcsActionIds.GIT_INIT,\n  title: \"Create Git Repository...\",\n  actionPerformed: async ({ get, set }) => {\n    // TODO: open a path selector to select the path where the git repo should be initialized\n    const project = get(currentProjectAtom);\n    const activePath = get(activePathsAtom)[0];\n    const stats = await stat(activePath);\n    const dir = stats?.isDirectory() ? activePath : project.path;\n    await git.init({ fs, dir });\n    set(vcsRootsAtom, (roots) =>\n      roots\n        .filter((root) => root.dir !== dir)\n        .concat({\n          vcs: \"Git\",\n          dir,\n        })\n    );\n    await refreshRepoStatusesCallback(get, set);\n  },\n});\n","import { z } from \"zod\";\nimport { atomWithPersistence } from \"../persistence/atomWithPersistence\";\nimport { list, maybeArray } from \"../persistence/schema-utils\";\nimport { focusAtom } from \"jotai-optics\";\n\ninterface VisitedUrl {\n  url: string;\n  username?: string;\n}\n\nconst visitedUrlsSchema = z.object({\n  \"@name\": z.enum([\"visitedUrls\"]),\n  list: list(\n    z.object({\n      option: maybeArray(\n        z.union([\n          z.object({\n            \"@name\": z.enum([\"url\"]),\n            \"@value\": z.string(),\n          }),\n          z.object({\n            \"@name\": z.enum([\"userName\"]),\n            \"@value\": z.string(),\n          }),\n        ])\n      ),\n    }),\n    \"UrlAndUserName\"\n  ),\n});\nconst cloneParentDirSchema = z.object({\n  \"@name\": z.enum([\"cloneParentDir\"]),\n  \"@value\": z.string(),\n});\nconst gitRememberedInputsSchema = z.object({\n  option: maybeArray(z.union([visitedUrlsSchema, cloneParentDirSchema])),\n});\n\ntype VisitedUrlsOption = (typeof visitedUrlsSchema)[\"_output\"];\ntype CloneParentDirOption = (typeof cloneParentDirSchema)[\"_output\"];\n\nconst gitRememberedInputsAtom = atomWithPersistence(\n  {\n    visitedUrls: [],\n    cloneParentDir: \"\",\n  },\n  {\n    storageFile: \"vcs.xml\", // GitRememberedInputs is user-level configuration, kept here temporarily\n    componentName: \"GitRememberedInputs\",\n    schema: gitRememberedInputsSchema,\n    read: ({ option: options } = { option: [] }) => {\n      return {\n        visitedUrls:\n          options\n            ?.find(\n              (option): option is VisitedUrlsOption =>\n                option[\"@name\"] === \"visitedUrls\"\n            )\n            ?.list.UrlAndUserName.map(\n              ({ option }): { url: string; username?: string | undefined } => ({\n                url: option.find((option) => option[\"@name\"] === \"url\")?.[\n                  \"@value\"\n                ]!,\n                username: option.find(\n                  (option) => option[\"@name\"] === \"userName\"\n                )?.[\"@value\"],\n              })\n            )\n            .filter((i) => i.url) ?? [],\n        cloneParentDir:\n          options?.find(\n            (option): option is CloneParentDirOption =>\n              option[\"@name\"] === \"cloneParentDir\"\n          )?.[\"@value\"] ?? \"\",\n      };\n    },\n    write: (value, state): (typeof gitRememberedInputsSchema)[\"_output\"] => {\n      return {\n        ...state,\n        option:\n          state.option?.map((option) => {\n            if (option[\"@name\"] === \"cloneParentDir\" && value.cloneParentDir) {\n              return {\n                \"@name\": \"cloneParentDir\",\n                \"@value\": value.cloneParentDir,\n              };\n            }\n            if (option[\"@name\"] === \"visitedUrls\" && value.visitedUrls) {\n              return {\n                \"@name\": \"visitedUrls\",\n                list: {\n                  UrlAndUserName: value.visitedUrls.map(\n                    ({ url, username }) => ({\n                      option: [\n                        { \"@name\": \"url\", \"@value\": url },\n                        { \"@name\": \"userName\", \"@value\": username ?? \"\" },\n                      ],\n                    })\n                  ),\n                },\n              };\n            }\n            return option;\n          }) ?? [],\n      };\n    },\n  }\n);\n\nexport const gitVisitedUrlsAtom = focusAtom(gitRememberedInputsAtom, (optic) =>\n  optic.path(\"visitedUrls\")\n);\n\nexport const cloneParentDirAtom = focusAtom(gitRememberedInputsAtom, (optic) =>\n  optic.path(\"cloneParentDir\")\n);\n","import React, { useEffect, useState } from \"react\";\nimport path from \"path\";\nimport git, { clone, GitProgressEvent } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport { defaultProject, autoClonedRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { ensureDir } from \"./fs/fs-utils\";\nimport {\n  AlertDialog,\n  Button,\n  Popup,\n  ProgressBar,\n  styled,\n} from \"@intellij-platform/core\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\nconst defaultWorkspaceFiles = {\n  \".idea/vcs.xml\": `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"GitRememberedInputs\">\n    <option name=\"visitedUrls\">\n      <list>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/alirezamirian/jui.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/thurwitz/example-branches.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n      </list>\n    </option>\n    <option name=\"cloneParentDir\" value=\"/workspace\"></option>\n  </component>\n  <component name=\"VcsDirectoryMappings\"></component>\n</project>\n\n`,\n};\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nconst defaultInitializer = async () => {\n  await ensureDir(fs.promises, defaultProject.path);\n  await Promise.all(\n    Object.entries(defaultWorkspaceFiles).map(async ([filename, content]) => {\n      const fullPath = path.join(defaultProject.path, filename);\n      if (await fs.promises.exists(fullPath)) {\n        return;\n      }\n      await ensureDir(fs.promises, path.dirname(fullPath));\n      await fs.promises.writeFile(fullPath, content, \"utf-8\");\n    })\n  );\n};\n\n/**\n * Used instead of Popup to have it not be fixed positioned, since this popup\n * is auto rendered in website's homepage, and example-app is rendered inline\n * there.\n */\nconst InlinePopup = styled(StyledPopupContainer)<{ minWidth?: number }>`\n  min-width: ${({ minWidth }) => (minWidth ? `${minWidth}px` : \"\")};\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nexport const ProjectInitializer = ({\n  children,\n  autoCloneSampleRepo = false,\n}: {\n  autoCloneSampleRepo?: boolean;\n  children?: React.ReactNode;\n}) => {\n  const [cloneProgress, setCloneProgress] = useState<GitProgressEvent | null>(\n    null\n  );\n\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function ensureSampleRepo(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl, onProgress: setCloneProgress });\n      }\n    }\n    // noinspection JSIgnoredPromiseFromCall: error handling done in the function\n    init();\n    async function init() {\n      const initializer =\n        (window as any).INITIALIZE_APP ?? // Giving a chance for external fs initialization. Used in e2e tests\n        defaultInitializer;\n      try {\n        await initializer({\n          fs,\n          git,\n          path,\n          projectDir: defaultProject.path,\n        });\n        if (autoCloneSampleRepo) {\n          await ensureSampleRepo(autoClonedRepo.path, autoClonedRepo.url);\n        }\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      } catch (e) {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      }\n    }\n  }, []);\n\n  const fraction = cloneProgress?.total\n    ? cloneProgress.loaded / cloneProgress.total\n    : 0;\n\n  switch (state) {\n    case \"uninitialized\":\n      return null;\n    case \"initialized\":\n      return <>{children}</>;\n    case \"cloning\":\n      return (\n        <InlinePopup minWidth={450}>\n          <Popup.Layout\n            header=\"Cloning sample git repository\"\n            content={\n              <div style={{ padding: \"1rem\" }}>\n                <ProgressBar\n                  name={`Cloning repository ${autoClonedRepo.url}`}\n                  isIndeterminate={!cloneProgress}\n                  details={\n                    fraction\n                      ? `${cloneProgress?.phase}: ${Math.round(\n                          fraction * 100\n                        )}% ${cloneProgress?.loaded}/${cloneProgress?.total}`\n                      : cloneProgress?.phase\n                  }\n                  aria-label={`Progress of cloning sample repo`}\n                  value={\n                    cloneProgress\n                      ? cloneProgress.loaded / cloneProgress.total\n                      : 0\n                  }\n                  maxValue={1}\n                />\n              </div>\n            }\n          />\n        </InlinePopup>\n      );\n    case \"error\":\n      return (\n        <AlertDialog\n          type=\"error\"\n          heading=\"Something went wrong!\"\n          body=\"Could not initialize example app\"\n          buttons={\n            <Button\n              variant=\"default\"\n              onPress={() => {\n                window.location.reload();\n              }}\n            >\n              Reload\n            </Button>\n          }\n        />\n      );\n  }\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","export function getInputCursorOffset(input: HTMLInputElement): number {\n  const caretIndex = input.selectionStart ?? input.value.length;\n  const inputStyle = window.getComputedStyle(input);\n\n  // Create and style a hidden span to mirror the input\n  const hiddenSpan = document.createElement(\"span\");\n  hiddenSpan.style.position = \"absolute\";\n  hiddenSpan.style.visibility = \"hidden\";\n  hiddenSpan.style.whiteSpace = \"pre-wrap\"; // Preserve spaces and line breaks\n  hiddenSpan.style.font = inputStyle.font;\n  hiddenSpan.style.fontSize = inputStyle.fontSize;\n  hiddenSpan.style.fontWeight = inputStyle.fontWeight;\n  hiddenSpan.style.fontFamily = inputStyle.fontFamily;\n  hiddenSpan.style.letterSpacing = inputStyle.letterSpacing;\n  hiddenSpan.style.border = inputStyle.border;\n  hiddenSpan.style.paddingLeft = inputStyle.paddingLeft;\n\n  // Set span content to text before the caret\n  hiddenSpan.textContent = input.value.substring(0, caretIndex);\n  document.body.appendChild(hiddenSpan);\n\n  // Measure the width of the hidden span to get the caret offset\n  const caretOffset = hiddenSpan.offsetWidth;\n\n  // Clean up the hidden span\n  document.body.removeChild(hiddenSpan);\n  return caretOffset;\n}\n","import path from \"path\";\nimport React, { ComponentProps, useEffect, useRef, useState } from \"react\";\nimport { mergeProps, mergeRefs } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  ActionsProvider,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  CommonActionId,\n  InputField,\n  Item,\n  ItemLayout,\n  ListBox,\n  MenuOverlayFromOrigin,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  WINDOW_SHADOW,\n} from \"@intellij-platform/core\";\nimport { MENU_VERTICAL_PADDING } from \"@intellij-platform/core/Menu/StyledMenu\";\nimport { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { fs } from \"../../fs/fs\";\nimport { getInputCursorOffset } from \"./getInputCursorOffset\";\n\nconst StyledPopover = styled.div`\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\nconst ListBoxStyledAsMenu: typeof ListBox /* https://github.com/styled-components/styled-components/issues/1803#issuecomment-2177525252 */ = styled(\n  ListBox\n)`\n  min-width: 120px;\n  margin: ${MENU_VERTICAL_PADDING}px 0;\n`;\n\nasync function getChildDirectories(searchDirectory: string) {\n  return fs.promises.readdir(searchDirectory).then(async (fileNames) => {\n    const childItems = await Promise.all(\n      fileNames.map(async (fileName) => {\n        const fullPath = path.join(searchDirectory, fileName);\n        return {\n          fullPath,\n          stat: await fs.promises.stat(fullPath),\n        };\n      })\n    );\n    return childItems\n      .filter(({ stat }) => stat.isDirectory())\n      .map(({ fullPath }) => fullPath);\n  });\n}\n\nexport function PathInputField({\n  value: valueProp,\n  onChange: onChangeProp,\n  defaultValue: defaultValueProp,\n  ...props\n}: Omit<ComponentProps<typeof InputField>, \"value\" | \"defaultValue\"> & {\n  value?: string;\n  defaultValue?: string;\n}) {\n  const [value, setValue] = useControlledState(\n    valueProp,\n    defaultValueProp ?? \"\",\n    onChangeProp\n  );\n  const [isAutocompleteVisible, setAutocompleteVisible] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const collectionRef = useRef<HTMLDivElement>(null);\n  const onAutocompleteSuggestionSelected = (key: React.Key) => {\n    setValue(path.join(`${key}`, path.sep)); // TODO: handle completion with tab\n  };\n  // Path search query is kept in a separate state because it needs to be updated when autocomplete action triggers.\n  // Otherwise, it could be a computed value based on `isAutocompleteVisible` and `directory`\n  const [pathSearchQuery, setPathSearchQuery] = useState(\"\");\n  const [pathSuggestions, setPathSuggestions] = useState<\n    Array<{ fullPath: string; textValue: string }>\n  >([]);\n  const updatePathAutocompletion = () => {\n    setMenuOrigin({\n      clientX:\n        (inputClientRect?.x ?? 0) + getInputCursorOffset(inputRef.current!),\n      clientY: (inputClientRect?.y ?? 0) + (inputClientRect?.height ?? 0) + 2,\n    });\n    setPathSearchQuery(\n      value.slice(0, inputRef.current?.selectionStart ?? undefined)\n    );\n  };\n  useEffect(() => {\n    if (isAutocompleteVisible) {\n      updatePathAutocompletion();\n    }\n  }, [isAutocompleteVisible, value]);\n\n  const wasAutocompleteVisible = usePrevious(isAutocompleteVisible);\n\n  useEffect(() => {\n    const pathParts = pathSearchQuery.split(path.sep);\n    const searchDirectory = pathParts.slice(0, -1).join(path.sep) || \"/\";\n    const query = pathParts.length > 1 ? pathParts.slice(-1)[0] : \"\";\n    let canceled = false;\n    getChildDirectories(searchDirectory).then((suggestions) => {\n      if (canceled) {\n        return;\n      }\n      // TODO: handle \"No suggestions\"\n      const matchedSuggestions = suggestions\n        .map((fullPath) => {\n          const dirname = path.basename(fullPath);\n          return { fullPath, textValue: dirname };\n        })\n        .filter(\n          ({ textValue }) =>\n            !query || textValue.toLowerCase().includes(query.toLowerCase())\n        );\n      setPathSuggestions(matchedSuggestions);\n      // TODO: set \"Use {0} to keep tail of the path\" tip if caret position is not at the end.\n      if (\n        matchedSuggestions.length > 0 &&\n        /* Note that wasAutocompleteVisible is a captured closure and it's intentionally not in effect's dependencies */\n        !wasAutocompleteVisible &&\n        inputRef.current?.value.indexOf(pathSearchQuery) === 0\n      ) {\n        inputRef.current.setSelectionRange(\n          pathSearchQuery.length,\n          inputRef.current.value.length,\n          \"backward\"\n        );\n      }\n    });\n    return () => {\n      canceled = true;\n    };\n  }, [pathSearchQuery]);\n\n  const [menuOrigin, setMenuOrigin] = useState({ clientX: 0, clientY: 0 });\n\n  const inputClientRect = inputRef.current?.getBoundingClientRect();\n\n  return (\n    <>\n      <ActionsProvider\n        actions={[\n          {\n            id: CommonActionId.CODE_COMPLETION,\n            title: \"Autocomplete path\",\n            actionPerformed: () => {\n              updatePathAutocompletion();\n              setAutocompleteVisible(true);\n            },\n          },\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <InputField\n            {...props}\n            value={value}\n            onChange={setValue}\n            inputRef={mergeRefs(inputRef, props.inputRef)}\n            inputProps={mergeProps(\n              props.inputProps ?? {},\n              shortcutHandlerProps,\n              {\n                onKeyDown: (e: React.KeyboardEvent) => {\n                  if (e.key === \"Escape\") {\n                    setAutocompleteVisible(false);\n                  }\n                },\n                onBlur: () => {\n                  setAutocompleteVisible(false);\n                },\n              }\n            )}\n            addonAfter={\n              <>\n                {props.addonAfter}\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Browse... ()\" />}\n                >\n                  {(props) => (\n                    <AutoHoverPlatformIcon\n                      {...props}\n                      style={{ marginRight: \".2rem\" }}\n                      role=\"button\"\n                      onClick={notImplemented}\n                      icon=\"general/openDisk.svg\"\n                    />\n                  )}\n                </TooltipTrigger>\n              </>\n            }\n          />\n        )}\n      </ActionsProvider>\n      {isAutocompleteVisible && (\n        <MenuOverlayFromOrigin\n          onClose={() => {\n            setAutocompleteVisible(false);\n          }}\n          origin={menuOrigin}\n        >\n          <StyledPopover>\n            <ListBoxStyledAsMenu\n              ref={collectionRef}\n              focusProxyRef={inputRef}\n              aria-label=\"Directories\"\n              shouldFocusOnHover\n              shouldUseVirtualFocus\n              autoFocus=\"first\"\n              onAction={onAutocompleteSuggestionSelected}\n              items={pathSuggestions}\n            >\n              {({ fullPath }) => (\n                <Item key={fullPath} textValue={fullPath}>\n                  <ItemLayout>\n                    <PlatformIcon icon={DIR_ICON} />\n                    {path.basename(fullPath)}\n                  </ItemLayout>\n                </Item>\n              )}\n            </ListBoxStyledAsMenu>\n          </StyledPopover>\n        </MenuOverlayFromOrigin>\n      )}\n    </>\n  );\n}\n","import path from \"path\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useAtom } from \"jotai\";\nimport {\n  Button,\n  ComboBox,\n  Item,\n  LabeledControlsAlignmentProvider,\n  ModalWindow,\n  styled,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport { windowManagerRefAtom } from \"../../Project/project.state\";\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  cloneParentDirAtom,\n  gitVisitedUrlsAtom,\n} from \"../gitRememberedInputs.state\";\nimport { useClone } from \"../useClone\";\nimport { PathInputField } from \"./PathInputField\";\nimport { actionAtom } from \"../../actionAtom\";\n\nexport const gitCloneActionAtom = actionAtom({\n  id: VcsActionIds.GIT_CLONE,\n  title: \"Clone...\",\n  actionPerformed: async ({ get }) => {\n    const windowManager = get(windowManagerRefAtom);\n    windowManager.current?.open(({ close }) => (\n      <GitCloneWindow close={close} />\n    ));\n  },\n});\n\nexport const cloneAnotherRepoActionAtom = actionAtom({\n  id: \"ExampleApp.cloneExampleRepo\",\n  title: \"Clone another repository...\",\n  isSearchable: false,\n  actionPerformed: ({ get }) => {\n    const windowManager = get(windowManagerRefAtom);\n    windowManager.current?.open(({ close }) => (\n      <GitCloneWindow\n        close={close}\n        url=\"https://github.com/thurwitz/example-branches.git\"\n      />\n    ));\n  },\n});\n\nconst StyledContainer = styled.div`\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.75rem;\n`;\n\nfunction GitCloneWindow({\n  close,\n  url: urlProp,\n}: {\n  close: () => void;\n  url?: string;\n}) {\n  const [url, setUrl] = useState(urlProp ?? \"\");\n  const [parentDir, setCloneParentDirState] = useAtom(cloneParentDirAtom);\n  const [visitedUrls, setVisitedUrls] = useAtom(gitVisitedUrlsAtom);\n  const [directory, setDirectory] = useState(\"\");\n  const [autoFillDirectory, setAutoFillDirectory] = useState(true);\n  const [showValidationErrors, setShowValidationErrors] = useState(false);\n  const urlInputRef = useRef<HTMLInputElement>(null);\n  const dirInputRef = useRef<HTMLInputElement>(null);\n  const urlError = validateRepoUrl(url);\n  const [dirError, setDirError] = useState(\"\");\n\n  const clone = useClone();\n\n  useEffect(() => {\n    if (autoFillDirectory) {\n      const repoName =\n        url\n          .split(/\\/{1,2}/)\n          .pop()\n          ?.replace(/\\.git$/, \"\") ?? \"\";\n      setDirectory(repoName ? path.join(parentDir, repoName) : parentDir);\n    }\n  }, [parentDir, url, autoFillDirectory]);\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setShowValidationErrors(true);\n    // Note: in the reference impl, validation is live, here it's upon submission.\n    // Error is cleared upon change, like in NewFilePopup.\n    const dirValidationError = await validateCloneDirectory(directory);\n    if (dirValidationError) {\n      setDirError(dirValidationError);\n      dirInputRef.current?.focus();\n      return;\n    }\n    if (urlError) {\n      urlInputRef.current?.focus();\n      return;\n    }\n    setCloneParentDirState(path.dirname(directory));\n    setVisitedUrls((urls) =>\n      urls.find((visitedUrl) => visitedUrl.url === url)\n        ? urls\n        : urls.concat({ url })\n    );\n    clone({\n      url,\n      dir: directory,\n      onSuccess: () => {\n        setVisitedUrls((visitedUrls) =>\n          visitedUrls.map(({ url }) => url).includes(url)\n            ? visitedUrls\n            : [...visitedUrls, { url, username: \"\" }]\n        );\n      },\n    });\n    close();\n  };\n\n  return (\n    <ModalWindow minWidth={600} minHeight=\"content\">\n      <WindowLayout\n        header=\"Get from Version Control\"\n        content={\n          <LabeledControlsAlignmentProvider>\n            <form id=\"clone_form\" onSubmit={onSubmit}>\n              <StyledContainer>\n                <ComboBox\n                  inputRef={urlInputRef}\n                  autoFocus\n                  label=\"URL:\"\n                  value={url}\n                  validationState={\n                    urlError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && urlError}\n                  onValueChange={(value) => {\n                    setUrl(value);\n                  }}\n                  items={visitedUrls}\n                >\n                  {({ url }) => <Item key={url}>{url}</Item>}\n                </ComboBox>\n                <PathInputField\n                  inputRef={dirInputRef}\n                  label=\"Directory:\"\n                  value={directory}\n                  validationState={\n                    dirError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && dirError}\n                  onChange={(value) => {\n                    setDirectory(value);\n                    setAutoFillDirectory(false);\n                    setDirError(\"\");\n                  }}\n                />\n              </StyledContainer>\n            </form>\n          </LabeledControlsAlignmentProvider>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  isDisabled={!directory || !url}\n                  type=\"submit\"\n                  form=\"clone_form\"\n                >\n                  Clone\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function validateCloneDirectory(directory: string) {\n  const stats = await stat(directory);\n  if (!stats) {\n    return null;\n  }\n  if (!stats.isDirectory()) {\n    return \"Destination is not a directory\";\n  }\n  const entries = await fs.promises.readdir(directory);\n  return entries.length > 0\n    ? \"The directory already exists and is not empty\"\n    : null;\n}\nconst SSH_URL_PATTERN = new RegExp(`^git@[\\\\w.-]+:[\\\\w./-]+\\\\.git$`);\nfunction validateRepoUrl(url: string): string | null {\n  url = sanitizeCloneUrl(url);\n  try {\n    new URL(url);\n    return null;\n  } catch (e) {\n    if (SSH_URL_PATTERN.test(url)) {\n      return null;\n    }\n  }\n  return \"Repository URL is a malformed URL\";\n}\n\nfunction sanitizeCloneUrl(url: string): string {\n  return removePrefix(removePrefix(url.trim(), \"git clone\"), \"hg clone\");\n}\n\nfunction removePrefix(str: string, prefix: string): string {\n  if (str.startsWith(prefix)) {\n    return str.slice(prefix.length);\n  }\n  return str;\n}\n","import path from \"path\";\nimport { useCallback } from \"react\";\nimport { useSetAtom } from \"jotai\";\nimport { useAtomCallback } from \"jotai/utils\";\nimport { useRunTask } from \"../tasks\";\nimport { cloneRepo } from \"../ProjectInitializer\";\nimport { _balloonManagerRef } from \"../Project/notImplemented\";\nimport { dirContentAtom } from \"../fs/fs.state\";\nimport { vcsRootsAtom } from \"./file-status.state\";\n\nexport function useClone() {\n  const runTask = useRunTask();\n  const setVcsRoots = useSetAtom(vcsRootsAtom);\n\n  return useAtomCallback(\n    useCallback(\n      (\n        _get,\n        set,\n        {\n          url,\n          dir,\n          onSuccess,\n        }: {\n          url: string;\n          dir: string;\n          onSuccess?: () => void;\n        }\n      ) => {\n        runTask(\n          {\n            title: `Cloning source repository ${url}`,\n          },\n          {\n            onFinished: onSuccess,\n            run: async ({\n              setIndeterminate,\n              setFraction,\n              setSecondaryText,\n            }) => {\n              await cloneRepo({\n                dir,\n                url,\n                // TODO: handle onAuthFailure, onAuth, and maybe onMessage\n                onProgress: (progress) => {\n                  if (progress.total) {\n                    const fraction = progress.loaded / progress.total;\n                    setFraction(fraction);\n                    setSecondaryText(\n                      `${progress.phase}: ${Math.round(fraction * 100)}% ${\n                        progress.loaded\n                      }/${progress.total}`\n                    );\n                  } else {\n                    setSecondaryText(progress.phase);\n                    setIndeterminate(true);\n                  }\n                },\n              }).then(\n                () => {\n                  setVcsRoots((roots) =>\n                    roots.find((root) => root.dir === dir)\n                      ? roots\n                      : roots.concat({ vcs: \"Git\", dir })\n                  );\n                  // TODO: other directories within parent don't need a refresh.\n                  //  add an optimized way to refresh a single directory inside a directory\n                  set(dirContentAtom(path.resolve(dir, \"..\")));\n                },\n                (e) => {\n                  console.log(\"e\", e);\n                  // FIXME: using useBalloonManager doesn't work here, because of how BalloonManager is rendered inside WindowManager\n                  _balloonManagerRef.value?.show({\n                    icon: \"Error\",\n                    title: \"Clone failed\",\n                    body: `Failed to clone git repo \"${url} into ${dir}: ${e}\"`,\n                  });\n                }\n              );\n            },\n          }\n        );\n      },\n      []\n    )\n  );\n}\n","import { useAtomValue } from \"jotai\";\nimport React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\nimport { gitAddActionAtom } from \"./actions/gitAddAction\";\nimport { gitInitActionAtom } from \"./actions/gitInitAction\";\nimport { vcsRootsAtom } from \"./file-status.state\";\nimport {\n  cloneAnotherRepoActionAtom,\n  gitCloneActionAtom,\n} from \"./actions/gitCloneAction\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n  const gitAddAction = useAtomValue(gitAddActionAtom);\n  const gitInitAction = useAtomValue(gitInitActionAtom);\n  const gitCloneAction = useAtomValue(gitCloneActionAtom);\n  const cloneAnotherRepoAction = useAtomValue(cloneAnotherRepoActionAtom);\n  return [\n    ...useChangesViewActionDefinitions(),\n    gitAddAction,\n    gitCloneAction,\n    cloneAnotherRepoAction,\n    // not including git init action if there is at least one git root, because the action is not fully implemented\n    // and doesn't allow selecting the directory to initialize as a git repository. FIXME\n    ...(useAtomValue(vcsRootsAtom).length === 0 ? [gitInitAction] : []),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup close={close} />);\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH,\n      title: \"Navigate Log to Selected Branch Head\",\n      useShortcutsOf: \"SelectIn\",\n      icon: <PlatformIcon icon=\"general/locate.svg\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n  ];\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + Math.round(num / 20) + 1;\n}\n","import React, { CSSProperties, useRef } from \"react\";\nimport { useAtom, useAtomValue } from \"jotai\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionsProviderProps,\n  BalloonManager,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useAlertDialog,\n  useBalloonManager,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { toolWindows } from \"./toolWindows\";\nimport { SyncChangeListsState } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsStateAtom } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { useTestActions } from \"../testActions/useTestActions\";\nimport { ToolWindowsRefContext } from \"./useToolWindowManager\";\nimport {\n  alertDialogRefAtom,\n  projectPopupManagerRefAtom,\n  windowManagerRefAtom,\n} from \"./project.state\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({ height }: { height: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  const [state, setState] = useAtom(toolWindowsStateAtom);\n  const isRollbackWindowOpen = useAtomValue(rollbackViewState.isOpenAtom);\n  const isSearchEveryWhereOpen = useAtomValue(searchEverywhereState.isOpen);\n\n  useAtomValue(projectPopupManagerRefAtom).current = usePopupManager();\n  useAtomValue(windowManagerRefAtom).current = useWindowManager();\n  useAtomValue(alertDialogRefAtom).current = useAlertDialog();\n\n  return (\n    <>\n      <SyncChangeListsState />\n      <BalloonManager disablePortal>\n        <SetBalloonManagerRef />\n        <UsePersistentFsNotification />\n        {/* disablePortal to make example app more portable*/}\n        <ToolWindowsRefContext.Provider value={toolWindowRef}>\n          <StyledWindowFrame style={{ height }}>\n            <ProjectActionProvider>\n              {({ shortcutHandlerProps }) => (\n                <>\n                  <DefaultToolWindows\n                    ref={toolWindowRef}\n                    toolWindowsState={state}\n                    onToolWindowStateChange={(newState) => {\n                      setState(newState);\n                    }}\n                    windows={toolWindows}\n                    containerProps={shortcutHandlerProps}\n                  >\n                    <FileEditor />\n                  </DefaultToolWindows>\n                  <IdeStatusBar />\n                </>\n              )}\n            </ProjectActionProvider>\n            {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n            {isRollbackWindowOpen && <RollbackWindow />}\n          </StyledWindowFrame>\n        </ToolWindowsRefContext.Provider>\n      </BalloonManager>\n    </>\n  );\n};\n\nfunction ProjectActionProvider(\n  props: Omit<ActionsProviderProps, \"actions\" | \"useCapture\">\n) {\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n  return (\n    <ActionsProvider\n      {...props}\n      actions={allActions}\n      useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n    />\n  );\n}\n\nfunction SetBalloonManagerRef() {\n  _balloonManagerRef.value = useBalloonManager();\n  return null;\n}\n\nfunction UsePersistentFsNotification() {\n  usePersistenceFsNotification();\n  return null;\n}\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\nimport { AppActionIds } from \"./appActionIds\";\nimport { editorActionIds } from \"./Editor/editorActionIds\";\nimport { projectActionIds } from \"./Project/projectActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateVersionControlWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit9\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n  [VcsActionIds.ADD_UNVERSIONED]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [VcsActionIds.FOCUS_TEXT_FILTER]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyL\",\n      },\n    },\n  ],\n  [VcsActionIds.GROUP_BY_DIRECTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Control\"],\n        code: \"KeyP\",\n      },\n    },\n  ],\n  SafeDelete: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  CopyPaths: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [AppActionIds.PASTE_MULTIPLE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyV\",\n      },\n    },\n  ],\n  [projectActionIds.NewElement]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n  [AppActionIds.GENERATE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_REGION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_REGION_RECURSIVELY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_ALL_REGIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  ...([1, 2, 3, 4, 5] as const).reduce((result, level) => {\n    result[editorActionIds[`EXPAND_ALL_TO_LEVEL${level}`]] = [\n      {\n        type: \"keyboard\",\n        firstKeyStroke: {\n          modifiers: [\"Alt\", \"Meta\"],\n          code: \"Multiply\",\n        },\n        secondKeyStroke: {\n          code: `Digit${level}`,\n        },\n      },\n      {\n        type: \"keyboard\",\n        firstKeyStroke: {\n          modifiers: [\"Alt\", \"Meta\"],\n          code: \"Multiply\",\n        },\n        secondKeyStroke: {\n          code: `Numpad${level}`,\n        },\n      },\n    ];\n    return result;\n  }, {} as Keymap),\n  [editorActionIds.COLLAPSE_REGION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [editorActionIds.COLLAPSE_REGION_RECURSIVELY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [editorActionIds.COLLAPSE_ALL_REGIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n};\n","import * as path from \"path\";\nimport React, { CSSProperties } from \"react\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  KeymapProvider,\n  PopupManager,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { ProjectInitializer } from \"./ProjectInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport \"./jetbrains-mono-font.css\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({\n  height,\n  autoCloneSampleRepo,\n}: {\n  height?: CSSProperties[\"height\"];\n  autoCloneSampleRepo?: boolean;\n}) => {\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <ProjectInitializer autoCloneSampleRepo={autoCloneSampleRepo}>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <WindowManager>\n              <PopupManager>\n                <Project height={height} />\n              </PopupManager>\n            </WindowManager>\n          </KeymapProvider>\n        </ProjectInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n","var map = {\n\t\"./simpleWorker\": 87223,\n\t\"./simpleWorker.js\": 87223\n};\n\nfunction webpackAsyncContext(req) {\n\treturn Promise.resolve().then(() => {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\n\t\tvar id = map[req];\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 96300;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./editorBaseApi\": [\n\t\t79375\n\t],\n\t\"./editorBaseApi.js\": [\n\t\t79375\n\t],\n\t\"./editorSimpleWorker\": [\n\t\t42789\n\t],\n\t\"./editorSimpleWorker.js\": [\n\t\t42789\n\t],\n\t\"./editorWorker\": [\n\t\t30363\n\t],\n\t\"./editorWorker.js\": [\n\t\t30363\n\t],\n\t\"./editorWorkerHost\": [\n\t\t76679\n\t],\n\t\"./editorWorkerHost.js\": [\n\t\t76679\n\t],\n\t\"./findSectionHeaders\": [\n\t\t43631\n\t],\n\t\"./findSectionHeaders.js\": [\n\t\t43631\n\t],\n\t\"./getIconClasses\": [\n\t\t75154\n\t],\n\t\"./getIconClasses.js\": [\n\t\t75154\n\t],\n\t\"./languageFeatureDebounce\": [\n\t\t69060\n\t],\n\t\"./languageFeatureDebounce.js\": [\n\t\t69060\n\t],\n\t\"./languageFeatures\": [\n\t\t35921\n\t],\n\t\"./languageFeatures.js\": [\n\t\t35921\n\t],\n\t\"./languageFeaturesService\": [\n\t\t33293\n\t],\n\t\"./languageFeaturesService.js\": [\n\t\t33293\n\t],\n\t\"./languageService\": [\n\t\t44718\n\t],\n\t\"./languageService.js\": [\n\t\t44718\n\t],\n\t\"./languagesAssociations\": [\n\t\t41356\n\t],\n\t\"./languagesAssociations.js\": [\n\t\t41356\n\t],\n\t\"./languagesRegistry\": [\n\t\t33550\n\t],\n\t\"./languagesRegistry.js\": [\n\t\t33550\n\t],\n\t\"./markerDecorations\": [\n\t\t52919\n\t],\n\t\"./markerDecorations.js\": [\n\t\t52919\n\t],\n\t\"./markerDecorationsService\": [\n\t\t1022\n\t],\n\t\"./markerDecorationsService.js\": [\n\t\t1022\n\t],\n\t\"./model\": [\n\t\t65041\n\t],\n\t\"./model.js\": [\n\t\t65041\n\t],\n\t\"./modelService\": [\n\t\t94657\n\t],\n\t\"./modelService.js\": [\n\t\t94657\n\t],\n\t\"./resolverService\": [\n\t\t91223\n\t],\n\t\"./resolverService.js\": [\n\t\t91223\n\t],\n\t\"./semanticTokensDto\": [\n\t\t21982\n\t],\n\t\"./semanticTokensDto.js\": [\n\t\t21982\n\t],\n\t\"./semanticTokensProviderStyling\": [\n\t\t76263\n\t],\n\t\"./semanticTokensProviderStyling.js\": [\n\t\t76263\n\t],\n\t\"./semanticTokensStyling\": [\n\t\t76567\n\t],\n\t\"./semanticTokensStyling.js\": [\n\t\t76567\n\t],\n\t\"./semanticTokensStylingService\": [\n\t\t29922\n\t],\n\t\"./semanticTokensStylingService.js\": [\n\t\t29922\n\t],\n\t\"./textModelSync/textModelSync.impl\": [\n\t\t54632\n\t],\n\t\"./textModelSync/textModelSync.impl.js\": [\n\t\t54632\n\t],\n\t\"./textModelSync/textModelSync.protocol\": [\n\t\t66828,\n\t\t6828\n\t],\n\t\"./textModelSync/textModelSync.protocol.js\": [\n\t\t66828,\n\t\t6828\n\t],\n\t\"./textResourceConfiguration\": [\n\t\t16576\n\t],\n\t\"./textResourceConfiguration.js\": [\n\t\t16576\n\t],\n\t\"./treeSitterParserService\": [\n\t\t40143\n\t],\n\t\"./treeSitterParserService.js\": [\n\t\t40143\n\t],\n\t\"./treeViewsDnd\": [\n\t\t55247\n\t],\n\t\"./treeViewsDnd.js\": [\n\t\t55247\n\t],\n\t\"./treeViewsDndService\": [\n\t\t61860\n\t],\n\t\"./treeViewsDndService.js\": [\n\t\t61860\n\t],\n\t\"./unicodeTextModelHighlighter\": [\n\t\t83969\n\t],\n\t\"./unicodeTextModelHighlighter.js\": [\n\t\t83969\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(() => {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 34428;\nmodule.exports = webpackAsyncContext;"],"names":["LoadingGif","props","React","Img","_extends","src","darkSrc","__docgenInfo","Loading","styled","withConfig","displayName","componentId","DefaultSuspense","_ref","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","refreshDepsMap","WeakMap","refreshableAtoms","WeakSet","atomWithRefresh","read","write","refreshAtom","atom","refreshableAtom","get","options","deps","Set","value","arguments","length","undefined","has","add","set","_len","args","Array","_key","currentValue","dep","c","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","IndexedDB","Create","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","name","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","pathname","persistentFsPreference","key","localStorage","getItem","setItem","switchToPersistentFS","_temp","log","getRootFS","InMemory","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentAtom","atomFamily","fileNames","stats","all","map","fileName","type","basename","lastModification","mtimeMs","size","getDirContent","debugLabel","reloadFileFromDiskCallback","_get","fileContentAtom","encoding","atomWithLazy","error","convertGitStatus","isArray","filterPath","includes","autoClonedRepo","defaultProject","currentProjectAtom","projectFilePath","projectRelativePath","currentProjectFilesAtom","project","projectFilesAtom","projectPath","files","addItem","item","childItems","forEach","push","relativePath","activePathsAtom","activePathExistsAtom","useActivePathsProvider","createFocusBasedSetterHook","nullValue","focusedElement","setValue","useStore","setAtom","useSetAtom","useCallback","newValue","useStableSetAtom","elementRef","useRef","useEffect","current","equals","useFocusWithin","onFocusWithin","currentTarget","onBlurWithin","relatedTarget","Element","closest","focusWithinProps","projectPopupManagerRefAtom","createRef","windowManagerRefAtom","alertDialogRefAtom","StorageFiles","storagePaths","storageFile","storageFileDir","storageFileMapping","persistentStateStoreAtoms","cacheAtom","storageContentAtom","xmlParser","XMLParser","WORKSPACE_XML_PARSE_OPTIONS","storageFileExists","EMPTY_STORAGE_STATE","xmlData","workspace","Object","assign","parse","component","readStorageFile","fsWriteTimer","update","storageFilepath","state","currentState","clearTimeout","setTimeout","XMLBuilder","WORKSPACE_XML_BUILD_OPTIONS","build","serializeState","atomWithPersistence","initialValue","baseAtom","persistenceAtom","WORKSPACE_FILE","componentName","schema","v","identity","componentState","find","output","safeParse","data","action","components","index","findIndex","splice","createPersistedStateAtom","syncEffect","atomEffect","peek","persistedValue","x","z","object","whatever","number","optional","s","y","attributeNamePrefix","ignoreAttributes","tagName","jPath","format","maybeArray","union","array","transform","list","itemTagName","itemSchema","vcsRootsAtom","mapping","string","enum","dir","vcs","git","roots","filter","notNull","_ref2","vcsFootForFileAtom","findRoot","fetchRepoStatusFromFs","repoDir","rows","statusMatrix","result","row","repoStatusAtoms","targetAtom","withAtomEffect","repoStatus","isRepoStatusUpdatingAtom","_repoRoot","isAnyRepoStatusUpdatingAtom","some","_ref3","fileStatusAtoms","repoRoot","filepaths","refreshFileStatusCallback","statusMap","newStatusMap","refreshRepoStatusesCallback","_ref4","finally","useRefreshRepoStatuses","useAtomCallback","useStatusColor","theme","useTheme","dark","FileStatusColor","color","fileStatus","useAtomValue","unwrap","useFileStatusColor","style","StatusColor","currentForegroundAware","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","StyledContainer","div","attrs","tabIndex","StyledLine","StyledShortcut","commonColors","linkForegroundEnabled","EditorZeroState","ActionTip","actionId","CommonActionId","GO_TO_FILE","GO_TO_ACTION","getShortcut","useGetActionShortcut","useAction","AppActionIds","editorActionIds","EXPAND_REGION","EXPAND_REGION_RECURSIVELY","EXPAND_ALL_REGIONS","EXPAND_ALL_TO_LEVEL","EXPAND_ALL_TO_LEVEL1","EXPAND_ALL_TO_LEVEL2","EXPAND_ALL_TO_LEVEL3","EXPAND_ALL_TO_LEVEL4","EXPAND_ALL_TO_LEVEL5","COLLAPSE_REGION","COLLAPSE_REGION_RECURSIVELY","COLLAPSE_ALL_REGIONS","COLLAPSE_DOC_COMMENTS","TOGGLE_FOLDING","EDITOR_LANG_POPUP_MENU","CompareClipboardWithSelection","context","event","getCallbackAtom","setSelf","callback","editorTabsAtom","currentProjectFiles","sortWith","descend","file","endsWith","slice","editorState","cursorPos","lineNumber","column","activeEditorTabIndexState","activeEditorTabAtom","tabs","editorCursorPositionState","Position","editorRefAtom","openPathCallback","shouldFocus","tabsState","tab","select","focus","newIndex","closeCallback","_","closePathCallback","Math","max","closeOtherTabsCallback","selectTabCallback","numTabs","focusTabCallback","editorManagerAtom","getCallback","openPath","closeTab","closeOtherTabs","closePath","useEditorStateManager","darculaColorSchemeTokenRules","vsCodeTheme","flatMap","scope","settings","token","values","keys","StyledEditor","MonacoEditor","Editor","editorTheme","useEditorTheme","monaco","useMonaco","themeName","setThemeName","useState","useLayoutEffect","replace","bracketColor","editor","defineTheme","base","inherit","colors","rules","minimap","enabled","lineHeight","showFoldingControls","guides","indentation","overviewRulerBorder","fontFamily","fontSize","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","getCached","m","k","cache1","memo2","create","dep1","dep2","cache2","Map","nullObj","unwrapLatestWithLoading","anAtom","defaultValue","freshAtom","isLoading","unwrappedAtom","prev","editorFullStateAtom","activeEditorTab","FileEditor","editorTabs","editorStateManager","editorRef","active","setActive","contextMenu","setContextMenu","hideAllAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","isContentLoading","tabActionsRef","useLatest","closeOthersTabs","setEditorRef","setContent","updateFileStatus","editorActionGroupDefinition","createDefaultActionGroup","useCreateDefaultActionGroup","selection","getSelection","selectedText","getModel","getValueInRange","id","description","isSearchable","menuPresentation","PlatformIcon","actionPerformed","COPY","copyToClipboard","PASTE","trigger","COPY_REFERENCE","level","useEditorActionGroup","updateContent","newContent","activePathsProviderProps","ActionsProvider","shortcutHandlerProps","StyledFileEditorContainer","mergeProps","onFocus","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","contextmenu","onMount","monacoEditor","onContextMenu","preventDefault","onDidScrollChange","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","JsxEmit","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","onChange","FileEditorLoading","MenuOverlayFromOrigin","origin","browserEvent","onClose","EditorActionGroupMenu","actionGroup","useActionGroup","ActionGroupMenu","menuProps","autoFocus","isUnderDarcula","panelBackground","StyledXterm","XTerm","Terminal","input","setInput","xtermRef","useMemo","background","letterSpacing","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","ref","onData","charCodeAt","foldersOnTopState","expandedKeysAtom","atomWithDefault","selectionAtom","selectedNodesAtom","nodesByKey","currentProjectTreeAtom","byKey","projectViewTreeRefAtom","rootItems","mapItem","parent","node","dirNode","sortProjectTreeNodes","root","createProjectTree","sort","item1","item2","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","projectActionIds","NewElement","NewFile","NewDir","CopyReferencePopupGroup","CopyPaths","CopyFileReference","CopyAbsolutePath","CopySourceRootPath","CopyFileName","ProjectViewContextMenu","getActionContext","ActionsMenu","actionContext","shortcut","DividerItem","CUT","DELETE","memoized","_cache","arg1","unwrapLatest","unwrapLatestOrNull","ProjectViewPane","setProjectViewTreeRef","treeState","setExpandedKeys","useAtom","selectedKeys","setSelectedKeys","sortItems","sortBy","a","selectedKeysArray","i","containerRef","contextMenuTargetKey","element","querySelector","onOpen","dataset","SpeedSearchTree","fillAvailableSpace","selectionMode","onExpandedChange","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","Hint","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","_ref5","HelpButton","HelpTooltip","helpText","Button","variant","findRootPaths","objects","getPath","obj","thePath","anObject","startsWith","deleteFileCallback","unlink","deleteFilesCallback","filePaths","createDirectoryCallback","destination","fullpath","isAtom","actionAtom","isSearchableValue","isDisabled","isDisabledValue","maybeAtom","fileCountMsg","IntlMessageFormat","dirCountMsg","deleteActionAtom","selectedNodes","windowManager","alertDialog","nodesToDelete","directories","singleDirName","confirm","okText","message","width","count","join","recursivelyDeleteDir","pathnames","rmdir","deleteDirCallback","open","close","DeleteFilesConfirmationDialog","confirmed","requestAnimationFrame","ModalWindow","minWidth","minHeight","WindowLayout","header","onSubmit","padding","marginBottom","display","flexDirection","gap","Checkbox","footer","Footer","left","right","form","copyActionAtom","cutActionAtom","pasteActionAtom","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","activeTab","selectPathInProjectView","selectOpenedFile","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","EXPAND_ALL","COLLAPSE_ALL","DEFAULT_LOADING_DELAY_MS","Delayed","waitedEnough","setWaitedEnough","timer","Tagged","change","Change","before","after","Unversioned","revision","changeToFileStatus","ADDED","DELETED","MOVED","RENAMED","MODIFIED","UNVERSIONED","revisionEquals","b","isDir","isAddition","isDeletion","isRename","isMove","isModified","isUnversioned","sameBefore","sameAfter","repoChangesAtoms","entries","allChangesAtom","flat","rollbackChangesCallback","changes","deleteAddedFiles","reloadFileFromDisk","changesWithRepoRoots","groupedChanges","groupBy","toReset","toCheckout","allSettled","_ref6","resetIndex","checkout","_ref7","_ref8","_ref9","_ref10","pathToRefresh","_ref11","changeListsAtom","jotaiAtom","comment","activeChangeListState","changeList","unversionedChangesAtom","SyncChangeListsState","setChangeLists","changeLists","trackedChanges","updatedChangeLists","aChange","existingChanges","newChanges","anExistingChange","createGroupByDirectory","mapNode","createDirectoryNode","shouldCollapseDirectories","nodes","pathToNodeCache","rootDirNodes","reduce","prevNode","parentNodePath","isDirectoryNode","directoryNodes","uniq","collapseDirectories","createDirectorNode","child","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","ADD_UNVERSIONED","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","EDIT_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GROUP_BY_DIRECTORY","GIT_ADD","GIT_INIT","GIT_CLONE","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","GIT_LOG_HIDE_BRANCHES","GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH","GIT_UPDATE_SELECTED","FOCUS_TEXT_FILTER","MATCH_CASE","REG_EXP","COPY_REVISION_NUMBER","LOG_REFRESH","SHOW_DETAILS","SHOW_DIFF_PREVIEW","PRESENTATION_SETTINGS","FILE_HISTORY_PRESENTATION_SETTINGS","CopyPathFromRepositoryRootProvider","changesTreeNodeKey","getNodeKeyForChange","changeNode","showPath","isGroupNode","isChangeNode","getChildren","repositoryGrouping","isAvailable","groupFn","repository","repositoryNode","directoryGrouping","useShortcutOf","keyPrefix","directoryNode","defaultChangeGroupings","defaultChangeGroupingsAtom","grouping","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","getPrefixedChangesGroupFn","isActive","groupings","groupFns","isOpenAtom","windowBoundsAtom","initiallyIncludedChangesAtom","rootNodesAtom","selectedChanges","rootNodes","changesTreeNodesAtom","includedRootNodes","rollbackViewState","initiallyExpandedKeysAtom","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","changesTreeNodesResult","fileCountsMap","expandAllKeys","dfsVisit","childrenFileCount","fileCount","total","changeListNode","showIgnoredFilesAtom","showRelatedFilesAtom","changesGroupingActiveState","selectedKeysAtom","resolvedSelectedKeysAtom","bfsVisit","parentValue","changesUnderSelectedKeysAtom","allChanges","processNode","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysAtom","includedChangesAtom","includedChangeKeys","includedChangesNestedSelectionAtom","NestedSelection","createSetInterface","getKey","updater","changesViewGroupingsState","groupChildren","changeListNodes","prefixedGroupFn","unversionedChanges","unversionedChangesNode","commitMessageSizeState","orientation","amendCommitAtom","commitMessageAtom","commitErrorMessageAtom","commitTaskIdAtom","changesFromActivePathsAtom","activePaths","activePath","queueCheckInCallback","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","contextual","changesUnderSelection","changesBasedOnActivePaths","ChangesViewTreeContextMenu","asyncFilter","predicate","predicateResult","getTrackingBranch","localBranchName","mergeRef","remote","repoLocalBranchesAtom","branches","branch","trackingBranch","repoRemoteBranchesAtoms","remotes","repoBranchesAtom","currentBranchName","repoCurrentBranchNameAtom","localBranches","currentBranch","remoteBranches","fullname","allBranchesAtom","repoRoots","branchForPathAtoms","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","readBranchStorage","branchStorage","entry","writeBranchStorage","branchesByType","keyAttribute","gitSettingsAtom","excludedBranches","newState","favoriteBranchesAtom","focusAtom","optic","prop","excludedFromFavoriteBranchesAtom","isFavoriteBranchAtoms","branchInfo","isFavorite","isPredefinedAsFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","StyledRepoColorSquare","span","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","currentBackgroundAware","formatFileCount","ChangeNodeHint","defaultNodeRenderers","repoNodeRenderer","rendered","directory","directoryNodeRenderer","createChangesTreeNodeRenderer","renderers","defaultRendererOverrides","nodeRenderers","getItemProps","nodeRenderer","dirCount","hasChildItems","getTextValue","itemRenderer","LoadingText","loading","changesViewTreeNodeRenderer","changelist","changeListNodeRenderer","fontWeight","unversioned","unversionedChangesNodeRenderer","_node","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","_set","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","selectionState","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","actionMenuProps","SpeedSearchMenu","GroupByActionButton","IconButton","isPressed","Section","ChangesGroupByActionButton","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","border","ToolbarSeparator","tasksAtom","firstTaskAtom","taskCountAtom","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","cancelToken","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","updates","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","onFinished","useCancelTask","abort","resolvedRefAtoms","depth","dateToString","date","getMonth","getDate","getFullYear","toString","dateRangeToString","dateRange","from","to","vcsTabKeysAtom","vcsActiveTabKeyAtom","vcsTabTitleAtoms","searchQuery","vcsLogFilter","user","parts","short","long","part","tabAtomFamilies","vcsLogAtomFamily","_tab","atomWithReset","vcsLogTabShowBranchesAtoms","vcsLogTabShowCommitDetailsAtoms","vcsLogTabShowCommitDetailsInCurrentTabAtom","CURRENT_USER_FILTER_VALUE","matchCase","regExp","vcsLogFilterCurrentTab","mapObjIndexed","useResetFilters","tabKey","getAtom","RESET","closeTabCallback","cache","commitDateComparator","commit","committer","timestamp","match","query","flags","RegExp","test","toLowerCase","allCommitsAtom","allCommits","commitsMap","commitsToProcess","readCommitResult","oid","sources","initialCommits","refs","repoPath","isBare","getCommonArgs","c1","c2","addCommit","latestCommit","containingRefs","shift","aCommit","readCommits","commitsTableRowsAtom","dateFilter","author","getTime","tree","byOid","indexBy","allResolvedRefsAtom","repoBranches","addRef","resolvedRef","isCurrent","commitsSelectionAtom","selectedCommitOids","selectedCommitsAtom","selectedCommitAtom","vcsTableShowCommitTimestampAtom","vcsTableReferencesOnTheLeftAtom","vcsTableHighlightMyCommitsAtom","authorColumn","hashColumn","dateColumn","defaultVisibleColumns","vcsTableColumnsVisibilityAtoms","commitSuccessfulMessage","useCommitChanges","refreshFileStatus","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","containsChange","blob","mode","newTreeOid","commitRef","commitFiles","email","StyledCommitMessageContainer","StyledCommitMessageTextArea","textarea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","amend","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","placeholder","preventFocusOnPress","mnemonic","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","setAmend","ActionHelpTooltip","focusCommitMessage","preventFocus","deleteChangeListMsg","selectedFilesCountMsg","deletablePathsUnderChangesTreeSelectionState","pathsToDelete","useChangesViewActions","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","refresh","StyledTreeViewWrapper","StyledLoadingWrapper","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","updating","commitMessageSize","setCommitMessageSize","changesViewActions","treeActions","ThreeViewSplitter","innerView","innerViewMinSize","lastView","lastSize","onLastResize","inactiveTextColor","ChangesViewZeroState","performAction","usePerformAction","textAlign","verticalAlign","ChangesViewPane","vcsRoots","TrackingBranchInfo","borderSpacing","COMMIT_TOOLWINDOW_ID","changesBranchesAtom","changesRepoRoots","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","View","tabContent","UNSAFE_FocusRestoringSuspense","document","activeElement","HTMLElement","isConnected","StyledHeader","borderColor","StyledSpacer","StyledPlaceholderContainer","parseCommitMessage","lines","bodyLines","subject","bodyAsString","line","shortenOid","commitDateTimeFormatter","Intl","DateTimeFormat","day","month","year","hour","minute","hour12","commitTimeFormatter","commitDateFormatter","getText","commitChangesTreeNodeRenderer","commitParent","DEFAULT_SIMILARITY_INDEX","detectRenames","deletions","additions","contents","getContent","renameMapping","similarity","file1Content","file2Content","diffLines","unchanged","added","removed","computeSimilarity","deletion","addition","currentCandidate","mergeRenames","detectRenamesBasedOnContent","hash","detectRenamesBasedOnHash","renamedChanges","rename","candidate","changesGroupingActiveAtoms","commitChangesTreeRefAtom","COMMIT_PARENT_ID","commitsDiffWithoutRenamesAtoms","fromRef","toRef","trees","afterOid","beforeOid","afterType","beforeType","afterRevision","TextDecoder","decode","Uint8Array","beforeRevision","getCommitChanges","commitsDiffAtoms","getChangedFilesAtom","atomForCommitsDiff","commitLogItem","parents","getChangesGroupFn","sortTreeNodesInPlace","changedFilesWithoutRenamesAtom","changedFilesAtom","loadableChangedFilesAtom","loadable","changedFilesLoadableAtom","CommitChangedFiles","treeShortcutHandlerProps","selectedCommits","nothingSelected","stateLoadable","setSelection","paddingBottom","PositionedTooltipTrigger","placement","bottom","labelIcon","fill","d","vcsLogStandardColors","light","gitLogColors","head","localBranch","remoteBranch","tag","StyledRef","StyledLabelSvg","svg","viewBox","StyledRefIconGroup","StyledLabelText","RefIcon","RefIconGroup","types","RefLabel","StyledCommitMessage","StyledCommitMessageHeader","StyledCommitterInfo","label","disabled","StyledCommitInfoRow","StyledRepoColorIcon","StyledRefsContainer","CommitDetails","firstSelectedCommit","allResolvedRefs","isMultiRepo","committerInfo","EmailLink","formatDateAndTime","refsByType","Tooltip","Date","RefGroup","StyledRefWithIcon","href","formatCommitDate","formatCommitTime","useRedefineAction","newId","useActions","commonProperties","useShortcutsOf","splitViewSizeState","groupingAtom","GROUP_BY_ACTION_GROUP_ID","LAYOUT_ACTION_GROUP_ID","VIEW_OPTIONS_ACTION_GROUP_ID","SHOW_DETAILS_ACTION_ID","SHOW_DIFF_PREVIEW_ACTION_ID","groupingActionId","VcsLogDetailsView","splitViewSize","setSplitViewSize","isDetailsVisible","toggleGroupBy","createActionGroup","availableGroupings","VcsLogsDetailsViewOptionsMenu","flexShrink","flex","firstSize","onFirstResize","firstViewMinSize","firstView","toggleActionAtoms","fromEntries","StyledDropdownButton","button","focusRing","focused","StyledDropdownIcon","StyledValue","FocusableAutoHoverPlatformIcon","AutoHoverPlatformIcon","VcsFilterDropdown","onClear","menuTriggerProps","MenuTrigger","BareButton","hoverIcon","StyledMenuIconButton","role","BranchFavoriteButton","onClick","onPointerUp","stopPropagation","hoverContainerSelector","BranchesFilterDropdown","selectedBranches","setSelectedBranches","resetBranches","useResetAtom","BranchesFilterMenu","onBranchesSelected","groupRepoRoots","repoGroupedAllBranchesState","allBranches","allRemoteBranches","allLocalBranches","setFavoriteBranches","repoGroupedAllBranches","remoteBranchesByRemote","createLocalBranchItems","renderBranchItem","submenuBehavior","_ref12","Divider","_ref13","_ref14","_ref15","NAME_PATTERN","getNameInStandardForm","firstAndLastName","matches","getFirstAndLastName","firstName","lastName","PRINTABLE_ASCII_PATTERN","nameToLowerCase","gitRepoUserAtoms","StyledCommitRow","StyledCommitCell","asOverlay","StyledMessageContainer","StyledRefTooltipRow","useCurrentUserHighlightStyle","currentUser","shouldHighlightCurrentUserCommits","userFilter","user2","CommitsTableRow","showCommitTimestamp","referencesOnTheLeft","isAuthorVisible","isDateVisible","isHashVisible","highlightStyles","flexBasis","flexGrow","CommitRefs","onLeft","refKey","filteredRefs","headIsOnABranch","aBranch","delay","withPointer","tooltipTriggerProps","unshift","StyledProgressBar","ProgressBar","StyledListItem","ResolvedRefsContext","CommitsTable","currentTabKey","resetFilters","setSelectedCommits","Provider","List","estimatedItemHeight","Consumer","showToggleDefs","highlightToggleDefs","columnToggleDefs","useToggleDef","CommitsTableViewOptionsMenuIconButton","showToggles","highlightToggles","columnToggles","allToggles","toggleKey","StyledSearchInput","SearchInput","searchHistoryState","VcsLogCommitsView","textFilterRef","searchInputRefAtom","setSearchQuery","setUser","resetUser","setDateFilter","resetDate","searchHistory","setSearchHistory","searchInputValue","setSearchInputValue","getActionShortcut","isRegExpOn","isMatchCaseOn","submitSearchQuery","createNewTab","newTabId","uuid","getTabFilterAtom","today","sevenDaysAgo","setDate","yesterday","predefinedDateRanges","inputRef","onBlur","addonAfter","StyledHoverContainer","excludeFromTabOrder","predefinedDateRange","getLocalBranchNodes","shouldGroupByDirectory","localBranchNodes","repos","groupNodesByDirectory","getRemoteBranchNodes","remoteBranchNodes","branchesTreeNodeAtom","branchTreeGroupingAtoms","shouldGroupByRepository","isGroupByRepositoryAvailableAtom","_param","branchesTreeRefAtoms","selectedKeysAtoms","expandedKeysAtoms","searchInputAtoms","availableGroupingsAtom","BranchesGroupByActionButton","branchTreeNodeRenderers","toUpperCase","Group","keyToBranch","_repo","StyledSearchIconContainer","BranchesTree","branchesTreeNodes","searchTerm","setSearchTerm","searchInputRef","isInputFocused","setInputFocused","setBranchFilter","focusProxyRef","showAsFocused","onSearchTermChange","keepSearchActiveOnBlur","hideSpeedSearchPopup","isSearchActive","DELETE_BRANCH_ACTION_ID","SHOW_BRANCH_DIFF_ACTION_ID","SHOW_MY_BRANCHES_ACTION_ID","FETCH_ACTION_ID","TOGGLE_FAVORITE_ACTION_ID","VcsBranchesView","VcsLogBranchesViewToolbar","StyledToolbar","refreshLogAction","copyRevisionNumberAction","useCommitsTableActions","VersionControlToolWindowZeroState","firstViewSizeState","lastViewSizeState","StyledToolWindowHeader","VersionControlToolWindow","tabKeys","activeTabKey","setActiveTabKey","activeKey","onActiveKeyChange","VcsToolWindowTabTitle","VcsTab","StyledExpandStripeButton","StyledShowBranchesButton","StyledShowBranchesButtonText","ShowBranchesButton","firstViewSize","setFirstViewSize","lastViewSize","setLastViewSize","focusTextFilterAction","hideBranchesAction","toggleMatchCaseAction","toggleRegExpAction","toggleDetailsAction","showDiffPreviewAction","useVcsLogsToolWindowActions","showBranches","setShowBranches","firstViewProps","lastViewMinSize","ToolWindowTabContent","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","isSplit","showProgressPanelAtom","tasksPopupBoundsAtom","StyledPopupTitle","TasksPopup","setShowProgressPanel","cancel","bounds","setBounds","Popup","innerWidth","top","innerHeight","onBoundsChange","nonDismissable","interactions","Layout","Header","hasControls","margin","details","secondaryDetails","maxValue","ProgressBarStopButton","StyledVerticalSeparator","StatusBarProgress","dense","namePosition","Spacer","StyledProgressBarButton","Container","StatusBarTaskProgressBar","firstTask","tasksCount","showProgressPanel","small","activeFileRepoRootAtom","activeFile","activeFileRepoBranchesAtom","activeFileRepoRoot","activeFileCurrentBranchAtom","selectAtom","prevValue","activeFileRepoHeadAtom","detached","resolveRef","validateBranchName","newBranchName","ILLEGAL_CHARS_PATTERN","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","labelPlacement","validationMessage","Boolean","StyledTitle","branchesPopupSizeState","BranchesPopup","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","useWindowManager","checkoutBranch","openedFiles","existingOpenedFile","interactionType","PopupLayout","currentBounds","disabledKeys","operation","tryCheckout","Errors","CheckoutConflictError","BalloonActionLink","aRepoRoot","checkoutRemoteBranch","getSectionLabel","compareActions","mergeActions","favoriteBranchArgs","notified","BranchPopupTrigger","gitRepoHead","maybeShowGitCloneTip","useShowGitTipIfNeeded","showSticky","PopupTrigger","onOpenChange","isOpen","popup","StatusBarWidget","StyledLastMessage","IdeStatusBar","cursorPosition","StatusBar","RollbackTreeContextMenu","StyledFrame","contrastBorder","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","windowBounds","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","balloons","setOpen","setDeleteAddedFiles","atLeastOneNewFileSelected","toolWindowsStateAtom","ToolWindowsState","removedFromSideBarIds","showStripeButton","tips","EXPAND_SELECTION","SHRINK_SELECTION","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsAtom","noContentHeight","otherProps","persistBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","ActionItem","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","SHOW_INTENTION_ACTIONS","search","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","getItemText","renderItem","FileItem","dirMatches","filenameMatches","splitWhen","titleMatches","filesSearchContributor","projectFiles","SearchEverywhereActionIds","StyledTab","selected","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","hr","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","selectionManagerRef","setFocusedKey","localActions","currentContributorIndex","contributorActions","_ref16","limit","nextItem","itemWrapper","_ref17","Tabs","TabComponent","TabsComponent","FocusScope","contain","newPattern","newPatternContainsPrevious","onPatternChanged","shouldFocusWrap","_ref18","itemText","gitAddCallback","StyledInput","NewItemPopup","inputName","validationType","hideMessage","setHideMessage","onMouseDown","offset","crossOffset","ValidationTooltip","appearance","createFileActionAtom","popupManager","destinationDir","NewFilePopup","createFile","editorManager","createFileCallback","waitUntil","HTMLTextAreaElement","AddFileToGitWindow","setFilename","setValidationMessage","submit","addToGit","criteria","timeoutInMs","createDirectoryActionAtom","NewDirectoryPopup","createDirectory","dirName","setDirName","validationResult","setValidationResult","updateValidation","asyncCallback","callbackRef","_len2","_key2","useCancelableAsyncCallback","validate","copyFilenameActionAtom","copyAbsolutePathActionAtom","copyPathFromRepositoryRootActionAtom","openSearchEverywhereCallback","useProjectActions","openSearchEverywhere","newFileAction","newDirectoryAction","newElementActionGroup","copyReferencePopupGroup","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","relative","isPathInside","selectedPathsAreDirectories","every","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","changePath","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","AlreadyExistsError","autoSelect","pathsToAddAtom","isIgnored","isUnchangedFile","gitAddDisabledAtom","gitAddActionAtom","pathsToAdd","aPath","gitInitActionAtom","visitedUrlsSchema","option","cloneParentDirSchema","gitRememberedInputsAtom","visitedUrls","cloneParentDir","UrlAndUserName","url","username","gitVisitedUrlsAtom","cloneParentDirAtom","defaultWorkspaceFiles","defaultInitializer","InlinePopup","StyledPopupContainer","ProjectInitializer","autoCloneSampleRepo","cloneProgress","setCloneProgress","setState","ensureSampleRepo","repoUrl","info","isSuccessfullyCloned","cloneRepo","onProgress","initializer","INITIALIZE_APP","projectDir","loaded","phase","round","AlertDialog","heading","buttons","location","reload","clone","http","corsProxy","singleBranch","getInputCursorOffset","caretIndex","selectionStart","inputStyle","getComputedStyle","hiddenSpan","createElement","visibility","whiteSpace","font","paddingLeft","textContent","substring","appendChild","caretOffset","offsetWidth","removeChild","StyledPopover","WINDOW_SHADOW","ListBoxStyledAsMenu","ListBox","MENU_VERTICAL_PADDING","PathInputField","valueProp","onChangeProp","defaultValueProp","useControlledState","isAutocompleteVisible","setAutocompleteVisible","collectionRef","pathSearchQuery","setPathSearchQuery","pathSuggestions","setPathSuggestions","updatePathAutocompletion","setMenuOrigin","clientX","inputClientRect","clientY","wasAutocompleteVisible","usePrevious","pathParts","searchDirectory","canceled","getChildDirectories","suggestions","matchedSuggestions","setSelectionRange","menuOrigin","getBoundingClientRect","CODE_COMPLETION","mergeRefs","inputProps","onKeyDown","shouldFocusOnHover","shouldUseVirtualFocus","gitCloneActionAtom","GitCloneWindow","cloneAnotherRepoActionAtom","urlProp","setUrl","parentDir","setCloneParentDirState","setVisitedUrls","setDirectory","autoFillDirectory","setAutoFillDirectory","showValidationErrors","setShowValidationErrors","urlInputRef","dirInputRef","urlError","removePrefix","trim","sanitizeCloneUrl","URL","SSH_URL_PATTERN","validateRepoUrl","dirError","setDirError","setVcsRoots","onSuccess","useClone","repoName","LabeledControlsAlignmentProvider","dirValidationError","validateCloneDirectory","urls","visitedUrl","ComboBox","onValueChange","str","prefix","useVcsActions","usePopupManager","gitAddAction","gitInitAction","gitCloneAction","cloneAnotherRepoAction","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","useAlertDialog","BalloonManager","disablePortal","SetBalloonManagerRef","UsePersistentFsNotification","ProjectActionProvider","DefaultToolWindows","toolWindowsState","onToolWindowStateChange","windows","useCapture","timeoutId","usePersistenceFsNotification","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateVersionControlWindow","ActivateTerminalWindow","SafeDelete","secondKeyStroke","App","KeymapProvider","WindowManager","PopupManager","webpackAsyncContext","req","__webpack_require__","o","module","exports","ids"],"sourceRoot":""}