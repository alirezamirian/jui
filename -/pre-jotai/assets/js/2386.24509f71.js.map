{"version":3,"file":"assets/js/2386.24509f71.js","mappings":"sRAAA,MCKaA,EACXC,GACGC,EAAAA,cAACC,EAAAA,GAAGC,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEI,IDPrB,iwICOsCC,QCPtC,wtIDOkEN,EAAAO,aAAA,qDEHlE,MAAMC,GAAUC,EAAAA,EAAAA,IAAOT,GAAWU,WAAA,CAAAC,YAAA,2BAAAC,YAAA,gBAAlBH,CAAkB,oCAIrBI,EAAoDC,IAAA,IAAC,SAChEC,EAAWb,EAAAA,cAACM,EAAO,MAAG,SACtBQ,GACDF,EAAA,OAAKZ,EAAAA,cAACA,EAAAA,SAAc,CAACa,SAAUA,GAAWC,EAA0B,EAACH,EAAAN,aAAA,wI,oPCT/D,MAAMU,EAAY,iBACZC,EAAW,eAElBC,EAA2C,CAC/CC,aAAc,qBACdC,GAAI,uBACJC,UAAW,kBACXC,QAAS,oBACTC,GAAI,eACJC,OAAQ,mBACRC,IAAK,gBACLC,IAAK,gBACLC,IAAK,kBACLC,SAAU,qBACVC,KAAM,iBACNC,IAAK,gBACLC,KAAM,iBACNC,IAAK,gBACLC,KAAM,iBACNC,IAAK,gBACLC,KAAM,iBACNC,SAAU,qBACVC,WAAY,uBACZC,IAAK,iBACLC,KAAM,qBACNC,MAAO,kBACPC,IAAK,gBACLC,IAAK,oBACLC,KAAM,kBAGKC,EAAkBC,IAC7B,MAAMC,EAAYC,EAAaF,GAC/B,OAAO3B,EAAiB4B,IAAc9B,CAAS,EAM3C+B,EAAgBF,GACpBA,EAASG,MAAM,KAAKC,OAAS,GAMxB,SAASC,EACdL,EACAM,GAEA,YAFkB,IAAlBA,IAAAA,EAAqBC,IAAAA,KAEdC,EAAwBR,EAAUM,EAC3C,CAEA,SAASE,EACPR,EACAM,EACAG,QAAuB,IAAvBA,IAAAA,EAA0B,IAE1B,MAAMC,EAAUH,IAAAA,QAAaP,GAC7B,OAAIU,IAAYJ,EACP,CAACI,GAASC,OACfH,EAAwBE,EAASJ,EAAYG,IAG1CA,CACT,C,qBC3DMG,E,6uPACJC,GAAwBC,SAAQ9C,IAAA,IAAC,MAAE+C,EAAK,SAAEC,GAAUhD,EAAA,MACjD,GACE2C,OAAOI,GACPD,SAASC,GAAUA,EAAMZ,MAAM,OAC/Bc,KAAKC,IACJ,MAAMC,EAAiC,CACrCD,SAQF,OANAE,OAAOC,KAAKL,GAAUM,SAASC,IAC7B,MAAMC,EAAQR,EAASO,GACnBC,IACFL,EAAOI,GAAgCC,EACzC,IAEKL,CAAM,GACb,ICnBKM,GAAe9D,EAAAA,EAAAA,IAAO+D,EAAAA,QAAc;;;;;;;;;;;EAqBpCC,EAAUxE,IACrB,MAAMyE,EDAsBC,MAC5B,MAAMC,GAASC,EAAAA,EAAAA,aACTC,GAAQC,EAAAA,EAAAA,OACPC,EAAWC,IAAgBC,EAAAA,EAAAA,UAChCJ,EAAMK,KAAO,UAAY,SAoC3B,OAlCAC,EAAAA,EAAAA,kBAAgB,KACd,GAAIR,EAAQ,CACV,MAAMS,EAAQ,aAAYP,EAAMO,KAAKC,QAAQ,IAAK,MAC5CC,EAAeT,EAAMK,KAAO,UAAY,OAC9CP,EAAOY,OAAOC,YAAYJ,EAAM,CAC9BK,KAAMZ,EAAMK,KAAO,UAAY,KAC/BQ,SAAS,EAGTC,OAAQd,EAAMK,KACV,CAEE,oBAAqB,UACrB,iCAAkC,UAClC,8BAA+B,UAC/B,oCAAqC,UACrC,+BAAgC,UAChC,qCAAsC,UACtC,0BAA2BL,EAAMK,KAAO,UAAY,UACpD,qCAAsCI,EACtC,qCAAsCA,EACtC,qCAAsCA,EACtC,qCAAsCA,EACtC,gCAAiC,UACjC,4BAA6B,aAE/B,CAAC,EAELM,MAAOnC,IAETuB,EAAaI,EACf,IACC,CAACT,EAAQE,IAELE,CAAS,ECxCIL,GAEpB,OACEzE,EAAAA,cAACqE,GAAYnE,EAAAA,EAAAA,GAAA,GACPH,EAAK,CACT6F,QACE,CACEC,QAAS,CAAEC,SAAS,GACpBC,WAAY,GACZC,oBAAqB,SACrBC,OAAQ,CACNC,aAAa,GAEfC,qBAAqB,EACrBC,WAAY,iBACZC,SAdS,GAeTC,UAAW,CACTC,sBAAuB,GACvBC,wBAAyB,EACzBC,mBAAoB,EACpBC,qBAAsB,EACtBC,WAAY,OACZC,SAAU,UACVC,yBAAyB,MAExB9G,EAAM6F,SAGbhB,MAAOJ,IACP,EAEJD,EAAAlE,aAAA,yX,4DC/BKyG,eAAeC,GAAkBC,QAAS,IAATA,IAAAA,EAAY,gBAClD,MAAMC,QAAcC,IAAiBC,IACnCC,EAAAA,WAAqBC,UAAUC,OAAO,CAAEN,aAAaG,EAAG,IAS1D,aADM,IAAII,SAASC,GAAYP,EAAMQ,KAAKR,EAAMS,MAAOF,KAChDP,CACT,CAEO,SAASU,GAAaC,GAC3BR,EAAAA,WAAqBQ,GACrB,MAAMC,EAAMT,EAAAA,WAAqB,MAYjC,OATAS,EAAIC,SAAWC,KAAK,IACfF,EAEHG,OAAQA,CACNC,EACAd,IACGU,EAAIG,OAAOC,GAAW7D,GAAU+C,EAAG,KAAM/C,OAGzCyD,CACT,CAEO,MAAMK,GAAYC,IACvB,MAAMC,EAAK,IAAKhB,EAAAA,WAAqB,MAAQ,IAE7C,OADAgB,EAAGC,WAAWF,GACPC,CAAE,EAGX,SAASlB,GACPoB,GAEA,OAAO,IAAIf,SAAQ,CAACC,EAASe,KAC3BD,GAAG,CAACE,EAAKJ,KACP,GAAII,IAAQJ,EACV,OAAOG,EAAOC,GAEhBhB,EAAQY,EAAG,GACX,GAEN,C,gBCpCA,MAAMK,IAAoBC,EAAAA,GAAAA,KAAI,UAC5BC,EACAC,GAQA,MAAM,OAAEC,EAAM,OAAEC,EAAM,QAAEC,EAAO,OAAEC,EAAM,MAAEC,GAAUL,EAC7CM,QAAcL,EAAOM,QAAQJ,GAInC,IAAK,MAAM5D,KAAQ+D,EAAO,CACxB,MAAME,EAAWjG,IAAAA,KAAU4F,EAAS5D,GAC9BkE,QAAaR,EAAOQ,KAAKD,GAC/B,GAAIC,EAAKC,UAAYD,EAAKE,iBAAkB,CAC1C,IAAKN,UAAgBO,GAAWV,EAAQM,IACtC,OAEFJ,IAASI,GACT,MAAMK,QAAgBZ,EAAOa,SAASN,SAChCO,GAAUb,EAAQ3F,IAAAA,QAAaiG,UAC/BN,EAAOc,UAAUR,EAAUK,EACnC,MAAWJ,EAAKQ,oBACRpB,GAAkBE,EAAc,IACjCC,EACHG,QAAS5F,IAAAA,KAAU4F,EAAS5D,KAG9B2E,QAAQC,KAAK,sDAAuDV,EAExE,CACF,IACMG,GAAa1C,MAAOsB,EAAmBxF,UACtBwF,EAAGJ,OAAOpF,YAENwF,EAAGiB,KAAKzG,IAAWiH,cAOvC/C,eAAe6C,GAAUvB,EAAmB4B,GACjD,MAAMX,QAAajB,EAChBiB,KAAKW,GACLC,OAAOC,GAAkB,WAAXA,EAAEC,MAA4B5C,QAAQgB,OAAO2B,KAC9D,IAAa,IAATb,EAAgB,CAElB,MAAM/F,EAAUH,IAAAA,QAAa6G,GACzB1G,IAAYH,IAAAA,QAAaG,UAErBqG,GAAUvB,EAAI9E,SAEhB8E,EACHgC,MAAMJ,GAENC,OAAOC,GACK,WAAXA,EAAEC,KAAoB5C,QAAQC,UAAYD,QAAQgB,OAAO2B,IAE/D,MAAO,IAAKb,EAAKQ,cACf,MAAM,IAAIQ,MAAO,gDAA+CL,IAEpE,CAOO,MAAMX,GAAQiB,GACnBlC,GAAGN,SAASuB,KAAKiB,GAAUL,OAAM,IAAM,OCnGlC,IAAI7B,GAEX,MAOamC,IAPqCpG,GAQhD,6BAR2D,CAC3DqG,IAAKA,IAAMC,aAAaC,QAAQvG,IAChCwG,IAAMvG,GAAgBqG,aAAaG,QAAQzG,GAAKC,KAFAD,OAkC3C2C,eAAe+D,GAAoBC,GAMjC,IANkC,OACzC9B,EAASc,QAAQiB,IAAG,aACpBpC,QAID,IAAAmC,EAAG,CAAC,EAACA,EACJ,KAVO1C,GAAG4C,sBAAuB5D,EAAAA,WAAqB6D,UAYpD,YADAnB,QAAQiB,IAAI,4CAGdjB,QAAQiB,IAAI,yBACZjB,QAAQoB,KAAK,eACb,MAAMC,QAA2BpE,WDtC5BD,eAAqBlG,GAKV,IALW,OAC3BiI,EAAM,OACNC,EAAM,aACNH,KACGyC,GACUxK,QACP6H,GAAkBE,EAAc,IACjCyC,EACHvC,OAAQd,KAAKc,GACbC,OAAQf,KAAKe,GACbC,QAAS,KAEb,CC4BQsC,CAAO,CACXxC,OAAQT,GACRU,aAAcZ,GAASiD,GACvBxC,eACAM,OAAO,EACPD,WAEFc,QAAQwB,QAAQ,eAEhB3D,GAAawD,GAEbrB,QAAQiB,IAAI,mCAAoCI,EAClD,CAEA,MAAMI,GAgBN,SAAwBC,GACtB,IACIC,EADAC,EAAS,UAGb,MAAMC,EAAYH,EAAQI,MACvBC,IACCH,EAAS,UACTD,EAAWI,CAAG,IAEfrD,IACCkD,EAAS,QACTD,EAAWjD,CAAG,IAclB,MAAO,CAAEsD,KAXIA,KACX,OAAQJ,GACN,IAAK,UACH,MAAMC,EACR,IAAK,QACH,MAAMF,EACR,QACE,OAAOA,EACX,EAIJ,CA1CmBM,EA/CgB,QAAjCxB,GAAuBC,MACnBzD,KFZCD,iBACL,aAAaI,IAAiBC,IAC5BC,EAAAA,WAAqB6D,SAAS3D,OAAO,CAAC,EAAGH,EAAG,GAEhD,CESM6E,IAEHJ,KAAKjE,IACLiE,MAAMK,IACJC,OAAe9D,GAAK6D,EACb7D,GAAK6D,KAEdhC,OAAOC,IAEN,MADAJ,QAAQiB,IAAI,2BAA4Bb,GAClCA,CAAC,KA0CEiC,GAAsDvL,IAE5D,IAF6D,SAClEE,GACDF,EAEC,OADA2K,GAAWO,OACJhL,CAAQ,ECjEV,MAAMsL,IAAkBC,EAAAA,EAAAA,IAAe,CAC5ClI,IAAK,cACLqG,IAAMrH,GAAiB2D,UACrB,IAAIwF,EACJ,IACEA,QAAkBlE,GAAGN,SAASqB,QAAQhG,EACxC,CAAE,MAAO+G,GACP,OAAO,IACT,CACA,MAAMqC,QAAchF,QAAQiF,IAC1BF,EAAUzI,KAAK4I,IACb,MAAMxE,EAAY,GAAE9E,KAAQsJ,IAC5B,OAAOrE,GAAGN,SAASuB,KAAKpB,GAAU2D,MAAMvC,IAAW,IAC9CA,EACHqD,KAAMrD,EAAKQ,cAAiB,MAAmB,OAC/C5B,cACC,KAGP,OAAOsE,EAAM1I,KAAKwF,IAAI,CACpBqD,KAAMrD,EAAKqD,KACXvH,MAAMwH,EAAAA,EAAAA,UAAStD,EAAKpB,UACpB9E,KAAMkG,EAAKpB,SACX2E,iBAAkBvD,EAAKwD,QACvBC,KAAMzD,EAAKyD,QACV,IAUMC,GACXnM,IAAA,IAAC,MAAEoM,EAAK,QAAEC,GAA4BrM,EAAA,OACtCkG,UACEmG,EAAQC,GAAwB/J,IAChC6J,EAAMG,GAAiBhK,GAAM,CAC9B,EAEG+J,IAA0Bb,EAAAA,EAAAA,IAAe,CAC7ClI,IAAK,kBACLqG,IAAM5H,GAAiCkE,UACrC,IAAKlE,EACH,MAAO,GAGT,aADqBwF,GAAGN,SAASE,OAAOpF,GAKjCwF,GAAGN,SAAS4B,SAAS9G,EAAU,CAAEwK,SAAU,SAHzC,IAGkD,IAmBlDD,IAAmBE,EAAAA,EAAAA,IAA8C,CAC5ElJ,IAAK,cACLmJ,QAASJ,GACTK,QAAU3K,GAAa,CACrB4K,IAAgB,IAAf,MAAEC,GAAOD,EACRC,GAAM3G,UACAlE,SAAmBwF,GAAGN,SAASE,OAAOpF,IAExCwF,GAAGN,SACA8B,UAAUhH,EAAU6G,GAAW,GAAI,QACnCQ,OAAOC,IACNJ,QAAQ4D,MAAM,yCAA0CxD,EAAE,GAEhE,GACA,K,gBC3CD,SAASyD,GACdC,GAEA,MAAOC,EAAOC,IAAY9I,EAAAA,EAAAA,UAAmB,MAC7C,IAAI+I,GAAWC,EAAAA,EAAAA,IAAuBJ,GAQtC,OANAK,EAAAA,EAAAA,YAAU,KACe,aAAnBF,EAASF,OACXC,EAASC,EAASG,SACpB,GACC,CAACH,IAEG,CACc,aAAnBA,EAASF,MAAuBE,EAASI,WAAaN,EACtDE,EAASF,MAEb,CAQO,SAASO,GACdR,GAEA,MAAOC,EAAOC,IAAY9I,EAAAA,EAAAA,UAAmB,MAC7C,IAAI+I,GAAWC,EAAAA,EAAAA,IAAuBJ,IAEtCK,EAAAA,EAAAA,YAAU,KACe,aAAnBF,EAASF,OACXC,EAASC,EAASG,SACpB,GACC,CAACH,IAEJ,MAAM3J,EAA2B,aAAnB2J,EAASF,MAAuBE,EAASI,WAAaN,EAEpE,GAAc,OAAVzJ,EACF,MAAM2J,EAASM,YAEjB,MAAO,CAACjK,EAAO2J,EAASF,MAC1B,CAiBO,SAASS,GACdC,EACAC,GAEA,OAAOC,EAAAA,EAAAA,KACL7N,IAAA,IAAC,SAAE8N,GAAU9N,EAAA,MACX,IACE8N,EAASC,YAAYJ,GAAaJ,YAAcK,CAAY,GAChE,GAEJ,CCtIO,MAAMI,GAAahO,IAAA,IAAC,KAAEuC,GAAcvC,EAAA,OACxCuC,EAAKJ,MAAM,KAAK8L,SAAS,OAAO,ECuBtBC,GACL,iBADKA,GAEN,2CAGMC,GAAiB,CAC5B5J,KAAM,YACNhC,KAAM,cAEK6L,IAAsBC,EAAAA,EAAAA,IAAc,CAC/C9K,IAAK,UACLmJ,QAASyB,KAGEG,IAAkB7C,EAAAA,EAAAA,IAAe,CAC5ClI,IAAK,kBACLqG,IACG2E,GACDvO,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OACNuC,IAAAA,KAAUqH,EAAIwE,IAAqB7L,KAAMgM,EAAoB,IAGtDC,IAA2BC,EAAAA,EAAAA,IAAS,CAC/ClL,IAAK,wBACLqG,IAAK1D,UAA8C,IAAvC,IAAE0D,GAAKgD,EACjB,MAAM8B,EAAU9E,EAAIwE,IACpB,OAAOxE,EAAI+E,GAAkBD,EAAQnM,MAAM,IAIlCoM,IAAoBlD,EAAAA,EAAAA,IAAe,CAC9ClI,IAAK,gBACLqG,IAEIgF,GAEF1I,UAA8C,IAAvC,IAAE0D,GAAKiF,EACZ,MAAMvG,EAAQsB,EAAI4B,GAAgBoD,IAC5BE,EAAyB,GACzBC,EAAWC,IACf,GAAkB,QAAdA,EAAKlD,MACP,GAAIkC,GAAWgB,GAAO,CACpB,MAAMC,EAAarF,EAAI4B,GAAgBwD,EAAKzM,OACxC0M,GACFA,EAAW3L,QAAQyL,EAEvB,OAEAD,EAAMI,KAAK,IACNF,EACHG,aAAc5M,IAAAA,SAAcqM,EAAaI,EAAKzM,OAElD,EAGF,OADC+F,GAAS,IAAIhF,SAAS0L,GAASD,EAAQC,KACjCF,CAAK,IAILM,GAAgCA,KAC3CC,EAAAA,EAAAA,GAA4Bb,IA0BjBc,IAAmBjB,EAAAA,EAAAA,IAAe,CAC7C9K,IAAK,sBACLmJ,QAAS,KAGE6C,IAAwBd,EAAAA,EAAAA,IAAS,CAC5ClL,IAAK,+BACLqG,IAAK4F,IAAA,IAAC,IAAE5F,GAAK4F,EAAA,OAAK5F,EAAI0F,IAAkBG,OAAS,CAAC,IAOvCC,GFhH6BC,EACxC1C,EACA2C,KAEA,IAAIC,EAAiC,KACrC,OAAO,SAACrM,EAAUe,QAAY,IAAZA,IAAAA,EAAe,WAC/B,MAAMuL,GAAWC,EAAAA,EAAAA,IAAkB9C,GAC7B+C,GAAaC,EAAAA,EAAAA,UAQnB,OAPA5C,EAAAA,EAAAA,YAAU,KACJwC,IAAmBG,EAAWE,SAChCJ,GAAUK,IACRC,EAAAA,GAAAA,GAAO5M,EAAO2M,GAAgBA,EAAe3M,GAEjD,GACC,CAACA,IACG,CACL6M,QAAU/G,IACR0G,EAAWE,QAAU5G,EAAEgH,cACvBT,EAAiBvG,EAAEgH,cACnBR,EAAStM,EAAM,EAEjB+M,OAASjH,IAELA,EAAEkH,yBAAyBC,SAC3BnH,EAAEkH,eAAeE,QAAQ,0CAY3BZ,EAASF,EAAU,EAGzB,CAAC,EEyEmCD,CACpCL,GACA,IAaWqB,IAA8BtC,EAAAA,EAAAA,IAEzC,CACA9K,IAAK,uBACLmJ,SAASkE,EAAAA,EAAAA,aACTC,4BAA4B,IAGjBC,IAAwBzC,EAAAA,EAAAA,IAEnC,CACA9K,IAAK,wBACLmJ,SAASkE,EAAAA,EAAAA,aACTC,4BAA4B,IAGjBE,IAAsB1C,EAAAA,EAAAA,IAEjC,CACA9K,IAAK,sBACLmJ,SAASkE,EAAAA,EAAAA,aACTC,4BAA4B,IC5IxBG,IAA4BvC,EAAAA,EAAAA,IAAS,CACzClL,IAAK,sBACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OACXiR,EAAAA,EAAAA,GACE,EAEEC,EAAAA,EAAAA,IAASC,GAASA,EAAK5O,OAASqH,EAAI0E,GAAgB,iBACpD4C,EAAAA,EAAAA,IAASC,GAASA,EAAK5O,KAAK6O,SAAS,UACrCF,EAAAA,EAAAA,IAASC,GAASA,EAAK5O,KAAK6O,SAAS,UAEvCxH,EAAI4E,IAA0B6C,QAAQrC,GAAuB,SAAdA,EAAKlD,QAEnDuF,QAAQF,IAAUA,EAAK5O,KAAK0L,SAAS,WACrCqD,MAAM,EAAG,IAETrO,KAAKkO,IAAI,CACR9J,SAAU8J,EAAK5O,KACfgP,YAAa,CAAEC,UAAW,CAAEC,WAAY,EAAGC,OAAQ,OAClD,IAIIC,IAAkBtD,EAAAA,EAAAA,IAAoC,CACjE9K,IAAK,cACLmJ,QAAS,GACTC,QAAS,CACPC,IAAuC,IAAtC,WAAEgF,EAAU,QAAEC,EAAO,QAAEC,GAASlF,EAIf,QAAZkF,GACFF,EAAWZ,IAA2BhG,MAAM+G,GAASF,EAAQE,IAC/D,KAKAC,IAA4B3D,EAAAA,EAAAA,IAAa,CAC7C9K,IAAK,wBACLmJ,QAAS,IAGEuF,IAAuBxD,EAAAA,EAAAA,IAAgC,CAClElL,IAAK,mBACLqG,IAAKiF,IAAc,IAAb,IAAEjF,GAAKiF,EACX,MAAMkD,EAAOnI,EAAI+H,IACjB,OAAOI,EAAKnI,EAAIoI,MAA+BD,EAAK,IAAM,IAAI,IAIrDG,IAA4B7D,EAAAA,EAAAA,IAAe,CACtD9K,IAAK,wBACLmJ,QAAS,IAAIyF,EAAAA,GAAS,EAAG,KAOdC,IAAiB/D,EAAAA,EAAAA,IAAuB,CACnD9K,IAAK,qBACLmJ,QAAS,OAYL2F,GACJ7C,IAAA,IAAC,SAAE1B,EAAQ,IAAE/D,GAAwByF,EAAA,OACrC,SAACnI,EAAkBiL,QAAW,IAAXA,IAAAA,GAAc,GAC/B,MAAMC,EAAYzE,EAASC,YAAY4D,IAAiBpE,WAClDiF,EAAQD,EAAUE,WAAWC,GAAQA,EAAIrL,WAAaA,IACtDsL,EAAUH,IACdzI,EAAIiI,GAA2BQ,EAAM,EAEjCI,EAAQA,KACZ9E,EAASC,YAAYqE,IAAgBS,gBAAgBD,OAAO,EAE9D,GAAIJ,GAAS,EACXG,EAAOH,OACF,CACL,MAAMM,EAAWP,EAAU9C,OAC3B1F,EAAI4H,IAAkBoB,GAAiB,IAClCA,EACH,CACE1L,WACAkK,YAAa,CAAEC,UAAW,CAAEC,WAAY,EAAGC,OAAQ,QAGvDiB,EAAOG,EACT,CACIR,GAGFU,WAAWJ,EAEf,CAAC,EAEGK,GACJC,IAAA,IAAC,IAAEnJ,GAAwBmJ,EAAA,OAC1BV,GACCzI,EAAI4H,IAAkBY,GACpBA,EAAUlB,QAAO,CAAC8B,EAAGC,IAAaA,IAAaZ,KAChD,EAECa,GACHC,GAA0CjM,IACzC,MAAM,IAAE0C,EAAG,SAAE+D,EAAQ,kBAAEyF,GAAsBD,EACvCE,EAAQP,GAAcK,GACtBd,EAAQ1E,EACXC,YAAY4D,IACZpE,WACAkF,WAAWC,GAAQA,EAAIrL,WAAaA,IACnCmL,GAAS,GACXe,GAAkB,KAChBC,EAAMhB,GACNzI,EAAIiI,GAA2ByB,KAAKC,IAAIlB,EAAQ,EAAG,GAAG,GAE1D,EAGEmB,GACJC,IAAA,IAAC,IAAE7J,GAAwB6J,EAAA,OAC1BpB,IACCzI,EAAI4H,IAAkBY,GACpBA,EAAUlB,QAAO,CAAC8B,EAAGC,IAAaA,IAAaZ,KAChD,CACF,EACGG,GACJkB,IAAA,IAAC,IAAE9J,EAAG,SAAE+D,GAA6B+F,EAAA,OACpCrB,IACC,MAAMsB,EAAUhG,EAASC,YAAY4D,IAAiBpE,WAAWkC,OAC7D+C,GAAS,GAAKA,EAAQsB,GACxB/J,EAAIiI,GAA2BQ,EACjC,CACD,EAEGI,GACJmB,IAAA,IAAC,SAAEjG,GAA6BiG,EAAA,MAChC,KACEjG,EAASC,YAAYqE,IAAgBS,gBAAgBD,OAAO,CAC7D,EAEUoB,IAAqBvF,EAAAA,EAAAA,IAA2C,CAC3ElL,IAAK,iBACLqG,IAAKqK,IAAsB,IAArB,YAAEC,GAAaD,EACnB,MAAO,CAELE,SAAUD,EAAY7B,IACtB+B,SAAUF,EAAYjB,IACtBoB,UAAWH,EAAYb,IACvBiB,eAAgBJ,EAAYP,IAC5BhB,OAAQuB,EAAYvB,IACpBC,MAAOsB,EAAYtB,IACpB,IAQQ2B,GAAwBA,KACnCC,EAAAA,EAAAA,IAAeR,IC5IV,SAASS,GACd3J,GAGA,OAAI4J,MAAMC,QAAQ7J,GACE,IAAdA,EAAO,GACD,CAAC,UAAW,cAAe,YAAsBA,EAAO,IAEhD,IAAdA,EAAO,GACS,IAAdA,EAAO,GACF,UAEA,QAGJ,UAEM,aAAXA,GAAoC,cAAXA,EACpB,WAEM,YAAXA,GAAmC,aAAXA,EACnB,UAEM,UAAXA,EACK,QAEM,eAAXA,EACK,cAEF,SACT,C,2BChFO,MAAM8J,GAAkBC,GAC7BH,MAAMC,QAAQE,GAASA,EAAQA,EAAQ,CAACA,GAAS,GCG5C,IAAKC,GAAY,SAAZA,GAAY,OAAZA,EAAY,kCAAZA,CAAY,MAajB,SAASC,GAAoB/U,GAOA,IAPO,cACzCgV,EAAa,OACbC,EAAM,KACN/J,EAAI,OACJgK,EAAM,YACNC,EAAcL,GAAaM,eAAc,QACzCC,EAAU,CAACF,EAAaH,GAAeM,KAAK,MACbtV,EAC/B,OAAOuV,EAAAA,GAAAA,IAAc,CACnBC,SAAU,mBACVH,UACAI,aAAa,EACbvK,KAAMhF,UAAyC,IAAhCgF,KAAMwK,GAAoB9I,EACvC,OAAO1B,QAAYwK,EAAmBL,GAAe,EAEvDM,MAAOzP,MAAA2I,EAAwBrL,KAAW,IAA5B,MAAEmS,EAAK,KAAEzK,GAAM2D,EAGrBrL,aAAiBoS,EAAAA,IACrBD,EAAMN,EAASH,EAAO1R,GACxB,EAEFyR,UAEJ,CAcAF,GAAqBc,OAASrG,IAAA,IAAO,WACnCsG,EAAU,KACV5K,EAAI,OACJgK,KACGa,GAG6BvG,EAAA,OAChCuF,GAAwD,IACnDgB,EACHV,QAAS,CAACU,EAAKZ,YAAaY,EAAKf,cAAec,GAAYR,KAAK,KACjEpK,KAAOlI,GACEkI,EACL0J,GAAY5R,GAAU6S,SAASG,MAC5BhH,GAASA,EAAK,WAAa8G,KAIlCZ,OACG1R,GACAyS,IACQ,CACLJ,OAAQjB,GAAYqB,GAAiBJ,QAAQ5S,KAAK4S,IAChD,MAAMK,EAAUhB,EAAO1R,EAAP0R,CAAcW,GAS9B,OARA3M,QAAQiB,IACL,YAAW2L,IACZ,kBACAG,EACA,UACAC,GAGKL,EAAO,WAAaC,EACvB,CACE,QAASA,KACNI,GAELL,CAAM,OAIlB,E,gBCrEJ,MAYMM,IAA6BC,EAAAA,GAAAA,KACjCC,EAAAA,GAAAA,IAAO,CACLC,KAAKC,EAAAA,GAAAA,MACLC,KAAKC,EAAAA,GAAAA,KAAMC,EAAAA,GAAAA,IAAQ,WAIVC,IAAgBtI,EAAAA,EAAAA,IAAyC,CACpE9K,IAAK,WACLoJ,QAAS,CACPoI,GAGE,CACAI,YAAa,UACbF,OAAQkB,GACRnB,cAAe,uBAEf9J,KAAO0L,IACL,MAAMC,EAAWjC,GAAYgC,GAAaE,UAAU7T,KAAK+L,IAAI,CAC3DsH,IAAKtH,EAAK,cACVwH,IAAKxH,EAAK,YAEZ,OAAO6H,EAASpH,OAAS,EAAIoH,EAAWE,IAAkB,EAE5D7B,OACG1R,GACA2M,IAAY,IACPA,GAAgB,CAAC,EACrB2G,QAAStT,EAAMP,KAAI2J,IAAA,IAAC,IAAE4J,EAAG,IAAEF,GAAK1J,EAAA,MAAM,CACpC,aAAc0J,EACd,OAAQE,EACT,WAMLO,GAAmBA,IACvBpQ,QAAQiF,IACN,CAAC,iBAAkB,cAAc3I,KAAIiD,UAEnC,SADqBsB,GAAGN,SAASE,OAAOkP,GAEtC,OAAOU,EAAAA,GAAAA,SAAa,CAAExP,GAAE,GAAExF,SAAUsU,IAAOjN,OAAM,IAAM,MACzD,KAEF2B,MAAMiM,GACC,IAAI,IAAIC,IAAID,EAAM5F,OAAO8F,GAAAA,KAAWlU,KACxCqT,IAAG,CACFA,MACAE,IAAK,YAQAY,IAAiB3L,EAAAA,EAAAA,IAAsC,CAClElI,IAAK,iBACLqG,IACG5H,GACD6M,IAAc,IAAb,IAAEjF,GAAKiF,EASN,OAAOwI,EAAAA,EAAAA,IAAS,CAAE7P,GAAE,GAAExF,aAAYqH,OAAM,IAAM,MAAK,IAQnDiO,GAAwBpR,UAC5BgD,QAAQoB,KAAM,gBAAeiN,KAC7B,MAAMC,QAAaC,EAAAA,EAAAA,IAAa,CAAEjQ,GAAE,GAAE8O,IAAKiB,IAC3CrO,QAAQwB,QAAS,gBAAe6M,KAChC,MAAMG,EAAqB,CAAC,EAI5B,OAHAF,EAAKlU,SAASqU,IACZD,EAAOC,EAAI,IAAMlD,GAAiBkD,EAAI,IAEjCD,CAAM,EAgBFE,IAAkBnL,EAAAA,EAAAA,IAA+B,CAC5DlJ,IAAK,iBACLoJ,QAAU4K,GAAoB,CAC5B/H,IAAkB,IAAjB,QAAEqC,GAASrC,EACVqC,EAAQyF,GAAsBC,GAAS,KAKhCM,IAA0BxJ,EAAAA,EAAAA,IAAc,CACnD9K,IAAK,0BACLmJ,SAAS,IAaEoL,IAAkBrM,EAAAA,EAAAA,IAAmC,CAChElI,IAAK,iBAKLqG,IACG5H,GACDkE,UAAoB,IAAb,IAAE0D,GAAKsJ,EACZ,MAAM6E,EAAWnO,EAAIwN,GAAepV,IACpC,GAAI+V,EAAU,CACZ,MAAM5I,EAAe5M,EAAAA,SAAcwV,EAAU/V,GACvCgW,EAAapO,EAAIgO,GAAgBG,IAOvC,OANKC,EAAW7I,IACdjG,QAAQiB,IACN,kEACAnI,GAIFgW,EAAW7I,IACXsF,QAhKKvO,WAG+B,IAHxB,SACpBlE,KACG+T,GACmC/V,EACtC,OAAOgX,EAAAA,GAAAA,aACS,IAAKjB,EAAMkC,UAAW,CAACjW,KACpCgJ,MAAMwM,GAASA,EAAK,IAAG,EA2JV1M,CAAO,CACXtD,GAAE,GACF8O,IAAKyB,EACL/V,SAAUmN,IAIlB,CACA,MAAO,aAAa,IAIb+I,GACXtE,IAAA,IAAC,IAAE7J,EAAG,SAAE+D,GAA6B8F,EAAA,OACrC,MAIA1N,IACE,MAAM6R,EAAWjK,EAASC,YAAYqJ,GAAe5O,IAAW+E,WAChE,GAAIwK,EAAU,CACZ,MAAM5I,EAAe5M,EAAAA,SAAcwV,EAAUvP,GACvCgP,QAAaR,EAAAA,GAAAA,aAAiB,CAClCxP,GAAE,GACF8O,IAAKyB,EACLE,UAAW,CAAC9I,KAEdpF,EAAI6N,GAAgBG,IAAYI,IAC9B,MAAMC,EAAe,IAChBD,GASL,OAPoB,IAAhBX,EAAK/H,eAEA2I,EAAajJ,GAEtBqI,EAAKlU,SAASqU,IACZS,EAAaT,EAAI,IAAMlD,GAAiBkD,EAAI,IAEvCS,CAAY,GAEvB,CACD,GAEUC,GAAuBA,KAEbxK,EAAAA,EAAAA,IAAkBqK,IAE5BI,GAAyBA,KACpCzK,EAAAA,EAAAA,KACEgG,IAAA,IAAC,SAAE/F,EAAQ,IAAE/D,GAAwB8J,EAAA,OACnC3N,UACE6D,EAAI8N,IAAyB,GAC7B,IACE,MAAMU,QAAgBzK,EAAS8D,WAAW+E,UACpChQ,QAAQiF,IACZ2M,GAAStV,KAAI8Q,IAAA,IAAC,IAAEuC,EAAG,IAAEE,GAAKzC,EAAA,OACxBuD,GAAsBhB,GAAKtL,MAAMgN,IAC/BjO,EAAI6N,GAAgBtB,GAAM0B,EAAW,GACrC,IAGR,CAAC,QACCjO,EAAI8N,IAAyB,EAC/B,EACD,GACH,ICtPSW,GAAkB1N,IAC7B,MAAM9G,GAAQC,EAAAA,EAAAA,MACd,OAAQ6G,GACN,IAAK,WACH,OAAO9G,EAAMK,KAAO,UAAY,UAClC,IAAK,QACH,OAAOL,EAAMK,KAAO,UAAY,UAClC,IAAK,UACH,OAAOL,EAAMK,KAAO,UAAY,UAClC,IAAK,UACH,OAAOL,EAAMK,KAAO,UAAY,UAEpB,EAOLoU,GAGRzY,IAA6B,IAA5B,SAAEE,EAAQ,SAAE8B,GAAUhC,EAC1B,MAAM0Y,EAT2B1W,KACjC,MAAO2W,GAAc5L,GAAqB+K,GAAgB9V,IAC1D,OAAOwW,GAAeG,GAAc,cAAc,EAOpCC,CAAmB5W,GACjC,OAAO5C,EAAAA,cAAA,QAAMyZ,MAAO,CAAEH,UAAUxY,EAAgB,EAGrC4Y,GAGRlM,IAA2B,IAA1B,SAAE1M,EAAQ,OAAE4K,GAAQ8B,EACxB,MACM8L,GADQzU,EAAAA,EAAAA,MACM8U,uBAAuBP,GAAe1N,IAC1D,OAAO1L,EAAAA,cAAA,QAAMyZ,MAAO,CAAEH,UAAUxY,EAAgB,EAChDuY,GAAAhZ,aAAA,0DAAAqZ,GAAArZ,aAAA,sD,4BCjCK,MAAMuZ,GAA0D,CACrExV,MAAO,MAGF,SAASyV,KACdD,GAAmBxV,OAAO0V,KAAK,CAC7BC,KAAM,UACNC,MAAO,uBACPC,KAAM,sCACNC,QACEla,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACma,GAAAA,EACC,CACAC,QAASP,IACV,kBAMT,C,4BCrBA,MAAMQ,GAAkB9Z,EAAAA,GAAO+Z,IAAIC,MAAM,CAAEvG,UAAW,GAAK;;;;;;;;EAUrDwG,GAAaja,EAAAA,GAAO+Z,GAAI;;;;EAMxBG,GAAiBla,EAAAA,GAAO+Z,GAAI;WACvB1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAaC,qBAAqB;EAG3D,SAASC,KACd,OACE5a,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAAC6a,GAAS,CAACC,SAAUC,GAAAA,EAAeC,aACpChb,EAAAA,cAAC6a,GAAS,CAACC,SAAUC,GAAAA,EAAeE,eAG1C,CAEA,SAASJ,GAASrN,GAAsC,IAArC,SAAEsN,GAAgCtN,EACnD,MAAM0N,GAAcC,EAAAA,GAAAA,KACdC,GAASC,EAAAA,EAAAA,IAAUP,GACzB,OACE9a,EAAAA,cAACwa,GAAU,KACRY,GAAQpB,MACTha,EAAAA,cAACya,GAAc,KAAES,EAAYJ,IAGnC,CAACF,GAAAva,aAAA,0D,uCC9CM,MAAMib,GACK,gBADLA,GAED,WCFCC,GAAkB,CAC7BC,cAAe,eACfC,0BAA2B,0BAC3BC,mBAAoB,mBACpBC,oBAAqB,gBACrBC,qBAAsB,iBACtBC,qBAAsB,iBACtBC,qBAAsB,iBACtBC,qBAAsB,iBACtBC,qBAAsB,iBACtBC,gBAAiB,iBACjBC,4BAA6B,4BAC7BC,qBAAsB,qBACtBC,sBAAuB,sBACvBC,eAAgB,gBAChBC,uBAAwB,sBACxBC,8BAA+B,iCC6OjC,SAAS1T,GAAO2T,GACd,OAAKA,EAAQC,MAGND,EAAQC,OAAO/P,MAAMmC,SAAS,OAAS,WAAa,QAFlD,EAGX,CCrNA,MAAM6N,IAAkBrN,EAAAA,EAAAA,IAAS,CAC/BlL,IAAK,cACLqG,IAAK5J,IAAc,IAAb,IAAE4J,GAAK5J,EACX,MAAM+b,EAAkBnS,EAAIqI,IAC5B,MAAO,IACF8J,EACHlT,QAASe,EAAI2C,GAAiBwP,GAAiB1U,WAChD,IASQ2U,GAAaA,KACxB,MAAOC,EAAYC,GXwIZ,EACL1H,EAAAA,EAAAA,IAAe7C,KACf6C,EAAAA,EAAAA,IAAeR,KWzIXmI,GAAYlM,EAAAA,EAAAA,WACXmM,EAAQC,IAAajY,EAAAA,EAAAA,WAAS,IAC9BkY,EAAaC,IAClBnY,EAAAA,EAAAA,UAA0C,MACtCoY,GAAgB/B,EAAAA,EAAAA,IAAUgC,EAAAA,IAC1BC,GAAyB3M,EAAAA,EAAAA,IAAkBmC,MAE1C,QAAErJ,EAAO,SAAExB,GAAYsV,GAC5BnP,GAA6BsO,IAOzBc,GAAgBC,EAAAA,EAAAA,GAAU,CAC9BxI,UAAW6H,EAAmB7H,UAC9ByI,gBAAiBZ,EAAmB5H,iBAGhCyI,GAAehN,EAAAA,EAAAA,IAAkBqC,IAEjC4K,GAAajN,EAAAA,EAAAA,IAAkBxD,GAAiBlF,IAChD4V,EAAmB5E,KAEnB6E,EDxED,SACLf,GAEA,MAAMgB,GAA2BC,EAAAA,GAAAA,KAC3B1Y,EAASyX,EAAUjM,QACnBmN,EAAY3Y,GAAQ4Y,eAEpBC,EAAeF,EACjB3Y,GAAQ8Y,YAAYC,gBAAgBJ,GACpC,GAEJ,OAAOF,EAAyB,CAC9BO,GAAI,kBACJtE,MAAO,oBACPuE,YAAa,oBACbzd,SACE,CACEid,EAAyB,CACvBO,GAAI,sBACJtE,MAAO,wBACPwE,cAAc,EACdC,iBAAkB,UAClB3d,SAAU,CACR,CACEwd,GAAI,uBACJtE,MAAO,uBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kCACzB4E,gBAAiBA,KACf9E,IAAgB,MAKxBsE,EACI,CACEG,GAAIvD,GAAAA,EAAe6D,KACnB5E,MAAO,OACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,iBACzB4E,gBAAiBA,KACf,MAAMV,EAAY3Y,GAAQ4Y,eACpBC,EAAeF,EACjB3Y,GAAQ8Y,YAAYC,gBAAgBJ,GACpC,GACAE,GACFU,KAAgBV,EAClB,GAGJ,KACJ,CACEG,GAAIvD,GAAAA,EAAe+D,MACnB9E,MAAO,QACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBACzB4E,gBAAiBA,KAQfrZ,GAAQkO,QACRlO,GAAQoN,QACN,WACA,qCACA,CAAC,EACF,GAGLqL,EAAyB,CACvBO,GAAI,qBACJtE,MAAO,uBACPuE,YAAa,sCACbE,iBAAkB,UAClB3d,SAAU,CACR,CACEwd,GAAIvD,GAAAA,EAAegE,eACnB/E,MAAO,iBACPuE,YACE,4FACFI,gBAAiBA,KACf9E,IAAgB,GAGpB,CAGEyE,GAAIhD,GACJtB,MAAO,qBACPuE,YAAa,+BACbI,gBAAiBA,KACf9E,IAAgB,MAKxB,UACAkE,EAAyB,CACvBO,GAAI,eACJtE,MAAO,UACPyE,iBAAkB,UAClB3d,SAAU,CACR,CACEwd,GAAI/C,GAAgBC,cACpBxB,MAAO,SACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,gBACA,CAAC,EACF,GAGL,CACE8B,GAAI/C,GAAgBE,0BACpBzB,MAAO,qBACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,2BACA,CAAC,EACF,GAGL,CACE8B,GAAI/C,GAAgBG,mBACpB1B,MAAO,aACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,mBACA,CAAC,EACF,GAGL,UACA,CACE8B,GAAI/C,GAAgBU,gBACpBjC,MAAO,WACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QAAQ7J,GAAO2T,GAAU,cAAe,CAAC,EAAE,GAGlE,CACE8B,GAAI/C,GAAgBW,4BACpBlC,MAAO,uBACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,yBACA,CAAC,EACF,GAGL,CACE8B,GAAI/C,GAAgBY,qBACpBnC,MAAO,eACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,iBACA,CAAC,EACF,GAGL,UACAuB,EAAyB,CACvBO,GAAI/C,GAAgBI,oBACpB3B,MAAO,sBACPyE,iBAAkB,UAClB3d,SAAW,CAAC,EAAG,EAAG,EAAG,EAAG,GAAa+C,KAAKmb,IAAK,CAC7CV,GAAI/C,GAAiB,sBAAqByD,KAC1ChF,MAAQ,GAAEgF,IACVL,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACN,mBAAkBwC,IACnB,CAAC,EACF,QAIP,UACA,CACEV,GAAI/C,GAAgBa,sBACpBpC,MAAO,wBACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,8BACA,CAAC,EACF,GAGL,UACA,CACE8B,GAAI/C,GAAgBc,eACpBrC,MAAO,iBACP2E,gBAAkBnC,IAChBO,EAAUjM,SAAS4B,QACjB7J,GAAO2T,GACP,oBACA,CAAC,EACF,MAKTuB,EAAyB,CACvBO,GAAI,sBACJtE,MAAO,sBACPyE,iBAAkB,UAClB3d,SAAU,CACR,CACEwd,GAAIhD,GACJtB,MAAO,cACP2E,gBAAiBA,KACf9E,IAAgB,MAKxB,UACA,CACEyE,GAAI/C,GAAgBgB,8BACpBvC,MAAO,yBACPuE,YAAa,2CACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kCACzB4E,gBAAiBA,KACf9E,IAAgB,IAItB5H,OAAO8F,GAAAA,IAEb,CCnKsCkH,CAAqBlC,GAEnDmC,EAAgB,SAACC,QAAkB,IAAlBA,IAAAA,EAAqB,IAC1ClC,GAAU,GACVW,EAAWuB,GACPlX,GACF4V,EAAiB5V,GAAUgC,OAAOC,IAChCJ,QAAQ4D,MAAM,+BAAgCxD,EAAE,GAGtD,EAMMkV,EAA2B9O,GAC/BrI,EAAW,CAACA,GAAY,IAG1B,OACEjI,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAAS,CAAC4D,KACxBtQ,IAAA,IAAC,qBAAE8R,GAAsB9R,EAAA,OACxBxN,EAAAA,cAACuf,IACKC,EAAAA,GAAAA,GAAWJ,EAA0BE,EAAsB,CAC7DrO,QAASA,KACPgM,GAAU,GACVU,EAAa,CACXnK,MAAOA,IAAMuJ,EAAUjM,SAAS0C,SAChC,IAILqJ,EAAWxM,OAAS,EACnBrQ,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACyf,EAAAA,EAAoB,CACnBC,WAAYA,IACV1f,EAAAA,cAAC2f,EAAAA,GAIC,CACAC,SAAU/F,IAEV7Z,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,SAAQ,SAClBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,eAAc,oBACxBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,YAAW,kBACrBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,aAAY,0BACtBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,cAAa,6BAI3BnE,EAAAA,cAAC8f,EAAAA,EAAU,CACT5W,MAAO2T,EACPG,OAAQA,EACR+C,YAAa9X,EACb+X,kBAAoB7b,IAClB2Y,EAAmBvJ,OACjBsJ,EAAWxJ,WAAWC,GAAQA,EAAIrL,WAAa9D,IAChD,EAEH8b,WAAS,IAEP3M,IACA,MAAM4M,EAAW/c,EAAAA,SAAcmQ,EAAIrL,UAC7B8R,EACJ/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAMpX,EAAe2Q,EAAIrL,YAEzC,OACEjI,EAAAA,cAACmgB,EAAAA,EAAO,CACNhc,IAAKmP,EAAIrL,SACTmY,UAAWF,EACXG,eACErgB,EAAAA,cAACsgB,EAAAA,EAAc,CAAC7W,QAASyW,EAAUnG,KAAMA,KAG3C/Z,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAYpN,EAAIrL,YAExCjI,EAAAA,cAAC2gB,EAAAA,EAAgB,CACf5G,KAAMA,EACNC,MACEha,EAAAA,cAACqZ,GAAe,CAACzW,SAAU0Q,EAAIrL,UAC5BiY,GAGLU,YACE5gB,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,sCAG5B1gB,EAAAA,cAAC6gB,EAAAA,EAAc,CACbzG,QAAUlQ,IACJA,EAAE4W,OACJtD,EAAc1M,QAAQ4M,gBACpBb,EAAWkE,QAAQzN,IAGrBkK,EAAc1M,QAAQmE,UACpB3B,EAAIrL,SAER,KAKR+Y,eAAgB,CACdC,cAAeA,KACb7D,GAAe8D,SAAS,MAKxB,KAKE,iBAAZzX,EAeNzJ,EAAAA,cAACuE,EAAM,CACL4c,OAAO,OACPhe,KAAM8E,EACNrC,QAAS,CAAEwb,aAAa,GACxBC,QAASA,CAACC,EAAc5c,KACtB4c,EAAa9N,QACb8N,EAAaC,eAAeC,IAC1BA,EAAE/E,MAAMgF,iBAGRla,QAAQC,UAAUoE,MAAK,KACrBuR,EAAeqE,EAAE,GACjB,IAEJF,EAAaI,mBAAkB,KAG7BvE,EAAe,KAAK,IA8E1C,SAAmBzY,GACjBA,EAAOid,UAAUC,WAAWC,mBAAmBC,mBAAmB,CAChEC,IAAKJ,EAAAA,GAAUC,WAAWI,QAAQhiB,QAGpC0E,EAAOid,UAAUC,WAAWC,mBAAmBI,sBAAsB,CACnEC,sBAAsB,EACtBC,oBAAoB,GAExB,CArFoBC,CAAU1d,GACVqY,EAAUjM,QAAUwQ,EACpBA,EAAae,2BAA2BnY,IACtCoT,EAAuBpT,EAAEoY,SAAS,IAEpChB,EAAaiB,kBAAiB,QAE5B,EAEJC,SAAUtD,EACV9a,MAAOqF,GAAW,KAGpBA,GAAW,uBAIfzJ,EAAAA,cAAC4a,GAAe,MAEA,YAAjB2C,GAA8Bvd,EAAAA,cAACyiB,GAAiB,MAChDvF,GACCld,EAAAA,cAAC0iB,EAAAA,EAAqB,CACpBC,OAAQzF,EAAYT,MAAMmG,aAC1BC,QAASA,IAAM1F,EAAe,OAE9Bnd,EAAAA,cAAC8iB,GAAqB,OAGA,GAEd,EAItB,SAASA,KACP,MAAMC,GAAcC,EAAAA,EAAAA,GAAe,mBACnC,OAAKD,EAIH/iB,EAAAA,cAACijB,EAAAA,EAAe,CAACF,YAAaA,IAC1BG,GACAljB,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,CACHijB,WAEE,GAEED,MAVH,IAeX,CAEA,MAAM3D,GAA4Bhf,EAAAA,GAAO+Z,GAAI;;;;;;gBAM7B7K,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACtB7K,EAAM0U,MACJ,oBACA1U,EAAMwe,iBACF,gBACAxe,EAAM8V,aAAa2I,gBACxB;EAGCZ,IAAoBliB,EAAAA,EAAAA,IAAOT,EAAY;;;;;EAgB5C8c,GAAAvc,aAAA,8P,uCCjUD,MAqBMijB,IAAc/iB,EAAAA,EAAAA,IAAOgjB,GAAAA,GAAM/iB,WAAA,CAAAC,YAAA,wBAAAC,YAAA,gBAAbH,CAAa,2CAIpBijB,GAAWA,KACtB,MAAO/N,EAAOgO,IAAYze,EAAAA,EAAAA,UAAS,IAC7B0e,GAAW7S,EAAAA,EAAAA,QAAqB,MAEhCjL,GA5BC+d,EAAAA,EAAAA,UACL,MACE/e,MAAO,CACLgf,WAAY,gBACZ3F,UAAW,WAGb7X,WAAY,aACZyd,eAAgB,EAChBxd,SAAU,GACVN,WAAY,IACZ+d,YAAa,QACbC,aAAa,EACbC,YAAa,EACbC,aAAc,SAEhB,IAoBF,OANAhW,EAAAA,EAAAA,YAAU,KACR2F,YAAW,KACT8P,EAAS5S,SAASoT,SAASC,OAAO,GAAI,IACtCT,EAAS5S,SAASoT,SAAS3N,MAJhB,KAI6B,GACvC,IAAK,GACP,IAEDvW,EAAAA,cAACsjB,GAAW,CACVc,IAAKV,EACL9d,QAASA,EACTye,OAASC,IACP,MAAMna,EAAOma,EAAKC,WAAW,GAE7B,GAAa,KAATpa,EACEsL,EAAMpF,OAAS,GACjBqT,EAAS5S,SAASoT,SAAS3N,MAAM,mBAAqBd,EAAQ,KAEhEiO,EAAS5S,SAASoT,SAAS3N,MAAM,UACjCkN,EAAS,QACJ,IAAItZ,EAAO,IAAe,MAATA,EAEtB,OAGAuZ,EAAS5S,SAASoT,SAAS3N,MAAM+N,GACjCb,EAAShO,EAAQ6O,EACnB,IAEF,EAEJd,GAAAnjB,aAAA,mD,4BC3BK,MAAMmkB,IAAoBvV,EAAAA,EAAAA,IAAK,CACpC9K,IAAK,2BACLmJ,SAAS,IAGEmX,IAAoBxV,EAAAA,EAAAA,IAAK,CACpC9K,IAAK,2BACLmJ,SAAS+B,EAAAA,EAAAA,IAAS,CAChBlL,IAAK,mCACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OACX,IAAIkX,IACFtN,EAAI+M,IACD7T,SAAQ8J,IAAA,IAAC,IAAE0J,GAAK1J,EAAA,OAAKvK,EAAeiU,GAAK3T,OAAO2T,EAAI,IACpD3T,OAAOiH,EAAIwE,IAAqB7L,MACpC,MAIMuhB,IAAiBzV,EAAAA,EAAAA,IAAgB,CAC5C9K,IAAK,wBACLmJ,QAAS,IAAIwK,IAAS,MAGX6M,IAAqBtV,EAAAA,EAAAA,IAAyC,CACzElL,IAAK,2BACLqG,IAAKiF,IAAc,IAAb,IAAEjF,GAAKiF,EACX,MAAMwO,EAAYzT,EAAIka,IAChBE,EAAapa,EAAIqa,IAAyBC,MAEhD,MAAO,IAD4B,QAAd7G,EAAsB2G,EAAW3gB,OAASga,GAE5Dpa,KAAKM,GAAQygB,EAAWpa,IAAK,GAAErG,OAC/B8N,OAAO8F,GAAAA,EAAQ,IAITgN,IAA0B9V,EAAAA,EAAAA,IAA8B,CACnE9K,IAAK,0BACLmJ,QAAStN,EAAAA,YACTyR,4BAA4B,IAGjBoT,IAA0BxV,EAAAA,EAAAA,IAAS,CAC9ClL,IAAK,cACLqG,IAAK4F,IAAc,IAAb,IAAE5F,GAAK4F,EAEX,OAiCJtJ,eACEwI,EACA9E,GAEA,MAAMwa,EAAYxa,EAAI4B,GAAgBkD,EAAQnM,OACxC2hB,EAAQ,IAAIG,IACZC,EACHC,GACDre,UACE,MAAMse,EAAO,IACRxV,EACHuV,UAEF,GAAkB,QAAdvV,EAAKlD,KAAgB,CACvB,GAAIkC,GAAWgB,GAAO,CACpB,MAAMyV,EAA2B,IAAKD,EAAMtkB,SAAU,IAUtD,OATAukB,EAAQvkB,gBACAyG,QAAQiF,KACXhC,EAAI4B,GAAgBwD,EAAKzM,QAAW,IAAiBU,IACpDqhB,EAAQG,MAGZpT,OAAO8F,GAAAA,GACTuN,GAAqBD,EAAQvkB,UAC7BgkB,EAAMna,IAAI0a,EAAQliB,KAAMkiB,GACjBA,CACT,CACA,OAAO,IACT,CAEA,OADAP,EAAMna,IAAIya,EAAKjiB,KAAMiiB,GACdA,CAAI,EAGTtkB,SACEyG,QAAQiF,KAAKwY,GAAa,IAAInhB,IAAIqhB,EAAQ,SAChDjT,OAAO8F,GAAAA,GACTuN,GAAqBxkB,GACrB,MAAMykB,EAAwB,CAC5B7Y,KAAM,UACNvJ,KAAMmM,EAAQnM,KACdgC,KAAMmK,EAAQnK,KACdggB,OAAQ,KACRrkB,YAGF,OADAgkB,EAAMna,IAAI4a,EAAKpiB,KAAMoiB,GACd,CAAEA,OAAMT,QACjB,CA/EWU,CADShb,EAAIwE,IACcxE,EAAI,KAONyE,EAAAA,EAAAA,IAAoB,CACtD9K,IAAK,oBACLmJ,QAAS,SAOX,SAASgY,GAAqBpc,GAG5BA,EAAMuc,MAAK,CAACC,EAAOC,IACbD,EAAMvgB,KAAOwgB,EAAMxgB,MACb,EAENugB,EAAMvgB,KAAOwgB,EAAMxgB,KACd,EAEF,GAEX,CA0DO,MAAMygB,GACX9R,IAAA,IAAC,SAAEpF,EAAQ,IAAE/D,GAAwBmJ,EAAA,OACpC3Q,IACC,MAAM0iB,EAAenX,EAASC,YAAY8V,IAAmBhR,eACvDqS,EAAe,CACnBpX,EAASC,YAAYK,IAAqByE,eAAetQ,MACzDI,OAAON,EAAeE,IACxBwH,EAAI8Z,GAAmB,IAAI3M,IAAI,IAAI+N,KAAiBC,IAAe,CACpE,EAQUC,GACXvR,IAAA,IAAC,SAAE9F,GAA6B8F,EAAA,OAC/BrQ,IACC,MAAM6hB,EAAUtX,EACbC,YAAYoW,IACZtR,gBAAgB3C,QACnBkV,GAASC,iBAAiB9hB,GAC1B6hB,GAASxS,MAAMrP,EAAI,CACpB,EAEU+hB,GAA6BA,KACxC,MAAMC,GAAqB1X,EAAAA,EAAAA,IAAkBmX,GAAsB,IAC7DQ,GAAoB3X,EAAAA,EAAAA,IAAkBsX,GAA2B,IACvE,OAAQ5iB,IACNgjB,EAAmBhjB,GACnBijB,EAAkBjjB,EAAK,CACxB,E,oGC1MI,MAAMkjB,GAAmB,CAC9BC,WAAY,aACZC,QAAS,UACTC,OAAQ,SACRC,wBAAyB,0BACzBC,UAAW,YACXC,kBAAmB,oBACnBC,iBAAkB,mBAClBC,mBAAoB,qBACpBC,aAAc,gBCET,SAASC,GAAsBnmB,GAIlC,IAJmC,iBACrComB,GAGDpmB,EACC,OACEZ,EAAAA,cAACinB,GAAAA,EAAW,CACV,aAAW,uBACXC,cAAeF,EACf9M,QAAS,CACP,KACKmB,EAAAA,EAAAA,IAAUgL,GAAiBC,YAC9BtM,MAAO,MACPmN,cAAUC,GAEZ,IAAIC,GAAAA,GACJhM,EAAAA,EAAAA,IAAUN,GAAAA,EAAeuM,MACzBjM,EAAAA,EAAAA,IAAUN,GAAAA,EAAe6D,OACzBvD,EAAAA,EAAAA,IAAUgL,GAAiBI,0BAC3BpL,EAAAA,EAAAA,IAAUN,GAAAA,EAAe+D,OACzB,IAAIuI,GAAAA,GACJhM,EAAAA,EAAAA,IAAUN,GAAAA,EAAewM,QACzB,IAAIF,GAAAA,GACJpV,OAAO8F,GAAAA,IAGf,CAACgP,GAAA1mB,aAAA,kPCDM,MAAMmnB,GAAkBA,KAC7B,MAAMlY,GAAU8F,EAAAA,EAAAA,IAAepG,IACzB1J,EAAS6P,KACT6Q,GAAUnV,EAAAA,EAAAA,QAAqB,MAC/B4W,GAAwB9W,EAAAA,EAAAA,IAAkBoU,KAChD7f,EAAAA,EAAAA,kBAAgB,KACduiB,EAAsBzB,EAAQ,GAC7B,CAACA,IAEJ,MAAO0B,GAAa/Z,GAAqBkX,KAClCgB,EAAc8B,IAAmBC,EAAAA,EAAAA,IAAenD,KAChDoD,EAAcC,IAAmBF,EAAAA,EAAAA,IAAelD,IAGjDqD,GAFe3S,EAAAA,EAAAA,IAAeoP,KAGhCwD,EAAAA,GAAAA,IAAyBC,GAAkB,QAAXA,EAAEvb,KAAiB,EAAI,IACvDwb,GAAAA,EAEEC,EACa,QAAjBN,EACI,GACA,IAAIA,GAAc5V,QAAQmW,GAAgC,iBAANA,IACpDhJ,EAA2B9O,GAAuB6X,GAClDE,GAAexX,EAAAA,EAAAA,QAAuB,MACtCyX,GAAuBzX,EAAAA,EAAAA,UASvBmW,EAAmBA,KAChB,CACLuB,QACEF,EAAavX,SAAS0X,cACnB,cAAaF,EAAqBxX,cAChC,KACP2L,MAAO,OAIX,OACEzc,EAAAA,cAACW,EAAe,KACb+mB,GAAWnC,MACVvlB,EAAAA,cAACyf,EAAAA,EAAoB,CACnB2E,IAAKiE,EACL5O,MAAO,CAAE0H,OAAQ,QACjBsH,OAAQ7nB,IAAA,IAAC,OAAEkI,GAAQlI,EAAA,OAChB0nB,EAAqBxX,QACpBhI,GAAQwI,QAAqB,eAAeoX,QAAQvkB,GAAG,EAE3Dub,WAAYA,IAER1f,EAAAA,cAAC+mB,GAAsB,CAACC,iBAAkBA,KAI9ChnB,EAAAA,cAAC2oB,GAAAA,GAAezoB,EAAAA,EAAAA,GAAA,CACd,aAAW,yBACX8lB,QAASA,GACL5G,EAAwB,CAC5BlW,MAAO,CAACwe,EAAUnC,MAClB3F,SAAWzc,IACTmC,EAAOyP,SAAU,GAAE5R,IAAO,EAE5BylB,oBAAkB,EAClBzF,WAAS,EACT0F,cAAc,WACdhB,aAAcA,EACd7H,kBAAmB8H,EACnBjC,aAAcA,EACdiD,iBAAkBnB,KAEhB/X,GACA5P,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAKyL,EAAKzM,KACVid,UAAWxQ,EAAKzK,KAChB0K,WACE,aAAcD,EAAOmY,EAAUnY,EAAK9O,eAAYsmB,GAGlDpnB,EAAAA,cAAC+oB,GAAAA,EAAU,KACR/oB,EAAAA,cAACgpB,GAAmB,CAAC5D,KAAMxV,IACb,YAAdA,EAAKlD,KACJ1M,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,SACEA,EAAAA,cAACipB,GAAAA,EAAoB,OAEvBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAE5Z,EAAQnM,OAG5BnD,EAAAA,cAACmpB,GAAgB,CAAC/D,KAAMxV,SActB,EAIhBuZ,GAAmB3b,IAAuC,IAAtC,KAAE4X,GAA8B5X,EACxD,MAAqB,QAAd4X,EAAK1Y,KAEV1M,EAAAA,cAACopB,GAAmB,CAAChE,KAAMA,IAE3BplB,EAAAA,cAACqpB,GAAoB,CAACjE,KAAMA,GAC7B,EAGGgE,GAAsB3Z,IAAA,MAA+BA,EAAA,OAEzDzP,EAAAA,cAACipB,GAAAA,EAAoB,KAAG,EAGpBI,GAAuBjZ,IAIF,IAJG,KAC5BgV,GAGDhV,EACC,MAAMvC,GAAQyb,EAAAA,EAAAA,YAAWC,GAAAA,GACzB,OAAO1b,GAAO2b,YAAc3b,GAAO4b,mBACjCzpB,EAAAA,cAACipB,GAAAA,EAAoB,MAErBjpB,EAAAA,cAACqZ,GAAe,CAACzW,SAAUwiB,EAAKjiB,MAC9BnD,EAAAA,cAACipB,GAAAA,EAAoB,MAExB,EAGGS,GAAiE,CACrEpa,QAAS,eACT4H,IAAKlW,EACL+Q,KAAMhR,GAUR,SAASioB,GAAmBlV,GAIJ,IAJK,KAC3BsR,GAGDtR,EACC,MAAMiG,EAXa,UADC3V,EAYMghB,GAXhB1Y,KACD/J,EAAeyB,EAAMe,MAEvBukB,GAAgBtlB,EAAMsI,OAAS,KAJxC,IAAsBtI,EAapB,OAAOpE,EAAAA,cAAAA,EAAAA,SAAA,KAAG+Z,GAAQ/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAMA,IACxC,CAACyN,GAAAnnB,aAAA,0D,gEC5LM,SAASspB,GAAU/oB,GAG4C,IAH3C,QACzB4f,EAAU,wBACPzgB,GAC8Da,EACjE,OACEZ,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAAC4pB,GAAAA,EAAW,CAACC,SAAUrJ,KAC9CxgB,EAAAA,cAAC8pB,GAAAA,GAAM5pB,EAAAA,EAAAA,GAAA,CACL6pB,QAAQ,OACR,aAAW,OACX,mBAAiB,sBACbhqB,GAEJC,EAAAA,cAAA,QAAMyZ,MAAO,CAAEpT,SAAU,KAAM,MAIvC,CCLO,SAAS2jB,GACdC,EACAC,GAEA,YAF2B,IAA3BA,IAAAA,EAA8BhC,GAAAA,GAEvB+B,EAAQhY,QAAQkY,IACrB,MAAMC,EAAUF,EAAQC,GACxB,OAAQF,EAAQrT,MACbyT,IAAaA,WAAaF,IAvBJhF,EAuBwB+E,EAAQG,GAAWD,EAtB3DE,WAAWnF,EAAShiB,IAAAA,MAD1B,IAAsBgiB,CAwBzB,GAAC,GAEL,CDLCwE,GAAAtpB,aAAA,iLEZM,MAAMkqB,GACVrW,GAAyCpN,UACxC,MAAM,QAAEmG,EAAO,MAAED,EAAK,SAAE0B,GAAawF,EAC/BsW,EAAoB1R,GAA0B5E,GAC9CuW,EAAkB/b,EAASgc,SACjC,IACE,UACQtiB,GAAGN,SAAS6iB,OAAO/nB,GACzB,MAAMuV,QAAgBzJ,EAAS8D,WAAWwF,GAAepV,IACrDuV,UACIP,EAAAA,GAAAA,OAAW,CACfxP,GAAE,GACF8O,IAAKiB,EACLvV,SAAUO,IAAAA,SAAcgV,EAASvV,WAE7B4nB,EAAkB5nB,GAE5B,CAAE,MAAOsH,GACPJ,QAAQ4D,MAAO,0BAAyB9K,IAAYsH,EACtD,CAAC,eACsBwE,EAAS8D,WAAWoC,KAClCK,UAAUrS,GACjBqK,EAAQb,GAAgBjJ,IAAAA,QAAaP,KACrCoK,EAAMG,GAAiBvK,GACzB,CACF,CAAC,QACC6nB,GACF,GAGSG,GACV1W,GAAyCpN,UAIxC,MAAM+jB,EAAaN,GAAmBrW,GACtC,OAAO3M,QAAQiF,IAAIse,EAAUjnB,IAAIgnB,GAAY,EAGpCE,GACV7W,GAAyCpN,UAExC,MAAM,QAAEmG,EAAO,MAAED,EAAK,SAAE0B,GAAawF,EAC/B2W,EAAaN,GAAmBrW,GAChCuW,EAAkB/b,EAASgc,SAC3BM,EAAuBlkB,UAC3B,MAAMmkB,QAAkB7iB,GAAGN,SAASqB,QAAQ7F,SACtCiE,QAAQiF,IACZye,EAAUpnB,KAAIiD,UACZ,MAAMokB,EAAW/nB,IAAAA,QAAaG,EAASgH,GACjCjB,QAAajB,GAAGN,SAASuB,KAAK6hB,GAChC7hB,EAAKC,eAEDuhB,EAAWK,GACR7hB,EAAKQ,qBACRmhB,EAAqBE,EAC7B,WAGE9iB,GAAGN,SAASqjB,MAAM7nB,GACxB2J,EAAQb,GAAgB8K,GAAK,EAE/B,IACE,UACQ8T,EAAqB9T,EAC7B,CAAE,MAAOhN,GACPJ,QAAQ4D,MAAO,+BAA8BwJ,IAAOhN,EACtD,CAAC,QACC+C,EAAQb,GAAgBjJ,IAAAA,QAAa+T,IACvC,CACF,CAAC,QACCuT,GACF,GAyBSW,GACXlX,GAEOpN,MAAOukB,EAAqBrhB,KACjC,MAAM,SAAE0E,EAAQ,QAAEzB,EAAO,MAAED,GAAUkH,EAC/BuW,EAAkB/b,EAASgc,SAC3BQ,EAAW/nB,IAAAA,KAAUkoB,EAAarhB,GACxC,IACE,SAAU5B,GAAGN,SAASE,OAAOkjB,GAC3B,MAAM,IAAI7gB,MAAO,QAAO6gB,0BAEpBvhB,GAAUvB,GAAGN,SAAUojB,GAC7Bje,EAAQb,GAAgBif,GAC1B,CAAC,QACCZ,GACF,G,gBChGJ,MAAMa,GAAe,IAAIC,GAAAA,EACtB,6DAID,SAGIC,GAAc,IAAID,GAAAA,EACrB,wEAID,SAGWE,IAAoBpc,EAAAA,EAAAA,IAAS,CACxClL,IAAM,UAAS4W,GAAAA,EAAewM,SAC9B/c,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAIvD,GAAAA,EAAewM,OACnBvN,MAAO,SACPuE,YAAa,uBACbmN,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OAAK1G,UAC7C,MAAM6kB,EAAY7W,EAAYiW,IACxBa,EAAc9W,EAAY8V,IAC1BiB,EAAgBnd,EAASC,YAAYgW,IAAoBxW,WACzD2d,EAAgBpd,EACnBC,YAAY+C,IACZvD,WAAW2C,QACRib,EAAcrd,EACjBC,YAAYgD,IACZxD,WAAW2C,QACd,GAA6B,IAAzB+a,EAAcxb,OAChB,OAEF,MAAM2b,EAAgBhC,GAAc6B,GAAgBzG,GAASA,EAAKjiB,OAC5D2nB,EAAYkB,EACf/Z,QAAQmT,GAAuB,SAAdA,EAAK1Y,OACtB7I,KAAKuhB,GAASA,EAAKjiB,OAChB8oB,EAAcD,EACjB/Z,QAAQmT,GAAuB,YAAdA,EAAK1Y,MAAoC,QAAd0Y,EAAK1Y,OACjD7I,KAAKuhB,GAASA,EAAKjiB,OAEtB,GAAI8oB,EAAY5b,OAAS,EAAG,CAC1B,MAAM6b,EACmB,IAAvBD,EAAY5b,QAAqC,IAArBya,EAAUza,OAClClN,IAAAA,SAAc8oB,EAAY,IAC1B,WAEkBF,GAAaI,QAAQ,CAC3CnS,MAAO,SACPoS,OAAQ,SACRC,QACErsB,EAAAA,cAAA,OAAKyZ,MAAO,CAAE6S,MAAO,MAAO,SACnB,IACNJ,EACI,IAAGA,KACJ,CACE,CAAEK,MAAON,EAAY5b,OAAQgc,QAASb,IACtC,CAAEe,MAAOzB,EAAUza,OAAQgc,QAASf,KAEnCrZ,QAAOxC,IAAA,IAAC,MAAE8c,GAAO9c,EAAA,OAAK8c,EAAQ,CAAC,IAC/B1oB,KAAIuM,IAAA,IAAC,QAAEic,EAAO,MAAEE,GAAOnc,EAAA,OAAKic,EAAQG,OAAO,CAAED,SAAQ,IACrDrW,KAAK,SAAS,IAErBlW,EAAAA,cAAA,WAAM,kCAELksB,EACI,KAAIA,MACL,6BAA6B,oBAChBlsB,EAAAA,cAAA,WAAM,4DAM3BisB,EAAY/nB,SAASoG,GAAaqhB,EAAUrhB,KAC5CshB,EAAYd,GAEhB,MACEgB,GACIW,MAAc3Y,IAAA,IAAC,MAAEM,GAAON,EAAA,OACxB9T,EAAAA,cAAC0sB,GAA6B,CAC5B5B,UAAWA,EACX1W,MAAOA,GACP,IAEHxI,MAAM+gB,IACDA,GACFC,uBAAsB,KASpBhB,EAAYd,EAAU,GAE1B,GAEN,CACD,IACF,IAGH,SAAS4B,GAA6BlY,GAMlC,IANmC,MACrCJ,EAAK,UACL0W,GAIDtW,EACC,OACExU,EAAAA,cAAC6sB,GAAAA,GAAW,CAACC,SAAS,UAAUC,UAAU,WACxC/sB,EAAAA,cAACgtB,GAAAA,EAAY,CACXC,OAAO,SACPxjB,QACEzJ,EAAAA,cAAA,QACEse,GAAG,qBACH4O,SAAWhjB,IACTA,EAAEuX,gBAAgB,EAEpBhI,MAAO,CACL0T,QAAS,iBAGXntB,EAAAA,cAAA,OAAKyZ,MAAO,CAAE2T,aAAc,UACJ,IAArBtC,EAAUza,OACN,gBAAelN,IAAAA,SAAc2nB,EAAU,OACvC,UAASA,EAAUza,eAAe,KAGzCrQ,EAAAA,cAAA,OACEyZ,MAAO,CACL4T,QAAS,OACTC,cAAe,SACfC,IAAK,YAGPvtB,EAAAA,cAACwtB,GAAAA,EAAQ,CAAC9B,YAAU,GAAC,mCACrB1rB,EAAAA,cAAA,OAAKyZ,MAAO,CAAE4T,QAAS,OAAQE,IAAK,SAClCvtB,EAAAA,cAACwtB,GAAAA,EAAQ,CAAC9B,YAAU,GAAC,kCACrB1rB,EAAAA,cAACwtB,GAAAA,EAAQ,CAAC9B,YAAU,GAAC,kCAK7B+B,OACEztB,EAAAA,cAACgtB,GAAAA,EAAaU,OAAM,CAClBC,KAAM3tB,EAAAA,cAAC2pB,GAAU,CAACvP,QAASA,IAAMP,OACjC+T,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,GAAAA,EAAM,CAAC1P,QAASA,IAAMhG,KAAS,UAChCpU,EAAAA,cAAC8pB,GAAAA,EAAM,CACL3G,WAAS,EACTzW,KAAK,SACLmhB,KAAK,qBACL9D,QAAQ,UACR3P,QAASA,KACPhG,GAAM,EAAK,GAEd,WAUjB,CC/LO,MAAM0Z,IAAkBze,EAAAA,EAAAA,IAAS,CACtClL,IAAM,UAAS4W,GAAAA,EAAe6D,OAC9BpU,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAIvD,GAAAA,EAAe6D,KACnB5E,MAAO,OACPuE,YAAa,oBACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,iBACzB2R,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OAAK1G,UAC7C+S,IAAgB,CACjB,IACF,ICXUkU,IAAiB1e,EAAAA,EAAAA,IAAS,CACrClL,IAAM,UAAS4W,GAAAA,EAAeuM,MAC9B9c,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAIvD,GAAAA,EAAeuM,IACnBtN,MAAO,MACPuE,YAAa,mBACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACzB2R,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OAAK1G,UAC7C+S,IAAgB,CACjB,IACF,ICXUmU,IAAmB3e,EAAAA,EAAAA,IAAS,CACvClL,IAAM,UAAS4W,GAAAA,EAAe+D,QAC9BtU,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAIvD,GAAAA,EAAe+D,MACnB9E,MAAO,QACPuE,YAAa,uBACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBACzB2R,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OAAK1G,UAC7C+S,IAAgB,CACjB,IACF,KCEG,uBAAEoU,ICxB4B,CAClCA,uBAAwB,uBDyBnB,SAASC,KACd,MAAMlI,GAAU5Q,EAAAA,EAAAA,IAAe2P,IACzB7K,GAAUiU,EAAAA,GAAAA,GAAe,CAAEnI,YAI3BoI,EAkBR,WAGE,MAAMC,GAAYjZ,EAAAA,EAAAA,IAAevC,IAE3Byb,EAA0BpI,KAC1BqI,EAAmBA,KACnBF,GACFC,EAAwBD,EAAUpmB,SACpC,EAGF,MAAO,CACL,CACEqW,GAAI2P,GACJjU,MAAO,qBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBACzB4E,gBAAiB4P,EACjB7C,YAAa2C,EACb9P,YAAa,+CAEfnJ,EAAAA,EAAAA,IAAeqW,KACfrW,EAAAA,EAAAA,IAAe2Y,KACf3Y,EAAAA,EAAAA,IAAe0Y,KACf1Y,EAAAA,EAAAA,IAAe4Y,KACf/b,OAAO8F,GAAAA,EACX,CA5C6ByW,GAC3B,OACExuB,EAAAA,cAACyuB,GAAAA,EAAiB,CAChBC,cAAc,UACdxU,QAAS,IAAIA,KAAYkU,GACzBO,kBACE3uB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUmT,KACxBjuB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe8T,aACvC7uB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe+T,iBAI3C9uB,EAAAA,cAACwnB,GAAe,MAGtB,CA4BC0G,GAAA7tB,aAAA,4D,kDE1ED,MAAM0uB,GAA2B,IAC1B,SAASC,GAAOpuB,GAAyC,IAAxC,SAAEE,GAAmCF,EAC3D,MAAOquB,EAAcC,IAAmBlqB,EAAAA,EAAAA,WAAS,GAOjD,OANAiJ,EAAAA,EAAAA,YAAU,KACR,MAAMkhB,EAAQvb,YAAW,KACvBsb,GAAgB,EAAK,GACpBH,IACH,MAAO,IAAMK,aAAaD,EAAM,GAC/B,IACCF,EACKjvB,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,GAEL,IACT,CAACkuB,GAAA3uB,aAAA,0H,gBCiED,MAAMgvB,GAAaC,GACjBA,EAaK,SAASC,GACdC,EACAC,GAEA,OAAIA,EACGD,EAMDA,EAAOrsB,OAASssB,EAAMtsB,MACpBG,EAAAA,EAAAA,SAAQksB,EAAOrsB,SAAUG,EAAAA,EAAAA,SAAQmsB,EAAMtsB,MAClCksB,GAAO,CACZ3iB,KAAM,UACN8iB,SACAC,UAGKJ,GAAO,CACZ3iB,KAAM,QACN8iB,SACAC,UAICJ,GAAO,CACZ3iB,KAAM,WACN8iB,SACAC,UAvBOJ,GAAO,CACZ3iB,KAAM,QACN+iB,UAwBGJ,GAAO,CACZ3iB,KAAM,UACN8iB,OAAQA,GAGd,CAKAD,GAAOG,YAAeC,GACbN,GAAO,CACZ3iB,KAAM,cACN+iB,MAAOE,IAIX,MAAMC,GAA4D,CAChEC,MAAO,QACPC,QAAS,UACTC,MAAO,WACPC,QAAS,WACTC,SAAU,WACVC,YAAa,WA0Ff,SAASC,GAAelI,EAAamI,GACnC,OAAOnI,GAAG9kB,OAASitB,GAAGjtB,MAAQ8kB,EAAEoI,QAAUD,EAAEC,KAC9C,CAtFAd,GAAOhW,WAAa,SAAU+V,GAC5B,OAAOM,GAAmBN,EAAO5iB,OAAS,aAC5C,EAKA6iB,GAAOpsB,KAAO,SAAUmsB,GACtB,OAAOC,GAAOI,SAASL,GAAQnsB,IACjC,EAEAosB,GAAO9lB,QAAU,SAAU6lB,GACzB,MAAI,UAAWA,EACNA,EAAOG,MAAMhmB,UAElB,WAAY6lB,EACPA,EAAOE,OAAO/lB,UAEhBlC,QAAQC,QAAQ,GACzB,EAKA+nB,GAAOe,WAAa,SAAUhB,GAC5B,MAAuB,UAAhBA,EAAO5iB,IAChB,EAKA6iB,GAAOgB,WAAa,SAAUjB,GAC5B,MAAuB,YAAhBA,EAAO5iB,IAChB,EAKA6iB,GAAOiB,SAAW,SAAUlB,GAC1B,MAAuB,YAAhBA,EAAO5iB,IAChB,EAKA6iB,GAAOkB,OAAS,SAAUnB,GACxB,MAAuB,UAAhBA,EAAO5iB,IAChB,EAKA6iB,GAAOmB,WAAa,SAAUpB,GAC5B,MAAuB,aAAhBA,EAAO5iB,IAChB,EAKA6iB,GAAOoB,cAAgB,SACrBrB,GAEA,MAAuB,gBAAhBA,EAAO5iB,IAChB,EAKA6iB,GAAOI,SAAW,SAAUL,GAC1B,MAAO,UAAWA,EAASA,EAAOG,MAAQH,EAAOE,MACnD,EAEAD,GAAOve,OAAS,SAAUiX,EAAcmI,GACtC,MAAMQ,EACJ,WAAY3I,GAAK,WAAYmI,EACzBD,GAAelI,EAAEuH,OAAQY,EAAEZ,QAC3B,WAAYvH,GAAM,WAAYmI,EAC9BS,EACJ,UAAW5I,GAAK,UAAWmI,EACvBD,GAAelI,EAAEwH,MAAOW,EAAEX,OAC1B,UAAWxH,GAAM,UAAWmI,EAClC,OAAOQ,GAAcC,CACvB,EC3NA,MAAMC,IAAmBzkB,EAAAA,EAAAA,IAAoC,CAC3DlI,IAAK,kBACLqG,IACG2N,GACDvX,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OACNoD,OAAO+sB,QAAQvmB,EAAIgO,GAAgBL,KAChCtU,KAAsB2J,IAAyB,IAAvB0S,EAAUxU,GAAO8B,EACxC,MAAMmiB,EAAW,CACfxsB,KAAMA,IAAAA,KAAUgV,EAAS+H,GACzBmQ,OAAO,EACP5mB,OAAAA,GACE,MAAM,IAAIY,MAAM,kBAClB,GAEF,MAAe,UAAXqB,EACK6jB,GAAO,KAAMI,GACA,aAAXjkB,EACF6jB,GAAOI,EAAUA,GACJ,YAAXjkB,EACF6jB,GAAOI,EAAU,MACJ,YAAXjkB,EACF6jB,GAAOG,YAAYC,GAEnB,IACT,IAED1d,OAAO8F,GAAAA,EAAQ,IAGXiZ,IAAkB3hB,EAAAA,EAAAA,IAAmC,CAChElL,IAAK,iBACLqG,IAAKiF,IAAc,IAAb,IAAEjF,GAAKiF,EACX,OAAOjF,EAAI+M,IACR1T,KAAIuM,IAAA,IAAC,IAAE8G,GAAK9G,EAAA,OAAK5F,EAAIsmB,GAAiB5Z,GAAK,IAC3C+Z,MAAM,IC/BAC,IAAmBjiB,EAAAA,EAAAA,IAAsB,CACpD9K,IAAK,oBACLmJ,QAAS,CACP,CACEgR,GAAI,YACJnZ,KAAM,UACNgsB,QAAS,+BACTC,QAAS,GACTpU,QAAQ,GAEV,CACEsB,GAAI,kBACJnZ,KAAM,wBACNgsB,QAAS,oCACTC,QAAS,GACTpU,QAAQ,MAKDqU,IAAwBhiB,EAAAA,EAAAA,IAA+B,CAClElL,IAAK,4BACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OACX4J,EAAI0mB,IAAkBta,MAAM0a,GAAeA,EAAWtU,UAAW,IAAI,IAG5DuU,IAA0BliB,EAAAA,EAAAA,IAA8B,CACnElL,IAAK,gCACLqG,IAAKgD,IAAA,IAAC,IAAEhD,GAAKgD,EAAA,OAAKhD,EAAIwmB,IAAiB/e,OAAOsd,GAAOoB,cAAc,IAoC9D,SAASa,KACd,MAAMJ,GAAUhc,EAAAA,EAAAA,IAAe4b,IACzBS,GAAiB9gB,EAAAA,EAAAA,IAAkBugB,IAgCzC,OA/BAjjB,EAAAA,EAAAA,YAAU,KACRwjB,GAAgBC,IACd,MAAMC,EAAiBP,EAAQnf,QAC5Bqd,IAAYC,GAAOoB,cAAcrB,KAE9BsC,EAAqBF,EAAY7tB,KAAKytB,IACnC,IACFA,EACHF,QAASE,EAAWF,QACjBvtB,KAAKyrB,GACJqC,EAAe/a,MAAMib,GAAYtC,GAAOve,OAAO6gB,EAASvC,OAEzDrd,OAAO8F,GAAAA,OAGR+Z,EAAkBF,EAAmBluB,SACzCoQ,IAAA,IAAC,QAAEsd,GAAStd,EAAA,OAAKsd,CAAO,IAEpBW,EAAaJ,EAAe1f,QAC/Bqd,IACEwC,EAAgBlb,MAAMob,GACrBzC,GAAOve,OAAOse,EAAQ0C,OAO5B,OAHEJ,EAAmBhb,MAAKpC,IAAA,IAAC,OAAEwI,GAAQxI,EAAA,OAAKwI,CAAM,KAC9C4U,EAAmB,IACJR,QAAQthB,QAAQiiB,GAC1BH,CAAkB,GACzB,GACD,CAACR,IACG,IACT,C,gBC7FO,MAAMa,GACXrxB,IAAA,IAA6B,QAC3BspB,EAAO,QACPgI,EAAUhK,GAAAA,EAAQ,oBAClBiK,EAAuB/J,IAAMA,GAAM,0BACnCgK,GAA4B,GACCxxB,EAAA,OAC9ByxB,IACC,MAAMC,EAAqC,CAAC,EACtCC,EAAeF,EAAMxuB,IAAIquB,GAASruB,KAAKuhB,IAC3C,MAAMxiB,EAAWsnB,EAAQ9E,GAuBzB,OArBoBniB,EAClBL,EAAS0nB,WAAW,KAAO1nB,EAAY,IAAGA,KAC1C4vB,QAAO,CAACC,EAAiBzoB,KACpBsoB,EAAgBtoB,KACnBsoB,EAAgBtoB,GAAWmoB,EAAoB,CAC7CzlB,KAAM,YACN1C,UACA0oB,eAAgB,GAChB5xB,SAAU,MAGV6xB,GAAgBF,KAClBA,EAASC,eAAiB1oB,GAE5B,MAAMqb,EAAUiN,EAAgBtoB,GAIhC,OAHAqb,EAAQvkB,SAAWukB,EAAQvkB,SAAS+N,SAAS4jB,GACzCpN,EAAQvkB,SACR,CAAC2xB,KAAapN,EAAQvkB,UACnBukB,CAAO,GACbD,EAEe,IAEdwN,GAAiBC,EAAAA,GAAAA,GAAKN,GAC5B,OAAOH,EACHQ,EAAe/uB,KAAKuhB,GAClB0N,GAAoBX,EAAqB/M,KAE3CwN,CAAc,CACnB,EAEH,SAASD,GAA4CvN,GACnD,MAAO,SAAUA,GAAsB,cAAdA,EAAK1Y,IAChC,CAEA,SAASomB,GACPC,EAGA1N,GAEA,IAAI,SAAEvkB,EAAQ,QAAEkJ,EAAO,eAAE0oB,GAAmBrN,EAC5C,OAAgC,IAA5BA,EAAQvkB,SAASuP,QAAgBsiB,GAAgBtN,EAAQvkB,SAAS,KACpEkJ,EAAUqb,EAAQvkB,SAAS,GAAGkJ,QAC9BlJ,EAAWukB,EAAQvkB,SAAS,GAAGA,SAAS+C,KAAKmvB,GAC3CL,GAAsBK,GAClBF,GAA0BC,EAAoB,IACzCC,EACHN,eAAgB1oB,IAElBgpB,IAECF,GACLC,EACAA,EAAmB,CACjBrmB,KAAM,YACN1C,UACA0oB,iBACA5xB,eAIC,IACFukB,EACHvkB,SAAUA,EAAS+C,KAAKmvB,GACtBL,GAAgBK,GACZF,GAA0BC,EAAoBC,GAC9CA,IAGV,CC1DO,MAAMC,GAAqBA,CAACvmB,EAAc4R,IAC9C,GAAE5R,KAAQ4R,IAEA4U,GAAuB5D,GAClC2D,GAAmB,SAAU1D,GAAOpsB,KAAKmsB,IAC9B6D,GAAa,SAAC7D,EAAmB8D,GAAe,YAAP,IAARA,IAAAA,GAAW,GAAsB,CAC7E1mB,KAAM,SACNvI,IAAK+uB,GAAoB5D,GACzBA,SACA8D,WACD,EAsBYC,GACXjO,GAC0B,aAAcA,EAC7BkO,GAAgBlO,GACb,WAAdA,EAAK1Y,KAKM6mB,GAGXnO,GAEAiO,GAAYjO,GAAQA,EAAKtkB,SAAW,KC/FzB0yB,GAAe,CAC1BC,SAAU,qBACVC,QAAS,sBACTC,gBAAiB,6BACjBC,OAAQ,qBACRC,kBAAmB,+BACnBC,eAAgB,4BAChBC,gBAAiB,6BACjBC,kBAAmB,qBACnBC,kBAAmB,+BACnBC,uBAAwB,yBACxBC,2BAA4B,mBAC5BC,UAAW,gBACXC,cAAe,eACfC,gBAAiB,iBACjBC,eAAgBxZ,GAAAA,EAAeyZ,YAE/BC,8BAA+B,uBAC/BC,mBAAoB,gCACpBC,QAAS,UACTC,SAAU,WACVC,UAAW,YACXC,sBAAuB,sBACvBC,aAAc,eAEdC,sBAAuB,wBACvBC,oCACE,mDACFC,oBAAqB,sBAErBC,kBAAmB,0BACnBC,WAAY,0BACZC,QAAS,oCACTC,qBAAsB,+BACtBC,YAAa,kBACbC,aAAc,4BACdC,kBAAmB,0BACnBC,sBAAuB,2BACvBC,mCAAoC,uCAEpCC,mCAAoC,sCCPhCC,GAAmE,CACvEvX,GAAI,aACJtE,MAAO,aACP8b,aAAazmB,EAAAA,EAAAA,IAAS,CACpBlL,IAAK,iCACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OAAK4J,EAAI+M,IAAelH,OAAS,CAAC,IAEjD0lB,SAAS1mB,EAAAA,EAAAA,IAAS,CAChBlL,IAAK,6BACLqG,IACEgD,IAAA,IAAC,IAAEhD,GAA8BgD,EAAA,OAChC6kB,GACe7nB,EAAI+M,IACL1T,KACVmyB,GFyBmB,SAC5BA,EACAl1B,GAAkB,YAAL,IAAbA,IAAAA,EAAgB,IACO,CACvB4L,KAAM,OACNvI,IAAK8uB,GAAmB,OAAQ+C,EAAW9e,KAC3C8e,aACAl1B,WACD,CEhCWm1B,CACED,EACA3D,EAAMpgB,QAAQmT,GACZmK,GAAOpsB,KAAKiiB,EAAKkK,SAAShF,WAAW0L,EAAW9e,SAIzD,KAIMgf,GAAgE,CAC3E5X,GAAI,YACJtE,MAAO,YACP8b,aAAa,EACbK,cAAe3C,GAAakB,mBAC5BqB,QAAS9D,GAAkD,CACzDG,2BAA2B,EAC3BD,oBAAqB1iB,IAAA,IAAC,QAAEzF,EAAO,eAAE0oB,EAAc,SAAE5xB,GAAU2O,EAAA,OFNlC,SAC3BzF,EACA0oB,EACA5xB,EACAs1B,GAAsB,YADA,IAAtBt1B,IAAAA,EAAyB,SACR,IAAjBs1B,IAAAA,EAAoB,IACE,CACtB1pB,KAAM,YACNvI,IAAKiyB,EAAYnD,GAAmB,YAAajpB,GACjDA,UACA0oB,iBACA5xB,WACD,CEJKu1B,CAAcrsB,EAAS0oB,EAAgB5xB,EAAS,EAClDoxB,QAAU9M,GAAS+N,GAAW/N,EAAKkK,QAAQ,GAC3CpF,QAAU9E,GAASmK,GAAOpsB,KAAKiiB,EAAKkK,WAI3BgH,GAET,CAACT,GAAoBK,IAEZK,IAA8BlnB,EAAAA,EAAAA,IAEzC,CACAlL,IAAK,6BACLqG,IAAK4F,IAAA,IAAC,IAAE5F,GAAK4F,EAAA,OACXkmB,GAAuBrkB,QAAQukB,IAC7BC,EAAAA,EAAAA,IAAcD,EAASV,aACnBtrB,EAAIgsB,EAASV,aACbU,EAASV,aACd,IAGQY,GAAoBA,CAC/BC,EACAtE,KAEA,GAA2B,IAAvBsE,EAAYtmB,QAAiC,IAAjBgiB,EAAMhiB,OACpC,OAAOgiB,EAET,MAAMuE,EAAkBD,EAAYzkB,MAAM,GAEpC2kB,EAAexE,EAA8CpgB,OACjEqhB,IAEIwD,EAAczE,EAA8CpgB,OAChEohB,IAEI0D,EAASJ,EAAY,GAAGE,GAK9B,MAHA,IAAIC,KAAeC,GAAQ7yB,SAAS8yB,IAClCA,EAAUl2B,SAAW41B,GAAkBE,EAAiBI,EAAUl2B,SAAS,IAEtEi2B,EAAO9kB,QAAQglB,GAAUA,EAAMn2B,SAASuP,OAAS,GAAE,EAS/C6mB,GACXpjB,IAAA,IAAsC,IACpCtJ,EAAG,SACH2sB,EAAQ,UACRC,GAKDtjB,EAAA,OACAsiB,IACC,MAAM5uB,EAAcpD,IAClBqyB,EAAAA,EAAAA,IAAcryB,GAASoG,EAAIpG,GAASA,EAChCizB,EAAWD,EACdnlB,QACCuC,IAAA,IAAC,GAAE8J,EAAE,YAAEwX,GAAathB,EAAA,OAAKhN,EAAQsuB,IAAgBtuB,EAAQ2vB,EAAS7Y,GAAI,IAEvEza,KAAI4Q,IAAkB,IAAjB,QAAEshB,GAASthB,EACf,OAAOjN,EAAQuuB,EAAQ,IAExBlyB,KAAmBkyB,GAClBK,EACI,kBACEL,KAAQuB,WAASzzB,KAAKozB,IAAK,IACtBA,EACH9yB,IAAM,GAAEiyB,KAAaa,EAAM9yB,SAC1B,EACL4xB,IAER,OAAQ3E,GACNsF,GAAqBW,EAAUjG,EAAQ,CAC1C,E,uCCvIH,MAAMmG,IAAStoB,EAAAA,EAAAA,IAAc,CAC3B9K,IAAK,sBACLmJ,SAAS,IAELkqB,IAAevoB,EAAAA,EAAAA,IAAsB,CACzC9K,IAAK,4BACLmJ,QAAS,CAAE6T,OAAQ,OAEfsW,IAA2BxoB,EAAAA,EAAAA,IAA+B,CAC9D9K,IAAK,wCACLmJ,QAAS,KAELoqB,IAAYroB,EAAAA,EAAAA,IAAS,CACzBlL,IAAK,iCACLqG,IAAK5J,IAAc,IAAb,IAAE4J,GAAK5J,EACX,MAAM+2B,EAAkBntB,EAAIitB,KACtB,UAAEC,GAAcltB,EAAIotB,IACpBC,EAAoBH,EAAUzlB,QACjCmT,GACe,eAAdA,EAAK1Y,MACLirB,EAAgBG,MAAMxI,GACpBlK,EAAKkM,WAAWF,QAAQviB,SAASygB,OAGvC,OAAiC,IAA7BuI,EAAkBxnB,OACbqnB,EAAUzlB,QACdmT,GAAuB,eAAdA,EAAK1Y,MAAyB0Y,EAAKkM,WAAWtU,SAGrD6a,CAAiB,IA0BfE,GAAoB,CAC/BR,UACAC,gBACAQ,uBA1B4B3oB,EAAAA,EAAAA,IAAS,CACrClL,IAAK,qCACLqG,IAAKgD,IAAc,IAAb,IAAEhD,GAAKgD,EACX,MAAMyqB,EAAkBztB,EAAIitB,IACtBpF,EAAQ7nB,EAAIktB,IACZ7R,GAAeqS,EAAAA,GAAAA,KAClB9S,GAAUiO,GAAYjO,GAAQA,EAAKtkB,SAAW,OAC9CskB,GAASA,EAAKjhB,KACfkuB,EACA4F,EAAgBp0B,IAAIqvB,KAEtB,OAAO,IAAIpb,IACT+N,EAAaxV,OACTwV,GACAsS,EAAAA,GAAAA,KACG/S,GAAUiO,GAAYjO,GAAQA,EAAKtkB,SAAW,OAC9CskB,GAASA,EAAKjhB,KACfkuB,GAEP,IAQHoF,4BACAC,cCvEK,SAASU,GAGdV,GAOA,MAAMW,EAAgB,IAAIpT,IACpBH,EAAQ,IAAIG,IACZqT,EAAgB,IAAIxgB,IAqB1B,OAnBAygB,EAAAA,GAAAA,IACEhF,IACA,CAACnO,EAAMoT,KAKL,GAJA1T,EAAMna,IAAIya,EAAKjhB,IAAKihB,GAChB,aAAcA,GAChBkT,EAAcG,IAAIrT,EAAKjhB,MAEpBq0B,EACH,OAAO,EAET,MAAME,EAAYF,EAAkBhG,QAClC,CAACmG,EAAOpM,IAAUoM,EAAQpM,GAC1B,GAGF,OADA8L,EAAc1tB,IAAIya,EAAKjhB,IAAKu0B,GACrBA,CAAS,GAElBhB,GAEK,CAAEA,YAAWW,gBAAevT,QAAOwT,gBAC5C,CCkBO,MAAMM,GACXtH,IAAyB,CAEzB5kB,KAAM,aACNvI,IAAK8uB,GAAmB,aAAc3B,EAAWhT,IACjDgT,aACAxwB,SAAUwwB,EAAWF,QAAQvtB,KAAKyrB,GAAW6D,GAAW7D,OAG7CuJ,IAAwB5pB,EAAAA,EAAAA,IAAK,CACxC9K,IAAK,+BACLmJ,SAAS,IAGEwrB,IAAwB7pB,EAAAA,EAAAA,IAAK,CACxC9K,IAAK,+BACLmJ,SAAS,IAOEyrB,IAA6B1rB,EAAAA,EAAAA,IAA4B,CACpElJ,IAAK,+BACLmJ,SAAS,IAME0rB,IAAoB/pB,EAAAA,EAAAA,IAAgB,CAC/C9K,IAAK,2BACLmJ,QAAS,IAAIwK,IAAS,MAMXmhB,IAA4B5pB,EAAAA,EAAAA,IAAmB,CAC1DlL,IAAK,mCACLqG,IAAK5J,IAAc,IAAb,IAAE4J,GAAK5J,EACX,MAAMqd,EAAYzT,EAAIwuB,IACtB,GAAkB,QAAd/a,EAAqB,CACvB,MAAM,UAAEyZ,GAAcltB,EAAIotB,IAC1B,OAAO,IAAI9f,KACTohB,EAAAA,GAAAA,KACG9T,GAAU,aAAcA,EAAOA,EAAKtkB,SAAW,KAChD,CAACskB,EAAM+T,KACL,MAAM9G,EAAQ8G,GAAe,GAE7B,OADA9G,EAAMviB,KAAKsV,GACJiN,CAAK,GAEdqF,GAECzG,OACAptB,KAAKuhB,GAASA,EAAKjhB,MAE1B,CACA,OAAO8Z,CAAS,IAOd0G,IAAqBtV,EAAAA,EAAAA,IAA2C,CACpElL,IAAK,4BACLqG,IAAKgD,IAAc,IAAb,IAAEhD,GAAKgD,EACX,MAAMqa,EAAerd,EAAIyuB,KACnB,MAAEnU,GAAUta,EAAIotB,IACtB,OAAO,IAAI9f,IACT,IAAI+P,GAAchkB,KAAKM,GAAQ2gB,EAAMta,IAAIrG,KAAM8N,OAAO8F,GAAAA,GACvD,IAIQqhB,IAA2B/pB,EAAAA,EAAAA,IAAiC,CACvElL,IAAK,mCACLqG,IAAKiF,IAAc,IAAb,IAAEjF,GAAKiF,EACX,MAAMoc,EAAgBrhB,EAAIma,IACpB0U,EAA6B,IAAIvhB,IACjCwhB,EAAelU,IACdA,IAGa,WAAdA,EAAK1Y,MACP2sB,EAAWZ,IAAIrT,EAAKkK,QAElB+D,GAAiCjO,IACnCA,EAAKtkB,SAASoD,QAAQo1B,GACxB,EAGF,OADAzN,EAAc3nB,QAAQo1B,GACfD,CAAU,IAORE,IAA4BlqB,EAAAA,EAAAA,IAAqC,CAC5ElL,IAAK,kCACLqG,IAAK4F,IAAc,IAAb,IAAE5F,GAAK4F,EACX,MAAMyb,EAAgBrhB,EAAIma,IACpB6U,EAAiBhvB,EAAI0mB,IAErBuI,EAA0C,IAAI3hB,IAC9CwhB,EAAelU,IACnB,GAAKA,EAAL,CAMA,GAHkB,eAAdA,EAAK1Y,MACP+sB,EAAoBhB,IAAIrT,EAAKkM,YAEb,WAAdlM,EAAK1Y,KAAmB,CAC1B,MAAM4kB,EAAakI,EAAe5iB,MAAM0a,GACtCA,EAAWF,QAAQviB,SAASuW,EAAKkK,UAE/BgC,GACFmI,EAAoBhB,IAAInH,EAE5B,CACI+B,GAAiCjO,IACnCA,EAAKtkB,SAASoD,QAAQo1B,EAbxB,CAcA,EAGF,OADAzN,EAAc3nB,QAAQo1B,GACfG,CAAmB,IASjBC,IAA0BzqB,EAAAA,EAAAA,IAAkB,CACvD9K,IAAK,iCACLmJ,QAAS,IAAIwK,IAAY,MAGd6hB,IAAuBtqB,EAAAA,EAAAA,IAAmC,CACrElL,IAAK,8BACLqG,IAAKsJ,IAAc,IAAb,IAAEtJ,GAAKsJ,EACX,MAAM8lB,EAAqBpvB,EAAIkvB,IAE/B,OADmBlvB,EAAIwmB,IACL/e,QAAQqd,GACxBsK,EAAmBC,IAAI3G,GAAoB5D,KAC5C,IAQQwK,IAAiCzqB,EAAAA,EAAAA,IAE5C,CACAlL,IAAK,mDACLqG,IAAKgK,IAA2B,IAA1B,IAAEhK,EAAG,YAAEsK,GAAaN,EACxB,MAAM,UAAEkjB,GAAcltB,EAAIotB,IACpBgC,EAAqBpvB,EAAIkvB,IACzB5R,EAAkBhT,GACtBL,IAAA,IAAC,IAAE9J,GAAK8J,EAAA,OACL/D,GACC/F,EAAI+uB,GAAyBhpB,EAAS,IAE5C,OAAO,IAAIqpB,GAAAA,EACT,CACE7wB,MAAO0wB,MACJI,EAAAA,GAAAA,GAAmBlS,IAExB,CACE4P,YACAnE,YAAc3jB,GACZyjB,GAAiCzjB,GAAQA,EAAK9O,SAAW,KAC3Dm5B,OAASrqB,GAASA,EAAKzL,KAE1B,IAIQsgB,IAAoBxV,EAAAA,EAAAA,IAAgB,CAC/C9K,IAAK,2BACLmJ,SAAS+B,EAAAA,EAAAA,IAAS,CAChBlL,IAAK,4CACLqG,IAAKmK,IAAc,IAAb,IAAEnK,GAAKmK,EACX,OAAO,IAAImD,IACTtN,EAAIotB,IACDF,UAAU7zB,KAAKuhB,GAAS,CACvBA,EAAKjhB,OACFihB,EAAKtkB,SAAS+C,KAAKmvB,GAAUA,EAAM7uB,SAEvC8sB,OACJ,MAKMiJ,IAA4B7qB,EAAAA,EAAAA,IAAS,CAChDlL,IAAK,oBACLqG,IAAKqK,IAAA,IAAC,IAAErK,EAAG,YAAEsK,GAAaD,EAAA,OACxBrK,EAAI+rB,IAA6B1yB,KAAK2yB,IAAQ,IACzCA,EACHW,SAAU3sB,EAAIuuB,GAA2BvC,EAASlY,QACjD,IAGD6b,GAAgBA,CAIpB/U,EACA2Q,KAEmE,IAEhE3Q,EACHtkB,SAAUi1B,EAAQ3Q,EAAKtkB,YAGZ82B,IAAwBvoB,EAAAA,EAAAA,IAIlC,CACDlL,IAAK,wBACLqG,IAAK4vB,IAAc,IAAb,IAAE5vB,GAAK4vB,EACX,MAAMC,GAAkBrS,EAAAA,GAAAA,IACtBsS,IAAA,IAAC,OAAEtd,GAAQsd,EAAA,OAAMtd,CAAM,GACvBxS,EAAI0mB,KACJrtB,IAAI+0B,IACA2B,EAAkBrD,GAA0B,CAChD1sB,MACA4sB,UAAWd,GACXa,SAAU4B,KAENyB,EAAqBhwB,EAAI+mB,IACzBmG,EACJ2C,EAAgBx2B,KAAK+0B,GACnBuB,GAAcvB,EAAgB2B,EAAgB3B,EAAez0B,QAEjE,GAAIq2B,EAAmBnqB,OAAS,EAAG,CACjC,MAAMoqB,EAAiD,CACrDt2B,IAAK,cACLuI,KAAM,cACN5L,SAAU05B,EAAmB32B,KAAKyrB,GAAW6D,GAAW7D,MAE1DoI,EAAU5nB,KACRqqB,GAAcM,EAAwBF,EAAgB,gBAE1D,CACA,OAAOnC,GAAuBV,EAAU,IAO/BgD,IAAyBrtB,EAAAA,EAAAA,IAGpC,CACAlJ,IAAK,yCACLmJ,QAAUqtB,GAAiC,eAAhBA,EAA+B,GAAM,KAKrDC,IAAmB3rB,EAAAA,EAAAA,IAAK,CACnC9K,IAAK,0BACLmJ,SAAS,IAQEutB,IAAqB5rB,EAAAA,EAAAA,IAAK,CACrC9K,IAAK,4BACLmJ,QAAS,KAMEwtB,IAA0B7rB,EAAAA,EAAAA,IAAK,CAC1C9K,IAAK,iCACLmJ,QAAS,KAGEytB,IAAoB9rB,EAAAA,EAAAA,IAAwB,CACvD9K,IAAK,2BACLmJ,QAAS,OAGE0tB,IAA8B3rB,EAAAA,EAAAA,IAAS,CAClDlL,IAAK,qCACLqG,IAAKywB,IAAc,IAAb,IAAEzwB,GAAKywB,EACX,MAAMC,EAAc1wB,EAAI0F,IACxB,OAAO1F,EAAIwmB,IAAiB/e,QAAQqd,GAClC4L,EAAYpD,MAAMqD,GAChB5L,GAAOpsB,KAAKmsB,GAAQhF,WAAW6Q,MAElC,IAOQC,GAAuBC,IAA2C,IAA1C,IAAE1wB,EAAG,SAAE+D,GAA6B2sB,EAIvE,OAAQC,IACN,MAWM1B,GAXU0B,EACZ5sB,EACGC,YAAYqiB,IACZ7iB,WACA8D,QAAQqd,GACPgM,EAAMxD,MAAMqD,GACV5L,GAAOpsB,KAAKmsB,GAAQhF,WAAW6Q,OAGrCzsB,EAASC,YAAYqsB,IAA6B7sB,YAEnBtK,IAAIqvB,IAEvC,GADAvoB,EAAI+uB,GAAyB,IAAI5hB,IAAI8hB,IACjCA,EAAmBvpB,OAAS,EAAG,CACjC,MAAMwV,GAAeqS,EAAAA,GAAAA,KAClB9S,GACCiO,GAAiCjO,GAAQA,EAAKtkB,SAAW,OAC1DskB,GAASA,EAAKjhB,KACfuK,EAASC,YAAYipB,IAAuBzpB,WAAWupB,UACvDkC,GAEFjvB,EAAI8Z,IAAoB8W,GACf,IAAIzjB,IAAI,IACe,QAAxByjB,EACAA,EACA,IAAIzjB,OACL+N,MAGPlb,EAAIquB,GAAmB,IAAIlhB,IAAI,CAAC8hB,EAAmB,KACrD,EACD,EAGU4B,GAAyCC,IAG5B,IAH6B,IACrD9wB,EAAG,SACH+D,GACkB+sB,EAIlB,OAAO,SAACC,QAAU,IAAVA,IAAAA,GAAa,GACnB,MAAMR,EAAcxsB,EAASC,YAAYuB,IAAkB/B,WACrDwtB,EAAwBjtB,EAC3BC,YAAYyqB,IACZjrB,WACGytB,EACJF,GAAcR,EAAY7qB,OAAS,EAC/B3B,EAASC,YAAYqsB,IAA6B7sB,WAClD,KACNxD,EACEotB,GAAkBN,yBAClBmE,GAA6B,IAAID,IAEnChxB,EAAIotB,GAAkBR,QAAQ,EAChC,CAAC,E,4BCnaI,MAAMsE,GAA6BA,IAEP,IAA7B,KADiBzmB,EAAAA,EAAAA,IAAe4jB,KACd3oB,OACb,KAGPrQ,EAAAA,cAACinB,GAAAA,EAAW,CACV,aAAW,kBACX/M,QAAS,EACPmB,EAAAA,EAAAA,IAAUmY,GAAaa,gBACvBhZ,EAAAA,EAAAA,IAAUmY,GAAaC,WACvBpY,EAAAA,EAAAA,IAAUmY,GAAae,gBACvB,IAAIlN,GAAAA,GACJhM,EAAAA,EAAAA,IAAUmY,GAAaI,QACvB,IAAIvM,GAAAA,GACJhM,EAAAA,EAAAA,IAAUmY,GAAaM,iBACvBzY,EAAAA,EAAAA,IAAUmY,GAAaQ,oBACvB3Y,EAAAA,EAAAA,IAAUmY,GAAaS,oBACvB5Y,EAAAA,EAAAA,IAAUmY,GAAaU,yBACvB7Y,EAAAA,EAAAA,IAAUmY,GAAaW,4BACvB,IAAI9M,GAAAA,GACJhM,EAAAA,EAAAA,IAAUN,GAAAA,EAAe2Y,UACzBzhB,OAAO8F,GAAAA,KClCRjR,eAAeg1B,GACpBC,EACA/kB,GAEA,MAAMglB,QAAwBz0B,QAAQiF,IACpCwK,EAAMnT,KAAK+L,GAASmsB,EAAUnsB,GAAM3F,OAAM,KAAM,OAElD,OAAO+M,EAAM/E,QAAO,CAACrC,EAAMwD,IAAU4oB,EAAgB5oB,IACvD,CCHOtM,eAAem1B,GAAiBr7B,GAMX,IANY,GACtCwH,EAAE,IACF8O,EAAG,gBACHglB,GAGDt7B,EACC,MAAMu7B,QAAiBvkB,EAAAA,GAAAA,UAAc,CACnCxP,KACA8O,MACA/T,KAAO,UAAS+4B,YAEZE,QAAexkB,EAAAA,GAAAA,UAAc,CACjCxP,KACA8O,MACA/T,KAAO,UAAS+4B,aAElB,OAAOC,GAAYC,EACd,GAAEA,KAAUD,EAAS/2B,QAAQ,iBAAkB,MAChD,IACN,CFYEy2B,GAAAx7B,aAAA,qEGgBF,MAAMg8B,IAAyBhwB,EAAAA,EAAAA,IAAsC,CACnElI,IAAK,wBACLqG,IACGmO,GACD7R,UAAe,MAANlG,EACP,MAAM07B,QAAiB1kB,EAAAA,GAAAA,aAAiB,CAAExP,GAAE,GAAE8O,IAAKyB,IACnD,OAAOpR,QAAQiF,IACb8vB,EAASz4B,KAAIiD,UAAa,CACxB3B,KAAMo3B,EACNC,qBAAsBP,GAAkB,CACtC7zB,GAAE,GACF8O,IAAKyB,EACLujB,gBAAiBK,QAGtB,IAODE,IAA0BpwB,EAAAA,EAAAA,IAAe,CAC7ClI,IAAK,yBACLqG,IAAMmO,GAAqB7R,UACzB,MAAM41B,QAAgB9kB,EAAAA,GAAAA,YAAgB,CAAExP,GAAE,GAAE8O,IAAKyB,IACjD,aACQpR,QAAQiF,IACZkwB,EAAQ74B,KAAI2J,IAAA,IAAC,OAAE4uB,GAAQ5uB,EAAA,OACrBoK,EAAAA,GAAAA,aACgB,CAAExP,GAAE,GAAE8O,IAAKyB,EAAUyjB,WAClCxwB,MAAM0wB,GACLA,EACGrqB,QAAQsqB,GAAsB,SAAXA,IACnB14B,KAAK04B,IAAM,CAAQp3B,KAAMo3B,EAAQH,cACrC,MAGPnL,MAAM,IAOC0L,IAAoBtwB,EAAAA,EAAAA,IAAqC,CACpElI,IAAK,mBACLqG,IACGmO,GACD7R,UAAoB,IAAb,IAAE0D,GAAKiF,EACZ,MAAMmtB,EAAoBpyB,EAAIqyB,GAA2BlkB,IACzD,IAAImkB,EAAgBtyB,EAAI6xB,GAAuB1jB,IAS/C,OAR6B,IAAzBmkB,EAAczsB,QAAgBusB,IAGhCE,EAAgBA,EAAcv5B,OAAO,CACnC4B,KAAMy3B,EACNJ,eAAgB,QAGb,CACL7jB,WACAokB,cACED,EAAclmB,MAAM2lB,GAAWA,EAAOp3B,OAASy3B,KAC/C,KACFE,cAAeA,EACfE,eAAgBxyB,EAAIiyB,GAAwB9jB,IAC7C,IAOMkkB,IAA6BxwB,EAAAA,EAAAA,IAAe,CACvDlI,IAAK,wBACLqG,IAAMmO,GAAqB,IAClBf,EAAAA,GAAAA,cAAkB,CACvBxP,GAAE,GACF8O,IAAKyB,EACLskB,UAAU,MAQHC,IAAmB7tB,EAAAA,EAAAA,IAAyB,CACvDlL,IAAK,kBACLqG,IAAK4F,IAAc,IAAb,IAAE5F,GAAK4F,EAEX,OADkB5F,EAAI+M,IACL1T,KAAIiQ,IAAA,IAAGoD,IAAKyB,GAAU7E,EAAA,OACrCtJ,EAAImyB,GAAkBhkB,GAAU,GACjC,IAOQwkB,IAAqB9wB,EAAAA,EAAAA,IAAsC,CACtElI,IAAK,mBACLqG,IACG5H,GACD4R,IAAc,IAAb,IAAEhK,GAAKgK,EACN,MAAM+Q,EAAO/a,EAAIwN,GAAepV,IAMhC,OALAkH,QAAQiB,IACL,iBAAgBnI,IACjB2iB,EACAA,GAAQ/a,EAAImyB,GAAkBpX,KAEzBA,GACH/a,EAAImyB,GAAkBpX,IAAOwX,eAAe53B,MAC5C,IAAI,IAIRi4B,GAAmC,CACvC,CAAEC,WAAY,QAASC,WAAY,UACnC,CAAED,WAAY,SAAUC,WAAY,kBAiCtC,SAASC,GAAkBC,GACzB,OACEhoB,GAAYgoB,GAAe35B,KAAKH,SAAqB+5B,GACnDjoB,GAAYioB,GAAOA,MAAMr5B,MAAMs5B,MAAM75B,KACnC4Q,IAAA,IAAG,eAAiB,UAAW6oB,EAAY,QAAS3kB,IAAYlE,EAAA,MAAM,CACpE4oB,WAAYI,GAAOA,MAAM,SACzBH,aACA3kB,WACD,OAEA,EAET,CAEA,SAASglB,GAAgBv5B,GACvB,MAAMw5B,GAAiBC,EAAAA,GAAAA,IAAQlpB,IAAA,IAAC,WAAE0oB,GAAY1oB,EAAA,OAAK0oB,CAAU,GAAEj5B,GAgB/D,MAAO,CACLP,IAhBcG,OAAO+sB,QAAQ6M,GAAgB/5B,KAC7CgR,IAAA,IAAEwoB,EAAYf,GAASznB,EAAA,MAAM,CAC3B4oB,MAAO,CACL,QAASJ,EACTj5B,MAAO,CACLs5B,KAAMpB,EAASz4B,KAAK04B,IAAM,CACxB,cAAe,CACb,QAASA,EAAO5jB,SAChB,UAAW4jB,EAAOe,kBAK3B,IAKL,CAEA,MAAMQ,IAAyB9mB,EAAAA,GAAAA,KAC7BC,EAAAA,GAAAA,IAAO,CACLomB,YAAYhmB,EAAAA,GAAAA,KAAMC,EAAAA,GAAAA,IAAQ,UAAUA,EAAAA,GAAAA,IAAQ,WAC5CgmB,YAAYnmB,EAAAA,GAAAA,MACZwB,UAAUxB,EAAAA,GAAAA,SAIR4mB,IAAwB9uB,EAAAA,EAAAA,IAAgC,CAC5D9K,IAAK,wBACLmJ,QAAS,GACTC,QAAS,CACPoI,GAAoE,CAClEE,OAAQioB,GACRloB,cAAe,eACf9J,KAAO0L,GACE+lB,GACL/lB,IAAc,uBAAuB,mBAGzC1B,OAAS1R,GACC2M,IAAY,IACdA,GAAgB,CAAC,EACrB,oBAAqB,CACnB,iBAAkB4sB,GAAgBv5B,WAQjC45B,IAAwB3xB,EAAAA,EAAAA,IAAe,CAClDlI,IAAK,0BACLqG,IACGyzB,GACD7D,IAAc,IAAb,IAAE5vB,GAAK4vB,EACN,OAAO8D,GACL1zB,EAAIuzB,IACJvzB,EAAI2zB,IACJF,EACD,IAIDE,IAAoClvB,EAAAA,EAAAA,IAAgC,CACxE9K,IAAK,iCACLmJ,QAAS,GACTC,QAAS,CACPoI,GAAoE,CAClEE,OAAQioB,GACRloB,cAAe,eACf9J,KAAO0L,GACE+lB,GACL/lB,IAAc,2BAA2B,mBAG7C1B,OAAS1R,GACC2M,IAAY,IACdA,GAAgB,CAAC,EACrB,wBAAyB,CACvB,iBAAkB4sB,GAAgBv5B,WAQ9C,SAASg6B,GAAuBx1B,GAK9B,OAAOw0B,GAAiCtF,MACtCwC,IAAA,IAAC,WAAE+C,EAAU,WAAEC,GAAYhD,EAAA,OACzBgD,IAAe10B,EAAO00B,YAAcD,IAAez0B,EAAOy0B,UAAU,GAE1E,CAEA,MAAMa,GAAaA,CACjBG,EACAC,EACA11B,MAEIy1B,EAAiBznB,MAAK5F,EAAAA,GAAAA,GAAOpI,MAG7B01B,EAA6B1nB,MAAK5F,EAAAA,GAAAA,GAAOpI,KAGtCw1B,GAAuBx1B,GAGhC,SAAS21B,KACP,OAAO9vB,EAAAA,EAAAA,KACLwsB,IAAA,IAAC,IAAEtwB,EAAG,SAAE+D,GAAUusB,EAAA,OAChB,SACEryB,EACA41B,QAAiB,IAAjBA,IAAAA,GAAqBN,GACnBxvB,EAASC,YAAYovB,IAAuB5vB,WAC5CO,EAASC,YAAYwvB,IAAmChwB,WACxDvF,IAGF,MAAM61B,EACJ1tB,GAEAA,EAAakB,QACVysB,KAAgC1tB,EAAAA,GAAAA,GAAO0tB,EAAgB91B,KAEtD6vB,EACJ1nB,GAEIA,EAAa+mB,MAAK9mB,EAAAA,GAAAA,GAAOpI,IACpBmI,EAEFA,EAAaxN,OAAOqF,GAGzB41B,GACF7zB,EAAIwzB,GAAmCM,GAClCL,GAAuBx1B,IAC1B+B,EAAIozB,GAAuBtF,KAG7B9tB,EAAIozB,GAAuBU,GACvBL,GAAuBx1B,IACzB+B,EAAIwzB,GAAmC1F,GAG7C,CAAC,GACH,GAEJ,CACO,SAASkG,KACd,MAAMN,GAAmBjpB,EAAAA,EAAAA,IAAe2oB,IAClCO,GAA+BlpB,EAAAA,EAAAA,IACnC+oB,IAGF,MAAO,CACLD,WAAat1B,GACXs1B,GAAWG,EAAkBC,EAA8B11B,GAC7Dg2B,eAAgBL,KAEpB,CC/XO,MAAMM,GAAwBj+B,IAI9B,IAJ+B,KACpCk+B,GAGDl+B,EACC,MAAM27B,GAASnnB,EAAAA,EAAAA,IAAe+nB,GAAmB2B,EAAK5nB,MACtD,OAAOlX,EAAAA,cAAAA,EAAAA,SAAA,KAAGu8B,EAAU,EACpBsC,GAAAx+B,aAAA,8ICNF,MAAM0+B,GAAwBx+B,EAAAA,GAAOy+B,IAAK;;;;;;;;;;;;;;kBAcxBp+B,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACtBgE,EAAM0U,MAAM,sBAAwB1U,EAAMK,KAAO,UAAY,OAAO;;EAIpEg6B,GAAoBC,IACxB,MAAM9rB,GAAQgC,EAAAA,EAAAA,IAAemC,IAAelE,WACzCkS,GAASA,EAAKrO,MAAQgoB,IAEnBt6B,GAAQC,EAAAA,EAAAA,MACRa,EAAS,CAACd,EAAM8V,aAAaykB,IAAKv6B,EAAM8V,aAAa0kB,MAC3D,OAAO15B,EAAO0N,EAAQ1N,EAAO2K,SAAW3K,EAAO,EAAE,EAGtC25B,GAAgBr/B,EAAAA,YAC3B,CAAAwN,EAOE4W,KAA8B,IAN9B,SACE8a,KACGn/B,GAG8ByN,EAAA,OAGnCxN,EAAAA,cAAC++B,IAAqB7+B,EAAAA,EAAAA,GAAA,CACpBkkB,IAAKA,GACDrkB,EAAK,CACT0Z,MAAO,IAAK1Z,EAAM0Z,MAAO6lB,gBAAiBL,GAAiBC,MAC3D,IAEJG,GAAAh/B,aAAA,6HChDK,MAAMk/B,GAAyBh/B,EAAAA,GAAOy+B,IAAK;;;;;;;gBAOlCp+B,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACtBgE,EAAM46B,uBAEH,sBAAqB56B,EAAM0U,MAC1B,oDACA1U,EAAMK,KAAO,kBAAoB,0BAC7BL,EAAM0U,MACV,yCACA1U,EAAMK,KAAO,OAAS,WAGZ,KADTL,EAAMR,MAAc,iDACnB,SAEL;WACMoJ,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACjB5I,EAAM+U,uBACJ/U,EAAM0U,MACJ,qCACA1U,EAAMK,KAAO,UAAY,WAE5B;ECQCqmB,GAAe,IAAIC,GAAAA,EACtB,oFAKD,SAGK,SAASkU,GAAgB/G,GAC9B,OAAOpN,GAAakB,OAAO,CAAEkM,aAC/B,CACA,MA+BMgH,GAAiBjwB,IAAyD,IAAxD,KAAE2V,GAA4B3V,EACpD,OACEzP,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KACb9D,EAAKgO,UAAYjwB,IAAAA,QAAaosB,GAAOpsB,KAAKiiB,EAAKkK,SAChC,EA8BhBqQ,GAAiE,CACrEb,KAlEqDc,CACrDxa,EAAIxkB,KAAA,IACJ,UAAE83B,GAAW93B,EAAA,MACT,CACJwf,UAAWjd,IAAAA,SAAciiB,EAAK4Q,WAAW9e,KACzC2oB,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAACq/B,GAAa,CAACH,SAAU9Z,EAAK4Q,WAAW9e,MACzClX,EAAAA,cAACipB,GAAAA,EAAoB,MACrBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAEuW,GAAgB/G,IAClC14B,EAAAA,cAACu/B,GAAsB,KACrBv/B,EAAAA,cAAC6+B,GAAqB,CAACC,KAAM1Z,EAAK4Q,eAIzC,EAoDC8J,UAnDyDC,CACzD3a,EAAI5X,KAAA,IACJ,UAAEkrB,GAAWlrB,EAAA,MACT,CACJ4S,UAAWgF,EAAKsN,eACZvvB,IAAAA,SAAciiB,EAAKsN,eAAgBtN,EAAKpb,SACxCob,EAAKpb,QACT61B,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM/Y,IACpBhB,EAAAA,cAACipB,GAAAA,EAAoB,MACrBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAEuW,GAAgB/G,KAGvC,EAsCCpJ,OA9BoDlK,IAAI,CACxDhF,UAAWjd,IAAAA,SAAcosB,GAAOpsB,KAAKiiB,EAAKkK,SAC1CuQ,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAMpX,EAAe4sB,GAAOpsB,KAAKiiB,EAAKkK,WACpDtvB,EAAAA,cAAC0Z,GAAW,CAAChO,OAAQ6jB,GAAOhW,WAAW6L,EAAKkK,SAC1CtvB,EAAAA,cAACipB,GAAAA,EAAoB,OAEtBsG,GAAOiB,SAASpL,EAAKkK,QACjB,mBAAkBnsB,IAAAA,SAAciiB,EAAKkK,OAAOE,OAAOrsB,QACpDosB,GAAOkB,OAAOrL,EAAKkK,SAClB,iBAAgBnsB,IAAAA,SAEbA,IAAAA,QAAaiiB,EAAKkK,OAAOG,MAAMtsB,MAC/BA,IAAAA,QAAaiiB,EAAKkK,OAAOE,OAAOrsB,OAEjCiC,QAAQ,oBAAqB,SAEpCpF,EAAAA,cAAC0/B,GAAc,CAACta,KAAMA,QA6Bf4a,GAAgCA,CAC3CC,EASAC,KAEA,MAAMC,EAAqC,IACtCR,MACAO,KACAD,GAECG,EAAetsB,IAMe,IANd,KACpBsR,EAAI,cACJiT,GAIDvkB,EAGC,MAAMusB,EACJF,EAAc/a,EAAK1Y,OACf,UAAE0T,EAAS,SAAEyf,GAAaQ,EAAajb,EAAM,CACjDsT,UAAWL,EAAc7tB,IAAI4a,EAAKjhB,MAAQ,EAC1Cm8B,SAAU,IAEZ,MAAO,CACLn8B,IAAKihB,EAAKjhB,IACV0L,WAAYwjB,GAAYjO,GAASA,EAAKtkB,SAAmB,GACzDy/B,cAAelN,GAAYjO,IAASA,EAAKtkB,UAAUuP,OAAS,EAC5D+P,YACAtf,SAAU++B,EACX,EAEH,MAAO,CACLO,eACAI,aAAcA,CACZpb,EAAO5Q,KAEH,IADJ,cAAE6jB,GAAoD7jB,EAItD,OAAO6rB,EADLF,EAAc/a,EAAK1Y,OACD0Y,EAAM,CACxBsT,UAAWL,EAAc7tB,IAAI4a,EAAKjhB,MAAQ,EAC1Cm8B,SAAU,IACTlgB,SAAS,EAEdqgB,aACEhsB,IAAA,IAAC,cAAE4jB,GAAoD5jB,EAAA,OACtD2Q,GACCplB,EAAAA,cAAC6f,EAAAA,EAASugB,EAAa,CAAEhb,OAAMiT,kBAAoB,EACxD,EC3IH,SAASqI,KACP,MAAMC,GAAUvrB,EAAAA,EAAAA,IAAeqD,IAC/B,OAAOzY,EAAAA,cAAAA,EAAAA,SAAA,KAAG2gC,GAAW3gC,EAAAA,cAACgvB,GAAO,KAAC,iBAChC,CAEO,MAAM4R,GACXZ,GAAmD,CACjDa,WA1CyDC,CAC3D1b,EAAIxkB,KAAA,IACJ,UAAE83B,GAAW93B,EAAA,MACT,CACJwf,UAAWgF,EAAKkM,WAAWnsB,KAC3B06B,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAAA,QAAMyZ,MAAO,CAAEsnB,WAAY3b,EAAKkM,WAAWtU,OAAS,YAASoK,IAC3DpnB,EAAAA,cAACipB,GAAAA,EAAoB,OAEvBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KACbuW,GAAgB/G,GAChB14B,EAAAA,cAAC0gC,GAAW,QAKpB,EA0BGM,YAxByEC,CAC3EC,EAAK1zB,KAAA,IACL,UAAEkrB,GAAWlrB,EAAA,MACT,CACJ4S,UAAW,oBACXyf,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAACipB,GAAAA,EAAoB,MACrBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KACbuW,GAAgB/G,GAChB14B,EAAAA,cAAC0gC,GAAW,QAIpB,IC3BD,SAASS,GAAmB/b,GAC1B,MAAmB,cAAfA,GAAM1Y,KACD,CAAC0Y,EAAKpb,SAEI,WAAfob,GAAM1Y,KACD,CAAC6iB,GAAOpsB,KAAKiiB,EAAKkK,SAEvB+D,GAAYjO,GACPA,EAAKtkB,SAAS4C,QAAQy9B,IAExB,EACT,CAMO,MAAMC,GAAiBxgC,IAIV,IAJW,QAC7BolB,GAGDplB,EACC,MAAM,UAAE82B,EAAS,cAAEW,EAAa,MAAEvT,IAAU1P,EAAAA,EAAAA,IAC1CwiB,KAEK/P,EAAcC,IAAmBF,EAAAA,EAAAA,IAAeoR,KAChDnT,EAAc8B,IAAmBC,EAAAA,EAAAA,IAAenD,IACjD4c,GAAkBjsB,EAAAA,EAAAA,IAAe0kB,KACjC,SAAE/kB,GAAaI,KACfmsB,GAAqB7yB,EAAAA,EAAAA,KACzBjB,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OACVrJ,IACC,MAAMgvB,EAAazkB,EAChBC,YAAYipB,IACZzpB,WACA2W,MAAMta,IAAIrG,GAIb,MAHyB,WAArBgvB,GAAYzmB,MACdqI,EAASwa,GAAOpsB,KAAKgwB,EAAW7D,SAE3B6D,CAAU,CAClB,GACH,IAGI/T,EAA2B9O,GACd,QAAjBuX,EACI,GACA,IAAIA,GAAcnkB,SAASS,IACzB,MAAMihB,EAAON,EAAMta,IAAIrG,GACvB,OAAOihB,EAAO+b,GAAmB/b,GAAQ,EAAE,KAInD,OACEplB,EAAAA,cAACyf,EAAAA,EAAoB,CACnBC,WAAYA,IAAM1f,EAAAA,cAAC67B,GAA0B,MAC7CpiB,MAAO,CAAE0H,OAAQ,SAEjBnhB,EAAAA,cAACuhC,GAAAA,GAA6BrhC,EAAAA,EAAAA,GAAA,CAC5B,aAAW,sBACX8lB,QAASA,EACT9c,MAAOwuB,EACP7O,cAAc,WACdhB,aAAcA,EACdhC,aAAcA,EACdiD,iBAAkBnB,EAClB3H,kBAAmB8H,EACnBlI,SAAU0hB,EACVD,gBAAiBA,EACjBzY,oBAAkB,EAClBzF,UAAU,SACN/D,IAEFgG,IACA,MAAMrlB,EAAQ6gC,GAA4BR,aAAa,CACrD/H,gBACAjT,SAEF,OACEplB,EAAAA,cAAC6f,EAAAA,EAAS9f,EACmB,IAA1BqlB,EAAKtkB,UAAUuP,QACdrQ,EAAAA,cAACwhC,GAAAA,EAAgB,CACf9c,eAAgB2c,EAAgBI,kBAAkBrc,GAClDsc,SAAUA,IAAML,EAAgBM,OAAOvc,KAG1CrlB,EAAMe,SACF,IAIQ,EAEzBsgC,GAAA/gC,aAAA,6R,wCCzGK,MAAMuhC,GAA0BA,KACrC,MAAM1nB,EAAU,EACdmB,EAAAA,EAAAA,IAAUmY,GAAaM,iBACvBzY,EAAAA,EAAAA,IAAUmY,GAAaQ,oBACvB3Y,EAAAA,EAAAA,IAAUmY,GAAaS,oBACvB5Y,EAAAA,EAAAA,IAAUmY,GAAaU,yBACvB7Y,EAAAA,EAAAA,IAAUmY,GAAaW,6BACvBliB,OAAO8F,GAAAA,GAET,OACE/X,EAAAA,cAAC6hC,GAAAA,EAAkB,CACjBniB,WAAY9e,IAAA,IAAC,UAAEsiB,GAAWtiB,EAAA,OACxBZ,EAAAA,cAACinB,GAAAA,EAAW,CAAC/M,QAASA,IAClB4nB,GACA9hC,EAAAA,cAAC+hC,GAAAA,GAAe7hC,EAAAA,EAAAA,GAAA,GAAKgjB,EAAe4e,KAE1B,GAGhB9hC,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBACA,EAEvB6nB,GAAAvhC,aAAA,kE,4BCdK,SAAS2hC,GAAmBphC,GAM/B,IANkD,UACpDw2B,EAAS,SACTsK,GAID9gC,EAEC,OAAyB,IAArBw2B,EAAU/mB,QAAgB+mB,EAAU,GAAGrd,KAEvC/Z,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAa,YAAW0W,EAAU,GAAGpd,WAGtDha,EAAAA,cAACiiC,GAAAA,GAAU,CACTC,UAAW9K,EAAU,GAAGD,SACxB/c,QAASA,IAAMsnB,EAAStK,EAAU,GAAG9Y,KAEpC8Y,EAAU,GAAGrd,OAMpB/Z,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,cACjD1gB,EAAAA,cAAC6hC,GAAAA,EAAkB,CACjBniB,WAAYlS,IAAoB,IAAnB,UAAE0V,GAAW1V,EACxB,OACExN,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACb2E,aAAcuP,EACXnlB,QAAOxC,IAAA,IAAC,SAAE0nB,GAAU1nB,EAAA,OAAK0nB,CAAQ,IACjCtzB,KAAIuM,IAAA,IAAC,GAAEkO,GAAIlO,EAAA,OAAKkO,CAAE,IACrBsB,SAAWzb,IACT,MAAMma,EAAK8Y,EAAUxgB,MAAK9C,IAAA,IAAC,GAAEwK,GAAIxK,EAAA,OAAKwK,IAAOna,CAAG,KAAGma,GAC/CA,GACFojB,EAASpjB,EACX,IAGFte,EAAAA,cAACmiC,GAAAA,EAAO,CAACnoB,MAAM,YACZod,EAAUvzB,KAAI2Q,IAAA,IAAC,GAAE8J,EAAE,MAAEtE,GAAOxF,EAAA,OAC3BxU,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKma,GAAKtE,EAAa,KAG5B,GAIXha,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,yBAI3B,CAACioB,GAAA3hC,aAAA,gZC/DM,MAAM+hC,GAA6BA,KAGxC,MAAMhL,GAAYhiB,EAAAA,EAAAA,IAAe8kB,IAE3BmI,GAAc5zB,EAAAA,EAAAA,KAClB7N,IAAA,IAAC,IAAE+J,GAAK/J,EAAA,OACL0d,IACC3T,EAAIouB,GAA2Bza,IAAMla,IAAWA,GAAM,CACvD,GACH,IAGF,OAAOpE,EAAAA,cAACgiC,GAAmB,CAAC5K,UAAWA,EAAWsK,SAAUW,GAAe,EAC3ED,GAAA/hC,aAAA,qECXK,MAAMiiC,GAA0BA,KACrC,MAAOC,EAAkBC,IAAuB5a,EAAAA,EAAAA,IAC9CkR,KAEK2J,EAAkBC,IAAuB9a,EAAAA,EAAAA,IAC9CiR,IAEI8J,EAAc,CAAEJ,mBAAkBE,oBAExC,OACEziC,EAAAA,cAAC6hC,GAAAA,EAAkB,CACjBniB,WAAY9e,IAAA,IAAC,UAAEsiB,GAAWtiB,EAAA,OACxBZ,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACb2E,aAAc7jB,OAAOC,KAAK0+B,GAAa1wB,QACpC9N,GAAQw+B,EAAYx+B,KAEvByb,SAAWzb,IACT,OAAQA,GACN,IAAK,mBACH,OAAOu+B,GAAqBt+B,IAAWA,IACzC,IAAK,mBACH,OAAOo+B,GAAqBp+B,IAAWA,IAC3C,IAGFpE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,oBAAmB,sBAC7BnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,oBAAmB,2CAGxB,GAGTnE,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACA,EChClB,SAAS6oB,KACd,OACE5iC,EAAAA,cAAC6iC,GAAAA,EAAO,CAACC,OAAO,UACd9iC,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe2Y,UACvC1zB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAaC,WACrCzzB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAaY,YACrCp0B,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,iBACjD1gB,EAAAA,cAAC4hC,GAAuB,OAE1B5hC,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAaG,kBACrC3zB,EAAAA,cAAC+iC,GAAAA,EAAgB,MACjB/iC,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,cACjD1gB,EAAAA,cAACoiC,GAA0B,OAE7BpiC,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,kBACjD1gB,EAAAA,cAACsiC,GAAuB,OAE1BtiC,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe8T,aACvC7uB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe+T,eAG7C,CDaEwT,GAAAjiC,aAAA,kECbDuiC,GAAAviC,aAAA,6D,gBCaM,MAAM2iC,IAAa/zB,EAAAA,EAAAA,IAAa,CACrC9K,IAAK,aACLmJ,QAAS,KAOE21B,IAAiB5zB,EAAAA,EAAAA,IAAsB,CAClDlL,IAAK,cACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OAAK4J,EAAIw4B,IAAY,EAAE,IAMzBE,IAAiB7zB,EAAAA,EAAAA,IAAiB,CAC7ClL,IAAK,cACLqG,IAAKgD,IAAA,IAAC,IAAEhD,GAAKgD,EAAA,OAAKhD,EAAIw4B,IAAY3yB,MAAM,IAG1C,IAAI8yB,GAAc,EAaX,MAAMC,GAAaA,KACxB,MAAMC,GAAgB1yB,EAAAA,EAAAA,IAAkBqyB,IACxC,OAAOM,EAAAA,GAAAA,IACL,CAAA7zB,EAKE8zB,KACgB,IALhB,MACEvpB,EAAK,aACLwpB,GAAe,GAC2B/zB,EAG5C,MAAMg0B,EAAmC,IAAI/6B,GAAAA,GAAIg7B,YAC3CplB,IAAO6kB,GACbE,GAAeM,GAAU,IACpBA,EACH,CACErlB,GAAI6kB,KACJnpB,QACAypB,kBACAD,eACAI,SAAU,CACRC,SAAU,EACVC,KAAM,GACNC,cAAe,GACfC,iBAAiB,OAIvB,MAAMC,EAAwBntB,IAC5BusB,GAAeM,GACNA,EAAM9/B,KAAK0/B,GAChBA,EAAKjlB,KAAOA,EACR,IAAKilB,EAAMK,SAAU,IAAKL,EAAKK,YAAa9sB,IAC5CysB,KAEN,EAEEW,EAAiC,mBAATX,EAAsB,CAAEY,IAAKZ,GAASA,EAuBpE,OAtBAh8B,QAAQC,QACN08B,EAAeC,IACb,CACEC,WAAAA,CAAYP,GACVI,EAAqB,CAAEJ,YACzB,EACAQ,OAAAA,CAAQP,GACNG,EAAqB,CAAEH,QACzB,EACAQ,gBAAAA,CAAiBP,GACfE,EAAqB,CAAEF,iBACzB,EACAQ,gBAAAA,CAAiBP,GACfC,EAAqB,CAAED,mBACzB,GAEFP,EAAgBe,SAElBC,SAAQ,KACRpB,GAAeM,GAAUA,EAAM1xB,QAAQsxB,GAASA,EAAKjlB,KAAOA,MAC5D4lB,EAAeQ,cAAc,IAExBpmB,CAAE,GAEZ,EAMUqmB,GAAgBA,KAC3Bl2B,EAAAA,EAAAA,KAAkB2B,IAAA,IAAC,SAAE1B,GAAU0B,EAAA,OAAMkO,IACnC,MAAMilB,EAAO70B,EACVC,YAAYq0B,IACZ70B,WACAyI,MAAM2sB,GAASA,EAAKjlB,KAAOA,IAC1BilB,GACFA,EAAKE,gBAAgBmB,OACvB,CACD,IC5JUC,IAAmBx4B,EAAAA,EAAAA,IAG9B,CACAlI,IAAK,2BACLqG,IACE5J,IAAA,IAAC,SAAE+X,EAAQ,IAAEyL,GAAwCxjB,EAAA,MACrD,IACSgX,EAAAA,GAAAA,WAAe,CAAExP,GAAE,GAAE8O,IAAKyB,EAAUyL,MAAK0gB,MAAO,GACxD,I,gBCZE,MAAMC,GAAgBC,GACnB,GAAEA,EAAKC,WAAa,KAAKD,EAAKE,aAAaF,EAChDG,cACAC,WACAlzB,OAAO,KAECmzB,GAAqBC,GAC5BA,EAAUC,MAAQD,EAAUE,GACtB,WAAUT,GAAaO,EAAUC,aAAaR,GACpDO,EAAUE,MAGVF,EAAUC,KACJ,SAAQR,GAAaO,EAAUC,QAErCD,EAAUE,GACJ,SAAQT,GAAaO,EAAUE,MAElC,GCNIC,IAAkBx2B,EAAAA,EAAAA,IAAe,CAC5C9K,IAAK,oBACLmJ,QAAS,CAAC,UAGCo4B,IAAuBz2B,EAAAA,EAAAA,IAAa,CAC/C9K,IAAK,yBACLmJ,QAAS,SAMEq4B,IAAmBt5B,EAAAA,EAAAA,IAAe,CAC7ClI,IAAK,qBACLqG,IACGrG,GACDvD,IAAc,IAAb,IAAE4J,GAAK5J,EACN,MAAMglC,EAAcp7B,EAAIq7B,GAAaD,YAAYzhC,IAC3C2hC,EAAOt7B,EAAIq7B,GAAaC,KAAK3hC,IAC7B6gC,EAAOx6B,EAAIq7B,GAAab,KAAK7gC,IAC7Bm4B,EAAW9xB,EAAIq7B,GAAatJ,OAAOp4B,IACnC4hC,EAA2C,GA2BjD,OAzBIzJ,GAAUjsB,OAAS,GACrB01B,EAAMj2B,KAAK,CACTk2B,MAAO1J,EAASpmB,KAAK,MACrB+vB,KAAO,MAAK3J,EAASpmB,KAAK,UAG1B8uB,GACFe,EAAMj2B,KAAK,CACTk2B,MAAOX,GAAkBL,GACzBiB,KAAO,QAAOZ,GAAkBL,OAGhCY,GACFG,EAAMj2B,KAAK,CACTk2B,MAAQ,IAAGJ,KACXK,KAAO,eAAcL,OAGrBE,GACFC,EAAMj2B,KAAK,CACTk2B,MAAOF,EACPG,KAAO,MAAKH,MAIR,MAAKC,EAAM11B,OAAS,EAAI,KAAO,KACpB,IAAjB01B,EAAM11B,OACF01B,EAAM,GAAGC,MACTD,EAAMliC,KAAKqiC,GAASA,EAAKD,OAAM/vB,KAAK,MACxC,IAIFiwB,GAA4D,GAMrDC,GACXC,IAEAF,GAASr2B,KAAKu2B,GACPA,GAMIC,GAA6BF,IACxC/4B,EAAAA,EAAAA,IAA4B,CAC1BlJ,IAAK,+BACLmJ,SAAS,KAOAi5B,GAAkCH,IAC7C/4B,EAAAA,EAAAA,IAA4B,CAC1BlJ,IAAK,6BACLmJ,SAAS,KAMAk5B,IAA8Cn3B,EAAAA,EAAAA,IAAS,CAClElL,IAAK,wCACLqG,IAAKgD,IAAA,IAAC,IAAEhD,GAAKgD,EAAA,OACXhD,EAAI+7B,GAAgC/7B,EAAIk7B,KAAuB,IAGtDe,GAA4B,IAC5BZ,GAAe,CAI1BD,YAAaQ,IACX/4B,EAAAA,EAAAA,IAA2B,CACzBlJ,IAAK,8BACLmJ,QAAS,MAMbo5B,UAAWN,IACT/4B,EAAAA,EAAAA,IAA4B,CAC1BlJ,IAAK,4BACLmJ,SAAS,KAMbq5B,OAAQP,IACN/4B,EAAAA,EAAAA,IAA4B,CAC1BlJ,IAAK,yBACLmJ,SAAS,KAMbw4B,KAAMM,IACJ/4B,EAAAA,EAAAA,IAAkC,CAChClJ,IAAK,uBACLmJ,QAAS,QAMb03B,MAAM33B,EAAAA,EAAAA,IAAqC,CACzClJ,IAAK,uBACLmJ,QAAS,OAKXivB,OAAQ6J,IACN/4B,EAAAA,EAAAA,IAA6B,CAC3BlJ,IAAK,yBACLmJ,QAAS,OAWFs5B,IAAyBC,EAAAA,GAAAA,IAAc,CAACx5B,EAAYlJ,KACxDkL,EAAAA,EAAAA,IAAS,CACdlL,IAAM,6BAA4BA,IAClCqG,IAAKiF,IAAA,IAAC,IAAEjF,GAAKiF,EAAA,OACXjF,EAAI6C,EAAW7C,EAAIk7B,KAA+C,EACpE/6B,IAAKA,CAAAyF,EAAe02B,KAAc,IAA5B,IAAEn8B,EAAG,IAAEH,GAAK4F,EAChBzF,EACE0C,EAAW7C,EAAIk7B,KACfoB,EACD,KAGJjB,IAIUkB,GAAkBA,KAC7Bt4B,EAAAA,EAAAA,KACEqF,IAAA,IAAC,MAAE9G,GAAO8G,EAAA,OACPkzB,IACChjC,OAAOD,OAAO8hC,IACXhiC,KAAKgK,GAAUA,EAAMm5B,KACrB9iC,QAAQ8I,EAAM,CAClB,GACH,IAGEi6B,GACJzyB,IAAA,IAAC,IAAE7J,EAAG,SAAE+D,EAAQ,MAAE1B,GAA0BwH,EAAA,OAC3CwyB,IACC,MAAMr0B,EAAOjE,EAASC,YAAY82B,IAAiBt3B,WACvBO,EACzBC,YAAY+2B,IACZv3B,aACyB64B,GAI1Br8B,EACE+6B,GACA/yB,EAAKA,EAAKU,WAAWlP,GAAQA,IAAQ6iC,IAAU,IAAMr0B,EAAK,IAG9DhI,EAAI86B,IAAkBxhC,GAASA,EAAKgO,QAAQ9N,GAAQA,IAAQ6iC,MAC5Db,GAASjiC,SAAS2J,GAAUb,EAAMa,EAAMm5B,KAAS,CAClD,E,gBCrNH,MAAME,GAAQ,CAAC,EACFC,GAAuBA,CAClClf,EACAmI,IACGA,EAAEgX,OAAOC,UAAUC,UAAYrf,EAAEmf,OAAOC,UAAUC,U,gBCGvD,SAASC,GACP9xB,EACA+xB,EACAC,GAEA,YAFgD,IAAhDA,IAAAA,EAAmD,CAAC,GAEhDA,EAAMd,OACD,IAAIe,OAAOF,EAAOC,EAAMf,UAAY,GAAK,KAAKiB,KAAKlyB,GAEvDgyB,EAAMf,UAGJjxB,EAAM5G,SAAS24B,GAFb/xB,EAAMmyB,cAAc/4B,SAAS24B,EAAMI,cAG9C,CAQO,MAAMC,IAAkBx4B,EAAAA,EAAAA,IAA+B,CAC5DlL,IAAK,qBACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,ODJRkG,eACLsB,GAOA,MAAM0/B,EAAoC,GACpCC,EAA6C,CAAC,EACpD,IAAIC,EAA2D,GAE/DA,EAAiB9jC,SAAS0L,IACxBm4B,EAAWn4B,EAAKq4B,iBAAiBC,KAAOt4B,CAAI,IAC3C,QAAAu4B,EAAA7Q,UAAAjnB,OAZA+3B,EAAO,IAAA9yB,MAAA6yB,EAAA,EAAAA,EAAA,KAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAPD,EAAOC,EAAA,GAAA/Q,UAAA+Q,GAaV,MAAMC,QAAuB/gC,QAAQiF,IACnC47B,EAAQ1kC,SAAQ9C,IAAA,IAAC,KAAE2nC,EAAI,SAAEC,EAAQ,OAAEC,GAAQ7nC,EAAA,OACzC2nC,EAAK1kC,KAAIiD,UACP,MAAMsgC,QAAexvB,EAAAA,GAAAA,WACP,IACP8wB,EAAc,CAAEF,WAAUC,WAC7BrkB,MACA0gB,MAAO,IAERl5B,MAAMs8B,GACLtwB,EAAAA,GAAAA,WAAe,IACV8wB,EAAc,CAAEF,WAAUC,WAC7BP,UAGN,MAAO,CAAEM,WAAUC,SAAQrB,SAAQmB,KAAM,IAAIzwB,IAAI,CAACsM,IAAO,GACzD,KAWN,KAPAqB,EAAAA,GAAAA,IACE,CAAAjY,EAAAiC,KAAA,IAAG23B,OAAQuB,GAAIn7B,GAAI45B,OAAQwB,GAAIn5B,EAAA,OAAK03B,GAAqBwB,EAAIC,EAAG,GAChEN,GACApkC,SAAQkM,IAAA,IAAC,OAAEg3B,EAAM,KAAEmB,EAAI,SAAEC,EAAQ,OAAEC,GAAQr4B,EAAA,OAC3Cy4B,EAAU,CAAEL,WAAUC,UAAUrB,GAAS,EAAGmB,EAAK,IAG5CP,EAAiB33B,OAAS,GAAG,CAClC,MACE43B,iBAAkBa,EAAY,SAC9BN,EAAQ,OACRC,EAAM,eACNM,GACEf,EAAiBgB,QACrBlB,EAAWh4B,KAAK,CACd04B,WACAP,iBAAkBa,EAClBC,eAAgBA,WAEUxhC,QAAQiF,IAClCs8B,EAAa1B,OAAOjiB,OAAOthB,KAAKqkC,GAC9BtwB,EAAAA,GAAAA,WAAe,IACV8wB,EAAc,CAAEF,WAAUC,WAC7BP,YAKQhkC,SAASkjC,IACrB,MAAMh0B,EAAQ40B,EAAiB30B,WAC7BS,IAAA,IAAGm0B,iBAAkBgB,GAASn1B,EAAA,OAC5BqzB,GAAqB8B,EAAS7B,GAAU,CAAC,IAE7CyB,EAAU,CAAEL,WAAUC,UAAUrB,EAAQh0B,EAAO21B,EAAe,GAElE,CACA,OAAOjB,EAEP,SAASe,EAASr0B,EAEhB4yB,EACAh0B,EACAm1B,GACC,IAJD,SAAEC,EAAQ,OAAEC,GAAwBj0B,EAKpC,GAAIuzB,EAAWX,EAAOc,KACpBH,EAAWX,EAAOc,KAAKa,eAAiB,IAAIjxB,IAAI,IAC3CiwB,EAAWX,EAAOc,KAAKa,kBACvBR,QAEA,CACL,MAAM9K,EAAyC,CAC7CwK,iBAAkBb,EAClB2B,eAAgBhB,EAAWX,EAAOc,KAC9B,IAAIpwB,IAAI,IAAIiwB,EAAWX,EAAOc,KAAKa,kBAAmBR,IACtDA,EACJC,WACAC,UAEFV,EAAWX,EAAOc,KAAOzK,EACzBuK,EAAiBkB,OACf91B,GAAS,EAAIA,EAAQ40B,EAAiB33B,OACtC,EACAotB,EAEJ,CACF,CACA,SAASiL,EAAaj0B,GAMlB,IANmB,SACrB+zB,EAAQ,OACRC,GAIDh0B,EACC,MAAO,CACLrM,KACA8+B,SACA,CAACuB,EAAS,SAAW,OAAQD,EAEjC,CACF,CC7GI,CAIEpgC,MACGoC,EAAI0yB,IAAkBr5B,KACvB2J,IAAA,IAAC,SAAEmL,EAAQ,cAAEmkB,EAAa,eAAEE,GAAgBxvB,EAAA,MAAM,CAChDg7B,SAAU7vB,EACV4vB,KAAM,CAAC,QACJhlC,OAAOu5B,EAAcj5B,KAAK04B,GAAWA,EAAOp3B,QAC5C5B,OACCy5B,EAAen5B,KAAK04B,GAAY,GAAEA,EAAOH,UAAUG,EAAOp3B,UAE/D,IAEJ,IAGQgkC,IAAwB95B,EAAAA,EAAAA,IAAS,CAC5ClL,IAAK,eACLqG,IAAKiF,IAAc,IAAb,IAAEjF,GAAKiF,EACX,MAAMm2B,EAAcp7B,EAAIo8B,GAAuBhB,aACzCtJ,EAAW9xB,EAAIo8B,GAAuBrK,QACtCkL,EAAQ,CACZf,UAAWl8B,EAAIo8B,GAAuBF,WACtCC,OAAQn8B,EAAIo8B,GAAuBD,SAE/ByC,EAAa5+B,EAAIo8B,GAAuB5B,MAExC5sB,EAAO5N,EAAIq9B,IACd51B,QACC7B,IAAA,IAAC,eAAE24B,GAAgB34B,EAAA,OAChBksB,GAAUjsB,QACXisB,EAASxE,MAAMyE,GAAWwM,EAAelP,IAAI0C,IAAQ,IAExDtqB,QACC6B,IAAA,IAAGm0B,kBAAkB,OAAEb,IAAUtzB,EAAA,QAC7Bs1B,GAAY7D,MACc,IAA1B6B,EAAOiC,OAAO/B,UAAmB8B,EAAW7D,KAAK+D,cACjDF,GAAY5D,IACc,IAA1B4B,EAAOiC,OAAO/B,UAAmB8B,EAAW5D,GAAG8D,UAAU,IAE9Dr3B,QACCuC,IAAA,IAAGyzB,kBAAkB,OAAEb,IAAU5yB,EAAA,OAC9BoxB,GACD2B,GAAMH,EAAO/a,QAASuZ,EAAa6B,IACnCF,GAAMH,EAAOmC,KAAM3D,EAAa,CAAEc,WAAW,GAAQ,IAE3D,MAAO,CACLtuB,OACAoxB,OAAOC,EAAAA,GAAAA,IAAQh1B,IAAA,IAAGwzB,iBAAkBb,GAAQ3yB,EAAA,OAAK2yB,EAAOc,GAAG,GAAE9vB,GAC9D,IAIQsxB,IAAuBr6B,EAAAA,EAAAA,IAAS,CAC3ClL,IAAK,oBACLqG,IAAKmK,IAAc,IAAb,IAAEnK,GAAKmK,EACX,MAAMg1B,EAAen/B,EAAI0yB,IACnBqL,EAAiC,CAAC,EAClCqB,EAASA,CAACxlB,EAAahgB,KAC3BmkC,EAAKnkB,GAAOmkB,EAAKnkB,IAAQ,GACzBmkB,EAAKnkB,GAAKtU,KAAK1L,EAAM,EA2BvB,OAzBAulC,EAAazlC,SAAQ2Q,IAAmB,IAAlB,SAAE8D,GAAU9D,EAChC+0B,EAAOp/B,EAAIq6B,GAAiB,CAAElsB,WAAUyL,IAAK,UAAY,CACvD1X,KAAM,OACNvH,KAAM,QACN,IAEJwkC,EAAazlC,SAAQk2B,IAAiD,IAAhD,SAAEzhB,EAAQ,cAAEmkB,EAAa,cAAEC,GAAe3C,EAC9D0C,EAAc54B,SAASq4B,IACrBqN,EAAOp/B,EAAIq6B,GAAiB,CAAElsB,WAAUyL,IAAKmY,EAAOp3B,QAAU,CAC5DuH,KAAM,cACNvH,KAAMo3B,EAAOp3B,KACb0kC,UAAW9M,GAAe53B,OAASo3B,EAAOp3B,KAC1Cq3B,eAAgBD,EAAOC,gBACvB,GACF,IAEJmN,EAAazlC,SAAQo2B,IAAA,IAAC,SAAE3hB,EAAQ,eAAEqkB,GAAgB1C,EAAA,OAChD0C,EAAe94B,SAASq4B,IACtB,MAAMe,EAAc,GAAEf,EAAOH,UAAUG,EAAOp3B,OAC9CykC,EAAOp/B,EAAIq6B,GAAiB,CAAElsB,WAAUyL,IAAKkZ,KAAgB,CAC3D5wB,KAAM,eACNvH,KAAMm4B,GACN,GACF,IAEGiL,CAAI,IAQFuB,IAAwB76B,EAAAA,EAAAA,IAAgB,CACnD9K,IAAK,4BACLmJ,QAAS,IAAIwK,IAAI,MAMNiyB,IAAqB16B,EAAAA,EAAAA,IAAS,CACzClL,IAAM,GAAE2lC,GAAsB3lC,WAC9BqG,IAAKywB,IAAc,IAAb,IAAEzwB,GAAKywB,EACX,MAAMhd,EAAYzT,EAAIs/B,IACtB,MAAkB,QAAd7rB,EACKzT,EAAI2+B,IAAuB/wB,KAAKvU,KACrCw3B,IAAA,IAAG4M,kBAAkB,IAAEC,IAAO7M,EAAA,OAAK6M,CAAG,IAGnC,IAAIjqB,GAAWpa,KAAKukB,GAAO,GAAEA,KAAI,IAI/B4hB,IAAuB36B,EAAAA,EAAAA,IAAS,CAC3ClL,IAAM,GAAE2lC,GAAsB3lC,YAC9BqG,IAAKixB,IAAA,IAAC,IAAEjxB,GAAKixB,EAAA,OACXjxB,EAAIu/B,IAAoBlmC,KAAKqkC,GAAQ19B,EAAI2+B,IAAuBK,MAAMtB,IAAK,IAMlE+B,IAAsB56B,EAAAA,EAAAA,IAAS,CAC1ClL,IAAK,iCACLqG,IAAK0/B,IAAc,IAAb,IAAE1/B,GAAK0/B,EACX,MAAMhC,EAAM19B,EAAIu/B,IAAoB,GACpC,OAAQ7B,GAAO19B,EAAI2+B,IAAuBK,MAAMtB,IAAS,IAAI,IAIpDiC,IAAmCl7B,EAAAA,EAAAA,IAAc,CAC5D9K,IAAK,sCACLmJ,SAAS,IAGE88B,IAAmCn7B,EAAAA,EAAAA,IAAc,CAC5D9K,IAAK,sCACLmJ,SAAS,IAGE+8B,IAAkCp7B,EAAAA,EAAAA,IAAc,CAC3D9K,IAAK,qCACLmJ,SAAS,IAGEg9B,GAAe,CAC1BhsB,GAAI,iBACJnZ,KAAM,UAEKolC,GAAa,CACxBjsB,GAAI,eACJnZ,KAAM,QAGKqlC,GAAa,CACxBlsB,GAAI,YACJnZ,KAAM,QAGFslC,GAAwB,CAACH,GAAahsB,GAAIksB,GAAWlsB,IAC9CosB,IAAiCr9B,EAAAA,EAAAA,IAA4B,CACxElJ,IAAK,qCACLmJ,QAAUgR,GAAOmsB,GAAsB57B,SAASyP,KCrL5CqsB,GAA0B,IAAIpf,GAAAA,EACjC,iFAID,SAOK,SAASqf,KACd,MAAMpgB,EAAoBtR,KACpB2xB,GAAiBC,EAAAA,EAAAA,KACjBC,EAAU3H,KAEhB,OAAO30B,EAAAA,EAAAA,KACL7N,IAAA,IAAC,SAAE8N,EAAQ,IAAE/D,EAAG,QAAEsC,GAASrM,EAAA,MACzB,CAACwwB,EAA+B4Z,KAC9B,MAAMC,EAASF,EACb,CAAE/wB,MAAO,gBAAiBwpB,cAAc,GACxC,CACEW,IAAKr9B,UAAiC,IAA1B,iBAAEy9B,GAAkB/2B,EAC9B+2B,GAAiB,GACjB,MAAM2G,GAAuBrN,EAAAA,GAAAA,IAC3BpuB,IAAA,IAAC,SAAEkJ,GAAUlJ,EAAA,OAAKkJ,CAAQ,UAElBpR,QAAQiF,IACZ4kB,EAAQvtB,KAAIiD,UACV,MAAMmB,EAAWsnB,GAAOpsB,KAAKmsB,GACvB3W,EAAWjK,EACdC,YAAYqJ,GAAe/P,IAC3BkG,WACG1E,QAAiBrB,GAAGN,SAASE,OAAOC,SAChCG,GAAGN,SAAS4B,SAASzB,GAC3B,KACJ,OAAO0Q,EACH,CACEA,WACA1Q,SAAU9E,IAAAA,SAAcwV,EAAU1Q,GAClCwB,WAEF,IAAI,MAGZwI,OAAO8F,GAAAA,UAELxQ,QAAQiF,IACZxI,OAAO+sB,QAAQma,GAAsBrnC,KACnCiD,UAA8B,IAAtB6R,EAAUjJ,GAAMU,EACtB,MAAM0G,EAAUpH,EAAM8iB,QAGpB,CAAC2Y,EAAKr3B,KAAA,IAAE,SAAE7L,EAAQ,QAAEwB,GAASqK,EAAA,MAAM,IAC9Bq3B,EACH,CAACljC,GACoB,iBAAZwB,GACH,IAAI2hC,aAAcC,OAAO5hC,GACzBA,EACP,GACD,CAAC,SCxEhB3C,eAA0BlG,GAa7B,IAb8B,QAChCkW,EAAO,GACP1O,EAAE,IACF8O,EAAG,OACHo0B,KACG1lC,GAQJhF,EACC,MAAM2qC,QAAoB3zB,EAAAA,GAAAA,WAAe,CAAExP,KAAI8O,MAAKo0B,SAAQlnB,IAAK,SAO3D2M,SANiBnZ,EAAAA,GAAAA,SAAa,CAClCxP,KACA8O,MACAo0B,SACApD,IAAKqD,KAEkBhC,KAEzB,IAAIiC,GAAiB,EA6BrB,SA3BMjkC,QAAQiF,IACZxI,OAAO+sB,QAAQja,GAASjT,KAAIiD,UAA6B,IAArBmB,EAAUwjC,GAAKj+B,EACjD,MAAM4F,EAAQ2d,EAAQ1d,WAAU5D,IAAA,IAAC,KAAEtM,GAAMsM,EAAA,OAAKtM,IAAS8E,CAAQ,IAC/D,GAAY,MAARwjC,EAMF,YAJIr4B,GAAS,IACXo4B,GAAiB,EACjBza,EAAQmY,OAAO91B,EAAO,KAI1B,MAAMqqB,EAAQ1M,EAAQ3d,GAChB80B,QAAYtwB,EAAAA,GAAAA,UAAc,CAAExP,KAAI8O,MAAKo0B,SAAQG,SAC/ChO,EACFA,EAAMyK,IAAMA,EAEZnX,EAAQjhB,KAAK,CACXpD,KAAM,OACNg/B,KAAM,SACNxD,MACA/kC,KAAM8E,IAGVujC,GAAiB,CAAI,MAIpBA,EACH,MAAM,IAAInhC,MAAM,sBAGlB,MAAMshC,QAAmB/zB,EAAAA,GAAAA,UAAc,CAAExP,KAAI8O,MAAKo0B,SAAQ/B,KAAMxY,IAG1D6a,QAAkBh0B,EAAAA,GAAAA,OAAW,IAC9BhS,EACHwC,KACA8O,MACAo0B,SACA/B,KAAMoC,UAIFpkC,QAAQiF,IACZxI,OAAOC,KAAK6S,GAASjT,KAAKjB,GACxBgV,EAAAA,GAAAA,WAAe,CACbxP,KACA8O,MACAo0B,SACA1oC,WACAwhB,IAAKwnB,MAIb,CDL0BC,CAAY,CAChBzjC,GAAE,GACF8O,IAAKyB,EACL7B,UACAuV,QAAS2e,EACT3B,OAAQ,CAENlkC,KAAM,UACN2mC,MAAO,8BAGX,MAAM/O,QAAsBruB,EAAS8D,WACnCqqB,GAA2BlkB,IAEzBokB,GACF9vB,EACE43B,GAAiB,CACflsB,WACAyL,IAAK2Y,KAIX9vB,EAAQ43B,GAAiB,CAAElsB,WAAUyL,IAAK,SAAU,KAGxDxY,MACA,KACEqB,EAAQ46B,IAERrd,IAAoBvgB,MAAMH,QAAQ4D,OAElCm9B,EAAe/wB,KAAK,CAClBC,KAAM,OACNE,KACEja,EAAAA,cAAAA,EAAAA,SAAA,KACI,GAAE2qC,GAAwBne,OAAO,CACjCD,MAAO6E,EAAQ/gB,aAEhB26B,EACEjoC,MAAM,MACNW,SAAQ,CAACwiC,EAAM9yB,IAAU,CAACpT,EAAAA,cAAA,MAAImE,IAAKiP,IAAW8yB,KAC9Ch0B,MAAM,KAGb,IAEHhI,IACC2gC,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,iBACPC,KAAM,4BAERnQ,QAAQ4D,MAAM,eAAgBxD,EAAE,GAEnC,EAEHw6B,WAAYA,KACV/5B,EAAIowB,GAAmB,KAAK,IAIlCpwB,EAAIowB,GAAmBkQ,EAAO,CAC/B,GACH,GAEJ,CEhIA,MAAMc,GAA+BxrC,EAAAA,GAAO+Z,GAAI;gBAChC1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACtBgE,EAAMK,KACF,UACA,MAAM;;;;EAKR+mC,GAA8BzrC,EAAAA,GAAO0rC,QAAS;;;;WAIzCz+B,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACjB5I,EAAMK,KACF,UACA,MAAM;;;;;EAMRinC,GAAyB3rC,EAAAA,GAAO+Z,GAAI;;;;EAKpC6xB,GAAqB5rC,EAAAA,GAAO+Z,GAAI;;;;;;WAM3B7K,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAM8V,aAAaykB,GAAG;EAMzC,SAASiN,GAAUh8B,GAItB,IAJuB,UACzB2M,GAGD3M,EACC,MAAMi8B,GAA2Bx7B,EAAAA,EAAAA,QAA4B,OACtDm6B,EAAesB,IAAoB1kB,EAAAA,EAAAA,IAAeiT,IACnDuM,EAASwD,KACT2B,GAAQn3B,EAAAA,EAAAA,IAAewlB,IACvBiQ,GAAiBC,EAAAA,EAAAA,MAChB0B,EAAcC,IAAmB7kB,EAAAA,EAAAA,IACtCkT,IAEI4R,GAAet3B,EAAAA,EAAAA,IAAe2lB,KAEpC9sB,EAAAA,EAAAA,YAAU,KACJ+8B,GACFyB,EAAgB,GAClB,GACC,CAACzB,IAEJ,MAAM2B,GAAwBl+B,EAAAA,EAAAA,KAAkBqF,IAAmB,IAAlB,SAAEpF,GAAUoF,EAC3D,MAAMmkB,EAAkBvpB,EACrBC,YAAYgrB,IACZxrB,WACG68B,EAAgBt8B,EAASC,YAAYksB,IAAoB1sB,WAC/D,MAAO,KAC0B,IAA3B8pB,EAAgB5nB,OAIf26B,EAIDt8B,EAASC,YAAYisB,IAAkBzsB,WACzC08B,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,qBACPC,KAAM,2CAIVmtB,EAAOnP,EAAiB+S,GAXtByB,EAAgB,0BAJhBA,EAAgB,yBAeoB,CAEvC,GACA,KAEG,SAAEG,IAAaC,EAAAA,GAAAA,KAYrB,OAVAC,EAAAA,EAAAA,qBACE/vB,GACA,MACEvJ,MAAOA,KACL64B,EAAyBv7B,SAAS0C,OAAO,KAG7C,IAIAxT,EAAAA,cAAC+rC,GAA4B,KAC3B/rC,EAAAA,cAACgsC,GAA2B,CAC1B5nB,IAAKioB,EACLjoC,MAAO4mC,EACPxoB,SAAW/F,IACT6vB,EAAiB7vB,EAAM3T,OAAO1E,MAAM,EAEtC2oC,YAAY,iBACZ,aAAW,UAEZP,GACCxsC,EAAAA,cAACmsC,GAAkB,KACjBnsC,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,sBAAsB,IAAEyyB,GAG/CxsC,EAAAA,cAACksC,GAAsB,KACrBlsC,EAAAA,cAAC8pB,GAAAA,EAAM,CACLkjB,qBAAmB,EACnBjjB,QAAS6iB,EAAW,eAAYxlB,EAChChN,QAASuyB,EACTjhB,WAA4B,MAAhBghB,EACZO,SAAS,KAERV,EAAQ,eAAiB,UAE5BvsC,EAAAA,cAAC8pB,GAAAA,EAAM,CAACkjB,qBAAmB,EAAC5yB,QAASP,GAAgBozB,SAAS,KAC3DV,EAAQ,2BAA6B,uBAKhD,CAACH,GAAA/rC,aAAA,kf,gBCpJM,MAAM6sC,GAAiBtsC,IAIvB,IAJwB,QAC7BwwB,GAGDxwB,EACC,MAAMusC,EAAgB/b,EAAQnf,QAC3Bqd,GAAyC,aAA9BC,GAAOhW,WAAW+V,KAC9Bjf,OACI+8B,EAAahc,EAAQnf,OAAOsd,GAAOe,YAAYjgB,OAC/Cg9B,EAAejc,EAAQnf,OAAOsd,GAAOgB,YAAYlgB,OAEvD,OACErQ,EAAAA,cAAAA,EAAAA,SAAA,KACGotC,EAAa,GACZptC,EAAAA,cAAC0Z,GAAW,CAAChO,OAAO,SAAS0hC,EAAW,UAEzCD,EAAgB,GACfntC,EAAAA,cAAC0Z,GAAW,CAAChO,OAAO,YAAYyhC,EAAc,aAE/CE,EAAe,GACdrtC,EAAAA,cAAC0Z,GAAW,CAAChO,OAAO,WAAW2hC,EAAa,YAE7C,EAELH,GAAA7sC,aAAA,iMCVF,MAAMitC,GAAmB/sC,EAAAA,GAAO+Z,GAAI;;;;EAK9BizB,IAAsBhtC,EAAAA,EAAAA,IAAOitB,GAAAA,EAAU;;EAGvCggB,GAAgCjtC,EAAAA,GAAOy+B,IAAK;;;;gBAIlCp+B,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACtBgE,EAAM0U,MAAM,mBAA2D;;EAGrEm0B,GAA4BA,KAChC,MAAMrc,GAAUhc,EAAAA,EAAAA,IAAeukB,IAC/B,OAAO35B,EAAAA,cAACktC,GAAc,CAAC9b,QAASA,GAAW,EAOtC,SAASsc,KACd,MAAOnB,EAAOoB,IAAY/lB,EAAAA,EAAAA,IAAegT,IAEzC,OACE56B,EAAAA,cAACstC,GAAgB,KACfttC,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAAC4tC,GAAAA,EAAiB,CAChBltB,WAAW,eACXmJ,SAAS,qDAIX9pB,GACAC,EAAAA,cAAA,OAAUD,EACRC,EAAAA,cAACutC,GAAmB,CAClB/jB,WAAY+iB,EACZ/pB,SAAWpe,IACTupC,EAASvpC,GAETypC,IAAoB,EAEtBC,cAAY,EACZb,SAAS,KACV,YAMPjtC,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,yBAEnC1gB,EAAAA,cAACiiC,GAAAA,GAAU,CAAC7nB,QAASP,IACnB7Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBAGvB/Z,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,4BAEnC1gB,EAAAA,cAACiiC,GAAAA,GAAU,CAACvW,YAAU,EAACtR,QAASP,IAC9B7Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,4BAGvB/Z,EAAAA,cAACwtC,GAA6B,KAC5BxtC,EAAAA,cAACytC,GAAyB,OAIlC,CAACC,GAAArtC,aAAA,sMCxED,MAAM0tC,GAAsB,IAAIxiB,GAAAA,EAC7B,4EAID,SAGIyiB,GAAwB,IAAIziB,GAAAA,EAC/B,+EAID,SAGI0iB,IAA+C5+B,EAAAA,EAAAA,IAAS,CAC5DlL,IAAK,0CACLqG,IAAK5J,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,MACX,IAAI4J,EAAI4uB,IAA0Br1B,UAC/BkO,QAAQqd,GAA2B,YAAhBA,EAAO5iB,OAC1B7I,IAAI0rB,GAAOpsB,KAAK,IAGjBsoB,IAAoBpc,EAAAA,EAAAA,IAAS,CACjClL,IAAM,0BAAyB4W,GAAAA,EAAewM,SAC9C/c,IAAKgD,IAAA,IAAC,IAAEhD,EAAG,YAAEsK,GAAatH,EAAA,MAAwB,CAChD8Q,GAAIvD,GAAAA,EAAewM,OACnBvN,MAAO,SACPuE,YAAa,uBACbmN,WAAyE,IAA7DlhB,EAAIyjC,IAA8C59B,OAC9DsO,gBAAiB7J,GAAaZ,GAAsBpN,UAClD,MAAM,SAAE4H,GAAawF,EACfg6B,EAActjB,GAAoB1W,GAClCi6B,EAAgBz/B,EACnBC,YAAYs/B,IACZ9/B,WAEG4d,EAAcrd,EACjBC,YAAYgD,IACZxD,WAAW2C,QACd,GAA6B,IAAzBq9B,EAAc99B,OAChB,aAEsB0b,GAAaI,QAAQ,CAC3CnS,MAAO,SACPoS,OAAQ,SACRC,QACErsB,EAAAA,cAAA,OACEyZ,MAAO,CAAE6S,MAAO,MACf,mCAAkC0hB,GAAsBxhB,OAAO,CAChED,MAAO4hB,EAAc99B,kBAKzBvG,QAAQiB,IAAK,YAAWojC,WAClBD,EAAYC,GACpB,IAEH,IAGI,SAASC,KACd,MAAM3U,GAAsBrkB,EAAAA,EAAAA,IAAemkB,IACrC8U,GlChCN5/B,EAAAA,EAAAA,KACEgB,IAAA,IAAC,IAAE9E,EAAG,SAAE+D,GAAUe,EAAA,OACf6+B,IACC,MAAM5c,EAAchjB,EAASC,YAAYuiB,IAAkB/iB,WACrDogC,EAAmB7c,EAAY9a,MACnCxG,IAAA,IAAC,GAAEkO,GAAIlO,EAAA,OAAKkO,IAAOgwB,CAAY,IAE7BC,GACF5jC,EACEumB,GACAQ,EAAY7tB,KAAKytB,IAAU,IACtBA,EACHtU,OAAQsU,IAAeid,MAG7B,CAED,GACH,IkCeIC,EAA+B,IAAI/U,GAAqBxnB,QAC3DyrB,IAAUA,EAAK1gB,SAEZ/P,EAAUiM,KAEVgB,EAA8B,CAClC,CACEoE,GAAIvD,GAAAA,EAAe2Y,QACnB1Z,MAAO,UACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACzB4E,gBAAiB1R,GAEnB,CACEqR,GAAIkV,GAAaG,gBACjB3Z,MAAO,kBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,yBACzB4E,gBAAiB9E,KAEnBzE,EAAAA,EAAAA,IAAeqW,KAmCjB,OAhCiC,IAA7BgO,EAAoB3sB,MAEtBoN,EAAQpK,KAAK,CACXwO,GAAIkV,GAAaQ,kBACjBha,MAAO,qBACPuE,YAAa,mDACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACzB4E,gBAAiB9E,KAGjB20B,EAA6Bn+B,OAAS,GACxC6J,EAAQpK,KAAK,CACXwO,GAAIkV,GAAaS,kBACjBja,MAAO+zB,GAAoBvhB,OAAO,CAChCD,MAAOiiB,EAA6Bn+B,SAEtCkO,YAAa,oDACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBACzB4E,gBAAiB9E,KAGuB,IAAxC20B,EAA6Bn+B,QAC/B6J,EAAQpK,KAAK,CACXkK,MAAO,wBACPuE,YAAa,4DACbD,GAAIkV,GAAaU,uBACjBna,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,0BACzB4E,gBAAiBA,KACf0vB,EAAoBG,EAA6B,GAAGlwB,GAAG,IAItDpE,CACT,CCtHA,MAAMG,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;EAM7Bm0B,GAAwBluC,EAAAA,GAAO+Z,GAAI;;;;EAMnCo0B,GAAuBnuC,EAAAA,GAAO+Z,GAAI;;;;;EASxC,IAAIhV,GAAuC,KAEhCuoC,GAAqBA,KAC9Bj6B,YAAW,KACTtO,IAAQkO,OAAO,GACf,EAGG,MAAMm7B,GAAsBA,KACjC,MACE9gC,OAAO,OAAE+gC,KACPC,EAAAA,GAAAA,KACE7oB,GAAUnV,EAAAA,EAAAA,QAAqB,MAC/BkM,GAAYlM,EAAAA,EAAAA,QAA8B,MAC1C8pB,GAAcmU,EAAAA,GAAAA,IAAqBF,GACnCG,GAAW35B,EAAAA,EAAAA,IAAeqD,KACzBu2B,EAAmBC,IAAwBrnB,EAAAA,EAAAA,IAChD8S,GAAuBC,IAEnBuU,EAAqBd,KACrBe,GAAchhB,EAAAA,GAAAA,GAAe,CAAEnI,YAKrC,OAFA1gB,GAASyX,EAAUjM,QAGjB9Q,EAAAA,cAACovC,GAAAA,EAAiB,CAChBzU,YAAaA,EACb0U,UACErvC,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAAS,IAAIi1B,KAAgBD,KAC3CtuC,IAAA,IAAC,qBAAE0e,GAAsB1e,EAAA,OACxBZ,EAAAA,cAACqa,GAAoBiF,EACnBtf,EAAAA,cAAC4iC,GAAkB,MACnB5iC,EAAAA,cAACyuC,GAAqB,KACnBM,GACC/uC,EAAAA,cAACgvB,GAAO,KACNhvB,EAAAA,cAAC0uC,GAAoB,KACnB1uC,EAAAA,cAACF,EAAU,QAIjBE,EAAAA,cAACohC,GAAc,CAACpb,QAASA,KAE3BhmB,EAAAA,cAAC0tC,GAAgB,MACD,IAIxB4B,iBAAkB,GAClBC,SAAUvvC,EAAAA,cAACosC,GAAU,CAACrvB,UAAWA,IACjCyyB,SAAUR,EACVS,aAAcR,GACd,EAEJN,GAAAtuC,aAAA,8DCvFF,MAAMga,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;WAMxB1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAag1B,iBAAiB;;EAGvD,SAASC,KACd,MAAMC,GAAgBC,EAAAA,EAAAA,MACtB,OACE7vC,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAAA,OAAKyZ,MAAO,CAAEq2B,UAAW,WAAY,qBAChB,IACnB9vC,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASA,IAAMw1B,EAAcpc,GAAaoB,WAAW,4BAG3D50B,EAAAA,cAAA,WAAM,0BACkB,IACxBA,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASP,IAAgB,oBAC/B7Z,EAAAA,cAAA,WACAA,EAAAA,cAAA,WACAA,EAAAA,cAAC0e,EAAAA,GAAY,CACXjF,MAAO,CAAEs2B,cAAe,YACxBh2B,KAAK,4BACJ,IACH/Z,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASP,IAAgB,+BAAmC,KAI1E,CAAC81B,GAAAtvC,aAAA,+DClCD,MAAMga,GAAkB9Z,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,mCAAAC,YAAA,gBAAVH,CAAU,qDAMrByvC,GAAkBA,KAC7B,MAAMC,GAAW76B,EAAAA,EAAAA,IAAemC,IAChC,OACEvX,EAAAA,cAACqa,GAAe,KACb41B,EAAS5/B,OAAS,EAAIrQ,EAAAA,cAAC2uC,GAAmB,MAAM3uC,EAAAA,cAAC2vC,GAAoB,MACtD,ECbf,SAASO,GAAkBtvC,GAI9B,IAJ+B,SACjC07B,GAGD17B,EACC,OACEZ,EAAAA,cAAA,SAAOyZ,MAAO,CAAE02B,cAAe,IAC5B7T,EAASz4B,KAAI2J,IAA2B,IAA1B,OAAE+uB,EAAM,SAAE5jB,GAAUnL,EACjC,MAAMkK,EAAU6kB,EAAOC,eAClB,GAAED,EAAOp3B,eAAUo3B,EAAOC,iBAC3BF,EAASjsB,OAAS,EACjB,GAAEksB,EAAOp3B,4BACV,qBAEJ,OAAOm3B,EAASjsB,OAAS,EACvBrQ,EAAAA,cAAA,MAAImE,IAAKwU,GACP3Y,EAAAA,cAAA,UAAKmD,IAAAA,SAAcwV,GAAU,UAC7B3Y,EAAAA,cAAA,UAAK0X,IAGP1X,EAAAA,cAAA,MAAImE,IAAKwU,GACP3Y,EAAAA,cAAA,UAAK0X,GAER,IAIT,CDZEs4B,GAAA3vC,aAAA,0DCYD6vC,GAAA7vC,aAAA,sZCfM,MAAM+vC,GAAuB,SAE9BC,IAAuBhhC,EAAAA,EAAAA,IAAS,CACpClL,IAAK,oCACLqG,IAAK5J,IAAgE,IAA/D,IAAE4J,GAAK5J,EAKX,OAJyB4J,EAAIwmB,IAC1BntB,KAAKyrB,GAAW9kB,EAAIwN,GAAeuX,GAAOpsB,KAAKmsB,OAC/Crd,OAAO8F,GAAAA,GAGPlU,KAAK8U,IACJ,MAAM4jB,EAAS/xB,EAAImyB,GAAkBhkB,IAAWokB,cAChD,OAAOR,EACH,CACE5jB,WACA4jB,UAEF,IAAI,IAETtqB,OAAO8F,GAAAA,EAAQ,IAITu4B,GAAmBA,KAC9B,MAAMC,GAA0Bn7B,EAAAA,EAAAA,IAC9B2jB,GAA2B,eAEvByX,GAAkBp7B,EAAAA,EAAAA,IAAei7B,IACjCr2B,GACHu2B,GAA2BC,EAAgB,GACvC,aAAYA,EAAgB,IAAIjU,QAAQp3B,MAAQ,MACjD,SAEN,OACEnF,EAAAA,cAACywC,GAAAA,EAAmB,KAClBzwC,EAAAA,cAACywC,GAAAA,EAAoBC,KAAI,CACvBC,WACE3wC,EAAAA,cAACugB,EAAAA,EAAc,CACbmL,WAAY6kB,GAAsD,IAA3BC,EAAgBngC,OACvDmQ,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CACZC,WAAY1gB,EAAAA,cAACkwC,GAAkB,CAAC5T,SAAUkU,OAI9CxwC,EAAAA,cAAA,YAAOga,IAGX7V,IAAI,UAEJnE,EAAAA,cAACgwC,GAAe,OAEE,EC9DnB,SAASY,GAA6BhwC,GAIzC,IAJ0C,SAC5CE,EAAW,MAGZF,EAcC,OAbAqN,EAAAA,EAAAA,YAAU,KACR,MAAMwC,EAAiBogC,SAASC,cAChC,MAAO,KAEHrgC,aAA0BsgC,aAC1BtgC,IAAmBogC,SAASC,eAC5BD,SAASC,gBAAkBD,SAAS52B,MACpCxJ,EAAeugC,aAEfvgC,EAAe+C,OACjB,CACD,GACA,IACIxT,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,EACZ,CD6CEwvC,GAAAjwC,aAAA,2DC7CDuwC,GAAAvwC,aAAA,6c,gBCxBM,MAAM4wC,GAAe1wC,EAAAA,GAAO+Z,GAAI;;;;;6BAKV1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAaw2B,WAAW;;EAG7DC,GAAe5wC,EAAAA,GAAO+Z,GAAI;;EAG1B82B,GAA6B7wC,EAAAA,GAAO+Z,GAAI;WAC1C9M,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM8V,aAAag1B,iBAAiB;;;;;;;;kBCZvD,MAAM2B,GAAsBrG,IACjC,MAAMsG,EAAQtG,EAAcjoC,MAAM,MAC5BwuC,EAAYD,EAAMp/B,MAAM,GAC9B,MAAO,CACLs/B,QAASF,EAAM,GACfG,aAAcF,EAAUr7B,KAAK,MAC7B+D,KACEja,EAAAA,cAAAA,EAAAA,SAAA,KACGuxC,EAAU1tC,KAAI,CAAC6tC,EAAMt+B,IACpBpT,EAAAA,cAACA,EAAAA,SAAc,CAACmE,IAAKiP,GAClBA,EAAQ,GAAKpT,EAAAA,cAAA,WACb0xC,MAKV,EAGI,SAASC,GAAWzJ,GACzB,OAAOA,EAAIh2B,MAAM,EAAG,EACtB,CAEA,MAAM0/B,GAA0B,IAAIC,KAAKC,eAAe,GAAI,CAC1DC,IAAK,UACLC,MAAO,UACPC,KAAM,UACNC,KAAM,UACNC,OAAQ,UACRC,QAAQ,IAGJC,GAAsB,IAAIR,KAAKC,eAAe,GAAI,CACtDI,KAAM,UACNC,OAAQ,UACRC,QAAQ,IAGJE,GAAsB,IAAIT,KAAKC,eAAe,GAAI,CACtDC,IAAK,UACLC,MAAO,UACPC,KAAM,Y3B+EJM,O4BpFG,MAAMC,GACXxS,GACE,CACEyS,c5BiFFF,G4B1FDntB,GACE,cAAausB,GAAWxuC,IAAAA,SAAciiB,EAAK8iB,SAAS9iB,EAAKosB,QAAQt/B,MAChE,EACA,M5ByFJ,CAACkT,EAAIhV,KAAA,IAAE,UAAEsoB,GAAWtoB,EAAA,MAAM,CACxBgQ,UAAWmyB,GAAQntB,GACnBya,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAACipB,GAAAA,EAAoB,MACrBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAEuW,GAAgB/G,KAGvC,I4BzFC,CACEoG,KA1BiDc,CACrDxa,EAAIxkB,KAAA,IACJ,UAAE83B,GAAW93B,EAAA,MACT,CACJwf,UAAWjd,IAAAA,SAAciiB,EAAK4Q,WAAW9e,KACzC2oB,SACE7/B,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAACq/B,GAAa,CAACH,SAAU9Z,EAAK4Q,WAAW9e,MACzClX,EAAAA,cAACipB,GAAAA,EAAoB,MACrBjpB,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAEuW,GAAgB/G,KAGvC,ICzBKwO,GAAQ,CAAC,E,gBCAf,MAAMwL,GAA2B,GAO1B5rC,eAAe6rC,GACpBvhB,GAEA,OA2BFtqB,eACEsqB,GAEA,MAAMwhB,EAAYxhB,EAAQnf,OAAOsd,GAAOgB,YAClCsiB,EAAYzhB,EAAQnf,OAAOsd,GAAOe,YAElCpiB,EAAW,IAAI+W,IACf6tB,EAAahsC,UACZoH,EAAS1D,IAAI8kB,IAChBphB,EAASvD,IAAI2kB,QAAcC,GAAO9lB,QAAQ6lB,IAErCphB,EAAS1D,IAAI8kB,IAAW,IAE3ByjB,EAAgB,IAAI9tB,IAuB1B,aAnBM1d,QAAQiF,IACZomC,EAAU/uC,KAAIiD,SACLS,QAAQiF,IACbqmC,EAAUhvC,KAAIiD,UACZ,MAAMksC,QAmDhBlsC,eAAiCmsC,EAAsBC,GACrD,OAAO,IAAI3rC,SAAgB,CAACC,EAASe,MACnC4qC,EAAAA,GAAAA,IAAUF,EAAcC,GAAc,SAAC1qC,EAAKpE,GAC1C,QAD+C,IAALA,IAAAA,EAAQ,IAC9CoE,EACF,OAAOD,EAAOC,GAEhB,MAAM,UAAE4qC,EAAS,MAAEza,GAAUv0B,EAAMouB,QACjC,CAAAhlB,EAAuB8hB,KAAY,IAAlC,MAAEqJ,EAAK,UAAEya,GAAW5lC,EACnB,MAAM+e,EAAQ+C,EAAO/C,OAAS,EAE9B,MAAO,CACLoM,MAAOA,EAAQpM,EACf6mB,UACEA,GAAc9jB,EAAO+jB,OAAU/jB,EAAOgkB,QAAkB,EAAR/mB,GACnD,GAEH,CAAEoM,MAAO,EAAGya,UAAW,IAEzB5rC,EAAe4rC,EAAYza,EAAnB,IACV,GAAE,GAEN,CAxEmC4a,OACjBT,EAAWU,SACXV,EAAWW,IAEbC,EAAmBX,EAAcvoC,IAAIgpC,GAEzCR,GAAcN,MACZgB,GAAoBV,EAAaU,EAAiBV,aAEpDD,EAAcpoC,IAAI6oC,EAAU,CAAER,aAAYxN,GAAIiO,GAChD,QAKDE,GAAaZ,EAAe3hB,EACrC,CAhESwiB,CAGT,SACExiB,GAEA,MAAMwhB,EAAYxhB,EAAQnf,OAAOsd,GAAOgB,YAClCsiB,EAAYzhB,EAAQnf,OAAOsd,GAAOe,YAExC,OAAOqjB,GACL,IAAI1uB,IACF2tB,EACG/uC,KAAK2vC,IACJ,MAAMjM,EAAQsL,EAAUj8B,MACtBhW,IAAA,IAAG6uB,OAAO,KAAEokB,IAAQjzC,EAAA,OAAKizC,IAASL,EAAShkB,OAAOqkB,IAAI,IAExD,OAAItM,EACK,CAACiM,EAAU,CAAEhO,GAAI+B,IAEnB,IAAI,IAEZt1B,OAAO8F,GAAAA,IAEZqZ,EAEJ,CAzBqC0iB,CAAyB1iB,GAC9D,CAiEA,SAASuiB,GACPZ,EACA3hB,GAEA,MAAM2iB,EAA8B,IAAIhB,EAAchvC,UAAUF,KAC7DmwC,GAAWA,EAAOxO,KAErB,OAAOpU,EACJvtB,KAAKyrB,IACJ,GAAIC,GAAOgB,WAAWjB,GAAS,CAC7B,MAAM2kB,EAAYlB,EAAcvoC,IAAI8kB,GACpC,GAAI2kB,EACF,OAAO1kB,GAAOD,EAAOE,OAAQykB,GAAWzO,GAAG/V,MAE/C,CACA,OAAOH,CAAM,IAEdrd,QAAQqd,IAAYykB,EAAellC,SAASygB,IACjD,CCjEO,MAAMyJ,IAA6B1rB,EAAAA,EAAAA,IAA4B,CACpElJ,IAAK,2CACLmJ,QAAUgR,GAAOA,IAAO4X,GAAkB5X,KAG/B41B,IAA4BjlC,EAAAA,EAAAA,IAA8B,CACrE9K,IAAK,kCACLmJ,QAAStN,EAAAA,YACTyR,4BAA4B,IAGjBgT,IAAoBxV,EAAAA,EAAAA,IAAe,CAC9C9K,IAAK,uCACLmJ,QAAS,IAAIwK,MAGF4M,IAAiBzV,EAAAA,EAAAA,IAAgB,CAC5C9K,IAAK,uCACLmJ,QAAS,IAAIwK,MAGTq8B,GAAmB,eAenBC,IAAiC/nC,EAAAA,EAAAA,IAAe,CACpDlI,IAAK,0CACLqG,IAAM5B,GAA6B,IFlE9B9B,eAA+BlG,GAWnC,IAXoC,QACrCyzC,EAAO,MACPC,KACG1rC,GAM+DhI,EAoDlE,aAjD+BgX,EAAAA,GAAAA,KAAS,IACnChP,EACHs+B,MAAK,GACLqN,MAAO,CAAC38B,EAAAA,GAAAA,KAAS,CAAEwM,IAAKiwB,IAAYz8B,EAAAA,GAAAA,KAAS,CAAEwM,IAAKkwB,KACpDzwC,IAAKiD,eACHlE,EAAQ4K,GAE8B,IADrCgiB,EAAQC,GAAMjiB,EAEf,MAAMgnC,QAAiB/kB,GAAOyY,OACxBuM,QAAkBjlB,GAAQ0Y,OAC1BwM,QAAkBjlB,GAAO/iB,QACzBioC,QAAmBnlB,GAAQ9iB,QACjC,GAAI8nC,IAAaC,EACf,OAAO,KAET,MAAMG,EAAiCJ,EACnC,CACEX,KAAMW,EACNrxC,KAAMA,IAAAA,KAAUyF,EAAOsO,KAAO,GAAItU,GAClCytB,MAAqB,SAAdqkB,EACPjrC,QAAS3C,UACP,IAAI+tC,aAAcC,aACTrlB,GAAOhmB,YAAc,IAAIsrC,aAGtC,KACEC,EAAkCP,EACpC,CACEZ,KAAMY,EACNtxC,KAAMA,IAAAA,KAAUyF,EAAOsO,KAAa,GAAItU,GACxCytB,MAAsB,SAAfskB,EACPlrC,QAAS3C,UACP,IAAI+tC,aAAcC,aACTtlB,GAAQ/lB,YAAc,IAAIsrC,aAGvC,KACEzlB,EACJslB,GAAiBI,EAEbzlB,GAAOylB,EAAgBJ,GACvB,KACN,SAAOtlB,GAAWC,GAAOI,SAASL,GAAQe,QACtCf,CAGN,KAGe,IAAIrd,QAAQrC,GAA8BA,GAC7D,CEKIqlC,CAAiB,CACf7sC,GAAE,MACCQ,MAIHssC,IAAmB7oC,EAAAA,EAAAA,IAAe,CACtClI,IAAK,4BACLqG,IACG5B,GACDhI,IAAA,IAAC,IAAE4J,GAAK5J,EAAA,OACN+xC,GAAcnoC,EAAI4pC,GAA+BxrC,IAAS,IAG1DusC,GACHtnC,GACD/G,UAA6C,IAAtC,IAAE0D,GAA8BgD,EACrC,MACM4nC,EADkB5qC,EAAIw/B,IACU,IAChC,MAAER,GAAUh/B,EAAI2+B,IAChBmL,EAAQc,GAAenN,kBAAkBC,IACzCmN,EAAUD,GAAenN,iBAAiBb,OAAOjiB,OACvD,GAAImvB,GAASe,EAAS,CACpB,MAAMtf,E1CyDqB,kBAE5BmB,MAA0BI,UAA1BJ,CAAmC,GAAI,C0C3DtBoe,CAAkB,CAChC9qC,MACA4sB,UAAWd,GACXa,SAAU4B,KAENrB,EAAY2d,GAASxxC,KACxBshB,IAAM,CAEHzY,KAAMynC,GACNhwC,IAAK8uB,GAAmBkhB,GAAkBhvB,GAC1C+iB,IAAK/iB,EACLqsB,QAAShI,EAAMrkB,IAAS8iB,iBAAiBb,OAAO/a,SAAW,GAC3DvrB,SAAUi1B,EACR,IACKvrB,EACDqD,EAAM,CACJymC,QACAD,QAASlvB,EACTjO,IAAKk+B,EAAc5M,aAGvB3kC,KAAKuhB,GAAS+N,GAAW/N,WAK7B,cAAEkT,EAAa,cAAED,KAAkB/f,GACvC8f,GACuB,IAArBV,EAAUrnB,OACNqnB,EAAU,GAAG52B,SACb42B,EAAUzlB,QAAOxC,IAAA,IAAC,SAAE3O,GAAU2O,EAAA,OAAK3O,EAASuP,OAAS,CAAC,KAqB9D,OAjBAklC,EAAAA,GAAAA,KACGnwB,IACgB,cAAdA,EAAK1Y,KAAuB,KAAO,MACpC8lC,GACGhS,aAAapb,EAAM,CAAEiT,kBACrBuP,eACL,CAGE/vB,MAAOS,EAAOof,UACdnE,YAAcnO,GACZ,aAAcA,EACTA,EAAKtkB,SACN,OAIH,IACFwX,EACH+f,gBACAC,cAAe,IAAIxgB,IACjB,IAAIwgB,GAAermB,QAChB9N,IAAU,GAAEA,IAAMmmB,WAAW6pB,OAItC,CACA,OAAO,IAAI,EAMFqB,IAAkCnmC,EAAAA,EAAAA,IAAS,CACtDlL,IAAK,iDACLqG,IAAK2qC,GAAqBf,MAMfqB,IAAoBpmC,EAAAA,EAAAA,IAAS,CACxClL,IAAK,oCACLqG,IAAK2qC,GAAqBD,MC/ItBxG,GAAuBnuC,EAAAA,GAAO+Z,GAAI;;;;;;;;EAoBjC,SAASo7B,GAAkBloC,GAI9B,IAJ+B,yBACjCmoC,GAGDnoC,EACC,MAAOooC,GAAmBjoC,GAAqBq8B,IACzChkB,GAAU5Q,EAAAA,EAAAA,IAAe8+B,IACzB2B,GAAmBD,GAAiBvlC,OAEpCylC,EAnBR,SAAoCC,GAClC,MAAMC,EAAYD,EAAOlyC,KAAKgK,IAAUG,EAAAA,EAAAA,IAAuBH,KAC/D,OACEmoC,EAAUp/B,MAAKhW,IAAA,IAAC,MAAEiN,GAAOjN,EAAA,MAAe,aAAViN,CAAoB,KAClDmoC,EAAU9jC,OAAO,GAAG,EAExB,CAawB+jC,CAAwB,CAC5CR,GACAD,KAEI3nC,EAAQioC,EAAcI,cACrBrwB,EAAc8B,IAAmBC,EAAAA,EAAAA,IAAenD,KAChDxG,EAAWk4B,IAAgBvuB,EAAAA,EAAAA,IAAelD,IAUjD,OARAzW,EAAAA,EAAAA,YAAU,KAER0Z,EAAgB9Z,GAAOyqB,eAAiB,IAAIxgB,KAC5Cq+B,EAAa,IAAIr+B,IAAM,GAGtB,CAACg+B,EAAcjoC,QAEdgoC,EAEA71C,EAAAA,cAACoxC,GAA0B,KAAC,qCAM9BpxC,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,GACMy1C,EAAwB,CAC5Bl8B,MAAO,CACL0H,OAAQ,yBACRmB,SAAU,cAGa,YAAxBwzB,EAAcjoC,OACb7N,EAAAA,cAACgvB,GAAO,KACNhvB,EAAAA,cAAC0uC,GAAoB,KACnB1uC,EAAAA,cAACF,EAAU,CAAC2Z,MAAO,CAAE6S,MAAO,YAAc,eAK/Cze,GACC7N,EAAAA,cAAC2oB,GAAAA,EAAe,CACd,aAAW,iBACX3C,QAASA,EACT9c,MAAO2E,EAAM6pB,UACb7O,cAAc,WACdhD,aAAcA,EACdiD,iBAAkBnB,EAClBE,aAAc5J,EACd+B,kBAAmBm2B,EACnB18B,MAAO,CAAE28B,cAAe,QACxBxtB,oBAAkB,GAEjB4pB,GAA8B/R,aAAa,CAC1CpI,cAAexqB,EAAMwqB,iBAI1Bud,EAAgBvlC,OAAS,GACxBrQ,EAAAA,cAACq2C,GAAAA,EAAwB,CACvBC,UAAU,MACV91B,QACExgB,EAAAA,cAAC4pB,GAAAA,EAAW,CACVC,SACE7pB,EAAAA,cAAAA,EAAAA,SAAA,KAAE,+HASND,GACAC,EAAAA,cAAA,QAAAE,EAAAA,EAAAA,GAAA,GACMH,EAAK,CACT0Z,MAAO,CACL6I,SAAU,WACVsL,MAAO,SACP2oB,OAAQ,YAGVv2C,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBAOjC,CAAC27B,GAAAr1C,aAAA,me,gBC7ID,MAAMm2C,GACJx2C,EAAAA,cAAA,QACEy2C,KAAK,eACLC,EAAE,iLAGAC,GACC,CAAEC,MAAO,UAAW3xC,KAAM,WAD3B0xC,GAGI,CAAEC,MAAO,UAAW3xC,KAAM,WAH9B0xC,GAIQ,CAAEC,MAAO,UAAW3xC,KAAM,WAJlC0xC,GAKC,CAAEC,MAAO,UAAW3xC,KAAM,WAE3B4xC,GACJ,CACEC,KAAMl2C,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,OAChCgE,EAAM0U,MACJ,sCACAq9B,GACD,EACHI,YAAavpC,IAAA,IAAC,MAAE5I,GAAyB4I,EAAA,OACvC5I,EAAM0U,MACJ,6CACAq9B,GACD,EACHK,aAAcvnC,IAAA,IAAC,MAAE7K,GAAyB6K,EAAA,OACxC7K,EAAM0U,MACJ,8CACAq9B,GACD,EACHM,IAAK7mC,IAAA,IAAC,MAAExL,GAAyBwL,EAAA,OAC/BxL,EAAM0U,MACJ,qCACAq9B,GACD,GAGDO,IAAY32C,EAAAA,EAAAA,IAAOg/B,GAAwB;;;;EAM3C4X,GAAiB52C,EAAAA,GAAO62C,IAAI78B,MAAM,CAAE88B,QAAS,iBAEhD;;;;;WAKQvjC,IAAA,IAAC,KAAEpH,EAAI,MAAE9H,GAAOkP,EAAA,OAAK+iC,GAAanqC,GAAM,CAAE9H,SAAQ;;;;;EAOvD0yC,GAAqB/2C,EAAAA,GAAOy+B,IAAK;;;EAKjCuY,GAAkBh3C,EAAAA,GAAOy+B,IAAK;;;EAK7B,SAASwY,GAAOhjC,GAAsC,IAArC,KAAE9H,GAAgC8H,EACxD,OAAOxU,EAAAA,cAACm3C,GAAc,CAACzqC,KAAMA,GAAO8pC,GACtC,CAEO,SAASiB,GAAYhjC,GAA+C,IAA9C,MAAEijC,GAAyCjjC,EACtE,OACEzU,EAAAA,cAACs3C,GAAkB,KAChBI,EAAM7zC,KAAI,CAAC6I,EAAM0G,IAChBpT,EAAAA,cAACm3C,GAAc,CAAChzC,IAAKiP,EAAO1G,KAAMA,GAC/B8pC,MAKX,CACO,SAASmB,GAAQhjC,GAMpB,IANqB,MACvB+iC,EAAK,SACL52C,GAID6T,EACC,OACE3U,EAAAA,cAACk3C,GAAS,KACRl3C,EAAAA,cAACy3C,GAAY,CAACC,MAAOA,IACrB13C,EAAAA,cAACu3C,GAAe,KAAEz2C,GAGxB,CAAC02C,GAAAn3C,aAAA,gJAAAo3C,GAAAp3C,aAAA,4MAAAs3C,GAAAt3C,aAAA,mSC/ED,MAAMga,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;EAI7Bs9B,GAAsBr3C,EAAAA,GAAO+Z,GAAI;;;;;EAOjCu9B,GAA4Bt3C,EAAAA,GAAO+Z,GAAI;;EAGvCw9B,GAAsBv3C,EAAAA,GAAO+Z,GAAI;WAC5B1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAaq9B,MAAM,CAAEC,UAAU,GAAO;EAGhEC,GAAsB13C,EAAAA,GAAO+Z,GAAI;;;;;EAMjC49B,IAAsB33C,EAAAA,EAAAA,IAAO8+B,GAAe;;EAI5C8Y,GAAsB53C,EAAAA,GAAOy+B,IAAK;;;;;;EAQjC,SAASoZ,KACd,MAAOC,GAAuB1qC,GAAqBs8B,KAC5CqO,GAAmB3qC,GAAqB+7B,IACzC6O,GAAcnjC,EAAAA,EAAAA,IAAemC,IAAelH,OAAS,EAC3D,IAAKgoC,EACH,OACEr4C,EAAAA,cAACoxC,GAA0B,KAAC,uBAMhC,MACEnJ,kBAAkB,OAAEb,EAAM,IAAEc,GAAK,eACjCa,EAAc,SACdP,GACE6P,GACE,QAAE7G,EAAO,KAAEv3B,GAASo3B,GAAmBjK,EAAO/a,SAC9CmsB,EAA6B,GAC/BpR,EAAOC,UAAUliC,OAASiiC,EAAOiC,OAAOlkC,MAC1CqzC,EAAc1oC,KACZ9P,EAAAA,cAACA,EAAAA,SAAc,CAACmE,IAAKijC,EAAOC,UAAUyE,OAAO,MACvC1E,EAAOC,UAAUliC,KAAK,IAACnF,EAAAA,cAACy4C,GAAS,CAAC3M,MAAO1E,EAAOC,UAAUyE,UAIhE1E,EAAOC,UAAUC,YAAcF,EAAOiC,OAAO/B,WAC/CkR,EAAc1oC,KAAK4oC,GAA+C,IAA7BtR,EAAOC,UAAUC,YAExD,MAAMiB,EAAO+P,IAAkBpQ,IAAQ,GACjCyQ,GAAa9a,EAAAA,GAAAA,IAASzZ,GAAQA,EAAI1X,MAAM67B,GAC9C,OACEvoC,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAAC43C,GAAmB,KAClB53C,EAAAA,cAAC63C,GAAyB,KAAErG,GAC3Bv3B,GAEHja,EAAAA,cAACi4C,GAAmB,KACjBM,GACCv4C,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAAC44C,GAAAA,EAAO,KAAEpQ,KAC/BzoC,GAAUC,EAAAA,cAACk4C,IAAmBh4C,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEm/B,SAAUsJ,OAG1DxoC,EAAAA,cAAA,WACI,GAAE2xC,GAAWzJ,MAAQd,EAAOiC,OAAOlkC,QACrCnF,EAAAA,cAACy4C,GAAS,CAAC3M,MAAO1E,EAAOiC,OAAOyC,QAAU,IACxC,GAAE4M,GAAkB,IAAIG,KAA+B,IAA1BzR,EAAOiC,OAAO/B,cAC5CkR,EAAcnoC,OAAS,GACtBrQ,EAAAA,cAAC83C,GAAmB,KAAC,aAAWU,KAIrCjQ,EAAKl4B,OAAS,GACbrQ,EAAAA,cAACm4C,GAAmB,KAClBn4C,EAAAA,cAAC84C,GAAQ,CAACvQ,KAAMoQ,EAAW7B,OAC3B92C,EAAAA,cAAC84C,GAAQ,CAACvQ,KAAMoQ,EAAW5B,cAC3B/2C,EAAAA,cAAC84C,GAAQ,CAACvQ,KAAMoQ,EAAW3B,eAC3Bh3C,EAAAA,cAAC84C,GAAQ,CAACvQ,KAAMoQ,EAAW1B,OAG/Bj3C,EAAAA,cAAA,WACwC,MAClC+oC,EAAej8B,KAAK,cAAY,IAAIi8B,GAAgB7yB,KAAK,OAIrE,CAEA,MAAM6iC,GAAoBx4C,EAAAA,GAAOy+B,IAAK;;;EAItC,SAAS8Z,GAAQtrC,GAA4C,IAA3C,KAAE+6B,GAAsC/6B,EACxD,OAAO+6B,GAAMl4B,OACXrQ,EAAAA,cAAAA,EAAAA,SAAA,KACGuoC,EAAK1kC,KAAI,CAACugB,EAAKhR,KACd,MAAMjO,EAAQ,GAAEif,EAAIjf,OAAOiO,IAAUm1B,EAAKl4B,OAAS,EAAI,GAAK,MAC5D,OAAiB,IAAV+C,EACLpT,EAAAA,cAAC+4C,GAAiB,KAChB/4C,EAAAA,cAACy3C,GAAY,CAACC,MAAOnP,EAAK1kC,KAAI4L,IAAA,IAAC,KAAE/C,GAAM+C,EAAA,OAAK/C,CAAI,IAAEwF,MAAM,EAAG,KAC1D/M,GAIHnF,EAAAA,cAAA,YAAOmF,EACR,KAGH,IACN,CAEA,SAASszC,GAASroC,GAAgC,IAA/B,MAAE07B,GAA0B17B,EAC7C,OACEpQ,EAAAA,cAAA,KAAGg5C,KAAO,UAASlN,IAASryB,MAAO,CAAEjN,IAAK,UACxCxM,EAAAA,cAACma,GAAAA,EAAI,KAAG,IAAG2xB,MAGjB,CAEA,SAAS4M,GAAkB1T,GACzB,MAAQ,MP5GH,SAA0BA,GAC/B,OAAOsN,GAAoB9lB,OAAOwY,EACpC,CO0GeiU,CAAiBjU,SPxGzB,SAA0BA,GAC/B,OAAOqN,GAAoB7lB,OAAOwY,GAAM5/B,QAAQ,IAAK,SACvD,COsG4C8zC,CAAiBlU,IAC7D,CCvJO,SAASmU,GACdr+B,EACAs+B,GAEA,MACMh+B,GADUi+B,EAAAA,EAAAA,MACOziC,MAAKhW,IAAA,IAAC,GAAE0d,GAAI1d,EAAA,OAAK0d,IAAOxD,CAAQ,IAEvD,OAAO6I,EAAAA,EAAAA,UAAQ,KACb,IAAKvI,EACH,OAAO,KAET,MAAM,QAAE8F,EAAO,GAAE5C,KAAOg7B,GAAqBl+B,EAC7C,MAAO,IACFk+B,EACHh7B,GAAI86B,EACJG,eAAgBj7B,EAChBE,cAAc,EACdG,gBAAkBnC,IAChB0E,EAAQ1E,EAAQ,EAEnB,GACA,CAACpB,GACN,CDiICg9B,GAAA/3C,aAAA,wDEnHD,MAAMm5C,IAAqBvqC,EAAAA,EAAAA,IAAK,CAC9B9K,IAAK,+BACLmJ,QAAS,KAGL+M,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;EAM7Bm/B,IAAgBpqC,EAAAA,EAAAA,IAAS,CAC7BlL,IAAK,wCACLqG,IAAK5J,IAAc,IAAb,IAAE4J,GAAK5J,EAMX,OALkB01B,GAAuBrkB,QAAQukB,IAC/CC,EAAAA,EAAAA,IAAcD,EAASV,aACnBtrB,EAAIgsB,EAASV,aACbU,EAASV,cAEEjyB,KAAK2yB,IAAQ,IACzBA,EACHryB,IAAM,WAAUqyB,EAASlY,KACzB6Y,SAAU3sB,EAAIuuB,GAA2BvC,EAASlY,QACjD,IAIDo7B,GAA2B,8BAC3BC,GAAyB,6BACzBC,GAA+B,kCAC/BC,GAA0B,GAAEF,MAA0BnmB,GAAagC,eACnEskB,GAA+B,GAAEH,MAA0BnmB,GAAaiC,oBAExEskB,GAAoBvjB,GAChB,+BAA8BA,EAASlY,KAG1C,SAAS07B,GAAiBxsC,GAAkC,IAAjC,OAAEw5B,GAA4Bx5B,EAC9D,MAAOysC,EAAeC,IAAoBtyB,EAAAA,EAAAA,IAAe4xB,IACnDW,GAAmB/kC,EAAAA,EAAAA,IACvBmxB,GAAgCS,IAE5BoT,GAAgB3rC,EAAAA,EAAAA,KAAkBgB,IAAA,IAAC,IAAE9E,GAAK8E,EAAA,OAAM6O,IACpD3T,EAAIouB,GAA2Bza,IAAMvN,IAAkBA,GAAa,CACrE,IACKspC,GAAoBr8B,EAAAA,GAAAA,KACpBs8B,GAAqBllC,EAAAA,EAAAA,IAAeqkC,IAEpCzzB,GAAU5Q,EAAAA,EAAAA,IAAe8+B,IACzBh6B,EAAU,CACdmgC,EAAkB,CAChB/7B,GAAIs7B,GACJ5/B,MAAO,eACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACzBjZ,SAAU,CACRu5C,EAAkB,CAChB/7B,GAAIo7B,GACJ1/B,MAAO,WACPyE,iBAAkB,gBAClB1E,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACzBjZ,SAAUw5C,EAAmBz2C,KAAK2yB,IAAQ,CACxClY,GAAIy7B,GAAiBvjB,GACrB+iB,eAAgB/iB,EAASL,cACzBnc,MAAOwc,EAASxc,MAChB2E,gBAAiBA,KACfy7B,EAAc5jB,EAASlY,GAAG,QAIhC+7B,EAAkB,CAChB/7B,GAAIq7B,GACJl7B,iBAAkB,gBAClBzE,MAAO,SACPlZ,SAAU,CACRq4C,GACE3lB,GAAagC,aACbqkB,IAEFV,GACE3lB,GAAaiC,kBACbqkB,KAEF7nC,OAAO8F,GAAAA,YAIZoW,EAAAA,GAAAA,GAAe,CAAEnI,aAGtB,OACEhmB,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAASA,IACvB9J,IAAA,IAAC,qBAAEkP,GAAsBlP,EAAA,OACxBpQ,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAACixC,GAAY,KACXjxC,EAAAA,cAAC6iC,GAAAA,EAAO,KACN7iC,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,YAAYyG,SAAS,aAExDnnB,EAAAA,cAACiiC,GAAAA,GAAU,CAACvW,YAAU,GACpB1rB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM,uBAGxB/Z,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,6BAEnC1gB,EAAAA,cAACiiC,GAAAA,GAAU,CAACvW,YAAU,GACpB1rB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,2BAGvB/Z,EAAAA,cAAC6hC,GAAAA,EAAkB,CACjBniB,WAAY5L,IAAoB,IAAnB,UAAEoP,GAAWpP,EACxB,OACE9T,EAAAA,cAACu6C,GAA6B,CAACr3B,UAAWA,GAAa,GAI3DljB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,0BAGvB/Z,EAAAA,cAACmxC,GAAY,MACbnxC,EAAAA,cAAC6iC,GAAAA,EAAO,CAACppB,MAAO,CAAE+gC,WAAY,IAC5Bx6C,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe8T,aACvC7uB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe+T,iBAG3C9uB,EAAAA,cAAA,OAAKyZ,MAAO,CAAEghC,KAAM,EAAG1tB,UAAW,IAC/BotB,EACCn6C,EAAAA,cAACovC,GAAAA,EAAiB,CAChBzU,YAAY,WACZ+f,UAAWT,EACXU,cAAeT,EACfU,iBAAkB,GAClBC,UACE76C,EAAAA,cAAC01C,GAAkB,CACjBC,yBAA0Br2B,IAG9B+vB,UAAWrvC,EAAAA,cAACo4C,GAAa,QAG3Bp4C,EAAAA,cAAC01C,GAAkB,CACjBC,yBAA0Br2B,KAIhB,GAI1B,CAEA,MAAMw7B,GAAmE,CACvE,CAACjB,IAAyBrT,MACvBxiC,OAAO+2C,YACRzkB,GAAuBzyB,KAAK2yB,GAAa,CACvCujB,GAAiBvjB,GACjBuC,GAA2BvC,EAASlY,SAIpC0a,IAAoB3pB,EAAAA,EAAAA,IAAS,CACjClL,IAAK,sDACLqG,IAAKgK,IAAA,IAAC,IAAEhK,GAAKgK,EAAA,OACXxQ,OAAO+sB,QAAQ+pB,IACZ7oC,QAAOwC,IAAA,IAAE,CAAE5G,GAAM4G,EAAA,OAAKjK,EAAIqD,EAAM,IAChChK,KAAI8Q,IAAA,IAAEmG,GAASnG,EAAA,OAAKmG,CAAQ,GAAC,IAGpC,SAASy/B,GAA6B1lC,GAIlC,IAJmC,UACrCqO,GAGDrO,EACC,MAAMoiB,GAAQjU,EAAAA,EAAAA,GAAe42B,IACvB/xB,GAAezS,EAAAA,EAAAA,IAAe4jB,IACpC,OACE/B,GACEj3B,EAAAA,cAACijB,EAAAA,EAAe,CAACF,YAAakU,IAC1B6K,GACA9hC,EAAAA,cAAC+hC,GAAAA,GAAe7hC,EAAAA,EAAAA,GAAA,GACVgjB,EACA4e,EAAe,CACnBja,aAAcA,MAM1B,CAACmyB,GAAA35C,aAAA,+H,+DC9ND,MAAM26C,GAAuBz6C,EAAAA,GAAO06C,MAAO;;;;;;;;WAQhCr6C,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAaq9B,MAAM,CAAEC,UAAU,GAAO;;;;;;;aAOzDxqC,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;;oBAGnC7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACxB7K,EAAM8V,aAAawgC,UAAU,CAAEC,SAAS,GAAO;;EAI/CC,GAAqB76C,EAAAA,GAAOy+B,IAAK;;;EAKjCqc,GAAc96C,EAAAA,GAAOy+B,IAAK;WACrB5uB,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OAAKxL,EAAM0U,MAAM,eAAe;;;;EAM/CgiC,IAAiC/6C,EAAAA,EAAAA,IAAOg7C,GAAAA,EAAuB;;;QAG7DznC,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OAAKlP,EAAM8V,aAAawgC,UAAU,CAAEC,SAAS,GAAO;;;EAI/D,SAASK,GAAiBhnC,GAS7B,IAT8B,MAChCujC,EAAK,MACL3zC,EAAK,QACLq3C,KACGC,GAKJlnC,EACC,OACExU,EAAAA,cAAC27C,GAAAA,EAAgBD,GACd,CAAC37C,EAAOqkB,IACPpkB,EAAAA,cAACg7C,IAAoB96C,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,IACnC2zB,EACA3zC,EACCpE,EAAAA,cAAAA,EAAAA,SAAA,KAAE,KACEA,EAAAA,cAACq7C,GAAW,KAAEj3C,GAChBpE,EAAAA,cAAC47C,GAAAA,EAAU,CAACxhC,QAASqhC,GACnBz7C,EAAAA,cAACs7C,GAA8B,CAC7BvhC,KAAK,gBACL8hC,UAAU,2BAKhB77C,EAAAA,cAACo7C,GAAkB,KACjBp7C,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kCAOjC,CAACyhC,GAAAn7C,aAAA,kYC/ED,MAAMy7C,GAAuBv7C,EAAAA,GAAOy+B,KAAKzkB,MAAM,CAAEwhC,KAAM,UAAY;;EAI5D,SAASC,GAAoBp7C,GAQhC,IARiC,QACnCq7C,EAAO,WACP/d,EAAU,UACV2L,GAKDjpC,EA6BC,OACEZ,EAAAA,cAAC87C,GAAoB,CACnBI,YAAchyC,IACZA,EAAEiyC,iBAAiB,EAErBF,QAASA,GAhCPpS,EAEA7pC,EAAAA,cAACu7C,GAAAA,EAAqB,CACpBxhC,KACEmkB,EACI,qEACA,6DAEN2d,UACE3d,EAAa,qBAAuB,+BAEtCke,uBAAuB,sBAIzBle,EACKl+B,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBAGxB/Z,EAAAA,cAACu7C,GAAAA,EAAqB,CACpBxhC,KAAK,sBACL8hC,UAAU,+BACVO,uBAAuB,sBAejC,CCrCO,SAASC,GAAsBz7C,GAAkC,IAAjC,OAAEomC,GAA4BpmC,EACnE,MAAO07C,EAAkBC,IAAuB30B,EAAAA,EAAAA,IAC9Cie,GAAatJ,OAAOyK,IAEhBwV,GAAgBC,EAAAA,EAAAA,IAAoB5W,GAAatJ,OAAOyK,IAE9D,OACEhnC,EAAAA,cAACw7C,GAAiB,CAChBp3C,MAAOk4C,EAAiBjsC,OAAS,EAAIisC,EAAiBpmC,KAAK,KAAO,KAClEulC,QAASe,EACT98B,WAAYlS,IAAA,IAAC,UAAE0V,GAAW1V,EAAA,OACxBxN,EAAAA,cAAC08C,GAAkB,CACjBx5B,UAAWA,EACXy5B,mBAAoBJ,GACpB,EAEJxE,MAAM,UAGZ,CDkBCiE,GAAA37C,aAAA,oVChBD,MAAMu8C,GACJtgB,GAEAt4B,OAAO+sB,SAAQ8M,EAAAA,GAAAA,IAAQpuB,IAAA,IAAC,WAAE6tB,GAAY7tB,EAAA,OAAK6tB,CAAU,GAAEhB,IAAWz4B,KAChEuM,IAAA,IAAEktB,EAAYp0B,GAAMkH,EAAA,MAAM,CACxBktB,aACAuf,UAAW3zC,EAAMrF,KAAK+L,GAASA,EAAK+I,WACrC,IAMCmkC,IAA8BztC,EAAAA,EAAAA,IAAS,CAC3ClL,IAAK,kCACLqG,IAAKsJ,IAAc,IAAb,IAAEtJ,GAAKsJ,EACX,MAAMipC,EAAcvyC,EAAI0yB,IAClB8f,EAAoBD,EAAYr5C,SACpC8Q,IAAA,IAAC,eAAEwoB,EAAc,SAAErkB,GAAUnE,EAAA,OAC3BwoB,EAAen5B,KAAK04B,IAAM,CACxB5jB,WACA2kB,WAAa,GAAEf,EAAOH,UAAUG,EAAOp3B,UACtC,IAED83C,EAAmBF,EAAYr5C,SACnC+Q,IAAA,IAAC,cAAEqoB,EAAa,SAAEnkB,GAAUlE,EAAA,OAC1BqoB,EAAcj5B,KAAK04B,IAAM,CACvB5jB,WACA2kB,WAAYf,EAAOp3B,QAClB,IAEP,MAAO,CACL23B,cAAe8f,GAAeK,GAC9BjgB,eAAgB4f,GAAeI,GAChC,IAUL,SAASN,GAAkB/nC,GAMvB,IANwB,UAC1BuO,EAAS,mBACTy5B,GAIDhoC,EACC,MAAO0pB,EAAkB6e,IAAuBl4C,EAAAA,EAAAA,UAC9C,KAEI,eAAE45B,EAAc,WAAEV,GAAeS,MAChCwe,GAA0BxvC,GAC/BmvC,KAEI,cAAEhgB,EAAgB,GAAE,eAAEE,EAAiB,IAC3CmgB,GAA0B,CAAC,EAEvBC,GAAyBvf,EAAAA,GAAAA,IAC7BhpB,IAAA,IAAC,WAAEyoB,GAAYzoB,EAAA,OAAKyoB,EAAWv6B,MAAM,KAAK,EAAE,GAC5Ci6B,IAOF/uB,EAAAA,EAAAA,YAAU,KACR,MAAMovC,EAAyBA,CAC7BhgB,EACAf,IAEOA,EACJrqB,QAAOmoB,IAAA,IAAC,WAAEkD,EAAU,UAAEuf,GAAWziB,EAAA,OAChCyiB,EAAU/kB,MAAMnf,GACdulB,EAAW,CAAEb,aAAYC,aAAY3kB,cACtC,IAEF9U,KAAIy2B,IAAA,IAAC,WAAEgD,EAAU,UAAEuf,GAAWviB,EAAA,MAAM,CACnC+C,aACAC,aACAuf,YACD,IAGLK,EACE,CACE,CACE7f,WAAY,QACZC,WAAY,OACZuf,UAAW,KAGZt5C,OAAO85C,EAAuB,QAASvgB,IACvCv5B,OAAO85C,EAAuB,SAAUrgB,IAC5C,GACA,IAEH,MAAMsgB,EAAmBriB,IAAA,IAAC,WACxBqC,EAAU,WACVD,EAAU,UACVwf,GACe5hB,EAAA,OACfj7B,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,UAASm5B,IAAcld,UAAWkd,GAC5Ct9B,EAAAA,cAACsgB,EAAAA,EAAc,CACb7W,QAAS6zB,EACTvjB,KACE/Z,EAAAA,cAACg8C,GAAoB,CACnB9d,WACiB,SAAfZ,GACAuf,EAAU/kB,MAAMnf,GACdulB,EAAW,CACTb,aACA1kB,WACA2kB,iBAIN2e,QAASA,KACY,SAAf3e,GACFuf,EAAU34C,SAASyU,IACjBimB,EAAe,CACbvB,aACA1kB,WACA2kB,cACA,GAEN,MAKH,EAET,OACEt9B,EAAAA,cAAC+hC,GAAAA,GAAe7hC,EAAAA,EAAAA,GAAA,GACVgjB,EAAS,CACbq6B,gBAAgB,gBAChBp6B,UAAU,QACV2J,SAAU,IACVlN,SAAWzb,IACT,MAAOuI,EAAMtI,GAAU,GAAED,IAAMpB,MAAM,KACxB,WAAT2J,GAAqBtI,EACvBu4C,EAAmB,CAACv4C,IACF,cAATsI,EACTiwC,EACEte,EAAiBx6B,KAAIw3B,IAAA,IAAC,WAAEiC,GAAYjC,EAAA,OAAKiC,CAAU,KAInC,WAAT5wB,GACTmN,IACF,IAGD,CACC7Z,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,UAAS,aACnBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,aAAY,gBACnBk6B,EAAiBx6B,IAAIy5C,GACxBt9C,EAAAA,cAACw9C,GAAAA,EAAO,MACRx9C,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,QAAQ6V,MAAM,SACrB8iB,EAAcj5B,KAAI43B,IAAA,IAAC,WAAE6B,EAAU,UAAEuf,GAAWphB,EAAA,OAC3C6hB,EAAiB,CAAEjgB,WAAY,QAASC,aAAYuf,aAAY,QAGjE74C,OAAO+sB,QAAQqsB,GAAwBv5C,KAAIqmC,IAAA,IAAEvnB,EAAQ2Z,GAAS4N,EAAA,OAC/DlqC,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,UAASwe,IAAU3I,MAAQ,GAAE2I,SACtC2Z,EAASz4B,KAAI45C,IAAA,IAAC,WAAEngB,EAAU,UAAEuf,GAAWY,EAAA,OACtCH,EAAiB,CAAEjgB,WAAY,SAAUC,aAAYuf,aAAY,IAE9D,KAKjB,CAACR,GAAAh8C,aAAA,oI,4BCvMD,MAAMq9C,GAAe,8BAErB,SAASC,GAAsBx4C,GAC7B,MAAMy4C,EAaR,SAA6Bz4C,GAC3B,MAAM04C,EAAU14C,EAAKoiC,MAAMmW,IAC3B,GAAIG,EACF,MAAO,CAACA,EAAQ,GAAIA,EAAQ,IAE9B,OAAO,IACT,CAnB2BC,CAAoB34C,GAC7C,GAAwB,MAApBy4C,EAA0B,CAC5B,MAAOG,EAAWC,GAAYJ,EAC9B,OAAOG,EAAUnW,cAAgB,IAAMoW,EAASpW,aAClD,CACA,OAIF,SAAyBziC,GACvB,OAAKA,EAAKoiC,MAAM0W,IACT94C,EAAKyiC,cADqCziC,CAEnD,CAPS+4C,CAAgB/4C,EACzB,CAEA,MAAM84C,GAA0B,SAYzB,MAAME,IAAmB9xC,EAAAA,EAAAA,IAAgC,CAC9DlI,IAAK,gBACLqG,IAAMmO,GAAqB7R,UAOlB,CACL3B,WAPiByS,EAAAA,GAAAA,UAAc,CAAExP,GAAE,GAAE8O,IAAKyB,EAAUxV,KAAM,eAO5C,GACd2oC,YAPkBl0B,EAAAA,GAAAA,UAAc,CAChCxP,GAAE,GACF8O,IAAKyB,EACLxV,KAAM,gBAIU,OCxBhBi7C,GAAkB79C,EAAAA,GAAO+Z,GAAI;;;;;;;;EAS7B+jC,GAAmB99C,EAAAA,GAAO+Z,GAAI;;;EAK9B69B,GAAsB53C,EAAAA,GAAO+Z,GAA6B;IAC5D1Z,IAAA,IAAC,UAAE09C,GAAW19C,EAAA,OACb09C,EAOG98C,EAAAA,EAAI;;UANJA,EAAAA,EAAI;;;;;SAQH;;;;;gBAKOgM,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACtB5I,EAAM46B,uBAAuB56B,EAAM0U,MAAM,mBAAmB;EAE1DilC,GAAyBh+C,EAAAA,GAAO+Z,GAAI;;;;EAMpCkkC,GAAsBj+C,EAAAA,GAAO+Z,GAAI;;;;;EAMjCmkC,GAA+BhvC,IAMf,IANgB,SACpCkJ,EAAQ,OACR0wB,GAID55B,EACC,MAAMivC,GAActpC,EAAAA,EAAAA,IAAe+oC,GAAiBxlC,IAC9CgmC,GAAoCvpC,EAAAA,EAAAA,IACxCi1B,IAGIuU,GAAaxpC,EAAAA,EAAAA,IAAewxB,GAAuBd,MDxEpD,IAAuC+Y,EC+E5C,MAAO,CAAE9d,WAJP4d,GACAC,IAAenY,KD5E2BoY,EC6EfxV,ED3E3BsU,GC2Ece,ED3Ecv5C,QAAUw4C,GAAsBkB,EAAM15C,OC6E7B,YAASiiB,EAAW,EAGtD,SAAS03B,GAAe1uC,GAW3B,IAX4B,KAC9Bm4B,EACAN,kBAAkB,IAChBC,EACAd,QAAQ,OAAEiC,EAAM,UAAEhC,EAAS,QAAEhb,IAC9B,SACD1T,GAKDvI,EACC,MAAM2uC,GAAsB3pC,EAAAA,EAAAA,IAAe+0B,IACrC6U,GAAsB5pC,EAAAA,EAAAA,IAAeg1B,IACrC6U,GAAkB7pC,EAAAA,EAAAA,IACtBs1B,GAA+BJ,GAAahsB,KAExC4gC,GAAgB9pC,EAAAA,EAAAA,IACpBs1B,GAA+BF,GAAWlsB,KAEtC6gC,GAAgB/pC,EAAAA,EAAAA,IACpBs1B,GAA+BH,GAAWjsB,KAGtC8gC,EAAkBX,GAA6B,CAAEpV,SAAQ1wB,aAC/D,OACE3Y,EAAAA,cAACo+C,GAAe,KACdp+C,EAAAA,cAACq+C,GAAgB,CAAC5kC,MAAO,CAAE4lC,UAAW,KAAMC,SAAU,EAAG9E,WAAY,IACnEx6C,EAAAA,cAACu+C,GAAsB,KACpBhW,GAAQvoC,EAAAA,cAACu/C,GAAU,CAACC,OAAQR,EAAqBzW,KAAMA,IACxDvoC,EAAAA,cAAA,QAAMyZ,MAAO2lC,GACV/N,GAAmBhlB,GAASmlB,WAIlCyN,GACCj/C,EAAAA,cAACq+C,GAAgB,CACf5kC,MAAO,CACL4lC,UAAW,OACX/yB,MAAO,wBACPkuB,WAAY,KACT4E,IAGJ/V,EAAOlkC,KACPkiC,EAAUliC,OAASkkC,EAAOlkC,MAAQ,KAGtC+5C,GACCl/C,EAAAA,cAACq+C,GAAgB,CACf5kC,MAAO,CACL4lC,UAAW,OACX/yB,MAAO,wBACPkuB,WAAY,KACT4E,Kd1GsBpa,Ec8G8B,KAAtD+Z,EAAsB1X,EAAYgC,GAAQ/B,Ud7G9CsK,GAAwBplB,OAAOwY,GAAM5/B,QAAQ,IAAK,YciHpD+5C,GACCn/C,EAAAA,cAACq+C,GAAgB,CACf5kC,MAAO,CACL4lC,UAAW,OACX/yB,MAAO,wBACPkuB,WAAY,KACT4E,IAGJzN,GAAWzJ,Kd3Hf,IAA8BlD,CcgIrC,CAEA,SAASya,GAAOr7B,GACd,MAAQ,GAAEA,EAAI1X,OAAO0X,EAAIjf,MAC3B,CAEA,SAASo6C,GAAUzrC,GAA0D,IAAzD,KAAEy0B,EAAI,OAAEiX,GAA8C1rC,EACxE,MAAM,aAAE4rC,IAAiB/7B,EAAAA,EAAAA,UAAQ,KAC/B,MAAMg8B,EAAkBpX,EAAKzQ,MAC1B1T,GAAqB,gBAAbA,EAAI1X,MAA0B0X,EAAIylB,YAE7C,MAAO,CACL6V,aAAcnX,EAAKt2B,QAChBmS,KAEiB,SAAbA,EAAI1X,MAAmBizC,GACV,iBAAbv7B,EAAI1X,MACH67B,EAAK3xB,MACFgpC,GACkB,gBAAjBA,EAAQlzC,MACRkzC,EAAQpjB,iBAAmBpY,EAAIjf,UAI5C,GACA,CAACojC,IAEJ,OACEvoC,EAAAA,cAACugB,EAAAA,EAAc,CACb+1B,UAAU,SACVuJ,MAAO,IACPn0B,WAAY6c,EAAKl4B,OAAS,EAC1BmQ,QACExgB,EAAAA,cAAC44C,GAAAA,EAAO,CAACkH,aAAW,GACjBvX,EAAK1kC,KAAKugB,GACTpkB,EAAAA,cAACw+C,GAAmB,CAACr6C,IAAKs7C,GAAOr7B,IAC/BpkB,EAAAA,cAACw3C,GAAO,CAAC9qC,KAAM0X,EAAI1X,OAClB0X,EAAIjf,WAMZqP,IAAA,IAAC,IAAE4P,KAAQ27B,GAAqBvrC,EAAA,OAC/BxU,EAAAA,cAACm4C,IAAmBj4C,EAAAA,EAAAA,GAAA,CAClBkkB,IAAKA,EACLk6B,UAAWkB,GACPO,GAEHL,EACEztC,QACEmS,GACc,iBAAbA,EAAI1X,OACH67B,EAAK3xB,MACHgpC,GACkB,gBAAjBA,EAAQlzC,MACRkzC,EAAQpjB,iBAAmBpY,EAAIjf,SAGtCtB,KAAKugB,IACJ,IAAIjf,EAAOif,EAAIjf,KACf,MAAMuyC,EAA0B,CAACtzB,EAAI1X,MAQrC,MAPiB,gBAAb0X,EAAI1X,MAA0B0X,EAAIoY,iBACpCkb,EAAMsI,QAAQ,gBACd76C,EAAQ,GAAEif,EAAIoY,eAAez5B,MAAM,KAAK,QAAQqhB,EAAIjf,QAErC,gBAAbif,EAAI1X,MAA0B0X,EAAIylB,WACpC6N,EAAM5nC,KAAK,QAGX9P,EAAAA,cAAC23C,GAAQ,CAACxzC,IAAKs7C,GAAOr7B,GAAMszB,MAAOA,GAChCvyC,EACQ,IAGG,GAI9B,CAAC25C,GAAAz+C,aAAA,wX,gBCrOD,MAAM4/C,IAAoB1/C,EAAAA,EAAAA,IAAO2/C,GAAAA,GAAa;;;;EAKxC7lC,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;IAI/B6lC,GAAAA;;;;;EAOEC,GAAsBpgD,EAAAA,cAA8C,CAAC,GACpE,SAASqgD,KACd,MAAMC,GAAgBlrC,EAAAA,EAAAA,IAAeswB,IAC/B6a,EAAexZ,MAEdzuB,EAAQkoC,GAAmB7yC,GAAqBw7B,IACjD/wB,EAAOE,GAAQF,MACdkgC,GAAmB3qC,GAAqB+7B,KACxCkM,EAAiB6K,IAAsB74B,EAAAA,EAAAA,IAC5CkiB,IAGF,OACE9pC,EAAAA,cAACogD,GAAoBM,SAAQ,CAACt8C,MAAOk0C,GAAmB,CAAC,GACvDt4C,EAAAA,cAACqa,GAAe,KACO,YAApBmmC,GACCxgD,EAAAA,cAACigD,GAAiB,CAAC,aAAW,kBAAkBjc,iBAAe,IAEhE5rB,GAAQA,EAAK/H,OAAS,GACrBrQ,EAAAA,cAAC2gD,GAAAA,EAAI,CACH,aAAW,eACXz3C,MAAOkP,EACPwQ,oBAAkB,EAClBC,cAAc,WACdhB,aAAc+tB,EACd51B,kBAAmBygC,EACnBG,oBAAqB,KAEpBhgD,IAAA,IAAC,iBAAEqnC,EAAgB,SAAEO,GAAU5nC,EAAA,OAC9BZ,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAK8jC,EAAiBC,IACtB9nB,UAAW6nB,EAAiBb,OAAO/a,SAGnCrsB,EAAAA,cAACogD,GAAoBS,SAAQ,MACzBtY,GACAvoC,EAAAA,cAAC8+C,GAAe,CACd7W,iBAAkBA,EAClBtvB,SAAU6vB,EACVD,KAAMA,EAAKN,EAAiBC,SAI7B,IAIQ,aAApBsY,GAAkCpoC,GAAwB,IAAhBA,EAAK/H,QAC9CrQ,EAAAA,cAACoxC,GAA0B,KAAC,8BAE1BpxC,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASA,IAAMmmC,EAAaD,IAAgB,mBAQ9D,CAACD,GAAAhgD,aAAA,uDCvED,MAAMygD,GAAiB,CACrB,CAAE37C,KAAM,mBAAoB0I,MAAOs8B,IACnC,CAAEhlC,KAAM,yBAA0B0I,MAAOu8B,KAErC2W,GAAsB,CAC1B,CAAE57C,KAAM,aAAc0I,MAAOw8B,KAEzB2W,GAAmB,CAAC1W,GAAcC,GAAYC,IAAY3mC,KAC9DjD,IAAA,IAAC,KAAEuE,EAAI,GAAEmZ,GAAI1d,EAAA,MAAM,CACjBuE,OACA0I,MAAO68B,GAA+BpsB,GACvC,IAEG2iC,GAAgBrxC,IACpB,MAAOxL,EAAOuG,IAAOid,EAAAA,EAAAA,IAAehY,EAAK/B,OACzC,MAAO,IAAK+B,EAAMzL,IAAKyL,EAAK/B,MAAM1J,IAAIiB,QAAQ,KAAM,KAAMhB,QAAOuG,MAAK,EAGjE,SAASu2C,KACd,MAAMC,EAAcL,GAAej9C,IAAIo9C,IACjCG,EAAmBL,GAAoBl9C,IAAIo9C,IAC3CI,EAAgBL,GAAiBn9C,IAAIo9C,IAErCK,EAAaH,EAAY59C,OAAO69C,GAAkB79C,OAAO89C,GAC/D,OACErhD,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,kBACjD1gB,EAAAA,cAAC6hC,GAAAA,EAAkB,CACjBniB,WAAYlS,IAAoB,IAAnB,UAAE0V,GAAW1V,EACxB,OAEExN,EAAAA,cAAC+hC,GAAAA,GAAe7hC,EAAAA,EAAAA,GAAA,GACVgjB,EAAS,CACb2E,aAAcy5B,EACXrvC,QAAOxC,IAAA,IAAC,MAAErL,GAAOqL,EAAA,OAAKrL,CAAK,IAC3BP,KAAIuM,IAAA,IAAC,IAAEjM,GAAKiM,EAAA,OAAKjM,CAAG,IACvByb,SAAWzb,IACT,MAAMw9B,EAAS2f,EAAW1qC,MACxB9C,IAAA,IAAG3P,IAAKo9C,GAAWztC,EAAA,OAAKytC,IAAcp9C,CAAG,IAEvCw9B,EACFA,EAAOh3B,KAAKvG,IAAWA,IAEvByV,IACF,IAGF7Z,EAAAA,cAACmiC,GAAAA,EAAO,CAACnoB,MAAM,QACbha,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,2BACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,aACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,cAEJshC,EAAYt9C,KAAI2Q,IAAA,IAAC,KAAErP,EAAI,IAAEhB,GAAKqQ,EAAA,OAC5BxU,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKA,GAAMgB,EAAY,IAGjCnF,EAAAA,cAAC6f,EAAAA,EAAI,CAAC7F,MAAM,WAERqnC,EAAcx9C,KAAI4Q,IAAA,IAAC,KAAEtP,EAAI,IAAEhB,GAAKsQ,EAAA,OAC9BzU,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKA,GAAMgB,EAAY,MAKrCnF,EAAAA,cAACmiC,GAAAA,EAAO,CAACnoB,MAAM,aAEXonC,EAAiBv9C,KAAI8Q,IAAA,IAAC,KAAExP,EAAI,IAAEhB,GAAKwQ,EAAA,OACjC3U,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKA,GAAMgB,EAAY,IAGjCnF,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,iBACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,kBACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,8BAEQ,GAItB7f,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,yBAI3B,CAACmnC,GAAA7gD,aAAA,gFCjED,MAAMmhD,IAAoBjhD,EAAAA,EAAAA,IAAOkhD,GAAAA,EAAa;;;;;EAOxCpnC,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;EAM7BonC,IAAqBzyC,EAAAA,EAAAA,IAAe,CACxC9K,IAAK,+BACLmJ,QAAS,KAIJ,SAASq0C,GAAiB/gD,GAAkC,IAAjC,OAAEomC,GAA4BpmC,EAC9D,MAAMghD,GAAgBxsC,EAAAA,EAAAA,IAAeysC,KAC9Bjc,EAAakc,IAAkBl6B,EAAAA,EAAAA,IACpCie,GAAaD,YAAYoB,KAEpBlB,EAAMic,IAAWn6B,EAAAA,EAAAA,IAAeie,GAAaC,KAAKkB,IACnDgb,GAAYvF,EAAAA,EAAAA,IAAoB5W,GAAaC,KAAKkB,KACjDoC,EAAY6Y,IAAiBr6B,EAAAA,EAAAA,IAAeie,GAAab,KAAKgC,IAC/Dkb,GAAYzF,EAAAA,EAAAA,IAAoB5W,GAAab,KAAKgC,KACjDmb,EAAeC,IAAoBx6B,EAAAA,EAAAA,IAAe85B,KAClDW,EAAkBC,IAAuBt9C,EAAAA,EAAAA,UAAS4gC,GACnD2c,GAAoBpnC,EAAAA,GAAAA,KACpBqnC,GAAaptC,EAAAA,EAAAA,IAAeywB,GAAac,OAAOK,IAChDyb,GAAgBrtC,EAAAA,EAAAA,IAAeywB,GAAaa,UAAUM,IACtD0b,EAAoB,SAACt+C,QAAK,IAALA,IAAAA,EAAQi+C,GACjCP,EAAe19C,GACXA,IAAU+9C,EAActzC,SAASzK,IACnCg+C,GAAkBD,GAAkB,CAClC/9C,KACG+9C,EAAclwC,QAAQrC,GAASA,IAASxL,MAGjD,GAEA6J,EAAAA,EAAAA,YAAU,KACRq0C,EAAoB1c,EAAY,GAC/B,CAACA,IAEJ,MAAM+c,GAAel0C,EAAAA,EAAAA,KACnBjB,IAAA,IAAC,IAAE7C,EAAG,SAAE+D,GAAUlB,EAAA,MAChB,KACE,MAAMo1C,GAAWC,EAAAA,GAAAA,KACjBl4C,EAAI86B,IAAkBrhC,GAAU,IAAIA,EAAOw+C,KAC3C5+C,OAAOD,OAAO8hC,IAAc3hC,SACzB4+C,IACCn4C,EACEm4C,EAAYF,GACZl0C,EACGC,YACCm0C,EACEp0C,EAASC,YAAY+2B,IAAsBv3B,aAG9CA,WACJ,IAGLxD,EAAI+6B,GAAsBkd,EAAS,CACpC,GACH,IAEIG,EAAQ,IAAIlK,KACZmK,EAAe,IAAInK,KACzBmK,EAAaC,QAAQF,EAAM7d,UAAY,GACvC,MAAMge,EAAY,IAAIrK,KACtBqK,EAAUD,QAAQF,EAAM7d,UAAY,GACpC,MAAMie,EAAuB,CAC3B,CACEh+C,KAAM,gBACNf,MAAO,CAAEmhC,KAAM2d,IAEjB,CACE/9C,KAAM,cACNf,MAAO,CAAEmhC,KAAMyd,KAGnB,OACEhjD,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAACixC,GAAY,KACXjxC,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CACZC,WAAW,sBACXyG,SAAUo7B,EAAkB/uB,GAAa2B,sBAI7Cn1B,EAAAA,cAACwhD,GAAiB,CAChB4B,SAAUxB,EACVx9C,MAAOi+C,EACP7/B,SAAU8/B,EACVp1B,SAAUw1B,EACVvxC,OAAQA,IAAMuxC,IACdjH,QAASA,IAAMiH,EAAkB,IACjCP,cAAeA,EACfkB,WACErjD,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACsjD,GAAAA,EAAoB,CACnBhiD,GAAIstB,GAAAA,EACJ20B,qBAAqB,EACrBzoC,SAAU0Y,GAAa6B,SAEvBr1B,EAAAA,cAACu7C,GAAAA,EAAqB,CACpBxhC,KACEyoC,EAAa,wBAA0B,gBAEzC3G,UACE2G,EACI,wBACA,0BAIVxiD,EAAAA,cAACsjD,GAAAA,EAAoB,CACnBhiD,GAAIstB,GAAAA,EACJ20B,qBAAqB,EACrBzoC,SAAU0Y,GAAa4B,YAEtBqtB,EACCziD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,8BAEnB/Z,EAAAA,cAACu7C,GAAAA,EAAqB,CACpBxhC,KAAK,oBACL8hC,UAAU,kCAQxB77C,EAAAA,cAAC6iC,GAAAA,EAAO,KACN7iC,EAAAA,cAACq8C,GAAsB,CAACrV,OAAQA,IAChChnC,EAAAA,cAACw7C,GAAiB,CAChBp3C,MAAO0hC,IAASW,GAA4B,KAAOX,EACnD2V,QAASuG,EACTtiC,WAAYjQ,IAAA,IAAC,UAAEyT,GAAWzT,EAAA,OACxBzP,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACbtD,SAAWzb,IACT,GAAY,WAARA,EACF,OAAO0V,KAETkoC,EAAS,GAAE59C,IAAM,IAGnBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,UAAS,aACnBnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKsiC,IAA2B,MACjC,EAETsR,MAAM,SAER/3C,EAAAA,cAACw7C,GAAiB,CAChBp3C,MAAOglC,GAAc/D,GAAkB+D,GACvCqS,QAASyG,EACTxiC,WAAYtP,IAAA,IAAC,UAAE8S,GAAW9S,EAAA,OACxBpQ,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACbtD,SAAWzb,IACT,MAAMq/C,EAAsBL,EAAqBvsC,MAC/C9C,IAAA,IAAC,KAAE3O,GAAM2O,EAAA,OAAK3O,IAAShB,CAAG,IAExBq/C,EACFvB,EAAcuB,EAAoBp/C,OAElCyV,IACF,IAGD,CACC7Z,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,UAAS,gBAChBg/C,EAAqBt/C,KAAI2Q,IAAA,IAAC,KAAErP,GAAMqP,EAAA,OACnCxU,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKgB,GAAOA,EAAY,KAG7B,EAET4yC,MAAM,SAER/3C,EAAAA,cAACw7C,GAAiB,CAChB97B,WAAYjL,IAAA,IAAC,UAAEyO,GAAWzO,EAAA,OACxBzU,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GAAKgjB,EAAS,CAAEtD,SAAU/F,KAC7B7Z,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,gBACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,qBACD,EAETk4B,MAAM,UAER/3C,EAAAA,cAAC+iC,GAAAA,EAAgB,MACjB/iC,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,0BAEnC1gB,EAAAA,cAACiiC,GAAAA,GAAU,CAAC,aAAW,WAAW7nB,QAASuoC,GACzC3iD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,8BAIzB/Z,EAAAA,cAACmxC,GAAY,MACbnxC,EAAAA,cAAC6iC,GAAAA,EAAO,CAACppB,MAAO,CAAE+gC,WAAY,IAC5Bx6C,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAa+B,cACrCv1B,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,iBACjD1gB,EAAAA,cAACiiC,GAAAA,GAAU,CAACvW,YAAU,GACpB1rB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,yDAGvB/Z,EAAAA,cAACkhD,GAAqC,MACtClhD,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,wBAAwByG,SAAS,aAG7DnnB,EAAAA,cAACiiC,GAAAA,GAAU,KACTjiC,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBAK3B/Z,EAAAA,cAACqgD,GAAY,MAGnB,CAEA,SAAShb,GAAkBC,GACzB,OAAIA,EAAUC,MAAQD,EAAUE,GACtB,WAAUT,GAAaO,EAAUC,aAAaR,GACpDO,EAAUE,MAGVF,EAAUC,KACJ,SAAQR,GAAaO,EAAUC,QAErCD,EAAUE,GACJ,SAAQT,GAAaO,EAAUE,MAElC,EACT,CC3MA,SAASie,GACP9Z,EACA+Z,GAEA,MAAMzG,EAAmBtT,EAAajmC,SACpC9C,IAAA,IAAC,SAAE+X,EAAQ,cAAEmkB,EAAa,cAAEC,GAAen8B,EAAA,OACzCk8B,EAAcj5B,KAAK04B,IAAM,CACvB5jB,WACAkxB,UAAW9M,GAAe53B,OAASo3B,EAAOp3B,KAC1Co3B,YACC,IAEDonB,EAAmB3/C,OAAO+sB,SAC9B8M,EAAAA,GAAAA,IAAQrwB,IAAA,IAAC,OAAE+uB,GAAQ/uB,EAAA,OAAK+uB,EAAOp3B,IAAI,GAAE83C,IACrCp5C,KAAqB4L,IAAuB,IAArBtK,EAAMm3B,GAAS7sB,EACtC,MAAMm0C,EAAQtnB,EAASz4B,KAAIuM,IAAA,IAAC,SAAEuI,GAAUvI,EAAA,OAAKzD,EAAAA,EAAAA,UAASgM,EAAS,IAC/D,MAAO,CACLjM,KAAM,cACNvI,IAAM,eAAcy/C,EAAM1tC,KAAK,QAAQ/Q,IACvCA,OACAm3B,WACA4B,WAAY5B,EAASxE,MAAKhkB,IAAA,IAAC,SAAE6E,EAAQ,OAAE4jB,GAAQzoB,EAAA,OAC7CkqB,GAAsB,CACpBrlB,WACA0kB,WAAY,QACZC,WAAYf,EAAOp3B,MACnB,IAEJ0kC,UAAWvN,EAASxE,MAAKtjB,IAAA,IAAC,UAAEq1B,GAAWr1B,EAAA,OAAKq1B,CAAS,IACrD+Z,MAAOA,EAAMvzC,SAAWs5B,EAAat5B,OAAS,KAAOuzC,EACtD,IAEH,OAAIF,EACKG,GAAsBF,GAExBA,CACT,CAEA,SAASG,GACPna,EACA+Z,GAEA,MAAM1G,EAAoBrT,EAAajmC,SACrC+Q,IAAA,IAAC,SAAEkE,EAAQ,eAAEqkB,GAAgBvoB,EAAA,OAC3BuoB,EAAen5B,KAAK04B,IAAM,CACxB5jB,WACA4jB,YACC,IAEDwnB,EAAoB//C,OAAO+sB,SAC/B8M,EAAAA,GAAAA,IACElpB,IAAA,IAAC,OAAE4nB,GAAQ5nB,EAAA,MAAM,GAAE4nB,EAAOH,UAAUG,EAAOp3B,MAAM,GACjD63C,IAEFn5C,KAAsBgR,IAAuB,IAArB1P,EAAMm3B,GAASznB,EACvC,MAAM+uC,EAAQtnB,EAASz4B,KAAIu2B,IAAA,IAAC,SAAEzhB,GAAUyhB,EAAA,OAAKztB,EAAAA,EAAAA,UAASgM,EAAS,IAC/D,MAAO,CACLjM,KAAM,eACNvI,IAAM,gBAAey/C,EAAM1tC,KAAK,QAAQ/Q,IACxCA,OACAm3B,WACA4B,WAAY5B,EAASxE,MAAKwC,IAAA,IAAC,SAAE3hB,EAAQ,OAAE4jB,GAAQjC,EAAA,OAC7C0D,GAAsB,CACpBrlB,WACA0kB,WAAY,SACZC,WAAYf,EAAOp3B,MACnB,IAEJy+C,MAAOA,EAAMvzC,SAAWs5B,EAAat5B,OAAS,KAAOuzC,EACtD,IAEH,OAAIF,EACKG,GAAsBE,GAExBA,CACT,CDgICpC,GAAAthD,aAAA,+HC9HM,MAAM2jD,IAAwB30C,EAAAA,EAAAA,IAAS,CAC5ClL,IAAK,8BACLqG,IAAKywB,IAAmC,IAAlC,IAAEzwB,GAAKywB,EAEX,MAAM0O,EAAen/B,EAAI0yB,IACnBwmB,EAAyBl5C,EAAIy5C,GAAwB,cACrDC,EACJ15C,EAAI25C,KACJ35C,EAAIy5C,GAAwB,eAE9B,MAAO,CACL,CAAEv3C,KAAM,QACR,CACEA,KAAM,aACN2wB,WAAY,QACZv8B,SAAUojD,EACNva,EAAa9lC,KAAK8lC,IACT,CACLj9B,KAAM,aACNvI,IAAM,oBAAmBwlC,EAAahxB,WACtCA,SAAUgxB,EAAahxB,SACvB7X,SAAU2iD,GACR,CAAC9Z,GACD+Z,OAIND,GAAoB9Z,EAAc+Z,IAExC,CACEh3C,KAAM,aACN2wB,WAAY,SACZv8B,SAAUojD,EACNva,EAAa9lC,KAAK8lC,IACT,CACLj9B,KAAM,aACNvI,IAAM,qBAAoBwlC,EAAahxB,WACvCA,SAAUgxB,EAAahxB,SACvB7X,SAAUgjD,GACR,CAACna,GACD+Z,OAINI,GAAqBna,EAAc+Z,IAE1C,IAGCG,GAAwB5xB,GAG5B,CACAG,2BAA2B,EAC3BlI,QAAU9E,GAASA,EAAKjgB,OAEb8+C,IAA0B52C,EAAAA,EAAAA,IAGrC,CACAlJ,IAAK,iCACLmJ,SAAS,IAEE62C,IAAoC90C,EAAAA,EAAAA,IAAkB,CACjElL,IAAK,gDACLqG,IAAK6wB,IAAA,IAAC,IAAE7wB,GAAK6wB,EAAA,OAAK7wB,EAAI+M,IAAelH,OAAS,CAAC,IAEpC+zC,GAAuBhe,IAClC/4B,EAAAA,EAAAA,IAA4C,CAC1ClJ,IAAK,4BACLmJ,QAAStN,EAAAA,YACTyR,4BAA4B,KAGnBunB,GAAoBoN,IAC/B/4B,EAAAA,EAAAA,IAA8B,CAC5BlJ,IAAK,qCACLmJ,QAAS,IAAIwK,OAGJ2M,GAAoB2hB,IAC/B/4B,EAAAA,EAAAA,IAA6B,CAC3BlJ,IAAK,qCACLmJ,QAAS,IAAIwK,OAIJusC,GAAmBje,IAC9B/4B,EAAAA,EAAAA,IAA2B,CACzBlJ,IAAK,oCACLmJ,QAAS,MAIP8pB,GAAY,CAChB,CACE9Y,GAAI,YACJtE,MAAO,YACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,+BACzBod,SAAU8sB,GAAwB,aAClCnuB,aAAa,GAEf,CACExX,GAAI,aACJtE,MAAO,aACPmd,SAAU8sB,GAAwB,cAClCnuB,YAAaquB,KAGJG,IAA0Bj1C,EAAAA,EAAAA,IAAS,CAC9ClL,IAAK,2CACLqG,IAAKixB,IAAA,IAAC,IAAEjxB,GAAKixB,EAAA,OACXrE,GACGnlB,QAAQukB,IACPC,EAAAA,EAAAA,IAAcD,EAASV,aACnBtrB,EAAIgsB,EAASV,aACbU,EAASV,cAEdjyB,KAAK2yB,IAAQ,IACTA,EACHW,SAAU3sB,EAAIy5C,GAAwBztB,EAASlY,QAC9C,ICjRF,SAASimC,KAEd,MAAMliB,GAAc5zB,EAAAA,EAAAA,KAClB7N,IAAA,IAAC,IAAE+J,GAAK/J,EAAA,OACL0d,IACC3T,EAAIs5C,GAAwB3lC,IAAMla,IAAWA,GAAM,CACpD,GACH,IAEIk2C,GAAqBllC,EAAAA,EAAAA,IAAekvC,IAE1C,OACEtkD,EAAAA,cAACgiC,GAAmB,CAClB5K,UAAWkjB,EACX5Y,SAAUW,GAGhB,CAACkiB,GAAAlkD,aAAA,sECTM,MAAMmkD,GAIT,CACFnnB,WAAajY,IACX,OACEplB,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEihB,EAAK1Y,QAAQ0Y,EAAKiY,aAC1Bjd,WAoGU3K,EApGU2P,EAAKiY,WAqGxB5nB,EAAM,GAAGgvC,cAAgBhvC,EAAMvD,MAAM,GAAG01B,eApGzC/3B,WAAYuV,EAAKtkB,UAEjBd,EAAAA,cAACipB,GAAAA,EAAoB,OAiG7B,IAAkBxT,CAhGL,EAGXshC,YAAc3xB,GAEVplB,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEihB,EAAKjhB,MAAOic,WAAWzT,EAAAA,EAAAA,UAASyY,EAAKjgB,OACjDnF,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CACZC,WAAY1gB,EAAAA,cAACkwC,GAAkB,CAAC5T,SAAUlX,EAAKkX,eAIjDv8B,GACAC,EAAAA,cAAC+oB,GAAAA,EAAW27B,MAAU3kD,EACnBqlB,EAAKykB,UACJ7pC,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAAC44C,GAAAA,EAAO,KAAC,WACExzB,EAAK8Y,YAAc,YAAY,YAI1Cn+B,GACAC,EAAAA,cAAC+oB,GAAAA,EAAW27B,MAAU3kD,EACpBC,EAAAA,cAAC0e,EAAAA,GAAY,CACX3E,KACEqL,EAAK8Y,WACD,qEACA,kEAOdl+B,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBAErB/Z,EAAAA,cAACipB,GAAAA,EAAoB,MACpB7D,EAAKw+B,OACJ5jD,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAC,IAAE9D,EAAKw+B,MAAM1tC,KAAK,MAAM,UASzD8gC,aAAe5xB,GAEXplB,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEihB,EAAKjhB,MAAOic,WAAWzT,EAAAA,EAAAA,UAASyY,EAAKjgB,OACjDnF,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAAC0e,EAAAA,GAAY,CACX3E,KAAMqL,EAAK8Y,WAAa,qBAAuB,mBAEjDl+B,EAAAA,cAACipB,GAAAA,EAAoB,MACpB7D,EAAKw+B,OACJ5jD,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KAAC,IAAE9D,EAAKw+B,MAAM1tC,KAAK,MAAM,OAMnD8f,WAAa5Q,GACXplB,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEihB,EAAKjhB,MACbic,WAAWzT,EAAAA,EAAAA,UAASyY,EAAKzM,UACzB9I,WAAYuV,EAAKtkB,UAEjBd,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAACq/B,GAAa,CAACH,SAAU9Z,EAAKzM,WAC9B3Y,EAAAA,cAACipB,GAAAA,EAAoB,QAI3B6W,UAAY1a,GACVplB,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEihB,EAAK1Y,QAAQ0Y,EAAKsN,iBAAiBtN,EAAKpb,UAChDoW,WAAWzT,EAAAA,EAAAA,UAASyY,EAAKpb,SACzB6F,WAAYuV,EAAKtkB,UAEjBd,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACnB/Z,EAAAA,cAACipB,GAAAA,EAAoB,QAI3B6tB,KAAO1xB,GACLplB,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEihB,EAAK1Y,OAAQ0T,UAAU,yBACnCpgB,EAAAA,cAACipB,GAAAA,EAAoB,QASpB,MAAM07B,GAAexgD,IAC1B,MAAOuI,EAAMk4C,EAAOtnB,GAAcn5B,EAAIpB,MAAM,KAC5C,MAAa,SAAT2J,EACK,OAEI,gBAATA,GAAmC,iBAATA,EACrB4wB,GAAc,KAEhB,IAAI,ECvHPkkB,GAAoBjhD,EAAAA,GAAOkV,KAAM;;;;EAKjC4E,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;EAM7BuqC,GAA4BtkD,EAAAA,GAAOy+B,IAAK;;;;;;EAQvC,SAAS8lB,GAAYlkD,GAAkC,IAAjC,OAAEomC,GAA4BpmC,EACzD,MAAOmkD,GAAqBp3C,GAAqBq2C,KAC1Cn8B,EAAcC,IAAmBF,EAAAA,EAAAA,IACtCoR,GAAkBgO,KAEbnhB,EAAc8B,IAAmBC,EAAAA,EAAAA,IACtCnD,GAAkBuiB,KAEbge,EAAYC,IAAiBr9B,EAAAA,EAAAA,IAAey8B,GAAiBrd,IAC9DhhB,GAAU5Q,EAAAA,EAAAA,IAAegvC,GAAqBpd,IAC9C5iB,GAAMvT,EAAAA,EAAAA,QAAuB,MAC7Bq0C,GAAiBr0C,EAAAA,EAAAA,QAAyB,OACzCs0C,EAAgBC,IAAmBpgD,EAAAA,EAAAA,WAAS,GAC7CqgD,GAAkB10C,EAAAA,EAAAA,IAAkBi2B,GAAuBrK,QA4BjE,OACEv8B,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAACixC,GAAY,KACXjxC,EAAAA,cAAC6kD,GAAyB,KACxB7kD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,oBAGrB/Z,EAAAA,cAACwhD,GAAiB,CAChBp9B,IAAK8gC,EACLlxC,UAAW,EACX5P,MAAO4gD,EACPxiC,SAAWtY,GAAM+6C,EAAc/6C,EAAEpB,OAAO1E,OACxC6M,QAASA,KACPm0C,GAAgB,EAAK,EAEvBj0C,OAAQA,KACNi0C,GAAgB,EAAM,KAI5BplD,EAAAA,cAAC2oB,GAAAA,EAAe,CACdvE,IAAKA,EACL4B,QAASA,EACTs/B,cAAeJ,EACfh8C,MAAO67C,GAAqB,GAC5Bl8B,cAAc,WACdhB,aAAcA,EACd7H,kBAAmB8H,EACnBjC,aAAcA,EACdiD,iBAAkBnB,EAClB/H,SAzDYzb,IAChB,MAAMo4B,EAASooB,GAAa,GAAExgD,KAC1Bo4B,GACF8oB,EAAgB,CAAC9oB,GACnB,EAsDI3T,oBAAkB,EAElB28B,cAAeJ,EACfH,WAAYA,EACZQ,mBAAoBP,EACpBQ,wBAAsB,EACtBC,sBAAoB,EACpBC,gBAAc,IAEZvgC,GAEOo/B,GAAwBp/B,EAAK1Y,MAAM0Y,KAKpD,CAAC0/B,GAAAzkD,aAAA,0HC1GD,MAAMulD,GAA0B,mBAC1BC,GAA6B,2BAC7BC,GAA6B,uBAC7BC,GAAkB,YAClBC,GAA4B,sBAE5B3rC,GAAkB9Z,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,mCAAAC,YAAA,eAAVH,CAAU,+BAK3B,SAAS0lD,GAAerlD,GAAkC,IAAjC,OAAEomC,GAA4BpmC,EAC5D,MAAMolB,GAAU5Q,EAAAA,EAAAA,IAAegvC,GAAqBpd,IAC9C9sB,EAA8B,CAClC,CACEoE,GAAIkV,GAAa0B,oBACjBlb,MAAO,kBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACzB4E,gBAAiBA,KACf9E,IAAgB,GAGpB,CACEyE,GAAIsnC,GACJ5rC,MAAO,gBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,eACzBw/B,eAAgB,aAChB56B,gBAAiBA,KACf9E,IAAgB,GAGpB,CACEyE,GAAIunC,GACJ7rC,MAAO,uBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,iBACzBw/B,eAAgB/lB,GAAaY,UAC7BzV,gBAAiBA,KACf9E,IAAgB,GAGpB,CACEyE,GAAIwnC,GACJ9rC,MAAO,mBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,iBACzB4E,gBAAiBA,KACf9E,IAAgB,GAGpB,CACEyE,GAAIynC,GACJ/rC,MAAO,oBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,cACzB4E,gBAAiBA,KACf9E,IAAgB,GAGpB,CACEyE,GAAI0nC,GACJhsC,MAAO,0BACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBACzB4E,gBAAiBA,KACf9E,IAAgB,OAGjBsU,EAAAA,GAAAA,GAAe,CAAEnI,aAGtB,OACEhmB,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAASA,IACvB1M,IAAA,IAAC,qBAAE8R,GAAsB9R,EAAA,OACxBxN,EAAAA,cAACqa,GAAoBiF,EACnBtf,EAAAA,cAACkmD,GAAyB,MAC1BlmD,EAAAA,cAAC8kD,GAAY,CAAC9d,OAAQA,IACN,GAI1B,CAEA,MAAMmf,IAAgB5lD,EAAAA,EAAAA,IAAOsiC,GAAAA,GAAQriC,WAAA,CAAAC,YAAA,iCAAAC,YAAA,eAAfH,CAAe,gCAKrC,SAAS2lD,KACP,OACElmD,EAAAA,cAACmmD,GAAa,CAACrjB,OAAO,QAAQnI,YAAY,YACxC36B,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAawB,wBACrCh1B,EAAAA,cAAC+iC,GAAAA,EAAgB,MAEjB/iC,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAasB,wBACrC90B,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU0Y,GAAa0B,sBACrCl1B,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU8qC,KACxB5lD,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAU+qC,KACxB7lD,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUgrC,KACxB9lD,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUirC,KACxB/lD,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUkrC,KACxBhmD,EAAAA,cAAC4uB,GAAAA,EAAY,CACX9T,SAAU0Y,GAAayB,sCAEzBj1B,EAAAA,cAAC+iC,GAAAA,EAAgB,MACjB/iC,EAAAA,cAACukD,GAA2B,MAC5BvkD,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe8T,aACvC7uB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe+T,eAG7C,CAACm3B,GAAA5lD,aAAA,6HC9GM,MAAM+lD,GAAyBA,KACpC,MAAMC,GAAqB53C,EAAAA,EAAAA,KACzB7N,IAAA,IAAC,SAAE8N,GAAU9N,EAAA,MACX,KACE,MAAMg1C,EAAkBlnC,EACrBC,YAAYo7B,IACZ57B,WACH0Q,KAAgB+2B,EAAgB1/B,KAAK,MAAMjM,MAAMH,QAAQ4D,MAAM,CAChE,GACH,IAGI44C,GAAa73C,EAAAA,EAAAA,KACjBjB,IAAA,IAAC,QAAEP,GAASO,EAAA,MACV,KACEP,EAAQ46B,GAAgB,CACzB,GACH,IAGF,MAAO,CACL,CACEvpB,GAAIkV,GAAa8B,qBACjBtb,MAAO,uBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACzBw/B,eAAgBx+B,GAAAA,EAAegE,eAC/BJ,gBAAiB0nC,GAEnB,CACE/nC,GAAIkV,GAAa+B,YACjBvb,MAAO,UACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACzBw/B,eAAgBx+B,GAAAA,EAAe2Y,QAC/B/U,gBAAiBA,KACf2nC,GAAY,GAGjB,EC3CGjsC,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;WAMxB1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAag1B,iBAAiB;;EAGvD,SAAS6W,KACd,MAAM3W,GAAgBC,EAAAA,EAAAA,MAEtB,OACE7vC,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAAA,OAAKyZ,MAAO,CAAEq2B,UAAW,WAAY,4BAEnC9vC,EAAAA,cAAA,WACAA,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASA,IAAMw1B,EAAcpc,GAAaoB,WAAW,4BAG3D50B,EAAAA,cAAA,WACAA,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASP,IAAgB,wBAC/B7Z,EAAAA,cAAA,WACAA,EAAAA,cAAA,WACAA,EAAAA,cAAC0e,EAAAA,GAAY,CACXjF,MAAO,CAAEs2B,cAAe,YACxBh2B,KAAK,4BACJ,IACH/Z,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASP,IAAgB,+BAAmC,KAI1E,CAAC0sC,GAAAlmD,aAAA,4ECDM,MAEDmmD,IAAqBv3C,EAAAA,EAAAA,IAAK,CAC9B9K,IAAK,+BACLmJ,QAAS,MAELm5C,IAAoBx3C,EAAAA,EAAAA,IAAK,CAC7B9K,IAAK,8BACLmJ,QAAS,MAGLo5C,GAAyBnmD,EAAAA,GAAOy+B,IAAK;;EAIrC3kB,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;EAQtBunC,IAAsB5yC,EAAAA,EAAAA,IAAkC,CACnE9K,IAAK,gCACLmJ,QAAStN,EAAAA,YACTyR,4BAA4B,IAGjBk1C,GAA2BA,KACtC,MAAMC,GAAUxxC,EAAAA,EAAAA,IAAeqwB,KACxBohB,EAAcC,IAAmBl/B,EAAAA,EAAAA,IAAe8d,IAGvD,OAFctwB,EAAAA,EAAAA,IAAemC,IAEhBlH,OAAS,EACpBrQ,EAAAA,cAACywC,GAAAA,EAAmB,CAClB/hB,cAAe1uB,EAAAA,cAAC0mD,GAAsB,KAAC,QACvCK,UAAWF,EACXG,kBAAoB7iD,GAAQ2iD,EAAiB,GAAE3iD,MAE9CyiD,EAAQ/iD,KAAKM,GACZnE,EAAAA,cAACywC,GAAAA,EAAoBC,KAAI,CACvBC,WAAY3wC,EAAAA,cAACinD,GAAqB,CAACjgB,OAAQ7iC,IAC3CA,IAAKA,GAELnE,EAAAA,cAACknD,GAAM,CAAClgB,OAAQ7iC,QAKtBnE,EAAAA,cAACyuB,GAAAA,EAAiB,CAACC,cAAc,mBAC/B1uB,EAAAA,cAACumD,GAAiC,MAErC,EAGGY,GAA2B5mD,EAAAA,GAAO06C,OAAO1gC,MAAM,CAAEvG,UAAW,GAAK;;;;;;;;;gBASvDpT,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,eAAe;WAC/C9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;aAExC7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAM0U,MAAM,sBAAsB;;;kBAG5ClJ,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACtBxL,EAAM0U,MACJ,oCACA1U,EAAMK,KAAO,YAAc,YAC5B;;EAGDmiD,IAA2B7mD,EAAAA,EAAAA,IAAO4mD,GAA0B;4BACtCrzC,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OAAKlP,EAAM8V,aAAaw2B,WAAW;EAEnEmW,GAA+B9mD,EAAAA,GAAOy+B,IAAK;;;;EAMjD,SAASsoB,GAAkB9yC,GAAwC,IAAvC,QAAE4F,GAAkC5F,EAC9D,OACExU,EAAAA,cAAConD,GAAwB,CAACnL,QAAS7hC,GACjCpa,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACnB/Z,EAAAA,cAACqnD,GAA4B,KAAC,YAGpC,CAEA,SAASH,GAAMzyC,GAAkC,IAAjC,OAAEuyB,GAA4BvyB,EAC5C,MAAO8yC,EAAeC,IAAoB5/B,EAAAA,EAAAA,IAAe4+B,KAClDiB,EAAcC,IAAmB9/B,EAAAA,EAAAA,IAAe6+B,IAEjDvsC,EAuDR,WACE,MAAM0nC,GAAgBxsC,EAAAA,EAAAA,IAAeysC,IAC/B8F,GAAel5C,EAAAA,EAAAA,KACnB2rB,IAAA,IAAC,IAAEzvB,EAAG,SAAE+D,GAAU0rB,EAAA,MAChB,KACEzvB,EACE27B,GACE53B,EAASC,YAAY+2B,IAAsBv3B,aAG7C,EACD,CACF,GACH,IAGIy5C,EAAkBC,GAA4BhiB,GAAaa,WAC3DohB,EAAeD,GAA4BhiB,GAAac,QACxDohB,EAAgBF,GACpBthB,IAGIrsB,EAA8B,IAC/BksC,KACH,CACE9nC,GAAIkV,GAAa2B,kBACjBnb,MAAO,oBACP2E,gBAAiBA,KACfijC,EAAc9wC,SAAS0C,OAAO,GAGlC,CACE8K,GAAIkV,GAAawB,sBACjBhb,MAAO,oBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,0BACzB4E,gBAAiBgpC,GAEnB,CACErpC,GAAIkV,GAAa4B,WACjBpb,MAAO,aACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,0BACzB4E,gBAAiBipC,GAEnB,CACEtpC,GAAIkV,GAAa6B,QACjBrb,MAAO,QACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kBACzB4E,gBAAiBmpC,GAEnB,CACExpC,GAAIkV,GAAagC,aACjBxb,MAAO,eACPuE,YAAa,wBACbI,gBAAiBopC,GAEnB,CACEzpC,GAAIkV,GAAaiC,kBACjBzb,MAAO,oBACPuE,YAAa,0BACbI,gBAAiBA,IAAM9E,OAG3B,OAAOK,CACT,CAtHkB8tC,IACTC,EAAcC,IAAmBtgC,EAAAA,EAAAA,IACtC0e,GAA2BU,IAGvBmhB,EAAkDF,EACpD,CACEpN,UAAW76C,EAAAA,cAACimD,GAAe,CAACjf,OAAQA,IACpC0T,UAAW6M,EACX5M,cAAe6M,EACf5M,iBAAkB,IAEpB,CAAC,EACL,OACE56C,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAASA,IACvBvF,IAAA,IAAC,qBAAE2K,GAAsB3K,EAAA,OAGxB3U,EAAAA,cAACqa,IAAena,EAAAA,EAAAA,GAAA,GACVof,EAAoB,CACxBtL,SAAUi0C,GAAgB,EAAI,KAE5BA,GACAjoD,EAAAA,cAACsnD,GAAkB,CAACltC,QAASA,IAAM8tC,GAAgB,KAErDloD,EAAAA,cAACovC,GAAAA,GAAiBlvC,EAAAA,EAAAA,GAAA,GACZioD,EAAc,CAClB9Y,UAAWrvC,EAAAA,cAAC2hD,GAAiB,CAAC3a,OAAQA,IACtCsI,iBAAkB,IAClBC,SAAUvvC,EAAAA,cAACg6C,GAAiB,CAAChT,OAAQA,IACrCwI,SAAUiY,EACVhY,aAAciY,EACdU,gBAAiB,MAEH,GAI1B,CAEA,SAASP,GACPQ,GAEA,OAAO55C,EAAAA,EAAAA,KACLoG,IAAA,IAAC,IAAElK,EAAG,SAAE+D,GAAUmG,EAAA,MAChB,KACElK,EACE09C,EAAY35C,EAASC,YAAY+2B,IAAsBv3B,aACtD/J,IAAWA,GACb,CACF,GACH,GAEJ,CAmEA,SAAS6iD,GAAqB3sB,GAAkC,IAAjC,OAAE0M,GAA4B1M,EAC3D,MAAMtlB,GzCzCCvG,EAAAA,EAAAA,IAAkBw4B,GAAkB,IyC0C3C,OACEjnC,EAAAA,cAACsoD,GAAAA,EAAoB,CACnBtuC,OAAO5E,EAAAA,EAAAA,IAAeuwB,GAAiBqB,IACvCpmB,YACa,SAAXomB,GACEhnC,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,eACjD1gB,EAAAA,cAAC6gB,EAAAA,EAAc,CAACzG,QAASA,IAAMpF,EAASgyB,OAMpD,CAAC2f,GAAAtmD,aAAA,mECvPM,MAAMkoD,GAAsC,CACjD,CACEjqC,GAAI,UACJtE,MAAO,UACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kCACzBtQ,QAASzJ,EAAAA,cAACkuB,GAAiB,MAC3Bs6B,cAAcC,EAAAA,GAAAA,IAAgB,CAAEC,WAAW,EAAMC,OAAQ,OAE3D,CACErqC,GAAI,WACJtE,MAAO,WACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kCACzBtQ,QACEzJ,EAAAA,cAACyuB,GAAAA,EAAiB,CAACC,cAAc,YAC/B1uB,EAAAA,cAACwjB,GAAQ,OAGbglC,cAAcC,EAAAA,GAAAA,IAAgB,CAAE7Z,OAAQ,YAE1C,CACEtwB,GAAI8xB,GACJp2B,MAAO,SACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,iCACzBtQ,QACEzJ,EAAAA,cAAC4oD,EAAAA,SAAQ,CAAC/nD,SAAUb,EAAAA,cAAC4wC,GAA6B,OAChD5wC,EAAAA,cAACswC,GAAgB,OAGrBkY,cAAcC,EAAAA,GAAAA,IAAgB,CAC5B7Z,OAAQ,OACRia,SAAS,EACTH,WAAW,KAGf,CACEpqC,GDtByC,kBCuBzCtE,MAAO,kBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kCACzBtQ,QACEzJ,EAAAA,cAAC4oD,EAAAA,SAAQ,CAAC/nD,SAAUb,EAAAA,cAAC4wC,GAA6B,OAChD5wC,EAAAA,cAAC2mD,GAAwB,OAG7B6B,cAAcC,EAAAA,GAAAA,IAAgB,CAC5B7Z,OAAQ,SACR+Z,OAAQ,Q,wCCtEP,MAAMG,IAAyB75C,EAAAA,EAAAA,IAAK,CACzC9K,IAAK,kCACLmJ,SAAS,IAEEy7C,IAAwB95C,EAAAA,EAAAA,IAAoB,CACvD9K,IAAK,2BACLmJ,QAAS,O,4BCWX,MAAM07C,GAAmBzoD,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,+BAAAC,YAAA,eAAVH,CAAU,wFAQ5B,SAAS0oD,KACd,MAAMC,GAAuBv4C,EAAAA,EAAAA,IAAkBm4C,IACzCnlB,GAAQvuB,EAAAA,EAAAA,IAAe4tB,IACvBmmB,EAASxkB,MACRykB,EAAQC,IAAazhC,EAAAA,EAAAA,IAAemhC,IAE3C,OACE/oD,EAAAA,cAACspD,GAAAA,GAAK,CACJF,OAKEA,GAAU,CACR98B,MAAO,IAEPqB,KAAMzhB,OAAOq9C,WAAa,IAAmC,IAC7DC,IACEt9C,OAAOu9C,YACQ,GAAf9lB,EAAMtzB,OACN,GACA,KAGNq5C,eAAiBN,IACfC,EAAUD,EAAO,EAEnBr8B,UAAW,IACXD,SAAU,IACV68B,gBAAc,EACdC,aAAa,OAEb5pD,EAAAA,cAACspD,GAAAA,GAAMO,OAAM,CACX58B,OACEjtB,EAAAA,cAACspD,GAAAA,GAAMQ,OAAM,CAACC,aAAW,GACvB/pD,EAAAA,cAACgpD,GAAgB,KAAC,oBAClBhpD,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAAC44C,GAAAA,EAAO,KAAC,SAChC54C,EAAAA,cAACiiC,GAAAA,GAAU,CACT+K,qBAAmB,EACnBuW,qBAAmB,EACnBnpC,QAASA,IAAM8uC,GAAqB,IAEpClpD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,8BAK3BtQ,QACEzJ,EAAAA,cAAAA,EAAAA,SAAA,KACG2jC,EAAM9/B,KAAI,CAAC0/B,EAAMnwB,IAChBpT,EAAAA,cAACA,EAAAA,SAAc,CAACmE,IAAKo/B,EAAKjlB,IACxBte,EAAAA,cAACkgD,GAAAA,GAAW,CACVzmC,MAAO,CAAEuwC,OAAQ,iBACjB7kD,KAAMo+B,EAAKvpB,MACXgqB,gBAAiBT,EAAKK,SAASI,gBAC/B,aAAa,eAAcT,EAAKvpB,QAChCiwC,QACE1mB,EAAKK,SAASE,OACbP,EAAKK,SAASG,cAAgB/jC,EAAAA,cAAAA,EAAAA,SAAA,KAAE,aAAYonB,GAE/C8iC,iBAAkB3mB,EAAKK,SAASG,cAChC3/B,MAAOm/B,EAAKK,SAASC,SACrBsmB,SAAU,EACVlP,OACE1X,EAAKC,cACHxjC,EAAAA,cAACoqD,GAAAA,EAAqB,CAAChwC,QAASA,IAAM+uC,EAAO5lB,EAAKjlB,QAIvDqlB,EAAMvwB,EAAQ,IAAMpT,EAAAA,cAACqqD,GAAAA,GAAuB,YAQ7D,CCzFA,SAASC,GACPvqD,GAEA,OAAOC,EAAAA,cAACkgD,GAAAA,IAAWhgD,EAAAA,EAAAA,GAAA,CAACqqD,OAAK,EAACC,aAAa,OAAOl+B,MAAO,KAASvsB,GAChE,CDqFCkpD,GAAA5oD,aAAA,qDCnFD,MAAMoqD,GAASlqD,EAAAA,GAAOy+B,KAAIx+B,WAAA,CAAAC,YAAA,mCAAAC,YAAA,eAAXH,CAAW,mBAGpBmqD,GAA0BnqD,EAAAA,GAAOy+B,KAAIx+B,WAAA,CAAAC,YAAA,oDAAAC,YAAA,eAAXH,CAAW,sCAGvC2/C,GAAAA,GAAYyK,WAQHC,GAA2BA,KACtC,MAAMC,GAAYz1C,EAAAA,EAAAA,IAAe6tB,IAC3B6nB,GAAa11C,EAAAA,EAAAA,IAAe8tB,IAC5BimB,EAASxkB,MACRomB,EAAmB7B,IAAwBthC,EAAAA,EAAAA,IAChDkhC,IAUF,OANA76C,EAAAA,EAAAA,YAAU,KACW,IAAf68C,GACF5B,GAAqB,EACvB,GACC,CAAC4B,IAGF9qD,EAAAA,cAAAA,EAAAA,SAAA,KACG6qD,IAAcE,GACb/qD,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAAC44C,GAAAA,EAAO,KAAG,GAAEiS,EAAU7wC,sDAGzBha,EAAAA,cAAC47C,GAAAA,EAAU,CACT5O,qBAAmB,EACnBuW,qBAAmB,EACnBnpC,QAASA,KACP8uC,GAAqB,EAAK,GAG5BlpD,EAAAA,cAAC0qD,GAAuB,KACtB1qD,EAAAA,cAACsqD,GAAiB,CAChBnlD,KAAM0lD,EAAUjnB,SAASE,MAAQ+mB,EAAU7wC,MAC3CgqB,gBAAiB6mB,EAAUjnB,SAASI,gBACpC5/B,MAAOymD,EAAUjnB,SAASC,SAC1BsmB,SAAU,EACVlP,OACEj7C,EAAAA,cAAAA,EAAAA,SAAA,KAQG6qD,EAAUrnB,cACTxjC,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAAC44C,GAAAA,EAAO,KAAC,WAChC54C,EAAAA,cAACoqD,GAAAA,EAAqB,CACpBY,OAAK,EACL5wC,QAASA,IAAM+uC,EAAO0B,EAAUvsC,cAWlDwsC,EAAa,GAAKC,IAClB/qD,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACyqD,GAAM,MACPzqD,EAAAA,cAACma,GAAAA,EAAI,CACHC,QAASA,IACP8uC,GAAsBn4C,IAAkBA,KAGzCg6C,EAAoB,iBAAmB,WAAW,KAAGD,EAAW,MAItEC,GAAqBD,EAAa,GAAK9qD,EAAAA,cAACipD,GAAU,MAClD,EAEL2B,GAAAvqD,aAAA,8O,gBChGK,MAAM4qD,IAA0B57C,EAAAA,EAAAA,IAAS,CAC9ClL,IAAK,qBACLqG,IAAK5J,IAAc,IAAb,IAAE4J,GAAK5J,EACX,MAAMsqD,EAAa1gD,EAAIqI,KAAuB5K,SAE9C,OADuBijD,GAAc1gD,EAAIwN,GAAekzC,MAC/B1gD,EAAI+M,IAAe,IAAIL,GAAG,IAO1Ci0C,IAA8B97C,EAAAA,EAAAA,IAAuB,CAChElL,IAAK,6BACLqG,IAAKgD,IAAc,IAAb,IAAEhD,GAAKgD,EACX,MAAM49C,EAAqB5gD,EAAIygD,IAC/B,OAAOzgD,EAAImyB,GAAkByuB,GAAoB,IAOxCC,IAA+Bh8C,EAAAA,EAAAA,IAAS,CACnDlL,IAAK,8BACLqG,IAAKiF,IAAc,IAAb,IAAEjF,GAAKiF,EACX,MAAMy7C,EAAa1gD,EAAIqI,KAAuB5K,SAC9C,OAAOijD,EAAa/tB,GAAmB+tB,GAAc,IAAI,IAUhDI,IAA0Bj8C,EAAAA,EAAAA,IAAS,CAC9ClL,IAAK,yBACLqG,IAAK1D,UAAoB,IAAb,IAAE0D,GAAK4F,EACjB,MAAMmsB,EAAS/xB,EAAI6gD,IACnB,GAAI9uB,EACF,MAAO,CACLgvB,UAAU,EACVzU,KAAMva,GAGV,MAAM5jB,EAAWnO,EAAIygD,IACrB,MAAO,CAGLM,UAAU,EACVzU,WAAY0U,EAAAA,EAAAA,IAAW,CAAEpjD,GAAE,GAAE8O,IAAKyB,EAAUyL,IAAK,SAClD,I,wCC/DE,SAASqnC,GACdnvB,EACAovB,GAEA,OACEpvB,EAASU,eAAelF,MACrBkf,GACE,GAAEA,EAAa5a,UAAU4a,EAAa7xC,SAAWumD,IAG/C,uBAELpvB,EAASQ,cAAchF,MAAKl3B,IAAA,IAAC,KAAEuE,GAAMvE,EAAA,OAAKuE,IAASumD,CAAa,IAC3D,WAEF,IACT,CAGA,MAAMC,GAAwB,IAAIjkB,OAM7B,wDAAGpyB,MAAM,IACPmhC,KAAK,MACL5yC,KAAI,CAACkQ,EAAGX,IAAUw4C,OAAOC,aAAaz4C,KACtC8C,KAAK,aAGL,SAAS41C,GAAkBxuB,GAChC,OAAOA,EAAWl4B,QAAQumD,GAAuB,IACnD,CCrBA,MAAMtxC,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;EAG7ByxC,IAAmBxrD,EAAAA,EAAAA,IAAOyrD,GAAAA,EAAY;;EAI/BC,GAGT,CACFC,SAAW5uB,GACTt9B,EAAAA,cAAAA,EAAAA,SAAA,KAAE,eACas9B,EAAW,mBAAgBt9B,EAAAA,cAAA,YAG5CmsD,qBAAuB7uB,GACrBt9B,EAAAA,cAAAA,EAAAA,SAAA,KAAE,eACas9B,EAAW,+BAA4Bt9B,EAAAA,cAAA,WAAM,uBAMzD,SAASosD,GAAkBxrD,GAQ9B,IAR+B,WACjC08B,EAAU,SACV3kB,EAAQ,MACRvE,GAKDxT,EACC,MAAO8qD,EAAeW,IAAoBrnD,EAAAA,EAAAA,UAASs4B,IAC5CgvB,EAASC,IAAcvnD,EAAAA,EAAAA,WAAS,GACjC6lC,GAAiBC,EAAAA,EAAAA,KACjBxO,GAAWlnB,EAAAA,EAAAA,IAAeunB,GAAkBhkB,IAC5C6zC,E/DiWD,WACL,MAAMC,EAAuBluB,KAC7B,OAAO9vB,EAAAA,EAAAA,KACLgtB,IAAA,IAAC,QAAExuB,EAAO,SAAEyB,GAAU+sB,EAAA,OACpB30B,MAAO6R,EAAkB2kB,EAAoBouB,WACrCc,EAAAA,EAAAA,IAAa,CACjBpkD,GAAE,GACF8O,IAAKyB,EACL+zC,OAAQpvB,EACRlZ,IAAKsnC,IAEPz+C,EAAQ0vB,GAAkBhkB,IAC1B,MAAM+lB,EAAiB,CACrBrB,WAAY,QACZC,aACA3kB,YAGAulB,GACExvB,EAASC,YAAYovB,IAAuB5vB,WAC5CO,EAASC,YAAYwvB,IAAmChwB,WACxDuwB,KAGF+tB,EAAqB/tB,GAAgB,GACrC+tB,EACE,IACK/tB,EACHpB,WAAYouB,IAEd,GAEJ,CACD,GACH,GAEJ,C+DrYuBiB,GAEfj/C,EAAQ+9C,GAAmBnvB,EAAUovB,GACrCkB,EAAkBl/C,GAAS4+C,EAAU,QAAU,QAsBrD,OACEtsD,EAAAA,cAAC6sB,GAAAA,GAAW,CAACC,SAAS,UAAUC,UAAU,WACxC/sB,EAAAA,cAACgtB,GAAAA,EAAY,CACXC,OAAS,iBAAgBqQ,IACzB7zB,QACEzJ,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAAA,QAAMse,GAAG,qBAAqB4O,SA1BtBzQ,IAChBA,EAAMgF,iBACD/T,EAeH6+C,GAAW,GAdXC,EAAalwB,EAAS3jB,SAAU2kB,EAAYouB,GACzCzhD,OAAOC,IACN2gC,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,mBACPC,KAAO,2BAA0BqjB,QAAiBouB,OAEpD5hD,QAAQ4D,MAAM,wBAAyBxD,EAAE,IAE1C0B,MAAK,KACJwI,GAAO,GAKb,GASUpU,EAAAA,cAAC+rD,GAAgB,CACfc,eAAe,QACf9U,MAAM,mBACN3zC,MAAOsnD,EACPlpC,SAAWskB,IACTulB,EAAiBP,GAAkBhlB,IACnCylB,GAAW,EAAK,EAElBK,gBAAiBA,EACjBE,kBACEp/C,GAA6B,UAApBk/C,EACLX,GAAcv+C,KAAS4vB,QACvBlW,MAMdqG,OACEztB,EAAAA,cAACgtB,GAAAA,EAAaU,OAAM,CAClBE,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,GAAAA,EAAM,CAAC1P,QAAShG,GAAO,UACxBpU,EAAAA,cAAC8pB,GAAAA,EAAM,CACLC,QAAQ,UACRrd,KAAK,SACLmhB,KAAK,qBACLnC,WAAYqhC,QAAQr/C,IAAU4+C,GAC/B,eAUjB,CAACF,GAAA/rD,aAAA,6UCtFD,MAAM4wC,GAAe1wC,EAAAA,GAAO+Z,GAAI;;;;;;EAO1B0yC,GAAczsD,EAAAA,GAAO+Z,GAAI;;;;;;EAQlB2yC,IAAyBh+C,EAAAA,EAAAA,IAMpC,CACA9K,IAAK,uBACLmJ,aAAS8Z,IAGJ,SAAS8lC,GAAatsD,GAAoC,IAAnC,MAAEwT,GAA8BxT,EAC5D,MAAO+oC,GAAgBh8B,GAAqBuvB,KACrCiwB,EAA4BC,IACjCxlC,EAAAA,EAAAA,IAAeqlC,KACVI,EAAqBC,IAA0BtoD,EAAAA,EAAAA,UAEpDmoD,GAA8B,CAAC,GAE3BI,GAAkBlyC,EAAAA,EAAAA,IAAUmY,GAAasB,uBACzC04B,GhEoZC/+C,EAAAA,EAAAA,KACLgvC,IAAA,IAAC,QAAExwC,GAASwwC,EAAA,MACV,CAAC9kC,EAAkB2kB,KACVkwB,EAAAA,EAAAA,IAAa,CAAEplD,GAAE,GAAE8O,IAAKyB,EAAUyL,IAAKkZ,IAAc1xB,MAAK,KAC/DqB,EAAQ0vB,GAAkBhkB,GAAU,GAEvC,GACH,IgE1ZIkyB,GAAiBC,EAAAA,EAAAA,KACjBhf,GAAgB2hC,EAAAA,EAAAA,KAChBC,GhEkXCj/C,EAAAA,EAAAA,KACJyF,GACCpN,MAAO6R,EAAkB2kB,EAAoBlB,KAC3C,MAAM,QAAEnvB,EAAO,SAAEyB,EAAQ,IAAE/D,GAAQuJ,EAC7By5C,EACJ5gD,GAA2BmH,SACvB05C,EAAAA,EAAAA,IAAS,CACbxlD,GAAE,GACF8O,IAAKyB,EACLyjB,SACAhY,IAAKkZ,IAEPrwB,EAAQ0vB,GAAkBhkB,IAC1B1L,EAAQb,GAAgBuM,IACxB,MAAMk1C,EAAcn/C,EAASC,YAAY4D,IAAiBpE,WACpD2/C,QAA2BhyB,IAAYh1B,UAAyB,IAAlB,SAAEmB,GAAUiiC,EAC9D,MAAMliC,QAAeI,GAAGN,SAASE,OAAOC,GAKxC,OAHID,SACI2lD,EAAmB1lD,GAEpBD,CAAM,GACZ6lD,GACHljD,EAAI4H,GAAiBu7C,EAAmB,GAG5C,KgExYI,WAAE5vB,EAAU,eAAEU,GAAmBD,KAEvC,IAAKgL,EACH,OAAO,KAET,MAAM3vB,EACoB,IAAxB2vB,EAAat5B,OACR,mBAAkBlN,IAAAA,SAAcwmC,EAAa,GAAGhxB,YACjD,eACN,OACE3Y,EAAAA,cAACspD,GAAAA,GAAK,CACJM,aAAa,MACb78B,UAAW,GACXD,SAAU,IACVs8B,OAAQiE,EACR3D,eAAgBA,CAACN,EAAQ2E,KACC,WAApBA,GACFX,EAA8B,CAC5B9gC,MAAO88B,EAAO98B,MACdnL,OAAQioC,EAAOjoC,SAGnBmsC,EAAuBlE,EAAO,GAGhCppD,EAAAA,cAACguD,GAAAA,EAAW,CACV/gC,OACEjtB,EAAAA,cAACspD,GAAAA,GAAMQ,OAAM,CAACC,aAAW,GACvB/pD,EAAAA,cAACixC,GAAY,KACXjxC,EAAAA,cAACgtD,GAAW,KAAEhzC,GACdha,EAAAA,cAAC6iC,GAAAA,EAAO,KACN7iC,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,WACjD1gB,EAAAA,cAACiiC,GAAAA,GAAU,CACT7nB,QAASA,KACPP,KACAzF,GAAO,GAGTpU,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,oBAGvB/Z,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,wBAEnC1gB,EAAAA,cAACiiC,GAAAA,GAAU,CACTvW,gBAA2CtE,IAA/B+lC,EACZ/yC,QAASA,KACPgzC,OAA8BhmC,GAC9BkmC,GACE9/C,IAAA,IAAC,MAAE8e,EAAK,OAAEnL,KAAW8sC,GAAezgD,EAAA,MAAM,IACrCygD,EACJ,GACF,GAGHjuD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,gCAO/BtQ,QACEzJ,EAAAA,cAAC+hC,GAAAA,EAAe,CACd,aAAY/nB,EACZujC,gBAAgB,gBAChB30B,oBAAkB,EAClBzF,UAAU,QACV+qC,aAAcvkB,EAAajmC,SAAQ+L,IAAA,IAAC,cAAEqtB,EAAa,SAAEnkB,GAAUlJ,EAAA,OAC7DqtB,EACG7qB,QAAO7B,IAAA,IAAC,eAAEosB,GAAgBpsB,EAAA,OAAMosB,CAAc,IAC9C34B,KAAIiQ,IAAA,IAAC,KAAE3O,GAAM2O,EAAA,MAAM,GAAE6E,UAAiBxT,GAAM,GAAC,IAElDya,SAAWzb,IACT,MAAOwU,EAAU4jB,EAAQ4xB,GAAc,GAAEhqD,IAAMpB,MAAM,MAErD+D,eAAesnD,EAAYR,GACzB,UACQA,GAER,CAAE,MAAO1jD,GACHA,aAAamkD,EAAAA,GAAOC,sBAEtBzjB,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,uBACPC,KAAM/P,EAAEmiB,UAGVwe,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,kBACPC,KAAO,6BAA4BsiB,KAGzC,CACF,CAuBA,GAAQp4B,IACDopD,GAAiBjvC,GACpB,OAAOivC,GAAiBrsC,UAExB,OAAQitC,GACN,IAAK,SACH,OAAOX,EAAa70C,EAAU4jB,GAAQ3wB,MACpC,KACEi/B,EAAe/wB,KAAK,CAClBE,MAAQ,mBAAkBuiB,IAC1BxiB,KAAM,OACNG,QACEla,EAAAA,cAACuuD,GAAAA,EAAiB,CAACn0C,QAASP,IAAgB,YAI9C,IAEJ,KACEgxB,EAAe/wB,KAAK,CAClBE,MAAQ,6BAA4BuiB,IACpCxiB,KAAM,SACN,IAGR,IAAK,SACH,OAAO+R,EAAcW,MAAK9X,IAAA,IAAC,MAAEP,GAAOO,EAAA,OAClC3U,EAAAA,cAACosD,GAAkB,CACjBzzC,SAAUA,EACV2kB,WAAYf,EACZnoB,MAAOA,GACP,IAEN,IAAK,WACH,OAtDCg6C,GAAY,IAAMV,EAAe/0C,EAAU4jB,KAuD9C,IAAK,kBACH,OArDR,WACE,MAAMya,EAAerN,GACjB/yB,MAAKpC,IAAA,IAAGmE,SAAU61C,GAAWh6C,EAAA,OAAKg6C,IAAc71C,CAAQ,KACxDqkB,eAAepmB,MACfnC,IAAA,IAAC,KAAEtP,EAAI,OAAEi3B,GAAQ3nB,EAAA,MAAM,GAAE2nB,KAAUj3B,MAAWo3B,CAAM,IAExD,GAAIya,EACF,OAAOoX,GAAY,IACjBV,EACE/0C,EACAq+B,EAAa7xC,KACb6xC,EAAa5a,SAIrB,CAsCeqyB,GACT,QACE,OAAO50C,KAEf,EAEFgJ,QAASzO,GAERm5C,GACCvtD,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKopD,EAAgBjvC,GAAI8B,UAAWmtC,EAAgBvzC,OACxDha,EAAAA,cAACsgB,EAAAA,EAAc,CACbvG,KAAMwzC,EAAgBxzC,KACtBtQ,QAAS8jD,EAAgBvzC,SAI/Bha,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,qBAAoB,+BAE5BwlC,EAAajmC,SACXmR,IAKO,IALN,eACCmoB,EAAc,cACdF,EAAa,SACbnkB,EAAQ,cACRokB,GACDloB,EACC,MAAM65C,EAAkBA,CAAC3W,EAAep/B,IACtCgxB,EAAat5B,OAAS,EACjB,GAAE0nC,QAAY50C,IAAAA,SAAcwV,KAC7Bo/B,EACA4W,EAAiBA,CACrBrxB,EACAuM,IACG,EACFA,GACC7pC,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,0BACpB,iBAAgBA,MAErBt9B,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,kCACtB,+BAGDt9B,EAAAA,cAACw9C,GAAAA,EAAO,CAACr5C,IAAI,6BAETyqD,EAAeA,CACnBtxB,EACAP,IAEAA,GACAO,IAAeP,GAAiB,CAC9B/8B,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,0BACpB,WAAUP,YAAwBO,MACrCt9B,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,yBACpB,UAASA,YAAqBP,MACjC/8B,EAAAA,cAACw9C,GAAAA,EAAO,CAACr5C,IAAI,2BAGjB,MAAO,CACLnE,EAAAA,cAACmiC,GAAAA,EAAO,CACNh+B,IAAM,GAAEwU,oBACRqB,MAAO00C,EAAgB,iBAAkB/1C,IAExCmkB,EAAcj5B,KAAIu2B,IAA+B,IAA9B,KAAEj1B,EAAI,eAAEq3B,GAAgBpC,EAC1C,MAAMyP,EAAY1kC,IAAS43B,GAAe53B,KACpC0pD,EAAqB,CACzBvxB,WAAYn4B,EACZk4B,WAAY,QACZ1kB,YAEF,OACE3Y,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAaxT,IACrBib,UAAWjb,EACX6U,MACEha,EAAAA,cAACsgB,EAAAA,EAAc,CACb7W,QAAStE,EACT4U,KACE/Z,EAAAA,cAACg8C,GAAoB,CACnB9d,WAAYA,EAAW2wB,GACvBhlB,UAAWA,EACXoS,QAASA,KACPrd,EAAeiwB,EAAmB,IAIxC1nC,SACEqV,GACEx8B,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,CAAC8hC,OAAK,GACnBxuB,OAOTqN,GACA7pC,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEwU,MAAaxT,eAAkB,YAI/CnF,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAaxT,sBACpB,oBAAmBA,UACpB0kC,GACA7pC,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAaxT,+BACpB,6BAA4BA,MAEjCnF,EAAAA,cAACw9C,GAAAA,EAAO,CAACr5C,IAAI,+BACZwqD,EAAexpD,EAAM0kC,GACrB+kB,EAAazpD,EAAM43B,GAAe53B,MACnCnF,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEwU,MAAaxT,WAAc,UAGzCnF,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEwU,MAAaxT,WAAc,WAGzCnF,EAAAA,cAACw9C,GAAAA,EAAO,CAACr5C,IAAI,iBACbnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEwU,MAAaxT,aAAgB,cAGzC0kC,GACA7pC,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEwU,MAAaxT,aAAgB,UAIxC,KAIbnF,EAAAA,cAACmiC,GAAAA,EAAO,CACNh+B,IAAM,GAAEwU,qBACRqB,MAAO00C,EAAgB,kBAAmB/1C,IAEzCqkB,EAAen5B,KAAK04B,IACnB,MAAMe,EAAc,GAAEf,EAAOH,UAAUG,EAAOp3B,OACxC0pD,EAAqB,CACzBvxB,aACAD,WAAY,SACZ1kB,YAEF,OACE3Y,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,IACrBld,UAAWkd,EACXtjB,MACEha,EAAAA,cAACsgB,EAAAA,EAAc,CACb7W,QAAS6zB,EACTvjB,KACE/Z,EAAAA,cAACg8C,GAAoB,CACnB9d,WAAYA,EAAW2wB,GACvB5S,QAASA,KACPrd,EAAeiwB,EAAmB,OAO5C7uD,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,sBACtB,YAGDt9B,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,sBACpB,oBAAmBA,SACtBt9B,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,+BACpB,6BAA4BA,MAC/Bt9B,EAAAA,cAACw9C,GAAAA,EAAO,CAACr5C,IAAI,+BACZwqD,EAAerxB,GAAY,GAC3BsxB,EAAatxB,EAAYP,GAAe53B,MACzCnF,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,4BACpB,cAAaA,kBAChBt9B,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAM,GAAEwU,MAAa2kB,6BACpB,cAAaA,mBAChBt9B,EAAAA,cAACw9C,GAAAA,EAAO,MACRx9C,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEwU,MAAa2kB,aAAsB,UAG5C,KAId,OASnB,CAAC4vB,GAAA7sD,aAAA,4MCxaD,IAAIyuD,IAAW,ECIR,SAASC,KACd,MAAOC,GAAerhD,GAAqB29C,IACrC2D,EDL6BC,MACnC,MAAMrkB,GAAiBC,EAAAA,EAAAA,KACjBmF,GAAW76B,EAAAA,EAAAA,IAAemC,IAC1Bq4B,GAAgBC,EAAAA,EAAAA,MAEtB,OAAOphC,EAAAA,EAAAA,KACL7N,IAAA,IAAC,MAAEoM,GAAOpM,EAAA,OACRkG,UACMmpC,EAAS5/B,OAAS,IAAMy+C,KAC1BA,IAAW,EACXjkB,EAAeskB,WAAW,CACxBn1C,MAAO,2BACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,gCACzBE,KAAM,+HACNC,QACEla,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACuuD,GAAAA,EAAiB,CAChBn0C,QAASA,KACPw1B,EAAc,8BAA8B,GAE/C,yBAMT,CACD,GACH,GACD,ECxB4Bsf,GAE7B,OACEF,GACEhvD,EAAAA,cAACovD,GAAAA,EAAY,CACX9Y,UAAU,MACV+Y,aAAe93B,IACRA,GACH3jB,WAAWq7C,EAAsB,IACnC,EAEFK,MAAO1uD,IAAA,IAAC,MAAEwT,GAAOxT,EAAA,OAAKZ,EAAAA,cAACktD,GAAa,CAAC94C,MAAOA,GAAS,GAErDpU,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CACZC,WACEsuC,EAAYzD,SACR,iDACC,eAAcyD,EAAYlY,UAKrC92C,EAAAA,cAACuvD,GAAAA,EAAe,CACdx1C,KACE/Z,EAAAA,cAAC0e,EAAAA,GAAY,CACX3E,KACEi1C,EAAYzD,SACR,sBACA,mBAIVxT,MAAOiX,EAAYlY,KAAK5kC,MACtB,EACA88C,EAAYzD,SAAW,OAAInkC,MAOzC,CAAC2nC,GAAA1uD,aAAA,6DCxCD,MAAMmvD,GAAoBjvD,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,kCAAAC,YAAA,eAAVH,CAAU,yCAIvBkvD,GAAeA,KAC1B,MAAMC,GAAiBt6C,EAAAA,EAAAA,IAAetC,IAEtC,OACE9S,EAAAA,cAAC2vD,GAAAA,EAAS,CACRhiC,KACE3tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC0e,EAAAA,GAAY,CACX3E,KAAK,uBACLgiC,KAAK,SACLE,QAASpiC,KAEX7Z,EAAAA,cAACwvD,GAAiB,KAAC,uDAKvB5hC,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACGA,EAAAA,cAAC4qD,GAAwB,MAC1B5qD,EAAAA,cAACuvD,GAAAA,EAAe,CAACn1C,QAASP,GAAgBk+B,MAAM,OAChD/3C,EAAAA,cAACuvD,GAAAA,EAAe,CACdn1C,QAASP,GACTk+B,MAAQ,GAAE2X,EAAer9C,cAAcq9C,EAAep9C,WAExDtS,EAAAA,cAACuvD,GAAAA,EAAe,CAACxX,MAAM,UACvB/3C,EAAAA,cAAC27C,GAAAA,EAAW,CACVj8B,WAAY9e,IAAA,IAAC,UAAEsiB,GAAWtiB,EAAA,OACxBZ,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GAAKgjB,EAAS,CAAEtD,SAAU/F,KAC7B7Z,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,oCACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,yCACD,IAGR,CAAC9f,EAAOqkB,IACPpkB,EAAAA,cAACuvD,GAAAA,GAAervD,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,EAAK2zB,MAAM,gBAGhD/3C,EAAAA,cAAC27C,GAAAA,EAAW,CACVj8B,WAAYlS,IAAA,IAAC,UAAE0V,GAAW1V,EAAA,OACxBxN,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GAAKgjB,EAAS,CAAEtD,SAAU/F,KAC7B7Z,EAAAA,cAAC6f,EAAAA,EAAI,CAAC7F,MAAM,WACVha,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,8BACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,oDACN7f,EAAAA,cAAC6f,EAAAA,EAAI,KAAC,gBAER7f,EAAAA,cAACw9C,GAAAA,EAAO,MACRx9C,EAAAA,cAAC6f,EAAAA,EAAI,KACH7f,EAAAA,cAACsgB,EAAAA,EAAc,CACbvG,KACE/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wCAErBtQ,QAAQ,gCAGZzJ,EAAAA,cAAC6f,EAAAA,EAAI,KACH7f,EAAAA,cAACsgB,EAAAA,EAAc,CACbvG,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,yBACzBtQ,QAAQ,6BAGP,IAGR,CAAC1J,EAAOqkB,IACPpkB,EAAAA,cAACuvD,GAAAA,GAAervD,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,EAAK2zB,MAAM,wBAGhD/3C,EAAAA,cAAC+uD,GAAkB,MACnB/uD,EAAAA,cAACuvD,GAAAA,EAAe,CAACx1C,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBAC1C/Z,EAAAA,cAACuvD,GAAAA,EAAe,CAACx1C,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,2BAG9C,EAEJ01C,GAAApvD,aAAA,uD,eCzFK,MAAMuvD,GAA0BA,IAInC5vD,EAAAA,cAAC2f,EAAAA,GAAI,CACHuuC,aAJiB,CAAC,YAKlB,aAAW,eACXtuC,SAAU/F,IAEV7Z,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,WAAWic,UAAU,aAC7BpgB,EAAAA,cAACsgB,EAAAA,EAAc,CACbvG,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM,qBAC1BtQ,QAAQ,gBAKhBmmD,GAAAvvD,aAAA,kECmBF,MAAMga,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;EAO7Bu1C,GAActvD,EAAAA,GAAO+Z,GAAI;sBACT1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAao1C,cAAc;;;EAKhEt1C,GAAaja,EAAAA,GAAO+Z,GAAI;;;;;;EAQvB,SAASy1C,KACd,MAAMC,GAAsB56C,EAAAA,EAAAA,IAC1B2iB,GAAkBC,uBAEdi4B,GAA8B76C,EAAAA,EAAAA,IAClC2iB,GAAkBN,0BAClB5zB,IAAIqvB,KACA,cAAEmF,IAAkBjjB,EAAAA,EAAAA,IAAewiB,KAClCJ,EAAc04B,IAAmBtoC,EAAAA,EAAAA,IACtCmQ,GAAkBP,cAEdE,GAAYtiB,EAAAA,EAAAA,IAAe2iB,GAAkBL,YAC5C7P,EAAcC,IAAmB9iB,EAAAA,EAAAA,UACtC,IAAI8S,IAASm4C,EAA4B/9C,MAAM,EAAG,MAE7C2T,EAAc8B,IACnB3iB,EAAAA,EAAAA,UAAmBgrD,IACdp2B,EAAoBu2B,IAAyBnrD,EAAAA,EAAAA,UAClD,IAAI8S,IAASm4C,IAET5uB,GAAkB+uB,EAAAA,GAAAA,GACtB,CACE14B,YACAuC,OAAS7U,GAASA,EAAKjhB,IACvBovB,YAAcnO,GAAUiO,GAAYjO,GAAQA,EAAKtkB,SAAW,MAE9D,CACE+mB,aAAc+R,EACdy2B,qBAAsBF,IAIpBl4B,GADa7iB,EAAAA,EAAAA,IAAe4b,IACC/e,QAAQqd,GACzCsK,EAAmBC,IAAI3G,GAAoB5D,MAEvCghC,EjF1C0BC,MAChC,MAAM1yC,EAAmB5E,KACzB,OAAOxK,EAAAA,EAAAA,KACJyF,GACCpN,MAAOsqB,EAA+Bo/B,KACpC,MAAM,SAAE9hD,EAAQ,QAAEzB,GAAYiH,EACxBy5C,EACJ5gD,GAA2BmH,GAEvBu8C,SACElpD,QAAQiF,IACZ4kB,EACGnf,QAAQqd,IAAYC,GAAOI,SAASL,GAAQe,QAC5CxsB,KAAIiD,UACH,MAAM6R,QAAiBjK,EAAS8D,WAC9BwF,GAAeuX,GAAOpsB,KAAKmsB,KAE7B,GAAI3W,EACF,MAAO,CACLA,WACA2W,SACAvf,aAAc5M,IAAAA,SAAcwV,EAAU4W,GAAOpsB,KAAKmsB,IAEtD,MAGNrd,OAAO8F,GAAAA,GACH24C,GAAiB7yB,EAAAA,GAAAA,IACrB/pB,IAAA,IAAC,SAAE6E,GAAU7E,EAAA,OAAK6E,CAAQ,GAC1B83C,SAEIlpD,QAAQiF,IACZxI,OAAO+sB,QAAQ2/B,GAAgB7sD,KAAIiD,UAA8B,IAAtB6R,EAAUzP,GAAMsL,EACzD,MAAM,QAAEm8C,EAAU,GAAE,WAAEC,EAAa,KAAO/yB,EAAAA,GAAAA,IACxCppB,IAAA,IAAG6a,QAAQ,KAAE5iB,IAAQ+H,EAAA,MACV,UAAT/H,GAAoB8jD,EAAmB,aAAe,SAAS,GACjEtnD,GAsCF,SApCM3B,QAAQspD,WACZF,EAAQ9sD,KAAI8Q,IAAA,IAAC,aAAE5E,GAAc4E,EAAA,OAC3Bm8C,EAAAA,EAAAA,IAAW,CACT1oD,GAAE,GACF8O,IAAKyB,EACL/V,SAAUmN,GACV,KAGF6gD,EAAWvgD,OAAS,UACKuH,EAAAA,GAAAA,WACb,CAAExP,GAAE,GAAE8O,IAAKyB,EAAUyL,IAAK,SACrCna,OAAM,IAAM,aAEP2jD,EAAAA,EAAAA,IAAS,CACbxlD,GAAE,GACF8O,IAAKyB,EACL1P,OAAO,EACP4P,UAAW+3C,EAAW/sD,KACpBgR,IAAA,IAAC,aAAE9E,EAAcuf,QAAQ,KAAE5iB,IAAQmI,EAAA,OAAK9E,CAAY,YAOlDxI,QAAQiF,IACZokD,EACG3+C,QAAOmoB,IAAA,IAAC,OAAE9K,GAAQ8K,EAAA,MAAqB,UAAhB9K,EAAO5iB,IAAgB,IAC9C7I,KAAIy2B,IAAiB,IAAhB,OAAEhL,GAAQgL,EACd,MAAMlxB,EAAWmmB,GAAOpsB,KAAKmsB,GAC7B,OAAOlnB,GAAGN,SAAS6iB,OAAOvhB,EAAS,MAKzConD,EAAkB,CACpB,MAAMlrD,QAAeoJ,EAAS8D,WAAWoC,IACzCwc,EAAQnf,OAAOsd,GAAOe,YAAYpsB,SAASorB,IACzChqB,EAAO2P,UAAUsa,GAAOpsB,KAAKmsB,GAAQ,GAEzC,CAG2BtF,GACzB9gB,EAAMxF,SAAQu3B,IAAiB,IAAhB,OAAE3L,GAAQ2L,EACvB,MAAoB,aAAhB3L,EAAO5iB,KAEF,GAEW,UAAhB4iB,EAAO5iB,KACF,CAAC4iB,EAAOE,OAAOrsB,KAAMmsB,EAAOG,MAAMtsB,MAEpCosB,GAAOpsB,KAAKmsB,EAAO,KAE5BzrB,IAAIV,IAAAA,SACae,SAAS6sD,GAC1B9jD,EAAQb,GAAgB2kD,YAGpBxpD,QAAQspD,WACZ3nD,EAAMrF,KAAIiD,UAAqC,IAA9B,aAAEiJ,EAAY,OAAEuf,GAAQ+L,EACvC,MAAMjyB,EAAWmmB,GAAOpsB,KAAKmsB,SACvBq+B,EAAmBvkD,SACnB0nD,EAAAA,EAAAA,IAAW,CAAE1oD,GAAE,GAAE8O,IAAKyB,EAAU/V,SAAUmN,UAC1C8N,EAAiBzU,EAAS,IAEnC,IAEJ,GAEL,GACD,EiFpEuBmnD,GAClBS,GAAWlmB,EAAAA,EAAAA,KACXmmB,GAAUtgD,EAAAA,EAAAA,IAAkBonB,GAAkBR,QAC9CnjB,EAAQA,IAAM68C,GAAQ,GAEtBjrC,GAAUnV,EAAAA,EAAAA,QAAqB,MAC/Bs+B,GAAchhB,EAAAA,GAAAA,GAAe,CAAEnI,aAC9BwqC,EAAkBU,IAAuBlsD,EAAAA,EAAAA,WAAS,GAEnDmsD,EAA4Bl5B,EAAgBH,MAC/CxI,GAA2B,UAAhBA,EAAO5iB,OAGrB,OACE1M,EAAAA,cAAC6sB,GAAAA,GAAW,CACVhK,QAASzO,EACTg1C,OAAQ5xB,EACRkyB,eAAgBwG,EAChBnjC,UAAW,IACXD,SAAU,KAEV9sB,EAAAA,cAACgtB,GAAAA,EAAY,CACXC,OAAO,mBACPxjB,QACEzJ,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAASi1B,IACvB3hC,IAAA,IAAC,qBAAE8R,GAAsB9R,EAAA,OACxBxN,EAAAA,cAACqa,GAAoBiF,EACnBtf,EAAAA,cAAA,OAAKyZ,MAAO,CAAE4T,QAAS,SACrBrtB,EAAAA,cAAC6iC,GAAAA,EAAO,KACN7iC,EAAAA,cAACiiC,GAAAA,GAAU,CAACvW,YAAU,GACpB1rB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,kBAErB/Z,EAAAA,cAAC6hC,GAAAA,EAAkB,CACjBniB,WAAYjQ,IAAA,IAAC,UAAEyT,GAAWzT,EAAA,OACxBzP,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACb2E,aAAc,GAEdjI,SAAU/F,KAEV7Z,EAAAA,cAACmiC,GAAAA,EAAO,CAACnoB,MAAM,YAGXsc,GAAuBzyB,KAAK2yB,GAC1Bx2B,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKqyB,EAASlY,IAAKkY,EAASxc,UAInC,GAGTha,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,0BAGvB/Z,EAAAA,cAAA,QAAMyZ,MAAO,CAAEghC,KAAM,KACrBz6C,EAAAA,cAAC6iC,GAAAA,EAAO,KACN7iC,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe8T,aACvC7uB,EAAAA,cAAC4uB,GAAAA,EAAY,CAAC9T,SAAUC,GAAAA,EAAe+T,iBAI3C9uB,EAAAA,cAAC6vD,GAAW,KACV7vD,EAAAA,cAACyf,EAAAA,EAAoB,CACnBC,WAAYA,IAAM1f,EAAAA,cAAC4vD,GAAuB,MAC1Cn2C,MAAO,CAAE0H,OAAQ,SAEjBnhB,EAAAA,cAACuhC,GAAAA,EAA6B,CAC5Bvb,QAASA,EACT9c,MAAOwuB,EACP7O,cAAc,WACdhB,aAAcA,EACd7H,kBAAmB8H,EACnBjC,aAAcA,EACdiD,iBAAkBnB,EAClB0Z,gBAAiBA,EACjBzY,oBAAkB,IAEhBxD,IACA,MAAMrlB,EAAQ6gC,GAA4BR,aAAa,CACrDhb,OACAiT,kBAEF,OACEr4B,EAAAA,cAAC6f,EAAAA,EAAS9f,EACmB,IAA1BqlB,EAAKtkB,UAAUuP,QACdrQ,EAAAA,cAACwhC,GAAAA,EAAgB,CACf9c,eAAgB2c,EAAgBI,kBAC9Brc,GAEFsc,SAAUA,IAAML,EAAgBM,OAAOvc,KAG1CrlB,EAAMe,SACF,MAMD,IAIxB2sB,OACEztB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,OACEyZ,MAAO,CACL0T,QAAS,kBACTE,QAAS,OACTC,cAAe,WAGjBttB,EAAAA,cAACwa,GAAU,KACTxa,EAAAA,cAACktC,GAAc,CAAC9b,QAAS6G,KAE3Bj4B,EAAAA,cAACwtB,GAAAA,EAAQ,CACP9B,YAAaylC,EACb3nC,WAAYgnC,EACZhuC,SAAU0uC,EACVjkB,SAAS,KACV,2CAIHjtC,EAAAA,cAACgtB,GAAAA,EAAaU,OAAM,CAClBE,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,GAAAA,EAAM,CAAC1P,QAAShG,EAAO64B,SAAS,KAAI,SAGrCjtC,EAAAA,cAAC8pB,GAAAA,EAAM,CACLC,QAAQ,UACRkjB,SAAS,IACTvhB,WAAuC,IAA3BuM,EAAgB5nB,OAC5B+J,QAASA,KACPk2C,EAAgBr4B,EAAiBu4B,GAC9BvmD,OAAOC,IACN8mD,EAASl3C,KAAK,CACZE,MAAO,2BACPD,KAAM,QACNE,KAAM,iEAERnQ,QAAQ4D,MAAM,oBAAqBxD,EAAE,IAEtCu6B,QAAQrwB,EAAM,GAEpB,kBAWnB,CAAC27C,GAAA1vD,aAAA,yDC9PM,MAAM+wD,IAAmBniD,EAAAA,EAAAA,IAAK,CACnC9K,IAAK,cACLmJ,QAAS,IAAI+jD,GAAAA,GACXrtD,OAAO+2C,YACLwN,GAAY1kD,KAAIjD,IAAA,IAAC,GAAE0d,EAAE,aAAEkqC,GAAc5nD,EAAA,MAAK,CAAC0d,EAAIkqC,EAAa,KAE9D,CACE8I,sBAAuB/I,GACpBt2C,QAAOzE,IAAA,IAAC,iBAAE+jD,GAAkB/jD,EAAA,OAA0B,IAArB+jD,CAA0B,IAC3D1tD,KAAI4L,IAAA,IAAC,GAAE6O,GAAI7O,EAAA,OAAK6O,CAAE,Q,wCCN3B,MAAMkzC,GAAO,CACX,CACE12C,SAAUC,GAAAA,EAAe02C,iBACzBz3C,MAAO,uCAET,CACEc,SAAUC,GAAAA,EAAe22C,iBACzB13C,MAAO,wCAIE23C,GAAUA,KACrB,MAAMC,GAASC,EAAAA,EAAAA,MAETC,GAAenuC,EAAAA,EAAAA,UACnB,IACE6tC,GACG3tD,KAAIjD,IAAA,IAAC,SAAEka,EAAQ,MAAEd,GAAOpZ,EAAA,MAAM,CAC7BmxD,iBAAkBH,IAAS92C,IAAWlE,MACnCuQ,GAA+B,aAAlBA,EAASza,OAEzBsN,QACD,IACA/H,QAAOzE,IAAA,IAAC,iBAAEukD,GAAkBvkD,EAAA,OAAKukD,CAAgB,IACjDluD,KAAI4L,IAAA,IAAC,iBAAEsiD,EAAgB,MAAE/3C,GAAOvK,EAAA,OAC/BuK,EAAM5U,QAAQ,aAAa4sD,EAAAA,GAAAA,GAAiBD,GAAmB,KAErE,CAACH,KAEIx+C,EAAO6+C,IAAYjtD,EAAAA,EAAAA,UACxBqP,KAAK69C,MAAM79C,KAAK89C,SAAWL,EAAazhD,SAE1C,MAAO,CACLS,QAASghD,EAAa1+C,GACtBg/C,KAAMA,KACJ,MAAMC,EAAWh+C,KAAK69C,MAAM79C,KAAK89C,UAAYL,EAAazhD,OAAS,IAC7DqD,EAAW2+C,EAAWj/C,EAAQi/C,EAAWA,EAAW,EAC1DvoD,QAAQiB,IAAI,oBAAqB2I,EAAU,WAAY2+C,GACvDJ,EAASv+C,EAAS,EAErB,E,4BC3CI,MAAM4+C,GAAQtyD,EAAAA,YAAiB,SACpCD,EACAwyD,GAEA,MAAMnuC,GAAMouC,EAAAA,GAAAA,GAAaD,IAGnB,eAAEE,IAAmBC,EAAAA,GAAAA,GAAa,CAAEvvC,UAAWpjB,EAAMojB,WAAaiB,GACxE,OAAOpkB,EAAAA,cAAA,SAAAE,EAAAA,EAAAA,GAAA,IAAWsf,EAAAA,GAAAA,GAAWizC,EAAgB1yD,GAAM,CAAEqkB,IAAKA,IAC5D,IAAGkuC,GAAAjyD,aAAA,gDCFI,MAAMsyD,GAAwB,CAInCp7B,QAAQtoB,EAAAA,EAAAA,IAAK,CACX9K,IAAK,2BACLmJ,SAAS,IAKXgG,KAAKrE,EAAAA,EAAAA,IAAa,CAChB9K,IAAK,wBACLmJ,QAAS,QAKXslD,gBAAgB3jD,EAAAA,EAAAA,IAAc,CAC5B9K,IAAK,mCACLmJ,aAAS8Z,IAKXyrC,oBAAoBxlD,EAAAA,EAAAA,IAA2B,CAC7ClJ,IAAK,iCACLmJ,QAAS,KAKX87C,QAAQn6C,EAAAA,EAAAA,IAA6B,CACnC9K,IAAK,2BACLmJ,QAAS,QC9BN,SAASwlD,GAAiBlyD,GAmBmB,IAnBlB,WAChCmyD,EAAU,qBACVC,EAAoB,gBACpBC,EAAe,UACflmC,KACGmmC,GAc4CtyD,EAC/C,MAAMuyD,GAAgBxiD,EAAAA,EAAAA,IAAkBqiD,GAClCI,EAAgB9kD,GAAsB0kD,EAAsB,CAChExJ,IAAK,IACLroC,OAAQ9M,KAAKC,IAAI,IAAKpI,OAAOu9C,YAAc,QAGtCL,EAAQC,IAAarkD,EAAAA,EAAAA,UAA0BouD,GAChDC,GAAqBxiD,EAAAA,EAAAA,QAAOu4C,EAAOjoC,QAezC,OAPAlT,EAAAA,EAAAA,YAAU,KACRo7C,GAAWD,IAAM,IACZA,EACHjoC,OAAQ4xC,EAAaM,EAAmBviD,QAAUmiD,KACjD,GACF,CAACF,IAGF/yD,EAAAA,cAACspD,GAAAA,IAAKppD,EAAAA,EAAAA,GAAA,GACAgzD,EAAU,CACd9J,OAAQA,EACRM,eAlBoBN,IAClB2J,IACFM,EAAmBviD,QAAUs4C,EAAOjoC,OACpCgyC,EAAc/J,IAEhBC,EAAUD,EAAO,EAcfr8B,UAAYgmC,EAA+BhmC,EAAlBkmC,IAG/B,CAACH,GAAAzyD,aAAA,80C,wCC/DM,MAAMizD,GAAoB/yD,EAAAA,GAAOy+B,IAAK;;;;;EAMhCu0B,IAAmBhzD,EAAAA,EAAAA,IAAOwoB,GAAAA,EAAY;;;;EAKtCyqC,GAAqBjzD,EAAAA,GAAOy+B,IAA+B;WAC7Dp+B,IAAA,IAAC,MAAEgE,EAAK,WAAE8mB,GAAY9qB,EAAA,OAC7B8qB,GACA9mB,EAAM+U,uBAAuB/U,EAAM8V,aAAag1B,kBAAkB;ECChEyB,GAAe5wC,EAAAA,GAAO+Z,GAAI;;EAMzB,SAASm5C,GAAU7yD,GAMtB,IANuB,OACzBwa,EAAM,WACNs4C,GAID9yD,EACC,MAAM,WAAE4oB,IAAeF,EAAAA,EAAAA,YAAWC,GAAAA,IAAqB,CAAC,EACxD,OACEvpB,EAAAA,cAACuzD,GAAgB,KACfvzD,EAAAA,cAACszD,GAAiB,KAAEl4C,EAAOrB,MAC3B/Z,EAAAA,cAACwzD,GAAkB,CAAC9nC,WAAYtQ,EAAOsQ,YACpClC,EACCxpB,EAAAA,cAAC2zD,GAAAA,EAAkB,CAACD,WAAYA,GAC7Bt4C,EAAOpB,OAGVoB,EAAOpB,OAGXha,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,CAACzP,MAAO,CAAEpT,SAAU,QAAS06B,WAAY,SACtD3lB,EAAO+L,UAEVnnB,EAAAA,cAACmxC,GAAY,MACbnxC,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,CACdzP,MAAO,CACLm6C,YACE,cAcZ,SAA6Bx4C,EAAgBy4C,GAC3C,IAAI1uC,GAAS2uC,EAAAA,GAAAA,IAAwB14C,GAAUA,EAAO+J,OAAS,KAC/D,MAAM4uC,EAAkE,GACxE,KAAO5uC,GACL4uC,EAAW/T,QAAQ6T,EAAQ1uC,EAAO0uC,GAAS1uC,GAC3CA,EAASA,EAAOA,OAElB,OAAO4uC,CACT,CAnBSC,CAAoB54C,EAAQ,SAASlF,KAAK,QAInD,CAeCu9C,GAAApzD,aAAA,6UCvDM,MAAM4zD,GAGR,CACH31C,GAAI,UACJtE,MAAO,UACPc,SAAUC,GAAAA,EAAeE,aACzBi5C,IAAKtzD,IAA4D,IAA3D,kBAAEuzD,GAAmDvzD,EACzD,MAAMgyD,GAAiBx9C,EAAAA,EAAAA,IAAeu9C,GAAsBC,iBACrDwB,EAAqBC,IAA0BrvD,EAAAA,EAAAA,UAEpD,MACIsvD,GAAa3wC,EAAAA,EAAAA,UACjB,IAAOivC,GAAiB2B,EAAAA,EAAAA,IAAuB3B,GAAkB,IACjE,CAACA,IAEG4B,EACJJ,GAAuBD,EACnBj6C,EAA8B,CAClC,CACEoE,GAAIvD,GAAAA,EAAe05C,uBACnBz6C,MAAO,oBACP2E,gBAAiB9E,KAGrB,MAAO,CACL66C,OAASltB,IACP,MAAMmtB,EAAaL,EAChBzwD,KAAKuX,IAAM,CACVs4C,YAAYkB,EAAAA,GAAAA,GAAex5C,EAAOpB,MAAOwtB,GACzCpsB,aAEDnJ,QACCzE,IAAA,IAAC,OAAE4N,EAAM,WAAEs4C,GAAYlmD,EAAA,OACrBkmD,IAAckB,EAAAA,GAAAA,GAAex5C,EAAOmD,aAAe,GAAIipB,EAAM,IAEnE,OAAOgtB,EACHG,EACAA,EAAW1iD,QAAOxC,IAAA,IAAC,OAAE2L,GAAQ3L,EAAA,OAAM2L,EAAOsQ,UAAU,GAAC,EAE3DmpC,WAAY,CAACL,GACbM,aAAcN,EAEdO,iBAAkBA,KAChBV,GAAwBtjD,IAAkBA,GAAa,EAEzDikD,iBACEh1D,EAAAA,cAACi1D,GAAAA,EAAc,CAACn6C,SAAUC,GAAAA,EAAe05C,yBACrCttC,GAAc,SAAQA,2BAG5B+tC,cACEl1D,EAAAA,cAACwtB,GAAAA,EAAQ,CACPsgB,cAAY,EACZtkB,WAAYgrC,EACZhyC,SAAWpe,IACTiwD,EAAuBjwD,EAAM,GAEhC,4BAIH8V,UACAi7C,mBAAAA,CAAmB/kD,GAAc,IAAb,OAAEgL,GAAQhL,EAC5BgL,GAAQ8F,QAAQ,CACdzE,MAAO,KACP8L,QAASqqC,GAEb,EACA34B,OAAQnmB,IAAA,IAAC,OAAEsH,GAAQtH,EAAA,OAAKsH,EAAOkD,EAAE,EACjC82C,WAAAA,CAAW5gD,GAAqD,IAAlD4G,QAAQ,MAAEpB,IAA6BxF,EACnD,OAAOwF,CACT,EACAq7C,UAAAA,CAAU5gD,GAMN,IANO,OACT2G,EAAM,WACNs4C,GAIDj/C,EACC,OAAOzU,EAAAA,cAACyzD,GAAU,CAACr4C,OAAQA,EAAQs4C,WAAYA,GACjD,EACD,G,gBC7EE,SAAS4B,GAAQ10D,GASpB,IATqB,KACvBmR,EAAI,QACJ8rC,GAODj9C,EACC,MAAM,WAAE4oB,IAAeF,EAAAA,EAAAA,YAAWC,GAAAA,IAAqB,CAAC,EAClDvP,EAAQjI,EAAK5M,KACb+R,EAAM/T,IAAAA,QAAa4O,EAAKhC,eAEvBwlD,EAAYC,IAAmBC,EAAAA,GAAAA,IACnCluB,GAAUA,EAAMhC,MAAQruB,EAAI7G,QAC7BwtC,GAAW,IAEP6X,EAAeF,EAAgB3xD,KAAI2J,IAAA,IAAC,KAAE+3B,EAAI,GAAEC,GAAIh4B,EAAA,MAAM,CAC1D+3B,KAAMA,EAAOruB,EAAI7G,OACjBm1B,GAAIA,EAAKtuB,EAAI7G,OACd,IACD,OACErQ,EAAAA,cAACuzD,GAAgB,KACfvzD,EAAAA,cAACszD,GAAiB,KAChBtzD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAMpX,EAAeoP,EAAK5O,SAE1CnD,EAAAA,cAACwzD,GAAkB,KAChBhqC,EACCxpB,EAAAA,cAAC2zD,GAAAA,EAAkB,CAACD,WAAYgC,GAC7B17C,GAGHA,GAGJha,EAAAA,cAAC+oB,GAAAA,EAAWG,KAAI,KACbM,EACCxpB,EAAAA,cAAC2zD,GAAAA,EAAkB,CAACD,WAAY6B,GAAar+C,GAE7CA,GAKV,CAACo+C,GAAAj1D,aAAA,wWCnDM,MAAMs1D,GAGR,CACHr3C,GAAI,QACJtE,MAAO,QACPc,SAAUC,GAAAA,EAAeC,WACzBk5C,IAAKA,KACH,MAAM0B,GAAkBnnD,EAAAA,EAAAA,KACtB7N,IAAA,IAAC,SAAE8N,GAAU9N,EAAA,MACX,IACE8N,EAASC,YAAYS,IAA0BjB,UAAU,GAC7D,KAEI,SAAE4G,GAAaI,KACfmZ,EAA0BpI,KAChC,MAAO,CACLwuC,OAASltB,GACPouB,IACG/xD,KAAKkO,IAAI,CACR8rC,SAAS+W,EAAAA,GAAAA,GAAe7iD,EAAKhC,aAAcy3B,GAC3Cz1B,WAEDE,QAAOzE,IAAA,IAAC,QAAEqwC,GAASrwC,EAAA,OAAKqwC,GAASxtC,MAAM,IAC5CwkD,WAAY,GACZC,cAAc,EACdK,mBAAAA,CAAmB1lD,GAAY,IAAX,KAAEsC,GAAMtC,EACP,SAAfsC,GAAMrF,MACRqI,EAAShD,EAAK5O,MAAM,GAEH,QAAf4O,GAAMrF,MACR4hB,EAAwBvc,EAAK5O,KAEjC,EACA82B,MAAAA,CAAM7pB,GAAY,IAAX,KAAE2B,GAAM3B,EACb,OAAO2B,EAAK5O,IACd,EACAkyD,UAAAA,CAAUvhD,GAMN,IANO,KACT/B,EAAI,QACJ8rC,GAID/pC,EACC,OAAO9T,EAAAA,cAACs1D,GAAQ,CAACvjD,KAAMA,EAAM8rC,QAASA,GACxC,EACAuX,WAAAA,CAAW5gD,GAA+D,IAA5DzC,MAAM,aAAEhC,IAAyCyE,EAC7D,OAAOzE,CACT,EACD,GCjEQ8lD,GACG,2BADHA,GAED,2BCmCN5kB,GAAe1wC,EAAAA,GAAO+Z,GAAI;;;gBAGhB1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACtBgE,EAAM0U,MAAM,qCAAqC;;MAE/C9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,2CAA2C;EAEtEw8C,GAAYv1D,EAAAA,GAAO06C,MAAuB;;gBAEhCxrC,IAAA,IAAC,MAAE7K,EAAK,SAAEmxD,GAAUtmD,EAAA,OAChCsmD,GAAYnxD,EAAM0U,MAAM,0CAA0C;WAC3DlJ,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACjBxL,EAAM0U,MAAM,0CAA0C;aAC7CxF,IAAA,IAAC,SAAEkkC,GAAUlkC,EAAA,OAAKkkC,GAAY,IAAI;EAEzCge,GAAmBz1D,EAAAA,GAAOy+B,IAAK;;;;;EAM/Bi3B,GAAa11D,EAAAA,GAAO+Z,GAAI;;;EAIxB47C,GAA6B31D,EAAAA,GAAO+Z,GAAI;;;;;;;;;;;;;;eAc/B9F,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,OAAK5P,EAAM0U,MAAM,wBAAwB;oBAC9C7E,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,OAAK7P,EAAM0U,MAAM,wBAAwB;;;EAIjE68C,GAA+B51D,EAAAA,GAAO+Z,GAAI;;;;EAK1C87C,GAAgB71D,EAAAA,GAAO81D,EAAG;;;;;MAK1B1hD,IAAA,IAAC,MAAE/P,GAAO+P,EAAA,OAAK/P,EAAM0U,MAAM,2CAA2C;EAEtEg9C,GAAwB/1D,EAAAA,GAAO+Z,GAAI;WAC9BzF,IAAA,IAAC,MAAEjQ,GAAOiQ,EAAA,OACjBjQ,EAAM0U,MAAM,8CAA8C;;EAIxDi9C,GAAiBh2D,EAAAA,GAAO+Z,GAAI;WACvB8f,IAAA,IAAC,MAAEx1B,GAAOw1B,EAAA,OACjBx1B,EAAM+U,uBACJ/U,EAAM0U,MAAM,+CACb;;;EAKCk9C,GAAoBj2D,EAAAA,GAAO+Z,GAAI;WAC1BggB,IAAA,IAAC,MAAE11B,GAAO01B,EAAA,OAAK11B,EAAM8V,aAAag1B,iBAAiB;;;;;EAQxD+mB,GAAe,CAACxC,GAA0B0B,IAE1Ce,GAAiB,CAAC,EAClBC,GAAqB,qBAKpB,SAASC,KACd,MAAM3F,GAAUtgD,EAAAA,EAAAA,IAAkBgiD,GAAsBp7B,SACjDjkB,EAAKujD,IAAUjvC,EAAAA,EAAAA,IAAe+qC,GAAsBr/C,MACpD6gD,EAAmB2C,IAAwB9xD,EAAAA,EAAAA,WAAS,IACpD+xD,EAASC,IAAchyD,EAAAA,EAAAA,UAC5BsJ,GAAsBqkD,GAAsBE,mBAAmBv/C,KAE3D2jD,GAA4BtmD,EAAAA,EAAAA,IAChCgiD,GAAsBE,mBAAmBv/C,IAGrC4H,GAAcC,EAAAA,GAAAA,MACb0M,EAAcC,IAAmB9iB,EAAAA,EAAAA,UAAoB,IAAI8S,KAC1Do/C,EAIF,CAAC,EACLT,GAAavyD,SAASizD,IACpBD,EAAgBC,EAAY74C,IAAM,IAC7B64C,KACAA,EAAYjD,IAAI,CAAEC,sBACtB,IAGH,MAAMiD,EAAqBX,GACxBxkD,QAAQklD,GAAwB,KAAR7jD,GAAc6jD,EAAY74C,KAAOhL,IACzDzP,KAAIo3B,IAAA,IAAC,GAAE3c,GAAI2c,EAAA,OAAKi8B,EAAgB54C,EAAG,KAE/B+4C,EAAmBC,IACxBtyD,EAAAA,EAAAA,UAxCwB,KAyCpB,aAAEuyD,IAAiB5zC,EAAAA,EAAAA,UAAQ,KASxB,CACL4zC,aARmBH,EAAmB1zD,SAASyzD,GAC/CA,EAAYzC,OAAOqC,GAASlzD,KAAK+L,IAAI,CACnCzL,IAAM,GAAEgzD,EAAY74C,MAAM64C,EAAYl9B,OAAOrqB,KAC7CunD,cACAvnD,gBAMH,CACDmnD,EACAzjD,KACG8jD,EAAmB1zD,SAAQ23B,IAAA,IAAC,WAAEw5B,GAAYx5B,EAAA,OAAKw5B,CAAU,MAExD2C,EAAwBN,EAAgB5jD,GAExCmkD,GAAsB9zC,EAAAA,EAAAA,UAAQ,KAClC,MAAM8zC,EAAsBF,EAAarlD,MAAM,EAAGmlD,GASlD,OARgBE,EAAalnD,OAASonD,EAAoBpnD,QAExDonD,EAAoB3nD,KAAK,CACvB3L,IAAKwyD,GACL/mD,KAAM8mD,GACNS,YAAa,OAGVM,CAAmB,GACzB,CAACJ,EAAmBE,IAEjBG,GAAqB7mD,EAAAA,EAAAA,QAAsB,OAajD5C,EAAAA,EAAAA,YAAU,KACJ8oD,GACFE,EAA0BF,EAC5B,GACC,CAACA,EAASzjD,KAEbrF,EAAAA,EAAAA,YAAU,KACR,GAAIspD,EAAa,GAAI,CAInB,MAAM,IAAEpzD,GAAQozD,EAAa,GAC7BzvC,EAAgB,IAAIhQ,IAAI,CAAC3T,KACzBwzD,EAAoB7mD,SAAS8mD,cAAczzD,GAK3CyoB,uBAAsB,KACpB+qC,EAAoB7mD,SAAS8mD,cAAczzD,EAAI,GAEnD,CACAmzD,EA5GwB,GA4GiB,GACxC,CAACC,IAEJ,MAAMM,EAAmC,CACvC,CACEv5C,GAAIu3C,GACJ77C,MAAO,WACPuE,YAAa,qDACbI,gBAAiBA,KACf,MAAMm5C,EAA0BrB,GAAapjD,WAC3CooB,IAAA,IAAC,GAAEnd,GAAImd,EAAA,OAAKnoB,IAAQgL,CAAE,IAGxBu4C,EACU,KAARvjD,EACImjD,GAAavkD,OAAO,GAAG,GAAGoM,GAC1Bm4C,GAAaqB,EAA0B,IAAIx5C,IAAM,GACtD,GAGL,CACEA,GAAIu3C,GACJ77C,MAAO,WACPuE,YAAa,iDACbI,gBAAiBA,KACf,MAAMm5C,EAA0BrB,GAAapjD,WAC3C62B,IAAA,IAAC,GAAE5rB,GAAI4rB,EAAA,OAAK52B,IAAQgL,CAAE,IAExBu4C,EAAOJ,GAAaqB,EAA0B,IAAIx5C,IAAM,GAAG,IAI3Dy5C,EAAqBtB,GAAa/yD,SAAQ+5C,IAA8B,IAA7B,GAAEn/B,EAAE,SAAExD,EAAQ,MAAEd,GAAOyjC,EACtE,OAAO3iC,EACH,CACE,CACEwD,GAAIxD,EACJd,MAAQ,QAAOA,IACfuE,YAAc,iBAAgBvE,YAC9B2E,gBAAiBA,KACXrL,IAAQgL,EACVu4C,EAAOv4C,GAEPk5C,GAAuBzC,oBACzB,IAIN,EAAE,IAGF3gD,EAAQA,IAAM68C,GAAQ,GAEtB/L,GAAiBr0C,EAAAA,EAAAA,QAAyB,MAC1C8mD,GAAsB9mD,EAAAA,EAAAA,QAAyB,MAC/C+O,EAAYzb,IAChB,GAAIA,IAAQwyD,GAAoB,CAC9BW,GAAsBU,GAAUA,EArKV,KAsKtB,MAAMC,EAAWV,EAAaE,EAAoBpnD,OAAS,GACvD4nD,GAKFrkD,YAAW,KACTkU,EAAgB,IAAIhQ,IAAI,CAACmgD,EAAS9zD,OAClCwzD,EAAoB7mD,SAAS8mD,cAAcK,EAAS9zD,IAAI,GAG9D,MACEiQ,IAKAR,YAAW,KACT,MAAMskD,EAAcX,EAAa3gD,MAAMhH,GAASA,EAAKzL,MAAQA,IAC7D+zD,GAAaf,YAAYhC,oBAAoB+C,EAAYtoD,KAAK,GAa7D,GACL,EAGI4hD,EAAOG,KACb,OACE3xD,EAAAA,cAAC8yD,GAAiB,CAChBE,qBAAsBL,GAAsBvJ,OAC5C2J,WAAYhG,QAAQgK,GACpB9D,gBAAiB,GACjBnmC,SAAU,IACVC,UAAW,IACX68B,aAAa,MACb/mC,QAASzO,GAETpU,EAAAA,cAACqf,EAAAA,GAAe,CACdnF,QAAS,IACHs9C,GAAuBt9C,SAAW,MACnC69C,KACAF,KAGJM,IAAA,IAAC,qBAAE74C,GAAsB64C,EAAA,OACxBn4D,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,GAASof,EAAoB,CAAE7F,MAAO,CAAE0H,OAAQ,aAC9CnhB,EAAAA,cAACspD,GAAAA,GAAMO,OAAM,CACX58B,OACEjtB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACspD,GAAAA,GAAMQ,OAAM,CAACC,aAAW,GACvB/pD,EAAAA,cAACixC,GAAY,KACXjxC,EAAAA,cAAA,OAAKyZ,MAAO,CAAEghC,KAAM,IAClBz6C,EAAAA,cAACo4D,GAAAA,EAAI,CACHC,aAAcvC,GACdwC,cAAerC,GACfl2C,YAAazM,EACb0M,kBAAoB7b,GAClB0yD,EAAO1yD,IAGTnE,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAI,IACRnE,EAAAA,cAACg2D,GAAgB,KAAC,QAGlBS,GAAa5yD,KAAKszD,IAChB,MAAMhwC,EAAWjM,EACfi8C,EAAYr8C,UAERd,EACJha,EAAAA,cAACg2D,GAAgB,KACdmB,EAAYn9C,OAGjB,OACEha,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKgzD,EAAY74C,IACpB6I,EACCnnB,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAAC44C,GAAAA,EAAO,KAAEzxB,IAGnBnnB,EAAAA,cAAA,YAAOga,IAGTA,EAEG,MAMhBw9C,GAAuBtC,cACxBl1D,EAAAA,cAACiiC,GAAAA,GAAU,CAACxoB,MAAO,CAAEuwC,OAAQ,YAAct+B,YAAU,GACnD1rB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,gCAIzB/Z,EAAAA,cAACk2D,GAA0B,KACzBl2D,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBACnB/Z,EAAAA,cAACu4D,GAAAA,GAAU,CAACC,SAAO,GACjBx4D,EAAAA,cAACsyD,GAAK,CACJluC,IAAK8gC,EACL/hC,WAAS,EACTlS,QAAUwL,IACRA,EAAM3T,OAAOyK,QAAQ,EAEvBnP,MAAO2yD,EACPv0C,SAAWtY,GAhNPuuD,KACxB,MAAMC,EACJhB,EAAmB5mD,SACnB2nD,EAAW5pD,SAAS6oD,EAAmB5mD,SAErC0mD,GAAuB1C,eAAiB4D,GAC1C5B,GAAqB,GAEvBE,EAAWyB,EAAW,EAyMAE,CAAiBzuD,EAAEgH,cAAc9M,UAIvCpE,EAAAA,cAACs2D,GAAqB,KACnBkB,GAAuBxC,oBAKhCvrD,QACEzJ,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACo2D,GAAa,MACbW,GACC/2D,EAAAA,cAACm2D,GAA4B,KAC3Bn2D,EAAAA,cAAC2gD,GAAAA,EAAI,CACH2E,cAAeJ,EACfyS,oBAAqBA,EACrBzuD,MAAOuuD,EACP5uC,cAAc,SACd08B,eAAa,EACbqT,iBAAe,EACfhwC,oBAAkB,EAClBf,aAAcA,EACd7H,kBAAmB8H,EACnBlI,SAAUA,IAETi5C,IAAiC,IAAhC,IAAE10D,EAAG,KAAEyL,EAAI,YAAEunD,GAAa0B,EAC1B,GAAI10D,IAAQwyD,GACV,OACE32D,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKwyD,IACT32D,EAAAA,cAACu2D,GAAc,KAAC,YAItB,MAAMuC,EAAW3B,EAAY/B,YAAYxlD,GACzC,OACE5P,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAKA,EACLic,UAAW04C,EACX,aAAYA,GAEX3B,EAAY9B,WAAWzlD,GACnB,IAIY,IAAxB2nD,EAAalnD,QACZrQ,EAAAA,cAACw2D,GAAiB,KAAC,qCAQ7B/oC,OACEztB,EAAAA,cAACspD,GAAAA,GAAMpgC,KAAI,KACRsoC,EAAK1gD,QAAQ,IAAC9Q,EAAAA,cAACma,GAAAA,EAAI,CAACC,QAASo3C,EAAKY,MAAM,eAI3C,IAKhB,CAACwE,GAAAv2D,aAAA,kGC7cM,MAAM04D,GACV7kD,GAAyCpN,UACxC,MAAM0jB,EAAoB1R,GAA0B5E,GAC9CgD,QAAYU,EAAAA,GAAAA,SAAa,CAAExP,GAAE,GAAExF,mBAC/BgV,EAAAA,GAAAA,IAAQ,CAAExP,GAAE,GAAE8O,MAAKtU,SAAUO,IAAAA,SAAc+T,EAAKtU,WAChD4nB,EAAkB5nB,EAAS,E,2BCDrC,MAAMo2D,IAAcz4D,EAAAA,EAAAA,IAAO+xD,GAAAA,EAAO;;;;;;;;;;;;EAa5BrhB,IAAe1wC,EAAAA,EAAAA,IAAO+oD,GAAAA,GAAMQ,OAAQ;6BACblpD,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAaooB,QAAQ;EAMhE,SAASm2B,GAAYzrD,GAgBxB,IAhByB,MAC3BwM,EAAK,UACLk/C,EAAY,OAAM,SAClBhsC,EAAQ,kBACR4/B,EAAiB,eACjBqM,EAAiB,QAAO,MACxB/0D,EAAK,SACLoe,GASDhV,EACC,MAAO4rD,EAAaC,IAAkBr0D,EAAAA,EAAAA,WAAS,GAC/C,OACEhF,EAAAA,cAACspD,GAAAA,GAAK,KACJtpD,EAAAA,cAACguD,GAAAA,EAAW,CACV/gC,OAAQjtB,EAAAA,cAACixC,GAAY,KAAEj3B,GACvBvQ,QACEzJ,EAAAA,cAAA,QACEktB,SAAWhjB,IACTA,EAAEuX,iBACFyL,GAAU,EAEZosC,YAAaA,KACXD,GAAe,EAAK,GAGtBr5D,EAAAA,cAACq2C,GAAAA,EAAwB,CACvB9e,OAAQw1B,QAAQD,KAAuBsM,EACvC9iB,UAAU,YACVijB,OAAQ,EACRC,aAAc,EACdh5C,QACExgB,EAAAA,cAACy5D,GAAAA,EAAiB,CAAC/sD,KAAMysD,GACtBrM,IAIL9sD,EAAAA,cAACg5D,GAAW,CACVU,WAAW,WACX9M,gBAAiBE,EAAoBqM,OAAiB/xC,EACtD2lB,YAAamsB,EACb90D,MAAOA,EACPoe,SAAWtY,IACTmvD,GAAe,GACf72C,EAAStY,EAAEpB,OAAO1E,MAAM,QAS1C,CAAC60D,GAAA54D,aAAA,+/BC7DM,MAAMs5D,IAAwBtqD,EAAAA,EAAAA,IAAS,CAC5ClL,IAAM,UAASkiB,GAAiBE,UAChC/b,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAI+H,GAAiBE,QACrBxM,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBACzBC,MAAO,OACPuE,YAAa,kBACbmN,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,EAAQ,QAAEzB,GAASO,EAAA,OAAK1G,UACtD,MAAMo0B,EAAcxsB,EAASC,YAAYuB,IAAkB/B,WAC3D,GAA2B,IAAvB+sB,EAAY7qB,OACd,OAEF,MAAMupD,EAAelrD,EAClBC,YAAY4C,IACZpD,WAAW2C,QAGR+oD,SACEzxD,GAAGN,SAASuB,KAAK6xB,EAAY,KACnCrxB,cACEqxB,EAAY,GACZ/3B,IAAAA,QAAa+3B,EAAY,IAE7B,IAAK0+B,EACH,MAAM,IAAIvvD,MAAM,gCAGlBuvD,EAAa9/C,MAAKrK,IAAA,IAAC,MAAE2E,GAAO3E,EAAA,OAC1BzP,EAAAA,cAAC85D,GAAY,CAAC1lD,MAAOA,EAAOylD,eAAgBA,GAAkB,GAC9D,CACH,IACF,IAGH,SAASC,GAAY1pD,GAMjB,IANkB,eACpBypD,EAAc,MACdzlD,GAIDhE,EACC,MAAM2pD,GAAatrD,EAAAA,EAAAA,KAChByF,IACC,MAAM6lD,EzGeuB7lD,KACjC,MAAMsW,EAAoB1R,GAA0B5E,GACpD,OAAOpN,MAAO+yD,EAAwB35C,KACpC,MAAMjY,EAAW9E,IAAAA,KAAU02D,EAAgB35C,IACrC,SAAExR,EAAQ,QAAEzB,EAAO,MAAED,GAAUkH,EAC/BuW,EAAkB/b,EAASgc,SACjC,IAEE,SADM/gB,GAAUvB,GAAGN,SAAU3E,IAAAA,QAAa8E,UAChCG,GAAGN,SAASE,OAAOC,GAC3B,MAAM,IAAIoC,MAAO,QAAOpC,0BAEpBG,GAAGN,SAAS8B,UAAU3B,EAAU,GAAI,SAC1C+E,EAAMG,GAAiBlF,WAChByG,EAAS8D,WAAWoC,KAAqBG,SAAS9M,SACnDuiB,EAAkBviB,GACxBgF,EAAQb,GAAgBytD,GAC1B,CAAC,QACCpvC,GACF,EACD,EyGlCsBuvC,CAAmB9lD,GACtC,OAAOpN,MAAOukB,EAAqBnL,KACjC,MAAMgL,EAAW/nB,IAAAA,KAAU02D,EAAgB35C,IACrC,SAAExR,GAAawF,EACf+lD,EAAgBvrD,EACnBC,YAAYiG,IACZzG,WACG2d,EAAgBpd,EACnBC,YAAY+C,IACZvD,WAAW2C,QACRqH,QAAgBzJ,EAAS8D,WAAWwF,GAAekT,UACnD6uC,EAAWF,EAAgB35C,GAEjC9L,IACA6lD,EAAczmD,cAKR0mD,IACJ,IAAMrpB,SAASC,yBAAyBqpB,sBAEtChiD,GACF2T,GAAeW,MAAK3Y,IAAA,IAAC,MAAEM,GAAON,EAAA,OAC5B9T,EAAAA,cAACo6D,GAAkB,CAACx3D,SAAUsoB,EAAU9W,MAAOA,GAAS,GAE5D,CACD,GAEH,CAACA,KAEI8L,EAAUm6C,IAAer1D,EAAAA,EAAAA,UAAS,KAClC8nD,EAAmBwN,IAAwBt1D,EAAAA,EAAAA,UAAS,IAgB3D,OACEhF,EAAAA,cAACi5D,GAAY,CACXj/C,MAAM,WACNkT,SAAUA,KACJhN,GAnBKpZ,WACb,MAAMsC,EAAWjG,IAAAA,KAAU02D,EAAgB35C,GACrC3T,QAAclD,GAAKD,GACrBmD,GAAOjD,SACTgxD,EACG,yBAAwBn3D,IAAAA,SAAc+c,sBAEhC3T,GAAO1C,cAChBywD,EACG,8BAA6Bn3D,IAAAA,SAAc+c,4BAGxC65C,EAAWF,EAAgB35C,EACnC,EAOMq6C,EACF,EAEFn2D,MAAO8b,EACPsC,SAAWskB,IACTwzB,EAAqB,IACrBD,EAAYvzB,EAAS,EAEvBgmB,kBAAmBA,GAGzB,CAMA,SAASsN,GAAkB5lD,GAMvB,IANwB,MAC1BJ,EAAK,SACLxR,GAID4R,EACC,MAAMgmD,GAVC/rD,EAAAA,EAAAA,IAAkBsqD,GAAgB,IAWzC,OACE/4D,EAAAA,cAAC6sB,GAAAA,GAAW,CAACC,SAAS,UAAUC,UAAU,WACxC/sB,EAAAA,cAACgtB,GAAAA,EAAY,CACXC,OAAO,kBACPxjB,QACEzJ,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,OACEyZ,MAAO,CACL4T,QAAS,OACTE,IAAK,OACLJ,QAAS,yBAGXntB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,6BAA6BjN,KAAM,KACtD9M,EAAAA,cAAA,WAAK,gDAEHA,EAAAA,cAAA,WACC4C,EACD5C,EAAAA,cAAA,WACAA,EAAAA,cAAA,WAAM,gEAMdytB,OACEztB,EAAAA,cAACgtB,GAAAA,EAAaU,OAAM,CAClBC,KAAM3tB,EAAAA,cAACwtB,GAAAA,EAAQ,CAAC9B,YAAU,GAAC,mBAC3BkC,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,GAAAA,EAAM,CAAC1P,QAAShG,GAAO,UACxBpU,EAAAA,cAAC8pB,GAAAA,EAAM,CACL3G,WAAS,EACT4G,QAAQ,UACR3P,QAASA,KACPogD,EAAS53D,GAAUgJ,KAAKwI,EAAM,GAEjC,YAUjB,CAEAtN,eAAeozD,GAAUO,EAAyBC,QAAW,IAAXA,IAAAA,EAAc,KAC1DD,KAAcC,EAAc,UAG1B,IAAInzD,SAASC,GAAYoM,WAAWpM,EAAS,YAC7C0yD,GAAUO,EAAUC,EAAc,IAC1C,CCnMO,MCSMC,IAA6BtrD,EAAAA,EAAAA,IAAS,CACjDlL,IAAM,UAASkiB,GAAiBG,SAChChc,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAI+H,GAAiBG,OACrBzM,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM/Y,IAC1BgZ,MAAO,YACPuE,YAAa,uBACbmN,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,EAAQ,QAAEzB,GAASO,EAAA,OAAK1G,UACtD,MAAMo0B,EAAcxsB,EAASC,YAAYuB,IAAkB/B,WAC3D,GAA2B,IAAvB+sB,EAAY7qB,OACd,OAEF,MAAMupD,EAAelrD,EAClBC,YAAY4C,IACZpD,WAAW2C,QAGR+oD,SACEzxD,GAAGN,SAASuB,KAAK6xB,EAAY,KACnCrxB,cACEqxB,EAAY,GACZ/3B,IAAAA,QAAa+3B,EAAY,IAE7B,IAAK0+B,EACH,MAAM,IAAIvvD,MAAM,gCAGlBuvD,EAAa9/C,MAAKrK,IAAA,IAAC,MAAE2E,GAAO3E,EAAA,OAC1BzP,EAAAA,cAAC46D,GAAiB,CAACxmD,MAAOA,EAAOylD,eAAgBA,GAAkB,GACnE,CACH,IACF,IAGH,SAASe,GAAiBxqD,GAMtB,IANuB,eACzBypD,EAAc,MACdzlD,GAIDhE,EACC,MAAMyqD,GAAkBpsD,EAAAA,EAAAA,IAAkB2c,GAAyB,KAE5D0vC,EAASC,IAAc/1D,EAAAA,EAAAA,UAAS,KAEhCg2D,EAAkBC,IAAuBj2D,EAAAA,EAAAA,UAGtC,MAEJk2D,ED3DNC,KAEA,MAAMz3B,GAAc7yB,EAAAA,EAAAA,QAClB,MAGIuqD,GAAcvqD,EAAAA,EAAAA,QAAOsqD,GAG3B,OAFAC,EAAYtqD,QAAUqqD,EAEf,WACLz3B,EAAY5yB,SAAS8zB,QACrBlB,EAAY5yB,QAAU,IAAIpI,GAAAA,GAAIg7B,YAAc,QAAAyE,EAAA7Q,UAAAjnB,OAFnCsG,EAAI,IAAArB,MAAA6yB,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAJ1xB,EAAI0xB,GAAA/Q,UAAA+Q,IAIb3/B,EAAAA,GAAAA,KAAI,SAAU87B,GAAuC,IAAD,IAAA62B,EAAA/jC,UAAAjnB,OAAlBsG,EAAI,IAAArB,MAAA+lD,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJ3kD,EAAI2kD,EAAA,GAAAhkC,UAAAgkC,GACpC,OAAOF,EAAYtqD,WAAW6F,EAChC,GAFAjO,CAEGg7B,EAAY5yB,WAAY6F,EAC7B,CAAC,EC2CwB4kD,EAA2B,UAClD1B,EACAiB,GAEAG,QACSO,GAAS3B,EAAgBiB,GAIpC,KACA7sD,EAAAA,EAAAA,YAAU,KACRitD,EAAiBrB,EAAgBiB,EAAQ,GACxC,CAACjB,EAAgBiB,IASpB,OACE96D,EAAAA,cAACi5D,GAAY,CACXj/C,MAAM,gBACNkT,SAAUA,KACJ4tC,GAXKh0D,WAEA,YADO00D,GAAS3B,EAAgBiB,WAErCD,EAAgBhB,EAAgBiB,GACtC1mD,IACF,EAOMmmD,EACF,EAEFn2D,MAAO02D,EACPt4C,SAAUu4C,EACVjO,kBAAmBkO,GAAkB3uC,QACrC8sC,eAAgB6B,GAAkBtuD,MAGxC,CAEA,MAAM8uD,GAAW10D,eACf+yD,EACAiB,GAEA,MAAM1xD,EAAWjG,IAAAA,KAAU02D,EAAgBiB,GAC3C,IAAKA,EACH,OAAO,KAET,GAAIA,EAAQjsD,SAAS,KACnB,MAAO,CACLnC,KAAM,UACN2f,QAAU,qHAGd,IAAI9f,QAAclD,GAAKD,GACvB,OAAImD,GAAOjD,SACF,CACLoD,KAAM,QACN2f,QAAU,yBAAwByuC,qBAE3BvuD,GAAO1C,cACT,CACL6C,KAAM,QACN2f,QAAU,8BAA6ByuC,qBAGpC,IACT,EC/HaW,IAA0BpsD,EAAAA,EAAAA,IAAS,CAC9ClL,IAAM,UAASkiB,GAAiBS,eAChCtc,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAI+H,GAAiBS,aACrB9M,MAAO,YACP0R,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OAAK1G,UAC7C+S,KACoBnL,EAASC,YAAYuB,IAAkB/B,WAC3CkC,MAEhB,CACD,IACF,ICbUqrD,IAA8BrsD,EAAAA,EAAAA,IAAS,CAClDlL,IAAM,UAASkiB,GAAiBO,mBAChCpc,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAI+H,GAAiBO,iBACrB5M,MAAO,gBACP0R,YAAalhB,EAAI2F,IACjBopC,eAAgB,YAChB56B,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,GAAUlB,EAAA,OAAK1G,UAC7C+S,KACoBnL,EAASC,YAAYuB,IAAkB/B,WAC3CkC,MAEhB,CACD,IACF,ICXUsrD,IAAwCtsD,EAAAA,EAAAA,IAAS,CAC5DlL,IAAM,UAASqvB,GAAaoC,qCAC5BprB,IAAK5J,IAAA,IAAC,IAAE4J,EAAG,YAAEsK,GAAalU,EAAA,MAAwB,CAChD0d,GAAIkV,GAAaoC,mCACjB5b,MAAO,4BACP0R,YAAalhB,EAAI2F,IACjBwO,gBAAiB7J,GAAYtH,IAAA,IAAC,SAAEkB,EAAQ,QAAEzB,GAASO,EAAA,OAAK1G,UACtD+S,KACoBnL,EAASC,YAAYuB,IAAkB/B,WAC3CkC,MAEhB,CACD,IACF,ICPI,SAASurD,KACd,MAAMC,GAAuBptD,EAAAA,EAAAA,KAC3B7N,IAAA,IAAC,IAAE+J,GAAK/J,EAAA,MACN,CAAA4M,EAA6B8F,KAAiB,IAA7C,QAAEiV,GAAwB/a,EACrB+a,IACF5d,EAAIgoD,GAAsBp7B,QAAQ,GAClC5sB,EAAIgoD,GAAsBr/C,IAAKA,GAC/B3I,EAAIgoD,GAAsBC,eAAgBrqC,GAC5C,CACD,GACH,IAEIxK,GAA2BC,EAAAA,GAAAA,KAC3B89C,GAAgB1mD,EAAAA,EAAAA,IAAeukD,IAC/BoC,GAAqB3mD,EAAAA,EAAAA,IAAeulD,IACpCqB,EAAwBj+C,EAAyB,CACrDO,GAAI+H,GAAiBC,WACrBtM,MAAO,SACPuE,YAAa,iDACbC,cAAc,EACd1d,SAAU,CAACg7D,EAAeC,KAGtBE,EAA0Bl+C,EAAyB,CACvDO,GAAI+H,GAAiBI,wBACrBzM,MAAO,yBACPyE,iBAAkB,OAClB3d,SAAU,CAGRid,EAAyB,CACvBO,GAAI+H,GAAiBM,kBACrB3M,MAAO,sBACPwE,cAAc,EACdC,iBAAkB,UAClB3d,SAAU,EAERsU,EAAAA,EAAAA,IAAesmD,KACftmD,EAAAA,EAAAA,IAAeqmD,KAGfrmD,EAAAA,EAAAA,IAAeumD,UAMvB,MAAO,CACL,CACEr9C,GAAIvD,GAAAA,EAAeE,aACnBjB,MAAO,cACPuE,YAAa,qCACbI,gBAAkBlC,IAChBo/C,EAAqBp/C,EAAO,UAAU,GAG1C,CACE6B,GAAIvD,GAAAA,EAAeC,WACnBhB,MAAO,aACPuE,YAAa,mCACbI,gBAAkBlC,IAChBo/C,EAAqBp/C,EAAO,QAAQ,GAGxCu/C,EACAC,EAEJ,CC5EO,MAAMC,GACXl8D,EAAAA,cAA0D,MAE/Cm8D,GAAuBA,KAClC,MAAMC,GAAgB9yC,EAAAA,EAAAA,YAAW4yC,IACjC,MAAO,CACLzvC,KAAOtoB,IACLi4D,GAAetrD,SAASurD,aAAaxuD,GAAUA,EAAMiM,KAAK3V,KAC1Di4D,GAAetrD,SAAS0C,MAAMrP,EAAI,EAErC,ECmBUm4D,GAAkCA,KAC7C,MAAMC,GAAqB9tD,EAAAA,EAAAA,IACzB+sB,GACA,IAEIvuB,EAAUiM,KAEhB,MAAO,CACLsjD,KACAC,KACAC,KACA,CACEp+C,GAAIkV,GAAaC,SACjBzZ,MAAO,cACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,yBACzB4E,gBAAkBlC,IAChB8/C,EAAmBxP,QAAQtwC,GAAO,GAGtC,CACE6B,GAAIkV,GAAaE,QACjB1Z,MAAO,sBACPuE,YAAa,sBACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACzB4E,gBAAiB1R,GAEnB,CACEqR,GAAIkV,GAAaY,UACjBpa,MAAO,YACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBACzB4E,gBAAiB9E,IAEnB,CACEyE,GAAIkV,GAAaI,OACjB5Z,MAAO,oBACPuE,YACE,uEACFxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBACzB4E,gBAAiB9E,OAEhB8iD,KACJ,EAGGC,GAAgB,IAAIrxC,GAAAA,EACvB,6EAID,SAEIsxC,GAAe,IAAItxC,GAAAA,EACtB,wFAID,SAGF,SAASixC,KACP,MAAMM,GAAeruD,EAAAA,EAAAA,IAAkB2sB,GAAsB,IACvD2hC,EAAoBZ,KACpBjhC,GAAc9lB,EAAAA,EAAAA,IAAelF,KAC5B8sD,GAAgBrvD,GAAqByB,IACtCyI,EAAQmS,GAAckR,GAEtB7B,GAAajkB,EAAAA,EAAAA,IAAe4b,IAC5Bwa,EAAiB3zB,EAAMigB,MAAMvS,GACjC8T,EAAWziB,MAAM0Y,GAmHrB,SAAsBnK,EAAgBjO,GACpC,MAAM+lD,EAAW95D,IAAAA,SAAcgiB,EAAQjO,GACvC,OACG+lD,IACCA,EAAS3yC,WAAW,QAAUnnB,IAAAA,WAAgB85D,EAEpD,CAzHgCC,CAAa33C,EAAMgK,GAAOpsB,KAAKmsB,QAOvD6tC,EAA8BtlD,EAAMulD,OAFrBj6D,GACnB65D,GAAcllC,MAAMloB,GAAuB,QAAdA,EAAKlD,MAAkBkD,EAAKzM,OAASA,MAEpE,MAAO,CACLmb,GAAIkV,GAAaa,cACjBra,MAAOmjD,EACFN,GAAarwC,OAAO,CAAED,MAAO1U,EAAMxH,SACnCusD,GAAcpwC,OAAO,CAAED,MAAO1U,EAAMxH,SACzCqb,YAAa8f,EACb7sB,gBAAiBA,KACfm+C,IACAC,EAAkBtwC,KAAK2jB,IACvBvC,IAAoB,EAG1B,CACA,SAAS4uB,KACP,MAAMM,EAAoBZ,KAEpBkB,GAAe5uD,EAAAA,EAAAA,KACnB7N,IAAA,IAAC,SAAE8N,EAAQ,IAAE/D,GAAK/J,EAAA,MAChB,KACE,MAAM08D,EAAsB5uD,EACzBC,YAAY+qB,IACZvrB,WACH,IAAIovD,EAAcD,EAAoBv5D,SAASquD,OAAOhuD,MACtD,GAAiC,IAA7Bk5D,EAAoBxwD,KAAY,CAClC,MAAM0wD,EAAU9uD,EACbC,YAAY0iB,IACZljB,YACCijB,QAAQvtB,IAAIqvB,IAChBvoB,EAAI+uB,GAAyB,IAAI5hB,IAAI0lD,IACrCD,EAAcC,IAAU,EAC1B,CACA,GAAID,EAAa,CACf,MAAM,UAAE7lC,GAAchpB,EACnBC,YAAYipB,IACZzpB,WACHxD,EACE8Z,GACA,IAAI3M,IAAI,IACHpJ,EAASC,YAAY8V,IAAmBtW,eACxC+pB,EAAAA,GAAAA,KACA9S,GAAUiO,GAAYjO,GAAQA,EAAKtkB,SAAW,OAC9CskB,GAASA,EAAKjhB,KACfuzB,EACA,CAAC6lC,OAIP5yD,EAAIquB,GAAmB,IAAIlhB,IAAI,CAACylD,IAClC,EACD,GACH,IAGF,MAAO,CACLj/C,GAAIkV,GAAac,gBACjBta,MAAO,SACP2E,gBAAiBA,KACf0+C,IACAN,EAAkBtwC,KAAK2jB,IACvBvC,IAAoB,EAG1B,CAEA,SAAS6uB,KACP,MAAM5/C,EAAqB3H,KACrBwiB,GAAkBviB,EAAAA,EAAAA,IAAegkB,IAEvC,MAAO,CACL9a,GAAIkV,GAAae,eACjBva,MAAO,iBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,2BACzB4E,gBAAiBA,KACf,IAAIgZ,GAAiBzzB,SAAQ,CAACorB,EAAQlc,EAAOqqD,KAC3C,MAAMC,EAAanuC,GAAOpsB,KAAKmsB,GAC1BouC,GACH5gD,EAAmB/H,SAAS2oD,EAAYtqD,IAAUqqD,EAAIptD,OAAS,EACjE,GACA,EAGR,CAEA,SAASssD,KACP,MAAMhlC,GAAkBviB,EAAAA,EAAAA,IAAegkB,IAEjClf,EAA8B,CAClC,CACEoE,GAAIkV,GAAaM,eACjB9Z,MAAO,oBACPuE,YAAa,wBACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,oBACzB4E,gBAAiB9E,KAYrB,OATI8d,EAAgB7qB,KAAO,GAEzBoN,EAAQpK,KAAK,CACXkK,MAAO,gCACPuE,YAAa,8CACbD,GAAIkV,GAAaW,2BACjBxV,gBAAiB9E,KAGdK,CACT,CCrMA,MAAMG,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;EAO7BqjD,GAA4Bp9D,EAAAA,GAAO+Z,GAAI;;;;EAMvC2xC,GAGF,CACFC,SAAW5uB,GACTt9B,EAAAA,cAAAA,EAAAA,SAAA,KAAE,eACas9B,EAAW,oBAAiBt9B,EAAAA,cAAA,WAAM,gDAInDmsD,qBAAuB7uB,GACrBt9B,EAAAA,cAAAA,EAAAA,SAAA,KAAE,eACas9B,EAAW,+BAA4Bt9B,EAAAA,cAAA,WAAM,uBAMzD,SAAS49D,GAAqBh9D,GAAoC,IAAnC,MAAEwT,GAA8BxT,EACpE,MAAOgtD,EAAUiQ,IAAe74D,EAAAA,EAAAA,WAAS,IAClC84D,EAAWC,IAAgB/4D,EAAAA,EAAAA,WAAS,GACrCs3B,GAAWlnB,EAAAA,EAAAA,IAAe+1C,KACzB6S,EAAgBC,IAAqBj5D,EAAAA,EAAAA,WAAS,GAC/C6lC,GAAiBC,EAAAA,EAAAA,KACjBozB,G7F8UCzvD,EAAAA,EAAAA,KACL4sB,IAAA,IAAC,QAAEpuB,GAASouB,EAAA,OACV,SAAC1iB,EAAkB2kB,EAAoBswB,GACrC,YADsD,IAAjBA,IAAAA,GAAoB,IAClDrxB,EAAAA,EAAAA,IAAO,CAAEn0B,GAAE,GAAE8O,IAAKyB,EAAUi1C,WAAUxpC,IAAKkZ,IAAc1xB,MAC9D,KACEqB,EAAQ0vB,GAAkBhkB,GAAU,GAG1C,CAAC,GACH,I6FtVIikB,EAAoBN,EAASS,eAAe53B,MAC3Cm4B,EAAY6gC,IAAiBn5D,EAAAA,EAAAA,UAAS43B,GAAqB,IAE5DlvB,EAAQ+9C,GAAmBnvB,EAAUgB,GACrC8gC,GAAW1wD,GAAoB,aAAVA,GAAwBowD,EAC7ClR,GAAmBwR,GAAWJ,EAAiB,QAAU,QA8B/D,OACEh+D,EAAAA,cAAC6sB,GAAAA,GAAW,CAACC,SAAS,UAAUC,UAAU,WACxC/sB,EAAAA,cAACgtB,GAAAA,EAAY,CACXC,OAAO,oBACPxjB,QACEzJ,EAAAA,cAACqa,GAAe,CACdiE,GAAG,qBACHhd,GAAG,OACH4rB,SAAWhjB,IACTA,EAAEuX,iBApCR28C,EACFF,EAAa5hC,EAAS3jB,SAAU2kB,EAAYswB,GACzC3jD,OAAOC,IACFA,aAAamkD,EAAAA,GAAOgQ,mBACtBxzB,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,uBACPC,KAAM,iDAGR4wB,EAAe/wB,KAAK,CAClBC,KAAM,QACNC,MAAO,mBACPC,KAAO,2BAA0BqjB,OAGrCxzB,QAAQ4D,MAAM,0BAA2BxD,EAAE,IAE5C0B,MAAK,KACJwI,GAAO,IAIX6pD,GAAkB,EAcF,GAGVj+D,EAAAA,cAACgsD,GAAAA,EAAU,CACT7oC,WAAS,EACTm7C,YAAU,EACVl6D,MAAOk5B,EACP9a,SAAWskB,IACTq3B,EAAcrS,GAAkBhlB,IAChCm3B,GAAkB,EAAK,EAEzBrR,gBAAiBA,EACjBE,kBACsB,UAApBF,GACAl/C,GACAu+C,GAAcv+C,GAAO4vB,GAEvBya,MAAM,mBACN8U,eAAe,UAEjB7sD,EAAAA,cAAC29D,GAAyB,KACxB39D,EAAAA,cAACwtB,GAAAA,EAAQ,CAAChE,WAAYokC,EAAUprC,SAAUq7C,GAAa,mBAGvD79D,EAAAA,cAACwtB,GAAAA,EAAQ,CACPhE,WAAYs0C,EACZpyC,YAAasyC,GAA4B,aAAVtwD,EAC/B8U,SAAUu7C,GACX,+BAMPtwC,OACEztB,EAAAA,cAACgtB,GAAAA,EAAaU,OAAM,CAClBE,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,GAAAA,EAAM,CAAC1P,QAAShG,GAAO,UACxBpU,EAAAA,cAAC8pB,GAAAA,EAAM,CACLC,QAAQ,UACRrd,KAAK,SACLmhB,KAAK,qBACLnC,WAAgC,UAApBkhC,GACb,eAUjB,CAACgR,GAAAv9D,aAAA,oNCnJM,MAAMk+D,GAAe39D,IAAA,IAAK,aAC/B4d,EAAY,WACZkN,EAAU,gBACV/M,KACG/V,GAOJhI,EAAA,OACCyO,EAAAA,EAAAA,IAA2B,CACzBlL,IAAM,UAASyE,EAAO0V,KACtB9T,IAAKgD,IAA6C,IAA5C,IAAEhD,EAAG,YAAEsK,GAAatH,EACxB,MAAMhG,EAAepD,IACnBqyB,EAAAA,EAAAA,IAAcryB,GAASoG,EAAIpG,GAASA,EACtC,MAAO,IACFwE,EACH8iB,WAAYlkB,EAAQkkB,GACpBlN,aAAchX,EAAQgX,GACtBG,gBAAiB7J,EAAY6J,GAC9B,GAEH,ECrBE6/C,IAAkBnvD,EAAAA,EAAAA,IAAmB,CACzClL,IAAM,cAAaqvB,GAAamB,qBAChCnqB,IAAK1D,UAAoB,IAAb,IAAE0D,GAAK5J,EACjB,OAAOk7B,IAAYh1B,UACjB,MAAMqR,EAAU3N,EAAIwN,GAAemjB,IACnC,GAAIhjB,EAAS,CACX,MAAMsmD,QAAkB7mD,EAAAA,GAAAA,UAAc,CACpCxP,GAAE,GACF8O,IAAKiB,EACLvV,SAAUO,IAAAA,SAAcgV,EAASgjB,KAE7B7xB,QAAelB,GAAGN,SACrBuB,KAAK8xB,GACLvvB,MAAMvC,GAASA,EAAKC,WACpBW,OAAM,KAAM,IACTy0D,EACJp1D,GAA+C,gBAArCkB,EAAIkO,GAAgByiB,IAChC,OAAQsjC,IAAcC,CACxB,CACA,OAAO,CAAK,GACXl0D,EAAI0F,IAAkB,IAIvByuD,IAAsBtvD,EAAAA,EAAAA,IAAkB,CAC5ClL,IAAM,cAAaqvB,GAAamB,mBAChCnqB,IAAKgD,IAAA,IAAC,IAAEhD,GAAKgD,EAAA,OAAqC,IAAhChD,EAAIg0D,IAAiBnuD,MAAY,IASxCuuD,GAAuBL,GAAa,CAC/CjgD,GAAIkV,GAAamB,QACjB3a,MAAO,MACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,oBACzBw/B,eAAgB/lB,GAAaO,gBAC7BrI,WAAYizC,GACZhgD,gBAAkBzK,GAAsBpN,UACtC,MAAM0zD,EAAWzB,GAAe7kD,IAC1B,SAAExF,GAAawF,EACf2qD,QAAmBnwD,EAAS8D,WAAWgsD,IAC7C,OAAOj3D,QAAQiF,IAAIqyD,EAAWh7D,IAAI22D,GAAU,IC7CnCsE,GAAwBP,GAAa,CAChDjgD,GAAIkV,GAAaoB,SACjB5a,MAAO,2BACP2E,gBACE/d,IAAA,IAAC,SAAE8N,EAAQ,IAAE/D,GAAK/J,EAAA,OAClBkG,UAEE,MACMoQ,SADgBxI,EAAS8D,WAAWxD,KACtB7L,WACdyU,EAAAA,GAAAA,KAAS,CAAExP,GAAE,GAAE8O,QACrBvM,EAAI4M,IAAgBM,GAClBA,EACG5F,QAAQsT,GAASA,EAAKrO,MAAQA,IAC9B3T,OAAO,CACN6T,IAAK,MACLF,SAEL,CACF,I,2BCPL,MAAM6nD,IAAqB/nD,EAAAA,GAAAA,KACzBC,EAAAA,GAAAA,IAAO,CACL+nD,KAAK7nD,EAAAA,GAAAA,MACL8nD,UAAU9nD,EAAAA,GAAAA,SAID+nD,IAAsBjwD,EAAAA,EAAAA,IAAgC,CACjE9K,IAAK,mCACLmJ,QAAS,GACTC,QAAS,CACPoI,GAAqBc,OAAqD,CACxEV,YAAa,UACbH,cAAe,sBACfc,WAAY,cACZb,OAAQkpD,GACRjzD,KAAO2K,GACEjB,GAAYiB,GAAQinB,MAAMyhC,gBAC9Bt7D,KAAIjD,IAAA,IAAC,OAAE6V,GAAQ7V,EAAA,MAAM,CACpBo+D,IAAKxpD,GAAYiB,GAAQG,MACtBH,GAA+B,QAApBA,EAAO,aACjB,UACJwoD,SAAUzpD,GAAYiB,GAAQG,MAC3BH,GAA+B,aAApBA,EAAO,aACjB,UACL,IACAxE,QAAQmW,GAAMA,EAAE42C,MAErBlpD,OAAS1R,GAAWqS,IACX,IACFA,EACHinB,KAAM,CACJyhC,eAAgB/6D,EAAMP,KAAI2J,IAAA,IAAC,IAAEwxD,EAAG,SAAEC,GAAUzxD,EAAA,MAAM,CAChDiJ,OAAQ,CACN,CAAE,QAAS,MAAO,SAAUuoD,GAC5B,CAAE,QAAS,WAAY,SAAUC,GAAY,KAEhD,YAQAG,IAAsBnwD,EAAAA,EAAAA,IAAa,CAC9C9K,IAAK,sCACLmJ,QAAS,GACTC,QAAS,CACPoI,GAAqBc,OAAqC,CACxDV,YAAa,UACbH,cAAe,sBACfc,WAAY,iBACZb,QAAQsB,EAAAA,GAAAA,MACRrL,KAAO2K,GACEA,IAAS,WAAa,GAE/BX,OAAS1R,GAAWqS,IACX,IACFA,EACH,SAAUrS,S,4BCpEpB,MAAMi7D,GAAwB,CAC5B,gBAAkB,+tBA8CpB,MAAMC,GAAqBx4D,gBACnB6C,GAAUvB,GAAGN,SAAUiH,GAAe5L,YACtCoE,QAAQiF,IACZxI,OAAO+sB,QAAQsuC,IAAuBx7D,KAAIiD,UAAgC,IAAxBoZ,EAAUzW,GAAQ7I,EAClE,MAAMwI,EAAWjG,IAAAA,KAAU4L,GAAe5L,KAAM+c,SACtC9X,GAAGN,SAASE,OAAOoB,WAGvBO,GAAUvB,GAAGN,SAAU3E,IAAAA,QAAaiG,UACpChB,GAAGN,SAAS8B,UAAUR,EAAUK,EAAS,SAAQ,IAE1D,EAQG81D,IAAch/D,EAAAA,EAAAA,IAAOi/D,GAAAA,EAA6C;eACzDhyD,IAAA,IAAC,SAAEsf,GAAUtf,EAAA,OAAMsf,EAAY,GAAEA,MAAe,EAAE;;;;;EAOpD2yC,GAAqBhwD,IAM3B,IAN4B,SACjC3O,EAAQ,oBACR4+D,GAAsB,GAIvBjwD,EACC,MAAOkwD,EAAeC,IAAoB56D,EAAAA,EAAAA,UACxC,OAGK6I,EAAOC,IAAY9I,EAAAA,EAAAA,UAExB,kBACFiJ,EAAAA,EAAAA,YAAU,KACRnH,eAAe+4D,EAAiB3oD,EAAa4oD,SAjE1Ch5D,eAAoCoQ,GACzC,IAEE,WADoB9O,GAAGN,SAASuB,KAAK6N,IAC1BrN,cAIT,OAHAC,QAAQi2D,KACL,uCAAsC7oD,2BAElC,EAET,MAAMxH,QAActH,GAAGN,SAASqB,QAAQ+N,GACxC,GAAqB,IAAjBxH,EAAMW,QAA6B,SAAbX,EAAM,GAI9B,OAHA5F,QAAQi2D,KACL,yCAAwC7oD,kEAEpC,CAEX,CAAE,MAAOhN,GAEP,OADAJ,QAAQi2D,KAAM,yCAAwC7oD,QAC/C,CACT,CACA,OAAO,CACT,CA6CkB8oD,CAAqB9oD,KAC/BpJ,EAAS,iBACHmyD,GAAU,CAAE/oD,MAAK8nD,IAAKc,EAASI,WAAYN,IAErD,EAGA94D,iBACE,MAAMq5D,EACHj0D,OAAek0D,gBAChBd,GACF,UACQa,EAAY,CAChB/3D,GAAE,GACFwP,IAAG,KACHzU,KAAI,IACJk9D,WAAYtxD,GAAe5L,OAEzBu8D,SACIG,EAAiB/wD,GAAqBA,IAE9ChF,QAAQiB,IAAI,yBACZ+C,EAAS,cACX,CAAE,MAAO5D,GACPJ,QAAQ4D,MAAM,qCAAsCxD,GACpD4D,EAAS,QACX,CACF,CArBArG,EAqBA,GACC,IAEH,MAAMo8B,EAAW87B,GAAehnC,MAC5BgnC,EAAcW,OAASX,EAAchnC,MACrC,EAEJ,OAAQ9qB,GACN,IAAK,gBACH,OAAO,KACT,IAAK,cACH,OAAO7N,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,GACZ,IAAK,UACH,OACEd,EAAAA,cAACu/D,GAAW,CAACzyC,SAAU,KACrB9sB,EAAAA,cAACspD,GAAAA,GAAMO,OAAM,CACX58B,OAAO,gCACPxjB,QACEzJ,EAAAA,cAAA,OAAKyZ,MAAO,CAAE0T,QAAS,SACrBntB,EAAAA,cAACkgD,GAAAA,GAAW,CACV/6C,KAAO,sBAAqB2J,KAC5Bk1B,iBAAkB27B,EAClB1V,QACEpmB,EACK,GAAE87B,GAAeY,UAAUlsD,KAAKmsD,MACpB,IAAX38B,OACI87B,GAAeW,UAAUX,GAAehnC,QAC9CgnC,GAAeY,MAErB,aAAa,kCACbn8D,MACEu7D,EACIA,EAAcW,OAASX,EAAchnC,MACrC,EAENwxB,SAAU,QAOxB,IAAK,QACH,OACEnqD,EAAAA,cAACygE,GAAAA,EAAW,CACV/zD,KAAK,QACLg0D,QAAQ,wBACRzmD,KAAK,mCACL0mD,QACE3gE,EAAAA,cAAC8pB,GAAAA,EAAM,CACLC,QAAQ,UACR3P,QAASA,KACPlO,OAAO00D,SAASC,QAAQ,GAE3B,YAMX,EAGK/5D,eAAem5D,GAAS7vD,GAIsC,IAJrC,IAC9B8G,EAAG,IACH8nD,EAAG,WACHkB,GACgE9vD,EAChEtG,QAAQiB,IAAI,wBACN+1D,EAAAA,EAAAA,IAAM,CACV14D,GAAE,GACF42D,MACA+B,KAAI,IACJC,UAAW,kCACX9pD,MACAgpD,aACAe,cAAc,GAElB,CAACxB,GAAAp/D,aAAA,kR,4ECnNM,SAAS6gE,GAAqBzrD,GACnC,MAAM0rD,EAAa1rD,EAAM2rD,gBAAkB3rD,EAAMrR,MAAMiM,OACjDgxD,EAAan1D,OAAOo1D,iBAAiB7rD,GAGrC8rD,EAAa1wB,SAAS2wB,cAAc,QAC1CD,EAAW9nD,MAAM6I,SAAW,WAC5Bi/C,EAAW9nD,MAAMgoD,WAAa,SAC9BF,EAAW9nD,MAAMioD,WAAa,WAC9BH,EAAW9nD,MAAMkoD,KAAON,EAAWM,KACnCJ,EAAW9nD,MAAMpT,SAAWg7D,EAAWh7D,SACvCk7D,EAAW9nD,MAAMsnB,WAAasgC,EAAWtgC,WACzCwgC,EAAW9nD,MAAMrT,WAAai7D,EAAWj7D,WACzCm7D,EAAW9nD,MAAMoK,cAAgBw9C,EAAWx9C,cAC5C09C,EAAW9nD,MAAMqpB,OAASu+B,EAAWv+B,OACrCy+B,EAAW9nD,MAAMmoD,YAAcP,EAAWO,YAG1CL,EAAWM,YAAcpsD,EAAMrR,MAAM09D,UAAU,EAAGX,GAClDtwB,SAAS52B,KAAK8nD,YAAYR,GAG1B,MAAMS,EAAcT,EAAWU,YAI/B,OADApxB,SAAS52B,KAAKioD,YAAYX,GACnBS,CACT,CCDA,MAAMG,GAAgB5hE,EAAAA,GAAO+Z,GAAI;;;sBAGX1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,eAAe;WACrD9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;IAEjD8oD,GAAAA;EAEEC,IAAuI9hE,EAAAA,EAAAA,IAC3I+hE,GAAAA,EACA;;YAEUC,GAAAA;EAoBL,SAASC,GAAc1uD,GAQ1B,IAPF1P,MAAOq+D,EACPjgD,SAAUkgD,EACVl0D,aAAcm0D,KACX5iE,GAIJ+T,EACC,MAAO1P,EAAOsM,IAAYkyD,EAAAA,GAAAA,GACxBH,EACAE,GAAoB,GACpBD,IAEKG,EAAuBC,IAA0B99D,EAAAA,EAAAA,WAAS,GAC3Do+C,GAAWvyC,EAAAA,EAAAA,QAAyB,MAEpCkyD,GAAgBlyD,EAAAA,EAAAA,QAAuB,OAMtCmyD,EAAiBC,IAAsBj+D,EAAAA,EAAAA,UAAS,KAChDk+D,EAAiBC,IAAsBn+D,EAAAA,EAAAA,UAE5C,IACIo+D,EAA2BA,KAC/BC,EAAc,CACZC,SACGC,GAAiBC,GAAK,GAAKtC,GAAqB9d,EAAStyC,SAC5D2yD,SAAUF,GAAiBG,GAAK,IAAMH,GAAiBpiD,QAAU,GAAK,IAExE8hD,EACE7+D,EAAM8N,MAAM,EAAGkxC,EAAStyC,SAASswD,qBAAkBh6C,GACpD,GAEHnZ,EAAAA,EAAAA,YAAU,KACJ40D,GACFO,GACF,GACC,CAACP,EAAuBz+D,IAE3B,MAAMu/D,GAAyBC,EAAAA,GAAAA,GAAYf,IAE3C50D,EAAAA,EAAAA,YAAU,KACR,MAAM41D,EAAYb,EAAgBjgE,MAAMI,IAAAA,KAClC2gE,EAAkBD,EAAU3xD,MAAM,GAAI,GAAGgE,KAAK/S,IAAAA,MAAa,IAC3DqkC,EAAQq8B,EAAUxzD,OAAS,EAAIwzD,EAAU3xD,OAAO,GAAG,GAAK,GAC9D,IAAI6xD,GAAW,EA8Bf,OAhGJj9D,eAAmCg9D,GACjC,OAAO17D,GAAGN,SAASqB,QAAQ26D,GAAiBl4D,MAAK9E,gBACtBS,QAAQiF,IAC/BF,EAAUzI,KAAIiD,UACZ,MAAMsC,EAAWjG,IAAAA,KAAU2gE,EAAiBr3D,GAC5C,MAAO,CACLrD,WACAC,WAAYjB,GAAGN,SAASuB,KAAKD,GAC9B,MAIF6I,QAAOxC,IAAA,IAAC,KAAEpG,GAAMoG,EAAA,OAAKpG,EAAKQ,aAAa,IACvChG,KAAIuM,IAAA,IAAC,SAAEhH,GAAUgH,EAAA,OAAKhH,CAAQ,KAErC,CAoDI46D,CAAoBF,GAAiBl4D,MAAMq4D,IACzC,GAAIF,EACF,OAGF,MAAMG,EAAqBD,EACxBpgE,KAAKuF,IAEG,CAAEA,WAAUgX,UADHjd,IAAAA,SAAciG,OAG/B6I,QACCuC,IAAA,IAAC,UAAE4L,GAAW5L,EAAA,OACXgzB,GAASpnB,EAAUwnB,cAAc/4B,SAAS24B,EAAMI,cAAc,IAErEu7B,EAAmBe,GAGjBA,EAAmB7zD,OAAS,IAE3BszD,GACoD,IAArDvgB,EAAStyC,SAAS1M,MAAM2c,QAAQiiD,IAEhC5f,EAAStyC,QAAQqzD,kBACfnB,EAAgB3yD,OAChB+yC,EAAStyC,QAAQ1M,MAAMiM,OACvB,WAEJ,IAEK,KACL0zD,GAAW,CAAI,CAChB,GACA,CAACf,IAEJ,MAAOoB,EAAYf,IAAiBr+D,EAAAA,EAAAA,UAAS,CAAEs+D,QAAS,EAAGG,QAAS,IAE9DF,EAAkBngB,EAAStyC,SAASuzD,wBAE1C,OACErkE,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACqf,EAAAA,GAAe,CACdnF,QAAS,CACP,CACEoE,GAAIvD,GAAAA,EAAeupD,gBACnBtqD,MAAO,oBACP2E,gBAAiBA,KACfykD,IACAN,GAAuB,EAAK,MAKjCruD,IAAA,IAAC,qBAAE6K,GAAsB7K,EAAA,OACxBzU,EAAAA,cAACgsD,GAAAA,GAAU9rD,EAAAA,EAAAA,GAAA,GACLH,EAAK,CACTqE,MAAOA,EACPoe,SAAU9R,EACV0yC,UAAUmhB,EAAAA,GAAAA,GAAUnhB,EAAUrjD,EAAMqjD,UACpCohB,YAAYhlD,EAAAA,GAAAA,GACVzf,EAAMykE,YAAc,CAAC,EACrBllD,EACA,CACEmlD,UAAYv6D,IACI,WAAVA,EAAE/F,KACJ2+D,GAAuB,EACzB,EAEF3xD,OAAQA,KACN2xD,GAAuB,EAAM,IAInCzf,WACErjD,EAAAA,cAAAA,EAAAA,SAAA,KACGD,EAAMsjD,WACPrjD,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,+BAEjC3gB,GACAC,EAAAA,cAACu7C,GAAAA,GAAqBr7C,EAAAA,EAAAA,GAAA,GAChBH,EAAK,CACT0Z,MAAO,CAAEm6C,YAAa,SACtB7X,KAAK,SACLE,QAASpiC,GACTE,KAAK,+BAMf,IAGL8oD,GACC7iE,EAAAA,cAAC0iB,EAAAA,EAAqB,CACpBG,QAASA,KACPigD,GAAuB,EAAM,EAE/BngD,OAAQyhD,GAERpkE,EAAAA,cAACmiE,GAAa,KACZniE,EAAAA,cAACqiE,GAAmB,CAClBj+C,IAAK2+C,EACLzd,cAAelC,EACf,aAAW,cACXshB,oBAAkB,EAClBC,uBAAqB,EACrBxhD,UAAU,QACVvD,SA5I8Bzb,IACxCuM,EAASvN,IAAAA,KAAW,GAAEgB,IAAOhB,IAAAA,KAAU,EA4I7B+F,MAAOg6D,IAENvuD,IAAA,IAAC,SAAEvL,GAAUuL,EAAA,OACZ3U,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKiF,EAAUgX,UAAWhX,GAC9BpJ,EAAAA,cAAC+oB,GAAAA,EAAU,KACT/oB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM/Y,IACnBmC,IAAAA,SAAciG,IAEZ,MAQvB,CAACo5D,GAAAniE,aAAA,4LCjNM,MAAMukE,GAAyBrG,GAAa,CACjDjgD,GAAIkV,GAAaqB,UACjB7a,MAAO,WACP2E,gBACE/d,IAAA,IAAC,SAAE8N,GAAU9N,EAAA,OACbkG,UACE,MAAMglB,QAAsBpd,EAAS8D,WAAWd,IAChDoa,EAAchb,SAAS2b,MAAKjf,IAAA,IAAC,MAAE4G,GAAO5G,EAAA,OACpCxN,EAAAA,cAAC6kE,GAAc,CAACzwD,MAAOA,GAAS,GAChC,CACH,IAGQ0wD,GAAiCvG,GAAa,CACzDjgD,GAAI,8BACJtE,MAAO,8BACPwE,cAAc,EACdG,gBACElP,IAAA,IAAC,SAAEf,GAAUe,EAAA,OACb3I,UACE,MAAMglB,QAAsBpd,EAAS8D,WAAWd,IAChDoa,EAAchb,SAAS2b,MAAKrc,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACpCpQ,EAAAA,cAAC6kE,GAAc,CACbzwD,MAAOA,EACP4qD,IAAI,oDACJ,GACF,CACH,IAGC3kD,GAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;EAQnC,SAASuqD,GAAc/wD,GAMnB,IANoB,MACtBM,EACA4qD,IAAK+F,GAINjxD,EACC,MAAOkrD,EAAKgG,IAAUhgE,EAAAA,EAAAA,UAAS+/D,GAAW,IACpCE,GAAY7vD,EAAAA,EAAAA,IAAegqD,KAC1Bt/B,EAAWolC,IAAgBlgE,EAAAA,EAAAA,UAASmgE,EAAenG,KACnDoG,EAAmBC,IAAwBrgE,EAAAA,EAAAA,WAAS,IACpDsgE,EAAsBC,IAA2BvgE,EAAAA,EAAAA,WAAS,GAC3DwgE,GAAyB70D,EAAAA,EAAAA,IAAkByuD,KAC1CqG,EAAaC,IAAkB99C,EAAAA,EAAAA,IAAes3C,IAC/CyG,GAAc90D,EAAAA,EAAAA,QAAyB,MACvC+0D,GAAc/0D,EAAAA,EAAAA,QAAyB,MACvCg1D,EAkIR,SAAyB7G,GACvBA,EAYF,SAA0BA,GACxB,OAAO8G,GAAaA,GAAa9G,EAAI+G,OAAQ,aAAc,WAC7D,CAdQC,CAAiBhH,GACvB,IAEE,OADA,IAAIiH,IAAIjH,GACD,IACT,CAAE,MAAO90D,GACP,GAAIg8D,GAAgBv+B,KAAKq3B,GACvB,OAAO,IAEX,CACA,MAAO,mCACT,CA7ImBmH,CAAgBnH,IAC1BoH,EAAUC,IAAerhE,EAAAA,EAAAA,UAAS,IAEnC87D,ECzED,WACL,MAAM/1B,EAAU3H,KACVkjC,EAAsBt2D,KACtBu2D,GAAc51D,EAAAA,EAAAA,IAAkB4G,IAEtC,OAAOivD,EAAAA,EAAAA,cACL5lE,IAQO,IARN,IACCo+D,EAAG,IACH9nD,EAAG,UACHuvD,GAKD7lE,EACCmqC,EACE,CACE/wB,MAAQ,6BAA4BglD,KAEtC,CACEt6B,WAAY+hC,EACZtiC,IAAKr9B,UAAgE,IAAzD,iBAAEy9B,EAAgB,YAAEH,EAAW,iBAAEE,GAAkB92B,QACvDyyD,GAAU,CACd/oD,IAAKA,EACL8nD,MAEAkB,WAAat8B,IACX,GAAIA,EAASjL,MAAO,CAClB,MAAMkL,EAAWD,EAAS08B,OAAS18B,EAASjL,MAC5CyL,EAAYP,GACZS,EACG,GAAEV,EAAS28B,UAAUlsD,KAAKmsD,MAAiB,IAAX38B,OAC/BD,EAAS08B,UACP18B,EAASjL,QAEjB,MACE2L,EAAiBV,EAAS28B,OAC1Bh8B,GAAiB,EACnB,IAED34B,MACD,KACE26D,GAAa1uD,GACXA,EAAMjB,MAAM2O,GAASA,EAAKrO,MAAQA,IAC9BW,EACAA,EAAMtU,OAAO,CAAE6T,IAAK,MAAOF,UAEjCovD,GAAqB,IAEtBp8D,IACCJ,QAAQiB,IAAI,IAAKb,GAEjB0P,GAAmBxV,OAAO0V,KAAK,CAC7BC,KAAM,QACNC,MAAO,eACPC,KAAO,6BAA4B+kD,UAAY9nD,MAAQhN,MACvD,GAEL,GAGN,GAEH,GAEJ,CDQgBw8D,GAqCd,SAASvB,EAAe/gE,GACtB,MAAMuiE,EACJviE,EACGrB,MAAM,WACNC,OACCoC,QAAQ,SAAU,KAAO,GAC/B,OAAOuhE,EAAWxjE,IAAAA,KAAU8hE,EAAW0B,GAAY1B,CACrD,CAEA,OACEjlE,EAAAA,cAAC6sB,GAAAA,GAAW,CAACC,SAAU,IAAKC,UAAU,WACpC/sB,EAAAA,cAACgtB,GAAAA,EAAY,CACXC,OAAO,2BACPxjB,QACEzJ,EAAAA,cAAC4mE,GAAAA,EAAgC,KAC/B5mE,EAAAA,cAAA,QAAMse,GAAG,aAAa4O,SAlDfpmB,UACfoD,EAAEuX,iBACF8jD,GAAwB,GAGxB,MAAMsB,QA0GV//D,eAAsCg5B,GACpC,MAAMvzB,QAAclD,GAAKy2B,GACzB,IAAKvzB,EACH,OAAO,KAET,IAAKA,EAAM1C,cACT,MAAO,iCAET,MAAMknB,QAAgB3oB,GAAGN,SAASqB,QAAQ22B,GAC1C,OAAO/O,EAAQ1gB,OAAS,EACpB,gDACA,IACN,CAtHqCy2D,CAAuBhnC,GACxD,GAAI+mC,EAGF,OAFAR,EAAYQ,QACZjB,EAAY90D,SAAS0C,QAGnBqyD,EACFF,EAAY70D,SAAS0C,SAGvBgyD,EAAuBriE,IAAAA,QAAa28B,IACpC4lC,GAAgBqB,GACdA,EAAKnwD,MAAMowD,GAAeA,EAAWhI,MAAQA,IACzC+H,EACAA,EAAKxjE,OAAO,CAAEy7D,UAEpB8B,EAAM,CACJ9B,MACA9nD,IAAK4oB,EACL2mC,UAAWA,KACTf,GAAgBD,GACdA,EAAY5hE,KAAI2Q,IAAA,IAAC,IAAEwqD,GAAKxqD,EAAA,OAAKwqD,CAAG,IAAEnwD,SAASmwD,GACvCyG,EACA,IAAIA,EAAa,CAAEzG,MAAKC,SAAU,MACvC,IAGL7qD,IAAO,GAmBGpU,EAAAA,cAACqa,GAAe,KACdra,EAAAA,cAACinE,GAAAA,EAAQ,CACP7jB,SAAUuiB,EACVxiD,WAAS,EACT40B,MAAM,OACN3zC,MAAO46D,EACPpS,gBACEiZ,GAAYP,EAAuB,QAAU,QAE/CxY,kBAAmBwY,GAAwBO,EAC3CqB,cAAgB9iE,IACd4gE,EAAO5gE,GACHghE,GACFF,EAAaC,EAAe/gE,GAC9B,EAEF8E,MAAOu8D,IAENhxD,IAAA,IAAC,IAAEuqD,GAAKvqD,EAAA,OAAKzU,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAK66D,GAAMA,EAAW,IAE5Ch/D,EAAAA,cAACwiE,GAAc,CACbpf,SAAUwiB,EACV7tB,MAAM,aACN3zC,MAAO07B,EACP8sB,gBACEwZ,GAAYd,EAAuB,QAAU,QAE/CxY,kBAAmBwY,GAAwBc,EAC3C5jD,SAAWpe,IACT8gE,EAAa9gE,GACbihE,GAAqB,GACrBgB,EAAY,GAAG,OAO3B54C,OACEztB,EAAAA,cAACgtB,GAAAA,EAAaU,OAAM,CAClBE,MACE5tB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,GAAAA,EAAM,CAAC1P,QAAShG,GAAO,UACxBpU,EAAAA,cAAC8pB,GAAAA,EAAM,CACLC,QAAQ,UACR2B,YAAaoU,IAAck/B,EAC3BtyD,KAAK,SACLmhB,KAAK,cACN,cAUjB,CAeA,MAAMq4C,GAAkB,IAAIx+B,OAAQ,kCAkBpC,SAASo+B,GAAaqB,EAAaC,GACjC,OAAID,EAAI78C,WAAW88C,GACVD,EAAIj1D,MAAMk1D,EAAO/2D,QAEnB82D,CACT,CE/MO,SAASE,KACd,MAAMzN,GAAe0N,EAAAA,EAAAA,KACfx7C,GAAgB2hC,EAAAA,EAAAA,MACf8Z,GAAgBn5D,GAA6BwwD,KAC7C4I,GAAiBp5D,GAA6B0wD,KAC9C2I,GAAkBr5D,GAA6Bw2D,KAC/C8C,GAA0Bt5D,GAC/B02D,IAEF,MAAO,IACFxI,KACHiL,EACAE,EACAC,KAG6C,KAAzCtyD,EAAAA,EAAAA,IAAemC,IAAelH,OAAe,CAACm3D,GAAiB,GACnE,CACElpD,GAAIkV,GAAasB,sBACjB9a,MAAO,mBACPuE,YAAa,sDACbxE,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,oBACzB4E,gBAAiBA,KACfmN,EAAcW,MAAK7rB,IAAA,IAAC,MAAEwT,GAAOxT,EAAA,OAC3BZ,EAAAA,cAAC49D,GAAqB,CAACxpD,MAAOA,GAAS,GACvC,GAGN,CACEkK,GAAIkV,GAAauB,aACjB/a,MAAO,iBACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,mBACzB4E,gBAAiBA,KACfi7C,EAAa9/C,MAAKtM,IAAA,IAAC,MAAE4G,GAAO5G,EAAA,OAAKxN,EAAAA,cAACktD,GAAa,CAAC94C,MAAOA,GAAS,GAAC,GAGrE,CACEkK,GAAIkV,GAAayB,oCACjBjb,MAAO,uCACPu/B,eAAgB,WAChBx/B,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBACzB4E,gBAAiBA,KACf9E,IAAgB,GAIxB,C,gBC1CA,MAAM8tD,GAAkD,CACtDC,oBAAqB,IACrBC,kBAAkB,EAClBtyD,QAASA,CAACuyD,EAASC,IAAoB,sBAAVA,GAGzBC,GAAyD,CAC7Dx7C,QAAQ,EACRo7C,oBAAqB,IACrBC,kBAAkB,GAGpB/gE,eAAemhE,GACblyD,GAEA,MAAMmyD,EAAY,IAAIC,GAAAA,UAAUR,IAEhC,UADkCv/D,GAAGN,SAASE,OAAO+N,GAEnD,OAAO,KAGT,MAAMqyD,QAAwBhgE,GAAGN,SAAS4B,SAASqM,EAAa,CAC9D3I,SAAU,SAGNi7D,EAAYH,EAAUI,MAAMF,GAGlC,OAFAC,EAAU/4D,QAAU+4D,EAAU/4D,SAAW,CAAC,EAC1C+4D,EAAU/4D,QAAQi5D,UAAY/yD,GAAY6yD,EAAU/4D,QAAQi5D,WACrDF,CACT,CACAvhE,eAAe0hE,GACbzyD,EACA0yD,GAEA,MAEMC,EAFa,IAAIC,GAAAA,WAAWX,IAELY,MAAMH,SAC7B9+D,GAAUvB,GAAGN,SAAU3E,IAAAA,QAAa4S,UACpC3N,GAAGN,SAAS8B,UAAUmM,EAAa2yD,EAC3C,CAEA,MAAMG,GACqB,CACzB,CAACnzD,GAAaM,gBAAiB,iBAG1B,SAAS8yD,GAAuBloE,GAInC,IAJoC,SACtCE,GAGDF,EACC,MAAMmoE,EAAqB5lE,IAAAA,MACzBiS,EAAAA,EAAAA,IAAepG,IAAqB7L,KACpC,SAGI6lE,EAAsBjzD,GAC1B5S,IAAAA,KACE4lE,EACAF,GAAmB9yD,IAAgBA,GAGjCkzD,EAAgBlzD,GAGbkyD,GADqBe,EAAmBjzD,IASjD,OAJA9H,EAAAA,EAAAA,YAAU,KACRg7D,EAAavzD,GAAaM,eAAe,GACxC,IAGDhW,EAAAA,cAACkpE,GAAAA,GAAU,CACT9yD,SAAS,mBACTtK,KAAMhF,UACJ,MAAOiP,EAAaH,GAAiBzR,EAAIpB,MAAM,KACzCslE,QAAkBY,EAAalzD,GACrC,OAAOsyD,GAAW/4D,QAAQi5D,UAAU3xD,MAClCpJ,IAAA,IAAG,QAASrI,GAAMqI,EAAA,OAAKrI,IAASyQ,CAAa,GAC9C,EAEHW,MAAOzP,UAAqB,IAAd,KAAEqiE,GAAM15D,EACpB,MAAM25D,GAAgBvrC,EAAAA,GAAAA,IACpBztB,IAAA,IAAC,YAAE2F,GAAa3F,EAAA,OAAK2F,CAAW,GAChC,IAAIozD,EAAKp4C,WAAWltB,KAAIiQ,IAAmB,IAAjB3P,EAAKC,GAAM0P,EACnC,MAAOiC,EAAaH,GAAiBzR,EAAIpB,MAAM,KAC/C,MAAO,CACLgT,cACAH,gBACAxR,QACD,KAIL,IAAK,MAAM2R,KAAeqzD,EAAe,CACvC,MAAMh4C,EAAUg4C,EAAcrzD,GACxBsyD,QAAmCJ,GACvCe,EAAmBjzD,KACf,CACJ,OAAQ,CAAE,WAAY,MAAO,YAAa,SAC1CzG,QAAS,CAAE,WAAY,IAAKi5D,UAAW,KAEzC,IAAK,MAAM,MAAEnkE,EAAK,cAAEwR,KAAmBwb,EAAS,CAC9C,MAAMi4C,EAAahB,EAAU/4D,QAAQi5D,UAC/Bn1D,EAAQi2D,EAAWh2D,WACvBmB,IAAA,IAAG,QAASrP,GAAMqP,EAAA,OAAKrP,IAASyQ,CAAa,IAEzC0zD,EACa,mBAAVllE,EACHA,EAAMilE,EAAWj2D,IAAU,MAC1BhP,EACPilE,EAAWngC,OAAO91B,EAAOA,GAAS,EAAI,EAAI,EAAG,CAC3C,QAASwC,KACN0zD,GAEP,OACMd,GAAeQ,EAAmBjzD,GAAcsyD,EACxD,IAGDvnE,EAGP,CCnJO,SAASyoE,KACd,MAAMx+B,EAAU3H,KAChB,MAAO,CACL,CACE9kB,GAAI,uBACJtE,MAAO,mBACP2E,gBAAiBA,KACfosB,EACE,CAAE/wB,MAAO,eAAgBwpB,cAAc,IACvC18B,MAAAlG,EAAmD4oE,KAAiB,IAA7D,QAAEnlC,EAAO,iBAAEC,EAAgB,YAAEF,GAAaxjC,EAC/CyjC,EAAQ,kBACF37B,EAAAA,GAAAA,KAAI,YACR,IAAK,IAAI+gE,EAAO,EAAGA,EAAO,IAAMA,IAC9BplC,EAAQqlC,GAAeD,IACvBrlC,EAAYqlC,EAAO,WACbE,GAAM,KACZrlC,EAAiB,cAErB,GAPM57B,CAOH8gE,EAAY,GAElB,GAIT,CAEA1iE,eAAe6iE,GAAMC,GACnB,OAAO,IAAIriE,SAASC,GAAYoM,WAAWpM,EAASoiE,IACtD,CAEA,SAASF,GAAeG,GACtB,OAAIA,EAAM,IAAQx1D,KAAKmsD,MAAMqJ,EAAM,IAC1B,GAEF,UAAYx1D,KAAKmsD,MAAMqJ,EAAM,IAAM,CAC5C,CDgHCf,GAAAzoE,aAAA,qKEnHD,MAAMypE,GAAoBvpE,EAAAA,GAAO+Z,GAAI;;;;;EAOxByvD,GAAUnpE,IAAsD,IAArD,OAAEugB,GAA6CvgB,EACrE,MAAMw7D,GAAgBvrD,EAAAA,EAAAA,QAA2B,OAC1ChD,EAAOC,IAAY8Z,EAAAA,EAAAA,IAAewpC,IACnC4Y,GAAuB50D,EAAAA,EAAAA,IAAe2iB,GAAkBR,QACxD0yC,GAAyB70D,EAAAA,EAAAA,IAAeu9C,GAAsBp7B,QAMpE,OAJAniB,EAAAA,EAAAA,IAAe7D,IAA6BT,SAAUw2D,EAAAA,EAAAA,MACtDlyD,EAAAA,EAAAA,IAAe1D,IAAuBZ,SAAU28C,EAAAA,EAAAA,MAChDr4C,EAAAA,EAAAA,IAAezD,IAAqBb,SAAUo5D,EAAAA,EAAAA,KAG5ClqE,EAAAA,cAAC8oE,GAAuB,KACtB9oE,EAAAA,cAACwxB,GAAoB,MACrBxxB,EAAAA,cAACmqE,EAAAA,EAAc,CAACC,eAAa,GAC3BpqE,EAAAA,cAACqqE,GAAoB,MACrBrqE,EAAAA,cAACsqE,GAA2B,MAE5BtqE,EAAAA,cAACk8D,GAAsBxb,SAAQ,CAACt8C,MAAOg4D,GACrCp8D,EAAAA,cAAC8pE,GAAiB,CAACrwD,MAAO,CAAE0H,WAC1BnhB,EAAAA,cAACuqE,GAAqB,MACnB/8D,IAAA,IAAC,qBAAE8R,GAAsB9R,EAAA,OACxBxN,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACwqE,EAAAA,EAAkB,CACjBpmD,IAAKg4C,EACLhL,iBAAkBvjD,EAClB48D,wBAA0BC,IACxB58D,EAAS48D,EAAS,EAEpBC,QAASpiB,GACTvnC,eAAgB1B,GAEhBtf,EAAAA,cAAC4c,GAAU,OAEb5c,EAAAA,cAACyvD,GAAY,MACZ,IAGNwa,GAA0BjqE,EAAAA,cAAC42D,GAAqB,MAChDoT,GAAwBhqE,EAAAA,cAAC+vD,GAAc,SAItB,EAI9B,SAASwa,GACPxqE,GAEA,MAAMu0D,EAAiC,IAClCsH,QACAyL,QACAkC,MAEL,OACEvpE,EAAAA,cAACqf,EAAAA,IAAenf,EAAAA,EAAAA,GAAA,GACVH,EAAK,CACTma,QAASo6C,EACTsW,YAAU,IAGhB,CAEA,SAASP,KAEP,OADAzwD,GAAmBxV,OAAQ0mC,EAAAA,EAAAA,KACpB,IACT,CAEA,SAASw/B,KAEP,OC3GK,WACL,MAAMtZ,GAAWlmB,EAAAA,EAAAA,KAEXC,EAAU3H,MAEhBn1B,EAAAA,EAAAA,YAAU,KACR,MAAM48D,EAAYj3D,YAAW,KACSwT,MAAhC7c,GAAuBC,OACzBwmD,EAAS7B,WAAW,CAClBn1C,MAAO,iCACPC,KAAM,sOACNC,QACEla,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACuuD,GAAAA,EAAiB,CAChBn0C,QAASA,KACP2wB,EACE,CAAE/wB,MAAO,4BAA6BwpB,cAAc,IACpD18B,MAAAlG,EAAsC+H,KAAkB,IAAjD,iBAAE47B,EAAgB,QAAEF,GAASzjC,EAClCyjC,EAAQ,eACRE,GAAiB,SACX15B,GAAqB,CACzBlC,eACAK,OAASpG,IACPyhC,EAAS,WAAUlhC,IAAAA,QAAaP,KAAY,IAG7CgJ,MAAK,KACJrB,GAAuBI,IAAI,MAAM,IAElCV,OAAM,QAEL,GAEP,GAEJ,0BAGDjK,EAAAA,cAACuuD,GAAAA,EAAiB,CAChBn0C,QAASA,IAAM7P,GAAuBI,IAAI,OAC3C,qBAMT,GACC,KACH,MAAO,IAAMykB,aAAay7C,EAAU,GACnC,GACL,CDwDEC,GACO,IACT,CAACf,GAAA1pE,aAAA,oKE5GM,MAAM0qE,GAA2B,CACtCC,sBAAuB,CACrB,CACEt+D,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,SAAU+gE,UAAW,CAAC,WAGlDC,qBAAsB,CACpB,CACEz+D,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,SAAU+gE,UAAW,CAAC,WAGlDE,6BAA8B,CAC5B,CACE1+D,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,SAAU+gE,UAAW,CAAC,WAGlDG,uBAAwB,CACtB,CAAE3+D,KAAM,WAAYu+D,eAAgB,CAAE9gE,KAAM,MAAO+gE,UAAW,CAAC,UAEjE,CAAC13C,GAAaC,UAAW,CACvB,CACE/mB,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,OAAQ+gE,UAAW,CAAC,MAAO,WAGvD,CAAC13C,GAAaY,WAAY,CACxB,CACE1nB,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,OAAQ+gE,UAAW,CAAC,WAGhD,CAAC13C,GAAaG,iBAAkB,CAC9B,CACEjnB,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,OAAQ+gE,UAAW,CAAC,OAAQ,YAGxD,CAAC13C,GAAaK,mBAAoB,CAChC,CACEnnB,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,OAAQ+gE,UAAW,CAAC,OAAQ,UAGxD,CAACrV,IAAyC,CACxC,CACEnpD,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,MAAO+gE,UAAW,CAAC,YAG/C,CAACrV,IAAqC,CACpC,CACEnpD,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,SAG5B,CAACqpB,GAAaQ,mBAAoB,CAChC,CACEtnB,KAAM,WACNu+D,eAAgB,CAAE9gE,KAAM,QAG5B,CAACqpB,GAAaW,4BAA6B,CACzC,CACEznB,KAAM,WACNu+D,eAAgB,CAAEC,UAAW,CAAC,OAAQ,SAAU/gE,KAAM,UAG1D,CAACqpB,GAAaU,wBAAyB,CACrC,CACExnB,KAAM,WACNu+D,eAAgB,CAAEC,UAAW,CAAC,WAAY/gE,KAAM,WAGpD,CAACqpB,GAAaS,mBAAoB,CAChC,CACEvnB,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,eAIZ,CAACqpB,GAAac,iBAAkB,CAC9B,CACE5nB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAACqpB,GAAaO,iBAAkB,CAC9B,CACErnB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,OACpB/gE,KAAM,UAIZ,CAACqpB,GAAa2B,mBAAoB,CAChC,CACEzoB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAACqpB,GAAakB,oBAAqB,CACjC,CACEhoB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,WACZ/gE,KAAM,UAIZmhE,WAAY,CACV,CACE5+D,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,eAIZuc,UAAW,CACT,CACEha,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,UAIZ,CAACmR,IAA8B,CAC7B,CACE5O,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,UAIZ,CAACkc,GAAiBC,YAAa,CAC7B,CACE5Z,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAACmR,IAAwB,CACvB,CACE5O,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAACoR,GAAgBC,eAAgB,CAC/B,CACE9O,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,cAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,WAIZ,CAACoR,GAAgBE,2BAA4B,CAC3C,CACE/O,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,OACpB/gE,KAAM,cAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,OACpB/gE,KAAM,WAIZ,CAACoR,GAAgBG,oBAAqB,CACpC,CACEhP,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,cAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,cAIR,CAAC,EAAG,EAAG,EAAG,EAAG,GAAaqoB,QAAO,CAACla,EAAQ0G,KAC5C1G,EAAOiD,GAAiB,sBAAqByD,MAAY,CACvD,CACEtS,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,MAAO,QACnB/gE,KAAM,YAERohE,gBAAiB,CACfphE,KAAO,QAAO6U,MAGlB,CACEtS,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,MAAO,QACnB/gE,KAAM,YAERohE,gBAAiB,CACfphE,KAAO,SAAQ6U,OAId1G,IACN,CAAC,GACJ,CAACiD,GAAgBU,iBAAkB,CACjC,CACEvP,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,oBAIZ,CAACoR,GAAgBW,6BAA8B,CAC7C,CACExP,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,OACpB/gE,KAAM,UAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,OACpB/gE,KAAM,oBAIZ,CAACoR,GAAgBY,sBAAuB,CACtC,CACEzP,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,UAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,qBC/Qb+B,OAAe0L,IAAMA,EAAAA,GACrB1L,OAAe9D,GAAKA,GACpB8D,OAAe/I,KAAOA,EACtB+I,OAAe60D,KAAOA,EAAAA,EAKhB,MAAMyK,GAAM5qE,IAMZ,IANa,OAClBugB,EAAM,oBACNu+C,GAID9+D,EACC,OAEEZ,EAAAA,cAACW,EAAe,KACdX,EAAAA,cAACmM,GAAS,KACRnM,EAAAA,cAACy/D,GAAkB,CAACC,oBAAqBA,GACvC1/D,EAAAA,cAACyrE,EAAAA,GAAc,CAAC7Z,OAAQmZ,IACtB/qE,EAAAA,cAAC0rE,EAAAA,GAAU,KACT1rE,EAAAA,cAAC2rE,EAAAA,EAAa,KACZ3rE,EAAAA,cAAC4rE,EAAAA,EAAY,KACX5rE,EAAAA,cAAC+pE,GAAO,CAAC5oD,OAAQA,UAOb,EAEpBqqD,GAAAnrE,aAAA,0UAEF,W,+BCAO,SAASyzD,EACd14C,GAEA,MAAO,WAAYA,CACrB,CACO,SAASywD,EAAczwD,GAC5B,MAAO,aAAcA,CACvB,CAEO,SAAS0wD,EACd1wD,GAEA,MAAO,aAAcA,GAAU,WAAYA,CAC7C,CAEO,SAAS2wD,EACd3wD,GAEA,MAAO,aAAcA,CACvB,C,wIChEO,MAAM65C,EAAiBr0D,IAMvB,IANwB,SAC7Bka,EAAQ,SACRha,GAIDF,EACC,MACMorE,EADc7wD,GACGD,CAAYJ,GACnC,OACE9a,EAAAA,cAAAA,EAAAA,SAAA,KACGgsE,IAAmBlrE,EAAWA,EAASkrE,GAAkBA,GACzD,EAQM7wD,EAAuBA,KAClC,MAAMy2C,GAASC,EAAAA,EAAAA,MACf,OAAQ/2C,IACN,MAAMi3C,EAAmBH,IAAS92C,IAAWlE,MAC3CpJ,IAAA,IAAC,KAAEd,GAAMc,EAAA,MAAc,aAATd,CAAmB,IAEnC,OAAOqlD,GAAmBC,EAAAA,EAAAA,GAAiBD,GAAoB,EAAE,CAClE,EACDkD,EAAA50D,aAAA,ikB,oKCwFF,MAAM4rE,EAAaA,CACjBC,EACAhiE,EACAiiE,IAEAjiE,EAAEC,OAAS+hE,GAAW/hE,OACrBgiE,EAAQD,EAAUhB,WAAa,GAAKkB,EAAAA,GAAoBhP,OACtDiP,GACCniE,EAAEoiE,iBAAiBD,KACnBtf,QAAQmf,EAAUhB,WAAWr8D,SAASw9D,M,0BC3F5C,MAAME,EAAiBvsE,EAAAA,cAA8B,IAErD,SAASwsE,IACP,MAAQ,OAAMn4D,KAAK69C,MAAsB,IAAhB79C,KAAK89C,WAChC,CAEA,MAAMsa,EAA+B,uBAC/BC,EAAiC,sBACjCC,EAAqB,IAAI1nD,IAUxB,SAAS5F,EAAgBtf,GAC9B,MAAM6sE,GAAgBtjD,EAAAA,EAAAA,YAAWijD,GAC3B3a,GAASC,EAAAA,EAAAA,MACT33C,EAAoB,IAC1Bqe,EAAAA,EAAAA,KACGnd,IACCA,GAAYA,aAAkBiM,EAAAA,KAAgBwkD,EAAAA,EAAAA,IAAczwD,GAExD,KADAA,EAAOta,WAEZsa,KACKA,GAAYA,aAAkBiM,EAAAA,GAChCnN,EAAQpK,KAAKsL,EACf,GAEFyxD,EAAyBjb,EAAQ7xD,EAAMma,UAGzC,MAAM4yD,EAAY9oE,OAAO+2C,YACvB7gC,EAAQrW,KAAKuX,GAAW,CAACA,EAAOkD,GAAIlD,EAAO0xD,WAAa,QAEnDC,IAAoB/nE,EAAAA,EAAAA,UAASwnE,IAE9B,qBAAEltD,GDxEH,SACLwtD,EACAltD,EAKmB9U,GAUlB,IATD,WACE8/D,GAAa,QAOd,IAAA9/D,EAAG,CAAC,EAACA,EAEN,MAAMkiE,GAAgCn8D,EAAAA,EAAAA,QAEpC,IACIo8D,GAA8Bp8D,EAAAA,EAAAA,QAAsB,MACpD4zD,GAA+CnhC,EAAAA,EAAAA,IAAkBp5B,IAwGzE,IAAwBuS,EAtGpB,GAuGwB,KADJA,EAtGDvS,EAAEgjE,aAuGVtM,UAAqC,IAAnBnkD,EAAMmkD,WAvGE12D,EAAEijE,OAkBvC,GAd4C,OAAxCF,EAA4Bn8D,SAC9B5E,OAAOkjB,aAAa69C,EAA4Bn8D,SAa9Ck8D,EAA8Bl8D,QAAQT,OAAS,EACjD28D,EAA8Bl8D,QAAQgnB,MAAKl3B,IAA6B,IAA5B,SAAEumB,EAAQ,SAAErM,GAAUla,EAChE,GAAIqrE,EAAW9kD,EAASokD,gBAAiBrhE,GAAG,GAE1C,OADAkjE,EAActyD,IACP,CACT,IAEFkyD,EAA8Bl8D,QAAU,OACnC,CACL,MAAMu8D,EAAkBrpE,OAAO+sB,QAAQ+7C,GACpCppE,SAAQ8J,IAAA,IAAEsN,EAAUgyD,GAAUt/D,EAAA,OAC7Bs/D,EAAUjpE,KAAKsjB,IAAQ,CAAQrM,WAAUqM,cAAY,IAEtDlV,QAEGwD,IAIG63D,EAAAA,EAAAA,GAAmB73D,EAAM0R,YAE/BlV,QAAOxC,IAAA,IAAC,SAAE0X,GAAU1X,EAAA,OAAKw8D,EAAW9kD,EAAS8jD,eAAgB/gE,EAAE,IAElE8iE,EAA8Bl8D,QAAUu8D,EAAgBp7D,QACtD7B,IAAA,IAAC,SAAE+W,EAAQ,SAAErM,GAAU1K,EAAA,OAAK+W,EAASokD,eAAe,IAGlDyB,EAA8Bl8D,QAAQT,OAAS,GACjD48D,EAA4Bn8D,QAAU5E,OAAO0H,YAAW,KACtDo5D,EAA8Bl8D,QAAU,EAAE,GACzC,KACH+/B,SAAS08B,iBACP,WACA,KACE18B,SAAS08B,iBACP,SACA,KACEP,EAA8Bl8D,QAAU,EAAE,GAE5C,CAAE08D,MAAM,GACT,GAGH,CAAEA,MAAM,EAAMC,SAAS,KAEhBJ,EAAgBh9D,OAAS,GAClC+8D,EAAcC,EAAgB,GAAGvyD,SAErC,CA1DA,SAASsyD,EAActyD,IAEN,IADA8E,EAAS9E,EAAU,CAAE2B,MAAOvS,MAGzCA,EAAEiyC,kBACFjyC,EAAEuX,iBAEN,CAmDA,IAqBF,MAAO,CAAEnC,qBAnBoB,CAiB3B,CAACsrD,EAAa,mBAAqB,aAAcnG,GAGrD,CCxCmCiJ,CAC/BZ,GACA,CAAChyD,EAAQla,KAAiB,IAAf,MAAE6b,GAAO7b,EAClBsZ,EACGtD,MAAMwE,GAAWA,EAAOkD,KAAOxD,KAC9BoG,QAAQ,CACRzE,QAEA8L,QAAS9L,EAAM3T,kBAAkBuI,QAAUoL,EAAM3T,OAAS,MAC1D,GAEN,CAAE8hE,WAAY7qE,EAAM6qE,aAGhBtW,EAAa,IAAIsY,KAAkB1yD,GAiBzC,OAdAoF,EAAqBmtD,GAAgCM,EAErDztD,EACG,QAAOotD,IAAiCK,KACvC,IAEJ9+D,EAAAA,EAAAA,YAAU,KACR0+D,EAAmBhiE,IAAIoiE,EAAkBzY,EAAW,KAEtDrmD,EAAAA,EAAAA,YAAU,IACD,KACL0+D,EAAmBgB,OAAOZ,EAAiB,GAE5C,IAED/sE,EAAAA,cAACusE,EAAe7rB,SAAQ,CAACt8C,MAAOkwD,GAC7Bv0D,EAAMe,SAAS,CAAEwe,yBAGxB,CAiBA,SAASutD,EACPjb,EACAgc,EACAzoD,GAEA,OAAOyoD,EAAkB/pE,KAErBgqE,IAEA,GAAIA,aAA4BxmD,EAAAA,EAC9B,OAAOwmD,EAET,MAAMf,EACJlb,IAASic,EAAiBvvD,MACzBuvD,EAAiBt0B,eACdqY,IAASic,EAAiBt0B,qBAC1BnyB,GACA0mD,EAAgBhB,IAAY,GAC5B1xD,EAAgD,IACjDyyD,MACC9B,EAAAA,EAAAA,IAAwB8B,GACxB,CAAE1oD,OAAQA,GAAU,MACpB,CAAC,EACL2nD,YACA3lD,SAAU2mD,GAAgB9b,EAAAA,EAAAA,GAAiB8b,QAAiB1mD,EAC5DlG,QAAU1E,IACHpB,EAAOsQ,YACVmiD,EAAiBlvD,gBACfnC,GAAW,CAAEC,MAAO,KAAM8L,QAAS,MAEvC,GAeJ,OA5DN,SACEnN,GAEA,MAAO,aAAcA,CACvB,CA6CQ2yD,CAAqB3yD,KACrB2wD,EAAAA,EAAAA,IAAwB8B,KAExBzyD,EAAOta,SAAW+rE,EAChBjb,EACAic,EAAiB/sE,SAAS+C,KAAKmvB,GACnB,YAAVA,EAAsB,IAAI3L,EAAAA,EAAgB2L,IAE5C5X,IAGGA,CAAM,GAGnB,CAOO,SAASm5C,EAAuBhsC,GACrC,MAAMylD,EAAwBzlD,EAAQjX,QACnC,IAAGm7D,MAEN,GAAIuB,aAAiCj9B,YAAa,CAWhD,MAAMk9B,EAAajqE,OAAOC,KAAK+pE,EAAsBtlD,SAClDzW,QAAQi8D,GAAYA,EAAQ5jD,WAAWoiD,KACvC7oE,KAAKqqE,IACJ,MAAM5vD,EAAK4vD,GAAS9oE,QAAQsnE,EAAgC,IACtDxyD,EAAUoE,GAAMquD,EAAmBniE,IAAI8T,GAE7C,OAAOpE,EACHlW,OAAOD,OAAOmW,GAASjI,QACrBzE,IAAA,IAAC,aAAEgR,GAAchR,EAAA,OAAsB,IAAjBgR,CAAsB,IAE9C,EAAE,IAEPjb,SACH,OAAOykB,EAAAA,EAAAA,IAAQmmD,IAAeA,EAAU99D,QAAQ49D,GAAY,IAAM,EACpE,CACA,MAAO,EACT,CAEO,SAAS50B,IACd,OAAO/vB,EAAAA,EAAAA,YAAWijD,EACpB,CAEO,MAAMlxD,EAAaP,GACjBu+B,IAAaziC,MAAKnH,IAAA,IAAC,GAAE6O,GAAI7O,EAAA,OAAK6O,IAAOxD,CAAQ,KAAK,KAG9C+0B,EAAmBA,KAI9B,MAAM31B,EAAUm/B,IAChB,OAAO/V,EAAAA,EAAAA,IAAiB,CAACxoB,EAAkB0B,KACzC,MAAMpB,EAASlB,EAAQtD,MAAKxG,IAAA,IAAC,GAAEkO,GAAIlO,EAAA,OAAKkO,IAAOxD,CAAQ,IACnDM,EACFA,EAAO8F,QAAQ1E,GAEf1S,QAAQ4D,MACL,wCAAuCoN,wCAE5C,GACA,EACFuE,EAAAhf,aAAA,29C,gDCtPK,MAAM0a,EAAiB,CAC5B8T,WAAY,YACZC,aAAc,cACd2iC,iBAAkB,mBAClBC,iBAAkB,qBAClBz2C,aAAc,aACdD,WAAY,WACZy5C,uBAAwB,uBACxBjgC,YAAa,2BACb45C,oBAAqB,oBACrBrvD,eAAgB,gBAChB2U,QAAS,UACT9U,KAAM,QACN0I,IAAK,OACLxI,MAAO,SACPyI,OAAQ,UACR+8C,gBAAiB,iB,4FCRZ,MAAM+J,EAAgBruE,EAAAA,cAAmCsuE,EAAAA,GAEnD7C,EAGR7qE,IAAuC,IAApCgxD,OAAQ2c,EAAU,SAAEztE,GAAUF,EACpC,MAAM4tE,GAAellD,EAAAA,EAAAA,YAAW+kD,GAC1Bzc,EAAS5tD,OAAOyqE,OAAOzqE,OAAO0qE,OAAOF,GAAeD,GAC1D,OACEvuE,EAAAA,cAACquE,EAAc3tB,SAAQ,CAACt8C,MAAOwtD,GAAS9wD,EAAkC,EAIjE+wD,EAAYA,KAAMvoC,EAAAA,EAAAA,YAAW+kD,GAAe5C,EAAAprE,aAAA,wD,uDCMlD,MAAMitE,EACXnmD,GACmD,aAAlBA,EAASza,KAE/B0/D,EAA0C,CACrD,MACA,OACA,QACA,U,oHC3BK,MAAMx9C,EAAehuB,IAUU,IAVT,SAC3Bka,EAAQ,SACRha,KACGoyD,GAOctyD,EACjB,MAAMwa,GAASC,EAAAA,EAAAA,IAAUP,GACzB,IAAKM,EACH,OAAOpb,EAAAA,cAAAA,EAAAA,SAAA,MAET,MAAM2uE,EACJ3uE,EAAAA,cAACiiC,EAAAA,IAAU/hC,EAAAA,EAAAA,GAAA,CACTwrB,WAAYtQ,EAAOsQ,WACnB,aAAYtQ,EAAOpB,OACfk5C,EAAU,CACd94C,QAAUlQ,IACRkR,GAAQ8F,UACRgyC,EAAW94C,UAAUlQ,EAAE,IAGxBpJ,GAAYsa,EAAOrB,MAGxB,OAAIqB,EAAOpB,MAEPha,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAYtF,EAAOpB,MAAOmN,SAAU/L,EAAO+L,YAG3DwnD,GAIAA,CAAY,EACnB//C,EAAAvuB,aAAA,+P,mFCtCK,MAAM4iB,EAAkBriB,IAGF,IAHG,YAC9BmiB,KACGhjB,GACkBa,EACrB,OACEZ,EAAAA,cAACinB,EAAAA,GAAW/mB,EAAAA,EAAAA,GAAA,CACV,aAAY6iB,EAAY/I,MACxBE,QAAS6I,EAAYjiB,UACjBf,GACJ,EAEJkjB,EAAA5iB,aAAA,oL,wICJF,SAASuuE,EAASh/D,GAChB,MAAO,YAAaA,CACtB,CAmCO,SAASqX,EAAWrmB,GAKN,IALO,QAC1BsZ,EAAO,cACPgN,EAAa,SACbpmB,EAAYghC,IAAoB9hC,EAAAA,cAAC2f,EAAAA,GAASmiB,OACvCoxB,GACatyD,EAChB,MAAM0zD,EAAaua,EAAc30D,GAC3Bg0C,EAAeoG,EAClBriD,QAAOzE,IAAA,IAAC,WAAEke,GAAYle,EAAA,OAAKke,CAAU,IACrC7nB,KAAI4L,IAAA,IAAC,GAAE6O,GAAI7O,EAAA,OAAK6O,CAAE,IAErB,OACEte,EAAAA,cAAAA,EAAAA,SAAA,KACGc,EAAS,IACLoyD,EACHtzC,SAAWzb,IACT,MAAMiX,EAASk5C,EAAW19C,MAAKxG,IAAA,IAAC,GAAEkO,GAAIlO,EAAA,OAAKkO,IAAOna,CAAG,IACjDiX,GAAUwzD,EAASxzD,IACrBA,EAAO8F,QACoB,mBAAlBgG,EACHA,MACAA,EAER,EAEFgnC,eAEAhlD,MAAOgR,EACPpZ,SAAWsa,GACLA,aAAkBiM,EAAAA,EACbrnB,EAAAA,cAACw9C,EAAAA,EAAO,MAEVsxB,EAAuB1zD,KAKxC,CAIO,SAAS0zD,EACd1zD,GAEA,MAAM2zD,EAAU,aAAc3zD,EAC9B,OACE2zD,GAC6B,YAA5B3zD,EAAOqD,kBACsB,kBAA5BrD,EAAOqD,iBAmBPrD,aAAkBiM,EAAAA,EACbrnB,EAAAA,cAACw9C,EAAAA,EAAO,MAGfx9C,EAAAA,cAAC6f,EAAAA,EAAI,CACH1b,IAAKiX,EAAOkD,GACZ8B,UAAWhF,EAAOpB,MAClB,aAAYoB,EAAOpB,MACnBnK,WACEk/D,GAAuC,YAA5B3zD,EAAOqD,iBACdrD,EAAOta,cACPsmB,GAGNpnB,EAAAA,cAACsgB,EAAAA,EAAc,CACb7W,QAAS2R,EAAOpB,MAChBD,KAAMqB,EAAOrB,KACboN,SAAU,aAAc/L,EAASA,EAAO+L,cAAWC,KAjCrDpnB,EAAAA,cAACmiC,EAAAA,EAAO,CACNh+B,IAAKiX,EAAOkD,GAEZ0wD,YAAU,EACV,aAC8B,YAA5B5zD,EAAOqD,iBAAiCrD,EAAOpB,WAAQoN,EAEzDpN,MAC8B,kBAA5BoB,EAAOqD,iBAAuCrD,EAAOpB,WAAQoN,EAE/Dle,MAAOkS,EAAOta,UAEbguE,EAyBT,CAEA,SAASD,EAAc3lE,GACrB,OAAO+lE,EAAAA,EAAAA,GACL/lE,EAAMrF,KAAK+L,GACT,CAACA,GAAMrM,OAAO,aAAcqM,EAAOi/D,EAAcj/D,EAAK9O,UAAY,OAEpEmR,OAAO28D,EACX,CAAC3nD,EAAA5mB,aAAA,quFAAAyuE,EAAAzuE,aAAA,gE,4KCrIM,MAAM2d,EAA8BA,KACzC,MAAM,KAAElE,IAASwtD,EAAAA,EAAAA,KACX/kB,GAAoBpnC,EAAAA,EAAAA,KACpB+zD,GAAqB5rC,EAAAA,EAAAA,IACzB,CAAA1iC,EAEE4b,KACI,IAFJ,SAAE1b,EAAQ,MAAEkZ,GAA0DpZ,EAGtEkZ,GAAKtM,IAAA,IAAC,MAAE4G,GAAO5G,EAAA,OACbxN,EAAAA,cAACspD,EAAAA,GACC,CACA6lB,YACE3yD,EAAQ+L,mBAAmBwoB,YACvB,CACEq+B,UAAW,CACTt+D,QACE0L,EAAQ+L,QAAQC,cACb,IAAG6mD,EAAAA,OACD7yD,EAAQ+L,SAEjB+tB,UAAW,eAEblvB,GAGNpnB,EAAAA,cAACspD,EAAAA,GAAMO,OAAM,CACXpgD,QAMEzJ,EAAAA,cAAC+hC,EAAAA,EAAe,CACd,aAAY/nB,EACZ9Q,MAAOpI,EAAS+C,KAAK+L,GACV,YAATA,EAAqB,IAAIyX,EAAAA,EAAgBzX,IAE3CgQ,SAAWzb,IAET,MAOMiX,GAPa6zD,EAAAA,EAAAA,GACjBnuE,EAAS+C,KAAK+L,GACH,YAATA,IAAsBm8D,EAAAA,EAAAA,IAAwBn8D,GAC1CA,EAAK9O,SACL8O,KAGkBgH,MACvBwE,GACmB,iBAAXA,GAAuBA,EAAOkD,KAAOna,IAE5CiX,IAAWA,EAAOsQ,YACpBtQ,EAAOuD,gBAAgBnC,EACzB,EAEFqG,QAASzO,EACT+O,UAAU,UAERvT,IACAk/D,EAAAA,EAAAA,GACEl/D,aAAgByX,EAAAA,EACZzX,EACA,IACKA,EAEHuX,SAAUo7B,EAAkB3yC,EAAK0O,QAM/C2O,OAAQjT,IAEJ,GACR,IAIN,OACEs1D,IAEO,CACL7wD,iBAAkB,aACf6wD,EACH3wD,gBAAkBnC,GAChB0yD,EAAmBI,EAAiB9yD,IAEzC,C,0EC/EI,MAAM8xD,EAAwB,CACnC,CAACiB,EAAAA,IAAqC,CACpC,CACE7iE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,aACN+gE,UAAW,CAAC,UAAW,UAI7B,CAACsE,EAAAA,IAAoC,CACnC,CACE9iE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,YACN+gE,UAAW,CAAC,UAAW,UAI7B,CAACuE,EAAAA,IAAmC,CAClC,CACE/iE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,UACN+gE,UAAW,CAAC,UAAW,UAI7B,CAACwE,EAAAA,IAAsC,CACrC,CACEhjE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,YACN+gE,UAAW,CAAC,UAAW,UAI7B,CAACyE,EAAAA,IAAiC,CAChC,CACEjjE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,QACN+gE,UAAW,CAAC,QAAS,WAI3B,CAAC0E,EAAAA,IAAyB,CACxB,CACEljE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,YAIZ,CAAC0lE,EAAAA,IAA+B,CAC9B,CACEnjE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,SACN+gE,UAAW,CAAC,YAIlB,CAAC7tD,EAAAA,IAA6B,CAC5B,CACE3Q,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,MACN+gE,UAAW,CAAC,QAAS,WAI3B,CAAC4E,EAAAA,IAAgC,CAC/B,CACEpjE,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,SAIZ,CAAC4Q,EAAAA,EAAe02C,kBAAmB,CACjC,CACE/kD,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,SAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OACZ/gE,KAAM,aAIZ,CAAC4Q,EAAAA,EAAe22C,kBAAmB,CACjC,CACEhlD,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,SAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OACZ/gE,KAAM,eAIZ,CAAC4Q,EAAAA,EAAe8T,YAAa,CAC3B,CACEniB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,eAIZ,CAAC4Q,EAAAA,EAAe+T,cAAe,CAC7B,CACEpiB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,oBAIZ,CAAC4Q,EAAAA,EAAeE,cAAe,CAC7B,CACEvO,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAe05C,wBAAyB,CACvC,CACE/nD,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OACZ/gE,KAAM,WAIZ,CAAC4Q,EAAAA,EAAeC,YAAa,CAC3B,CACEtO,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,SACpB/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAeyZ,aAAc,CAC5B,CACE9nB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,cAGV,CACEuC,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,QAIZ,CAAC4Q,EAAAA,EAAeqzD,qBAAsB,CACpC,CACE1hE,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OACZ/gE,KAAM,eAIZ,CAAC4Q,EAAAA,EAAegE,gBAAiB,CAC/B,CACErS,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,OAAQ,QAAS,OAC7B/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAe2Y,SAAU,CACxB,CACEhnB,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAewM,QAAS,CACvB,CACE7a,KAAM,WACNu+D,eAAgB,CACd9gE,KAAM,eAIZ,CAAC4Q,EAAAA,EAAe6D,MAAO,CACrB,CACElS,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAeuM,KAAM,CACpB,CACE5a,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAe+D,OAAQ,CACtB,CACEpS,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,QACZ/gE,KAAM,UAIZ,CAAC4Q,EAAAA,EAAeupD,iBAAkB,CAChC,CACE53D,KAAM,WACNu+D,eAAgB,CACdC,UAAW,CAAC,WACZ/gE,KAAM,W,4FCtQd,MAAM4lE,EAKF,CACFC,QAAS,OACT,IAAK,QACLC,UAAW,SACXC,QAAS,SACTC,UAAW,SACXC,WAAY,SACZC,MAAO,SACPC,MAAO,IACPC,MAAO,IACPC,SAAU,IACVC,UAAW,IACXC,SAAU,IACVC,eAAgB,IAChBC,MAAO,IACPC,UAAW,aAERC,EAAAA,EAAAA,GACDx7D,MAAMiwB,KAAKjwB,MAAM,KACdzR,KAAI,CAACqG,EAAGke,IAAMA,EAAI,IAAI7D,WAAW,KACjC1gB,KAAK2/D,GAAM5X,OAAOC,aAAa2X,KAC/B3/D,KAAKokB,GAAM,CAACA,EAAGA,EAAEw8B,mBAGlBssB,GAGFC,EAAAA,EAAAA,MACA,CACEC,UAAW,GACXC,UAAW,IACNnB,EACHoB,IAAK,SACLC,MAAO,SACPC,KAAM,SACNrB,QAAS,IACTsB,OAAQ,WAGZ,CACEL,UAAW,IACXC,UAAWnB,GAGXwB,EAAsC,CAAC,UAAW,MAAO,QAAS,QAC3DC,EAAqBC,GACzB,KACDA,EAAUvG,WAAa,IAAIzlD,MAC7B,CAACwC,EAAGmI,IAAMmhD,EAAexwD,QAAQkH,GAAKspD,EAAexwD,QAAQqP,KAE/DqhD,EAAUtnE,MAETtG,KAAKsG,GAAS4mE,EAAkBG,UAAU/mE,IAASA,IACnDtG,KAAKsG,GAASA,EAAK/E,QAAQ,0BAA2B,QACtD8Q,KAAK66D,EAAkBE,WAEfjf,EAAoB7qC,IAC/B,IAAImmD,EAAAA,EAAAA,GAAmBnmD,GACrB,MAAO,CAACA,EAAS8jD,eAAgB9jD,EAASokD,iBACvCt5D,QAAQmW,GAA2BhB,MAALgB,IAC9BvkB,IAAI2tE,GACJt7D,KAAK,MAEV,MAAM,IAAI7L,MAAM,sBAAsB,C,0EChFjC,MAAM2Y,EACX0uD,IAEA,MAAMt2D,GAASC,EAAAA,EAAAA,IAAUq2D,GACzB,GAAIt2D,EAAQ,CACV,IAAI0wD,EAAAA,EAAAA,IAAsB1wD,GACxB,OAAOA,EAET,MAAM,IAAI/Q,MAAO,kBAAiBqnE,mBACpC,CACA,OAAO,IAAI,C,0IC4Db,MAAMC,GAAoBpxE,EAAAA,EAAAA,IAAOssB,EAAAA,GAAa;IAC1C+kD,EAAAA;;;;EAMEv3D,EAAkB9Z,EAAAA,GAAO+Z,GAAI;;;;;;;EAS7Bu3D,EAAgBtxE,EAAAA,GAAOuxE,EAAG;;;;;EAO1BC,EAAaxxE,EAAAA,GAAO+Z,GAAI;;EAIxB03D,EAAgBzxE,EAAAA,GAAO+Z,GAAI;;;;;;EAQ3B23D,EAAiB1xE,EAAAA,GAAO+Z,GAAI;;;;EAM5B43D,GAAgB3xE,EAAAA,EAAAA,IAAO4xE,EAAAA,EAAa;;;;EAMpCC,EAAa7xE,EAAAA,GAAOy+B,IAAK;;EAIzBqzC,EAAiB9xE,EAAAA,GAAO+Z,GAAI;;EAcrBmmD,EAAc7/D,IASW,IATV,KAC1B8L,EAAO,WAAU,QACjBg0D,EAAO,KACPzmD,EAAI,SACJq4D,EAAQ,WACRC,EAAU,QACV5R,EAAO,SACP7zC,EAAW,OACRomC,GACctyD,EACjB,OACEZ,EAAAA,cAAC2xE,GAAiBzxE,EAAAA,EAAAA,GAAA,CAChB67C,KAAK,cACL6N,aAAa,OACb98B,SAAUA,EACV0lD,cAAe,CACbhpB,IAAKt9C,OAAOu9C,YAAc,GAG5BgpB,sBAAoB,GAChBvf,GAEJlzD,EAAAA,cAAC0yE,EAAAA,EAAiB,CAACC,cAAe,EAAGC,aAAcC,EAAAA,IAChDrlE,IAAA,IAAC,gBAAEslE,GAAiBtlE,EAAA,OACnBxN,EAAAA,cAACqa,EAAoBy4D,EACnB9yE,EAAAA,cAACoyE,EAAU,KAETpyE,EAAAA,cAAC0e,EAAAA,GAAY,CAAC5R,KAAM,GAAIiN,KAAO,WAAUrN,aAE3C1M,EAAAA,cAACgyE,EAAa,KACZhyE,EAAAA,cAAC6xE,EAAa,KAAEnR,GAChB1gE,EAAAA,cAAC+xE,EAAU,KAAE93D,GACZq4D,GAAYtyE,EAAAA,cAACiyE,EAAc,KAAEK,IAEhCtyE,EAAAA,cAACqyE,EAAc,KAAEE,GACjBvyE,EAAAA,cAACkyE,EAAa,KAAEvR,GACA,IAGJ,EAEtBF,EAAApgE,aAAA,wtE,+FC5JK,SAAS6pE,IACd,MAAM,KAAEz9C,IAASghC,EAAAA,EAAAA,KACjB,MAAO,CACLthC,QAASvrB,IAAA,IAAC,MAAEoZ,EAAK,QAAEqS,EAAO,OAAED,EAAS,KAAI,WAAE2mD,EAAa,UAAUnyE,EAAA,OAChE,IAAI2G,SAASC,IACXilB,GAAKjf,IAAA,IAAC,MAAE4G,GAAO5G,EAAA,OACbxN,EAAAA,cAACygE,EAAAA,EAAW,CACV/zD,KAAK,WACLuN,KAAMoS,EACNq0C,QAAS1mD,EACT2mD,QACE3gE,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8pB,EAAAA,EAAM,CAAC1P,QAAShG,GAAQ2+D,GACzB/yE,EAAAA,cAAC8pB,EAAAA,EAAM,CACLC,QAAQ,UACR3P,QAASA,KACP5S,GAAQ,GACR4M,GAAO,GAGRgY,IAIPvJ,QAASA,IAAMrb,GAAQ,IACvB,GACF,GACF,EAER,C,wICjDA,MAEMwrE,EAAUpyE,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,OAC1CgE,EAAM0U,MACJ,0BACC1U,EAAMK,KAA4B,UAArB,mBACf,EAEUguE,EAAsB1yE,EAAAA,GAAO+Z,GAAI;;;;;;;;;;sDAUQ04D;;;;;;EAQzCE,EAAyB3yE,EAAAA,GAAO+Z,GAAI;;;;;;;MAO3C9M,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACV5I,EAAM0U,MACJ,2BACC1U,EAAMK,KAAqB,YAAd,YACf;mBACYwK,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAEtB7K,EAAMR,MACL,qBAzCc,IA0CM,EAHvB,IAIG;;;;sBAIc4uE;WACX5iE,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACjBxL,EAAM0U,MACJ,0BACC1U,EAAMK,KAAgB,mBAAT,OACf;;IAEDguE;;;YAGQA;;;EAKCE,EAAsB5yE,EAAAA,GAAOy+B,IAAK;;;;EAMlCo0C,EAAsB7yE,EAAAA,GAAO+Z,GAAI;;;;;;;EASjC+4D,EAAoB9yE,EAAAA,GAAO+Z,GAErC;;;;wBAIqBxG,IAAA,IAAC,UAAEw/D,GAAWx/D,EAAA,OAAKw/D,CAAS;gBACpC9+D,IAAA,IAAC,UAAE8+D,GAAW9+D,EAAA,OAAmB,IAAd8+D,GAAmB,WAAW;;;;;;EAQpDC,EAAsBhzE,EAAAA,GAAO+Z,GAAI;;;;;;;;;EAWjCk5D,EAA4BjzE,EAAAA,GAAOy+B,IAAK;;;;;sBAK/Bg0C;;EAITS,EAAoClzE,EAAAA,GAAOy+B,IAAK;;;;;EAOhD00C,GAA0CnzE,EAAAA,EAAAA,IACrDkzE,EACA;;;;;IAKED;;;IAGAD;;;;IAIAA;;;IAGAA;;;wICrFJ,MAAMI,EAAiB3zE,EAAAA,cAA8C,MAMxDuuD,EAAiCvuD,EAAAA,YAC5C,CAAAY,EAAwBwjB,KAAS,IAAhC,QAAEhK,KAAYra,GAAOa,EACpB,MAAM4b,GAAU8M,EAAAA,EAAAA,YAAWqqD,GAC3B,GAAgB,OAAZn3D,EACF,MAAM,IAAInS,MACR,0EAGJ,OACErK,EAAAA,cAACma,EAAAA,GAAIja,EAAAA,EAAAA,GAAA,CACHkkB,IAAKA,GACDrkB,EAAK,CACTqa,QAAS,WACPoC,GAASqG,YAAY,QAAAslB,EAAA7Q,UAAAjnB,OADVsG,EAAI,IAAArB,MAAA6yB,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAJ1xB,EAAI0xB,GAAA/Q,UAAA+Q,GAEf,OAAOjuB,OAAazD,EACtB,IACA,IAaKi9D,EAAUpmE,IAWkB,IAVvCuM,KAAM85D,EAAW,OACjBC,SAAUC,EAAY,gBACtBC,GAAkB,EAAK,iBACvBlrD,EAAgB,MAChB9O,EAAK,cACLi6D,EAAa,QACbpxD,EAAO,KACP5I,EAAI,QACJC,KACG8G,GACUxT,EACb,MAAM0mE,GAAUrjE,EAAAA,EAAAA,QAAuB,OAChCsjE,EAAYC,IAAiBpvE,EAAAA,EAAAA,WAAS,IACtC8uE,EAAUO,IAAezR,EAAAA,EAAAA,GAC9BmR,EACAC,EACAlrD,GAEIwrD,EAA0B,GAAKt6D,EAAQ,EAAI,IAAME,EAAU,EAAI,IAErEjM,EAAAA,EAAAA,YAAU,KACR,MAAMsmE,EAAWL,EAAQpjE,QAEvBsjE,IADEG,IAEAT,EAqHR,SAAqBS,GACnB,OACEA,EAASC,aAAeC,WAAWnT,iBAAiBiT,GAAUxuE,WAElE,CAxHY2uE,CAAYH,GAAYD,EACxBC,EAASI,aAAeJ,EAASC,cAIzC,GACC,CAACV,IACJ,MACM/5D,EACgB,iBAAb85D,EACL7zE,EAAAA,cAAC0e,EAAAA,GAAY,CACX3E,KAAO,uBAJU,CAAC,QAAS,UAAW,QAIMnD,MAC1C,CAACg+D,EAAUxhE,EAAOqqD,IAChBmX,IAAaf,GAAYzgE,IAAUqqD,EAAIptD,OAAS,YAItDwjE,EAGElyC,EAASA,IAAM0yC,GAAaP,IAAcA,IAE1Ce,EAAoBf,GAAY/mB,QAAQ9yC,GAE9C,OACEja,EAAAA,cAAC2zE,EAAejzB,SAAQ,CAACt8C,MAAO,CAAEye,YAChC7iB,EAAAA,cAACkzE,EAAAA,IAAsBhzE,EAAAA,EAAAA,GAAA,CAAC,cAAY,WAAc8gB,GAChDhhB,EAAAA,cAACmzE,EAAAA,GAAmB,KAAEp5D,GACrBC,GAASha,EAAAA,cAACozE,EAAAA,GAAmB,KAAEp5D,GAChCha,EAAAA,cAACizE,EAAAA,GAAmB,KACjBgB,EACApxD,GACC7iB,EAAAA,cAACu7C,EAAAA,EAAqB,CACpBxhC,KAAK,6BACLkiC,QAASp5B,EACTk5B,KAAK,SACL,cAAY,YACZtiC,MAAO,CAAEq7D,WAAY,cAI1B76D,GACCja,EAAAA,cAAC+0E,EAAa,CACZjB,SAAUe,EACV/uE,QAASquE,IAAeU,EACxBnzC,SAAUC,GAEV3hC,EAAAA,cAACqzE,EAAAA,GAAiB,CAChBC,WAAYuB,GAAqBP,EACjClwD,IAAK8vD,GAEJj6D,IAIPja,EAAAA,cAAC+0E,EAAa,CACZjB,SAAUe,EACV/uE,QAASquE,GAAcU,EACvBnzC,SAAUC,EACVqzC,UAAWtB,EAAAA,IAEVx5D,GACCla,EAAAA,cAACuzE,EAAAA,GAAmB,CAACt3B,QAAU/xC,GAAMA,EAAEiyC,mBACpCjiC,KAKe,EAOxB66D,EAMDtlE,IAME,IAND,SACJ3O,EAAQ,SACR4gC,EAAQ,SACRoyC,EAAQ,QACRhuE,EAAO,UACPkvE,EAAYvB,EAAAA,IACbhkE,EACC,MAAMwlE,EAAWnB,EAAW,WAAa,SACnCoB,EACJl1E,EAAAA,cAACwzE,EAAAA,GAAyB,KACxBxzE,EAAAA,cAACu7C,EAAAA,EAAqB,CACpBa,uBAAyB,GAAE44B,IAC3Bj7D,KAAO,oBAAmBk7D,QAC1BE,UAAU,UAKhB,OAAOrvE,EACL9F,EAAAA,cAACg1E,EAAS,CACR/4B,QAASva,EACTqa,KAAK,SACL,eAAgB+3B,EAAW,WAAa,UAA1B,QAEbhzE,EACAo0E,GAGHl1E,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,EACJ,EAUFytD,EAAAluD,aAAA,iLAAAuzE,EAAAvzE,aAAA,msD,iHC/MD,MAAM+0E,EAAmBA,KACvB,MAAM,IAAI/qE,MAAM,sCAAsC,EAGlDgrE,EAAkBr1E,EAAAA,cAAuC,CAC7D8Z,KAAMs7D,EACNjmB,WAAYimB,IAGDtqC,EAAoBA,KAC/BxhB,EAAAA,EAAAA,YAAW+rD,GAuBAlL,EAAgDvpE,IAItD,IAJuD,SAC5DE,EAAQ,cACRspE,EAAa,kBACbkL,EAAoBC,EAAAA,GACrB30E,EACC,MAAOowD,EAAUwkB,IAAexwE,EAAAA,EAAAA,UAAgC,IAC1DywE,GAAgB5kE,EAAAA,EAAAA,QAAiB,IACjC6kE,GAAY7kE,EAAAA,EAAAA,QAAe,GAE3B8kE,GAAMhyD,EAAAA,EAAAA,UAA2B,KACrC,MAAM7J,EAAkC,SAAC/Z,EAAO61E,QAAO,IAAPA,IAAAA,EAAU,KACxDF,EAAU5kE,UACV,MAAM+R,EAAUA,KACd2yD,GAAaxkB,GACXA,EAAS/+C,QAAQ4jE,GAAaA,IAAaC,KAC5C,EAEGA,EACJ91E,EAAAA,cAAC4zE,EAAAA,GAAO1zE,EAAAA,EAAAA,GAAA,CACNiE,IAAKuxE,EAAU5kE,SACX/Q,EAAK,CACTia,MAAOja,EAAMia,MACb6I,QAASA,KAeb,OAZA2yD,GAAaxkB,IACX,GAAI4kB,EAAU,EAAG,CACf,MAAM/K,EAAY3+D,OAAO0H,YAAW,KAClCiP,IACA4yD,EAAc3kE,QAAU2kE,EAAc3kE,QAAQmB,QAC3C8jE,GAAeA,IAAelL,GAChC,GACA+K,GACHH,EAAc3kE,QAAU,IAAI2kE,EAAc3kE,QAAS+5D,EACrD,CACA,OAAO7Z,EAASztD,OAAOuyE,EAAQ,IAE1BjzD,CACT,EACA,MAAO,CACL/I,OACAq1C,WAAapvD,GAAU+Z,EAAK/Z,EAAO,GACpC,GACA,KAGHkO,EAAAA,EAAAA,YAAU,IACD,KACLwnE,EAAc3kE,QAAQ5M,SAASoa,IAC7BpS,OAAOkjB,aAAa9Q,EAAG,GACvB,GAEH,IAEH,MAAM03D,EACJh2E,EAAAA,cAACs1E,EAAiB,CAChB77D,MAAO,CAAE6I,SAAU8nD,EAAgB,gBAAahjD,IAE/C4pC,GAIL,OACEhxD,EAAAA,cAACq1E,EAAgB30B,SAAQ,CAACt8C,MAAOuxE,GAC9B70E,EACAspE,EACG4L,EACAC,EAAAA,aAAsBD,EAAoBnlC,SAAS52B,MAC9B,EAE7BkwD,EAAA9pE,aAAA,q6B,0EC7HK,MAAMk1E,EAAsBh1E,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,sBAAAC,YAAA,eAAVH,CAAU,6EAKzC2yE,EAAAA,G,0GCUG,MAAMt3B,EAAa57C,EAAAA,YAAiB,SAAmBY,EAE5D2xD,GACC,IAFC2jB,YAAaC,KAAoBp2E,GAAwBa,EAG3D,MAAMs1E,EACJC,IACCn2E,EAAAA,eAAqBD,EAAMe,WACG,iBAAxBf,EAAMe,SAAS4L,KACjB3M,EAAMe,SAAS4L,UAChB0a,IACJ,SACIhD,GAAMouC,EAAAA,EAAAA,GAAaD,IACnB,YAAE6jB,IAAgBC,EAAAA,EAAAA,GACtB,CACEH,iBACGn2E,GAELqkB,GAEIkyD,GAAWC,EAAAA,EAAAA,GAAex2E,IAC1B,UAAEojB,GAAcpjB,EAEtB,OAAOC,EAAAA,aACLD,EAAMe,UACN0e,EAAAA,EAAAA,GAAW82D,EAAUF,EAAa,CAAEjzD,YAAWiB,QAEnD,IAAGw3B,EAAAv7C,aAAA,wf,+HC5CI,MAAMm2E,EAAej2E,EAAAA,GAAO06C,MAA+B;;;;;;sBAM5Cr6C,IAAA,IAAC,MAAEgE,EAAK,SAAEozC,GAAUp3C,EAAA,OACtCo3C,EAAW,cAAgBpzC,EAAM0U,MAAM,yBAAyB;WACzD9L,IAAA,IAAC,MAAE5I,EAAK,SAAEozC,GAAUxqC,EAAA,OAC3BwqC,EACIpzC,EAAM0U,MAAM,uBACZ1U,EAAM0U,MACJ,oBACD;;MAEH7J,IAAA,IAAC,MAAE7K,EAAK,SAAEozC,GAAUvoC,EAAA,OACpBuoC,EACIpzC,EAAM0U,MAAM,8BACZ1U,EAAM0U,MAAM,0BAA0B;mBAC7BlJ,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACxBxL,EAAMR,MAAc,eAAiB,GAAK,CAAC;gBAChC0P,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACtBlP,EAAMR,MAAM,sBACP,SAAQQ,EAAMR,MAAM,uBAAyB,OAC5CQ,EAAM0U,MAAM,wBACX1U,EAAMK,KAAO,YAAc,eAE9B,EAAE;;;;;;;oBAOUuP,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,OACxB5P,EAAM0U,MAAM,4BAA6B,UAAU;;kBAEvC7E,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,MACrB,aAEC7P,EAAM0U,MAAM,yBACZ1U,EAAM0U,MACJ,oBACA,YAEF;;EAGKm9D,GAAsBl2E,EAAAA,EAAAA,IAAOi2E,EAAc;sBAClC7hE,IAAA,IAAC,MAAE/P,EAAK,SAAEozC,GAAUrjC,EAAA,OACrCqjC,GAAYpzC,EAAM0U,MAAM,iCAAkC,UAAU;WAC9DzE,IAAA,IAAC,MAAEjQ,EAAK,SAAEozC,GAAUnjC,EAAA,OAC1BmjC,GAAYpzC,EAAM0U,MAAM,4BAA4B;kBACvC8gB,IAAA,IAAC,MAAEx1B,EAAK,SAAEozC,GAAU5d,EAAA,OACjC4d,GAAYpzC,EAAM0U,MAAM,kCAAmC,UAAU;;;oBAGtDghB,IAAA,IAAC,MAAE11B,GAAO01B,EAAA,OACxB11B,EAAM0U,MAAM,oCAAqC,UAAU;;EAIpDo9D,GAAmBn2E,EAAAA,EAAAA,IAAOi2E,EAAc;;;;;;;iBCvBrD,MAAMG,EAA4D,CAChErpE,QAASmpE,EACT18D,KAAM28D,GA0BK5sD,EAAgC9pB,EAAAA,YAAiB,SAAeY,EAE3E2xD,GACC,IAFD,QAAExoC,EAAO,MAAEtQ,EAAK,UAAE07D,EAAS,SAAEloC,KAAaltC,GAAoBa,EAG9D,MAAMwjB,GAAMouC,EAAAA,EAAAA,GAAaD,IACnB,YAAE6jB,IAAgBC,EAAAA,EAAAA,GAAUt2E,EAAOqkB,GACnCkyD,GAAWC,EAAAA,EAAAA,GAAex2E,IAC1B,UAAEojB,EAAS,KAAE0K,GAAS9tB,EAEtBi1E,EAAajrD,GAAW4sD,EAAS5sD,IAAaysD,EACpD,OACEx2E,EAAAA,cAACg1E,GAAS90E,EAAAA,EAAAA,GAAA,IACJsf,EAAAA,EAAAA,GAAW82D,EAAUF,EAAa,CAAEjzD,YAAW0K,SAAO,CAC1DpU,MAAOA,EACP07D,UAAWA,EACX/wD,IAAKA,IAEJ6oB,EACCjtC,EAAAA,cAAC42E,EAAAA,EAAe,CACd3pC,SAAUA,EACVvhB,WAAY3rB,EAAM2rB,WAClBmrD,YAAa92E,EAAMqa,SAElBra,EAAMe,UAGTf,EAAMe,SAId,IAAGgpB,EAAAzpB,aAAA,i4F,0GCtFH,MAAMy2E,E,SAAoBv2E,GAAO+Z,GAAI;;;;EAc9B,SAAS63D,EAAYpyE,GAC1B,OACEC,EAAAA,cAACu4D,EAAAA,GAAU,KACTv4D,EAAAA,cAAC+2E,EAA4B,MACzBC,GACAh3E,EAAAA,cAAC82E,GAAsBt3D,EAAAA,EAAAA,GAAWzf,EAAOi3E,MAKnD,CAEA,SAASD,EAA4Bn2E,GAIjC,IAJkC,SACpCE,GAGDF,EACC,MAAMq2E,GAAeC,EAAAA,EAAAA,OACf,cAAEC,IAAkBC,EAAAA,EAAAA,GAAY,CACpC3S,UAAYv6D,IACV,KAAKmtE,EAAAA,EAAAA,GAAentE,GAAI,CACtB,GAAc,cAAVA,EAAE/F,IACJ,OAAO8yE,GAAcK,cAAc,CAAEC,MAAM,IACtC,GAAc,eAAVrtE,EAAE/F,IACX,OAAO8yE,GAAcO,UAAU,CAAED,MAAM,GAE3C,CACArtE,EAAEutE,qBAAqB,IAI3B,OAAOz3E,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,EAASq2E,GACrB,CAAChF,EAAA9xE,aAAA,0hB,oJC0BD,MAAMq3E,EAAqBn3E,EAAAA,GAAOw3C,KAAM;;;;EAMlC4/B,EAA0Bp3E,EAAAA,GAAOy+B,IAEpC;;WAEQp+B,IAAA,IAAC,MAAEgE,EAAK,WAAE8mB,GAAY9qB,EAAA,OAC7B8qB,EACI9mB,EAAM0U,MACJ,wBACA,WAIF1U,EAAM0U,MAAM,eAAe;EAG7B0/C,EAAcz4D,EAAAA,GAAOkV,KAAM;;;;;;;;;EAkBpB+X,EAAWhgB,IAMF,IANG,aACvBsgC,EAAY,UACZqnC,EAAS,0BACTyC,EAAyB,SACzB3qC,KACGltC,GACWyN,EACd,MAAMK,GAAQgqE,EAAAA,EAAAA,GAAe93E,GACvBqkB,EAAMpkB,EAAAA,OAA+B,OACrC,WAAEwkE,IAAesT,EAAAA,EAAAA,GAAY/3E,EAAO8N,EAAOuW,IAE3C,eAAE2zD,EAAc,UAAEC,EAAS,WAAEC,IAAeC,EAAAA,EAAAA,GAAa,CAC7D/0D,UAAWpjB,EAAMojB,YAGbg1D,EAGFrqC,EACA,CACEsqC,eAAiB37D,IACfA,EAAM0/B,kBACN1/B,EAAMgF,iBACFhF,EAAMrL,yBAAyB2/B,YACjCt0B,EAAMrL,cAAcoC,QAEpBiJ,EAAM3T,OAAOuvE,MACf,EAEFrkE,UAAW,GAEb,CAAC,EAEL,OACEhU,EAAAA,cAAC03E,EAAkB,CAACvC,UAAWA,GAC7Bn1E,EAAAA,cAACg5D,GAAW94D,EAAAA,EAAAA,GAAA,IACNsf,EAAAA,EAAAA,GAAWglD,EAAYyT,EAAYE,GAAmB,CAC1D/zD,IAAKA,KAEPpkB,EAAAA,cAACs4E,EAAAA,EAAY,CACXt0C,gBAAiBjkC,EAAMikC,gBACvBg0C,UAAWJ,EAA4BG,EAAiBC,EACxDxuD,WAAYzpB,EAAMikC,iBAAmBn2B,EAAM2b,WAC3CkC,WAAY3rB,EAAM2rB,WAClB,cAAY,OACZjS,MAAO,CACL8+D,cAAe,UAGlBx4E,EAAMe,UACLd,EAAAA,cAAC23E,EAAuB,CAACjsD,WAAY3rB,EAAM2rB,YACxCuhB,EACCjtC,EAAAA,cAAC42E,EAAAA,EAAe,CACd3pC,SAAUA,EACVvhB,WAAY3rB,EAAM2rB,WAClBmrD,YAAahpE,EAAM8zB,QAElB5hC,EAAMe,UAGTf,EAAMe,UAIO,EAEvB0sB,EAAAntB,aAAA,+xG,mFCxLK,MAAMi4E,EAAe13E,IAWrB,IAXsB,WAC3B8qB,EAAU,UACVssD,EAAS,gBACTh0C,EAAe,WACfxa,KACG0pC,GAMJtyD,EACC,OACEZ,EAAAA,cAACw4E,EAAAA,GAAOt4E,EAAAA,EAAAA,GAAA,GACFgzD,EAAU,CACdpmD,KAAM,GACNiN,KAAM,CACJ5U,KAAM6+B,EAAkB,wBAA0B,WAClDknC,UAAW,CACTuN,SAAU/sD,EACVgtD,SAAUlvD,GAAcwa,EACxB20C,QAASX,MAGb,EAEJM,EAAAj4E,aAAA,slB,gDCxBK,MAAMu4E,E,QACX54E,cAA8D,K,4FCAhE,MAAM64E,EACJ74E,EAAAA,cAAkE,MAEvD84E,EAGRl4E,IAA4B,IAA3B,SAAEE,EAAQ,QAAEmV,GAASrV,EACzB,MAAM4b,GAAU8M,EAAAA,EAAAA,YAAWsvD,EAAAA,GAC3B,IAAKp8D,EACH,MAAM,IAAInS,MACP,mMAIL,MAAMuF,EAAO4M,EAAQu8D,WAAWruE,QAAQuL,GAClC6tB,EAAOl0B,GAAMwQ,WAAa,GAMhC,OALK0jB,QAAkC1c,IAA1BxX,GAAM7P,MAAMqgB,WACvBtW,QAAQC,KACN,sIAIF/J,EAAAA,cAAC64E,EAAiCn4B,SAAQ,CACxCt8C,MAAO,CACL40E,kBAAmBx8D,EAAQqhC,QAAQrzC,IAAIyL,IAAY,KACnD6tB,KAAMA,IAGPhjC,EACyC,EAQnCmoB,EAAuB,SAAAzb,GAShC,IAT0C,UAC5CwnE,EAAY,QAQbxnE,EACC,MAAMyrE,EAAqBj5E,EAAAA,WAAiB64E,GAC5C,IAAKI,EACH,MAAM,IAAI5uE,MACR,wGAGJ,MAAM,kBAAE2uE,EAAiB,KAAEl1C,GAASm1C,EACpC,OACEj5E,EAAAA,cAACg1E,EAAS,KACPgE,EACCh5E,EAAAA,cAAC2zD,EAAAA,EAAkB,CAACD,WAAYslB,GAC7Bl1C,GAGHA,EAIR,EAAEg1C,EAAAz4E,aAAA,4EAAA4oB,EAAA5oB,aAAA,gmB,kGChEK,SAAS64E,EAA8Bt4E,GAiB1C,IAjB8C,WAChDm4E,EACAI,iBAAkBC,EAAqB,YACvCC,EAAW,eACXC,GAAiB,GAalB14E,EACC,MAAM,WAAEokD,EAAU,OAAEhoC,GAAWq8D,GAWzB,QAAEx7B,IAAYl6B,EAAAA,EAAAA,UAAQ,KAC1B,MAAMk6B,EAAwC,IAAI54B,IAclD,OAbIo0D,EAAYr8D,QAEd,IAAI+7D,EAAWQ,WACZ11E,KAAKM,GAAQ40E,EAAWruE,QAAQvG,KAChC8N,QAAOzE,IAAA,IAAC,KAAEd,GAAMc,EAAA,MAAc,SAATd,CAAe,IACpCxI,SAAS0L,IACR,MAAM4pE,GAAgB5kB,EAAAA,EAAAA,GAAehlD,EAAKwQ,UAAW4kC,GACjDw0B,GACF37B,EAAQlzC,IAAIiF,EAAKzL,IAAKq1E,EACxB,IAIC,CACL37B,UACD,GACA,CAACmH,EAAY+zB,EAAY/7D,IAEtBm8D,ECzDD,SACLM,EACA57B,GAEA,OAAO75C,OAAO0qE,OAAO+K,EAAyB,CAC5CC,UAAW,CACTt1E,MAAOA,KACL,GAAIy5C,EAAS,CAGX,MAAMhwC,EAAQ4rE,EAAwB5rE,MACtCA,EAAMia,gBACJ,IAAIhQ,IACF,IAAI+lC,EAAQ55C,QAAQgO,QAAQ9N,IAAS0J,EAAMqgD,aAAar0B,IAAI11B,MAGlE,MACEs1E,EAAwBC,WAC1B,IAIR,CDmC2BC,CACvBP,EACAp8D,EAAS6gC,EAAU,MAEf+7B,GAAen8D,EAAAA,EAAAA,GAAU,CAC7BogC,UACAs7B,mBACAJ,aACAO,mBA8BF,OAzBArrE,EAAAA,EAAAA,YAAU,KACR,MAAM,iBAAEkrE,EAAgB,QAAEt7B,EAAO,WAAEk7B,GAAea,EAAa9oE,QACzD+oE,EAAc,IAAIh8B,EAAQ55C,QAC1B61E,GAA+BD,EAAY/hD,MAAMiiD,GACrDZ,EAAiB3vD,WAAWuwD,KAE9B,IAAIC,EACAJ,EAAa9oE,QAAQwoE,iBACvBU,EAkDN,SAAqCn8B,GACnC,MAAO,IAAIA,EAAQ9sB,WAChB9e,QAAO7B,IAAA,IAAE,EAAG6pE,IAAY7pE,EAAA,OAA0B,IAArB6pE,GAAY10C,IAAU,IACnD9f,MACC,CAAA3R,EAAAU,KAAA,IAAE,EAAG0lE,IAAQpmE,GAAG,EAAGqmE,IAAQ3lE,EAAA,OACzB2lE,EAAO30C,GAAK20C,EAAO50C,KAAO20C,EAAO10C,GAAK00C,EAAO30C,IAAI,MACjD,KAAK,EACb,CAzDmB60C,CAA4Bv8B,KAEtCm8B,GAAcH,EAAYxpE,OAAS,GAAKypE,IAC3CE,EAuBN,SAAyBvqE,GAQhB,IARiB,WACxBspE,EAAU,iBACVI,EAAgB,YAChBU,GAKDpqE,EACK4qE,GAAuB,EAC3B,IAAK,MAAMl2E,KAAO40E,EAAWQ,UAI3B,GAHIp1E,IAAQg1E,EAAiBmB,mBAC3BD,GAAuB,GAErBA,GAAwBR,EAAYhrE,SAAS1K,GAC/C,OAAOA,EAGX,OAAO01E,EAAY,EACrB,CA1CmBU,CAAiB,CAC5BxB,aACAI,mBACAU,iBAGAG,IACFb,EAAiBvhB,cAAcoiB,GAC/Bb,EAAiBlzD,iBAAiB+zD,GACpC,GACC,CACDh1B,EACA40B,IAEK,CACL/7B,UACAs7B,mBAEJ,CE3DO,SAASqB,EAAwB55E,GAeoC,IAfhC,WAC1Cm4E,EAAU,iBACVI,EAAgB,uBAChB1zB,EAAsB,iBACtBg1B,EAAgB,eAChBnB,EAAc,IACdl1D,KACGs2D,GAQ6C95E,EAChD,MAAMy4E,GAAcsB,EAAAA,EAAAA,GAAoBD,IAElC,QAAE78B,EAASs7B,iBAAkByB,GACjC1B,EAA+B,CAC7BH,aACAI,mBACAE,cACAC,oBAEE,eAAEt4D,IAAmB65D,EAAAA,EAAAA,GACzB,CAAEp1B,0BACF4zB,EACAj1D,GAEI02D,GAA8Bn3D,EAAAA,EAAAA,UAClC,IChEG,SACLo3D,EACAl9B,GAIA,MAAMm9B,EAAiBA,CACrBC,EACAC,KAEA,IAAIC,EAA2CF,EAC/C,KAAqB,MAAdE,GAAoB,CACzB,IAAKt9B,GAAWA,EAAQhkB,IAAIshD,GAC1B,OAAOA,EAETA,EACgB,OAAdD,EACIH,EAAwBK,cAAcD,GACtCJ,EAAwBM,cAAcF,EAC9C,CACA,OAAOA,QAAc/zD,CAAS,EAEhC,OAAOpjB,OAAO0qE,OAAOqM,EAAyB,CAC5CM,YAAa,CACXj3E,MAAQD,GACN62E,EAAeD,EAAwBM,cAAcl3E,GAAM,SAE/Di3E,YAAa,CACXh3E,MAAQD,GACN62E,EAAeD,EAAwBK,cAAcj3E,GAAM,OAE/Dm3E,YAAa,CACXl3E,MAAOA,CAACD,EAAiBo3E,KACvB,MAAMC,EAAWR,EACfD,EAAwBO,cAAcn3E,EAAKo3E,GAC3C,QAEF,OAAmB,MAAZC,EAAmB39B,GAAS95C,SAASquD,OAAOhuD,MAAQo3E,CAAQ,GAGvEC,WAAY,CACVr3E,MAAOA,CAACD,EAAiBo3E,KACvB,MAAMG,EAAUV,EACdD,EAAwBU,aAAat3E,EAAKo3E,GAC1C,QAEF,OAAkB,MAAXG,EACH,IAAK79B,GAAS55C,QAAU,IAAKjB,OAAS,KACtC04E,CAAO,IAInB,CDaMC,CACElB,EACApB,EAAYr8D,OAAS6gC,EAAU,OAEnC,CAACw7B,EAAYr8D,OAAQy9D,EAAkB58B,IAInC+9B,EAA0B,CAAE/9B,UAASk7B,cAE3C,MAAO,CACL/3D,iBACAm4D,iBAAkByB,EAClBH,iBAAkBK,EAClBzB,YAAa,IACRA,EACHx7B,WAEFg+B,iBAAkB,CAChB7+D,OAAQq8D,EAAYr8D,OACpBuqB,MAAOsW,EAAQ/wC,KAAO,EACtBhM,SAAUu4E,EAAYr0B,YAExB42B,0BAEJ,C,wDE9EO,MAAMv0D,EAAYy0D,WAAAA,GAAA,KAEvB33E,IAAM,WAAakjB,EAAY00D,KAAM,CACrC,MAAIz9D,GACF,OAAO09D,KAAK73E,GACd,EAGF,SAASq5C,EAAO58C,GAAkC,MAAjBA,EAE/B,OAAO,IACT,CAXaymB,EACI00D,IAAM,EAYvB,IAAIE,EAAWz+B,EAGfA,EAAQ0+B,kBAAoB,UAC1Bn8E,QAIM,CACJ2M,KAAM,UACN6b,QAAS,KACTxoB,MAAOA,EACP8/B,SANa,KAObs8C,eAAe,EAEnB,C,+DCxCA,SAASt8D,EAAQ9f,GACf,OAAO,IACT,CAKA,IAAIq8E,EAAQv8D,EAMZA,EAAKq8D,kBAAoB,UACvBn8E,EACAyc,GAEA,MAGMlE,EAFJ+jE,EAAAA,EACAH,kBAAkBn8E,EAAOyc,GACE41C,OAAOhuD,MAC9Bk4E,EAA2BhkE,EAAOikE,iBACxCjkE,EAAOikE,iBAAoB//D,GACzB8/D,IAA2B9/D,IAAYA,EAAQggE,kBAC3ClkE,CACR,C,8FC9BA,MAAMmkE,EAAM,YACNlpB,EAAmBhzD,EAAAA,GAAO+Z,GAAI;;;;SAI3BmiE;EAGHC,EAAan8E,EAAAA,GAAOy+B,IAA0B;;WAEzCp+B,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACjBgE,EAAM+U,uBAAuB/U,EAAM8V,aAAag1B,kBAAkB;;eAEvDliC,IAAA,IAAC,MAAEw9C,GAAOx9C,EAAA,OAAKw9C,GAAS,OAAO;EAGxC2xB,EAAcp8E,EAAAA,GAAOy+B,KAAKzkB,MAAM,CACpCwhC,KAAM,gBACL;;;;SAIM0gC;EAkBI1zD,EACXhpB,GAGEC,EAAAA,cAACuzD,GAAgBrzD,EAAAA,EAAAA,GAAA,CACT,CAACmvE,EAAAA,IAAsC,GACzCtvE,IAUVgpB,EAAWG,KAAOwzD,EAOlB3zD,EAAW27B,MAAQi4B,EAAY5zD,EAAA1oB,aAAA,srB,gDCrDxB,MAAMkpB,E,QACXvpB,cAAiD,K,uECP5C,SAAS48E,EAAuBh8E,EAErCwjB,GACC,IAFD,cAAEy4D,EAAa,iBAAE1D,GAA6Cv4E,GAK9DqN,EAAAA,EAAAA,YAAU,KACR,IAAK4uE,GAAiB1D,EAAiB2D,YAAc14D,GAAKtT,QAAS,CACjE,IAAIyX,EAAUnE,EAAItT,QAAQ0X,cACvB,cAAa2wD,EAAiB2D,gBAE7Bv0D,IACFw0D,EAAAA,EAAAA,GAAe34D,EAAItT,QAASyX,EAEhC,IACC,CAACs0D,EAAez4D,EAAK+0D,EAAiB2D,YAC3C,C,8DCwBO,MAAME,EAA0Bp8E,IAehC,IAfoC,MACzCiN,EAAK,cACLy3C,EAAa,cACbyd,EAAa,SACbnjD,GAWDhf,GAGCqN,EAAAA,EAAAA,YACE,KACE,MAAMgvE,EAAQ33B,GAAex0C,QAC7B,GAAImsE,EAAO,CACT,MAAMxY,EAAahoD,IACC,YAAdA,EAAMtY,KAAmC,cAAdsY,EAAMtY,KACnCsY,EAAMgF,iBACNhF,EAAM0/B,kBAEN4mB,EAAcjyD,SAASosE,cACrB,IAAIC,cAAc1gE,EAAM/P,KAAM+P,KAGlB,UAAdA,EAAMtY,KACgC,MAAtC0J,EAAMsrE,kBAAkB2D,aAExBrgE,EAAMgF,iBACLhF,EAAMvL,eAA+Bq8D,iBACpC,SACC9wD,IACC3S,QAAQiB,IACN,QACA0R,EAAMtY,IACN0J,EAAMsrE,iBAAiB2D,WACvB,WACAl9D,GAGc,UAAdnD,EAAMtY,KAC+B,MAArC0J,EAAMsrE,iBAAiB2D,YAEvBl9D,IAAW/R,EAAMsrE,iBAAiB2D,WACpC,GAEF,CAAEtP,MAAM,EAAMC,SAAS,IAE3B,EAGF,OADAwP,EAAM1P,iBAAiB,UAAW9I,GAC3B,KACLwY,EAAMG,oBAAoB,UAAW3Y,EAAU,CAEnD,IAGH,C,gOC/BH,MAAM4Y,GAA0B98E,EAAAA,EAAAA,IAAO8Z,EAAAA,EAAiB;;WAE7CzZ,IAAA,IAAC,MAAEgE,EAAK,SAAEozC,GAAUp3C,EAAA,OAC3Bo3C,EACIpzC,EAAM0U,MACJ,gCAEF1U,EAAM0U,MACJ,uBACD;EAEHgkE,EAAsB/8E,EAAAA,GAAOkV,KAAM;;;;;;aAM5BjI,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACnB5I,EAAM24E,MAAM,qBAAuB,iBAAiB;;EAIlDviC,EAAuBz6C,EAAAA,GAAO06C,MAAO;;;;gBAI3BxrC,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAM0U,MAAM,kCAAkC;;;;;;2BAMlDlJ,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OAAKxL,EAAM8V,aAAaooB,QAAQ;;;;;;;;;;;;;;;;EAwBxDmkC,GAAWuW,EAAAA,EAAAA,aACtB,CAAA1pE,EAgBEy+C,KACuB,IAhBvB,eACE1F,EAAc,MACdpzC,EAAK,UACL07D,EAAS,MACT/wE,EAAK,aACLoK,EAAY,cACZ04D,EAAa,gBACbta,EAAe,kBACfE,EAAiB,YACjB2wB,EAAW,qBACXC,EAAoB,WACpBlZ,EACAphB,SAAUu6B,KACP59E,GACc+T,EAGnB,MAAMsQ,GAAMouC,EAAAA,EAAAA,GAAaD,GACnBqrB,GAAY/sE,EAAAA,EAAAA,QAA0B,MACtCuyC,GAAWoP,EAAAA,EAAAA,GAAamrB,GACxBE,GAAuBhtE,EAAAA,EAAAA,QAAuB,MAC9CitE,GAAajtE,EAAAA,EAAAA,QAAuB,MACpCktE,GAAaltE,EAAAA,EAAAA,QAAuB,MACpCmtE,EAAYjxB,QAAQH,IAAwC,UAApBA,EAExC/+C,GAAQowE,EAAAA,EAAAA,GAAiB,CAG7BC,YAAa,SACbC,mBAAmB,EACnBC,WAAYh6E,EACZi6E,kBAAmB7vE,EACnB8vE,cAAepX,EACf8W,eACGj+E,KAEC,iBACJw+E,EAAgB,kBAChBC,EAAiB,WACjBC,EACAja,WAAYka,EAAkB,aAC9BC,EAAY,YACZvI,IACEwI,EAAAA,EAAAA,GACF,IACK7+E,EACHo+E,mBAAmB,EACnBP,YACAx6B,WACA06B,aACAC,cAEFlwE,GAKIif,EAAW+wD,EAAqB/sE,QAClC+sE,EAAqB/sE,SAASmxD,YAAc,OAC5C76C,EACJ,OACEpnB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC6+E,EAAAA,EAAS,CACRz6D,IAAKA,EACLsH,WAAY3rB,EAAM2rB,WAClBqsB,MAAOh4C,EAAMg4C,MACb8U,eAAgBA,EAChB4xB,WAAYA,EACZtJ,UAAWA,EACX17D,MAAOA,GAGPzZ,EAAAA,cAAC8+E,EAAAA,EAAqB,CACpBrB,YAAaA,EACbC,qBAAsBA,EACtBa,iBAAkBA,GAElBv+E,EAAAA,cAACq9E,EAAuB,CACtBj5D,IAAKy5D,EACLjxB,gBAAiBA,EACjB5U,SAAUj4C,EAAM2rB,WAChBypD,UAAWtnE,EAAMmqE,UAAY,WAAa,IAG1Ch4E,EAAAA,cAACq2C,EAAAA,EAAwB,CACvBC,UAAU,MACVyoC,aAAW,EACXrzD,YAAaohC,EACbkyB,WAAY57B,EACZ5iC,QACExgB,EAAAA,cAACy5D,EAAAA,EAAiB,CAChB/sD,KACsB,UAApBkgD,EAA8BA,OAAkBxlC,GAGlDpnB,EAAAA,cAAA,MAASw+E,EAAoB1xB,IAGjCjN,MAAO,IAELE,GACA//C,EAAAA,cAACs9E,GACK99D,EAAAA,EAAAA,GACFk/D,EACAla,EACAzkB,MAMR//C,EAAAA,cAAC47C,EAAAA,GAAU17C,EAAAA,EAAAA,GAAA,GAAKk2E,EAAW,CAAEhyD,IAAKw5D,IAChC59E,EAAAA,cAACg7C,EAAoB,KACnBh7C,EAAAA,cAACi/E,EAAAA,EAAuB,CACtBjnC,SAAUj4C,EAAM2rB,WAChB5e,KAAM,GACNiN,KAAK,+BAOhBlM,EAAM0pB,QACLv3B,EAAAA,cAACk/E,EAAAA,EAAO,CACN96D,IAAK05D,EACLjwE,MAAOA,EACPmxE,WAAYnB,EACZvnC,UAAU,eACV6oC,iBAAkB,EAClB5lB,OAAQ,EACRC,aAAc,GAEdx5D,EAAAA,cAACo/E,EAAAA,GAAgBl/E,EAAAA,EAAAA,GAAA,GACXy+E,EAAY,CAChBv6D,IAAK25D,EACLlwE,MAAOA,EACP4L,MAAO,CAAEqT,gBAId,IAGPm6C,EAAA5mE,aAAA,8oD,8FC3QK,MAAMiiE,EAAUtiE,EAAAA,YAAiB,SAAgBY,EAEtD2xD,GACC,IAFD,SAAEzlC,KAAa/sB,GAAwBa,EAGvC,MAAMiN,GAAQwxE,EAAAA,EAAAA,GAAa,CACzBC,kBAAmB,SACnBz2D,cAAe,YACZ9oB,IAGL,OAAOC,EAAAA,cAACo/E,EAAAA,GAAgBl/E,EAAAA,EAAAA,GAAA,CAAC2N,MAAOA,EAAOuW,IAAKmuC,GAAkBxyD,GAChE,IAAGuiE,EAAAjiE,aAAA,uL,sLCEI,MAAM++E,EAAmBp/E,EAAAA,YAAiB,SAAyBY,EAUxE2xD,GACC,IARD,MACE1kD,EAAK,MACL4L,EAAK,UACL07D,EAAS,cACT7vB,KACGvlD,GACsBa,EAG3B,MAAMwjB,GAAMouC,EAAAA,EAAAA,GAAaD,IACnB,aAAEosB,EAAY,WAAEF,IAAec,EAAAA,EAAAA,GAAWx/E,EAAO8N,EAAOuW,GAS9D,OAPA44D,EAAAA,EAAAA,GAAwB,CACtBnvE,QACAk1D,cAAe3+C,EACfkhC,gBACA1lC,SAAU7f,EAAM6f,WAIhB5f,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,MAASy+E,EAAa1+E,EAAMg4C,OAC5B/3C,EAAAA,cAACw/E,EAAAA,GAAUt/E,EAAAA,EAAAA,GAAA,GACLy+E,EAAY,CAChBv6D,IAAKA,EACL3K,MAAOA,EACP07D,UAAWA,IAEV,IAAItnE,EAAMkrE,YAAYl1E,KAAK+L,GACZ,YAAdA,EAAKlD,KACH1M,EAAAA,cAACy/E,EAAc,CAACt7E,IAAKyL,EAAKzL,IAAKu7E,QAAS9vE,EAAM/B,MAAOA,IAErD7N,EAAAA,cAAC2/E,EAAM,CAACx7E,IAAKyL,EAAKzL,IAAKyL,KAAMA,EAAM/B,MAAOA,OAMtD,IACA,SAAS8xE,EAAMnyE,GAMX,IAN8B,KAChCoC,EAAI,MACJ/B,GAIDL,EACC,MAAM4W,EAAMpkB,EAAAA,OAA6B,OACnC,YAAE4/E,IAAgBC,EAAAA,EAAAA,GAAU,CAAE17E,IAAKyL,EAAKzL,KAAO0J,EAAOuW,GAEtDsH,EAAa7d,EAAMqgD,aAAar0B,IAAIjqB,EAAKzL,KACzCqlB,EAAa3b,EAAMsrE,iBAAiB2D,aAAeltE,EAAKzL,IAC9D,OACEnE,EAAAA,cAACupB,EAAAA,EAAiBm3B,SAAQ,CACxBt8C,MAAO,CACLsnB,aACAjC,mBAAoB5b,EAAMsrE,iBAAiBnB,UAC3CxuD,aACApE,KAAMxV,IAGR5P,EAAAA,cAACmgD,EAAAA,GAAcjgD,EAAAA,EAAAA,GAAA,GACT0/E,EAAW,CACfx7D,IAAKA,EACL4zB,SAAUtsB,EACVqqC,SAAUvsC,EACVs2D,kBAAgB,IAEflwE,EAAKiwB,UAId,CAEA,MAAMkgD,EAAuBx/E,EAAAA,GAAO+Z,GAAI;;;WAG7B7K,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAM8V,aAAag1B,iBAAiB;EAGxDswC,EAAgBz/E,EAAAA,GAAO+Z,GAAI;;;;EAMjC,SAASmlE,EAAcrvE,GAMnB,IANsC,QACxCsvE,EAAO,MACP7xE,GAIDuC,GACK,UAAE6vE,EAAS,aAAEC,EAAY,WAAEC,IAAeC,EAAAA,EAAAA,GAAkB,CAC9D1f,QAASgf,EAAQ7/C,SACjB,aAAc6/C,EAAQ,gBAMxB,OACE1/E,EAAAA,cAAAA,EAAAA,SAAA,KACG0/E,EAAQv7E,MAAQ0J,EAAMkrE,WAAWuC,eAChCt7E,EAAAA,cAACqqD,EAAAA,GAAuB,CAACtO,KAAK,iBAEhC/7C,EAAAA,cAAA,KAAQigF,EACLP,EAAQ7/C,UACP7/B,EAAAA,cAAC+/E,EAAyBG,EACvBR,EAAQ7/C,UAGb7/B,EAAAA,cAACggF,EAAkBG,EAChB,IACKtyE,EAAMkrE,WAAWxlD,cAAcmsD,EAAQv7E,MACzCu7E,EAAQW,YACVx8E,KAAKuhB,GACLplB,EAAAA,cAAC2/E,EAAM,CAACx7E,IAAKihB,EAAKjhB,IAAKyL,KAAMwV,EAAMvX,MAAOA,QAMtD,CAACuxE,EAAA/+E,aAAA,mW,gDCvJM,MAAMga,E,SAAkB9Z,GAAO+Z,GAGnC;;;;;;gBAMa1Z,IAAA,IAAC,MAAEgE,EAAK,SAAEozC,GAAUp3C,EAAA,OAChCo3C,EACIpzC,EAAM0U,MAAM,+BACZ1U,EAAM0U,MAAM,sBAAsB;WAC/B9L,IAAA,IAAC,MAAE5I,EAAK,SAAEozC,GAAUxqC,EAAA,OAC3BwqC,EACIpzC,EAAM0U,MAAM,+BACZ1U,EAAM0U,MACJ,sBACD;;MAEH7J,IAAA,IAAC,MAAE7K,EAAK,SAAEozC,EAAQ,gBAAE4U,GAAiBn9C,EAAA,OACrC7K,EAAM8V,aAAaooB,OAAO,CACxBkV,WACA4U,mBACA;;;;MAIFx8C,IAAA,IAAC,MAAExL,EAAK,gBAAEgoD,GAAiBx8C,EAAA,OAC3BxL,EAAM8V,aAAawgC,UAAU,CAC3B0R,kBACAzR,SAAS,GACT;;;oBAGYrnC,IAAA,IAAC,MAAElP,EAAK,gBAAEgoD,GAAiB94C,EAAA,OACzClP,EAAM8V,aAAaooB,OAAO,CACxBqY,SAAS,EACTyR,mBACA;;;QAGAp4C,IAAA,IAAC,MAAE5P,EAAK,gBAAEgoD,GAAiBp4C,EAAA,OAC3B5P,EAAM8V,aAAawgC,UAAU,CAC3B0R,kBACAzR,SAAS,GACT;;;mBAGS1mC,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,OAAK7P,EAAM07E,aAAahzE,OAAO;gECjDrD,MAAM2xE,GAA0B1+E,E,SAAAA,IAAOme,EAAAA,IAAcnE,MAEzD,CACD,cAAe,QACd;;;;;;;;YAQS3Z,IAAA,IAAC,MAAEgE,EAAK,SAAEozC,GAAUp3C,EAAA,OAC1Bo3C,EACIpzC,EAAM0U,MAAM,0CACZ1U,EAAM0U,MAAM,iCAAiC;;0ECGvD,MAAMinE,EAAoBhgF,EAAAA,GAAO+Z,GAAI;WAC1B1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAa8lE,qBAAqB;EAG5DC,EAA2BlgF,EAAAA,GAAO+Z,GAErC;;;;;;IAMC9M,IAAA,IAAC,UAAE8oC,GAAW9oC,EAAA,MACA,UAAd8oC,GACA90C,EAAAA,EAAI;;;;KAIH;;EAQQs9E,EAAwBrvE,IAYX,IAZY,SACpC3O,EAAQ,iBACRy9E,EAAgB,qBAChBb,EAAoB,YACpBD,GAQkBhuE,EAClB,OACEzP,EAAAA,cAACygF,EAAwB,CAACnqC,UAAWonC,GAClC58E,EACA28E,GACCz9E,EAAAA,cAACugF,EAAsBhC,EACpBd,GAGoB,EAE7BqB,EAAAz+E,aAAA,mgC,0FCzDF,MAAMqgF,EAAuBngF,EAAAA,GAAO+Z,GAEjC;;oBAEiB1Z,IAAA,IAAC,eAAEisD,GAAgBjsD,EAAA,MAChB,UAAnBisD,EAA6B,SAAW,KAAK;;;EAK3C8zB,EAAcpgF,EAAAA,GAAOw3C,KAAgC;WAChDvqC,IAAA,IAAC,MAAE5I,EAAO8mB,WAAYssB,GAAUxqC,EAAA,OACvC5I,EAAM8V,aAAaq9B,MAAM,CAAEC,YAAW;;;EAS7B6mC,GAAYrB,EAAAA,EAAAA,aAAW,SAAkB/tE,EAcpD8iD,GACC,IAdD,MACExa,EAAK,eACL8U,EAAc,WACd4xB,EAAU,SACV39E,EAAQ,WACR4qB,KACG3rB,GAMY0P,EAGjB,MAAMmxE,EAAW5gF,EAAAA,OAA+B,MAEhD,OAgBF,SAAyBoQ,GAMrB,IANsB,IACxBgU,EAAG,QACHte,GAIDsK,EACC,MAAM,gBAAEywE,EAAe,YAAEC,IAAgBx3D,EAAAA,EAAAA,YAAWy3D,IACpD77E,EAAAA,EAAAA,kBAAgB,KACd,MAAM87E,EAAQA,KACZ,MAAM10D,EAAQlI,EAAItT,SAASmxD,YAC3B,QAAI31C,IACFu0D,EAAgBv0D,IACT,EAEG,EAGT00D,KACHptE,WAAWotE,EAAO,EACpB,KAGF/yE,EAAAA,EAAAA,YAAU,KACJmW,EAAItT,UACNsT,EAAItT,QAAQ2I,MAAM6S,MAChBw0D,GAAeh7E,EAAW,GAAEg7E,MAAkB,GAClD,GACC,CAACA,EAAah7E,GACnB,CA9CEm7E,CAAiB,CAAE78D,IAAKw8D,EAAU96E,QAA4B,UAAnB+mD,IAEzC7sD,EAAAA,cAAC0gF,GAAoBxgF,EAAAA,EAAAA,GAAA,GACfH,EAAK,CACT8sD,eAAgBA,EAChBzoC,IAAKmuC,IAEJxa,GACC/3C,EAAAA,cAAC2gF,GAAWzgF,EAAAA,EAAAA,GAAA,GAAKu+E,EAAU,CAAE/yD,WAAYA,EAAYtH,IAAKw8D,IACvD7oC,GAGJj3C,EAGP,IAiCA,MAAMigF,EAAwB/gF,EAAAA,cAG3B,CAAE8gF,YAAa,KAAMD,gBAAiBA,SAclC,SAASja,EAAgC9yD,GAI5C,IAJ6C,SAC/ChT,GAGDgT,EACC,MAAOgtE,EAAaI,GAAkBlhF,EAAAA,SAA8B,MASpE,OACEA,EAAAA,cAAC+gF,EAAsBrgC,SAAQ,CAACt8C,MAAO,CAAE08E,cAAaD,gBAR/Bv0D,IACvB40D,GAAgBC,GACd70D,GAAS60D,GAAgB,GACrB70D,EAAQ,EACR60D,GACL,IAIErgF,EAGP,CAAC+9E,EAAAx+E,aAAA,gtBAAAumE,EAAAvmE,aAAA,2lB,sGCnIM,MAAMijD,EAAuB/iD,EAAAA,GAAOy+B,IAExC;IACCp+B,IAAA,IAAC,uBAAEw7C,GAAwBx7C,EAAA,OAC3Bw7C,EACK,GAAEA,MACH,EAAE;;;;IAIN5uC,IAAA,IAAC,uBAAE4uC,GAAwB5uC,EAAA,OAC3B4uC,EAA0B,GAAEA,YAAmC,SAAS;;;;;;;;;EAWtEglC,GAA2B7gF,EAAAA,EAAAA,IAAO+iD,EAAsB;;EAkCjD/H,EAAwBv7C,EAAAA,YACnC,SAA8ByP,EAY5B2U,GACC,IAZD,UACEy3B,EAAS,uBACTO,KACGr8C,GAOJ0P,EAGD,MAAM0lE,EAAa,QAAOp1E,EAAMo1E,WAAa,KAC7C,OACEn1E,EAAAA,cAACohF,EAAwB,CACvBh9D,IAAKA,EACLg4B,uBAAwBA,GAExBp8C,EAAAA,cAAC0e,EAAAA,IAAYxe,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEo1E,UAAWA,KACpCn1E,EAAAA,cAAC0e,EAAAA,IAAYxe,EAAAA,EAAAA,GAAA,GACPH,EAAK,CACTo1E,UAAWA,EACXp7D,KAAM8hC,IAAawlC,EAAAA,EAAAA,IAAUthF,EAAMga,KAAM,SACzC,mBAIR,IACAwhC,EAAAl7C,aAAA,y6C,oHC/DF,MAAMihF,EAAmB,iCA2BzB,SAASC,EACPC,EACAC,GAEA,MAAM78E,GAAQC,EAAAA,EAAAA,MACR68E,EAAgBD,GAAa78E,EAAMR,MAAMq9E,GAC/C,GAAIC,EACF,OAAOA,EAET,MAAM,UAAExW,EAAY,CAAC,EAAC,KAAE/lE,GACI,iBAAnBq8E,EACH,CAAEr8E,KAAMq8E,GACRA,EACN,OArCF,SACE58E,EACAO,EACA+lE,GAkBA,YAlBwB,IAAxBA,IAAAA,EAA2B,CAAC,GAkBpB,GAhBYoW,IAClB18E,EAAMwe,iBAAmB,WAAa,cAenBje,IAZnB,CAAC,WAAY,WAAY,UAAW,UAAW,YAI9C8M,QAAQo6D,IAEPnB,EAAUuN,WAAY,CAAC,UAAW,WAAW5pE,SAASw9D,KAEvD75C,QACC,CAAC2Y,EAAOkhC,IAAalhC,GAAS+/B,EAAUmB,GAAYA,EAAW,KAC/D,SAGN,CAeSsV,CAAa/8E,EAAOO,EAAM+lE,EACnC,CAEO,MAAMsN,EAAUx4E,EAAAA,YACrB,CAAAY,EAEE2xD,KACI,IAFJ,UAAEkvB,EAAS,KAAE1nE,EAAI,KAAEjN,KAAS/M,GAAuBa,EAGnD,MAAMghF,EAAmBL,EAAYxnE,EAAM0nE,GAErCr9D,GAAMy9D,EAAAA,EAAAA,GAAgBtvB,GAE5B,OADAuvB,EAAAA,EAAAA,GAAW,CAAE3+E,KAAO,8BAA6By+E,KAAsBx9D,GAChEpkB,EAAAA,cAACszD,EAAAA,GAAiBpzD,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,EAAKtX,KAAMA,IAAQ,IAE/D0rE,EAAAn4E,aAAA,mnB,8HC9DK,MAAMghF,EAAYA,CAACU,EAAwBC,KAChD,MAAO78E,EAAM88E,GAAOF,EAAeh/E,MAAM,KACzC,MAAQ,GAAEoC,IAAO68E,IAAYC,EAAO,IAAGA,IAAQ,IAAI,EAQ/CC,EAAuBnyE,GAC3BA,EAAaua,WAAW,KACpBva,EAAamC,MAAM,GAClB,sBAAqBnC,IAUf2O,EAAe1e,EAAAA,YAC1B,CAAAY,EAEE2xD,KACI,IAFJ,KAAEx4C,EAAI,SAAEooE,KAAapiF,GAA0Ba,EAG/C,MAAMwjB,GAAMy9D,EAAAA,EAAAA,GAAgBtvB,GAEtB0iB,GADQpwE,EAAAA,EAAAA,MACSI,KAzBAm9E,EAACj/E,EAAck/E,KACxC,MAAOl9E,EAAM88E,GAAO9+E,EAAKJ,MAAM,KAC/B,OAAOs/E,GAAa,GAAEl9E,SAAY88E,EAAO,IAAGA,IAAQ,IAAI,EAuBxBG,CAAYroE,EAAMooE,GAAYpoE,EAS5D,OARA+nE,EAAAA,EAAAA,GACE,CACE3+E,KAAM++E,EAAoBjN,GAC1BqN,aAAcJ,EAAoBnoE,IAEpCqK,GAGKpkB,EAAAA,cAACszD,EAAAA,GAAiBpzD,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,IAAO,IAEnD1F,EAAAre,aAAA,mxB,+DC1DF,MAAMkiF,EAA8B,GAEvBjvB,EAAoB/yD,EAAAA,GAAOy+B,IAIrC;;;;;;WAMQp+B,IAAA,IAAC,KAAEkM,EAAOy1E,GAAmB3hF,EAAA,MAAM,GAAEkM,KAAQ;YAC5CU,IAAA,IAAC,KAAEV,EAAOy1E,GAAmB/0E,EAAA,MAAM,GAAEV,KAAQ;;YAE7C2C,IAAA,IAAC,KAAEssC,GAAMtsC,EAAA,MAAe,WAATssC,EAAoB,eAAY30B,CAAS;qFCd7D,SAAS06D,EAAUlhF,EAQxBwjB,GACC,IARD,KAAEjhB,EAAI,aAAEm/E,GAAuD1hF,EAS/D,MAAMgE,GAAQC,EAAAA,EAAAA,MACR29E,GAAYl5D,EAAAA,EAAAA,YAAWC,EAAAA,GACvBwsC,EAAWysB,GAAWh5D,YAAcg5D,GAAW/4D,oBACrDxb,EAAAA,EAAAA,YAAU,KACR,IAAI81D,GAAW,EAoCf,MAnCkBj9D,WAChB,IAAK3D,EAEH,YADA2G,QAAQ4D,MAAM,sBAGZ0W,EAAItT,UAENsT,EAAItT,QAAQ2xE,SAAW,QAEzB,MAAMrrC,QAAYxyC,EACf89E,WAAWv/E,EAAM4yD,GACjB9rD,OAAOC,IACN,GAAIo4E,EACF,OAAO19E,EAAM89E,WAAWJ,EAAcvsB,GAExC,MAAM7rD,CAAC,IAERu6B,SAAQ,KACHrgB,GAAKtT,UAAYizD,IACnB3/C,EAAItT,QAAQ2xE,SAAW,QACzB,IAEJ,GAAIrrC,EAAK,CACP,MAAM7uB,EAAUnE,GAAKtT,QACrB,IAAKizD,GAAYx7C,EAAS,CACxBA,EAAQC,cAAc,QAAQiW,SAC9B,MAAMkkD,EAAa9xC,SAAS2wB,cAAc,OAC1Cj5C,EAAQw5C,YAAY4gB,GACpBA,EAAWC,UAkBrB,SAAuBxrC,GACrB,MAAMyrC,GAAiC,IAAhBxuE,KAAK89C,UAAiB2wB,QAAQ,GAC/CC,EAAY3rC,EAAI4rC,SAAS,eAC/B,MAAO,IAAID,GAAWvwD,QAAO,CAACywD,EAAWz1E,KAAe,IAAZuG,EAAGuK,GAAG9Q,EAChD,MAAM4rC,EAAS,GAAE96B,KAAMukE,IACvB,OAAOK,EACJ,OAAM5kE,KACN,OAAM86B,KACP8pC,EAAY,QAAO5kE,KAAQ,QAAO86B,KAAU6pC,GAC7C,GACA7rC,EACL,CA7BiC+rC,CAAc/rC,EACvC,CACF,MACEttC,QAAQ4D,MAAM,0BAA2BvK,EAC3C,EAEFigF,GAAYn5E,MAAMH,QAAQ4D,OACnB,KACLq2D,GAAW,CAAI,CAChB,GACA,CAAC5gE,EAAM4yD,GACZ,CAoBA,SAASmtB,EAAWG,EAAgBC,EAAgBnc,GAClD,MAAMoc,EAAWpc,EAAI/hE,QAAQi+E,EAAQC,GAC/BE,EAAgBD,EAASn+E,QAAQi+E,EAAQC,GAC/C,OAAIC,IAAaC,EACRD,EAEFL,EAAWG,EAAQC,EAAQE,EACpC,C,2JC5DO,MAAMC,EAA8B,GAC9BC,EAA6B,GAE7BhN,EAAmBn2E,EAAAA,GAAO06C,MAA4B;;;;;;;;;gBASnDr6C,IAAA,IAAC,QAAE+iF,GAAS/iF,EAAA,MAAM,GAAE+iF,KAAW;eAChCn2E,IAAA,IAAC,QAAEm2E,GAASn2E,EAAA,MAAM,GAAEm2E,KAAW;;;;;;;kBAO5Bl0E,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACtB7K,EAAM0U,MAAM,+BAAgC,UAAU;oBACxClJ,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACxBxL,EAAM0U,MAAM,gCAAiC,UAAU;;;;kBAI3CxF,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACtBlP,EAAM0U,MAAM,iCAAkC,UAAU;oBAC1C9E,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,OACxB5P,EAAM0U,MACJ,kCACA1U,EAAMK,KAAO,UAAY,UAC1B;;;;kBAIWwP,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,OACtB7P,EAAM0U,MAAM,iCAAkC,UAAU;oBAC1C3E,IAAA,IAAC,MAAE/P,GAAO+P,EAAA,OACxB/P,EAAM0U,MAAM,kCAAmC,UAAU;;EAQlD2oB,EAAajiC,EAAAA,YAAiB,SAAmB6U,EAe5D09C,GACC,IAfD,QACEoxB,EAAUF,EAA2B,oBACrCz2C,GAAsB,EAAI,oBAC1BuW,GAAsB,EACtBrhB,UAAW0hD,EAAc,WACzBl4D,EAAU,QACVtR,EAAO,cACPypE,EAAa,WACbC,EAAU,aACVC,EAAY,UACZC,EAAS,0BACTC,KACG/wB,GACar+C,EAKlB,MAAMuP,GAAMouC,EAAAA,EAAAA,GAAaD,IACnB,eAAEE,IAAmBC,EAAAA,EAAAA,GAAa,CAAEhnC,cAActH,IAClD,WAAE8/D,EAAU,UAAEhiD,IAAciiD,EAAAA,EAAAA,GAAS,CACzC//D,MACA8d,UAAW0hD,EACXl4D,aACAtR,UACAypE,gBACAC,aACAC,eACAC,YACAC,4BACAj3C,wBAGF,OACEhtC,EAAAA,cAAC02E,GAAgBx2E,EAAAA,EAAAA,GAAA,CACfi1E,UAAWjzC,EAAY,SAAW,GAClC8V,SAAUtsB,IACNlM,EAAAA,EAAAA,GAAW0kE,EAAYhxB,EAAYT,GAAe,CACtDkxB,QAASA,EACT3vE,SAAUuvC,IAAwB73B,GAAc,OAAItE,EACpDhD,IAAKA,IAGX,IAAG6d,EAAA5hC,aAAA,6xB,+HC3GH,MAAM+jF,GAAY7jF,EAAAA,EAAAA,IAAOme,EAAAA,IAAale,WAAA,CAAAC,YAAA,gCAAAC,YAAA,eAApBH,CAAoB,6CAwBzBshC,EAAqBjhC,IAKF,IALG,WACjC8e,EAAU,SACV5e,EAAQ,QACRujF,GAAU,KACPjO,GACqBx1E,EACxB,MAAM0jF,GAA8BzzE,EAAAA,EAAAA,UACpC,OACE7Q,EAAAA,cAAC27C,EAAAA,EAAW,CACVj8B,WAAYA,EACZ2vC,aAAe5iC,KACRA,GAAQ63D,EAA4BxzE,SACvCwzE,EAA4BxzE,QAAQ0C,OACtC,IAGD,CAACzT,EAAOqkB,IACPpkB,EAAAA,cAACiiC,EAAAA,IAAU/hC,EAAAA,EAAAA,GAAA,IACLsf,EAAAA,EAAAA,GAAW42D,EAAar2E,EAAO,CACjCkR,QAAU/G,IACJA,EAAEkH,eAAiBlH,EAAEkH,yBAAyB2/B,cAChDuzC,EAA4BxzE,QAAU5G,EAAEkH,cAC1C,IAEF,CACFgT,IAAKA,IAEJtjB,GACCujF,GAAWrkF,EAAAA,cAACokF,EAAS,CAACrqE,KAAK,2BAGrB,EAEhB8nB,EAAAxhC,aAAA,o1B,mFCrDK,MAAMJ,EAAuBW,IAA4B,IAA3B,QAAER,KAAYL,GAAOa,EAExD,OADciE,EAAAA,EAAAA,MACJI,KACDjF,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,GAASH,EAAK,CAAEI,IAAKC,GAAWL,EAAMI,OAExCH,EAAAA,cAAA,MAASD,EAAS,EACzBE,EAAAI,aAAA,6J,+HCRF,MAAMkkF,EAAiBhkF,EAAAA,GAAO+Z,GAK3B;;;;gBAIa1Z,IAAA,IAAC,MAAEgE,EAAK,SAAEozC,GAAUp3C,EAAA,OAChCo3C,EACIpzC,EAAM0U,MAAM,gCACZ1U,EAAM0U,MAAM,uBAAuB;;MAErC9L,IAAA,IAAC,MAAE5I,EAAK,QAAEu2C,EAAO,SAAEnD,EAAQ,gBAAE4U,GAAiBp/C,EAAA,OAC9C5I,EAAM8V,aAAaooB,OAAO,CACxBqY,UACAnD,WACA4U,mBACA;;MAEFn9C,IAAA,IAAC,MAAE7K,EAAK,QAAEu2C,GAAU,EAAK,gBAAEyR,EAAe,SAAE5U,GAAUvoC,EAAA,OACtDuoC,EACI,cACApzC,EAAM8V,aAAawgC,UAAU,CAC3B0R,kBACAzR,QAASA,GACT;;;;IAIR/qC,IAAA,IAAC,WAAEspD,EAAU,gBAAE9M,EAAe,SAAE5U,GAAU5nC,EAAA,MAC3B,aAAfspD,GACAl4D,EAAAA,EAAI;sBACkC,UAApBorD,GAA+B;oBACb,UAApBA,GAA+B;qBAC9B5U,GAAY;KAC5B;EAGCghB,EAAcz4D,EAAAA,GAAOkV,KAA8B;;;;;;WAM9C3B,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACjBlP,EAAM0U,MACJ,uBACD;WACM9E,IAAA,IAAC,MAAE5P,EAAK,SAAEozC,GAAUxjC,EAAA,OAC3BwjC,GACApzC,EAAM0U,MACJ,+BACD;;iBAEY7E,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,OACvB7P,EAAM0U,MACJ,4BACD;;kBAEa3E,IAAA,IAAC,MAAE/P,GAAO+P,EAAA,OACtB/P,EAAM0U,MACJ,wBACD;aACMzE,IAAA,IAAC,MAAEjQ,GAAOiQ,EAAA,OACjBjQ,EAAM0U,MACJ,wBACD;;;aAGM8gB,IAAA,IAAC,MAAEx1B,GAAOw1B,EAAA,OAAKx1B,EAAM8V,aAAag1B,iBAAiB;;EAI1D80C,EAAejkF,EAAAA,GAAO+Z,GAAI;;;;;EAM1BmqE,GAAoBlkF,EAAAA,EAAAA,IAAOikF,EAAc;;EAIzCE,GAAmBnkF,EAAAA,EAAAA,IAAOikF,EAAc;;EA0CjClyB,EAAQtyD,EAAAA,YAAiB,SAAcs6B,EAelDi4B,GACC,IAfD,gBACE3F,EAAe,WACf0R,EAAU,YACVqmB,EAAW,WACXthC,EAAU,MACV5pC,EAAK,UACL07D,EACA/xB,SAAUu6B,EAAY,QACtB1sE,EAAO,OACPE,EAAM,UACNgS,EAAS,WACTu2C,KACG35D,GACQu6B,EAGb,MAAMlW,GAAMouC,EAAAA,EAAAA,GAAaD,GACnBnP,GAAWoP,EAAAA,EAAAA,GAAamrB,IACxB,eAAElrB,IAAmBC,EAAAA,EAAAA,GACzB,CACEhnC,WAAY3rB,EAAMi4C,SAClB70B,YACAlS,UACAE,UAEFiyC,IAEK40B,EAAW4M,IAAgB5/E,EAAAA,EAAAA,WAAS,IACrC,iBAAE6/E,IAAqBC,EAAAA,EAAAA,GAAe,CAC1CC,oBAAqBH,IASvB,OANA32E,EAAAA,EAAAA,YAAU,KACJqwD,GACFlb,EAAStyC,SAASyC,QACpB,GACC,CAAC+qD,IAGFt+D,EAAAA,cAACukF,GAAcrkF,EAAAA,EAAAA,GAAA,CACbkkB,IAAKA,EACL4gE,YAAY,EACZtrB,WAAYA,IACRl6C,EAAAA,EAAAA,GAAWqlE,EAAkB,CAC/B1P,YACA17D,QACA6/C,YAAc78C,IACRA,EAAM3T,SAAWs6C,EAAStyC,UAC5B2L,EAAMgF,iBACN2hC,EAAStyC,SAAS0C,QACpB,IAEF,CACF2nC,QAAS68B,EACTprB,gBAAiBA,EACjB5U,SAAUj4C,EAAMi4C,WAEf2sC,GAAe3kF,EAAAA,cAAC0kF,EAAgB,KAAEC,GACnC3kF,EAAAA,cAACg5D,GAAW94D,EAAAA,EAAAA,GAAA,CAACkkB,IAAKg/B,IAAc5jC,EAAAA,EAAAA,GAAWzf,EAAO0yD,KACjDpP,GAAcrjD,EAAAA,cAACykF,EAAiB,KAAEphC,GAGzC,IAAGiP,EAAAjyD,aAAA,+iD,uKChHH,MAAM24D,GAAcz4D,EAAAA,EAAAA,IAAO+xD,EAAAA,EAAO;;EAOrBtG,EAAahsD,EAAAA,YAAiB,SAAmBY,EAe5D2xD,GACc,IAfd,gBACE3F,EAAe,kBACfE,EAAiB,UACjBqoB,EAAS,MACT17D,EAAK,eACLozC,EAAiB,SAAQ,YACzB4wB,EAAW,qBACXC,EAAoB,WACpBlZ,EAAa,CAAC,EAAC,YACfmgB,EAAW,WACXthC,EAAU,SACVD,KACGrjD,GACaa,EAGlB,MAAMwjB,GAAMouC,EAAAA,EAAAA,GAAaD,IACnB,WAAE0yB,EAAU,kBAAEzG,EAAiB,WAAEC,EAAU,iBAAEF,IACjD2G,EAAAA,EAAAA,GAAS,IACJnlF,EACHysC,aAAcsgB,EACdF,gBACsB,UAApBA,GAAmD,YAApBA,EAC3B,UACA,UAGV,OACE5sD,EAAAA,cAAC6+E,EAAAA,EAAS,CACRz6D,IAAKA,EACL2zB,MAAOh4C,EAAMg4C,MACb8U,eAAgBA,EAChBnhC,WAAY3rB,EAAM2rB,WAClB+yD,WAAYA,EACZtJ,UAAWA,EACX17D,MAAOA,GAEPzZ,EAAAA,cAAC8+E,EAAAA,EAAqB,CACpBrB,YAAaA,EACbC,qBAAsBA,EACtBa,iBAAkBA,GAElBv+E,EAAAA,cAACq2C,EAAAA,EAAwB,CACvBC,UAAU,YACVkjB,YAAa,GACbulB,aAAW,EACXrzD,YAAaohC,EACbtsC,QACExgB,EAAAA,cAACy5D,EAAAA,EAAiB,CAChB/sD,KAA0B,UAApBkgD,EAA8BA,OAAkBxlC,GAEtDpnB,EAAAA,cAAA,MAASw+E,EAAoB1xB,IAGjCjN,MAAO,GAEP7/C,EAAAA,cAACg5D,GAAW94D,EAAAA,EAAAA,GAAA,CACVkjD,SAAUA,EACVrW,YAAahtC,EAAMgtC,YACnBiL,SAAUj4C,EAAM2rB,WAChBkhC,gBAAiBA,EACjB0R,WAAYv+D,EAAMu+D,WAClBn7C,UAAWpjB,EAAMojB,UACjBkgC,WAAYA,EACZshC,YAAaA,IACTnlE,EAAAA,EAAAA,GAAWylE,EAAYzgB,EAAY,CACrCpgE,MAAOrE,EAAMqE,MACboK,aAAczO,EAAMyO,aACpBgU,SAAWtY,GACTnK,EAAMyiB,WAAWtY,EAAEpB,OAAO1E,aAO1C,IAAG4nD,EAAA3rD,aAAA,27E,yGC3KH,MAGa8kF,E,SAAa5kF,GAAO0nB,CAAE;;;;;;;QAO3Bza,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACV5I,EAAM0U,MACJ,0BACA1U,EAAM8V,aAAa0qE,iBACpB;;;WAdmBxkF,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,OACtDgE,EAAM8V,aAAaC,qBAAqB;;;;;aAqB7BlL,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACjB7K,EAAM0U,MACJ,uBACA1U,EAAM0U,MACJ,wBACA,IAEH;;;;aAIMlJ,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACjBxL,EAAM0U,MACJ,yBACA1U,EAAM0U,MACJ,0BACC1U,EAAMK,KAAmB,UAAZ,WAEjB;;;;;;aAMM6O,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACjBlP,EAAM0U,MACJ,0BACA1U,EAAM0U,MACJ,2BACA1U,EAAM0U,MAAM,qBAAsB,SAErC;;;;;;;aAOM9E,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,OACjB5P,EAAM0U,MACJ,yBACA1U,EAAM0U,MACJ,0BACC1U,EAAMK,KAAmB,UAAZ,WAEjB;;uCC1CA,MAAMkV,EAAOna,EAAAA,YAClB,CACED,EACAwyD,KAEA,MAAMnuC,GAAMy9D,EAAAA,EAAAA,GAAgBtvB,IAEtB,eAAEE,IAAmBC,EAAAA,EAAAA,GAAa3yD,EAAOqkB,IACzC,WAAE8/D,EAAU,UAAEhiD,IAAciiD,EAAAA,EAAAA,GAAS,IAAKpkF,EAAOqkB,QACjDkyD,GAAWC,EAAAA,EAAAA,GAAex2E,EAAO,CAAEslF,WAAW,IAC9CC,GAAsB9lE,EAAAA,EAAAA,GAAWizC,EAAgByxB,GAEvD,OACElkF,EAAAA,cAACulF,EAAAA,EAAS,CAACC,eAAe,iBACxBxlF,EAAAA,cAACmlF,GAAUjlF,EAAAA,EAAAA,GAAA,IACLsf,EAAAA,EAAAA,GAAWizC,EAAgB6yB,EAAqBhP,GAAS,CAC7Dh1E,GAAG,OACHy6C,KAAK,OACL33B,IAAKA,EAEL+wD,UAAY,GAAEp1E,EAAM2rB,WAAa,WAAa,MAC5CwW,EAAY,SAAW,MACrBniC,EAAMo1E,WAAa,KACvB,gBAAep1E,EAAM2rB,iBAActE,EACnCpT,SACGjU,EAAM2rB,gBAAoDtE,EAAtCrnB,EAAMwjD,qBAAuB,EAAI,IAGvDxjD,EAAMe,UAEC,IAGhBqZ,EAAA9Z,aAAA,y5B,0KCTK,MAAMsgD,EAAO3gD,EAAAA,YAAiB,SAAaY,EAQhD2xD,GACC,IARD,oBACEkzB,GAAsB,EAAK,mBAC3B78D,GAAqB,EAAK,oBAC1Bg4B,EAAmB,UACnBu0B,KACG3Q,GACU5jE,EAGf,MAAMb,EAAkD,IACnDykE,EACHkhB,wBAAyBD,GAErBrhE,GAAMouC,EAAAA,EAAAA,GAAaD,GACnB1kD,GAAQwxE,EAAAA,EAAAA,GAAat/E,IACrB,UAAE4lF,EAAS,YAAEC,IAAgBC,EAAAA,EAAAA,GACjC,IACK9lF,EACH88E,eAAe,GAEjBhvE,EACAuW,IAIA0hE,kBAAoBhlF,SAAUilF,KAAeD,KAC3CE,EAAAA,EAAAA,GAAmB,CACrBn4E,QACA+yC,sBACAyU,WAAazlD,GAAS5P,EAAAA,cAACimF,EAAAA,EAAQ,CAAC9hF,IAAKyL,EAAKzL,IAAKyL,KAAMA,MAGvD,OACE5P,EAAAA,cAACkmF,EAAAA,EAAYxlC,SAAQ,CAACt8C,MAAOwhF,GAC3B5lF,EAAAA,cAACw/E,EAAAA,GAAUt/E,EAAAA,EAAAA,GAAA,CACToB,GAAI6kF,EAAAA,IACAL,EACAH,GACApP,EAAAA,EAAAA,GAAex2E,EAAO,CAAEslF,WAAW,IAAO,CAC9Cz8D,mBAAoBA,EACpBusD,UAAWA,EACX/wD,IAAKA,IAEJ2hE,GAIT,G,gDC3FO,MAAMG,E,QAAclmF,cACzB,K,8FCNK,MAAMomF,EAAwBA,IAEjCpmF,EAAAA,cAACqqD,EAAAA,IAAuBnqD,EAAAA,EAAAA,GAAA,CACtBoB,GAAI,OACA+kF,EAAAA,EAAAA,GAAa,CAAEnQ,YAAa,KAAMv7C,YAAa,aAChD2rD,iBAGPF,EAAA/lF,aAAA,qD,mHCCK,SAAS4lF,EAAQrlF,GAA2C,IAAvC,KAAEgP,EAAI,SAAE9O,GAA4BF,EAC9D,MAAM,MAAEiN,EAAOstC,QAASorC,EAAW,SAAE3mE,IAAa0J,EAAAA,EAAAA,YAAW48D,EAAAA,GACvD9hE,EAAMpkB,EAAAA,OAAa,MACnB0rB,EAAa7d,EAAMqgD,aAAar0B,IAAIjqB,EAAKzL,KACzCqlB,EAAa3b,EAAMsrE,iBAAiB3vD,WAAW5Z,EAAKzL,MAEpD,UAAE87E,IAAcuG,EAAAA,EAAAA,GAAkB,CACtCriF,IAAKyL,EAAKzL,IACVigB,MACAxE,SAAUA,IAAMA,IAAWhQ,EAAKzL,KAChCg1E,iBAAkBtrE,EAAMsrE,mBAG1B,OACEn5E,EAAAA,cAACmgD,EAAAA,GAAcjgD,EAAAA,EAAAA,GAAA,CACb4/E,iBAAkByG,EAClBxwB,SAAUvsC,EACVwuB,SAAUtsB,EACV,gBAAeA,EACf,gBAAelC,EACf,aAAY5Z,EAAK,eACbqwE,EAAS,CACb77D,IAAKA,IAELpkB,EAAAA,cAACupB,EAAAA,EAAiBm3B,SAAQ,CACxBt8C,MAAO,CACLsnB,aACAlC,aACAC,mBAAoB88D,EACpBnhE,KAAMxV,IAGP9O,GAAY8O,EAAKiwB,UAI1B,CAAComD,EAAA5lF,aAAA,gP,+DC3CM,MAAMm/E,E,SAAaj/E,GAAO+Z,IAC9BC,OAAwBxa,IAAK,CAAQg8C,KAAMh8C,EAAMg8C,MAAQ,WACzDv7C,WAA4B,CAC3BimF,kBAAoBC,GAAkB,uBAATA,GACX;;;;;;WAMX9lF,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,mBAAmB;;IAErD9L,IAAA,IAAC,mBAAEob,GAAoBpb,EAAA,OACvBob,IACApnB,EAAAA,EAAAA,IAAG,kCAGF;gBACWiO,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAM0U,MAAM,kBAAkB;iDCftD,MAAM6mC,E,SAAiB5/C,GAAO+Z,IAAIC,OACtCxa,IAAK,CACJg8C,KAAMh8C,EAAMg8C,MAAQ,cAED;IACnBn7C,IAAsD,IAClD0+B,GADH,iBAAEwgD,EAAgB,SAAE/pB,EAAQ,SAAE/d,EAAQ,MAAEpzC,GAAOhE,EAE5C0Y,EAAQ0+B,EACRpzC,EAAM0U,MAAM,wBACZ1U,EAAM0U,MACJ,kBACA1U,EAAM8V,aAAaisE,iBAsBzB,OApBI5wB,IACE+pB,GACFxmE,EAAQ1U,EAAMgiF,oBACZhiF,EAAM0U,MACJ,6BACG1U,EAAM8V,aAAamsE,yBAE1BvnD,EAAkB16B,EAAM0U,MACtB,8BAGFA,EAAQ1U,EAAM0U,MACZ,mCACAA,GAEFgmB,EAAkB16B,EAAM0U,MACtB,sCAIC,CACLgmB,gBAAiB16B,EAAMkiF,oBAAoBxnD,GAC3ChmB,QACD;;;;;;;;;0JCRE,SAASusE,EAAOjlF,EAErBiN,EACAuW,GACC,IAHD,SAAExE,EAAQ,cAAE2lC,EAAa,cAAED,KAAkBvlD,GAAkBa,EAI/D,MACE+kF,WAAW,YAAErsB,KAAgBqsB,ICwD1B,SACL5lF,GAEA,IAAI,iBACFo5E,EAAgB,WAChBJ,EAAU,aACV7qB,EAAY,IACZ9pC,EAAG,iBACHq2D,EAAgB,UAChBt3D,EAAS,gBACTy1C,EAAe,cACfikB,EAAa,uBACb6I,EAAsB,cACtBqB,GAAgB,EAAK,kBACrBC,EAAiB,sBACjBriB,EAAqB,oBACrBsiB,GACElnF,EAIAmnF,GAAWC,EAAAA,EAAAA,GAAY,CAAEC,MAAO,SAAUC,YAAa,SACvDC,GAAW3jE,EAAAA,EAAAA,UACb,IACE82D,GACA,IAAI8M,EAAAA,EAAqBxO,EAAY7qB,EAAc9pC,EAAK8iE,IAC1D,CAACzM,EAAkB1B,EAAY7qB,EAAc9pC,EAAK8iE,KAEpDtK,EAAAA,EAAAA,GACE,CAAEC,gBAAe1D,iBAAkBA,GACnC/0D,GAGF,IAAI,gBAAEojE,IAAoBC,EAAAA,EAAAA,GAAwB,CAChDrjE,MACA+0D,mBACAsB,iBAAkB6M,EAClBnkE,YACAy1C,kBACA8sB,yBACAqB,gBACAC,oBACAriB,wBACAsiB,wBAGF,MAAO,CACLtB,UAAW6B,EAEf,CDxGME,CAAkB,IACjB3nF,EACHqkB,MACA+0D,iBAAkBtrE,EAAMsrE,iBACxBuM,wBAAyB3lF,EAAM0lF,oBAC/B1M,WAAYlrE,EAAMkrE,WAClB7qB,aAAcrgD,EAAMqgD,aAEpB64B,eAAe,KAGjB/J,EAAAA,EAAAA,GAAwB,CACtB13B,gBACA1lC,WACA/R,QACAk1D,cAAe3+C,IAGjB,MAAO+2B,EAASwsC,IAAc3iF,EAAAA,EAAAA,WAAS,IAEjC,iBAAE6/E,IAAqBC,EAAAA,EAAAA,GAAe,CAC1CC,oBAAqB4C,KAIvB15E,EAAAA,EAAAA,YAAU,KACR,MAAMutE,EAAW3tE,EAAMkrE,WAAWuC,eAE/Bv7E,EAAM0lF,qBACP53E,EAAMsrE,iBAAiByO,SACvBpM,IAEA3tE,EAAMsrE,iBAAiBvhB,cAAc4jB,GACrC3tE,EAAMsrE,iBAAiB5lE,OAAOioE,GAChC,GACC,EAAEz7E,EAAM0lF,sBAEX,MAAMoC,GAAmBvkD,EAAAA,EAAAA,GAAiB1jB,GAAQ,MAAa,IACzDgmE,GAAkCjiE,EAAAA,EAAAA,UACtC,MACE9V,QACAstC,QAAS4R,QAAQ5R,GAAWoK,GAC5B3lC,SAAUioE,KAEZ,CAACh6E,EAAOstC,EAASoK,IAGnB,MAAO,CACLogC,WAAWnmE,EAAAA,EAAAA,GAAWmmE,EAAWd,GACjCe,cACAzqC,UAEJ,C,yEEtFO,SAASkkC,EACdt/E,GAEA,MAAM8N,GAAQi6E,EAAAA,EAAAA,GAAqB,IAC9B/nF,EACHu/E,kBAAmB,YAGrB,OCJK,SAAyB1+E,EAE9BiN,GACC,IAFD,oBAAE8pD,GAAyC/2D,GAG3CksC,EAAAA,EAAAA,qBAAoB6qB,GAAqB,IAAM9pD,EAAMsrE,kBACvD,CDFE4O,CAAiBhoF,EAAO8N,GACjBA,CACT,C,mFEjBO,MAAMm6E,E,SAA0BznF,GAAO+Z,KAAI1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,MAAM,CAChEghE,YAAa,EACb7gC,WAAY,OACZh7B,WAAY,OACZkiF,QAAS,OACTC,OAAQ,UACR5uE,MAAO1U,EAAM0U,MAAM,mBAAoB1U,EAAM0U,MAAM,iBACpD,ICQD,SAAS6uE,EAAWvnF,GAIC,IAJkB,aACrCwnF,EAAY,OACZn7D,EAAM,SACNnsB,GACgBF,EAChB,MAAMynF,GAAYx3E,EAAAA,EAAAA,QAAuB,MAKzC,OAJAy3E,EAAAA,EAAAA,GAAmB,CACjBF,aAAcn7D,EACd7I,IAAKikE,IAGLroF,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACgoF,EAAuB,CACtBjsC,KAAK,eACL33B,IAAKikE,EACL5uE,OAAO8uE,EAAAA,EAAAA,IAAkBt7D,EAAOu7D,WAAa,QAE5CJ,EAAa3+E,QAAQo2B,UAExB7/B,EAAAA,cAAA,OACEmE,IAAKikF,EAAajkF,IAClBsV,OAAO8uE,EAAAA,EAAAA,IAAkBH,EAAaI,WAAa,QAElD1nF,GAIT,CAEO,MAAM2nF,EAGQA,CAACtjE,EAAQijE,EAActnF,EAAU4nF,IACtB,YAA1BN,EAAaO,SAEb3oF,EAAAA,cAACmoF,EAAW,CACVhkF,IAAKikF,EAAajkF,IAClBikF,aAAcA,EACdn7D,OAAQnsB,EAAS8V,MAAM4K,GAAqB,WAAfA,EAAEmnE,YAE9BD,EAAe5nF,EAASmR,QAAQuP,GAAqB,SAAfA,EAAEmnE,aAK7C3oF,EAAAA,cAAC4oF,EAAAA,GAAe,CACdzkF,IAAKikF,EAAajkF,IAClBikF,aAAcA,EACdjjE,OAAQA,QAAUiC,IAGtBqhE,EAAApoF,aAAA,wD,eCzDK,MAAM2lF,EAAqBplF,IAa5B,IAb+C,WACnDy0D,EAAU,oBACVzU,EAAsB,GAAE,MACxB/yC,GAKDjN,EAMC,MAAMioF,GAASllE,EAAAA,EAAAA,UACb,IACE,IAAImlE,EAAAA,EAA2B,CAQ7BC,mBAAoBnoC,EACpBooC,uBAAwB,GACxBC,cAAe,KAEnB,IAKF,OAHAJ,EAAO9P,WAAalrE,EAAMkrE,WAC1B8P,EAAO36B,aAAergD,EAAMqgD,aAErB,CACL43B,iBAAkB,CAChBhJ,WAAYjvE,EAAMsrE,iBAAiB2D,WACnC/D,WAAYlrE,EAAMkrE,WAClB8P,SAKAK,UAAW,SACXC,aAAehlF,GACN0kF,EAAOO,YAAYD,aAAahlF,EAAK,CAC1CklF,eAAe,EACfC,SAAU,IAGdxoF,SAAUA,CAAC4L,EAAMkD,IACF,SAATlD,EACK2oD,EAAWzlD,GAEP,YAATlD,EACK1M,EAAAA,cAAComF,EAAAA,EAAW,CAACjiF,IAAKyL,EAAKzL,WADhC,EAIFskF,cAAa,EAEbc,gBAAiB,QAEpB,C,qHC3CI,MAAM9pE,EAAuBzf,EAAAA,YAClC,CAAAY,EAQEwjB,KACI,IARJ,SACEtjB,EAAQ,WACR4e,EAAU,OACV+I,EAAM,WACNiD,KACG3rB,GACuBa,EAG5B,MAAMiN,GAAQ27E,EAAAA,EAAAA,GAAoB,CAAC,IAE7B,eAAEC,EAAc,eAAEzoE,EAAc,WAAE0oE,GCpBdC,EAAA/oF,EAE5BiN,KACI,IAFJ,WAAE6d,GAAa,EAAK,OAAEjD,GAA6B7nB,EAGnD,MAAO6oF,EAAgBG,IAAqB5kF,EAAAA,EAAAA,YA6C5C,MAAO,CAILgc,eATwD0K,EACtD,CAAC,EACD,CACEnK,cA5BiBrX,IACfA,EAAEpB,kBAAkBuI,UAG1Bu4E,EAAkB1/E,GAClBue,IAAS,CAAE3f,OAAQoB,EAAEpB,SACrBoB,EAAEuX,iBAEE5T,EAAM0pB,QAMR1pB,EAAMuG,QACNR,YAAW,KACT/F,EAAM4e,KAAK,KAAK,KAGlB5e,EAAM4e,KAAK,MACb,GAmBAi9D,YAhBiB74E,EAAAA,EAAAA,QAAO,MAkBxB44E,iBACD,EDzCwDE,CACrD,CAAElhE,SAAQiD,cACV7d,GAEIg8E,GAAWrqE,EAAAA,EAAAA,GAAWzf,EAAOihB,GACnC,OACEhhB,EAAAA,cAAAA,EAAAA,SAAA,KACuB,mBAAbc,EACNA,EAAS+oF,GAET7pF,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,GAAS2pF,EAAQ,CAAEzlE,IAAKA,IACrBtjB,GAGJ+M,EAAM0pB,QACLv3B,EAAAA,cAAC0iB,EAAAA,EAAqB,CACpBG,QAAShV,EAAMuG,MACfgQ,IAAKslE,EACL/mE,OAAQ8mE,EAKRK,kBAAkB,GAEjBpqE,KAGJ,IAQI2vD,EACX,oCAAoC5vD,EAAApf,aAAA,i+B,yJErEtC,SAAU0pF,EAAuB13D,GAC/B,IAAK,MAAM23D,KAAe33D,OAClB,IACD23D,EACH,WAAC3J,GACC,MAAM4J,EAAUD,EAAY3J,eAC5B,GAAI4J,EACF,IAAK,MAAMC,KAAoBD,EAAS,CACtC,MAAM,KAAEv9E,KAASy9E,GAAgCD,QAC3CC,CACR,CAEJ,EAEN,CAEA,MAAMC,EAAcvqE,EAAAA,EAAKwqE,KAAK,MAG9BD,EAAYlO,kBAAoB,SAC9Bn8E,EACAyc,GAGA,OAAOutE,EAAoBlqE,EAAAA,EAAKq8D,kBAAkBn8E,EAAOyc,GAC3D,EAEA,MAAM8tE,EAAiBnoD,EAAAA,EAAQkoD,KAAK,MAuCpC,SAASE,EAAmBzpF,GAC1B,OAAOwU,MAAMC,QAAQzU,GAEjBA,EAAS+C,IAAI0mF,IA/BjBjyE,EAgC6BxX,GA7B3Bd,EAAAA,eAAqBsY,IACpBA,EAAO5L,OAASmT,EAAAA,GAAQvH,EAAO5L,OAAS89E,EAAAA,EAWvCxqF,EAAAA,eAAqBsY,IAAWA,EAAO5L,OAASy1B,EAAAA,EAC3CniC,EAAAA,cACLsqF,EACA,CACEnmF,IAAmB,MAAdmU,EAAOnU,IAAcmU,EAAOnU,SAAMijB,KACnC9O,EAAOvY,OAEbwqF,EAAiBjyE,EAAOvY,MAAce,WAGnCwX,EAnBEtY,EAAAA,cACLoqF,EACA,CACEjmF,IAAmB,MAAdmU,EAAOnU,IAAcmU,EAAOnU,SAAMijB,KACnC9O,EAAOvY,OAEbwqF,EAAgBjyE,EAAOvY,MAAMe,YAbnC,IACEwX,CAiCF,CAzCAgyE,EAAepO,kBAAoB,SACjCn8E,EACAyc,GAGA,OAAOutE,EAAoB5nD,EAAAA,EAAQ+5C,kBAAkBn8E,EAAOyc,GAC9D,E,qCC8BO,MAAMiuE,EAAqBzqF,EAAAA,cAG/B,CACDoU,MAAOA,OACP01E,sBAAkB1iE,IAEPsjE,EAAc1qF,EAAAA,cAWzB,CAAC,GAEI,SAAS2qF,EAAO/pF,EAMrBiN,EACAuW,GACC,IANCxE,SAAUgrE,EAAY,gBACtBrtC,EAAkB,aACfx9C,GAC+Ba,EAIpC,MAAM,MAAEwT,EAAK,iBAAE01E,IAAqBxgE,EAAAA,EAAAA,YAAWmhE,GACzCtnE,EAAYpjB,EAAMojB,WAAa2mE,EAC/BjnE,EAAUA,KACd9iB,EAAM8iB,YACNzO,GAAO,EAEHwL,EAAYzb,GAIb0J,EAAMkrE,WAAWruE,QAAQvG,IAAMg4E,cAGH,kBAApB5+B,GACT16B,IACO+nE,IAAezmF,SAFjB,EADEymF,IAAezmF,GAMpB0mF,EAA0D,CAC9DttC,kBACAp6B,YACAvD,WACAiD,YAEI,UAAEK,IAAc4nE,EAAAA,EAAAA,GACpB,IAAK/qF,EAAO6f,WAAUiD,UAASM,aAC/BtV,EACAuW,GAGF,MAAO,CACLlB,YACA2nE,mBAEJ,CAEO,SAASE,EACdhrF,GAOA,OADAA,EDxDK,SAA6Ba,GAGe,IAHX,SACtCE,KACGf,GACwBa,EAC3B,MAAO,IACFb,EACHe,SACsB,mBAAbA,EACFskB,GAAYmlE,EAAgBzpF,EAASskB,IACrCmlE,EAAgBzpF,GAE3B,CC6CUkqF,CAAqBjrF,IACtBkrF,EAAAA,EAAAA,GAAa,IACflrF,EACHmrF,wBAAyB,SACzBrlE,aAAc9lB,EAAMorF,YAAc,CAACprF,EAAMorF,kBAAe/jE,EACxD0B,iBAAkBtb,IAAA,IAAEguE,GAAShuE,EAAA,OAAKzN,GAAOqrF,sBAAsB5P,EAAS,EACxExrB,oBAAqBjwD,EAAMsrF,mBACvB,CAACtrF,EAAMsrF,yBACPjkE,GAER,CAwBO,SAASzH,EAAIlQ,GAA0D,IAAvC,SAAEqd,KAAa/sB,GAAqB0P,EACzE,MAAM2U,EAAMpkB,EAAAA,OAA+B,MACrC6N,EAAQk9E,EAAahrF,IACrB,iBAAE8qF,EAAgB,UAAE3nE,GAAcynE,EAAQ5qF,EAAO8N,EAAOuW,GAE9D,OAQEpkB,EAAAA,cAAC0qF,EAAYhqC,SAAQ,CAACt8C,MAAOymF,GAC3B7qF,EAAAA,cAACsrF,EAAAA,IAAUprF,EAAAA,EAAAA,GAAA,GACLgjB,EAAS,CACbkB,IAAKA,EACL3K,MAAO,CAAEqT,YACTlE,mBAAoB7oB,EAAM6oB,sBAEzB2iE,EAAAA,EAAAA,GAAgB19E,EAAO,IAAIA,EAAMkrE,cAI1C,CAACp5D,EAAAtf,aAAA,quF,gQC9KD,MAAMmrF,EAAqBjrF,EAAAA,GAAOy+B,IAAK;;EAIjCysD,GAA6BlrF,EAAAA,EAAAA,IAAOme,EAAAA,GAAc;;;;EAMlDgtE,GAAwBnrF,EAAAA,EAAAA,IAAOi4E,EAAAA,EAAS;;;;EAyG9C,MAAMmT,EAAkB3rF,EAAAA,cAIrB,CAAEu+E,iBAAkB,CAAC,EAAGE,WAAY,CAAC,EAAGmN,sBAAuB,CAAC,IAEtDC,EAAoBA,KACxBviE,EAAAA,EAAAA,YAAWqiE,GAGb,SAASG,EAAQt+E,GAAwC,IAApC,KAAEoC,EAAI,MAAE/B,GAAyBL,EAE3D,MAAM4W,EAAMpkB,EAAAA,OAA4B,MAClC+rF,EAAgB/rF,EAAAA,OAA6B,MAC7C0rB,EAAa7d,EAAMqgD,aAAar0B,IAAIjqB,EAAKzL,KACzC6nF,EAAan+E,EAAMgY,aAAagU,IAAIjqB,EAAKzL,KACzCqlB,EAAa3b,EAAMsrE,iBAAiBtxD,aAAagS,IAAIjqB,EAAKzL,KAC1D6zE,EAAYnqE,EAAMsrE,iBAAiB2D,aAAeltE,EAAKzL,KACvD,QACJ0e,EAAO,gBACP06B,EAAe,cACf0uC,EAAiBlsF,IAA2BC,EAAAA,cAACksF,EAAAA,EAAYnsF,IAAS,YAClEm4D,EAAe9vC,IAAuBA,KACpCkB,EAAAA,EAAAA,YAAWohE,EAAAA,KAET,cAAEyB,EAAa,WAAE1N,EAAU,iBAAEF,EAAgB,sBAAEqN,GA5HvD,SAAoBhrF,EAKlBiN,EACAuW,GACe,IANf,gBACEm5B,KACGx9C,GACsEa,EAI3E,MAAMgP,EAAO/B,EAAMkrE,WAAWruE,QAAQ3K,EAAMoE,KACtCunB,EAAa7d,EAAMqgD,aAAar0B,IAAIjqB,EAAKzL,KACzC6nF,EAAan+E,EAAMgY,aAAagU,IAAIjqB,EAAKzL,KACzCioF,EAAax8E,EAAKusE,eAChBgQ,cAAeE,KAAsB/zE,IAAWg0E,EAAAA,EAAAA,GACtD,CACEnoF,IAAKyL,EAAKzL,IAGV0e,QAASupE,EAAa,YAAWhlE,GAEnCvZ,EACAuW,UAMKioE,EAAkBE,oBAClBF,EAAkBG,eAED,YAApBjvC,GAAiCyuC,UAE5BK,EAAkBI,cAG3B,MAAM,WAAEC,IAAeC,EAAAA,EAAAA,GAAS,CAC9BjhE,WAAYA,EACZkhE,aAAcA,KACZ,MAAMC,EAAmB,IAAIh/E,EAAMgY,cAAciS,MAC9CqzD,GACCt9E,EAAMkrE,WAAWruE,QAAQygF,IAAc2B,YAAcl9E,EAAKk9E,YAGtC,YAApBvvC,GAAkCyuC,GACpCn+E,EAAM0zC,UAAU3xC,EAAKzL,MAGlB4zE,EAAAA,EAAAA,QAEmB,YAApBx6B,GAAiCyuC,GAAca,IAE/Ch/E,EAAMsrE,iBAAiBwO,YAAW,GAEpC95E,EAAMsrE,iBAAiBvhB,cAAchoD,EAAKzL,KAC5C,IAIEgzE,EAAgB,CACpB1S,UAAYv6D,IACV,IACc,UAAVA,EAAE/F,KAA6B,MAAV+F,EAAE/F,MACH,kBAApBo5C,GACF,eAAiBrzC,EAAE/F,IAInB,OAFA0J,EAAM0zC,UAAU3xC,EAAKzL,UACrB+F,EAAEiyC,iBAEJ,IAII+nC,WAAY6I,IAAqB5I,EAAAA,EAAAA,GAAS,CAChDz4D,WAAYA,EACZs4D,UAAWA,KACTn2E,EAAM0zC,UAAU3xC,EAAKzL,KACjB6nF,GAEFn+E,EAAMsrE,iBAAiBvhB,cAAchoD,EAAKzL,IAC5C,IAIJ,MAAO,IACFmU,EACH6zE,eAAe3sE,EAAAA,EAAAA,GACb4sE,EACI,CACE,gBAAiBJ,EACjB,gBAAiB,QAEnB,CAAC,EACLK,EACAK,EACAvV,EACoB,kBAApB55B,EAAsCwvC,EAAmB,CAAC,GAGhE,CA4BIC,CACE,CACEzvC,kBACAp5C,IAAKyL,EAAKzL,KAEZ0J,EACAuW,IAGI8/D,WAAY6I,IAAqB5I,EAAAA,EAAAA,GAAS,CAChDz4D,WAAYA,EACZs4D,UAAWA,KACTn2E,EAAM0zC,UAAU3xC,EAAKzL,KACjB6nF,GAEFn+E,EAAMsrE,iBAAiBvhB,cAAchoD,EAAKzL,IAC5C,IAIJ,IAAM8oF,aAAcC,IAAkBC,EAAAA,EAAAA,GAAmB,CACvD/d,UAAWhrD,EACXslE,WAAYqC,EACZz1C,UAAW,YACX82C,YAAY,EACZvqE,UACA02C,OAAQ,EACRC,cAAe+I,EAAAA,GAAwB8qB,EAAAA,IACvC91D,OAAQy0D,IAGV,MAAMsB,EACgB,YAApB/vC,EACI,CACExB,KAAM,SACN,aAAc,WACXv8B,EAAAA,EAAAA,GAAWutE,EAAkB,CAE9B7wC,YAAchyC,GAA0BA,EAAEiyC,qBAG9C,CAAC,EACP,OACEn8C,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACutF,EAAAA,IAAcrtF,EAAAA,EAAAA,GAAA,GACTisF,EAAa,CACjBzgE,WAAYA,EACZyL,SAAU6gD,EACV5zD,IAAKA,IAEJoF,GACCxpB,EAAAA,cAACwtF,EAAAA,GAAkB,KACjBxtF,EAAAA,cAAC0rF,EAAqB,CACpB3xE,KAAM,CACJ5U,KAAM,YACN+lE,UAAW,CAAEwN,SAAUV,OAK/Bh4E,EAAAA,cAACupB,EAAAA,EAAiBm3B,SAAQ,CACxBt8C,MAAO,CACLsnB,aACAjC,mBAAoB5b,EAAMsrE,iBAAiBnB,UAC3CxuD,aACApE,KAAMxV,IAGR5P,EAAAA,cAAC2rF,EAAgBjrC,SAAQ,CACvBt8C,MAAO,CAAEq6E,aAAYF,mBAAkBqN,0BAEtC1zB,EAC0B,iBAAlBtoD,EAAKiwB,SACV7/B,EAAAA,cAACwrF,EAAuB/M,EACrB7uE,EAAKiwB,UAGRjwB,EAAKiwB,SAEPjwB,KAILA,EAAKusE,eACJn8E,EAAAA,cAACytF,EAAAA,EAAsBH,EACrBttF,EAAAA,cAACyrF,EAA0B,CAAC1xE,KAAK,0BAItCiyE,GASChsF,EAAAA,cAAC0tF,EAAAA,EAAO,CACNC,iBAOEC,GAGF5tF,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,CAAKkkB,IAAK2nE,GAAmBmB,GAC1BjB,EAAc,CAAE4B,YAAahgF,EAAOigF,QAASl+E,EAAKzL,QAM/D,CAKA,SAASypF,EAAan+E,GAMlB,IANmB,SACrB3O,EAAQ,gBACRitF,EAAkBl9C,SAAS52B,MAI5BxK,EACC,OAAOwmE,EAAAA,aAAsBn1E,EAAUitF,EACzC,CAACjC,EAAAzrF,aAAA,gZ,qHChSD,MAAM2tF,EAAuBztF,EAAAA,GAAO+Z,GAAI;;;;EAKlC2zE,EAAU1tF,EAAAA,GAAOy+B,IAAK;;EAItBkvD,EAAW3tF,EAAAA,GAAO4tF,GAAI;;;;WAIjBvtF,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACjBgE,EAAM+U,uBACJ/U,EAAM0U,MAAM,kCACb;EAGQgH,EAAiB9S,IAIF,IAJG,QAC7B/D,EAAO,SACP0d,EAAQ,KACRpN,GACoBvM,EACpB,MAAM,WAAEgc,IAAe4kE,EAAAA,EAAAA,GACrB7kE,EAAAA,EACA,sEAEI,WAAEk1D,EAAU,sBAAEmN,IAA0BC,EAAAA,EAAAA,KACxCwC,GAAe7kE,GAAczP,EACnC,OACE/Z,EAAAA,cAACguF,EAAoB,KAClBK,GAAeruF,EAAAA,cAACwtF,EAAAA,GAAkB,KAAEa,GACrCruF,EAAAA,cAACiuF,EAAYxP,EAAah1E,GACzB0d,GAAYnnB,EAAAA,cAACkuF,EAAatC,EAAwBzkE,GAC9B,EAEzB7G,EAAAjgB,aAAA,4U,oJCxBK,SAASiuF,EAAW1tF,GAOL,IAPM,SAC1BE,EAAQ,aACRytF,EACAtB,aAAcuB,EACd9E,WAAY+E,EAAe,iBAC3B3E,EAAgB,QAChBjnE,GACiBjiB,EACjB,MAAM8oF,GAAal3B,EAAAA,EAAAA,GAAai8B,IAC1B,aAAExB,IAAiByB,EAAAA,EAAAA,GACvB,CACE7rE,UACA8rE,mBAAmB,EACnBp3D,QAAQ,EACRq3D,2BAA2B,EAC3BC,eAAe,EACfC,6BAA+BvmE,KAErBwmE,EAAAA,EAAAA,GAAoBrF,EAAW54E,QAASyX,IAGpDmhE,GAuBF,OApBAsF,EAAAA,EAAAA,MASA/gF,EAAAA,EAAAA,YAAU,KACR,MAAMghF,EAAuBA,KAC3BpsE,GAAS,EAKX,OAHAguB,SAAS08B,iBAAiB,cAAe0hB,EAAsB,CAC7DxhB,SAAS,IAEJ,IACL58B,SAASusC,oBAAoB,cAAe6R,EAAqB,GAClE,IAGDjvF,EAAAA,cAAC0tF,EAAAA,EAAO,KACN1tF,EAAAA,cAACu4D,EAAAA,EAAU,CAACg2B,aAAcA,EAAcprE,WAAS,GAC/CnjB,EAAAA,cAACyqF,EAAAA,GAAmB/pC,SAAQ,CAC1Bt8C,MAAO,CACLgQ,MAAOyO,EACPinE,qBAGF9pF,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,IACMsf,EAAAA,EAAAA,GAAWytE,EAAcuB,GAAkB,CAC/CpqE,IAAKslE,IAEJ5oF,KAMb,CAACwtF,EAAAjuF,aAAA,y8B,mFC3EM,SAAS6uF,EAA4BtuF,GAQxC,IARyC,WAC3C8oF,EAAU,OACV/mE,EAAM,iBACNw8D,GAKDv+E,EACC,MAAO0hB,EAAU6sE,IAAenqF,EAAAA,EAAAA,UAA0C,CAAC,GAkB3E,OAhBAE,EAAAA,EAAAA,kBAAgB,KACd,MAAMkqF,EAAiB1F,EAAW54E,QAClCq+E,EACExsE,GAAUysE,EAoBhB,SAA0B5hF,GAYtB,IAZuB,QACzB81D,EAAO,QACPG,EAAO,aACP4rB,EAAY,cACZC,EAAa,iBACbnQ,EAAmB,GAOpB3xE,EACC,MAAM+hF,EACJ1+C,SAAS2+C,gBAAgBC,aACI,iBAArBtQ,EACJA,EAAiB3b,EACjB2b,GACAuQ,EACJ7+C,SAAS2+C,gBAAgBhb,cACI,iBAArB2K,EACJA,EAAiBzb,EACjByb,GAEN,IAAI31B,EAAMia,EACN91C,EAAO21C,EAEP31C,EAAO0hE,EAAeE,IACxB5hE,EAAO4hE,EAAaF,GAGlB7lC,EAAM8lC,EAAgBI,IACxBlmC,EAAMkmC,EAAcJ,GAMtB,OAHA9lC,EAAMn1C,KAAKC,IAAI,EAAGk1C,GAClB77B,EAAOtZ,KAAKC,IAAI,EAAGqZ,GAEZ,CAAE67B,MAAK77B,OAChB,CA1DUgiE,CAAkB,CAChBrsB,QACE3gD,EAAO2gD,QACP,IACFG,QAAS9gD,EAAO8gD,QAChB0b,mBACAkQ,aAAcD,EAAentB,YAC7BqtB,cAAeF,EAAeQ,eAEhC,CAAC,EACN,GACA,CAACjtE,GAAQ2gD,QAAS3gD,GAAQ8gD,UACtB,CACLypB,cAAe,CACbzzE,MAAO,CAAE6I,SAAU,QAASutE,OAAQ,OAAWvtE,IAGrD,C,qCCRA,MAAMwtE,GAAsBC,E,SAAAA,IAAiB,kDAUhCrtE,EAAwB1iB,EAAAA,YACnC,SAA8BY,EAE5B2xD,GACC,IAFD,SAAEzxD,EAAQ,OAAE6hB,KAAWuwC,GAAwCtyD,EAG/D,MAAM8oF,GAAal3B,EAAAA,EAAAA,GAAaD,IAC1B,cAAE26B,GAAkBgC,EAA6B,CACrDxF,aACA/mE,SACAw8D,iBAAkB,CAAE3b,EAAG,EAAGE,EAAG,KAGzBssB,GAA+BrsE,EAAAA,EAAAA,UAAQ,IACrChB,GAAQ7Z,kBAAkBioC,aAGzBk/C,EAAAA,EAAAA,GAAattE,EAAO7Z,QACvB6Z,EAAO7Z,QACPonF,EAAAA,EAAAA,GAAgBvtE,EAAO7Z,QAJlB,MAKR,CAAC6Z,GAAQ7Z,SAYZ,OAVAmF,EAAAA,EAAAA,YAAU,KAIR+hF,GAAcG,WAAW13D,IAAI,kBACtB,KACLu3D,GAAcG,WAAW1xD,OAAO,iBAAiB,IAElD,IAGDz+B,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8vF,EAAmB,MACnB/iC,QAAQpqC,IACP3iB,EAAAA,cAACsuF,EAAAA,GAAWpuF,EAAAA,EAAAA,GAAA,CACV+sF,aAAcC,EACdxD,WAAYA,EACZ6E,cAAY,GACRr7B,GAEHpyD,GAKX,IACA4hB,EAAAriB,aAAA,q1D,qHCjCK,MAAMs7C,EAA0C/6C,IAUhD,IAViD,SACtDE,EAAQ,WACR4e,EAAU,UACVw7D,EAAY,SAAQ,MACpBkV,EAAQ,QAAO,WACfhD,GAAa,EAAI,aACjBmB,GAAe,EAAI,oBACnBvhD,GAAsB,EAAI,qBAC1BqjD,KACGn9B,GACJtyD,EACC,MAAMiN,GAAQ27E,EAAAA,EAAAA,GAAoBt2B,GAC5B8rB,EAAah/E,EAAAA,OAAa,MAC1B0pF,EAAa1pF,EAAAA,OAAa,OAGxB07C,iBAAkB40C,EAAY,UAAEptE,IAAcqtE,EAAAA,EAAAA,GACpD,CAAE7jF,KAAM,QACRmB,EACAmxE,GAEIwR,EAA6C,IAC9CF,EAEHtjD,wBAEI,YAAEopC,IAAgBC,EAAAA,EAAAA,GAAUma,EAAiBxR,IAE3CiO,aAAcC,IAAkBC,EAAAA,EAAAA,GAAmB,CACzD/d,UAAWihB,GAAwBrR,EACnC0K,aACApzC,UAAWm6C,EAAavV,EAAWkV,GACnChD,aACA7zB,OAAQ,EACR4lB,iBAAkB,EAClBt8D,QAASA,IAAMhV,EAAMuG,QACrBmjB,OAAQ1pB,EAAM0pB,SAGhB,OACEv3B,EAAAA,cAAAA,EAAAA,SAAA,KACGc,EAASs1E,EAAa4I,GACtBnxE,EAAM0pB,QACLv3B,EAAAA,cAACsuF,EAAAA,EAAW,CACVrB,aAAcC,EACdxD,WAAYA,EACZ7mE,QAAShV,EAAMuG,MACfm6E,aAAcA,GAEb7uE,EAAW,CAAEwD,eAGjB,EAIP,SAASutE,EACPvV,EACAkV,GAEA,OAAQlV,GACN,IAAK,OACL,IAAK,QACL,IAAK,QACL,IAAK,MACH,MAAQ,GAAEA,KAAuB,QAAVkV,EAAkB,SAAW,QAGtD,QACE,MAAQ,GAAElV,KAAakV,IAE7B,CAACz0C,EAAAt7C,aAAA,+hB,wPCvFD,MAAMqwF,EAAuBnwF,EAAAA,GAAOowF,EAAG;;;;EAMjCC,EAA2BrwF,EAAAA,GAAO+Z,GAAI;;;EAKtCu2E,GAAwBtwF,EAAAA,EAAAA,IAAO+qF,EAAAA,GAAY;;IAE7CjhC,EAAAA;;;EAKEmM,EAAoBj2D,EAAAA,GAAO+Z,GAAI;WAC1B1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAEjBgE,EAAM0U,MACJ,2BACA1U,EAAMK,KAAO,UAAY,UAC1B;;;;;;;;;EAWL,SAAS6rF,EACPjjF,EACAigF,EACA1pE,EACAiE,GAEA,MAAM,YACJgxD,EAAW,iBACXF,EAAgB,iBAChBsB,EACAz5D,eAAgB+vE,EAAyB,iBACzClV,IACErB,EAAAA,EAAAA,GAAyB,CAC3BzB,YAAYp1D,EAAAA,EAAAA,UACV,IACE,IAAIqtE,EAAAA,EACFlD,EACIjgF,EAAMkrE,WAAWruE,QAAQojF,IAAUzN,YAAc,GACjDxyE,EAAMkrE,aAEd,CAAC+U,EAASjgF,EAAMkrE,aAElBI,iBAAkBtrE,EAAMsrE,iBACxBsB,iBAAkB,IAAIwW,EAAAA,EACpBnD,EACAjgF,EAAMkrE,WACNlrE,EAAMqgD,aACN9pC,GAEFqhC,wBAAwB,EACxB6zB,gBAAgB,EAChBl1D,SAKFnW,EAAAA,EAAAA,YAAU,KACR,MAAMsa,EAAUnE,EAAItT,QAElByX,GACA1a,EAAMsrE,iBAAiBnB,YACtBzvD,GAAS2oE,SAASrgD,SAASC,iBAE5BqgD,EAAAA,EAAAA,GAAY5oE,EACd,IAGF,MAAMinB,GAAW3+B,EAAAA,EAAAA,QAAiD,OAC3D/D,EAAMskF,IAAWpsF,EAAAA,EAAAA,UACtB,MAEIqsF,EAAcA,KAClB,MAAM,YAAEpvB,EAAc,EAAC,aAAE2tB,EAAe,GAAMvnE,EAAavX,SAAW,CAAC,EACnEmxD,EAAc,GAAK2tB,EAAe,IACpCpgD,EAAS1+B,QAAU,CACjBwb,MAAO21C,EACP9gD,OAAQyuE,GAEZ,EAEIjqC,EACJ0zB,EAAYr8D,QAAUq8D,EAAYr0B,WAAW30C,OAAS,GACxDihF,EAAAA,EAAAA,GAAkB,CAChBltE,IAAKiE,EACLkpE,UAAUjuD,EAAAA,EAAAA,IAAiB,KACpBqiB,GACH0rC,GACF,OAGJnsF,EAAAA,EAAAA,IAAgB,KACVygD,EACEnW,EAAS1+B,SACXsgF,EAAQ5hD,EAAS1+B,UAGd0+B,EAAS1+B,SACZugF,IAEFD,EAAQ,MACV,GACC,CAACzrC,IAEJ,MAAM6rC,EAA8C1kF,EAChD,CACE2M,MAAO,IACF3M,EACHigB,UAAWjgB,EAAKqU,OAChBswE,UAAW3kF,EAAKqU,SAGpB,CAAC,EACL,MAAO,CACLk4D,cACAoB,mBACAtB,mBACA4X,2BAA2BvxE,EAAAA,EAAAA,GACzBuxE,EACAS,EACA,CACEl4B,YAAcpvD,IAGZA,EAAEuX,gBAAgB,IAIxBo6D,mBAEJ,CAOO,MAAM95C,EAAkBv0B,IAMC,IANkB,gBAChD+vC,EAAkB,gBAAe,UACjCp6B,EAAY,QAAO,UACnBuuE,EAAY,kBAAiB,SAC7B5kE,KACG/sB,GACqByN,EACxB,MAIM4W,EAAMpkB,EAAAA,OAA+B,MACrCqoB,EAAeroB,EAAAA,OAA6B,MAC5C6N,GAAQk9E,EAAAA,EAAAA,IAAa,IAAKhrF,KAC1B,YACJs5E,EAAW,0BACX0X,EAAyB,iBACzBlV,EAAgB,iBAChBpB,GACEqW,EAAmBjjF,EAAO,KAAMuW,EAAKiE,IACnC,iBAAEwiE,EAAgB,UAAE3nE,IAAcynE,EAAAA,EAAAA,IACtC,IACK5qF,EACHojB,YACAvD,SAjBczb,IAChBpE,EAAM6f,WAAWzb,GACjBk1E,EAAYsY,OAAO,EAgBjBlX,mBACAl9B,mBAEF1vC,EACAuW,GAGF,OACEpkB,EAAAA,cAAC0qF,EAAAA,GAAYhqC,SAAQ,CACnBt8C,MAAO,IACFymF,EACHoB,cAAgBlsF,GACdC,EAAAA,cAAC4xF,GAAkB1xF,EAAAA,EAAAA,GAAA,CAACwxF,UAAWA,GAAe3xF,MAIlDC,EAAAA,cAAC6wF,GAAqB3wF,EAAAA,EAAAA,GAAA,CACpBoB,GAAG,MACH8iB,IAAKiE,EACL5O,MAAO,CAAEqT,aACLikE,EAAyB,CAC7BnoE,mBAAoB7oB,EAAM6oB,qBAE1B5oB,EAAAA,cAAC6xF,EAAsB,CACrB3oF,MAAO,IAAI2E,EAAMkrE,YACjB2Y,UAAWA,EACXrY,YAAaA,EACbwC,iBAAkBA,EAClBhuE,MAAOA,EACPqV,UAAWA,EACX4uE,QAAS1tE,KAGQ,EAI3B,SAASytE,EAAsBpiF,GAgB3B,IAhB+B,MACjCvG,EAAK,MACL2E,EAAK,YACLwrE,EAAW,iBACXwC,EAAgB,UAChB34D,EAAS,QACT4uE,EAAO,UACPJ,GASDjiF,EACC,MAAMwC,EAASonE,EAAYr8D,OACvB5M,IAAA,IAAC,IAAEjM,EAAG,KAAEuI,GAAe0D,EAAA,MACZ,SAAT1D,GAAmB2sE,EAAYx7B,QAAQhkB,IAAI11B,EAAI,OACjDijB,EACJ,OACEpnB,EAAAA,cAAAA,EAAAA,SAAA,KACG67E,EAAiB/6E,UAChBd,EAAAA,cAAC4wF,EAAwB,CACvB30C,QAAU/xC,IACRA,EAAEuX,gBAAgB,GAGpBzhB,EAAAA,cAAC+xF,EAAAA,GAAgB7xF,EAAAA,EAAAA,GAAA,GAAK27E,EAAgB,CAAE8V,MAAOtY,EAAYsY,UAG/D3xF,EAAAA,cAAC0wF,GAAoBxwF,EAAAA,EAAAA,GAAA,GAAKgjB,EAAS,CAAEkB,IAAK0tE,KACvCvG,EAAAA,EAAAA,GAAgB19E,EAAO3E,EAAO+I,GAC9BonE,EAAYr8D,QAAuC,IAA7Bq8D,EAAYx7B,QAAQ/wC,MACzC9M,EAAAA,cAACw2D,EAAiB,KAAEk7B,IAK9B,CAEA,SAASE,EAAkB99E,GAI2B,IAJvB,YAC7B+5E,EAAW,QACXC,EAAO,UACP4D,GACiD59E,EACjD,MAAMsQ,GAAMvT,EAAAA,EAAAA,QAAyB,MAC/BwX,GAAexX,EAAAA,EAAAA,QAAuB,MACtChD,GAAQmkF,EAAAA,EAAAA,GAAgBnE,GACxBoE,EAAWpkF,EAAMkrE,WAAWruE,QAAQojF,IAEpC,YACJzU,EAAW,0BACX0X,EAAyB,iBACzBlV,EAAgB,iBAChBpB,GACEqW,EAAmBjjF,EAAOigF,EAAS1pE,EAAKiE,IACtC,aAAE6pE,IAAiBC,EAAAA,EAAAA,GACvB,CAAErE,UAASD,cAAapT,oBACxB5sE,EACAuW,GAGF,OACEpkB,EAAAA,cAAC6wF,GAAqB3wF,EAAAA,EAAAA,GAAA,GAChB6wF,EAAyB,CAC7BzvF,GAAG,MACH8iB,IAAKiE,IAELroB,EAAAA,cAAC6xF,EAAsB,CACrB3oF,MAAO,IAAK+oF,GAAU5R,YAAc,IACpChH,YAAaA,EACbwC,iBAAkBA,EAClBhuE,MAAOA,EACPqV,UAAWgvE,EACXJ,QAAS1tE,EACTstE,UAAWA,IAInB,CAAC3vD,EAAA1hC,aAAA,gwB,8HC5UM,MAAMkiE,EAAwB,EACxB8qB,EAAoB,EAGpB/B,EAAa/qF,EAAAA,GAAOowF,EAAqC;;;;;;aAMzDpuB;;;;;;;;gBAQG8qB;MACVzsF,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACZgE,EAAM0U,MAAM,mBAAqB1U,EAAMK,KAAmB,UAAZ,UAAsB;IACpEm9D,EAAAA;gBACY50D,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACtB5I,EAAM0U,MACJ,uBACD;WACM7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACjB7K,EAAM0U,MACJ,uBACD;;IAED+wC,EAAAA;IACAA,EAAAA;IACAA,EAAAA,QAA6BA,EAAAA;;;IAG7BA,EAAAA;wBACoBj6C,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OAAKxL,EAAM0U,MAAM,sBAAsB;cAC3DxF,IAAA,IAAC,MAAElP,GAAOkP,EAAA,MACjB,GAAElP,EAAMR,MAAM,8BAAgC,KAAK;eAC3CoQ,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,MAClB,GAAE5P,EAAMR,MAAM,oCAAsC,OAAO;cACpDqQ,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,MACjB,KAAI7P,EAAMR,MAAM,kCAAoC,KAAK;;IAE5DuQ,IAAA,IAAC,mBAAEiU,GAAoBjU,EAAA,OACvBiU,IACApnB,EAAAA,EAAAA,IAAG,uDAIF;;;;;;IAMD+rF,EAAAA;;;;UAIMC,EAAAA;;;;;;;;MAQJD,EAAAA,eAA2BC,EAAAA;;;;;;;IAO7BA,EAAAA;;;;kFClFG,MAAMA,EAAqBjtF,EAAAA,GAAOy+B,IAAK;;EAIjCyuD,EAAoBltF,EAAAA,GAAOy+B,IAAK;;;;EAMvCozD,EAAmB5wF,EAAAA,EAAI;WAClBZ,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACjBgE,EAAMgiF,oBACJhiF,EAAM0U,MACJ,gCAEH;gBACW9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACtB5I,EAAM0U,MACJ,+BACD;EAEC+4E,EAAe7wF,EAAAA,EAAI;WACdiO,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACjB7K,EAAM0U,MACJ,sBACD;;EAGCg5E,EAAgB9wF,EAAAA,EAAI;WACf4O,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACjBxL,EAAM0U,MAAM,+BAAiC,YAAY;;EAGhDi0E,EAAiBhtF,EAAAA,GAAOgyF,EAGlC;;;;;;;IAOCF;IACAv+E,IAAA,IAAC,SAAEqjB,GAAUrjB,EAAA,OAAKqjB,GAAYi7D,CAAgB;IAC9C59E,IAAA,IAAC,WAAEkX,GAAYlX,EAAA,OAAKkX,GAAc4mE,CAAa;;;;;;8JCnC5C,SAASH,EAAUvxF,EASxBiN,EACAuW,GACC,IAVD,QACE0pE,EAAO,YACPD,EAAW,iBACXpT,GAID75E,EAID,MAAMqxF,EAAWpkF,EAAMkrE,WAAWruE,QAAQojF,IACpC,gBACJvwC,EAAe,UACfp6B,GAAY,EAAI,QAChBN,EAAO,SACPjD,IACE0J,EAAAA,EAAAA,YAAWohE,EAAAA,IACf,IAAI,UAAExnE,IAAcynE,EAAAA,EAAAA,GAClB,CACE,aAAcsH,IAAW,eAAiBA,GAAU7xE,UACpDR,WACAiD,UACAgF,aAAcha,EAAMsrE,iBAAiBtxD,aACrC4yD,iBACEA,GACA,IAAIwW,EAAAA,EACFnD,EACAjgF,EAAMkrE,WACNlrE,EAAMqgD,aACN9pC,GAEJjB,aAEFtV,EACAuW,GAEF,MAAM,aAAE8tE,IAAiBM,EAAAA,EAAAA,GAAe,CAAE1E,WAAWD,EAAazpE,GAE5DquE,EAAuB,CAC3BhuB,UAAYv6D,IACV,GAAc,WAAVA,EAAE/F,IAQJ,OANA0J,EAAM0zC,UAAUusC,GAChBjgF,EAAMsrE,iBAAiBvhB,cAAck2B,GACrCD,EAAY1U,iBAAiBwO,YAAW,QAChB,YAApBpqC,GACFrzC,EAAEiyC,kBAGN,GAeJ,OAXAluC,EAAAA,EAAAA,YAAU,KACR2F,YAAW,MAIS,IAAduP,GACFiB,EAAItT,SAAS0C,OACf,GACA,GACD,IAEI,CACL0+E,cAAc1yE,EAAAA,EAAAA,GAAW0D,EAAWgvE,EAAcO,GAEtD,CAOO,SAASvG,EAAO1+E,GAAgD,IAA5C,YAAEqgF,EAAW,QAAEC,GAA0BtgF,EAClE,MAAM4W,GAAMvT,EAAAA,EAAAA,QAAyB,MAC/BhD,GAAQmkF,EAAAA,EAAAA,GAAgBnE,GACxBoE,EAAWpkF,EAAMkrE,WAAWruE,QAAQojF,IAEpC,aAAEoE,GAAiBC,EAAW,CAAErE,UAASD,eAAehgF,EAAOuW,GAErE,OACEpkB,EAAAA,cAACsrF,EAAAA,IAAUprF,EAAAA,EAAAA,GAAA,GAAKgyF,EAAY,CAAE9tE,IAAKA,KAChCmnE,EAAAA,EAAAA,GAAgB19E,EAAO,IAAKokF,GAAU5R,YAAc,KAG3D,CAAC6L,EAAA7rF,aAAA,mP,kFChGM,MAAM4wF,UAAgC1J,EAAAA,EAE3CzL,WAAAA,CACEgS,EACQ/U,EACR7qB,EACA9pC,EACA8iE,GAEAwL,MAAM3Z,EAAY7qB,EAAc9pC,EAAK8iE,GAAU,KALvCnO,WAAAA,EAA+B,KAHjC90E,UAAI,EASV+3E,KAAK/3E,KAAO,IAAI80E,EAAWQ,WACxB11E,KAAKM,GAAQ40E,EAAWruE,QAAQvG,KAChCT,SAASkM,IACR,GAAIA,GAAQA,EAAKk9E,WAAagB,EAAS,CACrC,GAAkB,SAAdl+E,EAAKlD,KACP,MAAO,CAACkD,EAAKzL,KACR,GAAkB,YAAdyL,EAAKlD,KACd,MAAO,IAAIkD,EAAKywE,YAAYx8E,KAAIjD,IAAA,IAAC,IAAEuD,GAAKvD,EAAA,OAAKuD,CAAG,GAEpD,CACA,MAAO,EAAE,GAEf,CAEAm3E,WAAAA,GACE,OAAOU,KAAK/3E,KAAK,EACnB,CACAw3E,UAAAA,GACE,OAAOO,KAAK/3E,KAAKiO,OAAO,GAAG,EAC7B,CAEAmpE,WAAAA,CAAYl3E,GACV,MAAMwuF,EAAWD,MAAMrX,YAAYl3E,GAEnC,OAAO63E,KAAK/3E,KAAK4K,SAAS8jF,GAAYA,EAAW,IACnD,CACAvX,WAAAA,CAAYj3E,GACV,MAAMyuF,EAAWF,MAAMtX,YAAYj3E,GAEnC,OAAO63E,KAAK/3E,KAAK4K,SAAS+jF,GAAYA,EAAW,IACnD,EAYK,SAAST,EAAU3kF,EAExBK,EACAuW,GACC,IAHD,QAAE0pE,GAA2BtgF,EAI7B,MAAQ2pE,cAAe+a,IAAiB9a,EAAAA,EAAAA,GAAY,CAClD3S,UAAYv6D,IAGV,IAAKka,EAAItT,SAASogF,SAAShnF,EAAEpB,QAE3B,YADAoB,EAAEutE,sBAGJ,MAAMlyD,EAAO1X,EAAMkrE,WAAWruE,QAAQojF,GACtC,GAAc,cAAV5jF,EAAE/F,KAAuBohB,GAAQ1X,EAAMgY,aAAagU,IAAItU,EAAKphB,KAG/D,OAFA0J,EAAM0zC,UAAUh8B,EAAKphB,UACrB0J,EAAMsrE,iBAAiBwO,YAAW,GAGpCz9E,EAAEutE,qBAAqB,IAI3B,MAAO,CACLya,eAEJ,C,yECvEO,SAASF,EAAmBnE,GAGjC,MAAO,CAAElG,IAAc3iF,EAAAA,EAAAA,WAAS,IACzB,CAAE4yD,IAAiB5yD,EAAAA,EAAAA,UAAqB,MACzC6tF,GAAehiF,EAAAA,EAAAA,SAAO,GACtBiiF,GAAgBjiF,EAAAA,EAAAA,QAAmB,MAEnChD,EAAgC,IAEjCggF,EAAY1U,iBAAiBtrE,MAChC85E,WAAa3P,IACX6a,EAAa/hF,QAAUknE,EACvB2P,EAAW3P,EAAU,EAEvBpgB,aAAAA,CAAczzD,GACZ2uF,EAAchiF,QAAU3M,EACxByzD,EAAczzD,EAChB,GAeF,OAbAH,OAAO+uF,iBAAiBllF,EAAO,CAC7BmqE,UAAW,CACTxtE,IAAGA,IACMqoF,EAAa/hF,SAGxBgsE,WAAY,CACVtyE,IAAGA,IACMsoF,EAAchiF,WAKpB,IACF+8E,EACH1U,iBAAkB,IAAI6Z,EAAAA,EAAiBnF,EAAY9U,WAAYlrE,GAEnE,C,0GCpCA,MAAMolF,EAAoB1yF,EAAAA,GAAO+Z,GAAI;;;;;WAK1B1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACjBgE,EAAM0U,MACJ,8BACD;EAGC45E,EAAkC3yF,EAAAA,GAAOowF,EAAG;;;EAKrCwC,EAAc3lF,IAIqB,IAJD,KAC7CoC,EAAI,MACJ/B,EAAK,OACLoE,EAASA,MAAM,IACKzE,GAChB,UAAEyyE,EAAS,aAAEC,EAAY,WAAEC,IAAeiT,EAAAA,EAAAA,GAAe,CAC3D1yB,QAAS9wD,EAAKiwB,SACd,aAAcjwB,EAAK,gBAGrB,MAAMyiB,EAAQ,IAAIziB,EAAKywE,YAAYpuE,OAAOA,GAC1C,OAA2D,IAAvDogB,EAAMpgB,QAAOxC,IAAA,IAAC,KAAE/C,GAAM+C,EAAA,MAAc,SAAT/C,CAAe,IAAE2D,OACvCrQ,EAAAA,cAAAA,EAAAA,SAAA,MAGPA,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,KAAQigF,EACLrwE,EAAKiwB,UACJ7/B,EAAAA,cAACizF,EAAsB/S,EACpBtwE,EAAKiwB,UAGV7/B,EAAAA,cAACkzF,EAAoC/S,EAClCoL,EAAgB19E,EAAOwkB,KAG3B,EChDA,SAASk5D,EACd19E,EACAwkB,EACApgB,GAEA,YAFkC,IAAlCA,IAAAA,EAAqCA,KAAM,GAEpCogB,EAAMpgB,OAAOA,GAAQpO,KAAKuhB,IAC/B,OAAQA,EAAK1Y,MACX,IAAK,OACH,OAAO1M,EAAAA,cAAC8rF,EAAAA,EAAQ,CAAC3nF,IAAKihB,EAAKjhB,IAAKyL,KAAMwV,EAAMvX,MAAOA,IACrD,IAAK,UACH,OACE7N,EAAAA,cAAAA,EAAAA,SAAA,KACGolB,EAAKrlB,MAAMivE,YACVhvE,EAAAA,cAAComF,EAAAA,EAAW,CAACjiF,IAAKihB,EAAKjhB,IAAM,cAE/BnE,EAAAA,cAACmzF,EAAW,CACVhvF,IAAKihB,EAAKjhB,IACVyL,KAAMwV,EACNvX,MAAOA,EACPoE,OAAQA,IAETmT,EAAKrlB,MAAMivE,YACVhvE,EAAAA,cAAComF,EAAAA,EAAW,CAACjiF,IAAKihB,EAAKjhB,IAAM,eAIrC,IAAK,UACH,OAAOnE,EAAAA,cAAComF,EAAAA,EAAW,CAACjiF,IAAKihB,EAAKjhB,MAClC,GAEJ,CDoBEgvF,EAAA9yF,aAAA,ghB,iFE/BF,MAAMgzF,GAAkBC,EAAAA,EAAAA,eAQrB,CAAEC,UAAW,KAAMv2E,QAAQ,EAAO6iB,SAAUA,SAElC+2C,EAAkBh2E,IAKI,IALH,SAC9BE,EAAQ,SACRmsC,EAAQ,WACRvhB,EACAmrD,YAAa2c,EAAkBA,UACjB5yF,EACd,MAAMwjB,GAAMvT,EAAAA,EAAAA,QAAoB,MAC1BgmE,GAAcvzC,EAAAA,EAAAA,GAAiBkwD,IAC9Bx2E,EAAQC,IAAajY,EAAAA,EAAAA,WAAS,GAC/ByuF,GAAkBnwD,EAAAA,EAAAA,IAAkBp5B,IACxC,IAAIwhB,EAAJ,CAGA,GAAI1O,IAAW9S,EAAEijE,OAAQ,CACvB,MAAMomB,EAAYrpF,EAAEC,KAAKo9B,MAAM,gBAAgB,GAC3CgsD,GAAaA,EAAU3rD,gBAAkBqF,EAASrF,eACpDivC,GAEJ,CAkEJ,IAAsBtuD,EAjEJ,QAAVre,EAAE/F,KAAiBigB,EAAItT,YAiETyX,EAjEiCnE,EAAItT,SAmE9CQ,QAAQ,kBACS,OAA1BiX,EAAQmrE,eAIZ,SAAmBxpF,GACjB,SAAUA,EAAE+3D,aAAe/3D,EAAE0lF,cAAgB1lF,EAAEypF,iBAAiBtjF,OAClE,CALIq4C,CAAUngC,EAAQmrE,iBApEhBz2E,GAAU,EARZ,CASA,KAGFhP,EAAAA,EAAAA,YAAU,KAKR,SAASkD,IACP8L,GAAU,EACZ,CACA,SAAS22E,EAAc1pF,GACP,QAAVA,EAAE/F,KACJ8Y,GAAU,EAEd,CACA,OAXA4zB,SAAS08B,iBAAiB,UAAWkmB,GACrC5iD,SAAS08B,iBAAiB,QAASqmB,GACnC1nF,OAAOqhE,iBAAiB,OAAQp8D,GASzB,KACL0/B,SAASusC,oBAAoB,UAAWqW,GACxC5iD,SAASusC,oBAAoB,QAASwW,GACtC1nF,OAAOkxE,oBAAoB,OAAQjsE,EAAO,CAC3C,GACA,IAEH,MAAM0iF,GAAsBhjF,EAAAA,EAAAA,QAAe,IAgB3C,OAfA5C,EAAAA,EAAAA,YAAU,KACR,MAAM6lF,EAAUlgF,YAAW,KACrBigF,EAAoB/iF,UAAYm8B,GAClCnjC,QAAQC,KACL,YAAWkjC,8LAGZ7oB,EAAItT,SAAS4iF,cAEjB,IAEF,MAAO,KACLtkE,aAAa0kE,EAAQ,CACtB,GACA,CAAC7mD,IAEFjtC,EAAAA,cAACqzF,EAAgB3yC,SAAQ,CACvBt8C,MAAO,CACLmvF,UAAWtmD,EACXjwB,SACA6iB,SAAUA,KACRg0D,EAAoB/iF,QAAUm8B,CAAQ,IAI1CjtC,EAAAA,cAAA,QAAM+zF,QAAM,EAAC3vE,IAAKA,IACG,iBAAbtjB,EACNd,EAAAA,cAACg0F,EAAY,KAAElzF,GAEfA,EAEuB,EA6BxB,SAASkzF,EAAYxmF,GAAsC,IAArC,SAAE1M,GAAgC0M,EAC7D,MAAM,UAAE+lF,EAAS,OAAEv2E,EAAM,SAAE6iB,IAAavW,EAAAA,EAAAA,YAAW+pE,GACnD,GAAIE,EAAW,CACb,MAAMngF,EAAQtS,EAAS8mC,cAAc7mB,QAAQwyE,EAAU3rD,eACjDqsD,EAAQ7gF,GAAS,EAIvB,GAHI6gF,GACFp0D,IAEEo0D,GAASj3E,EACX,OACEhd,EAAAA,cAAAA,EAAAA,SAAA,KACGc,EAASoR,MAAM,EAAGkB,GACnBpT,EAAAA,cAAA,SAAIc,EAASoR,MAAMkB,EAAOA,EAAQ,IACjCtS,EAASoR,MAAMkB,EAAQ,GAIhC,CACA,OAAOpT,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,EACZ,CAAC81E,EAAAv2E,aAAA,mwBAAA2zF,EAAA3zF,aAAA,kV,qQCnJM,SAAS6zF,EAAyBtzF,GAMrC,IANsC,mBACxCuzF,EAAkB,SAClBrzF,GAIDF,EACC,OAAIZ,EAAAA,QAAcsqB,WAAW,MAEzBtqB,EAAAA,cAACA,EAAAA,SAAc,CACba,SACEb,EAAAA,cAACo0F,EAAoB,CAACC,iBAAkBF,KAGzCrzF,GAIAd,EAAAA,cAAAA,EAAAA,SAAA,KAAGc,EACZ,CAEA,SAASszF,EAAoB5mF,GAMzB,IALF8mF,eAAgBC,EAAqBA,SACrCF,iBAAkBG,EAAuBA,UAI1ChnF,EACC,MAAM8mF,GAAiBhxD,EAAAA,EAAAA,GAAiBixD,GAClCF,GAAmB/wD,EAAAA,EAAAA,GAAiBkxD,GAO1C,OANAvmF,EAAAA,EAAAA,YAAU,KACRqmF,MACO,KACLD,KAAoB,IAErB,IACI,IACT,CAACH,EAAA7zF,aAAA,w3BCzBD,MAAMo0F,EAAuBl0F,EAAAA,GAAO+Z,GAAI;;;;EAM3Bs3D,EAAwBrxE,EAAAA,GAAO+Z,GAAI;;;sBAG1B1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,eAAe;WACrD9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;IAEjD8oD,EAAAA;;EASEsyB,EAA6Bn0F,EAAAA,GAAO+Z,GAAI;;;;;EAOjCq6E,EAA2B,GAC3BC,EAA4B,GAE5BC,EAA0B70F,EAAAA,cAErC,CAAC,GAqBU6sB,EAAcpd,IAMkB,IANjB,aAC1Bm6C,EAAe,MAAK,SACpB98B,EAAW6nE,EAAwB,UACnC5nE,EAAY6nE,EAAyB,UACrCzf,KACGp1E,GACc0P,EACjB,MAAM,SAAE3O,GAAaf,EACf+0F,GAAexrE,EAAAA,EAAAA,YAAWurE,GAM1BzwE,EAAMpkB,EAAAA,OAA6B,OACnC,WAAE+0F,EAAU,cAAEC,IAAkBC,EAAAA,EAAAA,GACpC,CACEpG,eAAe,EACfD,2BAA2B,IAO7BsG,EAAAA,EAAAA,GAAuB,CACrB39D,QAAQ,EACR83B,aAAe93B,IACRA,IAlBTu9D,EAAajyE,YACb9iB,EAAM8iB,YAmBF,IAGJuB,IAEF4qE,EAAAA,EAAAA,KAEA,MAAM,YAAEmG,EAAW,WAAEC,IAAeC,EAAAA,EAAAA,GAAUt1F,EAAOqkB,IAGnDglC,OAAQ3vC,EAAK,+BACb67E,EAA8B,0BAC9BC,IACEC,EAAAA,EAAAA,GAA2BpxE,EAAK,IAAKrkB,EAAOgtB,YAAWD,cAErD,yBAAE2oE,GAwCV,WACE,MAAMC,GAAwB7kF,EAAAA,EAAAA,QAA2B,MAyBzD,MAAO,CACL4kF,yBAA0B,CACxBxkF,QA1BmC/G,IACrCwrF,EAAsB5kF,QAAU5G,EAAEpB,MAAM,EA0BtCqI,OAxB+BjH,IACjC,MAAMyrF,EAAyBzrF,EAAEkH,cACjC,IACGukF,GACAA,aAAkCtkF,UAChCnH,EAAEgH,cAAcggF,SAASyE,KAQzBA,EAAuBrkF,QAAQ,uBAClC,CACA,MAAMskF,EAAiBF,EAAsB5kF,QACzC8kF,IACFzE,EAAAA,EAAAA,GAAYyE,EAEhB,IAQJ,CAxEuCC,GAErC,OACE71F,EAAAA,cAACy0F,GAAoBv0F,EAAAA,EAAAA,GAAA,GAAK80F,EAAa,CAAE7f,UAAWA,IAClDn1E,EAAAA,cAAC81F,EAAAA,EAA8BR,EAC7Bt1F,EAAAA,cAACu4D,EAAAA,GAAU,CAACC,SAAO,EAAC+1B,cAAY,EAACprE,WAAS,GACxCnjB,EAAAA,cAAC4xE,GAAqB1xE,EAAAA,EAAAA,GAAA,IAChBsf,EAAAA,EAAAA,GAAW21E,EAAaJ,EAAYU,EAA0B,CAChEh8E,UACA,CACF2K,IAAKA,IAELpkB,EAAAA,cAAC00F,EAA0B,KACzB10F,EAAAA,cAAC+1F,EAAAA,EAAcr1C,SAAQ,CACrBt8C,MAAO,CACL+yB,UAAU,EACVi+D,aACAY,QAA0B,SAAjBpsC,IAGX5pD,EAAAA,cAACk0F,EAAyB,CACxBC,mBAAoBoB,GAEnBz0F,KAIW,QAAjB8oD,GAA0B5pD,EAAAA,cAACi2F,EAAAA,EAAoB,SAIjC,EAyC1BppE,EAAAxsB,aAAA,kpD,gDClMM,MAAM01F,E,QAAgB/1F,cAI1B,CAAEm3B,UAAU,EAAO6+D,SAAS,EAAMZ,WAAY,CAAC,G,mFCHlD,MAAMc,EAAe31F,EAAAA,GAAO+Z,GAA6B;;;;;;;kBAOvC1Z,IAAA,IAAC,UAAEu1F,EAAS,MAAEvxF,GAAOhE,EAAA,OACnCu1F,GAAavxF,EAAM8V,aAAao1C,cAAc;EAE5CsmC,EAAmB71F,EAAAA,GAAO+Z,GAAI;;;EAS7B,SAAS+7E,EAAY7oF,GAmBxB,IAnByB,KAC3BmgB,EAAI,MACJC,EAAK,UACLuoE,GAgBD3oF,EACC,OACExN,EAAAA,cAACk2F,EAAY,CAACC,UAAWA,GACvBn2F,EAAAA,cAACo2F,EAAgB,KAAEzoE,GACnB3tB,EAAAA,cAACo2F,EAAgB,KACfp2F,EAAAA,cAACmyE,EAAAA,EAAW,KAAEvkD,IAItB,CAACyoE,EAAAh2F,aAAA,20B,0GC5CD,MAAMi2F,EAAoB/1F,EAAAA,GAAOg2F,EAAG;;;;;;;;EAqBvBC,EAAe51F,IAAmD,IAAlD,SAAEE,GAA0CF,EACvE,MAAM,QAAEo1F,EAAO,WAAEZ,IAAe9rE,EAAAA,EAAAA,YAAWysE,EAAAA,GACrCU,EAAc,SAACvjC,GAA4C,YAAL,IAAvCA,IAAAA,EAA0C,CAAC,GAC9DlzD,EAAAA,cAACs2F,GAAsB92E,EAAAA,EAAAA,GAAW41E,EAAYliC,GAC3CpyD,GAAYd,EAAAA,cAAAA,EAAAA,SAAA,KAAE,QACG,EAEtB,OAAOg2F,EACLh2F,EAAAA,cAAC0yE,EAAAA,EAAiB,MACfllE,IAAA,IAAC,gBAAEslE,GAAiBtlE,EAAA,OAAKipF,EAAY3jB,EAAgB,IAGxD2jB,GACD,EACDD,EAAAn2F,aAAA,4Z,cCrCF,MAAMq2F,EAAqBn2F,EAAAA,GAAO+Z,GAAI;;EAIhCq8E,EAA6Bp2F,EAAAA,GAAO+Z,GAAI;;;EAQvC,SAAS0S,EAAYpsB,GAoBxB,IApByB,OAC3BqsB,EAAM,OACNQ,EAAM,QACNhkB,GAiBD7I,EACC,OACEZ,EAAAA,cAAAA,EAAAA,SAAA,KACGitB,IACoB,iBAAXA,EACNjtB,EAAAA,cAACw2F,EAAY,KAAEvpE,GAEfA,GAEJjtB,EAAAA,cAAC22F,EAA0B,KAAEltF,GAC5BgkB,GAAUztB,EAAAA,cAAC02F,EAAkB,KAAEjpE,GAGtC,CAGAT,EAAaU,OAAS2oE,EAAAA,EACtBrpE,EAAa88B,OAAS0sC,EAAaxpE,EAAA3sB,aAAA,m3B,iFCSnC,MAMMu2F,EAAiB52F,EAAAA,cAAsC,CAC3DysB,KAPuB2oD,KACvB,MAAM,IAAI/qE,MACR,4GACD,IAWUojD,EAAmBA,KAC9BnkC,EAAAA,EAAAA,YAAWstE,GAaAjrB,EAA8C/qE,IAAmB,IAAlB,SAAEE,GAAUF,EACtE,MAAO+pE,EAASksB,IAAc7xF,EAAAA,EAAAA,UAA+B,IACvD8xF,GAAYjmF,EAAAA,EAAAA,QAAe,GAE3B8kE,GAAMhyD,EAAAA,EAAAA,UAA0B,KAC7B,CACL8I,KAAM,SAAahjB,GACjB,OAAO,IAAIlC,SAAwBC,IACjCsvF,EAAUhmF,UACV,MAAMsD,EAASkE,IACbu+E,GAAYE,GACVA,EAAe9kF,QAAQ+kF,GAAYA,IAAY9qF,MAKjD0gB,uBAAsB,KACpBplB,EAAQ8Q,EAAO,GACf,EAEEpM,EACJlM,EAAAA,cAAC60F,EAAAA,GAAwBn0C,SAAQ,CAC/Bt8C,MAAO,CACLye,QAASA,KACPzO,GAAO,GAGXjQ,IAAK2yF,EAAUhmF,SAEK,mBAAZrH,EAEJA,EAAQ,CAAE2K,UACV3K,GAGRotF,GAAYE,GAAmBA,EAAexzF,OAAO2I,IAAQ,GAEjE,KAED,IAEH,OACElM,EAAAA,cAAC42F,EAAel2C,SAAQ,CAACt8C,MAAOuxE,GAC7B70E,EACA6pE,EACuB,EAE5BgB,EAAAtrE,aAAA,uN,iFCvIF,MAAM42F,EAAuBj3F,EAAAA,cAAwC,MAQ9D,SAAS0tF,EAAO9sF,GAMnB,IANoB,SACtBE,EAAQ,iBACR6sF,EAAmBuJ,EAAAA,IAIpBt2F,EACC,MAAM2kB,GAAO+D,EAAAA,EAAAA,YAAW2tE,GAClB5uE,GAAexX,EAAAA,EAAAA,QAAuB,MAE5C,OAAI0U,EAEAvlB,EAAAA,cAAC2tF,EAAgB,CAACI,gBAAiBxoE,GAAOzkB,GAI5Cd,EAAAA,cAACi3F,EAAqBv2C,SAAQ,CAACt8C,MAAOikB,EAAavX,SACjD9Q,EAAAA,cAAC2tF,EAAgB,KACf3tF,EAAAA,cAAA,OAAKokB,IAAKiE,EAAc,oBAAkB,IACvCvnB,IAKX,CAMO,SAASiuF,EACdoI,EACAC,GAEA,MAAMC,EAAeF,GAAU7lF,QAAQ,uBACjCgmF,EAAeF,GAAU9lF,QAAQ,uBACvC,OAAOy7C,QAAQsqC,IAAiBA,IAAiBC,CACnD,CAAC5J,EAAArtF,aAAA,ioB,sEClBD,MAAMk3F,EACJv3F,EAAAA,cAA2D,MAuBhD81F,EAA4Bl1F,IAG8B,IAH7B,SACxCE,KACGf,GAC4Da,EAC/D,OACEZ,EAAAA,cAACu3F,EAAiC72C,SAAQ,CAACt8C,MAAOrE,GAC/Ce,EACyC,EAInC02F,EAA+BA,KAC1CluE,EAAAA,EAAAA,YAAWiuE,GAAkCzB,EAAAz1F,aAAA,05E,kFCnDxC,SAASo3F,EAAqB7xF,GACnC,MAAM8xF,GAAqBF,EAAAA,EAAAA,KAC3B,IAAKE,EACH,MAAO,CAAE5kB,gBAAiB,CAAC,GAE7B,MAAM,kBAAE6kB,EAAiB,iBAAEC,EAAgB,aAAEC,GAC3CH,EAkBF,MAAO,CAAE5kB,iBAhBSglB,EAAAA,EAAAA,GAAQ,IACrBlyF,EACHmyF,YAAaA,IACJH,EAAiB,QAE1BI,OAAQp3F,IAA+B,IAA9B,WAAEq3F,EAAU,SAAEC,GAAUt3F,EAC/Bi3F,EAAa,IACRI,EACHzuC,IAAKyuC,EAAWzuC,IAAM0uC,EAASx0B,EAC/B/1C,KAAMsqE,EAAWtqE,KAAOuqE,EAAS10B,GACjC,EAEJ20B,UAAWA,KACTR,GAAmB,KAGgB,CAAC,EAC1C,CAQO,MAAMjlB,EAAoBllE,IAOI,IAPH,SAChC1M,KACGf,GAK0ByN,EAC7B,OAAO1M,EAAS22F,EAAqB13F,GAAO,C,oHC/BvC,SAASk2F,EAAqBl2F,GACnC,MAAMq4F,EAiBR,SAA2Br4F,QAAgC,IAAhCA,IAAAA,EAAmC,CAAC,GAC7D,MAAMs4F,GAAmBxnF,EAAAA,EAAAA,QAAe,CACtC24C,IAAK,EACLroC,OAAQ,EACRmL,MAAO,EACPqB,KAAM,IAEF+pE,GAAqBF,EAAAA,EAAAA,MACrB,SACJ1qE,EAAW4qE,GAAoB5qE,UAAY,EAAC,UAC5CC,EAAY2qE,GAAoB3qE,WAAa,GAC3ChtB,EACJ,IAAK23F,EACH,OAAO,KAET,MAAM,kBAAEC,EAAiB,iBAAEC,EAAgB,aAAEC,GAC3CH,EAEInG,EAAW,CACf3jE,MAAQ9gB,GACN+qF,EAAa,IACRQ,EAAiBvnF,QACpBwb,MAAOjY,KAAKC,IAAIwY,EAAUurE,EAAiBvnF,QAAQwb,MAAQxf,KAE/DypC,OAASzpC,GACP+qF,EAAa,IACRQ,EAAiBvnF,QACpBqQ,OAAQ9M,KAAKC,IAAIyY,EAAWsrE,EAAiBvnF,QAAQqQ,OAASrU,KAElE6gB,KAAO7gB,IACL,MAAMwrF,EAAWjkF,KAAKC,IACpBwY,EACAurE,EAAiBvnF,QAAQwb,MAAQxf,GAE7ByrF,EAAgBF,EAAiBvnF,QACvC,OAAO+mF,EAAa,IACfU,EACH5qE,KAAM4qE,EAAc5qE,KAAO4qE,EAAcjsE,MAAQgsE,EACjDhsE,MAAOgsE,GACP,EAEJ9uC,IAAM18C,IACJ,MAAM0rF,EAAYnkF,KAAKC,IACrByY,EACAsrE,EAAiBvnF,QAAQqQ,OAASrU,GAE9ByrF,EAAgBF,EAAiBvnF,QACvC,OAAO+mF,EAAa,IACfU,EACH/uC,IAAK+uC,EAAc/uC,IAAM+uC,EAAcp3E,OAASq3E,EAChDr3E,OAAQq3E,GACR,GAMN,SAASC,EACPC,GAGA,MAAO,CACL5rF,KAAM,EACNo7E,OAH0B,SAATwQ,GAA4B,UAATA,EAGf,KAAO,KAC5BC,gBAAiBA,KACfN,EAAiBvnF,QAAU8mF,EAAiB,SAAS,EAEvDrG,SAAUA,EAASmH,GACnBE,YAAajB,EACbl+E,MAAO,CAAE6I,SAAU,WAAY,CAACo2E,GAAO,GAE3C,CAEA,MAAO,CACLD,kBAEJ,CA7FyBI,CAAkB94F,GACzC,OACEq4F,GACEp4F,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC84F,EAAAA,EAAiBV,EAAeK,gBAAgB,UACjDz4F,EAAAA,cAAC+4F,EAAAA,EAAgBX,EAAeK,gBAAgB,SAChDz4F,EAAAA,cAACg5F,EAAAA,EAAeZ,EAAeK,gBAAgB,QAC/Cz4F,EAAAA,cAACi5F,EAAAA,EAAkBb,EAAeK,gBAAgB,WAI1D,CAkFCxC,EAAA51F,aAAA,mY,yICpGD,MAAM8hE,EAAgB5hE,EAAAA,GAAO+Z,GAAI;;;sBAGX1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,eAAe;WACrD9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;IAEjD8oD,EAAAA;EAES8c,EAAUl/E,EAAAA,YAAiB,SAAgByP,EAEtD8iD,GACC,IAFD,SAAEzxD,EAAQ,MAAE+M,EAAK,OAAE0rD,EAAS,KAAMx5D,GAAqB0P,EAGvD,MAAMquE,GAAatrB,EAAAA,EAAAA,GAAaD,IAC1B,aAAE2mC,IAAiBC,EAAAA,EAAAA,GACvB,IACKp5F,EACHw5D,SACAukB,cAEFjwE,GAGF,OACE7N,EAAAA,cAAC0tF,EAAAA,GAAO,KAEN1tF,EAAAA,cAACmiE,GAAajiE,EAAAA,EAAAA,GAAA,GAAKg5F,EAAY,CAAE90E,IAAK05D,IACpC99E,EAAAA,cAACo5F,EAAAA,EAAa,CAACC,UAAWxrF,EAAMuG,QAC/BtT,EACDd,EAAAA,cAACo5F,EAAAA,EAAa,CAACC,UAAWxrF,EAAMuG,SAIxC,IAAG8qE,EAAA7+E,aAAA,uS,2FC/CI,MAAMi5F,EACX14F,IAAA,IAAG0rB,MAAOQ,EAAU3L,OAAQ4L,GAA8CnsB,EAAA,OACzEwoD,IACC,MAAM98B,EAAQjY,KAAKC,IAAIwY,EAAUs8B,EAAO98B,OAClCnL,EAAS9M,KAAKC,IAAIyY,EAAWq8B,EAAOjoC,QAC1C,OAAIioC,EAAO98B,OAASA,GAAS88B,EAAOjoC,QAAUA,EACrC,IAAKioC,EAAQ98B,QAAOnL,UAEtBioC,CAAM,CACd,EAEI,SAASmwC,EAAkBjtE,EAAenL,GAC/C,MAAO,CACLwM,MAAOzhB,OAAOq9C,WAAaj9B,GAAS,EACpCk9B,KAAMt9C,OAAOu9C,YAActoC,GAAU,EACrCmL,QACAnL,SAEJ,CAUO,MAkDMmB,EACX9U,IAAA,IAAC,cACCgsF,EAAa,UACbljD,EAAY,UAIb9oC,EAAA,OACDiC,IAAwC,IAAvC,OAAE0R,EAAM,MAAEmL,GAAe7c,EACxB,MAAMgqF,EAAeD,EAAcn1B,wBACnC,MAAO,CACL12C,KAAM8rE,EAAa9rE,KACnB67B,IACgB,WAAdlT,EACImjD,EAAajwC,IAAMiwC,EAAat4E,OAChCs4E,EAAajwC,IAAMroC,EACzBmL,QACAnL,SACD,CACF,EAEI,SAASu4E,EACdtwC,EAAct+C,GAEL,IADT,IAAEyiB,EAAM,QAAqB,IAAAziB,EAAG,CAAC,EAACA,EAElC,MAAM6uF,EAAgBztF,OAAOq9C,WAAah8B,EACpCqsE,EAAiB1tF,OAAOu9C,YAAcl8B,EACtCI,GAAOksE,EAAAA,EAAAA,GAAMtsE,EAAKosE,EAAgBvwC,EAAO98B,MAAO88B,EAAOz7B,MACvD67B,GAAMqwC,EAAAA,EAAAA,GAAMtsE,EAAKqsE,EAAiBxwC,EAAOjoC,OAAQioC,EAAOI,KAC9D,OAAI77B,IAASy7B,EAAOz7B,MAAQ67B,IAAQJ,EAAOI,IAClC,CACL77B,OACA67B,MACAl9B,MAAO88B,EAAO98B,MACdnL,OAAQioC,EAAOjoC,QAGZioC,CACT,C,4FCtHO,MCiCM0wC,GApBTrgF,EAqBF,CACE6S,MAAO,GACPQ,SAAU,cACV3L,OAAQ,GACR4L,UAAW,eAxBXzkB,EA0BDigB,IAAO,CACN+D,MAAOjY,KAAK0lF,KAAKtlB,WAAWnT,iBAAiB/4C,GAAS+D,QACtDnL,OAAQ9M,KAAK0lF,KAAKtlB,WAAWnT,iBAAiB/4C,GAASpH,WA1BxDoH,IACC,MAAMu4C,EAAQv4C,EAAQyxE,WAAU,GAChCl5B,EAAMrnD,MAAM6I,SAAW,WACvBw+C,EAAMrnD,MAAMkU,KAAO,UACnBkjB,SAAS52B,KAAK8nD,YAAYjB,GAE1B98D,OAAOyqE,OAAO3N,EAAMrnD,MAAOA,GAC3B,MAAMwgF,EAAc3xF,EAAGw4D,GAGvB,OADAjwB,SAAS52B,KAAKioD,YAAYpB,GACnBm5B,CAAW,GAdpBC,IACEzgF,EACAnR,EAgCG,MAAM6xF,EAAiB,SAC5B/1E,EAA2BtZ,GAWvB,IAVJ,QACEsvF,GAAU,QAQX,IAAAtvF,EAAG,CAAC,EAACA,EAEN,MAAOuvF,EAAeC,IAAoBt1F,EAAAA,EAAAA,UAAiB,KAC3DE,EAAAA,EAAAA,kBAAgB,KACd,MAAMqjB,EAAUnE,EAAItT,QACpB,IAAKyX,GAAW8xE,EAAchqF,OAAS,EACrC,OAEF,MAAMvD,EAAOgtF,EAAevxE,GAEtBgyE,EAAmBF,EAAcG,IAAI,GACtCD,GAAqBE,EAAKC,QAAQH,EAAkBztF,IACvDwtF,EAAiB,CAACxtF,IAEpB,MAAMwR,EAAKpS,OAAO0gB,uBAAsB,KACtC,MAAM+tE,EAAUb,EAAevxE,GAC1BkyE,EAAKC,QAAQC,EAAS7tF,IACzBwtF,EAAiB,IAAID,EAAeM,GACtC,IAEF,MAAO,KACLzuF,OAAO0uF,qBAAqBt8E,EAAG,CAChC,GACA,CACD+7E,EAGAj2E,EAAItT,UAEN,MAAM+pF,EAAUA,KACd,MAAMN,EAAmBF,EAAcG,IAAI,GAC3C,GAAIp2E,EAAItT,SAAWypF,EAAkB,CACnC,MAAMO,EAAchB,EAAe11E,EAAItT,SAErCgqF,EAAY35E,SAAWo5E,EAAiBp5E,QACxC25E,EAAYxuE,QAAUiuE,EAAiBjuE,OAEvCguE,EACED,EAAcx2F,KAAKk3F,GACjBA,IAAUR,EAAmBO,EAAcC,IAInD,GAEIC,EDtG4B,SAClC1yF,EAAcwC,GAEV,IADJ,QAAE8qE,EAAU,UAAK,IAAA9qE,EAAG,CAAC,EAACA,EAEtB,MAAMmwF,GAAQpqF,EAAAA,EAAAA,QAAOvI,GACf4yF,GAAmBrqF,EAAAA,EAAAA,QAAsB,MAW/C,OAVA3L,EAAAA,EAAAA,kBAAgB,KACd+1F,EAAMnqF,QAAUxI,CAAE,KAEpB2F,EAAAA,EAAAA,YAAU,IACD,KAC4B,OAA7BitF,EAAiBpqF,SACnBse,aAAa8rE,EAAiBpqF,QAChC,GAED,KACI01D,EAAAA,EAAAA,cAAY,KACgB,OAA7B00B,EAAiBpqF,SACnBse,aAAa8rE,EAAiBpqF,SAEhCoqF,EAAiBpqF,QAAU5E,OAAO0H,WAAWqnF,EAAMnqF,QAAS8kE,EAAQ,GACnE,GACL,CCgF2BulB,CAAqBN,GAsB9C,OApBA5sF,EAAAA,EAAAA,YAAU,KACR,MAAMsa,EAAUnE,EAAItT,QACpB,GAAIspF,GAAW7xE,EAAS,CACtB,MAAM6yE,EAAmB,IAAIC,kBAAiB,KAC5CL,GAAkB,IAMpB,OAJAI,EAAiBhB,QAAQ7xE,EAAS,CAChC+yE,SAAS,EACTC,WAAW,IAEN,KACLH,EAAiBI,YAAY,CAEjC,IACC,CACDpB,EAGAh2E,EAAItT,UAEC,CAACupF,EAAcG,IAAI,IAAM,CAAEluE,MAAO,EAAGnL,OAAQ,GAAK05E,EAC3D,EAOaJ,EAAO,CAClBC,QAASA,CAAA95F,EAAA4M,KAAA,IACP,MAAE8e,EAAK,OAAEnL,GAAcvgB,GACrB0rB,MAAOmvE,EAAQt6E,OAAQu6E,GAA4CluF,EAAA,OAClE8e,IAAUmvE,GAAUt6E,IAAWu6E,CAAO,G,eCpDtC,SAASlG,EACd9L,EAAkC9oF,GAwCjC,IAtCCwoD,OAAQuyC,EAAW,cACnBnpB,EAAa,eACb9oB,EAAc,iBACdkyC,EAAoBxzE,IAAMA,GAAC,SAC3B0E,EAAQ,UACRC,EAAS,qBACT0lD,GAC+B7xE,EAgCjC,MAAOwoD,EAAQC,IAAauZ,EAAAA,EAAAA,GAC1B+4B,EACAnpB,EAEA9oB,IAKKmyC,EAAa1H,GAAsBgG,EAAezQ,EAAY,CACnE0Q,QAAS3nB,KAMJqpB,EAAoBC,IAAyB/2F,EAAAA,EAAAA,UAGjD,MAEGg3F,EACS,YAAblvE,EAAyB+uE,EAAYvvE,MAAQQ,GAAY,EACrDmvE,EACU,YAAdlvE,EAA0B8uE,EAAY16E,OAAS4L,GAAa,EACxDmvE,GAAe5C,EAAAA,EAAAA,IAAY,CAC/BhtE,MAAO0vE,EACP76E,OAAQ86E,IAEJ3G,EAAiE,CACrEsC,iBAAmBlrF,IACjB,IAAKg9E,EAAW54E,QACd,MAAM,IAAIzG,MACR,kGAGJ,MAAM++C,EAAS+yC,EAAUzS,EAAW54E,SAEpC,OADAirF,EAAsB,CAAE3yC,SAAQ18C,SACzB08C,CAAM,EAEfyuC,aAAeuE,IACbL,GAAuBD,IACrB,GAAIA,EAAoB,CACtB,MAAM,KAAEpvF,GAASovF,EACjB,MAAO,CACLpvF,OACA08C,OAAQwyC,EAAiBQ,EAAe1vF,IAAS0vF,EAErD,CACA,OAAON,CAAkB,GACzB,EAEJnE,kBAAmBA,KACbmE,GAAsBpS,EAAW54E,SAEnCu4C,EAAU8yC,EAAUzS,EAAW54E,SAAUgrF,EAAmBpvF,MAE9DqvF,EAAsB,KAAK,EAE7BjvE,SAAUkvE,EACVjvE,UAAWkvE,GAGPI,EAAgBP,GAAoB1yC,QAAUA,EAC9CkzC,GAAwB/C,EAAAA,EAAAA,KAC5BM,EAAAA,EAAAA,GACEmC,EACA9vF,OAAOq9C,WACPH,GAAQ98B,OAASuvE,EAAYvvE,QAE/ButE,EAAAA,EAAAA,GACEoC,EACA/vF,OAAOu9C,YACPL,GAAQjoC,QAAU06E,EAAY16E,SAGlC,MAAO,CACLo7E,WACyBn1E,MAAvBi1E,GAAe1uE,MAA2CvG,MAAtBi1E,GAAe7yC,IACrDgzC,MAC0Bp1E,MAAxBi1E,GAAe/vE,OAA+ClF,MAAzBi1E,GAAel7E,OACtDioC,OAAQ8yC,EAAa,IAMhBI,KACCD,IAAiBpqF,EAAAA,EAAAA,IAAQ7N,GAAmB,MAATA,GAAei4F,KAExD9G,0BAA2BpB,EAC3BmB,iCAEJ,CAEA,SAAS6G,EAAU5zE,GACjB,MAAM,KAAEoF,EAAI,IAAE67B,EAAG,MAAEl9B,EAAK,OAAEnL,GAAWoH,EAAQ87C,wBAC7C,MAAO,CAAE12C,OAAM67B,MAAKl9B,QAAOnL,SAC7B,C,4XChMA,MAAMs7E,EAAuBl8F,EAAAA,GAAO+Z,GAAI;;;EA0B3BoiF,EAA0B,GAC1BC,EAA2B,GAO3BC,EAASA,CAAAh8F,EAYpB2xD,KACiB,IAXjB,aACE3I,EAAe,OAAM,eACrBD,GAAiB,EAAK,YACtBkzC,EAAc,OAAM,SACpB/vE,EAAW4vE,EAAuB,UAClC3vE,EAAY4vE,EACZxtB,YAAa2tB,EACbj6E,QAASk6E,KACNh9F,GACQa,EAGb,MAAMk0F,GAAexrE,EAAAA,EAAAA,YAAW0zE,EAAAA,GAC1B7tB,EAAc2tB,GAAmBhI,EAAa3lB,YAC9CtsD,EAAUA,KACdk6E,MACAjI,EAAajyE,WAAW,EAEpBuB,GAAMouC,EAAAA,EAAAA,GAA6BD,GACnCu8B,EAAgCvmE,IAEjC4mD,GAAaC,UAAUt+D,SAASogF,SAAS3oE,MACzCwmE,EAAAA,EAAAA,GAAoB3qE,EAAItT,QAASyX,IAGhC,aAAE0kE,IAAiByB,EAAAA,EAAAA,GACvB,CACEn3D,QAAQ,EACR1U,UACA8rE,mBAAoBhlC,EACpBmlC,gCAEF1qE,IAMF64E,EAAAA,EAAAA,GAAmB,CACjB74E,MACA84E,uBAAyBhzF,KAEpBy/C,GACDmlC,EAA6B5kF,EAAEpB,SAE/B+Z,GACF,EAGFs6E,kBAAmBA,UAGrBnO,EAAAA,EAAAA,GAAiB,CACftjE,WAA4B,SAAhBmxE,GAA0B1tB,EAAc0tB,IAGtD,MAAM,OAAEzzC,EAAM,WAAEmzC,EAAU,+BAAEjH,IAC1BE,EAAAA,EAAAA,GAA2BpxE,EAAK,IAC3BrkB,EACH+sB,WACAC,YACA0lD,sBAAsB,IAEpB2qB,EACJjuB,GAAaC,UAAUt+D,UAAYyrF,GAC/Bc,EAAAA,EAAAA,IACE/6E,EAAAA,EAAAA,IAAS,CACPk3E,cAAerqB,EAAYC,UAAUt+D,QACrCwlC,UAAW64B,EAAY74B,YAEzBojD,EAAAA,GALF2D,CAMEj0C,GACFA,GAECjyB,EAAUla,IAAajY,EAAAA,EAAAA,WAAS,IACjC,iBAAE6/E,IAAqBC,EAAAA,EAAAA,GAAe,CAC1CC,oBAAqB9nE,KAEjB,eAAEw1C,IAAmBC,EAAAA,EAAAA,GACzB,CACEnP,qBAAqB,GAEvBn/B,IAEI,oBAAEk5E,IAAwBC,EAAAA,EAAAA,MAE1B,YAAEpI,EAAW,WAAEC,GC1HhB,SACLr1F,EACAqkB,GAEA,IAAI,KAAE23B,EAAO,UAAah8C,EACtBy9F,GAA8BC,EAAAA,EAAAA,MAYlC,OAXAD,EAAUz9F,EAAM,mBAAgBqnB,EAAYo2E,GAG5CvvF,EAAAA,EAAAA,YAAU,KACJmW,EAAItT,UAAYsT,EAAItT,QAAQogF,SAASrgD,SAASC,iBAChDqgD,EAAAA,EAAAA,GAAY/sE,EAAItT,QAClB,GACC,CAACsT,KAEJs5E,EAAAA,EAAAA,MAEO,CACLvI,YAAa,KACR5e,EAAAA,EAAAA,GAAex2E,EAAO,CAAEslF,WAAW,IACtCtpC,OACA/nC,UAAW,EACX,kBAAmBjU,EAAM,oBAAsBy9F,GAEjDpI,WAAY,CACV92E,GAAIk/E,GAGV,CD8FsCnI,CAAUt1F,EAAOqkB,GAM/CyrE,GAAS14D,EAAW,EAAI,EAE9B,OACEn3B,EAAAA,cAAC0tF,EAAAA,EAAO,KACN1tF,EAAAA,cAAC81F,EAAAA,EAA8BR,EAE7Bt1F,EAAAA,cAACu4D,EAAAA,GAAU,CAACg2B,cAAY,GACtBvuF,EAAAA,cAACw/D,EAAAA,GAAoBt/D,EAAAA,EAAAA,GAAA,CACnBkkB,IAAKA,EACL3K,MAAO,IACF2jF,EACHvN,WAEF77E,UAAW,GEtK6B,WAAoB,IAAD,IAAAm0B,EAAA7Q,UAAAjnB,OAAfstF,EAAU,IAAAroF,MAAA6yB,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAVs1D,EAAUt1D,GAAA/Q,UAAA+Q,GAChE,OAAO7oB,EAAAA,EAAAA,MACFm+E,EAAW95F,KAAK9D,IACjBkS,EAAAA,EAAAA,IAAQ7N,GAAmBgjB,MAAThjB,GAAoBrE,GAAS,MAGrD,CFiKgB69F,CACF/Y,EACApyB,EACA6qC,EACArQ,EACA6H,EAAa7H,cAAgB,CAAC,EAC9BkI,GACA5e,EAAAA,EAAAA,GAAex2E,KAGjBC,EAAAA,cAAC69F,EAAAA,EAAan9C,SAAQ,CACpBt8C,MAAO,CACL+yB,WACA6+D,QAA0B,SAAjBpsC,EACTwrC,eAGFp1F,EAAAA,cAACy8F,EAAoB,KAAE18F,EAAMe,UACX,QAAjB8oD,GAA0B5pD,EAAAA,cAACi2F,EAAAA,EAAoB,UAKhD,EAID3sC,EAAQtlD,OAAOyqE,OAAOzuE,EAAAA,WAAiB48F,GAAS,CAC3D9yC,OAAQg0C,EAAAA,EACRj0C,OAAQmE,EAAAA,EACR9kC,KAAM60E,EAAAA,IACLnB,EAAAv8F,aAAA,k6D,sEG3MI,MAAMw9F,GAAevK,EAAAA,EAAAA,eAIzB,CAAEn8D,UAAU,EAAO6+D,SAAS,EAAMZ,WAAY,CAAC,IAMrC4H,GAAyB1J,EAAAA,EAAAA,eAIpC,CAAC,E,oHCTH,MAAM0K,EAAoBz9F,EAAAA,GAAO+Z,GAG9B;;;;;;gBAMa1Z,IAAA,IAAC,YAAEmpD,GAAanpD,EAAA,OAAKmpD,GAAe,SAAS;;;WAGlDv8C,IAAA,IAAC,MAAE5I,EAAK,OAAEoY,GAAQxP,EAAA,OACzBwP,EACIpY,EAAM0U,MACJ,gCACA1U,EAAM8V,aAAaisE,iBAErB/hF,EAAM0U,MACJ,kCACA1U,EAAM8V,aAAaujF,wBACpB;sBACaxuF,IAAA,IAAC,MAAE7K,EAAK,OAAEoY,GAAQvN,EAAA,OACpCuN,EACIpY,EAAM0U,MAAM,gCAAiC,WAC7C1U,EAAM0U,MAAM,kCAAoC,UAAS;EAepDwkF,EAAc1tF,IAUpB,IAVqB,SAC1BtP,EAAQ,YACRipD,EAAW,UACXorB,EAAS,MACT17D,GAMDrJ,EACC,MAAM,SAAE+mB,EAAQ,QAAE6+D,EAAO,WAAEZ,IAAe9rE,EAAAA,EAAAA,YAAWu0E,EAAAA,GAC/CK,EAAe,SAAChrC,GAA4C,YAAL,IAAvCA,IAAAA,EAA0C,CAAC,GAC/DlzD,EAAAA,cAACg+F,GAAiB99F,EAAAA,EAAAA,GAAA,CAChB8c,OAAQma,EACR4yB,YAAaA,EACborB,UAAWA,EACX17D,MAAOA,IACH+F,EAAAA,EAAAA,GAAW41E,EAAYliC,IAE1BpyD,EACiB,EAEtB,OAAOk1F,EACLh2F,EAAAA,cAAC0yE,EAAAA,EAAiB,MACf5+D,IAAA,IAAC,gBAAEg/D,GAAiBh/D,EAAA,OAAKoqF,EAAaprB,EAAgB,IAGzDorB,GACD,EACDJ,EAAAz9F,aAAA,utB,+FCzEF,MAAM89F,EAAoB59F,EAAAA,GAAO+Z,GAAI;;;;EAK/B8jF,EAA0B79F,EAAAA,GAAO+Z,GAAI;;EAGrC+jF,EAA2B99F,EAAAA,GAAO+Z,GAAI;;;;;;;;EAStCgkF,EAA0B/9F,EAAAA,GAAO+Z,GAAI;;EAOpC,SAAS0zC,EAAWptD,GAiBvB,IAjBwB,OAC1BqsB,EAAM,OACNQ,EAAM,QACNhkB,GAcD7I,EACC,OACEZ,EAAAA,cAACm+F,EAAiB,KACflxE,GACCjtB,EAAAA,cAACo+F,EAAuB,KACH,iBAAXnxE,EACNjtB,EAAAA,cAAC89F,EAAAA,EAAW,KAAE7wE,GAEdA,GAINjtB,EAAAA,cAACq+F,EAAwB,KAAE50F,GAC1BgkB,GACCztB,EAAAA,cAACs+F,EAAuB,KACH,iBAAX7wE,EACNztB,EAAAA,cAAC+9F,EAAAA,EAAe,KAAEtwE,GAElBA,GAMZ,CAACugC,EAAA3tD,aAAA,ipB,iFC9CD,MAMMk+F,EAAgBv+F,EAAAA,cAAqC,CACzD8Z,KAPuBs7D,KACvB,MAAM,IAAI/qE,MACR,yGACD,IAUUi9D,EAAkBA,KAAuBh+C,EAAAA,EAAAA,YAAWi1E,GAYpD3yB,EAA4ChrE,IAAmB,IAAlB,SAAEE,GAAUF,EACpE,MAAO49F,EAAQC,IAAaz5F,EAAAA,EAAAA,UAA8B,IACpD8xF,GAAYjmF,EAAAA,EAAAA,QAAe,GAE3B8kE,GAAMhyD,EAAAA,EAAAA,UAAyB,KAkB5B,CACL7J,KAlBqCw1C,IACrCwnC,EAAUhmF,UACV,MAAMsD,EAAQA,KACZqqF,GAAWC,GACTA,EAAczsF,QAAQ0sF,GAAWA,IAAWC,KAC7C,EAEGA,EACJ5+F,EAAAA,cAACg9F,EAAAA,EAAuBt8C,SAAQ,CAC9Bv8C,IAAK2yF,EAAUhmF,QACf1M,MAAO,CAAEye,QAASzO,IAEA,mBAAVk7C,EAAuBA,EAAM,CAAEl7C,UAAWk7C,GAGtDmvC,GAAWC,GAAkBA,EAAcn7F,OAAOq7F,IAAc,KAKjE,IAEH,OACE5+F,EAAAA,cAACu+F,EAAc79C,SAAQ,CAACt8C,MAAOuxE,GAC5B70E,EACA09F,EACsB,EAE3B5yB,EAAAvrE,aAAA,mN,8HCxDK,MAAM+uD,EAAepvD,EAAAA,YAAiB,SAAqBY,EAEhE2xD,GACC,IAFD,UAAEjc,EAAS,SAAEx1C,EAAQ,MAAEwuD,KAAUvvD,GAA0Ba,EAG3D,MAAMiN,GAAQqnF,EAAAA,EAAAA,GAAuBn1F,GAC/Bi/E,GAAaxsB,EAAAA,EAAAA,GAAaD,IAC1B,aAAE06B,EAAY,aAAEqD,IAAiBuO,EAAAA,EAAAA,GACrC,CAAEnyF,KAAM3M,EAAM2M,MAAQ,QACtBmB,EACAmxE,GAEF,OACEh/E,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC8+F,EAAAA,GAAc5+F,EAAAA,EAAAA,GAAA,CAACkkB,IAAK46D,GAAgBsR,GAClCxvF,GAEF+M,EAAM0pB,QACLv3B,EAAAA,cAACg9F,EAAAA,EAAuBt8C,SAAQ,CAC9Bt8C,MAAO,CACL6oF,eACA9d,YAAa,CACXC,UAAW4P,EACX1oC,aAEFzzB,QAAShV,EAAMuG,QAGC,mBAAVk7C,EAAuBA,EAAM,CAAEl7C,MAAOvG,EAAMuG,QAAWk7C,GAKzE,IAAGF,EAAA/uD,aAAA,2yB,+DCxDI,MAAMm/D,E,SAAuBj/D,GAAO+Z,GAAI;;;;sBAIzB1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,eAAe;WACrD9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;IAEjD8oD,EAAAA;iDCJG,MAAM27B,E,SAAkBx9F,GAAO+Z,GAAI;;;;;;gBAM1B1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACtBgE,EAAM0U,MACJ,8BACA1U,EAAM0U,MAAM,0CACb;WACM9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACjB5I,EAAM0U,MACJ,8BACA1U,EAAM0U,MAAM,0CACb;;;;;;;8JC+DE,MAAM4mC,EAAct/C,IAgBkB,IAhBjB,MAC1BwD,EAAQ,EAAC,SACT+lD,EAAW,IAAG,SACd40C,EAAW,EAAC,KACZ55F,EAAI,aACJqlD,EAAe,MAAK,QACpBP,EAAO,iBACPC,EAAgB,OAChBjP,EAAM,MACN3uB,EAAK,MACLi+B,EAAK,UACL4qB,EAAS,MACT17D,EAAK,WACLulF,EAAU,eACVC,EAAiBlyC,QAAQiyC,MACtBj/F,GACca,EACjB,MAAM,iBAAEs+F,EAAgB,WAAEzgB,IAAe0gB,EAAAA,EAAAA,GAAe,IACnDp/F,EACHg4C,MAAO5yC,EACPf,QACA46F,aACA70C,WACA40C,aAEIK,GAAqBh7F,EAAQ+lD,EAAf,KAA0B24B,QAAQ,IAC/Cuc,EAAeC,IAAoBt6F,EAAAA,EAAAA,UAAwB,KAC3Dwb,EAAS++E,IAAcv6F,EAAAA,EAAAA,UAAwB,IAEhDw6F,GAAsC77E,EAAAA,EAAAA,UAC1C,MACE27E,mBACAC,gBAEF,IAEIxnD,EACJ/3C,EAAAA,cAACy/F,EAA2BhhB,EAAat5E,GAErCu6F,EAAmBz1C,EAAUzpC,GAAW6+E,GAAiBp1C,EAAU,KACzE,OACEjqD,EAAAA,cAAC2/F,EAA0B,CAAClmF,MAAOA,EAAO07D,UAAWA,GACjC,QAAjB3qB,GAA0BzS,EAC3B/3C,EAAAA,cAAC4/F,EAA8B,CAC7Br1C,MAAOA,EACPs1C,aAAc9yC,QAAQ5nD,IAA0B,QAAjBqlD,EAC/Bs1C,gBAAiB/yC,QAAQ2yC,IAEP,SAAjBl1C,GAA2BzS,EAC5B/3C,EAAAA,cAAC+/F,GAAsB7/F,EAAAA,EAAAA,GAAA,CACrBuZ,MAAO,CAAE6S,UACL4yE,EAAgB,CACpBc,cAAejgG,EAAMikC,mBAEnBjkC,EAAMikC,iBACNhkC,EAAAA,cAACigG,EAAyB,CAACxmF,MAAO,CAAE6S,MAAQ,GAAE8yE,SAGjDH,GAAkBj/F,EAAAA,cAAA,YAAOg/F,GAAe,GAAEI,MAC3Cp/F,EAAAA,cAACkgG,EAAmBx/C,SAAQ,CAACt8C,MAAOo7F,GACjCvkD,IAGLj7C,EAAAA,cAACmgG,EAAwB,KAAET,GAC3B1/F,EAAAA,cAACmgG,EAAwB,KAAEj2C,GACA,EAI3Bg2C,EAAqBlgG,EAAAA,cACzB,MAGI2/F,EAA6Bp/F,EAAAA,GAAO+Z,GAAI;WACnC9M,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM8V,aAAaisE,eAAe;;EAItDiZ,EAAiCr/F,EAAAA,GAAO+Z,GAI3C;;;SAGM7K,IAAA,IAAC,MAAE86C,GAAO96C,EAAA,OAAM86C,EAAQ,SAAW,UAAU;;;;;gBAKtCn6C,IAAA,IAAC,aAAEyvF,GAAczvF,EAAA,OAAKyvF,GAAgB,UAAU;mBAC7C/rF,IAAA,IAAC,gBAAEgsF,GAAiBhsF,EAAA,OAAKgsF,GAAmB,SAAS;EAGlEL,EAAyBl/F,EAAAA,GAAO+Z,GAAI;;;;EAMpC6lF,EAA2B5/F,EAAAA,GAAO+Z,GAAI;WACjC9F,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,OAAK5P,EAAM8V,aAAa8lE,qBAAqB;;;;;;EAQ5Duf,EAAyBx/F,EAAAA,GAAO+Z,GAAiC;;;;;;;;;;gBAUvD7F,IAAA,IAAC,MAAE7P,GAAO6P,EAAA,OACtB7P,EAAM0U,MACJ,yBACA1U,EAAMK,KAAO,gBAAkB,mBAChC;IACD0P,IAAA,IAAC,cAAEqrF,GAAerrF,EAAA,OAClBqrF,GACAx+F,EAAAA,EAAI;;;UAGE4+F;UACAC;UACAD;;;yBAGeE;KACpB;EAGCF,EAA6BvrF,IAAA,IAAC,MAAEjQ,GAAyBiQ,EAAA,OAC7DjQ,EAAM0U,MAAM,sCAAsC,EAC9C+mF,EAA2BjmE,IAAA,IAAC,MAAEx1B,GAAyBw1B,EAAA,OAC3Dx1B,EAAM0U,MAAM,oCAAoC,EAE5CgnF,GAAmCC,EAAAA,EAAAA,IAAS,+DAS5CN,EAA4B1/F,EAAAA,GAAO+Z,GAAI;;gBAE7BggB,IAAA,IAAC,MAAE11B,GAAO01B,EAAA,OACtB11B,EAAM0U,MACJ,4BACA1U,EAAMK,KAAO,mBAAqB,mBACnC;EAWE,SAASu7F,EAAwBvlE,EAEtC7W,GACC,IAFD,QAAEhK,EAAO,aAAEqmF,GAA0CxlE,EAGrD,MAAM,YAAEm7C,IAAgBC,EAAAA,EAAAA,GACtB,CACEj8D,UACA87D,YAAa,OACb3yB,qBAAqB,EAErBvW,qBAAqB,GAEvB5oB,GAEI5H,GAAU8M,EAAAA,EAAAA,YAAW42E,IACrB,WAAExT,EAAU,UAAEgU,IAAc/T,EAAAA,EAAAA,GAAS,CAAC,GAI5C,OAHA1+E,EAAAA,EAAAA,YAAU,KACRuO,GAAS+iF,WAAWmB,EAAYD,EAAe,KAAK,GACnD,CAACA,EAAcC,IACX,CACLtqB,aAAa52D,EAAAA,EAAAA,GAAW42D,EAAasW,GAEzC,CAKO,SAASiU,EAA6BtlE,EAE3CjX,GACC,IAFD,OAAEw8E,KAAW7gG,GAAyDs7B,EAGtE,MAAM7e,GAAU8M,EAAAA,EAAAA,YAAW42E,GAI3B,OAHAjyF,EAAAA,EAAAA,YAAU,KACRuO,GAAS8iF,iBAAiBsB,EAAS,SAAW,KAAK,GAClD,CAACA,IACGJ,EAAyBzgG,EAAOqkB,EACzC,CAeA87B,EAAYyK,UAAYg1C,EACxBz/C,EAAY2gD,MAAQpB,EACpBv/C,EAAY4gD,cAAgBlB,EAC5B1/C,EAAY6gD,MAAQhB,EACpB7/C,EAAY8gD,SAAWf,EACvB//C,EAAY+gD,QAAUd,EAAyBjgD,EAAA7/C,aAAA,4/F,8FCtSxC,MAAM+pD,EAAwBxpD,IAGA,IAHC,MACpCoqD,EAAK,QACL5wC,GAC6BxZ,EAC7B,MAAMwjB,GAAMvT,EAAAA,EAAAA,QAAwB,OAC9B,YAAEulE,IAAgBoqB,EAAAA,EAAAA,IACtB,CAAEpmF,UAASqmF,aAAc,UACzBr8E,GAEF,OACEpkB,EAAAA,cAACu7C,EAAAA,GAAqBr7C,EAAAA,EAAAA,GAAA,CACpBkkB,IAAKA,GACDgyD,EAAW,CACfr8D,KAAO,eAAcixC,EAAQ,QAAU,SACvCnP,UAAY,eAAcmP,EAAQ,QAAU,kBAC5C,EAEJZ,EAAA/pD,aAAA,4Y,kFCDK,MAAM6gG,EAAgBtgG,IAAA,IAAC,SAC5BE,EAAQ,KACRgM,EAAI,SACJykF,EAAQ,iBACR4P,EAAmB,WAChBphG,GACgBa,EAAA,OACnBZ,EAAAA,cAACovC,EAAAA,GAAiBlvC,EAAAA,EAAAA,GAAA,GACU,UAArBihG,EACD,CAAEtmD,UAAW/5C,EAAU45C,UAAW5tC,EAAM6tC,cAAe42C,GACvD,CAAEhiD,SAAUzuC,EAAU0uC,SAAU1iC,EAAM2iC,aAAc8hD,GACpDxxF,GACJ,EACFmhG,EAAA7gG,aAAA,+qC,8FCnCK,MAAM44F,EAAoDr4F,IAK1D,IAL2D,SAChE2wF,EAAQ,YACRqH,EAAW,gBACXD,KACG54F,GACJa,EACC,MAAM,aAAEwgG,IAAiBC,EAAAA,EAAAA,IAAiB,CACxC9P,WACAqH,cACAD,oBAEF,OAAO34F,EAAAA,cAACshG,EAAAA,GAAephG,EAAAA,EAAAA,GAAA,CAACkhG,aAAcA,GAAkBrhG,GAAS,EACjEk5F,EAAA54F,aAAA,qO,kFCfF,MAAMkhG,EAA0BhhG,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,6CAAAC,YAAA,eAAVH,CAAU,4DAQpCihG,EAA8BjhG,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,iDAAAC,YAAA,eAAVH,CAAU,kEAKlCK,IAAA,IAAC,OAAEsnF,GAAQtnF,EAAA,MAAM,GAAEsnF,UAAe,IACnC16E,IAAA,IAAC,WAAEi0F,GAAYj0F,EAAA,MAAM,eAAci0F,MAAe,IAEnDhyF,IAAA,IAAC,WAAEgyF,GAAYhyF,EAAA,MAAM,IAAGgyF,EAAa,KAAK,IAQvCC,EAA0DtxF,IAQhE,IARiE,aACtEuxF,EAAe,GAAE,WACjB/9E,EAAU,KACV9W,EAAO,EAAC,OACRo7E,EAAS,MAAK,SACdpnF,EAAQ,MACR2Y,EAAQ,CAAC,EAAC,aACV2nF,GACDhxF,EACC,OACEpQ,EAAAA,cAACuhG,GAAuBrhG,EAAAA,EAAAA,GAAA,GAClBkhG,EAAY,CAChB3nF,MAAO,IAAKA,EAAOmK,aAAY0I,MAAOxf,KAErChM,EACDd,EAAAA,cAACwhG,EAA2B,CAACC,WAAYE,EAAczZ,OAAQA,IACvC,EAE5BwZ,EAAArhG,aAAA,se,4FCvCK,MAAM04F,EAAoDn4F,IAK1D,IAL2D,SAChE2wF,EAAQ,YACRqH,EAAW,gBACXD,KACG54F,GACJa,EACC,MAAM,aAAEwgG,IAAiBQ,EAAAA,EAAAA,IAAe,CACtCrQ,WACAqH,cACAD,oBAEF,OAAO34F,EAAAA,cAAC0hG,EAAAA,GAAiBxhG,EAAAA,EAAAA,GAAA,CAACkhG,aAAcA,GAAkBrhG,GAAS,EACnEg5F,EAAA14F,aAAA,qO,6FCZK,MAAMy4F,EAAqDl4F,IAK3D,IAL4D,SACjE2wF,EAAQ,YACRqH,EAAW,gBACXD,KACG54F,GACJa,EACC,MAAM,aAAEwgG,IAAiBS,EAAAA,EAAAA,IAAgB,CACvCtQ,WACAqH,cACAD,oBAEF,OAAO34F,EAAAA,cAAC0hG,EAAAA,GAAiBxhG,EAAAA,EAAAA,GAAA,CAACkhG,aAAcA,GAAkBrhG,GAAS,EACnE+4F,EAAAz4F,aAAA,uO,8FCZK,MAAM24F,EAAiDp4F,IAKvD,IALwD,SAC7D2wF,EAAQ,YACRqH,EAAW,gBACXD,KACG54F,GACJa,EACC,MAAM,aAAEwgG,IAAiBU,EAAAA,EAAAA,IAAc,CACrCvQ,WACAqH,cACAD,oBAEF,OAAO34F,EAAAA,cAACshG,EAAAA,GAAephG,EAAAA,EAAAA,GAAA,CAACkhG,aAAcA,GAAkBrhG,GAAS,EACjEi5F,EAAA34F,aAAA,kO,mFCfF,MAAM0hG,EAAwBxhG,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,yCAAAC,YAAA,gBAAVH,CAAU,sDAOlCyhG,EAA4BzhG,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,6CAAAC,YAAA,gBAAVH,CAAU,iEAKhCK,IAAA,IAAC,OAAEsnF,GAAQtnF,EAAA,MAAM,GAAEsnF,UAAe,IAClC16E,IAAA,IAAC,WAAEi0F,GAAYj0F,EAAA,MAAM,eAAci0F,MAAe,IAErDhyF,IAAA,IAAC,WAAEgyF,GAAYhyF,EAAA,MAAM,IAAGgyF,EAAa,KAAK,IAQtCH,EAAsDlxF,IAAA,IAAC,aAClEuxF,EAAe,GAAE,WACjB/9E,EAAU,KACV9W,EAAO,EAAC,OACRo7E,EAAS,MAAK,aACdkZ,EAAY,SACZtgG,EAAQ,MACR2Y,EAAQ,CAAC,GACVrJ,EAAA,OACCpQ,EAAAA,cAAC+hG,GAAqB7hG,EAAAA,EAAAA,GAAA,GAChBkhG,EAAY,CAChB3nF,MAAO,IAAKA,EAAOmK,aAAYzC,OAAQrU,KAEtChM,EACDd,EAAAA,cAACgiG,EAAyB,CAACP,WAAYE,EAAczZ,OAAQA,IACvC,EACxBoZ,EAAAjhG,aAAA,ke,2FC/BF,MAAM4hG,EAAaA,CACjBtnE,EACAunE,EAAethG,KAEX,IADJ,gBAAE+3F,EAAe,SAAEpH,EAAQ,YAAEqH,GAA8Bh4F,EAa3D,MAAO,CACLwgG,cAZYtJ,EAAAA,EAAAA,GAAQ,CACpBnlB,cAAe,EACfolB,YAAaA,IAAMY,KAAqB,EACxCR,UAAWA,IAAMS,MACjBZ,OAAQxqF,IAAA,IAAC,SAAE0qF,EAAQ,WAAED,GAAYzqF,EAAA,OAC/B+jF,EACE0G,GACGiK,GAAU,EAAI,GACbhK,EAAyB,eAAhBv9D,EAA+B,IAAM,KACnD,IAIJ,EAGUinE,EAAkB7hG,GACtBkiG,EAAW,cAAc,EAAMliG,GAG3B8hG,EAAmB9hG,GACvBkiG,EAAW,cAAc,EAAOliG,GAG5B+hG,EAAiB/hG,GACrBkiG,EAAW,YAAY,EAAMliG,GAGzBshG,EAAoBthG,GACxBkiG,EAAW,YAAY,EAAOliG,E,6OCkBvC,MAAMi5D,GAAcz4D,EAAAA,EAAAA,IAAO+xD,EAAAA,EAAO;;;;;;;;;;EA+BrB7Q,EAAczhD,EAAAA,YAAiB,SAAoBY,EAgB9D2xD,GACC,IAhBD,YACEoyB,EAAW,WACXthC,EAAU,cACVlB,EAAa,QACb1G,EAAO,SACPvuB,EAAQ,sBACRi1E,EAAqB,mBACrBC,EAAqB,gBACrBh+F,MAAOq+D,EAAS,aAChBj0D,EAAe,GAAE,SACjBgU,EAAQ,KACR9V,EAAO,SACP02C,SAAUu6B,KACP59E,GACca,EAGnB,MAAOwD,EAAOsM,IAAYkyD,EAAAA,EAAAA,GACxBH,EACAj0D,EACAgU,GAEI6/E,GAAoB7vC,EAAAA,EAAAA,GAAaD,GACjCnP,GAAWoP,EAAAA,EAAAA,GAAamrB,IACvB2kB,EAAqBC,IAAwBv9F,EAAAA,EAAAA,WAAS,GACvDw9F,EAA4C,CAChDlkF,GAAIvD,EAAAA,EAAeqzD,oBACnBp0D,MAAOooF,EACPzjF,gBAAiBA,KACf4jF,GAAqB,EAAK,GAKxBrnF,GAAcC,EAAAA,EAAAA,KACdsnF,EAAatgD,EACjBniD,EAAAA,cAAC27C,EAAAA,EAAW,CACVpkB,OAAQ+qE,EACRjzC,aAAckzC,EACdlS,qBAAsBgS,EACtB3iF,WAAYlS,IAAA,IAAC,UAAE0V,GAAW1V,EAAA,OACxBxN,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACbC,UAAU,QACVvD,SAAWzb,IACT,MAAMu+F,EACJvgD,EAAcwgD,SAAU,GAAEx+F,IAAMpB,MAAM,KAAK,UACrBqkB,IAApBs7E,IACFhyF,EAASgyF,GACTP,IAAwBO,EAAiBt+F,GACzCg/C,EAAStyC,SAAS0C,QACpB,IAGD2uC,EAAct+C,KAAI,CAAC++F,EAAaxvF,IAC/BpT,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAM,GAAEiP,KAASwvF,KAAgBA,KAEpC,IAGR,CAAClnD,EAAkBt3B,IAClBpkB,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QACExgB,EAAAA,cAACygB,EAAAA,EAAa,CACZC,WAAY0hF,EACZj7E,SAAUjM,EAAYH,EAAAA,EAAeqzD,yBAIvCruB,GACA//C,EAAAA,cAAC0e,EAAAA,IAAYxe,EAAAA,EAAAA,GAAA,IACPsf,EAAAA,EAAAA,GAAWugC,EAAqBrE,GAAiB,CACrDt3B,IAAKA,EACLrK,KAAK,gCACLgiC,KAAK,SACL,aAAYqmD,SAOtBpiG,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,uBAEf43E,EAAQA,KACZjhF,EAAS,IACT+qC,IAAUr3C,EAAM,EAEZogE,GAAahlD,EAAAA,EAAAA,GAA2Czf,EAAO,CACnEqkB,IAAKi+E,EACLj/C,WACAh/C,QACAsI,OACA8V,SAAW/F,IACT/L,EAAS+L,EAAM3T,OAAO1E,MAAM,EAE9BugF,YACE3kF,EAAAA,cAAAA,EAAAA,SAAA,KACGyiG,EACA9d,GAGLthC,WACErjD,EAAAA,cAAAA,EAAAA,SAAA,KACGoE,GACCpE,EAAAA,cAACu7C,EAAAA,EAAqB,CACpBU,QAAS01C,EACT51C,KAAK,SACL,aAAW,eACXhiC,KAAK,gBACL8hC,UAAU,yBAGbwH,GAGLohB,UAAYhoD,IACNA,EAAM0wD,SAGQ,UAAd1wD,EAAMtY,IACR+oB,IAAWzQ,EAAMvL,cAAc9M,OACR,WAAdqY,EAAMtY,KACfwtF,IACF,IAGJ,OAAIxvC,EAEAniD,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAAS,CAACsoF,KACxB/yF,IAAA,IAAC,qBAAE6P,GAAsB7P,EAAA,OACxBzP,EAAAA,cAACg5D,GAAgBx5C,EAAAA,EAAAA,GAAWglD,EAAYllD,GAAyB,IAKlEtf,EAAAA,cAACg5D,EAAgBwL,EAC1B,IAAG/iB,EAAAphD,aAAA,i7G,oHC3NH,MAAMwiG,GAAmBtiG,EAAAA,EAAAA,IAAOme,EAAAA,GAAc;;EAIxCokF,EAAyBviG,EAAAA,GAAOy+B,IAA4B;;;;gBAIlDp+B,IAAA,IAAC,MAAEgE,EAAK,QAAEm+F,GAASniG,EAAA,OAC/BmiG,EACIn+F,EAAM0U,MACJ,8BACA1U,EAAMK,KAAO,UAAY,WAE3BL,EAAM0U,MACJ,uBACD;WACE9L,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACjB5I,EAAM0U,MACJ,uBACD;;;sBAGiB7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAMo+F,iBAAgB,GAAM,EAAM;mBACpD5yF,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACvBxL,EAAMR,MAAM,kBAA+B,GAAK,CAAC;EAEjD6+F,EAAmB1iG,EAAAA,GAAOy+B,IAAK;;;EAUxB+yD,EAAmB/xF,EAAAA,YAG9B,CAAA8T,EAAqCsQ,KAAS,IAA7C,OAAEpH,EAAM,MAAEuqB,EAAK,SAAEzmC,EAAQ,MAAE6wF,GAAO79E,EACnC,MAAMovF,GAAiBryF,EAAAA,EAAAA,QAAoB,OACrC,YAAEulE,IAAgBC,EAAAA,EAAAA,GACtB,CACEH,YAAa,OACb,aAAc,eACd3yB,qBAAqB,EAErBvW,qBAAqB,EACrB5yB,QAASu3E,GAEXuR,GAIF,OAAOlmF,EACLhd,EAAAA,cAAC8iG,EAAsB,CAAC1+E,IAAKA,EAAK2+E,SAAUx7D,GAC1CvnC,EAAAA,cAAC6iG,EAAgB,CAAC9oF,KAAM,mBACxB/Z,EAAAA,cAACijG,EAAgB,MACbniG,GAAY,IAAIsE,QAAQ,KAAM,SAEjCtE,GACCd,EAAAA,cAACu7C,EAAAA,GAAqBr7C,EAAAA,EAAAA,GAAA,GAChBk2E,EAAW,CACfhyD,IAAK8+E,EACLnpF,KAAK,gBACL8hC,UAAU,2BAId,IAAI,IACPk2C,EAAA1xF,aAAA,6M,oFC7EH,MAAMwiG,GAAmBtiG,EAAAA,EAAAA,IAAOme,EAAAA,GAAc;;;EAUjCykF,EAAmBnjG,EAAAA,YAG9B,CAAAY,EAA8BwjB,KAAG,IAAhC,OAAEpH,EAAM,MAAEuqB,EAAK,SAAEzmC,GAAUF,EAAA,OAC5Boc,EACEhd,EAAAA,cAACojG,EAAsB,CAACh/E,IAAKA,EAAK2+E,SAAUx7D,GAC1CvnC,EAAAA,cAAC6iG,EAAgB,CAAC9oF,KAAM,oBACtBjZ,GAAY,IAAIsE,QAAQ,KAAM,SAEhC,IAAI,IAGJg+F,EAAyB7iG,EAAAA,GAAOy+B,IAA4B;;;;gBAIlDxxB,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACtB5I,EAAM0U,MACJ,yBACA1U,EAAMK,KAAO,mBAAqB,OACnC;;MAECwK,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACV7K,EAAM0U,MACJ,0BACA1U,EAAMK,KAAO,kBAAoB,qBAClC;WACImL,IAAA,IAAC,QAAE2yF,EAAO,MAAEn+F,GAAOwL,EAAA,OAC1B2yF,EACIn+F,EAAM0U,MAAM,8BAA+B1U,EAAM8V,aAAaykB,KAC9Dv6B,EAAM0U,MACJ,yBACA1U,EAAM8V,aAAa2oF,kBACpB;;;;;;EAMPF,EAAA9iG,aAAA,uL,sEClCK,SAASijG,EAAa1iG,GAMzB,IAN0B,MAC5BwD,EAAK,SACLoe,GAID5hB,EACC,MAAM2iG,GAAW1yF,EAAAA,EAAAA,QAAOzM,GACxBm/F,EAASzyF,QAAU1M,EAqBnB,MAAO,CAAEqgE,UApBUhoD,IACjB,KACGA,EAAM+mF,SACN/mF,EAAMqE,QACNrE,EAAMgnF,SACJhnF,EAAM3T,kBAAkBioC,cArCN2yD,EAsCAjnF,EAAM3T,OA/B7B46F,EAAKC,mBACJD,aAAgBE,mBAP4C,CAC7D,WACA,QACA,UAKyB/0F,SAAS60F,EAAKh3F,OACvCg3F,aAAgBvpC,sBA6Bd,CACA,GAAyB,IAArB19C,EAAMtY,IAAIkM,OAIZ,OADAoM,EAAMgF,iBACCe,EAAU,GAAE+gF,EAASzyF,UAAU2L,EAAMtY,OAE9C,GAAkB,cAAdsY,EAAMtY,IAAqB,CAC7B,MAAM0/F,EAAWpnF,EAAMgnF,QAAU,GAAK,EACtCjhF,EAAS+gF,EAASzyF,QAAQoB,MAAM,EAAG2xF,GACrC,CACF,CAlDJ,IAA2BH,CAkDvB,EAGJ,C,gDCzBO,SAAS/oB,EACd56E,GAEA,MAAOid,EAAQC,IAAa2lD,EAAAA,EAAAA,GAC1B7iE,EAAM4lD,eACN5lD,EAAM+jG,wBAAyB,EAC/B/jG,EAAMgkG,yBAED/+C,EAAYC,IAAiB2d,EAAAA,EAAAA,GAClC7iE,EAAMilD,WACNjlD,EAAMikG,mBAAqB,GAC3BjkG,EAAMylD,oBAGR,MAAO,CACLxoC,SACAgoC,aACA/nC,YACAgoC,gBACA0sC,MAAOA,KACL1sC,EAAc,IACdhoC,GAAU,EAAM,EAGtB,CAcO,SAAS49D,EAAcj6E,EAAA4M,EAG5B4W,GACC,IAHD,uBAAEqhC,GAA0C7kD,GAC5C,WAAEokD,EAAU,OAAEhoC,EAAM,UAAEC,EAAS,cAAEgoC,GAAiCz3C,EAGlE,MAAQi3D,UAAWw/B,GAAsBX,EAAc,CACrDl/F,MAAO4gD,EACPxiC,SAAWpe,IACT,MAAM8/F,EAAe9/F,EAAM+/F,YAC3Bl/C,EAAci/C,GACTlnF,GAA2B,KAAjBknF,GACbjnF,GAAU,EACZ,IAGE00E,EAAQA,KACZ1sC,EAAc,IACdhoC,GAAU,EAAM,GAIhBk6D,eAAe,UAAE1S,EAAS,QAAE2/B,KAC1BhtB,EAAAA,EAAAA,GAAY,CACd3S,UAAYv6D,IACLka,EAAItT,SAASogF,SAAShnF,EAAEpB,UAIf,MAAVoB,EAAE/F,MAAgB+F,EAAEu5F,SAAWv5F,EAAEs5F,UACnCt5F,EAAEuX,iBAEU,WAAVvX,EAAE/F,IACJwtF,IAEAsS,EAAkB/5F,GASf8S,KAAUq6D,EAAAA,EAAAA,GAAentE,IAC5BA,EAAEutE,sBACJ,KAKFoN,kBAAkB,QAAE5zE,EAAO,OAAEE,KAC3B2zE,EAAAA,EAAAA,GAAe,CACjBuf,aAAe5nF,KAEyB,mBAA3BgpC,EACLA,EAAuBhpC,GACvBgpC,IAEJksC,GACF,IAIJ,MAAO,CACL3wE,eAAgB,CACd/P,UACAE,SACAszD,YACA2/B,WAGN,C,yEC3HO,MAAMz0C,EAAY/uD,IAGkB,IAHjB,KACxB+sB,EAAI,MACJC,GACehtB,EACf,OACEZ,EAAAA,cAACskG,EAAe,CACdhrC,YAAcpvD,IAGZA,EAAEuX,gBAAgB,GAGpBzhB,EAAAA,cAACukG,EAAmB,KAAE52E,GACtB3tB,EAAAA,cAACwkG,EAAoB,KAAE52E,GACP,EAIhB02E,EAAkB/jG,EAAAA,GAAO+Z,GAAI;;;;;;;sBAOb9M,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAC5B5I,EAAM0U,MACJ,uBACA1U,EAAM0U,MAAM,sBACT,MAAM;WACJ7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACjB7K,EAAM0U,MACJ,8BACA1U,EAAM8V,aAAaisE,gBACpB;;MAECv2E,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OAAKxL,EAAM0U,MAAM,wBAAyB,qBAAqB;;;;;EAOzEmrF,EAAyBlkG,EAAAA,GAAO+Z,GAAI;;;;EAMpCkqF,GAAuBjkG,EAAAA,EAAAA,IAAOkkG,EAAwB;;EAGtDF,GAAsBhkG,EAAAA,EAAAA,IAAOkkG,EAAwB;;;;EAIzD90C,EAAAtvD,aAAA,0nB,+HCvDK,MAAMkvD,EAAkBvvD,EAAAA,YAAiB,SAC9CD,EACAwyD,GAEA,MAAMnuC,GAAMouC,EAAAA,EAAAA,GAAaD,IAEnB,WAAE2xB,EAAU,UAAEhiD,IAAciiD,EAAAA,EAAAA,GAAS,CACzC//D,SACGrkB,EACHitC,qBAAqB,KAEjB,eAAEylB,IAAmBC,EAAAA,EAAAA,GAAa,CAAEnP,qBAAqB,GAAQn/B,GAEjEsgF,EAAgB3kG,EAAMg4C,MACxB4sD,EACAC,EACJ,OACE5kG,EAAAA,cAAC0kG,GAAaxkG,EAAAA,EAAAA,GAAA,IACRsf,EAAAA,EAAAA,GAAW0kE,EAAYzxB,GAAe,CAC1C0iB,UAAWjzC,EAAY,UAAY,GACnC9d,IAAKA,IAEJrkB,EAAMga,KACNha,EAAMga,MAAQha,EAAMg4C,OACnB/3C,EAAAA,cAAAA,EAAAA,SAAA,KAAE,QAEHD,EAAMg4C,MAGb,IAEM4sD,EAAwBpkG,EAAAA,GAAOy+B,IAAK;;;aAG7Bp+B,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACnBgE,EAAM24E,MACJ,kCACG,YAAY;;;;wBAIG/vE,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAC5B5I,EAAM0U,MACJ,mCACA1U,EAAM0U,MAAM,+BAAgC,WAC7C;aACM7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACjB7K,EAAM0U,MACJ,mCACA1U,EAAM8V,aAAaisE,gBACpB;;;wBAGiBv2E,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OAC5BxL,EAAM0U,MACJ,qCACA1U,EAAM0U,MAAM,iCAAkC,WAC/C;aACMxF,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACjBlP,EAAM0U,MACJ,qCACA1U,EAAM8V,aAAaisE,gBACpB;;EAIDie,GAA4BrkG,EAAAA,EAAAA,IAAOokG,EAAuB;aACnDnwF,IAAA,IAAC,MAAE5P,GAAO4P,EAAA,OACnB5P,EAAM24E,MACJ,kCACG,WAAW;EAClBhuB,EAAAlvD,aAAA,me,kFC/EF,MAAMwkG,EACW,EAIXC,EACJ,EAAID,EAJU,EAMHE,EAAkBxkG,EAAAA,GAAO81D,IAAGz1D,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,MAAM,CACvD0+B,gBAAiB16B,EAAM0U,MACrB,2BACA1U,EAAMK,KAAO,UAAY,WAE3B+/F,eAAgB,cAChBC,UAAW,aACXj7C,OAAQ,EACRlnB,OAAQ,OACR0X,WAAY,EACb,IAEY0qD,GAA4B3kG,EAAAA,EAAAA,IAAOwkG,EAAiB;;eAElDF;WACJC;EAEEz6C,GAA0B9pD,EAAAA,EAAAA,IAAOwkG,EAAiB;;aAElDF;YACDC;sHCEL,MAAMnkF,EAAmB/f,IAOF,IAPG,KAC/BmZ,EAAI,MACJC,EAAK,YACL4G,EAAW,QACXukF,EAAO,OACPC,EAAM,eACNpkF,GACsBpgB,EACtB,OACEZ,EAAAA,cAACqlG,EAAAA,EAAgB,CACfC,UAAWvrF,EACXC,MAAOA,EACPgH,eAAgBA,EAChBukF,QACEH,EACEplG,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,eACjD1gB,EAAAA,cAAC47C,EAAAA,EAAU,CACTxhC,QAAS+qF,EACT5hD,qBAAmB,EACnBvW,qBAAmB,GAEnBhtC,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,qBAIvB6G,GAGJ,EAEJD,EAAAtgB,aAAA,grC,0GC7DK,MAAMmlG,EAAiB5kG,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,MAAgB,CACxEswC,YAAatsC,EAAM0U,MAAM,0BACzBmsF,gBAAiB7gG,EAAMR,MAAc,8BACrCwf,WAAYhf,EAAM0U,MAAM,yBACxBosF,gCAAiC9gG,EAAM0U,MACrC,sCAEFqsF,wBAAyB/gG,EAAM0U,MAAM,sCACrCssF,wBAAyBhhG,EAAM0U,MAC7B,sCAEFusF,gBAAiBjhG,EAAM0U,MAAM,8BAC7BwsF,uBAAwBlhG,EAAM0U,MAAM,qCACpCysF,eAAgBnhG,EAAM0U,MAAM,6BAE5B0sF,gCAAiCphG,EAAM0U,MACrC,sCAEF2sF,wBAAyBrhG,EAAM0U,MAAM,sCACtC,EACY4sF,GAAkB3lG,EAAAA,EAAAA,IAAO4lG,EAAAA,EAAkB;;IAEpD34F,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK44F,EAAAA,EAAAA,GAAkBZ,EAAe,CAAE5gG,UAAS;iBCzBxD,MAAMyhG,GAAmB9lG,EAAAA,EAAAA,IAAO+lG,EAAAA,EAAmB;IACtD1lG,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAK2lG,EAAAA,EAAAA,GAAmBf,EAAe,CAAE5gG,UAAS;gBCIzD,MAAMkb,EAAgC/f,GAC3CC,EAAAA,cAACo4D,EAAAA,GAAIl4D,EAAAA,EAAAA,GAAA,GACCH,EAAK,CACTs4D,aAAc6tC,EACd5tC,cAAe+tC,EACfG,WAAW,KAEb1mF,EAAAzf,aAAA,oD,+DCPF,MAqCa8lG,E,SAAmB5lG,GAAO+Z,GAAoB;;;;;;;;;;;;;aAa9C9M,IAAA,IAAC,SAAEwqC,GAAUxqC,EAAA,OAAMwqC,EAAW,KAAO,GAAG;WAC1CvoC,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACjB7K,EAAM0U,MACJ,yBACD;;;;;;;;;;;IAtDmB1Y,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,OAClDwlG,EAAAA,EAAAA,GAAkB,CAChBX,gBAAiB7gG,EAAMR,MAAc,gCAAkC,EACvE0hG,uBAAwBlhG,EAAM0U,MAC5B,qCACA1U,EAAMK,KAAO,UAAY,WAE3B8gG,eAAgBnhG,EAAM0U,MACpB,6BACA1U,EAAMK,KAAO,UAAY,WAG3B+gG,gCAAiCphG,EAAM0U,MACrC,+CAEF2sF,wBAAyBrhG,EAAM0U,MAAM,uCAErCsK,WAAYhf,EAAM0U,MAChB,yBACA1U,EAAMK,KAAO,UAAY,WAE3BygG,gCAAiC9gG,EAAM0U,MACrC,+CAEFqsF,wBAAyB/gG,EAAM0U,MAC7B,uCAEFssF,wBAAyBhhG,EAAM0U,MAC7B,sCACA1U,EAAMK,KAAO,kBAAoB,kBAEnC4gG,gBAAiBjhG,EAAM0U,MACrB,8BACA1U,EAAMK,KAAO,kBAAoB,mBAEnC;2ECzCJ,MASaqhG,EAAoB/lG,EAAAA,GAAO+Z,GAA6B;;;;;kBAKnD9M,IAAA,IAAC,UAAEyS,GAAWzS,EAAA,OAAMyS,EAAY,IAAM,OAAO;;IAdtCrf,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,OACnD2lG,EAAAA,EAAAA,GAAmB,CACjBr1D,YAAatsC,EAAM0U,MACjB,0BACA1U,EAAM8V,aAAao1C,gBAErBlsC,WAAYhf,EAAM0U,MAAM,2BACxB;+FCNJ,MAAMg6C,E,SAAoB/yD,GAAOy+B,IAAK;;;;;;;;;;;;;EAiBzBne,EAAkB9gB,GAG3BC,EAAAA,cAAC47C,EAAAA,GAAU17C,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEwjD,qBAAmB,EAACvW,qBAAmB,IAC5DhtC,EAAAA,cAACszD,EAAiB,KAChBtzD,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM,uBAAwBo7D,UAAU,eACtDn1E,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAM,gBAAiBo7D,UAAU,WAIrDt0D,EAAAxgB,aAAA,4E,oHC3BF,MAAMomG,EAAsBlmG,EAAAA,GAAO+Z,GAAI;;;EAKjCosF,EAAYllG,EAAAA,EAAI;;;EAKhBmlG,EAAyBpmG,EAAAA,GAAOy+B,IAAK;IACvC0nE;;EAIEE,EAAuBrmG,EAAAA,GAAOy+B,IAAK;IACrC0nE;;;;EA6BSrB,EAAmBrlG,EAAAA,YAC9B,CAAAY,EAEEwjB,KACI,IAFJ,UAAEkhF,EAAS,MAAEtrF,EAAK,QAAEurF,EAAO,eAAEvkF,EAAiB,CAAC,GAAuBpgB,EAItE,MAAM,eAAE6xD,IAAmBC,EAAAA,EAAAA,GAAa,CAAC,GAAGF,EAAAA,EAAAA,GAAapuC,IACzD,OACEpkB,EAAAA,cAACymG,GAAmBvmG,EAAAA,EAAAA,GAAA,IACdsf,EAAAA,EAAAA,GAAWizC,EAAgBzxC,GAAe,CAC9CoD,IAAKA,IAEJkhF,GACCtlG,EAAAA,cAAC2mG,EAAsB,KAAErB,GAE1BtrF,EACAurF,GAAWvlG,EAAAA,cAAC4mG,EAAoB,KAAErB,GACf,IAG1BF,EAAAhlG,aAAA,k7B,gDC7CK,MAAM8f,E,SAAuDN,C,uECA7D,MAAM0mF,EAAqB3lG,IAAA,IAAC,WACjCgjB,EAAU,YACVstB,GAC6CtwC,EAAA,OAAKY,EAAAA,EAAI;kBACtC0vC;gBACFttB;CACf,EAYYwiF,EAAoB54F,IAAA,IAAC,gBAChCi4F,EAAe,WAEf7hF,EAAU,wBACV+hF,EAAuB,gCACvBD,EAA+B,wBAC/BE,EAAuB,gBACvBC,EAAe,wBAEfI,EAAuB,gCACvBD,EAA+B,uBAE/BF,EAAsB,eACtBC,GACSv4F,EAAA,OACThM,EAAAA,EAAoB;;;gBAGa,MAAnBikG,EAA2B,GAAEA,WAAsBr+E;0BACzC3X,IAAA,IAAC,SAAEsmD,GAAUtmD,EAAA,OAAKsmD,GAAY+vC,CAAsB;0BACpD11F,IAAA,IAAC,SAAE2lD,EAAQ,OAAE/4C,GAAQ5M,EAAA,OACvC2lD,GAAY/4C,GAAU+oF,CAAc;;;;aAI/BjyF,IAAA,IAAC,SAAEiiD,GAAUjiD,EAAA,OAAKiiD,GAAYiwC,CAA+B;aAC7DxxF,IAAA,IAAC,SAAEuhD,EAAQ,OAAE/4C,GAAQxI,EAAA,OAC5BuhD,GAAY/4C,GAAUipF,CAAuB;;;kBAGjCriF;kBACAnP,IAAA,IAAC,SAAEshD,GAAUthD,EAAA,OACzBshD,GAAY2vC,CAA+B;kBAC/B/wF,IAAA,IAAC,SAAEohD,EAAQ,OAAE/4C,GAAQrI,EAAA,OACjCohD,GAAY/4C,GAAU2oF,CAAuB;;MAE7C9wF,IAAA,IAAC,SAAEmjC,EAAQ,OAAEh7B,GAAQnI,EAAA,OACpBmjC,GACDx2C,EAAAA,EAAI;;;wBAGcokG;wBACA5oF,GAAU6oF;;OAE3B;GACJ,C,wICjFH,MAAMgB,EAAoCrlG,EAAAA,EAAI;;;;;;;;EASjCslG,EAAkCvmG,EAAAA,GAAO+Z,GAAW;;;;IAI7D1Z,IAAA,IAAC,mBAAEmmG,GAAoBnmG,EAAA,OACvBmmG,GACAvlG,EAAAA,EAAI;;UAEEqlG;;;YAGEr5F,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM8V,aAAa2I,eAAe;;;;;KAKxD;IACD5T,IAAA,IAAC,iBAAEu3F,GAAkBv3F,EAAA,OACrBu3F,GACAxlG,EAAAA,EAAI;;UAEEqlG;;;YAGEz2F,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OAAKxL,EAAM8V,aAAa2I,eAAe;;;;;KAKxD;2ECvBE,MAAM4jF,GAAMzpB,EAAAA,EAAAA,aAAW,SAAY58E,EASxC2xD,GACqB,IATrB,MACE1kD,EAAK,KACL+B,EAAI,UACJ42F,EAAS,OACTxpF,EAAM,sBACNkqF,EAAqB,UACrBlyB,EAAYmxB,EAAAA,GACAvlG,EAGd,MAAM,IAAEuD,EAAG,SAAE07B,GAAajwB,EACpBwU,GAAMy9D,EAAAA,EAAAA,GAAgBtvB,IAE1B40C,UAAU,SAKRnzF,KACGmzF,KAEHC,EAAAA,EAAAA,IACF,CACEjjG,MACA+iG,yBAEFr5F,EACAuW,GAEIoF,EAAa3b,EAAMkS,cAAgB5b,EACnCunB,EAAa7d,EAAMqgD,aAAar0B,IAAI11B,GAE1C,OACEnE,EAAAA,cAACg1E,GAAS90E,EAAAA,EAAAA,GAAA,GACJinG,EAAQ,CACZnzF,SAAUwyF,EAAYxyF,OAAWoT,EACjChD,IAAKA,EACLpH,OAAQA,EACR+4C,SAAUvsC,EACVwuB,SAAUtsB,IAETmU,EAGP,IAAGonE,EAAA5mG,aAAA,0nBCsBH,MAAMgnG,EAAyB7lG,EAAAA,EAAI;;;;;;;EAS7B8lG,EAAgB/mG,EAAAA,GAAO+Z,GAA4B;;eAE1C1Z,IAAA,IAAC,SAAE2mG,GAAU3mG,EAAA,OAAM2mG,EAAW,OAAS,QAAQ;;;IAG1DF;EAUSjvC,EAAO5qD,IAWqB,IAXF,UACrCg5F,EAAS,sBACTU,EAAqB,OACrBlqF,EAAM,aACNq7C,EAAY,cACZC,EAAgBguC,EAAAA,EAAiB,SACjCiB,EAAQ,eACRC,EAAc,SACdC,EAAQ,UACRxnF,KACGlgB,GACUyN,EACb,MAAMK,GAAQ65F,EAAAA,EAAAA,GAAgB3nG,GACxBqkB,EAAMpkB,EAAAA,OAA6B,OACnC,aAAE2nG,IAAiBC,EAAAA,EAAAA,IAAW7nG,EAAO8N,EAAOuW,IAE5C,uBAAEyjF,EAAsB,YAAEC,GC/H3B,SAAuBlnG,GAM1B,IANkD,UACpDmnG,EAAY,EAAC,IACb3jF,GAIDxjB,EACC,MAAOknG,EAAaE,IAAkBhjG,EAAAA,EAAAA,UAAS,CAC7C2oB,MAAM,EACNC,OAAO,EACP47B,KAAK,EACLjT,QAAQ,IAGJzgC,EAASA,KACb,MAAMyS,EAAUnE,EAAItT,QACpB,GAAIyX,EAAS,CACX,MAAM0/E,EAAa1/E,EAAQ2/E,WACrBC,EACJ5/E,EAAQ6/E,aAAe7/E,EAAQ05C,YAAc15C,EAAQ2/E,YACjDG,EAAY9/E,EAAQ+/E,UACpBC,EACJhgF,EAAQosD,cAAgBpsD,EAAQqnE,aAAernE,EAAQ+/E,WACnDE,EAAiB,CACrBh/C,IAAK6+C,EAAYN,EACjBxxD,OAAQgyD,EAAeR,EACvBp6E,KAAMs6E,EAAaF,EACnBn6E,MAAOu6E,EAAcJ,GAGrBD,EAAYt+C,MAAQg/C,EAAeh/C,KACnCs+C,EAAYvxD,SAAWiyD,EAAejyD,QACtCuxD,EAAYn6E,OAAS66E,EAAe76E,MACpCm6E,EAAYl6E,QAAU46E,EAAe56E,OAErCo6E,EAAeQ,EAEnB,GAIF,OAFAv6F,EAAAA,EAAAA,WAAU6H,GAEH,CACL+xF,uBAAwB,CACtBY,SAAU3yF,GAEZgyF,cAEJ,CDgFkDY,CAAe,CAAEtkF,SAC3D,mBAAEukF,IAAuBC,EAAAA,EAAAA,GAAoBxkF,GAC7CykF,EAAiB,IAAI/wF,IACzB6wF,EACG9kG,KAAK0kB,GACJA,aAAmBwoB,YAAcxoB,EAAQG,QAAa,IAAI,OAE3DzW,OAAO8F,EAAAA,KAGZ9J,EAAAA,EAAAA,YAAU,KACR,IAAKw5F,EAAU,CACb,MAAMqB,EAAsB1kF,EAAItT,QAC1Bi4F,EAAqBD,GAAqBtgF,cAC7C,cAAa3a,EAAMkS,iBAElB+oF,GAAuBC,IACzBhsB,EAAAA,EAAAA,GAAe+rB,EAAqBC,EAExC,CACE,GAED,CAACl7F,EAAMkS,cAIV,GAAI0nF,EACF,MAAM,IAAIp9F,MAAM,kCAElB,OACErK,EAAAA,cAACs4D,GAAap4D,EAAAA,EAAAA,GAAA,CAAC+f,UAAWA,IAAes2D,EAAAA,EAAAA,GAAex2E,IACtDC,EAAAA,cAAC8mG,EAA+B,CAC9BC,mBAAoBe,EAAYn6E,KAChCq5E,iBAAkBc,EAAYl6E,MAC9BnU,MAAO,CAAEqT,SAAU,IAEnB9sB,EAAAA,cAACsnG,GAAapnG,EAAAA,EAAAA,GAAA,IACRsf,EAAAA,EAAAA,GAAWmoF,EAAcE,GAAuB,CACpDN,SAAUA,EACVnjF,IAAKA,IAEJ,IAAIvW,EAAMkrE,YAAYl1E,KAAK+L,GAC1B5P,EAAAA,cAACinG,EAAG,CACF9iG,IAAKyL,EAAKzL,IACVyL,KAAMA,EACN/B,MAAOA,EACP24F,UAAWA,EACXU,sBAAuBA,EACvBlqF,OAAQA,EACRg4D,UAAW3c,SAKjBmvC,GACAxnG,EAAAA,cAACgpG,EAAAA,EAAgB,CACfjwB,WAAYlrE,EAAMkrE,WAClB8vB,eAAgBA,EAChBI,SAnC4B9kG,IAClC0J,EAAMq7F,eAAe/kG,EAAI,IAqCT,EAElBi0D,EAAA/3D,aAAA,mqG,+HEzLK,MAAM2oG,EAAmBpoG,IAAA,IAAoB,WAClDm4E,EAAU,eACV8vB,EAAc,SACdI,GAKDroG,EAAA,OACCZ,EAAAA,cAAAA,EAAAA,SAAA,KACG6oG,EAAe/7F,KAAO,GACrB9M,EAAAA,cAAC27C,EAAAA,EAAW,CACVy0C,MAAM,MACN1wE,WAAYlS,IAAoB,IAAnB,UAAE0V,GAAW1V,EACxB,MAAMtE,EAAiC,IAAI6vE,GAAY9mE,QACpDk3F,GAAaN,EAAehvE,IAAIsvE,EAAShlG,OAE5C,OACEnE,EAAAA,cAAC2f,EAAAA,IAAIzf,EAAAA,EAAAA,GAAA,GACCgjB,EAAS,CACbtD,SAAWzb,IACT8kG,EAAS9kG,EAAI,EAEf+E,MAAOA,KAEL0G,GACA5P,EAAAA,cAAC6f,EAAAA,EAAI,CAAC1b,IAAKyL,EAAKzL,IAAKic,UAAWxQ,EAAKwQ,WAClCxQ,EAAK7P,MAAMsgB,gBAAkBzQ,EAAKwQ,YAGlC,IAIV,CAACrgB,EAAOqkB,IACPpkB,EAAAA,cAACiiC,EAAAA,IAAU/hC,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,IAC1BpkB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,sCAK1B,EACHivF,EAAA3oG,aAAA,wf,yECrBK,MAAMioD,EAAuBtoD,EAAAA,YAClC,CAAAY,EAEEwjB,KACI,IAFJ,KAAErK,EAAI,MAAEC,EAAK,YAAE4G,EAAW,eAAEI,GAA2CpgB,EAGvE,OACEZ,EAAAA,cAACqlG,EAAAA,EAAgB,CACfrkF,eAAgBA,EAChBoD,IAAKA,EACLkhF,UAAWvrF,EACXC,MAAOA,EACPurF,QAAS3kF,GACT,IAGN0nC,EAAAjoD,aAAA,g/B,mHCnCK,MAAM+oG,EAAqBxoG,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,MAAgB,CAC5EswC,YAAatsC,EAAM0U,MAAM,oCACzBmsF,gBAAiB7gG,EAAMR,MAAc,wCACrCwf,WAAY,cACZ8hF,gCAAiC9gG,EAAM0U,MACrC,wDAEFqsF,wBAAyB/gG,EAAM0U,MAC7B,gDAEFssF,wBACEhhG,EAAM0U,MAAM,iDACZ1U,EAAM0U,MAAM,wCACdusF,gBAAiBjhG,EAAM0U,MAAM,wCAC7BwsF,uBAAwBlhG,EAAM0U,MAC5B,+CAEFysF,eAAgBnhG,EAAM0U,MAAM,uCAE5B0sF,gCACEphG,EAAM0U,MAAM,yDACZ1U,EAAM0U,MAAM,gDACd2sF,wBAAyBrhG,EAAM0U,MAC7B,gDAEH,EACY+vF,GAAsB9oG,EAAAA,EAAAA,IAAO4lG,EAAAA,EAAkB;;IAExD34F,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK44F,EAAAA,EAAAA,GAAkBgD,EAAmB,CAAExkG,UAAS;iBC/B5D,MAAM0kG,GAAuB/oG,EAAAA,EAAAA,IAAO+lG,EAAAA,EAAmB;IAC1D1lG,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAK2lG,EAAAA,EAAAA,GAAmB6C,EAAmB,CAAExkG,UAAS;ECIvD2kG,EACXxpG,GAEAC,EAAAA,cAACo4D,EAAAA,GAAIl4D,EAAAA,EAAAA,GAAA,GACCH,EAAK,CACTs4D,aAAcgxC,EACd/wC,cAAegxC,EACf9C,WAAW,EACXU,uBAAqB,KAEvBqC,EAAAlpG,aAAA,wD,+BCdK,SAASmpG,EACdC,EACAp5F,GAEA,MAAMiI,EAAsC,GAC5C,OAAKmxF,GAAQp5F,QAGTo5F,EAAO,GAAGlkE,KAAO,GACnBjtB,EAAOxI,KAAK,CAAC,CAAEy1B,KAAM,EAAGC,GAAIikE,EAAO,GAAGlkE,KAAO,IAAK,IAEpDkkE,EAAOvlG,SAAQ,CAAAtD,EAAewS,KAAW,IAAzB,KAAEmyB,EAAI,GAAEC,GAAI5kC,EAC1B0X,EAAOxI,KAAK,CAAC,CAAEy1B,OAAMC,OAAM,IAC3B,MAAMkkE,EAAsBD,EAAOr2F,EAAQ,GACvC,CAAEmyB,KAAMC,EAAK,EAAGA,GAAIikE,EAAOr2F,EAAQ,GAAGmyB,KAAO,GAC7C,CAAEA,KAAMC,EAAK,EAAGA,GAAIn1B,EAAS,GAnB9B,IAAsBs5F,KAoBPD,GAnBPnkE,KAAOokE,EAAMnkE,IAoBtBltB,EAAOxI,KAAK,CAAC45F,GAAU,GACzB,IAEKpxF,GAdE,CAAC,CAAC,CAAEitB,KAAM,EAAGC,GAAIn1B,EAAS,IAAK,GAe1C,CAEO,SAASu5F,EAAwBC,GACtC,OAAOA,EAAQr3E,QAAO,CAACi3E,EAAQr2F,KAC7B,MAAM02F,EAAYL,EAAOv3F,OAAO,GAAG,GACnC,OAAI43F,GAAWtkE,KAAOpyB,EAAQ,EACrB,IAAIq2F,EAAOv3F,MAAM,GAAI,GAAI,CAAEqzB,KAAMukE,EAAUvkE,KAAMC,GAAIpyB,IAEvD,IAAIq2F,EAAQ,CAAElkE,KAAMnyB,EAAOoyB,GAAIpyB,GAAQ,GAC7C,GACL,C,mGCjCA,MAAM22F,E,SAAmBxpG,GAAOy+B,IAAK;gBACrBp+B,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,MACrB,mBAAkBgE,EAAM0U,MACvB,8BACA,iBACI1U,EAAM0U,MAAM,4BAA6B,eAAe;;;EAS3D,SAASq6C,EAAkBnmD,GAMV,IANW,SACjC1M,EAAQ,WACR4yD,GAIDlmD,EACC,MAAMu4B,EAAqC2tB,GACvC81C,EAAAA,EAAAA,IAAa91C,EAAY5yD,EAASuP,QAClC,CAAC,CAAC,CAAEk1B,KAAM,EAAGC,GAAI1kC,EAASuP,SAAU,IACxC,OACErQ,EAAAA,cAAAA,EAAAA,SAAA,KACG+lC,EAAMliC,KAAI4L,IAAkC,KAAhC,KAAE81B,EAAI,GAAEC,GAAMwkE,GAAYv6F,EACrC,MAAMq0B,EAAOhjC,EAASoR,MAAMqzB,EAAMC,EAAK,GACvC,OAEExlC,EAAAA,cAACA,EAAAA,SAAc,CAACmE,IAAM,GAAEohC,KAAQC,KAC7BwkE,EAAchqG,EAAAA,cAAC+pG,EAAgB,KAAEjmE,GAA2BA,EAC9C,IAK3B,CAAC6vB,EAAAtzD,aAAA,of,gDCxCD,MAAM4pG,EAAgB,qBAEhBC,EAAiBA,CAACC,EAAsB/2F,IAC5C+2F,EACI/2F,EAAQ,EACNuvF,SAASwH,GACT91F,KAAKmsD,MAA8C,IAAxCnsD,KAAK+1F,IAAI31B,WAAW01B,GAAe,SAChD/iF,EAEAijF,EAAgBljC,GACpBA,EACG5/B,MAAM,+DACLr1B,MAAM,EAAG,GACVrO,KAAKukB,GAAOA,EAAIu6E,SAASv6E,EAAG,SAAMhB,IACjCkjF,EAAqBnjC,GACzBA,EACG5/B,MAAM,wCACLr1B,MAAM,EAAG,GACVrO,KAAKukB,GAAOA,EAAIu6E,SAASv6E,EAAIA,EAAG,SAAMhB,IACrCmjF,EAAYpjC,GAChBA,EACG5/B,MACC,IAAIG,OACD,eAAcuiE,eAA2BA,eAA2BA,gBAGvE/3F,MAAM,EAAG,GACVrO,IAAIqmG,GACHM,EAAarjC,GACjBA,EACG5/B,MACC,IAAIG,OACD,gBAAeuiE,eAA2BA,eAA2BA,eAA2BA,gBAGnG/3F,MAAM,EAAG,GACVrO,IAAIqmG,GChCF,MAAMO,EAWX3uB,WAAAA,CACE4uB,EACAC,EACAv6E,EACAnI,GAEA,IAAI2iF,OAFK,IAAT3iF,IAAAA,EAAY,KAAG,KAdD2iF,OAAC,OACDD,OAAC,OACDv6E,OAAC,OACDnI,OAAC,EAcK,iBAATyiF,GACRE,EAAIC,IAAKF,EAAIE,IAAKz6E,EAAIy6E,IAAK5iF,EAAI,KDoBpCk/C,KAEA,MAAM7uD,EAAS,CAAC+xF,EAAcC,EAAmBC,EAAUC,GAAWh4E,QAEpE,CAACla,EAAQgwD,IAAUhwD,GAAUgwD,EAAMnB,SAAM//C,GAC3C,OAAO9R,MAAMC,QAAQ+C,IACnBA,EAAOpG,MAAM,EAAG,GAAGkrD,OAAO57C,GAAMspF,OAAOC,UAAUvpF,KAC9ClJ,EACD,IAAI,EC5BmC0yF,CAAiBN,IAAS,GACxDA,aAAgBD,GACxBG,EAAGD,EAAGv6E,EAAGnI,GAAK,CAACyiF,EAAKE,EAAGF,EAAKC,EAAGD,EAAKt6E,EAAGs6E,EAAKziF,GAE7C2iF,EAAIF,EAEN1uB,KAAK4uB,EAAIA,EACT5uB,KAAK2uB,EAAIA,EACT3uB,KAAK5rD,EAAIA,EACT4rD,KAAK/zD,EAAIA,EAAI,EAAI5T,KAAKmsD,MAAU,IAAJv4C,GAAWA,CACzC,CAEAm2C,OAAAA,GACE,OACE0sC,OAAOC,UAAU/uB,KAAK4uB,IACtBE,OAAOC,UAAU/uB,KAAK2uB,IACtBG,OAAOC,UAAU/uB,KAAK5rD,IACtB06E,OAAOC,UAAU/uB,KAAK/zD,EAE1B,CAKAgjF,gBAAAA,CAAiBC,GACf,OAAO,IAAIT,EAAMzuB,KAAK4uB,EAAG5uB,KAAK2uB,EAAG3uB,KAAK5rD,EAAG86E,EAC3C,CAEAC,QAAAA,GACE,IAAI,EAAEP,EAAC,EAAED,EAAC,EAAEv6E,EAAGnI,EAAGijF,GAAUlvB,KAC5B,MAAMovB,EAAM/2F,KAAK69C,MACfm5C,EAASZ,EAAMY,OAEjB,IAAIjjF,EAAIgjF,EAAI,GAAO,EAAMC,IACzB,OAAS,GAALT,GAAe,GAALD,GAAe,GAALv6E,EACf,IAAIq6E,EAAMriF,EAAGA,EAAGA,EAAG8iF,IAExBN,EAAI,GAAKA,EAAIxiF,IAAGwiF,EAAIxiF,GACpBuiF,EAAI,GAAKA,EAAIviF,IAAGuiF,EAAIviF,GACpBgI,EAAI,GAAKA,EAAIhI,IAAGgI,EAAIhI,GAEjB,IAAIqiF,EACTp2F,KAAK+1F,IAAIgB,EAAIR,EAAIS,GAAS,KAC1Bh3F,KAAK+1F,IAAIgB,EAAIT,EAAIU,GAAS,KAC1Bh3F,KAAK+1F,IAAIgB,EAAIh7E,EAAIi7E,GAAS,KAC1BH,GAEJ,CAEAI,MAAAA,GACE,MAAMD,EAASZ,EAAMY,OACfD,EAAM/2F,KAAK69C,MAEjB,OAAO,IAAIu4C,EACTp2F,KAAKC,IAAI82F,EAAIpvB,KAAK4uB,EAAIS,GAAS,GAC/Bh3F,KAAKC,IAAI82F,EAAIpvB,KAAK2uB,EAAIU,GAAS,GAC/Bh3F,KAAKC,IAAI82F,EAAIpvB,KAAK5rD,EAAIi7E,GAAS,GAC/BrvB,KAAK/zD,EAET,CAEA,eAAOkjF,CAAS7xF,GAGd,OAAO,IAAImxF,EAAMnxF,GAAO6xF,WAAW/lE,UACrC,CAEAmmE,KAAAA,CAAMC,GACJ,MAAMlyF,EAC0B,iBAAvBkyF,EACH,IAAIf,EAAMe,GACVA,EACAC,EAAmBljC,GACvBl0D,KAAKmsD,MACFlnD,EAAM2O,EAAI,IAAO3O,EAAMivD,GACrByT,KAAK/zD,EAAI,KAAQ,EAAI3O,EAAM2O,EAAI,KAAO+zD,KAAKzT,IAElD,OAAO,IAAIkiC,EACTgB,EAAgB,KAChBA,EAAgB,KAChBA,EAAgB,KAEpB,CAEArmE,QAAAA,GACE,MAAMA,EAAYmjC,GAChBuiC,OAAOY,MAAMnjC,GAAa,GAAKA,EAAUnjC,SAAS,IAAIumE,SAAS,EAAG,KAKpE,MAAQ,IAJEvmE,EAAS42C,KAAK4uB,KACdxlE,EAAS42C,KAAK2uB,KACdvlE,EAAS42C,KAAK5rD,KACH,MAAX4rD,KAAK/zD,EAAY,GAAKmd,EAAS42C,KAAK/zD,IAEhD,EA/GWwiF,EAMaY,OAAS,E,6HCsBnC,MAAMO,EAA0BrrG,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,6CAAAC,YAAA,eAAVH,CAAU,6EAOtBK,IAAA,IAAC,YAAE+5B,GAAa/5B,EAAA,MAChB,aAAhB+5B,EAA6B,SAAW,KAAK,IAG3CkxE,EAAatrG,EAAAA,GAAO+Z,IAAG9Z,WAAA,CAAAC,YAAA,gCAAAC,YAAA,eAAVH,CAAU,oBAQvBurG,GAA0BvrG,EAAAA,EAAAA,IAAOsrG,GAAWrrG,WAAA,CAAAC,YAAA,6CAAAC,YAAA,eAAlBH,CAAkB,aAuBrC6uC,EAAsD5hC,IAchB,IAdiB,YAClEmtB,EAAc,aAAY,UAC1BkgB,EAAS,UACTH,EAAS,SACTnL,EAAQ,SACRC,EAAQ,cACRmL,EAAa,aACblL,EACA2xD,aAAc2K,EAAwB,CAAC,EAAC,UACxC18D,EAAS,iBACTuL,EAAgB,gBAChBwN,EAAe,iBACf9Y,KACGtuB,GACoBxT,EACvB,MAAM6a,GAAexX,EAAAA,EAAAA,QAAuB,MACtCm7F,GAAen7F,EAAAA,EAAAA,QAAuB,MACtCo7F,GAAcp7F,EAAAA,EAAAA,QAAuB,OACpCq7F,EAAgBC,IAAqBnnG,EAAAA,EAAAA,UAAwB,OAC7DonG,EAAeC,IAAoBrnG,EAAAA,EAAAA,UAAwB,MAC5DJ,GAAQC,EAAAA,EAAAA,MAERT,EAAQA,CAASkoG,EAAqBC,IAC1B,eAAhB5xE,EAA+B2xE,EAAkBC,EAE7CC,EAAkDpoG,EACtD00F,EAAAA,EACAG,EAAAA,GAEIwT,EAAmDroG,EACvD20F,EAAAA,EACAC,EAAAA,GAEI0T,EAAgBtoG,EAAM,QAAS,UAC/BuoG,EAAmBvoG,EAAM,WAAY,aAErCg9F,EAAuD,CAC3Dx9E,WAAYhf,EAAM8V,aAAao1C,eAC/BhjD,KAAM,KACHi/F,GAGCa,EAAkB9/F,GAAiBA,EAAO,EAE1C+/F,EACJ//F,GAEQ,MAARA,EACI8/F,EAAe9/F,GACH,IAAPA,EAAF,IACDuH,KAAKmsD,MAAM1zD,QACbsa,EAEA0lF,EAAWpJ,GACft/F,EAAMs/F,EAAKzhC,YAAayhC,EAAK9T,cAEzBmd,EAAaA,CAACjS,EAAqBH,KACvC,GAAmB,MAAfG,GAAuB8R,EAAe9R,GAAc,CACtD,IAAKzyE,EAAavX,QAChB,MAAM,IAAIzG,MACR,4EAGJ,MAIM2iG,EAAkBrS,EAJFv2F,EACpBikB,EAAavX,QAAQmxD,YACrB55C,EAAavX,QAAQ8+E,cAGvB,OAAOod,EAAkB,EAAIA,EAAkBlS,CACjD,CACE,OAAOzmF,KAAKC,IAAIqmF,EAAS,EAC3B,EAGIsS,EAAiBC,IACrB,IAAK7kF,EAAavX,UAAYo8F,EAC5B,OAAO,KAET,MAAMC,EAAaL,EAAQI,GAC3B,OAAIA,EAASzzF,MAAMizF,IAAgB79F,SAAS,KACnCs+F,EAAaL,EAAQzkF,EAAavX,SAEpCq8F,CAAU,EAGbC,EAAkBP,EAAcT,GAAiB58D,GACjD69D,EAAmBR,EAAcX,GAAkBxxD,GACzD,OACE16C,EAAAA,cAAC4rG,GAAuB1rG,EAAAA,EAAAA,GAAA,CACtBkkB,IAAKiE,EACLsS,YAAaA,GACT3Z,GAEH65B,GACC76C,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC6rG,EAAU,CACTznF,IAAK4nF,EACLvyF,MAAO,CACL,CAACizF,GAAgBW,EAIjB,CAACV,IACoB,OAAlBP,EAAyBiB,OAAmBjmF,IAC7CwzB,IAGHC,GAEH76C,EAAAA,cAACwsG,GAAYtsG,EAAAA,EAAAA,GAAA,CACXy4F,gBAAiBA,KACf,MAAM7rF,EAAOk/F,EAAal7F,QACtBg8F,EAAQd,EAAal7F,SACrB,EAEJ,OADAq7F,EAAkBzxD,GAAa5tC,GACxBA,CAAI,EAEbykF,SAAWoJ,IACa,MAAlBuR,GACFC,EAAkBY,EAAWb,EAAgBvR,GAC/C,EAEF/B,YAAaA,KACX,MAAMuU,EAAaF,EAAcjB,EAAal7F,SAC3B,OAAfq8F,GACFxyD,IAAgBwyD,GAElBhB,EAAkB,KAAK,GAErB/K,KAIT/xD,GACCrvC,EAAAA,cAAC8rG,EAAuB,CACtBryF,MAAO,CACL,CAACkzF,GAAmBr9D,IAGrBD,GAGJE,GACCvvC,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACysG,GAAavsG,EAAAA,EAAAA,GAAA,CACZy4F,gBAAiBA,KACf,MAAM7rF,EAAOggG,EAAQb,EAAYn7F,SAEjC,OADAu7F,EAAiB78D,GAAY1iC,GACtBA,CAAI,EAEbykF,SAAWoJ,IACY,MAAjByR,GACFC,EAAiBU,EAAWX,EAAezR,GAC7C,EAEF/B,YAAaA,KACX,MAAMuU,EAAaF,EAAchB,EAAYn7F,SAC1B,OAAfq8F,GACF19D,IAAe09D,GAEjBd,EAAiB,KAAK,GAEpBjL,IAENphG,EAAAA,cAAC6rG,EAAU,CACTznF,IAAK6nF,EACLxyF,MAAO,CACL,CAACizF,GAAgBU,EAIjB,CAACT,IACqB,OAAnBT,EAA0BkB,OAAkBhmF,IAC7CghC,IAGH7Y,IAIiB,EAE5BH,EAAA/uC,aAAA,qrG,mNClPF,MAGMitG,EAAkB/sG,EAAAA,GAAO+Z,GAAI;;;gBAGnB1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAa2I,eAAe;WACtD7V,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;;;YAGzC7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,MAAM,aAAY7K,EAAM0U,MAAM,0BAA0B;IAC1E8oD,EAAAA;KACA4O,EAAAA,EAAAA,QACFxvE,EAAAA,EAAAA,IAAG;;EAUQ+rG,EAKTn9F,IAAqE,IAApE,SAAEtP,EAAU+M,OAAO,OAAEu7C,GAAQ,eAAEM,KAAmBwJ,GAAY9iD,EACjE,MAAMgU,GAAMvT,EAAAA,EAAAA,QAAO,OACXu4C,OAAQokD,EAAW,+BAAElY,IAC3BE,EAAAA,EAAAA,GAA2BpxE,EAAK,CAC9BglC,SACAM,mBAGJ,OACE1pD,EAAAA,cAAC0tF,EAAAA,GAAO,KACN1tF,EAAAA,cAACstG,GAAeptG,EAAAA,EAAAA,GAAA,GACVgzD,EAAU,CACd9uC,IAAKA,EACL3K,MAAO,IAAKy5C,EAAWz5C,SAAU+zF,KAEjCxtG,EAAAA,cAAC81F,EAAAA,EAA8BR,EAC7Bt1F,EAAAA,cAACi2F,EAAAA,EAAoB,CACnBnpE,SA7CmB,IA8CnBC,UA7CoB,KA+CrBjsB,IAGG,ECEP,SAAS2sG,EAAgB7sG,GAQ5B,IAR6B,aAC/B8sG,EAAe,GAAE,eACjBhkD,EAAc,iBACdikD,GAKD/sG,EACC,MAAMgtG,EAtDR,SAIE1kG,EAKA+wB,GAGA,MAAO4zE,EAAYC,IAAiB9oG,EAAAA,EAAAA,UAAc,IAC5C+oG,EAAS7kG,EAAMuc,MACnB,CAACwC,EAAGmI,IAAMy9E,EAAW9sF,QAAQkZ,EAAOhS,IAAM4lF,EAAW9sF,QAAQkZ,EAAO7J,MAEtE,MAAO,CACL29E,SACAC,aAAe56F,IACb06F,GAAcG,EAAAA,EAAAA,GAAK76F,GAAQ,EAAG26F,GAAQlqG,IAAIo2B,GAAQ,EAGxD,CAgC8Bi0E,CAC1BR,GACAlgG,IAAA,IAAC,IAAErJ,GAAKqJ,EAAA,OAAKrJ,CAAG,KAEZ,YAAEgqG,GA3BD,CACLA,aAJyBtgG,EA8Bc+/F,GA1BpBG,OAAOlqG,KAAI,CAACkQ,EAAGX,KAAK,CACrCnC,QAASA,KACPpD,EAAMmgG,aAAa56F,EAAM,OANjC,IAA6BvF,EAiC3B,OACE7N,EAAAA,cAAAA,EAAAA,SAAA,KACG4tG,EAAoBG,OAAOlqG,KAAI,CAACuqG,EAAYh7F,IAC3CpT,EAAAA,cAACutG,GAASrtG,EAAAA,EAAAA,GAAA,CACRiE,IAAKiqG,EAAWjqG,IAChB0J,MAAOugG,GACHD,EAAY/6F,GAAM,CACtBs2C,eAAiBN,GAAWM,EAAe0kD,EAAWjqG,IAAKilD,KAE1DukD,EAAiBS,EAAWjqG,QAKvC,CD9BEopG,EAAAltG,aAAA,4OC8BDotG,EAAAptG,aAAA,y5BC/CD,MAAMguG,EACJruG,EAAAA,cAAoE,MAQzDsuG,EAAkC1tG,IAGC,IAHmB,OACjEo3F,EAAM,SACNl3F,GACwCF,EACxC,MAAM2tG,GAAU19F,EAAAA,EAAAA,QAEb,CAAC,IACG29F,EAAcC,IAAmBzpG,EAAAA,EAAAA,UAAsB,OACvD0pG,EAAaC,IAAkB3pG,EAAAA,EAAAA,UAAqB,OACpD4pG,EAAcC,IAAmB7pG,EAAAA,EAAAA,UAG9B,MACJ8pG,GAAqBj+F,EAAAA,EAAAA,SAKzB,IAAM,OACFk+F,GAAuBl+F,EAAAA,EAAAA,QAK1B,MAEG2uF,GAAe77E,EAAAA,EAAAA,UACnB,MACEqrF,UAAWA,CAAC1wF,EAAI2wF,KACVV,EAAQz9F,QAAQwN,IAClBxU,QAAQ4D,MAAO,sCAAqC4Q,KAGtDiwF,EAAQz9F,QAAQwN,GAAM2wF,EACf,YACEV,EAAQz9F,QAAQwN,EAAG,GAG9B4wF,UAAWA,CAAC5wF,EAAE9Q,KAAqB,IAAnB,KAAE+3B,EAAI,IAAEphC,GAAKqJ,EAC3B,MAAM2hG,EAASZ,EAAQz9F,QAAQwN,IAAKxN,QACpC,IAAKq+F,EACH,OAEF,MAAM,YAAEC,GAAgBD,EAClBE,EAAgBD,EAAYt+F,QASlC29F,EARqBtqG,IACnBkrG,EACG7mF,cAAe,cAAarkB,OAC5BkgE,wBAKWirC,CAAYnrG,GAAKorG,UACjCZ,EAAexqG,GAEf,MAAMqrG,EAAcL,EAAOM,UAAUp8F,WAClCzD,GAASu/F,EAAOl1E,OAAOrqB,KAAUzL,IAE9BurG,EAAeP,EAAOQ,WAAWt8F,WACpCzD,GAASu/F,EAAOl1E,OAAOrqB,KAAUzL,IAEpC4qG,EAAqBj+F,QAAU,CAC7BwN,KACAswB,OAAQugE,EAAOvgE,OACfx7B,MAAOo8F,GAAe,EAAIA,EAAcE,EACxC7mD,QAAS6mD,GAAgB,GAG3B,MAAME,EAAsB5rG,OAAO+sB,QAAQw9E,EAAQz9F,SAASjN,KAC1D4L,IAAA,IAAE6O,EAAI6wF,GAAO1/F,EAAA,MACX,CAAC6O,EAAI6wF,EAAOr+F,QAAS++F,sBAAsB1rG,GAAK,IAE9C2rG,EAAmBC,IACvB,IAAK,MAAOzxF,EAAIwxF,KAAoBF,EAAqB,CACvD,MAAMhB,EAAekB,EAAgBC,GACrC,GAAInB,EACF,MAAO,CACLtwF,KACAswF,eAGN,CACA,OAAO,IAAI,EAGbC,EAAgBiB,EAAgBvqE,IAEhCupE,EAAmBh+F,QAAUg/F,CAAe,EAE9C7B,KAAM79F,IAAa,IAAZ,GAAEo1B,GAAIp1B,EACXy+F,EAAgBC,EAAmBh+F,QAAQ00B,GAAI,EAEjDwqE,QAASA,KACHpB,GAAgBF,GAClB1W,EAAO,CACLzyD,KAAMwpE,EAAqBj+F,QAC3B00B,GAAI,CACFoJ,OAAQggE,EAAatwF,GACrBlL,MAAOw7F,EAAaA,aAAax7F,MACjCy1C,QAAS+lD,EAAaA,aAAa7rG,SAIzC4rG,EAAe,MACfE,EAAgB,MAChBJ,EAAgB,KAAK,EAEvBG,eACAJ,eACAE,iBAEF,CAACE,EAAcF,EAAaF,IAG9B,OACExuG,EAAAA,cAACquG,EAA+B3tD,SAAQ,CAACt8C,MAAOo7F,GAC7C1+F,EACuC,EAyC7CwtG,EAAAjuG,aAAA,k/CCxND,MAAM4vG,EAAY1vG,EAAAA,GAAO+Z,GAAI;;;EAIvB41F,EAAe3vG,EAAAA,GAAO+Z,GAAI;;;EAI1B61F,EAAa5vG,EAAAA,GAAO+Z,GAAI;;EAGxB81F,EAAc7vG,EAAAA,GAAO+Z,GAAI;;EAGzB+1F,EAAY9vG,EAAAA,GAAO+Z,GAAI;;;;;;EAsChBg2F,EAA8B,CACzCC,MAxBYhwG,EAAAA,GAAO+Z,GAA8B;;;;;;;;;gBASnC1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM8V,aAAa2I,eAAe;WACtD7V,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM0U,MAAM,eAAe;IACjD7J,IAAA,IAAC,YAAE+gG,GAAa/gG,EAAA,OAChB+gG,IACAhvG,EAAAA,EAAAA,IAAG,mCACCyuG,EACAC,EACAC,EACAC,EAGH;EAKHH,YACAC,eACAC,aACAC,cACAC,a,yFCaF,MAAMI,EAAkBA,CAACC,EAA8B9hE,IACrD8hE,GAAcC,EAAAA,EAAAA,IAAuB/hE,GAAU,SAAW,SAEtDgiE,GAAW/sG,EAAAA,EAAAA,IAAiC6iF,EAAAA,EAAAA,GAAK,QACjDmqB,GAAkBC,EAAAA,EAAAA,GACtBF,GACA5oF,EAAAA,EAAAA,IAAOpnB,IAAA,IAAC,MAAEmwG,GAA+BnwG,EAAA,OAAKmwG,CAAK,KAE/CC,GAAc/+F,EAAAA,EAAAA,IAClBzE,IAAA,IAAC,QAAEq7C,GAAiCr7C,EAAA,OAAMq7C,CAAO,IAE7CooD,GAAWH,EAAAA,EAAAA,GAAQD,EAAiBG,GACpCE,GAAej/F,EAAAA,EAAAA,IACnBxC,IAAA,IAAC,QAAEo5C,GAAiCp5C,EAAA,OAAKo5C,CAAO,IAE5CsoD,EAAgB,SAACC,GAA4C,YAAL,IAAvCA,IAAAA,EAA0C,KAC/Dn/F,EAAAA,EAAAA,IACE7B,IAAA,IAAC,SAAEihG,EAAQ,UAAE3oD,GAAmCt4C,EAAA,OAC9Cs4C,GACC,GAAkBnlD,OAAO6tG,GAAkBviG,SAASwiG,EAAS,GAChE,EACEC,GAAYR,EAAAA,EAAAA,GAAQD,EAAiBK,GAErCK,EAAsBJ,EAAc,CAAC,kBAAmB,kBACxDK,EAAwBL,EAAc,UAEtCM,EAAYA,CAChB7iE,EACA8hE,EACAnoD,KAEA,MAAMmpD,EAAQH,EAAoBhpD,GAC5BopD,EAAQX,EAAYU,GACpBE,EAASV,EAAaQ,GAC5B,GAAIC,EAAMthG,OAAS,GAAKuhG,EAAOvhG,OAAS,EACtC,MAAM,IAAIhG,MACR,iEAGJ,GAAIsnG,EAAM,IAAMC,EAAO,GAAI,CACzB,MAAMjpD,EAASgpD,EAAM,IAAIhpD,QAAUipD,EAAO,IAAIjpD,OAC9C,MAAO,CACLkpD,QAASF,EAAM,IAAIxtG,KAAOytG,EAAO,IAAIztG,IACrCpB,MACE4uG,EAAM,IAAIxtG,KAAOytG,EAAO,IAAIztG,IACxB,CACEA,IAAKytG,EAAO,GAAGztG,IACf2tG,aAAcH,EAAM,GAAGhpD,OACnB,EAAIgpD,EAAM,GAAGI,WACbH,EAAO,GAAGG,YAEhB,KACNjlG,KAAM67C,EAAS8nD,EAAgBC,EAAe9hE,GAElD,CACA,OAAO,IAAI,EAGPojE,EAAcA,CAClBpjE,EACA8hE,EACAnoD,KAEA,MAAMoiB,EAAU6mC,EAAsBjpD,GACtC,GAAuB,IAAnBoiB,EAAQt6D,OACV,MAAO,CACLlM,IAAKwmE,EAAQ,GAAGxmE,IAChB2I,KAAM69D,EAAQ,GAAGhiB,OAAS8nD,EAAgBC,EAAe9hE,IAG7D,GAAuB,IAAnB+7B,EAAQt6D,OACV,OAAO,KAET,MAAM,IAAIhG,MACR,kEACD,EAGG4nG,EAAeA,CACnBrjE,EACA8hE,EACAnoD,KAAqC,CAErCgmD,QAAS,CACP2D,KAAMjB,EAAS1oD,GACfxlD,MAAOuuG,EAAU/oD,GACjB4pD,WAAYvB,EAASroD,EAAYt2C,QAAO6B,IAAA,IAAC,UAAE40C,GAAW50C,EAAA,OAAK40C,CAAS,MAEtE0pD,SAAUJ,EAAYpjE,EAAQ8hE,EAAenoD,GAC7C8pD,OAAQZ,EAAU7iE,EAAQ8hE,EAAenoD,KAGrC+pD,EAAiB,IACjBC,EAAgB,IAahBC,EAAuBA,CAC3BnB,EACAX,EACAnoD,KAEA80C,EAAAA,EAAAA,GACE8T,EAAcE,IACdxtG,EAAAA,EAAAA,GAlBD6sG,IACDl8F,IAAA,IACEi+F,eAAgBrpD,EAAS,CACvBI,IAAKknD,EAAcvvF,OAAS,EAAImxF,EAAiB,EACjD3kF,KAAM+iF,EAAcpkF,MAAQ,EAAIimF,EAAgB,EAChDpxF,OAAQmxF,EACRhmF,MAAOimF,GACR,IACDpuG,GACuBqQ,EAAA,MAAwB,CAAE40C,SAAQjlD,MAAK,EAU5DuuG,CAAoBhC,IAHxBrT,CAKE90C,G,0BC7KG,MAAMsnD,GAAwBjvG,IAcgB,IAdA,OACnDguC,EAAM,cACNygE,EAAa,WACbM,EAAU,UACVF,EAAS,YACTH,EAAW,OACXr1E,GAQDr5B,EAIC,MAAM+xG,EAAgBA,IAAMtD,EAAchrC,wBAYpCuuC,EAASC,IACblC,EAAAA,EAAAA,IAAuB/hE,GAAUikE,EAAKllF,KAAOklF,EAAKrpD,IAC9CspD,EAAOD,IACXlC,EAAAA,EAAAA,IAAuB/hE,GAAUikE,EAAKjlF,MAAQilF,EAAKt8D,OAe/Cw8D,EAAmB,SACvB7pG,EACAnG,QAAK,IAALA,IAAAA,GAAQ,GAGR,MAAMiwG,EAASjwG,EAAQ+vG,EAAMF,EAC7B,OAAqB,IAAjB1pG,EAAMmH,OAED,CACL,CACE+C,MAAO,EACPrQ,QACAkwG,MAAQzE,GACNn6F,KAAK6+F,IAAIF,EAAOxE,GAAgBwE,EAAOL,QAIxCzpG,EAAMxF,SAAQ,CAACkM,EAAMwD,KAC1B,MAAMjP,EAAM81B,EAAOrqB,GACnB,MAAO,CACL,CACEwD,QACArQ,QACAk6D,SAAU,CAAE94D,MAAKmyC,UAAW,UAC5B28D,MAAQzE,GACNn6F,KAAK6+F,IAAIF,EAAOxE,GAAgB2E,EAAahvG,GAAKyuG,QAEtD,CACEx/F,MAAOA,EAAQ,EACfrQ,QACAk6D,SAAU,CAAE94D,MAAKmyC,UAAW,SAC5B28D,MAAQzE,GACNn6F,KAAK6+F,IAAIF,EAAOxE,GAAgB2E,EAAahvG,GAAK2uG,MAEvD,GAEL,EAEMK,EAnDmBjqG,KACvB,MAAMiqG,EAA4D,CAAC,EASnE,OARAjqG,EAAMhF,SAAS0L,IACb,MAAMzL,EAAM81B,EAAOrqB,GACbwjG,EAAe9D,EAAYnrG,GACjCgvG,EAAahvG,GAAO,CAClByuG,MAAOA,EAAMQ,GACbN,IAAKA,EAAIM,GACV,IAEID,CAAY,EAyCAE,CAAgB,IAAI5D,KAAcE,IAEjD2D,EAAgB,IACjBP,EAAiBtD,MACjBsD,EAAiBpD,GAAY,IAGlC,IAAI4D,EAAwC,KAC5C,OAAQ/E,IACN,IA3EkBA,KAClB,MAAMgF,EAAab,IACnB,OACEnE,EAAa5gF,MAAQ4lF,EAAW7lF,KAAO6lF,EAAWlnF,OAClDkiF,EAAa7gF,KAAO6lF,EAAW5lF,OAC/B4gF,EAAaj4D,OAASi9D,EAAWhqD,IAAMgqD,EAAWryF,QAClDqtF,EAAahlD,IAAMgqD,EAAWj9D,MAAM,EAqEjCk9D,CAAWjF,GACd,OAAO,KAET,MAAMl2F,EAASg7F,EAAc9gF,QAC3B,CAACkhF,EAAWz/D,KACV,MAAMg/D,EAAQh/D,EAAUg/D,MAAMzE,GAC9B,OAAKkF,GAAaT,EAAQS,EAAUT,MAC3B,IACFh/D,EACHg/D,SAGGS,CAAS,GAElB,MAOF,OAAKp7F,GAIHA,EAAOvV,QAAUwwG,GAAkBxwG,OACnCuV,EAAOlF,QAAUmgG,GAAkBngG,QAEnCmgG,EAAmBj7F,GAEdi7F,GARE,IAQc,CACxB,E,gBCpII,MACMI,GAA4B,OAuB5BC,GAA+BrzG,EAAAA,GAAOy+B,IAAwC;;;;;;;;;;iBAU1E20E;;WAENnmG,IAAA,IAAC,MAAE5I,EAAK,OAAEoY,GAAQxP,EAAA,OACzBwP,EACIpY,EAAM0U,MACJ,uCACA1U,EAAMK,KAAO,mBAAqB,cAEpCL,EAAM0U,MAAM,eAAe;gBACnB7J,IAAA,IAAC,MAAE7K,EAAK,OAAEoY,GAAQvN,EAAA,OAC9BuN,EACIpY,EAAM0U,MACJ,uCACA1U,EAAMK,KAAO,sBAAwB,4BAEvCmiB,CAAS;;IA9CIxmB,IAAqC,IAApC,OAAEguC,GAA4BhuC,EAIlD,MAAuB,gBAFV,SAAXguC,GAAgC,UAAXA,EAAqB,WAAa,eAGrDptC,EAAAA,EAAAA,IAAG,wBARkC,MAWrCA,EAAAA,EAAAA,IAAG,6FAXkC,IAeX,SAAXotC,EAAoB,uBAAoBxnB,EAGnDksC,GAAAA,EAGH;IA+BHljD,IAAA,IAAC,OAAE4M,GAAQ5M,EAAA,OACV4M,IACDxb,EAAAA,EAAAA,IAAG,8BAEesS,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACtBlP,EAAM0U,MACJ,oCACA1U,EAAMK,KAAO,sBAAwB,sBACtC,GAEN;kBC9DL,MAAM8nB,GAAa,QAAO4mF,YAoCbE,GAAyBtzG,EAAAA,GAAO+Z,GAAiC;;gBAE9D7K,IAAA,IAAC,MAAE7K,EAAK,YAAEolG,GAAav6F,EAAA,OACnCu6F,EACIS,GAAAA,EAAMU,SAASvmG,EAAM8V,aAAa2I,iBAClCze,EAAM8V,aAAa2I,eAAe;;;IAhBtB7V,IAAA,IAAC,OAAEohC,EAAM,MAAEhqC,GAAyC4I,EAAA,OACtEhM,EAAAA,EAAAA,IAAG,8BAAUsyG,EAAAA,EAAAA,IAAallE,GACxBhqC,EAAM8V,aAAao1C,eAAc;IAvBhBlvD,IAAA,IAAC,OACpBguC,EAAM,gBACNmlE,GAC4BnzG,EAAA,OAC5B+vG,EAAAA,EAAAA,IAAuB/hE,IACnBptC,EAAAA,EAAAA,IAAG,sEAGauyG,EAAkBhnF,GAAY,cAC1C6mF,KAIJpyG,EAAAA,EAAAA,IAAG,wEAGYuyG,EAAkBhnF,GAAY,cACzC6mF,GAGH;EAwBMziE,GAAe5wC,EAAAA,GAAO+Z,GAAI;;kBChBhC,SAAS05F,GAAcpzG,GAOA,IAPI,IAChCwjB,EAAG,YACH2zE,EAAW,OACXC,EAAM,UACNG,EACA8b,MAAOC,KACJC,GACsBvzG,EACzB,OAAOk3F,EAAAA,GAAAA,GAAQ,IACVqc,EACHpc,YAAaA,KACX,MAAMxvE,EAAUnE,EAAItT,QACpB,IAAImjG,EAA4B,KAChC,IAAK1rF,EACH,MAAM,IAAIle,MACR,yHAGJ,MAAM+pG,EAAuBvB,IACvBoB,IACFA,EAAMx6F,MAAMkU,KAAQ,GAAEklF,EAAKllF,SAC3BsmF,EAAMx6F,MAAM+vC,IAAO,GAAEqpD,EAAKrpD,QAC5B,EAEIjkB,EAAahd,EAAQ87C,wBAC3B,GAAI6vC,EAAa,CACf,MAAMG,EAsCd,SAA4B9rF,GAC1B,MAAM0rF,EAAQ1rF,EAAQyxE,WAAU,GAEhC,OADAia,EAAMx6F,MAAM6lB,gBCnGP,SAAsC/W,GAC3C,IAAIm7E,EAA2Bn7E,EAC3B7iB,EAAkB,GACtB,KAAe,MAARg+F,GAAc,CACnB,MAAM4Q,EAAqBhzC,iBAAiBoiC,GAAMpkE,gBAClD,GAAIg1E,EAAoB,CACtB,MAAMh7F,EAAQ,IAAImxF,GAAAA,EAAM6J,GAExB,GADA5uG,EAAOs6C,QAAQ1mC,GACC,MAAZA,EAAM2O,EAER,KAEJ,CACAy7E,EAAOA,EAAKhQ,aACd,CACA,OACEhuF,EACG8sB,QAAqB,CAAC+hF,EAAaC,IAC3BD,EAAcA,EAAYhJ,MAAMiJ,GAAaA,GACnD,OACDpvE,YAAc,EAEtB,CD6EgCqvE,CAA6BlsF,GACpD0rF,CACT,CA1C6BS,CAAmBnsF,GACxC0rF,EACyB,mBAAhBC,GACHA,EAAYG,IACZA,EACNJ,EAAMx6F,MAAM6I,SAAW,QACvBuuB,SAAS52B,KAAK06F,OAAOV,GACrBG,EAAoB7uE,EACtB,CACA,MAAO,CACL0uE,QACA1uE,OACA6uE,sBACAnc,WAAYF,EAAY,CAAExyD,SAC3B,EAEHyyD,OAAQxqF,IAGD,IAHE,SACP0qF,EACAD,YAAY,KAAE1yD,EAAI,oBAAE6uE,EAAmB,WAAEnc,IAC1CzqF,EACC,MAAMg4B,EAAW,CACf7X,KAAM4X,EAAK5X,KAAOuqE,EAAS10B,EAC3B51C,MAAO2X,EAAK3X,MAAQsqE,EAAS10B,EAC7Bha,IAAKjkB,EAAKikB,IAAM0uC,EAASx0B,EACzBntB,OAAQhR,EAAKgR,OAAS2hD,EAASx0B,EAC/BviD,OAAQokB,EAAKpkB,OACbmL,MAAOiZ,EAAKjZ,OAEd8nF,EAAoB5uE,GACpBwyD,EAAO,CAAEzyD,OAAMC,KAAI0yD,WAAUD,cAAa,EAE5CE,UAAW1oF,IAA4C,IAAzCwoF,YAAY,MAAEgc,EAAK,WAAEhc,IAAcxoF,EAC/CwkG,GAAOx1E,SACP05D,IAAY,CAAEF,cAAa,GAGjC,CEnFO,SAAS2c,GAAgBh0G,GAQF,IARM,OAClCguC,EACA1lC,MAAOumG,EACPp6C,WAAYw/C,EAAM,WAClBlF,EAAa,GAAE,aACf9nF,EAAe,GAAE,YACjBitF,EAAW,OACX76E,GACyBr5B,EACzB,MAAMynB,GAAexX,EAAAA,EAAAA,QAAuB,OAEtC,SAAEkkG,EAAQ,aAAEvG,EAAY,YAAEE,EAAW,aAAEE,GRqJxC,SAAoC7uG,GAEzC,MAAMue,EAAKve,EAAM6uC,OACXpyB,GAAU8M,EAAAA,EAAAA,YAAW+kF,GACrB2G,GAAiBv3F,EAAAA,EAAAA,GAAU1d,GAwBjC,OAvBAkO,EAAAA,EAAAA,YAAU,KACR,GAAIuO,EACF,OAAOA,EAAQwyF,UAAU1wF,EAAI02F,EAC/B,GACC,CAACx4F,EAAS8B,IAmBN,CACLy2F,SAjBA5wG,IAAQ,CAKR8wG,cAAez4F,EACfu7E,YAAajkF,IAAe,IAAd,KAAEyxB,GAAMzxB,EACpB0I,GAAS0yF,YAAY5wF,EAAI,CAAEinB,OAAMphC,OAAM,EAEzC6zF,OAAQxjF,IAAa,IAAZ,GAAEgxB,GAAIhxB,EACbgI,GAASyxF,KAAK,CAAEzoE,MAAK,EAEvB2yD,UAAWA,KACT37E,GAASwzF,SAAS,IAKpBxB,aAAchyF,GAASgyF,cAAgB,KACvCI,aACEpyF,GAASoyF,cAActwF,KAAOA,EAC1B9B,GAASoyF,aAAaA,aACtB,KACNF,YAAalyF,GAASkyF,aAAe,KAEzC,CQzLIwG,CAAwB,CACtB9F,YAAa/mF,EACb4R,SACA2U,SACA6gE,YACAE,aACAE,sBAAwB1rG,IACtB,MAAMgxG,EAAoBC,GAAcn7E,EAAOm7E,KAAYjxG,EACrDkrG,EAAgBhnF,EAAavX,QAKnC,OAAO++F,GAAsB,CAC3BR,cAAeA,EACfI,UAAWA,EAAUx9F,OAAOkjG,GAC5BxF,WAAYA,EAAW19F,OAAOkjG,GAC9Bl7E,SACA2U,SACA0gE,YAVmBnrG,GACnBkrG,EACG7mF,cAAe,cAAarkB,OAC5BkgE,yBAQH,IAIF2lC,EACY,MAAhB4E,GACe,MAAfF,GACA,IAAIe,KAAcE,GAAYvyC,OAAOxtD,GAASqqB,EAAOrqB,KAAU8+F,IAE3Dr5C,EAAczlD,IAClB,MAAMzL,EAAM81B,EAAOrqB,GAEnB,OACE5P,EAAAA,cAACq1G,IAAsBn1G,EAAAA,EAAAA,GAAA,CACrB0uC,OAAQA,EACRzqC,IAAKA,EACL,WAAUA,EACVsV,MAAO,IACF67F,GAAsB,CACvBnxG,MACAyqG,eACAhgE,SACA4/D,eACAE,kBAGAqG,EAAS5wG,GAAI,CACjB6Y,OAAQ6K,EAAahZ,SAAS1K,GAC9BiW,QAASA,IAAM06F,IAAc3wG,KAE5B0wG,EAAOjlG,GACe,EAG7B,OACE5P,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC6zG,GAAsB,CACrBjlE,OAAQA,EACRmlE,gBAAiBhnD,QAAQ6hD,GACzB5E,YAAaA,EACb5lF,IAAKiE,GAEJonF,EAAU5rG,IAAIwxD,GACfr1D,EAAAA,cAACmxC,GAAY,MACZw+D,EAAW9rG,IAAIwxD,IAIxB,CAGA,SAASigD,GAAqB9nG,GAY1B,IAZ2B,OAC7BohC,EAAM,IACNzqC,EAAG,aACHyqG,EAAY,aACZJ,EAAY,YACZE,GAODlhG,EACC,MAAM+nG,EAAwB,CAC5B,EAEF,GAAI3G,GAAc3xC,UAAU94D,MAAQA,GAAOqqG,EAAc,CACvD,MAAMgH,GAAc7E,EAAAA,EAAAA,IAAuB/hE,GACvC4/D,EAAaliF,MACbkiF,EAAartF,QAEbwvF,EAAAA,EAAAA,IAAuB/hE,GACzB2mE,EACsC,WAApC3G,EAAa3xC,SAAS3mB,UAClB,aACA,eACFk/D,EAEJD,EACsC,WAApC3G,EAAa3xC,SAAS3mB,UAClB,YACA,gBACFk/D,CAER,CAIA,OAHIrxG,IAAQuqG,IACV6G,EAAOloF,QAAU,QAEZkoF,CACT,CAEA,SAASF,GAAsB5lG,GAmB3B,IAnBkC,SACpC3O,EAAQ,OACR8tC,EAAM,YACNmpD,EAAW,OACXC,EAAM,UACNG,EAAS,QACT/9E,EAAO,aACP66F,KACG/hD,GAWJzjD,EACC,MAAM2U,GAAMvT,EAAAA,EAAAA,QAAoB,OAK1B,WAAEqzE,GAAe,CACrBA,WAAY,CACVhoC,YAAa9hC,EACbk/C,YAAcpvD,IACZA,EAAEuX,gBAAgB,IAIlB1hB,EAAQi0G,GAAe,CAC3B5vF,MACA4zB,SAAUi9D,EACVtiC,cAAe,EACfshC,OAAO,EACPlc,cACAC,SACAG,cAGF,OACEn4F,EAAAA,cAAC4zG,IAA4B1zG,EAAAA,EAAAA,GAAA,CAC3B0uC,OAAQA,IACJpvB,EAAAA,GAAAA,GAAW0zC,EAAYgxB,EAAYnkF,GAAM,CAC7CqkB,IAAKA,IAEJtjB,EAGP,CAAC8zG,GAAAv0G,aAAA,6lC,gBC/LM,MAAMo1G,GAAmBl1G,EAAAA,GAAO+Z,GAAwB;;;;IAI3D1Z,IAAA,IAAC,OAAEguC,GAAQhuC,EAAA,OACX+vG,EAAAA,EAAAA,IAAuB/hE,IACnBptC,EAAAA,EAAAA,IAAG,sBAIHA,EAAAA,EAAAA,IAAG,oBAGF;IACLgM,IAAA,IAAC,OAAEohC,GAAQphC,EAAA,OACXhM,EAAAA,EAAAA,IAAG,WACCotC,EAAM;EAIP,SAAS8mE,GAAUjmG,GAUtB,IAVuB,MACzB5B,EAAK,OACL+gC,EAAM,SACN9tC,EAAQ,SACRywF,GAMD9hF,EACC,OACE5B,GACE7N,EAAAA,cAACy1G,GAAgB,CAAC7mE,OAAQA,GACxB5uC,EAAAA,cAACkhG,GAAAA,EAAa,CACZvmE,aACEg2E,EAAAA,EAAAA,IAAuB/hE,GAAU,WAAa,aAEhDuyD,iBACa,SAAXvyD,GAAgC,QAAXA,EAAmB,QAAU,SAEpD9hC,KAAMe,EAAMf,KACZykF,SAAUA,GAETzwF,GAKX,CAAC40G,GAAAr1G,aAAA,siB,gBC+CM,MAAMs1G,GAAc31G,EAAAA,YAAiB,SAAoBY,EAa9DwjB,GACqB,IAbrB,mBACEwxF,GAAqB,EAAK,oBAC1BC,GAAsB,EAAK,OAC3B10F,EAAS,OAAM,UACf4L,EAAY,IAAG,iBACfqkC,EAAgB,wBAChBqZ,EAAuB,QACvBE,EAAO,SACP7pE,EAAQ,oBACRg1G,EAAsB,GAAE,eACxB90F,EAAiB,CAAC,GACDpgB,EAGnB,MAAMm1G,GAActsE,EAAAA,EAAAA,IAAQj8B,IAAA,IAAC,GAAE8Q,GAAI9Q,EAAA,OAAK8Q,CAAE,GAAEqsD,GACtCtiD,GAAexX,EAAAA,EAAAA,QAAuB,MACtCmlG,GACJnlG,EAAAA,EAAAA,QAA8C,OACzColG,EAAaC,IAAkBlxG,EAAAA,EAAAA,YAChCmxG,GAAsBtlG,EAAAA,EAAAA,QAEzB,CAAC,GAEEulG,GAAY34F,EAAAA,EAAAA,GAAU,CAAE2zC,mBAAkBqZ,6BAEhDvlE,EAAAA,EAAAA,kBAAgB,KACd,MAAMmxG,EAAYhuF,EAAavX,QACzBwlG,EAAkBA,IACtBJ,ER4DC,SACLroG,EACA6iG,EAKA6F,QAAmB,IAAnBA,IAAAA,EAAsBvyG,OAAOC,KAAK4J,EAAM88D,UAExC,MAAMpiB,EAAcvkD,OAAOC,KAAK4J,EAAM88D,SACnC14D,QACE9N,GAAQoyG,EAAU1nG,SAAS1K,KAAS0J,EAAMyjD,sBAAsBz3B,IAAI11B,KAEtEN,KAAKM,IAAG,IACJ0J,EAAM88D,QAAQxmE,GACjBA,WAEE,IACJqlD,EAAM,GAAE,OACRjT,EAAS,GAAE,KACX5oB,EAAO,GAAE,MACTC,EAAQ,KACNiQ,EAAAA,EAAAA,IAAQppB,IAAA,IAAC,OAAEm6B,GAAQn6B,EAAA,OAAKm6B,CAAM,GAAE2Z,GACpC,MAAO,CACL56B,KAAMskF,EAAa,OAAQvB,EAAe/iF,GAC1C67B,IAAKyoD,EAAa,MAAOvB,EAAelnD,GACxC57B,MAAOqkF,EAAa,QAASvB,EAAe9iF,GAC5C2oB,OAAQ07D,EAAa,SAAUvB,EAAen6D,GAC9Co0B,QAAS6nC,EAAqB,SAAU9B,EAAenoD,GACvDmlD,aAAc8E,EAAqB,QAAS9B,EAAenoD,GAE/D,CQ1FQiuD,CACEplD,EACAilD,EAAWhyC,wBACXsG,EAAQ9mE,KAAI4L,IAAA,IAAC,GAAE6O,GAAI7O,EAAA,OAAK6O,CAAE,MAWhC,GAA+B,IAA3B+3F,GAAWp0C,aAAiD,IAA5Bo0C,GAAWzmB,aAAoB,CACjE,MAAM6mB,EAAW,IAAIC,gBAAetmG,IAAe,IAAb+T,GAAO/T,EACvC+T,EAAOwyF,YAAYrqF,MAAQ,GAAKnI,EAAOwyF,YAAYx1F,OAAS,IAC9Dm1F,IACAG,EAASG,UAAUP,GACrB,IAEFI,EAASrc,QAAQic,EACnB,CACAC,GAAiB,GAChB,CAACllD,KAEJtkB,EAAAA,EAAAA,qBACE1oB,GACA,MACE5Q,MAAQrP,IACNgyG,EAAoBrlG,QAAQ3M,IAAM2M,SAAS0C,OAAO,EAEpDo5B,SAAWzoC,GAET,OADA0sC,SAASC,eAAex/B,QAAS,yBAAwBnN,OAE3D0yG,sBAAuBA,KACrB,MAAM,eAAEC,GAAmBV,EAAUtlG,QAAQsgD,iBACvB,MAAlB0lD,IAECV,EAAUtlG,QAAQsgD,iBAAiBuZ,QAAQmsC,GACzCpuD,WAEH0tD,EAAUtlG,QAAQ25D,wBAChBrZ,EAAiBt3C,KAAKg9F,IAG1BX,EAAoBrlG,QAAQgmG,GAAgBhmG,SAAS0C,OAAM,GAC7D,EAEFujG,iBAAkBA,KAChBf,EAAyBllG,SAAS0C,OAAO,EAE3C6oD,YAAc26C,IACZvsC,EAAwBusC,EAAQZ,EAAUtlG,QAAQsgD,kBAAkB,KAGxE,IAGF,MAAM6lD,GAAwBpmG,EAAAA,EAAAA,SAAO,IACrCosF,EAAAA,GAAAA,GAAmB,CACjB74E,IAAKiE,EACL60E,uBAAwBA,KACtB+Z,EAAsBnmG,SAAU,CAAI,EAEtCqsF,kBAAmBA,KACjB8Z,EAAsBnmG,SAAU,CAAK,IC5LpC,SACLomG,EAIA7uF,IAEApa,EAAAA,EAAAA,YAAU,KACR,MAAMkpG,EAAmBjtG,IAErBA,EAAEpB,kBAAkBioC,aACpB1oB,EAAavX,SAASogF,SAAShnF,EAAEpB,WAC/BoB,EAAEkH,eAAiBlH,EAAEkH,yBAAyB2/B,eAC/C1oB,EAAavX,SAASogF,SAAShnF,EAAEkH,gBAElC8lG,EAAY,CACVE,mBAAoBltG,EAAEpB,OACtBuuG,sBAAuBntG,EAAEkH,eAE7B,EAGF,OADAiX,EAAavX,SAASy8D,iBAAiB,WAAY4pC,GAC5C,KACL9uF,EAAavX,SAASssE,oBAAoB,WAAY+5B,EAAgB,CACvE,GACA,GACL,CDsKEG,EAAexjG,IAAgC,IAA/B,sBAAEujG,GAAuBvjG,EAClCujG,GAA0BJ,EAAsBnmG,SACnDklG,EAAyBllG,SAAS0C,OACpC,GACC6U,GAGH,MAAMkvF,EAAe/iG,IAAA,IAAC,OACpBo6B,EAAM,MACN/gC,GAID2G,EAAA,OACCxU,EAAAA,cAAC40G,GAAgB,CACfhmE,OAAQA,EACR1lC,MAAO2E,EAAMqkG,KACbvC,WAAY9hG,EAAM9K,MAClBk3B,OAASrqB,GAASA,EAClBylD,WAAazlD,GAASmmG,EAAYnmG,IAAO4nG,cACzC1C,YAAc3wG,GACZsmE,EAAwBrZ,EAAiBzvB,OAAOx9B,IAElD0jB,aAAcha,EAAMskG,YACpB,EAGExE,EAAoBxpG,IACnBgyG,EAAoBrlG,QAAQ3M,KAC/BgyG,EAAoBrlG,QAAQ3M,GAAOnE,EAAAA,aAGnCA,EAAAA,cAAA,OACEyZ,MAAO,CAAEjN,IAAK,SACd,sBAAqBrI,EACrB8M,QAASA,KACPw5D,EAAwBrZ,EAAiBqmD,YAAYtzG,GAAK,GAG5DnE,EAAAA,cAACu4D,EAAAA,EAAU,CAACn0C,IAAK+xF,EAAoBrlG,QAAQ3M,IAC3CnE,EAAAA,cAAC03G,EAAAA,EAAuB,CACtBp5F,GAAIna,EACJkkB,aAAcA,EACdsvF,wBAAyB3B,EACzB5kD,iBAAkBA,EAClBqZ,wBAAyBA,GAExBsrC,EAAY5xG,IAAMsF,YAOvBmuG,EAAuBnjG,IAMtB,IANuB,OAC5Bm6B,EAAM,MACN/gC,GAID4G,EACC,OAAK5G,EAIH7N,EAAAA,cAACovC,EAAAA,EAAiB,CAChBC,UAAWs+D,EAAiB9/F,EAAMgkG,SAClCviE,iBAAkB,GAClBC,SAAU1hC,EAAM9K,OAAS4qG,EAAiB9/F,EAAM9K,MAAMoB,KACtDqrC,SAAU3hC,EAAM9K,OAAO+uG,aACvBriE,aAAekrD,IACblwB,EACErZ,EAAiBymD,oBAAoBjpE,EAAQ+rD,GAC9C,EAEHhgE,aAAag2E,EAAAA,EAAAA,IAAuB/hE,GAAU,aAAe,aAbxD,IAcL,EAGAkpE,EAAgBlpE,GAAoB9hC,IACxC,MAAMirG,EAAkB1vF,EAAavX,SAASuzD,wBAE1C0zC,GACFttC,EACErZ,EAAiB4mD,WAAWppE,EAAQ9hC,EAAMirG,GAE9C,EAEIE,EAAoBA,CACxBhC,EACAt7E,KAEA,MAAMu9E,EAA8B,eAAhBv9E,EAA+B,OAAS,MACtDw9E,EAA+B,eAAhBx9E,EAA+B,QAAU,SAC9D,MAAO,CACLA,cACAkgB,UAAW+8D,EAAqB,CAC9BhpE,OAAQspE,EACRrqG,MAAOooG,EAAYiC,GAAa7F,SAElC33D,UAAWu7D,EAAYiC,GAAa7F,QAAQvlG,KAC5C6tC,cAAem9D,EAAaI,GAC5B3oE,SAAUqoE,EAAqB,CAC7BhpE,OAAQupE,EACRtqG,MAAOooG,EAAYkC,GAAc9F,SAEnC7iE,SAAUymE,EAAYkC,GAAc9F,QAAQvlG,KAC5C2iC,aAAcqoE,EAAaK,GAC5B,EAyHH,OACEn4G,EAAAA,cAACswG,EAA4BC,OAAKrwG,EAAAA,EAAAA,GAAA,GAC5B8gB,EAAc,CAClBoD,IAAKiE,EAMLmoF,YAAaoF,EACbn8F,MAAO,CAAE0H,SAAQ4L,eAAc/L,GAAgBvH,SAE9Cw8F,GAnIsBA,KACzB,MAAMmC,EAA0BH,EAC9BhC,EACA,cAEIoC,EAAwBJ,EAAkBhC,EAAa,aAEtDqC,EAAoBC,GAAsB1C,EAC7C,CAACuC,EAAyBC,GAC1B,CAACA,EAAuBD,GAEtBI,EAAgB,CAAC,OAAQ,MAAO,QAAS,UAAoB30G,KAChE+qC,IACC,MAAM/gC,EAAQooG,EAAYrnE,GAAQwjE,SAClC,OACEvkG,GACE7N,EAAAA,cAAC01G,GAAU,CACTvxG,IAAKyqC,EACLA,OAAQA,EACR/gC,MAAOA,EACP0jF,SAAWzkF,IACTub,EAAavX,SACX25D,EACErZ,EAAiBqnD,aACf7pE,EACA9hC,EACAub,EAAavX,QAAQuzD,yBAExB,GAGJspC,EAAiB9/F,EAAM1J,KAE3B,IAKP,OACEnE,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACsuG,EAA+B,CAC9BtW,OAAQrjF,IAAmB,IAAlB,GAAE6wB,EAAE,KAAED,GAAM5wB,EACnB81D,EACErZ,EAAiB68C,KACfgI,EAAY1wE,EAAKqJ,QAAQ2/D,QACvBhpE,EAAKsjB,QAAU,QAAU,QACzBtjB,EAAKnyB,OACP,CAAEw7B,OAAQpJ,EAAGoJ,OAAQia,QAASrjB,EAAGqjB,SACjCrjB,EAAGpyB,OAEN,GAQHpT,EAAAA,cAACswG,EAA4BH,WAAU,KACpCoH,EAAa,CACZ3oE,OAAQ,OACR/gC,MAAOooG,EAAkB,KAAE1H,WAG/BvuG,EAAAA,cAACswG,EAA4BL,UAAS,KACnCsH,EAAa,CACZ3oE,OAAQ,MACR/gC,MAAOooG,EAAiB,IAAE1H,WAG9BvuG,EAAAA,cAACswG,EAA4BF,YAAW,KACrCmH,EAAa,CACZ3oE,OAAQ,QACR/gC,MAAOooG,EAAmB,MAAE1H,WAGhCvuG,EAAAA,cAACswG,EAA4BJ,aAAY,KACtCqH,EAAa,CACZ3oE,OAAQ,SACR/gC,MAAOooG,EAAoB,OAAE1H,YAQnCvuG,EAAAA,cAACswG,EAA4BD,UAAS,KACpCrwG,EAAAA,cAACovC,EAAAA,GAAiBlvC,EAAAA,EAAAA,GAAA,GACZo4G,EAAkB,CACtBjpE,UACErvC,EAAAA,cAACovC,EAAAA,GAAiBlvC,EAAAA,EAAAA,GAAA,CAChBovC,iBAAkBwmE,EAClBzmE,UACErvC,EAAAA,cAACu4D,EAAAA,EAAU,CAACn0C,IAAK4xF,GACdl1G,IAGDy3G,OAITC,EAECx4G,EAAAA,cAACytG,EAAgB,CACfC,aAAcuI,GAAavI,aAC3BC,iBAAkBA,EAClBjkD,eAAgBA,CAACvlD,EAAKilD,IACpBqhB,EACErZ,EAAiBsnD,iBAAiBv0G,EAAKilD,OAMhD,EAgBauvD,CAAkB1C,GAGxC,IAAGN,GAAAt1G,aAAA,+nG,gFE7aH,MAAMu4G,EACJ54G,EAAAA,cAAwD,MAK7C6uC,EAAqBA,KAChC,MAAMryB,GAAU8M,EAAAA,EAAAA,YAAWsvF,GAC3B,IAAKp8F,EACH,MAAM,IAAInS,MACR,kEAGJ,OAAOmS,CAAO,EAOHk7F,EAOT92G,IAOG,IAPF,iBACHwwD,EAAgB,aAChB/oC,EAAY,wBACZsvF,EAAuB,wBACvBltC,EAAuB,GACvBnsD,EAAE,SACFxd,GACDF,EACC,MAAMy3E,GAAO/0C,EAAAA,EAAAA,IAAiB,KAC5BmnC,EAAwBrZ,EAAiBinB,KAAK/5D,GAAI,IAE9Cu6F,GAAOv1E,EAAAA,EAAAA,IAAiB,KAC5BmnC,EAAwBrZ,EAAiBynD,KAAKv6F,GAAI,IAE9CmgB,GAAS6E,EAAAA,EAAAA,IAAiB,KAC9BmnC,EAAwBrZ,EAAiB0nD,kBAAkBx6F,GAAI,IAE3Dy4F,GAAmBzzE,EAAAA,EAAAA,IAAiB,KACxCq0E,EAAwB7mG,SAAS0C,OAAO,IAEpCulG,GAAaz1E,EAAAA,EAAAA,IAChBo1D,IACCjuB,EAAwBrZ,EAAiB68C,KAAK3vF,EAAIo6E,GAAM,IAGtDsgB,GAAiB11E,EAAAA,EAAAA,IAAkB+tE,IACvC5mC,EAAwBrZ,EAAiB4nD,eAAe16F,EAAI+yF,GAAU,IAElE4H,GAAe31E,EAAAA,EAAAA,IAAkBl/B,IACrC,MAAMiyG,EAAYhuF,EAAavX,QAC/B,IAAKulG,EACH,MAAM,IAAIhsG,MAAM,sDAElBogE,EACErZ,EAAiB6nD,aACf36F,EACAla,EACAiyG,EAAUhyC,yBAEb,IAEG60C,GAAgB51E,EAAAA,EAAAA,IAAkBl/B,IACtC,MAAMiyG,EAAYhuF,EAAavX,QAC/B,IAAKulG,EACH,MAAM,IAAIhsG,MAAM,sDAElBogE,EACErZ,EAAiB8nD,cACf56F,EACAla,EACAiyG,EAAUhyC,yBAEb,IAEG80C,GAAoB71E,EAAAA,EAAAA,IAAkB8lB,IAC1CqhB,EAAwBrZ,EAAiBsnD,iBAAiBp6F,EAAI8qC,GAAQ,IAElEo2C,GAAe77E,EAAAA,EAAAA,UAAQ,KAEpB,CACL9V,MAFYujD,EAAiBuZ,QAAQrsD,GAGrCu6F,OACAxgC,OACA55C,SACAs4E,mBACAgC,aACAC,iBACAC,eACAC,gBACAC,uBAED,CAAC/nD,EAAkB9yC,IACtB,OACEte,EAAAA,cAAC44G,EAAuBl4D,SAAQ,CAACt8C,MAAOo7F,GACrC1+F,EAC+B,EAEpC42G,EAAAr3G,aAAA,mP,6JC3CF,MAAM+4G,EAAYhL,GACQ,oBAAxBA,EAAWiD,UACa,kBAAxBjD,EAAWiD,SAaAgI,GAAmBC,EAAAA,EAAAA,IAC9B,CAACC,EAAmBC,IAClBD,EAAQ3qE,SAAW4qE,EAAQ5qE,QAAU2qE,EAAQ1wD,UAAY2wD,EAAQ3wD,UAGxD4wD,EAAmBpI,GACb,kBAAbA,GAA6C,oBAAbA,EAC3B,SAEQ,WAAbA,GAAsC,UAAbA,EACpB,QAEFA,EAcF,MAAMhgD,EAIXyqB,WAAAA,CACkBnR,EAA2B7/D,GAU1C,IATD,eACEgsG,EAAiB,KAAI,gBACrB4C,EAAkB,CAAC,EAAC,sBACpBpoD,EAAwB,SAKzB,IAAAxmD,EAAG,CAAC,EAACA,EAAA,KATU6/D,QAAAA,EAA2B,KAJ7BmsC,oBAAc,OACdxlD,2BAAqB,OACpBooD,qBAAe,EAa9B19B,KAAK86B,eAAiBA,EACtB96B,KAAK09B,gBAAkBA,EACvB19B,KAAK1qB,sBAAwB,IAAIx5C,IAAIw5C,GAIrC,MAAMqoD,EAAiB31G,OAAOC,KAAK+3E,KAAKrR,SAAS14D,QAC9C9N,GACC63E,KAAK1qB,sBAAsBz3B,IAAI11B,IAAQ63E,KAAKrR,QAAQxmE,GAAKukD,YAE7D,GAAIixD,EAAetpG,OAAS,EAC1B,MAAM,IAAIhG,MACP,wGAAuGsvG,IAG9G,CAEAd,IAAAA,CAAKe,GACH,OAAO59B,KAAK69B,YAAW,CAACzL,EAAYjqG,IAClCA,IAAQy1G,EACJ,IACKxL,EACH1lD,WAAW,GAEb0lD,GAER,CACA0L,OAAAA,GACE,OAAO99B,KAAK69B,YACV,CAACzL,EAAYjqG,IAC8B,UAAzCs1G,EAAgBrL,EAAWiD,UACvBjD,EACA,IACKA,EACH1lD,WAAW,IAEnB,CAAEgxD,gBAAiB19B,KAAKrR,SAE5B,CAKAovC,cAAAA,GACE,OAAO/9B,KAAK69B,YACV,CAACzL,EAAYjqG,IAAQ63E,KAAK09B,gBAAgBv1G,IAAQiqG,GAEtD,CAEAqJ,WAAAA,CAAYtzG,GACV,OAAO63E,KAAK69B,YAAYzL,GAAeA,GAAY,CACjD0I,eAAgB3yG,GAEpB,CAEA2V,IAAAA,CAAK8/F,GACH,MAAM9wG,EAASkzE,KAAKrR,QAAQivC,GAC5B,IAAK9wG,EACH,OAAOkzE,KAET,MAAMg+B,EAAgC,GAMtC,MALwB,WAApBlxG,EAAOuoG,SACT2I,EAAkBlqG,KAAK,UACdspG,EAAStwG,IAClBkxG,EAAkBlqG,KAAK,kBAAmB,gBAAiB,UAEtDksE,KAAK69B,YACV,CAACzL,EAAYjqG,IACPA,IAAQy1G,EACH,IACFxL,EACH1lD,WAAW,GAIb0lD,EAAW1lD,WACX2wD,EAAiBvwG,EAAQslG,IACzB4L,EAAkBnrG,SAASu/F,EAAWiD,UAE/B,IAAKjD,EAAY1lD,WAAW,GAE9B0lD,GAET,CACE98C,sBAAuB,IAAI0qB,KAAK1qB,uBAAuBr/C,QACpD9N,GAAQA,IAAQy1G,KAIzB,CAEAj4E,MAAAA,CAAOi4E,GACL,OAAO59B,KAAKrR,QAAQivC,IAAYlxD,UAC5BszB,KAAK68B,KAAKe,GACV59B,KAAKliE,KAAK8/F,EAChB,CAEAvhC,IAAAA,CAAKuhC,GACH,MAAM9wG,EAASkzE,KAAKrR,QAAQivC,GAC5B,OAAK9wG,IAhJiB,qBADNslG,EAiJWtlG,GAhJlBuoG,UAA0D,WAAxBjD,EAAWiD,UAmJ/Cr1B,KAAK69B,YAAYzL,GAClBA,IAAetlG,EACV,IACFslG,EACH1lD,WAAW,GAGR0lD,IATApyB,KAlJOoyB,KA6JlB,CAGA4K,cAAAA,CAAeY,EAAgBvI,GAC7B,MAAMvoG,EAASkzE,KAAKrR,QAAQivC,GAC5B,OAAK9wG,EAGEkzE,KAAK69B,YAAYzL,IACtB,GAAIA,IAAetlG,EACjB,MAAO,IACFslG,EACHiD,YAGJ,MAAM4I,EAAeR,EAAgBrL,EAAWiD,UAChD,OACEjD,EAAW1lD,WACM,UAAjBuxD,GACAZ,EAAiBjL,EAAYtlG,IAC7BmxG,IAAiBR,EAAgBpI,GAE1B,IACFjD,EACH1lD,WAAW,GAGR0lD,CAAU,IArBVpyB,IAuBX,CAIAiyB,IAAAA,CACE2L,EACAM,EACA9mG,GAEA,MAAMtK,EAASkzE,KAAKrR,QAAQivC,GAC5B,IAAK9wG,EACH,OAAOkzE,KAET,MAAMm+B,EAAoC,iBAAhBD,EAA2BA,EAAcpxG,EAC7DsxG,EAAqC,iBAAhBF,EAA2BA,EAAc9mG,EAC9DinG,EAAoBr2G,OAAO+sB,QAAQirD,KAAKrR,SAAS14D,QAAOrR,IAAA,IAAE,CAAEwD,GAAMxD,EAAA,OACtEy4G,EAAiBc,EAAY/1G,EAAM,IAE/Bk2G,EAAoBD,EAAkBhnG,WAC1C7F,IAAA,IAAE,CAAEtB,GAAOsB,EAAA,OAAKtB,IAAWpD,CAAM,IAE7ByxG,EACJD,EAAoB,GAChBE,EAAAA,EAAAA,GACEJ,IAAgB,EAChB,CAACR,EAAW,IAAK9wG,KAAWqxG,IAC5BE,IAEFpM,EAAAA,EAAAA,GACEqM,EACAF,GAAeE,EACfD,GAEFI,GAAuB3pC,EAAAA,EAAAA,GAC3BypC,EAAoB12G,KAAI,CAAA4L,EAAe2D,KAAW,IAAxBjP,EAAKC,GAAMqL,EAC/Bq3B,EAAW1iC,EACXA,EAAM2sG,QAAU39F,IAClB0zB,EAAW,IAAK1iC,EAAO2sG,MAAO39F,IAEhC,MAAMsnG,EAAiBjB,EAAgB3wG,EAAOuoG,UAU9C,OAREltG,IAAQy1G,GACR9wG,EAAO4/C,WACPtkD,EAAMskD,WACa,UAAnBgyD,GACAjB,EAAgBr1G,EAAMitG,YAAcqJ,IAEpC5zE,EAAW,IAAK1iC,EAAOskD,WAAW,IAE7B,CAAE,GAAEvkD,IAAO2iC,EAAS,KAG/B,OAAOk1C,KAAK69B,YAAW,CAACz1G,EAAOD,IAAQs2G,EAAqBt2G,IAAQC,GACtE,CAEA60G,YAAAA,CACEW,EACAx1G,EACA2zG,GAEA,OAAO/7B,KAAK2+B,QAAQf,EAAWx1G,EAAO2zG,EAAiB,QACzD,CAEAmB,aAAAA,CACEU,EACAx1G,EACA2zG,GAEA,OAAO/7B,KAAK2+B,QAAQf,EAAWx1G,EAAO2zG,EAAiB,SACzD,CAEAW,gBAAAA,CACEkB,EACAnH,GAEA,OAAOz2B,KAAKlmE,OAAO8jG,EAAW,iBAAkBnH,EAClD,CAEAqG,iBAAAA,CAAkBc,GAChB,OAAO59B,KAAK69B,YACV,CAAChsG,EAAO1J,IACNA,IAAQy1G,EACJ,IACK/rG,EACH66C,WAAW,GAEb76C,GACN,CACEyjD,sBAAuB,IAAI0qB,KAAK1qB,sBAAuBsoD,IAG7D,CAEAC,UAAAA,CACEe,EACAh1G,GAEA,YAF0D,IAA1DA,IAAAA,EAA6D,CAAC,GAEvD,IAAIyrD,GAAiBxqB,EAAAA,EAAAA,GAAc+zE,EAAO5+B,KAAKrR,SAAU,CAC9DmsC,eAAgB96B,KAAK86B,eACrB4C,gBAAiB19B,KAAK09B,gBACtBpoD,sBAAuB0qB,KAAK1qB,yBACzB1rD,GAEP,CAEQkQ,MAAAA,CACN8jG,EACAz1G,EACAC,GAEA,MAAM0E,EAASkzE,KAAKrR,QAAQivC,GAC5B,OAAK9wG,EAGEkzE,KAAK69B,YAAY3tG,GAClBA,IAAWpD,EACN,IACFoD,EACH,CAAC/H,GAAMC,GAGJ8H,IATA8vE,IAWX,CAEQ2+B,OAAAA,CACNf,EACAx1G,EACA2zG,EACA8C,GAEA,MAAM/xG,EAASkzE,KAAKrR,QAAQivC,GAC5B,IAAK9wG,EACH,OAAOkzE,KAET,MAAMi+B,EAAeR,EAAgB3wG,EAAOuoG,UAC5C,GAAqB,UAAjB4I,EACF,OAAOj+B,KAAK69B,YAAY3tG,IACtB,GAAIA,IAAWpD,EAAQ,CACrB,MAAMgyG,EAAuB5uG,EAAOumG,eACpC,MAAO,IACFvmG,EACHumG,eAAgB,IACXqI,EACH,CAACD,GAAWC,EAAqBD,GAAYz2G,GAGnD,CACA,OAAO8H,CAAM,IAMjB,KAHyBykG,EAAAA,EAAAA,IAAuB7nG,EAAO8lC,QACnD,SACA,WACqBisE,EACvB,OAAO7+B,KAET,MAAM00B,EAAgBqH,EAAgB8C,GAChC/zE,EAAW4pE,EAAgB5nG,EAAO6/C,OAASvkD,EAEjD,OADwBy1F,EAAAA,EAAAA,GAAM,EAAG6W,EAAe5pE,KAAcA,EAEvC,WAAjBmzE,EACKj+B,KAAKg8B,WAAWlvG,EAAO8lC,OAAQ9H,EAAUixE,GAEzC/7B,KAAKy8B,aAAa3vG,EAAO8lC,OAAQ9H,EAAUixE,GAG/C/7B,IACT,CAEAg8B,UAAAA,CACEppE,EACA9hC,EACAirG,GAEA,OAAO/7B,KAAK++B,YAAW,EAAMnsE,EAAQ9hC,EAAMirG,EAC7C,CAEAU,YAAAA,CACE7pE,EACA9hC,EACAirG,GAEA,OAAO/7B,KAAK++B,YAAW,EAAOnsE,EAAQ9hC,EAAMirG,EAC9C,CAEAF,mBAAAA,CAAoBjpE,EAAgB+Z,GAClC,OAAOqzB,KAAK69B,YAAY3tG,GAClBA,EAAO0iC,SAAWA,GAAU1iC,EAAOw8C,WAAa0wD,EAASltG,GACpD,IACFA,EACH6lG,WAAY7lG,EAAO28C,QAAUF,EAAS,EAAIA,GAGvCz8C,GAEX,CAEQ6uG,UAAAA,CACNC,EACApsE,EACA9hC,EACAirG,GAEA,OAAO/7B,KAAK69B,YAAY3tG,IACtB,MAAM+uG,EAAmBD,EACrB5B,EAASltG,GACW,WAApBA,EAAOmlG,SACX,GAAInlG,EAAO0iC,SAAWA,GAAUqsE,GAAoB/uG,EAAOw8C,UAAW,CACpE,MAAMgoD,GAAiBC,EAAAA,EAAAA,IAAuB/hE,GAE1CmpE,EAAgB52F,OADhB42F,EAAgBzrF,MAEpB,MAAO,IACFpgB,EACHy8C,OAAQ77C,EAAO4jG,EAEnB,CACA,OAAOxkG,CAAM,GAEjB,EAGK,MAAMu8C,EAAkB,SAAAyyD,GAAA,IAAC,SAC9B7J,EAAW,mBACR8J,QACsB,IAAAD,EAAG,CAAC,EAACA,EAAA,MAAuB,CACrDtsE,OAAQ,OACRia,SAAS,EACTwoD,SAAUA,EACVN,MAAO,EACPpoD,OAAQ,GACRopD,WAAY,GACZrpD,WAAW,EACX+pD,eACgC,UAA9BgH,EAAgBpI,GACZ,CACE1jF,KAAM,IACN67B,IAAK,IACLl9B,MAAO,IACPnL,OAAQ,UAEViG,KACH+zF,EACJ,C,mECrgBM,MAAMrsE,EACXF,GAEA+hE,EAAuB/hE,GAAU,aAAe,WAErC+hE,EAA0B/hE,GAC1B,QAAXA,GAA+B,WAAXA,EAETklE,EAAgBllE,IAC1B,CACCjhB,KAAM,QACNC,MAAO,OACP47B,IAAK,SACLjT,OAAQ,OACR3H,G,iLCTG,SAASwsE,EAAax6G,EAAAkK,GAW1B,IAVD,aACEud,EAAY,WACZgzF,EAAU,oBACVC,GAKD16G,GACD,cAAE26G,QAA+D,IAAAzwG,EAAG,CAAC,EAACA,EAEtE,MAAO0wG,EAAiBC,IAAsBz2G,EAAAA,EAAAA,WAAS,IAqB/C6/E,iBAAkB62B,IAA4B52B,EAAAA,EAAAA,GAAe,CACnEC,oBAAqB02B,KAGjB,iBAAE52B,IAAqBC,EAAAA,EAAAA,GAAe,CAC1CC,oBAAqBw2B,KAGfI,gBAAiBC,GA8C3B,WACE,MAAM,KAAEvjC,IAASxpC,EAAAA,EAAAA,KACXgtE,GAAgBhrG,EAAAA,EAAAA,QAAsB,OACpCg0E,iBAAkBi3B,IAA2Bh3B,EAAAA,EAAAA,GAAe,CAClEuf,aAAen6F,IAEb2xG,EAAc/qG,QAAU5E,OAAO0H,YAAW,KAKT1J,EAAEkH,eAE/BinE,GACF,GACA,EAEJ0jC,cAAeA,KACiB,OAA1BF,EAAc/qG,UAChBse,aAAaysF,EAAc/qG,SAC3B+qG,EAAc/qG,QAAU,KAC1B,IAGJ,MAAO,CACL6qG,gBAAiBG,EAErB,CAzE6CE,IAErC,oBAAE1e,IAAwBC,EAAAA,EAAAA,GAAkB,CAChD0e,aAAcX,EAAoBxqG,SAAS0C,MAC3C0oG,yBAAyB,KAK3BjuG,EAAAA,EAAAA,YAAU,KAEL4iC,SAASC,eACTzoB,EAAavX,SAASogF,SAASrgD,SAASC,gBAEzCzoB,EAAavX,SAAS0C,OACxB,GACC,IAEH,MAAM,gBAAEs/D,IAAoB2kB,EAAAA,EAAAA,KAE5B,MAAO,CACL+jB,kBACAG,iBAAiBn8F,EAAAA,EAAAA,GACf89E,EACAzY,EACA+2B,EACA,CACE5nG,UAAW,IAGfmoG,uBAAwBT,EACxBU,sBAAuBtpC,EAE3B,C,wICtDO,SAASupC,EAA0Bz7G,GAItC,IAJuC,UACzCsiB,GAGDtiB,EACC,MAAM,MAAEiN,IAAUghC,EAAAA,EAAAA,KAEZytE,GAAsBt5F,EAAAA,EAAAA,GAAeu5F,EAAAA,IACrCC,GAAoBx5F,EAAAA,EAAAA,GAAey5F,EAAAA,IACnCC,GAAgB15F,EAAAA,EAAAA,GAAe25F,EAAAA,IAC/BC,GAAiBvhG,EAAAA,EAAAA,IAAUs0D,EAAAA,IAC3BktC,GAA0BxhG,EAAAA,EAAAA,IAC9ByhG,EAAAA,IAEF,KACGR,GACAE,GACAE,GACAE,GACAC,GAED,MAAM,IAAIxyG,MACR,iEAIJ,MAAM0yG,EAAqC,CACzCT,EACAE,EACA,CACEl+F,GAAI,SACJtE,MAAO,SACPyE,iBAAkB,UAClB3d,SAAU,IAAI47G,EAAc57G,SAAU87G,IAExC,IAAIv1F,EAAAA,EACJw1F,GAEF,OACE78G,EAAAA,cAACinB,EAAAA,GAAW/mB,EAAAA,EAAAA,GAAA,CACVga,QAAS6iG,EACTl1F,aAAc,CAACm1F,EAAAA,GAAmBnvG,EAAMwjG,YACpCnuF,GAGV,CAACm5F,EAAAh8G,aAAA,8X,eClDD,MAAMqmD,EAAyBnmD,EAAAA,GAAO+Z,GAAyB;;;;;;;MAOzD1Z,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OACVgE,EAAM0U,MACJ,kCAEF1U,EAAM0U,MAAM,4BACZ1U,EAAM8V,aAAao1C,cAAc;gBACvBtiD,IAAA,IAAC,MAAE5I,EAAK,OAAEoY,GAAQxP,EAAA,OAC9BwP,EACIpY,EAAM0U,MAAM,iCACZ1U,EAAM0U,MACJ,wCAEF,UACA1U,EAAM0U,MAAM,yCACZ1U,EAAM0U,MAAM,iCACZ,SAAS;EAGX2jG,EAAgC18G,EAAAA,GAAO+Z,GAAI;;EAI3C4iG,EAAgC38G,EAAAA,GAAO+Z,GAAI;;;;;EAOpC6iG,EAA2D1tG,IAKjE,IALkE,SACvE3O,EAAQ,kBACR6tB,EAAiB,gBACjB6sF,GAAkB,KACftoD,GACJzjD,EACC,OACEzP,EAAAA,cAAC0mD,GAAsBxmD,EAAAA,EAAAA,GAAA,CAAC8c,OAAQw+F,GAAqBtoD,GACnDlzD,EAAAA,cAACk9G,EAA6B,KAAEp8G,GAChCd,EAAAA,cAACi9G,EAA6B,KAC5Bj9G,EAAAA,cAAC6iC,EAAAA,EAAO,KACLlU,GACC3uB,EAAAA,cAAAA,EAAAA,SAAA,KACG2uB,EACD3uB,EAAAA,cAACklG,EAAAA,GAAyB,OAG9BllG,EAAAA,cAAC4uB,EAAAA,EAAY,CAAC9T,SAAUsiG,EAAAA,KACxBp9G,EAAAA,cAAC27C,EAAAA,EAAW,CACVj8B,WAAYtP,IAAoB,IAAnB,UAAE8S,GAAW9S,EACxB,OAAOpQ,EAAAA,cAACq8G,EAA0B,CAACn5F,UAAWA,GAAa,IAG5D,CAACnjB,EAAOqkB,IACPpkB,EAAAA,cAACugB,EAAAA,EAAc,CAACC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAW,aACjD1gB,EAAAA,cAACiiC,EAAAA,IAAU/hC,EAAAA,EAAAA,GAAA,GAAKH,EAAK,CAAEqkB,IAAKA,IAC1BpkB,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,0BAK3B/Z,EAAAA,cAAC4uB,EAAAA,EAAY,CAAC9T,SAAU+0D,EAAAA,OAGL,EAE3BstC,EAAA98G,aAAA,iJCxDF,MAAMg9G,EAA4B98G,EAAAA,GAAO+Z,GAAI;;;;;;;EAQvCgjG,EAA0B/8G,EAAAA,GAAO+Z,GAAI;;;EASrCijG,EACJv9G,EAAAA,cAAiD,CAC/C4sC,UAAU,IAGDC,EAA8BA,KACzCvjB,EAAAA,EAAAA,YAAWi0F,GAWA9uF,EAAsD7tB,IAQ5D,IAR6D,cAClE8tB,EAAa,SACb5tB,EAAQ,kBACR6tB,EAAiB,cACjB4sF,EAAa,QACbrhG,EAAO,iBACPsjG,EAAmB,YAChBtqD,GACJtyD,EACC,MAAMynB,GAAexX,EAAAA,EAAAA,QAAuB,MACtCwqG,GAAaxqG,EAAAA,EAAAA,QAAuB,MACpCyqG,GAAsBzqG,EAAAA,EAAAA,QAAsB,OAC5C,gBAGJ2qG,EAAe,gBACfG,EAAe,uBACfQ,EAAsB,sBACtBC,GACEhB,EACF,CAAE/yF,eAAcgzF,aAAYC,uBAC5B,CACEC,kBAIEkC,GAA2B95F,EAAAA,EAAAA,UAC/B,MACEipB,SAAU4uE,KAEZ,CAACA,IAKGlnD,EAAa,EAHiBopD,EAAAA,EAAAA,IAAqB,CACvDF,wBAEmDtjG,GAAW,IAEhE,OACEla,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAASo6C,IACvB9mD,IAAA,IAAC,qBAAE8R,GAAsB9R,EAAA,OACxBxN,EAAAA,cAACq9G,GAAyBn9G,EAAAA,EAAAA,GAAA,IACpBsf,EAAAA,EAAAA,GACFm8F,EACAr8F,GACAi3D,EAAAA,EAAAA,GAAerjB,IAChB,CACD9uC,IAAKiE,IAELroB,EAAAA,cAACu9G,EAAyB78D,SAAQ,CAACt8C,MAAOq5G,GACxCz9G,EAAAA,cAACm9G,GAAuBj9G,EAAAA,EAAAA,GAAA,CACtByuB,kBAAmBA,EACnB6sF,gBAAiBA,GACbY,GAEH1tF,GAEH1uB,EAAAA,cAACs9G,GAAuBp9G,EAAAA,EAAAA,GAAA,CACtBkkB,IAAKi3F,GACDc,GAQJn8G,EAAAA,cAACu4D,EAAAA,EAAU,CAACn0C,IAAKk3F,EAAqBn4F,WAAS,GAC5CriB,KAImB,GAEd,EAEpB2tB,EAAApuB,aAAA,oa,qHC7IF,MAAMs9G,EAAmCx2F,IACvC,MAAM0iD,EACc,aAAlB1iD,EAASza,MACqC,IAA9Cya,EAAS8jD,eAAeC,WAAW76D,QACnC,CAAC,MAAO,OAAQ,WAAWxB,SAASsY,EAAS8jD,eAAeC,UAAU,KACtE/jD,EAAS8jD,eAAe9gE,KAAKo9B,MAAM,6BAA6B,GAClE,OAAIsiC,EACK84B,SAAS94B,GAEX,IAAI,EAGP66B,EAAgBnkG,EAAAA,GAAOy+B,KAAIx+B,WAAA,CAAAC,YAAA,gDAAAC,YAAA,gBAAXH,CAAW,mBAWpBq9G,EAAiCh9G,IAUvC,IAVwC,GAC7C0d,EAAE,MACFtE,EAAK,KACLD,EAAI,WACJ8jG,GAAa,GAMdj9G,EACC,MAAMwa,GAASC,EAAAA,EAAAA,KAAUyiG,EAAAA,EAAAA,GAA+B,GAAEx/F,MAEpDy/F,EAAS3iG,GAAQ0xD,WACnBjpE,IAAI85G,GACL/mG,KAAKk0F,OAAOC,WACf,OACE/qG,EAAAA,cAACugB,EAAAA,EAAc,CACbC,QAASxgB,EAAAA,cAACygB,EAAAA,EAAa,CAACC,WAAY1G,EAAOmN,SAAU/L,GAAQ+L,YAE7DnnB,EAAAA,cAAC0kG,EAAa,KACX3qF,EAAK,OAEK,MAAVgkG,GAAkBF,EACjB79G,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,SAAI+9G,GAAW,SAEf,KACH/jG,GAEY,EAEnB4jG,EAAAv9G,aAAA,2sB,mJCrCK,MAAMmqE,EAAqBxqE,EAAAA,YAAiB,SAA2BY,EAU5E2xD,GACqB,IATnBoY,QAASpiB,EAAW,iBACpB6I,EAAgB,YAChB4sD,KACGj+G,GAIJa,EAGD,MAAMq9G,GAAiBzrD,EAAAA,EAAAA,GAAaD,GAC9B2rD,GAAaz0E,EAAAA,EAAAA,IAAQj8B,IAAA,IAAC,GAAE8Q,GAAI9Q,EAAA,OAAK8Q,CAAE,GAAEiqC,GACrCruC,GAAUikG,EAAAA,EAAAA,GAAsB,CACpCF,iBACA7sD,mBACAgtD,gBAAkB9/F,GAAO4/F,EAAW5/F,KAEtC,OACEte,EAAAA,cAACqf,EAAAA,GAAe,CAACnF,QAASA,IACvBzK,IAAA,IAAC,qBAAE6P,GAAsB7P,EAAA,OACxBzP,EAAAA,cAAC21G,EAAAA,GAAWz1G,EAAAA,EAAAA,GAAA,GACNH,EAAK,CACTqkB,IAAK65F,EACL7sD,iBAAkBA,EAClBuZ,QAASpiB,EAAY1kD,KAAIuM,IAAA,IAAC,GAAEkO,EAAE,KAAEvE,EAAI,QAAEtQ,EAAO,MAAEuQ,GAAO5J,EAAA,MAAM,CAC1DkO,KACAk5F,cACEx3G,EAAAA,cAAC49G,EAAAA,EAA8B,CAC7Bt/F,GAAIA,EACJvE,KAAMA,EACNC,MAAOA,EACP6jG,WAAYG,IAGhBv0G,UACD,IACDuX,gBAAgBxB,EAAAA,EAAAA,GACdzf,EAAMihB,gBAAkB,CAAC,EACzB1B,KAEF,GAIV,IAAGkrD,EAAAnqE,aAAA,8jB,mHCpBI,MAAMowC,EAAsB7vC,IAKC,IALA,UAClCy9G,EAAS,SACTv9G,EAAQ,cACR4tB,KACG3uB,GACyBa,EAC5B,MAAO09G,EAAqBC,IAAwBv5G,EAAAA,EAAAA,WAAS,IACtD+hD,EAAWy3D,IAAgB57C,EAAAA,EAAAA,GAChC7iE,EAAMgnD,UACNhnD,EAAM0+G,iBACN1+G,EAAMinD,mBAEF94C,EAAWlO,EAAAA,SAAe0+G,QAAQ59G,GACrCmR,QAEG+gB,IAEA,MAAM2rF,EACJ3+G,EAAAA,eAAqBgzB,IACrBA,EAAMtmB,OAASkyG,EAQjB,OAPKD,GAEH70G,QAAQC,KACN,mHACAipB,GAGG2rF,CAAU,IAMpB96G,KAAK4F,IAAO,IAAWA,EAAStF,IAAM,GAAEsF,EAAQtF,MAAM+N,MAAM,OAmBzD2sG,GAjBAR,GACFv0G,QAAQ4D,MACN,yFAIF1N,EAAAA,cAACupG,EAAAA,EAAc,CACbtpF,WAAS,EACT/W,MAAOgF,EACP8O,OAAQshG,EACRv+F,YAAagnC,EACb/mC,kBAAmBw+F,IAEjB5uG,GAAS5P,EAAAA,cAACmgB,EAAAA,EAAO,CAAChc,IAAKyL,EAAKzL,KAAMyL,EAAK7P,MAAM4wC,eAW/C1sC,EAAOiK,EAASrK,KAAI2J,IAAA,IAAC,IAAErJ,GAAKqJ,EAAA,OAAKrJ,CAAG,IACpC26G,GAAel7C,EAAAA,EAAAA,GAAY3/D,IACjCgK,EAAAA,EAAAA,YAAU,KACR,IAAKhK,EAAK4K,SAASk4C,GAAY,CAC7B,MAAMg4D,EAAe96G,EAAK66G,EAAa/9F,QAAQgmC,GAAa,IAAM9iD,EAAK,GACnDmjB,MAAhB23F,GACFP,EAAaO,EAEjB,KAGF,MAAMC,EAAgB9wG,EAAS0I,MAC5BnN,GAAyB2d,MAAb2/B,GAA0BA,IAAct9C,EAAQtF,MAE/D,OACEnE,EAAAA,cAACyuB,EAAAA,EAAiB,CAChB8sF,cAAegD,EACf7vF,cAC2B,mBAAlBA,EACLA,EAAc,CAAEmwF,yBAEhB7+G,EAAAA,cAAAA,EAAAA,SAAA,KACG0uB,EACAmwF,GAIPlwF,kBAAmB5uB,EAAM4uB,mBAExBqwF,GAAej/G,MAAMe,SACJ,EAclB89G,EACJnvG,IAA6C,MAANA,EACrC,MAAM,IAAIpF,MACR,oHACD,EAGLomC,EAAoBC,KAAOkuE,EAA8BnuE,EAAApwC,aAAA,wuF,wLChKlD,MAAMgd,EAA6B,iBAC7ByyD,EAAgC,mBAChCD,EAA+B,mBAC/BF,EAAiC,qBACjCytC,EAA6B,iBAC7B7tC,EAAqC,wBACrCC,EAAoC,uBACpCC,EAAmC,sBACnCC,EAAsC,yBACtCuvC,EAA6B,iBAC7BC,EAA+B,mBAC/BC,EAAwB,aACxBC,EAAuB,YACvBC,EAAwB,aACxBzvC,EAAyB,cACzBktC,EACX,6B,kKCgBF,MAAMwC,EAAqB,GACrBC,EAAoB,GAEbC,EAIR,CACH,CAAElhG,GAAI,gBAAiBswB,OAAQ,OAAQia,SAAS,GAChD,CAAEvqC,GAAI,mBAAoBswB,OAAQ,OAAQia,SAAS,GACnD,CAAEvqC,GAAI,mBAAoBswB,OAAQ,SAAUia,SAAS,GACrD,CAAEvqC,GAAI,oBAAqBswB,OAAQ,SAAUia,SAAS,GACtD,CAAEvqC,GAAI,iBAAkBswB,OAAQ,QAASia,SAAS,GAClD,CAAEvqC,GAAI,oBAAqBswB,OAAQ,QAASia,SAAS,GACrD,CAAEvqC,GAAI,iBAAkBswB,OAAQ,MAAOia,SAAS,GAChD,CAAEvqC,GAAI,gBAAiBswB,OAAQ,MAAOia,SAAS,IAG3C42D,EAAgB7+G,IAAA,IAAC,OACrBguC,EAAM,QACNia,GAIDjoD,EAAA,MACE,GAAEguC,EAAO,GAAG6V,gBAAgB7V,EAAO18B,MAAM,OACxCy+F,EAAAA,EAAAA,IAAuB/hE,GACnBia,EACE,QACA,OACFA,EACA,SACA,OACJ,EAESm0D,EAA+C,CAC1D0C,cAAeT,EAAAA,GACfU,gBAAiBT,EAAAA,GACjBU,OAAQT,EAAAA,GACRU,MAAOT,EAAAA,GACPlzG,OAAQmzG,EAAAA,IAGG9C,EAA4B,mBAC5BE,EAA0B,iBAC1BE,EAAqC,wBAE3C,SAASe,EAAoBlwG,GAIT,IAJU,iBACnCgwG,GAGDhwG,EACC,MAAM,aACJyrG,EAAY,cACZC,EAAa,eACbF,EAAc,WACdD,EAAU,iBACVhC,EAAgB,KAChB8B,EAAI,OACJp6E,EAAM,MACN5wB,IACEghC,EAAAA,EAAAA,KACE9wB,GAA2BC,EAAAA,EAAAA,KAE3B9D,EAA8B,GACpC,IAAKrM,EAGH,OAAOkQ,EAAyB,CAC9BO,GAAI,wBACJtE,MAAO,qBACPlZ,SAAU,KAGd,MAAMw7G,EAAsBv+F,EAAyB,CACnDO,GAAIi+F,EACJviG,MAAO,YACPlZ,SAAU,CACR,CACEwd,GAAI2gG,EAAAA,GACJjlG,MAAO,cACP2E,gBAAiBA,KACfq6F,EAAe,gBAAgB,GAGnC,CACE16F,GAAI4gG,EAAAA,GACJllG,MAAO,gBACP2E,gBAAiBA,KACfq6F,EAAe,kBAAkB,GAGrC,CACE16F,GAAI6gG,EAAAA,GACJnlG,MAAO,SACP2E,gBAAiBA,KACfq6F,EAAe,SAAS,GAG5B,CACE16F,GAAI8gG,EAAAA,GACJplG,MAAO,QACP2E,gBAAiBA,KACfq6F,EAAe,QAAQ,GAG3B,CACE16F,GAAI+gG,EAAAA,GACJrlG,MAAO,SACP2E,gBAAiBA,KACfq6F,EAAe,SAAS,MAK1BwD,EAAoBz+F,EAAyB,CACjDO,GAAIm+F,EACJziG,MAAO,UACPlZ,SAAU0+G,EAAQ37G,KACf+qC,IAAM,CACLtwB,GAAK,aAAYswB,EAAOtwB,KACxBtE,MAAOylG,EAAc7wE,GACrB70B,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAO,WAAU60B,EAAOtwB,OAC5CoN,WACE7d,EAAM+gC,SAAWA,EAAOA,QAAU/gC,EAAMg7C,UAAYja,EAAOia,QAC7DlqC,gBAAiBA,KACfo6F,EAAWnqE,EAAO,QA0D1B,GArDA10B,EAAQpK,KACN,CACEwO,GAAIsxD,EAAAA,GACJ51D,MAAQ,SAAQwjG,IAChB7+F,gBAAiBA,KACfo4F,GAAkB,GAGtB,CACEz4F,GAAIuxD,EAAAA,GACJ71D,MAAO,OACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,2BACzB4E,gBAAiBA,KACfk6F,GAAM,GAGV,CACEv6F,GAAIqxD,EAAAA,GACJ31D,MAAO,uBACP2E,gBAAiBA,KAEfmhG,MAAM,kBAAkB,GAG5B,CACExhG,GAAIw+F,EAAAA,GACJ9iG,MAAO,sBACP2E,gBAAiBA,KACf8f,GAAQ,GAGZ69E,EACAE,GAEqB,UAAnB3uG,EAAMwjG,UACRn3F,EAAQpK,KAAK,CACXwO,GAAI8+F,EAAAA,GACJpjG,MAAO,OACPD,KACE/Z,EAAAA,cAAC0e,EAAAA,GAAY,CACX3E,KAAO,WACLylG,EAAQ5oG,MACNnH,IAAA,IAAC,OAAEm/B,EAAM,QAAEia,GAASp5C,EAAA,OAClBm/B,IAAW/gC,EAAM+gC,QAAUia,IAAYh7C,EAAMg7C,OAAO,KACrDvqC,OAITK,gBAAiBA,KACfq6F,EAAe,gBAAgB,IAId,UAAnBnrG,EAAMwjG,UAA2C,WAAnBxjG,EAAMwjG,SAAuB,CAC7D,MAAM0O,EAAchiG,EAAyB,CAC3CO,GAAIq+F,EACJ3iG,MAAO,SACPlZ,SAAU,MAER6vG,EAAAA,EAAAA,IAAuB9iG,EAAM+gC,SAC/BmxE,EAAYj/G,SAASgP,KAAK,CACxBwO,GAAIoxD,EAAAA,GACJ11D,MAAO,oBACP2E,gBAAiBA,KACfu6F,EACmB,WAAjBrrG,EAAM+gC,QAAuB0wE,EAAqBA,EACnD,IAGLS,EAAYj/G,SAASgP,KAAK,CACxBwO,GAAImxD,EAAAA,GACJz1D,MAAO,iBACP2E,gBAAiBA,KACfu6F,EACmB,QAAjBrrG,EAAM+gC,QAAoB0wE,EAAqBA,EAChD,MAILS,EAAYj/G,SAASgP,KAAK,CACxBwO,GAAIkxD,EAAAA,GACJx1D,MAAO,kBACP2E,gBAAiBA,KACfs6F,EACmB,SAAjBprG,EAAM+gC,QAAqB2wE,EAAoBA,EAChD,IAGLQ,EAAYj/G,SAASgP,KAAK,CACxBwO,GAAIixD,EAAAA,GACJv1D,MAAO,mBACP2E,gBAAiBA,KACfs6F,EACmB,UAAjBprG,EAAM+gC,QAAsB2wE,EAAoBA,EACjD,KAIPrlG,EAAQpK,KAAKiwG,EACf,CACA,OAAOhiG,EAAyB,CAC9BO,GAAI,wBACJtE,MAAO,qBACPlZ,SAAUoZ,GAEd,C,kFClPO,MAAM4jG,EAAiCx/F,GAC3C,WAAUA,EAAGlZ,QAAQ,IAAK,YAUtB,SAAS+4G,EAAqBv9G,GAIF,IAJG,iBACpCwwD,EAAgB,eAChB6sD,EAAc,gBACdG,GAC8Bx9G,EAC9B,MAAMo/G,EAA6BnyG,GACjC7J,OAAOD,OAAO8J,EAAM88D,SAAS7yC,MAC3BtqB,IAAA,IAAC,UAAEk7C,EAAS,SAAE2oD,GAAU7jG,EAAA,OACtBk7C,GAA2C,WAA9B+wD,EAAAA,EAAAA,IAAgBpI,EAAqB,IA0DxD,MAhCoC,IAxBlBrtG,OAAOC,KAAKmtD,EAAiBuZ,SAAS9mE,KACrDM,GAAS,GAAEA,MAE8BN,KAC1C,CAACya,EAAYlL,KACX,MAAM,MAAE4G,EAAK,KAAED,GAASqkG,IAAkB9/F,IAAO,CAAC,EAClD,MAAO,CACLA,GAAIw/F,EAA8Bx/F,GAClCtE,MAAOA,GAAU,GAAEimG,EAAW7sG,YAC9B2G,OACAwE,YAAc,YAAWvE,GAASimG,EAAW7sG,YAC7CuL,gBAAiBA,KAEbyyC,EAAiBuZ,QAAQrsD,IAAKoqC,YAC7Bu1D,EAAentG,SAAS87B,SAAStuB,GAElC2/F,EAAentG,SAAS0C,MAAM8K,GAE9B2/F,EAAentG,SAASurD,aAAaxuD,GAAUA,EAAM8zB,OAAOrjB,IAC9D,EAEH,IAKH,CACEA,GAAIjB,EAAAA,GACJrD,MAAOgmG,EAA0B5uD,GAC7B,mBACA,kBACJzyC,gBAAiBA,KACfs/F,EAAentG,SAASurD,aAAaxuD,GAC/BmyG,EAA0BnyG,GACrBA,EAAMisG,UAENjsG,EAAMksG,mBAMjBnmG,YAAW,KACTqqG,EAAentG,SAASimG,kBAAkB,GAC1C,GAGN,CACEz4F,GAAIwxD,EAAAA,GACJ91D,MAAO,2BACP0R,WAA+C,MAAnC0lC,EAAiB0lD,eAC7Bn4F,gBAAiBA,KACfs/F,EAAentG,SAAS+lG,uBAAuB,GAKvD,CAEA,SAASoJ,EAAWC,GAClB,IAAIC,EAAM,CAAC,KAAM,KAAM,MAMvB,OAAOD,GAHgB94F,MAArB+4F,EAAKD,EAAI,GAAM,IAFA,CAAC,GAAI,GAAI,IAEqBrxG,SAASqxG,EAAI,KACtD,KACAC,EAAKD,EAAI,GAAM,GAEvB,C,wKC7DA,MAAME,EAAcx/G,IAAA,IAAC,OAAEkiC,GAAwCliC,EAAA,OAC7DkiC,GACAthC,EAAAA,EAAI;;oBAEcgM,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OAAK5I,EAAM8V,aAAaw2B,WAAW;qBAClC,IAAXpO,EAAkB,MAAQu9E,EAAoBv9E;GAC/D,EAEGqjB,EAAgB5lD,EAAAA,GAAO+Z,GAE1B;;;;;;;;IAQC8lG;IACArb,EAAAA;;;IAGAA,EAAAA;;;EAKEsb,EAGF,CACF72D,IAAK,YACLjT,OAAQ,YACR3oB,MAAO,YACPD,KAAM,YACNhnB,WAAY,QACZC,SAAU,SAMN05G,EAAuB//G,EAAAA,GAAO06C,MAAO;;;;;IAKvCmlE;EAGEG,GAA0BhgH,EAAAA,EAAAA,IAAO4lD,EAAe;aAXjC,OACD;;;;IAehB++C,EAAAA;;;IAGAob;qBAlBgB;;EAuBdE,GAAwBjgH,EAAAA,EAAAA,IAAO4lD,EAAe;;;;;aAvBhC,OADC;IA8BjBkE,EAAAA;;;IAGAi2D;sBAhCgB;;EAqCdG,EAAuBlgH,EAAAA,GAAO+Z,GAGjC;;;;eAIY7K,IAAA,IAAC,WAAEixG,GAAYjxG,EAAA,OAAMixG,EAAa,OAAS,QAAQ;;;;;;;IAO9DtwG,IAAA,IAAC,qBAAEuwG,GAAsBvwG,EAAA,OAOzB5O,EAAAA,EAAI;UAC2B,IAAzBm/G,EACE,IACC,cAAaA;;;;KAIrB;EAGCC,EAAqB5gH,EAAAA,cACzB,cA+CW6iC,EAAkC/uB,IAIpB,IAJqB,OAC9CgvB,EAAM,YACNnI,EAAc,gBACX56B,GACJ+T,EACC,MAAM+sG,EACY,eAAhBlmF,GAAgC,qBAAsB56B,EAClDA,EAAM8gH,iBACN,KACAC,EAAY,CAAErnG,MAAO1Z,EAAM0Z,MAAO07D,UAAWp1E,EAAMo1E,WACnD/wD,GAAMvT,EAAAA,EAAAA,QAAuB,MAC7B64E,GAAa74E,EAAAA,EAAAA,QAAuB,MACpCkwG,GAAoBlwG,EAAAA,EAAAA,QAA0B,MAC9Cs1C,EACY,eAAhBxrB,EACI4lF,EACAC,GACA,mBAAE7X,IAAuBC,EAAAA,EAAAA,GAAoBxkF,EAAK,CAAE2jF,UAAW,MAC9DiZ,EAAwBC,IAA2Bj8G,EAAAA,EAAAA,WAAS,IAC5Dk8G,EAAaC,IAAkBn8G,EAAAA,EAAAA,UAAS,KACxCo8G,EAA2BC,IAChCr8G,EAAAA,EAAAA,WAAkB,GACds8G,GAA0BzwG,EAAAA,EAAAA,WAEhC3L,EAAAA,EAAAA,kBAAgB,KACd,GAAIkf,EAAItT,QAAS,CACf,MAAMywG,EAAgB,IAAIn9F,EAAItT,QAAQhQ,UAAUmR,QAC7CmT,GAA8BA,aAAgB2rB,cAE3CywE,EAAuBD,EAAcluG,WAAW2f,GACpD21E,EAAmB95F,SAASmkB,KAE9BquF,EAA6BG,GAC7BF,EAAwBxwG,QAAUywG,EAAcC,EAClD,IACC,CAAC7Y,KAEJzjG,EAAAA,EAAAA,kBAAgB,KACVwkF,EAAW54E,SAAWowG,IAAgBx3B,EAAW54E,QAAQ8+E,cAC3DuxB,EAAez3B,EAAW54E,QAAQ8+E,aACpC,IAGF,MAAM,aAAE3C,IAAiBE,EAAAA,EAAAA,GAAmB,CAC1C51D,OAAQypF,EACR1qE,UAAW,cACXijB,OAGkB,eAAhB5+B,EAtKe,EAuKVumF,EAA6B,EACf,EAAdA,EACP1nD,YACkB,eAAhB7+B,GAAgC,GAAsB,EACxDwkD,iBAAkB,EAClBiO,YAAY,EACZhe,UAA2B,eAAhBz0C,EAA+BvW,EAAM28F,EAChDr3B,WAAYA,EACZ7mE,QAASA,KACPo+F,GAAwB,EAAM,IAQ5BQ,EAAe,CACnBC,YAAcjlG,IACZ,MAAMklG,EAAyBL,EAAwBxwG,QACvD,IAAK6wG,EACH,OAEF,MAAMC,EACY,aAAhBjnF,EACIle,EAAMgnD,QAAUk+C,EAAuBt9C,wBAAwB7a,IAC/D/sC,EAAM6mD,QAAUq+C,EAAuBt9C,wBAAwB12C,KACjEi0F,IAAeZ,GACjBC,EAAwBW,EAC1B,EAEFC,aAAcA,KACRb,GACFC,GAAwB,EAC1B,GAGEa,EAA4B,CAChCv1B,aAAcA,IAAM00B,GAAwB,GAC5CY,aAAcA,IAAMZ,GAAwB,IAE9C,OACEjhH,EAAAA,cAAC4gH,EAAmBlgE,SAAQ,CAACt8C,MAAOu2B,GAClC36B,EAAAA,cAACmmD,GAAajmD,EAAAA,EAAAA,GAAA,CACZ4iC,OAAQA,IACJtjB,EAAAA,EAAAA,GAAWshG,EAAWW,GAAa,CACvC1lE,KAAK,YAEL/7C,EAAAA,cAACygH,EAAoB,CACnBr8F,IAAKA,EACL23B,KAAK,eACL4kE,qBAAsBS,EACtBV,WAAiC,SAArBG,GAEX9gH,EAAMe,UAER6nG,EAAmBt4F,OAAS,GAC3BrQ,EAAAA,cAACsgH,EAAoB,CACnBl8F,IAAK28F,EACL/sG,UAAW,EACXu4E,aA/CgBw1B,KACxBd,GAAwB,EAAK,GAgDrBjhH,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,eAIxBinG,GAA0BrY,EAAmBt4F,OAAS,GAKrDrQ,EAAAA,cAAC4gH,EAAmBlgE,SAAQ,CAACt8C,MAAM,cACjCpE,EAAAA,cAAC0tF,EAAAA,GAAO,KACN1tF,EAAAA,cAACw/D,EAAAA,GAAoBt/D,EAAAA,EAAAA,GAAA,CACnBkkB,IAAKslE,IACDlqE,EAAAA,EAAAA,GAAWytE,EAAc60B,IAE7B9hH,EAAAA,cAACgiH,EAAgB,CACfl/E,QAAM,EACNm/E,kBACkB,aAAhBtnF,EACIymF,OACAh6F,GAGLrnB,EAAMe,aAMW,EAI5BkhH,GAAmBzhH,EAAAA,EAAAA,IAAOggH,EAE7B;IACC/rG,IAAA,IAAC,kBAAEytG,GAAmBztG,EAAA,OACtBytG,GACAzgH,EAAAA,EAAI;QACAujG,EAAAA,gBAA6Bkd,EAAoB;;;0BAG/BA;;;KAGrB;EAMQl/E,EAAmBA,IAEP,gBADHzZ,EAAAA,EAAAA,YAAWs3F,GAE7B5gH,EAAAA,cAACklG,EAAAA,GAAyB,MAE1BllG,EAAAA,cAACqqD,EAAAA,GAAuB,MAE1BxnB,EAAAxiC,aAAA,ooBAAA0iC,EAAA1iC,aAAA,0G,mFC3WK,MAAMutC,EAAoBhtC,IAMW,IANV,WAChC8f,EAAU,SACVmJ,EAAQ,SACR1C,EAAQ,KACR+6F,KACGC,GACoBvhH,EACvB,OACEZ,EAAAA,cAAC44C,EAAAA,GAAO14C,EAAAA,EAAAA,GAAA,CAACkiH,WAAS,GAAKD,GACrBniH,EAAAA,cAAC44C,EAAAA,EAAQkR,OAAM,KACZppC,EACAyG,GAAYnnB,EAAAA,cAAC44C,EAAAA,EAAQs1C,SAAQ,KAAE/mE,IAElCnnB,EAAAA,cAAC44C,EAAAA,EAAQypE,YAAW,KAAEx4F,GACrBq4F,GAAQliH,EAAAA,cAAC44C,EAAAA,EAAQz+B,KAAI,KAAE+nG,GAChB,EAEZt0E,EAAAvtC,aAAA,skB,yECnBK,MAAMogB,EAAgB7f,IAIW,IAJV,WAC5B8f,EAAU,SACVyG,KACGg7F,GACgBvhH,EACnB,OACEZ,EAAAA,cAAC44C,EAAAA,EAAYupE,EACXniH,EAAAA,cAAC44C,EAAAA,EAAQkR,OAAM,KACZppC,EACAyG,GAAYnnB,EAAAA,cAAC44C,EAAAA,EAAQs1C,SAAQ,KAAE/mE,IAE1B,EAEZ1G,EAAApgB,aAAA,+Y,mFCZK,MAAMupB,EAAchpB,IAKW,IALV,SAC1BipB,EAAQ,SACR1C,EAAQ,KACR+6F,KACGC,GACcvhH,EACjB,OACEZ,EAAAA,cAAC44C,EAAAA,GAAO14C,EAAAA,EAAAA,GAAA,CAACkiH,WAAS,GAAKD,GACrBniH,EAAAA,cAAC44C,EAAAA,EAAQkR,OAAM,KAAEjgC,GAChB1C,GACCnnB,EAAAA,cAAA,WACEA,EAAAA,cAAC44C,EAAAA,EAAQs1C,SAAQ,KAAE/mE,IAGtB+6F,GAAQliH,EAAAA,cAAC44C,EAAAA,EAAQz+B,KAAI,KAAE+nG,GAChB,EAEZt4F,EAAAvpB,aAAA,ke,0GCoBK,MAAMg2C,EAA2Bz1C,IAYc,IAZU,QAC9D4f,EAAO,SACP1f,EAAQ,MAKR++C,EAAQ,IAAG,OACX0Z,EAAS,EAAC,YACVwlB,EACAC,WAAYsjC,KACTviH,GAC8Ba,EACjC,MAAMiN,GAAQ00G,EAAAA,EAAAA,GAAuB,IAChCxiH,EACH8/C,UAGI6pC,GAAa74E,EAAAA,EAAAA,QAAuB,MACpC2xG,GAAchwD,EAAAA,EAAAA,GAAgB8vD,GAC9BtjC,EAAasjC,GAAmBE,EAEhCC,GAAet1B,EAAAA,EAAAA,GAAmB,IACnCptF,EACH2pF,aACAta,UAAW4P,EACXzlB,SACAhiC,OAAQ1pB,EAAM0pB,OACd1U,QAAShV,EAAMuG,QAYjB,OANAnG,EAAAA,EAAAA,YAAU,KACJJ,EAAM0pB,QACR3K,sBAAsB61F,EAAaC,eACrC,GACC,CAAC70G,EAAM0pB,SAGRv3B,EAAAA,cAAC2iH,EAAAA,EAAwB,CACvBniG,QAASA,EACTiiG,aAAcA,EACd/vG,QAAS5R,EACT+M,MAAOA,EACP67E,WAAYA,EACZ1K,WAAYA,EACZD,YAAaA,EACbrzD,WAAY3rB,EAAM2rB,YAClB,EAEJ2qB,EAAAh2C,aAAA,65C,qJCvDK,MAGDuiH,EAAgBriH,EAAAA,GAAO+Z,GAAmD;;eAW5E1Z,IAAA,IAAC,MAAEgE,EAAK,UAAEw9G,GAAWxhH,EAAA,OACnBwhH,EACK,GACCx9G,EAAMR,MACJ,yBACG,QAEP,IAAI;iBAEGoJ,IAAA,IAAC,UAAE40G,GAAW50G,EAAA,OAAO40G,EAAuB,KAAX,QAAe;;;SAGxD3yG,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OACf7K,EAAMR,MACJ,4BACG,CAAC;gBACMy+G,EAAAA;WACLzyG,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACjBxL,EAAM0U,MAAM,qBAAuB1U,EAAMK,KAAgB,UAAT,OAAmB;aAC1D6O,IAAA,IAAC,MAAElP,EAAK,UAAEw9G,GAAWtuG,EAAA,OAC9BsuG,EACIx9G,EAAM24E,MAAM,wCAnCsB,qCAqClC34E,EAAM24E,MAAM,sCAnClB,qCAoCsC;;;kBAGtB/oE,IAAA,IAAC,MAAE5P,EAAK,WAAEk+G,GAAYtuG,EAAA,OACpC5P,EAAMR,MAAe,wBAA0B0+G,EAAa,MAAQ,KAAK;kBAC3DC,EAAAA;IACd3gD,EAAAA;IACA3tD,IAAA,IAAC,WAAEquG,GAAYruG,EAAA,OACfquG,GACAthH,EAAAA,EAAI;;uBAEewhH,EAAAA;KAClB;EAGCvoG,EAAiBla,EAAAA,GAAO4tF,GAAI;;WAEvBx5E,IAAA,IAAC,MAAE/P,GAAO+P,EAAA,OACjB/P,EAAM0U,MACJ,6BACC1U,EAAMK,KAAmB,UAAZ,UACf;EAGCgsC,EAAe1wC,EAAAA,GAAO+Z,GAAI;eACjBzF,IAAA,IAAC,MAAEjQ,GAAOiQ,EAAA,OAAKjQ,EAAMq+G,cAAc,4BAA4B;;;EAIxEC,EAAoB3iH,EAAAA,GAAO+Z,GAAI;WAC1B8f,IAAA,IAAC,MAAEx1B,GAAOw1B,EAAA,OACjBx1B,EAAM0U,MACJ,yBACA1U,EAAM8V,aAAa8lE,sBACpB;eACUlmD,IAAA,IAAC,MAAE11B,GAAO01B,EAAA,OACrB11B,EAAMq+G,cAAc,mCAAmC;EAGrD99B,EAAa5kF,EAAAA,GAAO+Z,GAAI;WACnB2gB,IAAA,IAAC,MAAEr2B,GAAOq2B,EAAA,OACjBr2B,EAAM0U,MACJ,yBACA1U,EAAM8V,aAAaC,sBACpB;;;;;;EAQQwoG,EAGT,CACF5sE,OAAQ,MACRiT,IAAK,SACL77B,KAAM,QACNC,MAAO,OACPw1F,OAAQ,OAkBJxqE,EAAU54C,EAAAA,YAAiB,SAAgBq7B,EAE/Ck3B,GACc,IAFd,SAAEzxD,EAAQ,UAAEshH,EAAS,YAAEtiE,KAAgB//C,GAAqBs7B,EAG5D,MAAMjX,GACJouC,EAAAA,EAAAA,GAAaD,IACT,MACJ1kD,EAAK,cACLw1G,EAAa,qBACbC,EAAoB,UACpBhtE,EAAY,WACVhtB,EAAAA,EAAAA,YAAWi6F,EAAAA,IAAmB,CAAC,GAC7B,aAAEpB,IAAiBqB,EAAAA,EAAAA,GACvBzjH,EACA8N,EACI,IACKA,EAEH4e,KAAM42F,EAAgBx1G,GAAO4e,KAAO,QAEtC5e,IAGA,KAAE6qF,EAAI,OAAEn/B,GACW,iBAAhBzZ,EACHA,EACA,CAAE44C,KAAMyqB,EAAuB7sE,GAAYijB,YAAQnyC,GAEzD,OACEpnB,EAAAA,cAAC4iH,GAAa1iH,EAAAA,EAAAA,GAAA,CACZ4iH,WAAY/1D,QAAQjN,GACpBsiE,UAAWA,GACPD,EAAY,CAChBhtC,UAAWp1E,EAAMo1E,UACjB/wD,IAAKA,IAEJ07B,GACC9/C,EAAAA,cAACyjH,EAAAA,EAAc,CACbC,WAAYt/F,EACZs0E,KAAMA,EACNn/B,OACEA,IAAW+pD,EACP,CAAE52G,KAAM,WAAYtI,MAAOm1D,GAC3B,CAAE7sD,KAAM,aAActI,MAAOk/G,KAItCxiH,EAGP,IAEM6iH,EAAW3/G,OAAOyqE,OAAO71B,EAAS,CACtCkR,OAAQ7Y,EACRi9C,SAAUzzE,EACV4nG,YAAaa,EACb/oG,KAAMgrE,IACLvsC,EAAAv4C,aAAA,0+E,gDCnNI,MAAMkjH,E,QAAiBvjH,cAC5B,K,yGCcF,MAEM4jH,EAAoB,IACpBC,EAAa,wBACbC,EAAa,CACjBt6D,IAAKhoD,EAAAA,EAAI;;iBAEMqiH;IAEfttE,OAAQ/0C,EAAAA,EAAI;;iCAEmBqiH;IAE/Bl2F,KAAMnsB,EAAAA,EAAI;;gCAEoBqiH;IAE9Bj2F,MAAOpsB,EAAAA,EAAI;;+BAEkBqiH;KAGzBE,EAAuBxjH,EAAAA,GAAOy+B,IAEjC;;;;IAICp+B,IAAA,IAAC,KAAE83F,GAAM93F,EAAA,OAAKkjH,EAAWprB,EAAK;;;;;mBAKfsrB;oBACCA;qBACCC;aACRL;YACDA;;;;;;mBArCU;oBAAA;qBACC,aA4CwBf,EAAAA;;EAI/C,SAASqB,EAAkB9/G,GACzB,MAAwB,iBAAVA,EAAsB,GAAEA,MAAYA,CACpD,CAEA,MAAM+/G,EAAW/Z,GAAiBhmG,GACvBgjB,MAAThjB,EAAsB,OAAMgmG,QAAU8Z,EAAkB9/G,MAAYA,EAChEggH,EAAW9vG,GAAiBlQ,GACvBgjB,MAAThjB,EAAsB,OAAMkQ,QAAU4vG,EAAkB9/G,MAAYA,EAChEigH,EAxDiB,EAwDgBrB,EAAAA,GACjCsB,EA1DgB,EA0DetB,EAAAA,GAMrC,SAASuB,EAA0B/2G,EAAAiC,GAGhC,IAFD,MAAE6c,EAAK,OAAEnL,GAAmE3T,GAC5E,IAAEg8C,EAAG,KAAE77B,EAAI,MAAEC,EAAK,OAAE2oB,GAAuB9mC,EAE3C,MAAM+0G,GAAsB1T,EAAAA,EAAAA,GAC1B3vF,EAASijG,EAAQjjG,EAASkjG,GAAiBn8F,EAAAA,EAC3Ci8F,EAAQE,IAEJI,GAAwB3T,EAAAA,EAAAA,GAC5BxkF,EAAQ83F,EAAQ93F,EAAQg4F,GAAgBp8F,EAAAA,EACxCi8F,EAAQG,IAEV,MAAO,CACL96D,IAAKg7D,EAAoBh7D,GACzBjT,OAAQiuE,EAAoBjuE,GAC5B5oB,KAAM82F,EAAsB92F,GAC5BC,MAAO62F,EAAsB72F,GAEjC,CAEA,MAAM82F,EAAmBA,CACvBhsB,EACAwJ,IAEa,QAATxJ,GAA2B,WAATA,EACbwJ,EAAS,QAAU,OAErBA,EAAS,SAAW,MAG7B,SAASyiB,EAA4Bv0G,GAGM,IAHL,KACpCsoF,EAAI,OACJn/B,EAAS,OACcnpD,EACvB,MAAM,OAAE8xF,GAAS,EAAO99F,MAAOwgH,GACX,iBAAXrrD,EAAsBA,EAAS,CAAE2oC,QAAQ,EAAO99F,MAAOm1D,GAChE,MAAO,CACL,CAACmrD,EAAiBhsB,EAAMwJ,IAAU0iB,EAEtC,CAEO,SAASnB,EAAc3vG,GAU1B,IAV2B,KAC7B4kF,EAAI,OACJn/B,EAAM,WACNmqD,GAOD5vG,EACC,MAAOhH,EAAMskF,IAAWpsF,EAAAA,EAAAA,UAGrB,CAAEmc,YAAQiG,EAAWkF,WAAOlF,IAQ/B,OAPAnZ,EAAAA,EAAAA,YAAU,KACR,MAAM,aAAE2hF,EAAY,YAAE3tB,GAAgByhD,EAAW5yG,SAAW,CAAC,EACzD8+E,GAAgB9iF,GAAMqU,QAAU8gD,GAAen1D,GAAMwf,OACvD8kE,EAAQ,CAAEjwE,OAAQyuE,EAActjE,MAAO21C,GACzC,IAIAjiE,EAAAA,cAAC+jH,EAAoB,CACnBrrB,KAAMA,EACNj/E,MAAO8qG,EACLz3G,EACgB,aAAhBysD,EAAO7sD,KACHi4G,EAA6B,CAAEjsB,OAAMn/B,OAAQA,EAAOn1D,QACpDm1D,EAAOn1D,QAInB,CAACq/G,EAAApjH,aAAA,u9B,+FCvID,IACIwkH,EADAC,EAAsD,K,0BCuBnD,MAAMvkG,EAAiB3f,IAWW,IAXV,QAC7B4f,EAAO,SACP1f,EAAQ,MAKR++C,EAAQ,IAAG,OACX0Z,EAAM,UACNjjB,EAAY,iBACTv2C,GACiBa,EACpB,MAAMo+E,GAAanuE,EAAAA,EAAAA,QAAoB,MACjCjM,GAAQC,EAAAA,EAAAA,MACRgJ,GAAQ00G,EAAAA,EAAAA,GAAuB,IAChCxiH,EACH8/C,UAGI6pC,GAAa74E,EAAAA,EAAAA,QAAuB,MAEpC4xG,EDzCD,SACL78G,GAIA,MAAMwpE,GAAYv+D,EAAAA,EAAAA,QAAoB,OAEtC3L,EAAAA,EAAAA,IAAgB,KAQd,GAPK4/G,IAEHA,EAAoBlkH,IAA2B,IAA1B,QAAE0iE,EAAO,QAAEG,GAAS7iE,EACvCikH,EAAqB,CAAEvhD,UAASG,UAAS,EAE3C5yB,SAAS08B,iBAAiB,YAAau3C,KAEpC11C,EAAUt+D,QAAS,CACtB,MAAMi0G,EAAal0E,SAAS2wB,cAAc,QAY1C,OAXAx9D,OAAOyqE,OAAOs2C,EAAWtrG,MAAO,CAC9B6S,MAAO,MACPnL,OAAQ,MACRo3D,cAAe,OACfj2D,SAAU,QACVm/C,WAAY,WAEd5wB,SAAS52B,KAAK8nD,YAAYgjD,GAG1B31C,EAAUt+D,QAAUi0G,EACb,KACLA,EAAWtmF,QAAQ,CAEvB,IACC,IAEH,MAAMikF,EAAkBx4G,IACtB,MAAM86G,EAAoB96G,GAAK26G,EAC/B,GAAIz1C,EAAUt+D,SAAWk0G,EAAmB,CAC1C,MAAM,QAAE1hD,EAAO,QAAEG,GAAYuhD,EAC7B51C,EAAUt+D,QAAQ2I,MAAMkU,KAAQ,GAE9B21C,GAAW19D,EAAQ4zD,aAAe,OAEpC4V,EAAUt+D,QAAQ2I,MAAM+vC,IAAO,GAAEia,KACnC,CACAwhD,GAAiB,GAEnB//G,EAAAA,EAAAA,IAAgB,KACVU,EAAQ2xB,QACVmrF,GACF,GACC,CAAC98G,EAAQ2xB,OAAQ63C,EAAUt+D,UAE9B,MAAQ4xG,eAAgBuC,KAAoB3sG,IAAW60E,EAAAA,EAAAA,GAAmB,IACrEvnF,EACHwpE,cAGF,MAAO,IACF92D,EAIHoqG,iBAEJ,CCvBuBwC,CAA6B,CAChDx7B,aACAnyD,OAAQ1pB,EAAM0pB,OACd+e,YACA82C,YAAY,EACZ7zB,OACEA,GAAU30D,EAAMR,MAAc,kCAAoC,KAYtE,OARA6J,EAAAA,EAAAA,YAAU,KACJJ,EAAM0pB,QACR3K,uBAAsB,KACpB61F,EAAaC,gBAAgB,GAEjC,GACC,CAAC70G,EAAM0pB,SAGRv3B,EAAAA,cAAC2iH,EAAAA,EAAwB,CACvBniG,QAASA,EACTiiG,aAAcA,EACd/vG,QAAS5R,EACT+M,MAAOA,EACP67E,WAAYA,EACZ1K,WAAYA,EAUZD,aAAa,EACbrzD,WAAY3rB,EAAM2rB,YAClB,EAEJnL,EAAAlgB,aAAA,mpD,0ICpEK,MAAMsiH,EAA2B/hH,IASQ,IATgB,QAC9D4f,EAAO,QACP9N,EAAO,MACP7E,EAAK,WACL67E,EAAU,WACV1K,EAAU,YACVD,EAAW,aACX0jC,KACG1iH,GACwBa,EAC3B,MAAOyiH,EAAe8B,IAAkBngH,EAAAA,EAAAA,WAAS,IAC3C,aAAEsrF,EAAY,aAAE6xB,GAAiBiD,EACrCrlH,EAGA,IAAK8N,EAAOuG,MAAOivG,EAAgBx1G,EAAMuG,MAAQ,IAAMvG,EAAMuG,OAAM,IACnE4qE,GAcF,OAXKD,UACIuR,EAAar/E,SAGtB/L,EAAAA,EAAAA,IAAgB,KACdigH,EAGQ,OAFNz7B,EAAW54E,SAAS0X,cAClB,2CAEH,IAGDxoB,EAAAA,cAAAA,EAAAA,SAAA,KA6BJ,SACEc,EACAwvF,GAEA,GAAwB,mBAAbxvF,EACT,OAAOA,EAASwvF,GAElB,GAAItwF,EAAAA,eAAqBc,IAAsC,iBAAlBA,EAAS4L,KACpD,OAAO1M,EAAAA,aAAmBc,EAAUwvF,GAEtC,OAAOtwF,EAAAA,cAACqlH,EAAAA,EAAsB/0B,EAAexvF,EAC/C,CAvCOwkH,CAAkB5yG,EAAS,IAAK49E,EAAclsE,IAAK46D,IACnDnxE,EAAM0pB,SAAWx3B,EAAM2rB,YACtB1rB,EAAAA,cAAC0tF,EAAAA,GAAO,KACN1tF,EAAAA,cAACujH,EAAAA,EAAe7iE,SAAQ,CACtBt8C,MAAO,CACLyJ,QACAw1G,gBACA/sE,UAAWmsE,EAAansE,UACxBgtE,qBAAsBb,EAAan1B,WAAW7zE,QAGhDzZ,EAAAA,cAAA,OAAAE,EAAAA,EAAAA,GAAA,IACMsf,EAAAA,EAAAA,GACFijG,EAAax1B,aAEbk1B,GACD,CACD/9F,IAAKslE,IAEJlpE,KAKR,EAoBP,MAAM4kG,EAAkDA,CAACrlH,EAAO8N,EAAOuW,KACrE,MAAM,aAAEksE,EAAY,aAAE6xB,IAAiBoD,EAAAA,EAAAA,GACrCxlH,EACA8N,EACAuW,GAkBF,OAbAksE,EAAa7D,cAAgB,KACrBroE,EAAItT,mBAAmB8yF,kBAC3B/1F,EAAMuG,OAAM,EACd,SAQKk8E,EAAah3B,YAEb,CACLg3B,eACA6xB,eACD,EACDQ,EAAAtiH,aAAA,u3C,mFCtIF,MAAMmlH,GAA0BjlH,EAAAA,EAAAA,IAAOq4C,EAAAA,EAAS;;;eAGjCh4C,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,MACpB,GAAEgE,EAAMR,MAAc,iCAAiC;gBAC5CoJ,IAAA,IAAC,MAAE5I,GAAO4I,EAAA,OACtB5I,EAAM0U,MAAM,oCAAoC;;MAE9C7J,IAAA,IAAC,MAAE7K,GAAO6K,EAAA,OAAK7K,EAAM0U,MAAM,qCAAqC;EAGhEmsG,GAAiCllH,EAAAA,EAAAA,IAAOilH,EAAyB;gBACvDp1G,IAAA,IAAC,MAAExL,GAAOwL,EAAA,OACtBxL,EAAM0U,MAAM,sCAAsC;kBACpCxF,IAAA,IAAC,MAAElP,GAAOkP,EAAA,OACxBlP,EAAM0U,MAAM,uCAAuC;EAO1CmgD,EAAoBjlD,IAGW,IAHV,KAChC9H,EAAO,QAAO,SACd5L,GACuB0T,EACvB,MAAMwgE,EACK,UAATtoE,EAAmB84G,EAA0BC,EAC/C,OAAOzlH,EAAAA,cAACg1E,EAAS,CAACotC,WAAS,GAAEthH,EAAqB,EAClD24D,EAAAp5D,aAAA,2e,mECvCK,MAAM2iH,EAA6B,EAC7BH,EAAoBjiH,IAAA,IAAC,MAAEgE,GAAyBhE,EAAA,OAC3DgE,EAAM0U,MAAM,qBAAuB1U,EAAMK,KAAmB,UAAZ,UAAsB,EAC3D89G,EAAqBv1G,IAAA,IAAC,MAAE5I,GAAyB4I,EAAA,OAC5D5I,EAAM0U,MAAM,sBAAwB1U,EAAMK,KAAmB,UAAZ,UAAsB,C,gMCDlE,MAAMygH,EAAsB9kH,IAI5B,IAJ+C,KACpDgP,GAGDhP,EACC,OACEZ,EAAAA,cAAC84E,EAAAA,EAAiC,CAAC7iE,QAASrG,EAAKzL,KAC/CnE,EAAAA,cAAC2lH,EAAAA,EAAQ,CAACxhH,IAAKyL,EAAKzL,IAAKyL,KAAMA,IACG,EAEtC81G,EAAArlH,aAAA,iK,eCcK,MAAMsoB,EAAkB3oB,EAAAA,YAC7B,CAAAY,EASE2xD,KACI,IATJ,mBACE3pC,GAAqB,EAAK,QAC1B5C,EAAO,qBACP0/B,EAAoB,MACpBjsC,EAAK,UACL07D,KACGp1E,GACqBa,EAG1B,MAAMiN,GAAQo9E,EAAAA,EAAAA,GACZ,IAAKlrF,EAAO2lF,wBAAyB3lF,EAAM0lF,qBAC3Cz/D,GAEI5B,GAAMy9D,EAAAA,EAAAA,GAAgBtvB,IACtB,UACJqzD,EAAS,YACTC,EAAW,wBACXjqC,EAAuB,iBACvBC,IACEiqC,EAAAA,EAAAA,GAAmB,IAAK/lH,EAAO88E,eAAe,GAAQhvE,EAAOuW,IAE3D,iBAAE0hE,IAAqBigC,EAAAA,EAAAA,GAAmB,CAAEl4G,UAIlD,OACE7N,EAAAA,cAACgmH,EAAAA,EAAYtlE,SAAQ,CAACt8C,MAAOyhH,GAC3B7lH,EAAAA,cAAC44E,EAAAA,EAA6Bl4B,SAAQ,CAACt8C,MAAOw3E,IAC1Cl2B,GAAwB1lD,EAAAA,cAACmjG,EAAAA,EAAqBtnB,GAChD77E,EAAAA,cAACimH,EAAAA,GAAU/lH,EAAAA,EAAAA,GAAA,CACToB,GAAI6kF,EAAAA,GACJ/hE,IAAKA,EACLwE,mBAAoBA,GAChBk9D,EACA8/B,GACArvC,EAAAA,EAAAA,GAAex2E,EAAO,CAAEslF,WAAW,IAAO,CAC9C5rE,MAAOA,EACP07D,UAAWA,KAEV,CAACzoE,EAAckD,IACd5P,EAAAA,cAAC0lH,EAAmB,CAClBvhH,IAAMyL,EAAiBzL,IACvByL,KAAMA,OAKO,IAG3B+Y,EAAAtoB,aAAA,oW,sHChEK,SAASylH,EACd/lH,EACA8N,EACAuW,GAEA,MAAM,eACJpD,EAAc,iBACdy5D,EAAgB,iBAChBtB,EAAgB,YAChBE,KACG6sC,IACD1rC,EAAAA,EAAAA,GAAyB,IACxBz6E,EACHg5E,WAAYlrE,EAAMkrE,WAClBI,iBAAkBtrE,EAAMsrE,iBACxBsB,iBAAkB,IAAI0rC,EAAAA,EACpBt4G,EAAMkrE,WACNlrE,EAAMqgD,aACN9pC,GAEFA,SAOM+yD,cAAeivC,IAA6BhvC,EAAAA,EAAAA,GAAY,CAC9D3S,UAAYv6D,IAER,CAAC,QAAS,YAAa,cAAc2E,SAAS3E,EAAE/F,QAC/CkzE,EAAAA,EAAAA,GAAentE,GAEhBmvE,EAAYsY,QAEZznF,EAAEutE,qBACJ,KAIE,UAAEmuC,KAAcS,IAAmBC,EAAAA,EAAAA,GACvC,IAAKvmH,EAAO06E,oBACZ,IAAK5sE,EAAOsrE,oBACZ/0D,GAGF,MAAO,CACLwhG,WAAWpmG,EAAAA,EAAAA,GAAWomG,EAAW5kG,EAAgBolG,MAC9CF,KACAG,EAEP,C,0EClEO,MAAMJ,GAAa1lH,EAAAA,EAAAA,IAAOi/E,EAAAA,GAAYjlE,MAAM,CAAEwhC,KAAM,QAAoB;gBAC/Dn7C,IAAA,IAAC,MAAEgE,GAAOhE,EAAA,OAAKgE,EAAM0U,MAAM,kBAAkB;iDCYtD,MAAM0sG,E,QAAchmH,cACzB,K,+DCbK,MAAMmmH,UAAgC5+B,EAAAA,EAC3CzL,WAAAA,CACU/C,EACR7qB,EACA9pC,EACA8iE,GAEAwL,MAAM,CACJ3Z,aACA7qB,eACA9pC,MACA8iE,WAGA2B,OAAQ,SACP,KAbK9P,WAAAA,CAcV,CAEAwtC,YAAAA,CAAapiH,GACX,MAAMyL,EAAOosE,KAAKjD,WAAWruE,QAAQvG,GACrC,OAAOyL,GAAMk9E,WAAa9Q,KAAKZ,YAAYj3E,EAC7C,CAEAqiH,aAAAA,CAAcriH,GACZ,OAAO63E,KAAKX,YAAYl3E,EAC1B,E,oHCzBK,MAAMsiH,EAAiB,GACxBC,GAAqBnmH,EAAAA,EAAAA,IAAOi4E,EAAAA,EAAS;;;;;;EAYrCmuC,EAAUA,CAAC5wD,EAAmB+d,KAClC,MAAM5I,EAAY,CAAEwN,SAAU3iB,GAC9B,OAAI+d,EACK,CACL2N,UAAW1rB,EAAW,4BAA8B,oBACpD6wD,SAAU,CAAEzhH,KAAM,eAAgB+lE,cAGjC4I,OAAL,EACS,CACL2N,UAAW1rB,EAAW,6BAA+B,qBACrD6wD,SAAU,CAAEzhH,KAAM,gBAAiB+lE,aAEvC,EAGK,SAAS27C,EAAYjmH,GAIL,IAJM,SAC3Bm1D,EAAQ,SACR+d,KACG/zE,GACea,EAClB,MAAMmZ,GAAO4J,EAAAA,EAAAA,UAAQ,IAAMgjG,EAAQ5wD,EAAU+d,IAAW,CAAC/d,EAAU+d,IACnE,OACE9zE,EAAAA,cAAC0mH,GAAkBxmH,EAAAA,EAAAA,GAAA,CACjB6Z,KAAMA,GAAM6sG,SACZnlC,UAAW1nE,GAAM0nE,UACjB30E,KAAM25G,GACF1mH,GAGV,CAAC8mH,EAAAxmH,aAAA,2L,yBC3CM,SAASymH,EAAuBlmH,GAQQ,IARJ,WACzCm4E,EAAU,UACVx3B,EAAS,iBACT43B,EAAgB,IAChBh1E,GAIDvD,EACC,MAAO,CACLmmH,0BAA2B,CACzB/5E,qBAAqB,EACrB5yB,QAASA,KACPmnC,EAAUp9C,GAKV,MAAM6iH,EAAyB,IAC1B7tC,EAAiBtxD,cACpB5V,QAAQ9N,IACR,IAAI2oF,EAAY/T,EAAWruE,QAAQvG,IAAM2oF,UACzC,KAAOA,GAAW,CAChB,GAAIA,IAAc3oF,EAChB,OAAO,EAET2oF,EAAY/T,EAAWruE,QAAQoiF,IAAYA,SAC7C,CACA,OAAO,CAAK,IAEdk6B,EAAuB9iH,SAASC,GAC9Bg1E,EAAiB8tC,gBAAgB9iH,MAIhCg1E,EAAiB3vD,WAAWrlB,IAC7B6iH,EAAuB32G,OAAS,GAEhC8oE,EAAiB8tC,gBAAgB9iH,EACnC,GAIR,C,0BCvCO,MAAM+iH,GAAiB3mH,EAAAA,EAAAA,IAAO4/C,EAAAA,GAAgB5lC,MACnD,CAAEwhC,KAAM,YACa;;;kBAGLn7C,IAAA,IAAC,MAAEoe,GAAOpe,EAAA,OAASoe,EAAQ,GAAKynG,EAAiB,EAAjC,IAAsC;;IAEpEj5G,IAAsD,IAClD8xB,GADH,iBAAEwgD,EAAgB,SAAE/pB,EAAQ,SAAE/d,EAAQ,MAAEpzC,GAAO4I,EAE5C8L,EAAQ0+B,EACRpzC,EAAM0U,MAAM,wBACZ1U,EAAM0U,MACJ,kBACA1U,EAAM8V,aAAaisE,iBAsBzB,OApBI5wB,IACE+pB,GACFxmE,EAAQ1U,EAAMgiF,oBACZhiF,EAAM0U,MACJ,6BACG1U,EAAM8V,aAAamsE,yBAE1BvnD,EAAkB16B,EAAM0U,MACtB,8BAGFA,EAAQ1U,EAAM0U,MACZ,mCACAA,GAEFgmB,EAAkB16B,EAAM0U,MACtB,sCAIC,CACLgmB,kBACAhmB,QACD;EC/BE,SAASqsG,EAAQ/kH,GAAiC,IAA7B,KAAEgP,GAAwBhP,EACpD,MAAMwjB,GAAMvT,EAAAA,EAAAA,QAAO,OAEjBhD,OAAO,WACLkrE,EAAU,iBACVI,EAAgB,aAChBtzD,EAAY,aACZqoC,EAAY,UACZ3M,GAEFpG,QAAS2kC,EACTqnC,aAAer2G,QAAS8O,KACtB0J,EAAAA,EAAAA,YAAW08F,EAAAA,GAETx8F,EAAa2vD,EAAiB3vD,WAAW5Z,EAAKzL,KAC9C2vE,EAAWjuD,EAAagU,IAAIjqB,EAAKzL,KACjCunB,EAAawiC,EAAar0B,IAAIjqB,EAAKzL,MAEjC+/E,WAAY6I,IAAqB5I,EAAAA,EAAAA,GAAS,IAC7C2iC,EAAwB,CACzB3iH,IAAKyL,EAAKzL,IACV40E,aACAI,mBACA53B,cACCwlE,0BACHr7F,gBAGI,cAAE07F,GCpCH,SAAoBxmH,GAcvB,IAd2B,KAC7BgP,EAAI,IACJwU,EAAG,iBACH+0D,EAAgB,SAChBnhC,EAAQ,UACRuJ,EAAS,SACT3hC,GAQDhf,EACC,MACEsjF,YAAY,UAAEzf,KAAcyf,KAC1BC,EAAAA,EAAAA,GAAS,KACRqC,EAAAA,EAAAA,GAAkB,CACnBriF,IAAKyL,EAAKzL,IACVigB,MACA+0D,mBACA0D,eAAe,IACdoD,UACHv0D,WAAYssB,EACZhL,qBAAqB,IAcvB,MAAO,CACLo6E,eAAe5nG,EAAAA,EAAAA,GAAW0kE,EAAY,CAAEjjE,cAZpBA,KAChB,IAAIrR,EAAKywE,YAAYhwE,OAAS,EAChCkxC,EAAU3xC,EAAKzL,KAEfyb,IAAWhQ,EAAKzL,IAClB,GAEgB,CAChB43C,KAAM,aAMV,CDN4BsrE,CAAY,CACpCz3G,OACAwU,MACAm9B,YACA3hC,WACAu5D,mBACAnhC,SAAUtsB,IAYZ,OACE1rB,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAACknH,GAAchnH,EAAAA,EAAAA,GAAA,CACbkkB,IAAKA,GACDgjG,EAAa,CACjBtnC,iBAAkBA,EAClB9nC,SAAUtsB,EACVqqC,SAAUvsC,EACV,gBAAekC,EACf,gBAAelC,EACfxK,MAAOpP,EAAKoP,QAEX,IAAIpP,EAAKywE,YAAYhwE,OAAS,GAC7BrQ,EAAAA,cAAC6mH,GAAY3mH,EAAAA,EAAAA,GAAA,CACX61D,SAAUvsC,EACVsqD,SAAUA,GACNiZ,IAGR/sF,EAAAA,cAACupB,EAAAA,EAAiBm3B,SAAQ,CACxBt8C,MAAO,CACLsnB,aACAlC,aACAC,mBAAoBq2D,EACpB16D,KAAMxV,IAGPA,EAAKiwB,WAKhB,CAAC8lF,EAAAtlH,aAAA,wN,gME5CM,SAASimH,EAAiB1lH,EAU/BiN,EACAuW,GACC,IAXD,SACExE,EAAQ,QACR3O,EAAO,OACPE,EAAM,UACNgS,EAAS,cACToiC,EAAa,cACbD,KACGvlD,GACoBa,EAIzB,MAAM01E,GAAWC,EAAAA,EAAAA,GAAex2E,GAC1BmnF,GAAWC,EAAAA,EAAAA,GAAY,CAAEC,MAAO,SAAUC,YAAa,UAEtDlsC,EAASwsC,IAAc3iF,EAAAA,EAAAA,WAAS,IAErCwiF,iBAAiB,YAGfluB,EACAmL,UAAW6iD,KACR9/B,KAEHC,EAAAA,EAAAA,GAAwB,CAC1BrjE,MACA+0D,iBAAkBtrE,EAAMsrE,iBACxBuM,wBAAyB3lF,EAAM0lF,oBAC/BsB,eAAe,EACf5jE,YACAs3D,kBAAkB92D,EAAAA,EAAAA,UAChB,IACE5jB,EAAM06E,kBACN,IAAI0rC,EAAAA,EACFt4G,EAAMkrE,WACNlrE,EAAMqgD,aACN9pC,EACA8iE,IAEJ,CAACr5E,EAAMkrE,WAAYlrE,EAAMqgD,aAAcnuD,EAAM06E,sBAIjDuC,EAAAA,EAAAA,GAAwB,CACtBja,cAAe3+C,EACfvW,QACA+R,WACA0lC,kBAGF,MAAM,iBAAEu/B,IAAqBC,EAAAA,EAAAA,GAAe,CAC1CC,oBAAqB4C,KAGvB/K,EAAAA,EAAAA,GACE,CACEC,cAAe98E,EAAM88E,cACrB1D,iBAAkBtrE,EAAMsrE,kBAE1B/0D,GAGF,MA0CM,cAAE+yD,IAAkBC,EAAAA,EAAAA,GAAY,CACpC3S,UA3CiBhoD,IACjB,MAAMqgE,EAAajvE,EAAMsrE,iBAAiB2D,WACpCyqC,EAAczqC,EAChBjvE,EAAMkrE,WAAWruE,QAAQoyE,GACzB,KACJ,GAAIyqC,EAAa,CACf,MAAMC,EAAez6D,QAAQw6D,GAAaprC,eACpCrI,EAAWjmE,EAAMgY,aAAagU,IAAIijD,GAExC,GADmBjvE,EAAMqgD,aAAar0B,IAAIijD,GAGxC,YADArgE,EAAMg7D,sBAGR13E,GAAO0nH,gBAAgBhrG,EAAO8qG,GAC9B,MAAMG,IACHrwC,EAAAA,EAAAA,GAAe56D,KACD,UAAdA,EAAMtY,KACU,cAAdsY,EAAMtY,KAAuB2vE,GACf,eAAdr3D,EAAMtY,MAAyB2vE,GACpC,GAAI0zC,GAAgBE,EAGlB,OAFAjrG,EAAMgF,sBACN5T,EAAM0zC,UAAUu7B,GAEX,GAAkB,UAAdrgE,EAAMtY,IAEf,YADAyb,IAAWk9D,EAGf,CAOE,CAACrgE,EAAMgnF,QAAShnF,EAAM+mF,QAAS/mF,EAAMkrG,SAAUlrG,EAAMqE,QAAQ7O,QAC1DmW,GAAMA,IACP/X,OAAS,GAEXi3G,IAAmB7qG,GAErBA,EAAMg7D,qBAAqB,IAOvB0vC,GAAc1pG,EAAAA,EAAAA,GAAUmC,IAExB,iBACJu5D,EAAgB,WAChBJ,EAAU,aACVlzD,EAAY,aACZqoC,EAAY,UACZ3M,GACE1zC,EACEg4G,GAAcliG,EAAAA,EAAAA,UAClB,MACE9V,MAAO,CACLkrE,aACAI,mBACAtzD,eACAqoC,eACA3M,aAEFpG,QAAS4R,QAAQ5R,GAAWoK,GAC5B4hE,iBAEF,CACEhuC,EACAJ,EACAlzD,EACAqoC,EACA3M,EACApG,EACAoK,EACA4hE,IAMJ,OAFAS,EAAqC/5G,GAE9B,CAEL+3G,WAAWpmG,EAAAA,EAAAA,GACTqlE,EACA2C,EACArQ,EACAb,EACA,CAAErlE,UAASE,SAAQ4qC,KAAM,SAE3B8pE,cACA1qE,UAEJ,CAUA,MAAMysE,EAAwC/5G,IAC5C,MAAMg6G,GAAwBh3G,EAAAA,EAAAA,QAAOhD,EAAMkrE,aAC3C9qE,EAAAA,EAAAA,YAAU,KACR,GAA4C,QAAxCJ,EAAMsrE,iBAAiB2uC,aAAwB,CACjD,MAAM7jH,EAAO,IAAI4J,EAAMkrE,WAAWQ,YAE5B,QAAEwuC,EAAU,GAAE,MAAEC,EAAQ,KAAOnqF,EAAAA,EAAAA,IAClC9d,GAAiB9b,EAAK4K,SAASkR,GAAe,QAAU,WACzD,IAAIlS,EAAMsrE,iBAAiBtxD,eAE7B,GAAqB,IAAjBmgG,EAAM33G,QAAgB03G,EAAQ13G,OAAS,EACzC,IAAK,IAAI43G,KAAcF,EAAS,CAC9B,IAAI5jH,EAAuB8jH,EAC3B,KAAc7gG,MAAPjjB,GAAkB,CACvB,GAAIF,EAAK4K,SAAS1K,GAGhB,OAFA0J,EAAMsrE,iBAAiBrxD,gBAAgBkgG,EAAMzkH,OAAOY,SACpD0J,EAAMsrE,iBAAiBvhB,cAAczzD,GAGvCA,EACE0jH,EAAsB/2G,QAAQpG,QAAQvG,IAAM2oF,gBAC5C1lE,CACJ,CACF,CAEJ,CACAygG,EAAsB/2G,QAAUjD,EAAMkrE,UAAU,GAC/C,CAAClrE,EAAMkrE,YAAY,C,uHChOjB,MAAMmvC,EAAiCtnH,IAEqB,IAFpB,kBAC7CunH,GACiCvnH,EACjC,MAAMwnH,EACyB,iBAAtBD,EAAiCA,EAAkBC,aAAe,GACrEC,GAAmBzkD,EAAAA,EAAAA,GAAYwkD,GAUrC,MAAO,CACL5rC,YAR6B,iBAAtB2rC,EACHA,EAAkBC,aAAa/3G,SAAWg4G,EAAiBh4G,QAC3D83G,EAAkBC,aAAatwF,MAC7B,CAACwwF,EAAel1G,IAAUk1G,IAAkBD,EAAiBj1G,KAE/D+0G,EAIL,E,QC2BCI,OAAOC,SAvDJ,MAAMC,EAMX3sC,WAAAA,CACEzpD,EAAwBvnB,GAEvB,IADD,aAAE+a,QAA2C,IAAA/a,EAAG,CAAC,EAACA,EAAA,KAP5C49G,OAA4B,IAAIzjG,IAAM,KACtC0jG,cAAQ,OACRntC,cAAQ,OACRE,aAAO,EAMbM,KAAK2sC,SAAWt2F,EAChBxM,EAAeA,GAAgB,IAAI/N,IAEnC,IAiBI8wG,EAjBAC,EAASzjG,IAGX,GAFA42D,KAAK0sC,OAAO/9G,IAAIya,EAAKjhB,IAAKihB,GAGxBA,EAAKi7D,aACU,YAAdj7D,EAAK1Y,MAAsBmZ,EAAagU,IAAIzU,EAAKjhB,MAElD,IAAK,IAAI6uB,KAAS5N,EAAKi7D,WACrBwoC,EAAM71F,EAEV,EAGF,IAAK,IAAI5N,KAAQiN,EACfw2F,EAAMzjG,GAIR,IAAIhS,EAAQ,EACZ,IAAK,IAAKjP,EAAKihB,KAAS42D,KAAK0sC,OACvBE,GACFA,EAAKE,QAAU3kH,EACfihB,EAAK2jG,QAAUH,EAAKzkH,MAEpB63E,KAAKR,SAAWr3E,EAChBihB,EAAK2jG,aAAU3hG,GAGC,SAAdhC,EAAK1Y,OACP0Y,EAAKhS,MAAQA,KAGfw1G,EAAOxjG,EAIPwjG,EAAKE,aAAU1hG,EAGjB40D,KAAKN,QAAUktC,GAAMzkH,GACvB,CAEA,EAAA6kH,WACShtC,KAAK2sC,QACd,CAEA,QAAI77G,GACF,OAAOkvE,KAAK0sC,OAAO57G,IACrB,CAEAysE,OAAAA,GACE,OAAOyC,KAAK0sC,OAAOzkH,MACrB,CAEAglH,YAAAA,CAAa9kH,GACX,IAAIihB,EAAO42D,KAAK0sC,OAAOl+G,IAAIrG,GAC3B,OAAOihB,GAAM2jG,SAAW,IAC1B,CAEAG,WAAAA,CAAY/kH,GACV,IAAIihB,EAAO42D,KAAK0sC,OAAOl+G,IAAIrG,GAC3B,OAAOihB,GAAM0jG,SAAW,IAC1B,CAEAxtC,WAAAA,GACE,OAAOU,KAAKR,QACd,CAEAC,UAAAA,GACE,OAAOO,KAAKN,OACd,CAEAhxE,OAAAA,CAAQvG,GACN,OAAO63E,KAAK0sC,OAAOl+G,IAAIrG,IAAQ,IACjC,CAEAq2F,EAAAA,CAAG2uB,GACD,MAAMllH,EAAO,IAAI+3E,KAAKzC,WACtB,OAAOyC,KAAKtxE,QAAQzG,EAAKklH,GAC3B,EC9FK,SAASC,EACdhkG,GAEA,OAAOikG,EAA+BjkG,EAAM,GAC9C,CAEA,SAASikG,EACPjkG,EACA05F,GAEA,IAAK15F,EACH,MAAO,GAET,MAAMkkG,EAGFlkG,EAAKi7D,WAAWkoC,OAAOC,aACnBpkH,MAAOmlH,EAAU,KAAEC,GAASF,EAAmBl3D,OACjDq3D,EAAiBD,GAA2C,MAAnCF,EAAmBl3D,OAAOhuD,MACzD,OAAkB,MAAdmlH,GAAsBE,GAAkBjC,EAAa+B,GAChDF,EACLE,EACAzK,EAAav7G,OAAQgmH,EAAuBplH,MAGzC26G,CACT,CAEA,MAAM0I,EAAmBpiG,GACvBA,EAAK+2D,gBAEP,SAAyBwsC,GACvB,IAAK,MAAM50G,KAAK40G,GAAY,GAE1B,OAAO,EAET,OAAO,CACT,CARyBe,CAAgBtkG,EAAKi7D,Y,eC3BvC,MAAMspC,UAA6B32B,EAAAA,EAGxClX,WAAAA,CACE/C,EACAlrE,EACAjI,GAEA8sF,MAAM3Z,EAAYlrE,EAAOjI,GAAS,KAPnBmzE,gBAAU,EAQzBiD,KAAKjD,WAAaA,CACpB,CAEA6wC,eAAAA,GACE,GAAI5tC,KAAKc,WAAY,CACnB,MAAM13D,EAAO42D,KAAKjD,WAAWruE,QAAQsxE,KAAKc,YAC1C,GAAI13D,EAAM,CACR,MAAM,WAAEykG,GAAe7tC,KAAK8tC,uBAAuB1kG,GAC/CykG,EAAWx5G,OAAS,GACtB2rE,KAAKl0D,gBAAgB,IAAIk0D,KAAKn0D,gBAAiBgiG,GAEnD,CACF,CACF,CACAE,eAAAA,GACE,GAAI/tC,KAAKc,WAAY,CACnB,MAAM13D,EAAO42D,KAAKjD,WAAWruE,QAAQsxE,KAAKc,YAC1C,GAAI13D,EAAM,CACR,MAAM,WAAE4kG,GAAehuC,KAAK8tC,uBAAuB1kG,GAC/C4kG,EAAW35G,OAAS,GACtB2rE,KAAKl0D,gBACH,IAAIk0D,KAAKn0D,cAAc5V,QAAQ9N,IAAS6lH,EAAWn7G,SAAS1K,KAGlE,CACF,CACF,CAEQ2lH,sBAAAA,CAAuB1kG,GAC7B,OAAO42D,KAAKiuC,kCACV7kG,EACA,IAAI42D,KAAKjD,WAAWQ,WACpB,KAEJ,CAOQ0wC,iCAAAA,CACN7kG,EACAnhB,EACAimH,GAEA,MAAM/kG,EACJC,GAAQA,EAAK0nE,UAAY9Q,KAAKjD,WAAWruE,QAAQ0a,EAAK0nE,WAAa,KAC/Dq9B,EAAUlmH,EAAKgO,QAAQ9N,GAAQA,IAAQ+lH,IACvCE,EAAoBjlG,EACtBklG,EAAkBllG,EAAQglG,GAAStmH,KAAIjD,IAAA,IAAC,IAAEuD,GAAKvD,EAAA,OAAKuD,CAAG,IACvD63E,KAAKsuC,cAAc5mH,SAASS,IAC1B,MAAMyL,EAAOosE,KAAKjD,WAAWruE,QAAQvG,GACrC,OAAOA,IAAQihB,EAAKjhB,KAAOyL,EACvBy6G,EAAkBz6G,EAAMu6G,GACrBtmH,KAAI2J,IAAA,IAAC,IAAErJ,GAAKqJ,EAAA,OAAKrJ,CAAG,IACpBZ,OAAOY,GACV,EAAE,IAEZ,GAAIghB,GAAUilG,EAAkBhtD,OAAOj5D,GAAQ63E,KAAKxyD,WAAWrlB,KAC7D,OAAO63E,KAAKiuC,kCAAkC9kG,EAAQlhB,EAAMmhB,EAAKjhB,KAEnE,MAAMomH,EAAcF,EAClBjlG,EACAnhB,EAAKgO,QAAQ9N,GAAQA,IAAQ+lH,KAC7BrmH,KAAI4L,IAAA,IAAC,IAAEtL,GAAKsL,EAAA,OAAKtL,CAAG,IAEtB,MAAO,CACL0lH,WAAYU,EAAYzyF,MAAM3zB,IAAS63E,KAAKxyD,WAAWrlB,KACnDomH,EACCvuC,KAAKxyD,WAAWpE,EAAKjhB,KAEtBimH,EADA,CAAChlG,EAAKjhB,KAEV6lH,WACEI,EAAkB/5G,OAAS,GAC3B+5G,EAAkBhtD,OAAOj5D,GAAQ63E,KAAKxyD,WAAWrlB,KAC7CimH,EACApuC,KAAKxyD,WAAWpE,EAAKjhB,MAAQ+lH,EAC7B,CAAC9kG,EAAKjhB,KACNomH,EAAYt4G,QAAQ9N,GAAQ63E,KAAKxyD,WAAWrlB,KAEtD,CAEQmmH,WAAAA,GACN,MAAO,IAAItuC,KAAKjD,WAAWQ,WAAWtnE,QACnC9N,GAAmD,MAA3C63E,KAAKjD,WAAWruE,QAAQvG,IAAM2oF,WAE3C,EAGF,SAASu9B,EACPjlG,EACAolG,GAEA,MAAMnqC,GAAcj7D,EAAK+2D,cAAgB,IAAI/2D,EAAKi7D,YAAc,IAAIpuE,QACjEmT,GAASolG,EAAS37G,SAASuW,EAAKjhB,OAEnC,OAAOihB,EAAK+2D,cACRkE,EAAW98E,OACT88E,EAAWx8E,KAAKuhB,GAASilG,EAAkBjlG,EAAMolG,KAAWv5F,QAE9D,EACN,C,cC9FO,MAAMw3F,UAA0BgC,EAErC3uC,WAAAA,CACEzpD,EAAwBzxB,GAEvB,IADD,aAAEilB,GAA0CjlB,EAE5C8xF,MAAMrgE,EAAO,CAAExM,iBAAgB,KALjB6kG,cAAQ,EAMtB1uC,KAAK0uC,SAAWp1G,MAAMiwB,KAAKlT,GAAOxuB,KAAI2J,IAAA,IAAC,IAAErJ,GAAKqJ,EAAA,OAAKrJ,CAAG,GACxD,CAEAwmH,oBAAAA,GACE,MAAMjzF,EAAYskD,KAAK0uC,SACpB7mH,KAAKM,GAAQ63E,KAAKtxE,QAAQvG,KAC1B8N,OAAO8F,EAAAA,GACV,OAAOikE,KAAK4uC,6BAA6BlzF,EAAW,IAAI5f,IAC1D,CAEQ8yG,4BAAAA,CACNv4F,EACA/Z,GAEA,IAAK,MAAM8M,KAAQiN,EACbjN,GAAM+2D,gBACR7jE,EAAOmgB,IAAIrT,EAAKjhB,KAChB63E,KAAK4uC,6BAA6BxlG,EAAKi7D,WAAY/nE,IAGvD,OAAOA,CACT,EA6BK,SAAS2yE,EAAYx7E,EAE1BuW,GACe,IAFf,wBAAEklE,EAA0B,WAAYnrF,GAAqB0P,GAGxDoW,EAAc8B,IAAmBi7C,EAAAA,EAAAA,GACpC7iE,EAAM8lB,aAAe,IAAI/N,IAAI/X,EAAM8lB,mBAAgBuB,EACnDrnB,EAAMiwD,oBAAsB,IAAIl4C,IAAI/X,EAAMiwD,qBAAuB,IAAIl4C,IACrE/X,EAAM+oB,kBAGJpE,GAAiBmmG,EAAAA,EAAAA,GAA0B,IAC1C9qH,EACHu/E,kBAAmB,YAEjBpxB,GAAevqC,EAAAA,EAAAA,UACjB,IAAO5jB,EAAMmuD,aAAe,IAAIp2C,IAAI/X,EAAMmuD,cAAgB,IAAIp2C,KAC9D,CAAC/X,EAAMmuD,eAGT,MAAM1xC,EAAU0rG,EAA+BnoH,GAE/C,IAAIwpC,GAAOuhF,EAAAA,EAAAA,GACT/qH,GACAymE,EAAAA,EAAAA,cACGn0C,GAAU,IAAIo2F,EAAep2F,EAAO,CAAExM,kBACvC,CAACA,IAEHrJ,GAGF,MAAM28D,EAAmB,IAAIwwC,EAC3BpgF,EACA7kB,ICxFG,SACL3kB,EAKAwyD,GAEA,MAAMw4D,GAActtG,EAAAA,EAAAA,GAAU1d,IAE9B+sC,EAAAA,EAAAA,qBACEylB,GACA,KACS,CACLtsC,iBAAmB9hB,IACjB4mH,EAAYj6G,QAAQqoE,iBAAiBlzD,iBAAiB9hB,EAAI,EAE5DqP,MAAQrP,IACN,MAAMg1E,EAAmB4xC,EAAYj6G,QAAQqoE,iBAC7CA,EAAiBwO,YAAW,GAO5BxO,EAAiBvhB,cAAc,MAC/BhkD,YAAW,KACTulE,EAAiBvhB,cAAczzD,EAAI,GACnC,EAEJylH,eAAAA,GACEmB,EAAYj6G,QAAQqoE,iBAAiBywC,iBACvC,EACAG,eAAAA,GACEgB,EAAYj6G,QAAQqoE,iBAAiB4wC,iBACvC,EACAiB,SAAAA,GACED,EAAYj6G,QAAQ6W,gBAClBojG,EAAYj6G,QAAQy4B,KAAKohF,uBAE7B,EACAM,WAAAA,GACE,MAAM,KAAE1hF,EAAI,gBAAE5hB,EAAe,iBAAEwxD,GAC7B4xC,EAAYj6G,QACRgsE,EAAa3D,EAAiB2D,WAMpC,GALAn1D,EAAgB,IAAI7P,KAKhBglE,IAAevzC,EAAKmhF,SAAS77G,SAASiuE,GAAa,CACrD,IAAIltE,EAAO25B,EAAK7+B,QAAQoyE,GACxB,KAA0B,MAAnBltE,GAAMk9E,WACXl9E,EAAO25B,EAAK7+B,QAAQkF,EAAKk9E,WAEvBl9E,IACFupE,EAAiBvhB,cAAchoD,EAAKzL,KAChCg1E,EAAiB3vD,WAAWszD,IAC9B3D,EAAiB5lE,OAAO3D,EAAKzL,KAGnC,CACF,KAGJ,GAEJ,CDuBE+mH,CAAW,CAAE/xC,mBAAkBxxD,kBAAiB4hB,QAAQvjB,IAGxD/X,EAAAA,EAAAA,YAAU,KAEuB,MAA7ByW,EAAeo4D,YACdvzC,EAAK7+B,QAAQga,EAAeo4D,aAG7Bp4D,EAAekzC,cAAc,KAC/B,GACC,CAACruB,EAAM7kB,EAAeo4D,aAuBzB,MAAO,CACL/D,WAAYxvC,EACZ1jB,eACAqoC,eACA3M,UAzBiBp9C,IACjB,IAAIgnH,EAAkBC,EACpB7hF,EACA1jB,EACA1hB,GAEF,GAAgC,WAA5B+mF,EAAsC,CACxC,MAAMmgC,EA2CZ,SAAqB9hF,EAA+BplC,GAClD,MAAM2oF,EAAYvjD,EAAK7+B,QAAQvG,IAAM2oF,UACrC,IAAKA,EACH,MAAO,IAAIvjD,EAAKmhF,UAAUnnH,OAAO+nH,EAAgB/hF,IAEnD,IAAIpkB,EAAS2nE,EAAYvjD,EAAK7+B,QAAQoiF,GAAa,KACnD,GAAqB,SAAjB3nE,GAAQzY,KACV,OAAO6+G,EAAcpmG,GAAQthB,KAAI4Q,IAAA,IAAC,IAAEtQ,GAAKsQ,EAAA,OAAKtQ,CAAG,IAEnD,MAAMqnH,EAAkB,GACxB,KAAOrmG,GACLqmG,EAAS17G,QAAQy7G,EAAcpmG,GAAQthB,KAAI8Q,IAAA,IAAC,IAAExQ,GAAKwQ,EAAA,OAAKxQ,CAAG,KACvC,YAAhBghB,EAAOzY,KACLyY,EAAO2nE,UACT3nE,EAASokB,EAAK7+B,QAAQya,EAAO2nE,YAE7B0+B,EAAS17G,QAAQw7G,EAAgB/hF,IACjCpkB,EAAS,MAGXA,EAAS,KAGb,OAAO7P,MAAMiwB,KAAK,IAAIztB,IAAI0zG,GAC5B,CAnE+BC,CAAYliF,EAAMplC,GAAK8N,QAC7Cy5G,GAASA,IAASvnH,GAAO0hB,EAAagU,IAAI6xF,KAE7CP,EAAkBE,EAAiB74F,QAAO,CAAC3M,EAAcslE,IAChDigC,EACL7hF,EACA1jB,EACAslE,IAEDggC,EACL,CACAxjG,EAAgBwjG,EAAgB,EAQhChyC,mBACAxxD,kBAEJ,CAEA,SAAS4jG,EAAiBnmG,GACxB,MAAMi7D,EAAa,IAAKj7D,EAAKi7D,YAAc,IACrCxwE,EAAawwE,EAAWpuE,QAAO7B,IAAA,IAAC,KAAE1D,GAAM0D,EAAA,MAAc,SAAT1D,CAAe,IAC5Di/G,EAAetrC,EAAWpuE,QAAO6B,IAAA,IAAC,KAAEpH,GAAMoH,EAAA,MAAc,YAATpH,CAAkB,IAEvE,OAAOmD,EAAWtM,OAAOooH,EAAajoH,QAAQ6nH,GAChD,CAEA,SAASD,EAAgB/hF,GACvB,OAAOA,EAAKmhF,SACT7mH,KAAKM,GAAQolC,EAAK7+B,QAAQvG,KAC1B8N,OAAO8F,EAAAA,GACPrU,QAAQ6nH,GACR1nH,KAAI2Q,IAAA,IAAC,IAAErQ,GAAKqQ,EAAA,OAAKrQ,CAAG,GACzB,CA8BA,SAASinH,EACP7hF,EACA1jB,EACA1hB,GAGA,IAAK0hB,EAAagU,IAAI11B,KAASolC,EAAK7+B,QAAQvG,IAAMg4E,cAChD,OAAOt2D,EAET,MAAMskG,EAkBR,SAAmBx/G,EAAexG,GAChC,IAAI0H,EAAM,IAAIiM,IAAInN,GACdkB,EAAIguB,IAAI11B,GACV0H,EAAI8hE,OAAOxpE,GAEX0H,EAAI4sB,IAAIt0B,GAGV,OAAO0H,CACT,CA3BkB01C,CAAU17B,EAAc1hB,GAGxC,IAAK,MAAMunH,KAAQvB,EACS,MAAtB5gF,EAAK7+B,QAAQghH,IACfvB,EAAQx8C,OAAO+9C,GAKnB,GAAIvB,EAAQtwF,IAAI11B,GACd,IAAK,MAAMunH,KAAQtC,EAAsB7/E,EAAK7+B,QAAQvG,IACpDgmH,EAAQ1xF,IAAIizF,GAGhB,OAAOvB,CACT,C,8FE7NA,MAAMyB,UAA+B9iC,EAAAA,EACnC+iC,UAAAA,CAAWzmG,EAAeo+C,EAAWE,GACnC,MAAMooD,EAAap5B,MAAMm5B,WAAWzmG,EAAMo+C,EAAGE,GAO7C,OALEt+C,EAAK0nE,WAC6C,SAAlD9Q,KAAKjD,WAAWruE,QAAQ0a,EAAK0nE,YAAYpgF,OAEzCo/G,EAAWtjC,WAAWsE,UAAY,MAE7Bg/B,CACT,CAEAC,iBAAAA,GACE,IAAIroD,EAAIsY,KAAK7uD,QACTkF,EAAQ,GAYZ,MAAM25F,EAAe,IAAIhwC,KAAKjD,WAAWQ,WACtC11E,KAAKM,GAAQ63E,KAAKjD,WAAWruE,QAAQvG,KACrC8N,OAAO8F,EAAAA,GACV,IAAK,IAAIqN,KAAQ4mG,EAAc,CAC7B,IAAIF,EAAa9vC,KAAK6vC,WAAWzmG,EAAM,EAAGs+C,GAC1CA,EAAIooD,EAAWtjC,WAAWqqB,KAAKoZ,KAC/B55F,EAAMviB,KAAKg8G,EACb,CAEA,GAAI9vC,KAAKkwC,UAAW,CAClB,IAAIrZ,EAAO,IAAIsZ,EAAAA,GACb,EACAzoD,EACAsY,KAAKoN,YAAYgjC,YAAY9/F,MAC7B0vD,KAAKqwC,cAAgBrwC,KAAKoN,YAAYgjC,YAAYjrG,QAEhDmrG,EAAS,IAAIC,EAAAA,GAAW,SAAU,SAAU1Z,GAChD72B,KAAKwwC,YAAY7hH,IAAI,SAAU2hH,GAC/Bj6F,EAAMviB,KAAK,CAAE04E,WAAY8jC,IACzB5oD,EAAI4oD,EAAOzZ,KAAKoZ,IAClB,CAEA,GAAqB,IAAjB55F,EAAMhiB,OAAc,CACtB,IAAIwiG,EAAO,IAAIsZ,EAAAA,GACb,EACAzoD,EACAsY,KAAKoN,YAAYgjC,YAAY9/F,MAC7B0vD,KAAKywC,mBAAqBzwC,KAAKoN,YAAYgjC,YAAYjrG,QAErD4rB,EAAc,IAAIw/E,EAAAA,GAAW,cAAe,cAAe1Z,GAC/D72B,KAAKwwC,YAAY7hH,IAAI,cAAeoiC,GACpC1a,EAAMviB,KAAK,CAAE04E,WAAYz7C,IACzB22B,EAAI32B,EAAY8lE,KAAKoZ,IACvB,CAMA,OAJAjwC,KAAK6f,YAAc,IAAIpB,EAAAA,GACrBze,KAAKoN,YAAYgjC,YAAY9/F,MAC7Bo3C,EAAIsY,KAAK7uD,SAEJkF,CACT,CAEAq6F,qBAAAA,CAAsB7Z,GACpB,OAAOngB,MACJg6B,sBAAsB7Z,GACtB5gG,QAAQu2E,GAA0D,MAA3CxM,KAAKjD,WAAWruE,QAAQ89E,EAAWrkF,MAC/D,EAGK,MAAM4hH,EAAqBnlH,IAS5B,IAT+C,MACnDiN,GAGDjN,EAMC,MAAMioF,GAASllE,EAAAA,EAAAA,UACb,IACE,IAAIioG,EAAoB,CAQtB7iC,mBAAoB,MAExB,IAKF,OAHAF,EAAO9P,WAAalrE,EAAMkrE,WAC1B8P,EAAO36B,aAAergD,EAAMqgD,aAErB,CACL43B,iBAAkB,CAChBhJ,WAAYjvE,EAAMsrE,iBAAiB2D,WACnC/D,WAAYlrE,EAAMkrE,WAClB8P,SAKAK,UAAW,SACXC,aAAehlF,GACN0kF,EAAOO,YAAYD,aAAahlF,EAAK,CAC1CklF,eAAe,EACfC,SAAU,IAGdC,gBAAiB,QAEpB,C,oFCrHI,SAASp7D,EAAcvtB,GAID,IAJE,QAC7BolB,GAGDplB,EACC,MAAO,CACL,CACE0d,GAAIvD,EAAAA,EAAe8T,WACnB7U,MAAO,aACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,sBACzB4E,gBAAiBA,KACfqH,EAAQlV,SAASk6G,WAAW,GAGhC,CACE1sG,GAAIvD,EAAAA,EAAe+T,aACnB9U,MAAO,eACPD,KAAM/Z,EAAAA,cAAC0e,EAAAA,GAAY,CAAC3E,KAAK,wBACzB4E,gBAAiBA,KACfqH,EAAQlV,SAASm6G,aAAa,GAGlC,CACE3sG,GAAIvD,EAAAA,EAAe02C,iBACnBz3C,MAAO,mBACP2E,gBAAiBA,KACfqH,EAAQlV,SAAS84G,iBAAiB,GAGtC,CACEtrG,GAAIvD,EAAAA,EAAe22C,iBACnB13C,MAAO,mBAGP2E,gBAAiBA,KACfqH,EAAQlV,SAASi5G,iBAAiB,GAI1C,C,gDC1BA,MAQM4C,EAAkC,SACtC/8G,EACA2jB,EACAq5F,QAAmB,IAAnBA,IAAAA,EAAsB,IAEtB,MAAM9rH,EAAWyyB,EAAY3jB,GACb,MAAZ9O,EACF8rH,EAAe98G,KAAKF,GAEpB9O,EAASoD,SAAS8uB,GAChB25F,EAAgC35F,EAAOO,EAAaq5F,IAG1D,EAGO,MAAM7yF,EAIX+hD,WAAAA,CAAoBjuE,EAA4B07B,GAAwB,KAApD17B,MAAAA,EAAkB,KAAU07B,KAAAA,EAAqB,KADrErC,MAAQ,IAAI2lF,QAEV7wC,KAAKzyC,KAAOA,EACZyyC,KAAKnuE,MAAQA,CACf,CAEA8zB,MAAAA,CAAO/xB,GACL,MAAM9O,EAAWk7E,KAAKzyC,KAAKhW,YAAY3jB,GACjCzL,EAAM63E,KAAKzyC,KAAKtP,OAAOrqB,GAE7B,GADqC,MAAZ9O,EAEvBk7E,KAAKnuE,MAAM8zB,OAAOx9B,OACb,CACL,MAAM0J,EAAQmuE,KAAKv6C,kBAAkB7xB,GAC/Bk9G,EAzCmBC,EAC7Bn9G,EACA2jB,KAEA,MAAMq5F,EAAsB,GAE5B,OADAD,EAAgC/8G,EAAM2jB,EAAaq5F,GAC5CA,CAAc,EAmCMG,CAAuBn9G,GAAOA,GACnD01G,EAAkBtpC,KAAKzyC,KAAKhW,YAAY3jB,MACxC/L,IAAIm4E,KAAKzyC,KAAKtP,QACF,aAAVpsB,EACFmuE,KAAKnuE,MAAM8/D,UAAUm/C,GAErB9wC,KAAKnuE,MAAM4qB,OAAOq0F,EAEtB,CACF,CAEArrF,iBAAAA,CAAkB7xB,GAGhB,MAAMo9G,EAAchxC,KAAK90C,MAAM18B,IAAIoF,GACnC,GAAIo9G,EACF,OAAOA,EAET,MAAMlsH,EAAWwkH,EAAkBtpC,KAAKzyC,KAAKhW,YAAY3jB,IACnDzL,EAAM63E,KAAKzyC,KAAKtP,OAAOrqB,GAE7B,IAAI/B,EACJ,GAFqC,MAAZ/M,EAGvB+M,EAAQ,IAAImuE,KAAKnuE,MAAM3E,OAAO2F,SAAS1K,GAAO,WAAa,kBACtD,CACL,MAAM8oH,EAAuBnsH,EAAS+C,KAAKmvB,GACzCgpD,KAAKv6C,kBAAkBzO,KAGvBnlB,EADEo/G,EAAqB7vD,OAAOvvD,GAAoB,gBAAVA,IAChC,cAEAo/G,EAAqB7vD,OAAOvvD,GAAoB,aAAVA,IAC1C,WACA,mBAER,CAEA,OADAmuE,KAAK90C,MAAMv8B,IAAIiF,EAAM/B,GACdA,CACT,EAGF,SAASy3G,EAAqBxkH,GAC5B,OAAIA,EACM,GAAwByC,OAAOzC,GAElC,IACT,C,mFChGO,MAAMygC,EAAgCvhC,EAAAA,YAC3C,CAAAY,EASEwjB,KACwB,IATxB,gBACEid,EAAe,kBACf8mF,EAAiB,cACjBV,KACG1nH,GAGJa,EAGD,MAAMssH,EACyB,iBAAtB/E,EACHA,EAAkBC,aAClB,GACN,OACEpoH,EAAAA,cAAC2oB,EAAAA,GAAezoB,EAAAA,EAAAA,GAAA,CACdkkB,IAAKA,GACDrkB,EAAK,CAETooH,kBAAmB,CACjBC,aAAc,CAAC/mF,KAAoB6rF,IAErCzF,cAAeA,CAAChrG,EAAO7M,KACH,MAAd6M,EAAMtY,KAAeyL,EAAKxL,OAC5Bi9B,EAAgBM,OAAO/xB,EAAKxL,OAE9BqjH,IAAgBhrG,EAAO7M,EAAK,IAE9B,IAGN2xB,EAAAlhC,aAAA,wd,+FCnCF,MAAM8sH,E,SAAwB5sH,GAAOy+B,KAAIx+B,WAAA,CAAAC,YAAA,0CAAAC,YAAA,gBAAXH,CAAW,gDAwB5BihC,EAAmB5gC,IAIC,IAJmB,eAClD8jB,EAAc,SACdgd,EAAQ,kBACR0rF,GAAoB,GACKxsH,EACzB,MAAMilH,GAAcv8F,EAAAA,EAAAA,YAAW08F,EAAAA,GACzBqH,GAAc/jG,EAAAA,EAAAA,YAAWC,EAAAA,GAC/B,IAAK8jG,EACH,MAAM,IAAIhjH,MAAM,oDAGlB,OACErK,EAAAA,cAACmtH,EAAqB,KACpBntH,EAAAA,cAACwtB,EAAAA,EAAQ,CACPsgB,cAAY,EACZ,aAAa,UAASu/E,EAAYjoG,KAAKhF,YACvCoJ,WAA+B,aAAnB9E,EACZsf,gBAAoC,sBAAnBtf,EACjBgH,WAAY2hG,EAAY3hG,WACxBlJ,SAAUA,KACRkf,IAIImkF,GAAewH,GAAeD,IAChCvH,EAAYh4G,MAAMsrE,iBAAiBvhB,cACjCy1D,EAAYjoG,KAAKjhB,KAEnB0hH,EAAYh4G,MAAMsrE,iBAAiBwO,YAAW,GAC9Ck+B,EAAYh4G,MAAMsrE,iBAAiBrxD,gBAAgB,CACjDulG,EAAYjoG,KAAKjhB,MAErB,IAGkB,EAE1Bq9B,EAAAnhC,aAAA,w8C,4FCvDK,MAAM+vD,EAA0BA,CACrC7mB,EAAqB3oC,KAQQ,IAN3BinB,aAAcylG,EAAgB,oBAC9BC,EAAmB,qBACnBl9D,GAGAzvD,EAEF,MAAOinB,EAAc2lG,IAAsBC,EAAAA,EAAAA,GACzCH,EACAC,GAAuB,IAAIz1G,IAC3Bu4C,GAEIrqC,GAAUvI,EAAAA,EAAAA,GAAU8rB,GAE1B,OAAO5lB,EAAAA,EAAAA,UACL,IACE,IAAIoW,EAAAA,EACF,CAAE7wB,MAAO2e,KAAiB2lG,GAC1BxnG,EAAQlV,UAEZ,CAAC+W,EAAc0hB,EAAK7R,WACrB,C,0ECpBI,MAAMoxD,UAAmC4kC,EAAAA,EAQ9C5xC,WAAAA,CAAYl2E,GACV8sF,MAAM9sF,GARR,KAGA+nH,WAAa,IAAI1oG,IAAmB,KAC5B2oG,oBAA8B,EAAE,KAChC3kC,cAAwB,EAID7hE,MAAzBxhB,EAAQqjF,gBACVjN,KAAKiN,cAAgBrjF,EAAQqjF,cAEjC,CAEA4kC,SAAAA,CAAUzoG,EAAeo+C,EAAWE,GAClC,MAAMooD,EAAap5B,MAAMm7B,UAAUzoG,EAAMo+C,EAAGE,GAI5C,OAHIsY,KAAK4xC,sBACP9B,EAAWtjC,WAAWqqB,KAAKvmF,MAAQ0vD,KAAK4xC,qBAEnC9B,CACT,CAEAgC,SAAAA,CAAU1oG,EAAeo+C,EAAWE,GAClC,MAAkB,YAAdt+C,EAAK1Y,KACAsvE,KAAK+xC,aAAa3oG,EAAMo+C,EAAGE,GAE7BgvB,MAAMo7B,UAAU1oG,EAAMo+C,EAAGE,EAClC,CAEAqqD,YAAAA,CAAa3oG,EAAeo+C,EAAWE,GACrC,IAAIp3C,EAAQ0vD,KAAKoN,YAAYgjC,YAAY9/F,MACrC0hG,EAAahyC,KAAKiN,cAElB4pB,EAAO,IAAIsZ,EAAAA,GAAK3oD,EAAGE,EAAGp3C,EAAQk3C,EAAGwqD,GACjCxlC,EAAa,IAAI+jC,EAAAA,GAAWnnG,EAAK1Y,KAAM0Y,EAAKjhB,IAAK0uG,GAErD,OADArqB,EAAWylC,eAAgB,EACpB,CACLzlC,aAGJ,CAKUujC,iBAAAA,GACR,OAAOr5B,MAAMw7B,iBACf,CAEAA,eAAAA,GACElyC,KAAK4xC,oBAAsB5xC,KAAKmyC,yBAMhCnyC,KAAKoyC,qBACHpyC,KAAK6f,aAAavvE,QAAU0vD,KAAK4xC,oBACnC,MAAMS,EAAcryC,KAAK+vC,oBAEzB,OADA/vC,KAAK6f,YAAYvvE,MAAQ0vD,KAAK4xC,oBACvBS,CACT,CAEA9xC,gBAAAA,CAAiB+xC,EAAeC,GAC9B,OACE77B,MAAMnW,iBAAiB+xC,EAASC,IAChCvyC,KAAKmyC,2BAA6BnyC,KAAK4xC,mBAE3C,CAGApyD,QAAAA,CAASgzD,GACP97B,MAAMl3B,SAASgzD,GACfxyC,KAAKyyC,UAAYzyC,KAAK6f,YAAYvvE,KACpC,CAEAoiG,cAAAA,CAAevqH,EAAgB2I,GAC7B,MAAM6hH,EAAUj8B,MAAMg8B,eAAevqH,EAAK2I,GAE1C,OADmBkvE,KAAKwwC,YAAYhiH,IAAIrG,IACtB2I,EAAKwf,MAAQ0vD,KAAK6f,YAAYvvE,OAC9C0vD,KAAK2xC,WAAWhjH,IAAIxG,EAAK2I,EAAKwf,QACvB,IAEP0vD,KAAK2xC,WAAWhgD,OAAOxpE,GAChBwqH,EAEX,CAEQR,sBAAAA,GACN,OAAO95G,KAAKC,IACV0nE,KAAKoN,YAAYgjC,YAAY9/F,SAC1B0vD,KAAKoN,YAAYwlC,aAAa/qH,KAAKgrH,IACpC,MAAMrmC,EAAaqmC,EAAKrmC,WAClBsmC,EACJtmC,GAAcxM,KAAK2xC,WAAWnjH,IAAIg+E,EAAWrkF,KAC/C,OACE2qH,GACAtmC,EAAWqqB,KAAKkc,WAAW/yC,KAAKoN,YAAY4lC,kBAErCF,EAEF,CAAC,IAGd,E,+DCjIK,SAASG,EAAgBztG,GAC9B,OACE0tG,EAAa1tG,IAAW,KAALA,GAAiB,KAALA,GAAiB,KAALA,GAAiB,KAALA,GAAiB,KAALA,CAEvE,CAEO,SAAS0tG,EAAaC,GAC3B,MAAO,QAAQxnF,KAAKwnF,EACtB,CAEO,SAASC,EAAYjoD,GAC1B,OAAOA,EAAI1iB,gBAAkB0iB,GAAOA,EAAIv/B,gBAAkBu/B,CAC5D,CCLA,SAASkoD,EAAiBC,GACxB,OAAQL,EAAgBK,KAAQJ,EAAaI,EAC/C,CAGO,MAAM16D,EAAiBA,CAC5Bn/C,EACA85G,KAEA,MAAMC,EAAW/5G,EAAM1S,MAAM,IAAIc,IAAI4rH,GAC/B14D,EAAUw4D,EAAWxsH,MAAM,IAAIkP,OAAOo9G,GAAkBn5G,KAAK,IAC7D2nC,EAA+D,GACrE,IAAI6xE,GAAa,EACbC,EAAa,EACfC,EAAe,EAEjB,OAAa,CACX,GAAI/xE,EAAQxtC,SAAW0mD,EAAQ1mD,OAC7B,OAAOu5F,EAAAA,EAAAA,IAAwB/rD,EAAQh6C,KAAIjD,IAAA,IAAG+uH,WAAYvnG,GAAGxnB,EAAA,OAAKwnB,CAAC,KAErE,GAAIunG,EAAal6G,EAAMpF,OAAS,EAAG,CACjC,GAAIwtC,EAAQxtC,OAAS,EAAG,CAItB,MAAMw/G,EAAYhyE,EAAQ76C,MAC1B2sH,EAAaE,EAAUF,WAAa,EACpCC,EAAeC,EAAUD,aACzB,QACF,CACA,KACF,CACKP,EAAiB55G,EAAMk6G,IAK1B54D,EAAQ64D,GAAchoF,gBAAkBnyB,EAAMk6G,GAAY/nF,gBACzD8nF,GAAcF,EAASG,IAAkC,IAAnB9xE,EAAQxtC,SAE/CwtC,EAAQ/tC,KAAK,CAAE8/G,eAAcD,eAC7BD,GAAa,EACbE,IACAD,MAEAD,GAAa,EACbC,KAbAA,GAeJ,CACA,OAAO,IAAI,EAGb,SAASF,EAAQN,EAAc/7G,EAAe08G,GAC5C,MAAMC,EAAeD,EAAM18G,EAAQ,GACnC,OACY,IAAVA,GACC67G,EAAgBc,KAAkBd,EAAgBE,IAClDC,EAAYD,KAAUC,EAAYW,EAEvC,C,wEC3DO,MAAMtoC,EACX7hF,IAEA,MACE4hF,iBAAiB,UAAE/iB,KAAc+iB,KAC/BwoC,EAAAA,EAAAA,GAA4BpqH,GAwBhC,OAvBAqI,EAAAA,EAAAA,YAAU,KAER,MAAM,iBAAEkrE,EAAgB,UAAEh2D,EAAS,cAAE4jE,GAAkBnhF,GAErDmhF,GACe,UAAd5jE,GAAuC,SAAdA,GACK,MAA/Bg2D,EAAiB2D,YAEjB3D,EAAiBlzD,iBAAiBkzD,EAAiB2D,YAMnD3D,EAAiBmB,kBACc,MAA/BnB,EAAiB2D,YAIjB3D,EAAiBvhB,cAAcuhB,EAAiBmB,iBAClD,GAEC,IACI,CACLkN,gBAAiB,IACZA,EACH/iB,UAAYv6D,IAQLA,EAAE4W,QACL2jD,IAAYv6D,EACd,GAGL,C,yECzCI,MAAMs8E,EACX5gF,IAEA,MAKM0S,GAAS23G,EAAAA,EAAAA,GAA0BrqH,GACzC,MAAO,IACF0S,EACH2nE,WAAWzgE,EAAAA,EAAAA,GAAWlH,EAAO2nE,UAAW,CAAE1+D,cARWrX,IAChDtE,EAAQuzE,iBAAiB3vD,WAAW5jB,EAAQzB,MAC/CyB,EAAQuzE,iBAAiB5lE,OAAO3N,EAAQzB,IAC1C,IAMD,C,gDCjBI,MAAMi+D,EAAgB,yC,yECQtB,MAAM7J,EAAav4D,EAAAA,YAAiB,SAAyBY,EAElEwjB,GACC,IAFD,SAAEtjB,KAAaoyD,GAA6BtyD,EAG5C,MAAMsvH,GAAiBr/G,EAAAA,EAAAA,QAAwB,MACzCs/G,GAAkBt/G,EAAAA,EAAAA,QAAqB,MA4B7C,OA3BAi8B,EAAAA,EAAAA,qBACE1oB,GACA,MACE5Q,MAAQ48G,IACN,MAAMn5C,EAAek5C,EAAgBr/G,QAC/Bu/G,EAAmBH,EAAep/G,SAAS4iF,cACjD,IAAKzc,EACH,MAAM,IAAI5sE,MAAM,4BAElB,IAAKgmH,EACH,MAAM,IAAIhmH,MAAM,+BAElB,GAAI+lH,EACF,OAAOn5C,EAAaq5C,aAGpBz/E,SAASC,eACTD,SAASC,gBAAkBu/E,GAC3BA,EAAiBn/B,SAASrgD,SAASC,gBAEnCmmC,EAAaO,UAAU,CAAE+4C,UAAU,GACrC,KAGJ,IAIAvwH,EAAAA,cAACwwH,EAAAA,GAAsBt9D,EACrBlzD,EAAAA,cAACywH,EAAe,CAACrsG,IAAK+rG,IACtBnwH,EAAAA,cAAA,QAAM,+BAA6B,GAAG+zF,QAAM,EAAC3vE,IAAK8rG,IACjDpvH,EAGP,IACM2vH,EAAkBzwH,EAAAA,YAAiB,SACvCD,EACAqkB,GAEA,MAAM6yD,GAAeC,EAAAA,EAAAA,MAErB,OADApqC,EAAAA,EAAAA,qBAAoB1oB,GAAK,IAAM6yD,GAAc,CAACA,IACvC,IACT,IAAG1e,EAAAl4D,aAAA,6L,+CC3DI,MAAM0X,EACXnI,GACmC,MAARA,C,sECuB7B,IAAI/B,EAAe,UACf6iH,EAAkB,G,cClBf,SAAS79C,EAAoBjyE,GAGd,IAHe,OACnCkI,EAAM,cACNoI,GACiBtQ,EACjB,OACEsQ,IAAkBpI,GACjBA,aAAkBioC,aACjB,IAAIjoC,EAAOu3E,YAAYjjB,OAAOpqC,GAAUA,aAAiB+d,aAE/D,CA0DO,SAAS+mD,EAAOtqF,GAOqC,IAPjC,cACzBmlE,EAAgB,EAAC,SACjB36B,EAAQ,YACR+/C,EAAW,OACXC,EAAM,UACNG,EAAS,aACTvlB,EAAeA,MAAM,IACHplE,EAClB,MAAMmjH,GAAclzG,EAAAA,EAAAA,GAAU,CAAEu6E,SAAQG,cA4CxC,OAAOngD,EAAW,CAAC,EAAI,CAAEshB,YA1CJ78C,IACnB,GAAqB,IAAjBA,EAAMw+B,SAAiB23B,EAAan2D,GACtC,OD1DU,YAAV5O,IACF6iH,EAAkB7/E,SAAS2+C,gBAAgB/1E,MAAMm3G,iBACjD//E,SAAS2+C,gBAAgB/1E,MAAMm3G,iBAAmB,QAGpD/iH,EAAQ,WCwDN,MAAM03B,EAAO,CAAEi+B,EAAG/mD,EAAMo0G,MAAOntD,EAAGjnD,EAAMq0G,OACxC,IACI74B,EADA84B,GAAc,EAGlB,MAAMrP,EAAejlG,IACnB,MAAQo0G,MAAOrtD,EAAGstD,MAAOptD,GAAMjnD,EACzBy7E,EAAW,CAAE10B,EAAGA,EAAIj+B,EAAKi+B,EAAGE,EAAGA,EAAIn+B,EAAKm+B,IAE5CrvD,KAAK6+F,IAAIhb,EAAS10B,IAAMmP,GACxBt+D,KAAK6+F,IAAIhb,EAASx0B,IAAMiP,KACFo+C,IACtBA,GAAc,EACd94B,EAAaF,EAAY,CAAExyD,UAEzBwrF,GACFJ,EAAY7/G,QAAQknF,OAAO,CACzBzyD,OACAC,GAAI,CAAEg+B,EAAGj+B,EAAKi+B,EAAI00B,EAAS10B,EAAGE,EAAGn+B,EAAKm+B,EAAIw0B,EAASx0B,GACnDw0B,WACAD,cAEJ,EAEFpnD,SAAS08B,iBAAiB,YAAam0C,GAEvC7wE,SAAS08B,iBACP,WACA,KD7EU,aAAV1/D,IAIJA,EAAQ,YAIR+F,YAAW,MAGTo9G,EAAAA,EAAAA,IAAmB,KAEH,cAAVnjH,IACsD,SAApDgjC,SAAS2+C,gBAAgB/1E,MAAMm3G,mBACjC//E,SAAS2+C,gBAAgB/1E,MAAMm3G,iBAC7BF,GAAmB,IAGvBA,EAAkB,GAClB7iH,EAAQ,UACV,GACA,GACD,MCwDOkjH,GACFJ,EAAY7/G,QAAQqnF,YAAY,CAAEF,eAEpCpnD,SAASusC,oBAAoB,YAAaskC,EAAY,GAExD,CAAEl0C,MAAM,GACT,EAGL,C,+BCnHO,SAAS6J,EAAentE,GAC7B,OAAOA,EAAE4W,QAAU5W,EAAEs5F,SAAWt5F,EAAEu5F,SAAWv5F,EAAEy9G,QACjD,C,wFCOO,MAAMsJ,EAUXn1C,WAAAA,CAAoBo1C,GAAqC,KAArCA,SAAAA,EAAkC,KAT9C91B,sBAAgB,OAChB92E,KAMJ,IAAIW,IAGN+2D,KAAKof,iBAAmB,IAAIC,kBAAkB81B,IAC5CA,EAAUjtH,SAASktH,IACjB,MAAMtoH,EAASsoH,EAAStoH,OAClBA,aAAkBuI,UAGxB+/G,EAASC,aAAantH,SAASkhB,IACzBA,aAAgB/T,SAClB2qE,KAAK13D,KAAK9Z,IAAI1B,IAASwoH,qBAAqB1a,UAAUxxF,EACxD,IAEFgsG,EAASG,WAAWrtH,SAASkhB,IACvBA,aAAgB/T,SAClB2qE,KAAK13D,KAAK9Z,IAAI1B,IAASwoH,qBAAqBl3B,QAAQh1E,EACtD,IACA,GACF,GAEN,CAEAg1E,OAAAA,CAAQtxF,EAAiBlD,GACvBo2E,KAAK13D,KAAK9Z,IAAI1B,IAASwoH,qBAAqB91B,aAE5C,MAAM81B,EAAuB,IAAIE,sBAC9BzgG,IACC,MAAMzM,EAAO03D,KAAK13D,KAAK9Z,IAAI1B,GACrB2oH,EAAoB1gG,EACvBltB,KAAK45B,IACHA,EAAMi0F,gBAAkBj0F,EAAM30B,kBAAkBuI,QAC7CosB,EAAM30B,YACNse,IAELnV,OAAO8F,EAAAA,GACJ45G,EAAqB5gG,EACxBltB,KAAK45B,GACJA,EAAMi0F,gBAAkBj0F,EAAM30B,kBAAkBuI,QAC5CosB,EAAM30B,OACN,OAELmJ,OAAO8F,EAAAA,GAGJ65G,EACJttG,GAAMutG,yBAA2B,GAC7BlpB,EAAqBipB,EACxB3/G,QAAQsW,IAAaopG,EAAmB9iH,SAAS0Z,KACjDhlB,OAAOkuH,GACPx/G,QAAQsW,KAILA,aAAmBwoB,aACK,IAAxBxoB,EAAQ05C,aACiB,IAAzB15C,EAAQqnE,gBAGd5T,KAAKk1C,SACH,CACEU,+BACAjpB,mBAAoBA,EACpB7/F,UAEFkzE,MAEE13D,IACFA,EAAKutG,wBAA0BlpB,EACjC,GAEF,IACK/iG,EACH2f,KAAMzc,IAGV,IAAKA,GAAQhI,UAAY,IAAKoD,SAAS4tH,IACrCR,EAAqBl3B,QAAQ03B,EAAa,IAE5C91C,KAAK13D,KAAK3Z,IAAI7B,EAAQ,CACpBwoH,uBACAO,wBAAyB,KAE3B71C,KAAKof,iBAAiBhB,QAAQtxF,EAAQ,CACpCyyF,WAAW,GAEf,CAEAqb,SAAAA,CAAU9tG,GACRkzE,KAAK13D,KAAK9Z,IAAI1B,IAASwoH,qBAAqB91B,YAC9C,CAEAA,UAAAA,GACE,IAAIxf,KAAK13D,KAAKvgB,UAAUG,SAAQtD,IAAA,IAAC,qBAAE0wH,GAAsB1wH,EAAA,OACvD0wH,EAAqB91B,YAAY,IAEnCxf,KAAK13D,KAAO,IAAIW,IAChB+2D,KAAKof,iBAAiBI,YACxB,EC1HK,SAASoN,EACdmpB,EAA8CjnH,GAK7C,IAJD,UACEi9F,EAAY,GAAG,WACfiqB,EAAa,YAC0B,IAAAlnH,EAAG,CAAC,EAACA,EAE9C,MAAO69F,EAAoBspB,IAAyBjtH,EAAAA,EAAAA,UAAoB,IAsBxE,OApBAiJ,EAAAA,EAAAA,YAAU,KACR,MAAMikH,EAAmB,IAAIjB,GAAkB3hG,IAC7C2iG,EAAsB3iG,EAAOq5E,mBAAmB,IAMlD,OAJAupB,EAAiB93B,QAAQ23B,EAAuBjhH,QAAU,CACxDkhH,aACAjqB,cAEK,KACLmqB,EAAiB12B,YAAY,CAC9B,GACA,CAMDu2B,EAAuBjhH,UAGlB,CACL63F,qBAEJ,C,qFCzBO,MAAMxwE,EAAmBA,CAM9B5E,EAIA0G,EACApiB,KAEA,MAAM5T,EAAc4T,EAAMhU,IAAIo2B,GACxBk4F,EAAe/sG,IACnB,MAAMtkB,EAAWskB,EAAOmO,EAAYnO,GAAQ,KAChC,MAARA,GAAiBtkB,IAGrBmD,EAAK6L,KAAKmqB,EAAO7U,IACjBtkB,EAASoD,QAAQiuH,GAAY,EAG/B,OADAt6G,EAAMhU,IAAI0vB,GAAatC,OAAO/sB,QAAQiuH,GAC/BluH,CAAI,EAGAi0B,EAAyBA,CAMpC3E,EAIA0G,EACApiB,EACAu6G,KAEA,MAAMC,EAAmB,IAAIv6G,IAAIs6G,GAC3BvsG,EAAsB,GAe5B,OAdA0S,EACEhF,GACA,CAACnO,EAAMktG,KACL,MAAMnuH,EAAM81B,EAAO7U,GACb4mE,EACJsmC,GAAax6F,MAAMy6F,GAAeA,KAClCF,EAAiBx4F,IAAI11B,GAIvB,OAHI6nF,GACFnmE,EAAa/V,KAAK3L,GAEb6nF,CAAU,GAEnBn0E,GAEKgO,CAAY,EAGR0S,EAAWA,CACtBhF,EACAs1F,EACAhxG,KAEA,MAAM26G,EAAOptG,IACX,MAAMtkB,EAAWyyB,EAAYnO,GACvBrhB,EAASjD,GAAU+C,IAAI2uH,IAAQ,KACrC,OAAO3J,EAAMzjG,EAAMrhB,EAAO,EAE5B8T,EAAM3T,QAAQsuH,EAAI,EAGPt5F,EAAWA,CACtB3F,EACAs1F,EACAhxG,KAEA,MAAM46G,EAAoBA,CAACrtG,EAAM+T,KAC/B,MAAM7gB,EAASuwG,EAAMzjG,EAAM+T,GACrBr4B,EAAWyyB,EAAYnO,GAE7B,OADAtkB,GAAU+C,KAAK6uH,GAAcD,EAAIC,EAAWp6G,KACrCA,CAAM,EAEf,OAAOT,EAAMhU,KAAK0hB,GAASktG,EAAIltG,EAAM,OAAM,EAGhCgwB,EAAuBA,CAClCo9E,EACAppF,KAEA,MAAMqpF,EAAYA,CAAC3qG,EAAMmI,KACvB,MAAMyiG,EAAKF,EAAG1qG,GACR6qG,EAAKH,EAAGviG,GACd,OAAOyiG,EAAKC,GAAM,EAAID,EAAKC,EAAK,EAAI,CAAC,EAEvCvpF,EAAK1xB,MAAM4N,KAAKmtG,GAChB15F,EACEqQ,EAAKhW,aACJnO,IACC,MAAMtkB,EAAWyoC,EAAKhW,YAAYnO,GAC9BtkB,GACFA,EAAS2kB,KAAKmtG,EAChB,GAEFrpF,EAAK1xB,MACN,C,8DCvHI,MAAMu2E,EAAoBA,CAC/B2kC,EACAC,KAEA,MAAMx2G,GAAU8M,EAAAA,EAAAA,YAA+BypG,GAE/C,GAAe,MAAXv2G,EACF,MAAM,IAAInS,MAAM2oH,GAGlB,OAAOx2G,CAAO,C,8DCLT,SAAS8mB,EAAoDh7B,GAClE,IAAI8b,GAAMvT,EAAAA,EAAAA,WACV3L,EAAAA,EAAAA,kBAAgB,KACdkf,EAAItT,QAAUxI,CAAE,IAIlB,OAAOk+D,EAAAA,EAAAA,cAFW,mBAAAr+B,EAAA7Q,UAAAjnB,OAAIsG,EAAI,IAAArB,MAAA6yB,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAJ1xB,EAAI0xB,GAAA/Q,UAAA+Q,GAAA,OACxBjkB,EAAItT,SAASkwE,MAAM,KAAMrqE,EAAK,GACA,GAClC,C,+DCCO,SAAS4mF,EAAiBzyF,GAUxB,IAVyB,aAChCmxG,EAAY,wBACZC,GAA0B,QAQ3B,IAAApxG,EAAG,CAAC,EAACA,EA2BJ,MAAO,CAAEwyF,oBAAqB,CAAErsF,QA1BIwL,IAClC,GAAIA,EAAM3T,SAAW2T,EAAMvL,cAEzB,OAEF,MAAM+hH,EAAyBx2G,EAAMrL,cAEnC6hH,aAAkC5hH,SAClCoL,EAAMvL,eAAeggF,SAAS+hC,KAC7B/W,EAIG+W,aAAkCliF,aACpCkiF,EAAuBz/G,QAIvByoG,EACFA,KAGEiX,EAAAA,EAAAA,IAAuBz2G,EAAMvL,eAAeq4G,cAC3C/1G,OACL,GAGJ,C,8DC/Ce,SAASquE,EACtBtvB,GAEA,MAAM4gE,GAAWtiH,EAAAA,EAAAA,QAAU,MAc3B,OAbA7Q,EAAAA,WAAgB,KACTuyD,IAIuB,mBAAjBA,EACTA,EAAa4gE,EAASriH,SAErByhD,EAAkDzhD,QACjDqiH,EAASriH,QACb,IAGKqiH,CACT,C,6DCvBO,SAAS11G,EAAarZ,GAC3B,MAAMggB,GAAMvT,EAAAA,EAAAA,QAAOzM,GAInB,OAHAc,EAAAA,EAAAA,kBAAgB,KACdkf,EAAItT,QAAU1M,CAAK,IAEdggB,CACT,C,8DCNO,SAASw/C,EAAex/D,GAC7B,MAAMggB,GAAMvT,EAAAA,EAAAA,QAAOzM,GAInB,OAHA6J,EAAAA,EAAAA,YAAU,KACRmW,EAAItT,QAAU1M,CAAK,GAClB,CAACA,IACGggB,EAAItT,OACb,C,wFCkDGy3G,OAAOC,SA1DH,MAAM4K,EAIXt3C,WAAAA,CAAY/3E,GAAsB,KAHzB+I,UAAI,OACInC,SAAG,EAGlBqxE,KAAKrxE,IAAM,IAAImN,IAAI/T,GACnBi4E,KAAKlvE,KAAOkvE,KAAKrxE,IAAImC,IACvB,CAEA2rB,GAAAA,GAAqC,IAAD,IAAA0P,EAAA7Q,UAAAjnB,OAA7BnH,EAAK,IAAAoM,MAAA6yB,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAALn/B,EAAKm/B,GAAA/Q,UAAA+Q,GACV,OAAO2zC,KAAKq3C,sBAAsBvsF,IAChC59B,EAAMhF,SAAS0L,IACbk3B,EAASrO,IAAI7oB,EAAK,GAClB,GAEN,CAEA+9D,SAAwC,IAAD,IAAAtS,EAAA/jC,UAAAjnB,OAA7BnH,EAAK,IAAAoM,MAAA+lD,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAALpyD,EAAKoyD,GAAAhkC,UAAAgkC,GACb,OAAO0gB,KAAKq3C,sBAAsBvsF,IAChC59B,EAAMhF,SAAS0L,IACbk3B,EAAS6mC,OAAO/9D,EAAK,GACrB,GAEN,CAEA+xB,MAAAA,GAAwC,IAAD,IAAA2xF,EAAAh8F,UAAAjnB,OAA7BnH,EAAK,IAAAoM,MAAAg+G,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAALrqH,EAAKqqH,GAAAj8F,UAAAi8F,GACb,OAAOv3C,KAAKq3C,sBAAsBvsF,IAChC59B,EAAMhF,SAAS0L,IACRk3B,EAAS6mC,OAAO/9D,IACnBk3B,EAASrO,IAAI7oB,EACf,GACA,GAEN,CAEA+hF,KAAAA,GACE,OAAO3V,KAAKq3C,sBAAsBvsF,IAChCA,EAAS6qD,OAAO,GAEpB,CAEQ0hC,oBAAAA,CACNG,GAEA,MAAM1sF,EAAW,IAAIhvB,IAAIkkE,KAAKrxE,KAE9B,OADA6oH,EAAO1sF,GACA,IAAIssF,EAAatsF,EAC1B,CAGA5iC,OAAAA,GACE,OAAO83E,KAAKrxE,IAAIzG,WAAQozB,UAC1B,CAEAuC,GAAAA,CAAIz1B,GACF,OAAO43E,KAAKrxE,IAAIkvB,IAAIz1B,EACtB,CAEA,CAAA4kH,KACE,OAAOhtC,KAAKrxE,IAAI49G,OAAOC,WACzB,CAEAz3F,OAAAA,GACE,OAAOirD,KAAKrxE,IAAIomB,SAClB,CAEA9sB,IAAAA,GACE,OAAO+3E,KAAKrxE,IAAI1G,MAClB,CAEAF,MAAAA,GACE,OAAOi4E,KAAKrxE,IAAI5G,QAClB,EC/DK,MAAMi2B,EACXrvB,IAAmD,CAEnD8tB,IAAK,mBAAA0P,EAAA7Q,UAAAjnB,OAAItM,EAAM,IAAAuR,MAAA6yB,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAANtkC,EAAMskC,GAAA/Q,UAAA+Q,GAAA,OACb19B,GACGoG,GAAiB,IAAI+G,IAAI,IAAIs7G,EAAariH,GAAc0nB,OAAO10B,KACjE,EACH4pE,OAAQ,mBAAAtS,EAAA/jC,UAAAjnB,OAAItM,EAAM,IAAAuR,MAAA+lD,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAANv3D,EAAMu3D,GAAAhkC,UAAAgkC,GAAA,OAChB3wD,GACGoG,GACC,IAAI+G,IAAI,IAAIs7G,EAAariH,GAAc48D,UAAU5pE,KACpD,EACH4tF,MAAOA,IACLhnF,GAAKoG,GAAiB,IAAI+G,IAAI,IAAIs7G,EAAariH,GAAc4gF,WAC/DhwD,OAAQ,mBAAA2xF,EAAAh8F,UAAAjnB,OAAItM,EAAM,IAAAuR,MAAAg+G,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAANxvH,EAAMwvH,GAAAj8F,UAAAi8F,GAAA,OAChB5oH,GACGoG,GACC,IAAI+G,IAAI,IAAIs7G,EAAariH,GAAc4wB,UAAU59B,KACpD,IAGL,SAAS0vH,EACP/iH,GAEA,OAAOiT,EAAAA,EAAAA,UAAQ,IAAMqW,EAAmBtpB,IAAW,CAACA,GACtD,CAMO,MAAM+8G,EAAqB,SAChChrD,EACAj0D,EACAgU,QADoB,IAApBhU,IAAAA,EAAuB,IAAIsJ,KAG3B,MAAO1T,EAAOsM,IAAYkyD,EAAAA,EAAAA,GACxBH,EACAj0D,EACAgU,GAIF,MAAO,CAACpe,EAAOqvH,EAAqB/iH,GACtC,C,kBCrDA,IAAI7M,EAAM,CACT,iBAAkB,MAClB,oBAAqB,OAGtB,SAAS6vH,EAAoBC,GAC5B,OAAOpsH,QAAQC,UAAUoE,MAAK,KAC7B,IAAIgoH,EAAoBC,EAAEhwH,EAAK8vH,GAAM,CACpC,IAAIzpH,EAAI,IAAIG,MAAM,uBAAyBspH,EAAM,KAEjD,MADAzpH,EAAEC,KAAO,mBACHD,CACP,CAGA,OAAO0pH,EADE/vH,EAAI8vH,GACiB,GAEhC,CACAD,EAAoBzvH,KAAO,IAAOD,OAAOC,KAAKJ,GAC9C6vH,EAAoBp1G,GAAK,MACzBw1G,EAAOC,QAAUL,C,kBCnBjB,IAAI7vH,EAAM,CACT,kBAAmB,CAClB,OAED,qBAAsB,CACrB,OAED,uBAAwB,CACvB,OAED,0BAA2B,CAC1B,OAED,iBAAkB,CACjB,OAED,oBAAqB,CACpB,OAED,qBAAsB,CACrB,OAED,wBAAyB,CACxB,OAED,uBAAwB,CACvB,OAED,0BAA2B,CAC1B,OAED,mBAAoB,CACnB,OAED,sBAAuB,CACtB,OAED,4BAA6B,CAC5B,OAED,+BAAgC,CAC/B,OAED,qBAAsB,CACrB,OAED,wBAAyB,CACxB,OAED,4BAA6B,CAC5B,OAED,+BAAgC,CAC/B,OAED,oBAAqB,CACpB,OAED,uBAAwB,CACvB,OAED,0BAA2B,CAC1B,OAED,6BAA8B,CAC7B,OAED,sBAAuB,CACtB,OAED,yBAA0B,CACzB,OAED,sBAAuB,CACtB,OAED,yBAA0B,CACzB,OAED,6BAA8B,CAC7B,MAED,gCAAiC,CAChC,MAED,UAAW,CACV,OAED,aAAc,CACb,OAED,iBAAkB,CACjB,OAED,oBAAqB,CACpB,OAED,oBAAqB,CACpB,OAED,uBAAwB,CACvB,OAED,sBAAuB,CACtB,OAED,yBAA0B,CACzB,OAED,kCAAmC,CAClC,OAED,qCAAsC,CACrC,OAED,0BAA2B,CAC1B,OAED,6BAA8B,CAC7B,OAED,iCAAkC,CACjC,OAED,oCAAqC,CACpC,OAED,qCAAsC,CACrC,OAED,wCAAyC,CACxC,OAED,yCAA0C,CACzC,MACA,MAED,4CAA6C,CAC5C,MACA,MAED,8BAA+B,CAC9B,OAED,iCAAkC,CACjC,OAED,4BAA6B,CAC5B,OAED,+BAAgC,CAC/B,OAED,iBAAkB,CACjB,OAED,oBAAqB,CACpB,OAED,wBAAyB,CACxB,OAED,2BAA4B,CAC3B,OAED,gCAAiC,CAChC,OAED,mCAAoC,CACnC,QAGF,SAAS6vH,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEhwH,EAAK8vH,GAC9B,OAAOpsH,QAAQC,UAAUoE,MAAK,KAC7B,IAAI1B,EAAI,IAAIG,MAAM,uBAAyBspH,EAAM,KAEjD,MADAzpH,EAAEC,KAAO,mBACHD,CAAC,IAIT,IAAI8pH,EAAMnwH,EAAI8vH,GAAMr1G,EAAK01G,EAAI,GAC7B,OAAOzsH,QAAQiF,IAAIwnH,EAAI9hH,MAAM,GAAGrO,IAAI+vH,EAAoB1pH,IAAI0B,MAAK,IACzDgoH,EAAoBt1G,IAE7B,CACAo1G,EAAoBzvH,KAAO,IAAOD,OAAOC,KAAKJ,GAC9C6vH,EAAoBp1G,GAAK,MACzBw1G,EAAOC,QAAUL,C","sources":["webpack://website/../example-app/src/resources/loading.gif","webpack://website/../example-app/src/LoadingGif.tsx","webpack://website/../example-app/src/resources/loading_dark.gif","webpack://website/../example-app/src/DefaultSuspense.tsx","webpack://website/../example-app/src/file-utils.tsx","webpack://website/../example-app/src/Editor/useEditorTheme.ts","webpack://website/../example-app/src/Editor/Editor.tsx","webpack://website/../example-app/src/fs/browser-fs.tsx","webpack://website/../example-app/src/fs/fs-utils.ts","webpack://website/../example-app/src/fs/fs.tsx","webpack://website/../example-app/src/fs/fs.state.ts","webpack://website/../example-app/src/recoil-utils.ts","webpack://website/../example-app/src/Project/project-utils.ts","webpack://website/../example-app/src/Project/project.state.ts","webpack://website/../example-app/src/Editor/editor.state.ts","webpack://website/../example-app/src/VersionControl/file-status.ts","webpack://website/../example-app/src/ensureArray.ts","webpack://website/../example-app/src/Project/persistence/persistentAtomEffect.ts","webpack://website/../example-app/src/VersionControl/file-status.state.ts","webpack://website/../example-app/src/VersionControl/FileStatusColor.tsx","webpack://website/../example-app/src/Project/notImplemented.tsx","webpack://website/../example-app/src/Editor/EditorZeroState.tsx","webpack://website/../example-app/src/appActionIds.ts","webpack://website/../example-app/src/Editor/editorActionIds.ts","webpack://website/../example-app/src/Editor/useEditorActionGroup.tsx","webpack://website/../example-app/src/Editor/FileEditor.tsx","webpack://website/../example-app/src/Terminal/Terminal.tsx","webpack://website/../example-app/src/ProjectView/ProjectView.state.ts","webpack://website/../example-app/src/Project/projectActionIds.ts","webpack://website/../example-app/src/ProjectView/ProjectViewContextMenu.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewPane.tsx","webpack://website/../example-app/src/HelpButton.tsx","webpack://website/../example-app/src/path-utils.ts","webpack://website/../example-app/src/Project/fs-operations.ts","webpack://website/../example-app/src/ProjectView/actions/deleteAction.tsx","webpack://website/../example-app/src/ProjectView/actions/copyAction.tsx","webpack://website/../example-app/src/ProjectView/actions/cutAction.tsx","webpack://website/../example-app/src/ProjectView/actions/pasteAction.tsx","webpack://website/../example-app/src/ProjectView/ProjectToolWindow.tsx","webpack://website/../example-app/src/ProjectView/ProjectViewActionIds.ts","webpack://website/../example-app/src/Delayed.tsx","webpack://website/../example-app/src/VersionControl/Changes/Change.ts","webpack://website/../example-app/src/VersionControl/Changes/changes.state.ts","webpack://website/../example-app/src/VersionControl/Changes/change-lists.state.ts","webpack://website/../example-app/src/tree-utils/groupByDirectory.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/ChangeTreeNode.ts","webpack://website/../example-app/src/VersionControl/VcsActionIds.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesGroupings.ts","webpack://website/../example-app/src/VersionControl/Changes/Rollback/rollbackView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodesResult.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesView.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewTreeContextMenu.tsx","webpack://website/../example-app/src/async-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-utils.ts","webpack://website/../example-app/src/VersionControl/Branches/branches.state.ts","webpack://website/../example-app/src/VersionControl/RepoCurrentBranchName.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledRepoColorSquare.tsx","webpack://website/../example-app/src/VersionControl/Changes/StyledCurrentBranchTag.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesTree/changesTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/changesViewTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangeViewTree.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangeListsActionButton.tsx","webpack://website/../example-app/src/GroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ChangesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ActionButtons/ViewOptionsActionButton.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewToolbar.tsx","webpack://website/../example-app/src/tasks.ts","webpack://website/../example-app/src/VersionControl/refs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DateRange.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/vcs-logs.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/readCommits.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.state.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/commit-utils.ts","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitView.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesSummary.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/CommitActionsRow.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/useChangesViewActions.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewSplitter.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewZeroState.tsx","webpack://website/../example-app/src/VersionControl/Changes/ChangesView/ChangesViewPane.tsx","webpack://website/../example-app/src/VersionControl/TrackingBranchInfo.tsx","webpack://website/../example-app/src/VersionControl/CommitToolWindow.tsx","webpack://website/../example-app/src/UNSAFE_FocusRestoringSuspense.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/styled-components.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/commit-utils.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/commitChangesTreeNodeRenderer.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/getCommitChanges.tsx","webpack://website/../example-app/src/VersionControl/Changes/detectRenames.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitChanges/CommitsChangedFiles.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/RefLabel.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/CommitDetails.tsx","webpack://website/../example-app/src/useRedefineAction.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/DetailsView/VcsLogDetailsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogDropdown.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchFavoriteButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/BranchesFilterDropdown.tsx","webpack://website/../example-app/src/VersionControl/git-users.state.ts","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableRow.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTable.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/CommitsTableViewOptionsMenuIconButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/VcsLogCommitsView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.state.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesGroupByActionButton.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/branchTreeNodeRenderers.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/BranchesTree.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/BranchesView/VcsBranchesView.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/CommitsView/useCommitsTableActions.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindowZeroState.tsx","webpack://website/../example-app/src/VersionControl/VersionControlToolWindow/VersionControlToolWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.state.ts","webpack://website/../example-app/src/StatusBar/TasksPopup.tsx","webpack://website/../example-app/src/StatusBar/StatusBarTaskProgressBar.tsx","webpack://website/../example-app/src/VersionControl/active-file.state.ts","webpack://website/../example-app/src/VersionControl/Branches/branch-name-utils.tsx","webpack://website/../example-app/src/VersionControl/Branches/RenameBranchWindow.tsx","webpack://website/../example-app/src/VersionControl/Branches/BranchesPopup.tsx","webpack://website/../example-app/src/VersionControl/useShowGitTipIfNeeded.tsx","webpack://website/../example-app/src/StatusBar/BranchPopupTrigger.tsx","webpack://website/../example-app/src/StatusBar/IdeStatusBar.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackTreeContextMenu.tsx","webpack://website/../example-app/src/VersionControl/Changes/Rollback/RollbackWindow.tsx","webpack://website/../example-app/src/Project/toolWindows.state.ts","webpack://website/../example-app/src/SearchEverywhere/useTips.tsx","webpack://website/../example-app/src/SearchEverywhere/Input.tsx","webpack://website/../example-app/src/SearchEverywhere/searchEverywhere.state.tsx","webpack://website/../example-app/src/SearchEverywhere/ContentAwarePopup.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/ItemHelpers.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/ActionItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/action/actionsSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/FileItem.tsx","webpack://website/../example-app/src/SearchEverywhere/contributors/file/filesSearchContributor.tsx","webpack://website/../example-app/src/SearchEverywhere/SearchEverywhereActionIds.ts","webpack://website/../example-app/src/SearchEverywhere/SearchEverywherePopup.tsx","webpack://website/../example-app/src/VersionControl/gitAddCallback.tsx","webpack://website/../example-app/src/Project/actions/NewItemPopup.tsx","webpack://website/../example-app/src/Project/actions/createFileAction.tsx","webpack://website/../example-app/src/useCancelableAsyncCallback.ts","webpack://website/../example-app/src/Project/actions/createDirectoryAction.tsx","webpack://website/../example-app/src/Project/actions/copyFilename.tsx","webpack://website/../example-app/src/Project/actions/copyAbsolutePath.tsx","webpack://website/../example-app/src/VersionControl/actions/copyPathFromRepositoryRoot.tsx","webpack://website/../example-app/src/Project/useProjectActions.tsx","webpack://website/../example-app/src/Project/useToolWindowManager.ts","webpack://website/../example-app/src/VersionControl/Changes/useChangesViewActionDefinitions.tsx","webpack://website/../example-app/src/VersionControl/Branches/CreateNewBranchWindow.tsx","webpack://website/../example-app/src/createAction.tsx","webpack://website/../example-app/src/VersionControl/actions/gitAddAction.tsx","webpack://website/../example-app/src/VersionControl/actions/gitInitAction.tsx","webpack://website/../example-app/src/VersionControl/gitRememberedInputs.state.ts","webpack://website/../example-app/src/ProjectInitializer.tsx","webpack://website/../example-app/src/VersionControl/actions/getInputCursorOffset.ts","webpack://website/../example-app/src/VersionControl/actions/PathInputField.tsx","webpack://website/../example-app/src/VersionControl/actions/gitCloneAction.tsx","webpack://website/../example-app/src/VersionControl/useClone.ts","webpack://website/../example-app/src/VersionControl/useVcsActions.tsx","webpack://website/../example-app/src/Project/persistence/PersistentStateProvider.tsx","webpack://website/../example-app/src/testActions/useTestActions.ts","webpack://website/../example-app/src/Project/Project.tsx","webpack://website/../example-app/src/usePersistenceFsNotification.tsx","webpack://website/../example-app/src/exampleAppKeymap.ts","webpack://website/../example-app/src/App.tsx","webpack://website/../jui/src/ActionSystem/ActionGroup.tsx","webpack://website/../jui/src/ActionSystem/ActionShortcut.tsx","webpack://website/../jui/src/ActionSystem/useShortcut.ts","webpack://website/../jui/src/ActionSystem/ActionsProvider.tsx","webpack://website/../jui/src/ActionSystem/CommonActionIds.ts","webpack://website/../jui/src/ActionSystem/KeymapProvider.tsx","webpack://website/../jui/src/ActionSystem/Shortcut.ts","webpack://website/../jui/src/ActionSystem/components/ActionButton.tsx","webpack://website/../jui/src/ActionSystem/components/ActionGroupMenu.tsx","webpack://website/../jui/src/ActionSystem/components/ActionsMenu.tsx","webpack://website/../jui/src/ActionSystem/components/useCreateDefaultActionGroup.tsx","webpack://website/../jui/src/ActionSystem/defaultKeymap.tsx","webpack://website/../jui/src/ActionSystem/shortcutToString.ts","webpack://website/../jui/src/ActionSystem/useActionGroup.tsx","webpack://website/../jui/src/AlertDialog/AlertDialog.tsx","webpack://website/../jui/src/AlertDialog/useAlertDialog.tsx","webpack://website/../jui/src/Balloon/Balloon.styled.tsx","webpack://website/../jui/src/Balloon/Balloon.tsx","webpack://website/../jui/src/Balloon/BalloonManager.tsx","webpack://website/../jui/src/Balloon/StyledBalloonsStack.tsx","webpack://website/../jui/src/Button/BareButton.tsx","webpack://website/../jui/src/Button/StyledButton.tsx","webpack://website/../jui/src/Button/Button.tsx","webpack://website/../jui/src/ButtonGroup/ButtonGroup.tsx","webpack://website/../jui/src/Checkbox/Checkbox.tsx","webpack://website/../jui/src/Checkbox/CheckboxIcon.tsx","webpack://website/../jui/src/CollectionSpeedSearch/CollectionSpeedSearchContext.tsx","webpack://website/../jui/src/CollectionSpeedSearch/HighlightedTextValue.tsx","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearchResult.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchSelectionManager.ts","webpack://website/../jui/src/CollectionSpeedSearch/useCollectionSpeedSearch.ts","webpack://website/../jui/src/CollectionSpeedSearch/createSpeedSearchKeyboardDelegate.ts","webpack://website/../jui/src/Collections/Divider.ts","webpack://website/../jui/src/Collections/Item.ts","webpack://website/../jui/src/Collections/ItemLayout.tsx","webpack://website/../jui/src/Collections/ItemStateContext.tsx","webpack://website/../jui/src/Collections/useCollectionAutoScroll.ts","webpack://website/../jui/src/Collections/useCollectionFocusProxy.ts","webpack://website/../jui/src/Dropdown/ComboBox.tsx","webpack://website/../jui/src/Dropdown/ListBox.tsx","webpack://website/../jui/src/Dropdown/StatelessListBox.tsx","webpack://website/../jui/src/Dropdown/StyledContainer.tsx","webpack://website/../jui/src/Dropdown/StyledDropdownArrowIcon.tsx","webpack://website/../jui/src/Field/ContextHelp.tsx","webpack://website/../jui/src/Field/Label.tsx","webpack://website/../jui/src/Icon/AutoHoverPlatformIcon.tsx","webpack://website/../jui/src/Icon/LafIcon.tsx","webpack://website/../jui/src/Icon/PlatformIcon.tsx","webpack://website/../jui/src/Icon/StyledIconWrapper.tsx","webpack://website/../jui/src/Icon/useSvgIcon.tsx","webpack://website/../jui/src/IconButton/IconButton.tsx","webpack://website/../jui/src/IconButtonWithMenu/IconButtonWithMenu.tsx","webpack://website/../jui/src/Img.tsx","webpack://website/../jui/src/InputField/Input.tsx","webpack://website/../jui/src/InputField/InputField.tsx","webpack://website/../jui/src/Link/StyledLink.tsx","webpack://website/../jui/src/Link/Link.tsx","webpack://website/../jui/src/List/List.tsx","webpack://website/../jui/src/List/ListContext.tsx","webpack://website/../jui/src/List/ListDivider.tsx","webpack://website/../jui/src/List/ListItem.tsx","webpack://website/../jui/src/List/StyledList.tsx","webpack://website/../jui/src/List/StyledListItem.tsx","webpack://website/../jui/src/List/useList.ts","webpack://website/../jui/src/List/useSelectableList.ts","webpack://website/../jui/src/List/useListState.ts","webpack://website/../jui/src/Collections/useCollectionRef.ts","webpack://website/../jui/src/List/StyledListSectionHeader.tsx","webpack://website/../jui/src/List/renderWrapper.tsx","webpack://website/../jui/src/List/useListVirtualizer.tsx","webpack://website/../jui/src/Menu/ContextMenuContainer.tsx","webpack://website/../jui/src/Menu/useContextMenu.tsx","webpack://website/../jui/src/Collections/patchCollectionProps.tsx","webpack://website/../jui/src/Menu/Menu.tsx","webpack://website/../jui/src/Menu/MenuItem.tsx","webpack://website/../jui/src/Menu/MenuItemLayout.tsx","webpack://website/../jui/src/Menu/MenuOverlay.tsx","webpack://website/../jui/src/Menu/useOverlayPositionFromOrigin.tsx","webpack://website/../jui/src/Menu/MenuOverlayFromOrigin.tsx","webpack://website/../jui/src/Menu/MenuTrigger.tsx","webpack://website/../jui/src/Menu/SpeedSearchMenu.tsx","webpack://website/../jui/src/Menu/StyledMenu.tsx","webpack://website/../jui/src/Menu/StyledMenuItem.tsx","webpack://website/../jui/src/Menu/Submenu.tsx","webpack://website/../jui/src/Menu/_useSubmenu.ts","webpack://website/../jui/src/Menu/_useSubmenuState.tsx","webpack://website/../jui/src/Menu/MenuSection.tsx","webpack://website/../jui/src/Menu/renderMenuNodes.tsx","webpack://website/../jui/src/Mnemonic/MnemonicTrigger.tsx","webpack://website/../jui/src/Overlay/UNSAFE_React17SuspenseFix.tsx","webpack://website/../jui/src/ModalWindow/ModalWindow.tsx","webpack://website/../jui/src/ModalWindow/WindowContext.ts","webpack://website/../jui/src/ModalWindow/WindowFooter.tsx","webpack://website/../jui/src/ModalWindow/WindowHeader.tsx","webpack://website/../jui/src/ModalWindow/WindowLayout.tsx","webpack://website/../jui/src/ModalWindow/WindowManager.tsx","webpack://website/../jui/src/Overlay/Overlay.tsx","webpack://website/../jui/src/Overlay/OverlayInteractionHandler.tsx","webpack://website/../jui/src/Overlay/OverlayMoveHandle.tsx","webpack://website/../jui/src/Overlay/OverlayResizeHandles.tsx","webpack://website/../jui/src/Overlay/Popover.tsx","webpack://website/../jui/src/Overlay/bounds-helpers.tsx","webpack://website/../jui/src/utils/useDebounce.ts","webpack://website/../jui/src/Overlay/useContentSize.tsx","webpack://website/../jui/src/Overlay/useResizableMovableOverlay.tsx","webpack://website/../jui/src/Popup/Popup.tsx","webpack://website/../jui/src/Popup/_useDialog.ts","webpack://website/../jui/src/utils/mergeNonNullProps.tsx","webpack://website/../jui/src/Popup/PopupContext.tsx","webpack://website/../jui/src/Popup/PopupHeader.tsx","webpack://website/../jui/src/Popup/PopupLayout.tsx","webpack://website/../jui/src/Popup/PopupManager.tsx","webpack://website/../jui/src/Popup/PopupTrigger.tsx","webpack://website/../jui/src/Popup/StyledPopupContainer.tsx","webpack://website/../jui/src/Popup/StyledPopupHint.tsx","webpack://website/../jui/src/ProgressBar/ProgressBar.tsx","webpack://website/../jui/src/ProgressBar/ProgressBarStopButton.tsx","webpack://website/../jui/src/ResizableView.tsx","webpack://website/../jui/src/Resizer/BottomResizer.tsx","webpack://website/../jui/src/Resizer/HorizontalResizer.tsx","webpack://website/../jui/src/Resizer/LeftResizer.tsx","webpack://website/../jui/src/Resizer/RightResizer.tsx","webpack://website/../jui/src/Resizer/TopResizer.tsx","webpack://website/../jui/src/Resizer/VerticalResizer.tsx","webpack://website/../jui/src/Resizer/useResizer.ts","webpack://website/../jui/src/SearchInput/SearchInput.tsx","webpack://website/../jui/src/SpeedSearch/SpeedSearchInput.tsx","webpack://website/../jui/src/SpeedSearch/SpeedSearchPopup.tsx","webpack://website/../jui/src/SpeedSearch/useGhostInput.tsx","webpack://website/../jui/src/SpeedSearch/useSpeedSearch.tsx","webpack://website/../jui/src/StatusBar/StatusBar.tsx","webpack://website/../jui/src/StatusBar/StatusBarWidget.tsx","webpack://website/../jui/src/StyledSeparator.tsx","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabContent.tsx","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTab.ts","webpack://website/../jui/src/Tabs/EditorTabs/StyledEditorTabs.ts","webpack://website/../jui/src/Tabs/EditorTabs/EditorTabs.tsx","webpack://website/../jui/src/Tabs/StyledDefaultTab.ts","webpack://website/../jui/src/Tabs/StyledDefaultTabs.ts","webpack://website/../jui/src/Tabs/TabCloseButton.tsx","webpack://website/../jui/src/Tabs/TabContentLayout.tsx","webpack://website/../jui/src/Tabs/TabItem.tsx","webpack://website/../jui/src/Tabs/TabTheme.ts","webpack://website/../jui/src/Tabs/StyledHorizontalOverflowShadows.tsx","webpack://website/../jui/src/Tabs/Tab.tsx","webpack://website/../jui/src/Tabs/Tabs.tsx","webpack://website/../jui/src/Tabs/useHasOverflow.tsx","webpack://website/../jui/src/Tabs/TabsOverflowMenu.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabContent.tsx","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTab.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/StyledToolWindowTabs.ts","webpack://website/../jui/src/Tabs/ToolWindowTabs/ToolWindowTabs.tsx","webpack://website/../jui/src/TextRange.ts","webpack://website/../jui/src/TextWithHighlights/TextWithHighlights.tsx","webpack://website/../jui/src/Theme/parseColorString.ts","webpack://website/../jui/src/Theme/Color.ts","webpack://website/../jui/src/ThreeViewSplitter/ThreeViewSplitter.tsx","webpack://website/../jui/src/ToolWindows/FloatView.tsx","webpack://website/../jui/src/ToolWindows/FloatToolWindows.tsx","webpack://website/../jui/src/ToolWindows/MovableToolWindowStripeProvider.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowOuterLayout.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsLayoutState.ts","webpack://website/../jui/src/ToolWindows/createGetDropPosition.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripeButton.tsx","webpack://website/../jui/src/ToolWindows/StyledToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/useElementMove.tsx","webpack://website/../jui/src/ToolWindows/findEffectiveBackgroundColor.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowStripe.tsx","webpack://website/../jui/src/ToolWindows/UndockSide.tsx","webpack://website/../jui/src/ToolWindows/ToolWindows.tsx","webpack://website/../jui/src/ToolWindows/useOnFocusLost.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowStateProvider.tsx","webpack://website/../jui/src/ToolWindows/ToolWindowsState/ToolWindowsState.ts","webpack://website/../jui/src/ToolWindows/utils.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowSettingsIconMenu.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowHeader.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindowToolbarButton.tsx","webpack://website/../jui/src/ToolWindowsImpl/DefaultToolWindows.tsx","webpack://website/../jui/src/ToolWindowsImpl/MultiViewToolWindow.tsx","webpack://website/../jui/src/ToolWindowsImpl/ToolWindowActionIds.ts","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowActions.tsx","webpack://website/../jui/src/ToolWindowsImpl/useToolWindowsActions.tsx","webpack://website/../jui/src/Toolbar/Toolbar.tsx","webpack://website/../jui/src/Tooltip/ActionHelpTooltip.tsx","webpack://website/../jui/src/Tooltip/ActionTooltip.tsx","webpack://website/../jui/src/Tooltip/HelpTooltip.tsx","webpack://website/../jui/src/Tooltip/PositionedTooltipTrigger.tsx","webpack://website/../jui/src/Tooltip/Tooltip.tsx","webpack://website/../jui/src/Tooltip/TooltipContext.tsx","webpack://website/../jui/src/Tooltip/TooltipPointer.tsx","webpack://website/../jui/src/utils/useMouseEventOverlayPosition.tsx","webpack://website/../jui/src/Tooltip/TooltipTrigger.tsx","webpack://website/../jui/src/Tooltip/TooltipTriggerAndOverlay.tsx","webpack://website/../jui/src/Tooltip/ValidationTooltip.tsx","webpack://website/../jui/src/Tooltip/tooltip-styles.ts","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTreeNode.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/SpeedSearchTree.tsx","webpack://website/../jui/src/Tree/SpeedSearchTree/useSpeedSearchTree.ts","webpack://website/../jui/src/Tree/StyledTree.tsx","webpack://website/../jui/src/Tree/TreeContext.tsx","webpack://website/../jui/src/Tree/TreeKeyboardDelegate.tsx","webpack://website/../jui/src/Tree/TreeNodeIcon.tsx","webpack://website/../jui/src/Tree/useTreeNodeToggleButton.tsx","webpack://website/../jui/src/Tree/StyledTreeNode.tsx","webpack://website/../jui/src/Tree/TreeNode.tsx","webpack://website/../jui/src/Tree/useTreeNode.tsx","webpack://website/../jui/src/Tree/useSelectableTree.tsx","webpack://website/../jui/src/Collections/useCollectionCacheInvalidation.ts","webpack://website/../jui/src/Tree/__copied__TreeCollection.ts","webpack://website/../jui/src/Tree/getSingleChildrenKeys.ts","webpack://website/../jui/src/Tree/TreeSelectionManager.ts","webpack://website/../jui/src/Tree/useTreeState.ts","webpack://website/../jui/src/Tree/useTreeRef.tsx","webpack://website/../jui/src/Tree/useTreeVirtualizer.tsx","webpack://website/../jui/src/TreeActions/useTreeActions.tsx","webpack://website/../jui/src/TreeCheckboxes/NestedSelection.ts","webpack://website/../jui/src/TreeCheckboxes/SpeedSearchTreeWithCheckboxes.tsx","webpack://website/../jui/src/TreeCheckboxes/TreeNodeCheckbox.tsx","webpack://website/../jui/src/TreeCheckboxes/useNestedSelectionState.ts","webpack://website/../jui/src/VariableWidthListLayout.tsx","webpack://website/../jui/src/utils/string-utils.ts","webpack://website/../jui/src/minusculeMatch.ts","webpack://website/../jui/src/selection/useSelectableCollection.ts","webpack://website/../jui/src/selection/useSelectableItem.tsx","webpack://website/../jui/src/style-constants.ts","webpack://website/../jui/src/utils/FocusScope.tsx","webpack://website/../jui/src/utils/array-utils.ts","webpack://website/../jui/src/utils/interaction-utils/textSelection.ts","webpack://website/../jui/src/utils/interaction-utils/useMove.tsx","webpack://website/../jui/src/utils/keyboard-utils.ts","webpack://website/../jui/src/utils/overflow-utils/OverflowObserver.ts","webpack://website/../jui/src/utils/overflow-utils/useOverflowObserver.tsx","webpack://website/../jui/src/utils/tree-utils.ts","webpack://website/../jui/src/utils/useContextOrThrow.tsx","webpack://website/../jui/src/utils/useEventCallback.ts","webpack://website/../jui/src/utils/useFocusForwarder.ts","webpack://website/../jui/src/utils/useForwardedRef.ts","webpack://website/../jui/src/utils/useLatest.ts","webpack://website/../jui/src/utils/usePrevious.ts","webpack://website/../jui/src/utils/immutableSet.ts","webpack://website/../jui/src/utils/useSet.ts","webpack://website/../../node_modules/monaco-editor/esm/vs/base/common/worker/ lazy ^.*$ namespace object","webpack://website/../../node_modules/monaco-editor/esm/vs/editor/common/services/ lazy ^.*$ namespace object"],"sourcesContent":["export default \"data:image/gif;base64,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\"","import { Img } from \"@intellij-platform/core\";\nimport React, { ComponentProps } from \"react\";\nimport loadingGif from \"./resources/loading.gif\";\nimport loadingDarkGif from \"./resources/loading_dark.gif\";\n\nexport const LoadingGif = (\n  props: Omit<ComponentProps<typeof Img>, \"src\" | \"darkSrc\" | \"srcSet\">\n) => <Img {...props} src={loadingGif} darkSrc={loadingDarkGif} />;\n","export default \"data:image/gif;base64,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\"","import React, { SuspenseProps } from \"react\";\nimport styled from \"styled-components\";\nimport { LoadingGif } from \"./LoadingGif\";\n\nconst Loading = styled(LoadingGif)`\n  width: fit-content;\n  margin: auto;\n`;\nexport const DefaultSuspense: React.FC<Partial<SuspenseProps>> = ({\n  fallback = <Loading />,\n  children,\n}) => <React.Suspense fallback={fallback}>{children}</React.Suspense>;\n","import path from \"path\";\n\nexport const FILE_ICON = \"fileTypes/text\";\nexport const DIR_ICON = \"nodes/folder\";\n\nconst extensionIconMap: Record<string, string> = {\n  editorconfig: \"nodes/editorconfig\",\n  js: \"fileTypes/javaScript\",\n  gitignore: \"vcs/ignore_file\",\n  archive: \"fileTypes/archive\",\n  as: \"fileTypes/as\",\n  config: \"fileTypes/config\",\n  css: \"fileTypes/css\",\n  dtd: \"fileTypes/dtd\",\n  hpr: \"fileTypes/hprof\",\n  htaccess: \"fileTypes/htaccess\",\n  html: \"fileTypes/html\",\n  idl: \"fileTypes/idl\",\n  java: \"fileTypes/java\",\n  jfr: \"fileTypes/jfr\",\n  json: \"fileTypes/json\",\n  jsp: \"fileTypes/jsp\",\n  jspx: \"fileTypes/jspx\",\n  manifest: \"fileTypes/manifest\",\n  properties: \"fileTypes/properties\",\n  txt: \"fileTypes/text\",\n  wsdl: \"fileTypes/wsdlFile\",\n  xhtml: \"fileTypes/xhtml\",\n  xml: \"fileTypes/xml\",\n  xsd: \"fileTypes/xsdFile\",\n  yaml: \"fileTypes/yaml\",\n};\n\nexport const getIconForFile = (filepath: string) => {\n  const extension = getExtension(filepath);\n  return extensionIconMap[extension] || FILE_ICON;\n};\n\n/**\n * A little different from path.extname(). For \".gitignore\" path.extname returns \"\" while this returns \"gitignore\".\n */\nconst getExtension = (filepath: string): string =>\n  filepath.split(\".\").pop() || \"\";\n\n/**\n * @example\n * \"/a/b/c.ext\" => [\"/a/b\", \"/a\"]\n */\nexport function getParentPaths(\n  filepath: string,\n  upperLimit: string = path.sep\n): string[] {\n  return getParentPathsRecursive(filepath, upperLimit);\n}\n\nfunction getParentPathsRecursive(\n  filepath: string,\n  upperLimit: string,\n  previousPaths: string[] = []\n): string[] {\n  const dirname = path.dirname(filepath);\n  if (dirname !== upperLimit) {\n    return [dirname].concat(\n      getParentPathsRecursive(dirname, upperLimit, previousPaths)\n    );\n  }\n  return previousPaths;\n}\n","import { EditorProps, useMonaco } from \"@monaco-editor/react\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { editor } from \"monaco-editor\";\nimport { useLayoutEffect, useState } from \"react\";\nimport { useTheme } from \"styled-components\";\n\nimport vsCodeTheme from \"../resources/dracula-color-theme.json\"; // FIXME: don't read a fixed color scheme\n\nconst darculaColorSchemeTokenRules: editor.ITokenThemeRule[] =\n  vsCodeTheme.tokenColors.flatMap(({ scope, settings }) =>\n    ([] as string[])\n      .concat(scope)\n      .flatMap((scope) => scope.split(\" \"))\n      .map((token) => {\n        const values: editor.ITokenThemeRule = {\n          token,\n        };\n        Object.keys(settings).forEach((key) => {\n          const value = settings[key as keyof typeof settings];\n          if (value) {\n            values[key as keyof typeof settings] = value;\n          }\n        });\n        return values;\n      })\n  );\n\nexport const useEditorTheme = () => {\n  const monaco = useMonaco();\n  const theme = useTheme() as Theme;\n  const [themeName, setThemeName] = useState<EditorProps[\"theme\"]>(\n    theme.dark ? \"vs-dark\" : \"light\"\n  );\n  useLayoutEffect(() => {\n    if (monaco) {\n      const name = `jui-theme-${theme.name.replace(\" \", \"\")}`;\n      const bracketColor = theme.dark ? \"#dcdcdc\" : \"#000\";\n      monaco.editor.defineTheme(name, {\n        base: theme.dark ? \"vs-dark\" : \"vs\",\n        inherit: true,\n        // colors and rules should come from color scheme xml files.\n        // see platform/platform-resources/src/DefaultColorSchemesManager.xml\n        colors: theme.dark\n          ? {\n              // FIXME: read from color scheme files. List of available keys: https://github.com/microsoft/monaco-editor/issues/1631\n              \"editor.background\": \"#2B2B2B\",\n              \"editor.lineHighlightBackground\": \"#323232\",\n              \"editorLineNumber.foreground\": \"#606366\", // LINE_NUMBERS_COLOR\n              \"editorActiveLineNumber.foreground\": \"#a4a3a3\", // LINE_NUMBER_ON_CARET_ROW_COLOR\n              \"editorIndentGuide.background\": \"#373737\", // INDENT_GUIDE\n              \"editorIndentGuide.activeBackground\": \"#505050\", // SELECTED_INDENT_GUIDE\n              \"editorGutter.background\": theme.dark ? \"#313335\" : \"#f0f0f0\",\n              \"editorBracketHighlight.foreground1\": bracketColor,\n              \"editorBracketHighlight.foreground2\": bracketColor,\n              \"editorBracketHighlight.foreground3\": bracketColor,\n              \"editorBracketHighlight.foreground4\": bracketColor,\n              \"editorBracketMatch.background\": \"#43454b\", // in new UI\n              \"editorBracketMatch.border\": \"#00000000\", // in new UI\n            }\n          : {},\n        // token rules for syntax highlighting\n        rules: darculaColorSchemeTokenRules,\n      });\n      setThemeName(name);\n    }\n  }, [monaco, theme]);\n\n  return themeName;\n};\n","import MonacoEditor, { EditorProps } from \"@monaco-editor/react\";\nimport { styled } from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useEditorTheme } from \"./useEditorTheme\";\n\nexport const StyledEditor = styled(MonacoEditor)`\n  .monaco-editor {\n    .margin-view-overlays .line-numbers {\n      text-align: left;\n      padding-left: 7px;\n    }\n\n    .scrollbar .slider {\n      border-radius: 0.25rem;\n    }\n  }\n`;\n/**\n * Monaco Editor styled to look like Intellij Platform's editor.\n * TODO:\n *  - folding controls appearance is different and should be changed\n *  - highlighting pairs of parens, brackets, etc. is different.\n *  - context menu look different.\n *  - selection look different.\n *  - BUG: height is more than necessary. Needs investigation first.\n */\nexport const Editor = (props: Omit<EditorProps, \"theme\">) => {\n  const editorTheme = useEditorTheme();\n  const fontSize = 13;\n  return (\n    <StyledEditor\n      {...props}\n      options={\n        {\n          minimap: { enabled: false },\n          lineHeight: 22,\n          showFoldingControls: \"always\",\n          guides: {\n            indentation: true,\n          },\n          overviewRulerBorder: false,\n          fontFamily: \"JetBrains Mono\",\n          fontSize,\n          scrollbar: {\n            verticalScrollbarSize: 14,\n            horizontalScrollbarSize: 8,\n            verticalSliderSize: 8,\n            horizontalSliderSize: 8,\n            horizontal: \"auto\",\n            vertical: \"visible\",\n            alwaysConsumeMouseWheel: false, // to let example-app be rendered as a part of a page.\n          },\n          ...props.options,\n        } as EditorProps[\"options\"]\n      }\n      theme={editorTheme as any} // FIXME\n    />\n  );\n};\n","// FIXME?: We are importing everything from browserFS, which might be too much, considering many backends it supports\nimport * as BrowserFS from \"browserfs\";\n// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport LightningFS from \"@isomorphic-git/lightning-fs\";\nimport FS, { FSModule } from \"browserfs/dist/node/core/FS\";\nimport { BFSCallback } from \"browserfs/dist/node/core/file_system\";\n\n// importing the type didn't work as expected\ntype FileSystem = Parameters<typeof BrowserFS[\"initialize\"]>[0];\n\n// not so accurate type.\nexport type PromisifiedFS = Omit<\n  LightningFS.PromisifiedFS, // borrowed from LightningFS\n  \"init\" | \"activate\" | \"deactivate\"\n> & { exists: (path: string) => Promise<boolean> };\n\nexport type FSModuleWithPromises = FSModule & {\n  promises: PromisifiedFS;\n};\n\nexport async function createInMemoryFS() {\n  return await createFsBackend((cb) => {\n    BrowserFS.FileSystem.InMemory.Create({}, cb);\n  });\n}\n\nexport async function createIndexedDBFS(storeName = \"bfs-local-fs\") {\n  const idbfs = await createFsBackend((cb) => {\n    BrowserFS.FileSystem.IndexedDB.Create({ storeName }, cb);\n  });\n  // @ts-expect-error wasted several hours on the following f*** line! The reason it's needed is a huge f*** blunder\n  // in browserfs@2.0.0, in which IndexedDBFileSystem doesn't call the init function in Create function.\n  // several things made this issue extremely hard to find and fix:\n  // 1. the latest code on github is actually correct, but unpublished\n  // 2. If browserfs@1.x is used even once, it will initialize the indexedDB correctly, which hides the v2 error.\n  //    it exactly happened when trying to reproduce the issue on codesandbox: https://codesandbox.io/s/browser-fs-2-0-0-indexed-db-bug-5vuecr\n  await new Promise((resolve) => idbfs.init(idbfs.store, resolve));\n  return idbfs;\n}\n\nexport function initializeFS(fsBackend: FileSystem): FSModuleWithPromises {\n  BrowserFS.initialize(fsBackend);\n  const fsm = BrowserFS.BFSRequire(\"fs\");\n\n  // @ts-expect-error\n  fsm.promises = pify({\n    ...fsm,\n    // fs.exists violates error-first rule of callback-based async functions\n    exists: (\n      filePath: string,\n      cb: (error: null | unknown, value: boolean) => void\n    ) => fsm.exists(filePath, (value) => cb(null, value)),\n  });\n\n  return fsm as FSModuleWithPromises;\n}\n\nexport const createFs = (backend: FileSystem): FS => {\n  const fs = new (BrowserFS.BFSRequire(\"fs\").FS)();\n  fs.initialize(backend);\n  return fs;\n};\n\nfunction createFsBackend(\n  fn: (cb: BFSCallback<FileSystem>) => void\n): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    fn((err, fs) => {\n      if (err || !fs) {\n        return reject(err);\n      }\n      resolve(fs);\n    });\n  });\n}\n","// @ts-expect-error: https://github.com/sindresorhus/pify/issues/74\nimport pify from \"pify\";\nimport path from \"path\";\nimport FS from \"browserfs/dist/node/core/FS\";\nimport { PromisifiedFS } from \"./browser-fs\";\n// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { fs } from \"./fs\";\n\ntype CopyFsParams = {\n  source: FS;\n  target: FS;\n  /**\n   * called when a file is being copied\n   */\n  onCopy?: (filepath: string) => void;\n  /**\n   * force copy, even if file already exists in the target fs\n   * @default false\n   */\n  force?: boolean;\n\n  cancelSignal: unknown;\n};\n\nexport async function copyFs({\n  source,\n  target,\n  cancelSignal,\n  ...rest\n}: CopyFsParams) {\n  await copyFsRecursively(cancelSignal, {\n    ...rest,\n    source: pify(source),\n    target: pify(target),\n    rootDir: \"/\",\n  });\n}\n\nconst copyFsRecursively = CAF(function* (\n  cancelSignal: unknown,\n  params: {\n    source: PromisifiedFS;\n    target: PromisifiedFS;\n    onCopy?: (filepath: string) => void;\n    force?: boolean;\n    rootDir: string;\n  }\n): unknown {\n  const { source, target, rootDir, onCopy, force } = params;\n  const items = yield source.readdir(rootDir);\n\n  // While we could parallelize copying files of a given directory, it didn't prove to be much faster. Plus, supporting\n  // cancellation via CAF seems more straightforward if we don't do that.\n  for (const name of items) {\n    const fullPath = path.join(rootDir, name);\n    const stat = yield source.stat(fullPath);\n    if (stat.isFile() || stat.isSymbolicLink()) {\n      if (!force && (yield fileExists(target, fullPath))) {\n        return;\n      }\n      onCopy?.(fullPath);\n      const content = yield source.readFile(fullPath); // is it ok for symlink too?\n      yield ensureDir(target, path.dirname(fullPath));\n      yield target.writeFile(fullPath, content);\n    } else if (stat.isDirectory()) {\n      yield copyFsRecursively(cancelSignal, {\n        ...params,\n        rootDir: path.join(rootDir, name),\n      });\n    } else {\n      console.warn(\"unsupported file system item skipped, when copying:\", stat);\n    }\n  }\n});\nconst fileExists = async (fs: PromisifiedFS, filepath: string) => {\n  const exists = await fs.exists(filepath);\n\n  return exists && !(await fs.stat(filepath)).isDirectory();\n};\n\n/**\n * Similar to `fs.mkdir(dirPath, {recursive: true})`. `recursive` is not supported in the\n * currently used fs implementations.\n */\nexport async function ensureDir(fs: PromisifiedFS, dirPath: string) {\n  const stat = await fs\n    .stat(dirPath)\n    .catch((e) => (e.code === \"ENOENT\" ? false : Promise.reject(e)));\n  if (stat === false) {\n    // path doesn't exist\n    const dirname = path.dirname(dirPath);\n    if (dirname !== path.dirname(dirname)) {\n      // not root path\n      await ensureDir(fs, dirname);\n    }\n    await fs\n      .mkdir(dirPath)\n      // it can happen that due to async nature of this function, between calling stat and this line, the folder is already created.\n      .catch((e) =>\n        e.code === \"EEXIST\" ? Promise.resolve() : Promise.reject(e)\n      );\n  } else if (!stat.isDirectory()) {\n    throw new Error(`path is not a directory, but already exists: ${dirPath}`);\n  }\n}\n\n/**\n * A wrapper around stat which doesn't throw if nothing exists at the input pathname.\n * It provides a more ergonomic signature for use cases where it's required to know if\n * a file or directory exists on the pathname, distinguishing the two cases.\n */\nexport const stat = (pathname: string) =>\n  fs.promises.stat(pathname).catch(() => null);\n","import * as BrowserFS from \"browserfs\";\nimport React from \"react\";\nimport {\n  createFs,\n  createIndexedDBFS,\n  createInMemoryFS,\n  FSModuleWithPromises,\n  initializeFS,\n} from \"./browser-fs\";\nimport { copyFs } from \"./fs-utils\";\n\n/**\n * local fs, for when used in browser. Most of the things here would be a noop in node environment.\n */\nexport let fs: FSModuleWithPromises;\n\nconst localStorageSetting = <Enum extends string>(key: string) => ({\n  get: () => localStorage.getItem(key) as Enum | undefined,\n  set: (value: Enum) => localStorage.setItem(key, value),\n});\n/**\n * Global fs preferences for which the file system itself can't be used as storage.\n */\nexport const persistentFsPreference = localStorageSetting<\"yes\" | \"no\">(\n  \"demo_app_use_persistent_fs\"\n);\n\n// NOTE: Maybe we can make this module side-effect free by lazy initializing fsPromise, in WaitForFs, if it's enough\n// to assume any code requiring FS is executed via components rendered inside WaitForFs.\n// Also, we can gather exports of this file into an interface to make it easier to provide two implementations, for\n// browser and node.\nconst fsPromise: Promise<FSModuleWithPromises> = (\n  persistentFsPreference.get() === \"yes\"\n    ? createIndexedDBFS()\n    : createInMemoryFS()\n)\n  .then(initializeFS)\n  .then((theFs) => {\n    (window as any).fs = theFs;\n    return (fs = theFs);\n  })\n  .catch((e) => {\n    console.log(\"could not initialize FS:\", e);\n    throw e;\n  });\n\nexport function isFsInMemory() {\n  return fs.getRootFS() instanceof BrowserFS.FileSystem.InMemory;\n}\n\nexport async function switchToPersistentFS({\n  onCopy = console.log,\n  cancelSignal,\n}: {\n  onCopy?: (filepath: string) => void;\n  cancelSignal?: unknown;\n} = {}) {\n  if (!isFsInMemory()) {\n    console.log(\"Already on persistent fs. Nothing to do.\");\n    return;\n  }\n  console.log(\"Creating IndexedDB FS\");\n  console.time(\"creating db\");\n  const indexedDbFsBackend = await createIndexedDBFS();\n\n  await copyFs({\n    source: fs,\n    target: await createFs(indexedDbFsBackend),\n    cancelSignal,\n    force: true,\n    onCopy,\n  });\n  console.timeEnd(\"creating db\");\n\n  initializeFS(indexedDbFsBackend);\n  // persistentFsPreference.set(\"yes\");\n  console.log(\"FS switched to IndexedDB backend\", indexedDbFsBackend);\n}\n\nconst fsResource = wrapPromise(fsPromise);\n\n/**\n * Suspense aware wrapper for waiting for FS to be initialized. initialization API in some fs backends such as\n * BrowserFs, is async. That's why it's safe to use this on a high level.\n */\nexport const WaitForFs: React.FC<{ children?: React.ReactNode }> = ({\n  children,\n}) => {\n  fsResource.read();\n  return children as React.ReactElement;\n};\n\n/**\n * wrapPromise util for suspense for arbitrary async operation, represented as a promise.\n */\nfunction wrapPromise<T>(promise: Promise<T>) {\n  let status = \"pending\";\n  let response: T;\n\n  const suspender = promise.then(\n    (res) => {\n      status = \"success\";\n      response = res;\n    },\n    (err) => {\n      status = \"error\";\n      response = err;\n    }\n  );\n  const read = () => {\n    switch (status) {\n      case \"pending\":\n        throw suspender;\n      case \"error\":\n        throw response;\n      default:\n        return response;\n    }\n  };\n\n  return { read };\n}\n","import {\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { fs } from \"./fs\";\nimport { Stats } from \"@isomorphic-git/lightning-fs\";\nimport { basename } from \"path\";\n\nexport interface FsItem {\n  type: \"dir\" | \"file\";\n  name: string;\n  path: string;\n  lastModification: number;\n  size: number;\n}\n\n/**\n * recoil atoms and selectors for keeping list and content of files in recoil state, for components that need on such\n * state.\n * NOTE: still not clear if we should be using atomFamily or selectorFamily for this. changing the current\n * implementation to atomFamily however is easy and side effect free.\n */\nexport const dirContentState = selectorFamily({\n  key: \"dirContents\",\n  get: (path: string) => async (): Promise<null | FsItem[]> => {\n    let fileNames: string[];\n    try {\n      fileNames = await fs.promises.readdir(path);\n    } catch (e) {\n      return null;\n    }\n    const stats = await Promise.all(\n      fileNames.map((fileName) => {\n        const filePath = `${path}/${fileName}`;\n        return fs.promises.stat(filePath).then((stat: Stats) => ({\n          ...stat,\n          type: stat.isDirectory() ? (\"dir\" as const) : (\"file\" as const),\n          filePath,\n        }));\n      })\n    );\n    return stats.map((stat) => ({\n      type: stat.type,\n      name: basename(stat.filePath),\n      path: stat.filePath,\n      lastModification: stat.mtimeMs,\n      size: stat.size,\n    }));\n  },\n});\n\n/**\n * recoil callback to refresh the file content recoil value of a give path.\n * The callback returns `true` the file exists and content is refreshed successfully, and `false otherwise.\n * @param set\n * @deprecated use reset(fileContent(path)) directly\n */\nexport const reloadFileFromDiskCallback =\n  ({ reset, refresh }: CallbackInterface) =>\n  async (path: string) => {\n    refresh(readFileContentSelector(path));\n    reset(fileContentState(path));\n  };\n\nconst readFileContentSelector = selectorFamily({\n  key: \"readFileContent\",\n  get: (filepath: string | undefined) => async (): Promise<string | null> => {\n    if (!filepath) {\n      return \"\";\n    }\n    const exists = await fs.promises.exists(filepath);\n    if (!exists) {\n      return null;\n    }\n    // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n    return fs.promises.readFile(filepath, { encoding: \"utf8\" });\n  },\n});\n\n/**\n * **Note**: Still not quite clear if we should use atom and [synchronize with source of truth (FS)][recoil-atom-effects],\n * or if we should use selector and refresh it when needed. We probably need a proper [VFS][vfs] implementation at\n * some point, which would be capable of tracking modifications, and setting up listeners for it, and then atoms, can\n * hold the states like directory content, with effects which uses the listener API.\n * A few things to consider in that regard:\n * - if modifications to files are not directly synchronized to fs, using isomorphic-git for updating the file status\n *   can be tricky, unless an FS implementation is provided which uses the file content that is not yet synced with\n *   the actual local FS. Maybe something like Intellij's VFS, can be implemented as a BrowserFS backend impl.\n *\n * **Note**: currently, only text file is supported, for simplicity.\n *\n * [recoil-atom-effects]: https://recoiljs.org/docs/guides/atom-effects#write-through-cache-example\n * [vfs]: https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html\n **/\nexport const fileContentState = atomFamily<string | null, string | undefined>({\n  key: \"fileContent\",\n  default: readFileContentSelector,\n  effects: (filepath) => [\n    ({ onSet }) => {\n      onSet(async (content) => {\n        if (filepath && (await fs.promises.exists(filepath))) {\n          // Should a sync API be used here?\n          fs.promises\n            .writeFile(filepath, content ?? \"\", \"utf8\")\n            .catch((e: unknown) => {\n              console.error(\"failed to sync the file back to the fs\", e);\n            });\n        }\n      });\n    },\n  ],\n});\n\nexport const useReloadFromDisk = (path: string) => {\n  return useRecoilRefresher_UNSTABLE(dirContentState(path));\n};\n","import {\n  Loadable,\n  RecoilState,\n  RecoilValue,\n  useRecoilCallback,\n  useRecoilRefresher_UNSTABLE,\n  useRecoilValueLoadable,\n  useSetRecoilState,\n} from \"recoil\";\nimport { FocusEvent, useEffect, useRef, useState } from \"react\";\nimport { equals } from \"ramda\";\n\nexport type MaybeRecoilValue<T> = T | RecoilValue<T>;\n\nexport const createFocusBasedSetterHook = <T extends unknown, N extends T = T>(\n  state: RecoilState<T>,\n  nullValue: N\n) => {\n  let focusedElement: Element | null = null;\n  return (value: T, name: string = \"unknown\") => {\n    const setValue = useSetRecoilState(state);\n    const elementRef = useRef<Element>();\n    useEffect(() => {\n      if (focusedElement === elementRef.current) {\n        setValue((currentValue) =>\n          equals(value, currentValue) ? currentValue : value\n        );\n      }\n    }, [value]);\n    return {\n      onFocus: (e: FocusEvent) => {\n        elementRef.current = e.currentTarget;\n        focusedElement = e.currentTarget;\n        setValue(value);\n      },\n      onBlur: (e: FocusEvent) => {\n        if (\n          e.relatedTarget instanceof Element &&\n          e.relatedTarget?.closest(\"[data-overlay-container], [role=menu]\")\n        ) {\n          // hacky and probably not so reliable way to work around this issue:\n          // There are actions that depend on focus-based contextual value. Like \"Commit file/folder\" action that\n          // depends on activePaths state which is focus-based. If the action is triggered via menu, when the menu\n          // is opened the focus is lost and therefore the action gets disabled as the activePaths become null.\n          // With this hacky fix, we check if the focus is being moved to an overlay, and we don't clear the contextual\n          // state on blur, in this case.\n          // There are probably better ways to handle this focus-based contextual actions that wouldn't require such\n          // hacks.\n          return;\n        }\n        setValue(nullValue);\n      },\n    };\n  };\n};\n\n/**\n * Returns the latest value of a recoil value, or null, if the value is being loaded for the first time.\n * Useful for when stale data is ok, but may get synced soon.\n *\n * TODO: returning a tuple here is not the best API. Ideally we could have a fourth type of Lodable which would be\n *  similar to LoadingLoadale, but would hold a previous value as well. Then we could have a hook like similar to\n *  useRecoilValueLoadable, but returning that specific type of Loadable. The only difference with\n *  useRecoilValueLoadable would be calling getValue() would return the previous value if state is loading, making it\n *  easy to implement the common pattern of keeping the previous data plus a loading indicator, when new data is being\n *  loaded.\n */\nexport function useLatestRecoilValue<T>(\n  recoilValue: RecoilValue<T>\n): [T | null, Loadable<unknown>[\"state\"]] {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  return [\n    loadable.state === \"hasValue\" ? loadable.getValue() : state,\n    loadable.state,\n  ];\n}\n\n/**\n * Similar to {@link useLatestRecoilValue}, only that value is guaranteed\n * to be initialized. i.e. the first load of the recoil value will suspend\n * the rendering, but the subsequent updates will not, and the latest value\n * will be used, while a new value is being loaded.\n */\nexport function useExistingLatestRecoilValue<T>(\n  recoilValue: RecoilValue<T>\n): [T, Loadable<unknown>[\"state\"]] {\n  const [state, setState] = useState<T | null>(null);\n  let loadable = useRecoilValueLoadable(recoilValue);\n\n  useEffect(() => {\n    if (loadable.state === \"hasValue\") {\n      setState(loadable.contents);\n    }\n  }, [loadable]);\n\n  const value = loadable.state === \"hasValue\" ? loadable.getValue() : state;\n\n  if (value === null) {\n    throw loadable.toPromise();\n  }\n  return [value, loadable.state];\n}\n\n/**\n * Refreshes recoil value on mount\n */\nexport function useRefreshRecoilValueOnMount<T>(value: RecoilValue<T>) {\n  const refresh = useRecoilRefresher_UNSTABLE(value);\n  useEffect(() => {\n    refresh();\n  }, []);\n}\n\nexport function useRecoilInitialValue<T>(recoilState: RecoilState<T>): T;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: Exclude<T, undefined | null>\n): Exclude<T, undefined | null>;\nexport function useRecoilInitialValue<T>(\n  recoilState: RecoilState<T>,\n  defaultValue?: T\n) {\n  return useRecoilCallback(\n    ({ snapshot }) =>\n      () =>\n        snapshot.getLoadable(recoilState).getValue() ?? defaultValue,\n    []\n  );\n}\n","import { FsItem } from \"../fs/fs.state\";\n\nexport const filterPath = ({ path }: FsItem) =>\n  !path.split(\"/\").includes(\".git\");\n","import path from \"path\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilRefresher_UNSTABLE,\n} from \"recoil\";\nimport { createRef, MutableRefObject } from \"react\";\nimport {\n  AlertDialogApi,\n  PopupManagerAPI,\n  WindowManagerAPI,\n} from \"@intellij-platform/core\";\n\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { createFocusBasedSetterHook } from \"../recoil-utils\";\nimport { filterPath } from \"./project-utils\";\n\nexport interface Project {\n  name: string;\n  path: string;\n}\nexport interface ProjectFsItem extends FsItem {\n  relativePath: string;\n}\n\nexport const autoClonedRepo = {\n  path: \"/workspace/jui\",\n  url: \"https://github.com/alirezamirian/jui.git\",\n};\n\nexport const defaultProject = {\n  name: \"Workspace\",\n  path: \"/workspace\",\n};\nexport const currentProjectState = atom<Project>({\n  key: \"project\",\n  default: defaultProject,\n});\n\nexport const projectFilePath = selectorFamily({\n  key: \"projectFilePath\",\n  get:\n    (projectRelativePath: string) =>\n    ({ get }) =>\n      path.join(get(currentProjectState).path, projectRelativePath),\n});\n\nexport const currentProjectFilesState = selector({\n  key: \"project.current.files\",\n  get: async ({ get }): Promise<ProjectFsItem[]> => {\n    const project = get(currentProjectState);\n    return get(projectFilesState(project.path));\n  },\n});\n\nexport const projectFilesState = selectorFamily({\n  key: \"project.files\",\n  get:\n    (\n      projectPath: string /* could be changed to project id, when project entity is more mature */\n    ) =>\n    async ({ get }): Promise<ProjectFsItem[]> => {\n      const items = get(dirContentState(projectPath));\n      const files: ProjectFsItem[] = [];\n      const addItem = (item: FsItem) => {\n        if (item.type === \"dir\") {\n          if (filterPath(item)) {\n            const childItems = get(dirContentState(item.path));\n            if (childItems) {\n              childItems.forEach(addItem);\n            }\n          }\n        } else {\n          files.push({\n            ...item,\n            relativePath: path.relative(projectPath, item.path),\n          });\n        }\n      };\n      (items || []).forEach((item) => addItem(item));\n      return files;\n    },\n});\n\nexport const useRefreshCurrentProjectFiles = () =>\n  useRecoilRefresher_UNSTABLE(currentProjectFilesState);\n\n/**\n * file/dir paths relevant to the currently active (focused) UI part. Different UI components such as Editor,\n * ProjectView or ChangesView set this context when they get focused. The context can then be used in different actions\n * that operate on files/folders.\n * While this allows for contextual actions, without any specific support for \"Action Data\" from the action system,\n * it has some drawbacks, because of which it may make sense to add support for Action Data:\n * - When an action is not triggered by a shortcut, but by clicking an action button, the focused element doesn't\n *   matter. For example, if the editor is focused and \"Rollback\" action is triggered via the shortcut, then the active\n *   path in the editor defines the initially included changes, in the Rollback window. But if the action is triggered\n *   by clicking the rollback button, while the editor is focused, the editor is ignored, and the initially included\n *   changes are set based on selected nodes in ChangesView (which is the default source for initially included changes).\n *   Whether that behaviour is a good thing or not, in order to follow it, having support for Action Data, will help\n *   implementing this behavior, since the action data will be set based on the context, only when the action is\n *   triggered via shortcut.\n *   UPDATE: that's fixed now by introducing the optional `event` argument passed to actionPerformed, which gives us a\n *   chance to know if the action was performed by a shortcut or by clicking an action button.\n * - Action data would allow for lazy evaluation of the required data, only when the action is triggered via a shortcut,\n *   and based on the dom element from which the event is triggered. While in the current approach, the data is\n *   unnecessarily updated as it changes and the data-holder component is focused.\n * - It involves focus/blur event handling to keep track of the current value, for any such focus-based contextual\n *   value. Support for associating event data with elements would not need focus/blur event handling.\n *\n *  @see useActivePathsProvider\n */\nexport const activePathsState = atom<string[]>({\n  key: \"project.activePaths\",\n  default: [],\n});\n\nexport const activePathExistsState = selector({\n  key: \"project.activePaths.hasValue\",\n  get: ({ get }) => get(activePathsState).length > 0,\n});\n\n/**\n * Sets the value of {@link activePathsState} when focused.\n * @returns focus/blur handling props, to be applied on the container which should set the active path state\n */\nexport const useActivePathsProvider = createFocusBasedSetterHook(\n  activePathsState,\n  []\n);\n\n/**\n * Ref to the popup manager of the current project. Used in actions that are created by a recoil selector.\n * TODO(multi-project): either:\n *  - introduce project-level recoil root, to keep such states per project. Downside is there are atoms that are\n *    not per-project, and recoil doesn't currently support multiple nested scopes of atoms, even though it does\n *    support nested RecoilRoots.\n *  - (better) add a feature to the action system, where ActionProvider can define additional contextual properties\n *    to be made available in `context` when calling `actionPerformed` method. The biggest challenge for a nice\n *    implementation of such feature is static type safety.\n */\nexport const projectPopupManagerRefState = atom<\n  MutableRefObject<PopupManagerAPI | null>\n>({\n  key: \"project.popupManager\",\n  default: createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const windowManagerRefState = atom<\n  MutableRefObject<WindowManagerAPI | null>\n>({\n  key: \"project.windowManager\",\n  default: createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const alertDialogRefState = atom<\n  MutableRefObject<AlertDialogApi | null>\n>({\n  key: \"project.alertDialog\",\n  default: createRef(),\n  dangerouslyAllowMutability: true,\n});\n","import { atom, CallbackInterface, selector, useRecoilValue } from \"recoil\";\nimport { descend, sortWith } from \"ramda\";\nimport { Position } from \"monaco-editor\";\n\nimport {\n  currentProjectFilesState,\n  projectFilePath,\n} from \"../Project/project.state\";\nimport { Focusable } from \"../common-types\";\n\ninterface TextEditorState {\n  cursorPos: { lineNumber: number; column: number };\n}\ntype EditorState = TextEditorState;\n\nexport interface EditorTabState {\n  editorState: EditorState;\n  filePath: string;\n}\n\n// in order to showcase tabs behaviour when many tabs are open. Later on, it should be based on persisted project\n// settings.\nconst temporaryTabsDefaultValue = selector({\n  key: \"editor.tabs/Default\",\n  get: ({ get }) =>\n    sortWith(\n      [\n        // first README.md, then ts and js files.\n        descend((file) => file.path === get(projectFilePath(\"README.md\"))),\n        descend((file) => file.path.endsWith(\".ts\")),\n        descend((file) => file.path.endsWith(\".js\")),\n      ],\n      get(currentProjectFilesState).filter((item) => item.type === \"file\")\n    )\n      .filter((file) => !file.path.includes(\".idea\"))\n      .slice(0, 12)\n      // map project file to editor state object\n      .map((file) => ({\n        filePath: file.path,\n        editorState: { cursorPos: { lineNumber: 0, column: 0 } },\n      })),\n});\n\n// it should become something under \"project\" state later.\nexport const editorTabsState = atom<ReadonlyArray<EditorTabState>>({\n  key: \"editor.tabs\",\n  default: [],\n  effects: [\n    ({ getPromise, setSelf, trigger }) => {\n      // an effect is used to set the intial value instead of using the selector directly in default value,\n      // because otherwise the atom will be linked to the selector (and dynamically updated) until the state is set\n      // which can lead to inconsistent behavior based on whether anything in tabs state is changed or not.\n      if (trigger === \"get\") {\n        getPromise(temporaryTabsDefaultValue).then((tabs) => setSelf(tabs));\n      }\n    },\n  ],\n});\n\nconst activeEditorTabIndexState = atom<number>({\n  key: \"editor.activeTabIndex\",\n  default: 0,\n});\n\nexport const activeEditorTabState = selector<EditorTabState | null>({\n  key: \"editor.activeTab\",\n  get: ({ get }) => {\n    const tabs = get(editorTabsState);\n    return tabs[get(activeEditorTabIndexState)] || tabs[0] || null;\n  },\n});\n\nexport const editorCursorPositionState = atom<Position>({\n  key: \"editor.cursorPosition\",\n  default: new Position(0, 0),\n});\n\n/**\n * could be a global variable also, since there is no re-rendering need for it. It's kept as an atom, just to avoid\n * global variable and its issues.\n */\nexport const editorRefState = atom<null | Focusable>({\n  key: \"editor.focusHandle\",\n  default: null,\n});\n\nexport interface EditorStateManager {\n  openPath(filePath: string, focus?: boolean): void;\n  closePath(path: string): void;\n  closeOtherTabs(index: number): void;\n  closeTab(index: number): void;\n  select(index: number): void;\n  focus(): void;\n}\n\nconst openPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (filePath: string, shouldFocus = true) => {\n    const tabsState = snapshot.getLoadable(editorTabsState).getValue();\n    const index = tabsState.findIndex((tab) => tab.filePath === filePath);\n    const select = (index: number) => {\n      set(activeEditorTabIndexState, index);\n    };\n    const focus = () => {\n      snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n    };\n    if (index > -1) {\n      select(index);\n    } else {\n      const newIndex = tabsState.length;\n      set(editorTabsState, (currentState) => [\n        ...currentState,\n        {\n          filePath,\n          editorState: { cursorPos: { lineNumber: 0, column: 0 } }, // no persistence of cursor position for now.\n        },\n      ]);\n      select(newIndex);\n    }\n    if (shouldFocus) {\n      // Without setTimeout editor gets focused immediately and \"Enter\" key press (if openPath is called in a keyboard\n      // event handler) is picked up by editor, adding unwanted new line.\n      setTimeout(focus);\n    }\n  };\n\nconst closeCallback =\n  ({ set }: CallbackInterface) =>\n  (index: number) =>\n    set(editorTabsState, (tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex !== index)\n    );\n\nconst closePathCallback =\n  (callbackInterface: CallbackInterface) => (filePath: string) => {\n    const { set, snapshot, transact_UNSTABLE } = callbackInterface;\n    const close = closeCallback(callbackInterface);\n    const index = snapshot\n      .getLoadable(editorTabsState)\n      .getValue()\n      .findIndex((tab) => tab.filePath === filePath);\n    if (index > -1) {\n      transact_UNSTABLE(() => {\n        close(index);\n        set(activeEditorTabIndexState, Math.max(index - 1, 0));\n      });\n    }\n  };\n\nconst closeOtherTabsCallback =\n  ({ set }: CallbackInterface) =>\n  (index: number) => {\n    set(editorTabsState, (tabsState) =>\n      tabsState.filter((_, tabIndex) => tabIndex === index)\n    );\n  };\nconst select =\n  ({ set, snapshot }: CallbackInterface) =>\n  (index: number) => {\n    const numTabs = snapshot.getLoadable(editorTabsState).getValue().length;\n    if (index >= 0 && index < numTabs) {\n      set(activeEditorTabIndexState, index);\n    }\n  };\n\nconst focus =\n  ({ snapshot }: CallbackInterface) =>\n  () => {\n    snapshot.getLoadable(editorRefState).valueOrThrow()?.focus();\n  };\n\nexport const editorManagerState = selector<Omit<EditorStateManager, \"tabs\">>({\n  key: \"editor.manager\",\n  get: ({ getCallback }) => {\n    return {\n      // TODO: create an action for opening in editor (jump to source)\n      openPath: getCallback(openPathCallback),\n      closeTab: getCallback(closeCallback),\n      closePath: getCallback(closePathCallback),\n      closeOtherTabs: getCallback(closeOtherTabsCallback),\n      select: getCallback(select),\n      focus: getCallback(focus),\n    };\n  },\n});\n\n/**\n * Gives access to editor state manager, in React components. returns a stable editor manager object,\n * that won't cause re-rendering based on editor state changes.\n */\nexport const useEditorStateManager = (): EditorStateManager =>\n  useRecoilValue(editorManagerState);\n\n/**\n * Gives access to editor state and also the manager, as a tuple, analogous to how useState returns\n * a tuple for the state and the setter. Only the setter is an interface.\n */\nexport const useEditorState = () => {\n  return [\n    useRecoilValue(editorTabsState),\n    useRecoilValue(editorManagerState),\n  ] as const;\n};\n","import { status as getStatus } from \"isomorphic-git\";\nimport { StatusRow } from \"isomorphic-git\";\n\n// platform/editor-ui-api/src/com/intellij/openapi/vcs/FileStatus.java\nexport type FileStatus =\n  | \"UNKNOWN\"\n  | \"ADDED\"\n  | \"NOT_CHANGED\"\n  | \"MODIFIED\"\n  | \"DELETED\";\n\n// platform/vcs-api/src/com/intellij/openapi/vcs/VcsDirectoryMapping.java\nexport interface VcsDirectoryMapping {\n  dir: string;\n  vcs: \"Git\"; // only supported vcs for now.\n}\n\n// TODO: remove when upgraded TS to >=4.5\ntype Awaited<T> = T extends PromiseLike<infer U> ? U : T;\n\n/**\n * Converts isomorphic-git status string or StatusRow to FileStatus.\n *\n * for status row:\n *   [\"a.txt\", 0, 2, 0], // new, untracked\n *   [\"b.txt\", 0, 2, 2], // added, staged\n *   [\"c.txt\", 0, 2, 3], // added, staged, with unstaged changes\n *   [\"d.txt\", 1, 1, 1], // unmodified\n *   [\"e.txt\", 1, 2, 1], // modified, unstaged\n *   [\"f.txt\", 1, 2, 2], // modified, staged\n *   [\"g.txt\", 1, 2, 3], // modified, staged, with unstaged changes\n *   [\"h.txt\", 1, 0, 1], // deleted, unstaged\n *   [\"i.txt\", 1, 0, 0], // deleted, staged\n *\n * for status:\n *   | status                | description                                                                           |\n * | --------------------- | ------------------------------------------------------------------------------------- |\n * | `\"ignored\"`           | file ignored by a .gitignore rule                                                     |\n * | `\"unmodified\"`        | file unchanged from HEAD commit                                                       |\n * | `\"*modified\"`         | file has modifications, not yet staged                                                |\n * | `\"*deleted\"`          | file has been removed, but the removal is not yet staged                              |\n * | `\"*added\"`            | file is untracked, not yet staged                                                     |\n * | `\"absent\"`            | file not present in HEAD commit, staging area, or working dir                         |\n * | `\"modified\"`          | file has modifications, staged                                                        |\n * | `\"deleted\"`           | file has been removed, staged                                                         |\n * | `\"added\"`             | previously untracked file, staged                                                     |\n * | `\"*unmodified\"`       | working dir and HEAD commit match, but index differs                                  |\n * | `\"*absent\"`           | file not present in working dir or HEAD commit, but present in the index              |\n * | `\"*undeleted\"`        | file was deleted from the index, but is still in the working dir                      |\n * | `\"*undeletemodified\"` | file was deleted from the index, but is present with modifications in the working dir |\n */\nexport function convertGitStatus(\n  status: Awaited<ReturnType<typeof getStatus>> | StatusRow\n): FileStatus {\n  // TODO: complete and refine this logic.\n  if (Array.isArray(status)) {\n    if (status[1] === 1) {\n      return ([\"DELETED\", \"NOT_CHANGED\", \"MODIFIED\"] as const)[status[2]];\n    }\n    if (status[1] === 0) {\n      if (status[3] === 0) {\n        return \"UNKNOWN\";\n      } else {\n        return \"ADDED\";\n      }\n    }\n    return \"UNKNOWN\";\n  }\n  if (status === \"modified\" || status === \"*modified\") {\n    return \"MODIFIED\";\n  }\n  if (status === \"deleted\" || status === \"*deleted\") {\n    return \"DELETED\";\n  }\n  if (status === \"added\") {\n    return \"ADDED\";\n  }\n  if (status === \"unmodified\") {\n    return \"NOT_CHANGED\";\n  }\n  return \"UNKNOWN\";\n}\n","export type MaybeArray<T> = Array<T> | T;\nexport const ensureArray = <T>(input: MaybeArray<T> | undefined): Array<T> =>\n  Array.isArray(input) ? input : input ? [input] : [];\n","import { Checker } from \"@recoiljs/refine\";\nimport { syncEffect } from \"recoil-sync\";\nimport { DefaultValue } from \"recoil\";\nimport { ensureArray, MaybeArray } from \"../../ensureArray\";\n\nexport enum StorageFiles {\n  WORKSPACE_FILE = \"$WORKSPACE_FILE$\",\n}\n\nexport type PersistentAtomEffectArgs<A, C> = {\n  read: (componentState: C | undefined) => Promise<A> | A;\n  update: (value: A) => (componentState: C) => C;\n  refine: Checker<A>;\n  componentName: string;\n  itemKey?: string;\n  storageFile?: string;\n};\n\nexport function persistentAtomEffect<A, C>({\n  componentName,\n  refine,\n  read,\n  update,\n  storageFile = StorageFiles.WORKSPACE_FILE,\n  itemKey = [storageFile, componentName].join(\"|\"),\n}: PersistentAtomEffectArgs<A, C>) {\n  return syncEffect<A>({\n    storeKey: \"ProjectWorkspace\",\n    itemKey,\n    syncDefault: false,\n    read: async ({ read: readComponentState }) => {\n      return read((await readComponentState(itemKey)) as C);\n    },\n    write: async ({ write, read }, value) => {\n      // Note: currently, reading the recoil value for the first time also results in a call to write.\n      // It's maybe a bug in recoil-sync?\n      if (!(value instanceof DefaultValue)) {\n        write(itemKey, update(value));\n      }\n    },\n    refine,\n  });\n}\n\ninterface SettingComponentWithOptions<O> {\n  option?: MaybeArray<\n    {\n      \"@name\": string;\n    } & O\n  >;\n}\n\n/**\n * Wrapper around persistentAtomEffect to read/write from/to with a single\n * `option` tag in a component, based on the option `name` attribute.\n */\npersistentAtomEffect.option = <A, O>({\n  optionName,\n  read,\n  update,\n  ...args\n}: {\n  optionName: string;\n} & PersistentAtomEffectArgs<A, O>) =>\n  persistentAtomEffect<A, SettingComponentWithOptions<O>>({\n    ...args,\n    itemKey: [args.storageFile, args.componentName, optionName].join(\"|\"),\n    read: (settings) => {\n      return read(\n        ensureArray(settings?.option)?.find(\n          (item) => item[\"@name\"] === optionName\n        )\n      );\n    },\n    update:\n      (value) =>\n      (currentSettings): SettingComponentWithOptions<O> => {\n        return {\n          option: ensureArray(currentSettings?.option).map((option) => {\n            const updates = update(value)(option);\n            console.log(\n              `updating ${optionName}`,\n              \"currentSettings\",\n              currentSettings,\n              \"updates\",\n              updates\n            );\n\n            return option[\"@name\"] === optionName\n              ? {\n                  \"@name\": optionName,\n                  ...updates,\n                }\n              : option;\n          }),\n        };\n      },\n  });\n","import {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\nimport git, { findRoot, statusMatrix } from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport {\n  convertGitStatus,\n  FileStatus,\n  VcsDirectoryMapping,\n} from \"./file-status\";\nimport * as path from \"path\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { persistentAtomEffect } from \"../Project/persistence/persistentAtomEffect\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { ensureArray, MaybeArray } from \"../ensureArray\";\n\n/**\n * git.status function has an issue with newly added files. it returns \"*added\" for both of these cases:\n * - file is untracked, not yet staged (as the documentation says)\n * - file is staged, but modified in working directory (AM)\n * Here is where it seems to have wrong logic:\n * https://github.com/isomorphic-git/isomorphic-git/blob/d631f8e56a5504b10ffc1b35589b1a5b0b2f9e74/src/api/status.js#L135\n\n */\nconst status = async ({\n  filepath,\n  ...args\n}: Parameters<(typeof git)[\"status\"]>[0]) => {\n  return git\n    .statusMatrix({ ...args, filepaths: [filepath] })\n    .then((rows) => rows[0]);\n};\n\ninterface VcsDirectoryMappingStorage {\n  mapping?: MaybeArray<{ \"@directory\": string; \"@vcs\": \"Git\" }>;\n}\nconst vcsDirectoryMappingChecker = array(\n  object({\n    dir: string(),\n    vcs: union(literal(\"Git\")),\n  })\n);\n\nexport const vcsRootsState = atom<ReadonlyArray<VcsDirectoryMapping>>({\n  key: \"vcsRoots\",\n  effects: [\n    persistentAtomEffect<\n      ReadonlyArray<VcsDirectoryMapping>,\n      VcsDirectoryMappingStorage\n    >({\n      storageFile: \"vcs.xml\",\n      refine: vcsDirectoryMappingChecker,\n      componentName: \"VcsDirectoryMappings\",\n      // TODO: translate project dir to $PROJECT_DIR$\n      read: (gitSettings) => {\n        const mappings = ensureArray(gitSettings?.mapping)?.map((item) => ({\n          dir: item[\"@directory\"],\n          vcs: item[\"@vcs\"],\n        }));\n        return mappings.length > 0 ? mappings : TMP_findGitRoots();\n      },\n      update:\n        (value) =>\n        (currentValue): VcsDirectoryMappingStorage => ({\n          ...(currentValue || {}),\n          mapping: value.map(({ vcs, dir }) => ({\n            \"@directory\": dir,\n            \"@vcs\": vcs,\n          })),\n        }),\n    }),\n  ],\n});\n\nconst TMP_findGitRoots = () =>\n  Promise.all(\n    [\"/workspace/jui\", \"/workspace\"].map(async (dir) => {\n      const exists = await fs.promises.exists(dir);\n      if (exists) {\n        return git.findRoot({ fs, filepath: dir }).catch(() => null);\n      }\n    })\n  ).then((roots) => {\n    return [...new Set(roots.filter(notNull))].map<VcsDirectoryMapping>(\n      (dir) => ({\n        dir,\n        vcs: \"Git\",\n      })\n    );\n  });\n\n/**\n * Given the absolute path of a file, returns the relevant VCS root path, if any.\n */\nexport const vcsRootForFile = selectorFamily<string | null, string>({\n  key: \"gitRootForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      // FIXME: use vcsRoots.\n      // return get(vcsRootsState).find(\n      //   (root) => root.vcs === \"Git\" && isParentPath(root.dir, filepath)\n      // )?.dir ?? null;\n      // function isParentPath(parent: string, dir: string) {\n      //   const relative = path.relative(parent, dir);\n      //   return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n      // }\n      return findRoot({ fs, filepath }).catch(() => null);\n    },\n});\n\ntype RepoStatus = {\n  [relativeFilePath: string]: FileStatus;\n};\n\nconst fetchRepoStatusFromFs = async (repoDir: string) => {\n  console.time(`statusMatrix ${repoDir}`);\n  const rows = await statusMatrix({ fs, dir: repoDir });\n  console.timeEnd(`statusMatrix ${repoDir}`);\n  const result: RepoStatus = {};\n  rows.forEach((row) => {\n    result[row[0]] = convertGitStatus(row);\n  });\n  return result;\n};\n\n/**\n * A mapping from relative file paths to file status, calculated efficiently for all files in a repo.\n * It's an atom to allow updating it for a single file, when status of a file is changed, instead of querying\n * the whole status matrix.\n * UPDATE: going from setting `default` to the selector that fetches the repo status from fs, and refreshing the atom's\n * state by calling `reset`/`refresh` on it, to having an empty object as default value, and updating it based on\n * the refreshed selector. That is to make sure repoStatusState will not block UI, since many pieces of state depend\n * on it, and if it's async, it will require lots of local loading handling, or Suspense boundaries, for something\n * that's usually not critical for the UX to be completely up-to-date. In cases that we do need to know if repo status\n * is being updated, a separate atom is created to hold that state. It's a little non-idiomatic use of Recoil, but\n * it seems justified for the use case. Also, it could perhaps be a feature to be supported first-class, to allow\n * atoms that can preserve the state stale, contain both the current/stale value and the loading state.\n */\nexport const repoStatusState = atomFamily<RepoStatus, string>({\n  key: \"vcs.repoStatus\",\n  effects: (repoDir: string) => [\n    ({ setSelf }) => {\n      setSelf(fetchRepoStatusFromFs(repoDir));\n    },\n  ],\n});\n\nexport const repoStatusUpdatingState = atom<boolean>({\n  key: \"vcs.repoStatus.updating\",\n  default: false,\n});\n\n/**\n * Keeps FileStatus of files based on their absolute path.\n * NOTE: updating files status is now not connected to file updates, as there is no proper (V)FS API allowing change\n * listener. `useUpdateFileStatus` and `useUpdateVcsFileStatuses` can be used to update status of a file, or all files\n * in a git root.\n * NOTE: Do **not** use recoil `refresh` API to update file status, as it may update status for the whole repo (if\n * {@link repoStatusState} is not yet written into), which is not very efficient.\n * use {@link useRefreshFileStatus} or {@link refreshFileStatusCallback} to efficiently refresh\n * the status of a single file.\n */\nexport const fileStatusState = selectorFamily<FileStatus, string>({\n  key: \"vcs.fileStatus\",\n  /**\n   * using a selector for the default value allows for using standard recoil API like `reset`/`refresh` to update\n   * the status for a given file.\n   */\n  get:\n    (filepath: string) =>\n    async ({ get }) => {\n      const repoRoot = get(vcsRootForFile(filepath));\n      if (repoRoot) {\n        const relativePath = path.relative(repoRoot, filepath);\n        const repoStatus = get(repoStatusState(repoRoot));\n        if (!repoStatus[relativePath]) {\n          console.log(\n            \"file status missing in repo status state, fetching individually\",\n            filepath\n          );\n        }\n        return (\n          repoStatus[relativePath] ??\n          convertGitStatus(\n            await status({\n              fs,\n              dir: repoRoot,\n              filepath: relativePath,\n            })\n          )\n        );\n      }\n      return \"NOT_CHANGED\";\n    },\n});\n\nexport const refreshFileStatusCallback =\n  ({ set, snapshot }: CallbackInterface) =>\n  /**\n   * Adds a file or directory to git index\n   * @param fullPath\n   */\n  async (fullPath: string) => {\n    const repoRoot = snapshot.getLoadable(vcsRootForFile(fullPath)).getValue();\n    if (repoRoot) {\n      const relativePath = path.relative(repoRoot, fullPath);\n      const rows = await git.statusMatrix({\n        fs,\n        dir: repoRoot,\n        filepaths: [relativePath],\n      });\n      set(repoStatusState(repoRoot), (statusMap) => {\n        const newStatusMap = {\n          ...statusMap,\n        };\n        if (rows.length === 0) {\n          // if file is removed and doesn't exist in HEAD, it will not appear on the status matrix\n          delete newStatusMap[relativePath];\n        }\n        rows.forEach((row) => {\n          newStatusMap[row[0]] = convertGitStatus(row);\n        });\n        return newStatusMap;\n      });\n    }\n  };\n\nexport const useRefreshFileStatus = (): ((\n  absoluteFilepath: string\n) => Promise<void>) => useRecoilCallback(refreshFileStatusCallback);\n\nexport const useRefreshRepoStatuses = () =>\n  useRecoilCallback(\n    ({ snapshot, set }: CallbackInterface) =>\n      async () => {\n        set(repoStatusUpdatingState, true);\n        try {\n          const gitDirs = await snapshot.getPromise(vcsRootsState);\n          await Promise.all(\n            gitDirs?.map(({ dir, vcs }) =>\n              fetchRepoStatusFromFs(dir).then((repoStatus) => {\n                set(repoStatusState(dir), repoStatus);\n              })\n            )\n          );\n        } finally {\n          set(repoStatusUpdatingState, false);\n        }\n      },\n    []\n  );\n","import { useTheme } from \"styled-components\";\nimport { Theme } from \"@intellij-platform/core\";\nimport { useRecoilValue } from \"recoil\";\nimport { fileStatusState } from \"./file-status.state\";\nimport React from \"react\";\nimport { FileStatus } from \"./file-status\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\n\nexport const useStatusColor = (status: FileStatus) => {\n  const theme = useTheme() as Theme;\n  switch (status) {\n    case \"MODIFIED\":\n      return theme.dark ? \"#6897bb\" : \"#0032a0\"; // FILESTATUS_MODIFIED key from colorScheme\n    case \"ADDED\":\n      return theme.dark ? \"#629755\" : \"#0a7700\"; // FILESTATUS_ADDED key from colorScheme\n    case \"DELETED\":\n      return theme.dark ? \"#6c6c6c\" : \"#616161\"; // FILESTATUS_DELETED key from colorScheme\n    case \"UNKNOWN\":\n      return theme.dark ? \"#d1675a\" : \"#993300\"; // FILESTATUS_UNKNOWN key from colorScheme\n  }\n  return undefined;\n};\nexport const useFileStatusColor = (filepath: string): string | undefined => {\n  const [fileStatus] = useLatestRecoilValue(fileStatusState(filepath));\n  return useStatusColor(fileStatus ?? \"NOT_CHANGED\");\n};\n\nexport const FileStatusColor: React.FC<{\n  filepath: string;\n  children?: React.ReactNode;\n}> = ({ children, filepath }) => {\n  const color = useFileStatusColor(filepath);\n  return <span style={{ color }}>{children}</span>;\n};\n\nexport const StatusColor: React.FC<{\n  status: FileStatus;\n  children?: React.ReactNode;\n}> = ({ children, status }) => {\n  const theme = useTheme() as Theme;\n  const color = theme.currentForegroundAware(useStatusColor(status));\n  return <span style={{ color }}>{children}</span>;\n};\n","import { BalloonManagerAPI, Link } from \"@intellij-platform/core\";\nimport React from \"react\";\n\n/**\n * For ease of use, and to make notImplemented a simple function, not a hook, we set balloon manager in Project.\n * It's intentionally kept in a separate file, to avoid circular dependency caused by many components importing\n * Project.tsx\n * FIXME(multi-project): this should be scoped to project\n */\nexport const _balloonManagerRef: { value: null | BalloonManagerAPI } = {\n  value: null,\n};\n\nexport function notImplemented() {\n  _balloonManagerRef.value?.show({\n    icon: \"Warning\",\n    title: \"Unimplemented action\",\n    body: \"This action is not implemented yet.\",\n    actions: (\n      <>\n        <Link\n          /* TODO: Open a documentation about why some actions are not implemented. */\n          onPress={notImplemented}\n        >\n          Read more...\n        </Link>\n      </>\n    ),\n  });\n}\n","import React from \"react\";\nimport {\n  CommonActionId,\n  styled,\n  useAction,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nconst StyledContainer = styled.div.attrs({ tabIndex: -1 })`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n  justify-content: center;\n  padding: 0 25%;\n  font-size: 1rem;\n  outline: none;\n`;\n\nconst StyledLine = styled.div`\n  display: flex;\n  gap: 0.5rem;\n  margin-bottom: 0.5rem;\n`;\n\nconst StyledShortcut = styled.div`\n  color: ${({ theme }) => theme.commonColors.linkForegroundEnabled};\n`;\n\nexport function EditorZeroState() {\n  return (\n    <StyledContainer>\n      <ActionTip actionId={CommonActionId.GO_TO_FILE} />\n      <ActionTip actionId={CommonActionId.GO_TO_ACTION} />\n    </StyledContainer>\n  );\n}\n\nfunction ActionTip({ actionId }: { actionId: string }) {\n  const getShortcut = useGetActionShortcut();\n  const action = useAction(actionId);\n  return (\n    <StyledLine>\n      {action?.title}\n      <StyledShortcut>{getShortcut(actionId)}</StyledShortcut>\n    </StyledLine>\n  );\n}\n","export const AppActionIds = {\n  PASTE_MULTIPLE: \"PasteMultiple\",\n  GENERATE: \"Generate\",\n};\n","export const editorActionIds = {\n  EXPAND_REGION: \"ExpandRegion\",\n  EXPAND_REGION_RECURSIVELY: \"ExpandRegionRecursively\",\n  EXPAND_ALL_REGIONS: \"ExpandAllRegions\",\n  EXPAND_ALL_TO_LEVEL: \"ExpandToLevel\",\n  EXPAND_ALL_TO_LEVEL1: \"ExpandToLevel1\",\n  EXPAND_ALL_TO_LEVEL2: \"ExpandToLevel2\",\n  EXPAND_ALL_TO_LEVEL3: \"ExpandToLevel3\",\n  EXPAND_ALL_TO_LEVEL4: \"ExpandToLevel4\",\n  EXPAND_ALL_TO_LEVEL5: \"ExpandToLevel5\",\n  COLLAPSE_REGION: \"CollapseRegion\",\n  COLLAPSE_REGION_RECURSIVELY: \"CollapseRegionRecursively\",\n  COLLAPSE_ALL_REGIONS: \"CollapseAllRegions\",\n  COLLAPSE_DOC_COMMENTS: \"CollapseDocComments\",\n  TOGGLE_FOLDING: \"ToggleFolding\",\n  EDITOR_LANG_POPUP_MENU: \"EditorLangPopupMenu\",\n  CompareClipboardWithSelection: \"CompareClipboardWithSelection\",\n};\n","import React, { MutableRefObject } from \"react\";\nimport copyToClipboard from \"clipboard-copy\";\nimport { editor } from \"monaco-editor\";\nimport {\n  ActionContext,\n  ActionGroupDefinition,\n  CommonActionId,\n  PlatformIcon,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { AppActionIds } from \"../appActionIds\";\nimport { editorActionIds } from \"./editorActionIds\";\n\nexport function useEditorActionGroup(\n  editorRef: MutableRefObject<editor.ICodeEditor | undefined>\n): ActionGroupDefinition {\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const editor = editorRef.current;\n  const selection = editor?.getSelection();\n\n  const selectedText = selection // FIXME: needs to become reactive\n    ? editor?.getModel()?.getValueInRange(selection)\n    : \"\";\n\n  return createDefaultActionGroup({\n    id: \"EditorPopupMenu\",\n    title: \"Editor Popup Menu\",\n    description: \"Editor Popup Menu\",\n    children: (\n      [\n        createDefaultActionGroup({\n          id: \"ShowIntentionsGroup\",\n          title: \"Show Intentions Group\",\n          isSearchable: false,\n          menuPresentation: \"section\",\n          children: [\n            {\n              id: \"ShowIntentionActions\",\n              title: \"Show Context Actions\",\n              icon: <PlatformIcon icon=\"actions/intentionBulbGrey.svg\" />,\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        selectedText\n          ? {\n              id: CommonActionId.COPY,\n              title: \"Copy\",\n              icon: <PlatformIcon icon=\"actions/copy\" />,\n              actionPerformed: () => {\n                const selection = editor?.getSelection();\n                const selectedText = selection\n                  ? editor?.getModel()?.getValueInRange(selection)\n                  : \"\";\n                if (selectedText) {\n                  copyToClipboard(selectedText);\n                }\n              },\n            }\n          : null,\n        {\n          id: CommonActionId.PASTE,\n          title: \"Paste\",\n          icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n          actionPerformed: () => {\n            // Note: There doesn't seem to be a way to trigger the default paste action\n            // (without prompting for clipboard API), from a menu UI.\n            // So, selecting \"Paste\" menu item will ask for clipboard permission, and\n            // that's the same in the default Monaco context menu as well.\n            // The difference here is that pasting with ctrl+V works without permission\n            // by default, but because we are handling ctrl+V through the keymap,\n            // even pasting by the shortcut will require permission now.\n            editor?.focus();\n            editor?.trigger(\n              \"keyboard\",\n              \"editor.action.clipboardPasteAction\",\n              {}\n            );\n          },\n        },\n        createDefaultActionGroup({\n          id: \"Copy.Paste.Special\",\n          title: \"Copy / Paste Special\",\n          description: \"Copy / Paste Special Editor Actions\",\n          menuPresentation: \"submenu\",\n          children: [\n            {\n              id: CommonActionId.COPY_REFERENCE,\n              title: \"Copy Reference\",\n              description:\n                \"Copy reference to selected class, method or function, or a relative path to selected file\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n            {\n              // TODO: this action should be scoped to the entire app.\n              //  move it when referencing actions in groups is possible\n              id: AppActionIds.PASTE_MULTIPLE,\n              title: \"Paste from history\",\n              description: \"Paste from recent clipboards\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        \"divider\",\n        createDefaultActionGroup({\n          id: \"FoldingGroup\",\n          title: \"Folding\",\n          menuPresentation: \"submenu\",\n          children: [\n            {\n              id: editorActionIds.EXPAND_REGION,\n              title: \"Expand\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfold\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.EXPAND_REGION_RECURSIVELY,\n              title: \"Expand Recursively\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfoldRecursively\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.EXPAND_ALL_REGIONS,\n              title: \"Expand All\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.unfoldAll\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            {\n              id: editorActionIds.COLLAPSE_REGION,\n              title: \"Collapse\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(source(context), \"editor.fold\", {});\n              },\n            },\n            {\n              id: editorActionIds.COLLAPSE_REGION_RECURSIVELY,\n              title: \"Collapse Recursively\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldRecursively\",\n                  {}\n                );\n              },\n            },\n            {\n              id: editorActionIds.COLLAPSE_ALL_REGIONS,\n              title: \"Collapse All\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldAll\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            createDefaultActionGroup({\n              id: editorActionIds.EXPAND_ALL_TO_LEVEL,\n              title: \"Expand all to level\",\n              menuPresentation: \"submenu\",\n              children: ([1, 2, 3, 4, 5] as const).map((level) => ({\n                id: editorActionIds[`EXPAND_ALL_TO_LEVEL${level}`],\n                title: `${level}`,\n                actionPerformed: (context) => {\n                  editorRef.current?.trigger(\n                    source(context),\n                    `editor.foldLevel${level}`,\n                    {}\n                  );\n                },\n              })),\n            }),\n            \"divider\",\n            {\n              id: editorActionIds.COLLAPSE_DOC_COMMENTS,\n              title: \"Collapse Doc Comments\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.foldAllBlockComments\",\n                  {}\n                );\n              },\n            },\n            \"divider\",\n            {\n              id: editorActionIds.TOGGLE_FOLDING,\n              title: \"Toggle Folding\",\n              actionPerformed: (context) => {\n                editorRef.current?.trigger(\n                  source(context),\n                  \"editor.toggleFold\",\n                  {}\n                );\n              },\n            },\n          ],\n        }),\n        createDefaultActionGroup({\n          id: \"EditorLangPopupMenu\",\n          title: \"EditorLangPopupMenu\",\n          menuPresentation: \"section\",\n          children: [\n            {\n              id: AppActionIds.GENERATE,\n              title: \"Generate...\",\n              actionPerformed: () => {\n                notImplemented();\n              },\n            },\n          ],\n        }),\n        \"divider\",\n        {\n          id: editorActionIds.CompareClipboardWithSelection,\n          title: \"Compare with Clipboard\",\n          description: \"Compare current selection with clipboard\",\n          icon: <PlatformIcon icon=\"actions/diffWithClipboard.svg\" />,\n          actionPerformed: () => {\n            notImplemented();\n          },\n        },\n      ] as const\n    ).filter(notNull),\n  });\n}\n\nfunction source(context: ActionContext): \"keyboard\" | \"mouse\" | \"\" {\n  if (!context.event) {\n    return \"\";\n  }\n  return context.event?.type?.includes(\"key\") ? \"keyboard\" : \"mouse\";\n}\n","import { Monaco } from \"@monaco-editor/react\";\nimport {\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  ContextMenuContainer,\n  EditorTabContent,\n  EditorTabs,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuOverlayFromOrigin,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  TabItem,\n  TooltipTrigger,\n  useAction,\n  useActionGroup,\n  useLatest,\n} from \"@intellij-platform/core\";\nimport { editor, languages } from \"monaco-editor\";\nimport React, { useRef, useState } from \"react\";\nimport { selector, useSetRecoilState } from \"recoil\";\nimport { getIconForFile } from \"../file-utils\";\nimport { LoadingGif } from \"../LoadingGif\";\nimport { Editor } from \"./Editor\";\nimport {\n  activeEditorTabState,\n  editorCursorPositionState,\n  editorRefState,\n  useEditorState,\n} from \"./editor.state\";\nimport { fileContentState } from \"../fs/fs.state\";\nimport { useRefreshFileStatus } from \"../VersionControl/file-status.state\";\nimport * as path from \"path\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useActivePathsProvider } from \"../Project/project.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { useExistingLatestRecoilValue } from \"../recoil-utils\";\nimport { EditorZeroState } from \"./EditorZeroState\";\nimport { useEditorActionGroup } from \"./useEditorActionGroup\";\n\nconst editorFullState = selector({\n  key: \"editorState\",\n  get: ({ get }) => {\n    const activeEditorTab = get(activeEditorTabState);\n    return {\n      ...activeEditorTab,\n      content: get(fileContentState(activeEditorTab?.filePath)),\n    };\n  },\n});\n/**\n * Used as main content in the main ToolWindows. Shows currently opened files tabs and the editor.\n *\n * TODO: preserve editor state when switching between tabs\n * TODO: support multiple editors in split view.\n */\nexport const FileEditor = () => {\n  const [editorTabs, editorStateManager] = useEditorState();\n  const editorRef = useRef<editor.ICodeEditor>();\n  const [active, setActive] = useState(false);\n  const [contextMenu, setContextMenu] =\n    useState<editor.IEditorMouseEvent | null>(null);\n  const hideAllAction = useAction(HIDE_ALL_WINDOWS_ACTION_ID);\n  const setCursorPositionState = useSetRecoilState(editorCursorPositionState);\n\n  const [{ content, filePath }, loadingState] =\n    useExistingLatestRecoilValue(editorFullState);\n\n  // For functions that are needed in tab action callbacks. Because items are cached and referencing anything\n  // other than the collection item (tab) itself has a risk of working with stale data because of the caching\n  // More info: https://react-spectrum.adobe.com/react-stately/collections.html#why-not-array-map\n  // We can alternatively switch to mapping over tabs array, instead of using the Collection's dynamic api (items)\n  // which is subject to this caching.\n  const tabActionsRef = useLatest({\n    closePath: editorStateManager.closePath,\n    closeOthersTabs: editorStateManager.closeOtherTabs,\n  });\n\n  const setEditorRef = useSetRecoilState(editorRefState);\n\n  const setContent = useSetRecoilState(fileContentState(filePath));\n  const updateFileStatus = useRefreshFileStatus();\n\n  const editorActionGroupDefinition = useEditorActionGroup(editorRef);\n\n  const updateContent = (newContent: string = \"\") => {\n    setActive(false);\n    setContent(newContent);\n    if (filePath) {\n      updateFileStatus(filePath).catch((e) => {\n        console.error(\"Could not update file status\", e);\n      });\n    }\n  };\n\n  // For now, when the first tab content is changed, we focus the editor.\n  // FIXME when action system is implemented and there is an action like \"open project file\".\n  // Note that it's event currently buggy\n\n  const activePathsProviderProps = useActivePathsProvider(\n    filePath ? [filePath] : []\n  );\n\n  return (\n    <ActionsProvider actions={[editorActionGroupDefinition]}>\n      {({ shortcutHandlerProps }) => (\n        <StyledFileEditorContainer\n          {...mergeProps(activePathsProviderProps, shortcutHandlerProps, {\n            onFocus: () => {\n              setActive(true);\n              setEditorRef({\n                focus: () => editorRef.current?.focus(),\n              });\n            },\n          })}\n        >\n          {editorTabs.length > 0 ? (\n            <>\n              <ContextMenuContainer\n                renderMenu={() => (\n                  <Menu\n                    // TODO: detect which tab was triggering context menu and handle the action accordingly\n                    //  One idea is to use use the data-key attribute, from the closes parent that has one. Maybe a\n                    //  CollectionContextMenuContainer component which implements that, while ContextMenuContainer is\n                    //  modified to pass the MouseEvent object, in renderMenu.\n                    onAction={notImplemented}\n                  >\n                    <Item key=\"close\">Close</Item>\n                    <Item key=\"closeOthers\">Close Other tabs</Item>\n                    <Item key=\"closeAll\">Close all tabs</Item>\n                    <Item key=\"closeLeft\">Close tabs to the left</Item>\n                    <Item key=\"closeRight\">Close tabs to the right</Item>\n                  </Menu>\n                )}\n              >\n                <EditorTabs\n                  items={editorTabs}\n                  active={active}\n                  selectedKey={filePath}\n                  onSelectionChange={(key) => {\n                    editorStateManager.select(\n                      editorTabs.findIndex((tab) => tab.filePath === key)\n                    );\n                  }}\n                  noBorders\n                >\n                  {(tab) => {\n                    const filename = path.basename(tab.filePath);\n                    const icon = (\n                      <PlatformIcon icon={getIconForFile(tab.filePath)} />\n                    );\n                    return (\n                      <TabItem\n                        key={tab.filePath}\n                        textValue={filename}\n                        inOverflowMenu={\n                          <MenuItemLayout content={filename} icon={icon} />\n                        }\n                      >\n                        <TooltipTrigger\n                          tooltip={<ActionTooltip actionName={tab.filePath} />}\n                        >\n                          <EditorTabContent\n                            icon={icon}\n                            title={\n                              <FileStatusColor filepath={tab.filePath}>\n                                {filename}\n                              </FileStatusColor>\n                            }\n                            closeButton={\n                              <TooltipTrigger\n                                tooltip={\n                                  <ActionTooltip actionName=\"Close. Alt-Click to Close Others\" />\n                                }\n                              >\n                                <TabCloseButton\n                                  onPress={(e) => {\n                                    if (e.altKey) {\n                                      tabActionsRef.current.closeOthersTabs(\n                                        editorTabs.indexOf(tab)\n                                      );\n                                    } else {\n                                      tabActionsRef.current.closePath(\n                                        tab.filePath\n                                      );\n                                    }\n                                  }}\n                                />\n                              </TooltipTrigger>\n                            }\n                            containerProps={{\n                              onDoubleClick: () => {\n                                hideAllAction?.perform();\n                              },\n                            }}\n                          />\n                        </TooltipTrigger>\n                      </TabItem>\n                    );\n                  }}\n                </EditorTabs>\n              </ContextMenuContainer>\n              {typeof content === \"string\" ? (\n                /**\n                 * ## Note\n                 * TLDR: Keeping the editor mounted when filePath changes is intentional and does matter.\n                 *\n                 * Whether the editor component is kept mounted as tabs change or not has nuances that can lead to minor\n                 * focus issues. For example calling editorStateManager.focus() may do nothing if the editor is unmounted due\n                 * to filePath being changed. focusing editor in createFile action is an example of such case. It also affects\n                 * certain focus management code within the FileEditor. For example, focusing the editor on tab changes will\n                 * be necessary if the editor remounts with each file change. Or autofocus behavior of the editor can be\n                 * done on the onMount callback of the Editor component, if it's only mounted once. But the same code leads\n                 * to focus issues if the editor is mounted on active tab changes, when they are not done via the tab UI,\n                 * but as a side effect of another action like opening a file via Project tool window.\n                 *\n                 */\n                <Editor\n                  height=\"100%\"\n                  path={filePath}\n                  options={{ contextmenu: false }}\n                  onMount={(monacoEditor, monaco) => {\n                    monacoEditor.focus();\n                    monacoEditor.onContextMenu((c) => {\n                      c.event.preventDefault();\n                      // opening contextmenu async, because otherwise the editor takes the focus back\n                      // from the menu, right after it's opened.\n                      Promise.resolve().then(() => {\n                        setContextMenu(c);\n                      });\n                    });\n                    monacoEditor.onDidScrollChange(() => {\n                      // It doesn't seem easy to disable scroll on Monaco editor, so just closing the context menu on\n                      // scroll, just like the default Monaco context menu.\n                      setContextMenu(null);\n                    });\n                    enableJsx(monaco);\n                    editorRef.current = monacoEditor;\n                    monacoEditor.onDidChangeCursorPosition((e) => {\n                      setCursorPositionState(e.position);\n                    });\n                    monacoEditor.onDidChangeModel(() => {\n                      // TODO: set the editor tab state, and add an atom effect to persist whole editor state across loads\n                    });\n                  }}\n                  onChange={updateContent}\n                  value={content ?? \"\"}\n                />\n              ) : (\n                content && \"UNSUPPORTED CONTENT\"\n              )}\n            </>\n          ) : (\n            <EditorZeroState />\n          )}\n          {loadingState === \"loading\" && <FileEditorLoading />}\n          {contextMenu && (\n            <MenuOverlayFromOrigin\n              origin={contextMenu.event.browserEvent}\n              onClose={() => setContextMenu(null)}\n            >\n              <EditorActionGroupMenu />\n            </MenuOverlayFromOrigin>\n          )}\n        </StyledFileEditorContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n\nfunction EditorActionGroupMenu() {\n  const actionGroup = useActionGroup(\"EditorPopupMenu\");\n  if (!actionGroup) {\n    return null; // Replace with a placeholder \"Nothing to show\" menu\n  }\n  return (\n    <ActionGroupMenu actionGroup={actionGroup}>\n      {(menuProps) => (\n        <Menu\n          autoFocus={\n            // To avoid autofocusing the first item.\n            true\n          }\n          {...menuProps}\n        />\n      )}\n    </ActionGroupMenu>\n  );\n}\n\nconst StyledFileEditorContainer = styled.div`\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.color(\n      \"Editor.background\",\n      theme.isUnderDarcula()\n        ? \"rgb(40,40,40)\"\n        : theme.commonColors.panelBackground // FIXME: ColorUtil.darker(theme.commonColors.panelBackground, 3)\n    )};\n`;\n\nconst FileEditorLoading = styled(LoadingGif)`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nfunction enableJsx(monaco: Monaco) {\n  monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n    jsx: languages.typescript.JsxEmit.React,\n  });\n\n  monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n    noSemanticValidation: false,\n    noSyntaxValidation: false,\n  });\n}\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport * as Xterm from \"xterm\";\nimport { XTerm } from \"xterm-for-react\";\n\nconst useTerminalXtermOptions = (): Xterm.ITerminalOptions => {\n  return useMemo(\n    () => ({\n      theme: {\n        background: \"rgb(43,43,43)\", // CONSOLE_BACKGROUND_KEY from color scheme\n        selection: \"#214283\", // SELECTION_BACKGROUND?\n        // TODO: more colors\n      },\n      fontFamily: \"sans-serif\",\n      letterSpacing: -8,\n      fontSize: 12,\n      lineHeight: 1.3,\n      cursorStyle: \"block\",\n      cursorBlink: true,\n      cursorWidth: 8,\n      rendererType: \"dom\",\n    }),\n    []\n  );\n};\n\nconst StyledXterm = styled(XTerm)`\n  height: 100%;\n  background: rgb(43, 43, 43); // CONSOLE_BACKGROUND_KEY from color scheme\n`;\nexport const Terminal = (): React.ReactElement => {\n  const [input, setInput] = useState(\"\");\n  const xtermRef = useRef<XTerm | null>(null);\n\n  const options = useTerminalXtermOptions();\n  const PROMPT = \"$ \";\n  useEffect(() => {\n    setTimeout(() => {\n      xtermRef.current?.terminal.resize(80, 10);\n      xtermRef.current?.terminal.write(PROMPT);\n    }, 3000);\n  }, []);\n  return (\n    <StyledXterm\n      ref={xtermRef}\n      options={options}\n      onData={(data) => {\n        const code = data.charCodeAt(0);\n        // If the user hits empty and there is something typed echo it.\n        if (code === 13) {\n          if (input.length > 0) {\n            xtermRef.current?.terminal.write(\"\\r\\nYou typed: '\" + input + \"'\");\n          }\n          xtermRef.current?.terminal.write(\"\\r\\n\" + PROMPT);\n          setInput(\"\");\n        } else if (code < 32 || code === 127) {\n          // Disable control Keys such as arrow keys\n          return;\n        } else {\n          // Add general key press characters to the terminal\n          xtermRef.current?.terminal.write(data);\n          setInput(input + data);\n        }\n      }}\n    />\n  );\n};\n","import { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  CallbackInterface,\n  GetRecoilValue,\n  selector,\n  useRecoilCallback,\n} from \"recoil\";\nimport { currentProjectState, Project } from \"../Project/project.state\";\nimport { dirContentState, FsItem } from \"../fs/fs.state\";\nimport { filterPath } from \"../Project/project-utils\";\nimport { getParentPaths } from \"../file-utils\";\nimport { vcsRootsState } from \"../VersionControl/file-status.state\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\ninterface FileTreeNodeBase {\n  parent: (FileTreeNodeBase & { children: FsItem[] }) | null;\n  name: string;\n}\n\nexport type FileTreeDirNode = FileTreeNodeBase &\n  FsItem & {\n    children: FileTreeNode[];\n  };\nexport type FileTreeFileNode = FileTreeNodeBase & FsItem;\nexport type FileTreeNode = FileTreeFileNode | FileTreeDirNode;\n\ninterface ProjectTreeRoot extends FileTreeNodeBase {\n  type: \"project\";\n  path: string;\n  children: FileTreeNode[];\n}\n\nexport type ProjectTreeNode =\n  | ProjectTreeRoot\n  | ProjectTreeRoot[\"children\"][number]; // type def can be improved\n\nexport const foldersOnTopState = atom({\n  key: \"projectView.foldersOnTop\",\n  default: true,\n});\n\nexport const expandedKeysState = atom({\n  key: \"projectView.expandedKeys\",\n  default: selector({\n    key: \"projectView.expandedKeys/default\",\n    get: ({ get }) =>\n      new Set<Key>(\n        get(vcsRootsState)\n          .flatMap(({ dir }) => getParentPaths(dir).concat(dir))\n          .concat(get(currentProjectState).path)\n      ),\n  }),\n});\n\nexport const selectionState = atom<Selection>({\n  key: \"projectView.selection\",\n  default: new Set<Key>([]),\n});\n\nexport const selectedNodesState = selector<ReadonlyArray<ProjectTreeNode>>({\n  key: \"projectView.selectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectionState);\n    const nodesByKey = get(currentProjectTreeState).byKey;\n    const selectedKeys = selection === \"all\" ? nodesByKey.keys() : selection;\n    return [...selectedKeys]\n      .map((key) => nodesByKey.get(`${key}`))\n      .filter(notNull);\n  },\n});\n\nexport const projectViewTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"projectView.focusHandle\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const currentProjectTreeState = selector({\n  key: \"projectTree\",\n  get: ({ get }) => {\n    const project = get(currentProjectState);\n    return createProjectTree(project, get);\n  },\n});\n\ntype FilesTreeSort = \"name\"; // more to be added\n\n// TODO: add more sort options and add \"Tree Appearance\" option in Project tool window settings menu.\nexport const projectTreeSortState = atom<FilesTreeSort>({\n  key: \"project.tree.sort\",\n  default: \"name\",\n});\n\n/**\n * NOTE: using in-place native sort for performance.\n * See more https://www.measurethat.net/Benchmarks/Show/6698/0/ramda-sort-vs-js-native-sort\n */\nfunction sortProjectTreeNodes(items: FileTreeNode[]): void {\n  // TODO: add sortBy: FileTreeSort parameter\n  // TODO: add directoriesOnTop: boolean parameter\n  items.sort((item1, item2) => {\n    if (item1.name < item2.name) {\n      return -1;\n    }\n    if (item1.name > item2.name) {\n      return 1;\n    }\n    return 0;\n  });\n}\n\n// NOTE: this function could be sync, and those `await`s before `get` are unnecessary. They are there simply because\n// I didn't realize `get` returns the value, not Promise. But interestingly, when this function is made sync,\n// performance drastically drops for some reason. That needs to be investigated.\nasync function createProjectTree(\n  project: Project,\n  get: GetRecoilValue\n): Promise<{ root: ProjectTreeRoot; byKey: Map<string, ProjectTreeNode> }> {\n  const rootItems = get(dirContentState(project.path));\n  const byKey = new Map<string, ProjectTreeNode>();\n  const mapItem =\n    (parent: FileTreeDirNode | null) =>\n    async (item: FsItem): Promise<FileTreeNode | null> => {\n      const node = {\n        ...item,\n        parent,\n      };\n      if (item.type === \"dir\") {\n        if (filterPath(item)) {\n          const dirNode: FileTreeDirNode = { ...node, children: [] };\n          dirNode.children = (\n            await Promise.all(\n              (get(dirContentState(item.path)) ?? ([] as FsItem[])).map(\n                mapItem(dirNode)\n              )\n            )\n          ).filter(notNull);\n          sortProjectTreeNodes(dirNode.children);\n          byKey.set(dirNode.path, dirNode);\n          return dirNode;\n        }\n        return null;\n      }\n      byKey.set(node.path, node);\n      return node;\n    };\n\n  const children = (\n    await Promise.all((rootItems || []).map(mapItem(null)))\n  ).filter(notNull);\n  sortProjectTreeNodes(children);\n  const root: ProjectTreeNode = {\n    type: \"project\",\n    path: project.path,\n    name: project.name,\n    parent: null,\n    children,\n  };\n  byKey.set(root.path, root);\n  return { root, byKey };\n}\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for expanding to a certain path in project view.\n * @param snapshot\n * @param set\n */\nexport const expandToPathCallback =\n  ({ snapshot, set }: CallbackInterface) =>\n  (path: string) => {\n    const expandedKeys = snapshot.getLoadable(expandedKeysState).valueOrThrow();\n    const keysToExpand = [\n      snapshot.getLoadable(currentProjectState).valueOrThrow().path,\n    ].concat(getParentPaths(path));\n    set(expandedKeysState, new Set([...expandedKeys, ...keysToExpand]));\n  };\n\n/**\n * a function to be passed to useRecoilCallback to get back a callback for selecting a file in project view and focusing\n * the project view.\n * // TODO: open project view tool window if needed, when tool window state is also moved to recoil instead of local\n * //  state.\n */\nexport const selectKeyAndFocusCallback =\n  ({ snapshot }: CallbackInterface) =>\n  (key: Key) => {\n    const treeRef = snapshot\n      .getLoadable(projectViewTreeRefState)\n      .valueOrThrow()?.current;\n    treeRef?.replaceSelection(key);\n    treeRef?.focus(key);\n  };\n\nexport const useSelectPathInProjectView = () => {\n  const expandToOpenedFile = useRecoilCallback(expandToPathCallback, []);\n  const selectKeyAndFocus = useRecoilCallback(selectKeyAndFocusCallback, []);\n  return (path: string) => {\n    expandToOpenedFile(path);\n    selectKeyAndFocus(path);\n  };\n};\n","export const projectActionIds = {\n  NewElement: \"NewElement\",\n  NewFile: \"NewFile\",\n  NewDir: \"NewDir\",\n  CopyReferencePopupGroup: \"CopyReferencePopupGroup\",\n  CopyPaths: \"CopyPaths\",\n  CopyFileReference: \"CopyFileReference\",\n  CopyAbsolutePath: \"CopyAbsolutePath\",\n  CopySourceRootPath: \"CopySourceRootPath\",\n  CopyFileName: \"CopyFileName\",\n};\n","import {\n  ActionContext,\n  ActionsMenu,\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport React from \"react\";\nimport { projectActionIds } from \"../Project/projectActionIds\";\n\nexport function ProjectViewContextMenu({\n  getActionContext,\n}: {\n  getActionContext: () => ActionContext;\n}) {\n  return (\n    <ActionsMenu\n      aria-label=\"Project Tree actions\"\n      actionContext={getActionContext}\n      actions={[\n        {\n          ...useAction(projectActionIds.NewElement)!,\n          title: \"New\",\n          shortcut: undefined,\n        },\n        new DividerItem(),\n        useAction(CommonActionId.CUT),\n        useAction(CommonActionId.COPY),\n        useAction(projectActionIds.CopyReferencePopupGroup),\n        useAction(CommonActionId.PASTE),\n        new DividerItem(),\n        useAction(CommonActionId.DELETE),\n        new DividerItem(),\n      ].filter(notNull)}\n    />\n  );\n}\n","import {\n  ActionContext,\n  ContextMenuContainer,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  SpeedSearchTree,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport { identity, sortBy } from \"ramda\";\nimport React, { useContext, useLayoutEffect, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { DefaultSuspense } from \"../DefaultSuspense\";\nimport { useEditorStateManager } from \"../Editor/editor.state\";\nimport { DIR_ICON, FILE_ICON, getIconForFile } from \"../file-utils\";\nimport {\n  currentProjectState,\n  useActivePathsProvider,\n} from \"../Project/project.state\";\nimport {\n  currentProjectTreeState,\n  expandedKeysState,\n  FileTreeDirNode,\n  FileTreeFileNode,\n  FileTreeNode,\n  foldersOnTopState,\n  ProjectTreeNode,\n  projectViewTreeRefState,\n  selectionState,\n} from \"./ProjectView.state\";\nimport { FileStatusColor } from \"../VersionControl/FileStatusColor\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\nimport { ProjectViewContextMenu } from \"./ProjectViewContextMenu\";\n\nexport const ProjectViewPane = (): React.ReactElement => {\n  const project = useRecoilValue(currentProjectState);\n  const editor = useEditorStateManager();\n  const treeRef = useRef<TreeRefValue>(null);\n  const setProjectViewTreeRef = useSetRecoilState(projectViewTreeRefState);\n  useLayoutEffect(() => {\n    setProjectViewTreeRef(treeRef);\n  }, [treeRef]);\n\n  const [treeState] = useLatestRecoilValue(currentProjectTreeState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectionState);\n  const foldersOnTop = useRecoilValue(foldersOnTopState);\n\n  const sortItems = foldersOnTop\n    ? sortBy<ProjectTreeNode>((a) => (a.type === \"dir\" ? 1 : 2))\n    : identity;\n\n  const selectedKeysArray =\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].filter((i): i is string => typeof i === \"string\");\n  const activePathsProviderProps = useActivePathsProvider(selectedKeysArray);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contextMenuTargetKey = useRef<string | undefined>();\n\n  /**\n   * A (temporary?) non-straightforward way to position popups (action groups with \"none\" menuPresentation\")\n   * relative to the tree node content.\n   * It's implemented like this because the context menu API at the moment is too generic and disconnected from\n   * components like Tree.\n   * At minimum, this logic here can be extracted into a wrapper like TreeContextMenuContainer for reusability.\n   */\n  const getActionContext = (): ActionContext => {\n    return {\n      element:\n        containerRef.current?.querySelector(\n          `[data-key=\"${contextMenuTargetKey.current}\"]`\n        ) ?? null,\n      event: null,\n    };\n  };\n\n  return (\n    <DefaultSuspense>\n      {treeState?.root && (\n        <ContextMenuContainer\n          ref={containerRef}\n          style={{ height: \"100%\" }}\n          onOpen={({ target }) =>\n            (contextMenuTargetKey.current =\n              target?.closest<HTMLElement>(\"[data-key]\")?.dataset.key)\n          }\n          renderMenu={() => {\n            return (\n              <ProjectViewContextMenu getActionContext={getActionContext} />\n            );\n          }}\n        >\n          <SpeedSearchTree\n            aria-label=\"Project structure tree\"\n            treeRef={treeRef}\n            {...activePathsProviderProps}\n            items={[treeState.root] as ProjectTreeNode[]}\n            onAction={(path) => {\n              editor.openPath(`${path}`);\n            }}\n            fillAvailableSpace\n            autoFocus\n            selectionMode=\"multiple\"\n            selectedKeys={selectedKeys}\n            onSelectionChange={setSelectedKeys}\n            expandedKeys={expandedKeys}\n            onExpandedChange={setExpandedKeys}\n          >\n            {(item) => (\n              <Item\n                key={item.path}\n                textValue={item.name}\n                childItems={\n                  \"children\" in item ? sortItems(item.children) : undefined\n                }\n              >\n                <ItemLayout>\n                  {<ProjectViewNodeIcon node={item} />}\n                  {item.type === \"project\" ? (\n                    <>\n                      <b>\n                        <HighlightedTextValue />\n                      </b>\n                      <ItemLayout.Hint>{project.path}</ItemLayout.Hint>\n                    </>\n                  ) : (\n                    <FileTreeNodeText node={item} />\n                  )}\n                  {/* {\"loadingState\" in item &&\n                      item.loadingState === \"loading\" && (\n                        <TreeNodeHint>\n                          <Img height={16} src={loading} darkSrc={loadingDark} />\n                        </TreeNodeHint>\n                      )}*/}\n                </ItemLayout>\n              </Item>\n            )}\n          </SpeedSearchTree>\n        </ContextMenuContainer>\n      )}\n    </DefaultSuspense>\n  );\n};\n\nconst FileTreeNodeText = ({ node }: { node: FileTreeNode }) => {\n  return node.type === \"dir\" ? (\n    // why is the explicit casting necessary? :/ isn't \"type\" enough for TS to figure out the right type?\n    <FileTreeDirNodeText node={node as FileTreeDirNode} />\n  ) : (\n    <FileTreeFileNodeText node={node as FileTreeFileNode} />\n  );\n};\n\nconst FileTreeDirNodeText = ({}: { node: FileTreeFileNode }) => (\n  // TODO: add support for \"Highlight directories that contain modified files in the Project tree\" (showDirtyRecursively)\n  <HighlightedTextValue />\n);\n\nconst FileTreeFileNodeText = ({\n  node,\n}: {\n  node: FileTreeFileNode;\n}): React.ReactElement => {\n  const state = useContext(ItemStateContext);\n  return state?.isSelected && state?.isContainerFocused ? (\n    <HighlightedTextValue />\n  ) : (\n    <FileStatusColor filepath={node.path}>\n      <HighlightedTextValue />\n    </FileStatusColor>\n  );\n};\n\nconst nodeTypeIconMap: { [key in ProjectTreeNode[\"type\"]]?: string } = {\n  project: \"nodes/folder\",\n  dir: DIR_ICON,\n  file: FILE_ICON,\n};\n\nfunction findNodeIcon(value: ProjectTreeNode): string | null {\n  if (value.type === \"file\") {\n    return getIconForFile(value.name);\n  }\n  return nodeTypeIconMap[value.type] ?? null;\n}\n\nfunction ProjectViewNodeIcon({\n  node,\n}: {\n  node: ProjectTreeNode;\n}): React.ReactElement {\n  const icon = findNodeIcon(node);\n  return <>{icon && <PlatformIcon icon={icon} />}</>;\n}\n","import React from \"react\";\nimport {\n  Button,\n  ButtonProps,\n  HelpTooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nexport function HelpButton({\n  tooltip = \"Show help contents\",\n  ...props\n}: Omit<ButtonProps, \"variant\" | \"children\"> & { tooltip?: string }) {\n  return (\n    <TooltipTrigger tooltip={<HelpTooltip helpText={tooltip} />}>\n      <Button\n        variant=\"icon\"\n        aria-label=\"Help\"\n        aria-description=\"Show help contents\"\n        {...props}\n      >\n        <span style={{ fontSize: 18 }}>?</span>\n      </Button>\n    </TooltipTrigger>\n  );\n}\n","import path from \"path\";\nimport { identity } from \"ramda\";\n\nexport function isParentPath(parent: string, dir: string) {\n  return dir.startsWith(parent + path.sep); // is this good enough, or do we need the code below?\n  // const relative = path.relative(parent, dir);\n  // return relative && !relative.startsWith(\"..\") && !path.isAbsolute(relative);\n}\n\n/**\n * Given a list of paths, returns a subset of them, where nested paths are removed.\n * @example findRoots(['/a/b/c/x.txt', '/a/b', '/a/b/c', '/a/b/y.ts']); // ['/a/b']\n * @example findRoots([{p: '/a/b'}, {p: '/a'}]); // [{p: '/a'}]\n */\nexport function findRootPaths(paths: readonly string[]): string[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string\n): T[];\nexport function findRootPaths<T>(\n  objects: readonly T[],\n  getPath: (obj: T) => string = identity as (obj: T) => string\n): T[] {\n  return objects.filter((obj) => {\n    const thePath = getPath(obj);\n    return !objects.find(\n      (anObject) => anObject !== obj && isParentPath(getPath(anObject), thePath)\n    );\n  });\n}\n","import { CallbackInterface } from \"recoil\";\nimport {\n  refreshFileStatusCallback,\n  vcsRootForFile,\n} from \"../VersionControl/file-status.state\";\nimport { editorManagerState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\nimport git from \"isomorphic-git\";\nimport path from \"path\";\nimport { dirContentState, fileContentState } from \"../fs/fs.state\";\nimport { ensureDir } from \"../fs/fs-utils\";\n\nexport const deleteFileCallback =\n  (callbackInterface: CallbackInterface) => async (filepath: string) => {\n    const { refresh, reset, snapshot } = callbackInterface;\n    const refreshFileStatus = refreshFileStatusCallback(callbackInterface);\n    const releaseSnapshot = snapshot.retain();\n    try {\n      try {\n        await fs.promises.unlink(filepath);\n        const repoDir = await snapshot.getPromise(vcsRootForFile(filepath));\n        if (repoDir) {\n          await git.remove({\n            fs,\n            dir: repoDir,\n            filepath: path.relative(repoDir, filepath),\n          });\n          await refreshFileStatus(filepath); // TODO(fs.watch): better done separately using fs.watch\n        }\n      } catch (e) {\n        console.error(`error in deleting file ${filepath}`, e);\n      } finally {\n        const editor = await snapshot.getPromise(editorManagerState);\n        editor.closePath(filepath); // TODO(fs.watch): better done as an effect on editorState, using fs.watch. But fs.watch is not available at the moment.\n        refresh(dirContentState(path.dirname(filepath))); // TODO(fs.watch): better done separately using fs.watch\n        reset(fileContentState(filepath)); // TODO(fs.watch): better done separately using fs.watch\n      }\n    } finally {\n      releaseSnapshot();\n    }\n  };\n\nexport const deleteFilesCallback =\n  (callbackInterface: CallbackInterface) => async (filePaths: string[]) => {\n    // TODO: use task API\n    // An attempt to make this transactional failed, since it requires passing `set` and `reset` from transact function\n    // to deleteFileCallback, and {...callbackInterface, set, reset} didn't work , since callbackInterface is a proxy object\n    const deleteFile = deleteFileCallback(callbackInterface);\n    return Promise.all(filePaths.map(deleteFile));\n  };\n\nexport const deleteDirCallback =\n  (callbackInterface: CallbackInterface) => async (dir: string) => {\n    // TODO: use task API\n    const { refresh, reset, snapshot } = callbackInterface;\n    const deleteFile = deleteFileCallback(callbackInterface);\n    const releaseSnapshot = snapshot.retain();\n    const recursivelyDeleteDir = async (dirname: string) => {\n      const pathnames = await fs.promises.readdir(dirname);\n      await Promise.all(\n        pathnames.map(async (pathname) => {\n          const fullpath = path.resolve(dirname, pathname);\n          const stat = await fs.promises.stat(fullpath);\n          if (stat.isFile()) {\n            // potential improvement: refreshing dir content could wait until all files are deleted.\n            await deleteFile(fullpath);\n          } else if (stat.isDirectory()) {\n            await recursivelyDeleteDir(fullpath);\n          }\n        })\n      );\n      await fs.promises.rmdir(dirname);\n      refresh(dirContentState(dir));\n    };\n    try {\n      try {\n        await recursivelyDeleteDir(dir);\n      } catch (e) {\n        console.error(`error in deleting directory ${dir}`, e);\n      } finally {\n        refresh(dirContentState(path.dirname(dir))); // TODO(fs.watch): better done separately using fs.watch\n      }\n    } finally {\n      releaseSnapshot();\n    }\n  };\n\nexport const createFileCallback = (callbackInterface: CallbackInterface) => {\n  const refreshFileStatus = refreshFileStatusCallback(callbackInterface);\n  return async (destinationDir: string, filename: string) => {\n    const filePath = path.join(destinationDir, filename);\n    const { snapshot, refresh, reset } = callbackInterface;\n    const releaseSnapshot = snapshot.retain();\n    try {\n      await ensureDir(fs.promises, path.dirname(filePath));\n      if (await fs.promises.exists(filePath)) {\n        throw new Error(`File ${filePath} already exists`);\n      }\n      await fs.promises.writeFile(filePath, \"\", \"utf-8\");\n      reset(fileContentState(filePath)); // TODO(fs.watch): better done in an atom effect\n      (await snapshot.getPromise(editorManagerState)).openPath(filePath);\n      await refreshFileStatus(filePath);\n      refresh(dirContentState(destinationDir));\n    } finally {\n      releaseSnapshot();\n    }\n  };\n};\n\nexport const createDirectoryCallback = (\n  callbackInterface: CallbackInterface\n) => {\n  return async (destination: string, dirPath: string) => {\n    const { snapshot, refresh, reset } = callbackInterface;\n    const releaseSnapshot = snapshot.retain();\n    const fullpath = path.join(destination, dirPath);\n    try {\n      if (await fs.promises.exists(fullpath)) {\n        throw new Error(`File ${fullpath} already exists`);\n      }\n      await ensureDir(fs.promises, fullpath);\n      refresh(dirContentState(destination));\n    } finally {\n      releaseSnapshot();\n    }\n  };\n};\n","import path from \"path\";\nimport { selector } from \"recoil\";\nimport React from \"react\";\n\nimport {\n  ActionDefinition,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ModalWindow,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { HelpButton } from \"../../HelpButton\";\nimport {\n  activePathExistsState,\n  alertDialogRefState,\n  windowManagerRefState,\n} from \"../../Project/project.state\";\nimport { selectedNodesState } from \"../ProjectView.state\";\nimport { findRootPaths } from \"../../path-utils\";\nimport {\n  deleteDirCallback,\n  deleteFilesCallback,\n} from \"../../Project/fs-operations\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nconst dirCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 directory}\n    other {# directories}\n  }`,\n  \"en-US\"\n);\n\nexport const deleteActionState = selector({\n  key: `action.${CommonActionId.DELETE}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.DELETE,\n    title: \"Delete\",\n    description: \"Delete selected item\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      const deleteDir = getCallback(deleteDirCallback);\n      const deleteFiles = getCallback(deleteFilesCallback);\n      const selectedNodes = snapshot.getLoadable(selectedNodesState).getValue();\n      const windowManager = snapshot\n        .getLoadable(windowManagerRefState)\n        .getValue().current;\n      const alertDialog = snapshot\n        .getLoadable(alertDialogRefState)\n        .getValue().current;\n      if (selectedNodes.length === 0) {\n        return;\n      }\n      const nodesToDelete = findRootPaths(selectedNodes, (node) => node.path);\n      const filePaths = nodesToDelete\n        .filter((node) => node.type === \"file\")\n        .map((node) => node.path);\n      const directories = nodesToDelete\n        .filter((node) => node.type === \"project\" || node.type === \"dir\")\n        .map((node) => node.path);\n\n      if (directories.length > 0) {\n        const singleDirName =\n          directories.length === 1 && filePaths.length === 0\n            ? path.basename(directories[0])\n            : null;\n\n        const confirmed = await alertDialog?.confirm({\n          title: \"Delete\",\n          okText: \"Delete\",\n          message: (\n            <div style={{ width: 354 }}>\n              Delete{\" \"}\n              {singleDirName\n                ? `\"${singleDirName}\"`\n                : [\n                    { count: directories.length, message: dirCountMsg },\n                    { count: filePaths.length, message: fileCountMsg },\n                  ]\n                    .filter(({ count }) => count > 0)\n                    .map(({ message, count }) => message.format({ count }))\n                    .join(\" and \")}\n              ?\n              <br />\n              All files and subdirectories in\n              {singleDirName\n                ? ` \"${singleDirName}\" `\n                : \" the selected directories \"}\n              will be deleted. <br />\n              You might not be able to fully undo this operation!\n            </div>\n          ),\n        });\n        if (confirmed) {\n          directories.forEach((pathname) => deleteDir(pathname));\n          deleteFiles(filePaths);\n        }\n      } else {\n        windowManager\n          ?.open<boolean>(({ close }) => (\n            <DeleteFilesConfirmationDialog\n              filePaths={filePaths}\n              close={close}\n            />\n          ))\n          .then((confirmed) => {\n            if (confirmed) {\n              requestAnimationFrame(() => {\n                // It's important that the focus is restored to the previously focused item, which typically is the\n                // file in project view, that's being deleted.\n                // If the file is deleted before the focus is restored, the DOM element that was going to be focused\n                // will be removed by the time focus restoration logic runs.\n                // Even though `windowManager.open()` was changed to return a promise which is supposed to be resolved\n                // **after** the modal window is closed,\n                // in the CI environment the focus is not properly restored.\n                // In lack of a better solution, the deletion is done async with a setTimeout.\n                deleteFiles(filePaths);\n              });\n            }\n          });\n      }\n    }),\n  }),\n});\n\nfunction DeleteFilesConfirmationDialog({\n  close,\n  filePaths,\n}: {\n  close: (confirmed?: true) => void;\n  filePaths: string[];\n}) {\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Delete\"\n        content={\n          <form\n            id=\"delete_dialog_form\"\n            onSubmit={(e) => {\n              e.preventDefault();\n            }}\n            style={{\n              padding: \"0.75rem 1rem\",\n            }}\n          >\n            <div style={{ marginBottom: \".5rem\" }}>\n              {filePaths.length === 1\n                ? `Delete file \"${path.basename(filePaths[0])}\"`\n                : `Delete ${filePaths.length} files`}\n              ?\n            </div>\n            <div\n              style={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                gap: \"0.25rem\",\n              }}\n            >\n              <Checkbox isDisabled>Safe delete (with usage search)</Checkbox>\n              <div style={{ display: \"flex\", gap: \"1rem\" }}>\n                <Checkbox isDisabled>Search in comments and strings</Checkbox>\n                <Checkbox isDisabled>Search for text occurrences</Checkbox>\n              </div>\n            </div>\n          </form>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<HelpButton onPress={() => notImplemented()}></HelpButton>}\n            right={\n              <>\n                <Button onPress={() => close()}>Cancel</Button>\n                <Button\n                  autoFocus\n                  type=\"submit\"\n                  form=\"delete_dialog_form\" // Using form in absence of built-in support for default button\n                  variant=\"default\"\n                  onPress={() => {\n                    close(true);\n                  }}\n                >\n                  Ok\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import React from \"react\";\nimport { selector } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsState } from \"../../Project/project.state\";\n\nexport const copyActionState = selector({\n  key: `action.${CommonActionId.COPY}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.COPY,\n    title: \"Copy\",\n    description: \"Copy to clipboard\",\n    icon: <PlatformIcon icon=\"actions/copy\" />,\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n    }),\n  }),\n});\n","import React from \"react\";\nimport { selector } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsState } from \"../../Project/project.state\";\n\nexport const cutActionState = selector({\n  key: `action.${CommonActionId.CUT}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.CUT,\n    title: \"Cut\",\n    description: \"Cut to clipboard\",\n    icon: <PlatformIcon icon=\"actions/menu-cut\" />,\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n    }),\n  }),\n});\n","import React from \"react\";\nimport { selector } from \"recoil\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { activePathExistsState } from \"../../Project/project.state\";\n\nexport const pasteActionState = selector({\n  key: `action.${CommonActionId.PASTE}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.PASTE,\n    title: \"Paste\",\n    description: \"Paste from clipboard\",\n    icon: <PlatformIcon icon=\"actions/menu-paste\" />,\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n    }),\n  }),\n});\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  CommonActionId,\n  DefaultToolWindow,\n  PlatformIcon,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport {\n  projectViewTreeRefState,\n  useSelectPathInProjectView,\n} from \"./ProjectView.state\";\nimport { ProjectViewPane } from \"./ProjectViewPane\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { ProjectViewActionIds } from \"./ProjectViewActionIds\";\nimport { deleteActionState } from \"./actions/deleteAction\";\nimport { copyActionState } from \"./actions/copyAction\";\nimport { cutActionState } from \"./actions/cutAction\";\nimport { pasteActionState } from \"./actions/pasteAction\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nconst { SELECT_IN_PROJECT_VIEW } = ProjectViewActionIds;\n\nexport function ProjectToolWindow() {\n  const treeRef = useRecoilValue(projectViewTreeRefState);\n  const actions = useTreeActions({ treeRef });\n  // TODO: SelectInProjectView should be provided at project level, allowing potential shortcut to be globally\n  //  accessible, and allowing other UI parts than editor's active tab, to set the context of \"file\" which needs to be\n  //  opened in project view.\n  const projectViewActions = useProjectViewActions();\n  return (\n    <DefaultToolWindow\n      headerContent=\"Project\"\n      actions={[...actions, ...projectViewActions]}\n      additionalActions={\n        <>\n          <ActionButton actionId={SELECT_IN_PROJECT_VIEW} />\n          <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n          <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n        </>\n      }\n    >\n      <ProjectViewPane />\n    </DefaultToolWindow>\n  );\n}\n\nfunction useProjectViewActions(): Array<ActionDefinition> {\n  // improvement: for rendering, we only depend on whether activeTab is null or not. A selector can be defined for that\n  // to prevent unnecessary re-rendering. The active tab, could be read from the state snapshot, in the handler callback.\n  const activeTab = useRecoilValue(activeEditorTabState);\n\n  const selectPathInProjectView = useSelectPathInProjectView();\n  const selectOpenedFile = () => {\n    if (activeTab) {\n      selectPathInProjectView(activeTab.filePath);\n    }\n  };\n\n  return [\n    {\n      id: SELECT_IN_PROJECT_VIEW,\n      title: \"Select Opened File\",\n      icon: <PlatformIcon icon=\"general/locate\" />,\n      actionPerformed: selectOpenedFile,\n      isDisabled: !activeTab,\n      description: \"Selects a context file in the Project View\",\n    },\n    useRecoilValue(deleteActionState), // could have been on project level, if it could handle delete in editor as well\n    useRecoilValue(cutActionState),\n    useRecoilValue(copyActionState),\n    useRecoilValue(pasteActionState),\n  ].filter(notNull);\n}\n","export const ProjectViewActionIds = {\n  SELECT_IN_PROJECT_VIEW: \"SelectInProjectView\",\n};\n","import React, { ReactNode, useEffect, useState } from \"react\";\n\nconst DEFAULT_LOADING_DELAY_MS = 500; // To be shared later in more places.\nexport function Delayed({ children }: { children: ReactNode }) {\n  const [waitedEnough, setWaitedEnough] = useState(false);\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setWaitedEnough(true);\n    }, DEFAULT_LOADING_DELAY_MS);\n    return () => clearTimeout(timer);\n  }, []);\n  if (waitedEnough) {\n    return <>{children}</>;\n  }\n  return null;\n}\n","import { FileStatus } from \"../file-status\";\nimport { dirname } from \"path\";\n\nexport type Revision = {\n  path: string;\n  isDir: boolean;\n  hash?: string;\n  content(): Promise<string>;\n};\n\ndeclare const __tag: unique symbol;\n\ntype ChangeVariant<T extends { type: string }> = T & {\n  /**\n   * A non-exported tag is used to make opaque types that can only be created by Change function, following\n   * \"parse, don't validate\" rule, enforcing certain rules that defines the change type based on the\n   * presence and properties of the before and after revisions.\n   */\n  readonly [__tag]: any;\n};\n\n/**\n * Represents a file being moved from one directory to another, which may or may not have been renamed too.\n */\nexport type MoveChange = ChangeVariant<{\n  type: \"MOVED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being renamed withing the same directory.\n */\nexport type RenameChange = ChangeVariant<{\n  type: \"RENAMED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a file being changed, but not moved or renamed.\n */\nexport type ModificationChange = ChangeVariant<{\n  type: \"MODIFIED\";\n  before: Revision;\n  after: Revision;\n}>;\n\n/**\n * Represents a path being deleted.\n */\nexport type DeletionChange = ChangeVariant<{\n  type: \"DELETED\";\n  before: Revision;\n}>;\n\n/**\n * Represents a new file\n */\nexport type AdditionChange = ChangeVariant<{\n  type: \"ADDED\";\n  after: Revision;\n}>;\n\n/**\n * Represents an unversioned (new) file. In git terms, a file that doesn't exist in index or HEAD.\n */\nexport type UnversionedChange = ChangeVariant<{\n  type: \"UNVERSIONED\";\n  after: Revision;\n}>;\n\nexport type AnyChange =\n  | AdditionChange\n  | MoveChange\n  | RenameChange\n  | ModificationChange\n  | DeletionChange\n  | UnversionedChange;\n\nconst Tagged = <T>(change: T): T & { [__tag]: any } =>\n  change as T & { [__tag]: any };\n\n/**\n * Creates change objects from before and after revisions. It creates the right type of change\n * depending on the presence and properties of `before` and `after` revisions.\n * Note: Use Change.Unversioned(revision) to create unversioned changes.\n */\nexport function Change(before: null, after: Revision): Readonly<AdditionChange>;\nexport function Change(before: Revision, after: null): Readonly<DeletionChange>;\nexport function Change(\n  before: Revision,\n  after: Revision\n): Readonly<ModificationChange | RenameChange | MoveChange>;\nexport function Change(\n  before: Revision | null,\n  after: Revision | null\n): AnyChange {\n  if (after) {\n    if (!before) {\n      return Tagged({\n        type: \"ADDED\",\n        after,\n      });\n    }\n    if (before.path !== after.path) {\n      if (dirname(before.path) === dirname(after.path)) {\n        return Tagged({\n          type: \"RENAMED\",\n          before,\n          after,\n        });\n      } else {\n        return Tagged({\n          type: \"MOVED\",\n          before,\n          after,\n        });\n      }\n    }\n    return Tagged({\n      type: \"MODIFIED\",\n      before,\n      after,\n    });\n  } else {\n    return Tagged({\n      type: \"DELETED\",\n      before: before!, // \"!\" because typescript has an issue recognizing after and before can't be null simultaneously\n    });\n  }\n}\n\n/**\n * Creates an unversioned change object\n */\nChange.Unversioned = (revision: Revision): UnversionedChange => {\n  return Tagged({\n    type: \"UNVERSIONED\",\n    after: revision,\n  });\n};\n\nconst changeToFileStatus: Record<AnyChange[\"type\"], FileStatus> = {\n  ADDED: \"ADDED\",\n  DELETED: \"DELETED\",\n  MOVED: \"MODIFIED\",\n  RENAMED: \"MODIFIED\",\n  MODIFIED: \"MODIFIED\",\n  UNVERSIONED: \"UNKNOWN\",\n};\n\n/**\n * @returns {@link FileStatus} corresponding to the change type\n */\nChange.fileStatus = function (change: AnyChange): FileStatus {\n  return changeToFileStatus[change.type] ?? \"NOT_CHANGED\";\n};\n\n/**\n * @returns the `after` path if the change is not a deletion, and `before` path, otherwise.\n */\nChange.path = function (change: AnyChange): string {\n  return Change.revision(change).path;\n};\n\nChange.content = function (change: AnyChange): Promise<string> {\n  if (\"after\" in change) {\n    return change.after.content();\n  }\n  if (\"before\" in change) {\n    return change.before.content();\n  }\n  return Promise.resolve(\"\");\n};\n\n/**\n * type-guard returning filter for addition change\n */\nChange.isAddition = function (change: AnyChange): change is AdditionChange {\n  return change.type === \"ADDED\";\n};\n\n/**\n * type-guard returning filter for deletion change\n */\nChange.isDeletion = function (change: AnyChange): change is DeletionChange {\n  return change.type === \"DELETED\";\n};\n\n/**\n * type-guard returning filter for rename change\n */\nChange.isRename = function (change: AnyChange): change is RenameChange {\n  return change.type === \"RENAMED\";\n};\n\n/**\n * type-guard returning filter for move change\n */\nChange.isMove = function (change: AnyChange): change is MoveChange {\n  return change.type === \"MOVED\";\n};\n\n/**\n * type-guard returning filter for modification change.\n */\nChange.isModified = function (change: AnyChange): change is ModificationChange {\n  return change.type === \"MODIFIED\";\n};\n\n/**\n * type-guard returning filter for unversioned change.\n */\nChange.isUnversioned = function (\n  change: AnyChange\n): change is UnversionedChange {\n  return change.type === \"UNVERSIONED\";\n};\n\n/**\n * @returns the `after` revision if the change is not a deletion, and `before` revision, otherwise.\n */\nChange.revision = function (change: AnyChange): Revision {\n  return \"after\" in change ? change.after : change.before;\n};\n\nChange.equals = function (a: AnyChange, b: AnyChange): boolean {\n  const sameBefore =\n    \"before\" in a && \"before\" in b\n      ? revisionEquals(a.before, b.before)\n      : \"before\" in a === \"before\" in b;\n  const sameAfter =\n    \"after\" in a && \"after\" in b\n      ? revisionEquals(a.after, b.after)\n      : \"after\" in a === \"after\" in b;\n  return sameBefore && sameAfter;\n};\n\nfunction revisionEquals(a: Revision, b: Revision) {\n  return a?.path === b?.path && a.isDir === b.isDir;\n}\n","import { selector, selectorFamily, useRecoilCallback } from \"recoil\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport git, { checkout, resetIndex } from \"isomorphic-git\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { fs } from \"../../fs/fs\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { editorManagerState } from \"../../Editor/editor.state\";\nimport {\n  repoStatusState,\n  useRefreshFileStatus,\n  vcsRootForFile,\n  vcsRootsState,\n} from \"../file-status.state\";\nimport { AnyChange, Change } from \"./Change\";\n\nconst repoChangesState = selectorFamily<AnyChange[], string>({\n  key: \"vcs.repoChanges\",\n  get:\n    (repoDir: string) =>\n    ({ get }) =>\n      Object.entries(get(repoStatusState(repoDir)))\n        .map<AnyChange | null>(([filename, status]) => {\n          const revision = {\n            path: path.join(repoDir, filename),\n            isDir: false,\n            content(): Promise<string> {\n              throw new Error(\"Not implemented\");\n            },\n          };\n          if (status === \"ADDED\") {\n            return Change(null, revision);\n          } else if (status === \"MODIFIED\") {\n            return Change(revision, revision);\n          } else if (status === \"DELETED\") {\n            return Change(revision, null);\n          } else if (status === \"UNKNOWN\") {\n            return Change.Unversioned(revision);\n          } else {\n            return null;\n          }\n        })\n        .filter(notNull),\n});\n\nexport const allChangesState = selector<ReadonlyArray<AnyChange>>({\n  key: \"vcs.allChanges\",\n  get: ({ get }) => {\n    return get(vcsRootsState)\n      .map(({ dir }) => get(repoChangesState(dir)))\n      .flat();\n  },\n});\n\n/**\n * react hook that returns a rollback function which accepts a list of changes to rollback.\n */\nexport const useRollbackChanges = () => {\n  const updateFileStatus = useRefreshFileStatus();\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (changes: readonly AnyChange[], deleteAddedFiles?: boolean) => {\n        const { snapshot, refresh } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n\n        const changesWithRepoRoots = (\n          await Promise.all(\n            changes\n              .filter((change) => !Change.revision(change).isDir)\n              .map(async (change) => {\n                const repoRoot = await snapshot.getPromise(\n                  vcsRootForFile(Change.path(change))\n                );\n                if (repoRoot) {\n                  return {\n                    repoRoot,\n                    change,\n                    relativePath: path.relative(repoRoot, Change.path(change)),\n                  };\n                }\n              })\n          )\n        ).filter(notNull);\n        const groupedChanges = groupBy(\n          ({ repoRoot }) => repoRoot,\n          changesWithRepoRoots\n        );\n        await Promise.all(\n          Object.entries(groupedChanges).map(async ([repoRoot, items]) => {\n            const { toReset = [], toCheckout = [] } = groupBy(\n              ({ change: { type } }) =>\n                type !== \"ADDED\" || deleteAddedFiles ? \"toCheckout\" : \"toReset\",\n              items\n            );\n            await Promise.allSettled(\n              toReset.map(({ relativePath }) =>\n                resetIndex({\n                  fs,\n                  dir: repoRoot,\n                  filepath: relativePath,\n                })\n              )\n            );\n            if (toCheckout.length > 0) {\n              const resolvedHead = await git\n                .resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" })\n                .catch(() => null);\n              if (resolvedHead) {\n                await checkout({\n                  fs,\n                  dir: repoRoot,\n                  force: true,\n                  filepaths: toCheckout.map(\n                    ({ relativePath, change: { type } }) => relativePath\n                  ),\n                });\n              } else {\n                // if the repository is just created, HEAD is not resolved, and checkout() throws, so we delete files\n                // manually in that case.\n                // TODO: another use case is detached HEAD, and it may need to be handled for non-addition changes?\n                await Promise.all(\n                  toCheckout\n                    .filter(({ change }) => change.type === \"ADDED\")\n                    .map(({ change }) => {\n                      const fullPath = Change.path(change);\n                      return fs.promises.unlink(fullPath);\n                    })\n                );\n              }\n            }\n            if (deleteAddedFiles) {\n              const editor = await snapshot.getPromise(editorManagerState);\n              changes.filter(Change.isAddition).forEach((change) => {\n                editor.closePath(Change.path(change)); // FIXME(fs.watch)\n              });\n            }\n\n            // FIXME(fs.watch)\n            const changedDirectories = findRootPaths(\n              items.flatMap(({ change }) => {\n                if (change.type === \"MODIFIED\") {\n                  // minor optimization\n                  return [];\n                }\n                if (change.type === \"MOVED\") {\n                  return [change.before.path, change.after.path];\n                }\n                return Change.path(change);\n              })\n            ).map(path.dirname);\n            changedDirectories.forEach((pathToRefresh) =>\n              refresh(dirContentState(pathToRefresh))\n            );\n\n            await Promise.allSettled(\n              items.map(async ({ relativePath, change }) => {\n                const fullPath = Change.path(change);\n                await reloadFileFromDisk(fullPath); // Since fileContent is an atom, we set the value. Could be a selector that we would refresh\n                await resetIndex({ fs, dir: repoRoot, filepath: relativePath });\n                await updateFileStatus(fullPath);\n              })\n            );\n          })\n        );\n      },\n    []\n  );\n};\n","import {\n  atom,\n  selector,\n  useRecoilCallback,\n  useRecoilValue,\n  useSetRecoilState,\n} from \"recoil\";\nimport { useEffect } from \"react\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { allChangesState } from \"./changes.state\";\nimport { AnyChange, Change, UnversionedChange } from \"./Change\";\n\nexport interface ChangeListObj {\n  id: string;\n  name: string;\n  comment: string;\n  active: boolean;\n  changes: ReadonlyArray<AnyChange>;\n}\n\nexport const changeListsState = atom<ChangeListObj[]>({\n  key: \"changelists.lists\",\n  default: [\n    {\n      id: \"some-UUID\",\n      name: \"Changes\",\n      comment: \"last modified commit message\",\n      changes: [],\n      active: true,\n    },\n    {\n      id: \"some-other-UUID\",\n      name: \"Some other changelist\",\n      comment: \"Some empty changelist for testing\",\n      changes: [],\n      active: false,\n    },\n  ],\n});\n\nexport const activeChangeListState = selector<ChangeListObj | null>({\n  key: \"changelists.lists/default\",\n  get: ({ get }) =>\n    get(changeListsState).find((changeList) => changeList.active) ?? null,\n});\n\nexport const unversionedChangesState = selector<UnversionedChange[]>({\n  key: \"changelists.lists/unversioned\",\n  get: ({ get }) => get(allChangesState).filter(Change.isUnversioned),\n});\n\nexport const useSetActiveChangeList = () =>\n  useRecoilCallback(\n    ({ set, snapshot }) =>\n      (changeListId) => {\n        const changeLists = snapshot.getLoadable(changeListsState).getValue();\n        const targetChangeList = changeLists.find(\n          ({ id }) => id === changeListId\n        );\n        if (targetChangeList) {\n          set(\n            changeListsState,\n            changeLists.map((changeList) => ({\n              ...changeList,\n              active: changeList === targetChangeList,\n            }))\n          );\n        }\n        // TODO: check if deactivated changelist is empty, and open a confirmation modal window to remove it if confirmed.\n      },\n    []\n  );\n\n/**\n * Helper component that keeps change lists state up-to-date with respect to changes.\n * It must be rendered at top level. Reasons for the unconventional implementation as a component\n * that must be rendered in top level:\n * - The *effects* API in recoil doesn't allow for this use case where one atom needs to be kept valid/up-to-date\n *   based on another atom. Changes here is the source of truth. Any removed changes should be removed from\n *   changelist(s) too, and any new change should be added to the active changelist\n * - The state of change lists is **not** just a 1:1 function of changes. So it can't be a selector. How changes are\n *   grouped in different lists is something that must have its own source of truth, but it needs validation,\n *   every time changes are added/removed.\n */\nexport function SyncChangeListsState() {\n  const changes = useRecoilValue(allChangesState);\n  const setChangeLists = useSetRecoilState(changeListsState);\n  useEffect(() => {\n    setChangeLists((changeLists) => {\n      const trackedChanges = changes.filter(\n        (change) => !Change.isUnversioned(change)\n      );\n      const updatedChangeLists = changeLists.map((changeList) => {\n        return {\n          ...changeList,\n          changes: changeList.changes\n            .map((change) =>\n              trackedChanges.find((aChange) => Change.equals(aChange, change))\n            )\n            .filter(notNull),\n        };\n      });\n      const existingChanges = updatedChangeLists.flatMap(\n        ({ changes }) => changes\n      );\n      const newChanges = trackedChanges.filter(\n        (change) =>\n          !existingChanges.find((anExistingChange) =>\n            Change.equals(change, anExistingChange)\n          )\n      );\n      const activeChangeList =\n        updatedChangeLists.find(({ active }) => active) ??\n        updatedChangeLists[0];\n      activeChangeList.changes.push(...newChanges);\n      return updatedChangeLists;\n    });\n  }, [changes]);\n  return null;\n}\n","import { identity, uniq } from \"ramda\";\nimport { getParentPaths } from \"../file-utils\";\n\nexport interface DirectoryNode {\n  type: \"directory\";\n  dirPath: string;\n  parentNodePath: string;\n  children: ReadonlyArray<any>;\n}\n\ntype GroupByDirectorAdapter<T, D extends DirectoryNode> = {\n  shouldCollapseDirectories?: boolean;\n  getPath: (node: T) => string;\n  /**\n   * Maps each processed node. E.g. can be used to enrich nodes with grouping metadata.\n   * @example\n   * ```\n   * mapNode: (node) => ({...node, isGroupedByDirectory: true})\n   * ```\n   */\n  mapNode?: (node: T) => T;\n  createDirectoryNode?: (dirNode: DirectoryNode) => D;\n};\n/**\n * Exported only for tests.\n * @internal\n */\nexport const createGroupByDirectory =\n  <T, D extends DirectoryNode>({\n    getPath,\n    mapNode = identity,\n    createDirectoryNode = (i) => i as D,\n    shouldCollapseDirectories = false,\n  }: GroupByDirectorAdapter<T, D>) =>\n  (nodes: ReadonlyArray<T>): readonly D[] => {\n    const pathToNodeCache: Record<string, D> = {};\n    const rootDirNodes = nodes.map(mapNode).map((node) => {\n      const filepath = getPath(node);\n      // noinspection UnnecessaryLocalVariableJS\n      const rootDirNode = getParentPaths(\n        filepath.startsWith(\"/\") ? filepath : `/${filepath}`\n      ).reduce((prevNode: D | T, dirPath) => {\n        if (!pathToNodeCache[dirPath]) {\n          pathToNodeCache[dirPath] = createDirectoryNode({\n            type: \"directory\",\n            dirPath,\n            parentNodePath: \"\",\n            children: [],\n          });\n        }\n        if (isDirectoryNode(prevNode)) {\n          prevNode.parentNodePath = dirPath;\n        }\n        const dirNode = pathToNodeCache[dirPath];\n        dirNode.children = dirNode.children.includes(prevNode)\n          ? dirNode.children\n          : [prevNode, ...dirNode.children];\n        return dirNode;\n      }, node) as D; // This is gonna be true if the array is non-empty, but TS can't recongnize it.\n      // whether the array can be empty might be something to consider and guard against\n      return rootDirNode;\n    });\n    const directoryNodes = uniq(rootDirNodes);\n    return shouldCollapseDirectories\n      ? directoryNodes.map((node) =>\n          collapseDirectories(createDirectoryNode, node)\n        )\n      : directoryNodes;\n  };\n\nfunction isDirectoryNode<T, D extends DirectoryNode>(node: D | T): node is D {\n  return \"type\" in node && node.type === \"directory\";\n}\n\nfunction collapseDirectories<T, D extends DirectoryNode>(\n  createDirectorNode: Required<\n    GroupByDirectorAdapter<T, any>\n  >[\"createDirectoryNode\"],\n  dirNode: D\n): D {\n  let { children, dirPath, parentNodePath } = dirNode;\n  if (dirNode.children.length === 1 && isDirectoryNode(dirNode.children[0])) {\n    dirPath = dirNode.children[0].dirPath;\n    children = dirNode.children[0].children.map((child: D | T) =>\n      isDirectoryNode<T, D>(child)\n        ? collapseDirectories<T, D>(createDirectorNode, {\n            ...child,\n            parentNodePath: dirPath,\n          })\n        : child\n    );\n    return collapseDirectories<T, D>(\n      createDirectorNode,\n      createDirectorNode({\n        type: \"directory\",\n        dirPath,\n        parentNodePath,\n        children,\n      })\n    );\n  }\n  return {\n    ...dirNode,\n    children: children.map((child) =>\n      isDirectoryNode(child)\n        ? collapseDirectories<T, D>(createDirectorNode, child)\n        : child\n    ),\n  };\n}\n","import { VcsDirectoryMapping } from \"../../file-status\";\nimport { AnyChange, Change } from \"../Change\";\n\nexport interface ChangesTreeNode<T extends string> {\n  type: T;\n  key: string;\n}\n\nexport interface ChangesTreeGroupNode<\n  T extends string,\n  C extends ChangesTreeNode<any> = ChangesTreeNode<T>\n> extends ChangesTreeNode<T> {\n  children: ReadonlyArray<C>;\n}\n\nexport type GroupNodes<T extends ChangesTreeNode<any>> = Extract<\n  T,\n  ChangesTreeGroupNode<any>\n>;\n\nexport interface ChangeNode extends ChangesTreeNode<\"change\"> {\n  change: AnyChange;\n  /**\n   * Whether to show the file path in front of the file name (in muted UI)\n   */\n  showPath?: boolean;\n}\n\nexport interface DirectoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"directory\", C> {\n  dirPath: string;\n  parentNodePath: string;\n}\n\nexport interface RepositoryNode<\n  C extends ChangesTreeNode<any> = ChangesTreeNode<any>\n> extends ChangesTreeGroupNode<\"repo\", C> {\n  repository: VcsDirectoryMapping;\n}\n\n/**\n * Extends the type of changes tree nodes with additional (group) node types.\n */\nexport type ExtendedChangesTreeNode<G extends ChangesTreeGroupNode<any>> =\n  | ChangeNode\n  | RepositoryNode<G>\n  | DirectoryNode<G>\n  | G;\n\nexport type DefaultChangesTreeNode = ExtendedChangesTreeNode<never>;\nexport const changesTreeNodeKey = (type: string, id: string): string =>\n  `${type}_${id}`;\n\nexport const getNodeKeyForChange = (change: AnyChange) =>\n  changesTreeNodeKey(\"change\", Change.path(change));\nexport const changeNode = (change: AnyChange, showPath = true): ChangeNode => ({\n  type: \"change\",\n  key: getNodeKeyForChange(change),\n  change,\n  showPath,\n});\nexport const directoryNode = <G extends ChangesTreeNode<any>>(\n  dirPath: string,\n  parentNodePath: string,\n  children: readonly G[] = [],\n  keyPrefix: string = \"\"\n): DirectoryNode<G> => ({\n  type: \"directory\",\n  key: keyPrefix + changesTreeNodeKey(\"directory\", dirPath),\n  dirPath,\n  parentNodePath,\n  children,\n});\nexport const repositoryNode = <G extends ChangesTreeNode<any>>(\n  repository: VcsDirectoryMapping,\n  children: G[] = []\n): RepositoryNode<G> => ({\n  type: \"repo\",\n  key: changesTreeNodeKey(\"repo\", repository.dir),\n  repository,\n  children,\n});\nexport const isGroupNode = <T extends ChangesTreeNode<any>>(\n  node: T\n): node is GroupNodes<T> => \"children\" in node;\nexport const isChangeNode = (node: ChangesTreeNode<any>): node is ChangeNode =>\n  node.type === \"change\";\nexport const isDirectoryNode = <G extends ChangesTreeNode<any>>(\n  node: ChangesTreeNode<any>\n): node is DirectoryNode<G> => node.type === \"directory\";\n\nexport const getChildren = <\n  T extends ChangesTreeNode<any> = DefaultChangesTreeNode\n>(\n  node: T\n): null | GroupNodes<T>[\"children\"] =>\n  isGroupNode(node) ? node.children : null;\n","import { CommonActionId } from \"@intellij-platform/core\";\n\nexport const VcsActionIds = {\n  ROLLBACK: \"ChangesView.Revert\",\n  REFRESH: \"ChangesView.Refresh\",\n  SHELVE_SILENTLY: \"ChangesView.ShelveSilently\",\n  SHELVE: \"ChangesView.Shelve\",\n  UNSHELVE_SILENTLY: \"ChangesView.UnshelveSilently\",\n  NEW_CHANGELIST: \"ChangesView.NewChangeList\",\n  ADD_UNVERSIONED: \"ChangesView.AddUnversioned\",\n  RENAME_CHANGELIST: \"ChangesView.Rename\",\n  REMOVE_CHANGELIST: \"ChangesView.RemoveChangeList\",\n  SET_DEFAULT_CHANGELIST: \"ChangesView.SetDefault\",\n  MOVE_TO_ANOTHER_CHANGELIST: \"ChangesView.Move\",\n  SHOW_DIFF: \"Diff.ShowDiff\", // Maybe doesn't belong here?\n  CHECKIN_FILES: \"CheckinFiles\",\n  CHECKIN_PROJECT: \"CheckinProject\",\n  JUMP_TO_SOURCE: CommonActionId.EDIT_SOURCE,\n\n  GROUP_CHANGES_VIEW_POPUP_MENU: \"ChangesViewPopupMenu\", // Not used yet\n  GROUP_BY_DIRECTORY: \"ChangesView.GroupBy.Directory\",\n  GIT_ADD: \"Git.Add\",\n  GIT_INIT: \"Git.Init\",\n  GIT_CLONE: \"Git.Clone\",\n  GIT_CREATE_NEW_BRANCH: \"Git.CreateNewBranch\",\n  GIT_BRANCHES: \"Git.Branches\",\n\n  GIT_LOG_HIDE_BRANCHES: \"Git.Log.Hide.Branches\",\n  GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH:\n    \"Git.Log.Branches.Navigate.Log.To.Selected.Branch\",\n  GIT_UPDATE_SELECTED: \"Git.Update.Selected\",\n\n  FOCUS_TEXT_FILTER: \"Vcs.Log.FocusTextFilter\",\n  MATCH_CASE: \"Vcs.Log.MatchCaseAction\",\n  REG_EXP: \"Vcs.Log.EnableFilterByRegexAction\",\n  COPY_REVISION_NUMBER: \"Vcs.CopyRevisionNumberAction\",\n  LOG_REFRESH: \"Vcs.Log.Refresh\",\n  SHOW_DETAILS: \"Vcs.Log.ShowDetailsAction\",\n  SHOW_DIFF_PREVIEW: \"Vcs.Log.ShowDiffPreview\",\n  PRESENTATION_SETTINGS: \"Vcs.PresentationSettings\",\n  FILE_HISTORY_PRESENTATION_SETTINGS: \"Vcs.FileHistory.PresentationSettings\",\n\n  CopyPathFromRepositoryRootProvider: \"CopyPathFromRepositoryRootProvider\",\n};\n","import { GetRecoilValue, isRecoilValue, selector } from \"recoil\";\n\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { createGroupByDirectory } from \"../../../tree-utils/groupByDirectory\";\nimport { Change } from \"../Change\";\nimport {\n  changeNode,\n  ChangeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  directoryNode,\n  DirectoryNode,\n  isChangeNode,\n  isGroupNode,\n  RepositoryNode,\n  repositoryNode,\n} from \"./ChangeTreeNode\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { MaybeRecoilValue } from \"../../../recoil-utils\";\n\nexport type GroupFn<T extends ChangesTreeGroupNode<any>> = (\n  nodes: ReadonlyArray<ChangeNode>\n) => ReadonlyArray<T>;\n\nexport interface ChangeGrouping<\n  T extends ChangesTreeGroupNode<any>,\n  I = string\n> {\n  id: I;\n  title: string;\n  isAvailable: MaybeRecoilValue<boolean>;\n  useShortcutOf?: string;\n  groupFn: MaybeRecoilValue<GroupFn<T>>;\n}\n\nconst repositoryGrouping: ChangeGrouping<RepositoryNode, \"repository\"> = {\n  id: \"repository\",\n  title: \"Repository\",\n  isAvailable: selector({\n    key: \"repositoryGrouping/isAvailable\",\n    get: ({ get }) => get(vcsRootsState).length > 1,\n  }),\n  groupFn: selector({\n    key: \"repositoryGrouping/groupFn\",\n    get:\n      ({ get }: { get: GetRecoilValue }) =>\n      (nodes: ReadonlyArray<ChangeNode>) => {\n        const repos = get(vcsRootsState);\n        return repos.map(\n          (repository): RepositoryNode =>\n            repositoryNode(\n              repository,\n              nodes.filter((node) =>\n                Change.path(node.change)?.startsWith(repository.dir)\n              )\n            )\n        );\n      },\n  }),\n};\n\nexport const directoryGrouping: ChangeGrouping<DirectoryNode, \"directory\"> = {\n  id: \"directory\",\n  title: \"Directory\",\n  isAvailable: true,\n  useShortcutOf: VcsActionIds.GROUP_BY_DIRECTORY,\n  groupFn: createGroupByDirectory<ChangeNode, DirectoryNode>({\n    shouldCollapseDirectories: true,\n    createDirectoryNode: ({ dirPath, parentNodePath, children }) =>\n      directoryNode(dirPath, parentNodePath, children),\n    mapNode: (node) => changeNode(node.change, false),\n    getPath: (node) => Change.path(node.change),\n  }),\n};\n\nexport const defaultChangeGroupings: ReadonlyArray<\n  ChangeGrouping<DirectoryNode | RepositoryNode, \"directory\" | \"repository\">\n> = [repositoryGrouping, directoryGrouping];\n\nexport const defaultChangeGroupingsState = selector<\n  ReadonlyArray<Omit<typeof defaultChangeGroupings[number], \"isAvailable\">>\n>({\n  key: \"changes.availableGroupings\",\n  get: ({ get }) =>\n    defaultChangeGroupings.filter((grouping) =>\n      isRecoilValue(grouping.isAvailable)\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    ),\n});\n\nexport const recursiveGrouping = <T extends ChangesTreeNode<any>>(\n  groupingFns: Array<GroupFn<any>> /* Typing could be improved? */,\n  nodes: ReadonlyArray<ChangeNode>\n): ReadonlyArray<T> | ReadonlyArray<ChangeNode> => {\n  if (groupingFns.length === 0 || nodes.length === 0) {\n    return nodes;\n  }\n  const nextGroupingFns = groupingFns.slice(1);\n\n  const changeNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isChangeNode\n  );\n  const groupNodes = (nodes as ReadonlyArray<ChangesTreeNode<any>>).filter(\n    isGroupNode\n  );\n  const groups = groupingFns[0](changeNodes);\n\n  [...groupNodes, ...groups].forEach((groupNode) => {\n    groupNode.children = recursiveGrouping(nextGroupingFns, groupNode.children);\n  });\n  return groups.filter((group) => group.children.length > 0);\n};\n\n/**\n * returns a function that accepts a `keyPrefix` and creates change grouping function based on the\n * passed {@param groupings}, in a way that the key of each grouping node is prefixed with the `keyPrefix`.\n * Useful for grouping changes under some root nodes with potentially overlapping groups. E.g. the same\n * folder or repository node may appear under different changeLists.\n */\nexport const getPrefixedChangesGroupFn =\n  <G extends ChangesTreeGroupNode<any>>({\n    get,\n    isActive,\n    groupings,\n  }: {\n    get: GetRecoilValue;\n    isActive: (groupingId: string) => MaybeRecoilValue<boolean>;\n    groupings: ReadonlyArray<ChangeGrouping<G, any>>;\n  }) =>\n  (keyPrefix: string) => {\n    const resolve = <T>(value: MaybeRecoilValue<T>): T =>\n      isRecoilValue(value) ? get(value) : value;\n    const groupFns = groupings\n      .filter(\n        ({ id, isAvailable }) => resolve(isAvailable) && resolve(isActive(id))\n      )\n      .map(({ groupFn }) => {\n        return resolve(groupFn);\n      })\n      .map<GroupFn<any>>((groupFn) =>\n        keyPrefix\n          ? (...args) =>\n              groupFn(...args).map((group) => ({\n                ...group,\n                key: `${keyPrefix}:${group.key}`,\n              }))\n          : groupFn\n      );\n    return (changes: readonly ChangeNode[]) =>\n      recursiveGrouping<G>(groupFns, changes);\n  };\n\nexport const getChangesGroupFn = (\n  ...args: Parameters<typeof getPrefixedChangesGroupFn>\n) => getPrefixedChangesGroupFn(...args)(\"\");\n","import { atom, selector } from \"recoil\";\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport {\n  getExpandAllKeys,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { Bounds } from \"@intellij-platform/core/Overlay\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { AnyChange } from \"../Change\";\n\nconst isOpen = atom<boolean>({\n  key: \"rollbackView.isOpen\",\n  default: false,\n});\nconst windowBounds = atom<Partial<Bounds>>({\n  key: \"rollbackView.windowBounds\",\n  default: { height: 500 },\n});\nconst initiallyIncludedChanges = atom<ReadonlyArray<AnyChange>>({\n  key: \"rollbackView.initiallySelectedChanges\",\n  default: [],\n});\nconst rootNodes = selector({\n  key: \"rollbackView.includedRootNodes\",\n  get: ({ get }) => {\n    const selectedChanges = get(initiallyIncludedChanges);\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedRootNodes = rootNodes.filter(\n      (node) =>\n        node.type === \"changelist\" &&\n        selectedChanges.some((change) =>\n          node.changeList.changes.includes(change)\n        )\n    );\n    if (includedRootNodes.length === 0) {\n      return rootNodes.filter(\n        (node) => node.type === \"changelist\" && node.changeList.active\n      );\n    }\n    return includedRootNodes;\n  },\n});\nconst initiallyExpandedKeys = selector({\n  key: \"rollbackView.initiallyExpandedKeys\",\n  get: ({ get }) => {\n    const includedChanges = get(initiallyIncludedChanges);\n    const nodes = get(rootNodes);\n    const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n      (node) => (isGroupNode(node) ? node.children : null),\n      (node) => node.key,\n      nodes,\n      includedChanges.map(getNodeKeyForChange)\n    );\n    return new Set(\n      expandedKeys.length\n        ? expandedKeys\n        : getExpandAllKeys<ChangesViewTreeNode>(\n            (node) => (isGroupNode(node) ? node.children : null),\n            (node) => node.key,\n            nodes\n          )\n    );\n  },\n});\n\nexport const rollbackViewState = {\n  isOpen,\n  windowBounds,\n  initiallyExpandedKeys,\n  initiallyIncludedChanges,\n  rootNodes,\n};\n","import { Key } from \"react\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { ChangesTreeNode, getChildren } from \"./ChangeTreeNode\";\n\nexport function changesTreeNodesResult<\n  T extends ReadonlyArray<ChangesTreeNode<any>>\n>(\n  rootNodes: T\n): {\n  rootNodes: ReadonlyArray<T[number]>;\n  byKey: Map<Key, T[number]>;\n  expandAllKeys: Set<Key>;\n  fileCountsMap: Map<Key, number>;\n} {\n  const fileCountsMap = new Map();\n  const byKey = new Map();\n  const expandAllKeys = new Set<Key>();\n\n  dfsVisit<ChangesTreeNode<any>, number>(\n    getChildren,\n    (node, childrenFileCount) => {\n      byKey.set(node.key, node);\n      if (\"children\" in node) {\n        expandAllKeys.add(node.key);\n      }\n      if (!childrenFileCount) {\n        return 1;\n      }\n      const fileCount = childrenFileCount.reduce(\n        (total, count) => total + count,\n        0\n      );\n      fileCountsMap.set(node.key, fileCount);\n      return fileCount;\n    },\n    rootNodes\n  );\n  return { rootNodes, fileCountsMap, byKey, expandAllKeys };\n}\n","import { sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { atom, atomFamily, CallbackInterface, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport {\n  ChangeListObj,\n  changeListsState,\n  unversionedChangesState,\n} from \"../change-lists.state\";\nimport {\n  defaultChangeGroupings,\n  defaultChangeGroupingsState,\n  getPrefixedChangesGroupFn,\n  GroupFn,\n} from \"../ChangesTree/changesGroupings\";\nimport {\n  bfsVisit,\n  getExpandedToNodesKeys,\n} from \"@intellij-platform/core/utils/tree-utils\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport {\n  createSetInterface,\n  NestedSelection,\n  NestedSelectionState,\n} from \"@intellij-platform/core\";\nimport { rollbackViewState } from \"../Rollback/rollbackView.state\";\nimport { activePathsState } from \"../../../Project/project.state\";\nimport {\n  ChangeNode,\n  changeNode,\n  ChangesTreeGroupNode,\n  ChangesTreeNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n  getNodeKeyForChange,\n  GroupNodes,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { Task } from \"../../../tasks\";\nimport { AnyChange, Change } from \"../Change\";\nimport { changesTreeNodesResult } from \"../ChangesTree/changesTreeNodesResult\";\nimport { allChangesState } from \"../changes.state\";\n\nexport interface ChangeListNode<\n  C extends ChangesTreeNode<any> = ChangesViewTreeNode\n> extends ChangesTreeGroupNode<\"changelist\", C> {\n  changeList: ChangeListObj;\n}\nexport interface UnversionedChangesNode<\n  C extends ChangesTreeNode<any> = ChangeNode\n> extends ChangesTreeGroupNode<\"unversioned\", C> {}\n\nexport type ChangesViewTreeNode = ExtendedChangesTreeNode<\n  ChangeListNode | UnversionedChangesNode\n>;\n\nexport const changeListNode = (\n  changeList: ChangeListObj\n): ChangeListNode<ChangeNode> => ({\n  type: \"changelist\",\n  key: changesTreeNodeKey(\"changelist\", changeList.id),\n  changeList,\n  children: changeList.changes.map((change) => changeNode(change)),\n});\n\nexport const showIgnoredFilesState = atom({\n  key: \"changesView/showIgnoredFiles\",\n  default: false,\n});\n\nexport const showRelatedFilesState = atom({\n  key: \"changesView/showRelatedFiles\",\n  default: false,\n});\n\n// in a more extensible implementation, the id would be just string. but now that groupings are statically defined,\n// why not have more type safety\nexport type GroupingIds = typeof defaultChangeGroupings[number][\"id\"];\n\nexport const changesGroupingActiveState = atomFamily<boolean, string>({\n  key: \"changesView/isGroupingActive\",\n  default: true, // it's false in IntelliJ\n});\n\n/**\n * Selection state for the changes tree. Selection here means UI selection of tree nodes, not the checkboxes.\n */\nexport const selectedKeysState = atom<Selection>({\n  key: \"changesView.selectedKeys\",\n  default: new Set<Key>([]),\n});\n\n/**\n * Same as {@link selectedKeysState}, but always a set of key. i.e. \"all\" is resolved to keys.\n */\nexport const resolvedSelectedKeysState = selector<Set<Key>>({\n  key: \"changesView.resolvedSelectedKeys\",\n  get: ({ get }) => {\n    const selection = get(selectedKeysState);\n    if (selection === \"all\") {\n      const { rootNodes } = get(changesTreeNodesState);\n      return new Set(\n        bfsVisit<ChangesViewTreeNode, ChangesViewTreeNode[]>(\n          (node) => (\"children\" in node ? node.children : []),\n          (node, parentValue) => {\n            const nodes = parentValue ?? [];\n            nodes.push(node);\n            return nodes;\n          },\n          rootNodes\n        )\n          .flat()\n          .map((node) => node.key)\n      );\n    }\n    return selection;\n  },\n});\n\n/**\n * The List of currently selected nodes in Changes tree. Based on {@link selectedKeysState}\n */\nconst selectedNodesState = selector<ReadonlySet<ChangesViewTreeNode>>({\n  key: \"changesView.selectedNodes\",\n  get: ({ get }) => {\n    const selectedKeys = get(resolvedSelectedKeysState);\n    const { byKey } = get(changesTreeNodesState);\n    return new Set(\n      [...selectedKeys].map((key) => byKey.get(key)).filter(notNull)\n    );\n  },\n});\n\nexport const changesUnderSelectedKeys = selector<ReadonlySet<AnyChange>>({\n  key: \"changesView.selectedKeys.changes\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChanges: Set<AnyChange> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"change\") {\n        allChanges.add(node.change);\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return allChanges;\n  },\n});\n\n/**\n * The changelists from which at least one change is selected in the Changes tree view.\n */\nexport const changeListsUnderSelection = selector<ReadonlySet<ChangeListObj>>({\n  key: \"changesView.selectedChangeLists\",\n  get: ({ get }) => {\n    const selectedNodes = get(selectedNodesState);\n    const allChangeLists = get(changeListsState);\n\n    const selectedChangeLists: Set<ChangeListObj> = new Set();\n    const processNode = (node: ChangesViewTreeNode | undefined) => {\n      if (!node) {\n        return;\n      }\n      if (node.type === \"changelist\") {\n        selectedChangeLists.add(node.changeList);\n      }\n      if (node.type === \"change\") {\n        const changeList = allChangeLists.find((changeList) =>\n          changeList.changes.includes(node.change)\n        );\n        if (changeList) {\n          selectedChangeLists.add(changeList);\n        }\n      }\n      if (isGroupNode<ChangesViewTreeNode>(node)) {\n        node.children.forEach(processNode);\n      }\n    };\n    selectedNodes.forEach(processNode);\n    return selectedChangeLists;\n  },\n});\n\n/**\n * The list of changes that are included for the commit (via checkboxes).\n * TODO: for both this and tree selection state, value should be updated to exclude removed keys, when the tree data\n *  is changed\n */\nexport const includedChangeKeysState = atom<Set<string>>({\n  key: \"changesView.includedChangeKeys\",\n  default: new Set<string>([]),\n});\n\nexport const includedChangesState = selector<ReadonlyArray<AnyChange>>({\n  key: \"changesView.includedChanges\",\n  get: ({ get }) => {\n    const includedChangeKeys = get(includedChangeKeysState);\n    const allChanges = get(allChangesState);\n    return allChanges.filter((change) =>\n      includedChangeKeys.has(getNodeKeyForChange(change))\n    );\n  },\n});\n\n/**\n * A NestedSelection state, inferred based on selected changes. NestedSelection holds the checkmark state of all nodes\n * based on the selected leaf nodes.\n */\nexport const includedChangesNestedSelection = selector<\n  NestedSelectionState<ChangesViewTreeNode>\n>({\n  key: \"changesView.selectedChanges.nestedSelectionState\",\n  get: ({ get, getCallback }) => {\n    const { rootNodes } = get(changesTreeNodesState);\n    const includedChangeKeys = get(includedChangeKeysState);\n    const setSelectedKeys = getCallback(\n      ({ set }) =>\n        (setValue: (currentValue: Set<string>) => Set<string>) =>\n          set(includedChangeKeysState, setValue)\n    );\n    return new NestedSelection(\n      {\n        items: includedChangeKeys,\n        ...createSetInterface(setSelectedKeys),\n      },\n      {\n        rootNodes,\n        getChildren: (item: ChangesViewTreeNode) =>\n          isGroupNode<ChangesViewTreeNode>(item) ? item.children : null,\n        getKey: (item) => item.key,\n      }\n    );\n  },\n});\n\nexport const expandedKeysState = atom<Selection>({\n  key: \"changesView.expandedKeys\",\n  default: selector({\n    key: \"changesView.expandedKeys/temporaryDefault\",\n    get: ({ get }) => {\n      return new Set<Key>(\n        get(changesTreeNodesState)\n          .rootNodes.map((node) => [\n            node.key,\n            ...node.children.map((child) => child.key),\n          ])\n          .flat()\n      );\n    },\n  }),\n});\n\nexport const changesViewGroupingsState = selector({\n  key: \"changes.groupings\",\n  get: ({ get, getCallback }) =>\n    get(defaultChangeGroupingsState).map((grouping) => ({\n      ...grouping,\n      isActive: get(changesGroupingActiveState(grouping.id)),\n    })),\n});\n\nconst groupChildren = <\n  T extends ChangesTreeGroupNode<any, ChangeNode>,\n  G extends ChangesTreeNode<any>\n>(\n  node: T,\n  groupFn: (\n    nodes: ReadonlyArray<ChangeNode>\n  ) => ReturnType<GroupFn<GroupNodes<G>>> | ReadonlyArray<ChangeNode>\n) => ({\n  ...node,\n  children: groupFn(node.children),\n});\n\nexport const changesTreeNodesState = selector<{\n  rootNodes: ReadonlyArray<ChangeListNode | UnversionedChangesNode>;\n  fileCountsMap: Map<Key, number>;\n  byKey: Map<Key, ChangesViewTreeNode>;\n}>({\n  key: \"changesView.treeNodes\",\n  get: ({ get }) => {\n    const changeListNodes = sortBy(\n      ({ active }) => !active,\n      get(changeListsState)\n    ).map(changeListNode);\n    const prefixedGroupFn = getPrefixedChangesGroupFn({\n      get,\n      groupings: defaultChangeGroupings,\n      isActive: changesGroupingActiveState,\n    });\n    const unversionedChanges = get(unversionedChangesState);\n    const rootNodes: Array<ChangeListNode | UnversionedChangesNode> =\n      changeListNodes.map((changeListNode) =>\n        groupChildren(changeListNode, prefixedGroupFn(changeListNode.key))\n      );\n    if (unversionedChanges.length > 0) {\n      const unversionedChangesNode: UnversionedChangesNode = {\n        key: \"unversioned\",\n        type: \"unversioned\",\n        children: unversionedChanges.map((change) => changeNode(change)),\n      };\n      rootNodes.push(\n        groupChildren(unversionedChangesNode, prefixedGroupFn(\"unversioned\"))\n      );\n    }\n    return changesTreeNodesResult(rootNodes);\n  },\n});\n\n/**\n * Commit message split width, when the commit tool window is rendered in vertical layout\n */\nexport const commitMessageSizeState = atomFamily<\n  number,\n  \"horizontal\" | \"vertical\"\n>({\n  key: \"changesView/splitter/commitMessageSize\",\n  default: (orientation) => (orientation === \"horizontal\" ? 0.4 : 0.3),\n});\n/**\n * Whether --amend should be used for commit.\n */\nexport const amendCommitState = atom({\n  key: \"changesView/amendCommit\",\n  default: false,\n  // TODO: add a side effect to update message to the one from the last commit, when toggled to true.\n  // it should add a record to the commit message history and switch the message. When toggled to false,\n  // last entry in history should be back again. There is currently no history :D\n});\n/**\n * commit message text bound to the editor.\n */\nexport const commitMessageState = atom({\n  key: \"changesView/commitMessage\",\n  default: \"\",\n});\n\n/**\n * Whether to show error message related to attempting to commit without selecting any change.\n */\nexport const commitErrorMessageState = atom({\n  key: \"changesView/commitErrorMessage\",\n  default: \"\",\n});\n\nexport const commitTaskIdState = atom<Task[\"id\"] | null>({\n  key: \"changesView/commitTaskId\",\n  default: null,\n});\n\nexport const changesFromActivePathsState = selector({\n  key: \"changesView/changesFromActivePaths\",\n  get: ({ get }) => {\n    const activePaths = get(activePathsState);\n    return get(allChangesState).filter((change) =>\n      activePaths.some((activePath) =>\n        Change.path(change).startsWith(activePath)\n      )\n    );\n  },\n});\n\n/**\n * Recoil callback for queuing and marking changes as included based on a list of paths.\n */\nexport const queueCheckInCallback = ({ set, snapshot }: CallbackInterface) => {\n  /**\n   * @param paths: paths to filter changes based on. If not provided, activePaths is used.\n   */\n  return (paths?: string[]) => {\n    const changes = paths\n      ? snapshot\n          .getLoadable(allChangesState)\n          .getValue()\n          .filter((change) =>\n            paths.some((activePath) =>\n              Change.path(change).startsWith(activePath)\n            )\n          )\n      : snapshot.getLoadable(changesFromActivePathsState).getValue();\n\n    const includedChangeKeys = changes.map(getNodeKeyForChange);\n    set(includedChangeKeysState, new Set(includedChangeKeys));\n    if (includedChangeKeys.length > 0) {\n      const expandedKeys = getExpandedToNodesKeys<ChangesViewTreeNode>(\n        (node) =>\n          isGroupNode<ChangesViewTreeNode>(node) ? node.children : null,\n        (node) => node.key,\n        snapshot.getLoadable(changesTreeNodesState).getValue().rootNodes,\n        includedChangeKeys\n      );\n      set(expandedKeysState, (currentExpandedKeys) => {\n        return new Set([\n          ...(currentExpandedKeys !== \"all\"\n            ? currentExpandedKeys\n            : new Set<Key>()),\n          ...expandedKeys,\n        ]);\n      });\n      set(selectedKeysState, new Set([includedChangeKeys[0]]));\n    }\n  };\n};\n\nexport const openRollbackWindowForSelectionCallback = ({\n  set,\n  snapshot,\n}: CallbackInterface) => {\n  /**\n   * If contextual is true, changes related to {@link activePathsState} will be preselected.\n   */\n  return (contextual = true) => {\n    const activePaths = snapshot.getLoadable(activePathsState).getValue();\n    const changesUnderSelection = snapshot\n      .getLoadable(changesUnderSelectedKeys)\n      .getValue();\n    const changesBasedOnActivePaths =\n      contextual && activePaths.length > 0\n        ? snapshot.getLoadable(changesFromActivePathsState).getValue()\n        : null;\n    set(\n      rollbackViewState.initiallyIncludedChanges,\n      changesBasedOnActivePaths ?? [...changesUnderSelection]\n    );\n    set(rollbackViewState.isOpen, true);\n  };\n};\n","import { useRecoilValue } from \"recoil\";\nimport { selectedKeysState } from \"./ChangesView.state\";\nimport {\n  CommonActionId,\n  DividerItem,\n  useAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { ActionsMenu } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangesViewTreeContextMenu = () => {\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  if ([...selectedKeys].length === 0) {\n    return null;\n  }\n  return (\n    <ActionsMenu\n      aria-label=\"Changes actions\"\n      actions={[\n        useAction(VcsActionIds.CHECKIN_FILES),\n        useAction(VcsActionIds.ROLLBACK),\n        useAction(VcsActionIds.JUMP_TO_SOURCE),\n        new DividerItem(),\n        useAction(VcsActionIds.SHELVE),\n        new DividerItem(),\n        useAction(VcsActionIds.NEW_CHANGELIST),\n        useAction(VcsActionIds.RENAME_CHANGELIST),\n        useAction(VcsActionIds.REMOVE_CHANGELIST),\n        useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n        useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n        new DividerItem(),\n        useAction(CommonActionId.REFRESH),\n      ].filter(notNull)}\n    />\n  );\n};\n","export async function asyncFilter<T>(\n  predicate: (item: T) => Promise<boolean>,\n  array: readonly T[]\n) {\n  const predicateResult = await Promise.all(\n    array.map((item) => predicate(item).catch(() => false))\n  );\n  return array.filter((item, index) => predicateResult[index]);\n}\n","import git from \"isomorphic-git\";\n\n/**\n * Returns tracking branch for a given local branch\n */\nexport async function getTrackingBranch({\n  fs,\n  dir,\n  localBranchName,\n}: Pick<Parameters<typeof git[\"getConfig\"]>[0], \"fs\" | \"dir\"> & {\n  localBranchName: string;\n}): Promise<string | null> {\n  const mergeRef = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.merge`,\n  });\n  const remote = await git.getConfig({\n    fs,\n    dir,\n    path: `branch.${localBranchName}.remote`,\n  });\n  return mergeRef && remote\n    ? `${remote}/${mergeRef.replace(/^refs\\/heads\\//, \"\")}`\n    : null;\n}\n","import { equals, groupBy } from \"ramda\";\nimport {\n  atom,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n  useRecoilValue,\n} from \"recoil\";\nimport git, {\n  branch,\n  checkout,\n  deleteBranch,\n  renameBranch,\n} from \"isomorphic-git\";\n\nimport { fs } from \"../../fs/fs\";\nimport { vcsRootForFile, vcsRootsState } from \"../file-status.state\";\nimport { dirContentState, reloadFileFromDiskCallback } from \"../../fs/fs.state\";\nimport { editorTabsState } from \"../../Editor/editor.state\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { getTrackingBranch } from \"./branch-utils\";\nimport { array, literal, object, string, union } from \"@recoiljs/refine\";\nimport { persistentAtomEffect } from \"../../Project/persistence/persistentAtomEffect\";\nimport { ensureArray, MaybeArray } from \"../../ensureArray\";\n\nexport type LocalBranch = {\n  name: string;\n  trackingBranch: string | null;\n};\n\nexport type RemoteBranch = {\n  name: string;\n  remote: string;\n};\n\nexport type RepoBranches = {\n  repoRoot: string;\n  currentBranch: LocalBranch | null;\n  localBranches: LocalBranch[];\n  remoteBranches: RemoteBranch[];\n};\n\nexport type BranchType = \"LOCAL\" | \"REMOTE\";\n\nexport type BranchInfo = {\n  repoRoot: string;\n  branchType: BranchType;\n  branchName: string;\n};\n\n/**\n * List of local branches of a given repository.\n */\nconst repoLocalBranchesState = selectorFamily<LocalBranch[], string>({\n  key: \"vcs/repoLocalBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({}) => {\n      const branches = await git.listBranches({ fs, dir: repoRoot });\n      return Promise.all(\n        branches.map(async (branch) => ({\n          name: branch,\n          trackingBranch: await getTrackingBranch({\n            fs,\n            dir: repoRoot,\n            localBranchName: branch,\n          }),\n        }))\n      );\n    },\n});\n\n/**\n * List of remote branches of a given repository\n */\nconst repoRemoteBranchesState = selectorFamily({\n  key: \"vcs/repoRemoteBranches\",\n  get: (repoRoot: string) => async (): Promise<RemoteBranch[]> => {\n    const remotes = await git.listRemotes({ fs, dir: repoRoot });\n    return (\n      await Promise.all(\n        remotes.map(({ remote }) =>\n          git\n            .listBranches({ fs, dir: repoRoot, remote })\n            .then((branches) =>\n              branches\n                .filter((branch) => branch !== \"HEAD\")\n                .map((branch) => ({ name: branch, remote }))\n            )\n        )\n      )\n    ).flat();\n  },\n});\n\n/**\n * List of local and remote branches of a given repository\n */\nexport const repoBranchesState = selectorFamily<RepoBranches, string>({\n  key: \"vcs/repoBranches\",\n  get:\n    (repoRoot: string) =>\n    async ({ get }) => {\n      const currentBranchName = get(repoCurrentBranchNameState(repoRoot));\n      let localBranches = get(repoLocalBranchesState(repoRoot));\n      if (localBranches.length === 0 && currentBranchName) {\n        // When a repo is initialized and before the first commit, no branch is returned when listing branches.\n        // See more: https://github.com/isomorphic-git/isomorphic-git/issues/1650\n        localBranches = localBranches.concat({\n          name: currentBranchName,\n          trackingBranch: null,\n        });\n      }\n      return {\n        repoRoot,\n        currentBranch:\n          localBranches.find((branch) => branch.name === currentBranchName) ||\n          null,\n        localBranches: localBranches,\n        remoteBranches: get(repoRemoteBranchesState(repoRoot)),\n      };\n    },\n});\n\n/**\n * Current branch name of the given repository. Can be null, if head is detached.\n */\nexport const repoCurrentBranchNameState = selectorFamily({\n  key: \"vcs/repoCurrentBranch\",\n  get: (repoRoot: string) => () => {\n    return git.currentBranch({\n      fs,\n      dir: repoRoot,\n      fullname: false,\n    });\n  },\n});\n\n/**\n * List of all (remote and local) branches of all repositories\n */\nexport const allBranchesState = selector<RepoBranches[]>({\n  key: \"vcs/allBranches\",\n  get: ({ get }) => {\n    const repoRoots = get(vcsRootsState);\n    return repoRoots.map(({ dir: repoRoot }) =>\n      get(repoBranchesState(repoRoot))\n    );\n  },\n});\n\n/**\n * Given the absolute path of a file, returns the current branch on the repository this file belongs to.\n */\nexport const branchForPathState = selectorFamily<string | null, string>({\n  key: \"gitBranchForFile\",\n  get:\n    (filepath: string) =>\n    ({ get }) => {\n      const root = get(vcsRootForFile(filepath));\n      console.log(\n        `repo root for ${filepath}`,\n        root,\n        root && get(repoBranchesState(root))\n      );\n      return root\n        ? get(repoBranchesState(root)).currentBranch?.name || null\n        : null;\n    },\n});\n\nconst PREDEFINED_FAVORITE_BRANCH_NAMES = [\n  { branchType: \"LOCAL\", branchName: \"master\" },\n  { branchType: \"REMOTE\", branchName: \"origin/master\" },\n];\n\ninterface BranchStorage {\n  map: MaybeArray<{\n    entry: {\n      \"@type\": \"LOCAL\" | \"REMOTE\";\n      value: {\n        list: MaybeArray<{\n          \"branch-info\": {\n            \"@repo\": string;\n            \"@source\": string;\n          };\n        }>;\n      };\n    };\n  }>;\n}\n\n/**\n * Implements the intellij's data structure for persisting branch storage objects, used in persisting favorite branches\n * state. The reason for following the same data structure is to be able to open existing intellij projects with this\n * app and have it read/write the persistent state the same way an intellij does.\n */\ninterface GitSettingsStorage {\n  \"favorite-branches\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n  \"exclude-from-favorite\"?: {\n    \"branch-storage\": BranchStorage;\n  };\n}\n\nfunction readBranchStorage(branchStorage: BranchStorage | undefined) {\n  return (\n    ensureArray(branchStorage?.map).flatMap<BranchInfo>((entry) =>\n      ensureArray(entry?.entry.value.list).map(\n        ({ \"branch-info\": { \"@source\": branchName, \"@repo\": repoRoot } }) => ({\n          branchType: entry?.entry[\"@type\"],\n          branchName,\n          repoRoot,\n        })\n      )\n    ) || []\n  );\n}\n\nfunction toBranchStorage(value: readonly BranchInfo[]): BranchStorage {\n  const branchesByType = groupBy(({ branchType }) => branchType, value);\n  const entries = Object.entries(branchesByType).map(\n    ([branchType, branches]) => ({\n      entry: {\n        \"@type\": branchType as BranchType,\n        value: {\n          list: branches.map((branch) => ({\n            \"branch-info\": {\n              \"@repo\": branch.repoRoot,\n              \"@source\": branch.branchName,\n            },\n          })),\n        },\n      },\n    })\n  );\n  return {\n    map: entries,\n  };\n}\n\nconst branchInfoArrayChecker = array(\n  object({\n    branchType: union(literal(\"LOCAL\"), literal(\"REMOTE\")),\n    branchName: string(),\n    repoRoot: string(),\n  })\n);\n\nconst favoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"favorite-branches\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"favorite-branches\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nexport const isFavoriteBranchState = selectorFamily({\n  key: \"vcs/branches/isFavorite\",\n  get:\n    (branchInfo: BranchInfo) =>\n    ({ get }) => {\n      return isFavorite(\n        get(favoriteBranchesState),\n        get(excludedFromFavoriteBranchesState),\n        branchInfo\n      );\n    },\n});\n\nconst excludedFromFavoriteBranchesState = atom<ReadonlyArray<BranchInfo>>({\n  key: \"vcs/branches/favorite-excluded\",\n  default: [],\n  effects: [\n    persistentAtomEffect<ReadonlyArray<BranchInfo>, GitSettingsStorage>({\n      refine: branchInfoArrayChecker,\n      componentName: \"Git.Settings\",\n      read: (gitSettings) => {\n        return readBranchStorage(\n          gitSettings?.[\"exclude-from-favorite\"]?.[\"branch-storage\"]\n        );\n      },\n      update: (value) => {\n        return (currentValue): GitSettingsStorage => ({\n          ...(currentValue || {}),\n          \"exclude-from-favorite\": {\n            \"branch-storage\": toBranchStorage(value),\n          },\n        });\n      },\n    }),\n  ],\n});\n\nfunction isPredefinedAsFavorite(params: {\n  repoRoot: string;\n  branchName: string;\n  branchType: BranchType;\n}) {\n  return PREDEFINED_FAVORITE_BRANCH_NAMES.some(\n    ({ branchType, branchName }) =>\n      branchName === params.branchName && branchType === params.branchType\n  );\n}\n\nconst isFavorite = (\n  favoriteBranches: ReadonlyArray<BranchInfo>,\n  excludedFromFavoriteBranches: ReadonlyArray<BranchInfo>,\n  params: BranchInfo\n) => {\n  if (favoriteBranches.find(equals(params))) {\n    return true;\n  }\n  if (excludedFromFavoriteBranches.find(equals(params))) {\n    return false;\n  }\n  return isPredefinedAsFavorite(params);\n};\n\nfunction useToggleFavoriteBranch() {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      (\n        params: BranchInfo,\n        favorite: boolean = !isFavorite(\n          snapshot.getLoadable(favoriteBranchesState).getValue(),\n          snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n          params\n        )\n      ) => {\n        const remove = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> =>\n          currentValue.filter(\n            (favoriteBranch: BranchInfo) => !equals(favoriteBranch, params)\n          );\n        const add = (\n          currentValue: ReadonlyArray<BranchInfo>\n        ): ReadonlyArray<BranchInfo> => {\n          if (currentValue.some(equals(params))) {\n            return currentValue;\n          }\n          return currentValue.concat(params);\n        };\n\n        if (favorite) {\n          set(excludedFromFavoriteBranchesState, remove);\n          if (!isPredefinedAsFavorite(params)) {\n            set(favoriteBranchesState, add);\n          }\n        } else {\n          set(favoriteBranchesState, remove);\n          if (isPredefinedAsFavorite(params)) {\n            set(excludedFromFavoriteBranchesState, add);\n          }\n        }\n      },\n    []\n  );\n}\nexport function useFavoriteBranches() {\n  const favoriteBranches = useRecoilValue(favoriteBranchesState);\n  const excludedFromFavoriteBranches = useRecoilValue(\n    excludedFromFavoriteBranchesState\n  );\n\n  return {\n    isFavorite: (params: BranchInfo) =>\n      isFavorite(favoriteBranches, excludedFromFavoriteBranches, params),\n    toggleFavorite: useToggleFavoriteBranch(),\n  } as const;\n}\n\nexport function useCreateBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string, checkout: boolean = true) => {\n        return branch({ fs, dir: repoRoot, checkout, ref: branchName }).then(\n          () => {\n            refresh(repoBranchesState(repoRoot));\n          }\n        );\n      },\n    []\n  );\n}\n\n/**\n * Rename of a local branch.\n */\nexport function useRenameBranch() {\n  const toggleFavoriteBranch = useToggleFavoriteBranch();\n  return useRecoilCallback(\n    ({ refresh, snapshot }) =>\n      async (repoRoot: string, branchName: string, newBranchName: string) => {\n        await renameBranch({\n          fs,\n          dir: repoRoot,\n          oldref: branchName,\n          ref: newBranchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        const favoriteBranch = {\n          branchType: \"LOCAL\",\n          branchName,\n          repoRoot,\n        } as const;\n        if (\n          isFavorite(\n            snapshot.getLoadable(favoriteBranchesState).getValue(),\n            snapshot.getLoadable(excludedFromFavoriteBranchesState).getValue(),\n            favoriteBranch\n          )\n        ) {\n          toggleFavoriteBranch(favoriteBranch, false); // remove old branch from favorites\n          toggleFavoriteBranch(\n            {\n              ...favoriteBranch,\n              branchName: newBranchName,\n            },\n            true\n          ); // add new branch as favorite\n        }\n      },\n    []\n  );\n}\n\nexport function useCheckoutBranch() {\n  return useRecoilCallback(\n    (callbackInterface) =>\n      async (repoRoot: string, branchName: string, remote?: string) => {\n        const { refresh, snapshot, set } = callbackInterface;\n        const reloadFileFromDisk =\n          reloadFileFromDiskCallback(callbackInterface);\n        await checkout({\n          fs,\n          dir: repoRoot,\n          remote,\n          ref: branchName,\n        });\n        refresh(repoBranchesState(repoRoot));\n        refresh(dirContentState(repoRoot));\n        const openedFiles = snapshot.getLoadable(editorTabsState).getValue();\n        const existingOpenedFile = await asyncFilter(async ({ filePath }) => {\n          const exists = await fs.promises.exists(filePath); // should it be fs directly?\n          // the file content for files not open in the editor also need to be updated. TODO(fs.watch)\n          if (exists) {\n            await reloadFileFromDisk(filePath);\n          }\n          return exists;\n        }, openedFiles);\n        set(editorTabsState, existingOpenedFile);\n        // TODO: update file status (fileStatusState) for the repo.\n      },\n    []\n  );\n}\n\nexport function useDeleteBranch() {\n  return useRecoilCallback(\n    ({ refresh }) =>\n      (repoRoot: string, branchName: string) => {\n        return deleteBranch({ fs, dir: repoRoot, ref: branchName }).then(() => {\n          refresh(repoBranchesState(repoRoot));\n        });\n      },\n    []\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { VcsDirectoryMapping } from \"./file-status\";\nimport { branchForPathState } from \"./Branches/branches.state\";\n\nexport const RepoCurrentBranchName = ({\n  repo,\n}: {\n  repo: VcsDirectoryMapping;\n}) => {\n  const branch = useRecoilValue(branchForPathState(repo.dir));\n  return <>{branch}</>;\n};\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React, { ForwardedRef, HTMLAttributes } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"../file-status.state\";\nimport { useTheme } from \"styled-components\";\n\nconst StyledRepoColorSquare = styled.span`\n  width: 14px;\n  height: 14px;\n  align-self: center;\n  margin-right: 0.2rem;\n  position: relative;\n\n  //  after pseudo element is used to create the color mixing implemented here:\n  //  https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/VcsLogColorManagerImpl.java#L60\n  &&:after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0.75;\n    background: ${({ theme }) =>\n      theme.color(\"Table.background\") || (theme.dark ? \"#3C3F41\" : \"#fff\")};\n  }\n`;\n\nconst useRepoRootColor = (rootPath: string) => {\n  const index = useRecoilValue(vcsRootsState).findIndex(\n    (root) => root.dir === rootPath\n  );\n  const theme = useTheme() as Theme;\n  const colors = [theme.commonColors.red, theme.commonColors.blue];\n  return colors[index % colors.length] ?? colors[0];\n};\n\nexport const RepoColorIcon = React.forwardRef(\n  (\n    {\n      rootPath,\n      ...props\n    }: {\n      rootPath: string;\n    } & HTMLAttributes<HTMLSpanElement>,\n    ref: ForwardedRef<HTMLElement>\n  ) => (\n    <StyledRepoColorSquare\n      ref={ref}\n      {...props}\n      style={{ ...props.style, backgroundColor: useRepoRootColor(rootPath) }}\n    />\n  )\n);\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledCurrentBranchTag = styled.span`\n  display: inline-flex;\n  align-self: center;\n  height: 1.1rem;\n  line-height: 1.1rem;\n  padding: 0 0.25rem;\n\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(\n      // FIXME: color-mix algorithm used here seems to be different from how colors are mixed in the reference impl.\n      `color-mix(in srgb, ${theme.color(\n        \"VersionControl.Log.Commit.currentBranchBackground\",\n        theme.dark ? \"rgb(63, 71, 73)\" : \"rgb(228, 250, 255)\"\n      )}, ${theme.color(\n        \"VersionControl.RefLabel.backgroundBase\",\n        theme.dark ? \"#fff\" : \"#000\"\n      )} ${\n        (theme.value<number>(\"VersionControl.RefLabel.backgroundBrightness\") ??\n          0.08) * 100\n      }%)`\n    )};\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\n        \"VersionControl.RefLabel.foreground\",\n        theme.dark ? \"#909090\" : \"#7a7a7a\"\n      )\n    )};\n`;\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport path from \"path\";\nimport React, { Key } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport {\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nimport { DIR_ICON, getIconForFile } from \"../../../file-utils\";\nimport { RepoCurrentBranchName } from \"../../RepoCurrentBranchName\";\nimport { RepoColorIcon } from \"../StyledRepoColorSquare\";\nimport { StyledCurrentBranchTag } from \"../StyledCurrentBranchTag\";\nimport { Change } from \"../Change\";\nimport {\n  ChangeNode,\n  ChangesTreeNode,\n  DefaultChangesTreeNode,\n  DirectoryNode,\n  isGroupNode,\n  RepositoryNode,\n} from \"./ChangeTreeNode\";\nimport { StatusColor } from \"../../FileStatusColor\";\n\n/**\n * Necessary properties for each node, to be passed to `Item`s rendered in tree.\n * Some properties like `key` or `childItems` are not included, as they are calculated similarly\n * for all types of nodes.\n */\ntype RenderedNode = { textValue: string; rendered: React.ReactNode };\nexport type NodeRenderer<T extends ChangesTreeNode<any>> = (\n  node: T,\n  metadata: { fileCount: number; dirCount: number }\n) => RenderedNode;\n\nconst fileCountMsg = new IntlMessageFormat(\n  `{fileCount, plural,\n    =0 {No files}\n    =1 {1 file}\n    other {# files}\n  }`,\n  \"en-US\"\n);\n\nexport function formatFileCount(fileCount: number) {\n  return fileCountMsg.format({ fileCount });\n}\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      <StyledCurrentBranchTag>\n        <RepoCurrentBranchName repo={node.repository} />\n      </StyledCurrentBranchTag>\n    </ItemLayout>\n  ),\n});\nconst directoryNodeRenderer: NodeRenderer<DirectoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.parentNodePath\n    ? path.relative(node.parentNodePath, node.dirPath)\n    : node.dirPath,\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={DIR_ICON} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst ChangeNodeHint = ({ node }: { node: ChangeNode }): React.ReactElement => {\n  return (\n    <ItemLayout.Hint>\n      {node.showPath && path.dirname(Change.path(node.change))}\n    </ItemLayout.Hint>\n  );\n};\nconst changeNodeRenderer: NodeRenderer<ChangeNode> = (node) => ({\n  textValue: path.basename(Change.path(node.change)),\n  rendered: (\n    <ItemLayout>\n      <PlatformIcon icon={getIconForFile(Change.path(node.change))} />\n      <StatusColor status={Change.fileStatus(node.change)}>\n        <HighlightedTextValue />\n      </StatusColor>\n      {Change.isRename(node.change)\n        ? ` - renamed from ${path.basename(node.change.before.path)}`\n        : Change.isMove(node.change) &&\n          ` - moved from ${path\n            .relative(\n              path.dirname(node.change.after.path),\n              path.dirname(node.change.before.path)\n            )\n            .replace(/(\\.\\.\\/){2,}[!.]/g, \"..\")}/`}\n\n      <ChangeNodeHint node={node} />\n    </ItemLayout>\n  ),\n});\n\ntype NodeRenderersMap<T extends ChangesTreeNode<any>> = {\n  [type in T[\"type\"]]: NodeRenderer<T & { type: type }>;\n};\n\nconst defaultNodeRenderers: NodeRenderersMap<DefaultChangesTreeNode> = {\n  repo: repoNodeRenderer,\n  directory: directoryNodeRenderer,\n  change: changeNodeRenderer,\n};\n\nexport const simpleGroupingRenderer =\n  <T extends ChangesTreeNode<any>>(\n    getText: (node: T) => string\n  ): NodeRenderer<T> =>\n  (node, { fileCount }) => ({\n    textValue: getText(node),\n    rendered: (\n      <ItemLayout>\n        <HighlightedTextValue />\n        <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n      </ItemLayout>\n    ),\n  });\n\nexport const createChangesTreeNodeRenderer = <T extends ChangesTreeNode<any>>(\n  renderers: Omit<\n    NodeRenderersMap<T>,\n    keyof NodeRenderersMap<DefaultChangesTreeNode>\n  >,\n  /**\n   * Not so nice signature, but couldn't make it work with a single argument in a way that:\n   * - allows for optionally overriding the default renderers\n   * - infers the type of the resulting renderer based on additional keys passed in `renderers`\n   */\n  defaultRendererOverrides?: Partial<NodeRenderersMap<DefaultChangesTreeNode>>\n) => {\n  const nodeRenderers: NodeRenderersMap<T> = {\n    ...defaultNodeRenderers,\n    ...defaultRendererOverrides,\n    ...renderers,\n  };\n  const getItemProps = ({\n    node,\n    fileCountsMap,\n  }: {\n    node: T;\n    fileCountsMap: Map<Key, number>;\n  }): ItemProps<T> & { key: Key } => {\n    // Would make sense to handle missing renderer case if implementation is changed to be extensible with regard\n    // to node types\n    const nodeRenderer: NodeRenderer<T> =\n      nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n    const { textValue, rendered } = nodeRenderer(node, {\n      fileCount: fileCountsMap.get(node.key) || 0,\n      dirCount: 0, // It seems it's only used for ignored files subtree\n    });\n    return {\n      key: node.key,\n      childItems: isGroupNode(node) ? (node.children as T[]) : [],\n      hasChildItems: isGroupNode(node) && node.children?.length > 0,\n      textValue,\n      children: rendered,\n    };\n  };\n  return {\n    getItemProps,\n    getTextValue: (\n      node: T,\n      { fileCountsMap }: { fileCountsMap: Map<Key, number> }\n    ) => {\n      const nodeRenderer: NodeRenderer<T> =\n        nodeRenderers[node.type as T[\"type\"] /* Why is this cast needed?!*/];\n      return nodeRenderer(node, {\n        fileCount: fileCountsMap.get(node.key) || 0,\n        dirCount: 0, // It seems it's only used for ignored files subtree\n      }).textValue;\n    },\n    itemRenderer:\n      ({ fileCountsMap }: { fileCountsMap: Map<Key, number> }) =>\n      (node: T) =>\n        <Item {...getItemProps({ node, fileCountsMap })} />,\n  };\n};\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n} from \"../ChangesTree/changesTreeNodeRenderers\";\nimport { repoStatusUpdatingState } from \"../../file-status.state\";\nimport { Delayed } from \"../../../Delayed\";\nimport {\n  ChangeListNode,\n  ChangesViewTreeNode,\n  UnversionedChangesNode,\n} from \"./ChangesView.state\";\n\nconst changeListNodeRenderer: NodeRenderer<ChangeListNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: node.changeList.name,\n  rendered: (\n    <ItemLayout>\n      <span style={{ fontWeight: node.changeList.active ? \"bold\" : undefined }}>\n        <HighlightedTextValue />\n      </span>\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n        {/*in IntelliJ it's not shown if it's empty, but why not!*/}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nconst unversionedChangesNodeRenderer: NodeRenderer<UnversionedChangesNode> = (\n  _node,\n  { fileCount }\n) => ({\n  textValue: \"Unversioned Files\",\n  rendered: (\n    <ItemLayout>\n      <HighlightedTextValue />\n      <ItemLayout.Hint>\n        {formatFileCount(fileCount)}\n        {<LoadingText />}\n      </ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\n\nfunction LoadingText() {\n  const loading = useRecoilValue(repoStatusUpdatingState);\n  return <>{loading && <Delayed>, updating...</Delayed>}</>;\n}\n\nexport const changesViewTreeNodeRenderer =\n  createChangesTreeNodeRenderer<ChangesViewTreeNode>({\n    changelist: changeListNodeRenderer,\n    unversioned: unversionedChangesNodeRenderer,\n  });\n","import React, { Key, RefObject } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ContextMenuContainer,\n  Item,\n  SpeedSearchTreeWithCheckboxes,\n  TreeNodeCheckbox,\n  TreeRefValue,\n} from \"@intellij-platform/core\";\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n  expandedKeysState,\n  includedChangesNestedSelection,\n  selectedKeysState,\n} from \"./ChangesView.state\";\nimport { ChangesViewTreeContextMenu } from \"./ChangesViewTreeContextMenu\";\nimport { useActivePathsProvider } from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { Change } from \"../Change\";\nimport { isGroupNode } from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"./changesViewTreeNodeRenderer\";\n\nfunction findPathsUnderNode(node: ChangesViewTreeNode): string[] {\n  if (node?.type === \"directory\") {\n    return [node.dirPath];\n  }\n  if (node?.type === \"change\") {\n    return [Change.path(node.change)];\n  }\n  if (isGroupNode(node)) {\n    return node.children.flatMap(findPathsUnderNode);\n  }\n  return [];\n}\n\n/**\n * TODO: unversioned files\n * TODO: show diff/source on double click (on action to be more precise)\n */\nexport const ChangeViewTree = ({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): JSX.Element => {\n  const { rootNodes, fileCountsMap, byKey } = useRecoilValue(\n    changesTreeNodesState\n  );\n  const [selectedKeys, setSelectedKeys] = useRecoilState(selectedKeysState);\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const nestedSelection = useRecoilValue(includedChangesNestedSelection);\n  const { openPath } = useEditorStateManager();\n  const openChangeInEditor = useRecoilCallback(\n    ({ snapshot }) =>\n      (key: Key) => {\n        const changeNode = snapshot\n          .getLoadable(changesTreeNodesState)\n          .getValue()\n          .byKey.get(key);\n        if (changeNode?.type === \"change\") {\n          openPath(Change.path(changeNode.change));\n        }\n        return changeNode;\n      },\n    []\n  );\n\n  const activePathsProviderProps = useActivePathsProvider(\n    selectedKeys === \"all\"\n      ? [] // FIXME\n      : [...selectedKeys].flatMap((key) => {\n          const node = byKey.get(key);\n          return node ? findPathsUnderNode(node) : [];\n        })\n  );\n\n  return (\n    <ContextMenuContainer\n      renderMenu={() => <ChangesViewTreeContextMenu />}\n      style={{ height: \"100%\" }}\n    >\n      <SpeedSearchTreeWithCheckboxes\n        aria-label=\"Commit changes tree\" // no aria-label in the reference impl\n        treeRef={treeRef}\n        items={rootNodes}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onSelectionChange={setSelectedKeys}\n        onAction={openChangeInEditor}\n        nestedSelection={nestedSelection}\n        fillAvailableSpace\n        autoFocus=\"first\"\n        {...activePathsProviderProps}\n      >\n        {(node) => {\n          const props = changesViewTreeNodeRenderer.getItemProps({\n            fileCountsMap,\n            node,\n          });\n          return (\n            <Item {...props}>\n              {node.children?.length !== 0 && (\n                <TreeNodeCheckbox\n                  selectionState={nestedSelection.getSelectionState(node)}\n                  onToggle={() => nestedSelection.toggle(node)}\n                />\n              )}\n              {props.children}\n            </Item>\n          );\n        }}\n      </SpeedSearchTreeWithCheckboxes>\n    </ContextMenuContainer>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionsMenu,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  useAction,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport const ChangeListsActionButton = (): React.ReactElement => {\n  const actions = [\n    useAction(VcsActionIds.NEW_CHANGELIST),\n    useAction(VcsActionIds.RENAME_CHANGELIST),\n    useAction(VcsActionIds.REMOVE_CHANGELIST),\n    useAction(VcsActionIds.SET_DEFAULT_CHANGELIST),\n    useAction(VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST),\n  ].filter(notNull);\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <ActionsMenu actions={actions}>\n          {(actionMenuProps) => (\n            <SpeedSearchMenu {...menuProps} {...actionMenuProps} />\n          )}\n        </ActionsMenu>\n      )}\n    >\n      <PlatformIcon icon=\"vcs/changelist.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import React from \"react\";\nimport {\n  ActionTooltip,\n  IconButton,\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n  Section,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\ninterface Grouping<K extends string> {\n  id: K;\n  title: string;\n  isActive: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function GroupByActionButton<K extends string>({\n  groupings,\n  onToggle,\n}: {\n  groupings: Array<Grouping<K>>;\n  onToggle: (id: K) => void;\n}) {\n  //  TODO: Generalize and make action\n  if (groupings.length === 1 && groupings[0].icon) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={`Group By ${groupings[0].title}`} />\n        }\n      >\n        <IconButton\n          isPressed={groupings[0].isActive}\n          onPress={() => onToggle(groupings[0].id)}\n        >\n          {groupings[0].icon}\n        </IconButton>\n      </TooltipTrigger>\n    );\n  }\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            <Menu\n              {...menuProps}\n              selectedKeys={groupings\n                .filter(({ isActive }) => isActive)\n                .map(({ id }) => id)}\n              onAction={(key) => {\n                const id = groupings.find(({ id }) => id === key)?.id;\n                if (id) {\n                  onToggle(id);\n                }\n              }}\n            >\n              <Section title=\"Group By\">\n                {groupings.map(({ id, title }) => (\n                  <Item key={id}>{title}</Item>\n                ))}\n              </Section>\n            </Menu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../../GroupByActionButton\";\nimport {\n  changesViewGroupingsState,\n  changesGroupingActiveState,\n  GroupingIds,\n} from \"../ChangesView.state\";\n\nexport const ChangesGroupByActionButton = (): React.ReactElement => {\n  // Grouping is extensible in Intellij platform, but we only support grouping by directory here.\n\n  const groupings = useRecoilValue(changesViewGroupingsState);\n\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: GroupingIds) => {\n        set(changesGroupingActiveState(id), (value) => !value);\n      },\n    []\n  );\n\n  return <GroupByActionButton groupings={groupings} onToggle={toggleGroup} />;\n};\n","import React from \"react\";\nimport { useRecoilState } from \"recoil\";\nimport {\n  showIgnoredFilesState,\n  showRelatedFilesState,\n} from \"../ChangesView.state\";\nimport {\n  IconButtonWithMenu,\n  Item,\n  Menu,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\n\nexport const ViewOptionsActionButton = (): React.ReactElement => {\n  const [showRelatedFiles, setShowRelatedFiles] = useRecoilState(\n    showRelatedFilesState\n  );\n  const [showIgnoredFiles, setShowIgnoredFiles] = useRecoilState(\n    showIgnoredFilesState\n  );\n  const viewOptions = { showRelatedFiles, showIgnoredFiles };\n\n  return (\n    <IconButtonWithMenu\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          selectedKeys={Object.keys(viewOptions).filter(\n            (key) => viewOptions[key as keyof typeof viewOptions]\n          )}\n          onAction={(key) => {\n            switch (key) {\n              case \"showIgnoredFiles\":\n                return setShowIgnoredFiles((value) => !value);\n              case \"showRelatedFiles\":\n                return setShowRelatedFiles((value) => !value);\n            }\n          }}\n        >\n          <Item key=\"showIgnoredFiles\">Show Ignored Files</Item>\n          <Item key=\"showRelatedFiles\">\n            Show Files Related to Active Changelist\n          </Item>\n        </Menu>\n      )}\n    >\n      <PlatformIcon icon=\"actions/show.svg\" />\n    </IconButtonWithMenu>\n  );\n};\n","import {\n  Toolbar,\n  ToolbarSeparator,\n  ActionTooltip,\n  CommonActionId,\n  TooltipTrigger,\n  ActionButton,\n} from \"@intellij-platform/core\";\nimport { ChangeListsActionButton } from \"./ActionButtons/ChangeListsActionButton\";\nimport { ChangesGroupByActionButton } from \"./ActionButtons/ChangesGroupByActionButton\";\nimport { ViewOptionsActionButton } from \"./ActionButtons/ViewOptionsActionButton\";\nimport React from \"react\";\n\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nexport function ChangesViewToolbar() {\n  return (\n    <Toolbar border=\"bottom\">\n      <ActionButton actionId={CommonActionId.REFRESH} />\n      <ActionButton actionId={VcsActionIds.ROLLBACK} />\n      <ActionButton actionId={VcsActionIds.SHOW_DIFF} />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Changelists\" />}>\n        <ChangeListsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={VcsActionIds.SHELVE_SILENTLY} />\n      <ToolbarSeparator />\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"Group By\" />}>\n        <ChangesGroupByActionButton />\n      </TooltipTrigger>\n      <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n        <ViewOptionsActionButton />\n      </TooltipTrigger>\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </Toolbar>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { atom, selector, useRecoilCallback, useSetRecoilState } from \"recoil\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ninterface ProgressIndicator {\n  /**\n   * Sets the primary text, usually shown above the progress bar.\n   * @param text\n   */\n  setText(text: string): void;\n\n  /**\n   * Sets the secondary text, usually shown below the primary text.\n   * @param secondaryText\n   */\n  setSecondaryText(secondaryText: string): void;\n\n  /**\n   * Sets the fraction: a number between 0.0 and 1.0 reflecting the ratio of work that has already been done (0.0 for nothing, 1.0 for all).\n   * Only works for determinate indicator. The fraction should provide the user with a rough estimation of the time left;\n   * if that's impossible, consider making the progress indeterminate.\n   *\n   * @see ProgressIndicator#setIndeterminate\n   */\n  setFraction(progress: number): void;\n\n  /**\n   * sets `indeterminate` state of the associated progress bar.\n   * @param indeterminate\n   */\n  setIndeterminate(indeterminate: boolean): void;\n}\n\ninterface Progress {\n  text: string;\n  secondaryText: string;\n  isIndeterminate: boolean;\n  fraction: number;\n}\n\nexport interface Task {\n  id: number;\n  title: string;\n  isCancelable: boolean;\n  abortController: AbortController;\n  progress: Progress;\n}\n\nexport const tasksState = atom<Task[]>({\n  key: \"tasks.list\",\n  default: [],\n});\n\n/**\n * Selector that gives the first task. Optimized for use cases like in the statusbar where only the first task is shown.\n * While tasks state can update as tasks progress, this only changes when the first task does.\n */\nexport const firstTaskState = selector<Task | null>({\n  key: \"tasks.first\",\n  get: ({ get }) => get(tasksState)[0],\n});\n\n/**\n * Optimized recoil value to get the number of tasks, if the tasks are not needed.\n */\nexport const taskCountState = selector<number>({\n  key: \"tasks.count\",\n  get: ({ get }) => get(tasksState).length,\n});\n\nlet progressSeq = 0;\n\ntype TaskRunFn = (\n  progressIndicator: ProgressIndicator,\n  abortSignal: AbortSignal /* FIXME: refine type*/\n) => void | Promise<void>;\n\ntype TaskDefinition = TaskRunFn | { run: TaskRunFn; onFinished?: () => void };\n\n/**\n * Returns a function which can be used to run a task.\n * Tasks are shown in the toolbar or as a modal window.\n */\nexport const useRunTask = () => {\n  const setTasksState = useSetRecoilState(tasksState);\n  return useEventCallback(\n    (\n      {\n        title,\n        isCancelable = false,\n      }: { title: string; isCancelable?: boolean },\n      task: TaskDefinition\n    ): Task[\"id\"] => {\n      const abortController: AbortController = new CAF.cancelToken();\n      const id = ++progressSeq;\n      setTasksState((tasks) => [\n        ...tasks,\n        {\n          id: progressSeq++,\n          title,\n          abortController,\n          isCancelable,\n          progress: {\n            fraction: 0,\n            text: \"\",\n            secondaryText: \"\",\n            isIndeterminate: false,\n          },\n        },\n      ]);\n      const setTaskProgressState = (updates: Partial<Progress>) => {\n        setTasksState((tasks) => {\n          return tasks.map((task) =>\n            task.id === id\n              ? { ...task, progress: { ...task.progress, ...updates } }\n              : task\n          );\n        });\n      };\n      const taskDefinition = typeof task === \"function\" ? { run: task } : task;\n      Promise.resolve(\n        taskDefinition.run(\n          {\n            setFraction(fraction: number) {\n              setTaskProgressState({ fraction });\n            },\n            setText(text: string) {\n              setTaskProgressState({ text });\n            },\n            setSecondaryText(secondaryText: string) {\n              setTaskProgressState({ secondaryText });\n            },\n            setIndeterminate(isIndeterminate: boolean) {\n              setTaskProgressState({ isIndeterminate });\n            },\n          },\n          abortController.signal\n        )\n      ).finally(() => {\n        setTasksState((tasks) => tasks.filter((task) => task.id !== id));\n        taskDefinition.onFinished?.();\n      });\n      return id;\n    }\n  );\n};\n\n/**\n * Returns a function to cancel a task based on id.\n */\nexport const useCancelTask = () =>\n  useRecoilCallback(({ snapshot }) => (id: Task[\"id\"]) => {\n    const task = snapshot\n      .getLoadable(tasksState)\n      .getValue()\n      .find((task) => task.id === id);\n    if (task) {\n      task.abortController.abort();\n    }\n  });\n","import { selectorFamily } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport const resolvedRefState = selectorFamily<\n  string,\n  { repoRoot: string; ref: string }\n>({\n  key: \"vcs/resolved-branche-ref\",\n  get:\n    ({ repoRoot, ref }: { repoRoot: string; ref: string }) =>\n    () => {\n      return git.resolveRef({ fs, dir: repoRoot, ref, depth: 3 });\n    },\n});\n","export type DateRange = { from?: Date; to?: Date };\nexport const dateToString = (date: Date) => {\n  return `${date.getMonth() + 1}/${date.getDate()}/${date\n    .getFullYear()\n    .toString()\n    .slice(-2)}`;\n};\nexport const dateRangeToString = (dateRange: DateRange): string => {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n};\n","import { mapObjIndexed } from \"ramda\";\nimport {\n  atom,\n  atomFamily,\n  CallbackInterface,\n  RecoilState,\n  selector,\n  selectorFamily,\n  useRecoilCallback,\n} from \"recoil\";\n\nimport { DateRange, dateRangeToString } from \"./DateRange\";\n\nexport const vcsTabKeysState = atom<string[]>({\n  key: \"vcs/log/tabs/keys\",\n  default: [\"MAIN\"],\n});\n\nexport const vcsActiveTabKeyState = atom<string>({\n  key: \"vcs/log/tabs/activeKey\",\n  default: \"MAIN\",\n});\n\n/**\n * The title of a VCS log tab\n */\nexport const vcsTabTitleState = selectorFamily({\n  key: \"vcs/logs/tab/title\",\n  get:\n    (key: string) =>\n    ({ get }) => {\n      const searchQuery = get(vcsLogFilter.searchQuery(key));\n      const user = get(vcsLogFilter.user(key));\n      const date = get(vcsLogFilter.date(key));\n      const branches = get(vcsLogFilter.branch(key));\n      const parts: { short: string; long: string }[] = [];\n\n      if (branches?.length > 0) {\n        parts.push({\n          short: branches.join(\", \"),\n          long: `on ${branches.join(\", \")}`,\n        });\n      }\n      if (date) {\n        parts.push({\n          short: dateRangeToString(date),\n          long: `made ${dateRangeToString(date)}`,\n        });\n      }\n      if (searchQuery) {\n        parts.push({\n          short: `'${searchQuery}'`,\n          long: `containing '${searchQuery}'`,\n        });\n      }\n      if (user) {\n        parts.push({\n          short: user,\n          long: `by ${user}`,\n        });\n      }\n\n      return `Log${parts.length > 0 ? \": \" : \"\"}${\n        parts.length === 1\n          ? parts[0].short\n          : parts.map((part) => part.long).join(\" \")\n      }`;\n    },\n});\n\nconst tabStats: Array<(tabKey: string) => RecoilState<unknown>> = [];\n\n/**\n * marks a recoil state as a piece of state for VCS log tabs, so that it's cleaned up when the tab is closed.\n * @param someAtomFamily\n */\nexport const vcsLogTabState = <T extends (tabKey: string) => RecoilState<any>>(\n  someAtomFamily: T\n): T => {\n  tabStats.push(someAtomFamily);\n  return someAtomFamily;\n};\n\n/**\n * Whether branches filter is visible for a VCS log tab\n */\nexport const vcsLogTabShowBranchesState = vcsLogTabState(\n  atomFamily<boolean, string>({\n    key: \"vcs/logs/filter/showBranches\",\n    default: false,\n  })\n);\n\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsState = vcsLogTabState(\n  atomFamily<boolean, string>({\n    key: \"vcs/logs/showCommitDetails\",\n    default: true,\n  })\n);\n/**\n * Whether the commit details is shown (in a split view together with commit changes).\n */\nexport const vcsLogTabShowCommitDetailsInCurrentTabState = selector({\n  key: \"vcs/logs/showCommitDetails/currentTab\",\n  get: ({ get }) =>\n    get(vcsLogTabShowCommitDetailsState(get(vcsActiveTabKeyState))),\n});\n\nexport const CURRENT_USER_FILTER_VALUE = \"*\";\nexport const vcsLogFilter = {\n  /**\n   * The state of search query, for a VCS log tab\n   */\n  searchQuery: vcsLogTabState(\n    atomFamily<string, string>({\n      key: \"vcs/logs/filter/searchQuery\",\n      default: \"\",\n    })\n  ),\n  /**\n   * The state of whether \"match case\" is on the search query, for a VCS log tab\n   */\n  matchCase: vcsLogTabState(\n    atomFamily<boolean, string>({\n      key: \"vcs/logs/filter/matchCase\",\n      default: false,\n    })\n  ),\n  /**\n   * The state of whether \"regexp\" is on the search query, for a VCS log tab\n   */\n  regExp: vcsLogTabState(\n    atomFamily<boolean, string>({\n      key: \"vcs/logs/filter/regExp\",\n      default: false,\n    })\n  ),\n  /**\n   * The state of user filter, for a VCS log tab\n   */\n  user: vcsLogTabState(\n    atomFamily<string | null, string>({\n      key: \"vcs/logs/filter/user\",\n      default: null,\n    })\n  ),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  date: atomFamily<DateRange | null, string>({\n    key: \"vcs/logs/filter/date\",\n    default: null,\n  }),\n  /**\n   * The state of date filter, for a VCS log tab\n   */\n  branch: vcsLogTabState(\n    atomFamily<string[], string>({\n      key: \"vcs/logs/filter/branch\",\n      default: [],\n    })\n  ),\n};\n\ntype FamilyToAtom<F> = F extends (param: any) => RecoilState<infer S>\n  ? RecoilState<S>\n  : never;\n\ntype VcsLogFilter = typeof vcsLogFilter;\n\nexport const vcsLogFilterCurrentTab = mapObjIndexed((atomFamily, key) => {\n  return selector({\n    key: `vcs/logs/currentTabFilter/${key}`,\n    get: ({ get }) =>\n      get(atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>),\n    set: ({ set, get }, newValue) => {\n      set(\n        atomFamily(get(vcsActiveTabKeyState)) as RecoilState<unknown>,\n        newValue\n      );\n    },\n  });\n}, vcsLogFilter) as {\n  [key in keyof VcsLogFilter]: FamilyToAtom<VcsLogFilter[key]>;\n};\n\nexport const useResetFilters = () =>\n  useRecoilCallback(\n    ({ reset }) =>\n      (tabKey: string) => {\n        Object.values(vcsLogFilter)\n          .map((state) => state(tabKey))\n          .forEach(reset);\n      },\n    []\n  );\n\nconst closeTabCallback =\n  ({ set, snapshot, reset }: CallbackInterface) =>\n  (tabKey: string) => {\n    const tabs = snapshot.getLoadable(vcsTabKeysState).getValue();\n    const currentActiveTabKey = snapshot\n      .getLoadable(vcsActiveTabKeyState)\n      .getValue();\n    if (currentActiveTabKey === tabKey) {\n      // make sure the active tab key remains valid, by switching to previous tab. In the reference implementation\n      // the previously activated tab will be activated instead of the previous one index-wise, but it's a\n      // negligible and easy-to-fix difference.\n      set(\n        vcsActiveTabKeyState,\n        tabs[tabs.findIndex((key) => key === tabKey) - 1] || tabs[0]\n      );\n    }\n    set(vcsTabKeysState, (keys) => keys.filter((key) => key !== tabKey));\n    tabStats.forEach((state) => reset(state(tabKey)));\n  };\n\nexport function useCloseVcsTab() {\n  return useRecoilCallback(closeTabCallback, []);\n}\n","import git, { ReadCommitResult } from \"isomorphic-git\";\nimport { sort } from \"ramda\";\n\ntype Fs = Parameters<typeof git[\"readCommit\"]>[0][\"fs\"];\n\nconst cache = {};\nexport const commitDateComparator = (\n  a: ReadCommitResult,\n  b: ReadCommitResult\n) => b.commit.committer.timestamp - a.commit.committer.timestamp;\n\ntype CommitWithMeta = {\n  repoPath: string;\n  /**\n   * refs this commit contains in\n   */\n  containingRefs: Set<string>;\n  readCommitResult: ReadCommitResult;\n};\n\ntype RepoDescriptor = {\n  repoPath: string;\n  isBare?: boolean;\n};\n/**\n * Similar to git.log(...), but:\n * - supports multiple repos and multiple refs per repo.\n * - for each commit, includes the list of refs the commit is a part of\n * Commits are sorted by commit time, from new to old.\n */\nexport async function readCommits(\n  fs: Fs,\n  ...sources: Array<\n    RepoDescriptor & {\n      refs: string[];\n    }\n  >\n) {\n  const allCommits: Array<CommitWithMeta> = [];\n  const commitsMap: Record<string, CommitWithMeta> = {};\n  let commitsToProcess: Array<CommitWithMeta & RepoDescriptor> = [];\n\n  commitsToProcess.forEach((item) => {\n    commitsMap[item.readCommitResult.oid] = item;\n  });\n  const initialCommits = await Promise.all(\n    sources.flatMap(({ refs, repoPath, isBare }) =>\n      refs.map(async (ref) => {\n        const commit = await git\n          .resolveRef({\n            ...getCommonArgs({ repoPath, isBare }),\n            ref,\n            depth: 3,\n          })\n          .then((oid) =>\n            git.readCommit({\n              ...getCommonArgs({ repoPath, isBare }),\n              oid,\n            })\n          );\n        return { repoPath, isBare, commit, refs: new Set([ref]) };\n      })\n    )\n  );\n\n  sort(\n    ({ commit: c1 }, { commit: c2 }) => commitDateComparator(c1, c2),\n    initialCommits\n  ).forEach(({ commit, refs, repoPath, isBare }) =>\n    addCommit({ repoPath, isBare }, commit, -1, refs)\n  );\n\n  while (commitsToProcess.length > 0) {\n    const {\n      readCommitResult: latestCommit,\n      repoPath,\n      isBare,\n      containingRefs,\n    } = commitsToProcess.shift()!; // non-null assertion because of length>0;\n    allCommits.push({\n      repoPath,\n      readCommitResult: latestCommit,\n      containingRefs: containingRefs,\n    });\n    const parentCommits = await Promise.all(\n      latestCommit.commit.parent.map((oid) =>\n        git.readCommit({\n          ...getCommonArgs({ repoPath, isBare }),\n          oid,\n        })\n      )\n    );\n    // insert new parents in the right place so that commitsToProcess remains sorted.\n    parentCommits.forEach((commit) => {\n      const index = commitsToProcess.findIndex(\n        ({ readCommitResult: aCommit }) =>\n          commitDateComparator(aCommit, commit) > 0\n      );\n      addCommit({ repoPath, isBare }, commit, index, containingRefs);\n    });\n  }\n  return allCommits;\n\n  function addCommit(\n    { repoPath, isBare }: RepoDescriptor,\n    commit: ReadCommitResult,\n    index: number,\n    refs: Set<string>\n  ) {\n    if (commitsMap[commit.oid]) {\n      commitsMap[commit.oid].containingRefs = new Set([\n        ...commitsMap[commit.oid].containingRefs,\n        ...refs,\n      ]);\n    } else {\n      const entry: CommitWithMeta & RepoDescriptor = {\n        readCommitResult: commit,\n        containingRefs: commitsMap[commit.oid]\n          ? new Set([...commitsMap[commit.oid].containingRefs, ...refs])\n          : refs,\n        repoPath,\n        isBare,\n      };\n      commitsMap[commit.oid] = entry;\n      commitsToProcess.splice(\n        index >= 0 ? index : commitsToProcess.length,\n        0,\n        entry\n      );\n    }\n  }\n  function getCommonArgs({\n    repoPath,\n    isBare,\n  }: {\n    repoPath: string;\n    isBare?: boolean;\n  }) {\n    return {\n      fs,\n      cache,\n      [isBare ? \"gitdir\" : \"dir\"]: repoPath,\n    };\n  }\n}\n","import { ReadCommitResult } from \"isomorphic-git\";\nimport { atom, atomFamily, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { allBranchesState } from \"../../Branches/branches.state\";\nimport { resolvedRefState } from \"../../refs.state\";\nimport { readCommits } from \"./readCommits\";\nimport { GitRef } from \"../GitRef\";\nimport { indexBy } from \"ramda\";\n\nfunction match(\n  input: string,\n  query: string,\n  flags: { matchCase?: boolean; regExp?: boolean } = {}\n) {\n  if (flags.regExp) {\n    return new RegExp(query, flags.matchCase ? \"\" : \"i\").test(input);\n  }\n  if (!flags.matchCase) {\n    return input.toLowerCase().includes(query.toLowerCase());\n  }\n  return input.includes(query);\n}\n\ntype CommitLogItem = {\n  readCommitResult: ReadCommitResult;\n  containingRefs: Set<string>;\n  repoPath: string;\n};\n\nexport const allCommitsState = selector<Array<CommitLogItem>>({\n  key: \"vcs/allRepoCommits\",\n  get: ({ get }) =>\n    // TODO: readCommit can take too long. Suspending anything that depends on it leads to poor UX. would be nicer\n    //  to have the state updated (like an atom instead of selector) when commits are read, instead of query inside\n    //  the selector. But the challenge is that it does depend on another piece of state, allBranchesState\n    readCommits(\n      fs,\n      ...get(allBranchesState).map(\n        ({ repoRoot, localBranches, remoteBranches }) => ({\n          repoPath: repoRoot,\n          refs: [\"HEAD\"]\n            .concat(localBranches.map((branch) => branch.name))\n            .concat(\n              remoteBranches.map((branch) => `${branch.remote}/${branch.name}`)\n            ),\n        })\n      )\n    ),\n});\n\nexport const commitsTableRowsState = selector({\n  key: \"vcs/log/rows\",\n  get: ({ get }) => {\n    const searchQuery = get(vcsLogFilterCurrentTab.searchQuery);\n    const branches = get(vcsLogFilterCurrentTab.branch);\n    const flags = {\n      matchCase: get(vcsLogFilterCurrentTab.matchCase),\n      regExp: get(vcsLogFilterCurrentTab.regExp),\n    };\n    const dateFilter = get(vcsLogFilterCurrentTab.date);\n\n    const rows = get(allCommitsState)\n      .filter(\n        ({ containingRefs }) =>\n          !branches?.length ||\n          branches.some((branch) => containingRefs.has(branch))\n      )\n      .filter(\n        ({ readCommitResult: { commit } }) =>\n          (!dateFilter?.from ||\n            commit.author.timestamp * 1000 > dateFilter.from.getTime()) &&\n          (!dateFilter?.to ||\n            commit.author.timestamp * 1000 < dateFilter.to.getTime())\n      )\n      .filter(\n        ({ readCommitResult: { commit } }) =>\n          !searchQuery ||\n          match(commit.message, searchQuery, flags) ||\n          match(commit.tree, searchQuery, { matchCase: false })\n      );\n    return {\n      rows,\n      byOid: indexBy(({ readCommitResult: commit }) => commit.oid, rows),\n    };\n  },\n});\n\nexport const allResolvedRefsState = selector({\n  key: \"vcs/logs/all-refs\",\n  get: ({ get }) => {\n    const repoBranches = get(allBranchesState);\n    const refs: Record<string, GitRef[]> = {};\n    const addRef = (ref: string, value: GitRef) => {\n      refs[ref] = refs[ref] || [];\n      refs[ref].push(value);\n    };\n    repoBranches.forEach(({ repoRoot }) => {\n      addRef(get(resolvedRefState({ repoRoot, ref: \"HEAD\" })), {\n        type: \"head\",\n        name: \"HEAD\",\n      });\n    });\n    repoBranches.forEach(({ repoRoot, localBranches, currentBranch }) => {\n      localBranches.forEach((branch) => {\n        addRef(get(resolvedRefState({ repoRoot, ref: branch.name })), {\n          type: \"localBranch\",\n          name: branch.name,\n          isCurrent: currentBranch?.name === branch.name,\n          trackingBranch: branch.trackingBranch,\n        });\n      });\n    });\n    repoBranches.forEach(({ repoRoot, remoteBranches }) =>\n      remoteBranches.forEach((branch) => {\n        const branchName = `${branch.remote}/${branch.name}`;\n        addRef(get(resolvedRefState({ repoRoot, ref: branchName })), {\n          type: \"remoteBranch\",\n          name: branchName,\n        });\n      })\n    );\n    return refs;\n  },\n});\n\n/**\n * selection state of the commits table\n * TODO: make it per-tab\n */\nexport const commitsSelectionState = atom<Selection>({\n  key: \"vcs/log/commits/selection\",\n  default: new Set([]),\n});\n\n/**\n * OIDs of the selected commits in commits table.\n */\nexport const selectedCommitOids = selector({\n  key: `${commitsSelectionState.key}/keys`,\n  get: ({ get }) => {\n    const selection = get(commitsSelectionState);\n    if (selection === \"all\") {\n      return get(commitsTableRowsState).rows.map(\n        ({ readCommitResult: { oid } }) => oid\n      );\n    }\n    return [...selection].map((i) => `${i}`);\n  },\n});\n\nexport const selectedCommitsState = selector({\n  key: `${commitsSelectionState.key}/items`,\n  get: ({ get }) =>\n    get(selectedCommitOids).map((oid) => get(commitsTableRowsState).byOid[oid]),\n});\n\n/**\n * Selected commit in the commits table. The first row, if multiple rows are selected\n */\nexport const selectedCommitState = selector({\n  key: \"vcs/log/details/selectedCommit\",\n  get: ({ get }) => {\n    const oid = get(selectedCommitOids)[0];\n    return (oid && get(commitsTableRowsState).byOid[oid]) || null;\n  },\n});\n\nexport const vcsTableShowCommitTimestampState = atom<boolean>({\n  key: \"vcs/log/commits/showCommitTimestamp\",\n  default: false,\n});\n\nexport const vcsTableReferencesOnTheLeftState = atom<boolean>({\n  key: \"vcs/log/commits/referencesOnTheLeft\",\n  default: false,\n});\n\nexport const vcsTableHighlightMyCommitsState = atom<boolean>({\n  key: \"vcs/log/commits/highlightMyCommits\",\n  default: false,\n});\n\nexport const authorColumn = {\n  id: \"Default.Author\",\n  name: \"Author\",\n};\nexport const hashColumn = {\n  id: \"Default.Hash\",\n  name: \"Hash\",\n};\n\nexport const dateColumn = {\n  id: \"Date.Date\",\n  name: \"Date\",\n};\n\nconst defaultVisibleColumns = [authorColumn.id, dateColumn.id];\nexport const vcsTableColumnsVisibilityState = atomFamily<boolean, string>({\n  key: \"vcs/log/commits/highlightMyCommits\",\n  default: (id) => defaultVisibleColumns.includes(id),\n});\n","import path from \"path\";\nimport { groupBy } from \"ramda\";\nimport { useRecoilCallback } from \"recoil\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport React from \"react\";\nimport { useBalloonManager } from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport { commitFiles } from \"../../commit-utils\";\nimport {\n  useRefreshRepoStatuses,\n  vcsRootForFile,\n} from \"../../file-status.state\";\nimport { useRunTask } from \"../../../tasks\";\nimport { commitTaskIdState } from \"./ChangesView.state\";\nimport { AnyChange, Change } from \"../Change\";\nimport { resolvedRefState } from \"../../refs.state\";\nimport { repoCurrentBranchNameState } from \"../../Branches/branches.state\";\nimport { allCommitsState } from \"../../VersionControlToolWindow/CommitsView/CommitsTable.state\";\n\nconst commitSuccessfulMessage = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 file committed}\n    other {# files committed}\n  }`,\n  \"en-US\"\n);\n\n/**\n * Returns a commit callback to be used to commit a bunch of changes.\n * Syncs all relevant state (like file status, and change lists) after commit.\n */\nexport function useCommitChanges() {\n  const refreshFileStatus = useRefreshRepoStatuses();\n  const balloonManager = useBalloonManager();\n  const runTask = useRunTask();\n\n  return useRecoilCallback(\n    ({ snapshot, set, refresh }) =>\n      (changes: readonly AnyChange[], commitMessage: string) => {\n        const taskId = runTask(\n          { title: \"Committing...\", isCancelable: false },\n          {\n            run: async ({ setIndeterminate }) => {\n              setIndeterminate(true);\n              const changesGroupedByRepo = groupBy(\n                ({ repoRoot }) => repoRoot,\n                (\n                  await Promise.all(\n                    changes.map(async (change) => {\n                      const filePath = Change.path(change);\n                      const repoRoot = snapshot\n                        .getLoadable(vcsRootForFile(filePath))\n                        .getValue();\n                      const content = (await fs.promises.exists(filePath))\n                        ? await fs.promises.readFile(filePath)\n                        : null;\n                      return repoRoot\n                        ? {\n                            repoRoot,\n                            filePath: path.relative(repoRoot, filePath),\n                            content,\n                          }\n                        : null;\n                    })\n                  )\n                ).filter(notNull)\n              );\n              await Promise.all(\n                Object.entries(changesGroupedByRepo).map(\n                  async ([repoRoot, files]) => {\n                    const updates = files.reduce<{\n                      [filePath: string]: Uint8Array | null;\n                    }>(\n                      (soFar, { filePath, content }) => ({\n                        ...soFar,\n                        [filePath]:\n                          typeof content === \"string\"\n                            ? new TextEncoder().encode(content)\n                            : content,\n                      }),\n                      {}\n                    );\n                    await commitFiles({\n                      fs,\n                      dir: repoRoot,\n                      updates,\n                      message: commitMessage,\n                      author: {\n                        // FIXME\n                        name: \"Alireza\",\n                        email: \"alireza.mirian@gmail.com\",\n                      },\n                    });\n                    const currentBranch = await snapshot.getPromise(\n                      repoCurrentBranchNameState(repoRoot)\n                    );\n                    if (currentBranch) {\n                      refresh(\n                        resolvedRefState({\n                          repoRoot,\n                          ref: currentBranch,\n                        })\n                      );\n                    }\n                    refresh(resolvedRefState({ repoRoot, ref: \"HEAD\" }));\n                  }\n                )\n              ).then(\n                () => {\n                  refresh(allCommitsState); // maybe a more efficient way to update only the newly added commit, when\n                  // allCommitsState is refactored to allow that\n                  refreshFileStatus().catch(console.error);\n\n                  balloonManager.show({\n                    icon: \"Info\",\n                    body: (\n                      <>\n                        {`${commitSuccessfulMessage.format({\n                          count: changes.length,\n                        })}: `}\n                        {commitMessage\n                          .split(\"\\n\")\n                          .flatMap((part, index) => [<br key={index} />, part])\n                          .slice(1)}\n                      </>\n                    ),\n                  });\n                },\n                (e) => {\n                  balloonManager.show({\n                    icon: \"Error\",\n                    title: \"Commit failed!\",\n                    body: \"Could not commit files.\",\n                  });\n                  console.error(\"Commit error\", e);\n                }\n              );\n            },\n            onFinished: () => {\n              set(commitTaskIdState, null);\n            },\n          }\n        );\n        set(commitTaskIdState, taskId);\n      },\n    []\n  );\n}\n","import git from \"isomorphic-git\";\n\n/**\n * A wrapper around `git.commit`, which interfaces on file updates, instead of tree oid.\n * It will iterate on the provided files and create new blobs for each one. Then it creates\n * a new tree object corresponding to the new state, which in turn is passed to git.commit.\n * This way of committing files by building the new tree directly, and without using index\n * provides more flexibility in selectively committing only some changes, and is similar to\n * how it's done in JetBrains IDEs.\n */\nexport async function commitFiles({\n  updates,\n  fs,\n  dir,\n  gitdir,\n  ...options\n}: Omit<Parameters<typeof git[\"commit\"]>[0], \"tree\"> & {\n  /**\n   * A mapping from file paths to either:\n   * - the new content of the file that should be committed, in form of a Uint8Array blob\n   * - null, indicating the files should be removed\n   */\n  updates: { [filePath: string]: Uint8Array | null };\n}) {\n  const headTreeOid = await git.resolveRef({ fs, dir, gitdir, ref: \"HEAD\" });\n  const headTree = await git.readTree({\n    fs,\n    dir,\n    gitdir,\n    oid: headTreeOid,\n  });\n  const entries = headTree.tree;\n\n  let containsChange = false;\n  // Write content into blobs, and upsert respective entries with the new oids\n  await Promise.all(\n    Object.entries(updates).map(async ([filePath, blob]) => {\n      const index = entries.findIndex(({ path }) => path === filePath);\n      if (blob == null) {\n        // null indicates removed file\n        if (index > -1) {\n          containsChange = true;\n          entries.splice(index, 1);\n        }\n        return;\n      }\n      const entry = entries[index];\n      const oid = await git.writeBlob({ fs, dir, gitdir, blob });\n      if (entry) {\n        entry.oid = oid;\n      } else {\n        entries.push({\n          type: \"blob\",\n          mode: \"100644\", // Default mode. Maybe should be input?\n          oid,\n          path: filePath,\n        });\n      }\n      containsChange = true;\n    })\n  );\n\n  if (!containsChange) {\n    throw new Error(\"Nothing to commit!\");\n  }\n  // Write the new tree into the git object database\n  const newTreeOid = await git.writeTree({ fs, dir, gitdir, tree: entries });\n\n  // Commit using the newly created tree\n  const commitRef = await git.commit({\n    ...options,\n    fs,\n    dir,\n    gitdir,\n    tree: newTreeOid,\n  });\n\n  // Index is not updated when committing from a custom tree. We need to reset index for each updated file.\n  await Promise.all(\n    Object.keys(updates).map((filepath) =>\n      git.resetIndex({\n        fs,\n        dir,\n        gitdir,\n        filepath,\n        ref: commitRef /* Default HEAD would work too in normal cases where commit is added on HEAD, but this is more accurate */,\n      })\n    )\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport React, { useEffect, useImperativeHandle, useRef } from \"react\";\nimport { useRecoilCallback, useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  Button,\n  PlatformIcon,\n  styled,\n  useBalloonManager,\n  useDefaultToolWindowContext,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  amendCommitState,\n  commitErrorMessageState,\n  commitMessageState,\n  commitTaskIdState,\n  includedChangesState,\n} from \"./ChangesView.state\";\nimport { useCommitChanges } from \"./useCommitChanges\";\n\nconst StyledCommitMessageContainer = styled.div`\n  background: ${({ theme }) =>\n    theme.dark\n      ? \"#2b2b2b\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#fff\"};\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledCommitMessageTextArea = styled.textarea`\n  flex: 1;\n  background: none;\n  padding: 0.25rem 0.375rem;\n  color: ${({ theme }) =>\n    theme.dark\n      ? \"#a9b7c6\" /*FIXME: should come from color scheme. attributes.TEXT.BACKGROUND*/\n      : \"#000\"};\n  font-family: inherit;\n  border: none;\n  resize: none;\n  outline: none;\n`;\nconst StyledCommitActionsRow = styled.div`\n  display: flex;\n  gap: 0.3rem;\n  padding: 0.4rem;\n`;\nconst StyledErrorMessage = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 0.125rem 0.5rem;\n  gap: 0.25rem;\n  position: sticky; // prevents commit message scroll jump when message is toggled on and off\n  color: ${({ theme }) => theme.commonColors.red};\n`;\n\n/**\n * Commit message and commit buttons shown in the bottom/right split view of the commit toolwindow\n */\nexport function CommitView({\n  editorRef,\n}: {\n  editorRef: React.RefObject<{ focus: () => void }>;\n}) {\n  const commitMessageTextAreaRef = useRef<HTMLTextAreaElement>(null);\n  const [commitMessage, setCommitMessage] = useRecoilState(commitMessageState);\n  const commit = useCommitChanges();\n  const amend = useRecoilValue(amendCommitState);\n  const balloonManager = useBalloonManager();\n  const [errorMessage, setErrorMessage] = useRecoilState(\n    commitErrorMessageState\n  );\n  const commitTaskId = useRecoilValue(commitTaskIdState);\n\n  useEffect(() => {\n    if (commitMessage) {\n      setErrorMessage(\"\");\n    }\n  }, [commitMessage]);\n\n  const commitSelectedChanges = useRecoilCallback(({ snapshot }) => {\n    const includedChanges = snapshot\n      .getLoadable(includedChangesState)\n      .getValue();\n    const commitMessage = snapshot.getLoadable(commitMessageState).getValue();\n    return () => {\n      if (includedChanges.length === 0) {\n        setErrorMessage(\"Select files to commit\");\n        return;\n      }\n      if (!commitMessage) {\n        setErrorMessage(\"Specify commit message\");\n        return;\n      }\n      if (snapshot.getLoadable(amendCommitState).getValue()) {\n        balloonManager.show({\n          icon: \"Error\",\n          title: \"Unsupported action\",\n          body: \"Amending commits is not yet supported.\",\n        });\n        return;\n      }\n      commit(includedChanges, commitMessage);\n      // TODO: clear message and add an entry in commit message history\n    };\n  }, []);\n\n  const { hasFocus } = useDefaultToolWindowContext();\n\n  useImperativeHandle(\n    editorRef,\n    () => ({\n      focus: () => {\n        commitMessageTextAreaRef.current?.focus();\n      },\n    }),\n    []\n  );\n\n  return (\n    <StyledCommitMessageContainer>\n      <StyledCommitMessageTextArea\n        ref={commitMessageTextAreaRef}\n        value={commitMessage}\n        onChange={(event) => {\n          setCommitMessage(event.target.value);\n        }}\n        placeholder=\"Commit Message\"\n        data-gramm=\"false\"\n      />\n      {errorMessage && (\n        <StyledErrorMessage>\n          <PlatformIcon icon=\"general/error.svg\" /> {errorMessage}\n        </StyledErrorMessage>\n      )}\n      <StyledCommitActionsRow>\n        <Button\n          preventFocusOnPress\n          variant={hasFocus ? \"default\" : undefined}\n          onPress={commitSelectedChanges}\n          isDisabled={commitTaskId != null}\n          mnemonic=\"i\"\n        >\n          {amend ? \"Amend Commit\" : \"Commit\"}\n        </Button>\n        <Button preventFocusOnPress onPress={notImplemented} mnemonic=\"P\">\n          {amend ? \"Amend Commit and Push...\" : \"Commit and Push...\"}\n        </Button>\n      </StyledCommitActionsRow>\n    </StyledCommitMessageContainer>\n  );\n}\n","import React from \"react\";\nimport { StatusColor } from \"../FileStatusColor\";\nimport { AnyChange, Change } from \"./Change\";\n\nexport const ChangesSummary = ({\n  changes,\n}: {\n  changes: ReadonlyArray<AnyChange>;\n}) => {\n  const modifiedCount = changes.filter(\n    (change) => Change.fileStatus(change) === \"MODIFIED\"\n  ).length;\n  const addedCount = changes.filter(Change.isAddition).length;\n  const deletedCount = changes.filter(Change.isDeletion).length;\n\n  return (\n    <>\n      {addedCount > 0 && (\n        <StatusColor status=\"ADDED\">{addedCount} added</StatusColor>\n      )}\n      {modifiedCount > 0 && (\n        <StatusColor status=\"MODIFIED\">{modifiedCount} modified</StatusColor>\n      )}\n      {deletedCount > 0 && (\n        <StatusColor status=\"DELETED\">{deletedCount} deleted</StatusColor>\n      )}\n    </>\n  );\n};\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  IconButton,\n  ActionHelpTooltip,\n  ActionTooltip,\n  Checkbox,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  UnknownThemeProp,\n} from \"@intellij-platform/core\";\n\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { amendCommitState, includedChangesState } from \"./ChangesView.state\";\nimport { focusCommitMessage } from \"./ChangesViewSplitter\";\n\nconst StyledActionsRow = styled.div`\n  display: flex;\n  padding: 0.125rem;\n  position: relative;\n`;\nconst StyledAmendCheckbox = styled(Checkbox)`\n  padding-right: 0.625rem;\n`;\nconst StyledChangesSummaryContainer = styled.span`\n  position: absolute;\n  right: 0.5rem;\n  top: 0.25rem;\n  background: ${({ theme }) =>\n    theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)};\n  z-index: 1;\n`;\nconst ChangesViewChangesSummary = () => {\n  const changes = useRecoilValue(includedChangesState);\n  return <ChangesSummary changes={changes} />;\n};\n\n/**\n * Amend checkbox, commit message history button, and summary of included changes, shown as a row\n * bellow changes tree, in commit tool window.\n */\nexport function CommitActionsRow() {\n  const [amend, setAmend] = useRecoilState(amendCommitState);\n\n  return (\n    <StyledActionsRow>\n      <TooltipTrigger\n        tooltip={\n          <ActionHelpTooltip\n            actionName=\"Amend Commit\"\n            helpText=\"Modify the latest commit of the current branch\"\n          />\n        }\n      >\n        {(props) => (\n          <span {...props}>\n            <StyledAmendCheckbox\n              isSelected={amend}\n              onChange={(value) => {\n                setAmend(value);\n                // TODO: alternate commit message between the latest commit message and the last edited message.\n                focusCommitMessage();\n              }}\n              preventFocus\n              mnemonic=\"m\"\n            >\n              Amend\n            </StyledAmendCheckbox>\n          </span>\n        )}\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Show Commit Options\" />}\n      >\n        <IconButton onPress={notImplemented}>\n          <PlatformIcon icon=\"general/gear.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <TooltipTrigger\n        tooltip={<ActionTooltip actionName=\"Commit Message History\" />}\n      >\n        <IconButton isDisabled onPress={notImplemented}>\n          <PlatformIcon icon=\"vcs/historyInline.svg\" />\n        </IconButton>\n      </TooltipTrigger>\n      <StyledChangesSummaryContainer>\n        <ChangesViewChangesSummary />\n      </StyledChangesSummaryContainer>\n    </StyledActionsRow>\n  );\n}\n","import { IntlMessageFormat } from \"intl-messageformat\";\nimport { selector, useRecoilValue } from \"recoil\";\nimport {\n  changeListsUnderSelection,\n  changesUnderSelectedKeys,\n} from \"./ChangesView.state\";\nimport { useSetActiveChangeList } from \"../change-lists.state\";\nimport { useRefreshRepoStatuses } from \"../../file-status.state\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport React from \"react\";\nimport { alertDialogRefState } from \"../../../Project/project.state\";\nimport { Change } from \"../Change\";\nimport { deleteFilesCallback } from \"../../../Project/fs-operations\";\n\nconst deleteChangeListMsg = new IntlMessageFormat(\n  `Delete {count, plural,\n    =1 {Changelist}\n    other {Changelists}\n  }`,\n  \"en-US\"\n);\n\nconst selectedFilesCountMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {1 selected file}\n    other {# selected files}\n  }`,\n  \"en-US\"\n);\n\nconst deletablePathsUnderChangesTreeSelectionState = selector({\n  key: \"changesView.selectedKeys.deletablePaths\",\n  get: ({ get }) =>\n    [...get(changesUnderSelectedKeys).values()]\n      .filter((change) => change.type !== \"DELETED\")\n      .map(Change.path),\n});\n\nconst deleteActionState = selector({\n  key: `vcs.changesView.action.${CommonActionId.DELETE}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: CommonActionId.DELETE,\n    title: \"Delete\",\n    description: \"Delete selected item\",\n    isDisabled: get(deletablePathsUnderChangesTreeSelectionState).length === 0,\n    actionPerformed: getCallback((callbackInterface) => async () => {\n      const { snapshot } = callbackInterface;\n      const deletePaths = deleteFilesCallback(callbackInterface);\n      const pathsToDelete = snapshot\n        .getLoadable(deletablePathsUnderChangesTreeSelectionState)\n        .getValue();\n\n      const alertDialog = snapshot\n        .getLoadable(alertDialogRefState)\n        .getValue().current;\n      if (pathsToDelete.length === 0) {\n        return;\n      }\n      const confirmed = await alertDialog?.confirm({\n        title: \"Delete\",\n        okText: \"Delete\",\n        message: (\n          <div\n            style={{ width: 354 }}\n          >{`Are you sure you want to delete ${selectedFilesCountMsg.format({\n            count: pathsToDelete.length,\n          })}?`}</div>\n        ),\n      });\n      if (confirmed) {\n        console.log(`deleting ${pathsToDelete}`);\n        await deletePaths(pathsToDelete);\n      }\n    }),\n  }),\n});\n\nexport function useChangesViewActions() {\n  const selectedChangeLists = useRecoilValue(changeListsUnderSelection);\n  const setActiveChangeList = useSetActiveChangeList();\n  const nonActiveSelectedChangeLists = [...selectedChangeLists].filter(\n    (list) => !list.active\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  const actions: ActionDefinition[] = [\n    {\n      id: CommonActionId.REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHELVE_SILENTLY,\n      title: \"Shelve Silently\",\n      icon: <PlatformIcon icon=\"vcs/shelveSilent.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    useRecoilValue(deleteActionState),\n  ];\n  // Actions are conditionally added instead of being disabled.\n  if (selectedChangeLists.size === 1) {\n    // FIXME: action should be scoped to change lists tree\n    actions.push({\n      id: VcsActionIds.RENAME_CHANGELIST,\n      title: \"Edit Changelist...\",\n      description: \"Edit name and description of selected changelist\",\n      icon: <PlatformIcon icon=\"actions/edit.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length > 0) {\n    actions.push({\n      id: VcsActionIds.REMOVE_CHANGELIST,\n      title: deleteChangeListMsg.format({\n        count: nonActiveSelectedChangeLists.length,\n      }) as string,\n      description: \"Remove changelist and move all changes to another\",\n      icon: <PlatformIcon icon=\"general/remove.svg\" />,\n      actionPerformed: notImplemented,\n    });\n  }\n  if (nonActiveSelectedChangeLists.length === 1) {\n    actions.push({\n      title: \"Set Active Changelist\",\n      description: \"Set changelist to which new changes are placed by default\",\n      id: VcsActionIds.SET_DEFAULT_CHANGELIST,\n      icon: <PlatformIcon icon=\"actions/selectall.svg\" />,\n      actionPerformed: () => {\n        setActiveChangeList(nonActiveSelectedChangeLists[0].id);\n      },\n    });\n  }\n  return actions;\n}\n","import React, { useRef } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionsProvider,\n  getAnchorOrientation,\n  styled,\n  ThreeViewSplitter,\n  TreeRefValue,\n  useToolWindowState,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { repoStatusUpdatingState } from \"../../file-status.state\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { commitMessageSizeState } from \"./ChangesView.state\";\nimport { ChangeViewTree } from \"./ChangeViewTree\";\nimport { ChangesViewToolbar } from \"./ChangesViewToolbar\";\nimport { CommitView } from \"./CommitView\";\nimport { CommitActionsRow } from \"./CommitActionsRow\";\nimport { useChangesViewActions } from \"./useChangesViewActions\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst StyledTreeViewWrapper = styled.div`\n  flex: 1;\n  overflow: auto;\n  position: relative;\n`;\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  right: 0.125rem;\n  top: 0.125rem;\n  z-index: 1;\n`;\n\n// Not so ideal solution for allowing imperatively focusing commit message. Should be ok, since there will\n// be at most only one instance of change view rendered.\nlet editor: { focus: () => void } | null = null;\n\nexport let focusCommitMessage = () => {\n  setTimeout(() => {\n    editor?.focus();\n  });\n};\n\nexport const ChangesViewSplitter = () => {\n  const {\n    state: { anchor },\n  } = useToolWindowState();\n  const treeRef = useRef<TreeRefValue>(null);\n  const editorRef = useRef<{ focus: () => void }>(null);\n  const orientation = getAnchorOrientation(anchor);\n  const updating = useRecoilValue(repoStatusUpdatingState);\n  const [commitMessageSize, setCommitMessageSize] = useRecoilState(\n    commitMessageSizeState(orientation)\n  );\n  const changesViewActions = useChangesViewActions();\n  const treeActions = useTreeActions({ treeRef });\n  // TODO(lib-candidate): ToolWindowAwareSplitter. A wrapper around ThreeViewSplitter which sets orientation based\n  //  on anchor orientation from useToolWindowState.\n  editor = editorRef.current;\n\n  return (\n    <ThreeViewSplitter\n      orientation={orientation}\n      innerView={\n        <ActionsProvider actions={[...treeActions, ...changesViewActions]}>\n          {({ shortcutHandlerProps }) => (\n            <StyledContainer {...shortcutHandlerProps}>\n              <ChangesViewToolbar />\n              <StyledTreeViewWrapper>\n                {updating && (\n                  <Delayed>\n                    <StyledLoadingWrapper>\n                      <LoadingGif />\n                    </StyledLoadingWrapper>\n                  </Delayed>\n                )}\n                <ChangeViewTree treeRef={treeRef} />\n              </StyledTreeViewWrapper>\n              <CommitActionsRow />\n            </StyledContainer>\n          )}\n        </ActionsProvider>\n      }\n      innerViewMinSize={50}\n      lastView={<CommitView editorRef={editorRef} />}\n      lastSize={commitMessageSize}\n      onLastResize={setCommitMessageSize}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function ChangesViewZeroState() {\n  const performAction = usePerformAction();\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To commit changes,{\" \"}\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        For recent changes, see{\" \"}\n        <Link onPress={notImplemented}>Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ChangesViewSplitter } from \"./ChangesViewSplitter\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useRecoilValue } from \"recoil\";\nimport { ChangesViewZeroState } from \"./ChangesViewZeroState\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const ChangesViewPane = () => {\n  const vcsRoots = useRecoilValue(vcsRootsState);\n  return (\n    <StyledContainer>\n      {vcsRoots.length > 0 ? <ChangesViewSplitter /> : <ChangesViewZeroState />}\n    </StyledContainer>\n  );\n};\n","import path from \"path\";\nimport React from \"react\";\n\nimport { LocalBranch } from \"./Branches/branches.state\";\n\nexport function TrackingBranchInfo({\n  branches,\n}: {\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n}) {\n  return (\n    <table style={{ borderSpacing: 0 }}>\n      {branches.map(({ branch, repoRoot }) => {\n        const mapping = branch.trackingBranch\n          ? `${branch.name}  ${branch.trackingBranch}`\n          : branches.length > 1\n          ? `${branch.name} (no tracking branch)`\n          : \"No tracking branch\";\n\n        return branches.length > 1 ? (\n          <tr key={repoRoot}>\n            <td>{path.basename(repoRoot)}: &nbsp;</td>\n            <td>{mapping}</td>\n          </tr>\n        ) : (\n          <tr key={repoRoot}>\n            <td>{mapping}</td>\n          </tr>\n        );\n      })}\n    </table>\n  );\n}\n","import React from \"react\";\nimport { selector, useRecoilValue } from \"recoil\";\nimport {\n  ActionTooltip,\n  MultiViewToolWindow,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nimport { ChangesViewPane } from \"./Changes/ChangesView/ChangesViewPane\";\nimport { vcsRootForFile } from \"./file-status.state\";\nimport { LocalBranch, repoBranchesState } from \"./Branches/branches.state\";\nimport { changesGroupingActiveState } from \"./Changes/ChangesView/ChangesView.state\";\nimport { TrackingBranchInfo } from \"./TrackingBranchInfo\";\nimport { Change } from \"./Changes/Change\";\nimport { allChangesState } from \"./Changes/changes.state\";\n\nexport const COMMIT_TOOLWINDOW_ID = \"Commit\";\n\nconst changesBranchesState = selector({\n  key: \"vcs/commitToolWindow/changedRepos\",\n  get: ({ get }): Array<{ repoRoot: string; branch: LocalBranch }> => {\n    const changesRepoRoots = get(allChangesState)\n      .map((change) => get(vcsRootForFile(Change.path(change))))\n      .filter(notNull);\n\n    return changesRepoRoots\n      .map((repoRoot) => {\n        const branch = get(repoBranchesState(repoRoot)).currentBranch;\n        return branch\n          ? {\n              repoRoot,\n              branch,\n            }\n          : null;\n      })\n      .filter(notNull);\n  },\n});\n\nexport const CommitToolWindow = () => {\n  const areChangesGroupedByRepo = useRecoilValue(\n    changesGroupingActiveState(\"repository\")\n  );\n  const changesBranches = useRecoilValue(changesBranchesState);\n  const title =\n    !areChangesGroupedByRepo && changesBranches[0]\n      ? `Commit to ${changesBranches[0]?.branch?.name || \"!\"}`\n      : \"Commit\";\n\n  return (\n    <MultiViewToolWindow>\n      <MultiViewToolWindow.View\n        tabContent={\n          <TooltipTrigger\n            isDisabled={areChangesGroupedByRepo || changesBranches.length === 0}\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={changesBranches} />}\n              />\n            }\n          >\n            <span>{title}</span>\n          </TooltipTrigger>\n        }\n        key=\"commit\"\n      >\n        <ChangesViewPane />\n      </MultiViewToolWindow.View>\n    </MultiViewToolWindow>\n  );\n};\n","import React, { useEffect } from \"react\";\n\n/**\n * Works around an issue where the focus is lost after a component rendering the focused element is suspended and\n * unsuspended. Haven't tracked down the issue, but it can be the same react 17 issue we worked around in\n * {@link UNSAFE_React17SuspenseFix}.\n */\nexport function UNSAFE_FocusRestoringSuspense({\n  children = null,\n}: {\n  children?: React.ReactNode;\n}) {\n  useEffect(() => {\n    const focusedElement = document.activeElement;\n    return () => {\n      if (\n        focusedElement instanceof HTMLElement &&\n        focusedElement !== document.activeElement &&\n        document.activeElement === document.body &&\n        focusedElement.isConnected\n      ) {\n        focusedElement.focus(); // restore focus\n      }\n    };\n  }, []);\n  return <>{children}</>;\n}\n","import { styled } from \"@intellij-platform/core\";\n\nexport const StyledHeader = styled.div`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  height: 2.0625rem;\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n  flex-shrink: 0;\n`;\nexport const StyledSpacer = styled.div`\n  flex-grow: 1;\n`;\nexport const StyledPlaceholderContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  display: flex;\n  flex-direction: column;\n  justify-content: end;\n  align-items: center;\n  gap: 0.25rem;\n  min-height: 37%;\n  overflow: hidden;\n`;\n","import React from \"react\";\n\nexport const parseCommitMessage = (commitMessage: string) => {\n  const lines = commitMessage.split(\"\\n\");\n  const bodyLines = lines.slice(1);\n  return {\n    subject: lines[0],\n    bodyAsString: bodyLines.join(\"\\n\"),\n    body: (\n      <>\n        {bodyLines.map((line, index) => (\n          <React.Fragment key={index}>\n            {index > 0 && <br />}\n            {line}\n          </React.Fragment>\n        ))}\n      </>\n    ),\n  };\n};\n\nexport function shortenOid(oid: string) {\n  return oid.slice(0, 8);\n}\n\nconst commitDateTimeFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitTimeFormatter = new Intl.DateTimeFormat([], {\n  hour: \"numeric\",\n  minute: \"numeric\",\n  hour12: true,\n});\n\nconst commitDateFormatter = new Intl.DateTimeFormat([], {\n  day: \"numeric\",\n  month: \"numeric\",\n  year: \"2-digit\",\n});\n\nexport function formatCommitDateTime(date: Date | number) {\n  return commitDateTimeFormatter.format(date).replace(\" \", \"\");\n}\n\nexport function formatCommitDate(date: Date | number) {\n  return commitDateFormatter.format(date);\n}\n\nexport function formatCommitTime(date: Date | number) {\n  return commitTimeFormatter.format(date).replace(\" \", \"\");\n}\n","import path from \"path\";\nimport { HighlightedTextValue, ItemLayout } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport {\n  createChangesTreeNodeRenderer,\n  formatFileCount,\n  NodeRenderer,\n  simpleGroupingRenderer,\n} from \"../../Changes/ChangesTree/changesTreeNodeRenderers\";\nimport { RepositoryNode } from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { shortenOid } from \"../commit-utils\";\nimport {\n  CommitChangesTreeNode,\n  CommitParentChangeTreeNode,\n} from \"./CommitsChangedFiles.state\";\n\nconst repoNodeRenderer: NodeRenderer<RepositoryNode> = (\n  node,\n  { fileCount }\n) => ({\n  textValue: path.basename(node.repository.dir),\n  rendered: (\n    <ItemLayout>\n      <RepoColorIcon rootPath={node.repository.dir} />\n      <HighlightedTextValue />\n      <ItemLayout.Hint>{formatFileCount(fileCount)}</ItemLayout.Hint>\n    </ItemLayout>\n  ),\n});\nconst commitParentNodeRenderer = simpleGroupingRenderer(\n  (node: CommitParentChangeTreeNode) =>\n    `Changes to ${shortenOid(path.basename(node.oid))} ${node.subject.slice(\n      0,\n      50\n    )}`\n);\nexport const commitChangesTreeNodeRenderer =\n  createChangesTreeNodeRenderer<CommitChangesTreeNode>(\n    {\n      commitParent: commitParentNodeRenderer,\n    },\n    {\n      repo: repoNodeRenderer,\n    }\n  );\n","import git from \"isomorphic-git\";\nimport path from \"path\";\n\nimport { AnyChange, Change, Revision } from \"../../Changes/Change\";\n\nconst cache = {}; // FIXME: find a better caching strategy. Per project?\nexport async function getCommitChanges({\n  fromRef,\n  toRef,\n  ...params\n}: {\n  dir?: string;\n  gitdir?: string;\n  fromRef: string;\n  toRef: string;\n} & Pick<Parameters<typeof git[\"walk\"]>[0], \"fs\" | \"dir\" | \"gitdir\">): Promise<\n  AnyChange[]\n> {\n  let items: AnyChange[] = await git.walk({\n    ...params,\n    cache,\n    trees: [git.TREE({ ref: fromRef }), git.TREE({ ref: toRef })],\n    map: async function map(\n      filepath,\n      [before, after]\n    ): Promise<null | boolean | AnyChange> {\n      const afterOid = await after?.oid();\n      const beforeOid = await before?.oid();\n      const afterType = await after?.type();\n      const beforeType = await before?.type();\n      if (afterOid === beforeOid) {\n        return null;\n      }\n      const afterRevision: Revision | null = afterOid\n        ? {\n            hash: afterOid,\n            path: path.join(params.dir || \"\", filepath),\n            isDir: afterType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await after?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const beforeRevision: Revision | null = beforeOid\n        ? {\n            hash: beforeOid,\n            path: path.join(params.dir || \"\" || \"\", filepath),\n            isDir: beforeType === \"tree\",\n            content: async () =>\n              new TextDecoder().decode(\n                (await before?.content()) ?? new Uint8Array()\n              ),\n          }\n        : null;\n      const change: AnyChange | null =\n        afterRevision || beforeRevision\n          ? // @ts-expect-error ts can't tell that the signature matches\n            Change(beforeRevision, afterRevision)\n          : null;\n      return change && !Change.revision(change).isDir\n        ? change\n        : // returning null will cause the git.walk not to continue traversing the tree\n          false;\n    },\n  });\n\n  return (items || []).filter((item: boolean | AnyChange) => item);\n}\n","import { diffLines } from \"diff\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { AdditionChange, AnyChange, Change, DeletionChange } from \"./Change\";\n\n// Read more: https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage\nconst DEFAULT_SIMILARITY_INDEX = 50;\n\n/**\n * Given a list of changes, detects renames based on the change in the content of changes where only `before` or\n * `after` is present, and consolidates them into one change, making it count as a rename.\n * @param changes\n */\nexport async function detectRenames(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  return detectRenamesBasedOnContent(detectRenamesBasedOnHash(changes));\n}\n\nfunction detectRenamesBasedOnHash(\n  changes: ReadonlyArray<AnyChange>\n): AnyChange[] {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  return mergeRenames(\n    new Map<DeletionChange, { to: AdditionChange }>(\n      deletions\n        .map((deletion) => {\n          const match = additions.find(\n            ({ after: { hash } }) => hash === deletion.before.hash\n          );\n          if (match) {\n            return [deletion, { to: match }] as const;\n          }\n          return null;\n        })\n        .filter(notNull)\n    ),\n    changes\n  );\n}\n\nasync function detectRenamesBasedOnContent(\n  changes: ReadonlyArray<AnyChange>\n): Promise<AnyChange[]> {\n  const deletions = changes.filter(Change.isDeletion);\n  const additions = changes.filter(Change.isAddition);\n\n  const contents = new Map<AnyChange, string>();\n  const getContent = async (change: AnyChange): Promise<string> => {\n    if (!contents.get(change)) {\n      contents.set(change, await Change.content(change));\n    }\n    return contents.get(change) ?? \"\";\n  };\n  const renameMapping = new Map<\n    DeletionChange,\n    { similarity: number; to: AdditionChange }\n  >();\n  await Promise.all(\n    deletions.map(async (deletion) => {\n      return Promise.all(\n        additions.map(async (addition) => {\n          const similarity = await computeSimilarity(\n            await getContent(deletion),\n            await getContent(addition)\n          );\n          const currentCandidate = renameMapping.get(deletion);\n          if (\n            similarity >= DEFAULT_SIMILARITY_INDEX &&\n            (!currentCandidate || similarity > currentCandidate.similarity)\n          ) {\n            renameMapping.set(deletion, { similarity, to: addition });\n          }\n        })\n      );\n    })\n  );\n  return mergeRenames(renameMapping, changes);\n}\n\nfunction mergeRenames(\n  renameMapping: Map<DeletionChange, { to: AdditionChange }>,\n  changes: ReadonlyArray<AnyChange>\n) {\n  const renamedChanges: AnyChange[] = [...renameMapping.values()].map(\n    (rename) => rename.to\n  );\n  return changes\n    .map((change) => {\n      if (Change.isDeletion(change)) {\n        const candidate = renameMapping.get(change);\n        if (candidate) {\n          return Change(change.before, candidate?.to.after);\n        }\n      }\n      return change;\n    })\n    .filter((change) => !renamedChanges.includes(change));\n}\n\n/**\n * Computes similarity to two strings (typically file contents), and returns a similarity score,\n * similar to [git's similarity index](https://www.git-scm.com/docs/git-diff/2.6.7#:~:text=The-,similarity%20index,-is%20the%20percentage)\n * based on diff computed on a line basis.\n *\n * Note on performance:\n * diff computation can be quite heavy, so it's at least made async not to block the main thread. Further improvement\n * could be moving it to a worker thread.\n * Several alternatives are tested with no luck:\n * - fast-diff: It turned out to be much slower than diff\n * - fast-myers-diff: doesn't seem to support line diffing, or maybe it does but it wasn't straightforward, so skipped it.\n * - detect-rename: too slow!\n */\nasync function computeSimilarity(file1Content: string, file2Content: string) {\n  return new Promise<number>((resolve, reject) => {\n    diffLines(file1Content, file2Content, (err, value = []) => {\n      if (err) {\n        return reject(err);\n      }\n      const { unchanged, total } = value.reduce(\n        ({ total, unchanged }, change) => {\n          const count = change.count ?? 0;\n\n          return {\n            total: total + count,\n            unchanged:\n              unchanged + (!change.added && !change.removed ? count : 0),\n          };\n        },\n        { total: 0, unchanged: 0 }\n      );\n      resolve(100 * (unchanged / total));\n    });\n  });\n}\n","import React, { Key, RefObject } from \"react\";\nimport {\n  atom,\n  atomFamily,\n  GetRecoilValue,\n  selector,\n  selectorFamily,\n} from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { TreeRefValue } from \"@intellij-platform/core\";\nimport { sortTreeNodesInPlace } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { fs } from \"../../../fs/fs\";\nimport {\n  defaultChangeGroupings,\n  directoryGrouping,\n  getChangesGroupFn,\n} from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changeNode,\n  ChangesTreeGroupNode,\n  changesTreeNodeKey,\n  ExtendedChangesTreeNode,\n} from \"../../Changes/ChangesTree/ChangeTreeNode\";\nimport { changesTreeNodesResult } from \"../../Changes/ChangesTree/changesTreeNodesResult\";\nimport { ChangeListObj } from \"../../Changes/change-lists.state\";\nimport {\n  commitsTableRowsState,\n  selectedCommitsState,\n} from \"../CommitsView/CommitsTable.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\nimport { getCommitChanges } from \"./getCommitChanges\";\nimport { detectRenames } from \"../../Changes/detectRenames\";\n\nexport const changesGroupingActiveState = atomFamily<boolean, string>({\n  key: \"vcs/log/commits/changes/isGroupingActive\",\n  default: (id) => id === directoryGrouping.id,\n});\n\nexport const commitChangesTreeRefState = atom<RefObject<TreeRefValue>>({\n  key: \"vcs/log/commits/changes/treeRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const expandedKeysState = atom<Set<Key>>({\n  key: \"vcs/log/commits/changes/expandedKeys\",\n  default: new Set(),\n});\n\nexport const selectionState = atom<Selection>({\n  key: \"vcs/log/commits/changes/selectedKeys\",\n  default: new Set(),\n});\n\nconst COMMIT_PARENT_ID = \"commitParent\";\n\nexport type CommitChangesTreeNode =\n  ExtendedChangesTreeNode<CommitParentChangeTreeNode>;\nexport interface CommitParentChangeTreeNode\n  extends ChangesTreeGroupNode<typeof COMMIT_PARENT_ID, CommitChangesTreeNode> {\n  changeList: ChangeListObj;\n  oid: string;\n  subject: string;\n}\n\ntype CommitDiffParams = Pick<\n  Parameters<typeof getCommitChanges>[0],\n  \"fromRef\" | \"toRef\" | \"dir\"\n>;\nconst commitsDiffWithoutRenamesState = selectorFamily({\n  key: \"vcs/log/commits/diffWithoutRenamesState\",\n  get: (params: CommitDiffParams) => () =>\n    getCommitChanges({\n      fs,\n      ...params,\n    }),\n});\n\nconst commitsDiffState = selectorFamily({\n  key: \"vcs/log/commits/diffState\",\n  get:\n    (params: CommitDiffParams) =>\n    ({ get }) =>\n      detectRenames(get(commitsDiffWithoutRenamesState(params))),\n});\n\nconst getChangedFilesState =\n  (state: typeof commitsDiffState) =>\n  async ({ get }: { get: GetRecoilValue }) => {\n    const selectedCommits = get(selectedCommitsState);\n    const commitLogItem = selectedCommits[0]; // FIXME: take all selected commits into account\n    const { byOid } = get(commitsTableRowsState);\n    const toRef = commitLogItem?.readCommitResult?.oid;\n    const parents = commitLogItem?.readCommitResult.commit.parent;\n    if (toRef && parents) {\n      const groupFn = getChangesGroupFn({\n        get,\n        groupings: defaultChangeGroupings,\n        isActive: changesGroupingActiveState,\n      });\n      const rootNodes = parents?.map(\n        (parent) =>\n          ({\n            type: COMMIT_PARENT_ID,\n            key: changesTreeNodeKey(COMMIT_PARENT_ID, parent),\n            oid: parent,\n            subject: byOid[parent]?.readCommitResult.commit.message || \"\",\n            children: groupFn(\n              [\n                ...get(\n                  state({\n                    toRef,\n                    fromRef: parent,\n                    dir: commitLogItem.repoPath,\n                  })\n                ),\n              ].map((node) => changeNode(node))\n            ),\n          } as CommitParentChangeTreeNode)\n      );\n\n      const { expandAllKeys, fileCountsMap, ...result } =\n        changesTreeNodesResult(\n          rootNodes.length === 1\n            ? rootNodes[0].children\n            : rootNodes.filter(({ children }) => children.length > 0)\n        );\n\n      type Writeable<T> = { -readonly [P in keyof T]: T[P] };\n      sortTreeNodesInPlace(\n        (node) =>\n          (node.type === \"directory\" ? \"a_\" : \"b_\") +\n          commitChangesTreeNodeRenderer\n            .getTextValue(node, { fileCountsMap })\n            .toLowerCase(),\n        {\n          // cheating with the types by removing readonly constraints to use the inplace sort tree util.\n          // it should be ok, since the ReadonlyArray is only a compile-time thing.\n          roots: result.rootNodes as Writeable<typeof result.rootNodes>,\n          getChildren: (node) =>\n            \"children\" in node\n              ? (node.children as Writeable<typeof node.children>)\n              : null,\n        }\n      );\n\n      return {\n        ...result,\n        fileCountsMap,\n        expandAllKeys: new Set(\n          [...expandAllKeys].filter(\n            (key) => !`${key}`.startsWith(COMMIT_PARENT_ID)\n          )\n        ),\n      };\n    }\n    return null;\n  };\n\n/**\n * Changes corresponding to the currently selected commits, before rename detection, which can be slow.\n */\nexport const changedFilesWithoutRenamesState = selector({\n  key: \"vcs/log/commits/selection/changesWithoutRename\",\n  get: getChangedFilesState(commitsDiffWithoutRenamesState),\n});\n\n/**\n * Changes corresponding to the currently selected commits.\n */\nexport const changedFilesState = selector({\n  key: \"vcs/log/commits/selection/changes\",\n  get: getChangedFilesState(commitsDiffState),\n});\n","import React, { HTMLAttributes, useEffect } from \"react\";\nimport {\n  RecoilValue,\n  useRecoilState,\n  useRecoilValue,\n  useRecoilValueLoadable,\n} from \"recoil\";\n\nimport {\n  HelpTooltip,\n  PlatformIcon,\n  PositionedTooltipTrigger,\n  SpeedSearchTree,\n  styled,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport { LoadingGif } from \"../../../LoadingGif\";\nimport { Delayed } from \"../../../Delayed\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { selectedCommitsState } from \"../CommitsView/CommitsTable.state\";\nimport {\n  changedFilesState,\n  changedFilesWithoutRenamesState,\n  commitChangesTreeRefState,\n  expandedKeysState,\n  selectionState,\n} from \"./CommitsChangedFiles.state\";\nimport { commitChangesTreeNodeRenderer } from \"./commitChangesTreeNodeRenderer\";\n\nconst StyledLoadingWrapper = styled.div`\n  position: absolute;\n  inset: 0;\n  gap: 0.5rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nfunction useFastestValueLoadable<T>(states: RecoilValue<T>[]) {\n  const loadables = states.map((state) => useRecoilValueLoadable(state));\n  return (\n    loadables.find(({ state }) => state === \"hasValue\") ||\n    loadables.slice(-1)[0]\n  );\n}\n/**\n * TODO: handle multiple selected commits (check Changes.ShowChangesFromParents https://github.com/JetBrains/intellij-community/blob/ac57611a0612bd65ba2a19c841a4f95b40591134/platform/vcs-log/impl/src/com/intellij/vcs/log/ui/frame/VcsLogChangesBrowser.java#L255-L254)\n */\nexport function CommitChangedFiles({\n  treeShortcutHandlerProps,\n}: {\n  treeShortcutHandlerProps: HTMLAttributes<HTMLElement>;\n}) {\n  const [selectedCommits] = useLatestRecoilValue(selectedCommitsState);\n  const treeRef = useRecoilValue(commitChangesTreeRefState);\n  const nothingSelected = !selectedCommits?.length;\n\n  const stateLoadable = useFastestValueLoadable([\n    changedFilesState,\n    changedFilesWithoutRenamesState,\n  ]);\n  const state = stateLoadable.valueMaybe();\n  const [expandedKeys, setExpandedKeys] = useRecoilState(expandedKeysState);\n  const [selection, setSelection] = useRecoilState(selectionState);\n\n  useEffect(() => {\n    // TODO: expanded keys are supposed to be set based on selected keys\n    setExpandedKeys(state?.expandAllKeys ?? new Set());\n    setSelection(new Set());\n    // FIXME: with this being in an effect here, closing and reopening the toolwindow will\n    //  reset the selection, making selection state be effectively like a local state.\n  }, [stateLoadable.state]);\n\n  if (nothingSelected) {\n    return (\n      <StyledPlaceholderContainer>\n        Select commits to to view changes\n      </StyledPlaceholderContainer>\n    );\n  }\n  return (\n    <div\n      {...treeShortcutHandlerProps}\n      style={{\n        height: \"-webkit-fill-available\",\n        position: \"relative\",\n      }}\n    >\n      {stateLoadable.state === \"loading\" && (\n        <Delayed>\n          <StyledLoadingWrapper>\n            <LoadingGif style={{ width: \"1.5rem\" }} />\n            Loading...\n          </StyledLoadingWrapper>\n        </Delayed>\n      )}\n      {state && (\n        <SpeedSearchTree\n          aria-label=\"Commit changes\"\n          treeRef={treeRef}\n          items={state.rootNodes}\n          selectionMode=\"multiple\"\n          expandedKeys={expandedKeys}\n          onExpandedChange={setExpandedKeys}\n          selectedKeys={selection}\n          onSelectionChange={setSelection}\n          style={{ paddingBottom: \"1rem\" }}\n          fillAvailableSpace\n        >\n          {commitChangesTreeNodeRenderer.itemRenderer({\n            fileCountsMap: state.fileCountsMap,\n          })}\n        </SpeedSearchTree>\n      )}\n      {selectedCommits.length > 1 && (\n        <PositionedTooltipTrigger\n          placement=\"top\"\n          tooltip={\n            <HelpTooltip\n              helpText={\n                <>\n                  Showing diff for more than one commit is not currently\n                  supported. Only the first selected commit is taken into\n                  account.\n                </>\n              }\n            ></HelpTooltip>\n          }\n        >\n          {(props) => (\n            <span\n              {...props}\n              style={{\n                position: \"absolute\",\n                right: \"0.5rem\",\n                bottom: \"0.5rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/warning\" />\n            </span>\n          )}\n        </PositionedTooltipTrigger>\n      )}\n    </div>\n  );\n}\n","import { styled, Theme } from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { StyledCurrentBranchTag } from \"../Changes/StyledCurrentBranchTag\";\nimport { GitRef } from \"./GitRef\";\n\nconst labelIcon = (\n  <path\n    fill=\"currentColor\"\n    d=\"M4.2 4.8 C4.8627 4.8 5.4 5.3373 5.4 6 C5.4 6.6627 4.8627 7.2 4.2 7.2 C3.5373 7.2 3 6.6627 3 6 C3 5.3373 3.5373 4.8 4.2 4.8 ZM0.6 2.4 L0.6 7.2 L7.8 14.4 L12.6 9.6 L5.4 2.4 Z\"\n  />\n);\nconst vcsLogStandardColors = {\n  TIP: { light: \"#ffd100\", dark: \"#e1c731\" },\n  LEAF: { light: \"#8a2d6b\", dark: \"#c31e8c\" },\n  BRANCH: { light: \"#3cb45c\", dark: \"#3cb45c\" },\n  BRANCH_REF: { light: \"#9f79b5\", dark: \"#9f79b5\" },\n  TAG: { light: \"#7a7a7a\", dark: \"#999999\" },\n};\nconst gitLogColors: Record<GitRef[\"type\"], (args: { theme: Theme }) => string> =\n  {\n    head: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.headIconColor\",\n        vcsLogStandardColors.TIP\n      ),\n    localBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.localBranchIconColor\",\n        vcsLogStandardColors.BRANCH\n      ),\n    remoteBranch: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.remoteBranchIconColor\",\n        vcsLogStandardColors.BRANCH_REF\n      ),\n    tag: ({ theme }: { theme: Theme }) =>\n      theme.color(\n        \"VersionControl.GitLog.tagIconColor\",\n        vcsLogStandardColors.TAG\n      ),\n  };\n\nconst StyledRef = styled(StyledCurrentBranchTag)`\n  border-radius: 3px;\n  align-items: stretch;\n  font-size: 0.75rem;\n`;\n\nconst StyledLabelSvg = styled.svg.attrs({ viewBox: \"0 0 14.5 14.5\" })<{\n  type: GitRef[\"type\"];\n}>`\n  width: 1rem;\n  height: 1rem;\n  stroke: rgba(0, 0, 0, 0.25);\n  stroke-width: 0.5px;\n  color: ${({ type, theme }) => gitLogColors[type]({ theme })};\n  z-index: 1; // for the right vertical order of grouped labels\n  &:not(:first-child) {\n    margin-right: -11px;\n  }\n`;\n\nconst StyledRefIconGroup = styled.span`\n  display: inline-flex;\n  flex-direction: row-reverse;\n`;\n\nconst StyledLabelText = styled.span`\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\n\nexport function RefIcon({ type }: { type: GitRef[\"type\"] }) {\n  return <StyledLabelSvg type={type}>{labelIcon}</StyledLabelSvg>;\n}\n\nexport function RefIconGroup({ types }: { types: Array<GitRef[\"type\"]> }) {\n  return (\n    <StyledRefIconGroup>\n      {types.map((type, index) => (\n        <StyledLabelSvg key={index} type={type}>\n          {labelIcon}\n        </StyledLabelSvg>\n      ))}\n    </StyledRefIconGroup>\n  );\n}\nexport function RefLabel({\n  types,\n  children,\n}: {\n  types: Array<GitRef[\"type\"]>;\n  children: React.ReactNode;\n}) {\n  return (\n    <StyledRef>\n      <RefIconGroup types={types} />\n      <StyledLabelText>{children}</StyledLabelText>\n    </StyledRef>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport { useRecoilValue } from \"recoil\";\nimport React, { ReactNode } from \"react\";\n\nimport { Link, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport {\n  formatCommitDate,\n  formatCommitTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\nimport {\n  allResolvedRefsState,\n  selectedCommitState,\n} from \"../CommitsView/CommitsTable.state\";\nimport { RefIconGroup } from \"../RefLabel\";\nimport { GitRef } from \"../GitRef\";\n\nconst StyledContainer = styled.div`\n  padding: 0.875rem;\n  cursor: default;\n`;\nconst StyledCommitMessage = styled.div`\n  font-family: \"JetBrains Mono\", monospace;\n  line-height: 1.125rem;\n  margin-bottom: 1.25rem;\n  margin-right: 1.1875rem;\n`;\n\nconst StyledCommitMessageHeader = styled.div`\n  font-weight: bold;\n`;\nconst StyledCommitterInfo = styled.div`\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n`;\n\nconst StyledCommitInfoRow = styled.div`\n  line-height: 1.2;\n  display: flex;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\nconst StyledRepoColorIcon = styled(RepoColorIcon)`\n  align-self: start;\n`;\n\nconst StyledRefsContainer = styled.span`\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.25rem;\n  margin-bottom: 0.75rem;\n`;\n\nexport function CommitDetails() {\n  const [firstSelectedCommit] = useLatestRecoilValue(selectedCommitState);\n  const [allResolvedRefs] = useLatestRecoilValue(allResolvedRefsState);\n  const isMultiRepo = useRecoilValue(vcsRootsState).length > 0;\n  if (!firstSelectedCommit) {\n    return (\n      <StyledPlaceholderContainer>\n        No commits selected\n      </StyledPlaceholderContainer>\n    );\n  }\n\n  const {\n    readCommitResult: { commit, oid },\n    containingRefs,\n    repoPath,\n  } = firstSelectedCommit;\n  const { subject, body } = parseCommitMessage(commit.message);\n  const committerInfo: ReactNode[] = [];\n  if (commit.committer.name !== commit.author.name) {\n    committerInfo.push(\n      <React.Fragment key={commit.committer.email}>\n        by {commit.committer.name} <EmailLink email={commit.committer.email} />\n      </React.Fragment>\n    );\n  }\n  if (commit.committer.timestamp !== commit.author.timestamp) {\n    committerInfo.push(formatDateAndTime(commit.committer.timestamp * 1000));\n  }\n  const refs = allResolvedRefs?.[oid] || [];\n  const refsByType = groupBy((ref) => ref.type, refs);\n  return (\n    <StyledContainer>\n      <StyledCommitMessage>\n        <StyledCommitMessageHeader>{subject}</StyledCommitMessageHeader>\n        {body}\n      </StyledCommitMessage>\n      <StyledCommitInfoRow>\n        {isMultiRepo && (\n          <TooltipTrigger tooltip={<Tooltip>{repoPath}</Tooltip>}>\n            {(props) => <StyledRepoColorIcon {...props} rootPath={repoPath} />}\n          </TooltipTrigger>\n        )}\n        <div>\n          {`${shortenOid(oid)} ${commit.author.name} `}\n          <EmailLink email={commit.author.email} />{\" \"}\n          {`${formatDateAndTime(new Date(commit.author.timestamp * 1000))}`}\n          {committerInfo.length > 0 && (\n            <StyledCommitterInfo>committed {committerInfo}</StyledCommitterInfo>\n          )}\n        </div>\n      </StyledCommitInfoRow>\n      {refs.length > 0 && (\n        <StyledRefsContainer>\n          <RefGroup refs={refsByType.head} />\n          <RefGroup refs={refsByType.localBranch} />\n          <RefGroup refs={refsByType.remoteBranch} />\n          <RefGroup refs={refsByType.tag} />\n        </StyledRefsContainer>\n      )}\n      <div>\n        {/*TODO: collapsing and \"Show more\"*/}\n        In {containingRefs.size} branches: {[...containingRefs].join(\", \")}\n      </div>\n    </StyledContainer>\n  );\n}\n\nconst StyledRefWithIcon = styled.span`\n  display: inline-flex;\n  align-items: center;\n`;\nfunction RefGroup({ refs }: { refs: undefined | GitRef[] }) {\n  return refs?.length ? (\n    <>\n      {refs.map((ref, index) => {\n        const name = `${ref.name}${index === refs.length - 1 ? \"\" : \",\"}`;\n        return index === 0 ? (\n          <StyledRefWithIcon>\n            <RefIconGroup types={refs.map(({ type }) => type).slice(0, 2)} />\n            {name}\n          </StyledRefWithIcon>\n        ) : (\n          // span is needed for the right flex-wrap behavior\n          <span>{name}</span>\n        );\n      })}\n    </>\n  ) : null;\n}\n\nfunction EmailLink({ email }: { email: string }) {\n  return (\n    <a href={`mailto:${email}`} style={{ all: \"unset\" }}>\n      <Link>{`<${email}>`}</Link>\n    </a>\n  );\n}\n\nfunction formatDateAndTime(date: Date | number) {\n  return `on ${formatCommitDate(date)} at ${formatCommitTime(date)}`;\n}\n","import { useMemo } from \"react\";\nimport { ActionDefinition, useActions } from \"@intellij-platform/core\";\n\n/**\n * Currently, action groups are expected to **define** the child actions, instead of just referencing already defined\n * actions. In such model, where groups are not just a grouping of existing actions, this hook allows for redefining\n * existing actions to be used within a group. Kind of a temporary solution while action system evolves.\n */\nexport function useRedefineAction(\n  actionId: string,\n  newId: string\n): ActionDefinition | null {\n  const actions = useActions();\n  const action = actions.find(({ id }) => id === actionId);\n\n  return useMemo(() => {\n    if (!action) {\n      return null;\n    }\n    const { perform, id, ...commonProperties } = action;\n    return {\n      ...commonProperties,\n      id: newId,\n      useShortcutsOf: id,\n      isSearchable: false,\n      actionPerformed: (context) => {\n        perform(context);\n      },\n    };\n  }, [action]);\n}\n","import React, { HTMLAttributes } from \"react\";\nimport {\n  atom,\n  isRecoilValue,\n  RecoilValue,\n  selector,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionButton,\n  ActionGroupMenu,\n  ActionsProvider,\n  ActionTooltip,\n  CommonActionId,\n  IconButton,\n  IconButtonWithMenu,\n  PlatformIcon,\n  SpeedSearchMenu,\n  styled,\n  ThreeViewSplitter,\n  Toolbar,\n  TooltipTrigger,\n  useActionGroup,\n  useCreateDefaultActionGroup,\n  useTreeActions,\n} from \"@intellij-platform/core\";\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { CommitChangedFiles } from \"../CommitChanges/CommitsChangedFiles\";\nimport { CommitDetails } from \"./CommitDetails\";\nimport { defaultChangeGroupings } from \"../../Changes/ChangesTree/changesGroupings\";\nimport {\n  changesGroupingActiveState,\n  commitChangesTreeRefState,\n} from \"../CommitChanges/CommitsChangedFiles.state\";\nimport {\n  vcsLogTabShowCommitDetailsInCurrentTabState,\n  vcsLogTabShowCommitDetailsState,\n} from \"../vcs-logs.state\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { useRedefineAction } from \"../../../useRedefineAction\";\n\nconst splitViewSizeState = atom({\n  key: \"vcs/toolwindow/splitViewSize\",\n  default: 0.5,\n});\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nconst groupingState = selector({\n  key: \"vcs/log/commits/changes/groupingState\",\n  get: ({ get }) => {\n    const groupings = defaultChangeGroupings.filter((grouping) =>\n      isRecoilValue(grouping.isAvailable)\n        ? get(grouping.isAvailable)\n        : grouping.isAvailable\n    );\n    return groupings.map((grouping) => ({\n      ...grouping,\n      key: `groupBy:${grouping.id}`,\n      isActive: get(changesGroupingActiveState(grouping.id)),\n    }));\n  },\n});\n\nconst GROUP_BY_ACTION_GROUP_ID = \"Vcs.log.detailsView.groupBy\";\nconst LAYOUT_ACTION_GROUP_ID = \"Vcs.log.detailsView.layout\";\nconst VIEW_OPTIONS_ACTION_GROUP_ID = \"Vcs.log.detailsView.viewOptions\";\nconst SHOW_DETAILS_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DETAILS}`;\nconst SHOW_DIFF_PREVIEW_ACTION_ID = `${LAYOUT_ACTION_GROUP_ID}.${VcsActionIds.SHOW_DIFF_PREVIEW}`;\n\nconst groupingActionId = (grouping: { id: string }) => {\n  return `Vcs.log.detailsView.groupBy.${grouping.id}`;\n};\n\nexport function VcsLogDetailsView({ tabKey }: { tabKey: string }) {\n  const [splitViewSize, setSplitViewSize] = useRecoilState(splitViewSizeState);\n  const isDetailsVisible = useRecoilValue(\n    vcsLogTabShowCommitDetailsState(tabKey)\n  );\n  const toggleGroupBy = useRecoilCallback(({ set }) => (id: string) => {\n    set(changesGroupingActiveState(id), (currentValue) => !currentValue);\n  });\n  const createActionGroup = useCreateDefaultActionGroup();\n  const availableGroupings = useRecoilValue(groupingState);\n\n  const treeRef = useRecoilValue(commitChangesTreeRefState);\n  const actions = [\n    createActionGroup({\n      id: VIEW_OPTIONS_ACTION_GROUP_ID,\n      title: \"View Options\",\n      icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n      children: [\n        createActionGroup({\n          id: GROUP_BY_ACTION_GROUP_ID,\n          title: \"Group By\",\n          menuPresentation: \"titledSection\",\n          icon: <PlatformIcon icon=\"actions/groupBy.svg\" />,\n          children: availableGroupings.map((grouping) => ({\n            id: groupingActionId(grouping),\n            useShortcutsOf: grouping.useShortcutOf,\n            title: grouping.title,\n            actionPerformed: () => {\n              toggleGroupBy(grouping.id);\n            },\n          })),\n        }),\n        createActionGroup({\n          id: LAYOUT_ACTION_GROUP_ID,\n          menuPresentation: \"titledSection\",\n          title: \"Layout\",\n          children: [\n            useRedefineAction(\n              VcsActionIds.SHOW_DETAILS,\n              SHOW_DETAILS_ACTION_ID\n            ),\n            useRedefineAction(\n              VcsActionIds.SHOW_DIFF_PREVIEW,\n              SHOW_DIFF_PREVIEW_ACTION_ID\n            ),\n          ].filter(notNull),\n        }),\n      ],\n    }),\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer>\n          <StyledHeader>\n            <Toolbar>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Show Diff\" shortcut=\"D\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon={\"actions/diff.svg\"} />\n                </IconButton>\n              </TooltipTrigger>\n              <TooltipTrigger\n                tooltip={<ActionTooltip actionName=\"Revert Selected Changes\" />}\n              >\n                <IconButton isDisabled>\n                  <PlatformIcon icon=\"actions/rollback.svg\" />\n                </IconButton>\n              </TooltipTrigger>\n              <IconButtonWithMenu\n                renderMenu={({ menuProps }) => {\n                  return (\n                    <VcsLogsDetailsViewOptionsMenu menuProps={menuProps} />\n                  );\n                }}\n              >\n                <PlatformIcon icon=\"actions/groupBy.svg\" />\n              </IconButtonWithMenu>\n            </Toolbar>\n            <StyledSpacer />\n            <Toolbar style={{ flexShrink: 0 }}>\n              <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n              <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n            </Toolbar>\n          </StyledHeader>\n          <div style={{ flex: 1, minHeight: 0 }}>\n            {isDetailsVisible ? (\n              <ThreeViewSplitter\n                orientation=\"vertical\"\n                firstSize={splitViewSize}\n                onFirstResize={setSplitViewSize}\n                firstViewMinSize={10}\n                firstView={\n                  <CommitChangedFiles\n                    treeShortcutHandlerProps={shortcutHandlerProps}\n                  />\n                }\n                innerView={<CommitDetails />}\n              />\n            ) : (\n              <CommitChangedFiles\n                treeShortcutHandlerProps={shortcutHandlerProps}\n              />\n            )}\n          </div>\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst toggleActionsState: { [actionId: string]: RecoilValue<boolean> } = {\n  [SHOW_DETAILS_ACTION_ID]: vcsLogTabShowCommitDetailsInCurrentTabState,\n  ...Object.fromEntries(\n    defaultChangeGroupings.map((grouping) => [\n      groupingActionId(grouping),\n      changesGroupingActiveState(grouping.id),\n    ])\n  ),\n};\nconst selectedKeysState = selector({\n  key: \"vcs/log/commits/detailsView/viewOptionsSelectedKeys\",\n  get: ({ get }) =>\n    Object.entries(toggleActionsState)\n      .filter(([, state]) => get(state))\n      .map(([actionId]) => actionId),\n});\n\nfunction VcsLogsDetailsViewOptionsMenu({\n  menuProps,\n}: {\n  menuProps: Omit<HTMLAttributes<HTMLDivElement>, \"autoFocus\">;\n}) {\n  const group = useActionGroup(VIEW_OPTIONS_ACTION_GROUP_ID);\n  const selectedKeys = useRecoilValue(selectedKeysState);\n  return (\n    group && (\n      <ActionGroupMenu actionGroup={group}>\n        {(actionMenuProps) => (\n          <SpeedSearchMenu\n            {...menuProps}\n            {...actionMenuProps}\n            selectedKeys={selectedKeys}\n          />\n        )}\n      </ActionGroupMenu>\n    )\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  BareButton,\n  MenuTrigger,\n  MenuTriggerProps,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledDropdownButton = styled.button`\n  all: unset;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem;\n  padding-left: 0.25rem;\n  cursor: pointer;\n  background: transparent;\n  color: ${({ theme }) => theme.commonColors.label({ disabled: true })};\n\n  line-height: 1.5;\n  border-radius: 0.25rem;\n  white-space: nowrap;\n  border: 2px solid transparent;\n  &:hover {\n    color: ${({ theme }) => theme.color(\"*.foreground\")};\n  }\n  &:focus-visible {\n    border-color: ${({ theme }) =>\n      theme.commonColors.focusRing({ focused: true })};\n  }\n`;\n\nconst StyledDropdownIcon = styled.span`\n  margin-left: -1px;\n  line-height: 1.2;\n`;\n\nconst StyledValue = styled.span`\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  max-width: 8.25rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst FocusableAutoHoverPlatformIcon = styled(AutoHoverPlatformIcon)`\n  &:focus-visible {\n    outline: 2px solid\n      ${({ theme }) => theme.commonColors.focusRing({ focused: true })};\n    outline-offset: -2px;\n  }\n`;\nexport function VcsFilterDropdown({\n  label,\n  value,\n  onClear,\n  ...menuTriggerProps\n}: Omit<MenuTriggerProps, \"children\"> & {\n  label: React.ReactNode;\n  value?: React.ReactNode;\n  onClear?: () => void;\n}) {\n  return (\n    <MenuTrigger {...menuTriggerProps}>\n      {(props, ref) => (\n        <StyledDropdownButton {...props} ref={ref}>\n          {label}\n          {value ? (\n            <>\n              : <StyledValue>{value}</StyledValue>\n              <BareButton onPress={onClear}>\n                <FocusableAutoHoverPlatformIcon\n                  icon=\"actions/close\"\n                  hoverIcon=\"actions/closeHovered\"\n                />\n              </BareButton>\n            </>\n          ) : (\n            <StyledDropdownIcon>\n              <PlatformIcon icon=\"general/arrowDownSmall.svg\" />\n            </StyledDropdownIcon>\n          )}\n        </StyledDropdownButton>\n      )}\n    </MenuTrigger>\n  );\n}\n","import React from \"react\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n  styled,\n} from \"@intellij-platform/core\";\n\nconst StyledMenuIconButton = styled.span.attrs({ role: \"button\" })`\n  display: inline-flex;\n`;\n\nexport function BranchFavoriteButton({\n  onClick,\n  isFavorite,\n  isCurrent,\n}: {\n  isCurrent?: boolean;\n  isFavorite: boolean;\n  onClick: () => void;\n}) {\n  const getIcon = () => {\n    if (isCurrent) {\n      return (\n        <AutoHoverPlatformIcon\n          icon={\n            isFavorite\n              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n          }\n          hoverIcon={\n            isFavorite ? \"nodes/favorite.svg\" : \"nodes/notFavoriteOnHover.svg\"\n          }\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n    if (isFavorite) {\n      return <PlatformIcon icon=\"nodes/favorite.svg\" />;\n    } else {\n      return (\n        <AutoHoverPlatformIcon\n          icon=\"nodes/emptyNode.svg\"\n          hoverIcon=\"nodes/notFavoriteOnHover.svg\"\n          hoverContainerSelector=\"[role='menuitem']\"\n        />\n      );\n    }\n  };\n  return (\n    <StyledMenuIconButton\n      onPointerUp={(e) => {\n        e.stopPropagation();\n      }}\n      onClick={onClick}\n    >\n      {getIcon()}\n    </StyledMenuIconButton>\n  );\n}\n","import { groupBy } from \"ramda\";\nimport React, { HTMLAttributes, useEffect, useState } from \"react\";\nimport { selector, useRecoilState, useResetRecoilState } from \"recoil\";\nimport {\n  Divider,\n  Item,\n  MenuItemLayout,\n  SpeedSearchMenu,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  allBranchesState,\n  BranchType,\n  useFavoriteBranches,\n} from \"../../Branches/branches.state\";\nimport { BranchFavoriteButton } from \"../../Branches/BranchFavoriteButton\";\nimport { vcsLogFilter } from \"../vcs-logs.state\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\n\nexport function BranchesFilterDropdown({ tabKey }: { tabKey: string }) {\n  const [selectedBranches, setSelectedBranches] = useRecoilState(\n    vcsLogFilter.branch(tabKey)\n  );\n  const resetBranches = useResetRecoilState(vcsLogFilter.branch(tabKey));\n\n  return (\n    <VcsFilterDropdown\n      value={selectedBranches.length > 0 ? selectedBranches.join(\"|\") : null}\n      onClear={resetBranches}\n      renderMenu={({ menuProps }) => (\n        <BranchesFilterMenu\n          menuProps={menuProps}\n          onBranchesSelected={setSelectedBranches}\n        />\n      )}\n      label=\"Branch\"\n    />\n  );\n}\n\nconst groupRepoRoots = (\n  branches: Array<{ branchName: string; repoRoot: string }>\n) =>\n  Object.entries(groupBy(({ branchName }) => branchName, branches)).map(\n    ([branchName, items]) => ({\n      branchName,\n      repoRoots: items.map((item) => item.repoRoot),\n    })\n  );\n/**\n * Unique list of all local and remote branches of all repositories.\n * Each branch has a list of repos which indicates the list of repository roots the branch appears in.\n */\nconst repoGroupedAllBranchesState = selector({\n  key: \"vcs/allBranchesRepoConsolidated\",\n  get: ({ get }) => {\n    const allBranches = get(allBranchesState);\n    const allRemoteBranches = allBranches.flatMap(\n      ({ remoteBranches, repoRoot }) =>\n        remoteBranches.map((branch) => ({\n          repoRoot,\n          branchName: `${branch.remote}/${branch.name}`,\n        }))\n    );\n    const allLocalBranches = allBranches.flatMap(\n      ({ localBranches, repoRoot }) =>\n        localBranches.map((branch) => ({\n          repoRoot,\n          branchName: branch.name,\n        }))\n    );\n    return {\n      localBranches: groupRepoRoots(allLocalBranches),\n      remoteBranches: groupRepoRoots(allRemoteBranches),\n    };\n  },\n});\n\ntype BranchMenuItem = {\n  branchType: BranchType;\n  branchName: string;\n  repoRoots: string[];\n};\n\nfunction BranchesFilterMenu({\n  menuProps,\n  onBranchesSelected,\n}: {\n  onBranchesSelected: (branches: string[]) => void;\n  menuProps: Omit<HTMLAttributes<HTMLElement>, \"autoFocus\">;\n}) {\n  const [favoriteBranches, setFavoriteBranches] = useState<BranchMenuItem[]>(\n    []\n  );\n  const { toggleFavorite, isFavorite } = useFavoriteBranches();\n  const [repoGroupedAllBranches] = useLatestRecoilValue(\n    repoGroupedAllBranchesState\n  );\n  const { localBranches = [], remoteBranches = [] } =\n    repoGroupedAllBranches || {};\n\n  const remoteBranchesByRemote = groupBy(\n    ({ branchName }) => branchName.split(\"/\")[0],\n    remoteBranches\n  );\n\n  // The list of favorite branches is calculated on render, and is intentionally not updated. This behavior is copied\n  // from the reference implementation. Probably in order to not have items jump in and out of the menu, when branches\n  // are marked/unmarked as favorite. One improvement (?) here is that isFavorite state is always correct, as opposed\n  // to the reference implementation where (at least currently) the state of favorite icon is not kept up-to-date.\n  useEffect(() => {\n    const createLocalBranchItems = (\n      branchType: BranchType,\n      branches: Array<{ branchName: string; repoRoots: string[] }>\n    ): BranchMenuItem[] => {\n      return branches\n        .filter(({ branchName, repoRoots }) =>\n          repoRoots.some((repoRoot) =>\n            isFavorite({ branchType, branchName, repoRoot })\n          )\n        )\n        .map(({ branchName, repoRoots }) => ({\n          branchType,\n          branchName,\n          repoRoots,\n        }));\n    };\n\n    setFavoriteBranches(\n      [\n        {\n          branchType: \"LOCAL\",\n          branchName: \"HEAD\",\n          repoRoots: [],\n        } as BranchMenuItem,\n      ]\n        .concat(createLocalBranchItems(\"LOCAL\", localBranches))\n        .concat(createLocalBranchItems(\"REMOTE\", remoteBranches))\n    );\n  }, []);\n\n  const renderBranchItem = ({\n    branchName,\n    branchType,\n    repoRoots,\n  }: BranchMenuItem) => (\n    <Item key={`branch:${branchName}`} textValue={branchName}>\n      <MenuItemLayout\n        content={branchName}\n        icon={\n          <BranchFavoriteButton\n            isFavorite={\n              branchName === \"HEAD\" ||\n              repoRoots.some((repoRoot) =>\n                isFavorite({\n                  branchType,\n                  repoRoot,\n                  branchName,\n                })\n              )\n            }\n            onClick={() => {\n              if (branchName !== \"HEAD\") {\n                repoRoots.forEach((repoRoot) => {\n                  toggleFavorite({\n                    branchType,\n                    repoRoot,\n                    branchName,\n                  });\n                });\n              }\n            }}\n          />\n        }\n      />\n    </Item>\n  );\n  return (\n    <SpeedSearchMenu\n      {...menuProps}\n      submenuBehavior=\"toggleOnPress\"\n      autoFocus=\"first\"\n      minWidth={250}\n      onAction={(key) => {\n        const [type, value] = `${key}`.split(\":\");\n        if (type === \"branch\" && value) {\n          onBranchesSelected([value]);\n        } else if (type === \"favorites\") {\n          onBranchesSelected(\n            favoriteBranches.map(({ branchName }) => branchName)\n            // we could have filtered the ones that are actually favorite at this point, but not doing so to follow\n            // the original implementation, even though it's a little questionable.\n          );\n        } else if (type === \"select\") {\n          notImplemented(); // TODO\n        }\n      }}\n    >\n      {[\n        <Item key=\"select\">Select...</Item>,\n        <Item key=\"favorites\">Favorites</Item>,\n        ...favoriteBranches.map(renderBranchItem),\n        <Divider />,\n        <Item key=\"local\" title=\"Local\">\n          {localBranches.map(({ branchName, repoRoots }) =>\n            renderBranchItem({ branchType: \"LOCAL\", branchName, repoRoots })\n          )}\n        </Item>,\n        ...Object.entries(remoteBranchesByRemote).map(([origin, branches]) => (\n          <Item key={`remote:${origin}`} title={`${origin}/...`}>\n            {branches.map(({ branchName, repoRoots }) =>\n              renderBranchItem({ branchType: \"REMOTE\", branchName, repoRoots })\n            )}\n          </Item>\n        )),\n      ]}\n    </SpeedSearchMenu>\n  );\n}\n","import { selectorFamily } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\n\nexport type GitUser = { name: string; email: string };\n\nexport function areUsersEqual(\n  user1: GitUser | null | undefined,\n  user2: GitUser | null | undefined\n): boolean {\n  return (\n    Boolean(user1) &&\n    user1?.email === user2?.email &&\n    user1?.name === user2?.name\n  );\n}\nexport function areSamePerson(user1: GitUser, user2: GitUser): boolean {\n  return (\n    getNameInStandardForm(user1.name) === getNameInStandardForm(user2.name)\n  );\n}\nconst NAME_PATTERN = \"(\\\\w+)[\\\\p{Punct}\\\\s](\\\\w+)\";\n\nfunction getNameInStandardForm(name: string) {\n  const firstAndLastName = getFirstAndLastName(name);\n  if (firstAndLastName != null) {\n    const [firstName, lastName] = firstAndLastName;\n    return firstName.toLowerCase() + \" \" + lastName.toLowerCase(); // synonyms detection is currently english-only\n  }\n  return nameToLowerCase(name);\n}\n\nconst PRINTABLE_ASCII_PATTERN = \"[ -~]*\";\nfunction nameToLowerCase(name: string) {\n  if (!name.match(PRINTABLE_ASCII_PATTERN)) return name;\n  return name.toLowerCase();\n}\nfunction getFirstAndLastName(name: string) {\n  const matches = name.match(NAME_PATTERN);\n  if (matches) {\n    return [matches[1], matches[2]];\n  }\n  return null;\n}\nexport const gitRepoUserState = selectorFamily<GitUser, string>({\n  key: \"vcs/repo-user\",\n  get: (repoRoot: string) => async () => {\n    const name = await git.getConfig({ fs, dir: repoRoot, path: \"user.name\" });\n    const email = await git.getConfig({\n      fs,\n      dir: repoRoot,\n      path: \"user.email\",\n    });\n    return {\n      name: name ?? \"\",\n      email: email ?? \"\",\n    };\n  },\n});\n","import React, { CSSProperties, RefObject, useMemo } from \"react\";\nimport { css, styled, Tooltip, TooltipTrigger } from \"@intellij-platform/core\";\nimport { ReadCommitResult } from \"isomorphic-git\";\n\nimport { GitRef } from \"../GitRef\";\nimport { RefLabel, RefIcon } from \"../RefLabel\";\nimport { useRecoilValue } from \"recoil\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityState,\n  vcsTableHighlightMyCommitsState,\n  vcsTableReferencesOnTheLeftState,\n  vcsTableShowCommitTimestampState,\n} from \"./CommitsTable.state\";\nimport {\n  areSamePerson,\n  gitRepoUserState,\n  GitUser,\n} from \"../../git-users.state\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsLogFilterCurrentTab,\n} from \"../vcs-logs.state\";\nimport {\n  formatCommitDateTime,\n  parseCommitMessage,\n  shortenOid,\n} from \"../commit-utils\";\n\nconst StyledCommitRow = styled.div`\n  display: flex;\n  height: 1.5rem;\n  align-items: center;\n  width: 100%;\n  --column-width-1: 130px;\n  --column-width-2: 130px;\n  --column-width-3: 70px;\n`;\nconst StyledCommitCell = styled.div`\n  overflow: hidden;\n  padding-left: 0.25rem;\n`;\n\nconst StyledRefsContainer = styled.div<{ asOverlay?: boolean }>`\n  ${({ asOverlay }) =>\n    !asOverlay\n      ? css`\n          position: absolute;\n          right: 0;\n          top: 1px;\n          max-width: calc(100% - 100px);\n        `\n      : css`\n          flex-shrink: 0;\n        `};\n\n  display: flex;\n  gap: 0.25rem;\n  overflow: hidden;\n  background: ${({ theme }) =>\n    theme.currentBackgroundAware(theme.color(\"List.background\"))};\n`;\nconst StyledMessageContainer = styled.div`\n  position: relative;\n  display: flex;\n  gap: 0.25rem;\n`;\n\nconst StyledRefTooltipRow = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0.25rem;\n  font-size: 0.75rem;\n`;\nconst useCurrentUserHighlightStyle = ({\n  repoRoot,\n  author,\n}: {\n  repoRoot: string;\n  author: GitUser;\n}): CSSProperties => {\n  const currentUser = useRecoilValue(gitRepoUserState(repoRoot));\n  const shouldHighlightCurrentUserCommits = useRecoilValue(\n    vcsTableHighlightMyCommitsState\n  );\n  // for now assuming only a single table can be visible, and that's current tab's.\n  const userFilter = useRecoilValue(vcsLogFilterCurrentTab.user);\n  // single user case is not considered a special case, like it is in the original impl\n  const shouldHighlight =\n    shouldHighlightCurrentUserCommits &&\n    userFilter !== CURRENT_USER_FILTER_VALUE &&\n    areSamePerson(currentUser, author);\n\n  return { fontWeight: shouldHighlight ? \"bold\" : undefined };\n};\n\nexport function CommitsTableRow({\n  refs,\n  readCommitResult: {\n    oid,\n    commit: { author, committer, message },\n  },\n  repoRoot,\n}: {\n  repoRoot: string;\n  readCommitResult: ReadCommitResult;\n  refs: GitRef[] | undefined;\n}) {\n  const showCommitTimestamp = useRecoilValue(vcsTableShowCommitTimestampState);\n  const referencesOnTheLeft = useRecoilValue(vcsTableReferencesOnTheLeftState);\n  const isAuthorVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(authorColumn.id)\n  );\n  const isDateVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(dateColumn.id)\n  );\n  const isHashVisible = useRecoilValue(\n    vcsTableColumnsVisibilityState(hashColumn.id)\n  );\n\n  const highlightStyles = useCurrentUserHighlightStyle({ author, repoRoot });\n  return (\n    <StyledCommitRow>\n      <StyledCommitCell style={{ flexBasis: \"0%\", flexGrow: 1, flexShrink: 1 }}>\n        <StyledMessageContainer>\n          {refs && <CommitRefs onLeft={referencesOnTheLeft} refs={refs} />}\n          <span style={highlightStyles}>\n            {parseCommitMessage(message).subject}\n          </span>\n        </StyledMessageContainer>\n      </StyledCommitCell>\n      {isAuthorVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-1)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {author.name}\n          {committer.name !== author.name && \"*\"}\n        </StyledCommitCell>\n      )}\n      {isDateVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-2)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {formatCommitDateTime(\n            (showCommitTimestamp ? committer : author).timestamp * 1000\n          )}\n        </StyledCommitCell>\n      )}\n      {isHashVisible && (\n        <StyledCommitCell\n          style={{\n            flexBasis: \"auto\",\n            width: \"var(--column-width-3)\",\n            flexShrink: 1,\n            ...highlightStyles,\n          }}\n        >\n          {shortenOid(oid)}\n        </StyledCommitCell>\n      )}\n    </StyledCommitRow>\n  );\n}\n\nfunction refKey(ref: GitRef) {\n  return `${ref.type}${ref.name}`;\n}\n\nfunction CommitRefs({ refs, onLeft }: { refs: GitRef[]; onLeft?: boolean }) {\n  const { filteredRefs } = useMemo(() => {\n    const headIsOnABranch = refs.some(\n      (ref) => ref.type === \"localBranch\" && ref.isCurrent\n    );\n    return {\n      filteredRefs: refs.filter(\n        (ref) =>\n          !(\n            (ref.type === \"head\" && headIsOnABranch) ||\n            (ref.type === \"remoteBranch\" &&\n              refs.find(\n                (aBranch) =>\n                  aBranch.type === \"localBranch\" &&\n                  aBranch.trackingBranch === ref.name\n              ))\n          )\n      ),\n    };\n  }, [refs]);\n\n  return (\n    <TooltipTrigger\n      placement=\"bottom\"\n      delay={800}\n      isDisabled={refs.length < 2}\n      tooltip={\n        <Tooltip withPointer>\n          {refs.map((ref) => (\n            <StyledRefTooltipRow key={refKey(ref)}>\n              <RefIcon type={ref.type} />\n              {ref.name}\n            </StyledRefTooltipRow>\n          ))}\n        </Tooltip>\n      }\n    >\n      {({ ref, ...tooltipTriggerProps }) => (\n        <StyledRefsContainer\n          ref={ref as RefObject<HTMLDivElement>}\n          asOverlay={onLeft}\n          {...tooltipTriggerProps}\n        >\n          {filteredRefs\n            .filter(\n              (ref) =>\n                ref.type !== \"remoteBranch\" ||\n                !refs.find(\n                  (aBranch) =>\n                    aBranch.type === \"localBranch\" &&\n                    aBranch.trackingBranch === ref.name\n                )\n            )\n            .map((ref) => {\n              let name = ref.name;\n              const types: GitRef[\"type\"][] = [ref.type];\n              if (ref.type === \"localBranch\" && ref.trackingBranch) {\n                types.unshift(\"remoteBranch\");\n                name = `${ref.trackingBranch.split(\"/\")[0]} & ${ref.name}`;\n              }\n              if (ref.type === \"localBranch\" && ref.isCurrent) {\n                types.push(\"head\");\n              }\n              return (\n                <RefLabel key={refKey(ref)} types={types}>\n                  {name}\n                </RefLabel>\n              );\n            })}\n        </StyledRefsContainer>\n      )}\n    </TooltipTrigger>\n  );\n}\n","import React from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { Item, Link, List, ProgressBar, styled } from \"@intellij-platform/core\";\nimport { StyledPlaceholderContainer } from \"../styled-components\";\nimport { useResetFilters, vcsActiveTabKeyState } from \"../vcs-logs.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\nimport { CommitsTableRow } from \"./CommitsTableRow\";\nimport { GitRef } from \"../GitRef\";\nimport {\n  allResolvedRefsState,\n  commitsSelectionState,\n  commitsTableRowsState,\n} from \"./CommitsTable.state\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\n\n// const StyledList = styled(List)`\n//   display: grid;\n//   grid-template-columns: repeat(3, auto); /* Define 3 columns */\n//\n//   ${StyledListItem} {\n//     display: contents;\n//   }\n// ` as typeof List;\n\nconst StyledProgressBar = styled(ProgressBar)`\n  position: absolute;\n  width: 100%;\n  z-index: 1;\n`;\nconst StyledContainer = styled.div`\n  position: relative;\n  min-height: 0;\n  flex: 1;\n  ${StyledListItem} {\n    // the default \"min-width: min-content\", which is necessary for sizing overlays (e.g. Popup) containing list/tree,\n    // results in horizontally scrollable table. Probably not an issue when a proper Table component is implemented.\n    min-width: unset;\n  }\n`;\n\nconst ResolvedRefsContext = React.createContext<Record<string, GitRef[]>>({});\nexport function CommitsTable() {\n  const currentTabKey = useRecoilValue(vcsActiveTabKeyState);\n  const resetFilters = useResetFilters();\n\n  const [result, commitRowsState] = useLatestRecoilValue(commitsTableRowsState);\n  const rows = result?.rows;\n  const [allResolvedRefs] = useLatestRecoilValue(allResolvedRefsState);\n  const [selectedCommits, setSelectedCommits] = useRecoilState(\n    commitsSelectionState\n  );\n\n  return (\n    <ResolvedRefsContext.Provider value={allResolvedRefs ?? {}}>\n      <StyledContainer>\n        {commitRowsState === \"loading\" && (\n          <StyledProgressBar aria-label=\"Loading commits\" isIndeterminate />\n        )}\n        {rows && rows.length > 0 && (\n          <List\n            aria-label=\"Commits list\"\n            items={rows}\n            fillAvailableSpace\n            selectionMode=\"multiple\"\n            selectedKeys={selectedCommits}\n            onSelectionChange={setSelectedCommits}\n            estimatedItemHeight={24}\n          >\n            {({ readCommitResult, repoPath }) => (\n              <Item\n                key={readCommitResult.oid}\n                textValue={readCommitResult.commit.message}\n              >\n                {/* Using context here due to rendering optimizations of collection API */}\n                <ResolvedRefsContext.Consumer>\n                  {(refs) => (\n                    <CommitsTableRow\n                      readCommitResult={readCommitResult}\n                      repoRoot={repoPath}\n                      refs={refs[readCommitResult.oid]}\n                    />\n                  )}\n                </ResolvedRefsContext.Consumer>\n              </Item>\n            )}\n          </List>\n        )}\n        {commitRowsState === \"hasValue\" && rows && rows.length === 0 && (\n          <StyledPlaceholderContainer>\n            No commits matching filters\n            <Link onPress={() => resetFilters(currentTabKey)}>\n              Reset filters\n            </Link>\n          </StyledPlaceholderContainer>\n        )}\n      </StyledContainer>\n    </ResolvedRefsContext.Provider>\n  );\n}\n","import React from \"react\";\nimport { RecoilState, useRecoilState } from \"recoil\";\nimport {\n  ActionTooltip,\n  IconButtonWithMenu,\n  Item,\n  PlatformIcon,\n  Section,\n  SpeedSearchMenu,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  authorColumn,\n  dateColumn,\n  hashColumn,\n  vcsTableColumnsVisibilityState,\n  vcsTableHighlightMyCommitsState,\n  vcsTableReferencesOnTheLeftState,\n  vcsTableShowCommitTimestampState,\n} from \"./CommitsTable.state\";\n\ntype ToggleDef = {\n  name: string;\n  state: RecoilState<boolean>;\n};\nconst showToggleDefs = [\n  { name: \"Commit Timestamp\", state: vcsTableShowCommitTimestampState },\n  { name: \"References on the Left\", state: vcsTableReferencesOnTheLeftState },\n];\nconst highlightToggleDefs = [\n  { name: \"My Commits\", state: vcsTableHighlightMyCommitsState },\n];\nconst columnToggleDefs = [authorColumn, hashColumn, dateColumn].map(\n  ({ name, id }) => ({\n    name,\n    state: vcsTableColumnsVisibilityState(id),\n  })\n);\nconst useToggleDef = (item: ToggleDef) => {\n  const [value, set] = useRecoilState(item.state);\n  return { ...item, key: item.state.key.replace(/\"/g, \"_\"), value, set };\n};\n\nexport function CommitsTableViewOptionsMenuIconButton() {\n  const showToggles = showToggleDefs.map(useToggleDef);\n  const highlightToggles = highlightToggleDefs.map(useToggleDef);\n  const columnToggles = columnToggleDefs.map(useToggleDef);\n\n  const allToggles = showToggles.concat(highlightToggles).concat(columnToggles);\n  return (\n    <TooltipTrigger tooltip={<ActionTooltip actionName=\"View Options\" />}>\n      <IconButtonWithMenu\n        renderMenu={({ menuProps }) => {\n          return (\n            // TODO: keep menu open when (certain) items are toggled. Search for closeOnSelect TODO in menu\n            <SpeedSearchMenu\n              {...menuProps}\n              selectedKeys={allToggles\n                .filter(({ value }) => value)\n                .map(({ key }) => key)}\n              onAction={(key) => {\n                const toggle = allToggles.find(\n                  ({ key: toggleKey }) => toggleKey === key\n                );\n                if (toggle) {\n                  toggle.set((value) => !value);\n                } else {\n                  notImplemented();\n                }\n              }}\n            >\n              <Section title=\"Show\">\n                <Item>Compact References View</Item>\n                <Item>Tag Names</Item>\n                <Item>Long Edges</Item>\n                {\n                  showToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item title=\"Columns\">\n                  {\n                    columnToggles.map(({ name, key }) => (\n                      <Item key={key}>{name}</Item>\n                    )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                  }\n                </Item>\n              </Section>\n              <Section title=\"Highlight\">\n                {\n                  highlightToggles.map(({ name, key }) => (\n                    <Item key={key}>{name}</Item>\n                  )) as any /* returned type is too broad and couldn't find a quick way to narrow it properly */\n                }\n                <Item>Merge Commits</Item>\n                <Item>Current Branch</Item>\n                <Item>Not Cherry-Picked Commits</Item>\n              </Section>\n            </SpeedSearchMenu>\n          );\n        }}\n      >\n        <PlatformIcon icon=\"actions/groupBy.svg\" />\n      </IconButtonWithMenu>\n    </TooltipTrigger>\n  );\n}\n","import { v4 as uuid } from \"uuid\";\nimport React, { useEffect, useState } from \"react\";\nimport {\n  ActionButton,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  IconButton,\n  Item,\n  Menu,\n  PlatformIcon,\n  SearchInput,\n  styled,\n  StyledHoverContainer,\n  Toolbar,\n  ToolbarSeparator,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\n\nimport { StyledHeader, StyledSpacer } from \"../styled-components\";\nimport { VcsFilterDropdown } from \"./VcsLogDropdown\";\nimport {\n  atom,\n  RecoilState,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n  useResetRecoilState,\n} from \"recoil\";\nimport { searchInputRefState } from \"../VersionControlToolWindow\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  CURRENT_USER_FILTER_VALUE,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsTabKeysState,\n} from \"../vcs-logs.state\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { DateRange, dateToString } from \"../DateRange\";\nimport { BranchesFilterDropdown } from \"./BranchesFilterDropdown\";\nimport { CommitsTable } from \"./CommitsTable\";\nimport { CommitsTableViewOptionsMenuIconButton } from \"./CommitsTableViewOptionsMenuIconButton\";\n\nconst StyledSearchInput = styled(SearchInput)`\n  border-radius: 2px;\n  width: 219px;\n  margin-right: 0.0625rem;\n  margin-left: 0.2rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst searchHistoryState = atom<string[]>({\n  key: \"vcs/toolwindow/searchHistory\",\n  default: [], // TODO: add an effect to persist it under application level other.xml file under\n  // PropertyService component's \"Vcs.Log.Text.Filter.History\" property\n});\n\nexport function VcsLogCommitsView({ tabKey }: { tabKey: string }) {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const [searchQuery, setSearchQuery] = useRecoilState(\n    vcsLogFilter.searchQuery(tabKey)\n  );\n  const [user, setUser] = useRecoilState(vcsLogFilter.user(tabKey));\n  const resetUser = useResetRecoilState(vcsLogFilter.user(tabKey));\n  const [dateFilter, setDateFilter] = useRecoilState(vcsLogFilter.date(tabKey));\n  const resetDate = useResetRecoilState(vcsLogFilter.date(tabKey));\n  const [searchHistory, setSearchHistory] = useRecoilState(searchHistoryState);\n  const [searchInputValue, setSearchInputValue] = useState(searchQuery);\n  const getActionShortcut = useGetActionShortcut();\n  const isRegExpOn = useRecoilValue(vcsLogFilter.regExp(tabKey));\n  const isMatchCaseOn = useRecoilValue(vcsLogFilter.matchCase(tabKey));\n  const submitSearchQuery = (value = searchInputValue) => {\n    setSearchQuery(value);\n    if (value && !searchHistory.includes(value)) {\n      setSearchHistory((searchHistory) => [\n        value,\n        ...searchHistory.filter((item) => item !== value),\n      ]);\n    }\n  };\n\n  useEffect(() => {\n    setSearchInputValue(searchQuery);\n  }, [searchQuery]);\n\n  const createNewTab = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        const newTabId = uuid();\n        set(vcsTabKeysState, (value) => [...value, newTabId]);\n        Object.values(vcsLogFilter).forEach(\n          (filterState: (tabKey: string) => RecoilState<any>) => {\n            set(\n              filterState(newTabId),\n              snapshot\n                .getLoadable(\n                  filterState(\n                    snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n                  )\n                )\n                .getValue()\n            );\n          }\n        );\n        set(vcsActiveTabKeyState, newTabId);\n      },\n    []\n  );\n  const today = new Date();\n  const sevenDaysAgo = new Date();\n  sevenDaysAgo.setDate(today.getDate() - 7);\n  const yesterday = new Date();\n  yesterday.setDate(today.getDate() - 1);\n  const predefinedDateRanges = [\n    {\n      name: \"Last 24 hours\",\n      value: { from: yesterday },\n    },\n    {\n      name: \"Last 7 days\",\n      value: { from: sevenDaysAgo },\n    },\n  ];\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName=\"Text or Hash Filter\"\n              shortcut={getActionShortcut(VcsActionIds.FOCUS_TEXT_FILTER)}\n            />\n          }\n        >\n          <StyledSearchInput\n            inputRef={textFilterRef}\n            value={searchInputValue}\n            onChange={setSearchInputValue}\n            onSubmit={submitSearchQuery}\n            onBlur={() => submitSearchQuery()}\n            onClear={() => submitSearchQuery(\"\")}\n            searchHistory={searchHistory}\n            addonAfter={\n              <>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.REG_EXP}\n                >\n                  <AutoHoverPlatformIcon\n                    icon={\n                      isRegExpOn ? \"actions/regexSelected\" : \"actions/regex\"\n                    }\n                    hoverIcon={\n                      isRegExpOn\n                        ? \"actions/regexSelected\"\n                        : \"actions/regexHovered\"\n                    }\n                  />\n                </StyledHoverContainer>\n                <StyledHoverContainer\n                  as={ActionButton}\n                  excludeFromTabOrder={false}\n                  actionId={VcsActionIds.MATCH_CASE}\n                >\n                  {isMatchCaseOn ? (\n                    <PlatformIcon icon=\"actions/matchCaseSelected\" />\n                  ) : (\n                    <AutoHoverPlatformIcon\n                      icon=\"actions/matchCase\"\n                      hoverIcon=\"actions/matchCaseHovered\"\n                    />\n                  )}\n                </StyledHoverContainer>\n              </>\n            }\n          />\n        </TooltipTrigger>\n        <Toolbar>\n          <BranchesFilterDropdown tabKey={tabKey} />\n          <VcsFilterDropdown\n            value={user === CURRENT_USER_FILTER_VALUE ? \"me\" : user}\n            onClear={resetUser}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  if (key === \"select\") {\n                    return notImplemented();\n                  }\n                  setUser(`${key}`);\n                }}\n              >\n                <Item key=\"select\">Select...</Item>\n                <Item key={CURRENT_USER_FILTER_VALUE}>me</Item>\n              </Menu>\n            )}\n            label=\"User\"\n          />\n          <VcsFilterDropdown\n            value={dateFilter && dateRangeToString(dateFilter)}\n            onClear={resetDate}\n            renderMenu={({ menuProps }) => (\n              <Menu\n                {...menuProps}\n                onAction={(key) => {\n                  const predefinedDateRange = predefinedDateRanges.find(\n                    ({ name }) => name === key\n                  );\n                  if (predefinedDateRange) {\n                    setDateFilter(predefinedDateRange.value);\n                  } else {\n                    notImplemented();\n                  }\n                }}\n              >\n                {[\n                  <Item key=\"select\">Select...</Item>,\n                  ...predefinedDateRanges.map(({ name }) => (\n                    <Item key={name}>{name}</Item>\n                  )),\n                ]}\n              </Menu>\n            )}\n            label=\"Date\"\n          />\n          <VcsFilterDropdown\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Select in...</Item>\n                <Item>Select in Tree...</Item>\n              </Menu>\n            )}\n            label=\"Paths\"\n          />\n          <ToolbarSeparator />\n          <TooltipTrigger\n            tooltip={<ActionTooltip actionName=\"Open New Git Log Tab\" />}\n          >\n            <IconButton aria-label=\"Checkout\" onPress={createNewTab}>\n              <PlatformIcon icon=\"actions/openNewTab.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n        <StyledSpacer />\n        <Toolbar style={{ flexShrink: 0 }}>\n          <ActionButton actionId={VcsActionIds.LOG_REFRESH} />\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Cherry-Pick\" />}>\n            <IconButton isDisabled>\n              <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/cherryPick.svg\" />\n            </IconButton>\n          </TooltipTrigger>\n          <CommitsTableViewOptionsMenuIconButton />\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip actionName=\"Go To Hash/Branch/Tag\" shortcut=\"F\" />\n            }\n          >\n            <IconButton>\n              <PlatformIcon icon=\"actions/find\" />\n            </IconButton>\n          </TooltipTrigger>\n        </Toolbar>\n      </StyledHeader>\n      <CommitsTable />\n    </StyledContainer>\n  );\n}\n\nfunction dateRangeToString(dateRange: DateRange): string {\n  if (dateRange.from && dateRange.to) {\n    return `Between ${dateToString(dateRange.from)} and ${dateToString(\n      dateRange.to\n    )}`;\n  }\n  if (dateRange.from) {\n    return `since ${dateToString(dateRange.from)}`;\n  }\n  if (dateRange.to) {\n    return `until ${dateToString(dateRange.to)}`;\n  }\n  return \"\";\n}\n","import { basename } from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { Key, RefObject } from \"react\";\nimport { atom, atomFamily, isRecoilValue, selector } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport { PlatformIcon, TreeRefValue } from \"@intellij-platform/core\";\n\nimport {\n  allBranchesState,\n  BranchType,\n  isFavoriteBranchState,\n  LocalBranch,\n  RemoteBranch,\n  RepoBranches,\n} from \"../../Branches/branches.state\";\nimport {\n  DirectoryNode,\n  createGroupByDirectory,\n} from \"../../../tree-utils/groupByDirectory\";\nimport { vcsRootsState } from \"../../file-status.state\";\nimport { vcsLogTabState } from \"../vcs-logs.state\";\n\ntype LocalBranchNode = {\n  type: \"localBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is current branch in at least one repo\n   */\n  isCurrent: boolean;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n\n  branches: Array<{ repoRoot: string; branch: LocalBranch }>;\n};\ntype RemoteBranchNode = {\n  type: \"remoteBranch\";\n  key: string;\n  /**\n   * Branch name (without prefixes), to show in the tree node.\n   */\n  name: string;\n  /**\n   * Whether the branch is marked as favorite in at least one repo\n   */\n  isFavorite: boolean;\n  /**\n   * repo names to show in parentheses, only shown when the branch doesn't exist in all repos.\n   */\n  repos: null | string[];\n  branches: Array<{ repoRoot: string; branch: RemoteBranch }>;\n};\ntype BranchDirectoryNode = DirectoryNode & {\n  children: readonly AnyBranchTreeNode[];\n};\ntype RepositoryNode = {\n  type: \"repository\";\n  key: string;\n  repoRoot: string;\n  children: ReadonlyArray<LocalBranchNode | RemoteBranchNode | DirectoryNode>;\n};\nexport type AnyBranchTreeNode =\n  | {\n      type: \"head\";\n    }\n  | {\n      type: \"branchType\";\n      branchType: BranchType;\n      children: readonly AnyBranchTreeNode[];\n    }\n  | RepositoryNode\n  | BranchDirectoryNode\n  | LocalBranchNode\n  | RemoteBranchNode;\n\nfunction getLocalBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allLocalBranches = repoBranches.flatMap(\n    ({ repoRoot, localBranches, currentBranch }) =>\n      localBranches.map((branch) => ({\n        repoRoot,\n        isCurrent: currentBranch?.name === branch.name,\n        branch,\n      }))\n  );\n  const localBranchNodes = Object.entries(\n    groupBy(({ branch }) => branch.name, allLocalBranches)\n  ).map<LocalBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"localBranch\",\n      key: `localBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"LOCAL\",\n          branchName: branch.name,\n        })\n      ),\n      isCurrent: branches.some(({ isCurrent }) => isCurrent),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(localBranchNodes);\n  }\n  return localBranchNodes;\n}\n\nfunction getRemoteBranchNodes(\n  repoBranches: RepoBranches[],\n  shouldGroupByDirectory: boolean\n) {\n  const allRemoteBranches = repoBranches.flatMap(\n    ({ repoRoot, remoteBranches }) =>\n      remoteBranches.map((branch) => ({\n        repoRoot,\n        branch,\n      }))\n  );\n  const remoteBranchNodes = Object.entries(\n    groupBy(\n      ({ branch }) => `${branch.remote}/${branch.name}`,\n      allRemoteBranches\n    )\n  ).map<RemoteBranchNode>(([name, branches]) => {\n    const repos = branches.map(({ repoRoot }) => basename(repoRoot));\n    return {\n      type: \"remoteBranch\",\n      key: `remoteBranch:${repos.join(\"|\")}:${name}`,\n      name,\n      branches,\n      isFavorite: branches.some(({ repoRoot, branch }) =>\n        isFavoriteBranchState({\n          repoRoot,\n          branchType: \"REMOTE\",\n          branchName: branch.name,\n        })\n      ),\n      repos: repos.length === repoBranches.length ? null : repos,\n    };\n  });\n  if (shouldGroupByDirectory) {\n    return groupNodesByDirectory(remoteBranchNodes);\n  }\n  return remoteBranchNodes;\n}\n\nexport const branchesTreeNodeState = selector({\n  key: \"vcs/logs/branchesTree/nodes\",\n  get: ({ get }): AnyBranchTreeNode[] => {\n    // TODO: sorting. favorite should be on top. Others should be alphabetical\n    const repoBranches = get(allBranchesState);\n    const shouldGroupByDirectory = get(branchTreeGroupingState(\"directory\"));\n    const shouldGroupByRepository =\n      get(isGroupByRepositoryAvailableState) &&\n      get(branchTreeGroupingState(\"repository\"));\n\n    return [\n      { type: \"head\" },\n      {\n        type: \"branchType\",\n        branchType: \"LOCAL\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `LOCAL:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getLocalBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getLocalBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n      {\n        type: \"branchType\",\n        branchType: \"REMOTE\",\n        children: shouldGroupByRepository\n          ? repoBranches.map((repoBranches) => {\n              return {\n                type: \"repository\",\n                key: `REMOTE:repository:${repoBranches.repoRoot}`,\n                repoRoot: repoBranches.repoRoot,\n                children: getRemoteBranchNodes(\n                  [repoBranches],\n                  shouldGroupByDirectory\n                ),\n              };\n            })\n          : getRemoteBranchNodes(repoBranches, shouldGroupByDirectory),\n      },\n    ];\n  },\n});\nconst groupNodesByDirectory = createGroupByDirectory<\n  LocalBranchNode | RemoteBranchNode,\n  BranchDirectoryNode\n>({\n  shouldCollapseDirectories: false,\n  getPath: (node) => node.name,\n});\nexport const branchTreeGroupingState = atomFamily<\n  boolean,\n  \"directory\" | \"repository\"\n>({\n  key: \"vcs/logs/branchesTree/grouping\",\n  default: true,\n});\nexport const isGroupByRepositoryAvailableState = selector<boolean>({\n  key: \"vcs/logs/branchesTree/grouping/repo/available\",\n  get: ({ get }) => get(vcsRootsState).length > 1,\n});\nexport const branchesTreeRefState = vcsLogTabState(\n  atomFamily<RefObject<TreeRefValue>, string>({\n    key: \"vcs/logs/branchesTree/ref\",\n    default: React.createRef(),\n    dangerouslyAllowMutability: true,\n  })\n);\nexport const selectedKeysState = vcsLogTabState(\n  atomFamily<Selection, string>({\n    key: \"vcs/logs/branchesTree/selectedKeys\",\n    default: new Set(),\n  })\n);\nexport const expandedKeysState = vcsLogTabState(\n  atomFamily<Set<Key>, string>({\n    key: \"vcs/logs/branchesTree/expandedKeys\",\n    default: new Set(),\n  })\n);\n\nexport const searchInputState = vcsLogTabState(\n  atomFamily<string, string>({\n    key: \"vcs/logs/branchesTree/searchInput\",\n    default: \"\",\n  })\n);\n\nconst groupings = [\n  {\n    id: \"directory\" as const,\n    title: \"Directory\",\n    icon: <PlatformIcon icon=\"actions/GroupByPackage.svg\" />,\n    isActive: branchTreeGroupingState(\"directory\"),\n    isAvailable: true,\n  },\n  {\n    id: \"repository\" as const,\n    title: \"Repository\",\n    isActive: branchTreeGroupingState(\"repository\"),\n    isAvailable: isGroupByRepositoryAvailableState,\n  },\n];\nexport const availableGroupingsState = selector({\n  key: \"vcs/logs/branchesTree/availableGroupings\",\n  get: ({ get }) =>\n    groupings\n      .filter((grouping) =>\n        isRecoilValue(grouping.isAvailable)\n          ? get(grouping.isAvailable)\n          : grouping.isAvailable\n      )\n      .map((grouping) => ({\n        ...grouping,\n        isActive: get(branchTreeGroupingState(grouping.id)),\n      })),\n});\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\n\nimport { GroupByActionButton } from \"../../../GroupByActionButton\";\nimport {\n  availableGroupingsState,\n  branchTreeGroupingState,\n} from \"./BranchesTree.state\";\n\nexport function BranchesGroupByActionButton() {\n  //  TODO: Generalize and convert to actions\n  const toggleGroup = useRecoilCallback(\n    ({ set }) =>\n      (id: \"directory\" | \"repository\") => {\n        set(branchTreeGroupingState(id), (value) => !value);\n      },\n    []\n  );\n  const availableGroupings = useRecoilValue(availableGroupingsState);\n\n  return (\n    <GroupByActionButton\n      groupings={availableGroupings}\n      onToggle={toggleGroup}\n    />\n  );\n}\n","import { basename } from \"path\";\nimport React from \"react\";\nimport { ItemElement } from \"@react-types/shared/src/collections\";\nimport {\n  ActionTooltip,\n  HighlightedTextValue,\n  Item,\n  ItemLayout,\n  PlatformIcon,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { TrackingBranchInfo } from \"../../TrackingBranchInfo\";\nimport { RepoColorIcon } from \"../../Changes/StyledRepoColorSquare\";\nimport { AnyBranchTreeNode } from \"./BranchesTree.state\";\n\nexport const branchTreeNodeRenderers: {\n  [nodeType in AnyBranchTreeNode[\"type\"]]: (\n    node: AnyBranchTreeNode & { type: nodeType }\n  ) => ItemElement<AnyBranchTreeNode>;\n} = {\n  branchType: (node) => {\n    return (\n      <Item\n        key={`${node.type}:${node.branchType}`}\n        textValue={wordCase(node.branchType)}\n        childItems={node.children}\n      >\n        <HighlightedTextValue />\n      </Item>\n    );\n  },\n  localBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <TooltipTrigger\n            tooltip={\n              <ActionTooltip\n                actionName={<TrackingBranchInfo branches={node.branches} />}\n              ></ActionTooltip>\n            }\n          >\n            {(props) => (\n              <ItemLayout.Group {...props}>\n                {node.isCurrent ? (\n                  <TooltipTrigger\n                    tooltip={\n                      <Tooltip>\n                        Current {node.isFavorite && \"favorite \"}branch\n                      </Tooltip>\n                    }\n                  >\n                    {(props) => (\n                      <ItemLayout.Group {...props}>\n                        <PlatformIcon\n                          icon={\n                            node.isFavorite\n                              ? \"/platform/dvcs-impl/resources/icons/currentBranchFavoriteLabel.svg\"\n                              : \"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\"\n                          }\n                        />\n                      </ItemLayout.Group>\n                    )}\n                  </TooltipTrigger>\n                ) : (\n                  <PlatformIcon icon=\"vcs/branchNode\" />\n                )}\n                <HighlightedTextValue />\n                {node.repos && (\n                  <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n                )}\n              </ItemLayout.Group>\n            )}\n          </TooltipTrigger>\n        </ItemLayout>\n      </Item>\n    );\n  },\n  remoteBranch: (node) => {\n    return (\n      <Item key={`${node.key}`} textValue={basename(node.name)}>\n        <ItemLayout>\n          <PlatformIcon\n            icon={node.isFavorite ? \"nodes/favorite.svg\" : \"vcs/branchNode\"}\n          />\n          <HighlightedTextValue />\n          {node.repos && (\n            <ItemLayout.Hint>({node.repos.join(\", \")})</ItemLayout.Hint>\n          )}\n        </ItemLayout>\n      </Item>\n    );\n  },\n  repository: (node) => (\n    <Item\n      key={`${node.key}`}\n      textValue={basename(node.repoRoot)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <RepoColorIcon rootPath={node.repoRoot} />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  directory: (node) => (\n    <Item\n      key={`${node.type}_${node.parentNodePath}${node.dirPath}`}\n      textValue={basename(node.dirPath)}\n      childItems={node.children}\n    >\n      <ItemLayout>\n        <PlatformIcon icon=\"nodes/folder.svg\" />\n        <HighlightedTextValue />\n      </ItemLayout>\n    </Item>\n  ),\n  head: (node) => (\n    <Item key={`${node.type}`} textValue=\"HEAD (Current Branch)\">\n      <HighlightedTextValue />\n    </Item>\n  ),\n};\n\nfunction wordCase(input: string): string {\n  return input[0].toUpperCase() + input.slice(1).toLowerCase();\n}\n\nexport const keyToBranch = (key: string): string | null => {\n  const [type, _repo, branchName] = key.split(\":\");\n  if (type === \"head\") {\n    return \"HEAD\";\n  }\n  if (type === \"localBranch\" || type === \"remoteBranch\") {\n    return branchName ?? null;\n  }\n  return null;\n};\n","import React, { useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { PlatformIcon, SpeedSearchTree, styled } from \"@intellij-platform/core\";\n\nimport {\n  branchTreeNodeRenderers,\n  keyToBranch,\n} from \"./branchTreeNodeRenderers\";\nimport {\n  branchesTreeNodeState,\n  branchesTreeRefState,\n  expandedKeysState,\n  searchInputState,\n  selectedKeysState,\n} from \"./BranchesTree.state\";\nimport { StyledHeader } from \"../styled-components\";\nimport { vcsLogFilterCurrentTab } from \"../vcs-logs.state\";\nimport { useLatestRecoilValue } from \"../../../recoil-utils\";\n\nconst StyledSearchInput = styled.input`\n  all: unset;\n  flex: 1;\n  align-self: stretch;\n`;\nconst StyledContainer = styled.div`\n  min-width: 0; // don't outgrow the container\n  flex-grow: 1; // fill the available space\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledSearchIconContainer = styled.span`\n  display: inline-flex;\n  margin-top: -0.0625rem;\n  margin-left: 0.7rem;\n  margin-right: 0.25rem;\n  cursor: text;\n`;\n\nexport function BranchesTree({ tabKey }: { tabKey: string }) {\n  const [branchesTreeNodes] = useLatestRecoilValue(branchesTreeNodeState);\n  const [selectedKeys, setSelectedKeys] = useRecoilState(\n    selectedKeysState(tabKey)\n  );\n  const [expandedKeys, setExpandedKeys] = useRecoilState(\n    expandedKeysState(tabKey)\n  );\n  const [searchTerm, setSearchTerm] = useRecoilState(searchInputState(tabKey));\n  const treeRef = useRecoilValue(branchesTreeRefState(tabKey));\n  const ref = useRef<HTMLDivElement>(null);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setInputFocused] = useState(false);\n  const setBranchFilter = useSetRecoilState(vcsLogFilterCurrentTab.branch);\n  const onAction = (key: React.Key) => {\n    const branch = keyToBranch(`${key}`);\n    if (branch) {\n      setBranchFilter([branch]);\n    }\n  };\n\n  /**\n   * TODO: remaining from search:\n   * - Make the search input red when there is no match\n   * - filter non-matching tree nodes out\n   * - search in the whole tree, not just nodes that are currently visible based on expandedKeys\n   *   - update expanded keys to show matches, as a side effect, every time matches are updated.\n   * The above items are postponed to think more about flexibility of SpeedSearchTree API.\n   * Some rough thoughts about different approaches:\n   * - Provide generic tree utilities to search in the whole tree. In SpeedSearchTree allow for full control over\n   * `matches`. It will be in usage side that matches are calculated based on search input value, and passed to\n   * SpeedSearchTree as an input.\n   * - In SpeedSearchTree, allow for passing a custom search function, which would accept the tree collection object,\n   *   the search query, and the default match function (minusculeMatch).\n   * - Make Tree more flexible or introduce a more flexible base component, so that speed search for tree can be\n   *   implementated in a more composable way. Tree (or TreeBase) would accept props for intercepting `state` creation,\n   *   and it would also allow passing additional props to the tree container. Then a more generic CollectionSpeedSearch\n   *   component would offer options on how to control and customize speed search, and would return props to be passed\n   *   to collection components.\n   */\n\n  return (\n    <StyledContainer>\n      <StyledHeader>\n        <StyledSearchIconContainer>\n          <PlatformIcon icon=\"actions/search\" />\n        </StyledSearchIconContainer>\n        {/* FIXME: tabIndex -1 is a workaround to not get the input focused when the toolwindow opens. Not ideal.*/}\n        <StyledSearchInput\n          ref={searchInputRef}\n          tabIndex={-1}\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          onFocus={() => {\n            setInputFocused(true);\n          }}\n          onBlur={() => {\n            setInputFocused(false);\n          }}\n        />\n      </StyledHeader>\n      <SpeedSearchTree\n        ref={ref}\n        treeRef={treeRef}\n        focusProxyRef={searchInputRef}\n        items={branchesTreeNodes ?? []}\n        selectionMode=\"multiple\"\n        selectedKeys={selectedKeys}\n        onSelectionChange={setSelectedKeys}\n        expandedKeys={expandedKeys}\n        onExpandedChange={setExpandedKeys}\n        onAction={onAction}\n        fillAvailableSpace\n        // speed search related props\n        showAsFocused={isInputFocused}\n        searchTerm={searchTerm}\n        onSearchTermChange={setSearchTerm}\n        keepSearchActiveOnBlur\n        hideSpeedSearchPopup\n        isSearchActive\n      >\n        {(node) => {\n          // @ts-expect-error we need to somehow infer the type of `node.type`\n          return branchTreeNodeRenderers[node.type](node);\n        }}\n      </SpeedSearchTree>\n    </StyledContainer>\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  ActionButton,\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  PlatformIcon,\n  Toolbar,\n  ToolbarSeparator,\n  useTreeActions,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport { BranchesGroupByActionButton } from \"./BranchesGroupByActionButton\";\nimport { BranchesTree } from \"./BranchesTree\";\nimport { branchesTreeRefState } from \"./BranchesTree.state\";\n\nconst DELETE_BRANCH_ACTION_ID = \"Git.DeleteBranch\";\nconst SHOW_BRANCH_DIFF_ACTION_ID = \"Git.Compare.With.Current\";\nconst SHOW_MY_BRANCHES_ACTION_ID = \"Git.Show.My.Branches\";\nconst FETCH_ACTION_ID = \"Git.Fetch\";\nconst TOGGLE_FAVORITE_ACTION_ID = \"Git.Toggle.Favorite\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  height: 100%;\n`;\n\nexport function VcsBranchesView({ tabKey }: { tabKey: string }) {\n  const treeRef = useRecoilValue(branchesTreeRefState(tabKey));\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.GIT_UPDATE_SELECTED,\n      title: \"Update Selected\",\n      icon: <PlatformIcon icon=\"actions/checkOut\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: DELETE_BRANCH_ACTION_ID,\n      title: \"Delete branch\",\n      icon: <PlatformIcon icon=\"actions/gc\" />,\n      useShortcutsOf: \"SafeDelete\",\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_BRANCH_DIFF_ACTION_ID,\n      title: \"Compare with current\",\n      icon: <PlatformIcon icon=\"actions/diff\" />,\n      useShortcutsOf: VcsActionIds.SHOW_DIFF,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: SHOW_MY_BRANCHES_ACTION_ID,\n      title: \"Show My Branches\",\n      icon: <PlatformIcon icon=\"actions/find\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: FETCH_ACTION_ID,\n      title: \"Fetch All Remotes\",\n      icon: <PlatformIcon icon=\"vcs/fetch\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    {\n      id: TOGGLE_FAVORITE_ACTION_ID,\n      title: \"Mark/Unmark as Favorite\",\n      icon: <PlatformIcon icon=\"nodes/favorite\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n    ...useTreeActions({ treeRef }),\n  ];\n\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledContainer {...shortcutHandlerProps}>\n          <VcsLogBranchesViewToolbar />\n          <BranchesTree tabKey={tabKey} />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nconst StyledToolbar = styled(Toolbar)`\n  height: 100%;\n  flex-shrink: 0;\n`;\n\nfunction VcsLogBranchesViewToolbar() {\n  return (\n    <StyledToolbar border=\"right\" orientation=\"vertical\">\n      <ActionButton actionId={VcsActionIds.GIT_LOG_HIDE_BRANCHES} />\n      <ToolbarSeparator />\n      {/*FIXME: replace this with a separate \"new branch from\" action*/}\n      <ActionButton actionId={VcsActionIds.GIT_CREATE_NEW_BRANCH} />\n      <ActionButton actionId={VcsActionIds.GIT_UPDATE_SELECTED} />\n      <ActionButton actionId={DELETE_BRANCH_ACTION_ID} />\n      <ActionButton actionId={SHOW_BRANCH_DIFF_ACTION_ID} />\n      <ActionButton actionId={SHOW_MY_BRANCHES_ACTION_ID} />\n      <ActionButton actionId={FETCH_ACTION_ID} />\n      <ActionButton actionId={TOGGLE_FAVORITE_ACTION_ID} />\n      <ActionButton\n        actionId={VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH}\n      />\n      <ToolbarSeparator />\n      <BranchesGroupByActionButton />\n      <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n      <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n    </StyledToolbar>\n  );\n}\n","import { useRecoilCallback } from \"recoil\";\nimport React from \"react\";\nimport copyToClipboard from \"clipboard-copy\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport { VcsActionIds } from \"../../VcsActionIds\";\nimport {\n  allCommitsState,\n  commitsSelectionState,\n  selectedCommitOids,\n} from \"./CommitsTable.state\";\n\nexport const useCommitsTableActions = (): ActionDefinition[] => {\n  const copyRevisionNumber = useRecoilCallback(\n    ({ snapshot }) =>\n      () => {\n        const selectedCommits = snapshot\n          .getLoadable(selectedCommitOids)\n          .getValue();\n        copyToClipboard(selectedCommits.join(\" \")).catch(console.error);\n      },\n    []\n  );\n\n  const refreshLog = useRecoilCallback(\n    ({ refresh }) =>\n      () => {\n        refresh(allCommitsState);\n      },\n    []\n  );\n\n  return [\n    {\n      id: VcsActionIds.COPY_REVISION_NUMBER,\n      title: \"Copy Revision Number\",\n      icon: <PlatformIcon icon=\"actions/copy.svg\" />,\n      useShortcutsOf: CommonActionId.COPY_REFERENCE,\n      actionPerformed: copyRevisionNumber,\n    },\n    {\n      id: VcsActionIds.LOG_REFRESH,\n      title: \"Refresh\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      useShortcutsOf: CommonActionId.REFRESH,\n      actionPerformed: () => {\n        refreshLog();\n      },\n    },\n  ];\n};\n","import React from \"react\";\nimport {\n  Link,\n  PlatformIcon,\n  styled,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\n\nconst StyledContainer = styled.div`\n  min-height: 70%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 50px;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  white-space: nowrap;\n`;\nexport function VersionControlToolWindowZeroState() {\n  const performAction = usePerformAction();\n\n  return (\n    <StyledContainer>\n      <div style={{ textAlign: \"center\" }}>\n        To track changes to code:\n        <br />\n        <Link onPress={() => performAction(VcsActionIds.GIT_INIT)}>\n          Create Git repository...\n        </Link>\n        <br />\n        <Link onPress={notImplemented}>Use Local History...</Link>\n        <br />\n        <br />\n        <PlatformIcon\n          style={{ verticalAlign: \"text-top\" }}\n          icon=\"general/contextHelp.svg\"\n        />{\" \"}\n        <Link onPress={notImplemented}>Version Control integration</Link>{\" \"}\n      </div>\n    </StyledContainer>\n  );\n}\n","import React, { RefObject } from \"react\";\nimport {\n  atom,\n  RecoilState,\n  useRecoilCallback,\n  useRecoilState,\n  useRecoilValue,\n} from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionTooltip,\n  DefaultToolWindow,\n  MultiViewToolWindow,\n  PlatformIcon,\n  styled,\n  TabCloseButton,\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n  TooltipTrigger,\n  ToolWindowTabContent,\n} from \"@intellij-platform/core\";\n\nimport { VcsLogDetailsView } from \"./DetailsView/VcsLogDetailsView\";\nimport { VcsLogCommitsView } from \"./CommitsView/VcsLogCommitsView\";\nimport { VcsBranchesView } from \"./BranchesView/VcsBranchesView\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  useCloseVcsTab,\n  vcsActiveTabKeyState,\n  vcsLogFilter,\n  vcsLogTabShowBranchesState,\n  vcsLogTabShowCommitDetailsState,\n  vcsTabKeysState,\n  vcsTabTitleState,\n} from \"./vcs-logs.state\";\nimport { useCommitsTableActions } from \"./CommitsView/useCommitsTableActions\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { vcsRootsState } from \"../file-status.state\";\nimport { VersionControlToolWindowZeroState } from \"./VersionControlToolWindowZeroState\";\n\nexport const VERSION_CONTROL_TOOLWINDOW_ID = \"Version Control\";\n\nconst firstViewSizeState = atom({\n  key: \"vcs/toolwindow/firstViewSize\",\n  default: 0.25,\n});\nconst lastViewSizeState = atom({\n  key: \"vcs/toolwindow/lastViewSize\",\n  default: 0.35,\n});\n\nconst StyledToolWindowHeader = styled.span`\n  margin: 0 0.5rem 0 0.125rem;\n`;\n\nconst StyledContainer = styled.div`\n  height: 100%;\n  display: flex;\n  :focus-visible {\n    outline: none;\n  }\n`;\n\nexport const searchInputRefState = atom<RefObject<HTMLInputElement>>({\n  key: \"vcs/toolWindow/searchInputRef\",\n  default: React.createRef(),\n  dangerouslyAllowMutability: true,\n});\n\nexport const VersionControlToolWindow = () => {\n  const tabKeys = useRecoilValue(vcsTabKeysState);\n  const [activeTabKey, setActiveTabKey] = useRecoilState(vcsActiveTabKeyState);\n  const repos = useRecoilValue(vcsRootsState);\n\n  return repos.length > 0 ? (\n    <MultiViewToolWindow\n      headerContent={<StyledToolWindowHeader>Git:</StyledToolWindowHeader>}\n      activeKey={activeTabKey}\n      onActiveKeyChange={(key) => setActiveTabKey(`${key}`)}\n    >\n      {tabKeys.map((key) => (\n        <MultiViewToolWindow.View\n          tabContent={<VcsToolWindowTabTitle tabKey={key} />}\n          key={key}\n        >\n          <VcsTab tabKey={key} />\n        </MultiViewToolWindow.View>\n      ))}\n    </MultiViewToolWindow>\n  ) : (\n    <DefaultToolWindow headerContent=\"Version Control\">\n      <VersionControlToolWindowZeroState />\n    </DefaultToolWindow>\n  );\n};\n\nconst StyledExpandStripeButton = styled.button.attrs({ tabIndex: -1 })`\n  box-sizing: border-box;\n  all: unset;\n  width: 1.71875rem;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.625rem;\n  background: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  :disabled {\n    color: ${({ theme }) => theme.color(\"Button.disabledText\")};\n  }\n  &:hover {\n    background: ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Button.hoverBackground\",\n        theme.dark ? \"#0f0f0f28\" : \"#55555528\"\n      )};\n  }\n`;\nconst StyledShowBranchesButton = styled(StyledExpandStripeButton)`\n  border-right: 1px solid ${({ theme }) => theme.commonColors.borderColor};\n`;\nconst StyledShowBranchesButtonText = styled.span`\n  writing-mode: vertical-lr;\n  transform: rotateZ(180deg);\n  font-size: 0.6875rem;\n`;\n\nfunction ShowBranchesButton({ onPress }: { onPress: () => void }) {\n  return (\n    <StyledShowBranchesButton onClick={onPress}>\n      <PlatformIcon icon=\"actions/arrowExpand\" />\n      <StyledShowBranchesButtonText>Branches</StyledShowBranchesButtonText>\n    </StyledShowBranchesButton>\n  );\n}\n\nfunction VcsTab({ tabKey }: { tabKey: string }) {\n  const [firstViewSize, setFirstViewSize] = useRecoilState(firstViewSizeState);\n  const [lastViewSize, setLastViewSize] = useRecoilState(lastViewSizeState);\n\n  const actions = useVcsLogsToolWindowActions();\n  const [showBranches, setShowBranches] = useRecoilState(\n    vcsLogTabShowBranchesState(tabKey)\n  );\n\n  const firstViewProps: Partial<ThreeViewSplitterProps> = showBranches\n    ? {\n        firstView: <VcsBranchesView tabKey={tabKey} />,\n        firstSize: firstViewSize,\n        onFirstResize: setFirstViewSize,\n        firstViewMinSize: 85,\n      }\n    : {};\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        // tabIndex is added to make the whole container focusable, which means the focus can go away from the currently\n        // focused element, when background is clicked. This is to follow the original implementation.\n        <StyledContainer\n          {...shortcutHandlerProps}\n          tabIndex={showBranches ? -1 : 0}\n        >\n          {!showBranches && (\n            <ShowBranchesButton onPress={() => setShowBranches(true)} />\n          )}\n          <ThreeViewSplitter\n            {...firstViewProps}\n            innerView={<VcsLogCommitsView tabKey={tabKey} />}\n            innerViewMinSize={200}\n            lastView={<VcsLogDetailsView tabKey={tabKey} />}\n            lastSize={lastViewSize}\n            onLastResize={setLastViewSize}\n            lastViewMinSize={40}\n          />\n        </StyledContainer>\n      )}\n    </ActionsProvider>\n  );\n}\n\nfunction useToggleCurrentTabSettings(\n  toggleState: (activeTab: string) => RecoilState<boolean>\n) {\n  return useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          toggleState(snapshot.getLoadable(vcsActiveTabKeyState).getValue()),\n          (value) => !value\n        );\n      },\n    []\n  );\n}\n\nfunction useVcsLogsToolWindowActions() {\n  const textFilterRef = useRecoilValue(searchInputRefState);\n  const hideBranches = useRecoilCallback(\n    ({ set, snapshot }) =>\n      () => {\n        set(\n          vcsLogTabShowBranchesState(\n            snapshot.getLoadable(vcsActiveTabKeyState).getValue()\n          ),\n          // Would be nicer to have the action toggle, but prioritized matching the reference impl here.\n          false\n        );\n      },\n    []\n  );\n\n  const toggleMatchCase = useToggleCurrentTabSettings(vcsLogFilter.matchCase);\n  const toggleRegExp = useToggleCurrentTabSettings(vcsLogFilter.regExp);\n  const toggleDetails = useToggleCurrentTabSettings(\n    vcsLogTabShowCommitDetailsState\n  );\n\n  const actions: ActionDefinition[] = [\n    ...useCommitsTableActions(),\n    {\n      id: VcsActionIds.FOCUS_TEXT_FILTER,\n      title: \"Focus Text Filter\",\n      actionPerformed: () => {\n        textFilterRef.current?.focus();\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_HIDE_BRANCHES,\n      title: \"Hide Git Branches\",\n      icon: <PlatformIcon icon=\"actions/arrowCollapse\" />,\n      actionPerformed: hideBranches,\n    },\n    {\n      id: VcsActionIds.MATCH_CASE,\n      title: \"Match Case\",\n      icon: <PlatformIcon icon=\"actions/matchCase.svg\" />,\n      actionPerformed: toggleMatchCase,\n    },\n    {\n      id: VcsActionIds.REG_EXP,\n      title: \"Regex\",\n      icon: <PlatformIcon icon=\"actions/regex\" />,\n      actionPerformed: toggleRegExp,\n    },\n    {\n      id: VcsActionIds.SHOW_DETAILS,\n      title: \"Show Details\",\n      description: \"Display details panel\",\n      actionPerformed: toggleDetails,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF_PREVIEW,\n      title: \"Show Diff Preview\",\n      description: \"Show Diff Preview Panel\",\n      actionPerformed: () => notImplemented(),\n    },\n  ];\n  return actions;\n}\n\nfunction VcsToolWindowTabTitle({ tabKey }: { tabKey: string }) {\n  const closeTab = useCloseVcsTab();\n  return (\n    <ToolWindowTabContent\n      title={useRecoilValue(vcsTabTitleState(tabKey))}\n      closeButton={\n        tabKey !== \"MAIN\" && (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Close Tab\" />}>\n            <TabCloseButton onPress={() => closeTab(tabKey)} />\n          </TooltipTrigger>\n        )\n      }\n    />\n  );\n}\n","import React, { Suspense } from \"react\";\nimport {\n  DefaultToolWindow,\n  PlatformIcon,\n  ToolWindowState,\n  toolWindowState,\n} from \"@intellij-platform/core\";\n\nimport { Terminal } from \"../Terminal\";\nimport { ProjectToolWindow } from \"../ProjectView/ProjectToolWindow\";\nimport {\n  COMMIT_TOOLWINDOW_ID,\n  CommitToolWindow,\n} from \"../VersionControl/CommitToolWindow\";\nimport { UNSAFE_FocusRestoringSuspense } from \"../UNSAFE_FocusRestoringSuspense\";\nimport {\n  VERSION_CONTROL_TOOLWINDOW_ID,\n  VersionControlToolWindow,\n} from \"../VersionControl/VersionControlToolWindow/VersionControlToolWindow\";\n\nexport type ToolWindowDescriptor = {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactElement;\n  showStripeButton?: boolean;\n  initialState: ToolWindowState;\n};\nexport const toolWindows: ToolWindowDescriptor[] = [\n  {\n    id: \"Project\",\n    title: \"Project\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: <ProjectToolWindow />,\n    initialState: toolWindowState({ isVisible: true, weight: 0.23 }),\n  },\n  {\n    id: \"Terminal\",\n    title: \"Terminal\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowProject\" />,\n    content: (\n      <DefaultToolWindow headerContent=\"Terminal\">\n        <Terminal />\n      </DefaultToolWindow>\n    ),\n    initialState: toolWindowState({ anchor: \"bottom\" }),\n  },\n  {\n    id: COMMIT_TOOLWINDOW_ID,\n    title: \"Commit\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowCommit\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <CommitToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"left\",\n      isSplit: true, // Default is false in the original impl.\n      isVisible: false,\n    }),\n  },\n  {\n    id: VERSION_CONTROL_TOOLWINDOW_ID,\n    title: \"Version Control\",\n    icon: <PlatformIcon icon=\"toolwindows/toolWindowChanges\" />,\n    content: (\n      <Suspense fallback={<UNSAFE_FocusRestoringSuspense />}>\n        <VersionControlToolWindow />\n      </Suspense>\n    ),\n    initialState: toolWindowState({\n      anchor: \"bottom\",\n      weight: 0.35,\n    }),\n  },\n];\n","import { atom } from \"recoil\";\nimport { Bounds } from \"@intellij-platform/core\";\n\nexport const showProgressPanelState = atom({\n  key: \"ide.statusbar.showProgressPanel\",\n  default: false,\n});\nexport const tasksPopupBoundsState = atom<Bounds | null>({\n  key: \"ide.statusbar.tasksPopup\",\n  default: null,\n});\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport {\n  IconButton,\n  PlatformIcon,\n  Popup,\n  ProgressBar,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\n\nimport { tasksState, useCancelTask } from \"../tasks\";\nimport {\n  showProgressPanelState,\n  tasksPopupBoundsState,\n} from \"./IdeStatusBar.state\";\n\nconst StyledPopupTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport function TasksPopup() {\n  const setShowProgressPanel = useSetRecoilState(showProgressPanelState);\n  const tasks = useRecoilValue(tasksState);\n  const cancel = useCancelTask();\n  const [bounds, setBounds] = useRecoilState(tasksPopupBoundsState);\n\n  return (\n    <Popup\n      bounds={\n        // Maybe it would be a nicer UX to not fix height, and let it be based on content, but tried to mimic the\n        // original impl, where the height is fixed. The only improvement over the original impl is that the default\n        // height (in case of no persisted bounds), would depend on the content, and it will remain based on content,\n        // as long as the bounds is not changed manually by the user.\n        bounds || {\n          width: 300,\n          // TODO: allow for positioning based on right and/or bottom\n          left: window.innerWidth - 300 - /* distance to right edge */ 150,\n          top:\n            window.innerHeight -\n            tasks.length * 80 - // progress bars\n            30 - // header\n            100, // distance to bottom edge,\n        }\n      }\n      onBoundsChange={(bounds) => {\n        setBounds(bounds);\n      }}\n      minHeight={100}\n      minWidth={300}\n      nonDismissable\n      interactions=\"all\"\n    >\n      <Popup.Layout\n        header={\n          <Popup.Header hasControls>\n            <StyledPopupTitle>Background Tasks</StyledPopupTitle>\n            <TooltipTrigger tooltip={<Tooltip>Hide</Tooltip>}>\n              <IconButton\n                preventFocusOnPress\n                excludeFromTabOrder\n                onPress={() => setShowProgressPanel(false)}\n              >\n                <PlatformIcon icon=\"general/hideToolWindow\" />\n              </IconButton>\n            </TooltipTrigger>\n          </Popup.Header>\n        }\n        content={\n          <>\n            {tasks.map((task, index) => (\n              <React.Fragment key={task.id}>\n                <ProgressBar\n                  style={{ margin: \".5rem 0.75rem\" }}\n                  name={task.title}\n                  isIndeterminate={task.progress.isIndeterminate}\n                  aria-label={`Progress of ${task.title}`}\n                  details={\n                    task.progress.text ||\n                    (task.progress.secondaryText ? <>&nbsp;</> : undefined)\n                  }\n                  secondaryDetails={task.progress.secondaryText}\n                  value={task.progress.fraction}\n                  maxValue={1}\n                  button={\n                    task.isCancelable && (\n                      <ProgressBarStopButton onPress={() => cancel(task.id)} />\n                    )\n                  }\n                />\n                {tasks[index + 1] && <StyledVerticalSeparator />}\n              </React.Fragment>\n            ))}\n          </>\n        }\n      />\n    </Popup>\n  );\n}\n","import styled from \"styled-components\";\nimport {\n  BareButton,\n  Link,\n  ProgressBar,\n  ProgressBarProps,\n  ProgressBarStopButton,\n  Tooltip,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport { firstTaskState, taskCountState, useCancelTask } from \"../tasks\";\nimport { showProgressPanelState } from \"./IdeStatusBar.state\";\nimport React, { useEffect } from \"react\";\nimport { TasksPopup } from \"./TasksPopup\";\n\nfunction StatusBarProgress(\n  props: Omit<ProgressBarProps, \"dense\" | \"namePosition\" | \"width\">\n) {\n  return <ProgressBar dense namePosition=\"side\" width={146} {...props} />;\n}\n\nconst Spacer = styled.span`\n  width: 0.5rem;\n`;\nconst StyledProgressBarButton = styled.span`\n  cursor: pointer;\n\n  ${ProgressBar.Container} {\n    cursor: unset;\n  }\n`;\n/**\n * Intentionally, \"processes\" haven't been abstracted as an extension point for different features, since the focus\n * here is not to create an IDE, but to demo UI components.\n */\nexport const StatusBarTaskProgressBar = () => {\n  const firstTask = useRecoilValue(firstTaskState);\n  const tasksCount = useRecoilValue(taskCountState);\n  const cancel = useCancelTask();\n  const [showProgressPanel, setShowProgressPanel] = useRecoilState(\n    showProgressPanelState\n  );\n\n  // When there is no tasks, switch back to not showing the panel.\n  useEffect(() => {\n    if (tasksCount === 0) {\n      setShowProgressPanel(false);\n    }\n  }, [tasksCount]);\n\n  return (\n    <>\n      {firstTask && !showProgressPanel && (\n        <TooltipTrigger\n          tooltip={\n            <Tooltip>{`${firstTask.title}. Click to see all running background tasks.`}</Tooltip>\n          }\n        >\n          <BareButton\n            preventFocusOnPress\n            excludeFromTabOrder\n            onPress={() => {\n              setShowProgressPanel(true);\n            }}\n          >\n            <StyledProgressBarButton>\n              <StatusBarProgress\n                name={firstTask.progress.text || firstTask.title}\n                isIndeterminate={firstTask.progress.isIndeterminate}\n                value={firstTask.progress.fraction}\n                maxValue={1}\n                button={\n                  <>\n                    {/*  {task.canPause && (\n                      <ProgressBarPauseButton\n                        small\n                        paused={false}\n                        onPausedChange={() => {}}\n                      />\n                    )}*/}\n                    {firstTask.isCancelable && (\n                      <TooltipTrigger tooltip={<Tooltip>Cancel</Tooltip>}>\n                        <ProgressBarStopButton\n                          small\n                          onPress={() => cancel(firstTask.id)}\n                        />\n                      </TooltipTrigger>\n                    )}\n                  </>\n                }\n              />\n            </StyledProgressBarButton>\n          </BareButton>\n        </TooltipTrigger>\n      )}\n      {(tasksCount > 1 || showProgressPanel) && (\n        <>\n          <Spacer />\n          <Link\n            onPress={() =>\n              setShowProgressPanel((currentValue) => !currentValue)\n            }\n          >\n            {showProgressPanel ? \"Hide processes\" : \"Show all\"} ({tasksCount})\n          </Link>\n        </>\n      )}\n      {showProgressPanel && tasksCount > 0 && <TasksPopup />}\n    </>\n  );\n};\n","import { resolveRef } from \"isomorphic-git\";\nimport { selector } from \"recoil\";\nimport { activeEditorTabState } from \"../Editor/editor.state\";\nimport { fs } from \"../fs/fs\";\n\nimport { vcsRootForFile, vcsRootsState } from \"./file-status.state\";\nimport {\n  branchForPathState,\n  RepoBranches,\n  repoBranchesState,\n} from \"./Branches/branches.state\";\n\n/**\n * Repo root of the file opened in the active editor tab.\n */\nexport const activeFileRepoRootState = selector({\n  key: \"vcs/activeFileRepo\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    const activeFileRepo = activeFile && get(vcsRootForFile(activeFile));\n    return activeFileRepo ?? get(vcsRootsState)[0]?.dir;\n  },\n});\n\n/**\n * Branches of the repository of the file opened in the active editor tab.\n */\nexport const activeFileRepoBranchesState = selector<RepoBranches>({\n  key: \"vcs/activeFileRepoBranches\",\n  get: ({ get }) => {\n    const activeFileRepoRoot = get(activeFileRepoRootState);\n    return get(repoBranchesState(activeFileRepoRoot));\n  },\n});\n\n/**\n * Current branch of the file opened in the active editor tab.\n */\nexport const activeFileCurrentBranchState = selector({\n  key: \"vcs/activeFileCurrentBranch\",\n  get: ({ get }) => {\n    const activeFile = get(activeEditorTabState)?.filePath;\n    return activeFile ? branchForPathState(activeFile) : null;\n  },\n});\n\n/**\n * HEAD of the repository of the file opened in the active editor tab.\n * This can be evolved in future to become a \"state\" property on repositories. Right now we only keep repo root\n * in vcsRootsState. It can be changed to keep more properties of the repo, like state (NORMAL, DETACHED, MERGING,\n * REBASING, ...). Alternatively, repo state can be kept in a different piece of state mapped from vcsRootsState.\n */\nexport const activeFileRepoHeadState = selector({\n  key: \"vcs/activeFileRepoHead\",\n  get: async ({ get }) => {\n    const branch = get(activeFileCurrentBranchState);\n    if (branch) {\n      return {\n        detached: false,\n        head: branch,\n      };\n    }\n    const repoRoot = get(activeFileRepoRootState);\n    return {\n      // maybe HEAD can be pointing to refs other than branches, and in that case it's probably not true to say\n      // head is detached?\n      detached: true,\n      head: await resolveRef({ fs, dir: repoRoot, ref: \"HEAD\" }),\n    };\n  },\n});\n","import React from \"react\";\nimport { RepoBranches } from \"./branches.state\";\n\nexport type BranchNameError = \"EXISTING\" | \"CLASHING_WITH_REMOTE\";\n\nexport function validateBranchName(\n  branches: RepoBranches,\n  newBranchName: string\n): BranchNameError | null {\n  if (\n    branches.remoteBranches.some(\n      (remoteBranch) =>\n        `${remoteBranch.remote}/${remoteBranch.name}` === newBranchName\n    )\n  ) {\n    return \"CLASHING_WITH_REMOTE\";\n  }\n  if (branches.localBranches.some(({ name }) => name === newBranchName)) {\n    return \"EXISTING\";\n  }\n  return null;\n}\n\n// Almost borrowed from GitRefNameValidator\nconst ILLEGAL_CHARS_PATTERN = new RegExp(\n  \"(^\\\\.)|\" + // begins with a dot\n    \"(^-)|\" + // begins with '-'\n    \"(^/)|\" + // begins with '/'\n    \"(\\\\.\\\\.)+|\" + // two dots in a row\n    \"[ ~:^?*\\\\[\\\\\\\\]+|(@\\\\{)+|\" + // contains invalid character: space, one of ~:^?*[\\ or @{ sequence)\n    `[${Array(32)\n      .fill(null)\n      .map((_, index) => String.fromCharCode(index))\n      .join(\"\")}u007F]`\n);\n\nexport function cleanUpBranchName(branchName: string) {\n  return branchName.replace(ILLEGAL_CHARS_PATTERN, \"_\");\n}\n","import {\n  Button,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\nimport { useRecoilValue } from \"recoil\";\nimport { repoBranchesState, useRenameBranch } from \"./branches.state\";\n\nconst StyledContainer = styled.div`\n  padding: 0.5rem 1rem;\n`;\nconst StyledInputField = styled(InputField)`\n  width: 100%;\n`;\n\nexport const ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists <br />\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function RenameBranchWindow({\n  branchName,\n  repoRoot,\n  close,\n}: {\n  branchName: string;\n  repoRoot: string;\n  close: () => void;\n}) {\n  const [newBranchName, setNewBranchName] = useState(branchName);\n  const [touched, setTouched] = useState(false);\n  const balloonManager = useBalloonManager();\n  const branches = useRecoilValue(repoBranchesState(repoRoot));\n  const renameBranch = useRenameBranch();\n\n  const error = validateBranchName(branches, newBranchName);\n  const validationState = error && touched ? \"error\" : \"valid\";\n\n  const onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (!error) {\n      renameBranch(branches.repoRoot, branchName, newBranchName)\n        .catch((e) => {\n          balloonManager.show({\n            icon: \"Error\",\n            title: \"Unexpected error\",\n            body: `Could not rename branch ${branchName} to ${newBranchName}.`,\n          });\n          console.error(\"Branch rename error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setTouched(true);\n    }\n  };\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header={`Rename branch ${branchName}`}\n        content={\n          <StyledContainer>\n            <form id=\"branch_rename_form\" onSubmit={onSubmit}>\n              <StyledInputField\n                labelPlacement=\"above\"\n                label=\"New branch name:\"\n                value={newBranchName}\n                onChange={(newValue) => {\n                  setNewBranchName(cleanUpBranchName(newValue));\n                  setTouched(true);\n                }}\n                validationState={validationState}\n                validationMessage={\n                  error && validationState === \"error\"\n                    ? ErrorMessages[error]?.(branchName)\n                    : undefined\n                }\n              />\n            </form>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"branch_rename_form\"\n                  isDisabled={Boolean(error) && touched}\n                >\n                  Rename\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import path from \"path\";\nimport React, { useState } from \"react\";\nimport {\n  IconButton,\n  Toolbar,\n  ActionTooltip,\n  BalloonActionLink,\n  Bounds,\n  Divider,\n  Item,\n  ItemLayout,\n  MenuItemLayout,\n  PlatformIcon,\n  Popup,\n  PopupLayout,\n  Section,\n  SpeedSearchMenu,\n  styled,\n  TooltipTrigger,\n  useAction,\n  useBalloonManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport {\n  allBranchesState,\n  useCheckoutBranch,\n  useDeleteBranch,\n  useFavoriteBranches,\n} from \"./branches.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { atom, useRecoilState } from \"recoil\";\nimport { RenameBranchWindow } from \"./RenameBranchWindow\";\nimport { Errors } from \"isomorphic-git\";\nimport { BranchFavoriteButton } from \"./BranchFavoriteButton\";\n\nconst StyledHeader = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.375rem;\n  display: flex;\n  align-items: center;\n  width: 100%;\n`;\nconst StyledTitle = styled.div`\n  flex: 1;\n  text-align: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0 0.625rem;\n`;\n\nexport const branchesPopupSizeState = atom<\n  | {\n      width: number;\n      height: number;\n    }\n  | undefined\n>({\n  key: \"branchesPopup.bounds\",\n  default: undefined,\n});\n\nexport function BranchesPopup({ close }: { close: () => void }) {\n  const [repoBranches] = useLatestRecoilValue(allBranchesState);\n  const [branchesPopupPersistedSize, setBranchesPopupPersistedSize] =\n    useRecoilState(branchesPopupSizeState);\n  const [branchesPopupBounds, setBranchesPopupBounds] = useState<\n    Partial<Bounds>\n  >(branchesPopupPersistedSize ?? {});\n\n  const newBranchAction = useAction(VcsActionIds.GIT_CREATE_NEW_BRANCH);\n  const deleteBranch = useDeleteBranch();\n  const balloonManager = useBalloonManager();\n  const windowManager = useWindowManager();\n  const checkoutBranch = useCheckoutBranch();\n\n  // useRefreshRecoilValueOnMount(allBranchesState);\n\n  const { isFavorite, toggleFavorite } = useFavoriteBranches();\n\n  if (!repoBranches) {\n    return null;\n  }\n  const title =\n    repoBranches.length === 1\n      ? `Git Branches in ${path.basename(repoBranches[0].repoRoot)}`\n      : \"Git Branches\";\n  return (\n    <Popup\n      interactions=\"all\"\n      minHeight={55}\n      minWidth={300}\n      bounds={branchesPopupBounds}\n      onBoundsChange={(bounds, interactionType) => {\n        if (interactionType === \"resize\") {\n          setBranchesPopupPersistedSize({\n            width: bounds.width,\n            height: bounds.height,\n          });\n        }\n        setBranchesPopupBounds(bounds);\n      }}\n    >\n      <PopupLayout\n        header={\n          <Popup.Header hasControls>\n            <StyledHeader>\n              <StyledTitle>{title}</StyledTitle>\n              <Toolbar>\n                <TooltipTrigger tooltip={<ActionTooltip actionName=\"Fetch\" />}>\n                  <IconButton\n                    onPress={() => {\n                      notImplemented();\n                      close();\n                    }}\n                  >\n                    <PlatformIcon icon=\"vcs/fetch.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Restore Popup Size\" />}\n                >\n                  <IconButton\n                    isDisabled={branchesPopupPersistedSize === undefined}\n                    onPress={() => {\n                      setBranchesPopupPersistedSize(undefined);\n                      setBranchesPopupBounds(\n                        ({ width, height, ...currentBounds }) => ({\n                          ...currentBounds,\n                        })\n                      );\n                    }}\n                  >\n                    <PlatformIcon icon=\"general/fitContent.svg\" />\n                  </IconButton>\n                </TooltipTrigger>\n              </Toolbar>\n            </StyledHeader>\n          </Popup.Header>\n        }\n        content={\n          <SpeedSearchMenu\n            aria-label={title}\n            submenuBehavior=\"toggleOnPress\"\n            fillAvailableSpace\n            autoFocus=\"first\"\n            disabledKeys={repoBranches.flatMap(({ localBranches, repoRoot }) =>\n              localBranches\n                .filter(({ trackingBranch }) => !trackingBranch)\n                .map(({ name }) => `${repoRoot}/pull-${name}`)\n            )}\n            onAction={(key) => {\n              const [repoRoot, branch, operation] = `${key}`.split(\"//\");\n\n              async function tryCheckout(checkout: () => Promise<unknown>) {\n                try {\n                  await checkout();\n                  // TODO: show toolwindow balloon, when/if git toolwindow is added\n                } catch (e) {\n                  if (e instanceof Errors.CheckoutConflictError) {\n                    // TODO: open Git Checkout Problem window.\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Git Checkout Problem\",\n                      body: e.message,\n                    });\n                  } else {\n                    balloonManager.show({\n                      icon: \"Error\",\n                      title: \"Checkout failed\",\n                      body: `Could not checkout branch ${branch}`,\n                    });\n                  }\n                }\n              }\n\n              function checkoutLocalBranch() {\n                return tryCheckout(() => checkoutBranch(repoRoot, branch));\n              }\n\n              function checkoutRemoteBranch() {\n                const remoteBranch = repoBranches\n                  ?.find(({ repoRoot: aRepoRoot }) => aRepoRoot === repoRoot)\n                  ?.remoteBranches.find(\n                    ({ name, remote }) => `${remote}/${name}` === branch\n                  );\n                if (remoteBranch) {\n                  return tryCheckout(() =>\n                    checkoutBranch(\n                      repoRoot,\n                      remoteBranch.name,\n                      remoteBranch.remote\n                    )\n                  );\n                }\n              }\n\n              switch (key) {\n                case newBranchAction?.id:\n                  return newBranchAction?.perform();\n                default:\n                  switch (operation) {\n                    case \"delete\":\n                      return deleteBranch(repoRoot, branch).then(\n                        () => {\n                          balloonManager.show({\n                            title: `Deleted branch: ${branch}`,\n                            icon: \"Info\",\n                            actions: (\n                              <BalloonActionLink onPress={notImplemented}>\n                                Restore\n                              </BalloonActionLink>\n                            ),\n                          });\n                        },\n                        () => {\n                          balloonManager.show({\n                            title: `Could not deleted branch: ${branch}`,\n                            icon: \"Error\",\n                          });\n                        }\n                      );\n                    case \"rename\":\n                      return windowManager.open(({ close }) => (\n                        <RenameBranchWindow\n                          repoRoot={repoRoot}\n                          branchName={branch}\n                          close={close}\n                        />\n                      ));\n                    case \"checkout\":\n                      return checkoutLocalBranch();\n                    case \"remote-checkout\":\n                      return checkoutRemoteBranch();\n                    default:\n                      return notImplemented();\n                  }\n              }\n            }}\n            onClose={close}\n          >\n            {newBranchAction && (\n              <Item key={newBranchAction.id} textValue={newBranchAction.title}>\n                <MenuItemLayout\n                  icon={newBranchAction.icon}\n                  content={newBranchAction.title}\n                />\n              </Item>\n            )}\n            <Item key=\"checkout_revision\">Checkout Tag or Revision...</Item>\n            {\n              repoBranches.flatMap(\n                ({\n                  remoteBranches,\n                  localBranches,\n                  repoRoot,\n                  currentBranch,\n                }) => {\n                  const getSectionLabel = (label: string, repoRoot: string) =>\n                    repoBranches.length > 1\n                      ? `${label} in ${path.basename(repoRoot)}`\n                      : label;\n                  const compareActions = (\n                    branchName: string,\n                    isCurrent: boolean\n                  ) => [\n                    !isCurrent && (\n                      <Item\n                        key={`${repoRoot}//${branchName}//compare-with-branch`}\n                      >{`Compare with '${branchName}'`}</Item>\n                    ),\n                    <Item\n                      key={`${repoRoot}//${branchName}//show-diff-with-working-tree`}\n                    >\n                      Show Diff with Working Tree\n                    </Item>,\n                    <Divider key=\"compare-actions-divider\" />,\n                  ];\n                  const mergeActions = (\n                    branchName: string,\n                    currentBranch: string | undefined\n                  ) =>\n                    currentBranch &&\n                    branchName !== currentBranch && [\n                      <Item\n                        key={`${repoRoot}//${branchName}//rebase-current-onto`}\n                      >{`Rebase '${currentBranch}' onto '${branchName}'`}</Item>,\n                      <Item\n                        key={`${repoRoot}//${branchName}//merge-into-current`}\n                      >{`Merge '${branchName}' onto '${currentBranch}'`}</Item>,\n                      <Divider key=\"merge-actions-divider\" />,\n                    ];\n\n                  return [\n                    <Section\n                      key={`${repoRoot}//local_branches`}\n                      title={getSectionLabel(\"Local Branches\", repoRoot)}\n                    >\n                      {localBranches.map(({ name, trackingBranch }) => {\n                        const isCurrent = name === currentBranch?.name;\n                        const favoriteBranchArgs = {\n                          branchName: name,\n                          branchType: \"LOCAL\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${name}`}\n                            textValue={name}\n                            title={\n                              <MenuItemLayout\n                                content={name}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    isCurrent={isCurrent}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                                shortcut={\n                                  trackingBranch && (\n                                    <ItemLayout.Hint small>\n                                      {trackingBranch}\n                                    </ItemLayout.Hint>\n                                  )\n                                }\n                              />\n                            }\n                          >\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//checkout`}>\n                                Checkout\n                              </Item>\n                            )}\n                            <Item\n                              key={`${repoRoot}//${name}//new-branch-from`}\n                            >{`New Branch from '${name}'...`}</Item>\n                            {!isCurrent && (\n                              <Item\n                                key={`${repoRoot}//${name}//checkout-and-rebase-onto`}\n                              >{`Checkout and rebase onto '${name}'`}</Item>\n                            )}\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(name, isCurrent)}\n                            {mergeActions(name, currentBranch?.name)}\n                            <Item key={`${repoRoot}//${name}//pull`}>\n                              Update\n                            </Item>\n                            <Item key={`${repoRoot}//${name}//push`}>\n                              Push...\n                            </Item>\n                            <Divider key=\"push-divider\" />\n                            <Item key={`${repoRoot}//${name}//rename`}>\n                              Rename...\n                            </Item>\n                            {!isCurrent && (\n                              <Item key={`${repoRoot}//${name}//delete`}>\n                                Delete\n                              </Item>\n                            )}\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                    <Section\n                      key={`${repoRoot}//remote_branches`}\n                      title={getSectionLabel(\"Remote Branches\", repoRoot)}\n                    >\n                      {remoteBranches.map((branch) => {\n                        const branchName = `${branch.remote}/${branch.name}`;\n                        const favoriteBranchArgs = {\n                          branchName,\n                          branchType: \"REMOTE\",\n                          repoRoot,\n                        } as const;\n                        return (\n                          <Item\n                            key={`${repoRoot}//${branchName}`}\n                            textValue={branchName}\n                            title={\n                              <MenuItemLayout\n                                content={branchName}\n                                icon={\n                                  <BranchFavoriteButton\n                                    isFavorite={isFavorite(favoriteBranchArgs)}\n                                    onClick={() => {\n                                      toggleFavorite(favoriteBranchArgs);\n                                    }}\n                                  />\n                                }\n                              />\n                            }\n                          >\n                            <Item\n                              key={`${repoRoot}//${branchName}//remote-checkout`}\n                            >\n                              Checkout\n                            </Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//new-branch-from`}\n                            >{`New Branch from '${branchName}'...`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//checkout-and-rebase-onto`}\n                            >{`Checkout and rebase onto '${branchName}'`}</Item>\n                            <Divider key=\"new-branch-actions-divider\" />\n                            {compareActions(branchName, false)}\n                            {mergeActions(branchName, currentBranch?.name)}\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-merge`}\n                            >{`Pull into '${branchName}' Using Merge`}</Item>\n                            <Item\n                              key={`${repoRoot}//${branchName}//pull-into-using-rebase`}\n                            >{`Pull into '${branchName}' Using Rebase`}</Item>\n                            <Divider />\n                            <Item key={`${repoRoot}//${branchName}//delete`}>\n                              Delete\n                            </Item>\n                          </Item>\n                        );\n                      })}\n                    </Section>,\n                  ];\n                }\n              ) as any\n            }\n          </SpeedSearchMenu>\n        }\n      />\n    </Popup>\n  );\n}\n","import {\n  BalloonActionLink,\n  PlatformIcon,\n  useBalloonManager,\n  usePerformAction,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"./file-status.state\";\n\nlet notified = false;\nexport const useShowGitTipIfNeeded = () => {\n  const balloonManager = useBalloonManager();\n  const vcsRoots = useRecoilValue(vcsRootsState);\n  const performAction = usePerformAction();\n\n  return useRecoilCallback(\n    ({ reset }) =>\n      async () => {\n        if (vcsRoots.length < 2 && !notified) {\n          notified = true;\n          balloonManager.showSticky({\n            title: \"Clone another repository\",\n            icon: <PlatformIcon icon=\"actions/quickfixOffBulb.svg\" />,\n            body: \"Git integration in the example app supports multiple repos within the same project. See it in action by cloning another repo\",\n            actions: (\n              <>\n                <BalloonActionLink\n                  onPress={() => {\n                    performAction(\"ExampleApp.cloneExampleRepo\");\n                  }}\n                >\n                  Clone another repo\n                </BalloonActionLink>\n              </>\n            ),\n          });\n        }\n      },\n    []\n  );\n};\n","import {\n  ActionTooltip,\n  PlatformIcon,\n  PopupTrigger,\n  StatusBarWidget,\n  TooltipTrigger,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\n\nimport { activeFileRepoHeadState } from \"../VersionControl/active-file.state\";\nimport { useLatestRecoilValue } from \"../recoil-utils\";\nimport { BranchesPopup } from \"../VersionControl/Branches/BranchesPopup\";\nimport { useShowGitTipIfNeeded } from \"../VersionControl/useShowGitTipIfNeeded\";\n\nexport function BranchPopupTrigger() {\n  const [gitRepoHead] = useLatestRecoilValue(activeFileRepoHeadState);\n  const maybeShowGitCloneTip = useShowGitTipIfNeeded();\n\n  return (\n    gitRepoHead && (\n      <PopupTrigger\n        placement=\"top\"\n        onOpenChange={(isOpen) => {\n          if (!isOpen) {\n            setTimeout(maybeShowGitCloneTip, 500);\n          }\n        }}\n        popup={({ close }) => <BranchesPopup close={close} />}\n      >\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={\n                gitRepoHead.detached\n                  ? \"Git: Detached HEAD doesn't point to any branch\"\n                  : `Git Branch: ${gitRepoHead.head}`\n              }\n            />\n          }\n        >\n          <StatusBarWidget\n            icon={\n              <PlatformIcon\n                icon={\n                  gitRepoHead.detached\n                    ? \"general/warning.svg\"\n                    : \"vcs/branch.svg\"\n                }\n              />\n            }\n            label={gitRepoHead.head.slice(\n              0,\n              gitRepoHead.detached ? 8 : undefined\n            )}\n          />\n        </TooltipTrigger>\n      </PopupTrigger>\n    )\n  );\n}\n","import React from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport {\n  Divider,\n  Item,\n  Menu,\n  MenuItemLayout,\n  MenuTrigger,\n  PlatformIcon,\n  StatusBar,\n  StatusBarWidget,\n} from \"@intellij-platform/core\";\n\nimport { editorCursorPositionState } from \"../Editor/editor.state\";\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { StatusBarTaskProgressBar } from \"./StatusBarTaskProgressBar\";\nimport { BranchPopupTrigger } from \"./BranchPopupTrigger\";\n\nconst StyledLastMessage = styled.div`\n  margin-left: 0.75rem;\n  cursor: pointer;\n`;\nexport const IdeStatusBar = () => {\n  const cursorPosition = useRecoilValue(editorCursorPositionState);\n\n  return (\n    <StatusBar\n      left={\n        <>\n          <PlatformIcon\n            icon=\"general/tbHidden.svg\"\n            role=\"button\"\n            onClick={notImplemented}\n          />\n          <StyledLastMessage>\n            Tooltip content or last message will show up here.\n          </StyledLastMessage>\n        </>\n      }\n      right={\n        <>\n          {<StatusBarTaskProgressBar />}\n          <StatusBarWidget onPress={notImplemented} label=\"LF\" />\n          <StatusBarWidget\n            onPress={notImplemented}\n            label={`${cursorPosition.lineNumber},${cursorPosition.column}`}\n          />\n          <StatusBarWidget label=\"UTF-8\" />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item>Configure Indents for Typescript</Item>\n                <Item>Disable Indents Detection for Project</Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"2 spaces\" />\n            )}\n          </MenuTrigger>\n          <MenuTrigger\n            renderMenu={({ menuProps }) => (\n              <Menu {...menuProps} onAction={notImplemented}>\n                <Item title=\"Compile\">\n                  <Item>packages/jui/tsconfig.json</Item>\n                  <Item>packages/jui/src/StatusBar/StatusBar.stories.tsx</Item>\n                  <Item>Compile All</Item>\n                </Item>\n                <Divider />\n                <Item>\n                  <MenuItemLayout\n                    icon={\n                      <PlatformIcon icon=\"javaee/updateRunningApplication.svg\" />\n                    }\n                    content=\"Restart Typescript Service\"\n                  />\n                </Item>\n                <Item>\n                  <MenuItemLayout\n                    icon={<PlatformIcon icon=\"general/settings.svg\" />}\n                    content=\"Configure Typescript...\"\n                  />\n                </Item>\n              </Menu>\n            )}\n          >\n            {(props, ref) => (\n              <StatusBarWidget {...props} ref={ref} label=\"TypeScript 4.4.3\" />\n            )}\n          </MenuTrigger>\n          <BranchPopupTrigger />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/readwrite.svg\" />} />\n          <StatusBarWidget icon={<PlatformIcon icon=\"ide/fatalError.svg\" />} />\n        </>\n      }\n    />\n  );\n};\n","import {\n  Item,\n  Menu,\n  MenuItemLayout,\n  PlatformIcon,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const RollbackTreeContextMenu = () => {\n  const disabledKeys = [\"showDiff\"];\n\n  return (\n    <Menu\n      disabledKeys={disabledKeys}\n      aria-label=\"Context menu\"\n      onAction={notImplemented}\n    >\n      <Item key=\"showDiff\" textValue=\"Show Diff\">\n        <MenuItemLayout\n          icon={<PlatformIcon icon={\"actions/diff.svg\"} />}\n          content=\"Show Diff\"\n        />\n      </Item>\n    </Menu>\n  );\n};\n","import React, { Key, useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Selection } from \"@react-types/shared\";\nimport {\n  IconButton,\n  IconButtonWithMenu,\n  ActionsProvider,\n  Toolbar,\n  Button,\n  Checkbox,\n  CommonActionId,\n  ContextMenuContainer,\n  Item,\n  Menu,\n  ModalWindow,\n  PlatformIcon,\n  Section,\n  SpeedSearchTreeWithCheckboxes,\n  styled,\n  TreeNodeCheckbox,\n  TreeRefValue,\n  useBalloonManager,\n  useNestedSelectionState,\n  useTreeActions,\n  WindowLayout,\n  ActionButton,\n} from \"@intellij-platform/core\";\n\nimport {\n  changesTreeNodesState,\n  ChangesViewTreeNode,\n} from \"../ChangesView/ChangesView.state\";\nimport { rollbackViewState } from \"./rollbackView.state\";\nimport { ChangesSummary } from \"../ChangesSummary\";\nimport { defaultChangeGroupings } from \"../ChangesTree/changesGroupings\";\nimport { RollbackTreeContextMenu } from \"./RollbackTreeContextMenu\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\nimport {\n  getNodeKeyForChange,\n  isGroupNode,\n} from \"../ChangesTree/ChangeTreeNode\";\nimport { changesViewTreeNodeRenderer } from \"../ChangesView/changesViewTreeNodeRenderer\";\nimport { Change } from \"../Change\";\nimport { allChangesState, useRollbackChanges } from \"../changes.state\";\n\nconst StyledContainer = styled.div`\n  box-sizing: border-box;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem 0.75rem 0;\n`;\nconst StyledFrame = styled.div`\n  border: 1px solid ${({ theme }) => theme.commonColors.contrastBorder};\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledLine = styled.div`\n  &:not(:empty) {\n    line-height: 1.5;\n    padding-left: 0.375rem;\n    margin-bottom: 0.75rem;\n  }\n`;\n\nexport function RollbackWindow() {\n  const defaultExpandedKeys = useRecoilValue(\n    rollbackViewState.initiallyExpandedKeys\n  );\n  const initiallyIncludedChangeKeys = useRecoilValue(\n    rollbackViewState.initiallyIncludedChanges\n  ).map(getNodeKeyForChange);\n  const { fileCountsMap } = useRecoilValue(changesTreeNodesState);\n  const [windowBounds, setWindowBounds] = useRecoilState(\n    rollbackViewState.windowBounds\n  );\n  const rootNodes = useRecoilValue(rollbackViewState.rootNodes);\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(\n    new Set<Key>(initiallyIncludedChangeKeys.slice(0, 1))\n  );\n  const [expandedKeys, setExpandedKeys] =\n    useState<Set<Key>>(defaultExpandedKeys);\n  const [includedChangeKeys, setIncludedChangeKeys] = useState(\n    new Set<Key>(initiallyIncludedChangeKeys)\n  );\n  const nestedSelection = useNestedSelectionState<ChangesViewTreeNode>(\n    {\n      rootNodes,\n      getKey: (node) => node.key,\n      getChildren: (node) => (isGroupNode(node) ? node.children : null),\n    },\n    {\n      selectedKeys: includedChangeKeys,\n      onSelectedKeysChange: setIncludedChangeKeys,\n    }\n  );\n  const allChanges = useRecoilValue(allChangesState);\n  const includedChanges = allChanges.filter((change) =>\n    includedChangeKeys.has(getNodeKeyForChange(change))\n  );\n  const rollbackChanges = useRollbackChanges();\n  const balloons = useBalloonManager();\n  const setOpen = useSetRecoilState(rollbackViewState.isOpen);\n  const close = () => setOpen(false);\n\n  const treeRef = useRef<TreeRefValue>(null);\n  const treeActions = useTreeActions({ treeRef });\n  const [deleteAddedFiles, setDeleteAddedFiles] = useState(false);\n\n  const atLeastOneNewFileSelected = includedChanges.some(\n    (change) => change.type === \"ADDED\"\n  );\n\n  return (\n    <ModalWindow\n      onClose={close}\n      bounds={windowBounds}\n      onBoundsChange={setWindowBounds}\n      minHeight={200}\n      minWidth={275}\n    >\n      <WindowLayout\n        header=\"Rollback changes\"\n        content={\n          <ActionsProvider actions={treeActions}>\n            {({ shortcutHandlerProps }) => (\n              <StyledContainer {...shortcutHandlerProps}>\n                <div style={{ display: \"flex\" }}>\n                  <Toolbar>\n                    <IconButton isDisabled>\n                      <PlatformIcon icon=\"actions/diff\" />\n                    </IconButton>\n                    <IconButtonWithMenu\n                      renderMenu={({ menuProps }) => (\n                        <Menu\n                          {...menuProps}\n                          selectedKeys={[] /* FIXME */}\n                          // FIXME\n                          onAction={notImplemented}\n                        >\n                          <Section title=\"Group By\">\n                            {\n                              // FIXME\n                              defaultChangeGroupings.map((grouping) => (\n                                <Item key={grouping.id}>{grouping.title}</Item>\n                              ))\n                            }\n                          </Section>\n                        </Menu>\n                      )}\n                    >\n                      <PlatformIcon icon=\"actions/groupBy.svg\" />\n                    </IconButtonWithMenu>\n                  </Toolbar>\n                  <span style={{ flex: 1 }} />\n                  <Toolbar>\n                    <ActionButton actionId={CommonActionId.EXPAND_ALL} />\n                    <ActionButton actionId={CommonActionId.COLLAPSE_ALL} />\n                  </Toolbar>\n                </div>\n\n                <StyledFrame>\n                  <ContextMenuContainer\n                    renderMenu={() => <RollbackTreeContextMenu />}\n                    style={{ height: \"100%\" }}\n                  >\n                    <SpeedSearchTreeWithCheckboxes\n                      treeRef={treeRef}\n                      items={rootNodes}\n                      selectionMode=\"multiple\"\n                      selectedKeys={selectedKeys}\n                      onSelectionChange={setSelectedKeys}\n                      expandedKeys={expandedKeys}\n                      onExpandedChange={setExpandedKeys}\n                      nestedSelection={nestedSelection}\n                      fillAvailableSpace\n                    >\n                      {(node) => {\n                        const props = changesViewTreeNodeRenderer.getItemProps({\n                          node,\n                          fileCountsMap,\n                        });\n                        return (\n                          <Item {...props}>\n                            {node.children?.length !== 0 && (\n                              <TreeNodeCheckbox\n                                selectionState={nestedSelection.getSelectionState(\n                                  node\n                                )}\n                                onToggle={() => nestedSelection.toggle(node)}\n                              />\n                            )}\n                            {props.children}\n                          </Item>\n                        );\n                      }}\n                    </SpeedSearchTreeWithCheckboxes>\n                  </ContextMenuContainer>\n                </StyledFrame>\n              </StyledContainer>\n            )}\n          </ActionsProvider>\n        }\n        footer={\n          <>\n            <div\n              style={{\n                padding: \".5rem 0.75rem 0\",\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <StyledLine>\n                <ChangesSummary changes={includedChanges} />\n              </StyledLine>\n              <Checkbox\n                isDisabled={!atLeastOneNewFileSelected}\n                isSelected={deleteAddedFiles}\n                onChange={setDeleteAddedFiles}\n                mnemonic=\"D\"\n              >\n                Delete local copies of the added files\n              </Checkbox>\n            </div>\n            <WindowLayout.Footer\n              right={\n                <>\n                  <Button onPress={close} mnemonic=\"C\">\n                    Close\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    mnemonic=\"R\"\n                    isDisabled={includedChanges.length === 0}\n                    onPress={() => {\n                      rollbackChanges(includedChanges, deleteAddedFiles)\n                        .catch((e) => {\n                          balloons.show({\n                            title: \"Reverting changes failed\",\n                            icon: \"Error\",\n                            body: \"Could not revert selected changes. See console for more info\",\n                          });\n                          console.error(\"Git revert error:\", e);\n                        })\n                        .finally(close);\n                    }}\n                  >\n                    Rollback\n                  </Button>\n                </>\n              }\n            />\n          </>\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { atom } from \"recoil\";\nimport { ToolWindowsState } from \"@intellij-platform/core\";\nimport { toolWindows } from \"./toolWindows\";\n\nexport const toolWindowsState = atom({\n  key: \"toolWindows\",\n  default: new ToolWindowsState(\n    Object.fromEntries(\n      toolWindows.map(({ id, initialState }) => [id, initialState])\n    ),\n    {\n      removedFromSideBarIds: toolWindows\n        .filter(({ showStripeButton }) => showStripeButton === false)\n        .map(({ id }) => id),\n    }\n  ),\n});\n","import { useMemo, useState } from \"react\";\nimport {\n  CommonActionId,\n  shortcutToString,\n  useKeymap,\n} from \"@intellij-platform/core\";\n\nconst tips = [\n  {\n    actionId: CommonActionId.EXPAND_SELECTION,\n    title: \"Press $shortcut to expand selection\",\n  },\n  {\n    actionId: CommonActionId.SHRINK_SELECTION,\n    title: \"Press $shortcut to shrink selection\",\n  },\n];\n\nexport const useTips = () => {\n  const keymap = useKeymap();\n\n  const renderedTips = useMemo(\n    () =>\n      tips\n        .map(({ actionId, title }) => ({\n          keyboardShortcut: keymap?.[actionId]?.find(\n            (shortcut) => shortcut.type === \"keyboard\"\n          ),\n          title,\n        }))\n        .filter(({ keyboardShortcut }) => keyboardShortcut)\n        .map(({ keyboardShortcut, title }) =>\n          title.replace(\"$shortcut\", shortcutToString(keyboardShortcut!))\n        ),\n    [keymap]\n  );\n  const [index, setIndex] = useState(\n    Math.floor(Math.random() * renderedTips.length)\n  );\n  return {\n    current: renderedTips[index],\n    next: () => {\n      const tmpIndex = Math.floor(Math.random() * (renderedTips.length - 1));\n      const newIndex = tmpIndex < index ? tmpIndex : tmpIndex + 1; // making sure index will be changed\n      console.log(\"changing index to\", newIndex, \"tmpIndex\", tmpIndex);\n      setIndex(newIndex);\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport const Input = React.forwardRef(function Input(\n  props: HTMLProps<HTMLInputElement>,\n  forwardedRef: ForwardedRef<HTMLInputElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // NOTE: it's important not to pass all props to useFocusable (or not to merge returned props with ALL props), as it\n  // results for duplicate event handling, for events like onKeyDown that is handled by useFocusable too.\n  const { focusableProps } = useFocusable({ autoFocus: props.autoFocus }, ref);\n  return <input {...mergeProps(focusableProps, props)} ref={ref} />;\n});\n","import { Bounds } from \"@intellij-platform/core\";\nimport { atom, atomFamily } from \"recoil\";\n\nexport type SearchEveryWhereTab =\n  | \"All\"\n  | \"Classes\"\n  | \"Files\"\n  | \"Symbols\"\n  | \"Actions\"\n  | \"Git\";\n\nexport const searchEverywhereState = {\n  /**\n   * Whether the popup is open\n   */\n  isOpen: atom({\n    key: \"search.everywhere.isOpen\",\n    default: false,\n  }),\n  /**\n   * Currently selected tab, e.g. \"Actions\", \"Files\", etc.\n   */\n  tab: atom<string>({\n    key: \"search.everywhere.tab\",\n    default: \"All\",\n  }),\n  /**\n   * The Element of the context of the action that triggered the popup. Used to provide context to search, if needed.\n   */\n  contextElement: atom<Element>({\n    key: \"search.everywhere.contextElement\",\n    default: undefined,\n  }),\n  /**\n   * Initial search query.\n   */\n  initialSearchQuery: atomFamily<string, string>({\n    key: \"search.everywhere.initialQuery\",\n    default: \"\",\n  }),\n  /**\n   * Popup bounds\n   */\n  bounds: atom<Partial<Bounds> | null>({\n    key: \"search.everywhere.bounds\",\n    default: null,\n  }),\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { RecoilState, useSetRecoilState } from \"recoil\";\nimport { Bounds, Popup, PopupProps } from \"@intellij-platform/core\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\n/**\n * A special type of popup, where the content can be toggled on and off. Needed only for SearchEveryWhere at the moment,\n * but extracted as a component, to collocate related pieces, rather than leave them with the rest of the code in the\n * component.\n * - Updates persisted {@param boundsState}, when the bounds are changed, only if the content is shown when the bounds\n *   is changed.\n * - Minimizes the popup into {@param noContentHeight}, when {@param hasContent} is `false`.\n * - Restores the popup height to it's latest value, or based on content, when {@param hasContent} changes to `true`.\n * - Returns the right to be applied based on the input {@param minHeight} and {@param hasContent}.\n */\nexport function ContentAwarePopup({\n  hasContent,\n  persistedBoundsState,\n  noContentHeight,\n  minHeight,\n  ...otherProps\n}: {\n  /**\n   * Whether the popup has content. If `false`, the popup is minimized to `noContentHeight`.\n   */\n  hasContent: boolean;\n  /**\n   * The minimized height of the popup, when there is no content.\n   */\n  noContentHeight: number;\n  /**\n   * Persisted state of the popup bounds, in form of a recoil state.\n   */\n  persistedBoundsState: RecoilState<Partial<Bounds> | null>;\n} & Omit<PopupProps, \"bounds\" | \"onBoundsChange\">) {\n  const persistBounds = useSetRecoilState(persistedBoundsState);\n  const getInitBounds = useRecoilInitialValue(persistedBoundsState, {\n    top: 150,\n    height: Math.max(200, window.innerHeight - 300),\n  });\n\n  const [bounds, setBounds] = useState<Partial<Bounds>>(getInitBounds);\n  const heightToRestoreRef = useRef(bounds.height);\n  const onBoundsChange = (bounds: Bounds) => {\n    if (hasContent) {\n      heightToRestoreRef.current = bounds.height;\n      persistBounds(bounds);\n    }\n    setBounds(bounds);\n  };\n  useEffect(() => {\n    setBounds((bounds) => ({\n      ...bounds,\n      height: hasContent ? heightToRestoreRef.current : noContentHeight,\n    }));\n  }, [hasContent]);\n\n  return (\n    <Popup\n      {...otherProps}\n      bounds={bounds}\n      onBoundsChange={onBoundsChange}\n      minHeight={!hasContent ? noContentHeight : minHeight}\n    />\n  );\n}\n","import { ItemLayout, styled } from \"@intellij-platform/core\";\n\nexport const StyledIconWrapper = styled.span`\n  width: 0.9375rem;\n  margin-right: 0.25rem;\n  display: inline-flex;\n  justify-content: center;\n`;\nexport const StyledItemLayout = styled(ItemLayout)`\n  min-height: 1.375rem;\n  width: 100%;\n  padding: 0;\n`;\nexport const StyledTitleWrapper = styled.span<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled }) =>\n    isDisabled &&\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Action,\n  ActionGroup,\n  ItemLayout,\n  ItemStateContext,\n  TextRange,\n  TextWithHighlights,\n  isInResolvedActionGroup,\n  styled,\n} from \"@intellij-platform/core\";\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\n\nconst StyledSpacer = styled.div`\n  flex: 1;\n`;\n/**\n * UI of actions in SearchEverywhere list\n */\nexport function ActionItem({\n  action,\n  highlights,\n}: {\n  action: Action;\n  highlights: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>{action.icon}</StyledIconWrapper>\n      <StyledTitleWrapper isDisabled={action.isDisabled}>\n        {isSelected ? (\n          <TextWithHighlights highlights={highlights}>\n            {action.title}\n          </TextWithHighlights>\n        ) : (\n          action.title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint style={{ fontSize: \".85em\", fontWeight: \"bold\" }}>\n        {action.shortcut}\n      </ItemLayout.Hint>\n      <StyledSpacer />\n      <ItemLayout.Hint\n        style={{\n          marginRight:\n            \"-0.375rem\" /* to kill the default list padding on right. */,\n        }}\n      >\n        {getActionBreadcrumb(action, \"title\").join(\" | \")}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n\nfunction getActionBreadcrumb<T extends keyof ActionGroup>(\n  action: Action,\n  field: T\n): Array<ActionGroup[T]>;\nfunction getActionBreadcrumb(action: Action): Array<ActionGroup>;\nfunction getActionBreadcrumb(action: Action, field?: keyof ActionGroup) {\n  let parent = isInResolvedActionGroup(action) ? action.parent : null;\n  const breadcrumb: Array<ActionGroup | ActionGroup[keyof ActionGroup]> = [];\n  while (parent) {\n    breadcrumb.unshift(field ? parent[field] : parent);\n    parent = parent.parent;\n  }\n  return breadcrumb;\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  Action,\n  ActionDefinition,\n  ActionShortcut,\n  Checkbox,\n  CommonActionId,\n  getAvailableActionsFor,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport { searchEverywhereState } from \"../../searchEverywhere.state\";\nimport React, { useMemo, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { ActionItem } from \"./ActionItem\";\nimport { notImplemented } from \"../../../Project/notImplemented\";\n\nexport const actionsSearchContributor: SearchEverywhereContributor<{\n  action: Action;\n  highlights: TextRange[] | null;\n}> = {\n  id: \"Actions\",\n  title: \"Actions\",\n  actionId: CommonActionId.GO_TO_ACTION,\n  use: ({ everyWhereAutoSet }: { everyWhereAutoSet: boolean }) => {\n    const contextElement = useRecoilValue(searchEverywhereState.contextElement);\n    const [showDisabledActions, setShowDisabledActions] = useState<\n      null | boolean\n    >(null);\n    const allActions = useMemo(\n      () => (contextElement ? getAvailableActionsFor(contextElement) : []),\n      [contextElement]\n    );\n    const shouldIncludeDisabledActions =\n      showDisabledActions ?? everyWhereAutoSet;\n    const actions: ActionDefinition[] = [\n      {\n        id: CommonActionId.SHOW_INTENTION_ACTIONS,\n        title: \"Assign a shortcut\",\n        actionPerformed: notImplemented,\n      },\n    ];\n    return {\n      search: (query: string) => {\n        const allResults = allActions\n          .map((action) => ({\n            highlights: minusculeMatch(action.title, query),\n            action,\n          }))\n          .filter(\n            ({ action, highlights }) =>\n              highlights || minusculeMatch(action.description || \"\", query)\n          );\n        return shouldIncludeDisabledActions\n          ? allResults\n          : allResults.filter(({ action }) => !action.isDisabled);\n      },\n      searchDeps: [shouldIncludeDisabledActions],\n      isEverywhere: shouldIncludeDisabledActions,\n      // canToggleEverywhere: true, // TODO: is it needed?\n      toggleEverywhere: () => {\n        setShowDisabledActions((currentValue) => !currentValue);\n      },\n      searchAdvertiser: (\n        <ActionShortcut actionId={CommonActionId.SHOW_INTENTION_ACTIONS}>\n          {(shortcut) => `Press ${shortcut} to assign a shortcut`}\n        </ActionShortcut>\n      ),\n      headerFilters: (\n        <Checkbox\n          preventFocus\n          isSelected={shouldIncludeDisabledActions}\n          onChange={(value) => {\n            setShowDisabledActions(value);\n          }}\n        >\n          Include disabled actions\n        </Checkbox>\n      ),\n      actions,\n      processSelectedItem({ action }) {\n        action?.perform({\n          event: null,\n          element: contextElement,\n        });\n      },\n      getKey: ({ action }) => action.id,\n      getItemText({ action: { title } }: { action: Action }): string {\n        return title;\n      },\n      renderItem({\n        action,\n        highlights,\n      }: {\n        action: Action;\n        highlights: TextRange[] | null;\n      }) {\n        return <ActionItem action={action} highlights={highlights} />;\n      },\n    };\n  },\n};\n","import path from \"path\";\nimport React, { useContext } from \"react\";\nimport { splitWhen } from \"ramda\";\nimport {\n  ItemLayout,\n  ItemStateContext,\n  PlatformIcon,\n  TextRange,\n  TextWithHighlights,\n} from \"@intellij-platform/core\";\n\nimport {\n  StyledIconWrapper,\n  StyledItemLayout,\n  StyledTitleWrapper,\n} from \"../ItemHelpers\";\nimport { ProjectFsItem } from \"../../../Project/project.state\";\nimport { getIconForFile } from \"../../../file-utils\";\n\n/**\n * UI of paths in SearchEverywhere list.\n */\nexport function FileItem({\n  file,\n  matches,\n}: {\n  file: ProjectFsItem;\n  /**\n   * matches on file.relativePath\n   */\n  matches: null | TextRange[];\n}) {\n  const { isSelected } = useContext(ItemStateContext) || {};\n  const title = file.name;\n  const dir = path.dirname(file.relativePath);\n\n  const [dirMatches, filenameMatches] = splitWhen<TextRange, TextRange>(\n    (match) => match.from >= dir.length,\n    matches || []\n  );\n  const titleMatches = filenameMatches.map(({ from, to }) => ({\n    from: from - dir.length,\n    to: to - dir.length,\n  }));\n  return (\n    <StyledItemLayout>\n      <StyledIconWrapper>\n        <PlatformIcon icon={getIconForFile(file.path)} />\n      </StyledIconWrapper>\n      <StyledTitleWrapper>\n        {isSelected ? (\n          <TextWithHighlights highlights={titleMatches}>\n            {title}\n          </TextWithHighlights>\n        ) : (\n          title\n        )}\n      </StyledTitleWrapper>\n      <ItemLayout.Hint>\n        {isSelected ? (\n          <TextWithHighlights highlights={dirMatches}>{dir}</TextWithHighlights>\n        ) : (\n          dir\n        )}\n      </ItemLayout.Hint>\n    </StyledItemLayout>\n  );\n}\n","import { SearchEverywhereContributor } from \"../../SearchEverywhereContributor\";\nimport {\n  CommonActionId,\n  minusculeMatch,\n  TextRange,\n} from \"@intellij-platform/core\";\nimport React from \"react\";\nimport { useRecoilCallback } from \"recoil\";\nimport {\n  currentProjectFilesState,\n  ProjectFsItem,\n} from \"../../../Project/project.state\";\nimport { useEditorStateManager } from \"../../../Editor/editor.state\";\nimport { useSelectPathInProjectView } from \"../../../ProjectView/ProjectView.state\";\nimport { FileItem } from \"./FileItem\";\n\nexport const filesSearchContributor: SearchEverywhereContributor<{\n  file: ProjectFsItem;\n  matches: TextRange[] | null;\n}> = {\n  id: \"Files\",\n  title: \"Files\",\n  actionId: CommonActionId.GO_TO_FILE,\n  use: () => {\n    const getProjectFiles = useRecoilCallback(\n      ({ snapshot }) =>\n        () =>\n          snapshot.getLoadable(currentProjectFilesState).getValue(),\n      []\n    );\n    const { openPath } = useEditorStateManager();\n    const selectPathInProjectView = useSelectPathInProjectView();\n    return {\n      search: (query: string) =>\n        getProjectFiles()\n          .map((file) => ({\n            matches: minusculeMatch(file.relativePath, query),\n            file,\n          }))\n          .filter(({ matches }) => matches?.length),\n      searchDeps: [],\n      isEverywhere: true,\n      processSelectedItem({ file }) {\n        if (file?.type === \"file\") {\n          openPath(file.path, true);\n        }\n        if (file?.type === \"dir\") {\n          selectPathInProjectView(file.path);\n        }\n      },\n      getKey({ file }) {\n        return file.path;\n      },\n      renderItem({\n        file,\n        matches,\n      }: {\n        file: ProjectFsItem;\n        matches: TextRange[] | null;\n      }) {\n        return <FileItem file={file} matches={matches} />;\n      },\n      getItemText({ file: { relativePath } }: { file: ProjectFsItem }): string {\n        return relativePath;\n      },\n    };\n  },\n};\n","export const SearchEverywhereActionIds = {\n  PREVIOUS_TAB: \"SearchEverywhere.PrevTab\",\n  NEXT_TAB: \"SearchEverywhere.NextTab\",\n};\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useRecoilState, useSetRecoilState } from \"recoil\";\nimport {\n  IconButton,\n  ActionDefinition,\n  ActionsProvider,\n  FocusScope,\n  Item,\n  Link,\n  List,\n  PlatformIcon,\n  Popup,\n  Selection,\n  SelectionManager,\n  styled,\n  StyledTabProps,\n  Tabs,\n  Tooltip,\n  TooltipTrigger,\n  useGetActionShortcut,\n} from \"@intellij-platform/core\";\nimport { useTips } from \"./useTips\";\nimport { Input } from \"./Input\";\nimport {\n  searchEverywhereState,\n  SearchEveryWhereTab,\n} from \"./searchEverywhere.state\";\nimport { ContentAwarePopup } from \"./ContentAwarePopup\";\nimport {\n  SearchEverywhereContributor,\n  SearchEverywhereContributorResult,\n} from \"./SearchEverywhereContributor\";\nimport { actionsSearchContributor } from \"./contributors/action/actionsSearchContributor\";\nimport { filesSearchContributor } from \"./contributors/file/filesSearchContributor\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhereActionIds\";\nimport { useRecoilInitialValue } from \"../recoil-utils\";\n\nconst StyledHeader = styled.div`\n  display: flex;\n  width: 100%;\n  background: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Header.background\")};\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledTab = styled.button<StyledTabProps>`\n  all: unset;\n  background: ${({ theme, selected }) =>\n    selected && theme.color(\"SearchEverywhere.Tab.selectedBackground\")};\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.Tab.selectedForeground\")};\n  opacity: ${({ disabled }) => disabled && \".5\"};\n`;\nconst StyledTabContent = styled.span`\n  display: flex;\n  padding: 0 0.75rem;\n  height: 1.8rem;\n  align-items: center;\n`;\nconst StyledTabs = styled.div`\n  line-height: normal;\n  border-bottom: none;\n`;\nconst StyledSearchFieldContainer = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  height: 1.85rem;\n  align-items: center;\n  padding: 0 0.75rem 0;\n  gap: 0.75rem;\n\n  input {\n    all: unset;\n    flex: 1;\n    line-height: 1.25;\n\n    &::selection {\n      color: ${({ theme }) => theme.color(\"*.selectionForeground\")};\n      background: ${({ theme }) => theme.color(\"*.selectionBackground\")};\n    }\n  }\n`;\nconst StyledSearchResultsContainer = styled.div`\n  height: 24rem;\n  flex: 1;\n  min-height: 0; // for it to properly fill the remaining height and not to exceed that\n`;\nconst StyledDivider = styled.hr`\n  all: unset;\n  height: 1px;\n  width: 100%;\n  border-bottom: 1px solid\n    ${({ theme }) => theme.color(\"SearchEverywhere.SearchField.borderColor\")};\n`;\nconst StyledSearchFieldHint = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\"SearchEverywhere.SearchField.infoForeground\")};\n  white-space: nowrap;\n`;\n\nconst StyledLoadMore = styled.div`\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"SearchEverywhere.SearchField.infoForeground\")\n    )};\n  font-size: 0.7rem;\n  min-height: 1.375rem;\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  position: absolute;\n  text-align: center;\n  width: 100%;\n  top: 50%;\n`;\nconst SEARCH_RESULT_LIMIT = 30;\n\nconst contributors = [actionsSearchContributor, filesSearchContributor];\n\nconst LOAD_MORE_ITEM = {};\nconst LOAD_MORE_ITEM_KEY = \"LOAD_MORE_ITEM_KEY\";\n\n/**\n * TODO: implement history navigation\n */\nexport function SearchEverywherePopup() {\n  const setOpen = useSetRecoilState(searchEverywhereState.isOpen);\n  const [tab, setTab] = useRecoilState(searchEverywhereState.tab);\n  const [everyWhereAutoSet, setEveryWhereAutoSet] = useState(false);\n  const [pattern, setPattern] = useState(\n    useRecoilInitialValue(searchEverywhereState.initialSearchQuery(tab))\n  );\n  const persistInitialSearchQuery = useSetRecoilState(\n    searchEverywhereState.initialSearchQuery(tab)\n  );\n\n  const getShortcut = useGetActionShortcut();\n  const [selectedKeys, setSelectedKeys] = useState<Selection>(new Set());\n  const idToContributor: Record<\n    string,\n    SearchEverywhereContributorResult<{}> &\n      Omit<SearchEverywhereContributor<{}>, \"use\">\n  > = {};\n  contributors.forEach((contributor) => {\n    idToContributor[contributor.id] = {\n      ...contributor,\n      ...contributor.use({ everyWhereAutoSet }),\n    };\n  });\n\n  const activeContributors = contributors\n    .filter((contributor) => tab === \"\" || contributor.id === tab)\n    .map(({ id }) => idToContributor[id]);\n\n  const [searchResultLimit, setSearchResultLimit] =\n    useState(SEARCH_RESULT_LIMIT);\n  const { searchResult } = useMemo(() => {\n    // TODO: sort results\n    const searchResult = activeContributors.flatMap((contributor) =>\n      contributor.search(pattern).map((item) => ({\n        key: `${contributor.id}_${contributor.getKey(item)}`,\n        contributor,\n        item,\n      }))\n    );\n    return {\n      searchResult,\n    };\n  }, [\n    pattern,\n    tab,\n    ...activeContributors.flatMap(({ searchDeps }) => searchDeps),\n  ]);\n  const currentTabContributor = idToContributor[tab];\n\n  const visibleSearchResult = useMemo(() => {\n    const visibleSearchResult = searchResult.slice(0, searchResultLimit);\n    const hasMore = searchResult.length > visibleSearchResult.length;\n    if (hasMore) {\n      visibleSearchResult.push({\n        key: LOAD_MORE_ITEM_KEY,\n        item: LOAD_MORE_ITEM,\n        contributor: null!,\n      });\n    }\n    return visibleSearchResult;\n  }, [searchResultLimit, searchResult]);\n\n  const notFoundPatternRef = useRef<string | null>(null);\n\n  const onPatternChanged = (newPattern: string) => {\n    const newPatternContainsPrevious =\n      notFoundPatternRef.current &&\n      newPattern.includes(notFoundPatternRef.current);\n    // TODO: improve isEverywhere support. It should be supported it in \"All\" tabs too.\n    if (currentTabContributor?.isEverywhere && !newPatternContainsPrevious) {\n      setEveryWhereAutoSet(false);\n    }\n    setPattern(newPattern);\n  };\n\n  useEffect(() => {\n    if (pattern) {\n      persistInitialSearchQuery(pattern);\n    }\n  }, [pattern, tab]);\n\n  useEffect(() => {\n    if (searchResult[0]) {\n      // Currently, list auto selects the first item, only in first render. But not when the collection is changed.\n      // So we make sure the first item is selected, after each search. Perhaps, List should be changed instead to\n      // react to collection changes.\n      const { key } = searchResult[0];\n      setSelectedKeys(new Set([key]));\n      selectionManagerRef.current?.setFocusedKey(key);\n\n      // A workaround for a mysterious issue that happens only in docusaurus build.\n      // The ref value is not up-to-date, when the effect runs.\n      // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n      requestAnimationFrame(() => {\n        selectionManagerRef.current?.setFocusedKey(key);\n      });\n    }\n    setSearchResultLimit(SEARCH_RESULT_LIMIT);\n  }, [searchResult]);\n\n  const localActions: ActionDefinition[] = [\n    {\n      id: SearchEverywhereActionIds.PREVIOUS_TAB,\n      title: \"Prev tab\",\n      description: \"Switch to previous tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n\n        setTab(\n          tab === \"\"\n            ? contributors.slice(-1)[0].id\n            : contributors[currentContributorIndex - 1]?.id || \"\"\n        );\n      },\n    },\n    {\n      id: SearchEverywhereActionIds.NEXT_TAB,\n      title: \"Next tab\",\n      description: \"Switch to next tab in Search Everywhere dialog\",\n      actionPerformed: () => {\n        const currentContributorIndex = contributors.findIndex(\n          ({ id }) => tab === id\n        );\n        setTab(contributors[currentContributorIndex + 1]?.id || \"\");\n      },\n    },\n  ];\n  const contributorActions = contributors.flatMap(({ id, actionId, title }) => {\n    return actionId\n      ? [\n          {\n            id: actionId,\n            title: `Find ${title}`,\n            description: `Quickly go to ${title} by name`,\n            actionPerformed: () => {\n              if (tab !== id) {\n                setTab(id);\n              } else {\n                currentTabContributor?.toggleEverywhere?.();\n              }\n            },\n          },\n        ]\n      : [];\n  });\n\n  const close = () => setOpen(false);\n\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const selectionManagerRef = useRef<SelectionManager>(null);\n  const onAction = (key: React.Key) => {\n    if (key === LOAD_MORE_ITEM_KEY) {\n      setSearchResultLimit((limit) => limit + SEARCH_RESULT_LIMIT);\n      const nextItem = searchResult[visibleSearchResult.length + 1];\n      if (nextItem) {\n        // nextItem is expected to always have value\n\n        // Timeout needed to let the item get rendered first. Could be done in an effect instead,\n        // if we want to avoid setTimeout\n        setTimeout(() => {\n          setSelectedKeys(new Set([nextItem.key]));\n          selectionManagerRef.current?.setFocusedKey(nextItem.key);\n        });\n      }\n    } else {\n      close();\n      // Making sure the popup is fully closed before the new action is performed. One edge case that can\n      // make a difference is actions like FindAction that open the same popup. By performing an action\n      // async, we make sure the popup is closed and reopened, which is good, because otherwise, the user\n      // won't get any feedback when choosing such actions.\n      setTimeout(() => {\n        const itemWrapper = searchResult.find((item) => item.key === key);\n        itemWrapper?.contributor.processSelectedItem(itemWrapper.item);\n        /**\n         * The 50ms timeout is a workaround for an issue in FocusScope:\n         * restoreFocus only works if the previously focused element is in the dom, when the focus\n         * scope is unmounted. In case of SearchEveryWhere, actions like \"Rollback\" open a modal\n         * window, which has a focus scope, when the window is opened, the currently focused\n         * element (which will be the one to restore focus to), is search everywhere dialog, which\n         * is immediately closed. So when the modal window is closed, it tries to move focus back\n         * to search everywhere dialog, which is long gone! It would be nice if FocusScope could\n         * track a chain of nodes to restore focus to.\n         * With this 50ms timeout, focus is first restored to where it was, after SearchEveryWhere\n         * is closed, and then the actions is performed, for focus restoration to work.\n         */\n      }, 50);\n    }\n  };\n\n  const tips = useTips();\n  return (\n    <ContentAwarePopup\n      persistedBoundsState={searchEverywhereState.bounds}\n      hasContent={Boolean(pattern)}\n      noContentHeight={59}\n      minWidth={670}\n      minHeight={160}\n      interactions=\"all\"\n      onClose={close}\n    >\n      <ActionsProvider\n        actions={[\n          ...(currentTabContributor?.actions || []),\n          ...contributorActions,\n          ...localActions,\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <div {...shortcutHandlerProps} style={{ height: \"inherit\" }}>\n            <Popup.Layout\n              header={\n                <>\n                  <Popup.Header hasControls>\n                    <StyledHeader>\n                      <div style={{ flex: 1 }}>\n                        <Tabs\n                          TabComponent={StyledTab}\n                          TabsComponent={StyledTabs}\n                          selectedKey={tab}\n                          onSelectionChange={(key) =>\n                            setTab(key as SearchEveryWhereTab)\n                          }\n                        >\n                          <Item key=\"\">\n                            <StyledTabContent>All</StyledTabContent>\n                          </Item>\n                          {\n                            contributors.map((contributor) => {\n                              const shortcut = getShortcut(\n                                contributor.actionId\n                              );\n                              const title = (\n                                <StyledTabContent>\n                                  {contributor.title}\n                                </StyledTabContent>\n                              );\n                              return (\n                                <Item key={contributor.id}>\n                                  {shortcut ? (\n                                    <TooltipTrigger\n                                      tooltip={<Tooltip>{shortcut}</Tooltip>}\n                                    >\n                                      {/* Span needed for tooltip to work, in the current implementation of tooltip */}\n                                      <span>{title}</span>\n                                    </TooltipTrigger>\n                                  ) : (\n                                    title\n                                  )}\n                                </Item>\n                              );\n                            }) as any /*when a static Item is rendered before this array, it wrongly complains about the type*/\n                          }\n                        </Tabs>\n                      </div>\n                      {currentTabContributor?.headerFilters}\n                      <IconButton style={{ margin: \"0 0.5rem\" }} isDisabled>\n                        <PlatformIcon icon=\"actions/moveToLeftBottom\" />\n                      </IconButton>\n                    </StyledHeader>\n                  </Popup.Header>\n                  <StyledSearchFieldContainer>\n                    <PlatformIcon icon=\"actions/search\" />\n                    <FocusScope contain>\n                      <Input\n                        ref={searchInputRef}\n                        autoFocus\n                        onFocus={(event) => {\n                          event.target.select();\n                        }}\n                        value={pattern}\n                        onChange={(e) =>\n                          onPatternChanged(e.currentTarget.value)\n                        }\n                      />\n                    </FocusScope>\n                    <StyledSearchFieldHint>\n                      {currentTabContributor?.searchAdvertiser}\n                    </StyledSearchFieldHint>\n                  </StyledSearchFieldContainer>\n                </>\n              }\n              content={\n                <>\n                  <StyledDivider />\n                  {pattern && (\n                    <StyledSearchResultsContainer>\n                      <List\n                        focusProxyRef={searchInputRef}\n                        selectionManagerRef={selectionManagerRef}\n                        items={visibleSearchResult}\n                        selectionMode=\"single\"\n                        showAsFocused\n                        shouldFocusWrap\n                        fillAvailableSpace\n                        selectedKeys={selectedKeys}\n                        onSelectionChange={setSelectedKeys}\n                        onAction={onAction}\n                      >\n                        {({ key, item, contributor }) => {\n                          if (key === LOAD_MORE_ITEM_KEY) {\n                            return (\n                              <Item key={LOAD_MORE_ITEM_KEY}>\n                                <StyledLoadMore>...more</StyledLoadMore>\n                              </Item>\n                            );\n                          }\n                          const itemText = contributor.getItemText(item);\n                          return (\n                            <Item\n                              key={key}\n                              textValue={itemText}\n                              aria-label={itemText}\n                            >\n                              {contributor.renderItem(item)}\n                            </Item>\n                          );\n                        }}\n                      </List>\n                      {searchResult.length === 0 && (\n                        <StyledPlaceholder>\n                          No actions with such name found\n                        </StyledPlaceholder>\n                      )}\n                    </StyledSearchResultsContainer>\n                  )}\n                </>\n              }\n              footer={\n                <Popup.Hint>\n                  {tips.current} <Link onPress={tips.next}>Next Tip</Link>\n                </Popup.Hint>\n              }\n            />\n          </div>\n        )}\n      </ActionsProvider>\n    </ContentAwarePopup>\n  );\n}\n","import { CallbackInterface } from \"recoil\";\nimport { refreshFileStatusCallback } from \"./file-status.state\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../fs/fs\";\nimport path from \"path\";\n\nexport const gitAddCallback =\n  (callbackInterface: CallbackInterface) => async (filepath: string) => {\n    const refreshFileStatus = refreshFileStatusCallback(callbackInterface);\n    const dir = await git.findRoot({ fs, filepath });\n    await git.add({ fs, dir, filepath: path.relative(dir, filepath) });\n    await refreshFileStatus(filepath);\n  };\n","import {\n  Input,\n  Popup,\n  PopupLayout,\n  PositionedTooltipTrigger,\n  styled,\n  ValidationTooltip,\n} from \"@intellij-platform/core\";\nimport React, { ChangeEvent, useState } from \"react\";\n\nconst StyledInput = styled(Input)`\n  width: 20.5rem;\n  /**\n     * To have the validation box shadow not clipped by the popup.\n     * Maybe it should be an option on input to make sure margin is always in sync with the box-shadow thickness\n     */\n  margin: 3px;\n\n  input {\n    padding-top: 1px;\n    padding-bottom: 1px;\n  }\n`;\nconst StyledHeader = styled(Popup.Header)`\n  border-bottom: 1px solid ${({ theme }) => theme.commonColors.border()};\n`;\n\n/**\n * A simple Popup with an input, used in actions such as create file, or create directory\n */\nexport function NewItemPopup({\n  title,\n  inputName = \"Name\",\n  onSubmit,\n  validationMessage,\n  validationType = \"error\",\n  value,\n  onChange,\n}: {\n  inputName?: string;\n  title: React.ReactNode;\n  onSubmit: () => void;\n  value: string;\n  onChange: (newValue: string) => void;\n  validationMessage?: string;\n  validationType?: \"error\" | \"warning\";\n}) {\n  const [hideMessage, setHideMessage] = useState(false);\n  return (\n    <Popup>\n      <PopupLayout\n        header={<StyledHeader>{title}</StyledHeader>}\n        content={\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              onSubmit();\n            }}\n            onMouseDown={() => {\n              setHideMessage(true);\n            }}\n          >\n            <PositionedTooltipTrigger\n              isOpen={Boolean(validationMessage) && !hideMessage}\n              placement=\"top start\"\n              offset={6}\n              crossOffset={-6}\n              tooltip={\n                <ValidationTooltip type={validationType}>\n                  {validationMessage}\n                </ValidationTooltip>\n              }\n            >\n              <StyledInput\n                appearance=\"embedded\"\n                validationState={validationMessage ? validationType : undefined}\n                placeholder={inputName}\n                value={value}\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                  setHideMessage(false);\n                  onChange(e.target.value);\n                }}\n              />\n            </PositionedTooltipTrigger>\n          </form>\n        }\n      />\n    </Popup>\n  );\n}\n","import path from \"path\";\nimport { selector, useRecoilCallback } from \"recoil\";\nimport React, { useState } from \"react\";\nimport {\n  ActionDefinition,\n  Button,\n  Checkbox,\n  ModalWindow,\n  PlatformIcon,\n  WindowLayout,\n} from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { editorManagerState } from \"../../Editor/editor.state\";\nimport {\n  activePathExistsState,\n  activePathsState,\n  projectPopupManagerRefState,\n  windowManagerRefState,\n} from \"../project.state\";\nimport { vcsRootForFile } from \"../../VersionControl/file-status.state\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { createFileCallback } from \"../fs-operations\";\nimport { gitAddCallback } from \"../../VersionControl/gitAddCallback\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\n\n// TODO: expand to and select the new file in the project tree, if the action is initiated from projects view.\nexport const createFileActionState = selector({\n  key: `action.${projectActionIds.NewFile}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.NewFile,\n    icon: <PlatformIcon icon=\"fileTypes/text\" />,\n    title: \"File\",\n    description: \"Create new file\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot, refresh }) => async () => {\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n      const popupManager = snapshot\n        .getLoadable(projectPopupManagerRefState)\n        .getValue().current;\n\n      // TODO: open a dialog and let the user choose the destination if, multiple paths are active\n      const destinationDir = (\n        await fs.promises.stat(activePaths[0])\n      ).isDirectory()\n        ? activePaths[0]\n        : path.dirname(activePaths[0]);\n\n      if (!popupManager) {\n        throw new Error(\"Could not find popup manager\");\n      }\n\n      popupManager.show(({ close }) => (\n        <NewFilePopup close={close} destinationDir={destinationDir} />\n      ));\n    }),\n  }),\n});\n\nfunction NewFilePopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createFile = useRecoilCallback(\n    (callbackInterface) => {\n      const createFile = createFileCallback(callbackInterface);\n      return async (destination: string, filename: string) => {\n        const fullpath = path.join(destinationDir, filename);\n        const { snapshot } = callbackInterface;\n        const editorManager = snapshot\n          .getLoadable(editorManagerState)\n          .getValue();\n        const windowManager = snapshot\n          .getLoadable(windowManagerRefState)\n          .getValue().current;\n        const repoDir = await snapshot.getPromise(vcsRootForFile(fullpath));\n        await createFile(destinationDir, filename);\n        // TODO: select it in the Project tool window, if it was created from the Project tool window\n        close();\n        editorManager.focus();\n        // Hacky approach to fix an edge case where the editor is not rendered already (no open tabs), and\n        // so will be focused with a little delay. For the focus to go back to the editor after AddFileToGitWindow\n        // is closed, without any extra focus management, we need to make sure the editor is focused before the\n        // modal window is opened, so it restores to the editor.\n        await waitUntil(\n          () => document.activeElement instanceof HTMLTextAreaElement\n        );\n        if (repoDir) {\n          windowManager?.open(({ close }) => (\n            <AddFileToGitWindow filepath={fullpath} close={close} />\n          ));\n        }\n      };\n    },\n    [close]\n  );\n  const [filename, setFilename] = useState(\"\");\n  const [validationMessage, setValidationMessage] = useState(\"\");\n  const submit = async () => {\n    const fullPath = path.join(destinationDir, filename);\n    const stats = await stat(fullPath);\n    if (stats?.isFile()) {\n      setValidationMessage(\n        `A file with the name '${path.basename(filename)}' already exists`\n      );\n    } else if (stats?.isDirectory()) {\n      setValidationMessage(\n        `A directory with the name '${path.basename(filename)}' already exists`\n      );\n    } else {\n      await createFile(destinationDir, filename);\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New File\"\n      onSubmit={() => {\n        if (filename) {\n          submit(); // error handling?\n        }\n      }}\n      value={filename}\n      onChange={(newValue) => {\n        setValidationMessage(\"\");\n        setFilename(newValue);\n      }}\n      validationMessage={validationMessage}\n    />\n  );\n}\n\nfunction useAddToGit() {\n  return useRecoilCallback(gitAddCallback, []);\n}\n\nfunction AddFileToGitWindow({\n  close,\n  filepath,\n}: {\n  close: () => void;\n  filepath: string;\n}) {\n  const addToGit = useAddToGit();\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Add File to Git\"\n        content={\n          <>\n            <div\n              style={{\n                display: \"flex\",\n                gap: \"1rem\",\n                padding: \"0.75rem 0.75rem 0rem\",\n              }}\n            >\n              <PlatformIcon icon=\"general/questionDialog.svg\" size={32} />\n              <div>\n                Do you want to add the following file to Git?\n                <br />\n                {filepath}\n                <br />\n                <br />\n                If you choose Cancel, you can still add it later manually.\n              </div>\n            </div>\n          </>\n        }\n        footer={\n          <WindowLayout.Footer\n            left={<Checkbox isDisabled>Don't ask again</Checkbox>}\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  autoFocus\n                  variant=\"default\"\n                  onPress={() => {\n                    addToGit(filepath).then(close);\n                  }}\n                >\n                  Add\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function waitUntil(criteria: () => boolean, timeoutInMs = 2000) {\n  if (criteria() || timeoutInMs < 0) {\n    return;\n  }\n  await new Promise((resolve) => setTimeout(resolve, 50));\n  await waitUntil(criteria, timeoutInMs - 50);\n}\n","import { useRef } from \"react\";\n// @ts-expect-error caf package doesn't come with typing, and @types/caf doesn't exist at the moment\nimport { CAF } from \"caf\";\n\n/**\n * A utility to avoid race condition in async flows that should be triggered based on some user interaction.\n * Accepts a generator function representing a cancelable async flow. Each `yield` expression is a potential point of\n * cancellation, and the last invocation always cancels previous in progress invocations (if any).\n * Based on [Cancelable Async Flows](https://github.com/getify/CAF#cancelable-async-flows-caf)\n */\nexport const useCancelableAsyncCallback = <A extends any[]>(\n  asyncCallback: (...args: A) => Generator\n) => {\n  const cancelToken = useRef<null | { abort: () => void; signal: unknown }>(\n    null\n  );\n\n  const callbackRef = useRef(asyncCallback);\n  callbackRef.current = asyncCallback;\n\n  return (...args: any[]) => {\n    cancelToken.current?.abort();\n    cancelToken.current = new CAF.cancelToken();\n\n    CAF(function (signal: unknown, ...args: A): unknown {\n      return callbackRef.current(...args);\n    })(cancelToken.current, ...args);\n  };\n};\n","import path from \"path\";\nimport { selector, useRecoilCallback } from \"recoil\";\nimport React, { useEffect, useState } from \"react\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { createDirectoryCallback } from \"../fs-operations\";\nimport { useCancelableAsyncCallback } from \"../../useCancelableAsyncCallback\";\nimport {\n  activePathExistsState,\n  activePathsState,\n  projectPopupManagerRefState,\n} from \"../project.state\";\nimport { NewItemPopup } from \"./NewItemPopup\";\nimport { projectActionIds } from \"../projectActionIds\";\n\n// TODO: expand to and select the new directory in the project tree\nexport const createDirectoryActionState = selector({\n  key: `action.${projectActionIds.NewDir}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.NewDir,\n    icon: <PlatformIcon icon={DIR_ICON} />,\n    title: \"Directory\",\n    description: \"Create new directory\",\n    isDisabled: !get(activePathExistsState), // TODO: disable action when multiple paths are selected and none of them are directories\n    actionPerformed: getCallback(({ snapshot, refresh }) => async () => {\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n      const popupManager = snapshot\n        .getLoadable(projectPopupManagerRefState)\n        .getValue().current;\n\n      // TODO: open a dialog and let the user choose the destination if, multiple dirs are active\n      const destinationDir = (\n        await fs.promises.stat(activePaths[0])\n      ).isDirectory()\n        ? activePaths[0]\n        : path.dirname(activePaths[0]);\n\n      if (!popupManager) {\n        throw new Error(\"Could not find popup manager\");\n      }\n\n      popupManager.show(({ close }) => (\n        <NewDirectoryPopup close={close} destinationDir={destinationDir} />\n      ));\n    }),\n  }),\n});\n\nfunction NewDirectoryPopup({\n  destinationDir,\n  close,\n}: {\n  close: () => void;\n  destinationDir: string;\n}) {\n  const createDirectory = useRecoilCallback(createDirectoryCallback, []);\n\n  const [dirName, setDirName] = useState(\"\");\n\n  const [validationResult, setValidationResult] = useState<{\n    type: \"error\" | \"warning\";\n    message: string;\n  } | null>(null);\n\n  const updateValidation = useCancelableAsyncCallback(function* (\n    destinationDir: string,\n    dirName: string\n  ) {\n    setValidationResult(\n      (yield validate(destinationDir, dirName)) as Awaited<\n        ReturnType<typeof validate>\n      >\n    );\n  });\n  useEffect(() => {\n    updateValidation(destinationDir, dirName);\n  }, [destinationDir, dirName]);\n\n  const submit = async () => {\n    const error = await validate(destinationDir, dirName);\n    if (error == null) {\n      await createDirectory(destinationDir, dirName);\n      close();\n    }\n  };\n  return (\n    <NewItemPopup\n      title=\"New Directory\"\n      onSubmit={() => {\n        if (dirName) {\n          submit(); // error handling?\n        }\n      }}\n      value={dirName}\n      onChange={setDirName}\n      validationMessage={validationResult?.message}\n      validationType={validationResult?.type}\n    />\n  );\n}\n\nconst validate = async function (\n  destinationDir: string,\n  dirName: string\n): Promise<{ type: \"error\" | \"warning\"; message: string } | null> {\n  const fullPath = path.join(destinationDir, dirName);\n  if (!dirName) {\n    return null;\n  }\n  if (dirName.includes(\".\")) {\n    return {\n      type: \"warning\",\n      message: `Note: \".\" in the name is treated as a regular character. Use \"/\" instead if you mean to create nested directories`,\n    };\n  }\n  let stats = await stat(fullPath);\n  if (stats?.isFile()) {\n    return {\n      type: \"error\",\n      message: `A file with the name '${dirName}' already exists`,\n    };\n  } else if (stats?.isDirectory()) {\n    return {\n      type: \"error\",\n      message: `A directory with the name '${dirName}' already exists`,\n    };\n  }\n  return null;\n};\n","import { selector } from \"recoil\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\n\nimport { activePathExistsState, activePathsState } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\n\nexport const copyFilenameActionState = selector({\n  key: `action.${projectActionIds.CopyFileName}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.CopyFileName,\n    title: \"File Name\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n    }),\n  }),\n});\n","import { selector } from \"recoil\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\n\nimport { activePathExistsState, activePathsState } from \"../project.state\";\nimport { projectActionIds } from \"../projectActionIds\";\nimport { notImplemented } from \"../notImplemented\";\n\nexport const copyAbsolutePathActionState = selector({\n  key: `action.${projectActionIds.CopyAbsolutePath}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: projectActionIds.CopyAbsolutePath,\n    title: \"Absolute Path\",\n    isDisabled: !get(activePathExistsState),\n    useShortcutsOf: \"CopyPaths\",\n    actionPerformed: getCallback(({ snapshot }) => async () => {\n      notImplemented();\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n    }),\n  }),\n});\n","import { selector } from \"recoil\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\n\nimport {\n  activePathExistsState,\n  activePathsState,\n} from \"../../Project/project.state\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { VcsActionIds } from \"../VcsActionIds\";\n\nexport const copyPathFromRepositoryRootActionState = selector({\n  key: `action.${VcsActionIds.CopyPathFromRepositoryRootProvider}`,\n  get: ({ get, getCallback }): ActionDefinition => ({\n    id: VcsActionIds.CopyPathFromRepositoryRootProvider,\n    title: \"Path From Repository Root\",\n    isDisabled: !get(activePathExistsState),\n    actionPerformed: getCallback(({ snapshot, refresh }) => async () => {\n      notImplemented();\n      const activePaths = snapshot.getLoadable(activePathsState).getValue();\n      if (activePaths.length === 0) {\n        return;\n      }\n    }),\n  }),\n});\n","import { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  CommonActionId,\n  useCreateDefaultActionGroup,\n} from \"@intellij-platform/core\";\n\nimport { createFileActionState } from \"./actions/createFileAction\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { createDirectoryActionState } from \"./actions/createDirectoryAction\";\nimport { projectActionIds } from \"./projectActionIds\";\nimport { copyFilenameActionState } from \"./actions/copyFilename\";\nimport { copyAbsolutePathActionState } from \"./actions/copyAbsolutePath\";\nimport { copyPathFromRepositoryRootActionState } from \"../VersionControl/actions/copyPathFromRepositoryRoot\";\n\nexport function useProjectActions(): ActionDefinition[] {\n  const openSearchEverywhere = useRecoilCallback(\n    ({ set }) =>\n      ({ element }: ActionContext, tab: string) => {\n        if (element) {\n          set(searchEverywhereState.isOpen, true);\n          set(searchEverywhereState.tab, tab);\n          set(searchEverywhereState.contextElement, element);\n        }\n      },\n    []\n  );\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n  const newFileAction = useRecoilValue(createFileActionState);\n  const newDirectoryAction = useRecoilValue(createDirectoryActionState);\n  const newElementActionGroup = createDefaultActionGroup({\n    id: projectActionIds.NewElement,\n    title: \"New...\",\n    description: \"Create new class, interface, file or directory\",\n    isSearchable: true,\n    children: [newFileAction, newDirectoryAction],\n  });\n\n  const copyReferencePopupGroup = createDefaultActionGroup({\n    id: projectActionIds.CopyReferencePopupGroup,\n    title: \"Copy Path/Reference...\",\n    menuPresentation: \"none\",\n    children: [\n      // TODO: CopyFileReferences action group popup is not the default popup, it shows the copyable value as a hint\n      //  segment in each menu item. A custom actionPerformed should be implemented.\n      createDefaultActionGroup({\n        id: projectActionIds.CopyFileReference,\n        title: \"Copy File Reference\", // in the original impl, there is no title\n        isSearchable: false,\n        menuPresentation: \"section\",\n        children: [\n          // FIXME: actions are not triggered via UI\n          useRecoilValue(copyAbsolutePathActionState),\n          useRecoilValue(copyFilenameActionState),\n          // FIXME: should be able to define divider here\n          // new Divider(),\n          useRecoilValue(copyPathFromRepositoryRootActionState),\n        ],\n      }),\n    ],\n  });\n\n  return [\n    {\n      id: CommonActionId.GO_TO_ACTION,\n      title: \"Find Action\",\n      description: \"Quickly navigate to action by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Actions\");\n      },\n    },\n    {\n      id: CommonActionId.GO_TO_FILE,\n      title: \"Go to file\",\n      description: \"Quickly navigate to file by name\",\n      actionPerformed: (event) => {\n        openSearchEverywhere(event, \"Files\");\n      },\n    },\n    newElementActionGroup,\n    copyReferencePopupGroup,\n  ];\n}\n","import React, { RefObject, useContext } from \"react\";\nimport { ToolWindowRefValue } from \"@intellij-platform/core\";\n\ninterface ToolWindowManager {\n  open(key: string): void;\n}\n\nexport const ToolWindowsRefContext =\n  React.createContext<RefObject<ToolWindowRefValue> | null>(null);\n\nexport const useToolWindowManager = (): ToolWindowManager => {\n  const toolWindowRef = useContext(ToolWindowsRefContext);\n  return {\n    open: (key: string) => {\n      toolWindowRef?.current?.changeState((state) => state.show(key));\n      toolWindowRef?.current?.focus(key);\n    },\n  };\n};\n","import React from \"react\";\nimport { useRecoilCallback, useRecoilValue } from \"recoil\";\nimport path from \"path\";\nimport { ActionDefinition, PlatformIcon } from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport {\n  changesTreeNodesState,\n  changesUnderSelectedKeys,\n  ChangesViewTreeNode,\n  expandedKeysState,\n  includedChangeKeysState,\n  openRollbackWindowForSelectionCallback,\n  queueCheckInCallback,\n  selectedKeysState,\n} from \"./ChangesView/ChangesView.state\";\nimport { allChangesState } from \"./changes.state\";\nimport { IntlMessageFormat } from \"intl-messageformat\";\nimport { getExpandedToNodesKeys } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { COMMIT_TOOLWINDOW_ID } from \"../CommitToolWindow\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { useToolWindowManager } from \"../../Project/useToolWindowManager\";\nimport { focusCommitMessage } from \"./ChangesView/ChangesViewSplitter\";\nimport {\n  activePathsState,\n  currentProjectFilesState,\n} from \"../../Project/project.state\";\nimport { useEditorStateManager } from \"../../Editor/editor.state\";\nimport { getNodeKeyForChange, isGroupNode } from \"./ChangesTree/ChangeTreeNode\";\nimport { Change } from \"./Change\";\nimport { useLatestRecoilValue } from \"../../recoil-utils\";\nimport { findRootPaths } from \"../../path-utils\";\nimport { useRefreshRepoStatuses } from \"../file-status.state\";\nimport { activeChangeListState } from \"./change-lists.state\";\n\nexport const useChangesViewActionDefinitions = (): ActionDefinition[] => {\n  const openRollbackWindow = useRecoilCallback(\n    openRollbackWindowForSelectionCallback,\n    []\n  );\n  const refresh = useRefreshRepoStatuses();\n\n  return [\n    useCheckInActionDefinition(),\n    useCheckInProjectAction(),\n    useJumpToSourceAction(),\n    {\n      id: VcsActionIds.ROLLBACK,\n      title: \"Rollback...\",\n      icon: <PlatformIcon icon=\"actions/rollback.svg\" />,\n      actionPerformed: (event) => {\n        openRollbackWindow(Boolean(event));\n      },\n    },\n    {\n      id: VcsActionIds.REFRESH,\n      title: \"Refresh VCS Changes\",\n      description: \"Refresh VCS Changes\",\n      icon: <PlatformIcon icon=\"actions/refresh.svg\" />,\n      actionPerformed: refresh,\n    },\n    {\n      id: VcsActionIds.SHOW_DIFF,\n      title: \"Show Diff\",\n      icon: <PlatformIcon icon=\"actions/diff.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    {\n      id: VcsActionIds.SHELVE,\n      title: \"Shelve Changes...\",\n      description:\n        \"Save changes to an external patch file and remove them from the code\",\n      icon: <PlatformIcon icon=\"vcs/shelve.svg\" />,\n      actionPerformed: notImplemented,\n    },\n    ...useChangeListActionDefinitions(),\n  ];\n};\n\nconst commitFileMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit File...}\n    other {Commit Files...}\n  }`,\n  \"en-US\"\n);\nconst commitDirMsg = new IntlMessageFormat(\n  `{count, plural,\n    =1 {Commit Directory...}\n    other {Commit Directories...}\n  }`,\n  \"en-US\"\n);\n\nfunction useCheckInActionDefinition(): ActionDefinition {\n  const queueCheckIn = useRecoilCallback(queueCheckInCallback, []);\n  const toolWindowManager = useToolWindowManager();\n  const activePaths = useRecoilValue(activePathsState);\n  const [projectFiles] = useLatestRecoilValue(currentProjectFilesState);\n  const roots = findRootPaths(activePaths);\n\n  const allChanges = useRecoilValue(allChangesState);\n  const containsChange = roots.some((root) =>\n    allChanges.find((change) => isPathInside(root, Change.path(change)))\n  );\n\n  // The logic here is a little better than the reference impl, which itself is inconsistent in project view\n  // and in Changes view (aka commit view).\n  const isDirectory = (path: string) =>\n    projectFiles?.some((item) => item.type === \"dir\" && item.path === path);\n  const selectedPathsAreDirectories = roots.every(isDirectory);\n  return {\n    id: VcsActionIds.CHECKIN_FILES,\n    title: selectedPathsAreDirectories\n      ? (commitDirMsg.format({ count: roots.length }) as string)\n      : (commitFileMsg.format({ count: roots.length }) as string),\n    isDisabled: !containsChange,\n    actionPerformed: () => {\n      queueCheckIn();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\nfunction useCheckInProjectAction(): ActionDefinition {\n  const toolWindowManager = useToolWindowManager();\n\n  const queueChanges = useRecoilCallback(\n    ({ snapshot, set }) =>\n      () => {\n        const includedChangesKeys = snapshot\n          .getLoadable(includedChangeKeysState)\n          .getValue();\n        let keyToSelect = includedChangesKeys.values().next().value;\n        if (includedChangesKeys.size === 0) {\n          const allKeys = snapshot\n            .getLoadable(activeChangeListState)\n            .getValue()\n            ?.changes.map(getNodeKeyForChange);\n          set(includedChangeKeysState, new Set(allKeys));\n          keyToSelect = allKeys?.[0];\n        }\n        if (keyToSelect) {\n          const { rootNodes } = snapshot\n            .getLoadable(changesTreeNodesState)\n            .getValue();\n          set(\n            expandedKeysState,\n            new Set([\n              ...snapshot.getLoadable(expandedKeysState).getValue(),\n              ...getExpandedToNodesKeys(\n                (node) => (isGroupNode(node) ? node.children : null),\n                (node) => node.key,\n                rootNodes as ChangesViewTreeNode[],\n                [keyToSelect]\n              ),\n            ])\n          );\n          set(selectedKeysState, new Set([keyToSelect]));\n        }\n      },\n    []\n  );\n\n  return {\n    id: VcsActionIds.CHECKIN_PROJECT,\n    title: \"Commit\",\n    actionPerformed: () => {\n      queueChanges();\n      toolWindowManager.open(COMMIT_TOOLWINDOW_ID);\n      focusCommitMessage();\n    },\n  };\n}\n\nfunction useJumpToSourceAction(): ActionDefinition {\n  const editorStateManager = useEditorStateManager();\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  return {\n    id: VcsActionIds.JUMP_TO_SOURCE,\n    title: \"Jump to source\",\n    icon: <PlatformIcon icon=\"actions/editSource.svg\" />,\n    actionPerformed: () => {\n      [...selectedChanges].forEach((change, index, arr) => {\n        const changePath = Change.path(change);\n        if (!changePath) {\n          editorStateManager.openPath(changePath, index === arr.length - 1);\n        }\n      });\n    },\n  };\n}\n\nfunction useChangeListActionDefinitions(): ActionDefinition[] {\n  const selectedChanges = useRecoilValue(changesUnderSelectedKeys);\n\n  const actions: ActionDefinition[] = [\n    {\n      id: VcsActionIds.NEW_CHANGELIST,\n      title: \"New Changelist...\",\n      description: \"Create new changelist\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: notImplemented,\n    },\n  ];\n  if (selectedChanges.size > 0) {\n    // FIXME: should use active paths, not selection\n    actions.push({\n      title: \"Move to Another Changelist...\",\n      description: \"Move selected changes to another changelist\",\n      id: VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST,\n      actionPerformed: notImplemented,\n    });\n  }\n  return actions;\n}\n\nfunction isPathInside(parent: string, dir: string) {\n  const relative = path.relative(parent, dir);\n  return (\n    !relative /* If parent and dir are the same, `relative` will be an empty string. We want to return true in this edge case*/ ||\n    (!relative.startsWith(\"..\") && !path.isAbsolute(relative))\n  );\n}\n","import {\n  Button,\n  Checkbox,\n  InputField,\n  ModalWindow,\n  styled,\n  useBalloonManager,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport React, { FormEvent, ReactNode, useState } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { activeFileRepoBranchesState } from \"../active-file.state\";\nimport { useCreateBranch } from \"./branches.state\";\nimport { Errors } from \"isomorphic-git\";\nimport {\n  BranchNameError,\n  cleanUpBranchName,\n  validateBranchName,\n} from \"./branch-name-utils\";\n\nconst StyledContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 1rem 0.875rem 0.25rem;\n  gap: 0.6rem;\n`;\nconst StyledCheckboxesContainer = styled.div`\n  margin-left: -0.25rem; // to align with the field. Maybe something to look into in checkbox.\n  display: flex;\n  gap: 0.75rem;\n`;\n\nconst ErrorMessages: Record<\n  BranchNameError,\n  (branchName: string) => ReactNode\n> = {\n  EXISTING: (branchName: string) => (\n    <>\n      Branch name {branchName} already exists. <br />\n      Change the name or overwrite existing branch\n    </>\n  ),\n  CLASHING_WITH_REMOTE: (branchName: string) => (\n    <>\n      Branch name {branchName} clashes with remote branch <br />\n      with the same name\n    </>\n  ),\n};\n\nexport function CreateNewBranchWindow({ close }: { close: () => void }) {\n  const [checkout, setCheckout] = useState(true);\n  const [overwrite, setOverwrite] = useState(false);\n  const branches = useRecoilValue(activeFileRepoBranchesState);\n  const [isErrorVisible, setIsErrorVisible] = useState(false);\n  const balloonManager = useBalloonManager();\n  const createBranch = useCreateBranch();\n  const currentBranchName = branches.currentBranch?.name;\n  const [branchName, setBranchName] = useState(currentBranchName || \"\");\n\n  const error = validateBranchName(branches, branchName);\n  const isValid = !error || (error === \"EXISTING\" && overwrite);\n  const validationState = !isValid && isErrorVisible ? \"error\" : \"valid\";\n\n  const create = () => {\n    if (isValid) {\n      createBranch(branches.repoRoot, branchName, checkout)\n        .catch((e) => {\n          if (e instanceof Errors.AlreadyExistsError) {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unimplemented action\",\n              body: \"Overwrite option is currently not supported.\", // TODO,\n            });\n          } else {\n            balloonManager.show({\n              icon: \"Error\",\n              title: \"Unexpected error\",\n              body: `Could not create branch ${branchName}.`,\n            });\n          }\n          console.error(\"Branch creation error: \", e);\n        })\n        .then(() => {\n          close();\n          // TODO: show toolwindow balloon, when/if git toolwindow is added\n        });\n    } else {\n      setIsErrorVisible(true);\n    }\n  };\n\n  return (\n    <ModalWindow minWidth=\"content\" minHeight=\"content\">\n      <WindowLayout\n        header=\"Create New Branch\"\n        content={\n          <StyledContainer\n            id=\"create_branch_form\"\n            as=\"form\"\n            onSubmit={(e: FormEvent) => {\n              e.preventDefault();\n              create();\n            }}\n          >\n            <InputField\n              autoFocus\n              autoSelect\n              value={branchName}\n              onChange={(newValue) => {\n                setBranchName(cleanUpBranchName(newValue));\n                setIsErrorVisible(true);\n              }}\n              validationState={validationState}\n              validationMessage={\n                validationState === \"error\" &&\n                error &&\n                ErrorMessages[error](branchName)\n              }\n              label=\"New branch name:\"\n              labelPlacement=\"above\"\n            />\n            <StyledCheckboxesContainer>\n              <Checkbox isSelected={checkout} onChange={setCheckout}>\n                Checkout branch\n              </Checkbox>\n              <Checkbox\n                isSelected={overwrite}\n                isDisabled={!isErrorVisible || error !== \"EXISTING\"}\n                onChange={setOverwrite}\n              >\n                Overwrite existing branch\n              </Checkbox>\n            </StyledCheckboxesContainer>\n          </StyledContainer>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  form=\"create_branch_form\" // Using form in absence of built-in support for default button\n                  isDisabled={validationState === \"error\"}\n                >\n                  Create\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n","import { ActionContext, ActionDefinition } from \"@intellij-platform/core\";\nimport { CallbackInterface, isRecoilValue, selector } from \"recoil\";\nimport { MaybeRecoilValue } from \"./recoil-utils\";\n\n/**\n * Creates an action based on a recoil state and callbacks.\n * The action is created as a recoil selector, which means it only\n * updates when recoil values used in properties like isDisabled\n * are changed.\n */\nexport const createAction = <T,>({\n  isSearchable,\n  isDisabled,\n  actionPerformed,\n  ...params\n}: Omit<ActionDefinition, \"actionPerformed\" | \"isDisabled\" | \"isSearchable\"> & {\n  actionPerformed: (\n    callbackInterface: CallbackInterface\n  ) => (context: ActionContext) => T;\n  isDisabled?: MaybeRecoilValue<boolean>;\n  isSearchable?: MaybeRecoilValue<boolean>;\n}) =>\n  selector<ActionDefinition>({\n    key: `action.${params.id}`,\n    get: ({ get, getCallback }): ActionDefinition => {\n      const resolve = <T,>(value: MaybeRecoilValue<T>): T =>\n        isRecoilValue(value) ? get(value) : value;\n      return {\n        ...params,\n        isDisabled: resolve(isDisabled),\n        isSearchable: resolve(isSearchable),\n        actionPerformed: getCallback(actionPerformed),\n      };\n    },\n  });\n","import { selector } from \"recoil\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { asyncFilter } from \"../../async-utils\";\nimport { fileStatusState, vcsRootForFile } from \"../file-status.state\";\nimport git from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport path from \"path\";\nimport { activePathsState } from \"../../Project/project.state\";\nimport { createAction } from \"../../createAction\";\nimport { PlatformIcon } from \"@intellij-platform/core\";\nimport { gitAddCallback } from \"../gitAddCallback\";\nimport React from \"react\";\n\nconst pathsToAddState = selector<string[]>({\n  key: `vcs.action.${VcsActionIds.GIT_ADD}.pathsToAdd`,\n  get: async ({ get }) => {\n    return asyncFilter(async (activePath): Promise<boolean> => {\n      const repoDir = get(vcsRootForFile(activePath));\n      if (repoDir) {\n        const isIgnored = await git.isIgnored({\n          fs,\n          dir: repoDir,\n          filepath: path.relative(repoDir, activePath),\n        });\n        const isFile = await fs.promises\n          .stat(activePath)\n          .then((stat) => stat.isFile())\n          .catch(() => false);\n        const isUnchangedFile =\n          isFile && get(fileStatusState(activePath)) === \"NOT_CHANGED\";\n        return !isIgnored && !isUnchangedFile; // logic checked with the behavior of the reference impl\n      }\n      return false;\n    }, get(activePathsState));\n  },\n});\n\nconst gitAddDisabledState = selector<boolean>({\n  key: `vcs.action.${VcsActionIds.GIT_ADD}.disabled`,\n  get: ({ get }) => get(pathsToAddState).length === 0,\n});\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status, though.\n * TODO: task API can be used to make this a task.\n */\nexport const gitAddActionSelector = createAction({\n  id: VcsActionIds.GIT_ADD,\n  title: \"Add\",\n  icon: <PlatformIcon icon=\"general/add.svg\" />,\n  useShortcutsOf: VcsActionIds.ADD_UNVERSIONED,\n  isDisabled: gitAddDisabledState,\n  actionPerformed: (callbackInterface) => async () => {\n    const addToGit = gitAddCallback(callbackInterface);\n    const { snapshot } = callbackInterface;\n    const pathsToAdd = await snapshot.getPromise(pathsToAddState);\n    return Promise.all(pathsToAdd.map(addToGit));\n  },\n});\n","import git from \"isomorphic-git\";\nimport { fs } from \"../../fs/fs\";\nimport { createAction } from \"../../createAction\";\nimport { currentProjectState } from \"../../Project/project.state\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport { vcsRootsState } from \"../file-status.state\";\n\n/**\n * FIXME: action is not enabled on repo roots.\n * FIXME(maybe): if repo status is being updated, action either remains disabled or just doesn't work (didn't check which)\n *  Maybe not much to do here if the action remains disabled because of unknown status.\n * TODO: task API can be used to make this a task.\n */\nexport const gitInitActionSelector = createAction({\n  id: VcsActionIds.GIT_INIT,\n  title: \"Create Git Repository...\",\n  actionPerformed:\n    ({ snapshot, set }) =>\n    async () => {\n      // TODO: open a path selector to select the path where the git repo should be initialized\n      const project = await snapshot.getPromise(currentProjectState);\n      const dir = project.path;\n      await git.init({ fs, dir });\n      set(vcsRootsState, (roots) =>\n        roots\n          .filter((root) => root.dir !== dir)\n          .concat({\n            vcs: \"Git\",\n            dir,\n          })\n      );\n    },\n});\n","import { atom } from \"recoil\";\nimport { persistentAtomEffect } from \"../Project/persistence/persistentAtomEffect\";\nimport { array, object, string } from \"@recoiljs/refine\";\nimport { ensureArray, MaybeArray } from \"../ensureArray\";\n\n/**\n * The shape of the <option> tag in the persistence xml file.\n */\ntype VisitedUrlsOption = {\n  list: {\n    UrlAndUserName: MaybeArray<{\n      option: [\n        { \"@name\": \"url\"; \"@value\": string },\n        { \"@name\": \"userName\"; \"@value\": string }\n      ];\n    }>;\n  };\n};\n\ninterface VisitedUrl {\n  url: string;\n  username?: string;\n}\n\nconst visitedUrlsChecker = array(\n  object({\n    url: string(),\n    username: string(),\n  })\n);\n\nexport const gitVisitedUrlsState = atom<ReadonlyArray<VisitedUrl>>({\n  key: \"git.rememberedInputs.visitedUrls\",\n  default: [],\n  effects: [\n    persistentAtomEffect.option<ReadonlyArray<VisitedUrl>, VisitedUrlsOption>({\n      storageFile: \"vcs.xml\", // GitRememberedInputs is user-level configuration, kept here temporarily\n      componentName: \"GitRememberedInputs\",\n      optionName: \"visitedUrls\",\n      refine: visitedUrlsChecker,\n      read: (option) => {\n        return ensureArray(option?.list?.UrlAndUserName)\n          .map(({ option }) => ({\n            url: ensureArray(option).find(\n              (option) => option[\"@name\"] === \"url\"\n            )?.[\"@value\"]!,\n            username: ensureArray(option).find(\n              (option) => option[\"@name\"] === \"userName\"\n            )?.[\"@value\"],\n          }))\n          .filter((i) => i.url);\n      },\n      update: (value) => (option) => {\n        return {\n          ...option,\n          list: {\n            UrlAndUserName: value.map(({ url, username }) => ({\n              option: [\n                { \"@name\": \"url\", \"@value\": url },\n                { \"@name\": \"userName\", \"@value\": username ?? \"\" },\n              ],\n            })),\n          },\n        };\n      },\n    }),\n  ],\n});\n\nexport const cloneParentDirState = atom<string>({\n  key: \"git.rememberedInputs.cloneParentDir\",\n  default: \"\",\n  effects: [\n    persistentAtomEffect.option<string, { \"@value\": string }>({\n      storageFile: \"vcs.xml\", // GitRememberedInputs is user-level configuration, kept here temporarily\n      componentName: \"GitRememberedInputs\",\n      optionName: \"cloneParentDir\",\n      refine: string(),\n      read: (option) => {\n        return option?.[\"@value\"] ?? \"\";\n      },\n      update: (value) => (option) => {\n        return {\n          ...option,\n          \"@value\": value,\n        };\n      },\n    }),\n  ],\n});\n","import React, { useEffect, useState } from \"react\";\nimport path from \"path\";\nimport git, { clone, GitProgressEvent } from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport { defaultProject, autoClonedRepo } from \"./Project/project.state\";\nimport { fs } from \"./fs/fs\";\nimport { ensureDir } from \"./fs/fs-utils\";\nimport {\n  AlertDialog,\n  Button,\n  Popup,\n  ProgressBar,\n  styled,\n} from \"@intellij-platform/core\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\nconst defaultWorkspaceFiles = {\n  \".idea/vcs.xml\": `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"GitRememberedInputs\">\n    <option name=\"visitedUrls\">\n      <list>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/alirezamirian/jui.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n        <UrlAndUserName>\n          <option name=\"url\" value=\"https://github.com/thurwitz/example-branches.git\"></option>\n          <option name=\"userName\" value=\"\"></option>\n        </UrlAndUserName>\n      </list>\n    </option>\n    <option name=\"cloneParentDir\" value=\"/workspace\"></option>\n  </component>\n  <component name=\"VcsDirectoryMappings\"></component>\n</project>\n\n`,\n};\n\nexport async function isSuccessfullyCloned(dir: string) {\n  try {\n    const stats = await fs.promises.stat(dir);\n    if (!stats.isDirectory()) {\n      console.info(\n        `Already cloned repo was not found. \"${dir}\" is not a directory.`\n      );\n      return false;\n    }\n    const files = await fs.promises.readdir(dir);\n    if (files.length === 1 && files[0] === \".git\") {\n      console.info(\n        `Already cloned repo was not found at \"${dir}\". \".git\" folder exists, but it's not successfully unpacked.`\n      );\n      return false;\n    }\n  } catch (e) {\n    console.info(`Already cloned repo was not found at \"${dir}\".`);\n    return false;\n  }\n  return true;\n}\n\nconst defaultInitializer = async () => {\n  await ensureDir(fs.promises, defaultProject.path);\n  await Promise.all(\n    Object.entries(defaultWorkspaceFiles).map(async ([filename, content]) => {\n      const fullPath = path.join(defaultProject.path, filename);\n      if (await fs.promises.exists(fullPath)) {\n        return;\n      }\n      await ensureDir(fs.promises, path.dirname(fullPath));\n      await fs.promises.writeFile(fullPath, content, \"utf-8\");\n    })\n  );\n};\n\n/**\n * Used instead of Popup to have it not be fixed positioned, since this popup\n * is auto rendered in website's homepage, and example-app is rendered inline\n * there.\n */\nconst InlinePopup = styled(StyledPopupContainer)<{ minWidth?: number }>`\n  min-width: ${({ minWidth }) => (minWidth ? `${minWidth}px` : \"\")};\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n`;\n\nexport const ProjectInitializer = ({\n  children,\n  autoCloneSampleRepo = false,\n}: {\n  autoCloneSampleRepo?: boolean;\n  children?: React.ReactNode;\n}) => {\n  const [cloneProgress, setCloneProgress] = useState<GitProgressEvent | null>(\n    null\n  );\n\n  const [state, setState] = useState<\n    \"error\" | \"cloning\" | \"uninitialized\" | \"initialized\"\n  >(\"uninitialized\");\n  useEffect(() => {\n    async function ensureSampleRepo(dir: string, repoUrl: string) {\n      if (!(await isSuccessfullyCloned(dir))) {\n        setState(\"cloning\");\n        await cloneRepo({ dir, url: repoUrl, onProgress: setCloneProgress });\n      }\n    }\n    // noinspection JSIgnoredPromiseFromCall: error handling done in the function\n    init();\n    async function init() {\n      const initializer =\n        (window as any).INITIALIZE_APP ?? // Giving a chance for external fs initialization. Used in e2e tests\n        defaultInitializer;\n      try {\n        await initializer({\n          fs,\n          git,\n          path,\n          projectDir: defaultProject.path,\n        });\n        if (autoCloneSampleRepo) {\n          await ensureSampleRepo(autoClonedRepo.path, autoClonedRepo.url);\n        }\n        console.log(\"demo repo initialized\");\n        setState(\"initialized\");\n      } catch (e) {\n        console.error(\"could not initialize the demo repo\", e);\n        setState(\"error\");\n      }\n    }\n  }, []);\n\n  const fraction = cloneProgress?.total\n    ? cloneProgress.loaded / cloneProgress.total\n    : 0;\n\n  switch (state) {\n    case \"uninitialized\":\n      return null;\n    case \"initialized\":\n      return <>{children}</>;\n    case \"cloning\":\n      return (\n        <InlinePopup minWidth={450}>\n          <Popup.Layout\n            header=\"Cloning sample git repository\"\n            content={\n              <div style={{ padding: \"1rem\" }}>\n                <ProgressBar\n                  name={`Cloning repository ${autoClonedRepo.url}`}\n                  isIndeterminate={!cloneProgress}\n                  details={\n                    fraction\n                      ? `${cloneProgress?.phase}: ${Math.round(\n                          fraction * 100\n                        )}% ${cloneProgress?.loaded}/${cloneProgress?.total}`\n                      : cloneProgress?.phase\n                  }\n                  aria-label={`Progress of cloning sample repo`}\n                  value={\n                    cloneProgress\n                      ? cloneProgress.loaded / cloneProgress.total\n                      : 0\n                  }\n                  maxValue={1}\n                />\n              </div>\n            }\n          />\n        </InlinePopup>\n      );\n    case \"error\":\n      return (\n        <AlertDialog\n          type=\"error\"\n          heading=\"Something went wrong!\"\n          body=\"Could not initialize example app\"\n          buttons={\n            <Button\n              variant=\"default\"\n              onPress={() => {\n                window.location.reload();\n              }}\n            >\n              Reload\n            </Button>\n          }\n        />\n      );\n  }\n};\n\nexport async function cloneRepo({\n  dir,\n  url,\n  onProgress,\n}: Pick<Parameters<typeof clone>[0], \"url\" | \"dir\" | \"onProgress\">) {\n  console.log(\"cloning repo: \");\n  await clone({\n    fs,\n    url,\n    http,\n    corsProxy: \"https://cors.isomorphic-git.org\",\n    dir,\n    onProgress,\n    singleBranch: true,\n  });\n}\n","export function getInputCursorOffset(input: HTMLInputElement): number {\n  const caretIndex = input.selectionStart ?? input.value.length;\n  const inputStyle = window.getComputedStyle(input);\n\n  // Create and style a hidden span to mirror the input\n  const hiddenSpan = document.createElement(\"span\");\n  hiddenSpan.style.position = \"absolute\";\n  hiddenSpan.style.visibility = \"hidden\";\n  hiddenSpan.style.whiteSpace = \"pre-wrap\"; // Preserve spaces and line breaks\n  hiddenSpan.style.font = inputStyle.font;\n  hiddenSpan.style.fontSize = inputStyle.fontSize;\n  hiddenSpan.style.fontWeight = inputStyle.fontWeight;\n  hiddenSpan.style.fontFamily = inputStyle.fontFamily;\n  hiddenSpan.style.letterSpacing = inputStyle.letterSpacing;\n  hiddenSpan.style.border = inputStyle.border;\n  hiddenSpan.style.paddingLeft = inputStyle.paddingLeft;\n\n  // Set span content to text before the caret\n  hiddenSpan.textContent = input.value.substring(0, caretIndex);\n  document.body.appendChild(hiddenSpan);\n\n  // Measure the width of the hidden span to get the caret offset\n  const caretOffset = hiddenSpan.offsetWidth;\n\n  // Clean up the hidden span\n  document.body.removeChild(hiddenSpan);\n  return caretOffset;\n}\n","import path from \"path\";\nimport React, { ComponentProps, useEffect, useRef, useState } from \"react\";\nimport { mergeProps, mergeRefs } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  ActionsProvider,\n  ActionTooltip,\n  AutoHoverPlatformIcon,\n  CommonActionId,\n  InputField,\n  Item,\n  ItemLayout,\n  ListBox,\n  MenuOverlayFromOrigin,\n  PlatformIcon,\n  styled,\n  TooltipTrigger,\n  WINDOW_SHADOW,\n} from \"@intellij-platform/core\";\nimport { MENU_VERTICAL_PADDING } from \"@intellij-platform/core/Menu/StyledMenu\";\nimport { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { notImplemented } from \"../../Project/notImplemented\";\nimport { DIR_ICON } from \"../../file-utils\";\nimport { fs } from \"../../fs/fs\";\nimport { getInputCursorOffset } from \"./getInputCursorOffset\";\n\nconst StyledPopover = styled.div`\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\nconst ListBoxStyledAsMenu: typeof ListBox /* https://github.com/styled-components/styled-components/issues/1803#issuecomment-2177525252 */ = styled(\n  ListBox\n)`\n  min-width: 120px;\n  margin: ${MENU_VERTICAL_PADDING}px 0;\n`;\n\nasync function getChildDirectories(searchDirectory: string) {\n  return fs.promises.readdir(searchDirectory).then(async (fileNames) => {\n    const childItems = await Promise.all(\n      fileNames.map(async (fileName) => {\n        const fullPath = path.join(searchDirectory, fileName);\n        return {\n          fullPath,\n          stat: await fs.promises.stat(fullPath),\n        };\n      })\n    );\n    return childItems\n      .filter(({ stat }) => stat.isDirectory())\n      .map(({ fullPath }) => fullPath);\n  });\n}\n\nexport function PathInputField({\n  value: valueProp,\n  onChange: onChangeProp,\n  defaultValue: defaultValueProp,\n  ...props\n}: Omit<ComponentProps<typeof InputField>, \"value\" | \"defaultValue\"> & {\n  value?: string;\n  defaultValue?: string;\n}) {\n  const [value, setValue] = useControlledState(\n    valueProp,\n    defaultValueProp ?? \"\",\n    onChangeProp\n  );\n  const [isAutocompleteVisible, setAutocompleteVisible] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const collectionRef = useRef<HTMLDivElement>(null);\n  const onAutocompleteSuggestionSelected = (key: React.Key) => {\n    setValue(path.join(`${key}`, path.sep)); // TODO: handle completion with tab\n  };\n  // Path search query is kept in a separate state because it needs to be updated when autocomplete action triggers.\n  // Otherwise, it could be a computed value based on `isAutocompleteVisible` and `directory`\n  const [pathSearchQuery, setPathSearchQuery] = useState(\"\");\n  const [pathSuggestions, setPathSuggestions] = useState<\n    Array<{ fullPath: string; textValue: string }>\n  >([]);\n  const updatePathAutocompletion = () => {\n    setMenuOrigin({\n      clientX:\n        (inputClientRect?.x ?? 0) + getInputCursorOffset(inputRef.current!),\n      clientY: (inputClientRect?.y ?? 0) + (inputClientRect?.height ?? 0) + 2,\n    });\n    setPathSearchQuery(\n      value.slice(0, inputRef.current?.selectionStart ?? undefined)\n    );\n  };\n  useEffect(() => {\n    if (isAutocompleteVisible) {\n      updatePathAutocompletion();\n    }\n  }, [isAutocompleteVisible, value]);\n\n  const wasAutocompleteVisible = usePrevious(isAutocompleteVisible);\n\n  useEffect(() => {\n    const pathParts = pathSearchQuery.split(path.sep);\n    const searchDirectory = pathParts.slice(0, -1).join(path.sep) || \"/\";\n    const query = pathParts.length > 1 ? pathParts.slice(-1)[0] : \"\";\n    let canceled = false;\n    getChildDirectories(searchDirectory).then((suggestions) => {\n      if (canceled) {\n        return;\n      }\n      // TODO: handle \"No suggestions\"\n      const matchedSuggestions = suggestions\n        .map((fullPath) => {\n          const dirname = path.basename(fullPath);\n          return { fullPath, textValue: dirname };\n        })\n        .filter(\n          ({ textValue }) =>\n            !query || textValue.toLowerCase().includes(query.toLowerCase())\n        );\n      setPathSuggestions(matchedSuggestions);\n      // TODO: set \"Use {0} to keep tail of the path\" tip if caret position is not at the end.\n      if (\n        matchedSuggestions.length > 0 &&\n        /* Note that wasAutocompleteVisible is a captured closure and it's intentionally not in effect's dependencies */\n        !wasAutocompleteVisible &&\n        inputRef.current?.value.indexOf(pathSearchQuery) === 0\n      ) {\n        inputRef.current.setSelectionRange(\n          pathSearchQuery.length,\n          inputRef.current.value.length,\n          \"backward\"\n        );\n      }\n    });\n    return () => {\n      canceled = true;\n    };\n  }, [pathSearchQuery]);\n\n  const [menuOrigin, setMenuOrigin] = useState({ clientX: 0, clientY: 0 });\n\n  const inputClientRect = inputRef.current?.getBoundingClientRect();\n\n  return (\n    <>\n      <ActionsProvider\n        actions={[\n          {\n            id: CommonActionId.CODE_COMPLETION,\n            title: \"Autocomplete path\",\n            actionPerformed: () => {\n              updatePathAutocompletion();\n              setAutocompleteVisible(true);\n            },\n          },\n        ]}\n      >\n        {({ shortcutHandlerProps }) => (\n          <InputField\n            {...props}\n            value={value}\n            onChange={setValue}\n            inputRef={mergeRefs(inputRef, props.inputRef)}\n            inputProps={mergeProps(\n              props.inputProps ?? {},\n              shortcutHandlerProps,\n              {\n                onKeyDown: (e: React.KeyboardEvent) => {\n                  if (e.key === \"Escape\") {\n                    setAutocompleteVisible(false);\n                  }\n                },\n                onBlur: () => {\n                  setAutocompleteVisible(false);\n                },\n              }\n            )}\n            addonAfter={\n              <>\n                {props.addonAfter}\n                <TooltipTrigger\n                  tooltip={<ActionTooltip actionName=\"Browse... ()\" />}\n                >\n                  {(props) => (\n                    <AutoHoverPlatformIcon\n                      {...props}\n                      style={{ marginRight: \".2rem\" }}\n                      role=\"button\"\n                      onClick={notImplemented}\n                      icon=\"general/openDisk.svg\"\n                    />\n                  )}\n                </TooltipTrigger>\n              </>\n            }\n          />\n        )}\n      </ActionsProvider>\n      {isAutocompleteVisible && (\n        <MenuOverlayFromOrigin\n          onClose={() => {\n            setAutocompleteVisible(false);\n          }}\n          origin={menuOrigin}\n        >\n          <StyledPopover>\n            <ListBoxStyledAsMenu\n              ref={collectionRef}\n              focusProxyRef={inputRef}\n              aria-label=\"Directories\"\n              shouldFocusOnHover\n              shouldUseVirtualFocus\n              autoFocus=\"first\"\n              onAction={onAutocompleteSuggestionSelected}\n              items={pathSuggestions}\n            >\n              {({ fullPath }) => (\n                <Item key={fullPath} textValue={fullPath}>\n                  <ItemLayout>\n                    <PlatformIcon icon={DIR_ICON} />\n                    {path.basename(fullPath)}\n                  </ItemLayout>\n                </Item>\n              )}\n            </ListBoxStyledAsMenu>\n          </StyledPopover>\n        </MenuOverlayFromOrigin>\n      )}\n    </>\n  );\n}\n","import path from \"path\";\nimport React, { useRef, useState } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport {\n  Button,\n  ComboBox,\n  Item,\n  LabeledControlsAlignmentProvider,\n  ModalWindow,\n  styled,\n  WindowLayout,\n} from \"@intellij-platform/core\";\nimport { windowManagerRefState } from \"../../Project/project.state\";\nimport { fs } from \"../../fs/fs\";\nimport { stat } from \"../../fs/fs-utils\";\nimport { createAction } from \"../../createAction\";\nimport { VcsActionIds } from \"../VcsActionIds\";\nimport {\n  cloneParentDirState,\n  gitVisitedUrlsState,\n} from \"../gitRememberedInputs.state\";\nimport { useClone } from \"../useClone\";\nimport { PathInputField } from \"./PathInputField\";\n\nexport const gitCloneActionSelector = createAction({\n  id: VcsActionIds.GIT_CLONE,\n  title: \"Clone...\",\n  actionPerformed:\n    ({ snapshot }) =>\n    async () => {\n      const windowManager = await snapshot.getPromise(windowManagerRefState);\n      windowManager.current?.open(({ close }) => (\n        <GitCloneWindow close={close} />\n      ));\n    },\n});\n\nexport const cloneAnotherRepoActionSelector = createAction({\n  id: \"ExampleApp.cloneExampleRepo\",\n  title: \"Clone another repository...\",\n  isSearchable: false,\n  actionPerformed:\n    ({ snapshot }) =>\n    async () => {\n      const windowManager = await snapshot.getPromise(windowManagerRefState);\n      windowManager.current?.open(({ close }) => (\n        <GitCloneWindow\n          close={close}\n          url=\"https://github.com/thurwitz/example-branches.git\"\n        />\n      ));\n    },\n});\n\nconst StyledContainer = styled.div`\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  gap: 0.75rem;\n`;\n\nfunction GitCloneWindow({\n  close,\n  url: urlProp,\n}: {\n  close: () => void;\n  url?: string;\n}) {\n  const [url, setUrl] = useState(urlProp ?? \"\");\n  const parentDir = useRecoilValue(cloneParentDirState);\n  const [directory, setDirectory] = useState(getAutoFillDir(url));\n  const [autoFillDirectory, setAutoFillDirectory] = useState(true);\n  const [showValidationErrors, setShowValidationErrors] = useState(false);\n  const setCloneParentDirState = useSetRecoilState(cloneParentDirState);\n  const [visitedUrls, setVisitedUrls] = useRecoilState(gitVisitedUrlsState);\n  const urlInputRef = useRef<HTMLInputElement>(null);\n  const dirInputRef = useRef<HTMLInputElement>(null);\n  const urlError = validateRepoUrl(url);\n  const [dirError, setDirError] = useState(\"\");\n\n  const clone = useClone();\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setShowValidationErrors(true);\n    // Note: in the reference impl, validation is live, here it's upon submission.\n    // Error is cleared upon change, like in NewFilePopup.\n    const dirValidationError = await validateCloneDirectory(directory);\n    if (dirValidationError) {\n      setDirError(dirValidationError);\n      dirInputRef.current?.focus();\n      return;\n    }\n    if (urlError) {\n      urlInputRef.current?.focus();\n      return;\n    }\n    setCloneParentDirState(path.dirname(directory));\n    setVisitedUrls((urls) =>\n      urls.find((visitedUrl) => visitedUrl.url === url)\n        ? urls\n        : urls.concat({ url })\n    );\n    clone({\n      url,\n      dir: directory,\n      onSuccess: () => {\n        setVisitedUrls((visitedUrls) =>\n          visitedUrls.map(({ url }) => url).includes(url)\n            ? visitedUrls\n            : [...visitedUrls, { url, username: \"\" }]\n        );\n      },\n    });\n    close();\n  };\n\n  function getAutoFillDir(value: string) {\n    const repoName =\n      value\n        .split(/\\/{1,2}/)\n        .pop()\n        ?.replace(/\\.git$/, \"\") ?? \"\";\n    return repoName ? path.join(parentDir, repoName) : parentDir;\n  }\n\n  return (\n    <ModalWindow minWidth={600} minHeight=\"content\">\n      <WindowLayout\n        header=\"Get from Version Control\"\n        content={\n          <LabeledControlsAlignmentProvider>\n            <form id=\"clone_form\" onSubmit={onSubmit}>\n              <StyledContainer>\n                <ComboBox\n                  inputRef={urlInputRef}\n                  autoFocus\n                  label=\"URL:\"\n                  value={url}\n                  validationState={\n                    urlError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && urlError}\n                  onValueChange={(value) => {\n                    setUrl(value);\n                    if (autoFillDirectory) {\n                      setDirectory(getAutoFillDir(value));\n                    }\n                  }}\n                  items={visitedUrls}\n                >\n                  {({ url }) => <Item key={url}>{url}</Item>}\n                </ComboBox>\n                <PathInputField\n                  inputRef={dirInputRef}\n                  label=\"Directory:\"\n                  value={directory}\n                  validationState={\n                    dirError && showValidationErrors ? \"error\" : \"valid\"\n                  }\n                  validationMessage={showValidationErrors && dirError}\n                  onChange={(value) => {\n                    setDirectory(value);\n                    setAutoFillDirectory(false);\n                    setDirError(\"\");\n                  }}\n                />\n              </StyledContainer>\n            </form>\n          </LabeledControlsAlignmentProvider>\n        }\n        footer={\n          <WindowLayout.Footer\n            right={\n              <>\n                <Button onPress={close}>Cancel</Button>\n                <Button\n                  variant=\"default\"\n                  isDisabled={!directory || !url}\n                  type=\"submit\"\n                  form=\"clone_form\"\n                >\n                  Clone\n                </Button>\n              </>\n            }\n          />\n        }\n      />\n    </ModalWindow>\n  );\n}\n\nasync function validateCloneDirectory(directory: string) {\n  const stats = await stat(directory);\n  if (!stats) {\n    return null;\n  }\n  if (!stats.isDirectory()) {\n    return \"Destination is not a directory\";\n  }\n  const entries = await fs.promises.readdir(directory);\n  return entries.length > 0\n    ? \"The directory already exists and is not empty\"\n    : null;\n}\nconst SSH_URL_PATTERN = new RegExp(`^git@[\\\\w.-]+:[\\\\w./-]+\\\\.git$`);\nfunction validateRepoUrl(url: string): string | null {\n  url = sanitizeCloneUrl(url);\n  try {\n    new URL(url);\n    return null;\n  } catch (e) {\n    if (SSH_URL_PATTERN.test(url)) {\n      return null;\n    }\n  }\n  return \"Repository URL is a malformed URL\";\n}\n\nfunction sanitizeCloneUrl(url: string): string {\n  return removePrefix(removePrefix(url.trim(), \"git clone\"), \"hg clone\");\n}\n\nfunction removePrefix(str: string, prefix: string): string {\n  if (str.startsWith(prefix)) {\n    return str.slice(prefix.length);\n  }\n  return str;\n}\n","import { useRunTask } from \"../tasks\";\nimport { useRefreshCurrentProjectFiles } from \"../Project/project.state\";\nimport { vcsRootsState } from \"./file-status.state\";\nimport { useCallback } from \"react\";\nimport { cloneRepo } from \"../ProjectInitializer\";\nimport { _balloonManagerRef } from \"../Project/notImplemented\";\nimport { useSetRecoilState } from \"recoil\";\n\nexport function useClone() {\n  const runTask = useRunTask();\n  const refreshProjectFiles = useRefreshCurrentProjectFiles();\n  const setVcsRoots = useSetRecoilState(vcsRootsState);\n\n  return useCallback(\n    ({\n      url,\n      dir,\n      onSuccess,\n    }: {\n      url: string;\n      dir: string;\n      onSuccess?: () => void;\n    }) => {\n      runTask(\n        {\n          title: `Cloning source repository ${url}`,\n        },\n        {\n          onFinished: onSuccess,\n          run: async ({ setIndeterminate, setFraction, setSecondaryText }) => {\n            await cloneRepo({\n              dir: dir,\n              url,\n              // TODO: handle onAuthFailure, onAuth, and maybe onMessage\n              onProgress: (progress) => {\n                if (progress.total) {\n                  const fraction = progress.loaded / progress.total;\n                  setFraction(fraction);\n                  setSecondaryText(\n                    `${progress.phase}: ${Math.round(fraction * 100)}% ${\n                      progress.loaded\n                    }/${progress.total}`\n                  );\n                } else {\n                  setSecondaryText(progress.phase);\n                  setIndeterminate(true);\n                }\n              },\n            }).then(\n              () => {\n                setVcsRoots((roots) =>\n                  roots.find((root) => root.dir === dir)\n                    ? roots\n                    : roots.concat({ vcs: \"Git\", dir })\n                );\n                refreshProjectFiles(); // FIXME: flashes the whole page\n              },\n              (e) => {\n                console.log(\"e\", e);\n                // FIXME: using useBalloonManager doesn't work here, because of how BalloonManager is rendered inside WindowManager\n                _balloonManagerRef.value?.show({\n                  icon: \"Error\",\n                  title: \"Clone failed\",\n                  body: `Failed to clone git repo \"${url} into ${dir}: ${e}\"`,\n                });\n              }\n            );\n          },\n        }\n      );\n    },\n    []\n  );\n}\n","import React from \"react\";\nimport {\n  ActionDefinition,\n  PlatformIcon,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\n\nimport { notImplemented } from \"../Project/notImplemented\";\nimport { BranchesPopup } from \"./Branches/BranchesPopup\";\nimport { useChangesViewActionDefinitions } from \"./Changes/useChangesViewActionDefinitions\";\nimport { VcsActionIds } from \"./VcsActionIds\";\nimport { CreateNewBranchWindow } from \"./Branches/CreateNewBranchWindow\";\nimport { useExistingLatestRecoilValue } from \"../recoil-utils\";\nimport { gitAddActionSelector } from \"./actions/gitAddAction\";\nimport { gitInitActionSelector } from \"./actions/gitInitAction\";\nimport { useRecoilValue } from \"recoil\";\nimport { vcsRootsState } from \"./file-status.state\";\nimport {\n  cloneAnotherRepoActionSelector,\n  gitCloneActionSelector,\n} from \"./actions/gitCloneAction\";\n\nexport function useVcsActions(): ActionDefinition[] {\n  const popupManager = usePopupManager();\n  const windowManager = useWindowManager();\n  const [gitAddAction] = useExistingLatestRecoilValue(gitAddActionSelector);\n  const [gitInitAction] = useExistingLatestRecoilValue(gitInitActionSelector);\n  const [gitCloneAction] = useExistingLatestRecoilValue(gitCloneActionSelector);\n  const [cloneAnotherRepoAction] = useExistingLatestRecoilValue(\n    cloneAnotherRepoActionSelector\n  );\n  return [\n    ...useChangesViewActionDefinitions(),\n    gitAddAction,\n    gitCloneAction,\n    cloneAnotherRepoAction,\n    // not including git init action if there is at least one git root, because the action is not fully implemented\n    // and doesn't allow selecting the directory to initialize as a git repository. FIXME\n    ...(useRecoilValue(vcsRootsState).length === 0 ? [gitInitAction] : []),\n    {\n      id: VcsActionIds.GIT_CREATE_NEW_BRANCH,\n      title: \"New Branch\\u2026\",\n      description: \"Create new branch starting from the selected commit\",\n      icon: <PlatformIcon icon=\"general/add.svg\" />,\n      actionPerformed: () => {\n        windowManager.open(({ close }) => (\n          <CreateNewBranchWindow close={close} />\n        ));\n      },\n    },\n    {\n      id: VcsActionIds.GIT_BRANCHES,\n      title: \"Branches\\u2026\",\n      icon: <PlatformIcon icon=\"vcs/branch.svg\" />,\n      actionPerformed: () => {\n        popupManager.show(({ close }) => <BranchesPopup close={close} />);\n      },\n    },\n    {\n      id: VcsActionIds.GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH,\n      title: \"Navigate Log to Selected Branch Head\",\n      useShortcutsOf: \"SelectIn\",\n      icon: <PlatformIcon icon=\"general/locate.svg\" />,\n      actionPerformed: () => {\n        notImplemented();\n      },\n    },\n  ];\n}\n","import {\n  X2jOptionsOptional,\n  XMLBuilder,\n  XmlBuilderOptionsOptional,\n  XMLParser,\n} from \"fast-xml-parser\";\nimport path from \"path\";\nimport { groupBy } from \"ramda\";\nimport React, { useEffect, useRef } from \"react\";\nimport { useRecoilValue } from \"recoil\";\nimport { RecoilSync } from \"recoil-sync\";\n\nimport { fs } from \"../../fs/fs\";\nimport { ensureDir } from \"../../fs/fs-utils\";\nimport { currentProjectState } from \"../project.state\";\nimport { StorageFiles } from \"./persistentAtomEffect\";\nimport { ensureArray } from \"../../ensureArray\";\n\ntype ComponentState = { [key: string]: unknown; \"@name\": string };\ntype WorkspaceState = {\n  \"?xml\": { \"@version\": \"1.0\"; \"@encoding\": \"UTF-8\" };\n  project: {\n    \"@version\": string;\n    component: Array<ComponentState>;\n  };\n};\n\nconst WORKSPACE_XML_PARSE_OPTIONS: X2jOptionsOptional = {\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n  isArray: (tagName, jPath) => jPath === \"project.component\",\n};\n\nconst WORKSPACE_XML_BUILD_OPTIONS: XmlBuilderOptionsOptional = {\n  format: true,\n  attributeNamePrefix: \"@\",\n  ignoreAttributes: false,\n};\n\nasync function readWorkspace(\n  storageFile: string\n): Promise<null | WorkspaceState> {\n  const xmlParser = new XMLParser(WORKSPACE_XML_PARSE_OPTIONS);\n  const workspaceFileExists = await fs.promises.exists(storageFile);\n  if (!workspaceFileExists) {\n    return null;\n  }\n  // @ts-expect-error: bad typing in @isomorphic-git/lightning-fs@4.6.0. It's fixed, but not published at the time of writing this\n  const xmlData: string = await fs.promises.readFile(storageFile, {\n    encoding: \"utf8\",\n  });\n\n  const workspace = xmlParser.parse(xmlData);\n  workspace.project = workspace.project || {};\n  workspace.project.component = ensureArray(workspace.project.component);\n  return workspace;\n}\nasync function writeWorkspace(\n  storageFile: string,\n  workspaceState: WorkspaceState\n): Promise<void> {\n  const xmlBuilder = new XMLBuilder(WORKSPACE_XML_BUILD_OPTIONS);\n\n  const xmlString = xmlBuilder.build(workspaceState);\n  await ensureDir(fs.promises, path.dirname(storageFile));\n  await fs.promises.writeFile(storageFile, xmlString);\n}\n\nconst storageFileMapping: Record<StorageFiles, string> &\n  Record<string, string> = {\n  [StorageFiles.WORKSPACE_FILE]: \"workspace.xml\",\n};\n\nexport function PersistentStateProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const containerDirectory = path.join(\n    useRecoilValue(currentProjectState).path,\n    \".idea\"\n  );\n\n  const resolveStorageFile = (storageFile: string) =>\n    path.join(\n      containerDirectory,\n      storageFileMapping[storageFile] || storageFile\n    );\n\n  const getWorkspace = (storageFile: string) => {\n    // FIXME: caching the first read can cause issues when multiple writes happen, where they override each other.\n    const resolvedStorageFile = resolveStorageFile(storageFile);\n    return readWorkspace(resolvedStorageFile);\n  };\n\n  // preload common storage files\n  useEffect(() => {\n    getWorkspace(StorageFiles.WORKSPACE_FILE);\n  }, []);\n\n  return (\n    <RecoilSync\n      storeKey=\"ProjectWorkspace\"\n      read={async (key: string) => {\n        const [storageFile, componentName] = key.split(\"|\");\n        const workspace = await getWorkspace(storageFile);\n        return workspace?.project.component.find(\n          ({ \"@name\": name }) => name === componentName\n        );\n      }}\n      write={async ({ diff }) => {\n        const changesByFile = groupBy(\n          ({ storageFile }) => storageFile,\n          [...diff.entries()].map(([key, value]) => {\n            const [storageFile, componentName] = key.split(\"|\");\n            return {\n              storageFile,\n              componentName,\n              value,\n            };\n          })\n        );\n\n        for (const storageFile in changesByFile) {\n          const changes = changesByFile[storageFile];\n          const workspace: WorkspaceState = (await readWorkspace(\n            resolveStorageFile(storageFile)\n          )) || {\n            \"?xml\": { \"@version\": \"1.0\", \"@encoding\": \"UTF-8\" },\n            project: { \"@version\": \"4\", component: [] },\n          };\n          for (const { value, componentName } of changes) {\n            const components = workspace.project.component;\n            const index = components.findIndex(\n              ({ \"@name\": name }) => name === componentName\n            );\n            const componentState =\n              typeof value === \"function\"\n                ? value(components[index] || null)\n                : (value as object);\n            components.splice(index, index >= 0 ? 1 : 0, {\n              \"@name\": componentName,\n              ...componentState,\n            });\n          }\n          await writeWorkspace(resolveStorageFile(storageFile), workspace);\n        }\n      }}\n    >\n      {children}\n    </RecoilSync>\n  );\n}\n","// @ts-expect-error caf doesn't have typing :/\nimport { CAF } from \"caf\";\nimport { ActionDefinition } from \"@intellij-platform/core\";\nimport { useRunTask } from \"../tasks\";\n\nexport function useTestActions(): ActionDefinition[] {\n  const runTask = useRunTask();\n  return [\n    {\n      id: \"AddTestProcessAction\",\n      title: \"Add Test Process\",\n      actionPerformed: () => {\n        runTask(\n          { title: \"Test process\", isCancelable: true },\n          async ({ setText, setSecondaryText, setFraction }, abortSignal) => {\n            setText(\"Welcome!\");\n            await CAF(function* () {\n              for (let each = 0; each < 1000; each++) {\n                setText(getProcessName(each));\n                setFraction(each / 1000.0);\n                yield sleep(100);\n                setSecondaryText(\"Bla bla bla\");\n              }\n            })(abortSignal);\n          }\n        );\n      },\n    },\n  ];\n}\n\nasync function sleep(durationInMs: number) {\n  return new Promise((resolve) => setTimeout(resolve, durationInMs));\n}\n\nfunction getProcessName(num: number) {\n  if (num / 10.0 == Math.round(num / 10.0)) {\n    return \"\";\n  }\n  return \"Found: \" + Math.round(num / 20) + 1;\n}\n","import React, { CSSProperties, useRef } from \"react\";\nimport { useRecoilState, useRecoilValue } from \"recoil\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  ActionsProviderProps,\n  BalloonManager,\n  DefaultToolWindows,\n  styled,\n  ToolWindowRefValue,\n  useAlertDialog,\n  useBalloonManager,\n  usePopupManager,\n  useWindowManager,\n} from \"@intellij-platform/core\";\nimport { FileEditor } from \"../Editor/FileEditor\";\nimport { toolWindows } from \"./toolWindows\";\nimport { SyncChangeListsState } from \"../VersionControl/Changes/change-lists.state\";\nimport { IdeStatusBar } from \"../StatusBar/IdeStatusBar\";\nimport { usePersistenceFsNotification } from \"../usePersistenceFsNotification\";\nimport { RollbackWindow } from \"../VersionControl/Changes/Rollback/RollbackWindow\";\nimport { rollbackViewState } from \"../VersionControl/Changes/Rollback/rollbackView.state\";\nimport { toolWindowsState } from \"./toolWindows.state\";\nimport { SearchEverywherePopup } from \"../SearchEverywhere/SearchEverywherePopup\";\nimport { useProjectActions } from \"./useProjectActions\";\nimport { searchEverywhereState } from \"../SearchEverywhere/searchEverywhere.state\";\nimport { useVcsActions } from \"../VersionControl/useVcsActions\";\nimport { _balloonManagerRef } from \"./notImplemented\";\nimport { PersistentStateProvider } from \"./persistence/PersistentStateProvider\";\nimport { useTestActions } from \"../testActions/useTestActions\";\nimport { ToolWindowsRefContext } from \"./useToolWindowManager\";\nimport {\n  projectPopupManagerRefState,\n  windowManagerRefState,\n  alertDialogRefState,\n} from \"./project.state\";\n\nconst StyledWindowFrame = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  min-height: 0;\n`;\n\nexport const Project = ({ height }: { height: CSSProperties[\"height\"] }) => {\n  const toolWindowRef = useRef<ToolWindowRefValue>(null);\n  const [state, setState] = useRecoilState(toolWindowsState);\n  const isRollbackWindowOpen = useRecoilValue(rollbackViewState.isOpen);\n  const isSearchEveryWhereOpen = useRecoilValue(searchEverywhereState.isOpen);\n\n  useRecoilValue(projectPopupManagerRefState).current = usePopupManager();\n  useRecoilValue(windowManagerRefState).current = useWindowManager();\n  useRecoilValue(alertDialogRefState).current = useAlertDialog();\n\n  return (\n    <PersistentStateProvider>\n      <SyncChangeListsState />\n      <BalloonManager disablePortal>\n        <SetBalloonManagerRef />\n        <UsePersistentFsNotification />\n        {/* disablePortal to make example app more portable*/}\n        <ToolWindowsRefContext.Provider value={toolWindowRef}>\n          <StyledWindowFrame style={{ height }}>\n            <ProjectActionProvider>\n              {({ shortcutHandlerProps }) => (\n                <>\n                  <DefaultToolWindows\n                    ref={toolWindowRef}\n                    toolWindowsState={state}\n                    onToolWindowStateChange={(newState) => {\n                      setState(newState);\n                    }}\n                    windows={toolWindows}\n                    containerProps={shortcutHandlerProps}\n                  >\n                    <FileEditor />\n                  </DefaultToolWindows>\n                  <IdeStatusBar />\n                </>\n              )}\n            </ProjectActionProvider>\n            {isSearchEveryWhereOpen && <SearchEverywherePopup />}\n            {isRollbackWindowOpen && <RollbackWindow />}\n          </StyledWindowFrame>\n        </ToolWindowsRefContext.Provider>\n      </BalloonManager>\n    </PersistentStateProvider>\n  );\n};\n\nfunction ProjectActionProvider(\n  props: Omit<ActionsProviderProps, \"actions\" | \"useCapture\">\n) {\n  const allActions: ActionDefinition[] = [\n    ...useProjectActions(),\n    ...useVcsActions(),\n    ...useTestActions(),\n  ];\n  return (\n    <ActionsProvider\n      {...props}\n      actions={allActions}\n      useCapture /* useCapture because of Monaco's aggressive event handling. Specifically, Cmd+Shift+O in .ts files  */\n    />\n  );\n}\n\nfunction SetBalloonManagerRef() {\n  _balloonManagerRef.value = useBalloonManager();\n  return null;\n}\n\nfunction UsePersistentFsNotification() {\n  usePersistenceFsNotification();\n  return null;\n}\n","import { BalloonActionLink, useBalloonManager } from \"@intellij-platform/core\";\nimport path from \"path\";\nimport React, { useEffect } from \"react\";\n\nimport { persistentFsPreference, switchToPersistentFS } from \"./fs/fs\";\nimport { useRunTask } from \"./tasks\";\n\nexport function usePersistenceFsNotification() {\n  const balloons = useBalloonManager();\n\n  const runTask = useRunTask();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (persistentFsPreference.get() == undefined) {\n        balloons.showSticky({\n          title: \"Switch to IndexedDB filesystem\",\n          body: \"By default an in-memory filesystem is used to have a faster git clone. But it means all changes will be lost upon refresh. You can switch in the background to a persistence fs implementation which uses IndexedDB to store files.\",\n          actions: (\n            <>\n              <BalloonActionLink\n                onPress={() => {\n                  runTask(\n                    { title: \"Switching to IndexedDB FS\", isCancelable: true },\n                    async ({ setIndeterminate, setText }, cancelSignal) => {\n                      setText(\"Copying ...\");\n                      setIndeterminate(true);\n                      await switchToPersistentFS({\n                        cancelSignal,\n                        onCopy: (filepath) => {\n                          setText(`Copying ${path.dirname(filepath)}`);\n                        },\n                      })\n                        .then(() => {\n                          persistentFsPreference.set(\"yes\");\n                        })\n                        .catch(() => {\n                          // Do we need to do anything upon cancelation?\n                        });\n                    }\n                  );\n                }}\n              >\n                Switch to IndexedDB FS\n              </BalloonActionLink>\n              <BalloonActionLink\n                onPress={() => persistentFsPreference.set(\"no\")}\n              >\n                Don't ask again\n              </BalloonActionLink>\n            </>\n          ),\n        });\n      }\n    }, 3000);\n    return () => clearTimeout(timeoutId);\n  }, []);\n}\n","import { Keymap } from \"@intellij-platform/core\";\nimport { SearchEverywhereActionIds } from \"./SearchEverywhere/SearchEverywhereActionIds\";\nimport { VcsActionIds } from \"./VersionControl/VcsActionIds\";\nimport { AppActionIds } from \"./appActionIds\";\nimport { editorActionIds } from \"./Editor/editorActionIds\";\nimport { projectActionIds } from \"./Project/projectActionIds\";\n\nexport const exampleAppKeymap: Keymap = {\n  ActivateProjectWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit1\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateCommitWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit0\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateVersionControlWindow: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Digit9\", modifiers: [\"Meta\"] },\n    },\n  ],\n  ActivateTerminalWindow: [\n    { type: \"keyboard\", firstKeyStroke: { code: \"F12\", modifiers: [\"Alt\"] } },\n  ],\n  [VcsActionIds.ROLLBACK]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyZ\", modifiers: [\"Alt\", \"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHOW_DIFF]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyD\", modifiers: [\"Meta\"] },\n    },\n  ],\n  [VcsActionIds.SHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyH\", modifiers: [\"Meta\", \"Shift\"] },\n    },\n  ],\n  [VcsActionIds.UNSHELVE_SILENTLY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"KeyU\", modifiers: [\"Meta\", \"Alt\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.PREVIOUS_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\", modifiers: [\"Shift\"] },\n    },\n  ],\n  [SearchEverywhereActionIds.NEXT_TAB]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"Tab\" },\n    },\n  ],\n  [VcsActionIds.RENAME_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { code: \"F2\" },\n    },\n  ],\n  [VcsActionIds.MOVE_TO_ANOTHER_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Meta\", \"Shift\"], code: \"KeyM\" },\n    },\n  ],\n  [VcsActionIds.SET_DEFAULT_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: { modifiers: [\"Control\"], code: \"Space\" },\n    },\n  ],\n  [VcsActionIds.REMOVE_CHANGELIST]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  [VcsActionIds.CHECKIN_PROJECT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyK\",\n      },\n    },\n  ],\n  [VcsActionIds.ADD_UNVERSIONED]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [VcsActionIds.FOCUS_TEXT_FILTER]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyL\",\n      },\n    },\n  ],\n  [VcsActionIds.GROUP_BY_DIRECTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Control\"],\n        code: \"KeyP\",\n      },\n    },\n  ],\n  SafeDelete: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Backspace\" /* TODO: in intellij, it's DELETE. Check if it's a special key which matches both backspace and Delete*/,\n      },\n    },\n  ],\n  CopyPaths: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [AppActionIds.PASTE_MULTIPLE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyV\",\n      },\n    },\n  ],\n  [projectActionIds.NewElement]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n  [AppActionIds.GENERATE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyN\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_REGION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_REGION_RECURSIVELY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  [editorActionIds.EXPAND_ALL_REGIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"NumpadAdd\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"Equal\",\n      },\n    },\n  ],\n  ...([1, 2, 3, 4, 5] as const).reduce((result, level) => {\n    result[editorActionIds[`EXPAND_ALL_TO_LEVEL${level}`]] = [\n      {\n        type: \"keyboard\",\n        firstKeyStroke: {\n          modifiers: [\"Alt\", \"Meta\"],\n          code: \"Multiply\",\n        },\n        secondKeyStroke: {\n          code: `Digit${level}`,\n        },\n      },\n      {\n        type: \"keyboard\",\n        firstKeyStroke: {\n          modifiers: [\"Alt\", \"Meta\"],\n          code: \"Multiply\",\n        },\n        secondKeyStroke: {\n          code: `Numpad${level}`,\n        },\n      },\n    ];\n    return result;\n  }, {} as Keymap),\n  [editorActionIds.COLLAPSE_REGION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [editorActionIds.COLLAPSE_REGION_RECURSIVELY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Alt\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [editorActionIds.COLLAPSE_ALL_REGIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n};\n","import * as path from \"path\";\nimport React, { CSSProperties } from \"react\";\nimport { RecoilRoot } from \"recoil\";\nimport git from \"isomorphic-git\";\nimport http from \"isomorphic-git/http/web\";\nimport {\n  KeymapProvider,\n  PopupManager,\n  WindowManager,\n} from \"@intellij-platform/core\";\nimport { DefaultSuspense } from \"./DefaultSuspense\";\nimport { Project } from \"./Project/Project\";\nimport { ProjectInitializer } from \"./ProjectInitializer\";\nimport { fs, WaitForFs } from \"./fs/fs\";\nimport { exampleAppKeymap } from \"./exampleAppKeymap\";\nimport \"./jetbrains-mono-font.css\";\n\n// useful globals for debugging purposes\n(window as any).git = git;\n(window as any).fs = fs;\n(window as any).path = path;\n(window as any).http = http;\n\n/**\n * Example app root component. It expects ThemeProvider to be provided based on where it's rendered.\n */\nexport const App = ({\n  height,\n  autoCloneSampleRepo,\n}: {\n  height?: CSSProperties[\"height\"];\n  autoCloneSampleRepo?: boolean;\n}) => {\n  return (\n    // TODO: add an error boundary\n    <DefaultSuspense>\n      <WaitForFs>\n        <ProjectInitializer autoCloneSampleRepo={autoCloneSampleRepo}>\n          <KeymapProvider keymap={exampleAppKeymap}>\n            <RecoilRoot>\n              <WindowManager>\n                <PopupManager>\n                  <Project height={height} />\n                </PopupManager>\n              </WindowManager>\n            </RecoilRoot>\n          </KeymapProvider>\n        </ProjectInitializer>\n      </WaitForFs>\n    </DefaultSuspense>\n  );\n};\n\nexport default App;\n","import {\n  Action,\n  ActionDefinition,\n} from \"@intellij-platform/core/ActionSystem/Action\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\n\nexport type ActionInResolvedGroup = Action & { parent: ResolvedActionGroup };\n\n/**\n * Different ways to show a group of actions in a menu.\n * - `submenu`: renders children as submenu (corresponding, in the reference impl, to `isPopup` property of ActionGroup\n *   being set to `true` and 'SUPPRESS_SUBMENU' clientProperty not being set)\n * - `none`: renders the action group as a simple menu item, not rendering its children at all.\n *   The action group will be performed, which typically opens a popup (see {@link useCreateDefaultActionGroup}),\n *   showing the children.\n *   (corresponding, in the reference impl, to `isPopup` property and 'SUPPRESS_SUBMENU' clientProperty being set\n *   to true on the ActionGroup)\n * - `section`: renders children in a section with divider, but without section title\n * - `titledSection`: renders children in a section with divider and title.\n */\ntype ActionGroupMenuPresentation =\n  | \"section\"\n  | \"titledSection\"\n  | \"none\"\n  | \"submenu\";\n\nexport interface MutableActionGroup extends Action {\n  children: Array<Action | DividerItem>;\n  /**\n   * Whether the action group is searchable. See {@link getAvailableActionsFor}.\n   */\n  isSearchable?: boolean;\n  /**\n   * How the action group should be rendered, in menus.\n   */\n  menuPresentation?: ActionGroupMenuPresentation;\n}\nexport type ActionGroup = Readonly<MutableActionGroup>;\n\nexport interface ResolvedActionGroup extends ActionGroup {\n  parent: ResolvedActionGroup | null;\n  children: ActionInResolvedGroup[];\n}\nexport interface ActionGroupDefinition extends ActionDefinition {\n  children: Array<ActionDefinition | \"divider\">;\n  /**\n   * Defines how the action group should be represented in menus.\n   * @default 'submenu'\n   * @see ActionGroupMenuPresentation\n   */\n  menuPresentation?: ActionGroupMenuPresentation;\n}\n\nexport function isInResolvedActionGroup(\n  action: Action\n): action is ActionInResolvedGroup {\n  return \"parent\" in action;\n}\nexport function isActionGroup(action: Action): action is ActionGroup {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n\nexport function isResolvedActionGroup<T extends Action>(\n  action: Action\n): action is ResolvedActionGroup {\n  return \"children\" in action && \"parent\" in action; // probably better to use a discriminator field like `type`\n}\n\nexport function isActionGroupDefinition(\n  action: ActionDefinition\n): action is ActionGroupDefinition {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n","import React from \"react\";\nimport { useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\n\n/**\n * Renders the first keyboard shortcut for the action specified by {@param actionId}, based on the keymap context.\n * if {@param children} is provided, treats it as a render function that receives the shortcut string.\n */\nexport const ActionShortcut = ({\n  actionId,\n  children,\n}: {\n  actionId: string;\n  children?: (shortcut: string) => React.ReactNode;\n}) => {\n  const getShortcut = useGetActionShortcut();\n  const shortcutString = getShortcut(actionId);\n  return (\n    <>\n      {shortcutString && (children ? children(shortcutString) : shortcutString)}\n    </>\n  );\n};\n\n/**\n * Returns a function that gets first keyboard shortcut for the action specified by `actionId`, based on the\n * keymap context.\n */\nexport const useGetActionShortcut = (): ((actionId: string) => string) => {\n  const keymap = useKeymap();\n  return (actionId: string) => {\n    const keyboardShortcut = keymap?.[actionId]?.find(\n      ({ type }) => type === \"keyboard\"\n    );\n    return keyboardShortcut ? shortcutToString(keyboardShortcut) : \"\";\n  };\n};\n","import React, { KeyboardEventHandler, useRef } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  isKeyboardShortcut,\n  KeyboardShortcut,\n  KeyStroke,\n  Shortcut,\n  supportedModifiers,\n} from \"./Shortcut\";\n\nexport function useShortcuts(\n  shortcuts: { [actionId: string]: ReadonlyArray<Shortcut> },\n  onAction: (\n    actionId: string,\n    args: {\n      event: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>;\n    }\n  ) => void | boolean,\n  {\n    useCapture = false,\n  }: {\n    /**\n     * Experimental option to determine if event handling should be done on capture phase. Useful for cases where\n     * a descendant element handles events in capture phase, and that conflicts with an action.\n     */\n    useCapture?: boolean;\n  } = {}\n) {\n  const firstKeyActivatedShortcutsRef = useRef<\n    Array<{ actionId: string; shortcut: KeyboardShortcut }>\n  >([]);\n  const secondStrokeResetTimerIdRef = useRef<number | null>(null);\n  const onKeyDown: KeyboardEventHandler<HTMLElement> = useEventCallback((e) => {\n    // TODO: repeated key downs can trigger an action repeatedly, in the original impl. Example: expand/shrink selection\n    if (isModifierOnly(e.nativeEvent) || e.repeat) {\n      return;\n    }\n    // firstKeyActivatedShortcutsRef will be re-adjusted in any case. Cleaning whatever scheduled reset\n    if (secondStrokeResetTimerIdRef.current !== null) {\n      window.clearTimeout(secondStrokeResetTimerIdRef.current);\n    }\n\n    function triggerAction(actionId: string) {\n      const result = onAction(actionId, { event: e });\n      if (result !== false) {\n        // TODO: make sure about how propagation should be stopped and/or controlled\n        e.stopPropagation();\n        e.preventDefault();\n      }\n    }\n    // If there are keyboard shortcuts that are half way handled (first keystroke triggered already, and we are within\n    // the valid wait for the second keystroke), they should be prioritized over first keystroke matching.\n    if (firstKeyActivatedShortcutsRef.current.length > 0) {\n      firstKeyActivatedShortcutsRef.current.some(({ shortcut, actionId }) => {\n        if (isKeyMatch(shortcut.secondKeyStroke, e, true)) {\n          triggerAction(actionId);\n          return true;\n        }\n      });\n      firstKeyActivatedShortcutsRef.current = [];\n    } else {\n      const firstKeyMatches = Object.entries(shortcuts)\n        .flatMap(([actionId, shortcuts]) =>\n          shortcuts.map((shortcut) => ({ actionId, shortcut }))\n        )\n        .filter(\n          (\n            input\n          ): input is {\n            actionId: string;\n            shortcut: KeyboardShortcut;\n          } => isKeyboardShortcut(input.shortcut)\n        )\n        .filter(({ shortcut }) => isKeyMatch(shortcut.firstKeyStroke, e));\n\n      firstKeyActivatedShortcutsRef.current = firstKeyMatches.filter(\n        ({ shortcut, actionId }) => shortcut.secondKeyStroke\n      );\n\n      if (firstKeyActivatedShortcutsRef.current.length > 0) {\n        secondStrokeResetTimerIdRef.current = window.setTimeout(() => {\n          firstKeyActivatedShortcutsRef.current = [];\n        }, 2000);\n        document.addEventListener(\n          \"keydown\",\n          () => {\n            document.addEventListener(\n              \"keyup\",\n              () => {\n                firstKeyActivatedShortcutsRef.current = [];\n              },\n              { once: true }\n            );\n          },\n          //  by passing capture: true, we skip the current keydown event, since it's already passed capture phase\n          { once: true, capture: true }\n        );\n      } else if (firstKeyMatches.length > 0) {\n        triggerAction(firstKeyMatches[0].actionId);\n      }\n    }\n  });\n  const shortcutHandlerProps = {\n    /**\n     * by setting onKeyDownCapture is set instead of onKeyDown, we can prioritize action event handler over\n     * component-specific handlers. That might be useful for some components that aggressively stop propagation of\n     * events they handle, if the action is considered of higher priority compared to the conflicting component-internal\n     * functionality. So maybe an option would be in order to define whether the shortcut's event handling should be done\n     * in capture or bubbling phase.\n     * Another thing to get clarified as action system is more used, is to decide if action handler should stop\n     * propagation or not. Or should it be an option?\n     * UPDATE: Added an option to determine whether event handling should be done in capture phase. The use case is\n     * \"Find in files\" action with Cmd+Shift+O shortcut, which overlaps with some action in Monaco editor (only in .ts\n     * files). Monaco uses capture phase, and stops propagation, so unless we use capture phase, useShortcut's event\n     * handler is never called.\n     * An apposite use case is in SpeedSearchTree in tool windows, where we want Escape to be handled by speed search,\n     * and propagation stopped, if speed search is currently active. The second Escape keystroke should move focus to\n     * the editor. That wouldn't work if we unconditionally handle events in capture phase.\n     */\n    [useCapture ? \"onKeyDownCapture\" : \"onKeyDown\"]: onKeyDown,\n  };\n  return { shortcutHandlerProps };\n}\n\nconst isKeyMatch = (\n  keyStroke: KeyStroke | undefined,\n  e: React.KeyboardEvent,\n  loose?: boolean\n) =>\n  e.code === keyStroke?.code &&\n  (loose ? keyStroke.modifiers || [] : supportedModifiers).every(\n    (modifier) =>\n      e.getModifierState(modifier) ===\n      Boolean(keyStroke.modifiers?.includes(modifier))\n  );\n\nfunction isModifierOnly(event: KeyboardEvent) {\n  return event.location === 1 || event.location === 2;\n}\n","import { sortBy } from \"ramda\";\nimport React, { HTMLAttributes, useContext, useEffect, useState } from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { dfsVisit } from \"@intellij-platform/core/utils/tree-utils\";\n\nimport { Keymap, useKeymap } from \"./KeymapProvider\";\nimport { shortcutToString } from \"./shortcutToString\";\nimport { useShortcuts } from \"./useShortcut\";\nimport {\n  ActionGroup,\n  ActionInResolvedGroup,\n  isActionGroup,\n  isActionGroupDefinition,\n  MutableActionGroup,\n} from \"./ActionGroup\";\nimport {\n  Action,\n  ActionContext,\n  ActionDefinition,\n  MutableAction,\n} from \"./Action\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\n\n/**\n * Represents the properties required for the ActionsProvider component.\n */\nexport interface ActionsProviderProps {\n  /**\n   * A collection of action definitions.\n   */\n  actions: ActionDefinition[];\n  children: (args: {\n    shortcutHandlerProps: HTMLAttributes<HTMLElement>;\n  }) => React.ReactElement;\n\n  /**\n   * Experimental option to determine if event handling should be done on capture phase. Useful for cases where\n   * a descendant element handles events in capture phase, and that conflicts with an action.\n   */\n  useCapture?: boolean;\n}\n\nconst ActionsContext = React.createContext<Action[]>([]);\n\nfunction generateId() {\n  return `jui-${Math.floor(Math.random() * 10000000)}`;\n}\n\nconst ACTION_PROVIDER_ID_ATTRIBUTE = \"data-action-provider\";\nconst ACTION_PROVIDER_ID_DATA_PREFIX = \"action_provider_id_\";\nconst actionProvidersMap = new Map<string, Action[]>();\n\n/**\n * Provides a set of actions for the wrapped UI. Uses the currently provided keymap to find the shortcuts\n * for each action, and passes the necessary event handlers for the shortcuts, to the `children` render function.\n *\n * @param {Array<Action>} props.actions - The actions to be provided.\n * @param {boolean} [props.useCapture] - Specifies whether to use capture phase for event handling.\n * @param {Function} props.children - Render function that accepts shortcutHandlerProps as argument.\n */\nexport function ActionsProvider(props: ActionsProviderProps): JSX.Element {\n  const parentContext = useContext(ActionsContext);\n  const keymap = useKeymap();\n  const actions: Action[] = [];\n  dfsVisit(\n    (action: Action | DividerItem | null) =>\n      action && !(action instanceof DividerItem) && isActionGroup(action)\n        ? action.children\n        : null,\n    (action) => {\n      if (action && !(action instanceof DividerItem)) {\n        actions.push(action);\n      }\n    },\n    recursivelyCreateActions(keymap, props.actions)\n  );\n\n  const shortcuts = Object.fromEntries(\n    actions.map((action) => [action.id, action.shortcuts || []])\n  );\n  const [actionProviderId] = useState(generateId);\n\n  const { shortcutHandlerProps } = useShortcuts(\n    shortcuts,\n    (actionId, { event }) => {\n      actions\n        .find((action) => action.id === actionId)\n        ?.perform({\n          event,\n          // it's important to use target and not currentTarget\n          element: event.target instanceof Element ? event.target : null,\n        });\n    },\n    { useCapture: props.useCapture }\n  );\n\n  const allActions = [...parentContext, ...actions]; // Maybe warn overrides?\n\n  // @ts-expect-error: not sure why data-* attribute is not accepted.\n  shortcutHandlerProps[ACTION_PROVIDER_ID_ATTRIBUTE] = actionProviderId;\n  // @ts-expect-error: not sure why data-* attribute is not accepted.\n  shortcutHandlerProps[\n    `data-${ACTION_PROVIDER_ID_DATA_PREFIX}${actionProviderId}`\n  ] = \"\";\n\n  useEffect(() => {\n    actionProvidersMap.set(actionProviderId, allActions);\n  });\n  useEffect(() => {\n    return () => {\n      actionProvidersMap.delete(actionProviderId);\n    };\n  }, []);\n  return (\n    <ActionsContext.Provider value={allActions}>\n      {props.children({ shortcutHandlerProps })}\n    </ActionsContext.Provider>\n  );\n}\n\nfunction isMutableActionGroup(\n  action: MutableAction\n): action is MutableActionGroup {\n  return \"children\" in action; // probably better to use a discriminator field like `type`\n}\n\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: Array<ActionDefinition | DividerItem>,\n  parent: ActionGroup\n): Array<ActionInResolvedGroup | DividerItem>;\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: Array<ActionDefinition | DividerItem>\n): Array<Action | ActionGroup | DividerItem>;\nfunction recursivelyCreateActions(\n  keymap: Keymap | null,\n  actionDefinitions: Array<ActionDefinition | DividerItem>,\n  parent?: ActionGroup\n): Array<Action | ActionInResolvedGroup | ActionGroup | DividerItem> {\n  return actionDefinitions.map(\n    (\n      actionDefinition: ActionDefinition | DividerItem\n    ): Action | DividerItem => {\n      if (actionDefinition instanceof DividerItem) {\n        return actionDefinition;\n      }\n      const shortcuts =\n        keymap?.[actionDefinition.id] ??\n        (actionDefinition.useShortcutsOf\n          ? keymap?.[actionDefinition.useShortcutsOf]\n          : undefined);\n      const firstShortcut = shortcuts?.[0];\n      const action: MutableAction | ActionInResolvedGroup = {\n        ...actionDefinition,\n        ...(isActionGroupDefinition(actionDefinition)\n          ? { parent: parent ?? null }\n          : {}),\n        shortcuts,\n        shortcut: firstShortcut ? shortcutToString(firstShortcut) : undefined, // Maybe it should be all shortcuts?\n        perform: (context) => {\n          if (!action.isDisabled) {\n            actionDefinition.actionPerformed(\n              context || { event: null, element: null }\n            );\n          }\n        },\n      };\n      if (\n        isMutableActionGroup(action) &&\n        isActionGroupDefinition(actionDefinition)\n      ) {\n        action.children = recursivelyCreateActions(\n          keymap,\n          actionDefinition.children.map((child) =>\n            child === \"divider\" ? new DividerItem() : child\n          ),\n          action\n        );\n      }\n      return action;\n    }\n  );\n}\n\n/**\n * Experimental function to get list of all actions available from a given html elements. Useful for implementing\n * action search UI.\n * @experimental\n */\nexport function getAvailableActionsFor(element: Element): Action[] {\n  const closestActionProvider = element.closest(\n    `[${ACTION_PROVIDER_ID_ATTRIBUTE}]`\n  );\n  if (closestActionProvider instanceof HTMLElement) {\n    /**\n     * NOTE: initially, only one data attribute was used to hold the action provider id. Although simpler, that approach\n     * is subject to bug in some edge cases, where multiple nested action providers are rendered, but `actionProviderProps`\n     * is merged on a single dom element. In such cases, it's important that the props from the innermost action provider\n     * is merged last, overwriting other values for data-action-provider-id.\n     * Because that's error-prone, we keep unique data attributes (`data-action_provider_id_...`} for each action\n     * provider id, and to simplify querying part, we also add a constant data attribute (data-action-provider).\n     * This way we can read all action providers applied on the same dom element. Since action providers inherit actions\n     * from parent action providers, we can reliably pick the actions from the one with the highest number of actions.\n     */\n    const actionSets = Object.keys(closestActionProvider.dataset)\n      .filter((dataKey) => dataKey.startsWith(ACTION_PROVIDER_ID_DATA_PREFIX))\n      .map((dataKey) => {\n        const id = dataKey?.replace(ACTION_PROVIDER_ID_DATA_PREFIX, \"\");\n        const actions = id && actionProvidersMap.get(id);\n        // noinspection PointlessBooleanExpressionJS\n        return actions\n          ? Object.values(actions).filter(\n              ({ isSearchable }) => isSearchable !== false\n            )\n          : [];\n      })\n      .concat();\n    return sortBy((actionSet) => -actionSet.length, actionSets)[0] || [];\n  }\n  return [];\n}\n\nexport function useActions(): Action[] {\n  return useContext(ActionsContext);\n}\n\nexport const useAction = (actionId: string): Action | null => {\n  return useActions().find(({ id }) => id === actionId) ?? null;\n};\n\nexport const usePerformAction = (): ((\n  actionId: string,\n  context?: ActionContext\n) => void) => {\n  const actions = useActions();\n  return useEventCallback((actionId: string, context?: ActionContext) => {\n    const action = actions.find(({ id }) => id === actionId);\n    if (action) {\n      action.perform(context);\n    } else {\n      console.error(\n        `An attempt to perform action with id ${actionId} failed because action was not found`\n      );\n    }\n  });\n};\n","export const CommonActionId = {\n  EXPAND_ALL: \"ExpandAll\",\n  COLLAPSE_ALL: \"CollapseAll\",\n  EXPAND_SELECTION: \"EditorSelectWord\",\n  SHRINK_SELECTION: \"EditorUnSelectWord\",\n  GO_TO_ACTION: \"GotoAction\",\n  GO_TO_FILE: \"GotoFile\",\n  SHOW_INTENTION_ACTIONS: \"ShowIntentionActions\",\n  EDIT_SOURCE: \"Documentation.EditSource\",\n  SHOW_SEARCH_HISTORY: \"ShowSearchHistory\",\n  COPY_REFERENCE: \"CopyReference\",\n  REFRESH: \"Refresh\",\n  COPY: \"$Copy\",\n  CUT: \"$Cut\",\n  PASTE: \"$Paste\",\n  DELETE: \"$Delete\",\n  CODE_COMPLETION: \"CodeCompletion\",\n};\n","import React, { useContext } from \"react\";\nimport { Shortcut } from \"./Shortcut\";\nimport { defaultKeymap } from \"./defaultKeymap\";\n\nexport interface Keymap {\n  [actionId: string]: ReadonlyArray<Shortcut>;\n}\n\nexport const KeymapContext = React.createContext<Keymap | null>(defaultKeymap);\n\nexport const KeymapProvider: React.FC<{\n  keymap: Keymap;\n  children?: React.ReactNode;\n}> = ({ keymap: keymapProp, children }) => {\n  const parentKeyMap = useContext(KeymapContext);\n  const keymap = Object.assign(Object.create(parentKeyMap), keymapProp);\n  return (\n    <KeymapContext.Provider value={keymap}>{children}</KeymapContext.Provider>\n  );\n};\n\nexport const useKeymap = () => useContext(KeymapContext);\n","type ShortcutType = \"mouse\" | \"keyboard\";\nexport type KeyStrokeModifier = \"Alt\" | \"Shift\" | \"Meta\" | \"Control\";\n\nexport interface KeyStroke {\n  /**\n   * {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key}\n   */\n  code: string;\n  modifiers?: Array<KeyStrokeModifier>;\n}\n\ninterface ShortcutBase {\n  type: ShortcutType;\n}\n\ninterface MouseShortcut extends ShortcutBase {\n  type: \"mouse\";\n}\n\nexport interface KeyboardShortcut extends ShortcutBase {\n  type: \"keyboard\";\n  firstKeyStroke: KeyStroke;\n  secondKeyStroke?: KeyStroke;\n}\n\nexport type Shortcut = MouseShortcut | KeyboardShortcut;\n\nexport const isKeyboardShortcut = (\n  shortcut: Shortcut\n): shortcut is KeyboardShortcut => shortcut.type === \"keyboard\";\n\nexport const supportedModifiers: KeyStrokeModifier[] = [\n  \"Alt\",\n  \"Meta\",\n  \"Shift\",\n  \"Control\",\n];\n","import React from \"react\";\nimport { useAction } from \"@intellij-platform/core/ActionSystem/ActionsProvider\";\nimport {\n  IconButton,\n  IconButtonProps,\n} from \"@intellij-platform/core/IconButton\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport const ActionButton = ({\n  actionId,\n  children,\n  ...otherProps\n}: {\n  actionId: string;\n  /**\n   * Content to show instead of `action.icon`.\n   */\n  children?: React.ReactNode;\n} & IconButtonProps): JSX.Element => {\n  const action = useAction(actionId);\n  if (!action) {\n    return <></>;\n  }\n  const actionButton = (\n    <IconButton\n      isDisabled={action.isDisabled}\n      aria-label={action.title}\n      {...otherProps}\n      onPress={(e) => {\n        action?.perform();\n        otherProps.onPress?.(e);\n      }}\n    >\n      {children || action.icon}\n    </IconButton>\n  );\n  if (action.title) {\n    return (\n      <TooltipTrigger\n        tooltip={\n          <ActionTooltip actionName={action.title} shortcut={action.shortcut} />\n        }\n      >\n        {actionButton}\n      </TooltipTrigger>\n    );\n  }\n  return actionButton;\n};\n","import React from \"react\";\nimport { type ActionGroup } from \"@intellij-platform/core/ActionSystem/ActionGroup\";\nimport { type ActionMenuProps, ActionsMenu } from \"./ActionsMenu\";\n\nexport type ActionGroupMenuProps = Omit<ActionMenuProps, \"actions\"> & {\n  actionGroup: ActionGroup;\n};\n/**\n * Renders children of an action group as a menu.\n */\nexport const ActionGroupMenu = ({\n  actionGroup,\n  ...props\n}: ActionGroupMenuProps) => {\n  return (\n    <ActionsMenu\n      aria-label={actionGroup.title}\n      actions={actionGroup.children}\n      {...props}\n    />\n  );\n};\n","import React from \"react\";\nimport { flatten } from \"ramda\";\nimport { Menu, MenuItemLayout, MenuProps } from \"@intellij-platform/core/Menu\";\nimport { Divider, Item, Section } from \"@intellij-platform/core/Collections\";\nimport { DividerItem } from \"@intellij-platform/core/Collections/Divider\"; // Importing from /Collections breaks the build for some reason\nimport { type ActionGroup } from \"@intellij-platform/core/ActionSystem/ActionGroup\";\nimport {\n  type Action,\n  ActionContext,\n} from \"@intellij-platform/core/ActionSystem/Action\";\n\ntype ActionGroupAsMenuItem = Pick<\n  ActionGroup,\n  \"id\" | \"icon\" | \"title\" | \"isDisabled\" | \"children\" | \"menuPresentation\"\n>;\nexport type ActionItem = ActionGroupAsMenuItem | Action | DividerItem;\n\nfunction isAction(item: ActionItem): item is Action {\n  return \"perform\" in item;\n}\n\ntype ControlledMenuProps = Pick<\n  MenuProps<ActionItem>,\n  \"onAction\" | \"disabledKeys\" | \"items\" | \"children\"\n>;\ntype RenderMenu = (props: ControlledMenuProps) => React.ReactNode;\nexport type ActionMenuProps = {\n  actions: Array<ActionItem>;\n\n  /**\n   * Context with which actions should be performed.\n   * Usually the context by which the ActionsMenu itself is opened.\n   * Pass a function for lazy evaluation when the action is selected from the menu.\n   */\n  actionContext?: ActionContext | (() => ActionContext);\n  /**\n   * Allows for rendering a custom menu component, e.g. {@link SpeedSearchMenu}.\n   * If not provided, {@link Menu} is rendered, receiving additional props that\n   * are passed to `ActionsMenu`.\n   * If it is provided, additional {@link Menu} props are not allowed, and they\n   * can be passed directly to the returned menu element.\n   */\n  children?: RenderMenu;\n} & (\n  | {\n      children: RenderMenu;\n    }\n  | (Omit<MenuProps<ActionItem>, keyof ControlledMenuProps> & {\n      children?: never;\n    })\n);\n/**\n * Given a nested list of resolved actions, renders a menu corresponding to them.\n */\nexport function ActionsMenu({\n  actions,\n  actionContext,\n  children = (actionMenuProps) => <Menu {...actionMenuProps} />,\n  ...otherProps\n}: ActionMenuProps) {\n  const allActions = getAllActions(actions);\n  const disabledKeys = allActions\n    .filter(({ isDisabled }) => isDisabled)\n    .map(({ id }) => id);\n\n  return (\n    <>\n      {children({\n        ...otherProps,\n        onAction: (key) => {\n          const action = allActions.find(({ id }) => id === key);\n          if (action && isAction(action)) {\n            action.perform(\n              typeof actionContext === \"function\"\n                ? actionContext?.()\n                : actionContext\n            );\n          }\n        },\n        disabledKeys,\n        // FIXME: keep isSelected on actions (toggle action) and control selectedKeys too?\n        items: actions,\n        children: (action) => {\n          if (action instanceof DividerItem) {\n            return <Divider />;\n          }\n          return renderActionAsMenuItem(action);\n        },\n      })}\n    </>\n  );\n}\n\ntype ActionAsMenuItem = Omit<Action, \"perform\" | \"shortcuts\">;\n\nexport function renderActionAsMenuItem(\n  action: ActionAsMenuItem | ActionGroupAsMenuItem | DividerItem\n) {\n  const isGroup = \"children\" in action;\n  if (\n    isGroup &&\n    (action.menuPresentation === \"section\" ||\n      action.menuPresentation === \"titledSection\")\n  ) {\n    return (\n      <Section\n        key={action.id}\n        // @ts-expect-error: hasDivider is not yet made a public API.\n        hasDivider\n        aria-label={\n          action.menuPresentation === \"section\" ? action.title : undefined\n        }\n        title={\n          action.menuPresentation === \"titledSection\" ? action.title : undefined\n        }\n        items={action.children}\n      >\n        {renderActionAsMenuItem}\n      </Section>\n    );\n  }\n  if (action instanceof DividerItem) {\n    return <Divider />;\n  }\n  return (\n    <Item\n      key={action.id}\n      textValue={action.title}\n      aria-label={action.title}\n      childItems={\n        isGroup && action.menuPresentation === \"submenu\"\n          ? action.children\n          : undefined\n      }\n    >\n      <MenuItemLayout\n        content={action.title}\n        icon={action.icon}\n        shortcut={\"shortcut\" in action ? action.shortcut : undefined}\n      />\n    </Item>\n  );\n}\n\nfunction getAllActions(items: ActionItem[]): Action[] {\n  return flatten(\n    items.map((item) =>\n      [item].concat(\"children\" in item ? getAllActions(item.children) : [])\n    )\n  ).filter(isAction);\n}\n","import { flatten } from \"ramda\";\nimport React from \"react\";\nimport { Popup, usePopupManager } from \"@intellij-platform/core/Popup\";\nimport { SpeedSearchMenu } from \"@intellij-platform/core/Menu\";\nimport { MENU_POSITION_TARGET_DATA_ATTRIBUTE } from \"@intellij-platform/core/Menu/ContextMenuContainer\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  ActionContext,\n  ActionDefinition,\n  type ActionGroupDefinition,\n  isActionGroupDefinition,\n  useGetActionShortcut,\n} from \"@intellij-platform/core/ActionSystem\";\n\nimport { renderActionAsMenuItem } from \"./ActionsMenu\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\n\nexport const useCreateDefaultActionGroup = () => {\n  const { show } = usePopupManager();\n  const getActionShortcut = useGetActionShortcut();\n  const openActionsInPopup = useEventCallback(\n    (\n      { children, title }: Pick<ActionGroupDefinition, \"children\" | \"title\">,\n      context: ActionContext\n    ) => {\n      show(({ close }) => (\n        <Popup\n          // Maybe an option to conditionally use context-based positioning?\n          positioning={\n            context.element instanceof HTMLElement\n              ? {\n                  targetRef: {\n                    current:\n                      context.element.querySelector(\n                        `[${MENU_POSITION_TARGET_DATA_ATTRIBUTE}]`\n                      ) ?? context.element,\n                  },\n                  placement: \"bottom\",\n                }\n              : undefined\n          }\n        >\n          <Popup.Layout\n            content={\n              /**\n               * NOTE: It would be much nicer to use {@link ActionGroupMenu} component here. But the action group is not\n               * yet provided when the group definition is being created. It seems like a sign of bad design that needs\n               * to get addressed.\n               */\n              <SpeedSearchMenu\n                aria-label={title}\n                items={children.map((item) =>\n                  item === \"divider\" ? new DividerItem() : item\n                )}\n                onAction={(key) => {\n                  // The need for calculating `allActions` is a consequence of the issue explained in the note above.\n                  const allActions = flatten(\n                    children.map((item) =>\n                      item !== \"divider\" && isActionGroupDefinition(item)\n                        ? item.children\n                        : item\n                    )\n                  );\n                  const action = allActions.find(\n                    (action): action is ActionDefinition =>\n                      typeof action === \"object\" && action.id === key\n                  );\n                  if (action && !action.isDisabled) {\n                    action.actionPerformed(context);\n                  }\n                }}\n                onClose={close}\n                autoFocus=\"first\"\n              >\n                {(item) =>\n                  renderActionAsMenuItem(\n                    item instanceof DividerItem\n                      ? item\n                      : {\n                          ...item,\n                          // a consequence of the issue explained in the note above.\n                          shortcut: getActionShortcut(item.id),\n                        }\n                  )\n                }\n              </SpeedSearchMenu>\n            }\n            header={title}\n          />\n        </Popup>\n      ));\n    }\n  );\n\n  return (\n    groupDefinition: Omit<ActionGroupDefinition, \"actionPerformed\">\n  ): ActionGroupDefinition => {\n    return {\n      menuPresentation: \"submenu\",\n      ...groupDefinition,\n      actionPerformed: (context) =>\n        openActionsInPopup(groupDefinition, context),\n    };\n  };\n};\n","import {\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  // For some reason importing from shorter paths doesn't work as expected in cypress \\_()_/\n  // Weirdly, `import *` works in that case.\n} from \"@intellij-platform/core/ToolWindowsImpl/ToolWindowActionIds\";\n\nimport { Keymap } from \"./KeymapProvider\";\nimport { CommonActionId } from \"./CommonActionIds\";\n\n// TODO: OS specific defaults\n// TODO: extract and export action ids\n// NOTE: defaultKeymap doesn't belong to ActionSystem semantically. Would be something to be moved to a separate module\n/**\n * Default Intellij Idea keymapping for common action ids, including tool window actions.\n * @see CommonActionId\n */\nexport const defaultKeymap: Keymap = {\n  [RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowRight\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_LEFT_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowLeft\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_TOP_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowUp\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"ArrowDown\",\n        modifiers: [\"Control\", \"Alt\"],\n      },\n    },\n  ],\n  [MAXIMIZE_TOOL_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Quote\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [FOCUS_EDITOR_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n      },\n    },\n  ],\n  [HIDE_ACTIVE_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Escape\",\n        modifiers: [\"Shift\"],\n      },\n    },\n  ],\n  [HIDE_ALL_WINDOWS_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n        modifiers: [\"Shift\", \"Meta\"],\n      },\n    },\n  ],\n  [JUMP_TO_LAST_WINDOW_ACTION_ID]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F12\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowUp\",\n      },\n    },\n  ],\n  [CommonActionId.SHRINK_SELECTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyW\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n  [CommonActionId.EXPAND_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Equal\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadAdd\",\n      },\n    },\n  ],\n  [CommonActionId.COLLAPSE_ALL]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"Minus\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"NumpadSubtract\",\n      },\n    },\n  ],\n  [CommonActionId.GO_TO_ACTION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyA\",\n      },\n    },\n  ],\n  [CommonActionId.SHOW_INTENTION_ACTIONS]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"Enter\",\n      },\n    },\n  ],\n  [CommonActionId.GO_TO_FILE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\"],\n        code: \"KeyO\",\n      },\n    },\n  ],\n  [CommonActionId.EDIT_SOURCE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"ArrowDown\",\n      },\n    },\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"F4\",\n      },\n    },\n  ],\n  [CommonActionId.SHOW_SEARCH_HISTORY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Alt\"],\n        code: \"ArrowDown\",\n      },\n    },\n  ],\n  [CommonActionId.COPY_REFERENCE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\", \"Shift\", \"Alt\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [CommonActionId.REFRESH]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyR\",\n      },\n    },\n  ],\n  [CommonActionId.DELETE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        code: \"Backspace\",\n      },\n    },\n  ],\n  [CommonActionId.COPY]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyC\",\n      },\n    },\n  ],\n  [CommonActionId.CUT]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyX\",\n      },\n    },\n  ],\n  [CommonActionId.PASTE]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Meta\"],\n        code: \"KeyV\",\n      },\n    },\n  ],\n  [CommonActionId.CODE_COMPLETION]: [\n    {\n      type: \"keyboard\",\n      firstKeyStroke: {\n        modifiers: [\"Control\"],\n        code: \"Space\",\n      },\n    },\n  ],\n};\n","import { fromPairs } from \"ramda\";\nimport { isMac } from \"@react-aria/utils\";\nimport {\n  isKeyboardShortcut,\n  KeyStroke,\n  KeyStrokeModifier,\n  Shortcut,\n} from \"./Shortcut\";\nimport {\n  KeyboardEventKey,\n  LinuxDeadKeys,\n  NumericKeypadKeys,\n  UpperAlpha,\n} from \"./KeyboardEventKey\";\n\nconst defaultKeyToStr: {\n  [key in Exclude<\n    KeyStrokeModifier | KeyboardEventKey,\n    LinuxDeadKeys | UpperAlpha | NumericKeypadKeys\n  >]: string;\n} = {\n  Control: \"Ctrl\",\n  \" \": \"Space\",\n  ArrowDown: \"\",\n  ArrowUp: \"\",\n  ArrowLeft: \"\",\n  ArrowRight: \"\",\n  Enter: \"\",\n  Quote: \"'\",\n  Minus: \"-\",\n  Subtract: \"-\",\n  NumpadAdd: \"+\",\n  Multiply: \"*\",\n  NumpadMultiply: \"*\",\n  Equal: \"+\",\n  Backspace: \"\",\n  // lowercase to uppercase map\n  ...fromPairs(\n    Array.from(Array(26))\n      .map((e, i) => i + \"a\".charCodeAt(0))\n      .map((x) => String.fromCharCode(x))\n      .map((a) => [a, a.toUpperCase()])\n  ),\n};\nconst KeystrokeToString: {\n  separator: string;\n  codeToStr: Record<KeyStrokeModifier | KeyboardEventKey, string>;\n} = isMac()\n  ? {\n      separator: \"\",\n      codeToStr: {\n        ...defaultKeyToStr,\n        Alt: \"\",\n        Shift: \"\",\n        Meta: \"\",\n        Control: \"^\",\n        Escape: \"\",\n      },\n    }\n  : {\n      separator: \"+\",\n      codeToStr: defaultKeyToStr,\n    };\n\nconst modifiersOrder: KeyStrokeModifier[] = [\"Control\", \"Alt\", \"Shift\", \"Meta\"];\nexport const keystrokeToString = (keystroke: KeyStroke) => {\n  return [\n    ...(keystroke.modifiers || []).sort(\n      (a, b) => modifiersOrder.indexOf(a) - modifiersOrder.indexOf(b)\n    ),\n    keystroke.code,\n  ]\n    .map((code) => KeystrokeToString.codeToStr[code] || code)\n    .map((code) => code.replace(/^(Key|Digit|Numpad)(.)$/, \"$2\"))\n    .join(KeystrokeToString.separator);\n};\nexport const shortcutToString = (shortcut: Shortcut) => {\n  if (isKeyboardShortcut(shortcut)) {\n    return [shortcut.firstKeyStroke, shortcut.secondKeyStroke]\n      .filter((i): i is KeyStroke => i != undefined)\n      .map(keystrokeToString)\n      .join(\", \");\n  }\n  throw new Error(\"Not implemented yet\");\n};\n","import { useAction } from \"./ActionsProvider\";\nimport { isResolvedActionGroup, ResolvedActionGroup } from \"./ActionGroup\";\n\nexport const useActionGroup = (\n  actionGroupId: string\n): ResolvedActionGroup | null => {\n  const action = useAction(actionGroupId);\n  if (action) {\n    if (isResolvedActionGroup(action)) {\n      return action;\n    }\n    throw new Error(`Action with id ${actionGroupId} is not a group`);\n  }\n  return null;\n};\n","import React from \"react\";\nimport {\n  ModalWindow,\n  ModalWindowProps,\n} from \"@intellij-platform/core/ModalWindow\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\nimport { styled } from \"../styled\";\nimport { StyledWindowContainer } from \"@intellij-platform/core/ModalWindow/ModalWindow\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { ButtonGroup } from \"@intellij-platform/core/ButtonGroup\";\nimport { isEventOnEmptySpaces } from \"@intellij-platform/core/utils/interaction-utils/useMove\";\n\nexport interface AlertDialogProps\n  extends Pick<ModalWindowProps, \"minWidth\" | \"id\" | \"onClose\"> {\n  /**\n   * Content slot for the heading, aka. title of the dialog. Typically plain text.\n   */\n  heading?: React.ReactNode;\n  /**\n   * Content slot for the body, aka. message of the dialog. Typically plain text.\n   */\n  body?: React.ReactNode;\n  /**\n   * Content slot for the checkbox (\"Do not ask again\").\n   * @example\n   * ```jsx\n   * <AlertDialog checkbox={<Checkbox>Do not ask again</Checkbox>} />\n   * ```\n   * @see Checkbox\n   */\n  checkbox?: React.ReactNode;\n\n  /**\n   * Type of the alert dialog. The icon is set based on type.\n   */\n  type?: \"error\" | \"warning\" | \"information\" | \"question\";\n\n  /**\n   * Content slot for buttons.\n   * @example\n   * ```jsx\n   * <AlertDialog\n   *   buttons={\n   *     <>\n   *       <Button>Cancel</Button>\n   *       <Button variant=\"default\">Ok</Button>\n   *     </>\n   *   }\n   * />\n   * ```\n   * @see Button\n   */\n  buttons?: React.ReactNode;\n\n  /**\n   * Content slot for help icon button in the footer.\n   * @example\n   * ```jsx\n   * <AlertDialog\n   *   helpButton={\n   *     <TooltipTrigger tooltip={<HelpTooltip helpText=\"Show Help Contents\" />}>\n   *       <Button variant=\"icon\">\n   *         <PlatformIcon icon=\"actions/help\"></PlatformIcon>\n   *       </Button>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   * @see Button\n   */\n  helpButton?: React.ReactNode;\n}\n\nconst StyledModalWindow = styled(ModalWindow)`\n  ${StyledWindowContainer} {\n    border-radius: 0;\n    outline: 0.5px solid rgba(0, 0, 0, 0.85); // FIXME\n  }\n`;\n\nconst StyledContainer = styled.div`\n  padding: 1.25rem;\n  display: grid;\n  grid-template-columns: auto 1fr;\n  grid-template-rows: auto auto;\n  align-items: center;\n  gap: 0.875rem;\n`;\n\nconst StyledHeading = styled.h2`\n  margin: 0;\n  font-size: 0.875rem;\n  line-height: 1.25rem;\n  font-weight: bold;\n`;\n\nconst StyledBody = styled.div`\n  line-height: 1.2;\n`;\n\nconst StyledContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  cursor: default;\n`;\n\nconst StyledCheckbox = styled.div`\n  padding: 0.375rem 0;\n  // to align the checkbox with the content, since the box has a padding. Maybe Checkbox should not have any padding.\n  margin-left: -0.25rem;\n`;\n\nconst StyledButtons = styled(ButtonGroup)`\n  display: flex;\n  justify-self: end;\n  gap: 1rem;\n`;\n\nconst StyledIcon = styled.span`\n  align-self: start;\n`;\n\nconst StyledHelpIcon = styled.div`\n  justify-self: center;\n`;\n\n/**\n * A modal dialog implementing [Alert](https://jetbrains.github.io/ui/controls/alert), which is the\n * [notification](https://jetbrains.github.io/ui/controls/notifications/) pattern for use cases where\n * immediate user action is required.\n * Since the use cases are quite specific, and the component is expected to be used with pretty specific\n * content items, the layout is not implemented as a separate component, the way it is in components like\n * {@link ModalWindow} or {@link Menu}\n *\n *\n */\nexport const AlertDialog = ({\n  type = \"question\",\n  heading,\n  body,\n  checkbox,\n  helpButton,\n  buttons,\n  minWidth = 370,\n  ...otherProps\n}: AlertDialogProps): JSX.Element => {\n  return (\n    <StyledModalWindow\n      role=\"alertdialog\"\n      interactions=\"move\"\n      minWidth={minWidth}\n      defaultBounds={{\n        top: window.innerHeight / 4,\n      }}\n      // Reacting to content size, to make sure the content will be visible, considering the window is not resizable.\n      observeContentResize\n      {...otherProps}\n    >\n      <OverlayMoveHandle dragThreshold={6} canMoveStart={isEventOnEmptySpaces}>\n        {({ moveHandleProps }) => (\n          <StyledContainer {...moveHandleProps}>\n            <StyledIcon>\n              {/* Icon name is theme-able in the reference impl via OptionPane[`${icon}Icon`] */}\n              <PlatformIcon size={32} icon={`general/${type}Dialog`} />\n            </StyledIcon>\n            <StyledContent>\n              <StyledHeading>{heading}</StyledHeading>\n              <StyledBody>{body}</StyledBody>\n              {checkbox && <StyledCheckbox>{checkbox}</StyledCheckbox>}\n            </StyledContent>\n            <StyledHelpIcon>{helpButton}</StyledHelpIcon>\n            <StyledButtons>{buttons}</StyledButtons>\n          </StyledContainer>\n        )}\n      </OverlayMoveHandle>\n    </StyledModalWindow>\n  );\n};\n","import React, { ReactNode } from \"react\";\nimport { useWindowManager } from \"@intellij-platform/core/ModalWindow\";\nimport { Button } from \"@intellij-platform/core/Button\";\n\nimport { AlertDialog } from \"./AlertDialog\";\n\nexport interface AlertDialogApi {\n  confirm(options: {\n    title: ReactNode;\n    message: ReactNode;\n    okText?: string;\n    cancelText?: string;\n  }): Promise<boolean>;\n}\n\n/**\n * Similar to com.intellij.openapi.ui.Messages class in the reference impl, provides helper functions\n * to show different types of Alert dialog. The helper functions return a Promise of the selected option,\n * which makes it easy to use it imperatively, in a flow of statements, regardless of how the UI of the\n * alert dialog is handled.\n * {@link useAlertDialog} depends on {@link WindowManager}, to imperatively open modal windows.\n * @experimental\n */\nexport function useAlertDialog(): AlertDialogApi {\n  const { open } = useWindowManager();\n  return {\n    confirm: ({ title, message, okText = \"Ok\", cancelText = \"Cancel\" }) =>\n      new Promise((resolve) => {\n        open(({ close }) => (\n          <AlertDialog\n            type=\"question\"\n            body={message}\n            heading={title}\n            buttons={\n              <>\n                <Button onPress={close}>{cancelText}</Button>\n                <Button\n                  variant=\"default\"\n                  onPress={() => {\n                    resolve(true);\n                    close();\n                  }}\n                >\n                  {okText}\n                </Button>\n              </>\n            }\n            onClose={() => resolve(false)}\n          />\n        ));\n      }),\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nconst CORNER_RADIUS = 12; // it used to be 8. After introduction of Notifications tool window, it's 12\n\nconst bgColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\n    \"Notification.background\",\n    !theme.dark ? \"rgb(242,242,242)\" : \"#4E5052\"\n  );\n\nexport const StyledHeaderActions = styled.div`\n  position: absolute;\n  right: 0;\n  top: 0;\n  background: inherit;\n  padding: 0.375rem 0.5rem 0;\n  &::before {\n    content: \"\";\n    position: absolute;\n    right: 100%;\n    background: linear-gradient(90deg, transparent, ${bgColor});\n    width: 20px;\n    height: 100%;\n    z-index: 1;\n    top: 0;\n  }\n`;\n\nexport const StyledBalloonContainer = styled.div`\n  line-height: 1.2;\n  box-sizing: border-box;\n  overflow: hidden; // header actions overflows a little at the top right rounded corner\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); // shadow doesn't seem to be themed\n  padding: 0.5rem 0;\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"Notification.borderColor\",\n        !theme.dark ? \"#B2B2B2CD\" : \"#565A5CCD\"\n      )};\n  border-radius: ${({ theme }) =>\n    `${\n      (theme.value<number>(\n        \"Notification.arc\" as UnknownThemeProp<\"Notification.arc\">\n      ) ?? CORNER_RADIUS) / 2\n    }px`};\n  //display: inline-flex;\n  width: 23.3125rem;\n  position: relative;\n  background-color: ${bgColor};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Notification.foreground\",\n      !theme.dark ? \"#000\" : \"rgb(191,191,191)\"\n    )};\n\n  ${StyledHeaderActions} {\n    display: none;\n  }\n  &:hover ${StyledHeaderActions} {\n    display: initial;\n  }\n`;\n\nexport const StyledIconContainer = styled.span`\n  position: absolute;\n  left: 0.75rem;\n  top: 0.5rem;\n`;\n\nexport const StyledBalloonHeader = styled.div`\n  line-height: 1rem;\n  font-weight: bold;\n  margin: 0 2.125rem 0.25rem;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis; // this is not the case in original impl, but it's a clear improvement\n`;\n\nexport const StyledBalloonBody = styled.div<{\n  lineClamp: number | false;\n}>`\n  margin: 0 2.125rem 0 2.125rem;\n  line-height: 1rem;\n  display: inline;\n  -webkit-line-clamp: ${({ lineClamp }) => lineClamp};\n  word-break: ${({ lineClamp }) => lineClamp === 1 && \"break-all\"};\n  text-overflow: ellipsis;\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  word-wrap: break-word;\n`;\n\nexport const StyledBalloonFooter = styled.div`\n  margin: 0.375rem 1.875rem 0 2.125rem;\n  display: inline-flex;\n  white-space: nowrap;\n  overflow: hidden;\n  gap: 1rem;\n\n  // could be -webkit-fill-available too, if it has good support. Probably it doesn't tho\n  max-width: calc(100% - 3.5rem);\n`;\n\nexport const StyledToggleIconContainer = styled.span`\n  display: inline-flex;\n  position: absolute;\n  right: 0.5rem;\n  bottom: 0;\n  background-color: ${bgColor};\n  padding-left: 0.5rem;\n`;\n\nexport const StyledToggleExpandButtonContainer = styled.span`\n  display: block;\n  position: relative; // for icon absolute positioning\n  cursor: pointer;\n  flex: 1;\n`;\n\nexport const StyledToggleExpandButtonFooterContainer = styled(\n  StyledToggleExpandButtonContainer\n)`\n  min-height: 1.5rem;\n  margin: -0.5rem 0;\n  position: relative;\n  z-index: 1;\n  ${StyledToggleIconContainer} {\n    bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter} {\n    margin-top: 0.875rem;\n    margin-bottom: 0.5rem;\n  }\n  ${StyledBalloonFooter}:hover + * .icon[data-hover] {\n    display: none;\n  }\n  ${StyledBalloonFooter}:hover + * .icon {\n    display: unset;\n  }\n`;\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\nimport { IconProps } from \"@intellij-platform/core/Icon/IconProps\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  StyledBalloonBody,\n  StyledBalloonContainer,\n  StyledBalloonFooter,\n  StyledBalloonHeader,\n  StyledHeaderActions,\n  StyledIconContainer,\n  StyledToggleExpandButtonContainer,\n  StyledToggleExpandButtonFooterContainer,\n  StyledToggleIconContainer,\n} from \"@intellij-platform/core/Balloon/Balloon.styled\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { Link } from \"@intellij-platform/core/Link\";\n\nexport type BalloonProps = ControlledStateProps<{ expanded: boolean }> &\n  DOMProps & {\n    /**\n     * Icon rendered in the top left\n     */\n    icon?: \"Info\" | \"Warning\" | \"Error\" | React.ReactElement<IconProps>;\n    /**\n     * Rendered beside close button. Can be used for rendering a \"notification settings\" icon button.\n     */\n    headerActions?: React.ReactNode;\n    /**\n     * Called when the close button is clicked. If not passed, close button will not be rendered.\n     */\n    onClose?: () => void;\n    /**\n     * Actions rendered in the footer.\n     */\n    actions?: React.ReactNode;\n  } & (\n    | {\n        title?: React.ReactNode;\n        body: React.ReactNode;\n      }\n    | {\n        title: React.ReactNode;\n        body?: React.ReactNode;\n      }\n  );\n\ntype BalloonContextObj = {\n  onClose?: () => void;\n};\nconst BalloonContext = React.createContext<BalloonContextObj | null>(null);\n\n/**\n * A tiny wrapper around {@link Link} component, to be used for actions in Balloon.\n * It closes the balloon when pressed.\n */\nexport const BalloonActionLink: typeof Link = React.forwardRef(\n  ({ onPress, ...props }, ref) => {\n    const context = useContext(BalloonContext);\n    if (context === null) {\n      throw new Error(\n        \"BalloonActionLink should only be rendered inside Balloon notifications\"\n      );\n    }\n    return (\n      <Link\n        ref={ref}\n        {...props}\n        onPress={(...args) => {\n          context?.onClose?.();\n          return onPress?.(...args);\n        }}\n      />\n    );\n  }\n);\n/**\n * [Balloon notification](https://jetbrains.github.io/ui/controls/balloon/) UI.\n *\n * Notes and TODO:\n * - Add support for \"error\" variant: https://github.com/JetBrains/intellij-community/blob/48c024fcd38bd8d1eccdada05489a8952a494270/platform/platform-impl/src/com/intellij/diagnostic/IdeMessagePanel.java#L215\n * - Add support for timeout. Although if the auto close behaviour is only timeout-based, maybe there is not much value in adding a prop for it and calling onClose on timeout.\n * - BalloonActions component to be used for rendering a bunch of links in the actions. It should encapsulate the\n *   behaviour of moving actions into a menu when there is not enough room.\n */\nexport const Balloon = ({\n  icon: iconProp = \"Info\",\n  expanded: expandedProp,\n  defaultExpanded = false,\n  onExpandedChange,\n  title,\n  headerActions,\n  onClose,\n  body,\n  actions,\n  ...containerProps\n}: BalloonProps): React.ReactElement => {\n  const bodyRef = useRef<HTMLDivElement>(null);\n  const [expandable, setExpandable] = useState(false);\n  const [expanded, setExpanded] = useControlledState(\n    expandedProp!,\n    defaultExpanded,\n    onExpandedChange!\n  );\n  const maxLinesWhenNotExpanded = 1 + (title ? 0 : 1) + (actions ? 0 : 1);\n\n  useEffect(() => {\n    const bodyElem = bodyRef.current;\n    if (bodyElem) {\n      setExpandable(\n        expanded\n          ? getNumLines(bodyElem) > maxLinesWhenNotExpanded\n          : bodyElem.scrollHeight > bodyElem.clientHeight\n      );\n    } else {\n      setExpandable(false);\n    }\n  }, [expanded]);\n  const validIconTypes = [\"Error\", \"Warning\", \"Info\"] as const;\n  const icon =\n    typeof iconProp === \"string\" ? (\n      <PlatformIcon\n        icon={`general/notification${validIconTypes.find(\n          (iconType, index, arr) =>\n            iconType === iconProp || index === arr.length - 1\n        )}.svg`}\n      />\n    ) : (\n      iconProp\n    );\n  // @ts-expect-error support for callback updater is removed from useControlledState. https://github.com/adobe/react-spectrum/issues/2320\n  const toggle = () => setExpanded((expanded) => !expanded);\n\n  const effectiveExpanded = expanded && Boolean(body);\n\n  return (\n    <BalloonContext.Provider value={{ onClose }}>\n      <StyledBalloonContainer data-testid=\"balloon\" {...containerProps}>\n        <StyledIconContainer>{icon}</StyledIconContainer>\n        {title && <StyledBalloonHeader>{title}</StyledBalloonHeader>}\n        <StyledHeaderActions>\n          {headerActions}\n          {onClose && (\n            <AutoHoverPlatformIcon\n              icon=\"ide/notification/close.svg\"\n              onClick={onClose}\n              role=\"button\"\n              data-testid=\"close-btn\"\n              style={{ marginLeft: \"0.75rem\" }}\n            />\n          )}\n        </StyledHeaderActions>\n        {body && (\n          <ToggleWrapper\n            expanded={effectiveExpanded}\n            enabled={expandable && !effectiveExpanded}\n            onToggle={toggle}\n          >\n            <StyledBalloonBody\n              lineClamp={!effectiveExpanded && maxLinesWhenNotExpanded}\n              ref={bodyRef}\n            >\n              {body}\n            </StyledBalloonBody>\n          </ToggleWrapper>\n        )}\n        <ToggleWrapper\n          expanded={effectiveExpanded}\n          enabled={expandable && effectiveExpanded}\n          onToggle={toggle}\n          Component={StyledToggleExpandButtonFooterContainer}\n        >\n          {actions && (\n            <StyledBalloonFooter onClick={(e) => e.stopPropagation()}>\n              {actions}\n            </StyledBalloonFooter>\n          )}\n        </ToggleWrapper>\n      </StyledBalloonContainer>\n    </BalloonContext.Provider>\n  );\n};\n\n/**\n * If enabled wraps its children in a clickable area (with the expand/collapse arrow),f for toggling expanded state.\n */\nconst ToggleWrapper: React.FC<{\n  children?: React.ReactNode;\n  enabled: boolean;\n  expanded: boolean;\n  Component?: typeof StyledToggleExpandButtonContainer;\n  onToggle: () => void;\n}> = ({\n  children,\n  onToggle,\n  expanded,\n  enabled,\n  Component = StyledToggleExpandButtonContainer,\n}) => {\n  const iconName = expanded ? \"collapse\" : \"expand\";\n  const toggleIcon = (\n    <StyledToggleIconContainer>\n      <AutoHoverPlatformIcon\n        hoverContainerSelector={`${Component}`}\n        icon={`ide/notification/${iconName}.svg`}\n        className=\"icon\"\n      />\n    </StyledToggleIconContainer>\n  );\n\n  return enabled ? (\n    <Component\n      onClick={onToggle}\n      role=\"button\"\n      data-testid={`${expanded ? \"collapse\" : \"expand\"}-btn`}\n    >\n      {children}\n      {toggleIcon}\n    </Component>\n  ) : (\n    <>{children}</>\n  );\n};\n\n/**\n * Based on the computed line-height and clientHeight of the element, returns the number of lines of the content.\n */\nfunction getNumLines(bodyElem: Element) {\n  return (\n    bodyElem.clientHeight / parseFloat(getComputedStyle(bodyElem).lineHeight)\n  );\n}\n","import React, {\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Balloon, BalloonProps } from \"./Balloon\";\nimport { StyledBalloonsStack } from \"./StyledBalloonsStack\";\n\ntype ShowProps = Pick<\n  BalloonProps,\n  \"title\" | \"icon\" | \"body\" | \"actions\" | \"headerActions\"\n>;\n\nexport interface BalloonManagerAPI {\n  /**\n   * Shows a Balloon notification on the bottom left of the screen.\n   * @param props: Props to pass to the Balloon component\n   * @param [autoHideTimeout=10_000] timeout in ms for hiding the balloon notification.\n   * @returns hide function, in case the notification can expire for some reason.\n   */\n  show(props: ShowProps, autoHideTimeout?: number): () => void;\n  showSticky(props: ShowProps): () => void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\"You must render a BalloonManager...\");\n};\n\nconst BalloonsContext = React.createContext<BalloonManagerAPI>({\n  show: NotImplementedFn,\n  showSticky: NotImplementedFn,\n});\n\nexport const useBalloonManager = (): BalloonManagerAPI =>\n  useContext(BalloonsContext);\n\ntype BalloonElement = ReactElement<BalloonProps, typeof Balloon>;\n\nexport interface BalloonManagerProps {\n  disablePortal?: boolean;\n  BalloonsContainer?: React.ElementType;\n  children?: React.ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link useBalloonManager}) for showing Balloon notifications on the bottom right of the screen.\n * It renders notifications in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n * @param disablePortal: if `true`, the container for notifications will not be rendered in a portal\n * @param BalloonsContainer: container component for the notifications. It's {@link StyledBalloonsStack} by default.\n *\n * TODO: fade in/out transition. Notes:\n *  - Doesn't seem fade-in is needed. Tho it's much easier than fade-out, as it can be achieved with a css animation.\n *  - Fade out should happen only when the balloon is being hidden by timeout.\n * TODO: Support for maximum number of notifications and showing \"x more notification(s)\" button if the limit exceeds\n */\n\nexport const BalloonManager: React.FC<BalloonManagerProps> = ({\n  children,\n  disablePortal,\n  BalloonsContainer = StyledBalloonsStack,\n}) => {\n  const [balloons, setBalloons] = useState<Array<BalloonElement>>([]);\n  const timeoutIdsRef = useRef<number[]>([]);\n  const lastIdRef = useRef<number>(0);\n\n  const api = useMemo<BalloonManagerAPI>(() => {\n    const show: BalloonManagerAPI[\"show\"] = (props, timeout = 10_000) => {\n      lastIdRef.current++;\n      const onClose = () => {\n        setBalloons((balloons) =>\n          balloons.filter((aBalloon) => aBalloon !== balloon)\n        );\n      };\n      const balloon = (\n        <Balloon\n          key={lastIdRef.current}\n          {...props}\n          title={props.title} // TS acts unreasonable without this\n          onClose={onClose}\n        />\n      );\n      setBalloons((balloons) => {\n        if (timeout > 0) {\n          const timeoutId = window.setTimeout(() => {\n            onClose();\n            timeoutIdsRef.current = timeoutIdsRef.current.filter(\n              (aTimeoutId) => aTimeoutId !== timeoutId\n            );\n          }, timeout);\n          timeoutIdsRef.current = [...timeoutIdsRef.current, timeoutId];\n        }\n        return balloons.concat(balloon);\n      });\n      return onClose;\n    };\n    return {\n      show,\n      showSticky: (props) => show(props, 0),\n    };\n  }, []);\n\n  // clear timeouts when unmounted\n  useEffect(() => {\n    return () => {\n      timeoutIdsRef.current.forEach((id) => {\n        window.clearTimeout(id);\n      });\n    };\n  }, []);\n\n  const notificationsStack = (\n    <BalloonsContainer\n      style={{ position: disablePortal ? \"absolute\" : undefined }}\n    >\n      {balloons}\n    </BalloonsContainer>\n  );\n\n  return (\n    <BalloonsContext.Provider value={api}>\n      {children}\n      {disablePortal\n        ? notificationsStack\n        : ReactDOM.createPortal(notificationsStack, document.body)}\n    </BalloonsContext.Provider>\n  );\n};\n","import styled from \"styled-components\";\nimport { StyledBalloonContainer } from \"@intellij-platform/core/Balloon/Balloon.styled\";\n\n/**\n * Container component for stacking a number of Balloons in an overlay placed on the bottom right of where it's rendered.\n */\nexport const StyledBalloonsStack = styled.div`\n  position: fixed;\n  z-index: 1;\n  bottom: 42px;\n  right: 26px;\n  ${StyledBalloonContainer} {\n    margin-bottom: 12px;\n  }\n`;\n","import React, { ForwardedRef, JSXElementConstructor } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  AriaBaseButtonProps,\n  AriaButtonProps,\n  ButtonProps,\n} from \"@react-types/button\";\n\nexport interface BareButtonProps extends AriaBaseButtonProps, ButtonProps {\n  children: React.ReactElement;\n  elementType?: AriaButtonProps[\"elementType\"];\n\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n}\n\n/**\n * A component to make arbitrary content an accessible button which is also able to be a tooltip trigger.\n */\nexport const BareButton = React.forwardRef(function BareButton(\n  { elementType: elementTypeProp, ...props }: BareButtonProps,\n  forwardedRef: ForwardedRef<HTMLElement>\n) {\n  const elementType =\n    elementTypeProp ||\n    (React.isValidElement(props.children) &&\n    typeof props.children.type === \"string\"\n      ? (props.children.type as unknown as JSXElementConstructor<unknown>)\n      : undefined) ||\n    \"button\";\n  const ref = useObjectRef(forwardedRef);\n  const { buttonProps } = useButton(\n    {\n      elementType,\n      ...props,\n    },\n    ref\n  );\n  const domProps = filterDOMProps(props);\n  const { autoFocus } = props;\n\n  return React.cloneElement(\n    props.children,\n    mergeProps(domProps, buttonProps, { autoFocus, ref })\n  );\n});\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport const StyledButton = styled.button<{ disabled?: boolean }>`\n  box-sizing: border-box;\n  min-width: 4.5rem; // https://jetbrains.github.io/ui/controls/button/#28\n  padding: 0 0.875rem; // https://jetbrains.github.io/ui/controls/button/#28\n  height: 1.5rem;\n  font-family: inherit;\n  background-color: ${({ theme, disabled }) =>\n    disabled ? \"transparent\" : theme.color(\"Button.startBackground\")};\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"Button.disabledText\")\n      : theme.color(\n          \"Button.foreground\" as UnknownThemeProp<\"Button.foreground\">\n        )};\n  border: 1px solid\n    ${({ theme, disabled }) =>\n      disabled\n        ? theme.color(\"Button.disabledBorderColor\")\n        : theme.color(\"Button.startBorderColor\")};\n  border-radius: ${({ theme }) =>\n    (theme.value<number>(\"Button.arc\") ?? 6) / 2}px;\n  box-shadow: ${({ theme }) =>\n    theme.value(\"Button.paintShadow\")\n      ? `0 0 0 ${theme.value(\"Button.shadowWidth\") ?? 2}px ${\n          theme.color(\"Button.shadowColor\") ?? // Button.darcula.shadowColor default is skipped.\n          (theme.dark ? \"#36363680\" : \"#a6a6a633\")\n        }`\n      : \"\"};\n  white-space: nowrap; // https://jetbrains.github.io/ui/controls/button/#29\n\n  flex-shrink: 0; // button should not shrink when rendered in a flex container\n\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.focusedBorderColor\", \"#87afda\")};\n    outline: none;\n    box-shadow: ${({ theme }) =>\n      `0 0 0 2px ${\n        // NOTE: by not using the second argument for default value, we prioritize *.focusColor over the rest.\n        theme.color(\"Component.focusColor\") ??\n        theme.color(\n          \"Focus.borderColor\" as UnknownThemeProp<\"Focus.borderColor\">,\n          \"#8ab2eb\"\n        )\n      }`};\n  }\n`;\nexport const StyledDefaultButton = styled(StyledButton)`\n  background-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBackground\", \"#384f6b\")};\n  color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.foreground\")};\n  border-color: ${({ theme, disabled }) =>\n    !disabled && theme.color(\"Button.default.startBorderColor\", \"#BFBFBF\")};\n  &:focus,\n  &.focus /* for testing purposes*/ {\n    border-color: ${({ theme }) =>\n      theme.color(\"Button.default.focusedBorderColor\", \"#87afda\")};\n  }\n`;\n\nexport const StyledIconButton = styled(StyledButton)`\n  border-radius: 1000px;\n  padding: 0;\n  line-height: 0;\n  min-width: 0;\n  height: 1.5rem;\n  width: 1.5rem;\n`;\n","import React, {\n  ButtonHTMLAttributes,\n  CSSProperties,\n  ForwardedRef,\n} from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { AriaButtonProps } from \"@react-types/button\";\nimport { filterDOMProps, mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  StyledButton,\n  StyledDefaultButton,\n  StyledIconButton,\n} from \"@intellij-platform/core/Button/StyledButton\";\nimport { MnemonicTrigger } from \"@intellij-platform/core/Mnemonic\";\nimport { PressEvent } from \"@react-types/shared/src/events\";\n\ntype ButtonVariant = \"default\" | \"icon\";\nexport interface ButtonProps extends AriaButtonProps {\n  variant?: ButtonVariant; // can allow for custom (styled) component too if needed.\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  // Should this be become true by default? Maybe an context-based API to set defaults like this for a section?\n  preventFocusOnPress?: boolean;\n\n  form?: ButtonHTMLAttributes<HTMLButtonElement>[\"form\"];\n  style?: CSSProperties;\n  /**\n   * A character to be used as {@link https://jetbrains.design/intellij/principles/mnemonics/ mnemonic} for the button\n   * It will be shown as underlined in button text, when mnemonic is activated (by pressing Alt)\n   * Note: if you use mnemonic, and the direct child of the button is not a string, you should use `MnemonicText`\n   * to render the button text, to have the underlining behavior.\n   */\n  mnemonic?: string;\n  className?: string;\n\n  /**\n   * Called when the button is pressed, or triggered via mnemonic. If mnemonic is used, there won't be any event\n   * passed to onPress callback.\n   */\n  onPress?: (e?: PressEvent) => void;\n}\n\nconst variants: { [key in ButtonVariant]: typeof StyledButton } = {\n  default: StyledDefaultButton,\n  icon: StyledIconButton,\n};\n\n/**\n * https://jetbrains.github.io/ui/controls/button/\n *\n * TODO:\n * - Support for \"default\" button behaviour. it's kind of similar to a <button type=\"submit\" /> in html, but textarea\n * behaviour is different from what is explained here: https://jetbrains.github.io/ui/controls/button/#16\n * Cmd+Enter should always trigger onPress. Plus, maybe it should work independent of \"form\" being used? or maybe it's\n * not a big deal to expect an ancestor \"form\" element, when variant is \"default\"?\n * - \"Default\" style differences in Windows.\n * - Gradient colors (low hanging fruit, but negligible added value).\n *\n * Known issues:\n * - In the original impl, default button looks the same as normal button, when focus is not within the same area that\n * the button is. For example in the commit tool window, \"Commit\" button which is default, is not blue, unless the\n * \"Commit\" tool window is focused. This particular case can easily be achieved by conditionally setting variant to,\n * \"default\" based on tool window focus state, which is accessible via useDefaultToolWindowContext(), if\n * DefaultToolWindow is used. But we need to see if the same requirement exists in various places.\n * NOTE: this item is related to the first item in the to-do list above. There can be a container kind of component,\n * which enables \"default\" behaviour and look. Maybe it can be FocusScope or at least related to FocusScope.\n * - In the original impl, there is no visual clue for pressed state, which is poor accessibility. For now, the same\n * behaviour is followed here too. But we may reconsider deviating from the original impl for an improvement here.\n *\n */\nexport const Button: React.FC<ButtonProps> = React.forwardRef(function Button(\n  { variant, style, className, mnemonic, ...props }: ButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const { buttonProps } = useButton(props, ref);\n  const domProps = filterDOMProps(props);\n  const { autoFocus, form } = props;\n\n  const Component = (variant && variants[variant]) || StyledButton;\n  return (\n    <Component\n      {...mergeProps(domProps, buttonProps, { autoFocus, form })}\n      style={style}\n      className={className}\n      ref={ref}\n    >\n      {mnemonic ? (\n        <MnemonicTrigger\n          mnemonic={mnemonic}\n          isDisabled={props.isDisabled}\n          onTriggered={props.onPress}\n        >\n          {props.children}\n        </MnemonicTrigger>\n      ) : (\n        props.children\n      )}\n    </Component>\n  );\n});\n","import React, { CSSProperties, ReactNode } from \"react\";\nimport { DOMAttributes, FocusableElement } from \"@react-types/shared\";\nimport { FocusScope, useFocusManager } from \"@react-aria/focus\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport interface ButtonGroupProps {\n  children: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n}\n\nconst StyledButtonGroup = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 0.75rem;\n`;\n\n/**\n * `ButtonGroup` should be used as a wrapper around related {@link Button Buttons}, in places such as the\n * footer of a dialog. It does two things:\n * - allows for moving the focus between the buttons with left/right arrow keys.\n * - applies the right spacing between the buttons\n *\n * @see Button\n */\nexport function ButtonGroup(props: ButtonGroupProps) {\n  return (\n    <FocusScope>\n      <HorizontalArrowKeyNavigation>\n        {(arrowKeyNavigationProps) => (\n          <StyledButtonGroup {...mergeProps(props, arrowKeyNavigationProps)} />\n        )}\n      </HorizontalArrowKeyNavigation>\n    </FocusScope>\n  );\n}\n\nfunction HorizontalArrowKeyNavigation({\n  children,\n}: {\n  children: (props: DOMAttributes<FocusableElement>) => ReactNode;\n}) {\n  const focusManager = useFocusManager();\n  const { keyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (!hasAnyModifier(e)) {\n        if (e.key === \"ArrowLeft\") {\n          return focusManager?.focusPrevious({ wrap: true });\n        } else if (e.key === \"ArrowRight\") {\n          return focusManager?.focusNext({ wrap: true });\n        }\n      }\n      e.continuePropagation();\n    },\n  });\n\n  return <>{children(keyboardProps)}</>;\n}\n","import React, { HTMLProps, ReactNode } from \"react\";\nimport { useToggleState } from \"@react-stately/toggle\";\nimport { useCheckbox } from \"@react-aria/checkbox\";\nimport {\n  AriaLabelingProps,\n  FocusableDOMProps,\n  FocusableProps,\n  InputBase,\n} from \"@react-types/shared\";\nimport { useFocusRing } from \"@react-aria/focus\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { CheckboxIcon } from \"./CheckboxIcon\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { MnemonicTrigger } from \"@intellij-platform/core/Mnemonic\";\n\nexport interface CheckboxProps\n  extends InputBase,\n    FocusableDOMProps,\n    AriaLabelingProps,\n    FocusableProps {\n  /**\n   * If set to true, the checkbox won't be focusable.\n   * Common use cases:\n   * - When checkbox is rendered in a focusable container, like a list item where the focus should not be taken away\n   *   from that container.\n   * - \"Amend\" checkbox in \"Commit\" tool window. The focus is kept in the commit message or changes tree, perhaps, for\n   *   a questionably better UX.\n   * Note: Passing {@link excludeFromTabOrder} will still let the checkbox be focusable, while `preventFocus`, doesn't\n   * let the component get focused at all.\n   * TODO(potential): it might be nicer to have a `preventFocusOnPress` prop consistent with IconButton, instead.\n   *  In that case preventing focus completely would be achieved with `preventFocusOnPres` and `excludeFromTabOrder`.\n   */\n  preventFocus?: boolean;\n\n  /**\n   * By default, focus ring is always shown when the checkbox is focused, independent of the interaction method.\n   * if set to false, the focus will be only visible if the interaction is done via keyboard or screen readers.\n   * Similar to how [:focus-visible](https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible) works.\n   */\n  disableFocusAlwaysVisible?: boolean;\n\n  /**\n   * Indeterminism is presentational only.\n   * The indeterminate visual representation remains regardless of user interaction.\n   */\n  isIndeterminate?: boolean;\n\n  /**\n   * The label for the element.\n   */\n  children?: ReactNode;\n\n  /**\n   * Whether the element should be selected (uncontrolled).\n   */\n  defaultSelected?: boolean;\n  /**\n   * Whether the element should be selected (controlled).\n   */\n  isSelected?: boolean;\n  /**\n   * Handler that is called when the element's selection state changes.\n   */\n  onChange?: (isSelected: boolean) => void;\n  /**\n   * The value of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefvalue).\n   */\n  value?: string;\n  /**\n   * The name of the input element, used when submitting an HTML form. See [MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefname).\n   */\n  name?: string;\n\n  className?: string; // to support styled-components\n\n  /**\n   * A character to be used as {@link https://jetbrains.design/intellij/principles/mnemonics/ mnemonic} for the button\n   * It will be shown as underlined in button text, when mnemonic is activated (by pressing Alt)\n   * Note: if you use mnemonic, and the direct child of the button is not a string, you should use `Mnemonic.Text`\n   * to render the button text, to have the underlining behavior.\n   */\n  mnemonic?: string;\n}\n\nconst StyledWrapperLabel = styled.label`\n  position: relative;\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst StyledCheckboxLabelText = styled.span<{\n  isDisabled: boolean | undefined;\n}>`\n  margin-left: 0.25rem;\n  color: ${({ theme, isDisabled }) =>\n    isDisabled\n      ? theme.color(\n          \"CheckBox.disabledText\" as UnknownThemeProp<\"CheckBox.disabledText\">,\n          \"#808080\" /* this default value was a bit tricky. Still not clear from where it comes in darcular \n          theme when there is no clue of Checkbox.disabledText or *.disabledText. Note that using \n          CheckBox.disabledForeground is not a good option, because it's something other than #808080 for darcula */\n        )\n      : theme.color(\"*.foreground\")};\n`;\n\nconst StyledInput = styled.input`\n  opacity: 0.0001;\n  position: absolute;\n  z-index: 1;\n  inset: 0;\n  cursor: default;\n  &:disabled {\n    cursor: default;\n  }\n`;\n\n/**\n * Checkbox component to be used with or without a label.\n *\n * While the checkbox without the label + preventFocus makes it usable in tree/list, it might be more optimized to\n * use a more lightweight component like ListItemCheckbox, which uses CheckboxIcon with a simple press handle. Without\n * any input, state, etc.\n */\nexport const Checkbox = ({\n  preventFocus,\n  className,\n  disableFocusAlwaysVisible,\n  mnemonic,\n  ...props\n}: CheckboxProps) => {\n  const state = useToggleState(props);\n  const ref = React.useRef<HTMLInputElement>(null);\n  const { inputProps } = useCheckbox(props, state, ref);\n\n  const { isFocusVisible, isFocused, focusProps } = useFocusRing({\n    autoFocus: props.autoFocus,\n  });\n\n  const focusDisabledProps: Pick<\n    HTMLProps<HTMLInputElement>,\n    \"onFocusCapture\" | \"tabIndex\"\n  > = preventFocus\n    ? {\n        onFocusCapture: (event) => {\n          event.stopPropagation();\n          event.preventDefault();\n          if (event.relatedTarget instanceof HTMLElement) {\n            event.relatedTarget.focus();\n          } else {\n            event.target.blur();\n          }\n        },\n        tabIndex: -1,\n      }\n    : {};\n\n  return (\n    <StyledWrapperLabel className={className}>\n      <StyledInput\n        {...mergeProps(inputProps, focusProps, focusDisabledProps)}\n        ref={ref}\n      />\n      <CheckboxIcon\n        isIndeterminate={props.isIndeterminate}\n        isFocused={disableFocusAlwaysVisible ? isFocusVisible : isFocused}\n        isSelected={props.isIndeterminate || state.isSelected}\n        isDisabled={props.isDisabled}\n        aria-hidden=\"true\"\n        style={{\n          pointerEvents: \"none\",\n        }}\n      />\n      {props.children && (\n        <StyledCheckboxLabelText isDisabled={props.isDisabled}>\n          {mnemonic ? (\n            <MnemonicTrigger\n              mnemonic={mnemonic}\n              isDisabled={props.isDisabled}\n              onTriggered={state.toggle}\n            >\n              {props.children}\n            </MnemonicTrigger>\n          ) : (\n            props.children\n          )}\n        </StyledCheckboxLabelText>\n      )}\n    </StyledWrapperLabel>\n  );\n};\n","import React, { ComponentProps } from \"react\";\nimport { LafIcon } from \"@intellij-platform/core/Icon\";\n\n/**\n * Renders checkbox UI in different states (focused, selected, indeterminate, etc.), without having anything to do\n * with the interactions\n */\nexport const CheckboxIcon = ({\n  isDisabled,\n  isFocused,\n  isIndeterminate,\n  isSelected,\n  ...otherProps\n}: Omit<ComponentProps<typeof LafIcon>, \"size\" | \"icon\"> & {\n  isIndeterminate: boolean | undefined;\n  isFocused: boolean;\n  isDisabled: boolean | undefined;\n  isSelected: boolean;\n}) => {\n  return (\n    <LafIcon\n      {...otherProps}\n      size={20}\n      icon={{\n        name: isIndeterminate ? \"checkBoxIndeterminate\" : \"checkBox\",\n        modifiers: {\n          Disabled: isDisabled,\n          Selected: isSelected || isIndeterminate,\n          Focused: isFocused,\n        },\n      }}\n    />\n  );\n};\n","import React from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { CollectionSpeedSearchMatches } from \"./useCollectionSpeedSearchResult\";\n\nexport type CollectionSpeedSearchContextValue = {\n  matches: CollectionSpeedSearchMatches;\n  collection: Collection<Node<unknown>>;\n};\n\nexport const CollectionSpeedSearchContext =\n  React.createContext<CollectionSpeedSearchContextValue | null>(null);\n","import React, { Key, useContext } from \"react\";\nimport { TextWithHighlights } from \"@intellij-platform/core/TextWithHighlights/TextWithHighlights\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch/CollectionSpeedSearchContext\";\n\ntype CollectionSpeedSearchItemContextValue = {\n  text: string;\n  highlightedRanges: null | TextRange[];\n};\n\nconst CollectionSpeedSearchItemContext =\n  React.createContext<null | CollectionSpeedSearchItemContextValue>(null);\n\nexport const SpeedSearchItemHighlightsProvider: React.FC<{\n  children?: React.ReactNode;\n  itemKey: Key;\n}> = ({ children, itemKey }) => {\n  const context = useContext(CollectionSpeedSearchContext);\n  if (!context) {\n    throw new Error(\n      `SpeedSearchItemProvider is only meant to be rendered by collection components with speed search. \n      CollectionSpeedSearchContext is expected to be rendered as a wrapper around all items.`\n    );\n  }\n  const item = context.collection.getItem(itemKey);\n  const text = item?.textValue ?? \"\";\n  if (!text && item?.props.textValue === undefined) {\n    console.warn(\n      \"no textValue specified on Item. When using SpeedSearch, you need to specify textValue for item, which will be the basis for search\"\n    );\n  }\n  return (\n    <CollectionSpeedSearchItemContext.Provider\n      value={{\n        highlightedRanges: context.matches.get(itemKey) || null,\n        text: text,\n      }}\n    >\n      {children}\n    </CollectionSpeedSearchItemContext.Provider>\n  );\n};\n\n/**\n * Used inside Item content, to render the textValue of the Item, potentially with highlighted ranges if it's a match\n * in current search.\n */\nexport const HighlightedTextValue = function ({\n  Component = \"span\",\n}: {\n  /**\n   * When rendering in a flex parent (which is the case for tree or list), rendering a container is necessary to have\n   * the right spacing around highlights, when the highlighter span is immediately followed or proceeded by a white\n   * space. By default, a \"span\" is rendered.\n   */\n  Component?: React.ElementType;\n}) {\n  const speedSearchContext = React.useContext(CollectionSpeedSearchItemContext);\n  if (!speedSearchContext) {\n    throw new Error(\n      \"HighlightedTextValue should be rendered only in items of a speed search enabled collection component\"\n    );\n  }\n  const { highlightedRanges, text } = speedSearchContext;\n  return (\n    <Component>\n      {highlightedRanges ? (\n        <TextWithHighlights highlights={highlightedRanges}>\n          {text}\n        </TextWithHighlights>\n      ) : (\n        text\n      )}\n    </Component>\n  );\n};\n","import { Key, useEffect, useMemo } from \"react\";\nimport { minusculeMatch } from \"../minusculeMatch\";\nimport { SpeedSearchState } from \"../SpeedSearch/useSpeedSearch\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { createSpeedSearchSelectionManager } from \"./createSpeedSearchSelectionManager\";\nimport { TextRange } from \"@intellij-platform/core/TextRange\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nexport type CollectionSpeedSearchMatches = Map<Key, TextRange[]>;\n\nexport function useCollectionSpeedSearchResult<T>({\n  collection,\n  selectionManager: inputSelectionManager,\n  speedSearch,\n  focusBestMatch = false,\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  speedSearch: SpeedSearchState;\n  /**\n   * If true, focusing the best match (the longest \"start-with\" match) will be preferred.\n   * By default, the focus is moved to the first match that comes after the currently focused item, if currently\n   * focused item itself is not a match.\n   * A typical use case would be collections that filter out non-match items.\n   * @default false\n   */\n  focusBestMatch?: boolean;\n}) {\n  const { searchTerm, active } = speedSearch;\n\n  /**\n   * Note: when a component is implemented using react-aria's useCollection, any re-render of that component causes\n   * a new collection. That's because prop.children is normally an inline function, and therefore the collection is\n   * re-created: https://github.com/adobe/react-spectrum/blob/4a1cff846018e449487ccf54d7474bdfa4d4f57c/packages/@react-stately/collections/src/useCollection.ts#L29\n   * This means we will unnecessarily perform the search in such cases. it might be a non-issue, but if it turned out\n   * to be an issue, a sub-optimum improvement would be to use `collection.size` as a dependency instead of `collection`,\n   * assuming that searchable text in collections won't change, and assuming that the important changes (search-wise)\n   * will usually involve a size change in the collection.\n   */\n  const { matches } = useMemo(() => {\n    const matches: CollectionSpeedSearchMatches = new Map(); // maybe make it nullable makes more sense\n    if (speedSearch.active) {\n      // it's important not to iterate on items, since they can be nested.\n      [...collection.getKeys()]\n        .map((key) => collection.getItem(key)!)\n        .filter(({ type }) => type === \"item\")\n        .forEach((item) => {\n          const matchedRanges = minusculeMatch(item.textValue, searchTerm);\n          if (matchedRanges) {\n            matches.set(item.key, matchedRanges);\n          }\n        });\n    }\n\n    return {\n      matches,\n    };\n  }, [searchTerm, collection, active]);\n\n  const selectionManager = createSpeedSearchSelectionManager(\n    inputSelectionManager,\n    active ? matches : null\n  );\n  const latestValues = useLatest({\n    matches,\n    selectionManager,\n    collection,\n    focusBestMatch,\n  });\n\n  // On every query change, if the current selection doesn't include any of the matched items, move selection to the\n  // first matched item.\n  useEffect(() => {\n    const { selectionManager, matches, collection } = latestValues.current;\n    const matchedKeys = [...matches.keys()];\n    const noneOfTheMatchesAreSelected = !matchedKeys.some((matchedKey) =>\n      selectionManager.isSelected(matchedKey)\n    );\n    let keyToFocus: Key | undefined;\n    if (latestValues.current.focusBestMatch) {\n      keyToFocus = getLongestCommonPrefixMatch(matches);\n    }\n    if (!keyToFocus && matchedKeys.length > 0 && noneOfTheMatchesAreSelected) {\n      keyToFocus = getMatchToSelect({\n        collection,\n        selectionManager,\n        matchedKeys,\n      });\n    }\n    if (keyToFocus) {\n      selectionManager.setFocusedKey(keyToFocus);\n      selectionManager.replaceSelection(keyToFocus);\n    }\n  }, [\n    searchTerm,\n    latestValues /*it's a ref object, so no harm in listing it here to comply with rules of hooks*/,\n  ]);\n  return {\n    matches,\n    selectionManager,\n  };\n}\n\n/**\n * given a non-empty array of matched keys, returns the one that should be selected\n */\nfunction getMatchToSelect({\n  collection,\n  selectionManager,\n  matchedKeys,\n}: {\n  collection: Collection<Node<unknown>>;\n  selectionManager: SelectionManager;\n  matchedKeys: Key[];\n}): Key {\n  let passedFirstSelection = false;\n  for (const key of collection.getKeys()) {\n    if (key === selectionManager.firstSelectedKey) {\n      passedFirstSelection = true;\n    }\n    if (passedFirstSelection && matchedKeys.includes(key)) {\n      return key;\n    }\n  }\n  return matchedKeys[0];\n}\n\n/**\n * Returns the longest match from the beginning, if exists.\n */\nfunction getLongestCommonPrefixMatch(matches: CollectionSpeedSearchMatches) {\n  return [...matches.entries()]\n    .filter(([, [firstRange]]) => firstRange?.from === 0)\n    .sort(\n      ([, [rangeA]], [, [rangeB]]) =>\n        rangeB.to - rangeB.from - rangeA.to - rangeA.from\n    )?.[0]?.[0];\n}\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { Key } from \"react\";\n\nexport function createSpeedSearchSelectionManager(\n  wrappedSelectionManager: SelectionManager,\n  matches: Map<Key, unknown /* We don't care what a match is here */> | null\n): SelectionManager {\n  return Object.create(wrappedSelectionManager, {\n    selectAll: {\n      value: () => {\n        if (matches) {\n          // @ts-expect-error: state is private and there is no API on SelectionManager for bulk\n          // setting selected keys (which would ideally check for not selecting disabled keys internally).\n          const state = wrappedSelectionManager.state;\n          state.setSelectedKeys(\n            new Set(\n              [...matches.keys()].filter((key) => !state.disabledKeys.has(key))\n            )\n          );\n        } else {\n          wrappedSelectionManager.selectAll();\n        }\n      },\n    },\n  });\n}\n","import { HTMLAttributes, RefObject, useMemo } from \"react\";\nimport { Collection, KeyboardDelegate, Node } from \"@react-types/shared\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport {\n  SpeedSearchPopupProps,\n  SpeedSearchProps,\n} from \"@intellij-platform/core/SpeedSearch\";\nimport {\n  SpeedSearchState,\n  SpeedSearchStateProps,\n  useSpeedSearch,\n  useSpeedSearchState,\n} from \"../SpeedSearch/useSpeedSearch\";\nimport { CollectionSpeedSearchContextValue } from \"./CollectionSpeedSearchContext\";\nimport {\n  CollectionSpeedSearchMatches,\n  useCollectionSpeedSearchResult,\n} from \"./useCollectionSpeedSearchResult\";\nimport { createSpeedSearchKeyboardDelegate } from \"./createSpeedSearchKeyboardDelegate\";\n\nexport interface CollectionSpeedSearch {\n  containerProps: HTMLAttributes<HTMLElement>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  speedSearch: SpeedSearchState & { matches: CollectionSpeedSearchMatches };\n  searchPopupProps: SpeedSearchPopupProps;\n  speedSearchContextValue: CollectionSpeedSearchContextValue;\n}\n\n/**\n * Given a `collection`, a `selectionManager` and a `keyboardDelegate`, it returns:\n * - `speedSearch`: search term, if speed search is active or not, and the matched keys\n * - `matches`: A Set of matched keys, or `null` if speed search is not active\n * - `containerProps`: The props you need to pass to the collection container element to enable\n * speedSearch on it.\n * - `selectionManager`: a selection manager in which select all is overridden to only select\n * matched items if speed search is active.\n * - `keyboardDelegate`: a keyboard delegate in which limits navigation to matched items, when\n * speed search is active.\n *\n * Speed search options, including the ones for optionally controlling the state of the speed search\n * are also accepted in inputs.\n */\nexport function useCollectionSpeedSearch<T>({\n  collection,\n  selectionManager,\n  keepSearchActiveOnBlur,\n  keyboardDelegate,\n  focusBestMatch,\n  ref,\n  ...speedSearchStateProps\n}: {\n  collection: Collection<Node<T>>;\n  selectionManager: SelectionManager;\n  keyboardDelegate: KeyboardDelegate;\n  ref: RefObject<HTMLElement>;\n  focusBestMatch?: boolean;\n} & SpeedSearchStateProps &\n  Pick<SpeedSearchProps, \"keepSearchActiveOnBlur\">): CollectionSpeedSearch {\n  const speedSearch = useSpeedSearchState(speedSearchStateProps);\n\n  const { matches, selectionManager: speedSearchSelectionManager } =\n    useCollectionSpeedSearchResult({\n      collection,\n      selectionManager,\n      speedSearch,\n      focusBestMatch,\n    });\n  const { containerProps } = useSpeedSearch(\n    { keepSearchActiveOnBlur },\n    speedSearch,\n    ref\n  );\n  const speedSearchKeyboardDelegate = useMemo(\n    () =>\n      createSpeedSearchKeyboardDelegate(\n        keyboardDelegate,\n        speedSearch.active ? matches : null\n      ),\n    [speedSearch.active, keyboardDelegate, matches]\n  );\n\n  // Doesn't seem necessary to wrap with useMemo, but can be rethink-ed\n  const speedSearchContextValue = { matches, collection };\n\n  return {\n    containerProps,\n    selectionManager: speedSearchSelectionManager,\n    keyboardDelegate: speedSearchKeyboardDelegate,\n    speedSearch: {\n      ...speedSearch,\n      matches,\n    },\n    searchPopupProps: {\n      active: speedSearch.active,\n      match: matches.size > 0,\n      children: speedSearch.searchTerm,\n    },\n    speedSearchContextValue,\n  };\n}\n","import React, { Key } from \"react\";\nimport { KeyboardDelegate } from \"@react-types/shared\";\n\n/**\n * Creates a new KeyboardDelegate in which keyKeyBelow and getKeyAbove are overridden in a way that\n * navigation is limited to matched items.\n * Note: select all action is not handled in KeyboardDelegate.\n * Note: when virtualization is added, this probably need to change, like how it's handled\n * in `useListBoxLayout` in react spectrum.\n */\nexport function createSpeedSearchKeyboardDelegate(\n  wrappedKeyboardDelegate: KeyboardDelegate,\n  matches: Map<Key, unknown /*We don't care what a match is, here*/> | null\n): KeyboardDelegate {\n  // TODO: page up and down deactivate speed search. If we want that, we can pass the speedSearch\n  //  object too. but doesn't seem like the best way to do it, even it the same behavior is expected\n  const findFirstMatch = <T extends React.Key | undefined, K>(\n    fromKey: React.Key | undefined | null,\n    direction: \"up\" | \"down\"\n  ) => {\n    let currentKey: React.Key | undefined | null = fromKey;\n    while (currentKey != null) {\n      if (!matches || matches.has(currentKey)) {\n        return currentKey;\n      }\n      currentKey =\n        direction === \"up\"\n          ? wrappedKeyboardDelegate.getKeyAbove?.(currentKey)\n          : wrappedKeyboardDelegate.getKeyBelow?.(currentKey);\n    }\n    return currentKey ?? undefined;\n  };\n  return Object.create(wrappedKeyboardDelegate, {\n    getKeyBelow: {\n      value: (key) =>\n        findFirstMatch(wrappedKeyboardDelegate.getKeyBelow?.(key), \"down\"),\n    },\n    getKeyAbove: {\n      value: (key) =>\n        findFirstMatch(wrappedKeyboardDelegate.getKeyAbove?.(key), \"up\"),\n    },\n    getFirstKey: {\n      value: (key?: React.Key, global?: boolean): React.Key | null => {\n        const firstKey = findFirstMatch(\n          wrappedKeyboardDelegate.getFirstKey?.(key, global),\n          \"down\"\n        );\n        return firstKey == null ? matches?.values().next().value : firstKey;\n      },\n    },\n    getLastKey: {\n      value: (key?: React.Key, global?: boolean): React.Key | null => {\n        const lastKey = findFirstMatch(\n          wrappedKeyboardDelegate.getLastKey?.(key, global),\n          \"down\"\n        );\n        return lastKey == null\n          ? [...(matches?.keys() || [])].pop() ?? null\n          : lastKey;\n      },\n    },\n  } as { [key in keyof KeyboardDelegate]: { value: KeyboardDelegate[key] } });\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { PartialNode } from \"@react-stately/collections\";\n\ninterface DividerProps {}\n\n/**\n * To be used in dynamic collections, just to provide a key and make it easy to check in the render\n * function to figure out what to render (an Item or a Divider)\n */\nexport class DividerItem {\n  private static seq = 0;\n  key = \"divider_\" + DividerItem.seq++;\n  get id() {\n    return this.key;\n  }\n}\n\nfunction Divider({}: DividerProps): ReactElement {\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  return null as any;\n}\n// We don't want getCollectionNode to show up in the type definition\nlet _Divider = Divider as (props: DividerProps) => JSX.Element;\nexport { _Divider as Divider };\n\nDivider.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>\n): Generator<PartialNode<T>> {\n  let rendered = null;\n\n  yield {\n    type: \"divider\",\n    element: null as any, // to prevent check on key, which is not necessary for divider\n    props: props,\n    rendered,\n    hasChildNodes: false,\n  };\n};\n","import React, { ReactElement } from \"react\";\nimport { ItemProps } from \"@react-types/shared\";\nimport { Item as StatelyItem, PartialNode } from \"@react-stately/collections\";\n\n// noinspection JSUnusedLocalSymbols\n/**\n * Item for collection components, which by default disables caching, unless `invalidated` prop is set to false on the\n * context passed to useCollection. Control over cache invalidation policy can be enabled by using\n * `useCollectionCacheInvalidation` for creating such context object.\n */\nfunction Item<T>(props: ItemProps<T>): ReactElement {\n  return null as any as React.ReactElement;\n}\n\nexport type CacheInvalidationContext = { invalidated?: boolean };\n\n// We don't want getCollectionNode to show up in the type definition\nlet _Item = Item as <T>(props: ItemProps<T>) => JSX.Element;\nexport { _Item as Item };\n\n/**\n * @private @preapproved\n */\nItem.getCollectionNode = function* getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: CacheInvalidationContext\n): Generator<PartialNode<T>> {\n  const itemGenerator: Generator<PartialNode<T>> = (\n    StatelyItem as any\n  ).getCollectionNode(props, context);\n  const result = itemGenerator.next().value;\n  const originalShouldInvalidate = result.shouldInvalidate;\n  result.shouldInvalidate = (context: CacheInvalidationContext) =>\n    originalShouldInvalidate?.(context) || context.invalidated;\n  yield result;\n};\n","import React from \"react\";\nimport { styled } from \"../styled\";\nimport { DOMAttributes } from \"@react-types/shared\";\nimport { MENU_POSITION_TARGET_DATA_ATTRIBUTE } from \"@intellij-platform/core/Menu/ContextMenuContainer\";\n\nconst GAP = \"0.1875rem\";\nconst StyledItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  padding-right: 0.25rem;\n  gap: ${GAP};\n`;\n\nconst StyledHint = styled.span<{ small?: boolean }>`\n  display: inline-flex;\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(theme.commonColors.inactiveTextColor)};\n  padding-left: 0.1rem;\n  font-size: ${({ small }) => small && \"0.9em\"};\n`;\n\nconst StyledGroup = styled.span.attrs({\n  role: \"presentation\" as string,\n})`\n  display: inline-flex;\n  display: flex;\n  align-items: center;\n  gap: ${GAP};\n`;\n/**\n * Generic layout component capturing common use cases of tree or list items.\n * It handles the spacing between parts, and provides styled components for parts that need specific styling.\n * For more flexibility over the order of various pieces of content in list/tree items, there is no specific props\n * for parts. Different parts should just be rendered in children.\n *\n * @example\n * ```tsx\n * <ItemLayout>\n *   <PlatformIcon icon=\"nodes/folder\" />\n *   <HighlightedTextValue />\n *   <ItemLayout.Hint>~/workspace/jui</ItemLayout.Hint>\n * </ItemLayout>\n * ```\n * @beta\n */\nexport const ItemLayout = (\n  props: { children: React.ReactNode } & DOMAttributes\n) => {\n  return (\n    <StyledItemLayout\n      {...{ [MENU_POSITION_TARGET_DATA_ATTRIBUTE]: true }}\n      {...props}\n    />\n  );\n};\n\n/**\n * A more subtle text usually rendered next to the main text in the item.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Hint = StyledHint;\n\n/**\n * Useful when a number of items need to be grouped by a wrapper, e.g. to have a tooltip.\n * @example: project path in project root node, in project view\n * @example: \"library root\" rendered next to \"node_modules\" folders in project view.\n */\nItemLayout.Group = StyledGroup;\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Generic state of items in collections, provided via a context.\n * To be used in Menu, Tree, or anything that deals with a collection of items for which the common states like\n * **disabled** or **selected** is applicable.\n */\nexport interface ItemStateContextType {\n  node: Node<unknown>;\n  isSelected: boolean;\n  isContainerFocused: boolean;\n  isDisabled: boolean;\n}\n\nexport const ItemStateContext =\n  React.createContext<ItemStateContextType | null>(null);\n","import { RefObject, useEffect } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { scrollIntoView } from \"@react-aria/utils\";\n\ntype CollectionAutoScrollProps = {\n  isVirtualized?: boolean;\n  selectionManager: SelectionManager;\n};\n\nexport function useCollectionAutoScroll(\n  { isVirtualized, selectionManager }: CollectionAutoScrollProps,\n  ref: RefObject<HTMLElement>\n) {\n  // If not virtualized, scroll the focused element into view when the focusedKey changes.\n  // When virtualized, Virtualizer handles this internally.\n  useEffect(() => {\n    if (!isVirtualized && selectionManager.focusedKey && ref?.current) {\n      let element = ref.current.querySelector(\n        `[data-key=\"${selectionManager.focusedKey}\"]`\n      ) as HTMLElement;\n      if (element) {\n        scrollIntoView(ref.current, element);\n      }\n    }\n  }, [isVirtualized, ref, selectionManager.focusedKey]);\n}\n","import { Key, RefObject, useEffect } from \"react\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\n\n/**\n * interface to be extended by the props of collection components that support focus proxy.\n */\nexport interface CollectionFocusProxyProps {\n  /**\n   * ref to an element (typically HTMLInputElement) that should act as a focus\n   * proxy that handles ArrowUp, ArrowDown, and Enter keys to allow for\n   * navigating the collection and selecting items.\n   * Useful for implementing\n   * autocompletion or search input connected to a collection element.\n   */\n  focusProxyRef?: RefObject<HTMLElement>;\n}\n\n/**\n * A solution for connecting a collection to a search input so that the collection can still be navigated by keyboard\n * while the input is focused. It works by replaying certain keyboard events on the collection container and focused\n * item. An alternative approach (which is used in react-aria's useCombobox) is to use useSelectableCollection\n * separately for the input, but the biggest issue with that approach is that it's limiting in the following ways:\n * - Rendering input should be a part of the same component that renders the collection. Having specific components\n *   for use cases that require a search input is not flexible enough. For example, one may want to use SpeedSearchList\n *   or List connected to an input. Also, the input and the collection may need to be in different layouts in different\n *   use cases. Decoupling the rendering of the input and collection is a more flexible solution.\n * - The same options used for collection should be passed to the input field for behavior consistency, and that is\n *   prone to error.\n *   Some of these options, like `keyboardDelegate` can even have a default value in hooks like\n *   `useSelectableList`.\n *   It means making sure the same value is passed to the useSelectableCollection for input\n *   would require not using the default value, since the same value can't be accessed.\n *\n * With this event-forwarding approach, it's an arrow up or down event would behave exactly like it was triggered on\n * the collection itself, leaving no room for behavior discrepancies. But it has a few drawbacks:\n * - Although small, there is still some coupling between this code and implementation of the collection component.\n *   More specifically, this implementation assumes the following things:\n *   - \"Enter\" keys (selection or action) are handled on items, but arrow keys are handled on the collection element.\n *   - \"[data-key] attribute is set on items. That is used to find the element for the focused item (which, of course,\n *     is not actually focused while the input is).\n *\n * Note: there has been some addition to react-aria useSelectableCollection and useSelectableItem hooks\n * based on CustomEvent and a similar event reply mechanism in useAutocomplete.\n * It may be possible to replace this hook with built-in functionality in react-aria at some point.\n * But at the moment, it seems like that implementation is too coupled with the autocompletion use case, while\n * what is supported here is more generic and allows for the connected search input use case too.\n */\n\nexport const useCollectionFocusProxy = <T>({\n  state,\n  focusProxyRef,\n  collectionRef,\n  onAction,\n}: {\n  focusProxyRef: RefObject<HTMLElement> | undefined;\n  collectionRef: RefObject<HTMLElement>;\n  state: {\n    /** A collection of items in the list. */\n    collection: Collection<Node<T>>;\n    /** A selection manager to read and update multiple selection state. */\n    selectionManager: SelectionManager;\n  };\n  onAction: ((key: Key) => void) | undefined;\n}) => {\n  // TODO: focus/blur events should probably be handled as well, to keep the\n  //  isFocused state of the collection in sync.\n  useEffect(\n    () => {\n      const proxy = focusProxyRef?.current;\n      if (proxy) {\n        const onKeyDown = (event: KeyboardEvent) => {\n          if (event.key === \"ArrowUp\" || event.key === \"ArrowDown\") {\n            event.preventDefault();\n            event.stopPropagation();\n\n            collectionRef.current?.dispatchEvent(\n              new KeyboardEvent(event.type, event)\n            );\n          } else if (\n            event.key === \"Enter\" &&\n            state.selectionManager?.focusedKey != null\n          ) {\n            event.preventDefault(); // in forms, pressing Enter on input submits the form\n            (event.currentTarget as HTMLElement)?.addEventListener(\n              \"keyup\",\n              (event: KeyboardEvent) => {\n                console.log(\n                  \"Keyup\",\n                  event.key,\n                  state.selectionManager.focusedKey,\n                  \"onAction\",\n                  onAction\n                );\n                if (\n                  event.key === \"Enter\" &&\n                  state.selectionManager.focusedKey != null\n                ) {\n                  onAction?.(state.selectionManager.focusedKey);\n                }\n              },\n              { once: true, capture: true }\n            );\n          }\n        };\n        proxy.addEventListener(\"keydown\", onKeyDown);\n        return () => {\n          proxy.removeEventListener(\"keydown\", onKeyDown);\n        };\n      }\n    } /* with no dependency here, event listeners are reattached on each render, but that's the case when unmemoized\n    event handlers are passed to elements too (e.g., when using any react-aria hook) */\n  );\n};\n","import React, {\n  CSSProperties,\n  ForwardedRef,\n  forwardRef,\n  HTMLProps,\n  Ref,\n  useRef,\n} from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { AriaComboBoxProps, useComboBox } from \"@react-aria/combobox\";\nimport { useComboBoxState } from \"@react-stately/combobox\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { ControlledStateProps } from \"@intellij-platform/core/type-utils\";\nimport { BareButton } from \"@intellij-platform/core/Button\";\nimport { Popover } from \"@intellij-platform/core/Overlay\";\nimport { StatelessListBox } from \"./StatelessListBox\";\nimport { StyledContainer } from \"./StyledContainer\";\nimport { LabelPlacement, WithLabel } from \"../Field/Label\";\nimport { StyledDropdownArrowIcon } from \"./StyledDropdownArrowIcon\";\nimport {\n  PositionedTooltipTrigger,\n  ValidationTooltip,\n} from \"@intellij-platform/core/Tooltip\";\nimport {\n  ContextHelpProps,\n  WithInlineContextHelp,\n} from \"@intellij-platform/core/Field/ContextHelp\";\n\ntype AriaProps<T> = {\n  [K in keyof T as K extends `aria-${string}` ? K : never]: T[K];\n};\n\nexport interface ComboBoxProps<T extends object>\n  extends Pick<\n      AriaComboBoxProps<T>,\n      | \"disabledKeys\"\n      | \"defaultSelectedKey\"\n      | \"selectedKey\"\n      | \"isDisabled\"\n      | \"children\"\n      | \"items\"\n      | \"label\"\n      | \"autoFocus\"\n      | \"menuTrigger\"\n      | \"placeholder\"\n      | \"onFocus\"\n      | \"onBlur\"\n      | \"onKeyDown\"\n      | \"onKeyUp\"\n      | \"onOpenChange\"\n      | \"onFocusChange\"\n      | \"onSelectionChange\"\n    >,\n    AriaProps<AriaComboBoxProps<T>>,\n    ControlledStateProps<{\n      value: string;\n    }>,\n    ContextHelpProps {\n  labelPlacement?: LabelPlacement;\n  className?: string;\n  style?: CSSProperties;\n\n  validationState?: \"valid\" | \"error\" | \"warning\";\n\n  /**\n   * Validation message shown as a {@link ValidationTooltip} above the component.\n   * {@link ValidationTooltipProps#type} is defined based on `validationState`.\n   */\n  validationMessage?: React.ReactNode;\n\n  /**\n   * props to apply on input, excluding value that's controlled by the component\n   */\n  inputProps?: Omit<\n    HTMLProps<HTMLInputElement>,\n    \"value\" | \"defaultValue\" | \"as\"\n  >;\n  inputRef?: Ref<HTMLInputElement>;\n}\n\nconst StyledComboBoxContainer = styled(StyledContainer)`\n  padding: 0;\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\n          \"TextField.disabledForeground\" as UnknownThemeProp<\"TextField.disabledForeground\">\n        )\n      : theme.color(\n          \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n        )};\n`;\nconst StyledComboBoxInput = styled.input`\n  flex: 1;\n  background: none;\n  border: none;\n  outline: none;\n  color: inherit;\n  padding: ${({ theme }) =>\n    theme.inset(\"ComboBox.padding\") ?? \"1px 6px 1px 6px\"};\n  height: 100%;\n`;\n\nconst StyledDropdownButton = styled.button`\n  // Resetting default styles\n  appearance: none;\n  border: none;\n  background: ${({ theme }) => theme.color(\"ComboBox.ArrowButton.background\")};\n  outline: none;\n  font: inherit;\n  padding: 0;\n\n  // Custom styles\n  border-left: 1px solid ${({ theme }) => theme.commonColors.border()};\n  height: 100%;\n  aspect-ratio: 1;\n  /**\n   * In the reference impl, the clickable area exceeds the left border by a\n   * few pixels. The following trick implements that\n   */\n  position: relative;\n  ::before {\n    content: \"\";\n    position: absolute;\n    left: -4px;\n    top: 0;\n    bottom: 0;\n    width: 4px;\n  }\n`;\n\n/**\n * [Combobox](https://plugins.jetbrains.com/docs/intellij/combo-box.html) implementation.\n * Known differences with the reference impl:\n * - selected key doesn't focus when opened the dropdown manually.\n *   Opening the dropdown by pressing ArrowDown does focus the previously selected item.\n */\nexport const ComboBox = forwardRef(\n  <T extends object>(\n    {\n      labelPlacement,\n      style,\n      className,\n      value,\n      defaultValue,\n      onValueChange,\n      validationState,\n      validationMessage,\n      contextHelp,\n      contextHelpPlacement,\n      inputProps,\n      inputRef: inputRefProp,\n      ...props\n    }: ComboBoxProps<T>,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ): React.JSX.Element => {\n    const ref = useObjectRef(forwardedRef);\n    const buttonRef = useRef<HTMLButtonElement>(null);\n    const inputRef = useObjectRef(inputRefProp);\n    const dropdownContainerRef = useRef<HTMLDivElement>(null);\n    const popoverRef = useRef<HTMLDivElement>(null);\n    const listBoxRef = useRef<HTMLDivElement>(null);\n    const isInvalid = Boolean(validationState) && validationState !== \"valid\";\n\n    const state = useComboBoxState({\n      // defaultFilter not provided based on how ComboBoxes don't filter based on input in Intellij Platform\n      // filtering can still be implemented by controlling `value` and `items`.\n      menuTrigger: \"manual\", // overridable via props\n      allowsCustomValue: true,\n      inputValue: value,\n      defaultInputValue: defaultValue,\n      onInputChange: onValueChange,\n      isInvalid,\n      ...props,\n    });\n    const {\n      descriptionProps,\n      errorMessageProps,\n      labelProps,\n      inputProps: comboboxInputProps,\n      listBoxProps,\n      buttonProps,\n    } = useComboBox(\n      {\n        ...props,\n        allowsCustomValue: true,\n        buttonRef,\n        inputRef,\n        popoverRef,\n        listBoxRef,\n      },\n      state\n    );\n\n    // minWidth is not kept in the state, assuming it's unnecessary, considering the width is expected to be\n    // stable when the popover opens.\n    const minWidth = dropdownContainerRef.current\n      ? dropdownContainerRef.current?.offsetWidth + 2 /* for box shadow*/\n      : undefined;\n    return (\n      <>\n        <WithLabel\n          ref={ref}\n          isDisabled={props.isDisabled}\n          label={props.label}\n          labelPlacement={labelPlacement}\n          labelProps={labelProps}\n          className={className}\n          style={style}\n        >\n          {/* probably no need for HiddenSelect as autofilling doesn't seem relevant for applications using this library */}\n          <WithInlineContextHelp\n            contextHelp={contextHelp}\n            contextHelpPlacement={contextHelpPlacement}\n            descriptionProps={descriptionProps}\n          >\n            <StyledComboBoxContainer\n              ref={dropdownContainerRef}\n              validationState={validationState}\n              disabled={props.isDisabled}\n              className={state.isFocused ? \"is-focus\" : \"\"}\n            >\n              {/* FIXME: tooltip comes and goes on mouse enter/leave, which is especially weird when trying to open options */}\n              <PositionedTooltipTrigger\n                placement=\"top\"\n                showOnFocus\n                isDisabled={!validationMessage}\n                triggerRef={inputRef}\n                tooltip={\n                  <ValidationTooltip\n                    type={\n                      validationState !== \"valid\" ? validationState : undefined\n                    }\n                  >\n                    <div {...errorMessageProps}>{validationMessage}</div>\n                  </ValidationTooltip>\n                }\n                delay={0}\n              >\n                {(tooltipTriggerProps) => (\n                  <StyledComboBoxInput\n                    {...mergeProps(\n                      comboboxInputProps,\n                      inputProps,\n                      tooltipTriggerProps\n                    )}\n                  />\n                )}\n              </PositionedTooltipTrigger>\n\n              <BareButton {...buttonProps} ref={buttonRef}>\n                <StyledDropdownButton>\n                  <StyledDropdownArrowIcon\n                    disabled={props.isDisabled}\n                    size={20}\n                    icon=\"general/arrowDown.svg\"\n                  />\n                </StyledDropdownButton>\n              </BareButton>\n            </StyledComboBoxContainer>\n          </WithInlineContextHelp>\n        </WithLabel>\n        {state.isOpen && (\n          <Popover\n            ref={popoverRef}\n            state={state}\n            triggerRef={dropdownContainerRef}\n            placement=\"bottom start\"\n            containerPadding={0}\n            offset={2}\n            crossOffset={-1}\n          >\n            <StatelessListBox\n              {...listBoxProps}\n              ref={listBoxRef}\n              state={state}\n              style={{ minWidth }}\n            />\n          </Popover>\n        )}\n      </>\n    );\n  }\n);\n","import React, { ForwardedRef } from \"react\";\nimport { AriaListBoxOptions, AriaListBoxProps } from \"@react-aria/listbox\";\nimport { useListState } from \"@react-stately/list\";\nimport { StatelessListBox } from \"@intellij-platform/core/Dropdown/StatelessListBox\";\nimport { CollectionFocusProxyProps } from \"@intellij-platform/core/Collections\";\n\nexport interface ListBoxProps<T extends object>\n  extends AriaListBoxProps<T>,\n    CollectionFocusProxyProps,\n    Pick<\n      AriaListBoxOptions<T>,\n      \"shouldFocusOnHover\" | \"shouldUseVirtualFocus\"\n    > {\n  minWidth?: number;\n}\n\nexport const ListBox = React.forwardRef(function ListBox<T extends object>(\n  { minWidth, ...props }: ListBoxProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const state = useListState({\n    selectionBehavior: \"toggle\",\n    selectionMode: \"single\",\n    ...props,\n  });\n\n  return <StatelessListBox state={state} ref={forwardedRef} {...props} />;\n});\n","import React, { CSSProperties, ForwardedRef } from \"react\";\nimport {\n  AriaListBoxOptions,\n  useListBox,\n  useListBoxSection,\n  useOption,\n} from \"@react-aria/listbox\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { ListState } from \"@react-stately/list\";\nimport { Node } from \"@react-types/shared\";\n\nimport {\n  CollectionFocusProxyProps,\n  ItemStateContext,\n  useCollectionFocusProxy,\n} from \"@intellij-platform/core/Collections\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { StyledList } from \"@intellij-platform/core/List/StyledList\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\ninterface StatelessListBoxProps<T extends object>\n  extends AriaListBoxOptions<T>,\n    CollectionFocusProxyProps {\n  state: ListState<T>;\n  style?: CSSProperties;\n  className?: string;\n}\n\nexport const StatelessListBox = React.forwardRef(function StatelessListBox<\n  T extends object\n>(\n  {\n    state,\n    style,\n    className,\n    focusProxyRef,\n    ...props\n  }: StatelessListBoxProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const { listBoxProps, labelProps } = useListBox(props, state, ref);\n\n  useCollectionFocusProxy({\n    state,\n    collectionRef: ref,\n    focusProxyRef,\n    onAction: props.onAction,\n  });\n\n  return (\n    <>\n      <div {...labelProps}>{props.label}</div>\n      <StyledList\n        {...listBoxProps}\n        ref={ref}\n        style={style}\n        className={className}\n      >\n        {[...state.collection].map((item) =>\n          item.type === \"section\" ? (\n            <ListBoxSection key={item.key} section={item} state={state} />\n          ) : (\n            <Option key={item.key} item={item} state={state} />\n          )\n        )}\n      </StyledList>\n    </>\n  );\n});\nfunction Option<T extends object>({\n  item,\n  state,\n}: {\n  item: Node<T>;\n  state: ListState<T>;\n}) {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { optionProps } = useOption({ key: item.key }, state, ref);\n\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isSelected = state.selectionManager.focusedKey === item.key;\n  return (\n    <ItemStateContext.Provider\n      value={{\n        isDisabled,\n        isContainerFocused: state.selectionManager.isFocused,\n        isSelected,\n        node: item,\n      }}\n    >\n      <StyledListItem\n        {...optionProps}\n        ref={ref}\n        disabled={isDisabled}\n        selected={isSelected}\n        containerFocused\n      >\n        {item.rendered}\n      </StyledListItem>\n    </ItemStateContext.Provider>\n  );\n}\n\nconst StyledSectionHeading = styled.div`\n  font-size: 0.6875rem;\n  padding: 0 0.5rem;\n  color: ${({ theme }) => theme.commonColors.inactiveTextColor}; // not verified\n`;\n\nconst StyledSection = styled.div`\n  padding: 0;\n  margin: 0;\n  list-style: none;\n`;\n\nfunction ListBoxSection<T extends object>({\n  section,\n  state,\n}: {\n  section: Node<T>;\n  state: ListState<T>;\n}) {\n  let { itemProps, headingProps, groupProps } = useListBoxSection({\n    heading: section.rendered,\n    \"aria-label\": section[\"aria-label\"],\n  });\n\n  // If the section is not the first, add a separator element to provide visual separation.\n  // The heading is rendered inside an <li> element, which contains\n  // a <ul> with the child items.\n  return (\n    <>\n      {section.key !== state.collection.getFirstKey() && (\n        <StyledVerticalSeparator role=\"presentation\" />\n      )}\n      <li {...itemProps}>\n        {section.rendered && (\n          <StyledSectionHeading {...headingProps}>\n            {section.rendered}\n          </StyledSectionHeading>\n        )}\n        <StyledSection {...groupProps}>\n          {[\n            ...(state.collection.getChildren?.(section.key) ??\n              section.childNodes),\n          ].map((node) => (\n            <Option key={node.key} item={node} state={state} />\n          ))}\n        </StyledSection>\n      </li>\n    </>\n  );\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport const StyledContainer = styled.div<{\n  disabled?: boolean;\n  validationState?: \"valid\" | \"error\" | \"warning\";\n}>`\n  box-sizing: border-box;\n  display: flex;\n  width: 100%;\n  align-items: center;\n  height: 1.5rem;\n  background: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"ComboBox.disabledBackground\")\n      : theme.color(\"ComboBox.background\")};\n  color: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"ComboBox.disabledForeground\")\n      : theme.color(\n          \"ComboBox.foreground\" as UnknownThemeProp<\"ComboBox.foreground\">\n        )};\n  border: 1px solid\n    ${({ theme, disabled, validationState }) =>\n      theme.commonColors.border({\n        disabled,\n        validationState,\n      })};\n  // The focus style is applied unconditionally in the reference impl, so no use of focus-visible or js-based focus visible detection\n\n  box-shadow: 0 0 0 0.125rem\n    ${({ theme, validationState }) =>\n      theme.commonColors.focusRing({\n        validationState,\n        focused: false,\n      })};\n  &:focus,\n  &.is-focus {\n    border-color: ${({ theme, validationState }) =>\n      theme.commonColors.border({\n        focused: true,\n        validationState,\n      })};\n    outline: none;\n    box-shadow: 0 0 0 0.125rem\n      ${({ theme, validationState }) =>\n        theme.commonColors.focusRing({\n          validationState,\n          focused: true,\n        })};\n  }\n\n  border-radius: ${({ theme }) => theme.borderRadius.default}px;\n`;\n","import { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport const StyledDropdownArrowIcon = styled(PlatformIcon).attrs<{\n  disabled?: boolean;\n}>({\n  \"aria-hidden\": \"true\",\n})`\n  // NOTE: \"ArrowButton.nonEditableBackground\" theme key is used in the reference impl, but it doesn't seem necessary to allow\n  // for a separate arrow background in Dropdown (aka non-editable combobox), since the arrow is not really a\n  // separate button, but a visual indicator for the whole trigger. Also there is no mention of it in designs\n  // There is also separate theme properties for color and disabled color, but inheriting it (via currentColor)\n  // makes more sense\n\n  * {\n    fill: ${({ theme, disabled }) =>\n      disabled\n        ? theme.color(\"ComboBox.ArrowButton.disabledIconColor\")\n        : theme.color(\"ComboBox.ArrowButton.iconColor\")};\n  }\n`;\n","import { css, styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { DOMAttributes, DOMProps } from \"@react-types/shared\";\n\n/**\n * Interface to inherit in props of components that support rendering context help.\n */\nexport interface ContextHelpProps {\n  /**\n   * Context help, shown below the input.\n   * A typical use case is\n   * [to provide example values](https://jetbrains.github.io/ui/principles/context_help/#07).\n   */\n  contextHelp?: React.ReactNode; // TODO: implement\n  /**\n   * Placement of the contextHelp text with respect to the control.\n   * See more: https://plugins.jetbrains.com/docs/intellij/inline-help-text.html#placement\n   */\n  contextHelpPlacement?: \"below\" | \"after\";\n}\n\nconst StyledContextHelp = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n`;\n\nconst StyledContextHelpWrapper = styled.div<{\n  placement: ContextHelpProps[\"contextHelpPlacement\"];\n}>`\n  font-size: 0.75rem; // 12px, in new UI. It's 11px in the old UI.\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n  gap: 0.25rem; /* Not checked with the reference impl */\n  ${({ placement }) =>\n    placement === \"after\" &&\n    css`\n      flex-direction: row;\n      align-items: center;\n      gap: 1rem; /* Not checked with the reference impl */\n    `}\n  flex-grow: 1; /* Needed for when the control is inside a flex layout */\n`;\n\n/**\n * Implements [inline context help](https://plugins.jetbrains.com/docs/intellij/inline-help-text.html),\n * for its children.\n */\nexport const WithInlineContextHelp = ({\n  children,\n  descriptionProps,\n  contextHelpPlacement,\n  contextHelp,\n}: {\n  children: React.ReactNode;\n  /**\n   * Props to apply on the context help wrapper, to make the connected control\n   * described by the context help.\n   */\n  descriptionProps: DOMAttributes;\n} & ContextHelpProps) => {\n  return (\n    <StyledContextHelpWrapper placement={contextHelpPlacement}>\n      {children}\n      {contextHelp && (\n        <StyledContextHelp {...descriptionProps}>\n          {contextHelp}\n        </StyledContextHelp>\n      )}\n    </StyledContextHelpWrapper>\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, {\n  ForwardedRef,\n  forwardRef,\n  RefObject,\n  useContext,\n  useEffect,\n  useLayoutEffect,\n} from \"react\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\nexport type LabelPlacement = \"above\" | \"before\";\n\nconst StyledLabelContainer = styled.div<{\n  labelPlacement?: LabelPlacement;\n}>`\n  display: inline-flex;\n  flex-direction: ${({ labelPlacement }) =>\n    labelPlacement === \"above\" ? \"column\" : \"row\"};\n  align-items: start;\n  gap: 0.375rem;\n`;\n\nconst StyledLabel = styled.label<{ isDisabled?: boolean }>`\n  color: ${({ theme, isDisabled: disabled }) =>\n    theme.commonColors.label({ disabled })};\n  margin-top: 0.25rem;\n  line-height: 1.2;\n`;\n\n/**\n * Implements [label](https://jetbrains.github.io/ui/controls/input_field/#label),\n * for elements like Input, Dropdown, etc.\n */\nexport const WithLabel = forwardRef(function WithLabel(\n  {\n    label,\n    labelPlacement,\n    labelProps,\n    children,\n    isDisabled,\n    ...props\n  }: {\n    isDisabled: boolean | undefined;\n    label: React.ReactNode;\n    labelPlacement: LabelPlacement | undefined /* intentionally not optional */;\n    labelProps?: DOMAttributes;\n  } & DOMAttributes,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const labelRef = React.useRef<HTMLLabelElement>(null);\n  useAlignedLabels({ ref: labelRef, enabled: labelPlacement !== \"above\" });\n  return (\n    <StyledLabelContainer\n      {...props}\n      labelPlacement={labelPlacement}\n      ref={forwardedRef}\n    >\n      {label && (\n        <StyledLabel {...labelProps} isDisabled={isDisabled} ref={labelRef}>\n          {label}\n        </StyledLabel>\n      )}\n      {children}\n    </StyledLabelContainer>\n  );\n});\n\nfunction useAlignedLabels({\n  ref,\n  enabled,\n}: {\n  ref: RefObject<HTMLElement>;\n  enabled?: boolean;\n}) {\n  const { applyLabelWidth, commonWidth } = useContext(LabelAlignmentContext);\n  useLayoutEffect(() => {\n    const apply = (): boolean => {\n      const width = ref.current?.offsetWidth;\n      if (width) {\n        applyLabelWidth(width);\n        return true;\n      }\n      return false;\n    };\n    // In some situations, the width is zero in the first render.\n    if (!apply()) {\n      setTimeout(apply, 0);\n    }\n  });\n\n  useEffect(() => {\n    if (ref.current) {\n      ref.current.style.width =\n        commonWidth && enabled ? `${commonWidth}px` : \"\";\n    }\n  }, [commonWidth, enabled]);\n}\n\nconst LabelAlignmentContext = React.createContext<{\n  commonWidth: number | null;\n  applyLabelWidth: (width: number) => void;\n}>({ commonWidth: null, applyLabelWidth: () => {} });\n\n/**\n * Provides a context for\n * [labeled input controls](https://jetbrains.github.io/ui/principles/layout/#labeled-input-controls)\n * with side-positioned labels to have their input boxes aligned.\n * It doesn't render anything in DOM and only provides a context used\n * by labeled controls to set a common width on labels so that the input boxes\n * align.\n * Labeled input controls are:\n * - {@link InputField}\n * - {@link ComboBox}\n * - {@link Dropdown}\n */\nexport function LabeledControlsAlignmentProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const [commonWidth, setCommonWidth] = React.useState<null | number>(null);\n\n  const applyLabelWidth = (width: number) => {\n    setCommonWidth((currentWidth) =>\n      width > (currentWidth ?? 0)\n        ? width + 1 /* without 1px it wraps in some cases \\_()_/ */\n        : currentWidth\n    );\n  };\n  return (\n    <LabelAlignmentContext.Provider value={{ commonWidth, applyLabelWidth }}>\n      {children}\n    </LabelAlignmentContext.Provider>\n  );\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React, { ForwardedRef } from \"react\";\nimport { amendName, PlatformIcon, PlatformIconProps } from \"./PlatformIcon\";\n\nexport const StyledHoverContainer = styled.span<{\n  hoverContainerSelector?: string;\n}>`\n  ${({ hoverContainerSelector }) =>\n    hoverContainerSelector\n      ? `${hoverContainerSelector} &`\n      : \"\"} .icon[data-hover] {\n    display: none;\n  }\n\n  ${({ hoverContainerSelector }) =>\n    hoverContainerSelector ? `${hoverContainerSelector}:hover &` : \"&:hover\"} {\n    .icon {\n      display: none;\n    }\n\n    .icon[data-hover] {\n      display: inline-flex;\n    }\n  }\n`;\n\nconst StyledIconHoverContainer = styled(StyledHoverContainer)`\n  display: inline-flex;\n`;\n\n/**\n * A common use case for PlatformIcons is to have a default icon and a hover icon.\n * This component captures that simple use case, by rendering both icons, and hiding one based on a hover selector.\n *\n * ### Parent hover container\n *\n * If the hover-able element is a parent of the icon, and not the icon itself (i.e., the icon should change if the\n * that parent is hovered), you can use `StyledHoverContainer` to define that parent element:\n *\n * ```tsx\n * const SomeParent = styled(StyledHoverContainer)`...`;\n * <SomeParent><AutoHoverPlatformIcon icon=\"...\" /></SomeParent>\n * ```\n *\n * If the hover-able element is a parent of the icon, with a known selector, you can pass `hoverContainerSelector`,\n * instead of using `StyledHoverContainer`:\n *\n * ```tsx\n * <AutoHoverPlatformIcon icon=\"...\" hoverContainerSelector=\"[role=menuitem]\" />\n * ```\n *\n * If the hover container is a styled component, you can have it converted to selector like this:\n *\n * ```tsx\n * <AutoHoverPlatformIcon icon=\"...\" hoverContainerSelector={`${MyStyledHoverContainer}`} />\n * ```\n *\n * In all examples above, the hover icon is shown when the parent is hovered, instead of the icon itself.\n *\n */\nexport const AutoHoverPlatformIcon = React.forwardRef(\n  function AutoHoverPlatformIcon(\n    {\n      hoverIcon,\n      hoverContainerSelector,\n      ...props\n    }: PlatformIconProps & {\n      /**\n       * The icon to be used when hovered. If not provided, it will be the \"somethingHovered\" where \"something\" is the `icon`\n       */\n      hoverIcon?: string;\n      hoverContainerSelector?: string;\n    },\n    ref: ForwardedRef<HTMLSpanElement>\n  ) {\n    const className = `icon ${props.className || \"\"}`;\n    return (\n      <StyledIconHoverContainer\n        ref={ref}\n        hoverContainerSelector={hoverContainerSelector}\n      >\n        <PlatformIcon {...props} className={className} />\n        <PlatformIcon\n          {...props}\n          className={className}\n          icon={hoverIcon ?? amendName(props.icon, \"Hover\")}\n          data-hover\n        />\n      </StyledIconHoverContainer>\n    );\n  }\n);\n","import useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport React, { ForwardedRef } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\ninterface IconModifiers {\n  Selected?: boolean;\n  Focused?: boolean;\n  Disabled?: boolean;\n  Editable?: boolean;\n  Pressed?: boolean;\n}\n\nexport interface ThemeIconProps extends IconProps {\n  /**\n   * Icon which will be resolved against the default icon location based on theme type\n   */\n  icon: string | { name: string; modifiers: IconModifiers };\n\n  /**\n   * A theme key that can optionally override the icon.\n   */\n  themePath?: string;\n}\n\nconst ICONS_DIR_PREFIX = \"com/intellij/ide/ui/laf/icons/\";\n\n// Similar to LafIconLookup\nfunction findIconPath(\n  theme: Theme,\n  name: string,\n  modifiers: IconModifiers = {}\n) {\n  const basePath = `${ICONS_DIR_PREFIX}${\n    theme.isUnderDarcula() ? \"darcula/\" : \"intellij/\"\n  }`;\n  const suffix = (\n    [\"Editable\", \"Selected\", \"Pressed\", \"Focused\", \"Disabled\"] as Array<\n      keyof typeof modifiers\n    >\n  )\n    .filter((modifier) =>\n      // Focused or Pressed can't coexist with Disabled\n      modifiers.Disabled ? ![\"Focused\", \"Pressed\"].includes(modifier) : true\n    )\n    .reduce(\n      (soFar, modifier) => soFar + (modifiers[modifier] ? modifier : \"\"),\n      \"\"\n    );\n  return `${basePath}${name}${suffix}.svg`;\n}\n\nfunction useIconPath(\n  iconDescriptor: string | { name: string; modifiers?: IconModifiers },\n  themePath?: string\n) {\n  const theme = useTheme() as Theme; // TODO: investigate why useTheme is typed like this\n  const resolvedValue = themePath && theme.value(themePath);\n  if (resolvedValue) {\n    return resolvedValue;\n  }\n  const { modifiers = {}, name } =\n    typeof iconDescriptor === \"string\"\n      ? { name: iconDescriptor }\n      : iconDescriptor;\n  return findIconPath(theme, name, modifiers);\n}\n\nexport const LafIcon = React.forwardRef(\n  (\n    { themePath, icon, size, ...props }: ThemeIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const resolvedIconPath = useIconPath(icon, themePath);\n\n    const ref = useForwardedRef(forwardedRef);\n    useSvgIcon({ path: `platform/platform-impl/src/${resolvedIconPath}` }, ref);\n    return <StyledIconWrapper {...props} ref={ref} size={size} />;\n  }\n);\n","import React, { ForwardedRef } from \"react\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { IconProps } from \"./IconProps\";\nimport { StyledIconWrapper } from \"./StyledIconWrapper\";\nimport { useSvgIcon } from \"./useSvgIcon\";\n\nexport interface PlatformIconProps extends IconProps {\n  /**\n   * Icon path in intellij platform repo.\n   * If starts with \"/\", the path will be from the repo root. Otherwise, it's relative to \"platform/icons/src\".\n   * \".svg\" extension is optional.\n   */\n  icon: string;\n  /**\n   * Similar to icon, but for dark themes.\n   */\n  darkIcon?: string;\n}\n\nexport const amendName = (iconNameOrPath: string, amendment: string) => {\n  const [name, ext] = iconNameOrPath.split(\".\");\n  return `${name}${amendment}${ext ? `.${ext}` : \"\"}`;\n};\n\nexport const getDarkPath = (path: string, darkPath?: string) => {\n  const [name, ext] = path.split(\".\");\n  return darkPath || `${name}_dark${ext ? `.${ext}` : \"\"}`;\n};\n\nconst getPlatformIconPath = (relativePath: string) =>\n  relativePath.startsWith(\"/\")\n    ? relativePath.slice(1)\n    : `platform/icons/src/${relativePath}`;\n\n/**\n * Renders an icon from the predefined list of platform icons.\n * icon name must follow the directory structure in platform icons.\n * @example <PlatformIcon icon=\"general/hideToolWindow\" />\n * @example <PlatformIcon icon=\"toolbar/pin\" />\n * @example <PlatformIcon icon=\"toolbar/pin.svg\" />\n * @example <PlatformIcon icon=\"/platform/dvcs-impl/resources/icons/currentBranchLabel.svg\" />\n */\nexport const PlatformIcon = React.forwardRef(\n  (\n    { icon, darkIcon, ...props }: PlatformIconProps,\n    forwardedRef: ForwardedRef<HTMLElement>\n  ) => {\n    const ref = useForwardedRef(forwardedRef);\n    const theme = useTheme();\n    const iconName = theme.dark ? getDarkPath(icon, darkIcon) : icon;\n    useSvgIcon(\n      {\n        path: getPlatformIconPath(iconName),\n        fallbackPath: getPlatformIconPath(icon),\n      },\n      ref\n    );\n\n    return <StyledIconWrapper {...props} ref={ref} />;\n  }\n);\n","import { styled } from \"../styled\";\nimport { IconSize } from \"@intellij-platform/core/Icon/IconProps\";\n\nconst DEFAULT_ICON_SIZE: IconSize = 16;\n\nexport const StyledIconWrapper = styled.span<{\n  size?: IconSize;\n  useCurrentColor?: boolean;\n  role?: string;\n}>`\n  box-sizing: border-box;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 0;\n  width: ${({ size = DEFAULT_ICON_SIZE }) => `${size}px`};\n  height: ${({ size = DEFAULT_ICON_SIZE }) => `${size}px`};\n  position: relative; // to allow absolute positioned indicators and overlays on icon\n  cursor: ${({ role }) => (role === \"button\" ? \"pointer\" : undefined)};\n`;\n","import { RefObject, useContext, useEffect } from \"react\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\n\nexport function useSvgIcon(\n  { path, fallbackPath }: { path: string; fallbackPath?: string },\n  /**\n   * ref to the icon wrapper element in which the svg should be injected.\n   * This hook used to return svg string, and that svg was set as dangerouslySetInnerHTML. But now it injects the svg.\n   * by direct DOM manipulation. That's to eliminate the need for using dangerouslySetInnerHTML, so that we can allow\n   * arbitrary children (like LiveIndicator) as overlays on top of icons.\n   */\n  ref: RefObject<HTMLElement>\n) {\n  const theme = useTheme();\n  const itemState = useContext(ItemStateContext);\n  const selected = itemState?.isSelected || itemState?.isContainerFocused;\n  useEffect(() => {\n    let canceled = false;\n    const fetchIcon = async () => {\n      if (!path) {\n        console.error(\"icon path is empty\");\n        return;\n      }\n      if (ref.current) {\n        // For querying for icons that are not loaded yet. Especially useful for visual testing\n        ref.current.ariaBusy = \"true\";\n      }\n      const svg = await theme\n        .getSvgIcon(path, selected)\n        .catch((e) => {\n          if (fallbackPath) {\n            return theme.getSvgIcon(fallbackPath, selected);\n          }\n          throw e;\n        })\n        .finally(() => {\n          if (ref?.current && !canceled) {\n            ref.current.ariaBusy = \"false\";\n          }\n        });\n      if (svg) {\n        const element = ref?.current;\n        if (!canceled && element) {\n          element.querySelector(\"svg\")?.remove();\n          const svgElement = document.createElement(\"svg\");\n          element.appendChild(svgElement);\n          svgElement.outerHTML = makeIdsUnique(svg); // UNSAFE! Would require sanitization, or icon sources must be trusted.\n        }\n      } else {\n        console.error(\"Could not resolve icon:\", path);\n      }\n    };\n    fetchIcon().catch(console.error);\n    return () => {\n      canceled = true;\n    };\n  }, [path, selected]);\n}\n\n/**\n * If multiple instance of the same icon is rendered at the same time, and the SVG includes\n * url(#...) references to locally defined ids, in some cases the icon is not rendered properly.\n * because of ids colliding. We make sure the ids are unique in each rendered icon.\n */\nfunction makeIdsUnique(svg: string): string {\n  const randomPostfix = (Math.random() * 1000).toFixed(0);\n  const idMatches = svg.matchAll(/id=\"(.*?)\"/g);\n  return [...idMatches].reduce((modifiedSvg, [_, id]) => {\n    const newId = `${id}-${randomPostfix}`;\n    return replaceAll(\n      `id=\"${id}\"`,\n      `id=\"${newId}\"`,\n      replaceAll(`url(#${id})`, `url(#${newId})`, modifiedSvg)\n    );\n  }, svg);\n}\n\nfunction replaceAll(theOld: string, theNew: string, str: string): string {\n  const replaced = str.replace(theOld, theNew);\n  const replacedAgain = replaced.replace(theOld, theNew);\n  if (replaced === replacedAgain) {\n    return replaced;\n  }\n  return replaceAll(theOld, theNew, replacedAgain);\n}\n","import { PressProps, usePress } from \"@react-aria/interactions\";\nimport React, { ForwardedRef, HTMLProps } from \"react\";\nimport { styled } from \"../styled\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface IconButtonProps\n  extends PressProps,\n    // Maybe we should allow any arbitrary HTMLProps<HTMLButtonElement> props, instead of whitelisting?\n    Pick<\n      HTMLProps<HTMLButtonElement>,\n      \"onFocus\" | \"onBlur\" | \"style\" | \"className\"\n    > {\n  children?: React.ReactNode;\n  /**\n   * The minimum width/height of the button.\n   */\n  minSize?: number;\n  /**\n   * Whether the button should be focusable by pressing tab. The default is true for icon buttons (aka. action buttons),\n   * which means they are not included in the tab order.\n   */\n  excludeFromTabOrder?: boolean;\n}\n\nexport const DEFAULT_MINIMUM_BUTTON_SIZE = 22;\nexport const NAVBAR_MINIMUM_BUTTON_SIZE = 20;\n\nexport const StyledIconButton = styled.button<{ minSize: number }>`\n  position: relative; // to allow absolutely positioned overlays like an dropdown icon at the bottom right corner\n  background: none;\n  color: inherit;\n  border: 1px solid transparent;\n  border-radius: 3px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-height: ${({ minSize }) => `${minSize}px`};\n  min-width: ${({ minSize }) => `${minSize}px`};\n  padding: 0;\n  margin: 0;\n  &:disabled {\n    opacity: 0.25; // not quite accurate implementation. There might be better ways to style disabled state.\n  }\n  &:hover:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBackground\", \"#DFDFDF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.hoverBorderColor\", \"#DFDFDF\")};\n  }\n  &:focus-visible:not(:disabled) {\n    outline: none;\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\n        \"ActionButton.focusedBorderColor\",\n        theme.dark ? \"#5eacd0\" : \"#62b8de\"\n      )};\n  }\n  &:active:not(:disabled),\n  &.active:not(:disabled) {\n    background: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBackground\", \"#CFCFCF\")};\n    border-color: ${({ theme }) =>\n      theme.color(\"ActionButton.pressedBorderColor\", \"#CFCFCF\")};\n  }\n`;\n\n/**\n * Icon button, aka Action Button, in the reference implementation.\n * @see https://jetbrains.github.io/ui/controls/icon_button/\n */\nexport const IconButton = React.forwardRef(function IconButton(\n  {\n    minSize = DEFAULT_MINIMUM_BUTTON_SIZE,\n    preventFocusOnPress = true,\n    excludeFromTabOrder = true,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    ...otherProps\n  }: IconButtonProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  // FIXME: use useButton\n\n  const ref = useObjectRef(forwardedRef);\n  const { focusableProps } = useFocusable({ isDisabled }, ref);\n  const { pressProps, isPressed } = usePress({\n    ref,\n    isPressed: isPressedInput,\n    isDisabled,\n    onPress,\n    onPressChange,\n    onPressEnd,\n    onPressStart,\n    onPressUp,\n    shouldCancelOnPointerExit,\n    preventFocusOnPress,\n  });\n\n  return (\n    <StyledIconButton\n      className={isPressed ? \"active\" : \"\"}\n      disabled={isDisabled}\n      {...mergeProps(pressProps, otherProps, focusableProps)}\n      minSize={minSize}\n      tabIndex={excludeFromTabOrder && !isDisabled ? -1 : undefined}\n      ref={ref}\n    />\n  );\n});\n","import React, { useRef } from \"react\";\nimport styled from \"styled-components\";\nimport {\n  IconButton,\n  IconButtonProps,\n} from \"@intellij-platform/core/IconButton\";\nimport { MenuTrigger, MenuTriggerProps } from \"@intellij-platform/core/Menu\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst ArrowIcon = styled(PlatformIcon)`\n  position: absolute;\n  right: 1px;\n  bottom: 1px;\n`;\n\ntype IconButtonWithMenuProps = IconButtonProps &\n  Pick<MenuTriggerProps, \"renderMenu\"> & {\n    /**\n     * whether the default arrow should be removed or not. false by default.\n     */\n    noArrow?: boolean;\n  };\n/**\n * Renders an IconButton which opens a menu. by default a down arrow icon is shown as an overlay on the rendered\n * icon, but it can be disabled by passing `noArrow`. It also restores the focus to the previously focused element,\n * when the menu is closed.\n * @param renderMenu: render prop for rendering the menu\n * @param children: the content of the icon button\n * @param noArrow: whether the default arrow should be removed or not. false by default.\n * @param buttonProps: the rest of the props that will be passed down to IconButton\n *\n * TODO: Add story and write test for focus restoration, noArrow, and basic functionality.\n */\nexport const IconButtonWithMenu = ({\n  renderMenu,\n  children,\n  noArrow = false,\n  ...buttonProps\n}: IconButtonWithMenuProps) => {\n  const previouslyFocusedElementRef = useRef<HTMLElement>();\n  return (\n    <MenuTrigger\n      renderMenu={renderMenu}\n      onOpenChange={(open) => {\n        if (!open && previouslyFocusedElementRef.current) {\n          previouslyFocusedElementRef.current.focus();\n        }\n      }}\n    >\n      {(props, ref) => (\n        <IconButton\n          {...mergeProps(buttonProps, props, {\n            onFocus: (e: FocusEvent) => {\n              if (e.relatedTarget && e.relatedTarget instanceof HTMLElement) {\n                previouslyFocusedElementRef.current = e.relatedTarget;\n              }\n            },\n          })}\n          ref={ref}\n        >\n          {children}\n          {!noArrow && <ArrowIcon icon=\"general/dropdown.svg\" />}\n        </IconButton>\n      )}\n    </MenuTrigger>\n  );\n};\n","import React, { ComponentProps, HTMLAttributes, HTMLProps } from \"react\";\nimport { useTheme } from \"styled-components\";\nimport { Theme } from \"./Theme/Theme\";\n\ninterface Props extends React.ImgHTMLAttributes<HTMLImageElement> {\n  /**\n   * src for when a dark theme is active. if `darkSrc` doesn't have a non-empty string value, src will be used both\n   * for dark and light themes.\n   */\n  darkSrc?: string;\n}\n/**\n * Same as default `img`, but theme aware. Meaning that you can specify different sources for normal and dark mode.\n */\nexport const Img: React.FC<Props> = ({ darkSrc, ...props }) => {\n  const theme = useTheme() as Theme;\n  if (theme.dark) {\n    return <img {...props} src={darkSrc || props.src} />;\n  }\n  return <img {...props} />;\n};\n","import React, {\n  ForwardedRef,\n  InputHTMLAttributes,\n  useEffect,\n  useState,\n} from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { FocusableOptions, useFocusable } from \"@react-aria/focus\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled, css } from \"@intellij-platform/core/styled\";\n\nconst StyledInputBox = styled.div<{\n  disabled?: boolean;\n  focused?: boolean;\n  validationState: InputProps[\"validationState\"];\n  appearance: InputProps[\"appearance\"];\n}>`\n  box-sizing: border-box;\n  display: inline-flex;\n  min-width: 4rem; // https://jetbrains.github.io/ui/controls/input_field/#28\n  background: ${({ theme, disabled }) =>\n    disabled\n      ? theme.color(\"TextField.disabledBackground\")\n      : theme.color(\"TextField.background\")};\n  border: 1px solid\n    ${({ theme, focused, disabled, validationState }) =>\n      theme.commonColors.border({\n        focused,\n        disabled,\n        validationState,\n      })};\n  box-shadow: 0 0 0 0.125rem\n    ${({ theme, focused = false, validationState, disabled }) =>\n      disabled\n        ? \"transparent\"\n        : theme.commonColors.focusRing({\n            validationState,\n            focused: focused,\n          })};\n  border-radius: 1px;\n  cursor: text; // the whole box moves focus to the input\n  overflow: hidden;\n  ${({ appearance, validationState, disabled }) =>\n    appearance === \"embedded\" &&\n    css`\n      border-color: ${validationState !== \"error\" && \"transparent\"};\n      box-shadow: ${validationState !== \"error\" && \"none\"};\n      background: ${!disabled && \"transparent\"};\n    `};\n`;\n\nconst StyledInput = styled.input<{ disabled?: boolean }>`\n  all: unset;\n  padding: 0.1875rem 0.375rem;\n  flex: 1; // fill in the available space within the input box\n  min-width: 0;\n  line-height: 1rem;\n  color: ${({ theme }) =>\n    theme.color(\n      \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n    )};\n  color: ${({ theme, disabled }) =>\n    disabled &&\n    theme.color(\n      \"TextField.inactiveForeground\" as UnknownThemeProp<\"TextField.inactiveForeground\">\n    )};\n\n  caret-color: ${({ theme }) =>\n    theme.color(\n      \"TextField.caretForeground\" as UnknownThemeProp<\"TextField.caretForeground\">\n    )};\n  &::selection {\n    background: ${({ theme }) =>\n      theme.color(\n        \"*.selectionBackground\"\n      )}; // Not checked with the reference impl\n    color: ${({ theme }) =>\n      theme.color(\n        \"*.selectionForeground\"\n      )}; // Not checked with the reference impl\n  }\n  &::placeholder {\n    color: ${({ theme }) => theme.commonColors.inactiveTextColor};\n  }\n`;\n\nconst StyledAddons = styled.div`\n  display: inline-flex;\n  align-items: center;\n  gap: 0.25rem; /* TODO: check */\n  padding: 1px 0;\n`;\nconst StyledRightAddons = styled(StyledAddons)`\n  margin-right: 0.125rem; /* TODO: check */\n`;\n\nconst StyledLeftAddons = styled(StyledAddons)`\n  margin-left: 0.375rem; /* TODO: check */\n`;\n\nexport interface InputProps extends InputHTMLAttributes<HTMLInputElement> {\n  validationState?: \"valid\" | \"error\" | \"warning\";\n  /**\n   * Whether to auto select the value initially\n   */\n  autoSelect?: boolean;\n\n  /**\n   * Rendered inside the input box and after the input element.\n   * Used to render [Built-in buttons](https://jetbrains.github.io/ui/controls/built_in_button/).\n   */\n  addonAfter?: React.ReactNode;\n  /**\n   * Rendered inside the input box and before the input element.\n   */\n  addonBefore?: React.ReactNode;\n\n  /**\n   * Ref to the underlying input element\n   */\n  inputRef?: React.Ref<HTMLInputElement>;\n\n  /**\n   * Appearance of the input.\n   * - \"ghost\": Without the border and shadow in valid state.\n   * - \"boxed\" With the border and shadow.\n   * @default \"box\"\n   */\n  appearance?: \"embedded\" | \"box\";\n}\n\n/**\n * Bare input, themed, and with a few extra features:\n * - Support for \"error\" and \"warning\" state ({@param validationState}\n * - Support for autoSelect.\n * - Disables spell check by default. It can be overwritten.\n * Use {@link InputField} for more features like an associated label, error message and context help.\n */\nexport const Input = React.forwardRef(function Input(\n  {\n    validationState,\n    autoSelect,\n    addonBefore,\n    addonAfter,\n    style,\n    className,\n    inputRef: inputRefProp,\n    onFocus,\n    onBlur,\n    autoFocus,\n    appearance,\n    ...props\n  }: InputProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  const inputRef = useObjectRef(inputRefProp);\n  const { focusableProps } = useFocusable(\n    {\n      isDisabled: props.disabled,\n      autoFocus,\n      onFocus,\n      onBlur,\n    } as FocusableOptions,\n    inputRef\n  );\n  const [isFocused, setIsFocused] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setIsFocused,\n  });\n\n  useEffect(() => {\n    if (autoSelect) {\n      inputRef.current?.select();\n    }\n  }, [autoSelect]);\n\n  return (\n    <StyledInputBox\n      ref={ref}\n      spellCheck={false}\n      appearance={appearance}\n      {...mergeProps(focusWithinProps, {\n        className,\n        style,\n        onMouseDown: (event: MouseEvent) => {\n          if (event.target !== inputRef.current) {\n            event.preventDefault();\n            inputRef.current?.focus();\n          }\n        },\n      })}\n      focused={isFocused}\n      validationState={validationState}\n      disabled={props.disabled}\n    >\n      {addonBefore && <StyledLeftAddons>{addonBefore}</StyledLeftAddons>}\n      <StyledInput ref={inputRef} {...mergeProps(props, focusableProps)} />\n      {addonAfter && <StyledRightAddons>{addonAfter}</StyledRightAddons>}\n    </StyledInputBox>\n  );\n});\n","import React, {\n  ChangeEvent,\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n} from \"react\";\nimport { AriaFieldProps, useField } from \"@react-aria/label\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { FocusableProps } from \"@react-types/shared\";\nimport {\n  PositionedTooltipTrigger,\n  ValidationTooltip,\n} from \"@intellij-platform/core/Tooltip\";\nimport { Input, InputProps } from \"@intellij-platform/core/InputField/Input\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  ContextHelpProps,\n  WithInlineContextHelp,\n} from \"@intellij-platform/core/Field/ContextHelp\";\nimport { LabelPlacement, WithLabel } from \"@intellij-platform/core/Field/Label\";\n\nexport interface InputFieldProps\n  extends Omit<\n      AriaFieldProps,\n      \"labelElementType\" | \"validationState\" | \"errorMessage\" | \"isInvalid\"\n    >,\n    FocusableProps,\n    Pick<\n      InputProps,\n      \"addonBefore\" | \"addonAfter\" | \"inputRef\" | \"validationState\"\n    >,\n    ContextHelpProps {\n  /**\n   * className applied on the field's wrapper div.\n   */\n  className?: string;\n  /**\n   * style applied on the field's wrapper div.\n   */\n  style?: CSSProperties;\n  /**\n   * Label to be associated with the input.\n   */\n  label?: React.ReactNode;\n  /**\n   * Placement of the label with respect to the input box.\n   */\n  labelPlacement?: LabelPlacement;\n\n  /**\n   * Whether the input is disabled. Use this prop\n   */\n  isDisabled?: boolean;\n\n  /**\n   * Convenient prop to be used instead of inputProps.placeholder\n   **/\n  placeholder?: string;\n  /**\n   * Convenient prop to be used instead of inputProps.value\n   **/\n  value?: HTMLProps<HTMLInputElement>[\"value\"];\n  /**\n   * Convenient prop to be used instead of inputProps.defaultValue\n   **/\n  defaultValue?: HTMLProps<HTMLInputElement>[\"defaultValue\"];\n  /**\n   * Convenient prop to be used instead of inputProps.onChange. It also calls the passed callback with the\n   * change value instead of input.\n   **/\n  onChange?: (newValue: string) => void;\n  /**\n   * Props to be passed to the underlying input element.\n   **/\n  inputProps?: Omit<\n    HTMLProps<HTMLInputElement>,\n    \"as\" | \"ref\" | \"disabled\" //isDisabled should be used\n  >;\n  /**\n   * Whether to auto select the value initially\n   */\n  autoSelect?: boolean;\n\n  /**\n   * Validation message shown as a {@link ValidationTooltip} above the field.\n   * {@link ValidationTooltipProps#type} is defined based on `validationState`.\n   */\n  validationMessage?: React.ReactNode;\n}\n\nconst StyledInput = styled(Input)`\n  width: 100%;\n`;\n\n/**\n * An input box with an associated label, error message, and context help.\n */\nexport const InputField = React.forwardRef(function InputField(\n  {\n    validationState,\n    validationMessage,\n    className,\n    style,\n    labelPlacement = \"before\",\n    contextHelp,\n    contextHelpPlacement,\n    inputProps = {},\n    addonBefore,\n    addonAfter,\n    inputRef,\n    ...props\n  }: InputFieldProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref = useObjectRef(forwardedRef);\n  const { fieldProps, errorMessageProps, labelProps, descriptionProps } =\n    useField({\n      ...props,\n      errorMessage: validationMessage,\n      validationState:\n        validationState === \"error\" || validationState === \"warning\"\n          ? \"invalid\"\n          : \"valid\",\n    });\n\n  return (\n    <WithLabel\n      ref={ref}\n      label={props.label}\n      labelPlacement={labelPlacement}\n      isDisabled={props.isDisabled}\n      labelProps={labelProps}\n      className={className}\n      style={style}\n    >\n      <WithInlineContextHelp\n        contextHelp={contextHelp}\n        contextHelpPlacement={contextHelpPlacement}\n        descriptionProps={descriptionProps}\n      >\n        <PositionedTooltipTrigger\n          placement=\"top start\"\n          crossOffset={36}\n          showOnFocus\n          isDisabled={!validationMessage}\n          tooltip={\n            <ValidationTooltip\n              type={validationState !== \"valid\" ? validationState : undefined}\n            >\n              <div {...errorMessageProps}>{validationMessage}</div>\n            </ValidationTooltip>\n          }\n          delay={0}\n        >\n          <StyledInput\n            inputRef={inputRef}\n            placeholder={props.placeholder}\n            disabled={props.isDisabled}\n            validationState={validationState}\n            autoSelect={props.autoSelect}\n            autoFocus={props.autoFocus}\n            addonAfter={addonAfter}\n            addonBefore={addonBefore}\n            {...mergeProps(fieldProps, inputProps, {\n              value: props.value,\n              defaultValue: props.defaultValue,\n              onChange: (e: ChangeEvent<HTMLInputElement>) =>\n                props.onChange?.(e.target.value),\n            })}\n          />\n        </PositionedTooltipTrigger>\n      </WithInlineContextHelp>\n    </WithLabel>\n  );\n});\n","import { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nconst getDefaultLinkColor = ({ theme }: { theme: Theme }) =>\n  theme.commonColors.linkForegroundEnabled;\n\nexport const StyledLink = styled.a`\n  cursor: pointer;\n  text-decoration: none;\n  outline: none;\n  // &:focus-visible didn't work as expected, so FocusRing is used\n  &.focus-visible {\n    outline: 1px solid\n      ${({ theme }) =>\n        theme.color(\n          \"Link.focusedBorderColor\" as UnknownThemeProp<\"Link.focusedBorderColor\">,\n          theme.commonColors.focusBorderColor\n        )};\n    border-radius: 2px; // Registry.intValue(\"ide.link.button.focus.round.arc\", 4)\n  }\n  color: ${getDefaultLinkColor};\n\n  &:hover,\n  &.hover /* for testing purposes*/ {\n    text-decoration: underline;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.hoverForeground\",\n        theme.color(\n          \"link.hover.foreground\" as UnknownThemeProp<\"link.hover.foreground\">,\n          \"\" /*FIXME: check*/\n        )\n      )};\n  }\n  &:active,\n  &.active {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.pressedForeground\",\n        theme.color(\n          \"link.pressed.foreground\" as UnknownThemeProp<\"link.pressed.foreground\">,\n          !theme.dark ? \"#F00000\" : \"#BA6F25\"\n        )\n      )};\n  }\n  &:disabled,\n  &.disabled {\n    cursor: default;\n    text-decoration: none;\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.disabledForeground\" as UnknownThemeProp<\"Link.disabledForeground\">,\n        theme.color(\n          \"Label.disabledForeground\",\n          theme.color(\"Label.disabledText\", \"#999\")\n        )\n      )};\n  }\n  // We may need to refine this to allow passing visited as a prop for links that don't have href, and not apply the\n  // styles in that case, since it seems no href is considered visited by default. Although, in all main themes\n  // Link.visitedForeground is set to the default link color.\n  &:visited,\n  &.visited {\n    color: ${({ theme }) =>\n      theme.color(\n        \"Link.visitedForeground\",\n        theme.color(\n          \"link.visited.foreground\" as UnknownThemeProp<\"link.visited.foreground\">,\n          !theme.dark ? \"#800080\" : \"#9776A9\"\n        )\n      )};\n  }\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { AriaLinkProps } from \"@react-types/link\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { FocusRing, useFocusable } from \"@react-aria/focus\";\nimport { StyledLink } from \"@intellij-platform/core/Link/StyledLink\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\n\nexport type LinkProps = AriaLinkProps & {\n  isDisabled?: boolean;\n  className?: string;\n  children: React.ReactNode;\n  preventFocusOnPress?: boolean; // Should this be become true by default?\n  excludeFromTabOrder?: boolean;\n};\n\n/**\n * A focusable span in style of [Link](https://jetbrains.github.io/ui/controls/link/) and with accessibility role of link.\n *\n * TODO and known issues:\n * - in the reference impl, Space presses the link, Enter doesn't. It's vice versa here, because of how usePress is implemented.\n * - Support for External links\n * - Support for Anchor elements?\n *\n * Unknowns:\n * - What are ActionLink and DefaultLinkButtonUI?\n * - What is HyperLinkLabel compared to LabelLink (which was looked into in implementation of this component)?\n */\nexport const Link = React.forwardRef(\n  (\n    props: LinkProps,\n    forwardedRef: ForwardedRef<HTMLAnchorElement>\n  ): React.ReactElement => {\n    const ref = useForwardedRef(forwardedRef);\n\n    const { focusableProps } = useFocusable(props, ref);\n    const { pressProps, isPressed } = usePress({ ...props, ref });\n    const domProps = filterDOMProps(props, { labelable: true });\n    const interactionHandlers = mergeProps(focusableProps, pressProps);\n\n    return (\n      <FocusRing focusRingClass=\"focus-visible\">\n        <StyledLink\n          {...mergeProps(focusableProps, interactionHandlers, domProps)}\n          as=\"span\"\n          role=\"link\"\n          ref={ref}\n          // maybe use clsx\n          className={`${props.isDisabled ? \"disabled\" : \"\"} ${\n            isPressed ? \"active\" : \"\"\n          } ${props.className || \"\"}`}\n          aria-disabled={props.isDisabled || undefined}\n          tabIndex={\n            !props.isDisabled ? (props.excludeFromTabOrder ? -1 : 0) : undefined\n          }\n        >\n          {props.children}\n        </StyledLink>\n      </FocusRing>\n    );\n  }\n);\n","import { AriaListBoxProps } from \"@react-types/listbox\";\nimport { AsyncLoadable, Node } from \"@react-types/shared\";\nimport React, { ForwardedRef, Key } from \"react\";\nimport { useList } from \"./useList\";\nimport { ListItem } from \"./ListItem\";\nimport { StyledList } from \"./StyledList\";\nimport { useListState } from \"./useListState\";\nimport { filterDOMProps, useObjectRef } from \"@react-aria/utils\";\n\nimport { CollectionRefProps } from \"@intellij-platform/core/Collections/useCollectionRef\";\nimport { Virtualizer } from \"@react-aria/virtualizer\";\nimport { useListVirtualizer } from \"@intellij-platform/core/List/useListVirtualizer\";\nimport { ListContext } from \"@intellij-platform/core/List/ListContext\";\nimport { CollectionFocusProxyProps } from \"@intellij-platform/core/Collections\";\n\nexport type ListProps<T extends object> = Omit<\n  Omit<AriaListBoxProps<T>, \"disallowEmptySelection\">,\n  keyof AsyncLoadable\n> &\n  CollectionRefProps &\n  CollectionFocusProxyProps & {\n    /**\n     * fills the available horizontal or vertical space, when rendered in a flex container.\n     */\n    fillAvailableSpace?: boolean;\n    /**\n     * When true, shows the list in focused style, even when it's not focused. A common use case is when the list\n     * is virtually focused. i.e. the focus is physically on some other element (like a search input) which handles\n     * keyboard events as if the list was focused.\n     * Another (maybe questionable) use case is master detail views, where the master view is shown as focused, even\n     * when the details view has physical focus.\n     */\n    showAsFocused?: boolean;\n    allowEmptySelection?: boolean;\n    /**\n     * Called when the action for the item should be triggered, which can be by double click or pressing Enter.\n     * Enter not implemented yet :D\n     */\n    onAction?: (key: Key) => void;\n\n    /**\n     * Useful when list items have a custom height, to hint layout calculation logic about the item height which\n     * increases rendering efficiency and also prevents flash of items with wrong height.\n     */\n    estimatedItemHeight?: number;\n\n    className?: string;\n  };\n\n/**\n * List view\n */\nexport const List = React.forwardRef(function List<T extends object>(\n  {\n    allowEmptySelection = false,\n    fillAvailableSpace = false,\n    estimatedItemHeight,\n    className,\n    ...inputProps\n  }: ListProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const props: AriaListBoxProps<T> & CollectionRefProps = {\n    ...inputProps,\n    disallowEmptySelection: !allowEmptySelection,\n  };\n  const ref = useObjectRef(forwardedRef);\n  const state = useListState(props);\n  const { listProps, listContext } = useList(\n    {\n      ...props,\n      isVirtualized: true,\n    },\n    state,\n    ref\n  );\n\n  const {\n    virtualizerProps: { children: renderNode, ...virtualizerProps },\n  } = useListVirtualizer({\n    state,\n    estimatedItemHeight,\n    renderItem: (item) => <ListItem key={item.key} item={item} />,\n  });\n\n  return (\n    <ListContext.Provider value={listContext}>\n      <StyledList\n        as={Virtualizer<Node<any>, any>}\n        {...virtualizerProps}\n        {...listProps}\n        {...filterDOMProps(props, { labelable: true })}\n        fillAvailableSpace={fillAvailableSpace}\n        className={className}\n        ref={ref}\n      >\n        {renderNode}\n      </StyledList>\n    </ListContext.Provider>\n  );\n});\n","import React, { Key } from \"react\";\nimport { ListState } from \"@react-stately/list\";\n\nexport type ListContextType<T> = {\n  state: ListState<T>;\n  focused: boolean;\n  onAction: ((key: Key) => void) | undefined;\n};\n\nexport const ListContext = React.createContext<ListContextType<any> | null>(\n  null\n);\n","import React from \"react\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { useSeparator } from \"@react-aria/separator\";\n\nexport const ListDivider: React.FC = () => {\n  return (\n    <StyledVerticalSeparator\n      as={\"li\"}\n      {...useSeparator({ elementType: \"li\", orientation: \"vertical\" })\n        .separatorProps}\n    />\n  );\n};\n","import React, { useContext } from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport { StyledListItem } from \"./StyledListItem\";\nimport { ListContext } from \"@intellij-platform/core/List/ListContext\";\n\nexport interface ListItemProps<T> {\n  item: Node<T>;\n  children?: React.ReactNode;\n}\n\nexport function ListItem<T>({ item, children }: ListItemProps<T>) {\n  const { state, focused: listFocused, onAction } = useContext(ListContext)!;\n  const ref = React.useRef(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isSelected = state.selectionManager.isSelected(item.key);\n\n  const { itemProps } = useSelectableItem({\n    key: item.key,\n    ref,\n    onAction: () => onAction?.(item.key),\n    selectionManager: state.selectionManager,\n  });\n\n  return (\n    <StyledListItem\n      containerFocused={listFocused}\n      selected={isSelected}\n      disabled={isDisabled}\n      aria-disabled={isDisabled}\n      aria-selected={isSelected}\n      aria-label={item[\"aria-label\"]}\n      {...itemProps}\n      ref={ref}\n    >\n      <ItemStateContext.Provider\n        value={{\n          isDisabled,\n          isSelected,\n          isContainerFocused: listFocused,\n          node: item,\n        }}\n      >\n        {children || item.rendered}\n      </ItemStateContext.Provider>\n    </StyledListItem>\n  );\n}\n","import { css } from \"styled-components\";\nimport { styled } from \"../styled\";\n\ntype StyledListProps = {\n  fillAvailableSpace?: boolean;\n};\nexport const StyledList = styled.div\n  .attrs<StyledListProps>((props) => ({ role: props.role || \"list\" }))\n  .withConfig<StyledListProps>({\n    shouldForwardProp: (prop) => prop !== \"fillAvailableSpace\",\n  })<StyledListProps>`\n  padding: 0;\n  margin: 0;\n  list-style: none;\n  max-height: 100%;\n  overflow: auto;\n  color: ${({ theme }) => theme.color(\"*.textForeground\")};\n  outline: none;\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      height: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n    `}\n  background: ${({ theme }) => theme.color(\"List.background\")};\n`;\n","import { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { styled } from \"../styled\";\n\nexport type StyledListItemProps = {\n  containerFocused: boolean;\n  selected: boolean;\n  disabled: boolean;\n};\n\nexport const StyledListItem = styled.div.attrs<StyledListItemProps>(\n  (props) => ({\n    role: props.role || \"listitem\",\n  })\n)<StyledListItemProps>`\n  ${({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"List.foreground\" as UnknownThemeProp<\"List.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color = theme.asCurrentForeground(\n          theme.color(\n            \"List.selectionForeground\" as UnknownThemeProp<\"List.selectionForeground\">\n          ) || theme.commonColors.labelSelectedForeground\n        ) /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"List.selectionBackground\" as UnknownThemeProp<\"List.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"List.selectionInactiveForeground\" as UnknownThemeProp<\"List.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"List.selectionBackgroundInactive\" as UnknownThemeProp<\"List.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor: theme.asCurrentBackground(backgroundColor),\n      color,\n    };\n  }};\n  position: relative;\n  display: flex;\n  white-space: nowrap;\n  padding: 0 0.5rem; // themed?\n  line-height: 1.25rem;\n  outline: none;\n  cursor: default;\n  min-width: min-content; // Needed for content sizing for when list/tree is used inside popup or modal window\n`;\n","import { AriaSelectableListOptions } from \"@react-aria/selection\";\nimport { ListState } from \"@react-stately/list\";\nimport React, { Key, useEffect, useMemo, useState } from \"react\";\nimport { useSelectableList } from \"./useSelectableList\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { CollectionRefProps } from \"@intellij-platform/core/Collections/useCollectionRef\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport { ListContextType } from \"@intellij-platform/core/List/ListContext\";\nimport {\n  CollectionFocusProxyProps,\n  useCollectionFocusProxy,\n} from \"@intellij-platform/core/Collections\";\n\nexport interface ListProps\n  extends Omit<\n      AriaSelectableListOptions,\n      | \"disallowEmptySelection\"\n      | \"selectOnFocus\"\n      | \"selectionManager\" // Grouped as state, the second argument, like in useListBox\n      | \"collection\" // Grouped as state, the second argument, like in useListBox\n      | \"disabledKeys\" // Grouped as state, the second argument, like in useListBox\n      | \"ref\" // Third argument\n    >,\n    CollectionFocusProxyProps,\n    CollectionRefProps {\n  allowEmptySelection?: boolean;\n  /**\n   * Called when the action for the item should be triggered, which can be by double click or pressing Enter.\n   * Enter not implemented yet :D\n   */\n  onAction?: (key: Key) => void;\n  showAsFocused?: boolean;\n  id?: string;\n}\n// import { useSelectableList } from \"@react-aria/selection\";\n\nexport function useList<T>(\n  { onAction, showAsFocused, focusProxyRef, ...props }: ListProps,\n  state: ListState<T>,\n  ref: React.RefObject<HTMLElement>\n) {\n  const {\n    listProps: { onMouseDown, ...listProps },\n  } = useSelectableList({\n    ...props,\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    collection: state.collection,\n    disabledKeys: state.disabledKeys,\n    // if selectOnFocus is going to be an option (which is not in intellij UI), we should also conditionally show outline on items\n    selectOnFocus: true,\n  });\n\n  useCollectionFocusProxy({\n    focusProxyRef,\n    onAction,\n    state,\n    collectionRef: ref,\n  });\n\n  const [focused, setFocused] = useState(false);\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  // auto select the first item, if selection is empty and allowEmptySelection is false.\n  useEffect(() => {\n    const firstKey = state.collection.getFirstKey();\n    if (\n      !props.allowEmptySelection &&\n      state.selectionManager.isEmpty &&\n      firstKey\n    ) {\n      state.selectionManager.setFocusedKey(firstKey);\n      state.selectionManager.select(firstKey);\n    }\n  }, [!props.allowEmptySelection]);\n\n  const onActionCallback = useEventCallback(onAction ?? (() => {}));\n  const listContext: ListContextType<T> = useMemo(\n    () => ({\n      state,\n      focused: Boolean(focused || showAsFocused),\n      onAction: onActionCallback,\n    }),\n    [state, focused, showAsFocused]\n  );\n\n  return {\n    listProps: mergeProps(listProps, focusWithinProps),\n    listContext,\n    focused,\n  };\n}\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {\n  Collection,\n  FocusStrategy,\n  KeyboardDelegate,\n  Node,\n} from \"@react-types/shared\";\nimport { HTMLAttributes, Key, RefObject, useMemo } from \"react\";\nimport { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport {\n  MultipleSelectionManager,\n  SelectionManager,\n} from \"@react-stately/selection\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { useCollectionAutoScroll } from \"@intellij-platform/core/Collections/useCollectionAutoScroll\";\n\ninterface SelectableListOptions {\n  /**\n   * An interface for reading and updating multiple selection state.\n   */\n  selectionManager: MultipleSelectionManager;\n  /**\n   * State of the collection.\n   */\n  collection: Collection<Node<unknown>>;\n  /**\n   * The item keys that are disabled. These items cannot be selected, focused, or otherwise\n   * interacted with.\n   */\n  disabledKeys: Set<Key>;\n  /**\n   * A ref to the item.\n   */\n  ref: RefObject<HTMLElement>;\n  /**\n   * A delegate that returns collection item keys with respect to visual layout.\n   */\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Whether the collection or one of its items should be automatically focused upon render.\n   * @default false\n   */\n  autoFocus?: boolean | FocusStrategy;\n  /**\n   * Whether focus should wrap around when the end/start is reached.\n   * @default false\n   */\n  shouldFocusWrap?: boolean;\n  /**\n   * Whether the option is contained in a virtual scroller.\n   */\n  isVirtualized?: boolean;\n  /**\n   * Whether the collection allows empty selection.\n   * @default false\n   */\n  disallowEmptySelection?: boolean;\n  /**\n   * Whether selection should occur automatically on focus.\n   * @default false\n   */\n  selectOnFocus?: boolean;\n  /**\n   * Whether typeahead is disabled.\n   * @default false\n   */\n  disallowTypeAhead?: boolean;\n  /**\n   * Whether the collection items should use virtual focus instead of being focused directly.\n   */\n  shouldUseVirtualFocus?: boolean;\n  /**\n   * Whether navigation through tab key is enabled.\n   */\n  allowsTabNavigation?: boolean;\n}\n\ninterface SelectableListAria {\n  /**\n   * Props for the option element.\n   */\n  listProps: HTMLAttributes<HTMLElement>;\n}\n\n/**\n * Handles interactions with a selectable list.\n */\nexport function useSelectableList(\n  props: SelectableListOptions\n): SelectableListAria {\n  let {\n    selectionManager,\n    collection,\n    disabledKeys,\n    ref,\n    keyboardDelegate,\n    autoFocus,\n    shouldFocusWrap,\n    isVirtualized,\n    disallowEmptySelection,\n    selectOnFocus = false,\n    disallowTypeAhead,\n    shouldUseVirtualFocus,\n    allowsTabNavigation,\n  } = props;\n\n  // By default, a KeyboardDelegate is provided which uses the DOM to query layout information (e.g. for page up/page down).\n  // When virtualized, the layout object will be passed in as a prop and override this.\n  let collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n  let delegate = useMemo(\n    () =>\n      keyboardDelegate ||\n      new ListKeyboardDelegate(collection, disabledKeys, ref, collator),\n    [keyboardDelegate, collection, disabledKeys, ref, collator]\n  );\n  useCollectionAutoScroll(\n    { isVirtualized, selectionManager: selectionManager as SelectionManager },\n    ref\n  );\n\n  let { collectionProps } = useSelectableCollection({\n    ref,\n    selectionManager,\n    keyboardDelegate: delegate,\n    autoFocus,\n    shouldFocusWrap,\n    disallowEmptySelection,\n    selectOnFocus,\n    disallowTypeAhead,\n    shouldUseVirtualFocus,\n    allowsTabNavigation,\n  });\n\n  return {\n    listProps: collectionProps,\n  };\n}\n","import {\n  ListProps,\n  ListState,\n  useListState as originalUseListState,\n} from \"@react-stately/list\";\nimport {\n  CollectionRefProps,\n  useCollectionRef,\n} from \"@intellij-platform/core/Collections/useCollectionRef\";\n\nexport function useListState<T extends object>(\n  props: ListProps<T> & CollectionRefProps\n): ListState<T> {\n  const state = originalUseListState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  useCollectionRef(props, state);\n  return state;\n}\n","import { SelectionManager } from \"@react-stately/selection\";\nimport { RefObject, useImperativeHandle } from \"react\";\n\nexport type CollectionRefProps = {\n  /**\n   * Gives imperative access to selection manager.\n   */\n  selectionManagerRef?: RefObject<SelectionManager>;\n};\n\n/**\n * Common imperative API for collections. Used in Lists at the moment. Tree components implement a different imperative\n * API that can be refactored later for more consistency.\n */\nexport function useCollectionRef(\n  { selectionManagerRef }: CollectionRefProps,\n  state: { selectionManager: SelectionManager }\n) {\n  useImperativeHandle(selectionManagerRef, () => state.selectionManager);\n}\n","import { styled } from \"../styled\";\n\nexport const StyledListSectionHeader = styled.div(({ theme }) => ({\n  paddingLeft: 8,\n  fontWeight: \"bold\",\n  lineHeight: \"20px\",\n  outline: \"none\",\n  cursor: \"default\",\n  color: theme.color(\"*.textForeground\", theme.color(\"*.foreground\")),\n}));\n","import { ReusableView } from \"@react-stately/virtualizer\";\nimport { Node } from \"@react-types/shared\";\nimport React, { ReactNode, useRef } from \"react\";\nimport {\n  layoutInfoToStyle,\n  useVirtualizerItem,\n  VirtualizerItem,\n  VirtualizerProps,\n} from \"@react-aria/virtualizer\";\nimport { StyledListSectionHeader } from \"@intellij-platform/core/List/StyledListSectionHeader\";\n\ninterface SectionProps<T> {\n  reusableView: ReusableView<Node<T>, unknown>;\n  header: ReusableView<Node<T>, unknown>;\n  children?: ReactNode;\n}\n\nfunction ListSection<T extends object>({\n  reusableView,\n  header,\n  children,\n}: SectionProps<T>) {\n  const headerRef = useRef<HTMLDivElement>(null);\n  useVirtualizerItem({\n    reusableView: header,\n    ref: headerRef,\n  });\n  return (\n    <>\n      <StyledListSectionHeader\n        role=\"presentation\"\n        ref={headerRef}\n        style={layoutInfoToStyle(header.layoutInfo!, \"ltr\")}\n      >\n        {reusableView.content.rendered}\n      </StyledListSectionHeader>\n      <div\n        key={reusableView.key}\n        style={layoutInfoToStyle(reusableView.layoutInfo!, \"ltr\")}\n      >\n        {children}\n      </div>\n    </>\n  );\n}\n\nexport const renderWrapper: VirtualizerProps<\n  Node<any>,\n  unknown\n>[\"renderWrapper\"] = (parent, reusableView, children, renderChildren) => {\n  if (reusableView.viewType === \"section\") {\n    return (\n      <ListSection\n        key={reusableView.key}\n        reusableView={reusableView}\n        header={children.find((c) => c.viewType === \"header\")!}\n      >\n        {renderChildren(children.filter((c) => c.viewType === \"item\"))}\n      </ListSection>\n    );\n  }\n  return (\n    <VirtualizerItem\n      key={reusableView.key}\n      reusableView={reusableView}\n      parent={parent ?? undefined}\n    />\n  );\n};\n","import React, { HTMLAttributes, useMemo } from \"react\";\nimport { VirtualizerProps } from \"@react-aria/virtualizer\";\nimport { VariableWidthListLayout } from \"@intellij-platform/core/VariableWidthListLayout\";\nimport { ListState } from \"@react-stately/list\";\nimport { Node } from \"@react-types/shared\";\nimport { renderWrapper } from \"./renderWrapper\";\nimport { ListDivider } from \"@intellij-platform/core/List/ListDivider\";\n\ninterface ItemNode<T> extends Node<T> {\n  type: \"item\";\n}\nexport const useListVirtualizer = <T extends object>({\n  renderItem,\n  estimatedItemHeight = 20,\n  state,\n}: {\n  renderItem: (item: ItemNode<T>) => React.ReactNode;\n  estimatedItemHeight?: number;\n  state: ListState<T>;\n}): {\n  virtualizerProps: Omit<\n    VirtualizerProps<Node<T>, unknown>,\n    keyof HTMLAttributes<HTMLElement>\n  > & { children: (type: string, content: Node<T>) => React.ReactNode };\n} => {\n  const layout = useMemo(\n    () =>\n      new VariableWidthListLayout<T>({\n        /**\n         * there is currently no documentation available for these fields, but setting `rowHeight` enforces it, which\n         * wouldn't be good for custom tree UI with a different row height.\n         * wrong estimatedRowHeight seems to only affect small scrollbar position inaccuracy, which is a minor issue\n         * and not even noticeable in most cases. Also, it seems it slightly improves the performance if it exactly\n         * matches the real row height. But not even sure.\n         */\n        estimatedRowHeight: estimatedItemHeight,\n        estimatedHeadingHeight: 20,\n        dividerHeight: 2,\n      }),\n    []\n  );\n  layout.collection = state.collection;\n  layout.disabledKeys = state.disabledKeys;\n\n  return {\n    virtualizerProps: {\n      focusedKey: state.selectionManager.focusedKey,\n      collection: state.collection,\n      layout,\n      // Not clear how this sizeToFit is supposed to work, due to lack of documentation, but don't be tempted to\n      // think it solves the problem VariableWidthListLayout is trying to solve, because it doesn't :D\n      // Also, note that setting this to \"width\" prevents re-layout when container width is increased, which\n      // causes issues.\n      sizeToFit: \"height\",\n      scrollToItem: (key) => {\n        return layout.virtualizer.scrollToItem(key, {\n          shouldScrollX: false,\n          duration: 0,\n        });\n      },\n      children: (type, item) => {\n        if (type === \"item\") {\n          return renderItem(item as ItemNode<T>);\n        }\n        if (type === \"divider\") {\n          return <ListDivider key={item.key} />;\n        }\n      },\n      renderWrapper,\n\n      scrollDirection: \"both\",\n    },\n  };\n};\n","import React, { ForwardedRef, HTMLAttributes, HTMLProps } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { OverlayTriggerProps } from \"@react-types/overlays\";\n\nimport { useContextMenu, UseContextMenuProps } from \"./useContextMenu\";\nimport { MenuOverlayFromOrigin } from \"@intellij-platform/core/Menu/MenuOverlayFromOrigin\";\n\ninterface ContextMenuContainerProps\n  extends Omit<HTMLProps<HTMLDivElement>, \"children\">,\n    UseContextMenuProps {\n  /**\n   * Will be called to return the Menu when context menu is triggered. Use {@link Menu} component to render a menu.\n   */\n  renderMenu: () => React.ReactNode;\n  /**\n   * If children is a function, context menu props is passed to it, to be passed to the underlying element.\n   * Otherwise, a div container will be rendered.\n   */\n  children:\n    | React.ReactNode\n    | ((props: HTMLAttributes<HTMLElement>) => React.ReactNode);\n}\n\n/**\n * A generic container for context menu. It's the same as a normal div, only with an additional `renderMenu` prop,\n * to be used to render context menu, when it's triggered.\n * Closes the menu when a menu action is triggered.\n */\nexport const ContextMenuContainer = React.forwardRef(\n  (\n    {\n      children,\n      renderMenu,\n      onOpen,\n      isDisabled,\n      ...props\n    }: ContextMenuContainerProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    const state = useMenuTriggerState({} as OverlayTriggerProps);\n\n    const { positionOrigin, containerProps, overlayRef } = useContextMenu(\n      { onOpen, isDisabled },\n      state\n    );\n    const allProps = mergeProps(props, containerProps);\n    return (\n      <>\n        {typeof children === \"function\" ? (\n          children(allProps)\n        ) : (\n          <div {...allProps} ref={ref}>\n            {children}\n          </div>\n        )}\n        {state.isOpen && (\n          <MenuOverlayFromOrigin\n            onClose={state.close}\n            ref={overlayRef}\n            origin={positionOrigin}\n            /**\n             * Context menus don't autofocus the first item in the reference impl.\n             * Note that this just defines the default value, and can always be controlled per case on the rendered Menu\n             */\n            defaultAutoFocus={true}\n          >\n            {renderMenu()}\n          </MenuOverlayFromOrigin>\n        )}\n      </>\n    );\n  }\n);\n\n/**\n * Data attribute name to be used to mark an element as the reference for positioning a contextual menu.\n */\nexport const MENU_POSITION_TARGET_DATA_ATTRIBUTE =\n  \"data-context-menu-position-target\";\n","import React, { useRef, useState } from \"react\";\nimport { MenuTriggerState } from \"@react-stately/menu\";\n\nexport type UseContextMenuProps = {\n  /**\n   * Whether opening contextmenu is disabled.\n   */\n  isDisabled?: boolean;\n  /**\n   * Called when contextmenu is opened.\n   * @param args\n   */\n  onOpen?: (args: {\n    /**\n     * The target element on which contextmenu event was triggered.\n     */\n    target: Element;\n  }) => void;\n};\n/**\n * Functionality and accessibility of context menu.\n */\nexport const useContextMenu = (\n  { isDisabled = false, onOpen }: UseContextMenuProps,\n  state: MenuTriggerState\n) => {\n  const [positionOrigin, setPositionOrigin] = useState<React.MouseEvent>();\n  /**\n   * NOTE: not using useMenuTrigger because:\n   * - There is no option to have a trigger like this: \"right click + long press only by touch\" which seems to be the\n   *   reasonable trigger for context menu. If we want to use it just for long press, we could disable it if it's not\n   *   a touch device, but that would be suboptimal, since both touch and mouse can be available, and it should depend\n   *   not on availability of touch, but on the triggered event type. Plus, isDisabled is broken in v<3.5.0\n   * - It's not quite clear at the moment, if the aria attributes that useMenuTrigger sets would be applicable to\n   *   this context menu component too. The trigger is not the container. For example, if there is a list rendered\n   *   inside, the selected item would be the trigger. Maybe even this component, as a container for context menu\n   *   is not the best way to allow for context menu, when it comes to a11y concerns. For now, we skip a11y props of the\n   *   trigger. A11y props of the menu itself (e.g. aria-label) would also be up to the usage of this component.\n   *\n   *   TODO: add support for long touch\n   */\n  const onContextMenu = (e: React.MouseEvent<HTMLElement>) => {\n    if (!(e.target instanceof Element)) {\n      return;\n    }\n    setPositionOrigin(e);\n    onOpen?.({ target: e.target });\n    e.preventDefault();\n    // NOTE: we can't use offsetX/offsetY, because it would depend on the exact target that was clicked.\n    if (state.isOpen) {\n      /**\n       * If the context menu is already open, closing and reopening makes sure the menu properly gains the focus.\n       * Otherwise, the focus may go back to the background.\n       * It also better matches the reference impl.\n       */\n      state.close();\n      setTimeout(() => {\n        state.open(null);\n      });\n    } else {\n      state.open(null);\n    }\n  };\n\n  const overlayRef = useRef(null);\n\n  const containerProps: React.HTMLAttributes<HTMLElement> = isDisabled\n    ? {}\n    : {\n        onContextMenu,\n      };\n  return {\n    /**\n     * props to be applied on the container element which is supposed to have the context menu\n     */\n    containerProps,\n    /**\n     * The ref to be applied on the menu overlay wrapper. It's usually an input instead of an output in similar\n     * react-aria hooks, but it seemed unnecessary here.\n     */\n    overlayRef,\n\n    positionOrigin,\n  };\n};\n","import { Item, PartialNode, Section } from \"@react-stately/collections\";\nimport { Item as Item2 } from \"./Item\";\nimport {\n  CollectionBase,\n  CollectionElement,\n  ItemProps,\n  SectionProps,\n} from \"@react-types/shared\";\nimport React from \"react\";\n\nfunction* patchCollectionItem<T>(nodes: Generator<PartialNode<T>>) {\n  for (const partialNode of nodes)\n    yield {\n      ...partialNode,\n      *childNodes() {\n        const result2 = partialNode.childNodes?.();\n        if (result2) {\n          for (const partialChildNode of result2) {\n            const { type, ...partialChildNodeWithoutType } = partialChildNode;\n            yield partialChildNodeWithoutType;\n          }\n        }\n      },\n    };\n}\n\nconst PatchedItem = Item.bind(null);\n\n// @ts-expect-error: getCollectionNode is not public\nPatchedItem.getCollectionNode = function getCollectionNode<T>(\n  props: ItemProps<T>,\n  context: any\n): Generator<PartialNode<T>> {\n  // @ts-expect-error getCollectionNode is not public API\n  return patchCollectionItem(Item.getCollectionNode(props, context));\n};\n\nconst PatchedSection = Section.bind(null);\n\n// @ts-expect-error: getCollectionNode is not public\nPatchedSection.getCollectionNode = function getCollectionNode<T>(\n  props: SectionProps<T>,\n  context: any\n): Generator<PartialNode<T>> {\n  // @ts-expect-error getCollectionNode is not public API\n  return patchCollectionItem(Section.getCollectionNode(props, context));\n};\nfunction convertCollectionElement<T>(\n  result: CollectionElement<T> | React.ReactNode\n): CollectionElement<T> {\n  if (\n    React.isValidElement(result) &&\n    (result.type === Item || result.type === Item2)\n  ) {\n    return React.createElement(\n      PatchedItem,\n      {\n        key: result.key != null ? result.key : undefined,\n        ...(result.props as ItemProps<T>),\n      },\n      convertChildren(result.props.children)\n    ) as CollectionElement<T>;\n  }\n  if (React.isValidElement(result) && result.type === Section) {\n    return React.createElement(\n      PatchedSection,\n      {\n        key: result.key != null ? result.key : undefined,\n        ...(result.props as SectionProps<T>),\n      } as any,\n      convertChildren((result.props as any).children)\n    ) as CollectionElement<T>;\n  }\n  return result as CollectionElement<T>;\n}\n\nfunction convertChildren<T>(children: React.ReactNode): React.ReactNode {\n  return Array.isArray(children)\n    ? // NOTE: We intentionally avoid using React.Children.map as it messes with keys.\n      children.map(convertChildren)\n    : convertCollectionElement(children);\n}\n\n/**\n * CollectionBuilder expects child type to be the same as parent type, which is weird in the first place:\n * https://github.com/adobe/react-spectrum/blob/cae83ff95f2f709b761c70d47ace96d6346ed873/packages/%40react-stately/collections/src/CollectionBuilder.ts#L148\n * On the other hand, the default Item components sets the `type` to item, for all child PartialNode objects:\n * https://github.com/adobe/react-spectrum/blob/c49d9819adc2cb63377f39557352440c72072caf/packages/%40react-stately/collections/src/Item.ts#L40-L54\n * Which is also a little unexpected, as in many nested collections, an item can have all types of children.\n * This function patches that, replacing Item elements with PatchedItem element which doesn't set type on children\n * PartialNodes.\n */\nexport function patchCollectionProps<T>({\n  children,\n  ...props\n}: Partial<CollectionBase<T>>): CollectionBase<T> {\n  return {\n    ...props,\n    children:\n      typeof children === \"function\"\n        ? (node: T) => convertChildren(children(node)) as CollectionElement<T>\n        : (convertChildren(children) as CollectionElement<T>),\n  };\n}\n","import React, { CSSProperties, Key, RefObject, useContext } from \"react\";\nimport { AriaMenuOptions, useMenu as useMenuAria } from \"@react-aria/menu\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { AriaMenuProps } from \"@react-types/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { patchCollectionProps } from \"@intellij-platform/core/Collections/patchCollectionProps\";\nimport { TreeProps, useTreeState } from \"../Tree/useTreeState\"; // shared dependency between tree and menu, that could be lifted up import {Submenu} from '@intellij-platform/core/Menu/Submenu'\nimport { renderMenuNodes } from \"./renderMenuNodes\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { SubmenuProps } from \"./Submenu\"; // internal export\n\nexport interface MenuProps<T>\n  extends Omit<\n    AriaMenuProps<T>,\n    // selection is not properly supported for nested menus. Plus, it's not even that meaningful for a nested menu\n    // at least the way it's implemented now.\n    | \"onSelectionChange\"\n    | \"defaultSelectedKeys\"\n    | \"selectionMode\"\n    | \"disallowEmptySelection\"\n  > {\n  /**\n   * Indicates currently expanded menu item (controlled).\n   */\n  expandedKey?: Key; // FIXME: should be keys\n  /**\n   * Called when expanded menu item is changed by user interaction, which can be either hovering over the menu item\n   */\n  onExpandedKeyChange?: (expandedKey: Key) => void; // FIXME: should be keys\n  defaultExpandedKey?: Key; // FIXME: should be keys\n  /**\n   * @deprecated\n   */\n  expandOn?: \"hover\" | \"press\"; // hover delay doesn't seem to be needed as an option\n\n  /**\n   * Defines the press behaviour (either by mouse or by pressing Enter when focused) on menu items with submenu.\n   * By default (undefined), pressing or hovering over a menu item with submenu, opens the submenu.\n   * When set to \"toggle\", pressing a menu item with submenu will toggle the submenu. Hovering over such items will\n   * no longer open the submenu.\n   * When set to \"action\", pressing a menu item with submenu will call onAction for that item, and closes the menu.\n   * Hovering over such items will no longer open the submenu.\n   *\n   * In all cases, pressing the right arrow will always open the submenu.\n   */\n  submenuBehavior?: \"default\" | \"toggleOnPress\" | \"actionOnPress\";\n\n  /**\n   * fills the available horizontal or vertical space, when rendered in a flex container.\n   */\n  fillAvailableSpace?: boolean;\n\n  /**\n   * Minimum width of the menu\n   * @default: 120px\n   */\n  minWidth?: CSSProperties[\"minWidth\"];\n}\n\n/**\n * Can be provided by the overlay where the menu is rendered in. If provided, menu will call the provided close function\n * on actions. Note that there is no `closeOnSelect` option as of now, on this context, since no use case seems to exist\n * for keeping the menu overlay open after a menu item is selected.\n * **Update**: there are use cases where the menu is not closed after an item is clicked. Most of the toggle-able\n * actions (the ones with a checkmark) seem to be like this.\n * TODO: Make \"close on selection\" more flexible. Some ideas:\n *  - instead of calling close, pass it to `onAction` handler. Then on each action, one would need to call close if\n *    needed.\n *  - Offer a `MenuItem` component to be used instead of generic `Item`, where it accepts `closeOnSelect` boolean, which\n *    is true by default.\n *  - pass a `keepOpen` function to `onAction`.\n *  - Allow signaling whether the menu should kept open, via the returned value of onAction. e.g. return false means keep open.\n *  Last two suggestions are based on the assumption that most of the menu items are not selectable.\n *  Note that MenuOverlayContext could be used directly in action handlers too, but baking it into the menu makes it\n *  much more convenient, which seems more important than breaking the nice separation between Menu and MenuTrigger.\n */\nexport const MenuOverlayContext = React.createContext<{\n  close: () => void;\n  defaultAutoFocus: MenuProps<unknown>[\"autoFocus\"];\n}>({\n  close: () => {},\n  defaultAutoFocus: undefined,\n});\nexport const MenuContext = React.createContext<\n  Pick<\n    MenuProps<unknown>,\n    \"onClose\" | \"onAction\" | \"submenuBehavior\" | \"autoFocus\"\n  > & {\n    itemWrapper?: (\n      renderedItem: React.ReactNode,\n      item: Node<unknown>\n    ) => React.ReactNode;\n    renderSubmenu?: (props: SubmenuProps<unknown>) => React.ReactNode;\n  }\n>({});\n\nexport function useMenu<T>(\n  {\n    onAction: onActionProp,\n    submenuBehavior = \"default\",\n    ...props\n  }: MenuProps<T> & AriaMenuOptions<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const { close, defaultAutoFocus } = useContext(MenuOverlayContext);\n  const autoFocus = props.autoFocus ?? defaultAutoFocus;\n  const onClose = () => {\n    props.onClose?.();\n    close();\n  };\n  const onAction = (key: Key) => {\n    if (\n      // The following check should have been in useMenu, but it's not currently. Probably because they haven't yet\n      // covered nested menus.\n      !state.collection.getItem(key)?.hasChildNodes\n    ) {\n      return onActionProp?.(key);\n    } else if (submenuBehavior === \"actionOnPress\") {\n      onClose();\n      return onActionProp?.(key);\n    }\n  };\n  const menuContextValue: React.ContextType<typeof MenuContext> = {\n    submenuBehavior,\n    autoFocus,\n    onAction,\n    onClose,\n  };\n  const { menuProps } = useMenuAria(\n    { ...props, onAction, onClose, autoFocus },\n    state,\n    ref\n  );\n\n  return {\n    menuProps,\n    menuContextValue,\n  };\n}\n\nexport function useMenuState<T extends object>(\n  props: TreeProps<T> &\n    Pick<\n      MenuProps<T>,\n      \"expandedKey\" | \"defaultExpandedKey\" | \"onExpandedKeyChange\"\n    >\n) {\n  props = patchCollectionProps(props);\n  return useTreeState({\n    ...props,\n    childExpansionBehaviour: \"single\",\n    expandedKeys: props.expandedKey ? [props.expandedKey] : undefined,\n    onExpandedChange: ([firstKey]) => props?.onExpandedKeyChange?.(firstKey),\n    defaultExpandedKeys: props.defaultExpandedKey\n      ? [props.defaultExpandedKey]\n      : undefined,\n  });\n}\n\n/**\n * UI for menus which are normally shown in a popover. Being rendered as an overlay is not handled here.\n * Also, there is no coupling with any higher level entity like \"Action\", since this is just for the UI layer.\n * Something like ActionMenu which creates a menu out of a list of actions can be implemented on top of this.\n *\n * @example\n *  <Menu>\n *    <Item>Item one</Item>\n *    <Item>\n *      <MenuItemLayout\n *        icon={<PlatformIcon icon={\"actions/copy\"} />}\n *        content=\"Copy\"\n *        shortcut={\"C\"} />\n *    </Item>\n *  </Menu>\n *\n *  Current issues and limitations:\n *  - Divider in sub-menu's is not supported. because of a constraint in @react-stately/collections, which results in\n *    this error: Unsupported type <Divider> in <Item>. Only <Item> is supported. Maybe supporting section would\n *    be a workaround for it.\n *  - when a parent menu item which has an open submenu is hovered, it gets focus.\n */\nexport function Menu<T extends object>({ minWidth, ...props }: MenuProps<T>) {\n  const ref = React.useRef<HTMLUListElement>(null);\n  const state = useMenuState(props);\n  const { menuContextValue, menuProps } = useMenu(props, state, ref);\n\n  return (\n    /**\n     * MenuContext is used to pass onAction and onClose to be passed to useMenu in submenus.\n     * That's needed because in useMenuItem onAction and onClose are read off a WeakMap which has the menu state\n     * (TreeState) as key. So we have to pass onAction and onClose everytime we call useMenu in submenus, to let the\n     * menu items in that submenu access the right value of onAction and onClose. To avoid drilling these props down,\n     * we keep it in a context.\n     */\n    <MenuContext.Provider value={menuContextValue}>\n      <StyledMenu\n        {...menuProps}\n        ref={ref}\n        style={{ minWidth }}\n        fillAvailableSpace={props.fillAvailableSpace}\n      >\n        {renderMenuNodes(state, [...state.collection])}\n      </StyledMenu>\n    </MenuContext.Provider>\n  );\n}\n","import React, { HTMLAttributes, ReactNode, RefObject, useContext } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { isFocusVisible, useHover, usePress } from \"@react-aria/interactions\";\nimport {\n  AriaMenuItemProps,\n  MenuItemAria,\n  useMenuItem as useMenuItemAria,\n} from \"@react-aria/menu\";\nimport { useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { FocusableElement, Node } from \"@react-types/shared\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\nimport { Overlay } from \"@intellij-platform/core/Overlay\";\n\nimport { LafIcon, PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\nimport { MenuContext, MenuProps } from \"./Menu\";\nimport { MENU_BORDER_WIDTH, MENU_VERTICAL_PADDING } from \"./StyledMenu\";\nimport {\n  StyledMenuItem,\n  StyledMenuItemIcon,\n  StyledNestedArrow,\n} from \"./StyledMenuItem\";\nimport { Submenu, SubmenuProps } from \"@intellij-platform/core/Menu/Submenu\";\n\nexport interface MenuItemProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  onSubmenuClose?: () => void;\n}\n\nconst StyledMenuItemText = styled.span`\n  flex: 1;\n`;\n\nconst StyledMenuItemPlatformIcon = styled(PlatformIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nconst StyledMenuItemLafIcon = styled(LafIcon)`\n  svg path {\n    stroke: currentColor;\n  }\n`;\n\nfunction useMenuItem<T extends unknown>(\n  {\n    submenuBehavior,\n    ...props\n  }: AriaMenuItemProps & { submenuBehavior: MenuProps<T>[\"submenuBehavior\"] },\n  state: TreeState<T>,\n  ref: RefObject<FocusableElement>\n): MenuItemAria {\n  const item = state.collection.getItem(props.key!)!;\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const hasSubmenu = item.hasChildNodes;\n  const { menuItemProps: ariaMenuItemProps, ...result } = useMenuItemAria(\n    {\n      key: item.key,\n      // hack to prevent react-aria to call onClose when nested items are selected, which is incorrect, and because\n      // react-aria doesn't officially support nested menus at the moment\n      onClose: hasSubmenu ? () => {} : undefined,\n    },\n    state,\n    ref\n  );\n\n  // useMenuItem in react aria utilizes useHover to focus item on hover. The logic there conflicts with nested menus\n  // requirements (at least based on how nested menu is implemented here currently). Also, submenuBehavior requires\n  // some more customization. So we delete the handlers set by useHover in useMenuItem, and add a custom useHover.\n  delete ariaMenuItemProps.onMouseEnter;\n  delete ariaMenuItemProps.onPointerEnter;\n\n  if (submenuBehavior === \"default\" && isExpanded) {\n    // When menu item has its submenu opened, clicking it should not move focus or do anything.\n    delete ariaMenuItemProps.onPointerDown;\n  }\n\n  const { hoverProps } = useHover({\n    isDisabled: isDisabled,\n    onHoverStart: () => {\n      const isAnySubmenuOpen = [...state.expandedKeys].some(\n        (expandedKey) =>\n          state.collection.getItem(expandedKey)?.parentKey === item.parentKey\n      );\n\n      if (submenuBehavior === \"default\" && !isExpanded) {\n        state.toggleKey(item.key);\n      }\n\n      if (!isFocusVisible()) {\n        const shouldFocus =\n          submenuBehavior === \"default\" ? !isExpanded : !isAnySubmenuOpen;\n        if (shouldFocus) {\n          state.selectionManager.setFocused(true);\n        }\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  const keyboardProps = {\n    onKeyDown: (e: React.KeyboardEvent) => {\n      if (\n        ((e.key === \"Enter\" || e.key === \" \") &&\n          submenuBehavior !== \"actionOnPress\") ||\n        \"ArrowRight\" === e.key\n      ) {\n        state.toggleKey(item.key);\n        e.stopPropagation();\n        return;\n      }\n    },\n  };\n\n  const { pressProps: togglePressProps } = usePress({\n    isDisabled: isDisabled,\n    onPressUp: () => {\n      state.toggleKey(item.key);\n      if (isExpanded) {\n        // submenu was expanded and is closed now. moving focus back to the parent item\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  return {\n    ...result,\n    menuItemProps: mergeProps(\n      hasSubmenu\n        ? {\n            \"aria-expanded\": isExpanded,\n            \"aria-haspopup\": \"menu\",\n          }\n        : {},\n      ariaMenuItemProps,\n      hoverProps,\n      keyboardProps,\n      submenuBehavior === \"toggleOnPress\" ? togglePressProps : {}\n    ),\n  };\n}\n\nconst MenuItemContext = React.createContext<{\n  labelProps: HTMLAttributes<HTMLElement>;\n  descriptionProps: HTMLAttributes<HTMLElement>;\n  keyboardShortcutProps: HTMLAttributes<HTMLElement>;\n}>({ descriptionProps: {}, labelProps: {}, keyboardShortcutProps: {} });\n\nexport const useMenuItemLayout = () => {\n  return useContext(MenuItemContext);\n};\n\nexport function MenuItem<T>({ item, state }: MenuItemProps<T>) {\n  // Get props for the menu item element\n  const ref = React.useRef<HTMLLIElement>(null);\n  const nestedMenuRef = React.useRef<HTMLDivElement>(null);\n  const isDisabled = state.disabledKeys.has(item.key);\n  const isExpanded = state.expandedKeys.has(item.key);\n  const isSelected = state.selectionManager.selectedKeys.has(item.key);\n  const isFocused = state.selectionManager.focusedKey === item.key;\n  const {\n    onClose,\n    submenuBehavior,\n    renderSubmenu = (props: SubmenuProps<T>) => <Submenu {...props} />,\n    itemWrapper = (i: React.ReactNode) => i,\n  } = useContext(MenuContext);\n\n  const { menuItemProps, labelProps, descriptionProps, keyboardShortcutProps } =\n    useMenuItem(\n      {\n        submenuBehavior,\n        key: item.key,\n      },\n      state,\n      ref\n    );\n\n  const { pressProps: togglePressProps } = usePress({\n    isDisabled: isDisabled,\n    onPressUp: () => {\n      state.toggleKey(item.key);\n      if (isExpanded) {\n        // submenu was expanded and is closed now. moving focus back to the parent item\n        state.selectionManager.setFocusedKey(item.key);\n      }\n    },\n  });\n\n  let { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: ref,\n    overlayRef: nestedMenuRef,\n    placement: \"right top\",\n    shouldFlip: true,\n    onClose,\n    offset: 0,\n    crossOffset: -(MENU_VERTICAL_PADDING + MENU_BORDER_WIDTH),\n    isOpen: isExpanded,\n  });\n\n  const arrowProps: HTMLAttributes<HTMLElement> =\n    submenuBehavior !== \"default\"\n      ? {\n          role: \"button\",\n          \"aria-label\": \"Open\",\n          ...mergeProps(togglePressProps, {\n            // to prevent pointer up event handler on the item, which would trigger action.\n            onPointerUp: (e: React.PointerEvent) => e.stopPropagation(),\n          }),\n        }\n      : {};\n  return (\n    <>\n      <StyledMenuItem\n        {...menuItemProps}\n        isDisabled={isDisabled}\n        isActive={isFocused}\n        ref={ref}\n      >\n        {isSelected && (\n          <StyledMenuItemIcon>\n            <StyledMenuItemLafIcon\n              icon={{\n                name: \"checkmark\",\n                modifiers: { Selected: isFocused },\n              }}\n            />\n          </StyledMenuItemIcon>\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isContainerFocused: state.selectionManager.isFocused,\n            isSelected,\n            node: item,\n          }}\n        >\n          <MenuItemContext.Provider\n            value={{ labelProps, descriptionProps, keyboardShortcutProps }}\n          >\n            {itemWrapper(\n              typeof item.rendered === \"string\" ? (\n                <StyledMenuItemText {...labelProps}>\n                  {item.rendered}\n                </StyledMenuItemText>\n              ) : (\n                item.rendered\n              ),\n              item\n            )}\n          </MenuItemContext.Provider>\n        </ItemStateContext.Provider>\n        {item.hasChildNodes && (\n          <StyledNestedArrow {...arrowProps}>\n            <StyledMenuItemPlatformIcon icon=\"icons/ide/menuArrow\" />\n          </StyledNestedArrow>\n        )}\n      </StyledMenuItem>\n      {isExpanded && (\n        /**\n         * A note about using Overlay:\n         * If sub-menu is not rendered in a portal, useOverlayPosition doesn't work properly and the submenu may\n         * be rendered offscreen. Worse, it may introduce scroll in body (or some scrollable ancestor), which will\n         * trigger a scroll event which closes the menu if the menu is rendered in an overlay (like in MenuTrigger),\n         * which is almost always the case.\n         *\n         */\n        <Overlay\n          OverlayComponent={\n            /**\n             *  The FocusScope included in the default Overlay, messes with a particular expected behavior. So we use\n             *  SimpleOverlay, which just renders its children as a portal. There may be a better solution for that\n             *  problem, which would eliminate the need for the funky `OverlayComponent` prop on our `Overlay`\n             *  component. Something to look into in the future.\n             */\n            SimpleOverlay\n          }\n        >\n          <div ref={nestedMenuRef} {...positionProps}>\n            {renderSubmenu({ parentState: state, rootKey: item.key })}\n          </div>\n        </Overlay>\n      )}\n    </>\n  );\n}\n\n/**\n * A replacement for react-aria Overlay, which doesn't render FocusScope\n */\nfunction SimpleOverlay({\n  children,\n  portalContainer = document.body,\n}: {\n  children: ReactNode;\n  portalContainer?: Element | undefined;\n}) {\n  return ReactDOM.createPortal(children, portalContainer);\n}\n","import React from \"react\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections/ItemStateContext\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { useContextOrThrow } from \"@intellij-platform/core/utils/useContextOrThrow\";\n\nimport { useMenuItemLayout } from \"./MenuItem\";\nimport { StyledMenuItemIcon } from \"./StyledMenuItem\";\n\ninterface MenuItemLayoutProps {\n  icon?: React.ReactNode;\n  content: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\nconst StyledMenuItemLayout = styled.div`\n  display: flex;\n  align-items: center;\n  flex: 1; // to make sure it takes as much space as available in the menu item row, so that the suffix (shortcut) is pushed to the right\n`;\nconst Content = styled.span`\n  flex: 1;\n`;\n\nconst Shortcut = styled.kbd`\n  font-family: system-ui, sans-serif;\n  margin-left: 30px;\n  margin-right: -0.625rem;\n  color: ${({ theme }) =>\n    theme.currentForegroundAware(\n      theme.color(\"MenuItem.acceleratorForeground\")\n    )};\n`;\n\nexport const MenuItemLayout = ({\n  content,\n  shortcut,\n  icon,\n}: MenuItemLayoutProps) => {\n  const { isSelected } = useContextOrThrow(\n    ItemStateContext,\n    \"MenuItemLayout is meant to be rendered in Item component in Menus\"\n  );\n  const { labelProps, keyboardShortcutProps } = useMenuItemLayout();\n  const allowedIcon = !isSelected && icon;\n  return (\n    <StyledMenuItemLayout>\n      {allowedIcon && <StyledMenuItemIcon>{allowedIcon}</StyledMenuItemIcon>}\n      <Content {...labelProps}>{content}</Content>\n      {shortcut && <Shortcut {...keyboardShortcutProps}>{shortcut}</Shortcut>}\n    </StyledMenuItemLayout>\n  );\n};\n","import React, { HTMLProps, useEffect } from \"react\";\nimport { FocusScope } from \"@intellij-platform/core/utils/FocusScope\";\nimport {\n  MenuOverlayContext,\n  MenuProps,\n} from \"@intellij-platform/core/Menu/Menu\";\nimport { areInNestedOverlays, Overlay } from \"@intellij-platform/core/Overlay\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useOverlay, usePreventScroll } from \"@react-aria/overlays\";\n\nexport interface MenuOverlayProps {\n  children: React.ReactNode;\n  restoreFocus?: boolean;\n  overlayProps: HTMLProps<HTMLDivElement>;\n  overlayRef?: React.Ref<HTMLDivElement>;\n  /**\n   * Sets the default value of {@link Menu}'s {@link MenuProps#autoFocus} prop.\n   */\n  defaultAutoFocus?: MenuProps<unknown>[\"autoFocus\"];\n  onClose: () => void;\n}\n\n/**\n * Overlay container for Menu.\n * Positioning is not implemented at this layer.\n * {@link MenuOverlayProps#overlayProps} should be used for positioning.\n */\nexport function MenuOverlay({\n  children,\n  restoreFocus,\n  overlayProps: otherOverlayProps,\n  overlayRef: inputOverlayRef,\n  defaultAutoFocus,\n  onClose,\n}: MenuOverlayProps) {\n  const overlayRef = useObjectRef(inputOverlayRef);\n  const { overlayProps } = useOverlay(\n    {\n      onClose,\n      shouldCloseOnBlur: false,\n      isOpen: true,\n      isKeyboardDismissDisabled: false,\n      isDismissable: true,\n      shouldCloseOnInteractOutside: (element) => {\n        // FIXME: this is kind of hacky and should be removed when nested menu is properly supported\n        return !areInNestedOverlays(overlayRef.current, element);\n      },\n    },\n    overlayRef\n  );\n\n  usePreventScroll();\n\n  /**\n   * right clicks outside are not currently captured as \"outside interaction\" by react-aria's useOverlay hook.\n   * so we set up a global listener to close the context menu when contextmenu event is triggered outside the\n   * context menu container.\n   * NOTE: event handler is set up for the `capture` phase, to have it run before the handler for context menu\n   * when the menu is used as a context menu\n   */\n  useEffect(() => {\n    const onOutsideContextMenu = () => {\n      onClose();\n    };\n    document.addEventListener(\"contextmenu\", onOutsideContextMenu, {\n      capture: true,\n    });\n    return () =>\n      document.removeEventListener(\"contextmenu\", onOutsideContextMenu);\n  }, []);\n\n  return (\n    <Overlay>\n      <FocusScope restoreFocus={restoreFocus} autoFocus>\n        <MenuOverlayContext.Provider\n          value={{\n            close: onClose,\n            defaultAutoFocus,\n          }}\n        >\n          <div\n            {...mergeProps(overlayProps, otherOverlayProps)}\n            ref={overlayRef}\n          >\n            {children}\n          </div>\n        </MenuOverlayContext.Provider>\n      </FocusScope>\n    </Overlay>\n  );\n}\n","import React, { RefObject, useLayoutEffect, useState } from \"react\";\n\n/**\n * Similar to {@link import('@react-aria/overlays').useOverlayPosition useOverlayPosition},\n * but for positioning an overlay relative to a point, typically coordinates of a mouse event.\n * It's less advanced than useOverlayPosition, not taking into account many edge cases that\n * `useOverlayPosition` does.\n * Most importantly:\n * - Window resize is not taken into account\n * - Overlay resize is not taken into account.\n *   Positioning only happens when the origin changes.\n * - There are no options for positioning options like placement, offset or crossOffset\n *\n * @see https://github.com/adobe/react-spectrum/discussions/7267\n */\nexport function useOverlayPositionFromOrigin({\n  overlayRef,\n  origin,\n  containerPadding,\n}: {\n  overlayRef: RefObject<HTMLElement>;\n  containerPadding?: number | { x: number; y: number };\n  origin: Pick<React.MouseEvent, \"clientX\" | \"clientY\"> | undefined;\n}) {\n  const [position, setPosition] = useState<{ left?: number; top?: number }>({});\n\n  useLayoutEffect(() => {\n    const overlayElement = overlayRef.current;\n    setPosition(\n      origin && overlayElement\n        ? calculatePosition({\n            clientX:\n              origin.clientX +\n              1.5 /* a tiny offset is added to avoid menu items getting hovered upon open. 1px doesn't consistently work. */,\n            clientY: origin.clientY,\n            containerPadding,\n            overlayWidth: overlayElement.offsetWidth,\n            overlayHeight: overlayElement.offsetHeight,\n          })\n        : {}\n    );\n  }, [origin?.clientX, origin?.clientY]);\n  return {\n    positionProps: {\n      style: { position: \"fixed\", zIndex: 100000, ...position } as const,\n    },\n  };\n}\n\nfunction calculatePosition({\n  clientX,\n  clientY,\n  overlayWidth,\n  overlayHeight,\n  containerPadding = 0,\n}: {\n  clientX: number;\n  clientY: number;\n  overlayWidth: number;\n  overlayHeight: number;\n  containerPadding?: number | { x: number; y: number };\n}) {\n  const totalWidth =\n    document.documentElement.clientWidth -\n    (typeof containerPadding === \"object\"\n      ? containerPadding.x\n      : containerPadding);\n  const totalHeight =\n    document.documentElement.clientHeight -\n    (typeof containerPadding === \"object\"\n      ? containerPadding.y\n      : containerPadding);\n\n  let top = clientY;\n  let left = clientX;\n\n  if (left + overlayWidth > totalWidth) {\n    left = totalWidth - overlayWidth;\n  }\n\n  if (top + overlayHeight > totalHeight) {\n    top = totalHeight - overlayHeight;\n  }\n\n  top = Math.max(0, top);\n  left = Math.max(0, left);\n\n  return { top, left };\n}\n","import React, { ForwardedRef, useEffect, useMemo } from \"react\";\nimport {\n  MenuOverlay,\n  MenuOverlayProps,\n} from \"@intellij-platform/core/Menu/MenuOverlay\";\nimport { useOverlayPositionFromOrigin } from \"@intellij-platform/core/Menu/useOverlayPositionFromOrigin\";\nimport { getScrollParent, isScrollable, useObjectRef } from \"@react-aria/utils\";\nimport { createGlobalStyle } from \"styled-components\";\n\ninterface MenuOverlayFromOriginProps\n  extends Pick<MenuOverlayProps, \"onClose\" | \"defaultAutoFocus\"> {\n  /**\n   * Origin point within the viewport, based on which the menu overlay should be positioned.\n   * Any pointer/mouse event, or a plain object with clientX and clientY can be passed.\n   */\n  origin:\n    | {\n        /**\n         * Horizontal coordinate of the origin point within the viewport.\n         * See {@link MouseEvent.clientX}\n         */\n        clientX: number;\n        /**\n         * Vertical coordinate of the origin point within the viewport.\n         * See {@link MouseEvent.clientX}\n         */\n        clientY: number;\n\n        /**\n         * Origin's target element.\n         * Used to find the scrollable parent and disable scrolling while\n         * the overlay is rendered.\n         */\n        target?: EventTarget | HTMLElement | null;\n      }\n    | undefined;\n  children: React.ReactNode;\n}\n\nconst DisableScrollStyles = createGlobalStyle`\n  .disable-scroll {\n      overflow: hidden !important;\n  }\n`;\n\n/**\n * Menu overlay position based on an origin point on the screen.\n * Useful when the menu is opened by a pointer event.\n */\nexport const MenuOverlayFromOrigin = React.forwardRef(\n  function MenuOverlayFromOrigin(\n    { children, origin, ...otherProps }: MenuOverlayFromOriginProps,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) {\n    const overlayRef = useObjectRef(forwardedRef);\n    const { positionProps } = useOverlayPositionFromOrigin({\n      overlayRef,\n      origin,\n      containerPadding: { x: 0, y: 4 },\n    });\n\n    const scrollParent: null | Element = useMemo(() => {\n      if (!(origin?.target instanceof HTMLElement)) {\n        return null;\n      }\n      return isScrollable(origin.target)\n        ? origin.target\n        : getScrollParent(origin.target);\n    }, [origin?.target]);\n\n    useEffect(() => {\n      // Known issue: closing contextmenu causes a jump in scroll (see project view in example app)\n      // It's an issue that existed before the change to disable scroll when the contextmenu is open,\n      // so it should not have anythign to do with changing overflow hidden when the menu is open.\n      scrollParent?.classList?.add(\"disable-scroll\");\n      return () => {\n        scrollParent?.classList?.remove(\"disable-scroll\");\n      };\n    }, []);\n\n    return (\n      <>\n        <DisableScrollStyles />\n        {Boolean(origin) && (\n          <MenuOverlay\n            overlayProps={positionProps}\n            overlayRef={overlayRef}\n            restoreFocus\n            {...otherProps}\n          >\n            {children}\n          </MenuOverlay>\n        )}\n      </>\n    );\n  }\n);\n","import React, { HTMLAttributes, RefObject } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport { AriaMenuOptions, useMenuTrigger } from \"@react-aria/menu\";\nimport { useOverlayPosition } from \"@react-aria/overlays\";\nimport { useMenuTriggerState } from \"@react-stately/menu\";\nimport { MenuTriggerProps as AriaMenuTriggerProps } from \"@react-types/menu\";\n\nimport { MenuOverlay } from \"./MenuOverlay\";\nimport { AriaButtonProps } from \"@react-types/button\";\nimport { Alignment } from \"@react-types/shared\";\n\nexport interface MenuTriggerProps\n  extends Omit<AriaMenuTriggerProps, \"closeOnSelect\"> {\n  restoreFocus?: boolean;\n  // TODO: replace render function children with normal children, and utilize PressResponder. Add a story for the\n  //  edge case of custom trigger, using PressResponder\n  children: (\n    props: HTMLAttributes<HTMLButtonElement>,\n    ref: RefObject<any> // Using a generic didn't seem to work for some reason\n  ) => React.ReactNode;\n  // NOTE: there is a chance of unchecked breaking change here, since this is not explicitly mentioned as public API\n  // of useButton, but it is passed to the underlying usePress.\n  preventFocusOnPress?: boolean;\n  /**\n   * By default, the menu is positioned relative to the trigger. `positioningTargetRef` can be used to have the menu\n   * positioned to another element. An example use case is when the menu trigger is a button inside some list item or\n   * text box, but the menu semantically belongs to the container list item or text box.\n   */\n  positioningTargetRef?: React.RefObject<HTMLElement>;\n  renderMenu: (props: {\n    // AriaMenuOptions contains more properties than needed\n    menuProps: Pick<\n      AriaMenuOptions<unknown>,\n      \"id\" | \"aria-labelledby\" | \"autoFocus\" | \"onClose\"\n    >;\n  }) => React.ReactNode;\n\n  /**\n   * Alignment of the menu relative to the trigger.\n   * @default 'start'\n   */\n  align?: Alignment;\n  /**\n   * Where the Menu opens relative to its trigger.\n   * @default 'bottom'\n   */\n  direction?: \"bottom\" | \"top\" | \"left\" | \"right\" | \"start\" | \"end\";\n  /**\n   * Whether the menu should automatically flip direction when space is limited.\n   * @default true\n   */\n  shouldFlip?: boolean;\n}\n\n// FIXME: Escape doesn't close the menu\n// FIXME: Focus is not restored if nested menu are opened. It may be solved by using useOverlay and closing submenu in click outside.\n// FIXME: use PressResponder and replace render prop children with a normal react dom children. Issues with current impl:\n//  disabled trigger doesn't work as expected. props passed to children fn is html props, which is limiting for button\n//  components that don't accept arbitrary dom props.\n/**\n * Makes its children a trigger for a menu, rendered via {@link MenuTriggerProps#renderMenu} prop.\n * Closes the menu when a menu action is triggered.\n */\nexport const MenuTrigger: React.FC<MenuTriggerProps> = ({\n  children,\n  renderMenu,\n  direction = \"bottom\",\n  align = \"start\",\n  shouldFlip = true,\n  restoreFocus = true,\n  preventFocusOnPress = true,\n  positioningTargetRef,\n  ...otherProps\n}) => {\n  const state = useMenuTriggerState(otherProps);\n  const triggerRef = React.useRef(null);\n  const overlayRef = React.useRef(null);\n  // FIXME: Menu props is not used, but it's just about labelBy and id. Only needed for accessibility, but it would\n  //  require a `renderMenu` prop, instead of `menu`.\n  const { menuTriggerProps: triggerProps, menuProps } = useMenuTrigger(\n    { type: \"menu\" },\n    state,\n    triggerRef\n  );\n  const ariaButtonProps: AriaButtonProps<\"button\"> = {\n    ...triggerProps,\n    // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n    preventFocusOnPress,\n  };\n  const { buttonProps } = useButton(ariaButtonProps, triggerRef);\n\n  const { overlayProps: positionProps } = useOverlayPosition({\n    targetRef: positioningTargetRef ?? triggerRef,\n    overlayRef,\n    placement: getPlacement(direction, align),\n    shouldFlip,\n    offset: 0,\n    containerPadding: 0,\n    onClose: () => state.close(),\n    isOpen: state.isOpen,\n  });\n\n  return (\n    <>\n      {children(buttonProps, triggerRef)}\n      {state.isOpen && (\n        <MenuOverlay\n          overlayProps={positionProps}\n          overlayRef={overlayRef}\n          onClose={state.close}\n          restoreFocus={restoreFocus}\n        >\n          {renderMenu({ menuProps })}\n        </MenuOverlay>\n      )}\n    </>\n  );\n};\n\nfunction getPlacement(\n  direction: Required<MenuTriggerProps>[\"direction\"],\n  align: Required<MenuTriggerProps>[\"align\"]\n) {\n  switch (direction) {\n    case \"left\":\n    case \"right\":\n    case \"start\":\n    case \"end\":\n      return `${direction} ${align === \"end\" ? \"bottom\" : \"top\"}` as const;\n    case \"bottom\":\n    case \"top\":\n    default:\n      return `${direction} ${align}` as const;\n  }\n}\n","import React, {\n  HTMLAttributes,\n  RefObject,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport {\n  mergeProps,\n  useLayoutEffect,\n  useResizeObserver,\n} from \"@react-aria/utils\";\nimport { focusSafely } from \"@react-aria/focus\";\nimport { ListCollection } from \"@react-stately/list\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport {\n  useCollectionSpeedSearch,\n  CollectionSpeedSearchMatches,\n} from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport {\n  SpeedSearchInput,\n  SpeedSearchPopupProps,\n  SpeedSearchState,\n} from \"@intellij-platform/core/SpeedSearch\";\n\nimport { StyledMenu } from \"./StyledMenu\";\nimport { MenuContext, MenuProps, useMenu, useMenuState } from \"./Menu\";\nimport { renderMenuNodes } from \"./renderMenuNodes\";\nimport { SubmenuProps, useSubmenu } from \"./Submenu\";\nimport { useSubmenuState } from \"./_useSubmenuState\";\nimport { MenuKeyboardDelegate } from \"./_useSubmenu\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledVerticalSeparator } from \"@intellij-platform/core/StyledSeparator\";\n\nexport interface SpeedSearchMenuProps<T>\n  extends Omit<MenuProps<T>, \"submenuBehavior\"> {\n  submenuBehavior?: Exclude<MenuProps<T>[\"submenuBehavior\"], \"default\">;\n  /**\n   * Text to show when the filtering is active but no match is found for the current query.\n   * @default \"Nothing to show\"\n   */\n  emptyText?: React.ReactNode;\n}\n\nconst StyledItemsContainer = styled.ul`\n  all: unset;\n  flex: 1;\n  overflow: auto;\n`;\n\nconst StyledSearchFieldWrapper = styled.div`\n  flex-shrink: 0;\n  padding: 0 0.2rem 0.3rem;\n`;\n\nconst StyledSpeedSearchMenu = styled(StyledMenu)`\n  --jui-menu-item-padding: 1.25rem;\n  ${StyledVerticalSeparator} {\n    margin: 0 3px; // FIXME: probably use theme\n  }\n`;\n\nconst StyledPlaceholder = styled.div`\n  color: ${({ theme }) =>\n    // Ref: StatusText => DEFAULT_ATTRIBUTES => SimpleTextAttributes.GRAYED_ATTRIBUTES\n    theme.color(\n      \"Component.infoForeground\",\n      theme.dark ? \"#787878\" : \"#999999\"\n    )};\n\n  // center positioning. Intentionally different from reference impl.\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n\n  white-space: nowrap;\n`;\n\nfunction useSpeedSearchMenu<T>(\n  state: TreeState<T>,\n  rootKey: React.Key | null,\n  ref: React.RefObject<HTMLUListElement>,\n  containerRef: React.RefObject<HTMLDivElement>\n) {\n  const {\n    speedSearch,\n    selectionManager,\n    keyboardDelegate,\n    containerProps: speedSearchContainerProps,\n    searchPopupProps,\n  } = useCollectionSpeedSearch({\n    collection: useMemo(\n      () =>\n        new ListCollection(\n          rootKey\n            ? state.collection.getItem(rootKey)?.childNodes ?? []\n            : state.collection\n        ),\n      [rootKey, state.collection]\n    ),\n    selectionManager: state.selectionManager,\n    keyboardDelegate: new MenuKeyboardDelegate(\n      rootKey,\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    keepSearchActiveOnBlur: true,\n    focusBestMatch: true,\n    ref,\n  });\n\n  // When a menu item which was focused is filtered out, the focus goes to body.\n  // We manually move focus back to the container.\n  useEffect(() => {\n    const element = ref.current;\n    if (\n      element &&\n      state.selectionManager.isFocused &&\n      !element?.contains(document.activeElement)\n    ) {\n      focusSafely(element);\n    }\n  });\n\n  const lastSize = useRef<{ width: number; height: number } | null>(null);\n  const [size, setSize] = useState<{ width: number; height: number } | null>(\n    null\n  );\n  const measureSize = () => {\n    const { offsetWidth = 0, offsetHeight = 0 } = containerRef.current || {};\n    if (offsetWidth > 0 && offsetHeight > 0) {\n      lastSize.current = {\n        width: offsetWidth,\n        height: offsetHeight,\n      };\n    }\n  };\n  const isSearchActive =\n    speedSearch.active && speedSearch.searchTerm.length > 0;\n  useResizeObserver({\n    ref: containerRef,\n    onResize: useEventCallback(() => {\n      if (!isSearchActive) {\n        measureSize();\n      }\n    }),\n  });\n  useLayoutEffect(() => {\n    if (isSearchActive) {\n      if (lastSize.current) {\n        setSize(lastSize.current);\n      }\n    } else {\n      if (!lastSize.current) {\n        measureSize();\n      }\n      setSize(null);\n    }\n  }, [isSearchActive]);\n\n  const sizeStyleProps: HTMLAttributes<HTMLElement> = size\n    ? {\n        style: {\n          ...size,\n          minHeight: size.height,\n          maxHeight: size.height,\n        },\n      }\n    : {};\n  return {\n    speedSearch,\n    keyboardDelegate,\n    selectionManager,\n    speedSearchContainerProps: mergeProps<HTMLAttributes<HTMLElement>[]>(\n      speedSearchContainerProps,\n      sizeStyleProps,\n      {\n        onMouseDown: (e: React.MouseEvent) => {\n          // Until SearchInput and connecting that to a selectable list is implemented, we should prevent menu from\n          // losing focus when the fake search input is clicked\n          e.preventDefault();\n        },\n      }\n    ),\n    searchPopupProps,\n  };\n}\n\n/**\n * Drop-in replacement for Menu, which implements SpeedSearch.\n *\n *\n */\nexport const SpeedSearchMenu = <T extends object>({\n  submenuBehavior = \"toggleOnPress\",\n  autoFocus = \"first\",\n  emptyText = \"Nothing to show\",\n  minWidth,\n  ...props\n}: SpeedSearchMenuProps<T>) => {\n  const onAction = (key: React.Key) => {\n    props.onAction?.(key);\n    speedSearch.clear();\n  };\n  const ref = React.useRef<HTMLUListElement>(null);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const state = useMenuState({ ...props });\n  const {\n    speedSearch,\n    speedSearchContainerProps,\n    searchPopupProps,\n    keyboardDelegate,\n  } = useSpeedSearchMenu(state, null, ref, containerRef);\n  const { menuContextValue, menuProps } = useMenu(\n    {\n      ...props,\n      autoFocus,\n      onAction,\n      keyboardDelegate,\n      submenuBehavior,\n    },\n    state,\n    ref\n  );\n\n  return (\n    <MenuContext.Provider\n      value={{\n        ...menuContextValue,\n        renderSubmenu: (props) => (\n          <SpeedSearchSubmenu emptyText={emptyText} {...props} />\n        ),\n      }}\n    >\n      <StyledSpeedSearchMenu\n        as=\"div\"\n        ref={containerRef}\n        style={{ minWidth }}\n        {...speedSearchContainerProps}\n        fillAvailableSpace={props.fillAvailableSpace}\n      >\n        <SpeedSearchMenuContent\n          items={[...state.collection]}\n          emptyText={emptyText}\n          speedSearch={speedSearch}\n          searchPopupProps={searchPopupProps}\n          state={state}\n          menuProps={menuProps}\n          menuRef={ref}\n        />\n      </StyledSpeedSearchMenu>\n    </MenuContext.Provider>\n  );\n};\n\nfunction SpeedSearchMenuContent<T>({\n  items,\n  state,\n  speedSearch,\n  searchPopupProps,\n  menuProps,\n  menuRef,\n  emptyText,\n}: {\n  state: TreeState<T>;\n  items: Node<T>[];\n  speedSearch: SpeedSearchState & { matches: CollectionSpeedSearchMatches };\n  searchPopupProps: SpeedSearchPopupProps;\n  menuProps: HTMLAttributes<HTMLElement>;\n  menuRef: RefObject<HTMLUListElement>;\n  emptyText: React.ReactNode;\n}) {\n  const filter = speedSearch.active\n    ? ({ key, type }: Node<T>) =>\n        type !== \"item\" || speedSearch.matches.has(key)\n    : undefined;\n  return (\n    <>\n      {searchPopupProps.children && (\n        <StyledSearchFieldWrapper\n          onClick={(e) => {\n            e.preventDefault();\n          }}\n        >\n          <SpeedSearchInput {...searchPopupProps} clear={speedSearch.clear} />\n        </StyledSearchFieldWrapper>\n      )}\n      <StyledItemsContainer {...menuProps} ref={menuRef}>\n        {renderMenuNodes(state, items, filter)}\n        {speedSearch.active && speedSearch.matches.size === 0 && (\n          <StyledPlaceholder>{emptyText}</StyledPlaceholder>\n        )}\n      </StyledItemsContainer>\n    </>\n  );\n}\n\nfunction SpeedSearchSubmenu<T>({\n  parentState,\n  rootKey,\n  emptyText,\n}: SubmenuProps<T> & { emptyText: React.ReactNode }) {\n  const ref = useRef<HTMLUListElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const state = useSubmenuState(parentState);\n  const rootItem = state.collection.getItem(rootKey);\n\n  const {\n    speedSearch,\n    speedSearchContainerProps,\n    searchPopupProps,\n    keyboardDelegate,\n  } = useSpeedSearchMenu(state, rootKey, ref, containerRef);\n  const { submenuProps } = useSubmenu(\n    { rootKey, parentState, keyboardDelegate },\n    state,\n    ref\n  );\n\n  return (\n    <StyledSpeedSearchMenu\n      {...speedSearchContainerProps}\n      as=\"div\"\n      ref={containerRef}\n    >\n      <SpeedSearchMenuContent\n        items={[...(rootItem?.childNodes || [])]}\n        speedSearch={speedSearch}\n        searchPopupProps={searchPopupProps}\n        state={state}\n        menuProps={submenuProps}\n        menuRef={ref}\n        emptyText={emptyText}\n      />\n    </StyledSpeedSearchMenu>\n  );\n}\n","import { css } from \"styled-components\";\n\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { StyledVerticalSeparator } from \"../StyledSeparator\";\nimport { UnknownThemeProp } from \"../Theme/Theme\";\n\nimport { StyledMenuItem, StyledMenuItemIcon } from \"./StyledMenuItem\";\n\nexport const MENU_VERTICAL_PADDING = 5;\nexport const MENU_BORDER_WIDTH = 1;\n\n// noinspection CssInvalidPropertyValue\nexport const StyledMenu = styled.ul<{ fillAvailableSpace?: boolean }>`\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  font-size: 0.8rem;\n  margin: 0;\n  padding: ${MENU_VERTICAL_PADDING}px 0;\n  outline: none;\n  list-style: none;\n  width: fit-content;\n  min-width: 120px;\n  overflow: auto;\n  // Border doesn't seem to be painted in the original impl. IdeaPopupMenuUI.isUnderPopup(c) seemed to return false\n  // in all cases. More info: https://github.com/JetBrains/intellij-community/blob/c5ece483811a3ab546fc3880225efb02cc8b94dd/platform/platform-impl/src/com/intellij/ide/ui/laf/darcula/ui/DarculaPopupMenuBorder.java#L24\n  /*  border: ${MENU_BORDER_WIDTH}px solid\n    ${({ theme }) =>\n    theme.color(\"Menu.borderColor\", !theme.dark ? \"#CDCDCD\" : \"#515151\")};*/\n  ${WINDOW_SHADOW};\n  background: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.background\" as UnknownThemeProp<\"PopupMenu.background\">\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"PopupMenu.foreground\" as UnknownThemeProp<\"PopupMenu.foreground\">\n    )};\n\n  ${StyledVerticalSeparator}:first-child,\n  ${StyledVerticalSeparator}:last-child, \n  ${StyledVerticalSeparator} + ${StyledVerticalSeparator} {\n    display: none;\n  }\n  ${StyledVerticalSeparator} {\n    background-color: ${({ theme }) => theme.color(\"Menu.separatorColor\")};\n    height: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.height\") ?? 3}px`};\n    padding: ${({ theme }) =>\n      `${theme.value(\"PopupMenuSeparator.stripeIndent\") ?? 1}px 0`};\n    margin: ${({ theme }) =>\n      `0 ${theme.value(\"PopupMenuSeparator.withToEdge\") ?? 1}px`};\n  }\n  ${({ fillAvailableSpace }) =>\n    fillAvailableSpace &&\n    css`\n      flex: 1;\n      width: fill-available; // will be converted to --webkit-fill-available and --moz-available, but doesn't work in FF\n      height: fill-available;\n    `}\n\n  --jui-menu-item-padding: 1rem;\n  --jui-menu-item-icon-width: 1rem;\n  --jui-menu-item-icon-spacing: 0.3125rem;\n\n  ${StyledMenuItem} {\n    // NOTE: The left margin seems not to be consistent in all menus.\n    padding-left: var(--jui-menu-item-padding);\n  }\n  &:has(${StyledMenuItemIcon}) {\n    // Adjusting item padding for menus with icon to be slightly smaller. Based on observations on the reference impl.\n    // Could be handled by a negative margin on icons as well.\n    --jui-menu-item-padding: 0.75rem;\n\n    // CSS-only solution to conditionally add left margin to menu items without icon, if there is at least one menu item\n    // with icon, in the current menu. To have text in all menu items aligned. The extra margin is avoided if there is no\n    // menu item with icon. It relies on :has() css pseudo-class which is not supported in FF at the moment.\n    ${StyledMenuItem}:not(:has(${StyledMenuItemIcon})) {\n      padding-left: calc(\n        var(--jui-menu-item-padding) + var(--jui-menu-item-icon-width) +\n          var(--jui-menu-item-icon-spacing)\n      );\n    }\n  }\n  ${StyledMenuItemIcon} {\n    width: var(--jui-menu-item-icon-width);\n    margin-right: var(--jui-menu-item-icon-spacing);\n  }\n`;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nexport const StyledMenuItemIcon = styled.span`\n  display: inline-flex; // prevents unwanted increased height\n`;\n\nexport const StyledNestedArrow = styled.span`\n  display: inline-flex; // to make it not take more height than the icon\n  margin-right: -0.75rem;\n  margin-left: 0.75rem;\n`;\n\nconst highlightedStyle = css`\n  color: ${({ theme }) =>\n    theme.asCurrentForeground(\n      theme.color(\n        \"MenuItem.selectionForeground\" as UnknownThemeProp<\"MenuItem.selectionForeground\">\n      )\n    )};\n  background: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.selectionBackground\" as UnknownThemeProp<\"MenuItem.selectionBackground\">\n    )};\n`;\nconst defaultStyle = css`\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.foreground\" as UnknownThemeProp<\"MenuItem.foreground\">\n    )};\n  background: unset;\n`;\nconst disabledStyle = css`\n  color: ${({ theme }) =>\n    theme.color(\"MenuItem.disabledForeground\") + \"!important\"};\n  background: unset !important;\n`;\nexport const StyledMenuItem = styled.li<{\n  isDisabled: boolean;\n  isActive: boolean;\n}>`\n  position: relative; // for being able to position arrow icon absolutely\n  outline: none;\n  cursor: default;\n  white-space: nowrap;\n\n  // bg/fg style for different states. Order is based on how they should override each other\n  ${defaultStyle};\n  ${({ isActive }) => isActive && highlightedStyle};\n  ${({ isDisabled }) => isDisabled && disabledStyle};\n\n  padding-right: 1.25rem;\n  line-height: 1.3125rem; // to make the item have the right height\n  display: flex;\n  align-items: center;\n`;\n","import React, { useContext, useEffect, useRef } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { AriaMenuOptions, useMenu } from \"@react-aria/menu\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport {\n  MenuKeyboardDelegate,\n  useSubmenu as useSubmenuAria,\n} from \"./_useSubmenu\";\nimport { useSubmenuState } from \"./_useSubmenuState\";\nimport { MenuContext } from \"./Menu\";\nimport { StyledMenu } from \"./StyledMenu\";\nimport { renderMenuNodes } from \"./renderMenuNodes\";\n\nexport function useSubmenu<T>(\n  {\n    rootKey,\n    parentState,\n    keyboardDelegate,\n  }: { rootKey: React.Key; parentState: TreeState<T> } & Pick<\n    AriaMenuOptions<T>,\n    \"keyboardDelegate\"\n  >,\n  state: TreeState<T>,\n  ref: React.RefObject<HTMLElement>\n) {\n  const rootItem = state.collection.getItem(rootKey);\n  const {\n    submenuBehavior,\n    autoFocus = true,\n    onClose,\n    onAction,\n  } = useContext(MenuContext);\n  let { menuProps } = useMenu(\n    {\n      \"aria-label\": rootItem?.[\"aria-label\"] || rootItem?.textValue,\n      onAction,\n      onClose,\n      selectedKeys: state.selectionManager.selectedKeys,\n      keyboardDelegate:\n        keyboardDelegate ||\n        new MenuKeyboardDelegate(\n          rootKey,\n          state.collection,\n          state.disabledKeys,\n          ref\n        ),\n      autoFocus,\n    },\n    state,\n    ref\n  );\n  const { submenuProps } = useSubmenuAria({ rootKey }, parentState, ref);\n\n  const submenuBehaviorProps = {\n    onKeyDown: (e: React.KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        // Close the menu and submenu root node.\n        state.toggleKey(rootKey);\n        state.selectionManager.setFocusedKey(rootKey);\n        parentState.selectionManager.setFocused(true);\n        if (submenuBehavior !== \"default\") {\n          e.stopPropagation();\n        }\n        return;\n      }\n    },\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      // we need this hack until the nested menu is properly supported. That's because when the element is hovered\n      // it sets the focus key, which will move focus to that item.\n      // noinspection PointlessBooleanExpressionJS seems to be false positive. autoFocus can be \"first\" or \"last\"\n      if (autoFocus === true) {\n        ref.current?.focus();\n      }\n    });\n  }, []);\n\n  return {\n    submenuProps: mergeProps(menuProps, submenuProps, submenuBehaviorProps),\n  };\n}\n\nexport interface SubmenuProps<T> {\n  parentState: TreeState<T>;\n  rootKey: React.Key;\n}\n\nexport function Submenu<T>({ parentState, rootKey }: SubmenuProps<T>) {\n  const ref = useRef<HTMLUListElement>(null);\n  const state = useSubmenuState(parentState);\n  const rootItem = state.collection.getItem(rootKey);\n\n  const { submenuProps } = useSubmenu({ rootKey, parentState }, state, ref);\n\n  return (\n    <StyledMenu {...submenuProps} ref={ref}>\n      {renderMenuNodes(state, [...(rootItem?.childNodes || [])])}\n    </StyledMenu>\n  );\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport React, { Key, RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { ListKeyboardDelegate } from \"@react-aria/selection\";\n\nexport class MenuKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  private keys: React.Key[];\n  constructor(\n    rootKey: Key | null,\n    private collection: Collection<Node<T>>,\n    disabledKeys: Set<React.Key>,\n    ref: React.RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super(collection, disabledKeys, ref, collator);\n    this.keys = [...collection.getKeys()]\n      .map((key) => collection.getItem(key))\n      .flatMap((item) => {\n        if (item && item.parentKey == rootKey) {\n          if (item.type === \"item\") {\n            return [item.key];\n          } else if (item.type === \"section\") {\n            return [...item.childNodes].map(({ key }) => key);\n          }\n        }\n        return [];\n      });\n  }\n\n  getFirstKey(): React.Key {\n    return this.keys[0];\n  }\n  getLastKey(): React.Key {\n    return this.keys.slice(-1)[0];\n  }\n\n  getKeyBelow(key: React.Key): React.Key {\n    const keyBelow = super.getKeyBelow(key);\n    // @ts-expect-error: getKeyBelow should be allowed to return null, but typing is currently inaccurate in react-aria\n    return this.keys.includes(keyBelow) ? keyBelow : null;\n  }\n  getKeyAbove(key: React.Key): React.Key {\n    const keyAbove = super.getKeyAbove(key);\n    // @ts-expect-error: getKeyBelow should be allowed to return null, but typing is currently inaccurate in react-aria\n    return this.keys.includes(keyAbove) ? keyAbove : null;\n  }\n}\n\n/**\n * Behavior accessibility of submenus:\n * - Closing submenu on ArrowLeft key press.\n *   Note that it can't be implemented in useMenuItem, because the focus might be on no the submenu itself and not any\n *   of its items\n * @param rootKey: Key of the root node, the submenu is created from its children\n * @param state\n * @param ref\n */\nexport function useSubmenu<T>(\n  { rootKey }: { rootKey: Key },\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const { keyboardProps: submenuProps } = useKeyboard({\n    onKeyDown: (e) => {\n      // Keyboard events bubble through portals. Don't handle keyboard events\n      // for elements outside the collection (e.g. menus).\n      if (!ref.current?.contains(e.target as Element)) {\n        e.continuePropagation();\n        return;\n      }\n      const root = state.collection.getItem(rootKey);\n      if (e.key === \"ArrowLeft\" && root && state.expandedKeys.has(root.key)) {\n        state.toggleKey(root.key);\n        state.selectionManager.setFocused(true);\n        return;\n      }\n      e.continuePropagation();\n    },\n  });\n\n  return {\n    submenuProps,\n  };\n}\n","import { TreeState } from \"@react-stately/tree\";\nimport { Key, useRef, useState } from \"react\";\nimport {\n  MultipleSelectionState,\n  SelectionManager,\n} from \"@react-stately/selection\";\n\n/**\n * Creates a TreeState corresponding to the submenu, from the state of a parent (sub)menu.\n * The collection and everything is the same, and the only difference from the parent state is selection manager\n * having a separate focused state to keep the focused state of each menu container separately, as the submenus\n * are usually rendered in separate overlays.\n */\nexport function useSubmenuState<T>(parentState: TreeState<T>) {\n  // We want synchronous updates to `isFocused` and `focusedKey` after their setters are called.\n  // But we also need to trigger a re-render. So, we have both a ref (sync) and state (async).\n  const [, setFocused] = useState(false);\n  const [, setFocusedKey] = useState<Key | null>(null);\n  const isFocusedRef = useRef(false);\n  const focusedKeyRef = useRef<Key | null>(null);\n\n  const state: MultipleSelectionState = {\n    // @ts-expect-error state is private\n    ...parentState.selectionManager.state,\n    setFocused: (isFocused: boolean) => {\n      isFocusedRef.current = isFocused;\n      setFocused(isFocused);\n    },\n    setFocusedKey(key: Key) {\n      focusedKeyRef.current = key;\n      setFocusedKey(key);\n    },\n  };\n  Object.defineProperties(state, {\n    isFocused: {\n      get() {\n        return isFocusedRef.current;\n      },\n    },\n    focusedKey: {\n      get() {\n        return focusedKeyRef.current!;\n      },\n    },\n  });\n\n  return {\n    ...parentState,\n    selectionManager: new SelectionManager(parentState.collection, state),\n  };\n}\n","import React from \"react\";\nimport { useMenuSection } from \"@react-aria/menu\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nimport { renderMenuNodes } from \"./renderMenuNodes\";\n\nexport interface MenuSectionProps<T> {\n  item: Node<T>;\n  state: TreeState<T>;\n  filter?: (node: Node<T>) => boolean;\n}\n\nconst StyledMenuHeading = styled.div`\n  cursor: default;\n  padding: 2px 0 2px 12px;\n  font-weight: bold;\n  font-size: 0.8125rem;\n  color: ${({ theme }) =>\n    theme.color(\n      \"MenuItem.disabledForeground\"\n    )}; // TODO: make sure about it. It's probably not correct color\n`;\n\nconst StyledMenuSectionItemsContainer = styled.ul`\n  padding: 0;\n  margin: 0;\n`;\n\nexport const MenuSection = <T extends unknown>({\n  item,\n  state,\n  filter = () => true,\n}: MenuSectionProps<T>): React.ReactElement => {\n  let { itemProps, headingProps, groupProps } = useMenuSection({\n    heading: item.rendered,\n    \"aria-label\": item[\"aria-label\"],\n  });\n\n  const nodes = [...item.childNodes].filter(filter);\n  if (nodes.filter(({ type }) => type === \"item\").length === 0) {\n    return <></>;\n  }\n  return (\n    <>\n      <li {...itemProps}>\n        {item.rendered && (\n          <StyledMenuHeading {...headingProps}>\n            {item.rendered}\n          </StyledMenuHeading>\n        )}\n        <StyledMenuSectionItemsContainer {...groupProps}>\n          {renderMenuNodes(state, nodes)}\n        </StyledMenuSectionItemsContainer>\n      </li>\n    </>\n  );\n};\n","import React from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { Node } from \"@react-types/shared\";\nimport { ListDivider } from \"@intellij-platform/core/List/ListDivider\"; // private import\n\nimport { MenuItem } from \"./MenuItem\";\nimport { MenuSection } from \"./MenuSection\";\n\nexport function renderMenuNodes<T>(\n  state: TreeState<T>,\n  nodes: Node<T>[],\n  filter: (node: Node<T>) => boolean = () => true\n) {\n  return nodes.filter(filter).map((node) => {\n    switch (node.type) {\n      case \"item\":\n        return <MenuItem key={node.key} item={node} state={state} />;\n      case \"section\":\n        return (\n          <>\n            {node.props.hasDivider && (\n              <ListDivider key={node.key + \"-divider1\"} />\n            )}\n            <MenuSection\n              key={node.key}\n              item={node}\n              state={state}\n              filter={filter}\n            />\n            {node.props.hasDivider && (\n              <ListDivider key={node.key + \"-divider2\"} />\n            )}\n          </>\n        );\n      case \"divider\":\n        return <ListDivider key={node.key} />;\n    }\n  });\n}\n","import React, {\n  createContext,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\nexport interface MnemonicProps {\n  children: React.ReactNode;\n  /**\n   * Character to be used as {@link https://jetbrains.design/intellij/principles/mnemonics/ mnemonic}.\n   */\n  mnemonic: string;\n  /**\n   * Called when mnemonic key is pressed with the activator key\n   */\n  onTriggered?: () => void;\n\n  /**\n   * Whether the mnemonic is disabled. Useful when setting mnemonic on disable-able components, to just pass\n   * isDisabled prop down to MnemonicTrigger\n   */\n  isDisabled?: boolean;\n}\n\nconst MnemonicContext = createContext<{\n  character: string | null;\n  rendered: () => void;\n  /**\n   * Called when mnemonic is found in the text of the trigger component and rendered underlined, so the user\n   * can have a chance to know how to trigger the component's action via mnemonic.\n   */\n  active: boolean;\n}>({ character: null, active: false, rendered: () => {} });\n\nexport const MnemonicTrigger = ({\n  children,\n  mnemonic,\n  isDisabled,\n  onTriggered: onTriggeredProp = () => {},\n}: MnemonicProps): JSX.Element => {\n  const ref = useRef<HTMLElement>(null);\n  const onTriggered = useEventCallback(onTriggeredProp);\n  const [active, setActive] = useState(false);\n  const keydownListener = useEventCallback((e: KeyboardEvent) => {\n    if (isDisabled) {\n      return;\n    }\n    if (active && !e.repeat) {\n      const character = e.code.match(/Key([A-Z])/)?.[1];\n      if (character && character.toLowerCase() === mnemonic.toLowerCase()) {\n        onTriggered();\n      }\n    }\n    if (e.key === \"Alt\" && ref.current && isAccessible(ref.current)) {\n      setActive(true);\n    }\n  });\n\n  useEffect(() => {\n    // calling addEventListener with already registered listener is no-op.\n    document.addEventListener(\"keydown\", keydownListener);\n    document.addEventListener(\"keyup\", keyupListener);\n    window.addEventListener(\"blur\", onBlur);\n    function onBlur() {\n      setActive(false);\n    }\n    function keyupListener(e: KeyboardEvent) {\n      if (e.key === \"Alt\") {\n        setActive(false);\n      }\n    }\n    return () => {\n      document.removeEventListener(\"keydown\", keydownListener);\n      document.removeEventListener(\"keyup\", keyupListener);\n      window.removeEventListener(\"blur\", onBlur);\n    };\n  }, []);\n\n  const renderedMnemonicRef = useRef<string>(\"\");\n  useEffect(() => {\n    const timerId = setTimeout(() => {\n      if (renderedMnemonicRef.current !== mnemonic) {\n        console.warn(\n          `Mnemonic ${mnemonic} was set but not rendered to the user. \nMake sure the specified character is rendered directly in MnemonicTrigger, or wrapped by MnemonicText inside MnemonicTrigger children. \nElement:`,\n          ref.current?.parentElement\n        );\n      }\n    });\n    return () => {\n      clearTimeout(timerId);\n    };\n  }, [mnemonic]);\n  return (\n    <MnemonicContext.Provider\n      value={{\n        character: mnemonic,\n        active,\n        rendered: () => {\n          renderedMnemonicRef.current = mnemonic;\n        },\n      }}\n    >\n      <span hidden ref={ref} />\n      {typeof children === \"string\" ? (\n        <MnemonicText>{children}</MnemonicText>\n      ) : (\n        children\n      )}\n    </MnemonicContext.Provider>\n  );\n};\n\n/**\n * Checks if a\n * See more in ./design-decisions.md\n */\nfunction isAccessible(element: Element): boolean {\n  return (\n    !element.closest(\"[aria-hidden]\") &&\n    element.parentElement !== null &&\n    isVisible(element.parentElement)\n  );\n}\nfunction isVisible(e: HTMLElement) {\n  return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length);\n}\n/**\n * Used inside MnemonicTrigger children, when the direct child can't be a string.\n * @example\n * ```tsx\n * <MnemonicTrigger mnemonic=\"D\">\n *    <>\n *      <MnemonicText>Disconnect</MnemonicText>\n *    </>\n * </MnemonicTrigger>\n * ```\n */\nexport function MnemonicText({ children }: { children: string }) {\n  const { character, active, rendered } = useContext(MnemonicContext);\n  if (character) {\n    const index = children.toLowerCase().indexOf(character.toLowerCase());\n    const found = index > -1;\n    if (found) {\n      rendered();\n    }\n    if (found && active) {\n      return (\n        <>\n          {children.slice(0, index)}\n          <u>{children.slice(index, index + 1)}</u>\n          {children.slice(index + 1)}\n        </>\n      );\n    }\n  }\n  return <>{children}</>;\n}\n","import { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\nimport React, { useEffect } from \"react\";\n\n/**\n * A workaround for an issue in measuring overlay size, caused by a limitation/bug in how React 17 runs effects when\n * children suspend rendering: https://github.com/facebook/react/issues/21510\n *\n * Here is a simplified demonstration of the issue:\n * Expected behavior (React 18): https://codesandbox.io/s/parent-effects-suspense-v18-38m8p7?file=/src/App.tsx\n * Broken behavior (React 17): https://codesandbox.io/s/parent-effects-suspense-v17-h39g4g\n *\n * The overlay content size measuring runs in an effect, and that effect won't run when the content is rendered after\n * suspense.\n */\nexport function UNSAFE_React17SuspenseFix({\n  measureContentSize,\n  children,\n}: {\n  measureContentSize: () => void;\n  children: React.ReactNode;\n}) {\n  if (React.version.startsWith(\"17\")) {\n    return (\n      <React.Suspense\n        fallback={\n          <NullSuspenseFallback afterUnsuspended={measureContentSize} />\n        }\n      >\n        {children}\n      </React.Suspense>\n    );\n  }\n  return <>{children}</>;\n}\n\nfunction NullSuspenseFallback({\n  afterSuspended: afterSuspendedProp = () => {},\n  afterUnsuspended: afterUnsuspendedProp = () => {},\n}: {\n  afterUnsuspended?: () => void;\n  afterSuspended?: () => void;\n}) {\n  const afterSuspended = useEventCallback(afterSuspendedProp);\n  const afterUnsuspended = useEventCallback(afterUnsuspendedProp);\n  useEffect(() => {\n    afterSuspended?.();\n    return () => {\n      afterUnsuspended?.();\n    };\n  }, []);\n  return null;\n}\n","import React, { FocusEventHandler, useContext, useRef } from \"react\";\nimport { useOverlayTriggerState } from \"@react-stately/overlays\";\nimport { useModalOverlay, usePreventScroll } from \"@react-aria/overlays\";\nimport { focusSafely, FocusScope } from \"@react-aria/focus\";\nimport { useDialog } from \"@react-aria/dialog\";\nimport { AriaDialogProps } from \"@react-types/dialog\"; // temporary phantom dependency\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport {\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  ResizableMovableOverlayOptions,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { WindowContext } from \"@intellij-platform/core/ModalWindow/WindowContext\";\nimport { UNSAFE_React17SuspenseFix } from \"@intellij-platform/core/Overlay/UNSAFE_React17SuspenseFix\";\n\nexport interface ModalWindowProps\n  extends AriaDialogProps,\n    ResizableMovableOverlayOptions {\n  children: React.ReactNode;\n  className?: string;\n  onClose?: () => void;\n}\n\nconst StyledWindowUnderlay = styled.div`\n  position: fixed;\n  z-index: 1000; // FIXME: z-index should not be hard-coded like this\n  inset: 0;\n`;\n\nexport const StyledWindowContainer = styled.div`\n  position: fixed;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  border-radius: 8px;\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n  outline: 1px solid #555; // FIXME\n`;\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledWindowInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const DEFAULT_WINDOW_MIN_WIDTH = 50;\nexport const DEFAULT_WINDOW_MIN_HEIGHT = 24;\n\nexport const WindowControllerContext = React.createContext<\n  Partial<Pick<ModalWindowProps, \"onClose\">>\n>({});\n\n/**\n * A movable/resizable modal window. The window header which holds the title, can be used to drag the window around.\n * In the reference impl, modal windows are os-native, and contain os-level buttons for minimize/close/maximise, which\n * are not relevant here since they wouldn't be os-native windows. A close button is still relevant (and kind of\n * necessary) and will be added in next iterations.\n *\n * The content container doesn't come with any padding. Other related components should be used for common layouts in\n * modal windows.\n * Example use cases: Window for git operations such as push, update, revert, new branch, etc.\n *\n * ![img.png](https://user-images.githubusercontent.com/3150694/181095858-968c5c66-2ae7-4e40-84e3-e6df43cd4aa4.png)\n *\n * NOTE: The part regarding rendering OverlayInteractionHandler, and rendering as a dialog with a focus scope, in an\n * overlay container could be extracted into a component which is then used to create custom resizable/movable overlay\n * dialogs, like \"Branches\", or \"Search Everywhere\".\n *\n * TODO: show close button (maybe os-aware styles?)\n *\n */\nexport const ModalWindow = ({\n  interactions = \"all\",\n  minWidth = DEFAULT_WINDOW_MIN_WIDTH,\n  minHeight = DEFAULT_WINDOW_MIN_HEIGHT,\n  className,\n  ...props\n}: ModalWindowProps): React.ReactElement => {\n  const { children } = props;\n  const propsContext = useContext(WindowControllerContext);\n  const onClose = () => {\n    propsContext.onClose?.();\n    props.onClose?.();\n  };\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { modalProps, underlayProps } = useModalOverlay(\n    {\n      isDismissable: false,\n      isKeyboardDismissDisabled: false,\n    },\n    // useModalOverlay doesn't really need the full `OverlayTriggerState` interface.\n    // It only requires `isOpen` and `close`.\n    // However, it's currently typed like this, so useOverlayTriggerState is used,\n    // just to comply with the required type, and in the unlikely case where a future minor version starts to use\n    // other properties from `OverlayTriggerState`\n    useOverlayTriggerState({\n      isOpen: true,\n      onOpenChange: (isOpen) => {\n        if (!isOpen) {\n          onClose();\n        }\n      },\n    }),\n    ref\n  );\n  usePreventScroll();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  const {\n    bounds: style,\n    overlayInteractionHandlerProps,\n    UNSAFE_measureContentSize,\n  } = useResizableMovableOverlay(ref, { ...props, minHeight, minWidth });\n\n  const { focusContainmentFixProps } = useFocusContainmentFix();\n\n  return (\n    <StyledWindowUnderlay {...underlayProps} className={className}>\n      <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n        <FocusScope contain restoreFocus autoFocus>\n          <StyledWindowContainer\n            {...mergeProps(dialogProps, modalProps, focusContainmentFixProps, {\n              style,\n            })}\n            ref={ref}\n          >\n            <StyledWindowInnerContainer>\n              <WindowContext.Provider\n                value={{\n                  isActive: true, // because it's modal. WindowContext would be used for non-modal windows too, in future\n                  titleProps,\n                  movable: interactions !== \"none\",\n                }}\n              >\n                <UNSAFE_React17SuspenseFix\n                  measureContentSize={UNSAFE_measureContentSize}\n                >\n                  {children}\n                </UNSAFE_React17SuspenseFix>\n              </WindowContext.Provider>\n            </StyledWindowInnerContainer>\n            {interactions === \"all\" && <OverlayResizeHandles />}\n          </StyledWindowContainer>\n        </FocusScope>\n      </OverlayInteractionHandler>\n    </StyledWindowUnderlay>\n  );\n};\n\n/**\n * The way FocusScope is implemented at the moment, it's possible for another focus scope to steal the focus,\n * right after the modal window is opened. The issue is not tracked down to the root cause. But with this hook,\n * we make sure there is no way for focus to go out of the modal window, when it's mounted.\n */\nfunction useFocusContainmentFix<T extends HTMLElement>() {\n  const lastFocusedElementRef = useRef<HTMLElement | null>(null);\n  const onFocus: FocusEventHandler<T> = (e) => {\n    lastFocusedElementRef.current = e.target;\n  };\n  const onBlur: FocusEventHandler = (e) => {\n    const probablyFocusedElement = e.relatedTarget;\n    if (\n      !probablyFocusedElement ||\n      (probablyFocusedElement instanceof Element &&\n        !e.currentTarget.contains(probablyFocusedElement) &&\n        // The following condition is added to exclude cases where the focus\n        // is going to an overlay that is opened from within the modal window.\n        // The condition is suboptimal as there is no check on whether the\n        // overlay is a logical child of the modal or not.\n        // However, it seems justified since the entire hook is a temporary hack,\n        // and also it doesn't seem likely for an overlay outside the modal\n        // to grab the focus.\n        !probablyFocusedElement.closest(\"[data-overlay-root]\"))\n    ) {\n      const elementToFocus = lastFocusedElementRef.current;\n      if (elementToFocus) {\n        focusSafely(elementToFocus);\n      }\n    }\n  };\n  return {\n    focusContainmentFixProps: {\n      onFocus,\n      onBlur,\n    },\n  };\n}\n","import React from \"react\";\nimport { DOMAttributes } from \"@react-types/shared\";\n\nexport const WindowContext = React.createContext<{\n  isActive: boolean;\n  movable: boolean;\n  titleProps: DOMAttributes;\n}>({ isActive: false, movable: true, titleProps: {} });\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { ButtonGroup } from \"@intellij-platform/core/ButtonGroup\";\n\nconst StyledFooter = styled.div<{ hasBorder?: boolean }>`\n  padding: 0.625rem 0.875rem;\n  display: flex;\n  gap: 0.5rem;\n  justify-content: space-between;\n  align-items: center;\n  border-top: 1px solid transparent;\n  border-color: ${({ hasBorder, theme }) =>\n    hasBorder && theme.commonColors.contrastBorder};\n`;\nconst StyledFooterSide = styled.div`\n  display: flex;\n  gap: 0.75rem;\n`;\n\n/**\n * Implements the common layout for window footer, to be used in {@link ModalWindowProps#footer}.\n * Footer has a left and a right side. There is a standard gap between the children of each side.\n */\nexport function WindowFooter({\n  left,\n  right,\n  hasBorder,\n}: {\n  /**\n   * The content to go to the left side the footer. A help icon button is very common on the left side.\n   */\n  left?: React.ReactNode;\n  /**\n   * The content to go to the right side the footer.\n   * {@link Button}s are usually used inside the right content.\n   * A {@link ButtonGroup} is rendered around the content to allow for keyboard navigation with arrow keys.\n   */\n  right?: React.ReactNode;\n  /**\n   * Whether to show top border for footer or not\n   */\n  hasBorder?: boolean;\n}) {\n  return (\n    <StyledFooter hasBorder={hasBorder}>\n      <StyledFooterSide>{left}</StyledFooterSide>\n      <StyledFooterSide>\n        <ButtonGroup>{right}</ButtonGroup>\n      </StyledFooterSide>\n    </StyledFooter>\n  );\n}\n","import React, { HTMLAttributes, useContext } from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\n\nimport { WindowContext } from \"./WindowContext\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nconst StyledWindowTitle = styled.h1`\n  margin: 0;\n  text-align: center;\n  font-size: 13px; // not rem! intentional\n  line-height: 24px; // Double check\n  cursor: default;\n  user-select: none;\n  padding: 0 8px;\n`;\n\n/**\n * Implements appearance of Window header, and also acts as a handle for moving the window.\n * Expected to be used with {@link WindowLayout}:\n *\n * @example\n * ```tsx\n * <ModalWindow>\n *    <WindowLayout header={<WindowHeader>header</WindowHeader>} />\n * </ModalWindow>\n * ```\n */\nexport const WindowHeader = ({ children }: { children?: React.ReactNode }) => {\n  const { movable, titleProps } = useContext(WindowContext);\n  const renderTitle = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledWindowTitle {...mergeProps(titleProps, otherProps)}>\n      {children || <>&nbsp;</>}\n    </StyledWindowTitle>\n  );\n  return movable ? (\n    <OverlayMoveHandle>\n      {({ moveHandleProps }) => renderTitle(moveHandleProps)}\n    </OverlayMoveHandle>\n  ) : (\n    renderTitle()\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport React from \"react\";\nimport { WindowHeader } from \"./WindowHeader\";\nimport { WindowFooter } from \"@intellij-platform/core/ModalWindow/WindowFooter\";\n\nconst StyledWindowFooter = styled.div`\n  min-height: min-content;\n`;\n\nconst StyledWindowContentWrapper = styled.div`\n  overflow: auto;\n  flex: 1;\n`;\n\n/**\n * Window content layout, supporting fixed `header` and `footer` sections, and a scrollable `content` area.\n */\nexport function WindowLayout({\n  header,\n  footer,\n  content,\n}: {\n  /**\n   * Fixed position header of the window at the top. Use {@link WindowLayout.Header} for the default window header,\n   * which also acts as a move handle for the window. If a string is passed, it will be wrapped by\n   * {@link WindowLayout.Header} automatically.\n   */\n  header: React.ReactNode;\n  /**\n   * Scrollable content of the window.\n   */\n  content: React.ReactNode;\n  /**\n   * An area at the bottom of the window which is not scrolled as opposed to `content`. Use {@link WindowLayout.Footer}\n   * for rendering the common layout of a window footer.\n   */\n  footer?: React.ReactNode;\n}) {\n  return (\n    <>\n      {header &&\n        (typeof header === \"string\" ? (\n          <WindowHeader>{header}</WindowHeader>\n        ) : (\n          header\n        ))}\n      <StyledWindowContentWrapper>{content}</StyledWindowContentWrapper>\n      {footer && <StyledWindowFooter>{footer}</StyledWindowFooter>}\n    </>\n  );\n}\n\n// Just for improved discoverability. Might as well export WindowFooter and WindowHeader instead.\nWindowLayout.Footer = WindowFooter;\nWindowLayout.Header = WindowHeader;\n","import React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  ModalWindow,\n  ModalWindowProps,\n  WindowControllerContext,\n} from \"./ModalWindow\";\n\nexport interface WindowManagerAPI {\n  /**\n   * Shows a modal window within the stack of windows managed by {@link WindowManager}.\n   * The opened windows will be closed when `onClose` interactions happen.\n   * Returns a Promise which is resolved when the modal window is closed.\n   *\n   * Modal window element, or a function that returns the modal window element can\n   * be passed.\n   * If a function is passed, it will receive a close function in its object argument,\n   * which can be used to resolve the returned promise with.\n   *\n   * @example\n   *\n   * ```\n   * const windowManager = useWindowManager();\n   *\n   * const showWindow = () => {\n   *   windowManager\n   *     .open<boolean>(({ close }) => (\n   *       <ModalWindow>\n   *         <WindowLayout\n   *           header=\"...\"\n   *           content={<>...</>}\n   *           footer={\n   *             <WindowLayout.Footer\n   *               right={\n   *                 <>\n   *                   <Button onPress={close}>Cancel</Button>\n   *                   <Button onPress={() => close(true)}>Ok</Button>\n   *                 </>\n   *               }\n   *             />\n   *           }\n   *         />\n   *       </ModalWindow>\n   *     ))\n   *     .then((confirmed) => alert(`confirmed: ${confirmed ?? false}`));\n   * };\n   * ```\n   */\n  open<T>(\n    props:\n      | React.ReactElement<ModalWindowProps, typeof ModalWindow>\n      | ((args: {\n          close: (result?: T) => void;\n        }) => React.ReactElement<ModalWindowProps, typeof ModalWindow>)\n  ): Promise<T | undefined>;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\n    \"WindowManager not found. Wrap your application with WindowManager to be able to open windows imperatively\"\n  );\n};\n\nconst WindowsContext = React.createContext<WindowManagerAPI>({\n  open: NotImplementedFn,\n});\n\n/**\n * Returns imperative API for showing windows.\n *\n */\nexport const useWindowManager = (): WindowManagerAPI =>\n  useContext(WindowsContext);\n\ntype WindowElement = ReactElement<ModalWindowProps, typeof ModalWindow>;\n\nexport interface WindowManagerProps {\n  children?: ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link useWindowManager}) for opening windows.\n * It renders windows in a portal appended to `body`, unless `disablePortal` is `true`.\n *\n */\nexport const WindowManager: React.FC<WindowManagerProps> = ({ children }) => {\n  const [windows, setWindows] = useState<Array<WindowElement>>([]);\n  const newKeyRef = useRef<number>(0);\n\n  const api = useMemo<WindowManagerAPI>(() => {\n    return {\n      open: function <T>(content: Parameters<WindowManagerAPI[\"open\"]>[0]) {\n        return new Promise<T | undefined>((resolve) => {\n          newKeyRef.current++;\n          const close = (result?: T) => {\n            setWindows((currentWindows) =>\n              currentWindows.filter((aWindow) => aWindow !== window)\n            );\n            // Make sure (?) to resolve the promise after the dialog is closed,\n            // for the focus to be restored to the previous element before the\n            // potential further actions take place.\n            requestAnimationFrame(() => {\n              resolve(result);\n            });\n          };\n          const window = (\n            <WindowControllerContext.Provider\n              value={{\n                onClose: () => {\n                  close();\n                },\n              }}\n              key={newKeyRef.current}\n            >\n              {typeof content === \"function\"\n                ? // @ts-expect-error close signature is not correctly inferred\n                  content({ close })\n                : content}\n            </WindowControllerContext.Provider>\n          );\n          setWindows((currentWindows) => currentWindows.concat(window));\n        });\n      },\n    };\n  }, []);\n\n  return (\n    <WindowsContext.Provider value={api}>\n      {children}\n      {windows}\n    </WindowsContext.Provider>\n  );\n};\n","import React, { useContext, useRef } from \"react\";\nimport { Overlay as AriaOverlay, OverlayProps } from \"@react-aria/overlays\";\n\nconst ParentOverlayContext = React.createContext<HTMLElement | null>(null);\n\n/**\n * A (drop-in replacement) wrapper around Overlay, which makes sure overlays created in nested\n * react components will be ported to the same top level container. This is especially useful to detect\n * \"outside clicks\" when overlays are nested. The most common example would be nested menu in popup.\n *\n */\nexport function Overlay({\n  children,\n  OverlayComponent = AriaOverlay,\n}: {\n  children: React.ReactNode;\n  OverlayComponent?: React.ComponentType<OverlayProps>;\n}) {\n  const root = useContext(ParentOverlayContext);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  if (root) {\n    return (\n      <OverlayComponent portalContainer={root}>{children}</OverlayComponent>\n    );\n  }\n  return (\n    <ParentOverlayContext.Provider value={containerRef.current}>\n      <OverlayComponent>\n        <div ref={containerRef} data-overlay-root=\"\">\n          {children}\n        </div>\n      </OverlayComponent>\n    </ParentOverlayContext.Provider>\n  );\n}\n\n/**\n * Returns true, if element1 and element2 are in nested overlays. \"Nested\" being in terms of React component tree.\n * Useful for detecting \"outside click\" when overlay components are nested in each other.\n */\nexport function areInNestedOverlays(\n  element1: Element | null,\n  element2: Element | null\n) {\n  const overlayRoot1 = element1?.closest(\"[data-overlay-root]\");\n  const overlayRoot2 = element2?.closest(\"[data-overlay-root]\");\n  return Boolean(overlayRoot1) && overlayRoot1 === overlayRoot2;\n}\n","import React, { useContext } from \"react\";\n\nexport type Bounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * TODO(docs): add a few words about this abstraction and it's use.\n */\nexport type OverlayInteractionHandlerProps = {\n  /**\n   * Signals start of a UI interaction like resize or move, in which overlay bounds change.\n   */\n  startInteraction: (type: \"move\" | \"resize\") => Bounds;\n  /**\n   * Used to update bounds state during a UI interaction.\n   */\n  updateBounds: (bounds: Bounds) => void;\n  /**\n   * Signals end of a UI interaction.\n   */\n  finishInteraction: () => void;\n\n  minWidth?: number;\n  minHeight?: number;\n};\n\nconst OverlayInteractionHandlerContext =\n  React.createContext<OverlayInteractionHandlerProps | null>(null);\n\n/**\n * Provides the context used by components like {@link OverlayMoveHandle} and {@link OverlayResizeHandles} that provide\n * user interactions that change the boundary of the overlay they are rendered in.\n * Use {@link useResizableMovableOverlay} which implements an efficient state management for overlay bounds and returns\n * props to be passed to `OverlayInteractionHandler`:\n *\n * @example\n *\n * const {\n *    bounds, // Bounds to be applied to the overlay element.\n *    overlayInteractionHandlerProps,\n *  } = useResizableMovableOverlay(props);\n *\n * return (\n *   <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n *     <div style={bounds}>...</div>\n *   </OverlayInteractionHandler>\n * );\n *\n * @see useResizableMovableOverlay\n */\nexport const OverlayInteractionHandler = ({\n  children,\n  ...props\n}: OverlayInteractionHandlerProps & { children: React.ReactNode }) => {\n  return (\n    <OverlayInteractionHandlerContext.Provider value={props}>\n      {children}\n    </OverlayInteractionHandlerContext.Provider>\n  );\n};\n\nexport const useOverlayInteractionHandler = () =>\n  useContext(OverlayInteractionHandlerContext);\n","import { useMove, UseMoveOptions } from \"../utils/interaction-utils/useMove\";\nimport { useOverlayInteractionHandler } from \"./OverlayInteractionHandler\";\nimport React from \"react\";\n\nexport type UseOverlayMoveHandleOptions = Omit<\n  UseMoveOptions<unknown>,\n  \"onMoveStart\" | \"onMove\" | \"onMoveEnd\"\n>;\n/**\n * Used for making a dom element a move handle for the overlay it's being rendered in.\n * It uses the context provided by {@link OverlayInteractionHandler}, and returns props to be applied on a dom element to\n * make it a move handle for the overlay it's being rendered in.\n *\n * @see OverlayMoveHandle\n */\nexport function useOverlayMoveHandle(options?: UseOverlayMoveHandleOptions) {\n  const interactionHandler = useOverlayInteractionHandler();\n  if (!interactionHandler) {\n    return { moveHandleProps: {} };\n  }\n  const { finishInteraction, startInteraction, updateBounds } =\n    interactionHandler;\n\n  const moveProps = useMove({\n    ...options,\n    onMoveStart: () => {\n      return startInteraction(\"move\");\n    },\n    onMove: ({ startState, movement }) => {\n      updateBounds({\n        ...startState,\n        top: startState.top + movement.y,\n        left: startState.left + movement.x,\n      });\n    },\n    onMoveEnd: () => {\n      finishInteraction();\n    },\n  });\n  return { moveHandleProps: moveProps || {} };\n}\n\n/**\n * Used for making a dom element a move handle for the overlay it's being rendered in.\n * It uses the context provided by {@link OverlayInteractionHandler}. A render function is expected as `children`. It's\n * passed the event handlers that need to be applied on a dom element to make it a move handle for the overlay it's\n * being rendered in.\n */\nexport const OverlayMoveHandle = ({\n  children,\n  ...props\n}: {\n  children: (\n    props: ReturnType<typeof useOverlayMoveHandle>\n  ) => React.ReactElement;\n} & UseOverlayMoveHandleOptions) => {\n  return children(useOverlayMoveHandle(props));\n};\n","import React, { useRef } from \"react\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport {\n  HorizontalResizerProps,\n  VerticalResizerProps,\n} from \"../Resizer/ResizerProps\";\nimport {\n  Bounds,\n  useOverlayInteractionHandler,\n} from \"./OverlayInteractionHandler\";\n\ntype OverlayResizeHandlesProps = {\n  minWidth?: number;\n  minHeight?: number;\n};\n\n/**\n * Renders invisible resize handles at the edges of the overlay it's rendered in. It uses the context provided by\n * {@link OverlayInteractionHandler} to resize the overlay when the handles are used.\n */\nexport function OverlayResizeHandles(props: OverlayResizeHandlesProps) {\n  const overlayResizer = useOverlayResizer(props);\n  return (\n    overlayResizer && (\n      <>\n        <RightResizer {...overlayResizer.getResizerProps(\"right\")} />\n        <LeftResizer {...overlayResizer.getResizerProps(\"left\")} />\n        <TopResizer {...overlayResizer.getResizerProps(\"top\")} />\n        <BottomResizer {...overlayResizer.getResizerProps(\"bottom\")} />\n      </>\n    )\n  );\n}\n\n/**\n * overlay resizing logic and state. When resizing is in progress, the source of truth is a local state, for performance\n * reasons. When the resize is done (e.g. by mouse being released), `onBoundsChange` is called with the new bounds.\n */\nfunction useOverlayResizer(props: OverlayResizeHandlesProps = {}) {\n  const initialBoundsRef = useRef<Bounds>({\n    top: 0,\n    height: 0,\n    width: 0,\n    left: 0,\n  });\n  const interactionHandler = useOverlayInteractionHandler();\n  const {\n    minWidth = interactionHandler?.minWidth ?? 1,\n    minHeight = interactionHandler?.minHeight ?? 1,\n  } = props;\n  if (!interactionHandler) {\n    return null;\n  }\n  const { finishInteraction, startInteraction, updateBounds } =\n    interactionHandler;\n\n  const onResize = {\n    right: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        width: Math.max(minWidth, initialBoundsRef.current.width + size),\n      }),\n    bottom: (size: number) =>\n      updateBounds({\n        ...initialBoundsRef.current,\n        height: Math.max(minHeight, initialBoundsRef.current.height + size),\n      }),\n    left: (size: number) => {\n      const newWidth = Math.max(\n        minWidth,\n        initialBoundsRef.current.width + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        left: initialBounds.left + initialBounds.width - newWidth,\n        width: newWidth,\n      });\n    },\n    top: (size: number) => {\n      const newHeight = Math.max(\n        minHeight,\n        initialBoundsRef.current.height + size\n      );\n      const initialBounds = initialBoundsRef.current;\n      return updateBounds({\n        ...initialBounds,\n        top: initialBounds.top + initialBounds.height - newHeight,\n        height: newHeight,\n      });\n    },\n  };\n\n  function getResizerProps(side: \"left\" | \"right\"): HorizontalResizerProps;\n  function getResizerProps(side: \"top\" | \"bottom\"): VerticalResizerProps;\n  function getResizerProps(\n    side: \"left\" | \"right\" | \"top\" | \"bottom\"\n  ): HorizontalResizerProps | VerticalResizerProps {\n    const horizontal = side === \"left\" || side === \"right\";\n    return {\n      size: 1,\n      cursor: horizontal ? \"ew\" : \"ns\",\n      onResizeStarted: () => {\n        initialBoundsRef.current = startInteraction(\"resize\");\n      },\n      onResize: onResize[side],\n      onResizeEnd: finishInteraction,\n      style: { position: \"absolute\", [side]: 0 },\n    };\n  }\n\n  return {\n    getResizerProps,\n  };\n}\n","import React, { ForwardedRef } from \"react\";\nimport {\n  AriaPopoverProps,\n  DismissButton,\n  Overlay,\n  usePopover,\n} from \"@react-aria/overlays\";\nimport { OverlayTriggerState } from \"@react-stately/overlays\";\n\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\n\nimport { styled } from \"../styled\";\nimport { useObjectRef } from \"@react-aria/utils\";\n\nexport interface PopoverProps extends Omit<AriaPopoverProps, \"popoverRef\"> {\n  children: React.ReactNode;\n  state: OverlayTriggerState;\n}\n\nconst StyledPopover = styled.div`\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\nexport const Popover = React.forwardRef(function Popover(\n  { children, state, offset = 8, ...props }: PopoverProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n) {\n  const popoverRef = useObjectRef(forwardedRef);\n  const { popoverProps } = usePopover(\n    {\n      ...props,\n      offset,\n      popoverRef,\n    },\n    state\n  );\n\n  return (\n    <Overlay>\n      {/* Rendering underlay doesn't seem necessary based on the reference impl */}\n      <StyledPopover {...popoverProps} ref={popoverRef}>\n        <DismissButton onDismiss={state.close} />\n        {children}\n        <DismissButton onDismiss={state.close} />\n      </StyledPopover>\n    </Overlay>\n  );\n});\n","import { Bounds } from \"@intellij-platform/core/Overlay/OverlayInteractionHandler\";\nimport { clamp } from \"ramda\";\nimport { ResizableMovableOverlayOptions } from \"@intellij-platform/core/Overlay/useResizableMovableOverlay\";\n\nexport const withMinSize =\n  ({ width: minWidth, height: minHeight }: { width: number; height: number }) =>\n  (bounds: Bounds) => {\n    const width = Math.max(minWidth, bounds.width);\n    const height = Math.max(minHeight, bounds.height);\n    if (bounds.width != width || bounds.height != height) {\n      return { ...bounds, width, height };\n    }\n    return bounds;\n  };\n\nexport function getCenteredBounds(width: number, height: number): Bounds {\n  return {\n    left: (window.innerWidth - width) / 2,\n    top: (window.innerHeight - height) / 2,\n    width,\n    height,\n  };\n}\n\n/**\n * A helper function to create interaction interceptor which ensures bounds are contained within a container.\n *\n * @example\n * const ensureInViewPort = containedWithin({left: 0, top: 0, width: window.innerWidth, height: window.innerHeight})\n *\n * useResizableMovableOverlay({ onBoundsChanging: ensureInViewPort});\n */\nexport const containedWithin =\n  (\n    containerBounds: Bounds\n  ): ResizableMovableOverlayOptions[\"onBoundsChanging\"] =>\n  (bounds, interactionType) => {\n    if (interactionType === \"move\") {\n      const left = clamp(\n        containerBounds.left,\n        containerBounds.left + containerBounds.width - bounds.width,\n        bounds.left\n      );\n      const top = clamp(\n        containerBounds.top,\n        containerBounds.top + containerBounds.height - bounds.height,\n        bounds.top\n      );\n      return {\n        ...bounds,\n        left,\n        top,\n      };\n    } else if (interactionType === \"resize\") {\n      const left = Math.max(containerBounds.left, bounds.left);\n      const top = Math.max(containerBounds.top, bounds.top);\n      // the logic here seems unnecessarily complicated\n      return {\n        left,\n        top,\n        width:\n          bounds.width -\n          Math.max(\n            0,\n            bounds.left +\n              bounds.width -\n              (containerBounds.left + containerBounds.width)\n          ) -\n          (left - bounds.left),\n        height:\n          bounds.height -\n          Math.max(\n            0,\n            bounds.top +\n              bounds.height -\n              (containerBounds.top + containerBounds.height)\n          ) -\n          (top - bounds.top),\n      };\n    }\n    return bounds;\n  };\nexport const position =\n  ({\n    targetElement,\n    placement = \"bottom\",\n  }: {\n    placement?: \"bottom\" | \"top\";\n    targetElement: HTMLElement;\n  }) =>\n  ({ height, width }: Bounds): Bounds => {\n    const targetBounds = targetElement.getBoundingClientRect();\n    return {\n      left: targetBounds.left,\n      top:\n        placement === \"bottom\"\n          ? targetBounds.top + targetBounds.height\n          : targetBounds.top - height,\n      width,\n      height,\n    };\n  };\n\nexport function ensureInViewport(\n  bounds: Bounds,\n  { gap = 0 }: { gap?: number } = {}\n): Bounds {\n  const viewportWidth = window.innerWidth - gap;\n  const viewportHeight = window.innerHeight - gap;\n  const left = clamp(gap, viewportWidth - bounds.width, bounds.left);\n  const top = clamp(gap, viewportHeight - bounds.height, bounds.top);\n  if (left !== bounds.left || top !== bounds.top) {\n    return {\n      left,\n      top,\n      width: bounds.width,\n      height: bounds.height,\n    };\n  }\n  return bounds;\n}\n","import { useCallback, useEffect, useLayoutEffect, useRef } from \"react\";\n\nexport const useDebouncedCallback = (\n  fn: () => void,\n  { timeout = 100 } = {}\n) => {\n  const fnRef = useRef(fn);\n  const currentTimeoutId = useRef<number | null>(null);\n  useLayoutEffect(() => {\n    fnRef.current = fn;\n  });\n  useEffect(() => {\n    return () => {\n      if (currentTimeoutId.current !== null) {\n        clearTimeout(currentTimeoutId.current);\n      }\n    };\n  }, []);\n  return useCallback(() => {\n    if (currentTimeoutId.current !== null) {\n      clearTimeout(currentTimeoutId.current);\n    }\n    currentTimeoutId.current = window.setTimeout(fnRef.current, timeout);\n  }, []);\n};\n","import { RefObject, useEffect, useLayoutEffect, useState } from \"react\";\nimport { useDebouncedCallback } from \"@intellij-platform/core/utils/useDebounce\";\n\n/**\n * Clones the element, applies the temporary styles, and calls {@param fn} on the clone.\n * Previously, we applied the temporary styles on the element itself, run fn, and then revert to previous styles,\n * but that can mess with the scroll bar in the content. If there is a scrollable part in some nested element,\n * applying temporary style (in our case width: fit-content, height: fit-content) can cause scroll to jump which is not\n * restored after the style reversion. Now the approach is changed to apply the temporary styles on a temporary clone\n * of the element. It's certainly not as efficient and some optimization may be needed.\n * @param style: temporary styles to apply before fn is invoked, and revert after.\n * @param fn the function to compute something on the element with temporary styles\n */\nconst withTemporaryStyle =\n  <T extends any>(\n    style: Partial<CSSStyleDeclaration>,\n    fn: (element: HTMLElement) => T\n  ) =>\n  (element: HTMLElement): T => {\n    const clone = element.cloneNode(true) as HTMLElement;\n    clone.style.position = \"absolute\";\n    clone.style.left = \"-9999px\";\n    document.body.appendChild(clone);\n\n    Object.assign(clone.style, style);\n    const returnValue = fn(clone);\n\n    document.body.removeChild(clone);\n    return returnValue;\n  };\n\n/**\n * FIXME: withTemporaryStyle is not side-effect free and can cause scroll jumps. It creates awfully hard-to-debug\n *  issues.\n */\nexport const getContentSize = withTemporaryStyle(\n  {\n    width: \"\",\n    minWidth: \"fit-content\", // Shouldn't it be min-content? :-?\n    height: \"\",\n    minHeight: \"fit-content\",\n  },\n  (element) => ({\n    width: Math.ceil(parseFloat(getComputedStyle(element).width)),\n    height: Math.ceil(parseFloat(getComputedStyle(element).height)),\n  })\n);\n\nexport const useContentSize = (\n  ref: RefObject<HTMLElement>,\n  {\n    observe = false,\n  }: {\n    /**\n     * if false, the content size is measured only initially. If true, the dom changes are observed, and content size\n     * is updated accordingly.\n     * @default false\n     */\n    observe?: boolean;\n  } = {}\n) => {\n  const [measuredSizes, setMeasuredSizes] = useState<Size[]>([]);\n  useLayoutEffect(() => {\n    const element = ref.current;\n    if (!element || measuredSizes.length > 5) {\n      return;\n    }\n    const size = getContentSize(element);\n\n    const lastMeasuredSize = measuredSizes.at(-1);\n    if (!lastMeasuredSize || !Size.isEqual(lastMeasuredSize, size)) {\n      setMeasuredSizes([size]);\n    }\n    const id = window.requestAnimationFrame(() => {\n      const newSize = getContentSize(element);\n      if (!Size.isEqual(newSize, size)) {\n        setMeasuredSizes([...measuredSizes, newSize]);\n      }\n    });\n    return () => {\n      window.cancelAnimationFrame(id);\n    };\n  }, [\n    measuredSizes,\n    // ref value shouldn't normally be an effect's dependency, but for some reason, ref value is null in the first call\n    // when built for website. Interestingly, it doesn't happen in storybook. So maybe something to investigate further\n    ref.current,\n  ]);\n  const measure = () => {\n    const lastMeasuredSize = measuredSizes.at(-1);\n    if (ref.current && lastMeasuredSize) {\n      const currentSize = getContentSize(ref.current);\n      if (\n        currentSize.height !== lastMeasuredSize.height ||\n        currentSize.width !== lastMeasuredSize.width\n      ) {\n        setMeasuredSizes(\n          measuredSizes.map((aSize) =>\n            aSize === lastMeasuredSize ? currentSize : aSize\n          )\n        );\n      }\n    }\n  };\n  const debouncedMeasure = useDebouncedCallback(measure);\n\n  useEffect(() => {\n    const element = ref.current;\n    if (observe && element) {\n      const mutationObserver = new MutationObserver(() => {\n        debouncedMeasure();\n      });\n      mutationObserver.observe(element, {\n        subtree: true,\n        childList: true,\n      });\n      return () => {\n        mutationObserver.disconnect();\n      };\n    }\n  }, [\n    observe,\n    // ref value shouldn't normally be an effect's dependency, but for some reason, ref value is null in the first call\n    // when built for website. Interestingly, it doesn't happen in storybook. So maybe something to investigate further\n    ref.current,\n  ]);\n  return [measuredSizes.at(-1) || { width: 0, height: 0 }, measure] as const;\n};\n\ninterface Size {\n  width: number;\n  height: number;\n}\n// eslint-disable-next-line @typescript-eslint/no-redeclare\nexport const Size = {\n  isEqual: (\n    { width, height }: Size,\n    { width: width2, height: height2 }: { width: number; height: number }\n  ) => width === width2 && height === height2,\n};\n","import { RefObject, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  Bounds,\n  OverlayInteractionHandler,\n  OverlayInteractionHandlerProps,\n} from \"./OverlayInteractionHandler\";\nimport { clamp, filter } from \"ramda\";\nimport { useContentSize } from \"@intellij-platform/core/Overlay/useContentSize\";\nimport {\n  getCenteredBounds,\n  withMinSize,\n} from \"@intellij-platform/core/Overlay/bounds-helpers\";\n\n/**\n * Common props for resizable and movable overlays such as Windows or Popups.\n * There is currently no corresponding component/hook, and this is just a type helper.\n */\nexport interface ResizableMovableOverlayOptions {\n  onBoundsChange?: (bounds: Bounds, interactionType: \"move\" | \"resize\") => void;\n  /**\n   * For performance reason, overlay bounds is kept in a local state during a resize or move interaction, and\n   * `onBoundsChange` is called once at the end of interaction. `onBoundsChanging` gives a chance of rectifying\n   * bounds changes during an interaction to for example apply custom size/placement constraints.\n   */\n  onBoundsChanging?: (\n    newBounds: Bounds,\n    /**\n     * Whether the interaction is a \"move\" or \"resize\" considering the initial bounds when interaction was started.\n     */\n    interactionType: \"move\" | \"resize\"\n  ) => Bounds;\n  /**\n   * Controlled bounds. Can be a partially specified bounds.\n   * - If `top` not specified, the returned bounds will be centered vertically.\n   * - If `left` not specified, the returned bounds will be centered horizontally.\n   * - If `width` not specified, the width of the bounds will be based on content width.\n   * - If `height` not specified, the height of the bounds will be based on content height.\n   * Note that regardless of `bounds`, `onBoundsChange` always receives a full `bounds` object which is solely\n   * based on the bounds of the overlay, at the end of an interaction.\n   */\n  bounds?: Partial<Bounds>;\n  /**\n   * Default bounds in uncontrolled mode. Can be a partially specified bounds.\n   * - If `top` not specified, the returned bounds will be centered vertically.\n   * - If `left` not specified, the returned bounds will be centered horizontally.\n   * - If `width` not specified, the width of the bounds will be based on content width.\n   * - If `height` not specified, the height of the bounds will be based on content height.\n   * Note that regardless of `defaultBounds`, `onBoundsChange` always receives a full `bounds` object which is solely\n   * based on the bounds of the overlay, at the end of an interaction.\n   */\n  defaultBounds?: Partial<Bounds>;\n  minWidth?: number | \"content\"; // TODO: support function, receiving measured size, for more flexibility\n  minHeight?: number | \"content\"; // TODO: support function, receiving measured size, for more flexibility\n\n  /**\n   * Allowed interactions:\n   * - \"all\": both resizable and movable\n   * - \"move\": movable, but not resizable\n   * - \"none\": fixed size and position\n   * The reason there are no `resizable` and `movable` boolean props is that resizable=true,movable=false doesn't make\n   * sense from UX perspective.\n   * @default \"all\"\n   */\n  interactions?: \"all\" | \"move\" | \"none\"; // FIXME: it's not used in useResizableMovableOverlay, maybe separate props?\n\n  /**\n   * When the size is not specified by `bounds` or `defaultBounds` props, the content size is measured and used in the\n   * returned bounds. By default, the content size is measured initially. If `observeContentSize` is true, the DOM\n   * mutations will be observed and the content is re-measured as changes are observed.\n   */\n  observeContentResize?: boolean;\n}\n/**\n *\n * TODO: rename to something better? :D\n * TODO: maybe an option like ensureInViewport that would move the final bound into the viewport (if necessary), when\n *  calling onBoundsChange at the end of an interaction. That's important because if move handle(s) (usually rendered\n *  at the top of the overlay) are out of reach, there would be no way back.\n * TODO: description\n * Assumptions:\n * - The overlay is rendered in a portal, and with position \"fixed\".\n * - The returned bounds should be used to style the overlay.\n *   - There shouldn't be other style affecting the positioning, such as margin, or transform.\n *   - If the overlay has border, box-sizing should be \"border-box\"\n */\nexport function useResizableMovableOverlay(\n  overlayRef: RefObject<HTMLElement>,\n  {\n    bounds: inputBounds,\n    defaultBounds,\n    onBoundsChange,\n    onBoundsChanging = (i) => i,\n    minWidth,\n    minHeight,\n    observeContentResize,\n  }: ResizableMovableOverlayOptions\n): {\n  /**\n   * The bounds to be applied as `style` on the overlay, to position it. Even if the input `bounds` or `defaultBounds`\n   * is not defined, returned `bounds` is always a full bounds object. This eliminates any other need for styling,\n   * if the input bounds doesn't define size or position.\n   * NOTE: even when the size is not specified as input, and is to be based on content, the returned `bounds` include\n   * explicit, size, measured **after the first render**. This is because overlays such as windows are not expected to\n   * be resized without user interaction, and just based on the content size change. So we make sure even when the\n   * sizing is based on content, it's stable. If imperative re-measure of the size is needed, or even dynamic resizing\n   * based on content is needed in some cases, it is feasible to add it as an option.\n   */\n  bounds: Bounds;\n  /**\n   * `true` if the returned bounds has explicit position. `false` if it's centered as a fallback.\n   */\n  positioned: boolean;\n  /**\n   * `true` if the returned bounds has explicit size. `false` if it's measured based on content.\n   */\n  sized: boolean;\n  /**\n   * Props to be passed to {@link OverlayInteractionHandler}\n   */\n  overlayInteractionHandlerProps: OverlayInteractionHandlerProps;\n\n  /**\n   * Allow for remeasuring content size imperatively, when needed. Currently only used to work around\n   * an issue related to Suspense in React 17.\n   */\n  UNSAFE_measureContentSize: () => void;\n} {\n  const [bounds, setBounds] = useControlledState<Partial<Bounds> | undefined>(\n    inputBounds,\n    defaultBounds!,\n    // onBoundsChange is called with Bounds object. Not Partial<Bounds>, and not undefined.\n    onBoundsChange as (\n      value: Partial<Bounds> | undefined,\n      reason: \"resize\" | \"move\"\n    ) => void\n  );\n  const [contentSize, measureContentSize] = useContentSize(overlayRef, {\n    observe: observeContentResize,\n  });\n  // local state of bounds for when the overlay is in a UI interaction, like movement or resize with mouse.\n  // We don't want to update the state in the higher levels repeatedly in such transactions, and we just want to\n  // trigger on update when the UI interaction is done.\n  // It's maintained during a UI interaction and then reset to null.\n  const [currentInteraction, setCurrentInteraction] = useState<null | {\n    type: \"move\" | \"resize\";\n    bounds: Bounds;\n  }>(null);\n\n  const effectiveMinWidth =\n    minWidth === \"content\" ? contentSize.width : minWidth || 0;\n  const effectiveMinHeight =\n    minHeight === \"content\" ? contentSize.height : minHeight || 0;\n  const applyMinSize = withMinSize({\n    width: effectiveMinWidth,\n    height: effectiveMinHeight,\n  });\n  const overlayInteractionHandlerProps: OverlayInteractionHandlerProps = {\n    startInteraction: (type: \"move\" | \"resize\") => {\n      if (!overlayRef.current) {\n        throw new Error(\n          \"overlayRef value is not set. Make sure to have the ref passed to the resizable/movable overlay\"\n        );\n      }\n      const bounds = getBounds(overlayRef.current);\n      setCurrentInteraction({ bounds, type });\n      return bounds;\n    },\n    updateBounds: (updatedBounds) => {\n      setCurrentInteraction((currentInteraction) => {\n        if (currentInteraction) {\n          const { type } = currentInteraction;\n          return {\n            type,\n            bounds: onBoundsChanging(updatedBounds, type) || updatedBounds,\n          };\n        }\n        return currentInteraction;\n      });\n    },\n    finishInteraction: () => {\n      if (currentInteraction && overlayRef.current) {\n        // @ts-expect-error https://github.com/adobe/react-spectrum/issues/6784\n        setBounds(getBounds(overlayRef.current), currentInteraction.type);\n      }\n      setCurrentInteraction(null);\n    },\n    minWidth: effectiveMinWidth,\n    minHeight: effectiveMinHeight,\n  };\n\n  const partialBounds = currentInteraction?.bounds ?? bounds;\n  const centeredContentBounds = getCenteredBounds(\n    clamp(\n      effectiveMinWidth,\n      window.innerWidth,\n      bounds?.width ?? contentSize.width\n    ),\n    clamp(\n      effectiveMinHeight,\n      window.innerHeight,\n      bounds?.height ?? contentSize.height\n    )\n  );\n  return {\n    positioned:\n      partialBounds?.left != undefined && partialBounds?.top != undefined,\n    sized:\n      partialBounds?.width != undefined && partialBounds?.height != undefined,\n    bounds: applyMinSize({\n      /**\n       * Since input bounds may be partial (e.g. only specifying size), we create a full bounds object as a fallback,\n       * based on the measured size, positioned in center. We can introduce a \"loose\" mode, where the returned bound\n       * is not \"filled\" with default properties.\n       */\n      ...centeredContentBounds,\n      ...(partialBounds && filter((value) => value != null, partialBounds)),\n    }),\n    UNSAFE_measureContentSize: measureContentSize,\n    overlayInteractionHandlerProps,\n  };\n}\n\nfunction getBounds(element: HTMLElement) {\n  const { left, top, width, height } = element.getBoundingClientRect();\n  return { left, top, width, height };\n}\n","import React, { ForwardedRef, RefObject, useContext, useState } from \"react\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { useFocusWithin, useInteractOutside } from \"@react-aria/interactions\";\nimport { FocusScope, useFocusable } from \"@react-aria/focus\";\nimport { useOverlay, usePreventScroll } from \"@react-aria/overlays\";\nimport { filterDOMProps, useObjectRef } from \"@react-aria/utils\";\nimport { pipe } from \"ramda\";\n\nimport {\n  areInNestedOverlays,\n  ensureInViewport,\n  Overlay,\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  position,\n  ResizableMovableOverlayOptions,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { mergeNonNullProps } from \"@intellij-platform/core/utils/mergeNonNullProps\";\nimport { useFocusForwarder } from \"@intellij-platform/core/utils/useFocusForwarder\";\n\nimport { useDialog } from \"./_useDialog\";\nimport { PopupHeader } from \"./PopupHeader\";\nimport { PopupContext, PopupControllerContext } from \"./PopupContext\";\nimport { PopupLayout } from \"./PopupLayout\";\nimport { StyledPopupHint } from \"./StyledPopupHint\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\n/**\n * only needed for setting overflow to hidden to make sure nothing will overflow a window under any circumstances.\n * The reason we can't set that overflow: \"hidden\" on the StyledWindowContainer itself is that we want resize handles\n * to overflow without bing clipped.\n */\nconst StyledInnerContainer = styled.div`\n  height: inherit;\n  overflow: hidden;\n`;\nexport interface PopupProps extends ResizableMovableOverlayOptions, DOMProps {\n  children: React.ReactNode;\n  onClose?: () => void;\n\n  nonDismissable?: boolean;\n\n  /**\n   * By default, Popup prevents scrolling on the scrollable ancestor, if popup is positioned relative to a target\n   * element. Allowing or disallowing scroll can be forced by passing boolean value.\n   */\n  allowScroll?: \"auto\" | boolean;\n\n  /**\n   * Used to position the popup relative to a target element, if there is no positioning information in the input\n   * `bounds`/`defaultBounds`.\n   */\n  positioning?: {\n    targetRef: RefObject<HTMLElement>;\n    placement?: \"bottom\" | \"top\";\n  };\n}\n\nexport const DEFAULT_POPUP_MIN_WIDTH = 50;\nexport const DEFAULT_POPUP_MIN_HEIGHT = 50;\n\n/**\n * [Popup](https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-%28Community%29?node-id=75426%3A16881&t=vzpRGV2y2cDw5a6Z-0)\n * component, rendered as a draggable overlay which is positioned either in the center of the viewport or relative to a trigger element.\n * If there is a trigger element, use {@link PopupTrigger} instead.\n */\nexport const _Popup = (\n  // NOTE: export is only for __docgenInfo to be emitted for this.\n  {\n    interactions = \"move\",\n    nonDismissable = false,\n    allowScroll = \"auto\",\n    minWidth = DEFAULT_POPUP_MIN_WIDTH,\n    minHeight = DEFAULT_POPUP_MIN_HEIGHT,\n    positioning: positioningProp,\n    onClose: onCloseProp,\n    ...props\n  }: PopupProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element => {\n  const propsContext = useContext(PopupControllerContext);\n  const positioning = positioningProp || propsContext.positioning;\n  const onClose = () => {\n    onCloseProp?.();\n    propsContext.onClose?.();\n  };\n  const ref = useObjectRef<HTMLDivElement>(forwardedRef);\n  const shouldCloseOnInteractOutside = (element: Element) => {\n    return (\n      !positioning?.targetRef.current?.contains(element) &&\n      !areInNestedOverlays(ref.current, element)\n    );\n  };\n  const { overlayProps } = useOverlay(\n    {\n      isOpen: true, // FIXME?\n      onClose,\n      shouldCloseOnBlur: !nonDismissable,\n      shouldCloseOnInteractOutside,\n    },\n    ref\n  );\n  // Passing isDismissable to useOverlay also utilizes useInteractOutside and closes the overlay, but it calls\n  // preventDefault() and stopPropagation() on the event, which prevents focus from going to elements outside the popup.\n  // Not sure why they do this in react-aria, but it seems we are better off not using that option and using\n  // useInteractOutside directly here like this:\n  useInteractOutside({\n    ref,\n    onInteractOutsideStart: (e) => {\n      if (\n        !nonDismissable &&\n        shouldCloseOnInteractOutside(e.target as Element)\n      ) {\n        onClose();\n      }\n    },\n    // onInteractOutsideStart will not be called if onInteractOutside is not passed!\n    onInteractOutside: () => {},\n  });\n\n  usePreventScroll({\n    isDisabled: allowScroll === \"auto\" ? !positioning : allowScroll,\n  });\n\n  const { bounds, positioned, overlayInteractionHandlerProps } =\n    useResizableMovableOverlay(ref, {\n      ...props,\n      minWidth,\n      minHeight,\n      observeContentResize: true,\n    });\n  const positionedBounds =\n    positioning?.targetRef.current && !positioned\n      ? pipe(\n          position({\n            targetElement: positioning.targetRef.current,\n            placement: positioning.placement,\n          }),\n          ensureInViewport\n        )(bounds)\n      : bounds;\n\n  const [isActive, setActive] = useState(false);\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setActive,\n  });\n  const { focusableProps } = useFocusable(\n    {\n      excludeFromTabOrder: true,\n    },\n    ref\n  );\n  const { focusForwarderProps } = useFocusForwarder();\n\n  const { dialogProps, titleProps } = useDialog(props, ref);\n\n  /**\n   * A hook like useOverlayStack or useOverlayZIndex can be introduced which would handle focus/blur, and return/set\n   * the right z-index so that only the overlay holding the focus would have a higher z-index than others.\n   */\n  const zIndex = isActive ? 1 : 0;\n\n  return (\n    <Overlay>\n      <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n        {/* TODO: FocusScope is redundant. Test focus restoration without it (in status bar progress), and remove it if unnecessary */}\n        <FocusScope restoreFocus>\n          <StyledPopupContainer\n            ref={ref}\n            style={{\n              ...positionedBounds,\n              zIndex,\n            }}\n            tabIndex={-1}\n            {...mergeNonNullProps(\n              focusWithinProps,\n              focusableProps,\n              focusForwarderProps,\n              overlayProps,\n              propsContext.overlayProps || {},\n              dialogProps,\n              filterDOMProps(props)\n            )}\n          >\n            <PopupContext.Provider\n              value={{\n                isActive,\n                movable: interactions !== \"none\",\n                titleProps,\n              }}\n            >\n              <StyledInnerContainer>{props.children}</StyledInnerContainer>\n              {interactions === \"all\" && <OverlayResizeHandles />}\n            </PopupContext.Provider>\n          </StyledPopupContainer>\n        </FocusScope>\n      </OverlayInteractionHandler>\n    </Overlay>\n  );\n};\n\nexport const Popup = Object.assign(React.forwardRef(_Popup), {\n  Header: PopupHeader,\n  Layout: PopupLayout,\n  Hint: StyledPopupHint,\n});\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { AriaDialogProps } from \"@react-types/dialog\";\nimport { FocusableElement } from \"@react-types/shared\";\nimport { filterDOMProps, useSlotId } from \"@react-aria/utils\";\nimport { focusSafely } from \"@react-aria/focus\";\nimport { RefObject, useEffect } from \"react\";\nimport { useOverlayFocusContain } from \"@react-aria/overlays\";\nimport { DialogAria } from \"@react-aria/dialog\";\n\n////////////////// NOTE //////////////////////////\n// This is a copy of useDialog from react-aria, with a little part removed from the useEffect call.\n// In the original code, inside the effect, there is a hack to fix an issue in Safari, which involves\n// blurring and refocusing the element. Even though there is a comment about an attempt to make it work\n// nice when used with `shouldCloseOnBlur` option of `useOverlay`, it didn't work and the refocusing causes\n// the popup to close. Probably because in our case useOverlay and useDialog are used in the same level, but\n// in what they've tested on in react-aria, useDialog is used in something nested in the component that uses\n// useDialog.\n// TODO: replace with original useDialog, if the issue explained above got fixed in some version of react-aria.\n//////////////////////////////////////////////////\n/**\n * Provides the behavior and accessibility implementation for a dialog component.\n * A dialog is an overlay shown above other content in an application.\n */\nexport function useDialog(\n  props: AriaDialogProps,\n  ref: RefObject<FocusableElement>\n): DialogAria {\n  let { role = \"dialog\" } = props;\n  let titleId: string | undefined = useSlotId();\n  titleId = props[\"aria-label\"] ? undefined : titleId;\n\n  // Focus the dialog itself on mount, unless a child element is already focused.\n  useEffect(() => {\n    if (ref.current && !ref.current.contains(document.activeElement)) {\n      focusSafely(ref.current);\n    }\n  }, [ref]);\n\n  useOverlayFocusContain();\n\n  return {\n    dialogProps: {\n      ...filterDOMProps(props, { labelable: true }),\n      role,\n      tabIndex: -1,\n      \"aria-labelledby\": props[\"aria-labelledby\"] || titleId,\n    },\n    titleProps: {\n      id: titleId,\n    },\n  };\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport { filter } from \"ramda\";\n\n/**\n * Like mergeProps, but doesn't merge props where value is null or undefined. That's needed because useFocusable (and\n * maybe some other react-aria hooks as well) return props like onFocus, with value set to null or undefined, which\n * overrides the same prop from other sources.\n */\n// @ts-expect-error not sure why!\nexport const mergeNonNullProps: typeof mergeProps = (...propsArray) => {\n  return mergeProps(\n    ...propsArray.map((props): typeof props =>\n      filter((value) => value != undefined, props ?? [])\n    )\n  );\n};\n","import { DOMAttributes } from \"@react-types/shared\";\nimport { createContext } from \"react\";\nimport { PopupProps } from \"./Popup\";\n\nexport const PopupContext = createContext<{\n  isActive: boolean;\n  movable: boolean;\n  titleProps: DOMAttributes;\n}>({ isActive: false, movable: true, titleProps: {} });\n\n/**\n * A context to provide some props that are necessary for PopupTrigger or PopupManager.\n * Passing those props via context helps with providing a nice API in those components.\n */\nexport const PopupControllerContext = createContext<\n  {\n    overlayProps?: DOMAttributes;\n  } & Partial<Pick<PopupProps, \"positioning\" | \"onClose\">>\n>({});\n","import React, { CSSProperties, HTMLAttributes, useContext } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { OverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\n\nimport { PopupContext } from \"./PopupContext\";\n\nconst StyledPopupHeader = styled.div<{\n  active?: boolean;\n  hasControls?: boolean;\n}>`\n  box-sizing: border-box;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 1.5rem;\n  min-height: ${({ hasControls }) => hasControls && \"1.75rem\"};\n  cursor: default;\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"Popup.Header.activeForeground\" as UnknownThemeProp<\"Popup.Header.activeForeground\">,\n          theme.commonColors.labelForeground\n        )\n      : theme.color(\n          \"Popup.Header.inactiveForeground\" as UnknownThemeProp<\"Popup.Header.inactiveForeground\">,\n          theme.commonColors.labelDisabledForeground\n        )};\n  background-color: ${({ theme, active }) =>\n    active\n      ? theme.color(\"Popup.Header.activeBackground\", \"#e6e6e6\")\n      : theme.color(\"Popup.Header.inactiveBackground\", `#ededed`)};\n`;\n/**\n * Implements appearance of\n * [Popup Header](https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-%28Community%29?node-id=75455%3A26566&t=Hzwse5j5R6iCEzVW-4),\n * and also acts as a handle for moving the panel.\n * Expected to be used with {@link Popup#Layout}:\n *\n * @example\n * ```tsx\n * <Popup>\n *    <Popup.Layout header={<Popup.Header>header</Popup.Header>} />\n * </Popup>\n * ```\n */\nexport const PopupHeader = ({\n  children,\n  hasControls,\n  className,\n  style,\n}: {\n  children?: React.ReactNode;\n  hasControls?: boolean;\n  className?: string;\n  style?: CSSProperties;\n}) => {\n  const { isActive, movable, titleProps } = useContext(PopupContext);\n  const renderHeader = (otherProps: HTMLAttributes<HTMLElement> = {}) => (\n    <StyledPopupHeader\n      active={isActive}\n      hasControls={hasControls}\n      className={className}\n      style={style}\n      {...mergeProps(titleProps, otherProps)}\n    >\n      {children}\n    </StyledPopupHeader>\n  );\n  return movable ? (\n    <OverlayMoveHandle>\n      {({ moveHandleProps }) => renderHeader(moveHandleProps)}\n    </OverlayMoveHandle>\n  ) : (\n    renderHeader()\n  );\n};\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { Popup } from \"./Popup\";\nimport { PopupHeader } from \"./PopupHeader\";\nimport { StyledPopupHint } from \"@intellij-platform/core/Popup/StyledPopupHint\";\n\nconst StyledPopupLayout = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n`;\nconst StyledPopupLayoutHeader = styled.div`\n  flex-shrink: 0;\n`;\nconst StyledPopupLayoutContent = styled.div`\n  flex: 1;\n  overflow: auto;\n  // Not sure about making the content area a vertical flex container, but it seemed it makes sense as default.\n  // The use case at hand where this was added was \"Branches\" popup, which would of course be implementable without this\n  // too, with an extra flex container around the menu.\n  display: flex;\n  flex-direction: column;\n`;\nconst StyledPopupLayoutFooter = styled.div`\n  flex-shrink: 0;\n`;\n\n/**\n * Popup content layout, supporting fixed `header` and `footer` sections, and a scrollable `content` area.\n */\nexport function PopupLayout({\n  header,\n  footer,\n  content,\n}: {\n  /**\n   * Fixed position header of the popup at the top. {@link Popup.Header} can be used for the content.\n   */\n  header?: React.ReactNode;\n  /**\n   * Scrollable content of the popup.\n   */\n  content: React.ReactNode;\n  /**\n   * Fixed position footer of the popup at the bottom. {@link Popup.Hint} can be used for the content.\n   */\n  footer?: React.ReactNode;\n}) {\n  return (\n    <StyledPopupLayout>\n      {header && (\n        <StyledPopupLayoutHeader>\n          {typeof header === \"string\" ? (\n            <PopupHeader>{header}</PopupHeader>\n          ) : (\n            header\n          )}\n        </StyledPopupLayoutHeader>\n      )}\n      <StyledPopupLayoutContent>{content}</StyledPopupLayoutContent>\n      {footer && (\n        <StyledPopupLayoutFooter>\n          {typeof footer === \"string\" ? (\n            <StyledPopupHint>{footer}</StyledPopupHint>\n          ) : (\n            footer\n          )}\n        </StyledPopupLayoutFooter>\n      )}\n    </StyledPopupLayout>\n  );\n}\n","import React, {\n  ReactElement,\n  ReactNode,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { Popup, PopupProps } from \"./Popup\";\nimport { PopupControllerContext } from \"@intellij-platform/core/Popup/PopupContext\";\n\nexport interface PopupManagerAPI {\n  /**\n   * Shows a popup within the stack of popups managed by {@link PopupManager}.\n   * The opened popup will be closed when `onClose` interactions happen.\n   */\n  show(\n    popup:\n      | React.ReactElement<PopupProps, typeof Popup>\n      | ((args: {\n          close: () => void;\n        }) => React.ReactElement<PopupProps, typeof Popup>)\n  ): void;\n}\n\nconst NotImplementedFn = () => {\n  throw new Error(\n    \"PopupManager not found. Wrap your application with PopupManager to be able to open popups imperatively\"\n  );\n};\n\nconst PopupsContext = React.createContext<PopupManagerAPI>({\n  show: NotImplementedFn,\n});\n\n/**\n * Returns imperative API for showing popups.\n */\nexport const usePopupManager = (): PopupManagerAPI => useContext(PopupsContext);\n\ntype PopupElement = ReactElement<PopupProps, typeof Popup>;\n\nexport interface PopupManagerProps {\n  children?: ReactNode;\n}\n\n/**\n * Enables imperative API (via {@link usePopupManager}) for showing Popups.\n * It renders popups in a portal appended to `body`, unless `disablePortal` is `true`.\n */\nexport const PopupManager: React.FC<PopupManagerProps> = ({ children }) => {\n  const [popups, setPopups] = useState<Array<PopupElement>>([]);\n  const newKeyRef = useRef<number>(0);\n\n  const api = useMemo<PopupManagerAPI>(() => {\n    const show: PopupManagerAPI[\"show\"] = (popup) => {\n      newKeyRef.current++;\n      const close = () => {\n        setPopups((currentPopups) =>\n          currentPopups.filter((aPopup) => aPopup !== wrappedPopup)\n        );\n      };\n      const wrappedPopup = (\n        <PopupControllerContext.Provider\n          key={newKeyRef.current}\n          value={{ onClose: close }}\n        >\n          {typeof popup === \"function\" ? popup({ close }) : popup}\n        </PopupControllerContext.Provider>\n      );\n      setPopups((currentPopups) => currentPopups.concat(wrappedPopup));\n    };\n    return {\n      show,\n    };\n  }, []);\n\n  return (\n    <PopupsContext.Provider value={api}>\n      {children}\n      {popups}\n    </PopupsContext.Provider>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { OverlayTriggerProps, useOverlayTrigger } from \"@react-aria/overlays\";\nimport { PressResponder } from \"@react-aria/interactions\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport {\n  OverlayTriggerProps as OverlayTriggerStateProps,\n  useOverlayTriggerState,\n} from \"@react-stately/overlays\";\n\nimport { PopupProps } from \"./Popup\";\nimport { PopupControllerContext } from \"./PopupContext\";\n\nexport interface PopupTriggerProps\n  extends Partial<OverlayTriggerProps>,\n    OverlayTriggerStateProps {\n  placement?: Required<PopupProps>[\"positioning\"][\"placement\"];\n  popup:\n    | React.ReactElement\n    | (({ close }: { close: () => void }) => React.ReactNode);\n  children: React.ReactElement;\n}\n\n/**\n * Popup opened by a trigger. `trigger` can be an element of any pressable component (such as {@link Button} or\n * {@link IconButton}), and is rendered in place. Similar to {@link Popup component}, `children` defines the content\n * of Popup.\n */\nexport const PopupTrigger = React.forwardRef(function PopupTrigger(\n  { placement, children, popup, ...props }: PopupTriggerProps,\n  forwardedRef: ForwardedRef<HTMLButtonElement>\n) {\n  const state = useOverlayTriggerState(props);\n  const triggerRef = useObjectRef(forwardedRef);\n  const { overlayProps, triggerProps } = useOverlayTrigger(\n    { type: props.type || \"menu\" },\n    state,\n    triggerRef\n  );\n  return (\n    <>\n      <PressResponder ref={triggerRef} {...triggerProps}>\n        {children}\n      </PressResponder>\n      {state.isOpen && (\n        <PopupControllerContext.Provider\n          value={{\n            overlayProps,\n            positioning: {\n              targetRef: triggerRef,\n              placement,\n            },\n            onClose: state.close,\n          }}\n        >\n          {typeof popup === \"function\" ? popup({ close: state.close }) : popup}\n        </PopupControllerContext.Provider>\n      )}\n    </>\n  );\n});\n","import { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport const StyledPopupContainer = styled.div`\n  position: fixed;\n  box-sizing: border-box;\n  // not checked if there should be a better substitute for * in the following colors. Maybe \"Component\"?\n  background-color: ${({ theme }) => theme.color(\"*.background\")};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  outline: none; // Focus will be reflected in header. No need for outline or any other focus style on the container\n  ${WINDOW_SHADOW}; // FIXME: OS-dependant style?\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\n\n/**\n * Hint component (aka Advertiser) used in Popup's footer.\n * {@see Popup.Layout}\n */\nexport const StyledPopupHint = styled.div`\n  // NOTE: Following the reference implementation, would require to set fallback colors non-prior to\n  // *.(background|foreground) colors (by not passing the fallback color as the second argument to theme.color).\n  // It's only in BigPopup that the fallback colors are prioritized over *-fallback. But in Figma designs, this is\n  // simplified, and hint always has the muted color (like in BigPopup), instead of the default foreground.\n  // So we are intentionally deviating from the reference implementation here.\n  background: ${({ theme }) =>\n    theme.color(\n      \"Popup.Advertiser.background\",\n      theme.color(\"SearchEverywhere.Advertiser.background\")\n    )};\n  color: ${({ theme }) =>\n    theme.color(\n      \"Popup.Advertiser.foreground\",\n      theme.color(\"SearchEverywhere.Advertiser.foreground\")\n    )};\n  padding: 0.3125rem 0.9375rem 0.3125rem 0.625rem;\n  font-size: 0.875em;\n  line-height: normal;\n  user-select: none;\n  cursor: default;\n  // NOTE: white-space is intentionally not set as nowrap.\n`;\n","import React, {\n  CSSProperties,\n  HTMLAttributes,\n  Ref,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { keyframes } from \"styled-components\";\nimport { useProgressBar } from \"@react-aria/progress\";\nimport { AriaProgressBarProps } from \"@react-types/progress\";\nimport { PressProps, useHover } from \"@react-aria/interactions\";\nimport { useButton } from \"@react-aria/button\";\nimport { mergeProps } from \"@react-aria/utils\";\n\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\n\nexport interface ProgressBarProps extends Omit<AriaProgressBarProps, \"label\"> {\n  /**\n   * Process name, shown above or to the left of the progress bar. Placement is controlled by {@link namePosition}.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-name\n   */\n  name?: React.ReactNode;\n\n  /**\n   * Process name position with respect to the progress bar.\n   * If `namePosition` is \"side\", {@link name} is **not** automatically appended with a colon.\n   * @default \"top\"\n   */\n  namePosition?: \"side\" | \"top\";\n\n  /**\n   * Process details, placed bellow the progress bar, with a de-emphasized color.\n   * @see https://jetbrains.github.io/ui/controls/progress_bar/#process-details\n   */\n  details?: React.ReactNode;\n\n  /**\n   * A second line of details. Not an officially documented feature, but it's supported in the reference impl.\n   */\n  secondaryDetails?: React.ReactNode;\n\n  /**\n   * Placed next to and aligned with the progress bar, used for\n   * [process control](https://jetbrains.github.io/ui/controls/progress_bar/#process-control) buttons.\n   */\n  button?: React.ReactNode;\n\n  /**\n   * Progress bar track width.\n   */\n  width?: CSSProperties[\"width\"];\n\n  /**\n   * Not supported in [the official specs](https://jetbrains.github.io/ui/controls/progress_bar/#25), but the progress\n   * bar in status bar has a denser spacing. It still won't be a pixel perfect match with the progress bar in the\n   * status bar.\n   */\n  dense?: boolean;\n\n  /** Whether the value's label is displayed. True by default if there's a label, false by default if not. */\n  showValueLabel?: boolean;\n\n  style?: HTMLAttributes<unknown>[\"style\"];\n  className?: HTMLAttributes<unknown>[\"className\"];\n}\n\ninterface ProgressBarContextObj {\n  setForcedDetails: (details: string | null) => void;\n  setTooltip: (tooltip: string | null) => void;\n}\n\n/**\n * @see https://jetbrains.github.io/ui/controls/progress_bar/\n * @see https://github.com/JetBrains/intellij-community/blob/82f201386c3f7a339ff25fc8f3389024c8078a87/platform/platform-api/src/com/intellij/openapi/ui/panel/ProgressPanelBuilder.java\n *\n * Known issues:\n * There are a couple of UI issues because of the current layout (which can be improved probably):\n * - max-width of the label and details, it's not necessarily aligned with the the progressbar track, because they don't\n *   share the same container\n * - when label is on the side, details is aligned with the label, instead of the progressbar track.\n */\nexport const ProgressBar = ({\n  value = 0,\n  maxValue = 100,\n  minValue = 0,\n  name,\n  namePosition = \"top\",\n  details,\n  secondaryDetails,\n  button,\n  width,\n  dense,\n  className,\n  style,\n  valueLabel,\n  showValueLabel = Boolean(valueLabel),\n  ...props\n}: ProgressBarProps): React.ReactElement => {\n  const { progressBarProps, labelProps } = useProgressBar({\n    ...props,\n    label: name,\n    value,\n    valueLabel,\n    maxValue,\n    minValue,\n  });\n  const percentage = (100 * (value / maxValue)).toFixed(0);\n  const [forcedDetails, setForcedDetails] = useState<null | string>(\"\");\n  const [tooltip, setTooltip] = useState<null | string>(\"\");\n\n  const contextValue: ProgressBarContextObj = useMemo(\n    () => ({\n      setForcedDetails,\n      setTooltip,\n    }),\n    []\n  );\n  const label = (\n    <StyledProgressBarLabel {...labelProps}>{name}</StyledProgressBarLabel>\n  );\n  const effectiveDetails = details ? tooltip || forcedDetails || details : null;\n  return (\n    <StyledProgressBarContainer style={style} className={className}>\n      {namePosition === \"top\" && label}\n      <StyledProgressBarLineContainer\n        dense={dense}\n        hasTopMargin={Boolean(name) && namePosition === \"top\"}\n        hasBottomMargin={Boolean(effectiveDetails)}\n      >\n        {namePosition === \"side\" && label}\n        <StyledProgressBarTrack\n          style={{ width }}\n          {...progressBarProps}\n          indeterminate={props.isIndeterminate}\n        >\n          {!props.isIndeterminate && (\n            <StyledProgressBarProgress style={{ width: `${percentage}%` }} />\n          )}\n        </StyledProgressBarTrack>\n        {showValueLabel && <span>{valueLabel ?? `${percentage}%`}</span>}\n        <ProgressBarContext.Provider value={contextValue}>\n          {button}\n        </ProgressBarContext.Provider>\n      </StyledProgressBarLineContainer>\n      <StyledProgressBarDetails>{effectiveDetails}</StyledProgressBarDetails>\n      <StyledProgressBarDetails>{secondaryDetails}</StyledProgressBarDetails>\n    </StyledProgressBarContainer>\n  );\n};\n\nconst ProgressBarContext = React.createContext<null | ProgressBarContextObj>(\n  null\n);\n\nconst StyledProgressBarContainer = styled.div`\n  color: ${({ theme }) => theme.commonColors.labelForeground /* TODO: check*/};\n  cursor: default; // prevent cursor on text\n`;\n\nconst StyledProgressBarLineContainer = styled.div<{\n  dense?: boolean;\n  hasTopMargin?: boolean;\n  hasBottomMargin?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  gap: ${({ dense }) => (dense ? \"0.5rem\" : \"0.625rem\")};\n  height: 4px;\n  // spacing is based on the reference impl and figma designs. top and bottom spacing is inverted in the spec document\n  // figma: https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-(Community)?node-id=75426%3A16650\n  // spec document: https://jetbrains.github.io/ui/controls/progress_bar/#25\n  margin-top: ${({ hasTopMargin }) => hasTopMargin && \"0.375rem\"};\n  margin-bottom: ${({ hasBottomMargin }) => hasBottomMargin && \"0.25rem\"};\n`;\n\nconst StyledProgressBarLabel = styled.div`\n  white-space: nowrap;\n  max-width: calc(100% - 2rem);\n  overflow: hidden;\n`;\n\nconst StyledProgressBarDetails = styled.div`\n  color: ${({ theme }) => theme.commonColors.contextHelpForeground};\n  font-size: 0.82em;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: calc(100% - 2rem); // not the best way\n`;\n\nconst StyledProgressBarTrack = styled.div<{ indeterminate?: boolean }>`\n  height: inherit;\n  border-radius: 2px;\n  overflow: hidden;\n  display: flex;\n\n  // In case used in flex layout\n  min-width: 0;\n  flex: 1;\n\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.trackColor\",\n      theme.dark ? \"rgb(85,85,85)\" : \"rgb(196,196,196)\"\n    )};\n  ${({ indeterminate }) =>\n    indeterminate &&\n    css`\n      background: linear-gradient(\n        90deg,\n        ${getIndeterminateStartColor} 0%,\n        ${getIndeterminateEndColor} 50%,\n        ${getIndeterminateStartColor} 100%\n      );\n      background-size: 96px auto;\n      animation: 800ms ${indeterminateBackgroundAnimation} linear infinite;\n    `}\n`;\n\nconst getIndeterminateStartColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateStartColor\");\nconst getIndeterminateEndColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ProgressBar.indeterminateEndColor\");\n\nconst indeterminateBackgroundAnimation = keyframes`\n  0% {\n    background-position: 0;\n  }\n  100% {\n    background-position: 96px;\n  }\n`;\n\nconst StyledProgressBarProgress = styled.div`\n  height: 100%;\n  background: ${({ theme }) =>\n    theme.color(\n      \"ProgressBar.progressColor\",\n      theme.dark ? \"rgb(160,160,160)\" : \"rgb(128,128,128)\"\n    )};\n`;\n\ntype ProgressBarIconButtonProps = Pick<PressProps, \"onPress\"> & {\n  hoverTooltip: string;\n};\n\n/**\n * Accessibility and functionality of progress bar icon buttons\n * @private maybe?\n */\nexport function useProgressBarIconButton(\n  { onPress, hoverTooltip }: ProgressBarIconButtonProps,\n  ref: Ref<HTMLElement>\n) {\n  const { buttonProps } = useButton(\n    {\n      onPress,\n      elementType: \"span\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: it works, but it's intentionally excluded from the type.\n      preventFocusOnPress: true,\n    },\n    ref\n  );\n  const context = useContext(ProgressBarContext);\n  const { hoverProps, isHovered } = useHover({});\n  useEffect(() => {\n    context?.setTooltip(isHovered ? hoverTooltip : null);\n  }, [hoverTooltip, isHovered]);\n  return {\n    buttonProps: mergeProps(buttonProps, hoverProps),\n  };\n}\n\n/**\n * @private maybe?\n * */\nexport function useProgressBarPauseIconButton(\n  { paused, ...props }: ProgressBarIconButtonProps & { paused: boolean },\n  ref: Ref<HTMLElement>\n) {\n  const context = useContext(ProgressBarContext);\n  useEffect(() => {\n    context?.setForcedDetails(paused ? \"Paused\" : null);\n  }, [paused]);\n  return useProgressBarIconButton(props, ref);\n}\n\n/**\n * Experimenting with an idea of exposing parts on each component, to maximize styling customizability, similar to\n * [classes](https://mui.com/joy-ui/api/button/#classes) API in MUI components. But instead of passing classes prop,\n * one would be able to create custom versions of a component by doing something like this:\n * const CustomComponent = styled(Component)`\n *   ${Component.part1} {\n *     // custom style here\n *   }\n * `;\n * The question is if this type of customizability is actually a good thing in the balance between flexibility for\n * catering for different use cases and not stepping out of the design system boundaries.\n * Another potential downside is that the public API expands to the anatomy of the component.\n */\nProgressBar.Container = StyledProgressBarContainer;\nProgressBar.Label = StyledProgressBarLabel;\nProgressBar.LineContainer = StyledProgressBarLineContainer;\nProgressBar.Track = StyledProgressBarTrack;\nProgressBar.Progress = StyledProgressBarProgress;\nProgressBar.Details = StyledProgressBarDetails;\n","import React, { useRef } from \"react\";\nimport { AutoHoverPlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { useProgressBarIconButton } from \"./ProgressBar\";\n\ninterface ProgressBarCancelButtonProps {\n  /**\n   * whether small icon should be used.\n   */\n  small?: boolean;\n  onPress: () => void;\n}\n\n/**\n * Stop (cancel) icon button for progress bar, to be used in {@link ProgressBarProps#button}.\n */\nexport const ProgressBarStopButton = ({\n  small,\n  onPress,\n}: ProgressBarCancelButtonProps) => {\n  const ref = useRef<HTMLSpanElement>(null);\n  const { buttonProps } = useProgressBarIconButton(\n    { onPress, hoverTooltip: \"Cancel\" },\n    ref\n  );\n  return (\n    <AutoHoverPlatformIcon\n      ref={ref}\n      {...buttonProps}\n      icon={`process/stop${small ? \"Small\" : \"\"}.svg`}\n      hoverIcon={`process/stop${small ? \"Small\" : \"\"}Hovered.svg`}\n    />\n  );\n};\n","import React from \"react\";\nimport {\n  ThreeViewSplitter,\n  ThreeViewSplitterProps,\n} from \"./ThreeViewSplitter/ThreeViewSplitter\";\n\ntype ResizableViewProps = Omit<\n  ThreeViewSplitterProps,\n  | \"innerView\"\n  | \"firstView\"\n  | \"firstSize\"\n  | \"onFirstResize\"\n  | \"lastView\"\n  | \"lastSize\"\n  | \"onLastResize\"\n> & {\n  children: React.ReactNode;\n  onResize: ThreeViewSplitterProps[\"onFirstResize\"];\n  size: ThreeViewSplitterProps[\"firstSize\"];\n  /**\n   * Whether the resizer should be placed at before or after the resizable view.\n   */\n  resizerPlacement?: \"before\" | \"after\";\n};\n/**\n * A single resizable view, built on top of {@link ThreeViewSplitter}, just to provide better prop interface.\n * Like `ThreeViewSplitter` it supports \"horizontal\" or \"vertical orientations. There is an extra `resizerPlacement`\n * prop which determines where the resizer should be placed in relation with the view. When set to \"before\" the view\n * will be resizable from the start (\"left\" or \"top\"). When set to \"after\" the view will be resizable from end (\"right\"\n * or \"bottom\"). Default is \"after\"\n */\nexport const ResizableView = ({\n  children,\n  size,\n  onResize,\n  resizerPlacement = \"after\",\n  ...props\n}: ResizableViewProps) => (\n  <ThreeViewSplitter\n    {...(resizerPlacement === \"after\"\n      ? { firstView: children, firstSize: size, onFirstResize: onResize }\n      : { lastView: children, lastSize: size, onLastResize: onResize })}\n    {...props}\n  />\n);\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useBottomResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will increase/decrease the height\n */\nexport const BottomResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useBottomResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype HorizontalResizerViewProps = ResizerViewProps<\"horizontal\">;\n\nconst StyledHorizontalResizer = styled.div`\n  top: 0;\n  height: 100%;\n  width: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledHorizontalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: HorizontalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  width: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  height: 100%;\n  left: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a horizontal layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const HorizontalResizer: React.FC<HorizontalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"col\",\n  children,\n  style = {},\n  resizerProps,\n}) => {\n  return (\n    <StyledHorizontalResizer\n      {...resizerProps}\n      style={{ ...style, background, width: size }}\n    >\n      {children}\n      <StyledHorizontalResizerArea handleSize={outerPadding} cursor={cursor} />\n    </StyledHorizontalResizer>\n  );\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useLeftResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the left side of the resizable view. i.e.\n * moving mouse to right/left will decrease/increase the width\n */\nexport const LeftResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useLeftResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { HorizontalResizer } from \"./HorizontalResizer\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useRightResizer } from \"./useResizer\";\n\n/**\n * Handle for resizing views in a horizontal layout, where the resizer is at the right side of the resizable view. i.e.\n * moving mouse to right/left will increase/decrease the width\n */\nexport const RightResizer: React.FC<ResizerProps<\"horizontal\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useRightResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <HorizontalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport { ResizerProps } from \"./ResizerProps\";\nimport { useTopResizer } from \"./useResizer\";\nimport { VerticalResizer } from \"./VerticalResizer\";\n\n/**\n * Handle for resizing views in a vertical layout, where the resizer is at the top side of the resizable view. i.e.\n * moving mouse to bottom/top will decrease/increase the height\n */\nexport const TopResizer: React.FC<ResizerProps<\"vertical\">> = ({\n  onResize,\n  onResizeEnd,\n  onResizeStarted,\n  ...props\n}) => {\n  const { resizerProps } = useTopResizer({\n    onResize,\n    onResizeEnd,\n    onResizeStarted,\n  });\n  return <VerticalResizer resizerProps={resizerProps} {...props} />;\n};\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ResizerViewProps } from \"./useResizer\";\n\ntype VerticalResizerViewProps = ResizerViewProps<\"vertical\">;\n\nconst StyledVerticalResizer = styled.div`\n  width: 100%;\n  height: 0;\n  position: relative;\n  z-index: 1; // to keep resizer on top of sibling views, in case they are non-static\n`;\n\nconst StyledVerticalResizerArea = styled.div<{\n  handleSize: number;\n  cursor: VerticalResizerViewProps[\"cursor\"];\n}>`\n  position: absolute;\n  cursor: ${({ cursor }) => `${cursor}-resize`};\n  height: ${({ handleSize }) => `calc(100% + ${handleSize}px)`};\n  width: 100%;\n  top: ${({ handleSize }) => `-${handleSize / 2}px`};\n`;\n\n/**\n * Handle for resizing views in a vertical layout. It just handles the\n * movement event and calls onResize with the new size. It has nothing to do\n * with actually applying the size.\n */\nexport const VerticalResizer: React.FC<VerticalResizerViewProps> = ({\n  outerPadding = 10,\n  background,\n  size = 0,\n  cursor = \"row\",\n  resizerProps,\n  children,\n  style = {},\n}) => (\n  <StyledVerticalResizer\n    {...resizerProps}\n    style={{ ...style, background, height: size }}\n  >\n    {children}\n    <StyledVerticalResizerArea handleSize={outerPadding} cursor={cursor} />\n  </StyledVerticalResizer>\n);\n","import { useMove } from \"../utils/interaction-utils/useMove\";\nimport { ResizerProps } from \"./ResizerProps\";\n\ntype UseResizerProps = Pick<\n  ResizerProps,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n>;\n\nexport type ResizerViewProps<O = \"horizontal\" | \"vertical\"> = Omit<\n  ResizerProps<O>,\n  \"onResize\" | \"onResizeEnd\" | \"onResizeStarted\"\n> &\n  ReturnType<typeof useResizer>;\n\nconst useResizer = (\n  orientation: \"horizontal\" | \"vertical\",\n  invert: boolean,\n  { onResizeStarted, onResize, onResizeEnd }: UseResizerProps\n) => {\n  const props = useMove({\n    dragThreshold: 0,\n    onMoveStart: () => onResizeStarted() || 0,\n    onMoveEnd: () => onResizeEnd?.(),\n    onMove: ({ movement, startState }) =>\n      onResize(\n        startState +\n          (invert ? -1 : +1) *\n            movement[orientation === \"horizontal\" ? \"x\" : \"y\"]\n      ),\n  });\n  return {\n    resizerProps: props,\n  };\n};\n\nexport const useLeftResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", true, props);\n};\n\nexport const useRightResizer = (props: UseResizerProps) => {\n  return useResizer(\"horizontal\", false, props);\n};\n\nexport const useTopResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", true, props);\n};\n\nexport const useBottomResizer = (props: UseResizerProps) => {\n  return useResizer(\"vertical\", false, props);\n};\n","import React, { ComponentProps, useState } from \"react\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\n\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n  CommonActionId,\n  useGetActionShortcut,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { Input, InputProps } from \"@intellij-platform/core/InputField\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { Item } from \"@intellij-platform/core/Collections\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\n\nexport interface SearchInputProps\n  extends Omit<InputProps, \"onSubmit\" | \"onChange\"> {\n  /**\n   * Search history to be shown as a menu when the search icon is pressed.\n   */\n  searchHistory?: Array<string>;\n  /**\n   * The content of \"show history\" button tooltip, and the corresponding action title.\n   * @default \"Recent Search\"\n   */\n  historyButtonTitle?: string;\n  /**\n   * Called when the search input is cleared by either clear button or `Escape` key.\n   * `onChange` is also called with an empty string, whenever the input is cleared,\n   * so there is no need for updating the state using `onClear`, when the value is controlled.\n   *\n   * @param clearedValue the value before clearing.\n   */\n  onClear?: (clearedValue: string) => void;\n  /**\n   * Called when the search is submitted by pressing `Enter`\n   * @param value submitted text\n   */\n  onSubmit?: (value: string) => void;\n  /**\n   * Controlled value of the search input\n   */\n  value?: string;\n  /**\n   * Default value of the search input, used for initialization when value is uncontrolled.\n   */\n  defaultValue?: string;\n  /**\n   * Called when the value is changed.\n   */\n  onChange?: (value: string) => void;\n  /**\n   * Called when a history item is selected. `onChange` is called with the selected text, so\n   * there is no need for updating the state using `onHistoryItemSelected`, when the value is controlled.\n   *\n   * @param value text selected from history.\n   * @param previousValue the value of the input before the history item was selected.\n   */\n  onHistoryItemSelected?: (value: string, previousValue: string) => void;\n}\n\nconst StyledInput = styled(Input)`\n  input[type=\"search\"] {\n    -webkit-appearance: none;\n    &::-webkit-search-cancel-button {\n      -webkit-appearance: none;\n    }\n    &::-webkit-search-decoration {\n      -webkit-appearance: none;\n    }\n  }\n`;\n\n/**\n * A wrapper around {@link Input} with a few additions:\n * - A Search icon, added as an {@link InputProps#addonBefore addonBefore}.\n * - A clear button, added as an {@link InputProps#addonAfter addonAfter}, when the input has value.\n *   {@link SearchInputProps#onClear onClear} is called when the clear button is clicked.\n * - A list of search queries shown as a menu, when the search icon is clicked,\n *   if {@link SearchInputProps#searchHistory searchHistory} is provided.\n * - An action provided on the input element, to open the search history via\n *   {@link CommonActionId.SHOW_SEARCH_HISTORY} shortcut.\n * - Search submission callback ({@link SearchInputProps#onSubmit onSubmit}) called when search is submitted by pressing Enter\n *\n * {@link InputProps#onChange onChange} and {@link InputProps#onSubmit onSubmit} props are also different in SearchInput, compared to\n * the corresponding props of the native input.\n *\n * Caveat: If the width is not set (either explicitly or via the entailing layout), the width of the input will change when clear button shows/hides.\n *\n * @see Input\n * @see InputField\n */\nexport const SearchInput = React.forwardRef(function SearchInput(\n  {\n    addonBefore,\n    addonAfter,\n    searchHistory,\n    onClear,\n    onSubmit,\n    onHistoryItemSelected,\n    historyButtonTitle = \"Recent Search\",\n    value: valueProp,\n    defaultValue = \"\",\n    onChange,\n    type = \"search\",\n    inputRef: inputRefProp,\n    ...props\n  }: SearchInputProps,\n  forwardedRef: React.Ref<HTMLDivElement>\n) {\n  const [value, setValue] = useControlledState(\n    valueProp!,\n    defaultValue,\n    onChange!\n  );\n  const inputContainerRef = useObjectRef(forwardedRef);\n  const inputRef = useObjectRef(inputRefProp);\n  const [isSearchHistoryOpen, setSearchHistoryOpen] = useState(false);\n  const showSearchHistoryAction: ActionDefinition = {\n    id: CommonActionId.SHOW_SEARCH_HISTORY,\n    title: historyButtonTitle,\n    actionPerformed: () => {\n      setSearchHistoryOpen(true);\n    },\n  };\n  // TODO: rename HelpTooltip, ActionTooltip, etc. to Tooltip.Action Tooltip.Help, then add ActionTooltip in action\n  //  components, and use that instead of the more low-level API used here.\n  const getShortcut = useGetActionShortcut();\n  const searchIcon = searchHistory ? (\n    <MenuTrigger\n      isOpen={isSearchHistoryOpen}\n      onOpenChange={setSearchHistoryOpen}\n      positioningTargetRef={inputContainerRef}\n      renderMenu={({ menuProps }) => (\n        <Menu\n          {...menuProps}\n          autoFocus=\"first\"\n          onAction={(key) => {\n            const historyItemText =\n              searchHistory[parseInt(`${key}`.split(\"_\")[0])];\n            if (historyItemText !== undefined) {\n              setValue(historyItemText);\n              onHistoryItemSelected?.(historyItemText, value);\n              inputRef.current?.focus();\n            }\n          }}\n        >\n          {searchHistory.map((historyItem, index) => (\n            <Item key={`${index}_${historyItem}`}>{historyItem}</Item>\n          ))}\n        </Menu>\n      )}\n    >\n      {(menuTriggerProps, ref) => (\n        <TooltipTrigger\n          tooltip={\n            <ActionTooltip\n              actionName={historyButtonTitle}\n              shortcut={getShortcut(CommonActionId.SHOW_SEARCH_HISTORY)}\n            />\n          }\n        >\n          {(tooltipTriggerProps) => (\n            <PlatformIcon\n              {...mergeProps(tooltipTriggerProps, menuTriggerProps)}\n              ref={ref}\n              icon=\"actions/searchWithHistory.svg\"\n              role=\"button\"\n              aria-label={historyButtonTitle}\n            />\n          )}\n        </TooltipTrigger>\n      )}\n    </MenuTrigger>\n  ) : (\n    <PlatformIcon icon=\"actions/search.svg\" />\n  );\n  const clear = () => {\n    setValue(\"\");\n    onClear?.(value);\n  };\n  const inputProps = mergeProps<ComponentProps<typeof Input>[]>(props, {\n    ref: inputContainerRef,\n    inputRef,\n    value,\n    type,\n    onChange: (event) => {\n      setValue(event.target.value);\n    },\n    addonBefore: (\n      <>\n        {searchIcon}\n        {addonBefore}\n      </>\n    ),\n    addonAfter: (\n      <>\n        {value && (\n          <AutoHoverPlatformIcon\n            onClick={clear}\n            role=\"button\"\n            aria-label=\"Clear search\"\n            icon=\"actions/close\"\n            hoverIcon=\"actions/closeHovered\"\n          />\n        )}\n        {addonAfter}\n      </>\n    ),\n    onKeyDown: (event) => {\n      if (event.repeat) {\n        return;\n      }\n      if (event.key === \"Enter\") {\n        onSubmit?.(event.currentTarget.value);\n      } else if (event.key === \"Escape\") {\n        clear();\n      }\n    },\n  });\n  if (searchHistory) {\n    return (\n      <ActionsProvider actions={[showSearchHistoryAction]}>\n        {({ shortcutHandlerProps }) => (\n          <StyledInput {...mergeProps(inputProps, shortcutHandlerProps)} />\n        )}\n      </ActionsProvider>\n    );\n  }\n  return <StyledInput {...inputProps} />;\n});\n","import React, { useRef } from \"react\";\nimport { useButton } from \"@react-aria/button\";\nimport {\n  AutoHoverPlatformIcon,\n  PlatformIcon,\n} from \"@intellij-platform/core/Icon\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface SpeedSearchInputProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n  clear: () => void;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 0.25rem;\n`;\n\nconst StyledSpeedSearchInput = styled.span<{ noMatch?: boolean }>`\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  background: ${({ theme, noMatch }) =>\n    noMatch\n      ? theme.color(\n          \"SearchField.errorBackground\",\n          theme.dark ? \"#743A3A\" : \"#ffcccc\"\n        )\n      : theme.color(\n          \"TextField.background\"\n        )}; // fallback logic not checked with the ref impl\n  color: ${({ theme }) =>\n    theme.color(\n      \"TextField.foreground\" as UnknownThemeProp<\"TextField.foreground\">\n    )}; // fallback logic not checked with the ref impl\n  height: 1.5rem; // 24px, JBTextField COMPACT_HEIGHT\n  padding: 0.125rem 0.375rem;\n  border: 1px solid ${({ theme }) => theme.getOutlineColor(true, false)};\n  border-radius: ${({ theme }) =>\n    ((theme.value(\"Component.arc\") as number) ?? 5) / 2}px;\n`;\nconst StyledSearchText = styled.span`\n  flex: 1;\n  font-size: 0.91em; // RelativeFont.SMALL\n`;\n\n/**\n * An input field to be rendered to show the filter value in speed search in menus and similar speedSearch-enabled\n * components.\n * @see SpeedSearchPopup\n */\nexport const SpeedSearchInput = React.forwardRef<\n  HTMLElement,\n  SpeedSearchInputProps\n>(({ active, match, children, clear }, ref) => {\n  const clearButtonRef = useRef<HTMLElement>(null);\n  const { buttonProps } = useButton(\n    {\n      elementType: \"span\",\n      \"aria-label\": \"Clear search\",\n      excludeFromTabOrder: true,\n      // @ts-expect-error: preventFocusOnPress is not defined in public API of useButton\n      preventFocusOnPress: true,\n      onPress: clear,\n    },\n    clearButtonRef\n  );\n\n  // Temporary styled components until SearchInput is implemented\n  return active ? (\n    <StyledSpeedSearchInput ref={ref} noMatch={!match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      <StyledSearchText>\n        {(children || \"\").replace(/ /g, \"\\u00A0\")}\n      </StyledSearchText>\n      {children && (\n        <AutoHoverPlatformIcon\n          {...buttonProps}\n          ref={clearButtonRef}\n          icon=\"actions/close\"\n          hoverIcon=\"actions/closeHovered\"\n        />\n      )}\n    </StyledSpeedSearchInput>\n  ) : null;\n});\n","import { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React from \"react\";\nimport { styled } from \"../styled\";\n\nexport interface SpeedSearchPopupProps {\n  children: string | undefined;\n  match?: boolean;\n  active: boolean | undefined;\n}\n\nconst StyledSearchIcon = styled(PlatformIcon)`\n  margin-right: 10px;\n  vertical-align: middle;\n`;\n\n/**\n * The little popup view shown in the top left corner of list, tree, etc., which shows the search\n * query.\n * @see SpeedSearchInput\n */\nexport const SpeedSearchPopup = React.forwardRef<\n  HTMLElement,\n  SpeedSearchPopupProps\n>(({ active, match, children }, ref) =>\n  active ? (\n    <StyledSpeedSearchPopup ref={ref} noMatch={!match}>\n      <StyledSearchIcon icon={\"actions/search\"} />\n      {(children || \"\").replace(/ /g, \"\\u00A0\")}\n    </StyledSpeedSearchPopup>\n  ) : null\n);\n\nconst StyledSpeedSearchPopup = styled.span<{ noMatch?: boolean }>`\n  // ref: https://github.com/JetBrains/intellij-community/blob/e3c7d96daba1d5d84d5650bde6c220aed225bfda/platform/platform-impl/src/com/intellij/ui/SpeedSearchBase.java#L53-L53\n  box-sizing: border-box;\n  position: absolute;\n  background: ${({ theme }) =>\n    theme.color(\n      \"SpeedSearch.background\",\n      theme.dark ? \"rgb(111,111,111)\" : \"#fff\"\n    )};\n  border: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"SpeedSearch.borderColor\",\n        theme.dark ? \"rgb(64, 64, 64)\" : \"rgb(192, 192, 192)\"\n      )};\n  color: ${({ noMatch, theme }) =>\n    noMatch\n      ? theme.color(\"SpeedSearch.errorForeground\", theme.commonColors.red)\n      : theme.color(\n          \"SpeedSearch.foreground\",\n          theme.commonColors.tooltipForeground\n        )};\n  z-index: 1;\n  padding: 3px 7px;\n  height: 25px;\n  line-height: 1.2;\n  transform: translateY(-100%);\n`;\n","import React, { useRef } from \"react\";\n\nfunction isTypeableElement(elem: HTMLElement): boolean {\n  const nonTypeableInputTypes: Array<HTMLInputElement[\"type\"]> = [\n    \"checkbox\",\n    \"radio\",\n    \"button\",\n  ];\n  return (\n    elem.isContentEditable ||\n    (elem instanceof HTMLInputElement &&\n      !nonTypeableInputTypes.includes(elem.type)) ||\n    elem instanceof HTMLTextAreaElement\n  );\n}\n\n/**\n * Main use case is for a list of item, which can have keyboard focus, be filterable and capture\n * typing if the corresponding keyboard events are not happening on an inner element (like an input)\n * that already handles typing.\n * @param value\n * @param onChange\n * TODO: add support for removing word by word by alt+backspace like native text fields.\n * TODO: add support for removing the whole content by command/ctrl+backspace.\n */\nexport function useGhostInput({\n  value,\n  onChange,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n}) {\n  const valueRef = useRef(value);\n  valueRef.current = value;\n  const onKeyDown = (event: React.KeyboardEvent | KeyboardEvent) => {\n    if (\n      !event.ctrlKey &&\n      !event.altKey &&\n      !event.metaKey &&\n      (!(event.target instanceof HTMLElement) ||\n        !isTypeableElement(event.target))\n    ) {\n      if (event.key.length === 1) {\n        // Seems reasonable to prevent default here generally, but the specific case this is added for is the space key,\n        // scrolling the page.\n        event.preventDefault();\n        return onChange(`${valueRef.current}${event.key}`);\n      }\n      if (event.key === \"Backspace\") {\n        const sliceEnd = event.metaKey ? 0 : -1;\n        onChange(valueRef.current.slice(0, sliceEnd));\n      }\n    }\n  };\n  return { onKeyDown } as const;\n}\n","import { useGhostInput } from \"./useGhostInput\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport React, { RefObject } from \"react\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\nexport interface SpeedSearchState {\n  /**\n   * Whether speed search is active. Speed search becomes active when the user starts to type and becomes inactive\n   * when Escape is pressed, or when the speed search container is blurred and `keepSearchActiveOnBlur` is false.\n   * Whenever speed search becomes inactive, search text is also cleared.\n   * Note that speed search can be active while search term is empty.\n   */\n  active: boolean;\n  setActive: (value: boolean) => void;\n  searchTerm: string;\n  setSearchTerm: (value: string) => void;\n  /**\n   * clears search term and sets active to false\n   */\n  clear: () => void;\n}\n\nexport interface SpeedSearchStateProps\n  extends ControlledStateProps<{\n    searchTerm: string;\n    isSearchActive: boolean;\n  }> {}\n\nexport function useSpeedSearchState(\n  props: SpeedSearchStateProps\n): SpeedSearchState {\n  const [active, setActive] = useControlledState(\n    props.isSearchActive!,\n    props.defaultIsSearchActive ?? false,\n    props.onIsSearchActiveChange!\n  );\n  const [searchTerm, setSearchTerm] = useControlledState(\n    props.searchTerm!,\n    props.defaultSearchTerm || \"\",\n    props.onSearchTermChange!\n  );\n\n  return {\n    active,\n    searchTerm,\n    setActive,\n    setSearchTerm,\n    clear: () => {\n      setSearchTerm(\"\");\n      setActive(false);\n    },\n  };\n}\n\nexport interface SpeedSearchProps {\n  keepSearchActiveOnBlur?: boolean | ((e: React.FocusEvent) => boolean);\n}\n\n/**\n * TODO: description\n * IMPORTANT: making the container element focusable is not a part of this hook. But it's a prerequisite for it to work.\n * Previously, a tabIndex:-1 was passed as a container prop, but it turns out it's not that simple. For collections for\n * example we usually want tab index to be 0 once it's not focused and then when an item is focused, we want it to be\n * -1, and such kind of logics are handled in their respective hooks. So, making the container focusable and how to do\n * it is NOT this hook's responsibility anymore.\n */\nexport function useSpeedSearch(\n  { keepSearchActiveOnBlur }: SpeedSearchProps,\n  { searchTerm, active, setActive, setSearchTerm }: SpeedSearchState,\n  ref: RefObject<HTMLElement>\n) {\n  const { onKeyDown: ghostInputKeydown } = useGhostInput({\n    value: searchTerm,\n    onChange: (value) => {\n      const trimmedValue = value.trimStart();\n      setSearchTerm(trimmedValue);\n      if (!active && trimmedValue !== \"\") {\n        setActive(true);\n      }\n    },\n  });\n  const clear = () => {\n    setSearchTerm(\"\");\n    setActive(false);\n  };\n\n  const {\n    keyboardProps: { onKeyDown, onKeyUp },\n  } = useKeyboard({\n    onKeyDown: (e) => {\n      if (!ref.current?.contains(e.target as HTMLElement)) {\n        // In case events are propagated through portals\n        return;\n      }\n      if (e.key === \"a\" && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n      }\n      if (e.key === \"Escape\") {\n        clear();\n      } else {\n        ghostInputKeydown(e);\n      }\n      /**\n       * In the reference impl, at least some action shortcuts are allowed\n       * while the search is active. But actions with some other shortcuts\n       * (like Delete) are not triggered while the speed search is active\n       * the current condition below is not 100% matching the reference impl,\n       * but seems to be good enough for now.\n       */\n      if (!active || hasAnyModifier(e)) {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  const {\n    focusWithinProps: { onFocus, onBlur },\n  } = useFocusWithin({\n    onBlurWithin: (event) => {\n      if (\n        !(typeof keepSearchActiveOnBlur === \"function\"\n          ? keepSearchActiveOnBlur(event)\n          : keepSearchActiveOnBlur)\n      ) {\n        clear();\n      }\n    },\n  });\n\n  return {\n    containerProps: {\n      onFocus,\n      onBlur,\n      onKeyDown,\n      onKeyUp,\n    },\n  };\n}\n","import React from \"react\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\n\nexport interface StatusBarProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n}\n\n/**\n * Status bar rendered at the bottom of the main window. In the reference implementation, there are three slots for\n * content: left, right and center. It doesn't seem center is really necessary, so only left and right are supported\n * for now.\n * @param left content on the left side of the status bar.\n * @param right content on the right side of the status bar. Typically, a bunch of {@link StatusBarWidget}s\n */\nexport const StatusBar = ({\n  left,\n  right,\n}: StatusBarProps): React.ReactElement => {\n  return (\n    <StyledStatusBar\n      onMouseDown={(e) => {\n        // stop focus from going out of the currently focused element, when status bar is clicked\n        // might be too intrusive to prevent default unconditionally :-? Also, it may make sense for it to be an option\n        e.preventDefault();\n      }}\n    >\n      <StyledStatusBarLeft>{left}</StyledStatusBarLeft>\n      <StyledStatusBarRight>{right}</StyledStatusBarRight>\n    </StyledStatusBar>\n  );\n};\n\nconst StyledStatusBar = styled.div`\n  box-sizing: border-box;\n  padding: 0 0.25rem;\n  display: flex;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between; // because there is left and right sides\n  background-color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.background\" as UnknownThemeProp<\"StatusBar.background\">,\n      theme.color(\"Panel.background\" as UnknownThemeProp<\"Panel.background\">)\n    ) || \"#fff\"};\n  color: ${({ theme }) =>\n    theme.color(\n      \"StatusBar.Widget.foreground\" as UnknownThemeProp<\"StatusBar.Widget.foreground\">,\n      theme.commonColors.labelForeground\n    )};\n  border-top: 1px solid\n    ${({ theme }) => theme.color(\"StatusBar.borderColor\", \"rgb(145, 145, 145)\")};\n  height: calc(1.25rem + 1px /* border*/);\n  line-height: 1.25rem;\n  font-size: 0.656rem; // not verified\n  cursor: default;\n`;\n\nconst StyledStatusBarSection = styled.div`\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n`;\n\nconst StyledStatusBarRight = styled(StyledStatusBarSection)`\n  flex-shrink: 0;\n`;\nconst StyledStatusBarLeft = styled(StyledStatusBarSection)`\n  flex-shrink: 1;\n  min-width: 0;\n  overflow: hidden;\n`;\n","import React, { ForwardedRef } from \"react\";\nimport { PressProps, usePress } from \"@react-aria/interactions\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useFocusable } from \"@react-aria/focus\";\n\nexport interface StatusBarWidgetProps extends PressProps {\n  label?: React.ReactNode;\n  icon?: React.ReactNode;\n}\n\n/**\n * Status bar button (aka widget), with the right hover and pressed appearance.\n * It doesn't get focused when pressed, and is excluded from tab order.\n * Disabled style is not couldn't be found, so it's skipped at the moment.\n */\nexport const StatusBarWidget = React.forwardRef(function StatusBarWidget(\n  props: StatusBarWidgetProps,\n  forwardedRef: ForwardedRef<HTMLSpanElement>\n) {\n  const ref = useObjectRef(forwardedRef);\n  // Maybe it's better for a11y to use useButton, or at least use button element?\n  const { pressProps, isPressed } = usePress({\n    ref,\n    ...props,\n    preventFocusOnPress: true,\n  });\n  const { focusableProps } = useFocusable({ excludeFromTabOrder: true }, ref);\n\n  const StyledWrapper = props.label\n    ? StyledStatusBarWidget\n    : StyledStatusBarIconWidget;\n  return (\n    <StyledWrapper\n      {...mergeProps(pressProps, focusableProps)}\n      className={isPressed ? \"pressed\" : \"\"}\n      ref={ref}\n    >\n      {props.icon}\n      {props.icon && props.label && (\n        <>&nbsp;</> //not the nicest way to handle spacing!\n      )}\n      {props.label}\n    </StyledWrapper>\n  );\n});\n\nconst StyledStatusBarWidget = styled.span`\n  display: inline-flex;\n  align-items: center;\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.375rem\"};\n  height: 1.125rem;\n  white-space: nowrap;\n  &:hover {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverBackground\" as UnknownThemeProp<\"StatusBar.Widget.hoverBackground\">,\n        theme.color(\"ActionButton.hoverBackground\", \"#dfdfdf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.hoverForeground\" as UnknownThemeProp<\"StatusBar.Widget.hoverForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n  &.pressed {\n    background-color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedBackground\" as UnknownThemeProp<\"StatusBar.Widget.pressedBackground\">,\n        theme.color(\"ActionButton.pressedBackground\", \"#cfcfcf\")\n      )};\n    color: ${({ theme }) =>\n      theme.color(\n        \"StatusBar.Widget.pressedForeground\" as UnknownThemeProp<\"StatusBar.Widget.pressedForeground\">,\n        theme.commonColors.labelForeground\n      )};\n  }\n`;\n\nconst StyledStatusBarIconWidget = styled(StyledStatusBarWidget)`\n  padding: ${({ theme }) =>\n    theme.inset(\n      \"StatusBar.Widget.widgetInsets\" as UnknownThemeProp<\"StatusBar.Widget.widgetInsets\">\n    ) ?? \"0 0.25rem\"};\n`;\n","import React from \"react\";\nimport { styled } from \"./styled\";\n\ntype SeparatorUI = {\n  STRIPE_INDENT: number;\n  STRIPE_WIDTH: number;\n};\n\n// based on implementation in com.intellij.ide.ui.laf.darcula.ui.DarculaSeparatorUI, which seems to be used for all themes\nconst DarculaSeparatorUI: SeparatorUI = {\n  STRIPE_INDENT: 1,\n  STRIPE_WIDTH: 1,\n};\n\nconst defaultSize =\n  2 * DarculaSeparatorUI.STRIPE_INDENT + DarculaSeparatorUI.STRIPE_WIDTH;\n\nexport const StyledSeparator = styled.hr(({ theme }) => ({\n  backgroundColor: theme.color(\n    \"Separator.separatorColor\",\n    theme.dark ? \"#cdcdcd\" : \"#515151\"\n  ),\n  backgroundClip: \"content-box\",\n  boxSizing: \"border-box\",\n  margin: 0,\n  border: \"none\",\n  flexShrink: 0,\n}));\n\nexport const StyledHorizontalSeparator = styled(StyledSeparator)`\n  height: inherit; // should it be auto?\n  padding: 0 ${DarculaSeparatorUI.STRIPE_INDENT}px;\n  width: ${defaultSize}px;\n`;\nexport const StyledVerticalSeparator = styled(StyledSeparator)`\n  width: auto;\n  padding: ${DarculaSeparatorUI.STRIPE_INDENT}px 0;\n  height: ${defaultSize}px;\n`;\n","import React from \"react\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport {\n  TabContentLayout,\n  TabItemLayoutProps,\n} from \"@intellij-platform/core/Tabs/TabContentLayout\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { BareButton } from \"@intellij-platform/core/Button\";\n\ninterface EditorTabContentProps {\n  icon: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button, shown in place of \"pin\" button if not pinned. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <EditorTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactElement;\n  onUnpin?: () => void;\n  pinned?: boolean;\n  containerProps?: TabItemLayoutProps[\"containerProps\"];\n}\n/**\n * For rendering the content of Editor tabs. supports for file icon which is shown on the left and close or unpin\n * button shown on the right.\n */\nexport const EditorTabContent = ({\n  icon,\n  title,\n  closeButton,\n  onUnpin,\n  pinned,\n  containerProps,\n}: EditorTabContentProps) => {\n  return (\n    <TabContentLayout\n      startIcon={icon}\n      title={title}\n      containerProps={containerProps}\n      endIcon={\n        pinned ? (\n          <TooltipTrigger tooltip={<ActionTooltip actionName=\"Unpin Tab\" />}>\n            <BareButton\n              onPress={onUnpin}\n              excludeFromTabOrder\n              preventFocusOnPress\n            >\n              <PlatformIcon icon=\"actions/pinTab\" />\n            </BareButton>\n          </TooltipTrigger>\n        ) : (\n          closeButton\n        )\n      }\n    />\n  );\n};\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme, UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const editorTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"EditorTabs.borderColor\"),\n  underlineHeight: theme.value<number>(\"EditorTabs.underlineHeight\"),\n  background: theme.color(\"EditorTabs.background\"),\n  underlinedTabInactiveBackground: theme.color(\n    \"EditorTabs.underlinedTabBackground\" // that's correctly not underlinedTabInactiveBackground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabBackground: theme.color(\"EditorTabs.underlinedTabBackground\"), // TODO: use EditorColorsScheme when available\n  hoverInactiveBackground: theme.color(\n    \"EditorTabs.hoverInactiveBackground\" as UnknownThemeProp<\"EditorTabs.hoverInactiveBackground\">\n  ),\n  hoverBackground: theme.color(\"EditorTabs.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\"EditorTabs.inactiveUnderlineColor\"), // TODO: use EditorColorsScheme when available\n  underlineColor: theme.color(\"EditorTabs.underlineColor\"), // TODO: use EditorColorsScheme when available\n\n  underlinedTabInactiveForeground: theme.color(\n    \"EditorTabs.underlinedTabForeground\" // that's correctly not underlinedTabInactiveForeground!\n  ), // TODO: use EditorColorsScheme when available\n  underlinedTabForeground: theme.color(\"EditorTabs.underlinedTabForeground\"), // TODO: use EditorColorsScheme when available\n});\nexport const StyledEditorTab = styled(StyledDefaultTab)`\n  font-size: 0.7rem;\n  ${({ theme }) => getTabThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { editorTabTheme } from \"./StyledEditorTab\";\n\nexport const StyledEditorTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(editorTabTheme({ theme }))};\n`;\n","import { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledEditorTab } from \"./StyledEditorTab\";\nimport { StyledEditorTabs } from \"./StyledEditorTabs\";\nimport React from \"react\";\n\nexport type EditorTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const EditorTabs = <T extends object>(props: EditorTabsProps<T>) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledEditorTab}\n    TabsComponent={StyledEditorTabs}\n    focusable={false}\n  />\n);\n","import { getTabThemeStyles } from \"./TabTheme\";\nimport { styled } from \"../styled\";\nimport { Theme, UnknownThemeProp } from \"../Theme\";\n\nexport type StyledTabProps = {\n  selected?: boolean;\n  disabled?: boolean;\n  active?: boolean;\n};\n\nconst defaultTabTheme = ({ theme }: { theme: Theme }) =>\n  getTabThemeStyles({\n    underlineHeight: theme.value<number>(\"DefaultTabs.underlineHeight\") ?? 3,\n    inactiveUnderlineColor: theme.color(\n      \"DefaultTabs.inactiveUnderlineColor\",\n      theme.dark ? \"#747a80\" : \"#9ca7b8\"\n    ),\n    underlineColor: theme.color(\n      \"DefaultTabs.underlineColor\",\n      theme.dark ? \"#4A88C7\" : \"#4083C9\"\n    ),\n\n    underlinedTabInactiveForeground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveForeground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveForeground\">\n    ),\n    underlinedTabForeground: theme.color(\"DefaultTabs.underlinedTabForeground\"),\n\n    background: theme.color(\n      \"DefaultTabs.background\",\n      theme.dark ? \"#3C3F41\" : \"#ECECEC\"\n    ),\n    underlinedTabInactiveBackground: theme.color(\n      \"DefaultTabs.underlinedTabInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabInactiveBackground\">\n    ),\n    underlinedTabBackground: theme.color(\n      \"DefaultTabs.underlinedTabBackground\" as UnknownThemeProp<\"DefaultTabs.underlinedTabBackground\">\n    ),\n    hoverInactiveBackground: theme.color(\n      \"DefaultTabs.hoverInactiveBackground\" as UnknownThemeProp<\"DefaultTabs.hoverInactiveBackground\">,\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n    hoverBackground: theme.color(\n      \"DefaultTabs.hoverBackground\",\n      theme.dark ? \"rgba(0,0,0,.35)\" : \"rgba(0,0,0,.1)\"\n    ),\n  });\n\nexport const StyledDefaultTab = styled.div<StyledTabProps>`\n  box-sizing: border-box;\n  display: inline-flex;\n  letter-spacing: 0.015rem;\n  font-size: 0.85rem;\n  cursor: default;\n  white-space: nowrap;\n\n  // spacing\n  padding: 0 0.5rem;\n  line-height: 1.7rem; // vertical spacing handled by line-height\n\n  // disabled state doesn't seem to be supported in Intellij Platform at all.\n  opacity: ${({ disabled }) => (disabled ? \".5\" : \"1\")};\n  color: ${({ theme }) =>\n    theme.color(\n      \"DefaultTabs.foreground\" as UnknownThemeProp<\"DefaultTabs.foreground\">\n    )};\n\n  position: relative;\n  &::after {\n    content: \"\";\n    position: absolute;\n    width: 100%;\n    left: 0;\n    bottom: 0;\n  }\n\n  ${defaultTabTheme};\n`;\n","import { Theme } from \"../Theme\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"./TabTheme\";\n\nconst defaultTabsTheme = ({ theme }: { theme: Theme }) =>\n  getTabsThemeStyles({\n    borderColor: theme.color(\n      \"DefaultTabs.borderColor\",\n      theme.commonColors.contrastBorder\n    ),\n    background: theme.color(\"DefaultTabs.background\"),\n  });\n\nexport const StyledDefaultTabs = styled.div<{ noBorders?: boolean }>`\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  border-style: solid;\n  border-width: ${({ noBorders }) => (noBorders ? \"0\" : \"1px 0\")};\n\n  ${defaultTabsTheme};\n`;\n","import React from \"react\";\nimport { BareButton, BareButtonProps } from \"@intellij-platform/core/Button\";\nimport { PlatformIcon } from \"../Icon\";\nimport { styled } from \"../styled\";\n\nconst StyledIconWrapper = styled.span`\n  display: inherit;\n  .icon.hover {\n    display: none;\n  }\n  &:hover {\n    .icon {\n      display: none;\n    }\n    .icon.hover {\n      display: unset;\n    }\n  }\n`;\n/**\n * Close button for Tab\n */\nexport const TabCloseButton = (props: Omit<BareButtonProps, \"children\">) => {\n  // using useHover proved to be unstable.\n  return (\n    <BareButton {...props} excludeFromTabOrder preventFocusOnPress>\n      <StyledIconWrapper>\n        <PlatformIcon icon={\"actions/closeHovered\"} className=\"icon hover\" />\n        <PlatformIcon icon={\"actions/close\"} className=\"icon\" />\n      </StyledIconWrapper>\n    </BareButton>\n  );\n};\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { css, styled } from \"../styled\";\nimport { useFocusable } from \"@react-aria/focus\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\n\nconst StyledTabItemLayout = styled.div`\n  display: inline-flex;\n  align-items: center;\n`;\n\nconst iconStyle = css`\n  display: inline-flex; // without this, the wrapper takes the full height, causing icon to be placed on top\n  margin-top: -0.1rem; // seems necessary for pixel perfect match with the original impl\n`;\n\nconst StyledStartIconWrapper = styled.span`\n  ${iconStyle};\n  margin-right: 0.25rem;\n`;\n\nconst StyledEndIconWrapper = styled.span`\n  ${iconStyle};\n  margin-left: 0.25rem;\n  margin-right: -0.25rem; // default padding of the tab should be a little reduced when close icon is there.\n  border-radius: 16px;\n`;\n\nexport interface TabItemLayoutProps {\n  /**\n   * the icon placed before the text.\n   */\n  startIcon?: React.ReactNode;\n  /**\n   * title of the tab. Normally just a string\n   */\n  title?: React.ReactNode;\n  /**\n   * the icon placed after the text. Typical use cases: close or pin icon.\n   */\n  endIcon?: React.ReactNode;\n\n  /**\n   * Generic HTML props passed to the container div.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n}\n\n/**\n * Helper component for rendering the common layout of tab content.\n */\nexport const TabContentLayout = React.forwardRef(\n  (\n    { startIcon, title, endIcon, containerProps = {} }: TabItemLayoutProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    // To allow tooltip be used easily. TooltipTrigger passes props via FocusableContext.\n    const { focusableProps } = useFocusable({}, useObjectRef(ref));\n    return (\n      <StyledTabItemLayout\n        {...mergeProps(focusableProps, containerProps)}\n        ref={ref}\n      >\n        {startIcon && (\n          <StyledStartIconWrapper>{startIcon}</StyledStartIconWrapper>\n        )}\n        {title}\n        {endIcon && <StyledEndIconWrapper>{endIcon}</StyledEndIconWrapper>}\n      </StyledTabItemLayout>\n    );\n  }\n);\n","import { ItemProps } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport React from \"react\";\n\nexport interface TabItemProps extends ItemProps<never> {\n  /**\n   * Determines how the tab item should look when rendered as a menu item in overflow menu.\n   * If not passed, `textValue` will be used.\n   * @example\n   * <TabItem\n   *   key={tab.id}\n   *   textValue={tab.title}\n   *   inOverflowMenu={\n   *     <MenuItemLayout content={tab.title} icon={icon} />\n   *   }\n   *  >\n   *   <TabContentLayout startIcon={icon} title={tab.title} />\n   * </TabItem>\n   */\n  inOverflowMenu?: React.ReactNode;\n}\n\n/**\n * Same as {@link Item}, but allows for specifying the tab content for when it's rendered in the overflow menu item.\n */\nexport const TabItem: (props: TabItemProps) => React.ReactElement = Item;\n","import { css } from \"@intellij-platform/core/styled\";\nimport { StyledTabProps } from \"./StyledDefaultTab\";\n\n/**\n * Describes theme-able properties of a tab, which can then be passed to {@link getTabThemeStyles}\n */\nexport interface TabTheme {\n  underlineHeight?: number;\n\n  borderColor?: string;\n\n  inactiveUnderlineColor?: string;\n  underlineColor?: string;\n\n  underlinedTabInactiveForeground?: string;\n  underlinedTabForeground?: string;\n\n  background?: string;\n  underlinedTabBackground?: string;\n  underlinedTabInactiveBackground?: string;\n  hoverInactiveBackground?: string;\n  hoverBackground?: string;\n  inactiveColoredTabBackground?: string; // not used for now\n}\n\nexport const getTabsThemeStyles = ({\n  background,\n  borderColor,\n}: Pick<TabTheme, \"background\" | \"borderColor\">) => css`\n  border-color: ${borderColor};\n  background: ${background};\n`;\n\n/**\n * Converts tab theme properties to a chunk of style that can be dropped in a styled version of StyledDefaultTab\n *\n * @example\n * ```ts\n * const StyledCustomTab = styled(StyledDefaultTab)`\n *   ${getTabThemeStyles({background: 'red'})}\n * `\n * ```\n */\nexport const getTabThemeStyles = ({\n  underlineHeight,\n\n  background,\n  underlinedTabBackground,\n  underlinedTabInactiveBackground,\n  hoverInactiveBackground,\n  hoverBackground,\n\n  underlinedTabForeground,\n  underlinedTabInactiveForeground,\n\n  inactiveUnderlineColor,\n  underlineColor,\n}: TabTheme) =>\n  css<StyledTabProps>`\n    // active indicator\n    &::after {\n      height: ${underlineHeight != null ? `${underlineHeight}px` : undefined};\n      background-color: ${({ selected }) => selected && inactiveUnderlineColor};\n      background-color: ${({ selected, active }) =>\n        selected && active && underlineColor};\n    }\n\n    // foreground rules\n    color: ${({ selected }) => selected && underlinedTabInactiveForeground};\n    color: ${({ selected, active }) =>\n      selected && active && underlinedTabForeground};\n\n    //  background rules\n    background: ${background};\n    background: ${({ selected }) =>\n      selected && underlinedTabInactiveBackground};\n    background: ${({ selected, active }) =>\n      selected && active && underlinedTabBackground};\n\n    ${({ disabled, active }) =>\n      !disabled &&\n      css`\n        &:hover,\n        &.hover /* for testing purposes */ {\n          background: ${hoverInactiveBackground};\n          background: ${active && hoverBackground};\n        }\n      `}\n  `;\n","import { css, styled } from \"@intellij-platform/core/styled\";\n\ninterface Props {\n  hasOverflowAtStart: boolean;\n  hasOverflowAtEnd: boolean;\n}\n\nconst horizontalOverflowIndicatorStyles = css`\n  content: \"\";\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 10px;\n  z-index: 1;\n`;\nexport const StyledHorizontalOverflowShadows = styled.div<Props>`\n  position: relative; // for overflow indicator (pseudo-)elements to be positioned absolute\n\n  /* FIXME: find out what color, width and gradient parameters are used in the original implementation */\n  ${({ hasOverflowAtStart }) =>\n    hasOverflowAtStart &&\n    css`\n      ::before {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        left: 0;\n      }\n    `};\n  ${({ hasOverflowAtEnd }) =>\n    hasOverflowAtEnd &&\n    css`\n      ::after {\n        ${horizontalOverflowIndicatorStyles};\n        background: linear-gradient(\n          -90deg,\n          ${({ theme }) => theme.commonColors.panelBackground} 0%,\n          transparent 100%\n        );\n        right: 0;\n      }\n    `};\n`;\n","import { useTab } from \"@react-aria/tabs\";\nimport { TabListState } from \"@react-stately/tabs\";\nimport { Node } from \"@react-types/shared\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport React, { ForwardedRef, forwardRef, RefObject, useEffect } from \"react\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\n\ntype TabProps<T extends object> = {\n  state: TabListState<object>;\n  item: Node<T>;\n  /**\n   * {@see TabsProps#focusable}\n   */\n  focusable?: boolean;\n  /**\n   * {@see TabsProps#active}\n   */\n  active?: boolean;\n  shouldSelectOnPressUp?: boolean;\n  Component?: typeof StyledDefaultTab;\n};\n\nexport const Tab = forwardRef(function Tab<T extends object>(\n  {\n    state,\n    item,\n    focusable,\n    active,\n    shouldSelectOnPressUp,\n    Component = StyledDefaultTab,\n  }: TabProps<T>,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): React.ReactElement {\n  const { key, rendered } = item;\n  const ref = useForwardedRef(forwardedRef);\n  const {\n    tabProps: {\n      /**\n       * by extracting out tabIndex, all keyboard support of the tabs is disabled, since we prevent the tab from being\n       * focusable.\n       */\n      tabIndex,\n      ...tabProps\n    },\n  } = useTab(\n    {\n      key,\n      shouldSelectOnPressUp,\n    },\n    state,\n    ref\n  );\n  const isSelected = state.selectedKey === key;\n  const isDisabled = state.disabledKeys.has(key);\n\n  return (\n    <Component\n      {...tabProps}\n      tabIndex={focusable ? tabIndex : undefined}\n      ref={ref}\n      active={active}\n      selected={isSelected}\n      disabled={isDisabled}\n    >\n      {rendered}\n    </Component>\n  );\n});\n","import React, { Key, useEffect } from \"react\";\nimport { useTabList } from \"@react-aria/tabs\";\nimport { filterDOMProps, mergeProps, scrollIntoView } from \"@react-aria/utils\";\nimport { useTabListState } from \"@react-stately/tabs\";\nimport { AriaTabListProps } from \"@react-types/tabs\";\nimport { StyledHorizontalOverflowShadows } from \"./StyledHorizontalOverflowShadows\";\nimport { TabsOverflowMenu } from \"./TabsOverflowMenu\";\nimport { useOverflowObserver } from \"../utils/overflow-utils/useOverflowObserver\";\nimport { useHasOverflow } from \"./useHasOverflow\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\nimport { StyledDefaultTab } from \"./StyledDefaultTab\";\nimport { StyledDefaultTabs } from \"./StyledDefaultTabs\";\nimport { Tab } from \"./Tab\";\n\nexport type TabsProps<T> = Omit<\n  AriaTabListProps<T>,\n  \"orientation\" | \"isDisabled\" | \"\"\n> & {\n  /**\n   * Whether tabs should be focusable or not. By default, following the Intellij Platform implementation, tabs are\n   * not focusable and therefore lack the keyboard accessibility support specified in WAI-ARIA.\n   * You can change this default behaviour and make the tabs keyboard accessible by passing `focusable`.\n   * focus styles are not perfect at the moment, since it's not considered an important feature.\n   * @default false\n   */\n  focusable?: boolean;\n\n  /**\n   * Whether selected tab should change on press up instead of press down.\n   * @default false.\n   */\n  shouldSelectOnPressUp?: boolean;\n\n  /**\n   * Enables \"active\" style on tabs. Is usually related to a container having focus.\n   */\n  active?: boolean;\n\n  /**\n   * If set to true, tabs will be wrapped into multiple rows if needed.\n   * NOTE: In the original implementation, in multi row mode, rows are separated by a border. It's not easy to achieve\n   * this when we are implementing this feature with a simple `flex-wrap: wrap` css rule. It doesn't seem that\n   * important, but we can achieve something similar by some css tricks like the ones suggested here:\n   * https://stackoverflow.com/questions/36128333/row-lines-for-flex-container-css\n   * @default false\n   */\n  multiRow?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * If set to true and multiRow is not true, it will prevent horizontal scroll of tabs. Depending on the value of\n   * In this case:\n   * - if {@link noOverflowMenu} is not set to true, tabs that can't be fitted into the available space will be\n   *   accessible via an overflow menu.\n   * - if {@link noOverflowMenu} is set to true, the tabs will be fitted into the available space, and they will\n   *   be shrunk when needed.\n   *\n   * @todo: not implemented yet.\n   * @default false\n   */\n  noScroll?: boolean;\n\n  /**\n   * Only effective when {@link multiRow} is not true.\n   * When set to true, tabs that couldn't be fitted into the available space, are either shrunk (if {@link noScroll}\n   * is set to true), or are just accessible by scroll.\n   */\n  noOverflowMenu?: boolean;\n\n  /**\n   * Removes the top and bottom border when passed.\n   * It's still not clear whether such option makes sense or not, but\n   * at least in common use cases like in tool windows, it seems borders are already there and there should be a way\n   * of removing tab borders. On the other hand, when Tabs is used without any assumption about the surrounding UI,\n   * it kind of makes sense to have the top and bottom borders by default. So that's why this is made an option for\n   * now, maybe until things are clearer.\n   *\n   * @default false\n   */\n  noBorders?: boolean;\n\n  TabsComponent?: typeof StyledDefaultTabs;\n  /**\n   *\n   */\n  TabComponent?: typeof StyledDefaultTab;\n};\n\nconst scrollBarDisabledStyle = css`\n  -ms-overflow-style: none; /* for Internet Explorer, Edge */\n  scrollbar-width: none; /* for Firefox */\n  &::-webkit-scrollbar {\n    /* for Chrome/Safari/Webkit */\n    display: none;\n  }\n`;\n\nconst StyledTabList = styled.div<{ multiRow?: boolean }>`\n  display: flex;\n  flex-wrap: ${({ multiRow }) => (multiRow ? \"wrap\" : \"nowrap\")};\n  overflow: auto;\n\n  ${scrollBarDisabledStyle};\n`;\n\n/**\n *\n * TODO: add support for overflow:\n *  - have vertical scroll also scroll tabs\n *  - add support for re-reordering tabs.\n *  - FIX: When a tab that was not selected is removed, selection should not change. It now changes to the tab before the removed one.\n */\nexport const Tabs = <T extends object>({\n  focusable,\n  shouldSelectOnPressUp,\n  active,\n  TabComponent,\n  TabsComponent = StyledDefaultTabs,\n  multiRow,\n  noOverflowMenu,\n  noScroll,\n  noBorders,\n  ...props\n}: TabsProps<T>): React.ReactElement => {\n  const state = useTabListState(props);\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { tabListProps } = useTabList(props, state, ref);\n\n  const { scrolledIndicatorProps, hasOverflow } = useHasOverflow({ ref });\n  const { overflowedElements } = useOverflowObserver(ref);\n  const overflowedKeys = new Set(\n    overflowedElements\n      .map((element) =>\n        element instanceof HTMLElement ? element.dataset[\"key\"] : null\n      )\n      .filter(notNull)\n  );\n\n  useEffect(() => {\n    if (!noScroll) {\n      const scrollableContainer = ref.current;\n      const selectedTabElement = scrollableContainer?.querySelector(\n        `[data-key=\"${state.selectedKey}\"]`\n      ) as HTMLElement;\n      if (scrollableContainer && selectedTabElement) {\n        scrollIntoView(scrollableContainer, selectedTabElement);\n      }\n    } else {\n      // TODO maybe? sample use case: project tool window tabs, when not grouped.\n    }\n  }, [state.selectedKey]);\n  const onOverflowMenuItemSelected = (key: Key) => {\n    state.setSelectedKey(key);\n  };\n  if (noScroll) {\n    throw new Error(\"noScroll is not supported yet.\");\n  }\n  return (\n    <TabsComponent noBorders={noBorders} {...filterDOMProps(props)}>\n      <StyledHorizontalOverflowShadows\n        hasOverflowAtStart={hasOverflow.left}\n        hasOverflowAtEnd={hasOverflow.right}\n        style={{ minWidth: 0 }}\n      >\n        <StyledTabList\n          {...mergeProps(tabListProps, scrolledIndicatorProps)}\n          multiRow={multiRow}\n          ref={ref}\n        >\n          {[...state.collection].map((item) => (\n            <Tab\n              key={item.key}\n              item={item}\n              state={state}\n              focusable={focusable}\n              shouldSelectOnPressUp={shouldSelectOnPressUp}\n              active={active}\n              Component={TabComponent}\n            />\n          ))}\n        </StyledTabList>\n      </StyledHorizontalOverflowShadows>\n      {!noOverflowMenu && (\n        <TabsOverflowMenu\n          collection={state.collection}\n          overflowedKeys={overflowedKeys}\n          onSelect={onOverflowMenuItemSelected}\n        />\n      )}\n    </TabsComponent>\n  );\n};\n","import { RefObject, UIEventHandler, useEffect, useState } from \"react\";\n\nexport function useHasOverflow<T extends HTMLElement>({\n  threshold = 5,\n  ref,\n}: {\n  threshold?: number;\n  ref: RefObject<T>;\n}) {\n  const [hasOverflow, setHasOverflow] = useState({\n    left: false,\n    right: false,\n    top: false,\n    bottom: false,\n  });\n\n  const update = () => {\n    const element = ref.current;\n    if (element) {\n      const offsetLeft = element.scrollLeft;\n      const offsetRight =\n        element.scrollWidth - (element.offsetWidth + element.scrollLeft);\n      const offsetTop = element.scrollTop;\n      const offsetBottom =\n        element.scrollHeight - (element.offsetHeight + element.scrollTop);\n      const newHasOverflow = {\n        top: offsetTop > threshold,\n        bottom: offsetBottom > threshold,\n        left: offsetLeft > threshold,\n        right: offsetRight > threshold,\n      };\n      if (\n        hasOverflow.top !== newHasOverflow.top ||\n        hasOverflow.bottom !== newHasOverflow.bottom ||\n        hasOverflow.left !== newHasOverflow.left ||\n        hasOverflow.right !== newHasOverflow.right\n      ) {\n        setHasOverflow(newHasOverflow);\n      }\n    }\n  };\n  useEffect(update);\n\n  return {\n    scrolledIndicatorProps: {\n      onScroll: update as UIEventHandler<T>,\n    },\n    hasOverflow,\n  };\n}\n","import { Collection, Node } from \"@react-types/shared\";\nimport { Item } from \"@react-stately/collections\";\nimport { Menu, MenuTrigger } from \"@intellij-platform/core/Menu\";\nimport { IconButton } from \"@intellij-platform/core/IconButton\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport React, { Key } from \"react\";\n\nexport const TabsOverflowMenu = <T extends unknown>({\n  collection,\n  overflowedKeys,\n  onSelect,\n}: {\n  collection: Collection<Node<T>>;\n  overflowedKeys: Set<Key>;\n  onSelect: (key: Key) => void;\n}) => (\n  <>\n    {overflowedKeys.size > 0 && (\n      <MenuTrigger\n        align=\"end\"\n        renderMenu={({ menuProps }) => {\n          const items: Iterable<Node<unknown>> = [...collection].filter(\n            (menuItem) => overflowedKeys.has(menuItem.key)\n          );\n          return (\n            <Menu\n              {...menuProps}\n              onAction={(key) => {\n                onSelect(key);\n              }}\n              items={items}\n            >\n              {(item) => (\n                <Item key={item.key} textValue={item.textValue}>\n                  {item.props.inOverflowMenu || item.textValue}\n                </Item>\n              )}\n            </Menu>\n          );\n        }}\n      >\n        {(props, ref) => (\n          <IconButton {...props} ref={ref}>\n            <PlatformIcon icon=\"actions/findAndShowNextMatches\" />\n          </IconButton>\n        )}\n      </MenuTrigger>\n    )}\n  </>\n);\n","import React, { ForwardedRef, HTMLProps } from \"react\";\nimport { TabCloseButton } from \"@intellij-platform/core/Tabs/TabCloseButton\";\nimport { TabContentLayout } from \"@intellij-platform/core/Tabs/TabContentLayout\";\n\ntype ToolWindowTabContentProps = {\n  icon?: React.ReactNode;\n  title: React.ReactNode;\n  /**\n   * Close button for the tab. Use {@link TabCloseButton} to render the close button\n   * for the tab.\n   *\n   * @example\n   * ```tsx\n   * <ToolWindowTabContent\n   *   closeButton={\n   *     <TooltipTrigger\n   *       tooltip={<ActionTooltip actionName=\"Close Tab\" shortcut=\"^F4\" />}\n   *     >\n   *       <TabCloseButton onPress={}></TabCloseButton>\n   *     </TooltipTrigger>\n   *   }\n   * />\n   * ```\n   */\n  closeButton?: React.ReactNode;\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">;\n};\n\nexport const ToolWindowTabContent = React.forwardRef(\n  (\n    { icon, title, closeButton, containerProps }: ToolWindowTabContentProps,\n    ref: ForwardedRef<HTMLDivElement>\n  ) => {\n    return (\n      <TabContentLayout\n        containerProps={containerProps}\n        ref={ref}\n        startIcon={icon}\n        title={title}\n        endIcon={closeButton}\n      />\n    );\n  }\n);\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { Theme } from \"@intellij-platform/core/Theme\";\nimport { StyledDefaultTab } from \"@intellij-platform/core/Tabs/StyledDefaultTab\";\nimport {\n  getTabThemeStyles,\n  TabTheme,\n} from \"@intellij-platform/core/Tabs/TabTheme\";\n\nexport const toolWindowTabTheme = ({ theme }: { theme: Theme }): TabTheme => ({\n  borderColor: theme.color(\"ToolWindow.HeaderTab.borderColor\"),\n  underlineHeight: theme.value<number>(\"ToolWindow.HeaderTab.underlineHeight\"),\n  background: \"transparent\",\n  underlinedTabInactiveBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabInactiveBackground\"\n  ),\n  underlinedTabBackground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabBackground\"\n  ),\n  hoverInactiveBackground:\n    theme.color(\"ToolWindow.HeaderTab.hoverInactiveBackground\") ??\n    theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  hoverBackground: theme.color(\"ToolWindow.HeaderTab.hoverBackground\"),\n  inactiveUnderlineColor: theme.color(\n    \"ToolWindow.HeaderTab.inactiveUnderlineColor\"\n  ),\n  underlineColor: theme.color(\"ToolWindow.HeaderTab.underlineColor\"),\n\n  underlinedTabInactiveForeground:\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabInactiveForeground\") ??\n    theme.color(\"ToolWindow.HeaderTab.underlinedTabForeground\"),\n  underlinedTabForeground: theme.color(\n    \"ToolWindow.HeaderTab.underlinedTabForeground\"\n  ),\n});\nexport const StyledToolWindowTab = styled(StyledDefaultTab)`\n  padding: 0 0.7rem;\n  ${({ theme }) => getTabThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { getTabsThemeStyles } from \"@intellij-platform/core/Tabs/TabTheme\";\nimport { StyledDefaultTabs } from \"@intellij-platform/core/Tabs/StyledDefaultTabs\";\nimport { toolWindowTabTheme } from \"./StyledToolWindowTab\";\n\nexport const StyledToolWindowTabs = styled(StyledDefaultTabs)`\n  ${({ theme }) => getTabsThemeStyles(toolWindowTabTheme({ theme }))};\n`;\n","import React from \"react\";\nimport { Tabs, TabsProps } from \"@intellij-platform/core/Tabs/Tabs\";\nimport { StyledToolWindowTab } from \"./StyledToolWindowTab\";\nimport { StyledToolWindowTabs } from \"./StyledToolWindowTabs\";\n\ntype ToolWindowTabsProps<T extends object> = Omit<\n  TabsProps<T>,\n  \"TabComponent\" | \"TabsComponent\" | \"focusable\"\n>;\n\nexport const ToolWindowTabs = <T extends object>(\n  props: ToolWindowTabsProps<T>\n) => (\n  <Tabs\n    {...props}\n    TabComponent={StyledToolWindowTab}\n    TabsComponent={StyledToolWindowTabs}\n    focusable={false}\n    shouldSelectOnPressUp\n  />\n);\n","export type TextRange = { from: number; to: number };\n\nexport function isEmptyRange(range: TextRange) {\n  return range.from > range.to;\n}\n\nexport function getAllRanges(\n  ranges: TextRange[],\n  length: number\n): Array<[TextRange, boolean]> {\n  const result: Array<[TextRange, boolean]> = [];\n  if (!ranges?.length) {\n    return [[{ from: 0, to: length - 1 }, false]];\n  }\n  if (ranges[0].from > 0) {\n    result.push([{ from: 0, to: ranges[0].from - 1 }, false]);\n  }\n  ranges.forEach(({ from, to }, index) => {\n    result.push([{ from, to }, true]);\n    const gapRange: TextRange = ranges[index + 1]\n      ? { from: to + 1, to: ranges[index + 1].from - 1 }\n      : { from: to + 1, to: length - 1 };\n    if (!isEmptyRange(gapRange)) {\n      result.push([gapRange, false]);\n    }\n  });\n  return result;\n}\n\nexport function createRangesFromIndices(indices: number[]): TextRange[] {\n  return indices.reduce((ranges, index) => {\n    const lastRange = ranges.slice(-1)[0];\n    if (lastRange?.to === index - 1) {\n      return [...ranges.slice(0, -1), { from: lastRange.from, to: index }];\n    }\n    return [...ranges, { from: index, to: index }];\n  }, [] as TextRange[]);\n}\n","import React from \"react\";\nimport { getAllRanges, TextRange } from \"../TextRange\";\nimport { styled } from \"../styled\";\n\nconst HighlightedMatch = styled.span`\n  background: ${({ theme }) =>\n    `linear-gradient(${theme.color(\n      \"SearchMatch.startBackground\",\n      \"#ffeaa2b3\"\n    )}, ${theme.color(\"SearchMatch.endBackground\", \"#ffd042b3\")})`};\n  color: #000;\n  border-radius: 3px;\n`;\n\n/**\n * Renders the children (which must be a string), with highlights wrapped in spans with the highlight style.\n * Note: this component doesn't render a container. It just highlights the specified ranges.\n */\nexport function TextWithHighlights({\n  children,\n  highlights,\n}: {\n  children: string;\n  highlights: TextRange[] | null;\n}): React.ReactElement {\n  const parts: Array<[TextRange, boolean]> = highlights\n    ? getAllRanges(highlights, children.length)\n    : [[{ from: 0, to: children.length }, false]];\n  return (\n    <>\n      {parts.map(([{ from, to }, highlighted]) => {\n        const text = children.slice(from, to + 1);\n        return (\n          // TODO: key\n          <React.Fragment key={`${from}_${to}`}>\n            {highlighted ? <HighlightedMatch>{text}</HighlightedMatch> : text}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n","// language=JSRegexp\nconst numberPattern = \"[0-9]{0,3}.?[0-9]*\";\n\nconst parseComponent = (componentStr: string, index: number) =>\n  componentStr\n    ? index < 3\n      ? parseInt(componentStr)\n      : Math.round(Math.min(parseFloat(componentStr), 1) * 255)\n    : undefined;\n\nconst parseHexRgba = (str: string) =>\n  str\n    .match(/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})?$/i)\n    ?.slice(1, 5)\n    .map((i) => (i ? parseInt(i, 16) : undefined));\nconst parseShorthandHex = (str: string) =>\n  str\n    .match(/^#?([0-9A-F])([0-9A-F])([0-9A-F])$/i)\n    ?.slice(1, 4)\n    .map((i) => (i ? parseInt(i + i, 16) : undefined));\nconst parseRgb = (str: string) =>\n  str\n    .match(\n      new RegExp(\n        `^rgb\\\\(\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern}\\\\s*)\\\\)$`\n      )\n    )\n    ?.slice(1, 5)\n    .map(parseComponent);\nconst parseRgba = (str: string) =>\n  str\n    .match(\n      new RegExp(\n        `^rgba\\\\(\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern})\\\\s*,\\\\s*(${numberPattern}\\\\s*)\\\\)$`\n      )\n    )\n    ?.slice(1, 5)\n    .map(parseComponent);\n\n/**\n * parses a color string into rgba components.\n * @param str\n */\nexport const parseColorString = (\n  str: string\n): [number, number, number, number?] | null => {\n  const result = [parseHexRgba, parseShorthandHex, parseRgb, parseRgba].reduce<\n    (number | undefined)[] | undefined\n  >((result, parse) => result || parse(str), undefined);\n  return Array.isArray(result) &&\n    result.slice(0, 3).every((c) => Number.isInteger(c))\n    ? (result as [number, number, number, number?])\n    : null;\n};\n","import { parseColorString } from \"./parseColorString\";\n\n/**\n * A Color class resembling AWT Color\n */\nexport class Color {\n  public readonly r: number;\n  public readonly g: number;\n  public readonly b: number;\n  public readonly a: number;\n\n  private static readonly FACTOR = 0.7;\n\n  constructor(r: number, g: number, b: number, a?: number);\n  constructor(rgba: string);\n  constructor(rgba: Color);\n  constructor(\n    rgba: string | number | Color,\n    g?: number,\n    b?: number,\n    a: number = 255\n  ) {\n    let r: number;\n    if (typeof rgba === \"string\") {\n      [r = NaN, g = NaN, b = NaN, a = 255] = parseColorString(rgba) || [];\n    } else if (rgba instanceof Color) {\n      [r, g, b, a] = [rgba.r, rgba.g, rgba.b, rgba.a];\n    } else {\n      r = rgba;\n    }\n    this.r = r;\n    this.g = g!;\n    this.b = b!;\n    this.a = a < 1 ? Math.round(a * 255) : a;\n  }\n\n  isValid() {\n    return (\n      Number.isInteger(this.r) &&\n      Number.isInteger(this.g) &&\n      Number.isInteger(this.b) &&\n      Number.isInteger(this.a)\n    );\n  }\n\n  /**\n   * Extra method for changing transparency\n   */\n  withTransparency(alpha: number) {\n    return new Color(this.r, this.g, this.b, alpha);\n  }\n\n  brighter() {\n    let { r, g, b, a: alpha } = this;\n    const int = Math.floor,\n      FACTOR = Color.FACTOR;\n    // The rest is copy paste of java.awt.Color (only `int i` is changed to `let i` :D)\n    let i = int(1.0 / (1.0 - FACTOR));\n    if (r == 0 && g == 0 && b == 0) {\n      return new Color(i, i, i, alpha);\n    }\n    if (r > 0 && r < i) r = i;\n    if (g > 0 && g < i) g = i;\n    if (b > 0 && b < i) b = i;\n\n    return new Color(\n      Math.min(int(r / FACTOR), 255),\n      Math.min(int(g / FACTOR), 255),\n      Math.min(int(b / FACTOR), 255),\n      alpha\n    );\n  }\n\n  darker() {\n    const FACTOR = Color.FACTOR;\n    const int = Math.floor;\n\n    return new Color(\n      Math.max(int(this.r * FACTOR), 0),\n      Math.max(int(this.g * FACTOR), 0),\n      Math.max(int(this.b * FACTOR), 0),\n      this.a\n    );\n  }\n\n  static brighter(color: string): string {\n    // note: we can't type args simply with ConstructorParameters<typeof Color>.\n    // see more: https://github.com/microsoft/TypeScript/issues/37079\n    return new Color(color).brighter().toString();\n  }\n\n  blend(colorOrColorString: Color | string) {\n    const color =\n      typeof colorOrColorString === \"string\"\n        ? new Color(colorOrColorString)\n        : colorOrColorString;\n    const getBlendedValue = (component: \"r\" | \"g\" | \"b\") =>\n      Math.round(\n        (color.a / 255) * color[component] +\n          (this.a / 255) * (1 - color.a / 255) * this[component]\n      );\n    return new Color(\n      getBlendedValue(\"r\"),\n      getBlendedValue(\"g\"),\n      getBlendedValue(\"b\")\n    );\n  }\n\n  toString() {\n    const toString = (component: number) =>\n      Number.isNaN(component) ? \"\" : component.toString(16).padStart(2, \"0\");\n    const r = toString(this.r);\n    const g = toString(this.g);\n    const b = toString(this.b);\n    const a = this.a === 255 ? \"\" : toString(this.a);\n    return `#${r}${g}${b}${a}`;\n  }\n}\n","import React, { CSSProperties, useRef, useState } from \"react\";\nimport styled, { useTheme } from \"styled-components\";\nimport {\n  BottomResizer,\n  LeftResizer,\n  RightResizer,\n  TopResizer,\n} from \"../Resizer\";\nimport { ResizerProps } from \"../Resizer/ResizerProps\";\nimport { Theme } from \"../Theme/Theme\";\n\n/**\n * Props are named mostly based on ThreeComponentsSplitter in Intellij Platform.\n */\nexport interface ThreeViewSplitterProps {\n  orientation?: \"horizontal\" | \"vertical\";\n  resizerProps?: Partial<\n    Omit<ResizerProps, \"onResize\" | \"onResizeStarted\" | \"onResizeEnd\">\n  >;\n  innerView?: React.ReactNode;\n  innerViewMinSize?: number;\n  firstView?: React.ReactNode;\n  firstSize?: number | null;\n  firstViewMinSize?: number;\n  lastView?: React.ReactNode;\n  lastSize?: number | null;\n  lastViewMinSize?: number;\n  onFirstResize?: (size: number) => void;\n  onLastResize?: (size: number) => void;\n  style?: CSSProperties;\n  className?: string;\n}\n\nconst StyledSplitterContainer = styled.div<{\n  orientation: \"horizontal\" | \"vertical\";\n}>`\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  flex-direction: ${({ orientation }) =>\n    orientation === \"vertical\" ? \"column\" : \"row\"};\n`;\n\nconst StyledView = styled.div`\n  // The default overflow visible should be changed obviously. Not sure if there is any layout implication\n  // in using 'auto' instead of hidden, to provide scroll behaviour by default, but even if we realize later\n  // that we need to set overflow to hidden here, we can have scrollable content inside the inner view via an\n  // intermediate element inside the inner view, with overflow set to auto and width set to 100%.\n  overflow: auto;\n`;\n\nconst StyledSplitterInnerView = styled(StyledView)`\n  flex: 1;\n`;\n\n/**\n * Corresponding to\n * [ThreeComponentsSplitter](https://github.com/JetBrains/intellij-community/blob/58dbd93e9ea527987466072fa0bfbf70864cd35f/platform/platform-api/src/com/intellij/openapi/ui/ThreeComponentsSplitter.java#L40-L40)\n * `firstView` and `lastView` are optional, and if not provided, the corresponding resizer is not rendered.\n * innerView is supposed to fill the remaining space, while firstView and lastView have specific sizes.\n * size changes in a resize interaction is not reported and is handled by local state in the component. That's\n * to prevent frequent state updates in a higher level which can be expensive. It's also based on this assumption\n * that in the usage side there is no need for any control over resizing or even knowing the intermediate state.\n * Maybe a minSize and maxSize would be the extent of the required control over resizing. But anyway, this model\n * of keeping the size as a local state during a resize session is something that can be changed if needed.\n *\n * Features:\n * - Relative sizing (fraction of the container)\n * - Default size by content\n * - Change handling only when resize is done.\n *\n * TODO: max and min size not implemented\n * TODO: add support for uncontrolled version\n */\nexport const ThreeViewSplitter: React.FC<ThreeViewSplitterProps> = ({\n  orientation = \"horizontal\",\n  firstView,\n  firstSize,\n  lastView,\n  lastSize,\n  onFirstResize,\n  onLastResize,\n  resizerProps: resizerPropsOverrides = {},\n  innerView,\n  firstViewMinSize,\n  lastViewMinSize,\n  innerViewMinSize,\n  ...containerProps\n}: ThreeViewSplitterProps): React.ReactElement => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const firstViewRef = useRef<HTMLDivElement>(null);\n  const lastViewRef = useRef<HTMLDivElement>(null);\n  const [firstSizeState, setFirstSizeState] = useState<number | null>(null);\n  const [lastSizeState, setLastSizeState] = useState<number | null>(null);\n  const theme = useTheme() as Theme;\n\n  const value = <T1, T2>(horizontalValue: T1, verticalValue: T2) =>\n    orientation === \"horizontal\" ? horizontalValue : verticalValue;\n\n  const FirstResizer: React.ComponentType<ResizerProps> = value(\n    RightResizer,\n    BottomResizer\n  );\n  const SecondResizer: React.ComponentType<ResizerProps> = value(\n    LeftResizer,\n    TopResizer\n  );\n  const sizeStyleProp = value(\"width\", \"height\");\n  const minSizeStyleProp = value(\"minWidth\", \"minHeight\");\n\n  const resizerProps: ThreeViewSplitterProps[\"resizerProps\"] = {\n    background: theme.commonColors.contrastBorder,\n    size: 1,\n    ...resizerPropsOverrides,\n  };\n\n  const isFractionSize = (size: number) => size < 1;\n\n  const normalizeSize = (\n    size: number | undefined | null\n  ): CSSProperties[\"width\" | \"height\"] =>\n    size != null\n      ? isFractionSize(size)\n        ? `${size * 100}%`\n        : Math.round(size)\n      : undefined;\n\n  const getSize = (elem: HTMLElement): number =>\n    value(elem.offsetWidth, elem.offsetHeight);\n\n  const getNewSize = (currentSize: number, newSize: number) => {\n    if (currentSize != null && isFractionSize(currentSize)) {\n      if (!containerRef.current) {\n        throw new Error(\n          \"ThreeViewSplitter: Could not locate container to calculate fraction size\"\n        );\n      }\n      const containerSize = value(\n        containerRef.current.offsetWidth,\n        containerRef.current.offsetHeight\n      );\n      const newFractionSize = newSize / containerSize;\n      return newFractionSize < 1 ? newFractionSize : currentSize;\n    } else {\n      return Math.max(newSize, 1);\n    }\n  };\n\n  const getActualSize = (viewElem: HTMLElement | null): number | null => {\n    if (!containerRef.current || !viewElem) {\n      return null;\n    }\n    const actualSize = getSize(viewElem);\n    if (viewElem.style[sizeStyleProp]?.includes(\"%\")) {\n      return actualSize / getSize(containerRef.current);\n    }\n    return actualSize;\n  };\n\n  const currentLastSize = normalizeSize(lastSizeState ?? lastSize);\n  const currentFirstSize = normalizeSize(firstSizeState ?? firstSize);\n  return (\n    <StyledSplitterContainer\n      ref={containerRef}\n      orientation={orientation}\n      {...containerProps}\n    >\n      {firstView && (\n        <>\n          <StyledView\n            ref={firstViewRef}\n            style={{\n              [sizeStyleProp]: currentFirstSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                (lastSizeState !== null ? currentFirstSize : undefined) ??\n                firstViewMinSize,\n            }}\n          >\n            {firstView}\n          </StyledView>\n          <FirstResizer\n            onResizeStarted={() => {\n              const size = firstViewRef.current\n                ? getSize(firstViewRef.current)\n                : 0;\n              setFirstSizeState(firstSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (firstSizeState != null) {\n                setFirstSizeState(getNewSize(firstSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(firstViewRef.current);\n              if (actualSize !== null) {\n                onFirstResize?.(actualSize);\n              }\n              setFirstSizeState(null);\n            }}\n            {...resizerProps}\n          />\n        </>\n      )}\n      {innerView && (\n        <StyledSplitterInnerView\n          style={{\n            [minSizeStyleProp]: innerViewMinSize,\n          }}\n        >\n          {innerView}\n        </StyledSplitterInnerView>\n      )}\n      {lastView && (\n        <>\n          <SecondResizer\n            onResizeStarted={() => {\n              const size = getSize(lastViewRef.current!);\n              setLastSizeState(lastSize ?? size);\n              return size;\n            }}\n            onResize={(newSize) => {\n              if (lastSizeState != null) {\n                setLastSizeState(getNewSize(lastSizeState, newSize));\n              }\n            }}\n            onResizeEnd={() => {\n              const actualSize = getActualSize(lastViewRef.current);\n              if (actualSize !== null) {\n                onLastResize?.(actualSize);\n              }\n              setLastSizeState(null);\n            }}\n            {...resizerProps}\n          />\n          <StyledView\n            ref={lastViewRef}\n            style={{\n              [sizeStyleProp]: currentLastSize,\n              // if other side is resizing, minWidth/minHeight is set so that this side is not get affected.\n              // It may make sense to allow opting out of this behaviour, if it's considered a feature to be able to\n              // \"push\" the other side too when expanding one side.\n              [minSizeStyleProp]:\n                (firstSizeState !== null ? currentLastSize : undefined) ??\n                lastViewMinSize,\n            }}\n          >\n            {lastView}\n          </StyledView>\n        </>\n      )}\n    </StyledSplitterContainer>\n  );\n};\n","import { isMac } from \"@react-aria/utils\";\nimport React, { HTMLProps, useRef } from \"react\";\nimport { css } from \"styled-components\";\nimport { WINDOW_SHADOW } from \"../style-constants\";\nimport { styled } from \"../styled\";\nimport { Theme } from \"../Theme/Theme\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\nimport {\n  OverlayInteractionHandler,\n  OverlayResizeHandles,\n  useResizableMovableOverlay,\n} from \"@intellij-platform/core/Overlay\";\nimport { Overlay } from \"@react-aria/overlays\";\n\nconst FLOAT_WINDOW_MIN_WIDTH = 100;\nconst FLOAT_WINDOW_MIN_HEIGHT = 40; // in Intellij Platform it's zero but there is window frame which doesn't exist here\n\nconst StyledFloatView = styled.div`\n  box-sizing: border-box;\n  position: fixed;\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  // border color doesn't seem to be correct and needs more investigation. might be even os-specific and outside\n  // theme colors.\n  border: ${({ theme }) => `1px solid ${theme.color(\"Component.borderColor\")}`};\n  ${WINDOW_SHADOW};\n  ${isMac() &&\n  css<{ theme: Theme }>`\n    border-radius: 8px;\n  `}\n  z-index: 2;\n`;\n\n/**\n * Container for tool windows in float view mode. It handles some visual aspects like the border and shadow, as well as\n * UI interactions for changing the floatingBound of the tool window.\n */\nexport const FloatView: React.FC<\n  {\n    state: FloatWindowState;\n    onBoundsChange: (bounds: WindowBounds) => void;\n  } & Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\">\n> = ({ children, state: { bounds }, onBoundsChange, ...otherProps }) => {\n  const ref = useRef(null);\n  const { bounds: boundsStyle, overlayInteractionHandlerProps } =\n    useResizableMovableOverlay(ref, {\n      bounds,\n      onBoundsChange,\n    });\n\n  return (\n    <Overlay>\n      <StyledFloatView\n        {...otherProps}\n        ref={ref}\n        style={{ ...otherProps.style, ...boundsStyle }}\n      >\n        <OverlayInteractionHandler {...overlayInteractionHandlerProps}>\n          <OverlayResizeHandles\n            minWidth={FLOAT_WINDOW_MIN_WIDTH}\n            minHeight={FLOAT_WINDOW_MIN_HEIGHT}\n          />\n          {children}\n        </OverlayInteractionHandler>\n      </StyledFloatView>\n    </Overlay>\n  );\n};\n","import { move } from \"ramda\";\nimport React, { HTMLProps, Key, useState } from \"react\";\nimport { FloatView } from \"./FloatView\";\nimport { FloatWindowState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { WindowBounds } from \"./ToolWindowsState/ToolWindowsState\";\n\n// NOTE: useStackedLayersState and useStackedLayers are generic but kept here since there is no other use case at the\n// moment. They should be moved to their own file(s) when/if other use case came up.\n\ninterface StackedLayersState<T> {\n  /**\n   * Sorted list of items representing layers.\n   */\n  sorted: T[];\n  /**\n   * A function to be used when the layer should be brought to front, typically based on some UI interaction.\n   */\n  bringToFront: (index: number) => void;\n}\n\n/**\n * State management for a stacked list of layers with **bring to front** functionality.\n */\nfunction useStackedLayersState<T, K = React.Key>(\n  /**\n   * A list of arbitrary items representing stacked layers.\n   */\n  items: T[],\n  /**\n   * A function for converting each item into a key which consistently identifies each item, in subsequent renders.\n   * It's used to maintain current sorting state. Although it can be of any type, it's usually a string or number.\n   */\n  getKey: (item: T) => K\n): StackedLayersState<T> {\n  // Local state for now, but can easily change to controllable if needed.\n  const [sortedKeys, setSortedKeys] = useState<K[]>([]);\n  const sorted = items.sort(\n    (a, b) => sortedKeys.indexOf(getKey(a)) - sortedKeys.indexOf(getKey(b))\n  );\n  return {\n    sorted,\n    bringToFront: (index: number) => {\n      setSortedKeys(move(index, -1, sorted).map(getKey));\n    },\n  };\n}\n\n/**\n * Given the state of a stacked list of layers, returns DOM props to be applied to each layer for interaction-based\n * \"bring to front\" behaviour.\n */\nfunction useStackedLayers<T>(state: StackedLayersState<T>): {\n  layersProps: Array<HTMLProps<HTMLElement>>;\n} {\n  return {\n    layersProps: state.sorted.map((_, index) => ({\n      onFocus: () => {\n        state.bringToFront(index);\n      },\n    })),\n  };\n}\n\n/**\n * Renders float tool windows.\n * - handles resize and move actions for float windows.\n * - handles layering of float tool windows.\n */\nexport function FloatToolWindows({\n  floatWindows = [],\n  onBoundsChange,\n  renderToolWindow,\n}: {\n  floatWindows: FloatWindowState[] | undefined;\n  onBoundsChange: (key: Key, bounds: WindowBounds) => void;\n  renderToolWindow: (key: Key) => React.ReactNode;\n}) {\n  const stackedFloatWindows = useStackedLayersState(\n    floatWindows,\n    ({ key }) => key\n  );\n  const { layersProps } = useStackedLayers(stackedFloatWindows);\n  // sorted list is used to render layers. We could as well use z-index and always render with the same order, but\n  // it doesn't really matter as long as key is set.\n  return (\n    <>\n      {stackedFloatWindows.sorted.map((toolWindow, index) => (\n        <FloatView\n          key={toolWindow.key}\n          state={toolWindow}\n          {...layersProps[index]}\n          onBoundsChange={(bounds) => onBoundsChange(toolWindow.key, bounds)}\n        >\n          {renderToolWindow(toolWindow.key)}\n        </FloatView>\n      ))}\n    </>\n  );\n}\n","import React, {\n  Key,\n  MutableRefObject,\n  RefObject,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"../utils/useLatest\";\nimport { DropPosition } from \"./createGetDropPosition\";\nimport { UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor } from \"./utils\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\ntype StripeLocation<T extends unknown> = {\n  index: number;\n  anchor: Anchor;\n  isSplit: boolean;\n};\ntype MovableStripeProps<T> = {\n  stripeElRef: React.RefObject<HTMLElement>;\n  getKey: (item: T) => Key;\n  anchor: Anchor;\n  mainItems: T[];\n  splitItems: T[];\n  createGetDropPosition: (\n    key: Key\n  ) => (draggedRect: Rect) => DropPosition | null;\n};\n\ntype MovableToolWindowStripeContextType<T> = {\n  addStripe: <T>(\n    id: string,\n    propsRef: MutableRefObject<MovableStripeProps<T>>\n  ) => () => void;\n  startMove: (id: string, args: { from: Rect; key: Key }) => void;\n  move: (args: { to: Rect }) => void;\n  endMove: () => void;\n  dropPosition: null | { id: string; dropPosition: DropPosition };\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n};\n\nexport type MovableToolWindowStripeProviderProps<T = unknown> = {\n  children: React.ReactNode;\n  onMove: (args: { from: StripeLocation<T>; to: StripeLocation<T> }) => void;\n};\n\nconst MovableToolWindowStripeContext =\n  React.createContext<MovableToolWindowStripeContextType<any> | null>(null);\n\n/**\n * A wrapper component to render around `ToolWindowStripe`s to make their button movable. Stripe buttons then become\n * draggable and can be moved either within the same `ToolWindowStripe` or across different ones.\n * @param onMove: called when a stripe button is moved from one anchor to another.\n * @param children: child element tree, containing one or more ToolWindowStripe elements. No need to be direct children.\n */\nexport const MovableToolWindowStripeProvider = <T extends unknown>({\n  onMove,\n  children,\n}: MovableToolWindowStripeProviderProps<T>) => {\n  const stripes = useRef<{\n    [id: string]: RefObject<MovableStripeProps<T>>;\n  }>({});\n  const [draggingRect, setDraggingRect] = useState<Rect | null>(null);\n  const [draggingKey, setDraggingKey] = useState<Key | null>(null);\n  const [dropPosition, setDropPosition] = useState<{\n    id: string;\n    dropPosition: DropPosition;\n  } | null>(null);\n  const getDropPositionRef = useRef<\n    (to: Rect) => {\n      id: string;\n      dropPosition: DropPosition;\n    } | null\n  >(() => null);\n  const moveStartLocationRef = useRef<null | {\n    id: string;\n    index: number;\n    anchor: Anchor;\n    isSplit: boolean;\n  }>(null);\n\n  const contextValue = useMemo(\n    (): MovableToolWindowStripeContextType<T> => ({\n      addStripe: (id, propsRef) => {\n        if (stripes.current[id]) {\n          console.error(`multiple stripes with the same id \"${id}`);\n        }\n        // @ts-expect-error\n        stripes.current[id] = propsRef;\n        return () => {\n          delete stripes.current[id];\n        };\n      },\n      startMove: (id, { from, key }) => {\n        const stripe = stripes.current[id]?.current;\n        if (!stripe) {\n          return;\n        }\n        const { stripeElRef } = stripe;\n        const stripeElement = stripeElRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n\n        // Running the following two state setters immediately affect the layout\n        // in a way that is necessary for drop position calculation, so the order\n        // is important\n        setDraggingRect(getItemRect(key).toJSON());\n        setDraggingKey(key);\n\n        const indexInMain = stripe.mainItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        const indexInSplit = stripe.splitItems.findIndex(\n          (item) => stripe.getKey(item) === key\n        );\n        moveStartLocationRef.current = {\n          id,\n          anchor: stripe.anchor,\n          index: indexInMain > -1 ? indexInMain : indexInSplit,\n          isSplit: indexInSplit > -1,\n        };\n\n        const dropPositionGetters = Object.entries(stripes.current).map(\n          ([id, stripe]) =>\n            [id, stripe.current!.createGetDropPosition(key)] as const\n        );\n        const getDropPosition = (draggedRect: Rect) => {\n          for (const [id, getDropPosition] of dropPositionGetters) {\n            const dropPosition = getDropPosition(draggedRect);\n            if (dropPosition) {\n              return {\n                id,\n                dropPosition,\n              };\n            }\n          }\n          return null;\n        };\n\n        setDropPosition(getDropPosition(from));\n\n        getDropPositionRef.current = getDropPosition;\n      },\n      move: ({ to }) => {\n        setDropPosition(getDropPositionRef.current(to));\n      },\n      endMove: () => {\n        if (dropPosition && draggingKey) {\n          onMove({\n            from: moveStartLocationRef.current!,\n            to: {\n              anchor: dropPosition.id as Anchor /*FIXME*/,\n              index: dropPosition.dropPosition.index,\n              isSplit: dropPosition.dropPosition.split,\n            },\n          });\n        }\n        setDraggingKey(null);\n        setDropPosition(null);\n        setDraggingRect(null);\n      },\n      dropPosition,\n      draggingRect,\n      draggingKey,\n    }),\n    [dropPosition, draggingKey, draggingRect]\n  );\n\n  return (\n    <MovableToolWindowStripeContext.Provider value={contextValue}>\n      {children}\n    </MovableToolWindowStripeContext.Provider>\n  );\n};\n\nexport function useMovableStripeButtons<T>(props: MovableStripeProps<T>) {\n  // Seems reasonable to assume anchor is unique. Also current onMove signature is coupled with anchor, not a more generic id.\n  const id = props.anchor;\n  const context = useContext(MovableToolWindowStripeContext);\n  const latestPropsRef = useLatest(props);\n  useEffect(() => {\n    if (context) {\n      return context.addStripe(id, latestPropsRef);\n    }\n  }, [context, id]);\n\n  const getProps = (\n    key: Key\n  ): Pick<\n    Required<UseElementMoveOptions<unknown>>,\n    \"onMoveStart\" | \"onMove\" | \"onMoveEnd\"\n  > & { moveDisabled: boolean } => ({\n    moveDisabled: !context,\n    onMoveStart: ({ from }) => {\n      context?.startMove?.(id, { from, key });\n    },\n    onMove: ({ to }) => {\n      context?.move({ to });\n    },\n    onMoveEnd: () => {\n      context?.endMove();\n    },\n  });\n  return {\n    getProps,\n    draggingRect: context?.draggingRect ?? null,\n    dropPosition:\n      context?.dropPosition?.id === id\n        ? context?.dropPosition.dropPosition\n        : null,\n    draggingKey: context?.draggingKey ?? null,\n  };\n}\n","import { styled } from \"../styled\";\nimport { css } from \"styled-components\";\n\nconst TopStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: ts;\n`;\nconst BottomStripe = styled.div`\n  display: flex; // default display, which is block causes an unwanted minimum height\n  grid-area: bs;\n`;\nconst LeftStripe = styled.div`\n  grid-area: ls;\n`;\nconst RightStripe = styled.div`\n  grid-area: rs;\n`;\nconst InnerView = styled.div`\n  grid-area: main;\n  min-height: 0; // necessary to prevent overflow;\n  position: relative; // necessary for undock views which are absolute positioned\n  background: inherit;\n  min-width: 0; // very important for layout. If not set, resizing tool windows can cause weird scrollbar inside tool windows pane.\n`;\n\n/**\n * The container which renders top,bottom,left and right stripes with a centered content.\n * responsible only for the layout of the stripes and the centered content. layout doesn't\n * include the opened tool windows on different sides and is just about the stripes around\n * the center area.\n * It also supports toggling stripes visibility.\n */\nconst Shell = styled.div<{ hideStripes: boolean }>`\n  display: grid;\n  grid-template-columns: min-content auto min-content;\n  grid-template-rows: min-content auto min-content;\n  grid-template-areas:\n    \".   ts   .\"\n    \"ls main rs\"\n    \".   bs   .\";\n\n  background: ${({ theme }) => theme.commonColors.panelBackground};\n  color: ${({ theme }) => theme.color(\"*.foreground\")};\n  ${({ hideStripes }) =>\n    hideStripes &&\n    css`\n      ${TopStripe},\n      ${BottomStripe}, \n      ${LeftStripe}, \n      ${RightStripe} {\n        display: none;\n      }\n    `}\n`;\n\nexport const StyledToolWindowOuterLayout = {\n  Shell,\n  TopStripe,\n  BottomStripe,\n  LeftStripe,\n  RightStripe,\n  InnerView,\n};\n","import { compose, filter, groupBy, map, pipe, prop, sortBy } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\nimport {\n  ToolWindowsState,\n  ToolWindowState,\n  ViewMode,\n} from \"./ToolWindowsState\";\n\ntype ToolWindowStateWithKey = { key: Key } & ToolWindowState;\n\nexport interface StripesState {\n  main: Key[];\n  split: Key[];\n  activeKeys: Key[];\n}\n\n/**\n * Represents UI state of the split view (aka secondary or side view) within a docked view at one of the four sides.\n */\ntype SideDockedSplitState = {\n  key: Key;\n  /**\n   * relative size of the split view inside a docked view. Note that this is intentionally a fraction size (0size<1),\n   * based on the expected behaviour. split views inside a docked view are not fixed sized and resizing the window\n   * affect their size. This is not the case for the docked views themselves inside the main layout, which have fixed\n   * size which is not affected by window resizing.\n   */\n  sizeFraction: number;\n};\n\n// A potential improvement for this and similar nullable types like SideDockedState.split might be to avoid null type\n// and have it like { open: false} | {open: true, ...relevantProps}\n// Not sure if it's really preferred in terms of usage in the react component.\nexport type SideDockedState = null | {\n  size: number;\n  mainKey: Key;\n  split: SideDockedSplitState | null;\n};\n\nexport type SideUnDockedState = null | {\n  size: number;\n  key: Key;\n};\n\nexport interface SideState {\n  docked: SideDockedState;\n  undocked: SideUnDockedState;\n  stripes: StripesState;\n}\n\nexport interface FloatWindowState {\n  key: Key;\n  bounds: Exclude<ToolWindowState[\"floatingBounds\"], undefined>;\n}\n\n/**\n * Derived from ToolWindowsState, it represents the same information in a away that is suitable for ToolWindows\n * component to render the layout.\n */\nexport interface ToolWindowsLayoutState {\n  left: SideState;\n  top: SideState;\n  right: SideState;\n  bottom: SideState;\n  floatWindows: Array<FloatWindowState>;\n  windows: Array<FloatWindowState>;\n}\n\ninterface ContainerSize {\n  width: number;\n  height: number;\n}\n\nconst getSizeInAnchor = (containerSize: ContainerSize, anchor: Anchor) =>\n  containerSize[isHorizontalToolWindow(anchor) ? \"height\" : \"width\"];\n\nconst mapToKey = map<ToolWindowStateWithKey, Key>(prop(\"key\"));\nconst sortAndMapToKey = compose(\n  mapToKey,\n  sortBy(({ order }: ToolWindowStateWithKey) => order)\n);\nconst filterMains = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => !isSplit\n);\nconst getMains = compose(sortAndMapToKey, filterMains);\nconst filterSplits = filter<ToolWindowStateWithKey, \"array\">(\n  ({ isSplit }: ToolWindowStateWithKey) => isSplit\n);\nconst filterVisible = (expectedViewMode: ViewMode | ViewMode[] = []) =>\n  filter<ToolWindowStateWithKey, \"array\">(\n    ({ viewMode, isVisible }: ToolWindowStateWithKey) =>\n      isVisible &&\n      ([] as ViewMode[]).concat(expectedViewMode).includes(viewMode)\n  );\nconst getSplits = compose(sortAndMapToKey, filterSplits);\n\nconst filterVisibleDocked = filterVisible([\"docked_unpinned\", \"docked_pinned\"]);\nconst filterVisibleUnDocked = filterVisible(\"undock\");\n\nconst getDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideDockedState => {\n  const docks = filterVisibleDocked(toolWindows);\n  const mains = filterMains(docks);\n  const splits = filterSplits(docks);\n  if (mains.length > 1 || splits.length > 1) {\n    throw new Error(\n      \"More than one visible docked window in a side is not possible\"\n    );\n  }\n  if (mains[0] || splits[0]) {\n    const weight = mains[0]?.weight || splits[0]?.weight;\n    return {\n      mainKey: mains[0]?.key || splits[0]?.key,\n      split:\n        mains[0]?.key && splits[0]?.key\n          ? {\n              key: splits[0].key,\n              sizeFraction: mains[0].weight\n                ? 1 - mains[0].sideWeight\n                : splits[0].sideWeight,\n            }\n          : null,\n      size: weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  return null;\n};\n\nconst getUnDocked = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideUnDockedState => {\n  const windows = filterVisibleUnDocked(toolWindows);\n  if (windows.length === 1) {\n    return {\n      key: windows[0].key,\n      size: windows[0].weight * getSizeInAnchor(containerSize, anchor),\n    };\n  }\n  if (windows.length === 0) {\n    return null;\n  }\n  throw new Error(\n    \"More than one visible undocked window in a side is not possible\"\n  );\n};\n\nconst getSideState = (\n  anchor: Anchor,\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n): SideState => ({\n  stripes: {\n    main: getMains(toolWindows),\n    split: getSplits(toolWindows),\n    activeKeys: mapToKey(toolWindows.filter(({ isVisible }) => isVisible)),\n  },\n  undocked: getUnDocked(anchor, containerSize, toolWindows),\n  docked: getDocked(anchor, containerSize, toolWindows),\n});\n\nconst DEFAULT_HEIGHT = 300;\nconst DEFAULT_WIDTH = 400;\nconst getFloatWindowState =\n  (containerSize: ContainerSize) =>\n  ({\n    floatingBounds: bounds = {\n      top: containerSize.height / 2 - DEFAULT_HEIGHT / 2,\n      left: containerSize.width / 2 - DEFAULT_WIDTH / 2,\n      height: DEFAULT_HEIGHT,\n      width: DEFAULT_WIDTH,\n    },\n    key,\n  }: ToolWindowStateWithKey): FloatWindowState => ({ bounds, key });\n\nconst getFloatWindowsState = (\n  viewMode: \"float\" | \"window\",\n  containerSize: ContainerSize,\n  toolWindows: ToolWindowStateWithKey[]\n) =>\n  pipe(\n    filterVisible(viewMode),\n    map<ToolWindowStateWithKey, FloatWindowState>(\n      getFloatWindowState(containerSize)\n    )\n  )(toolWindows);\n\nexport function getToolWindowsLayoutState(\n  state: Readonly<ToolWindowsState>,\n  containerSize: ContainerSize,\n  /**\n   * list of valid window ids. If state contains window ids that are not included here, they will be excluded in\n   * the returned state object.\n   */\n  windowIds: string[] = Object.keys(state.windows)\n): ToolWindowsLayoutState {\n  const toolWindows = Object.keys(state.windows)\n    .filter(\n      (key) => windowIds.includes(key) && !state.removedFromSideBarIds.has(key)\n    )\n    .map((key) => ({\n      ...state.windows[key],\n      key,\n    }));\n  const {\n    top = [],\n    bottom = [],\n    left = [],\n    right = [],\n  } = groupBy(({ anchor }) => anchor, toolWindows);\n  return {\n    left: getSideState(\"left\", containerSize, left),\n    top: getSideState(\"top\", containerSize, top),\n    right: getSideState(\"right\", containerSize, right),\n    bottom: getSideState(\"bottom\", containerSize, bottom),\n    windows: getFloatWindowsState(\"window\", containerSize, toolWindows),\n    floatWindows: getFloatWindowsState(\"float\", containerSize, toolWindows),\n  };\n}\n","import { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { Key } from \"react\";\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface DropPosition {\n  index: number;\n  split: boolean;\n\n  relative?: {\n    placement: \"before\" | \"after\";\n    key: Key;\n  };\n}\n\n/**\n * TODO: Add a few words about what this function do.\n */\nexport const createGetDropPosition = <T extends any>({\n  anchor,\n  stripeElement,\n  splitItems,\n  mainItems,\n  getItemRect,\n  getKey,\n}: {\n  stripeElement: HTMLElement;\n  anchor: Anchor;\n  getItemRect: (key: Key) => Rect;\n  getKey: (key: T) => Key;\n  mainItems: T[];\n  splitItems: T[];\n}): ((draggedRect: Rect) => DropPosition | null) => {\n  // Note: It may be tempting to calculate stripe element boundaries just once\n  // here, since it's not supposed to change during a drag session, but it\n  // can change due to getting empty when the only button is being dragged out.\n  const getStripeRect = () => stripeElement.getBoundingClientRect();\n\n  const getCanDrop = (draggingRect: Rect) => {\n    const stripeRect = getStripeRect();\n    return (\n      draggingRect.right > stripeRect.left - stripeRect.width &&\n      draggingRect.left < stripeRect.right &&\n      draggingRect.bottom > stripeRect.top - stripeRect.height &&\n      draggingRect.top < stripeRect.bottom\n    );\n  };\n\n  const start = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.left : rect.top;\n  const end = (rect: Rect) =>\n    isHorizontalToolWindow(anchor) ? rect.right : rect.bottom;\n\n  const getKeyToOffsets = (items: T[]) => {\n    const keyToOffsets: Record<Key, { start: number; end: number }> = {};\n    items.forEach((item) => {\n      const key = getKey(item);\n      const boundingRect = getItemRect(key);\n      keyToOffsets[key] = {\n        start: start(boundingRect),\n        end: end(boundingRect),\n      };\n    });\n    return keyToOffsets;\n  };\n\n  const getDropPositions = (\n    items: T[],\n    split = false\n    // FIXME: score is a bad name. it's quite the opposite! the less means the higher score.\n  ): Array<DropPosition & { score: (rect: Rect) => number }> => {\n    const getRef = split ? end : start;\n    if (items.length === 0) {\n      // if the section is empty, we should still allow adding to it.\n      return [\n        {\n          index: 0,\n          split,\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - getRef(getStripeRect())),\n        },\n      ];\n    }\n    return items.flatMap((item, index) => {\n      const key = getKey(item);\n      return [\n        {\n          index,\n          split,\n          relative: { key, placement: \"before\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].start),\n        },\n        {\n          index: index + 1,\n          split,\n          relative: { key, placement: \"after\" },\n          score: (draggingRect: Rect) =>\n            Math.abs(getRef(draggingRect) - keyToOffsets[key].end),\n        },\n      ];\n    });\n  };\n\n  const keyToOffsets = getKeyToOffsets([...mainItems, ...splitItems]);\n\n  const dropPositions = [\n    ...getDropPositions(mainItems),\n    ...getDropPositions(splitItems, true),\n  ];\n\n  let lastDropPosition: DropPosition | null = null;\n  return (draggingRect: Rect) => {\n    if (!getCanDrop(draggingRect)) {\n      return null;\n    }\n    const result = dropPositions.reduce(\n      (bestMatch, candidate) => {\n        const score = candidate.score(draggingRect);\n        if (!bestMatch || score < bestMatch.score) {\n          return {\n            ...candidate,\n            score,\n          };\n        }\n        return bestMatch;\n      },\n      null as\n        | null\n        | (DropPosition & {\n            score: number;\n          })\n    );\n\n    if (!result) {\n      return null;\n    }\n    if (\n      result.split !== lastDropPosition?.split ||\n      result.index !== lastDropPosition?.index\n    ) {\n      lastDropPosition = result;\n    }\n    return lastDropPosition;\n  };\n};\n","import { StyledIconWrapper } from \"../Icon/StyledIconWrapper\";\nimport { styled } from \"../styled\";\nimport React from \"react\";\nimport { css } from \"styled-components\";\nimport { Anchor } from \"./utils\";\n\nexport interface StyledToolWindowStripeButtonProps {\n  anchor: Anchor;\n  active?: boolean;\n}\n\nexport const STRIPE_BUTTON_CROSS_PADDING = 2.5;\nexport const STRIPE_BUTTON_LINE_HEIGHT = \"1rem\";\n\nconst anchorStyles = ({ anchor }: { anchor: Anchor }) => {\n  const orientation =\n    anchor === \"left\" || anchor === \"right\" ? \"vertical\" : \"horizontal\";\n\n  return orientation === \"horizontal\"\n    ? css`\n        padding: ${STRIPE_BUTTON_CROSS_PADDING}px 10px;\n      `\n    : css`\n        padding: 10px ${STRIPE_BUTTON_CROSS_PADDING}px;\n        writing-mode: vertical-lr;\n        // writing-mode: sideways-lr is not supported anywhere other than FF, so, we need to rotate\n        transform: ${anchor === \"left\" ? \"rotateZ(180deg)\" : undefined};\n\n        // icons are not rotated like text in Intellij Platform implementation. It kind of makes sense.\n        ${StyledIconWrapper} {\n          transform: rotate(180deg);\n        }\n      `;\n};\n\nexport const StyledToolWindowStripeButton = styled.span<StyledToolWindowStripeButtonProps>`\n  box-sizing: border-box;\n  display: flex; // to allow icon and text alignment by default;\n  align-items: center;\n  cursor: default;\n  user-select: none;\n  overflow: hidden;\n  direction: ltr;\n  flex-shrink: 0;\n  font-size: 0.7rem;\n  line-height: ${STRIPE_BUTTON_LINE_HEIGHT}; // absolute value seems to be problematic when the base font size is changed\n  white-space: nowrap;\n  color: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedForeground\",\n          theme.dark ? \"rgb(255,255,255)\" : \"rgb(0,0,0)\"\n        )\n      : theme.color(\"*.foreground\")};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\n          \"ToolWindow.Button.selectedBackground\",\n          theme.dark ? \"rgba(15,15,15,.332)\" : \"rgba(85,85,85,.332)\"\n        )\n      : undefined};\n\n  ${anchorStyles}\n  ${({ active }) =>\n    !active &&\n    css`\n      &:hover {\n        background: ${({ theme }) =>\n          theme.color(\n            \"ToolWindow.Button.hoverBackground\",\n            theme.dark ? \"rgba(15,15,15,.156)\" : \"rgba(85,85,85,.156)\"\n          )};\n      }\n    `};\n`;\n","import {\n  STRIPE_BUTTON_CROSS_PADDING,\n  STRIPE_BUTTON_LINE_HEIGHT,\n  StyledToolWindowStripeButton,\n} from \"./StyledToolWindowStripeButton\";\nimport { Anchor, isHorizontalToolWindow, theOtherSide } from \"./utils\";\nimport { css } from \"styled-components\";\nimport { Theme } from \"../Theme/Theme\";\nimport { styled } from \"../styled\";\nimport { Color } from \"../Theme/Color\";\n\nconst minHeight = `calc(${STRIPE_BUTTON_LINE_HEIGHT} + ${\n  2 * STRIPE_BUTTON_CROSS_PADDING + 1 /*border*/\n}px)`;\n\nconst anchorStyles = ({\n  anchor,\n  preventCollapse,\n}: StyledToolWindowStripeProps) =>\n  isHorizontalToolWindow(anchor)\n    ? css`\n        flex-direction: row;\n        width: 100%;\n        min-height: ${preventCollapse ? minHeight : \"fit-content\"};\n        ${StyledToolWindowStripeButton} {\n          height: 1.25rem;\n        }\n      `\n    : css`\n        flex-direction: column;\n        height: 100%;\n        min-width: ${preventCollapse ? minHeight : \"fit-content\"};\n        ${StyledToolWindowStripeButton} {\n          width: 1.25rem;\n        }\n      `;\nconst borderStyle = ({ anchor, theme }: { anchor: Anchor; theme: Theme }) =>\n  css`border-${theOtherSide(anchor)}: 1px solid ${\n    theme.commonColors.contrastBorder\n  }`;\n\nexport interface StyledToolWindowStripeProps {\n  anchor: Anchor;\n  highlighted?: boolean;\n  preventCollapse?: boolean;\n}\n\nexport const StyledToolWindowStripe = styled.div<StyledToolWindowStripeProps>`\n  box-sizing: border-box;\n  background: ${({ theme, highlighted }) =>\n    highlighted\n      ? Color.brighter(theme.commonColors.panelBackground)\n      : theme.commonColors.panelBackground};\n  display: inline-flex;\n  overflow: hidden;\n  ${borderStyle};\n  ${anchorStyles}\n`;\n\nexport const StyledSpacer = styled.div`\n  flex: 1;\n`;\n","import { RefObject } from \"react\";\nimport {\n  useMove,\n  UseMoveOptions,\n  XY,\n} from \"../utils/interaction-utils/useMove\";\nimport { findEffectiveBackgroundColor } from \"./findEffectiveBackgroundColor\";\n\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nexport interface UseElementMoveOptions<S>\n  extends Omit<UseMoveOptions<S>, \"onMoveStart\" | \"onMove\"> {\n  ref: RefObject<HTMLElement>;\n  /**\n   * if true a clone of the element is created and used as ghost.\n   * A function can be passed to customize the default ghost element or return a completely\n   * different one.\n   */\n  ghost?: boolean | ((defaultGhost: HTMLElement) => HTMLElement);\n\n  onMoveStart: (args: { from: Rect }) => S;\n  onMove: (args: { from: Rect; to: Rect; movement: XY; startState: S }) => void;\n}\n\n/**\n * Provides necessary event handling props to be applied on an element to make it movable.\n * It's implemented on top of {@link useMove}. The differences are:\n * - The signature of `onMoveStart`, `onMove` and `onMoveEnd` are changed to pass\n *   {@link Rect} instead of {@link XY}.\n * - rendering a ghost element.\n *\n * ## A note about ghost:\n * There is no easy way to create a snapshot image of an html element. Native drag and drop API\n * supports [setting drag\n * image](https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/setDragImage) but we are\n * not using drag events mainly because of not being able to customize the offset after which drag\n * should start. See {@link UseMoveOptions#dragThreshold dragThreshold} for more details. There are\n * some libraries like html2canvas for creating an image from an html element, but they are very\n * big and using them doesn't make sense at all from a value/cost ratio perspective. There might be\n * some ways of implementing custom move threshold on top of native drag events. For example by\n * delaying the call to setDragImage, but it needs more investigation. Also, not sure if opacity of\n * the ghost is something you can control when using setDragImage.\n **/\nexport function useElementMove<S>({\n  ref,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  ghost: ghostOption,\n  ...otherOptions\n}: UseElementMoveOptions<S>) {\n  return useMove({\n    ...otherOptions,\n    onMoveStart: () => {\n      const element = ref.current;\n      let ghost: HTMLElement | null = null;\n      if (!element) {\n        throw new Error(\n          \"Movement started but ref value is null. Make sure the passed ref is applied on the same element that other props are.\"\n        );\n      }\n      const updateGhostPosition = (rect: Rect) => {\n        if (ghost) {\n          ghost.style.left = `${rect.left}px`;\n          ghost.style.top = `${rect.top}px`;\n        }\n      };\n      const from: Rect = element.getBoundingClientRect();\n      if (ghostOption) {\n        const defaultGhost = createDefaultGhost(element);\n        ghost =\n          typeof ghostOption === \"function\"\n            ? ghostOption(defaultGhost) || defaultGhost\n            : defaultGhost;\n        ghost.style.position = \"fixed\";\n        document.body.append(ghost);\n        updateGhostPosition(from);\n      }\n      return {\n        ghost,\n        from,\n        updateGhostPosition,\n        startState: onMoveStart({ from }),\n      };\n    },\n    onMove: ({\n      movement,\n      startState: { from, updateGhostPosition, startState },\n    }) => {\n      const to: Rect = {\n        left: from.left + movement.x,\n        right: from.right + movement.x,\n        top: from.top + movement.y,\n        bottom: from.bottom + movement.y,\n        height: from.height,\n        width: from.width,\n      };\n      updateGhostPosition(to);\n      onMove({ from, to, movement, startState });\n    },\n    onMoveEnd: ({ startState: { ghost, startState } }) => {\n      ghost?.remove();\n      onMoveEnd?.({ startState });\n    },\n  });\n}\n\nfunction createDefaultGhost(element: HTMLElement) {\n  const ghost = element.cloneNode(true) as HTMLElement;\n  ghost.style.backgroundColor = findEffectiveBackgroundColor(element);\n  return ghost;\n}\n","import { Color } from \"../Theme/Color\";\n\n/**\n * Computes the effective background color of the element by blending translucent backgrounds of\n * the elements ancestors. It traverses up the parents, until reaches a solid background color.\n * all translucent backgrounds in between are blended with that solid color, with respect to their\n * transparency. It's meant to be used only for the simple cases where an element doesn't overflow\n * the parents. Obviously, in other cases there won't be one single effective background color\n * for the element.\n */\nexport function findEffectiveBackgroundColor(element: HTMLElement): string {\n  let elem: HTMLElement | null = element;\n  let colors: Color[] = [];\n  while (elem != null) {\n    const computedBackground = getComputedStyle(elem).backgroundColor;\n    if (computedBackground) {\n      const color = new Color(computedBackground);\n      colors.unshift(color);\n      if (color.a === 255) {\n        // if we've reached a solid color, we don't need to continue traversing ancestors\n        break;\n      }\n    }\n    elem = elem.parentElement;\n  }\n  return (\n    colors\n      .reduce<Color | null>((resultColor, nextColor) => {\n        return resultColor ? resultColor.blend(nextColor) : nextColor;\n      }, null)\n      ?.toString() || \"\"\n  );\n}\n","import { mergeProps } from \"@react-aria/utils\";\nimport React, { CSSProperties, HTMLAttributes, Key, useRef } from \"react\";\nimport { createGetDropPosition, DropPosition } from \"./createGetDropPosition\";\nimport { useMovableStripeButtons } from \"./MovableToolWindowStripeProvider\";\nimport { StyledSpacer, StyledToolWindowStripe } from \"./StyledToolWindowStripe\";\nimport { StyledToolWindowStripeButton } from \"./StyledToolWindowStripeButton\";\nimport { useElementMove, UseElementMoveOptions } from \"./useElementMove\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\ninterface ToolWindowStripeProps<T> {\n  anchor: Anchor;\n  items: T[];\n  splitItems?: T[];\n  getKey: (item: T) => Key;\n  renderItem: (item: T) => React.ReactNode;\n  selectedKeys?: Key[];\n  onItemPress?: (key: Key) => void;\n}\n\n/**\n * TODO: refactor to remove the key based interface.\n */\nexport function ToolWindowStripe<T>({\n  anchor,\n  items: mainItems,\n  renderItem: render,\n  splitItems = [],\n  selectedKeys = [],\n  onItemPress,\n  getKey,\n}: ToolWindowStripeProps<T>) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const { getProps, draggingRect, draggingKey, dropPosition } =\n    useMovableStripeButtons({\n      stripeElRef: containerRef,\n      getKey,\n      anchor,\n      mainItems,\n      splitItems,\n      createGetDropPosition: (key: Key) => {\n        const isNotCurrentItem = (anItem: T) => getKey(anItem) !== key;\n        const stripeElement = containerRef.current!;\n        const getItemRect = (key: Key) =>\n          stripeElement\n            .querySelector(`[data-key=\"${key}\"]`)! // FIXME\n            .getBoundingClientRect();\n        return createGetDropPosition({\n          stripeElement: stripeElement,\n          mainItems: mainItems.filter(isNotCurrentItem),\n          splitItems: splitItems.filter(isNotCurrentItem),\n          getKey,\n          anchor,\n          getItemRect,\n        });\n      },\n    });\n\n  const highlighted =\n    dropPosition != null &&\n    draggingKey != null &&\n    [...mainItems, ...splitItems].every((item) => getKey(item) !== draggingKey);\n\n  const renderItem = (item: T) => {\n    const key = getKey(item);\n\n    return (\n      <ToolWindowStripeButton\n        anchor={anchor}\n        key={key}\n        data-key={key}\n        style={{\n          ...getStripeButtonStyles({\n            key,\n            dropPosition,\n            anchor,\n            draggingRect,\n            draggingKey,\n          }),\n        }}\n        {...getProps(key)}\n        active={selectedKeys.includes(key)}\n        onPress={() => onItemPress?.(key)}\n      >\n        {render(item)}\n      </ToolWindowStripeButton>\n    );\n  };\n  return (\n    <>\n      <StyledToolWindowStripe\n        anchor={anchor}\n        preventCollapse={Boolean(dropPosition)}\n        highlighted={highlighted}\n        ref={containerRef}\n      >\n        {mainItems.map(renderItem)}\n        <StyledSpacer />\n        {splitItems.map(renderItem)}\n      </StyledToolWindowStripe>\n    </>\n  );\n}\ntype Rect = Omit<ClientRect, \"toJSON\" | \"x\" | \"y\">;\n\nfunction getStripeButtonStyles({\n  anchor,\n  key,\n  dropPosition,\n  draggingRect,\n  draggingKey,\n}: {\n  anchor: Anchor;\n  key: Key;\n  draggingKey: Key | null;\n  draggingRect: Rect | null;\n  dropPosition: DropPosition | null;\n}) {\n  const styles: CSSProperties = {\n    // transition: \"margin 100ms\", // maybe only when drag is in progress, if unwanted transition at drop\n  };\n  if (dropPosition?.relative?.key === key && draggingRect) {\n    const marginValue = isHorizontalToolWindow(anchor)\n      ? draggingRect.width\n      : draggingRect.height;\n\n    if (isHorizontalToolWindow(anchor)) {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginLeft\"\n          : \"marginRight\"\n      ] = marginValue;\n    } else {\n      styles[\n        dropPosition.relative.placement === \"before\"\n          ? \"marginTop\"\n          : \"marginBottom\"\n      ] = marginValue;\n    }\n  }\n  if (key === draggingKey) {\n    styles.display = \"none\";\n  }\n  return styles;\n}\n\nfunction ToolWindowStripeButton<T, S>({\n  children,\n  anchor,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  onPress,\n  moveDisabled,\n  ...otherProps\n}: {\n  children: React.ReactNode;\n  anchor: Anchor;\n  style: CSSProperties;\n  active: boolean;\n  onPress: () => void;\n  moveDisabled?: boolean;\n  onMoveStart: UseElementMoveOptions<S>[\"onMoveStart\"];\n  onMove: UseElementMoveOptions<S>[\"onMove\"];\n  onMoveEnd: UseElementMoveOptions<S>[\"onMoveEnd\"];\n}) {\n  const ref = useRef<HTMLElement>(null);\n\n  // for some reason, usePress and useMove (used in useElementMove) are not compatible.\n  // it seems onMouseDown in useMove is not called, even when handlers are merged by mergeProps.\n  // FIXME: fix compatibility of useMove and usePress, and switch to usePress({ onPress })\n  const { pressProps } = {\n    pressProps: {\n      onPointerUp: onPress,\n      onMouseDown: (e) => {\n        e.preventDefault();\n      },\n    } as HTMLAttributes<HTMLElement>,\n  }; //usePress({ onPress });\n  const props = useElementMove({\n    ref,\n    disabled: moveDisabled,\n    dragThreshold: 7,\n    ghost: true,\n    onMoveStart,\n    onMove,\n    onMoveEnd,\n  });\n\n  return (\n    <StyledToolWindowStripeButton\n      anchor={anchor}\n      {...mergeProps(otherProps, pressProps, props)}\n      ref={ref}\n    >\n      {children}\n    </StyledToolWindowStripeButton>\n  );\n}\n","import React from \"react\";\nimport { css } from \"styled-components\";\nimport { ResizableView } from \"../ResizableView\";\nimport { styled } from \"../styled\";\nimport { SideUnDockedState } from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\n\nexport const StyledUndockSide = styled.div<{ anchor: Anchor }>`\n  position: absolute;\n  background: inherit;\n  z-index: 1;\n  ${({ anchor }) =>\n    isHorizontalToolWindow(anchor)\n      ? css`\n          left: 0;\n          right: 0;\n        `\n      : css`\n          top: 0;\n          bottom: 0;\n        `};\n  ${({ anchor }) =>\n    css`\n      ${anchor}: 0;\n    `};\n`;\n\nexport function UndockSide({\n  state,\n  anchor,\n  children,\n  onResize,\n}: {\n  state: Exclude<SideUnDockedState, null>;\n  anchor: Anchor;\n  children: React.ReactNode;\n  onResize: (size: number) => void;\n}) {\n  return (\n    state && (\n      <StyledUndockSide anchor={anchor}>\n        <ResizableView\n          orientation={\n            isHorizontalToolWindow(anchor) ? \"vertical\" : \"horizontal\"\n          }\n          resizerPlacement={\n            anchor === \"left\" || anchor === \"top\" ? \"after\" : \"before\"\n          }\n          size={state.size}\n          onResize={onResize}\n        >\n          {children}\n        </ResizableView>\n      </StyledUndockSide>\n    )\n  );\n}\n","import { indexBy } from \"ramda\";\nimport React, {\n  CSSProperties,\n  ForwardedRef,\n  HTMLProps,\n  Key,\n  useImperativeHandle,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\n\nimport { ThreeViewSplitter } from \"../ThreeViewSplitter/ThreeViewSplitter\";\nimport { FocusScope } from \"../utils/FocusScope\";\nimport { FloatToolWindows } from \"./FloatToolWindows\";\nimport { MovableToolWindowStripeProvider } from \"./MovableToolWindowStripeProvider\";\nimport { StyledToolWindowOuterLayout } from \"./StyledToolWindowOuterLayout\";\nimport {\n  getToolWindowsLayoutState,\n  SideDockedState,\n  StripesState,\n  ToolWindowsLayoutState,\n} from \"./ToolWindowsState/ToolWindowsLayoutState\";\nimport { ToolWindowsState } from \"./ToolWindowsState/ToolWindowsState\";\nimport { ToolWindowStateProvider } from \"./ToolWindowsState/ToolWindowStateProvider\";\nimport { ToolWindowStripe } from \"./ToolWindowStripe\";\nimport { UndockSide } from \"./UndockSide\";\nimport { Anchor, isHorizontalToolWindow } from \"./utils\";\nimport { useOnFocusLost } from \"./useOnFocusLost\";\nimport { useInteractOutside } from \"@react-aria/interactions\";\n\ninterface ToolWindow {\n  id: string;\n  toolbarButton: React.ReactNode;\n  content: React.ReactNode;\n}\n\nexport interface ToolWindowsProps {\n  children: React.ReactNode;\n  windows: ToolWindow[];\n  toolWindowsState: Readonly<ToolWindowsState>;\n  onToolWindowStateChange: (newState: ToolWindowsState) => void;\n\n  /**\n   * Whether stripe buttons should be hidden or not.\n   * `hideToolStripes` UISettings in Intellij Platform\n   */\n  hideToolWindowBars?: boolean;\n\n  /**\n   *\n   * `wideScreenSupport` in UISettings in Intellij Platform\n   */\n  useWidescreenLayout?: boolean;\n\n  /**\n   * min width applied to the main content (children).\n   * @default 50\n   */\n  mainContentMinWidth?: number;\n\n  height?: CSSProperties[\"height\"];\n  minHeight?: CSSProperties[\"minHeight\"];\n  margin?: CSSProperties[\"margin\"];\n\n  /**\n   * props to be passed to the container element.\n   */\n  containerProps?: Omit<HTMLProps<HTMLDivElement>, \"as\">;\n}\n\nexport interface ToolWindowRefValue {\n  focus(key: Key): void;\n  hasFocus(key: Key): void;\n  focusLastActiveWindow(): void;\n  focusMainContent(): void;\n  changeState(\n    updater: (currentState: Readonly<ToolWindowsState>) => ToolWindowsState\n  ): void;\n}\n\n/**\n * @constructor\n *\n * Corresponding to ToolWindowPane in Intellij Platform\n *\n * Known issues:\n * - in Firefox and Safari, left and right toolbars are not properly shown. Seems like a nasty bug, since adding and\n * then removing some min-width: fit-content style fixes it.\n * - in the dock view of a side, open only a window from the split ones. then open a window from main ones.\n *   focus is not moved to the just opened window. The reason is we rely on autofocusing and because the React tree\n *   changes for both windows, even the split one which was open will be unmounted and mounted again, and since it's\n *   placed after the main one, and hence mounted later, it will get the focus again. This becomes a bigger issue\n *   if the main one is unpinned, because it immediately gets closed after opening.\n *   Possible solutions:\n *   - make sure the split one won't unmount and mount again in such scenario.\n *   - decouple focusing logic from mounting logic, and only focus windows somehow, when the `isVisible` is changed\n *     from false to true, not when mounted.\n * - related to previous issue: open a tool window in split section of a side. set view mode for a tool window in main\n *   section of the same side to docked_unpinned. try to open the unpinned one while the split one is open. it doesn't\n *   work.\n */\nexport const ToolWindows = React.forwardRef(function ToolWindows(\n  {\n    hideToolWindowBars = false,\n    useWidescreenLayout = false,\n    height = \"100%\",\n    minHeight = \"0\",\n    toolWindowsState,\n    onToolWindowStateChange,\n    windows,\n    children,\n    mainContentMinWidth = 50,\n    containerProps = {},\n  }: ToolWindowsProps,\n  ref: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const windowsById = indexBy(({ id }) => id, windows);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const mainContentFocusScopeRef =\n    useRef<React.ComponentRef<typeof FocusScope>>(null);\n  const [layoutState, setLayoutState] = useState<ToolWindowsLayoutState>();\n  const windowFocusableRefs = useRef<{\n    [key: string]: React.RefObject<React.ComponentRef<typeof FocusScope>>;\n  }>({});\n\n  const latestRef = useLatest({ toolWindowsState, onToolWindowStateChange });\n\n  useLayoutEffect(() => {\n    const container = containerRef.current;\n    const _setLayoutState = () =>\n      setLayoutState(\n        getToolWindowsLayoutState(\n          toolWindowsState,\n          container!.getBoundingClientRect(),\n          windows.map(({ id }) => id)\n        )\n      );\n\n    // If container is rendered but has zero dimensions for any reason, we start observing size changes, until\n    // it's no longer collapsed. Note that we don't want to unconditionally observe resizes and update the layout state.\n    // because tool windows are not supposed to keep the fraction width as the window resizes. They are supposed to have\n    // a fixed width which is determined fraction-based, but only when the tool window is opened. In fact, updating the\n    // layout state, on each and every change to toolWindowsState is also not quite correct, as some state changes\n    // are unrelated and shouldn't cause a re-calculation of the size. FIXME: don't re-calculate fraction base sizes on\n    //  every state change.\n    if (container?.offsetWidth === 0 || container?.offsetHeight === 0) {\n      const observer = new ResizeObserver(([resize]) => {\n        if (resize.contentRect.width > 0 && resize.contentRect.height > 0) {\n          _setLayoutState();\n          observer.unobserve(container);\n        }\n      });\n      observer.observe(container);\n    }\n    _setLayoutState();\n  }, [toolWindowsState]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (key: Key) => {\n        windowFocusableRefs.current[key]?.current?.focus();\n      },\n      hasFocus: (key: Key) =>\n        document.activeElement?.closest(`[data-tool-window-id=\"${key}\"]`) !==\n        null,\n      focusLastActiveWindow: () => {\n        const { lastFocusedKey } = latestRef.current.toolWindowsState;\n        if (lastFocusedKey != null) {\n          if (\n            !latestRef.current.toolWindowsState.windows[lastFocusedKey]\n              .isVisible\n          ) {\n            latestRef.current.onToolWindowStateChange(\n              toolWindowsState.show(lastFocusedKey)\n            );\n          }\n          windowFocusableRefs.current[lastFocusedKey].current?.focus(true);\n        }\n      },\n      focusMainContent: () => {\n        mainContentFocusScopeRef.current?.focus();\n      },\n      changeState: (updater) => {\n        onToolWindowStateChange(updater(latestRef.current.toolWindowsState));\n      },\n    }),\n    []\n  );\n\n  const interactionOutsideRef = useRef(false);\n  useInteractOutside({\n    ref: containerRef,\n    onInteractOutsideStart: () => {\n      interactionOutsideRef.current = true;\n    },\n    onInteractOutside: () => {\n      interactionOutsideRef.current = false;\n    },\n  });\n\n  useOnFocusLost(({ focusReceivingElement }) => {\n    if (!focusReceivingElement && !interactionOutsideRef.current) {\n      mainContentFocusScopeRef.current?.focus();\n    }\n  }, containerRef);\n\n  // TODO: extract component candidate\n  const renderStripe = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: StripesState;\n  }) => (\n    <ToolWindowStripe\n      anchor={anchor}\n      items={state.main}\n      splitItems={state.split}\n      getKey={(item) => item}\n      renderItem={(item) => windowsById[item]?.toolbarButton}\n      onItemPress={(key) =>\n        onToolWindowStateChange(toolWindowsState.toggle(key))\n      }\n      selectedKeys={state.activeKeys}\n    />\n  );\n\n  const renderToolWindow = (key: Key) => {\n    if (!windowFocusableRefs.current[key]) {\n      windowFocusableRefs.current[key] = React.createRef();\n    }\n    return (\n      <div\n        style={{ all: \"unset\" }}\n        data-tool-window-id={key}\n        onFocus={() => {\n          onToolWindowStateChange(toolWindowsState.lastFocused(key));\n        }}\n      >\n        <FocusScope ref={windowFocusableRefs.current[key]}>\n          <ToolWindowStateProvider\n            id={key}\n            containerRef={containerRef}\n            mainContentFocusableRef={mainContentFocusScopeRef}\n            toolWindowsState={toolWindowsState}\n            onToolWindowStateChange={onToolWindowStateChange}\n          >\n            {windowsById[key]?.content}\n          </ToolWindowStateProvider>\n        </FocusScope>\n      </div>\n    );\n  };\n  // TODO: candidate for component extraction\n  const renderSideDockedView = ({\n    anchor,\n    state,\n  }: {\n    anchor: Anchor;\n    state: SideDockedState;\n  }) => {\n    if (!state) {\n      return null;\n    }\n    return (\n      <ThreeViewSplitter\n        innerView={renderToolWindow(state.mainKey)}\n        innerViewMinSize={50}\n        lastView={state.split && renderToolWindow(state.split.key)}\n        lastSize={state.split?.sizeFraction}\n        onLastResize={(newSize) => {\n          onToolWindowStateChange(\n            toolWindowsState.resizeDockSplitView(anchor, newSize)\n          );\n        }}\n        orientation={isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\"}\n      />\n    );\n  };\n  const onDockResize = (anchor: Anchor) => (size: number) => {\n    const containerBounds = containerRef.current?.getBoundingClientRect();\n    // containerBounds should have value in normal course of events\n    if (containerBounds) {\n      onToolWindowStateChange(\n        toolWindowsState.resizeDock(anchor, size, containerBounds)\n      );\n    }\n  };\n  const getSplitViewProps = (\n    layoutState: ToolWindowsLayoutState,\n    orientation: \"horizontal\" | \"vertical\"\n  ) => {\n    const firstAnchor = orientation === \"horizontal\" ? \"left\" : \"top\";\n    const secondAnchor = orientation === \"horizontal\" ? \"right\" : \"bottom\";\n    return {\n      orientation,\n      firstView: renderSideDockedView({\n        anchor: firstAnchor,\n        state: layoutState[firstAnchor].docked,\n      }),\n      firstSize: layoutState[firstAnchor].docked?.size,\n      onFirstResize: onDockResize(firstAnchor),\n      lastView: renderSideDockedView({\n        anchor: secondAnchor,\n        state: layoutState[secondAnchor].docked,\n      }),\n      lastSize: layoutState[secondAnchor].docked?.size,\n      onLastResize: onDockResize(secondAnchor),\n    };\n  };\n  const renderInnerLayout = (layoutState: ToolWindowsLayoutState) => {\n    const horizontalSplitterProps = getSplitViewProps(\n      layoutState,\n      \"horizontal\"\n    );\n    const verticalSplitterProps = getSplitViewProps(layoutState, \"vertical\");\n\n    const [outerSplitterProps, innerSplitterProps] = useWidescreenLayout\n      ? [horizontalSplitterProps, verticalSplitterProps]\n      : [verticalSplitterProps, horizontalSplitterProps];\n\n    const undockLayers = ([\"left\", \"top\", \"right\", \"bottom\"] as const).map(\n      (anchor) => {\n        const state = layoutState[anchor].undocked;\n        return (\n          state && (\n            <UndockSide\n              key={anchor}\n              anchor={anchor}\n              state={state}\n              onResize={(size) => {\n                containerRef.current &&\n                  onToolWindowStateChange(\n                    toolWindowsState.resizeUndock(\n                      anchor,\n                      size,\n                      containerRef.current.getBoundingClientRect()\n                    )\n                  );\n              }}\n            >\n              {renderToolWindow(state.key)}\n            </UndockSide>\n          )\n        );\n      }\n    );\n\n    return (\n      <>\n        <MovableToolWindowStripeProvider\n          onMove={({ to, from }) => {\n            onToolWindowStateChange(\n              toolWindowsState.move(\n                layoutState[from.anchor].stripes[\n                  from.isSplit ? \"split\" : \"main\"\n                ][from.index],\n                { anchor: to.anchor, isSplit: to.isSplit },\n                to.index\n              )\n            );\n          }}\n        >\n          {/**\n           * ToolWindow bars, aka Stripes. Order of stripes is irrelevant for layout but relevant for\n           * priority when stripe buttons are moved across stripes.\n           * layout is handled by `StyledToolWindowOuterLayout`.\n           */}\n          <StyledToolWindowOuterLayout.LeftStripe>\n            {renderStripe({\n              anchor: \"left\",\n              state: layoutState[\"left\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.LeftStripe>\n          <StyledToolWindowOuterLayout.TopStripe>\n            {renderStripe({\n              anchor: \"top\",\n              state: layoutState[\"top\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.TopStripe>\n          <StyledToolWindowOuterLayout.RightStripe>\n            {renderStripe({\n              anchor: \"right\",\n              state: layoutState[\"right\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.RightStripe>\n          <StyledToolWindowOuterLayout.BottomStripe>\n            {renderStripe({\n              anchor: \"bottom\",\n              state: layoutState[\"bottom\"].stripes,\n            })}\n          </StyledToolWindowOuterLayout.BottomStripe>\n        </MovableToolWindowStripeProvider>\n        {/**\n         * The inner layout of the ToolWindow, including four tool windows and\n         * a main content in the center.\n         */}\n        <StyledToolWindowOuterLayout.InnerView>\n          <ThreeViewSplitter\n            {...outerSplitterProps}\n            innerView={\n              <ThreeViewSplitter\n                innerViewMinSize={mainContentMinWidth}\n                innerView={\n                  <FocusScope ref={mainContentFocusScopeRef}>\n                    {children}\n                  </FocusScope>\n                }\n                {...innerSplitterProps}\n              />\n            }\n          />\n          {undockLayers}\n          {\n            <FloatToolWindows\n              floatWindows={layoutState?.floatWindows}\n              renderToolWindow={renderToolWindow}\n              onBoundsChange={(key, bounds) =>\n                onToolWindowStateChange(\n                  toolWindowsState.setFloatingBound(key, bounds)\n                )\n              }\n            />\n          }\n        </StyledToolWindowOuterLayout.InnerView>\n      </>\n    );\n  };\n\n  return (\n    <StyledToolWindowOuterLayout.Shell\n      {...containerProps}\n      ref={containerRef}\n      /**\n       * Potential refactoring: hideStripes can also be handled by conditionally\n       * rendering tool window bars, instead of considering it as a feature of\n       * StyledToolWindowOuterLayout\n       **/\n      hideStripes={hideToolWindowBars}\n      style={{ height, minHeight, ...containerProps?.style }}\n    >\n      {layoutState && renderInnerLayout(layoutState)}\n    </StyledToolWindowOuterLayout.Shell>\n  );\n});\n","import { RefObject, useEffect } from \"react\";\n\n/**\n * Executes a callback function when focus is lost from the container element. i.e. when the currently focused element\n * was within the container and:\n * - The focus is going to an element outside the container, or\n * - The focus is about to get lost (i.e. go to `document.body`).\n *\n * Note: react-aria's `useFocusWithin` (and it's `onBlurWithin` option) can't be used, since (at least currently) it\n * doesn't cover the scenario where the focus is about to get lost due to the focused element getting unmounted.\n */\nexport function useOnFocusLost(\n  onFocusLost: (args: {\n    focusLosingElement: HTMLElement | null;\n    focusReceivingElement: Element | null;\n  }) => void,\n  containerRef: RefObject<HTMLElement>\n): void {\n  useEffect(() => {\n    const handleBodyFocus = (e: FocusEvent) => {\n      if (\n        e.target instanceof HTMLElement &&\n        containerRef.current?.contains(e.target) &&\n        (!e.relatedTarget || e.relatedTarget instanceof HTMLElement) &&\n        !containerRef.current?.contains(e.relatedTarget)\n      ) {\n        onFocusLost({\n          focusLosingElement: e.target,\n          focusReceivingElement: e.relatedTarget,\n        });\n      }\n    };\n    containerRef.current?.addEventListener(\"focusout\", handleBodyFocus);\n    return () => {\n      containerRef.current?.removeEventListener(\"focusout\", handleBodyFocus);\n    };\n  }, []);\n}\n","import React, { Key, RefObject, useContext, useMemo } from \"react\";\nimport { ToolWindowsProps } from \"../ToolWindows\";\nimport { ToolWindowState, ViewMode, WindowBounds } from \"./ToolWindowsState\";\nimport { Anchor } from \"../utils\";\nimport { useEventCallback } from \"@intellij-platform/core/utils/useEventCallback\";\n\ntype ToolWindowStateContextValue = {\n  state: Readonly<ToolWindowState>;\n  hide: () => void;\n  remove: () => void;\n  blur: () => void;\n  focusMainContent: () => void;\n  moveToSide: (args: { anchor: Anchor; isSplit: boolean }) => void;\n  changeViewMode: (viewMode: ViewMode) => void;\n  stretchWidth: (value: number) => void;\n  stretchHeight: (value: number) => void;\n  setFloatingBounds: (bounds: WindowBounds) => void;\n};\nconst ToolWindowStateContext =\n  React.createContext<ToolWindowStateContextValue | null>(null);\n\n/**\n * Used in a tool window's UI tree, to get access to the tool window state and actions for changing it.\n */\nexport const useToolWindowState = () => {\n  const context = useContext(ToolWindowStateContext);\n  if (!context) {\n    throw new Error(\n      \"useToolWindowContext is meant to be used inside a tool window.\"\n    );\n  }\n  return context;\n};\n\n/**\n * Used in ToolWindows to provide tool window state and necessary actions as a context, which will be accessible\n * within the tool window content tree, via {@link useToolWindowState}\n */\nexport const ToolWindowStateProvider: React.FC<\n  {\n    children?: React.ReactNode;\n    id: Key;\n    containerRef: RefObject<HTMLElement>;\n    mainContentFocusableRef: RefObject<{ focus: () => void }>;\n  } & Pick<ToolWindowsProps, \"toolWindowsState\" | \"onToolWindowStateChange\">\n> = ({\n  toolWindowsState,\n  containerRef,\n  mainContentFocusableRef,\n  onToolWindowStateChange,\n  id,\n  children,\n}) => {\n  const blur = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.blur(id));\n  });\n  const hide = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.hide(id));\n  });\n  const remove = useEventCallback(() => {\n    onToolWindowStateChange(toolWindowsState.removeFromSidebar(id));\n  });\n  const focusMainContent = useEventCallback(() => {\n    mainContentFocusableRef.current?.focus();\n  });\n  const moveToSide = useEventCallback(\n    (side: { anchor: Anchor; isSplit: boolean }) => {\n      onToolWindowStateChange(toolWindowsState.move(id, side));\n    }\n  );\n  const changeViewMode = useEventCallback((viewMode: ViewMode) => {\n    onToolWindowStateChange(toolWindowsState.changeViewMode(id, viewMode));\n  });\n  const stretchWidth = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchWidth(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const stretchHeight = useEventCallback((value: number) => {\n    const container = containerRef.current;\n    if (!container) {\n      throw new Error(\"Couldn't resize since the container is not present\");\n    }\n    onToolWindowStateChange(\n      toolWindowsState.stretchHeight(\n        id,\n        value,\n        container.getBoundingClientRect()\n      )\n    );\n  });\n  const setFloatingBounds = useEventCallback((bounds: WindowBounds) => {\n    onToolWindowStateChange(toolWindowsState.setFloatingBound(id, bounds));\n  });\n  const contextValue = useMemo((): ToolWindowStateContextValue => {\n    const state = toolWindowsState.windows[id];\n    return {\n      state,\n      hide,\n      blur,\n      remove,\n      focusMainContent,\n      moveToSide,\n      changeViewMode,\n      stretchWidth,\n      stretchHeight,\n      setFloatingBounds,\n    };\n  }, [toolWindowsState, id]);\n  return (\n    <ToolWindowStateContext.Provider value={contextValue}>\n      {children}\n    </ToolWindowStateContext.Provider>\n  );\n};\n","import { clamp, curry, fromPairs, insert, mapObjIndexed, move } from \"ramda\";\nimport { Key } from \"react\";\nimport { Anchor, isHorizontalToolWindow } from \"../utils\";\n\nexport type ViewMode =\n  | \"docked_pinned\"\n  | \"docked_unpinned\"\n  | \"undock\"\n  | \"float\"\n  /**\n   * @deprecated \"window\" ViewMode was initially added following the original impl. It doesn't seem reasonable to\n   * support it though. It's marked as deprecated to be removed in the future.\n   */\n  | \"window\";\n\nexport type WindowBounds = {\n  top: number;\n  left: number;\n  width: number;\n  height: number;\n};\n\n/**\n * Data structure for keeping the state of a single tool window. very similar to WindowInfo in Intellij Platform\n *\n * A note about about the data structure:\n * Some fields like `isSplit`, `weight`, `floatingBound` are meaningful only\n * for a subset of viewModes. So it may be tempting to introduce a `viewMode`\n * type which minimally and more accurately describes the information\n * relevant for each viewMode. But it's not structured like that, and it's\n * orthogonal to viewMode, since we want to preserve the relevant information\n * for each viewMode, to be used when the viewMode is changed back.\n *\n * NOTE: consider renaming to `WindowState` to avoid confusion with `ToolWindowsState`\n */\nexport interface ToolWindowState {\n  /**\n   * The order of the tool window in its group. The group is specified by `anchor` and `isSplit`.\n   */\n  order: number;\n  /**\n   * Whether the tool window is visible (open) or not.\n   * NOTE: A maximum of 1 **docked** tool window within the same group (same `anchor` and `isSplit`) can be visible.\n   * You will get a render error in `ToolWindows` component otherwise.\n   */\n  isVisible: boolean;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered in the primary group, i.e. when\n   * `isSplit` is false\n   */\n  weight: number;\n  /**\n   * Relative size (in the scale of 0-1) of the tool window in its anchor, when rendered in the secondary group. i.e.\n   * when `isSplit` is true.\n   */\n  sideWeight: number;\n  /**\n   * The side of the tool window, being \"left\", \"right\", \"top\" or \"bottom\"\n   */\n  anchor: Anchor;\n  /**\n   * Specifies whether the tool window should be shown in the split view, aka \"Secondary group\".\n   */\n  isSplit: boolean;\n  /**\n   * Tool windows view mode. See {@link ViewMode}\n   *\n   * NOTE: in Intellij Platform, there is a window `type` and also `docked` and\n   * `autoHide`.\n   * keeping one viewMode makes more sense and prevents invalid combinations\n   * like { type: \"window, \"docked\": true}, that would be unnecessarily allowed.\n   */\n  viewMode: ViewMode;\n  /**\n   * Boundaries of the tool window, when rendered in \"float\" view mode.\n   */\n  floatingBounds?: WindowBounds;\n}\n\nconst isDocked = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" ||\n  toolWindow.viewMode === \"docked_pinned\";\n\n/**\n * Determines whether the tool window should hide on focus. In the java implementation, it's a field on window\n * info instead of being a calculated field. We changed that to match viewMode with the 5 view modes that are possible\n * to choose from the UI, eliminating the combinations that are never allowed. If from UX perspective, having window\n * or float mode with autoHide feature is considered valid at some point, we may need to change the implementation\n * to something similar to the original implementation where isAutoHide and viewMode are separate.\n */\nconst isAutoHide = (toolWindow: ToolWindowState) =>\n  toolWindow.viewMode === \"docked_unpinned\" || toolWindow.viewMode === \"undock\";\n\nexport type SideInfo = Pick<ToolWindowState, \"anchor\" | \"isSplit\">;\nexport const areInSameSection = curry(\n  (window1: SideInfo, window2: SideInfo) =>\n    window1.anchor === window2.anchor && window1.isSplit === window2.isSplit\n);\n\nexport const getViewModeType = (viewMode: ViewMode) => {\n  if (viewMode === \"docked_pinned\" || viewMode === \"docked_unpinned\") {\n    return \"docked\";\n  }\n  if (viewMode === \"window\" || viewMode === \"float\") {\n    return \"float\";\n  }\n  return viewMode;\n};\ntype IdToWindowStateMap = Readonly<{\n  [key: string]: Readonly<ToolWindowState>;\n}>;\n\n/**\n * Represents UI state of a bunch of tool windows. What is rendered inside each window or toolbar button is irrelevant.\n *\n * TODO: document pros and cons of these two approaches\n * - Having a class for ToolWindowsState which keeps a readonly mapping of keys to window states.\n * - Having ToolWindowsState as an interface (a mapping from keys to window states), and a bunch of action functions\n *   which accept a window state and some arguments, and return a new window state.\n */\nexport class ToolWindowsState {\n  public readonly lastFocusedKey: Key | null;\n  public readonly removedFromSideBarIds: ReadonlySet<Key>;\n  private readonly layoutToRestore: IdToWindowStateMap;\n  constructor(\n    public readonly windows: IdToWindowStateMap,\n    {\n      lastFocusedKey = null,\n      layoutToRestore = {},\n      removedFromSideBarIds = [],\n    }: {\n      lastFocusedKey?: Key | null;\n      layoutToRestore?: IdToWindowStateMap;\n      removedFromSideBarIds?: Iterable<Key>;\n    } = {}\n  ) {\n    this.lastFocusedKey = lastFocusedKey;\n    this.layoutToRestore = layoutToRestore;\n    this.removedFromSideBarIds = new Set(removedFromSideBarIds);\n    // TODO: instead of keeping a set of removedFromSideBarIds showStripeButton can be a boolean on each window state.\n    //  if we want to avoid the invalid combination of `{ isVisible: true, showStripeButton: false }`, we can have a\n    //  a single property like : visibility: 'open' | 'closed' | 'removed'\n    const invalidWindows = Object.keys(this.windows).filter(\n      (key) =>\n        this.removedFromSideBarIds.has(key) && this.windows[key].isVisible\n    );\n    if (invalidWindows.length > 0) {\n      throw new Error(\n        `Invalid ToolWindowsState. The following windows are set as visible but are removed from the sidebar: ${invalidWindows}`\n      );\n    }\n  }\n\n  hide(targetKey: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow, key) =>\n      key === targetKey\n        ? {\n            ...toolWindow,\n            isVisible: false,\n          }\n        : toolWindow\n    );\n  }\n  hideAll(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) =>\n        getViewModeType(toolWindow.viewMode) === \"float\"\n          ? toolWindow\n          : {\n              ...toolWindow,\n              isVisible: false,\n            },\n      { layoutToRestore: this.windows }\n    );\n  }\n\n  /**\n   * Restores windows to the state before hideAll.\n   */\n  restoreWindows(): ToolWindowsState {\n    return this.mapWindows(\n      (toolWindow, key) => this.layoutToRestore[key] || toolWindow\n    );\n  }\n\n  lastFocused(key: Key): ToolWindowsState {\n    return this.mapWindows((toolWindow) => toolWindow, {\n      lastFocusedKey: key,\n    });\n  }\n\n  show(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const closableViewModes: ViewMode[] = [];\n    if (target.viewMode === \"undock\") {\n      closableViewModes.push(\"undock\");\n    } else if (isDocked(target)) {\n      closableViewModes.push(\"docked_unpinned\", \"docked_pinned\", \"undock\");\n    }\n    return this.mapWindows(\n      (toolWindow, key) => {\n        if (key === targetKey) {\n          return {\n            ...toolWindow,\n            isVisible: true,\n          };\n        }\n        if (\n          toolWindow.isVisible &&\n          areInSameSection(target, toolWindow) &&\n          closableViewModes.includes(toolWindow.viewMode)\n        ) {\n          return { ...toolWindow, isVisible: false };\n        }\n        return toolWindow;\n      },\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds].filter(\n          (key) => key !== targetKey\n        ),\n      }\n    );\n  }\n\n  toggle(targetKey: Key): ToolWindowsState {\n    return this.windows[targetKey]?.isVisible\n      ? this.hide(targetKey)\n      : this.show(targetKey);\n  }\n\n  blur(targetKey: Key): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target || !isAutoHide(target)) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  // TODO: initiate floatingBound when changing viewMode to float or window and there is no previous floatingBound\n  changeViewMode(targetKey: Key, viewMode: ViewMode): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((toolWindow) => {\n      if (toolWindow === target) {\n        return {\n          ...toolWindow,\n          viewMode,\n        };\n      }\n      const viewModeType = getViewModeType(toolWindow.viewMode);\n      if (\n        toolWindow.isVisible &&\n        viewModeType !== \"float\" &&\n        areInSameSection(toolWindow, target) &&\n        viewModeType === getViewModeType(viewMode)\n      ) {\n        return {\n          ...toolWindow,\n          isVisible: false,\n        };\n      }\n      return toolWindow;\n    });\n  }\n\n  move(targetKey: Key, index: number): ToolWindowsState;\n  move(targetKey: Key, side: SideInfo, index?: number): ToolWindowsState;\n  move(\n    targetKey: Key,\n    sideOrIndex: SideInfo | number,\n    index?: number\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const targetSide = typeof sideOrIndex === \"object\" ? sideOrIndex : target;\n    const targetIndex = typeof sideOrIndex === \"number\" ? sideOrIndex : index;\n    const targetSideWindows = Object.entries(this.windows).filter(([, value]) =>\n      areInSameSection(targetSide, value)\n    );\n    const indexInTargetSide = targetSideWindows.findIndex(\n      ([, window]) => window === target\n    );\n    const sortedTargetWindows: Array<[Key, ToolWindowState]> =\n      indexInTargetSide < 0\n        ? insert(\n            targetIndex ?? -1,\n            [targetKey, { ...target, ...targetSide }],\n            targetSideWindows\n          )\n        : move(\n            indexInTargetSide,\n            targetIndex ?? indexInTargetSide,\n            targetSideWindows\n          );\n    const newTargetSideWindows = fromPairs(\n      sortedTargetWindows.map(([key, value], index) => {\n        let newValue = value;\n        if (value.order !== index) {\n          newValue = { ...value, order: index };\n        }\n        const targetViewMode = getViewModeType(target.viewMode);\n        if (\n          key !== targetKey &&\n          target.isVisible &&\n          value.isVisible &&\n          targetViewMode !== \"float\" &&\n          getViewModeType(value.viewMode) === targetViewMode\n        ) {\n          newValue = { ...value, isVisible: false };\n        }\n        return [`${key}`, newValue];\n      })\n    );\n    return this.mapWindows((value, key) => newTargetSideWindows[key] || value);\n  }\n\n  stretchWidth(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"width\");\n  }\n\n  stretchHeight(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.stretch(targetKey, value, containerBounds, \"height\");\n  }\n\n  setFloatingBound(\n    targetKey: Key,\n    floatingBounds: WindowBounds\n  ): ToolWindowsState {\n    return this.update(targetKey, \"floatingBounds\", floatingBounds);\n  }\n\n  removeFromSidebar(targetKey: Key): ToolWindowsState {\n    return this.mapWindows(\n      (state, key) =>\n        key === targetKey\n          ? {\n              ...state,\n              isVisible: false,\n            }\n          : state,\n      {\n        removedFromSideBarIds: [...this.removedFromSideBarIds, targetKey],\n      }\n    );\n  }\n\n  mapWindows(\n    mapFn: (toolWindow: ToolWindowState, key: string) => ToolWindowState,\n    options: ConstructorParameters<typeof ToolWindowsState>[1] = {}\n  ) {\n    return new ToolWindowsState(mapObjIndexed(mapFn, this.windows), {\n      lastFocusedKey: this.lastFocusedKey,\n      layoutToRestore: this.layoutToRestore,\n      removedFromSideBarIds: this.removedFromSideBarIds,\n      ...options,\n    });\n  }\n\n  private update<K extends keyof ToolWindowState>(\n    targetKey: Key,\n    key: K,\n    value: ToolWindowState[K]\n  ) {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    return this.mapWindows((window) => {\n      if (window === target) {\n        return {\n          ...window,\n          [key]: value,\n        };\n      }\n      return window;\n    });\n  }\n\n  private stretch(\n    targetKey: Key,\n    value: number,\n    containerBounds: { width: number; height: number },\n    property: \"width\" | \"height\"\n  ): ToolWindowsState {\n    const target = this.windows[targetKey];\n    if (!target) {\n      return this;\n    }\n    const viewModeType = getViewModeType(target.viewMode);\n    if (viewModeType === \"float\") {\n      return this.mapWindows((window) => {\n        if (window === target) {\n          const currentFloatingBound = window.floatingBounds!;\n          return {\n            ...window,\n            floatingBounds: {\n              ...currentFloatingBound,\n              [property]: currentFloatingBound[property] + value,\n            },\n          };\n        }\n        return window;\n      });\n    }\n    const expectedProperty = isHorizontalToolWindow(target.anchor)\n      ? \"height\"\n      : \"width\";\n    if (expectedProperty !== property) {\n      return this;\n    }\n    const containerSize = containerBounds[property];\n    const newValue = containerSize * target.weight + value;\n    const isNewValueValid = clamp(0, containerSize, newValue) === newValue;\n    if (isNewValueValid) {\n      if (viewModeType === \"docked\") {\n        return this.resizeDock(target.anchor, newValue, containerBounds);\n      } else {\n        return this.resizeUndock(target.anchor, newValue, containerBounds);\n      }\n    }\n    return this;\n  }\n\n  resizeDock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(true, anchor, size, containerBounds);\n  }\n\n  resizeUndock(\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.resizeSide(false, anchor, size, containerBounds);\n  }\n\n  resizeDockSplitView(anchor: Anchor, weight: number): ToolWindowsState {\n    return this.mapWindows((window) => {\n      if (window.anchor === anchor && window.isVisible && isDocked(window)) {\n        return {\n          ...window,\n          sideWeight: window.isSplit ? weight : 1 - weight,\n        };\n      }\n      return window;\n    });\n  }\n\n  private resizeSide(\n    dock: boolean,\n    anchor: Anchor,\n    size: number,\n    containerBounds: { width: number; height: number }\n  ): ToolWindowsState {\n    return this.mapWindows((window) => {\n      const isInResizingView = dock\n        ? isDocked(window)\n        : window.viewMode === \"undock\";\n      if (window.anchor === anchor && isInResizingView && window.isVisible) {\n        const containerSize = !isHorizontalToolWindow(anchor)\n          ? containerBounds.width\n          : containerBounds.height;\n        return {\n          ...window,\n          weight: size / containerSize,\n        };\n      }\n      return window;\n    });\n  }\n}\n\nexport const toolWindowState = ({\n  viewMode = \"docked_pinned\",\n  ...inputs\n}: Partial<ToolWindowState> = {}): ToolWindowState => ({\n  anchor: \"left\",\n  isSplit: false,\n  viewMode: viewMode,\n  order: 1,\n  weight: 0.2,\n  sideWeight: 0.5,\n  isVisible: false,\n  floatingBounds:\n    getViewModeType(viewMode) === \"float\"\n      ? {\n          left: 300,\n          top: 300,\n          width: 600,\n          height: 300,\n        }\n      : undefined,\n  ...inputs,\n});\n","export type Anchor = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport const getAnchorOrientation = (\n  anchor: Anchor\n): \"horizontal\" | \"vertical\" =>\n  isHorizontalToolWindow(anchor) ? \"horizontal\" : \"vertical\";\n\nexport const isHorizontalToolWindow = (anchor: Anchor) =>\n  anchor === \"top\" || anchor === \"bottom\";\n\nexport const theOtherSide = (anchor: Anchor) =>\n  ({\n    left: \"right\" as const,\n    right: \"left\" as const,\n    top: \"bottom\" as const,\n    bottom: \"top\" as const,\n  }[anchor]);\n","import React, { RefObject, useEffect, useRef, useState } from \"react\";\nimport { useFocusWithin } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport { useOverlayMoveHandle } from \"@intellij-platform/core/Overlay\";\nimport { useFocusForwarder } from \"@intellij-platform/core/utils/useFocusForwarder\";\n\nexport function useToolWindow(\n  {\n    containerRef,\n    contentRef,\n    focusableContentRef,\n  }: {\n    containerRef: RefObject<HTMLElement>;\n    contentRef: RefObject<Element>;\n    focusableContentRef: RefObject<{ focus: () => void }>;\n  },\n  { onFocusChange }: { onFocusChange?: (focused: boolean) => void } = {}\n) {\n  const [contentHasFocus, setContentHasFocus] = useState(false);\n  /**\n   * NOTE: useFocusWithin form @react-aria/interactions (at least until 3.5.1) has a couple of problem, because of which\n   * we may need to implement our own version of it.\n   * - It doesn't play nice with FocusScope with `contain` set to true. When something is blurred, FocusScope prevents\n   *   that by restoring focus back immediately. but the blur event is already caught by useFocusWithin. One solution\n   *   would be to change useFocusWithin implementation to ignore these blur events that are immediately followed\n   *   by a focus event that keeps the focus in.\n   * - useFocusWithin has an inconsistent behaviour when it comes to Portals. Since it uses react props for handling\n   *   focus and blur, the [react tree determines event bubbling](https://reactjs.org/docs/portals.html#event-bubbling-through-portals),\n   *   which can be a very nice feature, when an overlay (rendered in a portal) grabs the focus, which should still\n   *   be seen as \"within\". But the problems is that the current implementation uses DOM `.contains(e.relatedTarget)`\n   *   method to determine if focus is no longer within. First of all, using react tree or dom tree to determine \"within\"\n   *   can be seen as an option perhaps. Secondly, it should be consistent on focus and blur.\n   *\n   *   Right now these problems are no big deal. but it may become an issue when portals are used within the content\n   *   of the tool window.\n   *\n   * NOTE: In the original implementation, when a heading toolbar button opens a menu, and focus goes to menu, the\n   * header loses the focus appearance, ant it relies only on content having the focus.\n   */\n  const { focusWithinProps: contentFocusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setContentHasFocus,\n  });\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: onFocusChange,\n  });\n\n  const { toolWindowProps: autoHideProps } = useAutoHide();\n\n  const { focusForwarderProps } = useFocusForwarder({\n    forwardFocus: focusableContentRef.current?.focus,\n    ignoreFocusedDescendant: true,\n  });\n\n  // If there is no focusable content rendered in the tool window, nothing will be autofocused. In that case\n  // we will focus the tool window container itself as a fallback.\n  useEffect(() => {\n    if (\n      !document.activeElement ||\n      !containerRef.current?.contains(document.activeElement)\n    ) {\n      containerRef.current?.focus();\n    }\n  }, []);\n\n  const { moveHandleProps } = useOverlayMoveHandle();\n\n  return {\n    contentHasFocus,\n    toolWindowProps: mergeProps(\n      focusForwarderProps,\n      focusWithinProps,\n      autoHideProps,\n      {\n        tabIndex: -1,\n      }\n    ),\n    toolWindowContentProps: contentFocusWithinProps,\n    toolWindowHeaderProps: moveHandleProps,\n  };\n}\n\n/**\n * Applies the auto hide behaviour of tool window based on view mode information and by handling focus and blur events,\n * on the root tool window element. Returns the necessary props that should be applied to the root tool window element.\n * The implementation is not perfect and may not 100% match the original Intellij Platform implementation.\n * If this focus based implementation for auto hide proves to be fragile and not good enough in future,\n * an alternative approach would be to move auto hide logic to the state management logic as much as possible,\n * and limit the focus based auto-hiding to only when the focus goes within the main content area. That should have\n * less focus-related edge cases.\n * TODO: auto hide behaviour should be moved to the core ToolWindows API. ToolWindows now renders a FocusScope and\n * handles focus events on any tool window, to track last focused tool window.\n */\nfunction useAutoHide() {\n  const { blur } = useToolWindowState();\n  const hideTimeoutId = useRef<number | null>(null);\n  const { focusWithinProps: windowFocusWithinProps } = useFocusWithin({\n    onBlurWithin: (e) => {\n      // setTimeout and windowHasFocusRef is to work around the problem with useFocusWithin, described above.\n      hideTimeoutId.current = window.setTimeout(() => {\n        // Sometimes when the element is blurred, the subsequent focus that is triggered by FocusScope to keep the focus\n        // is a little delayed and therefore after the timeout reaches. It seem to happen only when a non-focusable\n        // area is clicked. We mitigate it by ignoring blur events where nothing is focused. It's not a problem\n        // at least with `DefaultToolWindow` implementation that uses a FocusScope.\n        const isSomethingElseFocused = e.relatedTarget;\n        if (isSomethingElseFocused) {\n          blur();\n        }\n      });\n    },\n    onFocusWithin: () => {\n      if (hideTimeoutId.current !== null) {\n        clearTimeout(hideTimeoutId.current);\n        hideTimeoutId.current = null;\n      }\n    },\n  });\n  return {\n    toolWindowProps: windowFocusWithinProps,\n  };\n}\n","import React from \"react\";\nimport { DividerItem } from \"@intellij-platform/core/Collections\";\nimport { useToolWindowState } from \"@intellij-platform/core/ToolWindows\";\nimport {\n  useAction,\n  useActionGroup,\n} from \"@intellij-platform/core/ActionSystem\";\nimport {\n  ActionItem,\n  ActionsMenu,\n} from \"@intellij-platform/core/ActionSystem/components\";\nimport {\n  MOVE_TO_ACTION_GROUP_ID,\n  TOOL_WINDOW_RESIZE_ACTION_GROUP_ID,\n  VIEW_MODE_ACTION_GROUP_ID,\n  ViewModeToActionId,\n} from \"./useToolWindowActions\";\nimport {\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { MenuTriggerProps } from \"@intellij-platform/core/Menu\";\n\n/**\n * Tool window gear icon menu, with a set of default actions and some extra ones.\n * TODO: add support for extra actions when action system is progressed a little.\n */\nexport function ToolWindowSettingsIconMenu({\n  menuProps,\n}: {\n  menuProps: Parameters<MenuTriggerProps[\"renderMenu\"]>[0][\"menuProps\"];\n}) {\n  const { state } = useToolWindowState();\n\n  const viewModeActionGroup = useActionGroup(VIEW_MODE_ACTION_GROUP_ID);\n  const moveToActionGroup = useActionGroup(MOVE_TO_ACTION_GROUP_ID);\n  const resizeActions = useActionGroup(TOOL_WINDOW_RESIZE_ACTION_GROUP_ID);\n  const maximizeAction = useAction(MAXIMIZE_TOOL_WINDOW_ACTION_ID);\n  const removeFromSideBarAction = useAction(\n    REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID\n  );\n  if (\n    !viewModeActionGroup ||\n    !moveToActionGroup ||\n    !resizeActions ||\n    !maximizeAction ||\n    !removeFromSideBarAction\n  ) {\n    throw new Error(\n      \"[ToolWindowSettingsIconMenu]: can't find tool window actions.\"\n    );\n  }\n\n  const gearIconActions: Array<ActionItem> = [\n    viewModeActionGroup,\n    moveToActionGroup,\n    {\n      id: \"resize\",\n      title: \"Resize\",\n      menuPresentation: \"submenu\",\n      children: [...resizeActions.children, maximizeAction],\n    },\n    new DividerItem(),\n    removeFromSideBarAction,\n  ];\n  return (\n    <ActionsMenu\n      actions={gearIconActions}\n      selectedKeys={[ViewModeToActionId[state.viewMode]]}\n      {...menuProps}\n    />\n  );\n}\n","import React, { HTMLProps } from \"react\";\nimport { IconButton } from \"@intellij-platform/core/IconButton\";\nimport { Toolbar } from \"@intellij-platform/core/Toolbar/Toolbar\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { MenuTrigger } from \"@intellij-platform/core/Menu/MenuTrigger\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport { StyledHorizontalSeparator } from \"@intellij-platform/core/StyledSeparator\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme/Theme\";\nimport { ToolWindowSettingsIconMenu } from \"./ToolWindowSettingsIconMenu\";\nimport {\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { ActionButton } from \"@intellij-platform/core/ActionSystem/components\";\n\nexport interface ToolWindowHeaderProps\n  extends Omit<HTMLProps<HTMLDivElement>, \"ref\" | \"as\"> {\n  contentHasFocus?: boolean;\n  additionalActions?: React.ReactNode;\n}\n\nconst StyledToolWindowHeader = styled.div<{ active: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: end; // to have the content overflow from right, as the toolwindow shrinks. That will keep the left-most buttons in the view\n  padding: 0 2px 0 4px;\n  overflow: hidden; // for the negative margin applied on StyledToolWindowHeaderActions\n  border-bottom: 1px solid\n    ${({ theme }) =>\n      theme.color(\n        \"ToolWindow.Header.borderColor\" as UnknownThemeProp<\"ToolWindow.Header.borderColor\">\n      ) ||\n      theme.color(\"DefaultTabs.borderColor\") ||\n      theme.commonColors.contrastBorder};\n  background: ${({ theme, active }) =>\n    active\n      ? theme.color(\"ToolWindow.Header.background\") ||\n        theme.color(\n          \"ToolWindow.header.active.background\" as UnknownThemeProp<\"ToolWindow.header.active.background\">\n        ) ||\n        \"#E2E6EC\"\n      : theme.color(\"ToolWindow.Header.inactiveBackground\") ||\n        theme.color(\"ToolWindow.Header.background\") ||\n        \"#ECECEC\"};\n`;\n\nconst StyledToolWindowHeaderActions = styled.div`\n  margin-right: -4px;\n`;\n\nconst StyledToolWindowHeaderContent = styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n  overflow: hidden;\n`;\n\nexport const DefaultToolWindowHeader: React.FC<ToolWindowHeaderProps> = ({\n  children,\n  additionalActions,\n  contentHasFocus = false,\n  ...otherProps\n}) => {\n  return (\n    <StyledToolWindowHeader active={contentHasFocus} {...otherProps}>\n      <StyledToolWindowHeaderContent>{children}</StyledToolWindowHeaderContent>\n      <StyledToolWindowHeaderActions>\n        <Toolbar>\n          {additionalActions && (\n            <>\n              {additionalActions}\n              <StyledHorizontalSeparator />\n            </>\n          )}\n          <ActionButton actionId={DOCK_TOOL_WINDOW_ACTION_ID} />\n          <MenuTrigger\n            renderMenu={({ menuProps }) => {\n              return <ToolWindowSettingsIconMenu menuProps={menuProps} />;\n            }}\n          >\n            {(props, ref) => (\n              <TooltipTrigger tooltip={<ActionTooltip actionName=\"Options\" />}>\n                <IconButton {...props} ref={ref}>\n                  <PlatformIcon icon=\"general/gearPlain\" />\n                </IconButton>\n              </TooltipTrigger>\n            )}\n          </MenuTrigger>\n          <ActionButton actionId={HIDE_ACTIVE_WINDOW_ACTION_ID} />\n        </Toolbar>\n      </StyledToolWindowHeaderActions>\n    </StyledToolWindowHeader>\n  );\n};\n","import React, { useContext, useMemo, useRef } from \"react\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { DOMProps } from \"@react-types/shared\";\nimport { styled } from \"@intellij-platform/core/styled\";\nimport {\n  FocusScope,\n  FocusScopeRef,\n} from \"@intellij-platform/core/utils/FocusScope\";\nimport {\n  ActionDefinition,\n  ActionsProvider,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { useToolWindow } from \"./useToolWindow\";\nimport { DefaultToolWindowHeader } from \"./DefaultToolWindowHeader\";\nimport { useToolWindowActions } from \"./useToolWindowActions\";\n\nexport interface DefaultToolWindowProps extends DOMProps {\n  children?: React.ReactNode;\n  /**\n   * title to be shown on the left side of the tool window header.\n   */\n  headerContent?: React.ReactNode;\n  /**\n   * additional action buttons to be rendered before the default gear and hide buttons.\n   */\n  additionalActions?: React.ReactNode;\n  /**\n   * Actions to be provided in the tool window, in addition to the default tool window actions.\n   */\n  actions?: ActionDefinition[];\n  /**\n   * The title of main part of the tool windows component. Used in tool window actions.\n   * @default \"Editor\"\n   */\n  mainContentTitle?: string;\n  onFocusChange?: (focused: boolean) => void;\n}\n\nconst StyledToolWindowContainer = styled.div`\n  outline: none;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  width: 100%;\n  flex: 1;\n`;\nconst StyledToolWindowContent = styled.div`\n  flex: 1;\n  overflow: auto;\n`;\n\ninterface DefaultToolWindowContextObj {\n  hasFocus?: boolean;\n}\n\nconst DefaultToolWindowContext =\n  React.createContext<DefaultToolWindowContextObj>({\n    hasFocus: false,\n  });\n\nexport const useDefaultToolWindowContext = () =>\n  useContext(DefaultToolWindowContext);\n/**\n * Default component for rendering the content of a tool window. It supports a header and a scrollable area.\n * The header supports showing a content, and some default+custom actions on the right.\n *\n * @see MultiContentToolWindow\n *\n * Remaining features:\n * - Additional gear menu actions.\n *\n */\nexport const DefaultToolWindow: React.FC<DefaultToolWindowProps> = ({\n  headerContent,\n  children,\n  additionalActions,\n  onFocusChange,\n  actions,\n  mainContentTitle = \"Editor\",\n  ...otherProps\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const focusableContentRef = useRef<FocusScopeRef>(null);\n  const {\n    // NOTE: we might as well use :focus-within and target StyledToolWindowHeader to set the background, but it's not\n    // a clear improvement.\n    contentHasFocus,\n    toolWindowProps,\n    toolWindowContentProps,\n    toolWindowHeaderProps,\n  } = useToolWindow(\n    { containerRef, contentRef, focusableContentRef },\n    {\n      onFocusChange,\n    }\n  );\n\n  const defaultToolWindowContext = useMemo(\n    () => ({\n      hasFocus: contentHasFocus,\n    }),\n    [contentHasFocus]\n  );\n  const activeToolWindowActionGroup = useToolWindowActions({\n    mainContentTitle,\n  });\n  const allActions = [activeToolWindowActionGroup, ...(actions || [])];\n\n  return (\n    <ActionsProvider actions={allActions}>\n      {({ shortcutHandlerProps }) => (\n        <StyledToolWindowContainer\n          {...mergeProps(\n            toolWindowProps,\n            shortcutHandlerProps,\n            filterDOMProps(otherProps)\n          )}\n          ref={containerRef}\n        >\n          <DefaultToolWindowContext.Provider value={defaultToolWindowContext}>\n            <DefaultToolWindowHeader\n              additionalActions={additionalActions}\n              contentHasFocus={contentHasFocus}\n              {...toolWindowHeaderProps}\n            >\n              {headerContent}\n            </DefaultToolWindowHeader>\n            <StyledToolWindowContent\n              ref={contentRef}\n              {...toolWindowContentProps}\n            >\n              {/**\n               * FIXME: adding `contain` prevents focus from moving to another focus scope both with mouse and keyboard.\n               * If we want to follow the Intellij Platform behaviour exactly, we need a kind of focus containment, where\n               * focus is trapped only for keyboard interaction, and user can still move focus by clicking another scope.\n               * Maybe a custom useFocusContainment hook and a separate option for activating it on our own FocusScope.\n               */}\n              <FocusScope ref={focusableContentRef} autoFocus>\n                {children}\n              </FocusScope>\n            </StyledToolWindowContent>\n          </DefaultToolWindowContext.Provider>\n        </StyledToolWindowContainer>\n      )}\n    </ActionsProvider>\n  );\n};\n","import React from \"react\";\nimport { Shortcut, useAction } from \"@intellij-platform/core/ActionSystem\";\nimport { ActionTooltip, TooltipTrigger } from \"@intellij-platform/core/Tooltip\";\nimport { getActivateToolWindowActionId } from \"./useToolWindowsActions\";\nimport styled from \"styled-components\";\n\nconst getToolWindowNumberFromShortcut = (shortcut: Shortcut): number | null => {\n  const num =\n    shortcut.type === \"keyboard\" &&\n    shortcut.firstKeyStroke.modifiers?.length === 1 &&\n    [\"Alt\", \"Meta\", \"Control\"].includes(shortcut.firstKeyStroke.modifiers[0]) &&\n    shortcut.firstKeyStroke.code.match(/^(Digit|Numpad)([0-9])$/)?.[2];\n  if (num) {\n    return parseInt(num);\n  }\n  return null;\n};\n\nconst StyledWrapper = styled.span`\n  display: flex;\n`;\n\n/**\n * Default UI for the toolbar button (aka. stripe button) of the tool window.\n * - Renders the title and icon for the tool window\n * - Optionally shows the number before the title, if a numeric shortcut is set for the corresponding ActivateToolWindow\n *   action, in the currently applied keymap.\n * - Adds an Action Tooltip\n */\nexport const DefaultToolWindowToolbarButton = ({\n  id,\n  title,\n  icon,\n  showNumber = true,\n}: {\n  id: React.Key;\n  title: string;\n  icon: React.ReactNode;\n  showNumber?: boolean;\n}) => {\n  const action = useAction(getActivateToolWindowActionId(`${id}`));\n\n  const number = action?.shortcuts\n    ?.map(getToolWindowNumberFromShortcut)\n    .find(Number.isInteger);\n  return (\n    <TooltipTrigger\n      tooltip={<ActionTooltip actionName={title} shortcut={action?.shortcut} />}\n    >\n      <StyledWrapper>\n        {icon}\n        &nbsp;\n        {number != null && showNumber ? (\n          <>\n            <u>{number}</u>:&nbsp;\n          </>\n        ) : null}\n        {title}\n      </StyledWrapper>\n    </TooltipTrigger>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { indexBy } from \"ramda\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport {\n  ToolWindowRefValue,\n  ToolWindows,\n  ToolWindowsProps,\n} from \"@intellij-platform/core/ToolWindows\";\nimport { useToolWindowsActions } from \"./useToolWindowsActions\";\nimport { DefaultToolWindowToolbarButton } from \"./DefaultToolWindowToolbarButton\";\nimport { ActionsProvider } from \"@intellij-platform/core/ActionSystem\";\n\ninterface DefaultToolWindow {\n  id: string;\n  title: string;\n  icon: React.ReactNode;\n  content: React.ReactNode;\n}\n\n/**\n * A wrapper around ToolWindows, which provides default actions. It also expects windows to have a `title` and an `icon`\n * instead of more generic `toolbarButton`. The `title` and `icon` are then used in toolbar button, and also in the\n * actions that are dynamically created for each window to toggle/focus the tool window.\n */\nexport const DefaultToolWindows = React.forwardRef(function DefaultToolWindows(\n  {\n    windows: toolWindows,\n    toolWindowsState,\n    showNumbers,\n    ...props\n  }: Omit<ToolWindowsProps, \"windows\"> & {\n    windows: DefaultToolWindow[];\n    showNumbers?: boolean;\n  },\n  forwardedRef: ForwardedRef<ToolWindowRefValue>\n): React.ReactElement {\n  const toolWindowsRef = useObjectRef(forwardedRef);\n  const windowById = indexBy(({ id }) => id, toolWindows);\n  const actions = useToolWindowsActions({\n    toolWindowsRef,\n    toolWindowsState,\n    getPresentation: (id) => windowById[id],\n  });\n  return (\n    <ActionsProvider actions={actions}>\n      {({ shortcutHandlerProps }) => (\n        <ToolWindows\n          {...props}\n          ref={toolWindowsRef}\n          toolWindowsState={toolWindowsState}\n          windows={toolWindows.map(({ id, icon, content, title }) => ({\n            id,\n            toolbarButton: (\n              <DefaultToolWindowToolbarButton\n                id={id}\n                icon={icon}\n                title={title}\n                showNumber={showNumbers}\n              />\n            ),\n            content,\n          }))}\n          containerProps={mergeProps(\n            props.containerProps || {},\n            shortcutHandlerProps\n          )}\n        />\n      )}\n    </ActionsProvider>\n  );\n});\n","import React, { Key, useEffect, useState } from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { DefaultToolWindow, DefaultToolWindowProps } from \"./DefaultToolWindow\";\nimport { TabItem } from \"../Tabs/TabItem\";\nimport { usePrevious } from \"../utils/usePrevious\";\nimport { ToolWindowTabs } from \"../Tabs/ToolWindowTabs/ToolWindowTabs\";\n\nexport interface MultiContentToolWindowProps\n  extends Pick<DefaultToolWindowProps, \"additionalActions\"> {\n  /**\n   * List of contents that will be accessible with a list of grouped or ungrouped tabs in the tool window header.\n   */\n  children:\n    | React.ReactElement<MultiContentToolWindowContentProps>[]\n    | React.ReactElement<MultiContentToolWindowContentProps>;\n  /**\n   * Key of currently active content\n   */\n  activeKey?: Key;\n  defaultActiveKey?: Key;\n  onActiveKeyChange?: (key: Key) => void;\n  /**\n   * If true, it groups tabs in a dropdown instead.\n   *\n   * @default false\n   */\n  groupTabs?: boolean;\n  /**\n   * The content shown as the title of the tool window, before content switcher (tabs or dropdown).\n   * For more control over header content, you can pass a function which accepts rendered content switcher,\n   * and then you can compose it with other content as you wish. Use case examples of function variant:\n   * - You want to render a title before the content switcher, and something after the tabs. Like a \"+\" button in\n   *   terminal.\n   * - You want to conditionally move inner-content header up to the tool window header, if there is only one tab. In\n   *   that case you don't need to render the content switcher at all. An example is the new design in the \"Run\"\n   *   tool window.\n   */\n  headerContent?:\n    | React.ReactNode\n    | ((props: { renderedViewSwitcher: React.ReactNode }) => React.ReactNode);\n}\n\n/**\n * Implemented on top of DefaultToolWindow, allows for multiple tabbed content within a tool window.\n * Remaining features:\n * - Although trivial, group tabs action in tool window header gear icon is intentionally left unimplemented for now,\n *   until an increment on action system is done.\n * - Grouped mode is not implemented currently, as we don't have a dropdown component. Though it seems it's just a\n *   MenuTrigger and some trigger with a arrow icon.\n */\nexport const MultiViewToolWindow = ({\n  groupTabs,\n  children,\n  headerContent,\n  ...props\n}: MultiContentToolWindowProps) => {\n  const [isToolWindowFocused, setToolWindowFocused] = useState(false);\n  const [activeKey, setActiveKey] = useControlledState(\n    props.activeKey!,\n    props.defaultActiveKey!,\n    props.onActiveKeyChange!\n  );\n  const contents = React.Children.toArray(children)\n    .filter(\n      (\n        child\n      ): child is React.ReactElement<MultiContentToolWindowContentProps> => {\n        const validChild =\n          React.isValidElement(child) &&\n          child.type === MultiContentToolWindowContent;\n        if (!validChild) {\n          // FIXME: only warn in dev mode\n          console.warn(\n            \"You are not supposed to render anything but MultiContentToolWindowContent inside MultiViewToolWindow. Rendered: \",\n            child\n          );\n        }\n        return validChild;\n      }\n    )\n    // The following map is because of what React.Children.toArray does to keys: https://stackoverflow.com/q/33791401/1493081\n    // It doesn't look like a good idea since and there might be better ways to fix this, or at least make sure it would\n    // work in all cases. FIXME\n    .map((content) => ({ ...content, key: `${content.key}`.slice(2) as Key }));\n  const renderContentSwitcher = () => {\n    if (groupTabs) {\n      console.error(\n        \"groupTab is not supported yet in MultiViewToolWindow. Will fallback to ungrouped tabs\"\n      );\n    }\n    return (\n      <ToolWindowTabs\n        noBorders\n        items={contents}\n        active={isToolWindowFocused}\n        selectedKey={activeKey}\n        onSelectionChange={setActiveKey}\n      >\n        {(item) => <TabItem key={item.key}>{item.props.tabContent}</TabItem>}\n      </ToolWindowTabs>\n    );\n  };\n  const renderedViewSwitcher = renderContentSwitcher();\n\n  // We set the active key if it's not set or is invalid. A common scenario is when tabs are closable, and when the\n  // active tab is closed. You would always want to previous tab to get activated in such cases, instead of the first\n  // one. By having the logic here, there is no need to repeat the same logic in each use case. Although, it can also\n  // be moved into a state management utility for tabs, maybe in the future.\n\n  const keys = contents.map(({ key }) => key);\n  const previousKeys = usePrevious(keys);\n  useEffect(() => {\n    if (!keys.includes(activeKey)) {\n      const newActiveKey = keys[previousKeys.indexOf(activeKey) - 1] ?? keys[0];\n      if (newActiveKey != undefined) {\n        setActiveKey(newActiveKey);\n      }\n    }\n  });\n\n  const activeContent = contents.find(\n    (content) => activeKey == undefined || activeKey === content.key\n  );\n  return (\n    <DefaultToolWindow\n      onFocusChange={setToolWindowFocused}\n      headerContent={\n        typeof headerContent === \"function\" ? (\n          headerContent({ renderedViewSwitcher })\n        ) : (\n          <>\n            {headerContent}\n            {renderedViewSwitcher}\n          </>\n        )\n      }\n      additionalActions={props.additionalActions}\n    >\n      {activeContent?.props.children}\n    </DefaultToolWindow>\n  );\n};\n\nexport interface MultiContentToolWindowContentProps {\n  key: Key;\n  /**\n   * Used in the corresponding tab.\n   */\n  tabContent: React.ReactNode;\n\n  children: React.ReactNode;\n}\n\nconst MultiContentToolWindowContent =\n  ({}: MultiContentToolWindowContentProps) => {\n    throw new Error(\n      \"MultiContentToolWindowContent is not meant to be rendered directly. You should only use it in MultiViewToolWindow\"\n    );\n  };\n\nMultiViewToolWindow.View = MultiContentToolWindowContent;\n","export const HIDE_ALL_WINDOWS_ACTION_ID = \"HideAllWindows\";\nexport const JUMP_TO_LAST_WINDOW_ACTION_ID = \"JumpToLastWindow\";\nexport const HIDE_ACTIVE_WINDOW_ACTION_ID = \"HideActiveWindow\";\nexport const MAXIMIZE_TOOL_WINDOW_ACTION_ID = \"MaximizeToolWindow\";\nexport const DOCK_TOOL_WINDOW_ACTION_ID = \"DockToolWindow\";\nexport const RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID = \"ResizeToolWindowRight\";\nexport const RESIZE_TOOL_WINDOW_LEFT_ACTION_ID = \"ResizeToolWindowLeft\";\nexport const RESIZE_TOOL_WINDOW_TOP_ACTION_ID = \"ResizeToolWindowTop\";\nexport const RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID = \"ResizeToolWindowBottom\";\nexport const DOCK_PINNED_MODE_ACTION_ID = \"DockPinnedMode\";\nexport const DOCK_UNPINNED_MODE_ACTION_ID = \"DockUnpinnedMode\";\nexport const UNDOCK_MODE_ACTION_ID = \"UndockMode\";\nexport const FLOAT_MODE_ACTION_ID = \"FloatMode\";\nexport const WINDOW_MODE_ACTION_ID = \"WindowMode\";\nexport const FOCUS_EDITOR_ACTION_ID = \"FocusEditor\";\nexport const REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID =\n  \"RemoveToolWindowFromSidebar\"; // doesn't show up in keymap. Not sure what the id is in the original impl.\n","import React from \"react\";\nimport {\n  Anchor,\n  isHorizontalToolWindow,\n  useToolWindowState,\n  ViewMode,\n} from \"@intellij-platform/core/ToolWindows\";\nimport {\n  ActionDefinition,\n  ActionGroupDefinition,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport {\n  DOCK_PINNED_MODE_ACTION_ID,\n  DOCK_TOOL_WINDOW_ACTION_ID,\n  DOCK_UNPINNED_MODE_ACTION_ID,\n  FLOAT_MODE_ACTION_ID,\n  FOCUS_EDITOR_ACTION_ID,\n  HIDE_ACTIVE_WINDOW_ACTION_ID,\n  MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n  REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n  RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n  RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n  RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n  UNDOCK_MODE_ACTION_ID,\n  WINDOW_MODE_ACTION_ID,\n} from \"./ToolWindowActionIds\";\nimport { useCreateDefaultActionGroup } from \"@intellij-platform/core/ActionSystem/components\";\n\n// Resize steps in Intellij Platform is calculated based on the size of a \"W\" character and some\n// configuration (ide.windowSystem.hScrollChars). Although it's technically feasible, it seems not necessary\nconst HEIGHT_RESIZE_STEP = 16 * 5;\nconst WIDTH_RESIZE_STEP = 13 * 5;\n\nexport const anchors: Array<{\n  anchor: Anchor;\n  isSplit: boolean;\n  id: string;\n}> = [\n  { id: \"moveToLeftTop\", anchor: \"left\", isSplit: false },\n  { id: \"moveToLeftBottom\", anchor: \"left\", isSplit: true },\n  { id: \"moveToBottomLeft\", anchor: \"bottom\", isSplit: false },\n  { id: \"moveToBottomRight\", anchor: \"bottom\", isSplit: true },\n  { id: \"moveToRightTop\", anchor: \"right\", isSplit: true },\n  { id: \"moveToRightBottom\", anchor: \"right\", isSplit: false },\n  { id: \"moveToTopRight\", anchor: \"top\", isSplit: true },\n  { id: \"moveToTopLeft\", anchor: \"top\", isSplit: false },\n];\n\nconst getAnchorName = ({\n  anchor,\n  isSplit,\n}: {\n  anchor: Anchor;\n  isSplit: boolean;\n}) =>\n  `${anchor[0].toUpperCase()}${anchor.slice(1)} ${\n    isHorizontalToolWindow(anchor)\n      ? isSplit\n        ? \"Right\"\n        : \"Left\"\n      : isSplit\n      ? \"Bottom\"\n      : \"Top\"\n  }`;\n\nexport const ViewModeToActionId: Record<ViewMode, string> = {\n  docked_pinned: DOCK_PINNED_MODE_ACTION_ID,\n  docked_unpinned: DOCK_UNPINNED_MODE_ACTION_ID,\n  undock: UNDOCK_MODE_ACTION_ID,\n  float: FLOAT_MODE_ACTION_ID,\n  window: WINDOW_MODE_ACTION_ID,\n};\n\nexport const VIEW_MODE_ACTION_GROUP_ID = \"TW.ViewModeGroup\";\nexport const MOVE_TO_ACTION_GROUP_ID = \"TW.MoveToGroup\";\nexport const TOOL_WINDOW_RESIZE_ACTION_GROUP_ID = \"ResizeToolWindowGroup\";\n\nexport function useToolWindowActions({\n  mainContentTitle,\n}: {\n  mainContentTitle: string;\n}): ActionGroupDefinition {\n  const {\n    stretchWidth,\n    stretchHeight,\n    changeViewMode,\n    moveToSide,\n    focusMainContent,\n    hide,\n    remove,\n    state,\n  } = useToolWindowState();\n  const createDefaultActionGroup = useCreateDefaultActionGroup();\n\n  const actions: ActionDefinition[] = [];\n  if (!state) {\n    // FIXME: when window is removed, a last render happens with the new ToolWindowsState, which doesn't have state\n    //  for the removed tool window. Need to understand why that happens.\n    return createDefaultActionGroup({\n      id: \"ActiveToolwindowGroup\",\n      title: \"Active Tool Window\",\n      children: [],\n    });\n  }\n  const viewModeActionGroup = createDefaultActionGroup({\n    id: VIEW_MODE_ACTION_GROUP_ID,\n    title: \"View Mode\",\n    children: [\n      {\n        id: DOCK_PINNED_MODE_ACTION_ID,\n        title: \"Dock Pinned\",\n        actionPerformed: () => {\n          changeViewMode(\"docked_pinned\");\n        },\n      },\n      {\n        id: DOCK_UNPINNED_MODE_ACTION_ID,\n        title: \"Dock Unpinned\",\n        actionPerformed: () => {\n          changeViewMode(\"docked_unpinned\");\n        },\n      },\n      {\n        id: UNDOCK_MODE_ACTION_ID,\n        title: \"Undock\",\n        actionPerformed: () => {\n          changeViewMode(\"undock\");\n        },\n      },\n      {\n        id: FLOAT_MODE_ACTION_ID,\n        title: \"Float\",\n        actionPerformed: () => {\n          changeViewMode(\"float\");\n        },\n      },\n      {\n        id: WINDOW_MODE_ACTION_ID,\n        title: \"Window\",\n        actionPerformed: () => {\n          changeViewMode(\"window\");\n        },\n      },\n    ],\n  });\n  const moveToActionGroup = createDefaultActionGroup({\n    id: MOVE_TO_ACTION_GROUP_ID,\n    title: \"Move to\",\n    children: anchors.map(\n      (anchor): ActionDefinition => ({\n        id: `TW.MoveTo.${anchor.id}`,\n        title: getAnchorName(anchor),\n        icon: <PlatformIcon icon={`actions/${anchor.id}`} />,\n        isDisabled:\n          state.anchor === anchor.anchor && state.isSplit === anchor.isSplit,\n        actionPerformed: () => {\n          moveToSide(anchor);\n        },\n      })\n    ),\n  });\n  actions.push(\n    {\n      id: FOCUS_EDITOR_ACTION_ID,\n      title: `Focus ${mainContentTitle}`, // in intellij it says \"Focus Editor\" but it's not generic enough.\n      actionPerformed: () => {\n        focusMainContent();\n      },\n    },\n    {\n      id: HIDE_ACTIVE_WINDOW_ACTION_ID,\n      title: \"Hide\",\n      icon: <PlatformIcon icon=\"general/hideToolWindow\" />,\n      actionPerformed: () => {\n        hide();\n      },\n    },\n    {\n      id: MAXIMIZE_TOOL_WINDOW_ACTION_ID,\n      title: \"Maximize Tool Window\", // Should be \"Restore Tool Window Size if the window is currently maximized\n      actionPerformed: () => {\n        // TODO(release): either remove the action or implement it\n        alert(\"Not implemented\");\n      },\n    },\n    {\n      id: REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID,\n      title: \"Remove from Sidebar\",\n      actionPerformed: () => {\n        remove();\n      },\n    },\n    viewModeActionGroup,\n    moveToActionGroup\n  );\n  if (state.viewMode === \"float\") {\n    actions.push({\n      id: DOCK_TOOL_WINDOW_ACTION_ID,\n      title: \"Dock\",\n      icon: (\n        <PlatformIcon\n          icon={`actions/${\n            anchors.find(\n              ({ anchor, isSplit }) =>\n                anchor === state.anchor && isSplit === state.isSplit\n            )?.id\n          }`}\n        />\n      ),\n      actionPerformed: () => {\n        changeViewMode(\"docked_pinned\");\n      },\n    });\n  }\n  if (state.viewMode !== \"float\" && state.viewMode !== \"window\") {\n    const resizeGroup = createDefaultActionGroup({\n      id: TOOL_WINDOW_RESIZE_ACTION_GROUP_ID,\n      title: \"Resize\",\n      children: [],\n    });\n    if (isHorizontalToolWindow(state.anchor)) {\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID,\n        title: \"Stretch to bottom\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"bottom\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      });\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_TOP_ACTION_ID,\n        title: \"Stretch to top\",\n        actionPerformed: () => {\n          stretchHeight(\n            state.anchor === \"top\" ? -HEIGHT_RESIZE_STEP : HEIGHT_RESIZE_STEP\n          );\n        },\n      });\n    } else {\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_LEFT_ACTION_ID,\n        title: \"Stretch to left\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"left\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      });\n      resizeGroup.children.push({\n        id: RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID,\n        title: \"Stretch to right\",\n        actionPerformed: () => {\n          stretchWidth(\n            state.anchor === \"right\" ? -WIDTH_RESIZE_STEP : WIDTH_RESIZE_STEP\n          );\n        },\n      });\n    }\n    actions.push(resizeGroup);\n  }\n  return createDefaultActionGroup({\n    id: \"ActiveToolwindowGroup\",\n    title: \"Active Tool Window\",\n    children: actions,\n  });\n}\n","import React from \"react\";\nimport { ActionDefinition } from \"@intellij-platform/core/ActionSystem\";\nimport {\n  getViewModeType,\n  ToolWindowRefValue,\n  ToolWindowsState,\n} from \"@intellij-platform/core/ToolWindows\";\nimport {\n  HIDE_ALL_WINDOWS_ACTION_ID,\n  JUMP_TO_LAST_WINDOW_ACTION_ID,\n} from \"./ToolWindowActionIds\";\n\ninterface DefaultToolWindowActionsProps {\n  toolWindowsState: Readonly<ToolWindowsState>;\n  toolWindowsRef: React.RefObject<ToolWindowRefValue>;\n  /**\n   * Used when creating ActivateToolWindow action for each tool window.\n   */\n  getPresentation?: (key: React.Key) =>\n    | {\n        title: string;\n        icon: React.ReactNode;\n      }\n    | undefined;\n}\n\nexport const getActivateToolWindowActionId = (id: string) =>\n  `Activate${id.replace(\" \", \"\")}Window`;\n\n/**\n * Provides default tool windows actions:\n * - Hide all tool windows\n * - Activate{id}Window action for each window\n * - Jump to last tool window\n *\n * @see also {@link DefaultToolWindows}\n */\nexport function useToolWindowsActions({\n  toolWindowsState,\n  toolWindowsRef,\n  getPresentation,\n}: DefaultToolWindowActionsProps) {\n  const isAnySideWindowWindowOpen = (state: Readonly<ToolWindowsState>) =>\n    Object.values(state.windows).some(\n      ({ isVisible, viewMode }) =>\n        isVisible && getViewModeType(viewMode) !== \"float\"\n    );\n  const windowIds = Object.keys(toolWindowsState.windows).map(\n    (key) => `${key}`\n  );\n  const activateToolWindowActions = windowIds.map(\n    (id: string, index): ActionDefinition => {\n      const { title, icon } = getPresentation?.(id) || {};\n      return {\n        id: getActivateToolWindowActionId(id),\n        title: title || `${getOrdinal(index)} window`,\n        icon,\n        description: `Activate ${title || getOrdinal(index)} window`,\n        actionPerformed: () => {\n          if (\n            toolWindowsState.windows[id]?.isVisible &&\n            !toolWindowsRef.current?.hasFocus(id)\n          ) {\n            toolWindowsRef.current?.focus(id);\n          } else {\n            toolWindowsRef.current?.changeState((state) => state.toggle(id));\n          }\n        },\n      };\n    }\n  );\n  const actions: ActionDefinition[] = [\n    ...activateToolWindowActions,\n    {\n      id: HIDE_ALL_WINDOWS_ACTION_ID,\n      title: isAnySideWindowWindowOpen(toolWindowsState)\n        ? \"Hide All Windows\"\n        : \"Restore windows\",\n      actionPerformed: () => {\n        toolWindowsRef.current?.changeState((state) => {\n          if (isAnySideWindowWindowOpen(state)) {\n            return state.hideAll();\n          } else {\n            return state.restoreWindows();\n          }\n        });\n        // Because windows have autofocus behaviour, a timeout is set. Not sure how reliable it is.\n        // TODO: replace effect-based auto focus behaviour with something better, maybe controlled by ToolWindows\n        //  component, and when a tool window is opened.\n        setTimeout(() => {\n          toolWindowsRef.current?.focusMainContent();\n        });\n      },\n    },\n    {\n      id: JUMP_TO_LAST_WINDOW_ACTION_ID,\n      title: \"Jump to Last Tool Window\",\n      isDisabled: toolWindowsState.lastFocusedKey == null,\n      actionPerformed: () => {\n        toolWindowsRef.current?.focusLastActiveWindow();\n      },\n    },\n  ];\n  return actions;\n}\n\nfunction getOrdinal(n: number) {\n  let ord = [\"st\", \"nd\", \"rd\"];\n  let exceptions = [11, 12, 13];\n  let nth =\n    ord[(n % 10) - 1] == undefined || exceptions.includes(n % 100)\n      ? \"th\"\n      : ord[(n % 10) - 1];\n  return n + nth;\n}\n","import React, {\n  CSSProperties,\n  MouseEvent,\n  useContext,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { styled, css } from \"../styled\";\nimport {\n  StyledHorizontalSeparator,\n  StyledSeparator,\n  StyledVerticalSeparator,\n} from \"../StyledSeparator\";\nimport { useOverflowObserver } from \"@intellij-platform/core/utils/overflow-utils/useOverflowObserver\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { Overlay, useOverlayPosition } from \"@react-aria/overlays\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { StyledPopupContainer } from \"@intellij-platform/core/Popup/StyledPopupContainer\";\n\ntype ToolbarBorderProp =\n  | true\n  | \"horizontal\"\n  | \"vertical\"\n  | \"bottom\"\n  | \"top\"\n  | \"left\"\n  | \"right\";\n\nexport type ToolbarProps = {\n  children: React.ReactNode;\n  orientation?: \"vertical\" | \"horizontal\";\n  border?: ToolbarBorderProp;\n  style?: CSSProperties;\n  className?: string;\n} & (\n  | {\n      orientation: \"vertical\";\n    }\n  | {\n      orientation?: \"horizontal\";\n      /**\n       * Defines how the toolbar should handle its children when there is not enough room\n       * to fit all:\n       * - popup: the overflowed children will be hidden behind a show more arrow icon that\n       *   shows the rest of the items in a popup.\n       * - wrap: children will be wrapped so that they fit the available width/height\n       **/\n      overflowBehavior?: \"popup\" | \"wrap\";\n    }\n);\n\nconst borderStyle = ({ border }: { border?: ToolbarBorderProp }) =>\n  border &&\n  css`\n    border-style: solid;\n    border-color: ${({ theme }) => theme.commonColors.borderColor};\n    border-width: ${border === true ? \"1px\" : borderPropToCssProp[border]};\n  `;\n\nconst StyledToolbar = styled.div<{\n  border?: ToolbarBorderProp;\n}>`\n  display: inline-flex;\n  box-sizing: border-box;\n  overflow: hidden;\n  // NOTE: in the original implementation, there is no empty space between buttons, but buttons have kind of an\n  // invisible left padding, which is mouse-intractable, but doesn't visually seem a part of the button.\n  // Although implementable, it didn't seem necessary to follow the exact same thing. Margin should be fine.\n  gap: 4px;\n  ${borderStyle}\n  ${StyledSeparator}:first-child {\n    display: none;\n  }\n  ${StyledSeparator}:last-child {\n    display: none;\n  }\n`;\n\nconst borderPropToCssProp: Record<\n  Exclude<ToolbarBorderProp, boolean>,\n  CSSProperties[\"borderWidth\"]\n> = {\n  top: \"1px 0 0 0\",\n  bottom: \"0 0 1px 0\",\n  right: \"0 1px 0 0\",\n  left: \"0 0 0 1px\",\n  horizontal: \"0 1px\",\n  vertical: \"1px 0\",\n};\n\nconst SIDE_PADDING = 3;\nconst END_PADDING = 4;\n\nconst StyledShowMoreButton = styled.button`\n  all: unset;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  ${borderStyle};\n`;\n\nconst StyledHorizontalToolbar = styled(StyledToolbar)`\n  padding: ${SIDE_PADDING}px ${END_PADDING}px;\n  max-width: 100%;\n  /*noinspection CssInvalidPropertyValue*/\n  max-width: -webkit-fill-available;\n  ${StyledHorizontalSeparator} {\n    margin: 1px 0;\n  }\n  ${StyledShowMoreButton} {\n    margin-right: -${END_PADDING}px;\n  }\n`;\n\nconst StyledVerticalToolbar = styled(StyledToolbar)`\n  flex-direction: column;\n  max-height: 100%;\n  /*noinspection CssInvalidPropertyValue*/\n  max-height: -webkit-fill-available;\n  padding: ${END_PADDING}px ${SIDE_PADDING}px;\n  ${StyledVerticalSeparator} {\n    margin: 0 1px;\n  }\n  ${StyledShowMoreButton} {\n    margin-bottom: -${END_PADDING}px;\n  }\n`;\n\nconst StyledToolbarContent = styled.div<{\n  shouldWrap?: boolean;\n  firstOverflowedIndex: number;\n}>`\n  box-sizing: inherit;\n  display: inherit;\n  flex-direction: inherit;\n  flex-wrap: ${({ shouldWrap }) => (shouldWrap ? \"wrap\" : \"nowrap\")};\n  gap: inherit;\n  max-height: inherit;\n  max-width: inherit;\n  min-height: 0;\n  min-width: 0;\n\n  ${({ firstOverflowedIndex }) =>\n    /**\n     * The hidden styles should be in a way that the hidden element:\n     * - occupies its space in the document layout.\n     * - doesn't capture mouse events. (e.g. a half-overflowing hidden element shouldn't show tooltip)\n     * - remains accessible to screen readers.\n     */\n    css`\n      > ${firstOverflowedIndex === 0\n          ? \"*\"\n          : `:nth-child(${firstOverflowedIndex}) ~ *`} {\n        opacity: 0 !important;\n        pointer-events: none !important;\n      }\n    `}\n`;\n// This can be used in other places if use-cases are raised for keeping orientation in the context.\nconst OrientationContext = React.createContext<\"horizontal\" | \"vertical\">(\n  \"horizontal\"\n);\n\n/**\n * ## Toolbar API/Implementation notes\n *\n * ### Handling Overflow\n *\n * Handling the overflow popup on DOM-level, allows for a simple and flexible implementation that doesn't\n * require any coupling between Toolbar and components like IconButton. Other components can also similarly be\n * rendered inside toolbar without adopting any specific API. It's worth noting that any generic approach based\n * on children react nodes instead of children DOM nodes will have many edge cases and will involve assumptions\n * that will limit the API of toolbar. Also, any approach based on moving dom nodes to the overflow popup will\n * conflict with React owning the DOM.\n *\n * #### Assumption\n *\n * Since the overflow popup renders the same `children`, and items in the toolbar and popup overflow are made\n * visible/hidden based on the index of DOM nodes, it's important than children deterministically results in the\n * same dom structure. i.e. if a component in children randomly renders different number of root dom nodes in\n * each render, it can cause issues in hiding/showing elements.\n *\n * ### Orientation\n * A few reasons for not having separate `HorizontalToolbar` and `VerticalToolbar` components instead of `Toolbar` with\n * `orientation` prop:\n * - From usage side, a single `Toolbar` component is considered a more discoverable API.\n * - Separate components would require abstracting common parts which unnecessarily adds to complexity.\n *   The amount of branching to handle the differences is considered ok, at the current state of the component.\n */\n\n/**\n * @description\n * A toolbar is a container for {@link IconButton} and similar UI components.\n *\n * ## Features:\n * - A toolbar can be horizontal or vertical\n * - When there is not enough space for all children, toolbar shows an arrow icon, which shows the overflowing\n *   items in a popup, upon mouseover.\n *   Optionally, overflow can be wrapped into multiple lines, in horizontal toolbars.\n *\n * @example\n * <Toolbar>\n *   <IconButton aria-label=\"Show Diff\">\n *     <PlatformIcon icon=\"actions/diff\" />\n *   </IconButton>\n *   </Toolbar>\n */\nexport const Toolbar: React.FC<ToolbarProps> = ({\n  border,\n  orientation = \"horizontal\",\n  ...props\n}): React.ReactElement => {\n  const overflowBehavior =\n    orientation === \"horizontal\" && \"overflowBehavior\" in props\n      ? props.overflowBehavior\n      : null;\n  const rootProps = { style: props.style, className: props.className };\n  const ref = useRef<HTMLDivElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const showMoreButtonRef = useRef<HTMLButtonElement>(null);\n  const StyledToolbar =\n    orientation === \"horizontal\"\n      ? StyledHorizontalToolbar\n      : StyledVerticalToolbar;\n  const { overflowedElements } = useOverflowObserver(ref, { threshold: 0.8 });\n  const [isOverflowPopupVisible, setOverflowPopupVisible] = useState(false);\n  const [popupHeight, setPopupHeight] = useState(30);\n  const [firstOverflowedChildIndex, setFirstOverflowedChildIndex] =\n    useState<number>(-1);\n  const firstOverflowedChildRef = useRef<HTMLElement | undefined>();\n\n  useLayoutEffect(() => {\n    if (ref.current) {\n      const childElements = [...ref.current.children].filter(\n        (node): node is HTMLElement => node instanceof HTMLElement\n      );\n      const firstOverflowedChild = childElements.findIndex((child) =>\n        overflowedElements.includes(child)\n      );\n      setFirstOverflowedChildIndex(firstOverflowedChild);\n      firstOverflowedChildRef.current = childElements[firstOverflowedChild];\n    }\n  }, [overflowedElements]);\n\n  useLayoutEffect(() => {\n    if (overlayRef.current && popupHeight !== overlayRef.current.offsetHeight) {\n      setPopupHeight(overlayRef.current.offsetHeight);\n    }\n  });\n\n  const { overlayProps } = useOverlayPosition({\n    isOpen: isOverflowPopupVisible,\n    placement: \"bottom left\",\n    offset:\n      // in lack of positioning options for aligning bottom and left of of the overflow popup with the bottom and left\n      // of the toolbar itself, we have to measure the popup height, and use offset to achieve the same\n      orientation === \"horizontal\"\n        ? -popupHeight + SIDE_PADDING + 1\n        : -popupHeight + 1,\n    crossOffset:\n      orientation === \"horizontal\" ? -(SIDE_PADDING + 2) : -(SIDE_PADDING + 1),\n    containerPadding: 0,\n    shouldFlip: false,\n    targetRef: orientation === \"horizontal\" ? ref : showMoreButtonRef,\n    overlayRef: overlayRef,\n    onClose: () => {\n      setOverflowPopupVisible(false);\n    },\n  });\n\n  const showOverflowPopup = () => {\n    setOverflowPopupVisible(true);\n  };\n\n  const toolbarProps = {\n    onMouseMove: (event: MouseEvent) => {\n      const firstOverflowedElement = firstOverflowedChildRef.current;\n      if (!firstOverflowedElement) {\n        return;\n      }\n      const shouldShow =\n        orientation === \"vertical\"\n          ? event.clientY > firstOverflowedElement.getBoundingClientRect().top\n          : event.clientX > firstOverflowedElement.getBoundingClientRect().left;\n      if (shouldShow !== isOverflowPopupVisible) {\n        setOverflowPopupVisible(shouldShow);\n      }\n    },\n    onMouseLeave: () => {\n      if (isOverflowPopupVisible) {\n        setOverflowPopupVisible(false);\n      }\n    },\n  };\n  const toolbarOverflowPopupProps = {\n    onMouseEnter: () => setOverflowPopupVisible(true),\n    onMouseLeave: () => setOverflowPopupVisible(false),\n  };\n  return (\n    <OrientationContext.Provider value={orientation}>\n      <StyledToolbar\n        border={border}\n        {...mergeProps(rootProps, toolbarProps)}\n        role=\"toolbar\"\n      >\n        <StyledToolbarContent\n          ref={ref}\n          role=\"presentation\"\n          firstOverflowedIndex={firstOverflowedChildIndex}\n          shouldWrap={overflowBehavior === \"wrap\"}\n        >\n          {props.children}\n        </StyledToolbarContent>\n        {overflowedElements.length > 0 && (\n          <StyledShowMoreButton\n            ref={showMoreButtonRef}\n            tabIndex={-1}\n            onMouseEnter={showOverflowPopup}\n          >\n            <PlatformIcon icon=\"ide/link\" />\n          </StyledShowMoreButton>\n        )}\n      </StyledToolbar>\n      {isOverflowPopupVisible && overflowedElements.length > 0 && (\n        // Maybe more accessible to reuse the entire Popup here? it would require more flexible API to handle mouseleave though\n        // Note: we could also render the whole toolbar with the same props and only orientation being overwritten,\n        // but it has the risk of infinite overlay opening in some edge cases, and that level of generality doesn't\n        // seem to be necessary, at least at the moment.\n        <OrientationContext.Provider value=\"horizontal\">\n          <Overlay>\n            <StyledPopupContainer\n              ref={overlayRef}\n              {...mergeProps(overlayProps, toolbarOverflowPopupProps)}\n            >\n              <ToolbarInOverlay\n                border\n                firstVisibleIndex={\n                  orientation === \"vertical\"\n                    ? firstOverflowedChildIndex\n                    : undefined\n                }\n              >\n                {props.children}\n              </ToolbarInOverlay>\n            </StyledPopupContainer>\n          </Overlay>\n        </OrientationContext.Provider>\n      )}\n    </OrientationContext.Provider>\n  );\n};\n\nconst ToolbarInOverlay = styled(StyledHorizontalToolbar)<{\n  firstVisibleIndex?: number;\n}>`\n  ${({ firstVisibleIndex }) =>\n    firstVisibleIndex &&\n    css`\n      ${StyledSeparator}:nth-child(${firstVisibleIndex + 1}) {\n        display: none;\n      }\n      > :not(:nth-child(${firstVisibleIndex}) ~ *) {\n        display: none;\n      }\n    `};\n`;\n\n/**\n * Separator to be used between items in a toolbar.\n */\nexport const ToolbarSeparator = (): React.ReactElement => {\n  const orientation = useContext(OrientationContext);\n  return orientation === \"horizontal\" ? (\n    <StyledHorizontalSeparator />\n  ) : (\n    <StyledVerticalSeparator />\n  );\n};\n","import React from \"react\";\nimport { Tooltip, TooltipProps } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionHelpTooltipProps\n  extends Omit<TooltipProps, \"children\" | \"multiline\"> {\n  actionName: React.ReactNode;\n  helpText: React.ReactNode;\n  shortcut?: React.ReactNode;\n  link?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action Help\"\n * @see {@link ActionTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionHelpTooltip = ({\n  actionName,\n  helpText,\n  shortcut,\n  link,\n  ...tooltipProps\n}: ActionHelpTooltipProps): JSX.Element => {\n  return (\n    <Tooltip multiline {...tooltipProps}>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n      <Tooltip.Description>{helpText}</Tooltip.Description>\n      {link && <Tooltip.Link>{link}</Tooltip.Link>}\n    </Tooltip>\n  );\n};\n","import React from \"react\";\nimport { Tooltip, TooltipProps } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface ActionTooltipProps\n  extends Omit<TooltipProps, \"children\" | \"multiline\"> {\n  actionName: React.ReactNode;\n  shortcut?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Action\"\n * @see {@link ActionHelpTooltip} {@link HelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const ActionTooltip = ({\n  actionName,\n  shortcut,\n  ...tooltipProps\n}: ActionTooltipProps): JSX.Element => {\n  return (\n    <Tooltip {...tooltipProps}>\n      <Tooltip.Header>\n        {actionName}\n        {shortcut && <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>}\n      </Tooltip.Header>\n    </Tooltip>\n  );\n};\n","import React from \"react\";\nimport { Tooltip, TooltipProps } from \"@intellij-platform/core/Tooltip/Tooltip\";\n\nexport interface HelpTooltipProps\n  extends Omit<TooltipProps, \"children\" | \"multiline\"> {\n  helpText: React.ReactNode;\n  shortcut?: React.ReactNode;\n  link?: React.ReactNode;\n}\n\n/**\n * Tooltip of type \"Help\"\n * @see {@link ActionTooltip} {@link ActionHelpTooltip}\n * @see https://jetbrains.github.io/ui/controls/tooltip/#02\n */\nexport const HelpTooltip = ({\n  helpText,\n  shortcut,\n  link,\n  ...tooltipProps\n}: HelpTooltipProps): JSX.Element => {\n  return (\n    <Tooltip multiline {...tooltipProps}>\n      <Tooltip.Header>{helpText}</Tooltip.Header>\n      {shortcut && (\n        <div>\n          <Tooltip.Shortcut>{shortcut}</Tooltip.Shortcut>\n        </div>\n      )}\n      {link && <Tooltip.Link>{link}</Tooltip.Link>}\n    </Tooltip>\n  );\n};\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { TooltipTriggerProps as AriaTooltipTriggerProps } from \"@react-aria/tooltip\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { AriaPositionProps, useOverlayPosition } from \"@react-aria/overlays\";\nimport { TooltipTriggerAndOverlay } from \"./TooltipTriggerAndOverlay\";\nimport { useObjectRef } from \"@react-aria/utils\";\n\nexport interface PositionedTooltipTriggerProps<\n  T extends HTMLElement = HTMLElement\n> extends Omit<AriaTooltipTriggerProps, \"trigger\">,\n    Pick<\n      AriaPositionProps,\n      \"placement\" | \"offset\" | \"crossOffset\" | \"shouldFlip\"\n    > {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<T> }\n      ) => React.ReactNode);\n\n  /**\n   * Whether to show the tooltip on trigger's focus. By default, tooltip is shown only when the trigger\n   * is hovered, but it can improve accessibility to show the tooltip on focus as well.\n   */\n  showOnFocus?: boolean;\n\n  /**\n   * Ref to trigger.\n   * If not provided, a ref will be created internally.\n   * Useful for when a ref to the trigger is necessary where PositionedTooltipTrigger\n   * is used.\n   */\n  triggerRef?: RefObject<T>;\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}. Tooltip will be positioned based relative to the trigger.\n * The default tooltip positioning is based on cursor, which is implemented by {@link TooltipTrigger}\n */\nexport const PositionedTooltipTrigger = <T extends HTMLElement>({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  offset = 8,\n  showOnFocus,\n  triggerRef: inputTriggerRef,\n  ...props\n}: PositionedTooltipTriggerProps<T>): JSX.Element => {\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const overlayRef = useRef<HTMLDivElement>(null);\n  const fallbackRef = useObjectRef<T>(inputTriggerRef);\n  const triggerRef = inputTriggerRef || fallbackRef;\n\n  const positionAria = useOverlayPosition({\n    ...props,\n    overlayRef,\n    targetRef: triggerRef,\n    offset,\n    isOpen: state.isOpen,\n    onClose: state.close,\n  });\n\n  // A workaround for a mysterious issue that happens only in docusaurus build.\n  // The ref value is not up-to-date, when the effect runs.\n  // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n  useEffect(() => {\n    if (state.isOpen) {\n      requestAnimationFrame(positionAria.updatePosition);\n    }\n  }, [state.isOpen]);\n\n  return (\n    <TooltipTriggerAndOverlay\n      tooltip={tooltip}\n      positionAria={positionAria}\n      trigger={children}\n      state={state}\n      overlayRef={overlayRef}\n      triggerRef={triggerRef}\n      showOnFocus={showOnFocus}\n      isDisabled={props.isDisabled}\n    />\n  );\n};\n","import React, { ForwardedRef, MutableRefObject, useContext } from \"react\";\nimport { AriaTooltipProps, useTooltip } from \"@react-aria/tooltip\";\nimport { useObjectRef } from \"@react-aria/utils\";\nimport { PositionAria } from \"@react-aria/overlays\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { WINDOW_SHADOW } from \"@intellij-platform/core/style-constants\";\nimport { TooltipContext } from \"./TooltipContext\";\nimport { TooltipPointer, TooltipPointerPosition } from \"./TooltipPointer\";\nimport {\n  tooltipBackground,\n  tooltipBorderColor,\n  WITH_POINTER_BORDER_RADIUS,\n} from \"./tooltip-styles\";\n\nexport interface TooltipProps extends Omit<AriaTooltipProps, \"isOpen\"> {\n  children: React.ReactNode;\n  multiline?: boolean;\n  className?: string;\n  /**\n   * Whether (and in what position) the arrow pointer should be shown.\n   * When using {@link TooltipTrigger} or {@link PositionedTooltipTrigger}, the position of the pointer is calculated\n   * based on the target element, and a boolean value to define whether the arrow should be shown or not would suffice.\n   *\n   * Tooltips with pointer have slight style difference.\n   * {@see https://www.figma.com/file/nfDfMAdV7j2fnQlpYNAOfP/IntelliJ-Platform-UI-Kit-(Community)?type=design&node-id=15-51&mode=design&t=7PplrxG8ZfXB4hIK-0}\n   *\n   * @example\n   * <Tooltip withPointer />\n   * // shows the pointer in the position controlled by {@link TooltipTrigger} or {@link PositionedTooltipTrigger}\n   * // If there is not `TooltipTrigger` or `PositionedTooltipTrigger`, the arrow is shown on top center by default.\n   *\n   * @example\n   * <Tooltip withPointer={{side: 'top', offset: 30}} />\n   * // shows the pointer on the top side, with horizontal offset of 30px from the left of tooltip, regardless\n   * // of whether `TooltipTrigger` or `PositionedTooltipTrigger` is used.\n   *\n   * @example\n   * <Tooltip withPointer={{side: 'left', offset: -30}} />\n   * // shows the pointer on the left side, with vertidcal offset of 30px from the bottom of the tooltip, regardless\n   * // of whether `TooltipTrigger` or `PositionedTooltipTrigger` is used.\n   */\n  withPointer?: boolean | TooltipPointerPosition;\n}\n\n// Providing default value for paddings, based on intellijlaf theme. In Intellij Platform, themes extend either\n// intellijlaf or darcula. Which means some properties can be omitted in the custom theme, relying on the values\n// in the base theme. This is not how theming works here, at the moment, and there are other similar issues, but\n// this is just a mitigation for one case, spacing in tooltip.\nexport const DEFAULT_TEXT_BORDER_INSETS = \"0.5rem 0.8125rem 0.625rem 0.625rem\";\nexport const DEFAULT_SMALL_TEXT_BORDER_INSETS =\n  \"0.375rem 0.75rem 0.4375rem 0.625rem\";\nconst StyledTooltip = styled.div<{ multiline?: boolean; hasPointer?: boolean }>`\n  box-sizing: content-box;\n  max-width: ${\n    /**\n     * Max width is meant to be set on the multiline description (which is not used in ActionTooltip which would\n     * be right according to [the specs](https://jetbrains.github.io/ui/controls/tooltip/#09)).\n     * But if set on `Tooltip.Description`, title and link can still make the tooltip grow more that the expected max\n     * width. So it makes more sense to set the max width on the container anyway. But since the value of the max width\n     * is meant to be for description we set the box-sizing to \"content-box\" to exclude container's padding in max-width\n     * calculation.\n     */\n    ({ theme, multiline }) =>\n      multiline\n        ? `${\n            theme.value<number>(\n              \"HelpTooltip.maxWidth\" as UnknownThemeProp<\"HelpTooltip.maxWidth\">\n            ) ?? 250\n          }px`\n        : null\n  };\n  white-space: ${({ multiline }) => (!multiline ? \"nowrap\" : null)};\n  display: inline-flex;\n  flex-direction: column;\n  gap: ${({ theme }) =>\n    theme.value<number>(\n      \"HelpToolTip.verticalGap\" as UnknownThemeProp<\"HelpToolTip.verticalGap\">\n    ) ?? 4}px;\n  background: ${tooltipBackground};\n  color: ${({ theme }) =>\n    theme.color(\"ToolTip.foreground\", !theme.dark ? \"#000\" : \"#bfbfbf\")};\n  padding: ${({ theme, multiline }) =>\n    multiline\n      ? theme.inset(\"HelpTooltip.defaultTextBorderInsets\") ||\n        DEFAULT_TEXT_BORDER_INSETS\n      : theme.inset(\"HelpTooltip.smallTextBorderInsets\") ||\n        DEFAULT_SMALL_TEXT_BORDER_INSETS};\n  line-height: 1.2;\n  border-style: solid;\n  border-width: ${({ theme, hasPointer }) =>\n    theme.value<boolean>(\"ToolTip.paintBorder\") || hasPointer ? \"1px\" : \"0px\"};\n  border-color: ${tooltipBorderColor};\n  ${WINDOW_SHADOW};\n  ${({ hasPointer }) =>\n    hasPointer &&\n    css`\n      position: relative; // needed for absolute positioning of the pointer\n      border-radius: ${WITH_POINTER_BORDER_RADIUS}px;\n    `}\n`;\n\nconst StyledShortcut = styled.kbd`\n  all: unset;\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.shortcutForeground\",\n      !theme.dark ? \"#787878\" : \"#999999\"\n    )};\n`;\n\nconst StyledHeader = styled.div`\n  font-size: ${({ theme }) => theme.fontSizeDelta(\"HelpTooltip.fontSizeDelta\")};\n  display: flex;\n  gap: 0.5rem;\n`;\nconst StyledDescription = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"Tooltip.infoForeground\" as UnknownThemeProp<\"Tooltip.infoForeground\">,\n      theme.commonColors.contextHelpForeground\n    )};\n  font-size: ${({ theme }) =>\n    theme.fontSizeDelta(\"HelpTooltip.descriptionSizeDelta\")};\n`;\n\nconst StyledLink = styled.div`\n  color: ${({ theme }) =>\n    theme.color(\n      \"ToolTip.linkForeground\" as UnknownThemeProp<\"ToolTip.linkForeground\">,\n      theme.commonColors.linkForegroundEnabled\n    )};\n  a,\n  [role=\"link\"] {\n    // Maybe target Link instead, without important. It didn't work as expected, in the first try tho.\n    color: inherit !important;\n  }\n`;\n\nexport const placementToPointerSide: Record<\n  PositionAria[\"placement\"],\n  TooltipPointerPosition[\"side\"]\n> = {\n  bottom: \"top\",\n  top: \"bottom\",\n  left: \"right\",\n  right: \"left\",\n  center: \"top\", // doesn't make sense :-?\n};\n/**\n * Implements the UI of a Tooltip. For tooltip to be shown for a trigger, on hover, use {@link TooltipTrigger}.\n * The following components can be used to compose the content of a tooltip.\n * - {@link Tooltip.Header}\n * - {@link Tooltip.Description}\n * - {@link Tooltip.Link}\n * - {@link Tooltip.Shortcut}\n * Prefer using higher-level components like {@link HelpTooltip}, {@link ActionHelpTooltip} or {@link ActionTooltip}.\n * that ensure different pieces of tooltip content follow the\n * [design system recommendation](https://jetbrains.github.io/ui/controls/tooltip)\n *\n *\n * ### Reference:\n * Tooltip, Tooltip.* and TooltipTrigger are corresponding to [HelpTooltip](https://github.com/JetBrains/intellij-community/blob/854daf45b47a6ea9da0348978608bfbfe998d99c/platform/platform-api/src/com/intellij/ide/HelpTooltip.java#L102)\n * in the original impl.\n */\nconst Tooltip = React.forwardRef(function Tooltip(\n  { children, multiline, withPointer, ...props }: TooltipProps,\n  forwardedRef: ForwardedRef<HTMLDivElement>\n): JSX.Element {\n  const ref: MutableRefObject<HTMLDivElement | null> =\n    useObjectRef(forwardedRef);\n  const {\n    state,\n    isInteractive,\n    pointerPositionStyle,\n    placement = \"bottom\",\n  } = useContext(TooltipContext) || {};\n  const { tooltipProps } = useTooltip(\n    props,\n    state\n      ? {\n          ...state,\n          // if the tooltip is not interactive, let it be closed even when it's hovered. That's the according to the reference impl.\n          open: isInteractive ? state?.open : () => {},\n        }\n      : state\n  );\n\n  const { side, offset } =\n    typeof withPointer === \"object\"\n      ? withPointer\n      : { side: placementToPointerSide[placement], offset: undefined };\n\n  return (\n    <StyledTooltip\n      hasPointer={Boolean(withPointer)}\n      multiline={multiline}\n      {...tooltipProps}\n      className={props.className}\n      ref={ref}\n    >\n      {withPointer && (\n        <TooltipPointer\n          tooltipRef={ref}\n          side={side}\n          offset={\n            offset || !pointerPositionStyle\n              ? { type: \"specific\", value: offset }\n              : { type: \"calculated\", value: pointerPositionStyle }\n          }\n        />\n      )}\n      {children}\n    </StyledTooltip>\n  );\n});\n\nconst _Tooltip = Object.assign(Tooltip, {\n  Header: StyledHeader,\n  Shortcut: StyledShortcut,\n  Description: StyledDescription,\n  Link: StyledLink,\n});\n\nexport { _Tooltip as Tooltip };\n","import React, { CSSProperties } from \"react\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\nimport { PositionAria } from \"@react-aria/overlays\";\n\ninterface TooltipContextObject {\n  state: TooltipTriggerState;\n  isInteractive: boolean;\n  placement: PositionAria[\"placement\"];\n  pointerPositionStyle?: CSSProperties;\n}\n\nexport const TooltipContext = React.createContext<TooltipContextObject | null>(\n  null\n);\n","import { compose, identity } from \"ramda\";\nimport React, { CSSProperties, RefObject, useEffect, useState } from \"react\";\nimport { css, styled } from \"@intellij-platform/core/styled\";\n\nimport {\n  tooltipBackground,\n  WITH_POINTER_BORDER_RADIUS,\n} from \"./tooltip-styles\";\n\ntype OffsetValue = number | `${number}%`;\nexport type TooltipPointerPosition = {\n  /**\n   * The side of the tooltip the pointer is shown\n   */\n  side: \"top\" | \"bottom\" | \"left\" | \"right\";\n  /**\n   * - When side is \"top\" or \"bottom\":\n   *   Horizontal offset (in px) with respect to the left (or right, if negative) of the tooltip.\n   * - When side is \"left\" or \"right\":\n   *   Vertical offset (in px) with respect to the top (or bottom, if negative) of the tooltip.\n   *\n   * @default: '50%'\n   */\n  offset?: OffsetValue | { value: OffsetValue; invert?: boolean };\n};\n\nconst POINTER_WIDTH = 6;\nconst POINTER_HEIGHT = 9;\nconst POINTER_THICKNESS = 1.5;\nconst TRANSLATE = `translate(-${POINTER_WIDTH}px, -${POINTER_HEIGHT}px)`;\nconst sideStyles = {\n  top: css`\n    top: 0;\n    transform: ${TRANSLATE};\n  `,\n  bottom: css`\n    bottom: 0;\n    transform: rotateX(180deg) ${TRANSLATE};\n  `,\n  left: css`\n    left: 0;\n    transform: rotate(-90deg) ${TRANSLATE};\n  `,\n  right: css`\n    right: 0;\n    transform: rotate(90deg) ${TRANSLATE};\n  `,\n};\nconst StyledTooltipPointer = styled.span<{\n  side: TooltipPointerPosition[\"side\"];\n}>`\n  position: absolute;\n  width: 0;\n  height: 0;\n  ${({ side }) => sideStyles[side]};\n\n  &::before {\n    content: \"\";\n    position: absolute;\n    border-left: ${POINTER_WIDTH + POINTER_THICKNESS}px solid transparent;\n    border-right: ${POINTER_WIDTH + POINTER_THICKNESS}px solid transparent;\n    border-bottom: ${POINTER_HEIGHT + POINTER_THICKNESS}px solid #636569;\n    left: -${POINTER_THICKNESS}px;\n    top: -${POINTER_THICKNESS}px;\n  }\n\n  &::after {\n    content: \"\";\n    position: absolute;\n    border-left: ${POINTER_WIDTH}px solid transparent;\n    border-right: ${POINTER_WIDTH}px solid transparent;\n    border-bottom: ${POINTER_HEIGHT}px solid ${tooltipBackground};\n  }\n`;\n\nfunction normalizeCssValue(value: string | number) {\n  return typeof value === \"number\" ? `${value}px` : value;\n}\n\nconst withMin = (min: number) => (value: string | number | undefined) =>\n  value != undefined ? `max(${min}px, ${normalizeCssValue(value)})` : value;\nconst withMax = (max: number) => (value: string | number | undefined) =>\n  value != undefined ? `min(${max}px, ${normalizeCssValue(value)})` : value;\nconst HEIGHT_OFFSET = POINTER_HEIGHT + WITH_POINTER_BORDER_RADIUS;\nconst WIDTH_OFFSET = POINTER_WIDTH + WITH_POINTER_BORDER_RADIUS;\n\n/**\n * Ensures pointer is not offset too much or too little that would make the arrow appear\n * outside the tooltip boundary.\n */\nfunction limitPointerPositionStyles(\n  { width, height }: { width: number | undefined; height: number | undefined },\n  { top, left, right, bottom }: CSSProperties\n) {\n  const applyVerticalMinMax = compose(\n    height ? withMax(height - HEIGHT_OFFSET) : identity,\n    withMin(HEIGHT_OFFSET)\n  );\n  const applyHorizontalMinMax = compose(\n    width ? withMax(width - WIDTH_OFFSET) : identity,\n    withMin(WIDTH_OFFSET)\n  );\n  return {\n    top: applyVerticalMinMax(top),\n    bottom: applyVerticalMinMax(bottom),\n    left: applyHorizontalMinMax(left),\n    right: applyHorizontalMinMax(right),\n  };\n}\n\nconst getOffsetCssProp = (\n  side: TooltipPointerPosition[\"side\"],\n  invert?: boolean\n): \"top\" | \"bottom\" | \"left\" | \"right\" => {\n  if (side === \"top\" || side === \"bottom\") {\n    return invert ? \"right\" : \"left\";\n  }\n  return invert ? \"bottom\" : \"top\";\n};\n\nfunction pointerPositionToOffsetStyle({\n  side,\n  offset = \"50%\",\n}: TooltipPointerPosition): CSSProperties {\n  const { invert = false, value: offsetValue } =\n    typeof offset === \"object\" ? offset : { invert: false, value: offset };\n  return {\n    [getOffsetCssProp(side, invert)]: offsetValue,\n  };\n}\n\nexport function TooltipPointer({\n  side,\n  offset,\n  tooltipRef,\n}: {\n  side: TooltipPointerPosition[\"side\"];\n  offset:\n    | { type: \"calculated\"; value: CSSProperties }\n    | { type: \"specific\"; value: TooltipPointerPosition[\"offset\"] };\n  tooltipRef: RefObject<HTMLElement>;\n}) {\n  const [size, setSize] = useState<{\n    height: number | undefined;\n    width: number | undefined;\n  }>({ height: undefined, width: undefined });\n  useEffect(() => {\n    const { offsetHeight, offsetWidth } = tooltipRef.current || {};\n    if (offsetHeight != size?.height || offsetWidth != size?.width) {\n      setSize({ height: offsetHeight, width: offsetWidth });\n    }\n  });\n\n  return (\n    <StyledTooltipPointer\n      side={side}\n      style={limitPointerPositionStyles(\n        size,\n        offset.type === \"specific\"\n          ? pointerPositionToOffsetStyle({ side, offset: offset.value })\n          : offset.value\n      )}\n    />\n  );\n}\n","import React, { useRef } from \"react\";\nimport { useLayoutEffect } from \"@react-aria/utils\";\nimport {\n  AriaPositionProps,\n  PositionAria,\n  useOverlayPosition,\n} from \"@react-aria/overlays\";\n\n/**\n * `useOverlayPosition` only supports positioning overlay relative to an element, at the moment.\n *  For context menu or tooltip, we may want to position the overlay based on the coordinates of the mouse event which\n *  has triggered the overlay.\n *  This hook wraps `useOverlayPosition`, and is very similar to it, but you don't need to pass `targetRef`. Instead,\n *  you have to call the updatePosition in the event handler that triggers the overlay, passing the `MouseEvent` object.\n *\n * This is hopefully a temporary solution to circumvents the limitation of `useOverlayPosition`, until it supports\n * non-element based positioning as well. It works by appending a dummy 1x1 px element to body and positioning it\n * based on React.MouseEvent objects. Then it uses a ref to that element as the `targetRef`, passed to `useOverlayPosition`\n *\n * @example\n * ```ts\n * const { updatePosition, overlyProps} = useMouseEventOverlayPosition({ overlayRef });\n *\n * const onContextMenu = (event: React.ReactEvent) => {\n *  updatePosition(event);\n *  // ...\n * }\n * ```\n */\nlet globalMoveHandler: null | ((e: MouseEvent) => void) = null;\nlet lastMouseClientPos: { clientX: number; clientY: number } | undefined;\n\nexport function useMouseEventOverlayPosition(\n  options: Omit<AriaPositionProps, \"targetRef\">\n): Omit<PositionAria, \"updatePosition\"> & {\n  updatePosition: (event?: React.MouseEvent) => void;\n} {\n  const targetRef = useRef<HTMLElement>(null);\n\n  useLayoutEffect(() => {\n    if (!globalMoveHandler) {\n      // After the first use of the hook, the listener will be attached forever. Not a big deal but can be improved.\n      globalMoveHandler = ({ clientX, clientY }) => {\n        lastMouseClientPos = { clientX, clientY };\n      };\n      document.addEventListener(\"mousemove\", globalMoveHandler);\n    }\n    if (!targetRef.current) {\n      const fakeTarget = document.createElement(\"span\");\n      Object.assign(fakeTarget.style, {\n        width: \"0px\",\n        height: \"0px\",\n        pointerEvents: \"none\",\n        position: \"fixed\",\n        visibility: \"hidden\",\n      });\n      document.body.appendChild(fakeTarget);\n      // @ts-expect-error We intentionally don't pass null to generic argument, to not have it as a mutable nullable\n      // ref, since we are mimicking an element ref.\n      targetRef.current = fakeTarget;\n      return () => {\n        fakeTarget.remove();\n      };\n    }\n  }, []);\n\n  const updatePosition = (e?: React.MouseEvent) => {\n    const coordinatesSource = e || lastMouseClientPos;\n    if (targetRef.current && coordinatesSource) {\n      const { clientX, clientY } = coordinatesSource;\n      targetRef.current.style.left = `${\n        // not sure why crossOffset passed to useOverlayPosition doesn't work, so compensating for it here.\n        clientX + (options.crossOffset ?? 0)\n      }px`;\n      targetRef.current.style.top = `${clientY}px`;\n    }\n    _updatePosition();\n  };\n  useLayoutEffect(() => {\n    if (options.isOpen) {\n      updatePosition();\n    }\n  }, [options.isOpen, targetRef.current]);\n\n  const { updatePosition: _updatePosition, ...result } = useOverlayPosition({\n    ...options,\n    targetRef,\n  });\n\n  return {\n    ...result,\n    /**\n     * Ref to be passed to be passed as targetRef\n     */\n    updatePosition,\n  };\n}\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { TooltipTriggerProps as AriaTooltipTriggerProps } from \"@react-aria/tooltip\";\nimport { AriaPositionProps } from \"@react-aria/overlays\";\nimport { useTooltipTriggerState } from \"@react-stately/tooltip\";\nimport { useMouseEventOverlayPosition } from \"@intellij-platform/core/utils/useMouseEventOverlayPosition\";\nimport { useTheme } from \"@intellij-platform/core/styled\";\nimport { TooltipTriggerAndOverlay } from \"@intellij-platform/core/Tooltip/TooltipTriggerAndOverlay\";\n\nexport interface TooltipTriggerProps\n  // controlling isOpen state is not supported since positioning is based on cursor.\n  // PositionedTooltipTrigger can be used for controlled isOpen state\n  extends Omit<AriaTooltipTriggerProps, \"isOpen\" | \"defaultOpen\" | \"trigger\"> {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Placement of the tooltip with respect to the cursor\n   * @default \"bottom left\"\n   */\n  placement?: AriaPositionProps[\"placement\"];\n  /**\n   * The additional offset applied along the main axis between the element and its\n   * anchor element.\n   * @default theme.value<number>(\"HelpTooltip.mouseCursorOffset\") ?? 20\n   */\n  offset?: number;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  children:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<HTMLElement> }\n      ) => React.ReactNode);\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}.\n * Showing tooltip on focus and controlled open state are not supported at the moment, based on how tooltip works in the\n * reference impl, and since tooltip is positioned based on cursor position. Positioning the tooltip based on cursor\n * position requires tooltip to be opened on hover. That's why neither controlling opened state nor showing the tooltip\n * on focus are supported here. {@link PositionedTooltipTrigger} allows for positioning the tooltip with respect to the\n * trigger element, and offers more options.\n */\nexport const TooltipTrigger = ({\n  tooltip,\n  children,\n  /**\n   * ide.tooltip.initialReshowDelay registry key. [Docs](https://jetbrains.github.io/ui/controls/tooltip/#19) says\n   * it's 300 by default, but it's 500 in the code currently.\n   */\n  delay = 500,\n  offset,\n  placement = \"bottom left\",\n  ...props\n}: TooltipTriggerProps): JSX.Element => {\n  const triggerRef = useRef<HTMLElement>(null);\n  const theme = useTheme();\n  const state = useTooltipTriggerState({\n    ...props,\n    delay,\n  });\n\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  const positionAria = useMouseEventOverlayPosition({\n    overlayRef,\n    isOpen: state.isOpen,\n    placement,\n    shouldFlip: true,\n    offset:\n      offset ?? theme.value<number>(\"HelpTooltip.mouseCursorOffset\") ?? 20,\n  });\n\n  // FIXME: Find the explanation for why it happens, and fix it properly, if it's a legit issue.\n  useEffect(() => {\n    if (state.isOpen) {\n      requestAnimationFrame(() => {\n        positionAria.updatePosition();\n      });\n    }\n  }, [state.isOpen]);\n\n  return (\n    <TooltipTriggerAndOverlay\n      tooltip={tooltip}\n      positionAria={positionAria}\n      trigger={children}\n      state={state}\n      overlayRef={overlayRef}\n      triggerRef={triggerRef}\n      /**\n       * If we want to support showing tooltip on focus, or if we want to allow controlled open state, we should let it\n       * be positioned by the trigger element in that case, rather than mouse position.\n       * One solution would be to use useOverlayPosition as well, and conditionally use the right `overlayProps`, based on\n       * whether the position determined by mouse is within `triggerRef.current?.getBoundingClientRect()`. Another way\n       * (maybe better) would be to have `useMouseEventOverlayPosition` accept `bounds` or `containerBounds`, which if\n       * passed, makes sure the position is kept within that boundary. Outside positions would be mapped to the closest\n       * point on the border of the boundary.\n       */\n      showOnFocus={false}\n      isDisabled={props.isDisabled}\n    />\n  );\n};\n","import React, {\n  HTMLAttributes,\n  ReactElement,\n  RefObject,\n  useState,\n} from \"react\";\nimport { useTooltipTrigger as useAriaTooltipTrigger } from \"@react-aria/tooltip\";\nimport { TooltipTriggerState } from \"@react-stately/tooltip\";\nimport { FocusableProvider } from \"@react-aria/focus\";\nimport { Overlay, PositionAria } from \"@react-aria/overlays\";\nimport { mergeProps, useLayoutEffect } from \"@react-aria/utils\";\n\nimport { TooltipContext } from \"./TooltipContext\";\n\ninterface TooltipTriggerBaseProps<T extends HTMLElement = HTMLElement> {\n  /**\n   * Tooltip content. The value should be an element of type {@link Tooltip}.\n   */\n  tooltip: ReactElement;\n  /**\n   * Either a focusable component, or a render function which accepts trigger props and passes it to some component.\n   */\n  trigger:\n    | React.ReactNode\n    | ((\n        props: HTMLAttributes<HTMLElement> & { ref: RefObject<T> }\n      ) => React.ReactNode);\n\n  state: TooltipTriggerState;\n\n  showOnFocus?: boolean;\n  positionAria: PositionAria;\n  overlayRef: RefObject<HTMLDivElement>;\n  triggerRef: RefObject<T>;\n  isDisabled?: boolean;\n}\n\n/**\n * Sets {@param tooltip} for its {@param children}. It doesn't handle tooltip positioning, and so shouldn't be used\n * directly. {@param tooltipOverlayProps} should be used to apply the intended positioning.\n *\n * TODO: Implement timeout-based auto-hide (https://jetbrains.github.io/ui/controls/tooltip/#19)\n * TODO: shadow\n */\nexport const TooltipTriggerAndOverlay = <T extends HTMLElement>({\n  tooltip,\n  trigger,\n  state,\n  overlayRef,\n  triggerRef,\n  showOnFocus,\n  positionAria,\n  ...props\n}: TooltipTriggerBaseProps<T>): JSX.Element => {\n  const [isInteractive, setInteractive] = useState(false);\n  const { triggerProps, tooltipProps } = useTooltipTrigger(\n    props,\n    // In Intellij Platform. The tooltip hides right away. We follow the same, unless the tooltip is interactive.\n    // Maybe something to rethink if it's worth following the reference impl for.\n    { ...state, close: isInteractive ? state.close : () => state.close(true) },\n    triggerRef\n  );\n\n  if (!showOnFocus) {\n    delete triggerProps.onFocus;\n  }\n\n  useLayoutEffect(() => {\n    setInteractive(\n      overlayRef.current?.querySelector(\n        'a, button, [role=\"button\"], [role=link]'\n      ) !== null\n    );\n  });\n  return (\n    <>\n      {normalizeChildren(trigger, { ...triggerProps, ref: triggerRef })}\n      {state.isOpen && !props.isDisabled && (\n        <Overlay>\n          <TooltipContext.Provider\n            value={{\n              state,\n              isInteractive,\n              placement: positionAria.placement,\n              pointerPositionStyle: positionAria.arrowProps.style,\n            }}\n          >\n            <div\n              {...mergeProps(\n                positionAria.overlayProps,\n                // Is it ok to apply tooltip props on this wrapper?\n                tooltipProps\n              )}\n              ref={overlayRef}\n            >\n              {tooltip}\n            </div>\n          </TooltipContext.Provider>\n        </Overlay>\n      )}\n    </>\n  );\n};\n\nfunction normalizeChildren<T extends HTMLElement = HTMLElement>(\n  children: TooltipTriggerBaseProps<T>[\"trigger\"],\n  triggerProps: HTMLAttributes<HTMLElement> & { ref: RefObject<T> }\n) {\n  if (typeof children === \"function\") {\n    return children(triggerProps);\n  }\n  if (React.isValidElement(children) && typeof children.type === \"string\") {\n    return React.cloneElement(children, triggerProps);\n  }\n  return <FocusableProvider {...triggerProps}>{children}</FocusableProvider>;\n}\n\n/**\n * A wrapper around react-aria's useTooltipTrigger, adjusting it for Intellij Platform.\n */\nconst useTooltipTrigger: typeof useAriaTooltipTrigger = (props, state, ref) => {\n  const { triggerProps, tooltipProps } = useAriaTooltipTrigger(\n    props,\n    state,\n    ref\n  );\n  // onPointerDown returned from the underlying usePress stops propagation which messes with some usages of tooltip\n  // like in tab or tool window stripe button. We replace onPointerDown handler with a similar handler that closes\n  // the tooltip.\n  triggerProps.onPointerDown = () => {\n    if (!(ref.current instanceof HTMLInputElement)) {\n      state.close(true);\n    }\n  };\n  /**\n   * onMouseDown is preventDefault-ed which interferes with functionality of the tooltip trigger, in use cases like\n   * tool window stripe button. Note that since pointerDown is handled for calling the tooltip trigger's onPressStart\n   * handler (which hides the tooltip), there is no issue in excluding onMouseDown, because it's only used to preventDefault\n   * the event, because of some edge cases focus handling which is not our concern.\n   */\n  delete triggerProps.onMouseDown;\n\n  return {\n    triggerProps,\n    tooltipProps,\n  };\n};\n","import React from \"react\";\nimport { Tooltip } from \"@intellij-platform/core/Tooltip/Tooltip\";\nimport { styled } from \"@intellij-platform/core/styled\";\n\nexport interface ValidationTooltipProps {\n  children: React.ReactNode;\n  /**\n   * @default error\n   */\n  type?: \"error\" | \"warning\";\n}\n\nconst StyledValidationTooltip = styled(Tooltip)`\n  box-shadow: none;\n  padding: 0.25rem 0.5rem; // from ComponentValidator class in the reference impl\n  max-width: ${({ theme }) =>\n    `${theme.value<number>(\"ValidationTooltip.maxWidth\")}px`};\n  background: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.errorBackground\")};\n  border: 1px solid\n    ${({ theme }) => theme.color(\"ValidationTooltip.errorBorderColor\")};\n`;\n\nconst StyledWarningValidationTooltip = styled(StyledValidationTooltip)`\n  background: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.warningBackground\")};\n  border-color: ${({ theme }) =>\n    theme.color(\"ValidationTooltip.warningBorderColor\")};\n`;\n\n/**\n * Tooltip to be used for validation error messages\n * @see https://jetbrains.github.io/ui/principles/validation_errors/\n */\nexport const ValidationTooltip = ({\n  type = \"error\",\n  children,\n}: ValidationTooltipProps): JSX.Element => {\n  const Component =\n    type === \"error\" ? StyledValidationTooltip : StyledWarningValidationTooltip;\n  return <Component multiline>{children}</Component>;\n};\n","import { Theme } from \"@intellij-platform/core/Theme\";\n\nexport const WITH_POINTER_BORDER_RADIUS = 4;\nexport const tooltipBackground = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ToolTip.background\", !theme.dark ? \"#f2f2f2\" : \"#3c3f41\");\nexport const tooltipBorderColor = ({ theme }: { theme: Theme }) =>\n  theme.color(\"ToolTip.borderColor\", !theme.dark ? \"#adadad\" : \"#636569\");\n","import React from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeNode } from \"../TreeNode\";\nimport { SpeedSearchItemHighlightsProvider } from \"@intellij-platform/core/CollectionSpeedSearch\";\n\nexport const SpeedSearchTreeNode = <T extends object>({\n  item,\n}: {\n  item: Node<T>;\n}) => {\n  return (\n    <SpeedSearchItemHighlightsProvider itemKey={item.key}>\n      <TreeNode key={item.key} item={item} />\n    </SpeedSearchItemHighlightsProvider>\n  );\n};\n","import React, { ForwardedRef } from \"react\";\nimport { Node } from \"@react-types/shared\";\nimport { Virtualizer } from \"@react-aria/virtualizer\";\nimport { CollectionSpeedSearchContext } from \"@intellij-platform/core/CollectionSpeedSearch\";\nimport {\n  SpeedSearchProps,\n  SpeedSearchStateProps,\n} from \"@intellij-platform/core/SpeedSearch\";\nimport useForwardedRef from \"@intellij-platform/core/utils/useForwardedRef\";\nimport { StyledTree } from \"../StyledTree\";\nimport { SpeedSearchPopup } from \"../../SpeedSearch/SpeedSearchPopup\";\nimport { useTreeState } from \"../useTreeState\";\nimport { TreeProps } from \"../Tree\";\nimport { useTreeVirtualizer } from \"../useTreeVirtualizer\";\nimport { TreeContext } from \"../TreeContext\";\nimport { useSpeedSearchTree } from \"./useSpeedSearchTree\";\nimport { SpeedSearchTreeNode } from \"./SpeedSearchTreeNode\";\nimport { filterDOMProps } from \"@react-aria/utils\";\n\nexport type SpeedSearchTreeProps<T extends object> = TreeProps<T> &\n  SpeedSearchProps &\n  SpeedSearchStateProps & {\n    /**\n     * Whether speed search popup should not be shown. Useful when speed search state is controlled, and\n     * a search input is rendered outside the tree.\n     */\n    hideSpeedSearchPopup?: boolean;\n  };\n\nexport const SpeedSearchTree = React.forwardRef(\n  <T extends object>(\n    {\n      fillAvailableSpace = false,\n      treeRef,\n      hideSpeedSearchPopup,\n      style,\n      className,\n      ...props\n    }: SpeedSearchTreeProps<T>,\n    forwardedRef: ForwardedRef<HTMLDivElement>\n  ) => {\n    const state = useTreeState(\n      { ...props, disallowEmptySelection: !props.allowEmptySelection },\n      treeRef\n    );\n    const ref = useForwardedRef(forwardedRef);\n    const {\n      treeProps,\n      treeContext,\n      speedSearchContextValue,\n      searchPopupProps,\n    } = useSpeedSearchTree({ ...props, isVirtualized: true }, state, ref);\n\n    const { virtualizerProps } = useTreeVirtualizer({ state });\n\n    // NOTE: SpeedSearchPopup can be rendered as a portal with proper positioning (useOverlayPosition), if overflow\n    // issues required it.\n    return (\n      <TreeContext.Provider value={treeContext}>\n        <CollectionSpeedSearchContext.Provider value={speedSearchContextValue}>\n          {!hideSpeedSearchPopup && <SpeedSearchPopup {...searchPopupProps} />}\n          <StyledTree\n            as={Virtualizer}\n            ref={ref}\n            fillAvailableSpace={fillAvailableSpace}\n            {...virtualizerProps}\n            {...treeProps}\n            {...filterDOMProps(props, { labelable: true })}\n            style={style}\n            className={className}\n          >\n            {(type: string, item: unknown) => (\n              <SpeedSearchTreeNode\n                key={(item as Node<T>).key}\n                item={item as Node<T>}\n              />\n            )}\n          </StyledTree>\n        </CollectionSpeedSearchContext.Provider>\n      </TreeContext.Provider>\n    );\n  }\n);\n","import { RefObject } from \"react\";\nimport { useKeyboard } from \"@react-aria/interactions\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useCollectionSpeedSearch } from \"../../CollectionSpeedSearch/useCollectionSpeedSearch\";\nimport {\n  SpeedSearchProps,\n  SpeedSearchStateProps,\n} from \"../../SpeedSearch/useSpeedSearch\";\nimport { TreeKeyboardDelegate } from \"../TreeKeyboardDelegate\";\nimport { SelectableTreeProps, useSelectableTree } from \"../useSelectableTree\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\n\ninterface UseSpeedSearchTreeProps<T>\n  extends SpeedSearchProps,\n    SpeedSearchStateProps,\n    SelectableTreeProps<T> {}\n\nexport function useSpeedSearchTree<T>(\n  props: UseSpeedSearchTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const {\n    containerProps,\n    keyboardDelegate,\n    selectionManager,\n    speedSearch,\n    ...collectionSpeedSearch\n  } = useCollectionSpeedSearch({\n    ...props,\n    collection: state.collection,\n    selectionManager: state.selectionManager,\n    keyboardDelegate: new TreeKeyboardDelegate(\n      state.collection,\n      state.disabledKeys,\n      ref\n    ),\n    ref,\n    // TODO: maybe allow control over speed search via other props\n  });\n\n  // Speed search is cleared on \"Enter\" key. Alternatively we could wrap onAction and onToggle props\n  // but this seemed more reasonable\n  // NOTE: It may make sense for this behaviour to be pulled up to useCollectionSpeedSearch.\n  const { keyboardProps: speedSearchKeyboardProps } = useKeyboard({\n    onKeyDown: (e) => {\n      if (\n        [\"Enter\", \"ArrowLeft\", \"ArrowRight\"].includes(e.key) &&\n        !hasAnyModifier(e)\n      ) {\n        speedSearch.clear();\n      } else {\n        e.continuePropagation();\n      }\n    },\n  });\n\n  const { treeProps, ...selectableTree } = useSelectableTree(\n    { ...props, keyboardDelegate },\n    { ...state, selectionManager },\n    ref\n  );\n\n  return {\n    treeProps: mergeProps(treeProps, containerProps, speedSearchKeyboardProps),\n    ...collectionSpeedSearch,\n    ...selectableTree,\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { StyledList } from \"@intellij-platform/core/List/StyledList\";\n\nexport const StyledTree = styled(StyledList).attrs({ role: \"tree\" as string })`\n  background: ${({ theme }) => theme.color(\"Tree.background\")};\n`;\n","import React, { Key, MutableRefObject } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\n\nexport type TreeContextType<T> = {\n  state: Pick<\n    TreeState<T>,\n    | \"collection\"\n    | \"selectionManager\"\n    | \"expandedKeys\"\n    | \"disabledKeys\"\n    | \"toggleKey\"\n  >;\n  focused: boolean;\n  onActionRef: MutableRefObject<((key: Key) => void) | undefined>;\n};\n\nexport const TreeContext = React.createContext<TreeContextType<any> | null>(\n  null\n);\n","import { ListKeyboardDelegate } from \"@react-aria/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key, RefObject } from \"react\";\n\nexport class TreeKeyboardDelegate<T> extends ListKeyboardDelegate<T> {\n  constructor(\n    private collection: Collection<Node<T>>,\n    disabledKeys: Set<Key>,\n    ref: RefObject<HTMLElement>,\n    collator?: Intl.Collator\n  ) {\n    super({\n      collection,\n      disabledKeys,\n      ref,\n      collator,\n      // Since @react-aria/selection@3.16.0 getKeyLeftOf and getKeyRightOf is\n      // removed if orientation is vertical and layout is \"stack\".\n      layout: \"grid\",\n    });\n  }\n\n  getKeyLeftOf(key: React.Key): React.Key | null {\n    const item = this.collection.getItem(key);\n    return item?.parentKey ?? this.getKeyAbove(key);\n  }\n\n  getKeyRightOf(key: React.Key): React.Key | null {\n    return this.getKeyBelow(key);\n  }\n}\n","import { LafIcon } from \"../Icon\";\nimport React, { ComponentProps, useMemo } from \"react\";\nimport { styled } from \"../styled\";\n\nexport const TREE_ICON_SIZE = 16;\nconst StyledTreeNodeIcon = styled(LafIcon)`\n  margin-left: -20px;\n  margin-right: 4px;\n  margin-top: -1px; // the svg path seems to have uneven vertical padding. This is to compensate for that.\n  flex-shrink: 0;\n  align-self: center;\n`;\n\ntype TreeNodeIconProps = ComponentProps<typeof StyledTreeNodeIcon> & {\n  selected: boolean;\n  expanded: boolean;\n};\nconst getIcon = (selected: boolean, expanded: boolean) => {\n  const modifiers = { Selected: selected };\n  if (expanded) {\n    return {\n      themePath: selected ? \"Tree.expandedSelectedIcon\" : \"Tree.expandedIcon\",\n      iconPath: { name: \"treeExpanded\", modifiers },\n    };\n  }\n  if (!expanded) {\n    return {\n      themePath: selected ? \"Tree.collapsedSelectedIcon\" : \"Tree.collapsedIcon\",\n      iconPath: { name: \"treeCollapsed\", modifiers },\n    };\n  }\n};\n\nexport function TreeNodeIcon({\n  selected,\n  expanded,\n  ...props\n}: TreeNodeIconProps) {\n  const icon = useMemo(() => getIcon(selected, expanded), [selected, expanded]);\n  return (\n    <StyledTreeNodeIcon\n      icon={icon?.iconPath}\n      themePath={icon?.themePath}\n      size={TREE_ICON_SIZE}\n      {...props}\n    />\n  );\n}\n","import { Key } from \"react\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { PressProps } from \"@react-aria/interactions\";\n\nexport function useTreeNodeToggleButton<T>({\n  collection,\n  toggleKey,\n  selectionManager,\n  key,\n}: { key: Key } & Pick<\n  TreeState<T>,\n  \"collection\" | \"toggleKey\" | \"selectionManager\"\n>): { treeNodeToggleButtonProps: PressProps } {\n  return {\n    treeNodeToggleButtonProps: {\n      preventFocusOnPress: true,\n      onPress: () => {\n        toggleKey(key);\n\n        // The rest is for deselecting selected descendants and selecting the toggled node, if there\n        // is at least one of such currently selected descendants. This is the exact behavior\n        // of Tree in Intellij Platform, and hence implemented here.\n        const selectedDescendantKeys = [\n          ...selectionManager.selectedKeys,\n        ].filter((key: Key) => {\n          let parentKey = collection.getItem(key)?.parentKey;\n          while (parentKey) {\n            if (parentKey === key) {\n              return true;\n            }\n            parentKey = collection.getItem(parentKey)?.parentKey;\n          }\n          return false;\n        });\n        selectedDescendantKeys.forEach((key) =>\n          selectionManager.toggleSelection(key)\n        );\n        // if any of the descendants are selected\n        if (\n          !selectionManager.isSelected(key) &&\n          selectedDescendantKeys.length > 0\n        ) {\n          selectionManager.toggleSelection(key);\n        }\n      },\n    },\n  };\n}\n","import { styled } from \"@intellij-platform/core/styled\";\nimport { UnknownThemeProp } from \"@intellij-platform/core/Theme\";\nimport { StyledListItem } from \"@intellij-platform/core/List/StyledListItem\";\nimport { TREE_ICON_SIZE } from \"./TreeNodeIcon\";\n\ntype StyledListItemProps = {\n  level: number;\n};\nexport const StyledTreeNode = styled(StyledListItem).attrs<StyledListItemProps>(\n  { role: \"treeitem\" }\n)<StyledListItemProps>`\n  // There are some theme properties for tree node padding (theme.ui.Tree.leftChildIndent and\n  // theme.ui.Tree.leftChildIndent), but they doesn't seem to be applicable.\n  padding-left: ${({ level }) => `${(level + 1) * TREE_ICON_SIZE + 8}px`};\n  padding-right: 0.25rem;\n  ${({ containerFocused, selected, disabled, theme }) => {\n    let backgroundColor;\n    let color = disabled\n      ? theme.color(\"*.disabledForeground\")\n      : theme.color(\n          \"Tree.foreground\" as UnknownThemeProp<\"Tree.foreground\">,\n          theme.commonColors.labelForeground\n        );\n    if (selected) {\n      if (containerFocused) {\n        color = theme.asCurrentForeground(\n          theme.color(\n            \"Tree.selectionForeground\" as UnknownThemeProp<\"Tree.selectionForeground\">\n          ) || theme.commonColors.labelSelectedForeground\n        ) /* Prioritizing \"*.selectionForeground\" over labelSelectedForeground*/;\n        backgroundColor = theme.color(\n          \"Tree.selectionBackground\" as UnknownThemeProp<\"Tree.selectionBackground\">\n        );\n      } else {\n        color = theme.color(\n          \"Tree.selectionInactiveForeground\" as UnknownThemeProp<\"Tree.selectionInactiveForeground\">,\n          color\n        );\n        backgroundColor = theme.color(\n          \"Tree.selectionBackgroundInactive\" as UnknownThemeProp<\"Tree.selectionBackgroundInactive\">\n        );\n      }\n    }\n    return {\n      backgroundColor,\n      color,\n    };\n  }}\n`;\n","import { usePress } from \"@react-aria/interactions\";\nimport { Node } from \"@react-types/shared\";\nimport React, { useContext, useRef } from \"react\";\nimport { ItemStateContext } from \"../Collections/ItemStateContext\";\nimport { TreeNodeIcon } from \"./TreeNodeIcon\";\nimport { useTreeNode } from \"./useTreeNode\";\nimport { useTreeNodeToggleButton } from \"./useTreeNodeToggleButton\";\nimport { TreeContext } from \"./TreeContext\";\nimport { StyledTreeNode } from \"@intellij-platform/core/Tree/StyledTreeNode\";\n\ntype TreeNodeProps<T> = {\n  item: Node<T>;\n  showAsFocused?: boolean;\n};\n\nexport function TreeNode<T>({ item }: TreeNodeProps<T>) {\n  const ref = useRef(null);\n  const {\n    state: {\n      collection,\n      selectionManager,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n    },\n    focused: containerFocused,\n    onActionRef: { current: onAction },\n  } = useContext(TreeContext)!;\n\n  const isSelected = selectionManager.isSelected(item.key);\n  const expanded = expandedKeys.has(item.key);\n  const isDisabled = disabledKeys.has(item.key);\n\n  const { pressProps: togglePressProps } = usePress({\n    ...useTreeNodeToggleButton({\n      key: item.key,\n      collection,\n      selectionManager,\n      toggleKey,\n    }).treeNodeToggleButtonProps,\n    isDisabled,\n  });\n\n  const { treeNodeProps } = useTreeNode({\n    item,\n    ref,\n    toggleKey,\n    onAction,\n    selectionManager,\n    disabled: isDisabled,\n  });\n\n  /**\n   * NOTE: TreeNode intentionally is not designed in a recursive way for two main reasons:\n   * - Performance\n   * - Better support for virtualization\n   * So instead of rendering TreeNode for childNodes, if the node is expanded, we expect parent\n   * to render children. It's not a layout issue since we don't need any nesting in terms of\n   * layout of nested items. In terms of layout, a tree will be rendered similar to a flat list,\n   * but with more indentation for nested nodes.\n   */\n  return (\n    <>\n      <StyledTreeNode\n        ref={ref}\n        {...treeNodeProps}\n        containerFocused={containerFocused}\n        disabled={isDisabled}\n        selected={isSelected}\n        aria-disabled={isDisabled}\n        aria-selected={isSelected}\n        level={item.level}\n      >\n        {[...item.childNodes].length > 0 && (\n          <TreeNodeIcon\n            selected={isSelected}\n            expanded={expanded}\n            {...togglePressProps}\n          />\n        )}\n        <ItemStateContext.Provider\n          value={{\n            isDisabled,\n            isSelected,\n            isContainerFocused: containerFocused,\n            node: item,\n          }}\n        >\n          {item.rendered}\n        </ItemStateContext.Provider>\n      </StyledTreeNode>\n    </>\n  );\n}\n","import { usePress } from \"@react-aria/interactions\";\nimport { useSelectableItem } from \"@intellij-platform/core/selection\";\nimport { mergeProps } from \"@react-aria/utils\";\nimport { SelectionManager } from \"@react-stately/selection\";\nimport { Node } from \"@react-types/shared\";\nimport { Key, RefObject } from \"react\";\n\nexport function useTreeNode<T>({\n  item,\n  ref,\n  selectionManager,\n  disabled,\n  toggleKey,\n  onAction,\n}: {\n  item: Node<T>;\n  ref: RefObject<HTMLElement>;\n  disabled: boolean;\n  toggleKey: (key: Key) => void;\n  onAction?: (key: Key) => void;\n  selectionManager: SelectionManager;\n}) {\n  const {\n    pressProps: { onKeyDown, ...pressProps },\n  } = usePress({\n    ...useSelectableItem({\n      key: item.key,\n      ref,\n      selectionManager,\n      isVirtualized: false,\n    }).itemProps,\n    isDisabled: disabled,\n    preventFocusOnPress: false,\n  });\n\n  const onDoubleClick = () => {\n    if ([...item.childNodes].length > 0) {\n      toggleKey(item.key);\n    } else {\n      onAction?.(item.key);\n    }\n  };\n  const ariaProps = {\n    role: \"treeitem\",\n  };\n\n  return {\n    treeNodeProps: mergeProps(pressProps, { onDoubleClick }, ariaProps),\n  };\n}\n","import { Key, RefObject, useEffect, useMemo, useRef, useState } from \"react\";\nimport {\n  DOMProps,\n  KeyboardDelegate,\n  KeyboardEvent,\n  Node,\n} from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { useFocusWithin, useKeyboard } from \"@react-aria/interactions\";\nimport { filterDOMProps, mergeProps } from \"@react-aria/utils\";\nimport { useCollator } from \"@react-aria/i18n\";\nimport { useSelectableCollection } from \"@intellij-platform/core/selection\";\nimport { TreeKeyboardDelegate } from \"./TreeKeyboardDelegate\";\nimport { useCollectionAutoScroll } from \"../Collections/useCollectionAutoScroll\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeContextType } from \"./TreeContext\";\nimport { hasAnyModifier } from \"@intellij-platform/core/utils/keyboard-utils\";\nimport { FocusEvents } from \"@react-types/shared/src/events\";\nimport { FocusStrategy } from \"@react-types/shared/src/selection\";\nimport { groupBy } from \"ramda\";\nimport {\n  CollectionFocusProxyProps,\n  useCollectionFocusProxy,\n} from \"@intellij-platform/core/Collections\";\n\nexport interface SelectableTreeProps<T>\n  extends DOMProps,\n    Omit<FocusEvents, \"onFocusChange\">,\n    CollectionFocusProxyProps {\n  isVirtualized?: boolean;\n  keyboardDelegate?: KeyboardDelegate;\n  /**\n   * Called when the action associated with a leaf tree node should be taken.\n   * The exact UI interaction is abstracted away, but it's either Enter key or double click.\n   */\n  onAction?: (key: Key) => void;\n  onNodeKeyDown?: (event: KeyboardEvent, node: Node<T>) => void;\n\n  allowEmptySelection?: boolean;\n\n  autoFocus?: boolean | FocusStrategy;\n\n  showAsFocused?: boolean;\n}\n\n/**\n * NOTE: at the time of writing this hook, react-aria didn't have support for Tree. When useTree is implemented in\n * react-aria, it makes sense to refactor this and use that. There will still be something on top of it here.\n */\nexport function useSelectableTree<T>(\n  {\n    onAction,\n    onFocus,\n    onBlur,\n    autoFocus,\n    showAsFocused,\n    focusProxyRef,\n    ...props\n  }: SelectableTreeProps<T>,\n  state: TreeState<T>,\n  ref: RefObject<HTMLElement>\n) {\n  const domProps = filterDOMProps(props);\n  const collator = useCollator({ usage: \"search\", sensitivity: \"base\" });\n\n  const [focused, setFocused] = useState(false);\n  const {\n    collectionProps: {\n      // preventDefault in onMouseDown prevents collection from getting focused.\n      // Maybe it should be removed from useSelectableCollection, now that it lives here\n      onMouseDown,\n      onKeyDown: selectionKeyDown,\n      ...collectionProps\n    },\n  } = useSelectableCollection({\n    ref,\n    selectionManager: state.selectionManager,\n    disallowEmptySelection: !props.allowEmptySelection,\n    selectOnFocus: true,\n    autoFocus,\n    keyboardDelegate: useMemo(\n      () =>\n        props.keyboardDelegate ||\n        new TreeKeyboardDelegate(\n          state.collection,\n          state.disabledKeys,\n          ref,\n          collator\n        ),\n      [state.collection, state.disabledKeys, props.keyboardDelegate]\n    ),\n  });\n\n  useCollectionFocusProxy({\n    collectionRef: ref,\n    state,\n    onAction,\n    focusProxyRef,\n  });\n\n  const { focusWithinProps } = useFocusWithin({\n    onFocusWithinChange: setFocused,\n  });\n\n  useCollectionAutoScroll(\n    {\n      isVirtualized: props.isVirtualized,\n      selectionManager: state.selectionManager,\n    },\n    ref\n  );\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    const focusedKey = state.selectionManager.focusedKey;\n    const focusedItem = focusedKey\n      ? state.collection.getItem(focusedKey)\n      : null;\n    if (focusedItem) {\n      const isExpandable = Boolean(focusedItem?.hasChildNodes);\n      const expanded = state.expandedKeys.has(focusedKey);\n      const isDisabled = state.disabledKeys.has(focusedKey);\n      if (isDisabled) {\n        event.continuePropagation();\n        return;\n      }\n      props?.onNodeKeyDown?.(event, focusedItem);\n      const shouldToggle =\n        !hasAnyModifier(event) &&\n        (event.key === \"Enter\" ||\n          (event.key === \"ArrowLeft\" && expanded) ||\n          (event.key === \"ArrowRight\" && !expanded));\n      if (isExpandable && shouldToggle) {\n        event.preventDefault();\n        state.toggleKey(focusedKey);\n        return;\n      } else if (event.key === \"Enter\") {\n        onAction?.(focusedKey);\n        return;\n      }\n    }\n    // selectionKeyDown currently doesn't report back if it handled the event or not. We could have conditionally\n    // continued propagation if the event was not handled. Then we could change Speed Search impl to only handle\n    // inputs when the propagation is not prevented.\n    // Also, selectionKeyDown is not accurate in handling actions like \"select all\". e.g. it takes 'cmd+shift+a' too,\n    // as select all which can conflict with action system. So we don't call it if there are multiple modifiers.\n    const hasAtMostOneModifier =\n      [event.metaKey, event.ctrlKey, event.shiftKey, event.altKey].filter(\n        (i) => i\n      ).length < 2;\n    if (hasAtMostOneModifier) {\n      selectionKeyDown?.(event);\n    }\n    event.continuePropagation();\n  };\n  const { keyboardProps } = useKeyboard({\n    onKeyDown,\n  });\n\n  //////////////////////////////// providing context value ////////////////////////////////\n  const onActionRef = useLatest(onAction);\n\n  const {\n    selectionManager,\n    collection,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n  } = state;\n  const treeContext = useMemo<TreeContextType<T>>(\n    () => ({\n      state: {\n        collection,\n        selectionManager,\n        expandedKeys,\n        disabledKeys,\n        toggleKey,\n      },\n      focused: Boolean(focused || showAsFocused),\n      onActionRef,\n    }),\n    [\n      selectionManager,\n      collection,\n      expandedKeys,\n      disabledKeys,\n      toggleKey,\n      focused,\n      showAsFocused,\n      onActionRef,\n    ]\n  );\n  ////////////////////////////////////////////////////////////////////////////////////////\n  useSelectParentOfRemovedSelectedNode(state);\n\n  return {\n    // order of merging here is important. navigation handling should precede selection handling\n    treeProps: mergeProps(\n      focusWithinProps,\n      collectionProps,\n      keyboardProps,\n      domProps,\n      { onFocus, onBlur, role: \"tree\" }\n    ),\n    treeContext,\n    focused,\n  };\n}\n\n/**\n * When a selected node is removed from the tree, selects the parent of the removed node\n * if no other node is selected.\n *\n * Note: this behavior is observed in a couple of tree views, including project files tree.\n * There could be an option for disabling/enabling it, if use cases comes up in future\n * where this behavior causes issues.\n */\nconst useSelectParentOfRemovedSelectedNode = (state: TreeState<unknown>) => {\n  const previousCollectionRef = useRef(state.collection);\n  useEffect(() => {\n    if (state.selectionManager.rawSelection !== \"all\") {\n      const keys = [...state.collection.getKeys()];\n\n      const { invalid = [], valid = [] } = groupBy(\n        (selectedKey) => (keys.includes(selectedKey) ? \"valid\" : \"invalid\"),\n        [...state.selectionManager.selectedKeys]\n      );\n      if (valid.length === 0 && invalid.length > 0) {\n        for (let invalidKey of invalid) {\n          let key: Key | undefined = invalidKey;\n          while (key != undefined) {\n            if (keys.includes(key)) {\n              state.selectionManager.setSelectedKeys(valid.concat(key));\n              state.selectionManager.setFocusedKey(key);\n              return;\n            }\n            key =\n              previousCollectionRef.current.getItem(key)?.parentKey ??\n              undefined;\n          }\n        }\n      }\n    }\n    previousCollectionRef.current = state.collection;\n  }, [state.collection]);\n};\n","import { usePrevious } from \"@intellij-platform/core/utils/usePrevious\";\nimport { CacheInvalidationContext } from \"./Item\";\n\nexport interface CollectionCacheInvalidationProps {\n  /**\n   * Defines cache invalidation policy for items. By default, the render result is cached based on the item objects.\n   * This is equivalent of passing false or not passing anything for `cacheInvalidation`. If `true` is passed, it will\n   * always invalidate the render result, causing the collection to be recreated on each re-render. It can\n   * considerably affect performance in large collections. in addition to boolean value, an object with the list of\n   * invalidators can also be passed. renderer function is called each time any of the invalidators are changed.\n   * Think of it as [dependency array in react hooks](https://reactjs.org/docs/hooks-reference.html#usememo). Except\n   * that the length of the array can also safely change.\n   */\n  cacheInvalidation?: boolean | { invalidators: ReadonlyArray<unknown> };\n}\n\n/**\n * Allows cache invalidation options based on input props, for components that use collection\n */\nexport const useCollectionCacheInvalidation = ({\n  cacheInvalidation,\n}: CollectionCacheInvalidationProps): CacheInvalidationContext => {\n  const invalidators =\n    typeof cacheInvalidation === \"object\" ? cacheInvalidation.invalidators : [];\n  const lastInvalidators = usePrevious(invalidators);\n\n  const invalidated =\n    typeof cacheInvalidation === \"object\"\n      ? cacheInvalidation.invalidators.length !== lastInvalidators.length ||\n        cacheInvalidation.invalidators.some(\n          (anInvalidator, index) => anInvalidator !== lastInvalidators[index]\n        )\n      : cacheInvalidation;\n\n  return {\n    invalidated,\n  };\n};\n","//@ts-nocheck\n/**\n * Not exported from @react-stately/tree, but needed in the custom implementation of useTreeState\n */\n\nimport { Key } from \"react\";\nimport { Collection, Node } from \"@react-types/shared\";\n\nexport class TreeCollection<T> implements Collection<Node<T>> {\n  private keyMap: Map<Key, Node<T>> = new Map();\n  private iterable: Iterable<Node<T>>;\n  private firstKey: Key;\n  private lastKey: Key;\n\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys?: Set<Key> } = {}\n  ) {\n    this.iterable = nodes;\n    expandedKeys = expandedKeys || new Set();\n\n    let visit = (node: Node<T>) => {\n      this.keyMap.set(node.key, node);\n\n      if (\n        node.childNodes &&\n        (node.type === \"section\" || expandedKeys.has(node.key))\n      ) {\n        for (let child of node.childNodes) {\n          visit(child);\n        }\n      }\n    };\n\n    for (let node of nodes) {\n      visit(node);\n    }\n\n    let last: Node<T>;\n    let index = 0;\n    for (let [key, node] of this.keyMap) {\n      if (last) {\n        last.nextKey = key;\n        node.prevKey = last.key;\n      } else {\n        this.firstKey = key;\n        node.prevKey = undefined;\n      }\n\n      if (node.type === \"item\") {\n        node.index = index++;\n      }\n\n      last = node;\n\n      // Set nextKey as undefined since this might be the last node\n      // If it isn't the last node, last.nextKey will properly set at start of new loop\n      last.nextKey = undefined;\n    }\n\n    this.lastKey = last?.key;\n  }\n\n  *[Symbol.iterator]() {\n    yield* this.iterable;\n  }\n\n  get size() {\n    return this.keyMap.size;\n  }\n\n  getKeys() {\n    return this.keyMap.keys();\n  }\n\n  getKeyBefore(key: Key) {\n    let node = this.keyMap.get(key);\n    return node?.prevKey ?? null;\n  }\n\n  getKeyAfter(key: Key) {\n    let node = this.keyMap.get(key);\n    return node?.nextKey ?? null;\n  }\n\n  getFirstKey() {\n    return this.firstKey;\n  }\n\n  getLastKey() {\n    return this.lastKey;\n  }\n\n  getItem(key: Key) {\n    return this.keyMap.get(key) ?? null;\n  }\n\n  at(idx: number) {\n    const keys = [...this.getKeys()];\n    return this.getItem(keys[idx]);\n  }\n}\n","import { Node } from \"@react-types/shared\";\nimport { Key } from \"react\";\n\n/**\n * given a node, returns keys of all consecutive single children\n */\nexport function getSingleChildrenKeys<T>(\n  node: Node<T> | null | undefined\n): Key[] {\n  return getSingleChildrenKeysRecursive(node, []);\n}\n\nfunction getSingleChildrenKeysRecursive<T>(\n  node: Node<T> | null | undefined,\n  previousKeys: Key[]\n): Key[] {\n  if (!node) {\n    return [];\n  }\n  const childNodesIterator: Iterator<\n    Node<T>,\n    Node<T> | undefined\n  > = node.childNodes[Symbol.iterator]();\n  const { value: firstChild, done } = childNodesIterator.next();\n  const noMoreChildren = done || childNodesIterator.next().value == null;\n  if (firstChild != null && noMoreChildren && isExpandable(firstChild)) {\n    return getSingleChildrenKeysRecursive(\n      firstChild,\n      previousKeys.concat((firstChild as Node<T>).key)\n    );\n  }\n  return previousKeys;\n}\n\nconst isExpandable = <T>(node: Node<T>) =>\n  node.hasChildNodes || !isEmptyIterable(node.childNodes);\n\nfunction isEmptyIterable(iterable: Iterable<unknown> | undefined | null) {\n  for (const _ of iterable || []) {\n    // eslint-disable-line no-unused-vars, no-unreachable-loop\n    return false;\n  }\n  return true;\n}\n","import {\n  MultipleSelectionState,\n  SelectionManager,\n  SelectionManagerOptions,\n} from \"@react-stately/selection\";\nimport { Collection, Node } from \"@react-types/shared\";\nimport React, { Key } from \"react\";\n\nexport class TreeSelectionManager extends SelectionManager {\n  private readonly collection: Collection<Node<unknown>>;\n\n  constructor(\n    collection: Collection<Node<unknown>>,\n    state: MultipleSelectionState,\n    options?: SelectionManagerOptions\n  ) {\n    super(collection, state, options);\n    this.collection = collection;\n  }\n\n  expandSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      if (node) {\n        const { expandKeys } = this.getExpandAndShrinkKeys(node);\n        if (expandKeys.length > 0) {\n          this.setSelectedKeys([...this.selectedKeys, ...expandKeys]);\n        }\n      }\n    }\n  }\n  shrinkSelection() {\n    if (this.focusedKey) {\n      const node = this.collection.getItem(this.focusedKey);\n      if (node) {\n        const { shrinkKeys } = this.getExpandAndShrinkKeys(node);\n        if (shrinkKeys.length > 0) {\n          this.setSelectedKeys(\n            [...this.selectedKeys].filter((key) => !shrinkKeys.includes(key))\n          );\n        }\n      }\n    }\n  }\n\n  private getExpandAndShrinkKeys(node: Node<unknown>) {\n    return this.recursivelyGetExpandAndShrinkKeys(\n      node,\n      [...this.collection.getKeys()],\n      null\n    );\n  }\n  /**\n   * Starting from a node, traverses the tree up, until it reaches the root of the fully selected subtree that includes\n   * the starting node. The root itself may or may not be selected. Returns:\n   * - keys to be added to selection, when expanding selection\n   * - keys to be removed from selection, when shrinking selection\n   */\n  private recursivelyGetExpandAndShrinkKeys(\n    node: Node<unknown>,\n    keys: Array<Key>,\n    previousChild: Key | null\n  ): { expandKeys: Key[]; shrinkKeys: Key[] } {\n    const parent =\n      node && node.parentKey ? this.collection.getItem(node.parentKey) : null;\n    const newKeys = keys.filter((key) => key !== previousChild);\n    const parentDescendants = parent\n      ? getAllDescendants(parent, newKeys).map(({ key }) => key)\n      : this.getAllRoots().flatMap((key) => {\n          const item = this.collection.getItem(key);\n          return key !== node.key && item\n            ? getAllDescendants(item, newKeys)\n                .map(({ key }) => key)\n                .concat(key)\n            : [];\n        });\n    if (parent && parentDescendants.every((key) => this.isSelected(key))) {\n      return this.recursivelyGetExpandAndShrinkKeys(parent, keys, node.key);\n    }\n    const descendants = getAllDescendants(\n      node,\n      keys.filter((key) => key !== previousChild)\n    ).map(({ key }) => key);\n\n    return {\n      expandKeys: descendants.some((key) => !this.isSelected(key))\n        ? descendants\n        : !this.isSelected(node.key)\n        ? [node.key]\n        : parentDescendants,\n      shrinkKeys:\n        parentDescendants.length > 0 &&\n        parentDescendants.every((key) => this.isSelected(key))\n          ? parentDescendants\n          : this.isSelected(node.key) && previousChild\n          ? [node.key]\n          : descendants.filter((key) => this.isSelected(key)),\n    };\n  }\n\n  private getAllRoots() {\n    return [...this.collection.getKeys()].filter(\n      (key) => this.collection.getItem(key)?.parentKey == null\n    );\n  }\n}\n\nfunction getAllDescendants<T>(\n  node: Node<T>,\n  stopKeys: Array<React.Key>\n): Node<T>[] {\n  const childNodes = (node.hasChildNodes ? [...node.childNodes] : []).filter(\n    (node) => stopKeys.includes(node.key)\n  );\n  return node.hasChildNodes\n    ? childNodes.concat(\n        childNodes.map((node) => getAllDescendants(node, stopKeys)).flat()\n      )\n    : [];\n}\n","import {\n  Collection,\n  CollectionStateBase,\n  Expandable,\n  MultipleSelection,\n  Node,\n} from \"@react-types/shared\";\nimport { TreeProps as _TreeProps, TreeState } from \"@react-stately/tree\";\nimport {\n  TreeRefValue,\n  useTreeRef,\n} from \"@intellij-platform/core/Tree/useTreeRef\";\nimport { ForwardedRef, Key, useCallback, useEffect, useMemo } from \"react\";\nimport { useMultipleSelectionState } from \"@react-stately/selection\";\nimport { useCollection } from \"@react-stately/collections\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  CollectionCacheInvalidationProps,\n  useCollectionCacheInvalidation,\n} from \"@intellij-platform/core/Collections/useCollectionCacheInvalidation\";\nimport { TreeCollection as _TreeCollection } from \"./__copied__TreeCollection\";\nimport { getSingleChildrenKeys } from \"./getSingleChildrenKeys\";\nimport { TreeSelectionManager } from \"@intellij-platform/core/Tree/TreeSelectionManager\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport class TreeCollection<T> extends _TreeCollection<T> {\n  public readonly rootKeys: Key[];\n  constructor(\n    nodes: Iterable<Node<T>>,\n    { expandedKeys }: { expandedKeys: Set<Key> }\n  ) {\n    super(nodes, { expandedKeys });\n    this.rootKeys = Array.from(nodes).map(({ key }) => key);\n  }\n\n  getAllExpandableKeys(): Set<Key> {\n    const rootNodes = this.rootKeys\n      .map((key) => this.getItem(key))\n      .filter(notNull);\n    return this.recursivelyAddExpandableKeys(rootNodes, new Set<Key>());\n  }\n\n  private recursivelyAddExpandableKeys(\n    nodes: Iterable<Node<T>>,\n    result: Set<Key>\n  ) {\n    for (const node of nodes) {\n      if (node?.hasChildNodes) {\n        result.add(node.key);\n        this.recursivelyAddExpandableKeys(node.childNodes, result);\n      }\n    }\n    return result;\n  }\n}\nexport interface TreeProps<T>\n  extends CollectionStateBase<T, TreeCollection<T>>,\n    Expandable,\n    MultipleSelection,\n    CollectionCacheInvalidationProps {\n  childExpansionBehaviour?: \"multi\" | \"single\";\n}\n/**\n * Provides state management for tree-like components. Handles building a collection\n * of items from props, item expanded state, and manages multiple selection state.\n *\n * Similar to (and initially copied from) useTreeState from @react-stately/tree, but with the following changes:\n * - Supports exposing some imperative API via ref.\n *   Could be done via a wrapper too.\n * - Different onToggle implementation with two adjustments to match Intellij Platform:\n *   - Collapsing a key collapses all descendants as well.\n *   - Expanding a single-child node will recursively expand all single-child descendants.\n *   Couldn't be done with a wrapper in a clean and optimal way. Access to setExpandedKey is not provided. We would need\n *   to either maintain a new state for expanded keys and ignore the one returned from the wrapped hook, or\n *   inefficiently call the returned `toggleKey` function many times.\n * - Supports collection invalidation via CollectionCacheInvalidationProps\n *   Perhaps not the most important addition, but not possible to be done via a wrapper.\n * - Uses TreeSelectionManager instead of the default SelectionManager, which implements expand/shrink selection.\n *   Could be done in a wrapper, with a little hack. Would need to replace selection manager.\n * - returned `collection` is of type `TreeCollection` (which is an improved version of react-stately `TreeCollection`),\n *   instead of the more generic `Collection`.\n */\nexport function useTreeState<T extends object>(\n  { childExpansionBehaviour = \"multi\", ...props }: TreeProps<T>,\n  treeRef?: ForwardedRef<TreeRefValue>\n): TreeState<T> {\n  let [expandedKeys, setExpandedKeys] = useControlledState(\n    props.expandedKeys ? new Set(props.expandedKeys) : undefined!,\n    props.defaultExpandedKeys ? new Set(props.defaultExpandedKeys) : new Set(),\n    props.onExpandedChange!\n  );\n\n  let selectionState = useMultipleSelectionState({\n    ...props,\n    selectionBehavior: \"replace\",\n  });\n  let disabledKeys = useMemo(\n    () => (props.disabledKeys ? new Set(props.disabledKeys) : new Set<Key>()),\n    [props.disabledKeys]\n  );\n\n  const context = useCollectionCacheInvalidation(props);\n\n  let tree = useCollection<T, TreeCollection<T>>(\n    props,\n    useCallback(\n      (nodes) => new TreeCollection(nodes, { expandedKeys }),\n      [expandedKeys]\n    ),\n    context\n  );\n\n  const selectionManager = new TreeSelectionManager(\n    tree as Collection<Node<T>>,\n    selectionState\n  );\n\n  useTreeRef({ selectionManager, setExpandedKeys, tree }, treeRef);\n\n  // Reset focused key if that item is deleted from the collection.\n  useEffect(() => {\n    if (\n      selectionState.focusedKey != null &&\n      !tree.getItem(selectionState.focusedKey)\n    ) {\n      // @ts-expect-error imprecise typing in @react-stately/selection\n      selectionState.setFocusedKey(null);\n    }\n  }, [tree, selectionState.focusedKey]);\n\n  const toggleKey = (key: Key) => {\n    let newExpandedKeys = toggleTreeNode(\n      tree as Collection<Node<T>>,\n      expandedKeys,\n      key\n    );\n    if (childExpansionBehaviour === \"single\") {\n      const expandedSiblings = getSiblings(tree, key).filter(\n        (aKey) => aKey !== key && expandedKeys.has(aKey)\n      );\n      newExpandedKeys = expandedSiblings.reduce((expandedKeys, expandedKey) => {\n        return toggleTreeNode(\n          tree as Collection<Node<T>>,\n          expandedKeys,\n          expandedKey\n        );\n      }, newExpandedKeys);\n    }\n    setExpandedKeys(newExpandedKeys);\n  };\n\n  return {\n    collection: tree as Collection<Node<T>>,\n    expandedKeys,\n    disabledKeys,\n    toggleKey,\n    selectionManager,\n    setExpandedKeys,\n  };\n}\n\nfunction getChildItems<T>(node: Node<T>): Node<T>[] {\n  const childNodes = [...(node.childNodes || [])];\n  const childItems = childNodes.filter(({ type }) => type === \"item\");\n  const sectionItems = childNodes.filter(({ type }) => type === \"section\");\n\n  return childItems.concat(sectionItems.flatMap(getChildItems));\n}\n\nfunction getRootItemKeys(tree: TreeCollection<unknown>) {\n  return tree.rootKeys\n    .map((key) => tree.getItem(key))\n    .filter(notNull)\n    .flatMap(getChildItems)\n    .map(({ key }) => key);\n}\n/**\n * Returns the siblings of an item in tree, ignoring sections.\n * Disclaimer: The code is done quick and dirty and in a rush. Unpleasant code, good candidate for refactoring :D\n */\nfunction getSiblings(tree: TreeCollection<unknown>, key: Key): Key[] {\n  const parentKey = tree.getItem(key)?.parentKey;\n  if (!parentKey) {\n    return [...tree.rootKeys].concat(getRootItemKeys(tree));\n  }\n  let parent = parentKey ? tree.getItem(parentKey) : null;\n  if (parent?.type === \"item\") {\n    return getChildItems(parent).map(({ key }) => key);\n  }\n  const siblings: Key[] = [];\n  while (parent) {\n    siblings.push(...getChildItems(parent).map(({ key }) => key));\n    if (parent.type === \"section\") {\n      if (parent.parentKey) {\n        parent = tree.getItem(parent.parentKey);\n      } else {\n        siblings.push(...getRootItemKeys(tree));\n        parent = null;\n      }\n    } else {\n      parent = null;\n    }\n  }\n  return Array.from(new Set(siblings));\n}\nfunction toggleTreeNode(\n  tree: Collection<Node<unknown>>,\n  expandedKeys: Set<Key>,\n  key: Key\n): Set<Key> {\n  // toggling a non-expandable node should be no-op\n  if (!expandedKeys.has(key) && !tree.getItem(key)?.hasChildNodes) {\n    return expandedKeys;\n  }\n  const newKeys = toggleKey(expandedKeys, key);\n  // In Intellij impl, when a node is collapsed, all descendants are also collapsed. In other words, keys that are\n  // not a part of the list of visible nodes, will be excluded from the expanded keys, with the toggle action.\n  for (const aKey of newKeys) {\n    if (tree.getItem(aKey) == null) {\n      newKeys.delete(aKey);\n    }\n  }\n\n  // If we are toggling it open, expand all expandable single-child items\n  if (newKeys.has(key)) {\n    for (const aKey of getSingleChildrenKeys(tree.getItem(key))) {\n      newKeys.add(aKey);\n    }\n  }\n  return newKeys;\n}\n\nfunction toggleKey(set: Set<Key>, key: Key): Set<Key> {\n  let res = new Set(set);\n  if (res.has(key)) {\n    res.delete(key);\n  } else {\n    res.add(key);\n  }\n\n  return res;\n}\n","import { ForwardedRef, Key, useImperativeHandle } from \"react\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { TreeSelectionManager } from \"./TreeSelectionManager\";\nimport { TreeCollection } from \"./useTreeState\";\n\nexport interface TreeRefValue {\n  focus(key: Key): void;\n  replaceSelection(key: Key): void;\n\n  /**\n   * Extends selection to all siblings of the currently focused node.\n   */\n  expandSelection(): void;\n  /**\n   * Shrinks selection towards currently focused node.\n   */\n  shrinkSelection(): void;\n\n  expandAll(): void;\n  collapseAll(): void;\n}\n\n/**\n * Sets up a tree ref for imperatively working with tree from outside. For imperatively focusing, expanding to\n * specific key, etc.\n */\nexport function useTreeRef<T extends {}>(\n  props: {\n    tree: TreeCollection<T>;\n    selectionManager: TreeSelectionManager;\n    setExpandedKeys: (keys: Set<Key>) => void;\n  },\n  forwardedRef?: ForwardedRef<TreeRefValue>\n) {\n  const latestState = useLatest(props);\n\n  useImperativeHandle(\n    forwardedRef,\n    () => {\n      return {\n        replaceSelection: (key: Key) => {\n          latestState.current.selectionManager.replaceSelection(key);\n        },\n        focus: (key: Key) => {\n          const selectionManager = latestState.current.selectionManager;\n          selectionManager.setFocused(true);\n          /**\n           * NOTE: we set focus key to null and set it to key again, to make sure scroll into view works even when\n           * the key is currently focused but not in view. It wouldn't be needed if there was an imperative handle\n           * for scrolling an item into view, but it's only implemented in way that is reactive to changes to the\n           * focused key. {@see useCollectionAutoScroll}\n           */\n          selectionManager.setFocusedKey(null);\n          setTimeout(() => {\n            selectionManager.setFocusedKey(key);\n          });\n        },\n        expandSelection() {\n          latestState.current.selectionManager.expandSelection();\n        },\n        shrinkSelection() {\n          latestState.current.selectionManager.shrinkSelection();\n        },\n        expandAll() {\n          latestState.current.setExpandedKeys(\n            latestState.current.tree.getAllExpandableKeys()\n          );\n        },\n        collapseAll() {\n          const { tree, setExpandedKeys, selectionManager } =\n            latestState.current;\n          const focusedKey = selectionManager.focusedKey;\n          setExpandedKeys(new Set());\n\n          // Find the root node that is a grandparent of focused node, and focus/select it.\n          // NOTE: this behaviour of updating selection when nodes are collapsed is something to be fixed in general,\n          // and then this custom logic here would be not necessary.\n          if (focusedKey && !tree.rootKeys.includes(focusedKey)) {\n            let item = tree.getItem(focusedKey);\n            while (item?.parentKey != null) {\n              item = tree.getItem(item.parentKey);\n            }\n            if (item) {\n              selectionManager.setFocusedKey(item.key);\n              if (selectionManager.isSelected(focusedKey)) {\n                selectionManager.select(item.key);\n              }\n            }\n          }\n        },\n      };\n    },\n    []\n  );\n}\n","import { HTMLAttributes, useMemo } from \"react\";\nimport { LayoutNode } from \"@react-stately/layout\";\nimport { Node } from \"@react-types/shared\";\nimport { TreeState } from \"@react-stately/tree\";\nimport { VirtualizerProps } from \"@react-aria/virtualizer\";\nimport { LayoutInfo, Rect, Size } from \"@react-stately/virtualizer\";\nimport { VariableWidthListLayout } from \"@intellij-platform/core/VariableWidthListLayout\";\nimport { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nclass FlattenedTreeLayout<T> extends VariableWidthListLayout<T> {\n  buildChild(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildChild(node, x, y);\n    if (\n      node.parentKey &&\n      this.collection.getItem(node.parentKey)?.type === \"item\"\n    ) {\n      layoutNode.layoutInfo.parentKey = null;\n    }\n    return layoutNode;\n  }\n\n  doBuildCollection(): LayoutNode[] {\n    let y = this.padding;\n    let nodes = [];\n    /**\n     * The only difference here is that in tree, we need to use getKeys() to get the keys for a flattened list of items\n     * that are currently visible. With this difference only, things seem to work as expected, but sections are not\n     * tested, and not even sure if they would be applicable for Tree view.\n     * Diff compared to ListView#BuildCollection:\n     * -        for (let node of this.collection) {\n     * +        const visibleNodes = [...this.collection.getKeys()].map(key => this.collection.getItem(key));\n     * +        for (let node of visibleNodes) {\n     * This needs to be maintained with version upgrades, until TreeLayout is supported:\n     * https://github.com/adobe/react-spectrum/issues/2396\n     */\n    const visibleNodes = [...this.collection.getKeys()]\n      .map((key) => this.collection.getItem(key))\n      .filter(notNull);\n    for (let node of visibleNodes) {\n      let layoutNode = this.buildChild(node, 0, y);\n      y = layoutNode.layoutInfo.rect.maxY;\n      nodes.push(layoutNode);\n    }\n\n    if (this.isLoading) {\n      let rect = new Rect(\n        0,\n        y,\n        this.virtualizer.visibleRect.width,\n        this.loaderHeight ?? this.virtualizer.visibleRect.height\n      );\n      let loader = new LayoutInfo(\"loader\", \"loader\", rect);\n      this.layoutInfos.set(\"loader\", loader);\n      nodes.push({ layoutInfo: loader });\n      y = loader.rect.maxY;\n    }\n\n    if (nodes.length === 0) {\n      let rect = new Rect(\n        0,\n        y,\n        this.virtualizer.visibleRect.width,\n        this.placeholderHeight ?? this.virtualizer.visibleRect.height\n      );\n      let placeholder = new LayoutInfo(\"placeholder\", \"placeholder\", rect);\n      this.layoutInfos.set(\"placeholder\", placeholder);\n      nodes.push({ layoutInfo: placeholder });\n      y = placeholder.rect.maxY;\n    }\n\n    this.contentSize = new Size(\n      this.virtualizer.visibleRect.width,\n      y + this.padding\n    );\n    return nodes;\n  }\n\n  getVisibleLayoutInfos(rect: Rect): LayoutInfo[] {\n    return super\n      .getVisibleLayoutInfos(rect)\n      .filter((layoutInfo) => this.collection.getItem(layoutInfo.key) != null);\n  }\n}\n\nexport const useTreeVirtualizer = <T extends object>({\n  state,\n}: {\n  state: TreeState<T>;\n}): {\n  virtualizerProps: Omit<\n    VirtualizerProps<any, unknown>,\n    \"children\" | keyof HTMLAttributes<HTMLElement>\n  >;\n} => {\n  const layout = useMemo(\n    () =>\n      new FlattenedTreeLayout({\n        /**\n         * there is currently no documentation available for these fields, but setting `rowHeight` enforces it, which\n         * wouldn't be good for custom tree UI with a different row height.\n         * wrong estimatedRowHeight seems to only affect small scrollbar position inaccuracy, which is a minor issue\n         * and not even noticeable in most cases. Also, it seems it slightly improves the performance if it exactly\n         * matches the real row height. But not even sure.\n         */\n        estimatedRowHeight: 20,\n      }),\n    []\n  );\n  layout.collection = state.collection;\n  layout.disabledKeys = state.disabledKeys;\n\n  return {\n    virtualizerProps: {\n      focusedKey: state.selectionManager.focusedKey,\n      collection: state.collection,\n      layout,\n      // Not clear how this sizeToFit is supposed to work, due to lack of documentation, but don't be tempted to\n      // think it solves the problem VariableWidthListLayout is trying to solve, because it doesn't :D\n      // Also, note that setting this to \"width\" prevents re-layout when container width is increased, which\n      // causes issues.\n      sizeToFit: \"height\",\n      scrollToItem: (key) => {\n        return layout.virtualizer.scrollToItem(key, {\n          shouldScrollX: false,\n          duration: 0,\n        });\n      },\n      scrollDirection: \"both\",\n    },\n  };\n};\n","import React, { RefObject } from \"react\";\nimport {\n  ActionDefinition,\n  CommonActionId,\n} from \"@intellij-platform/core/ActionSystem\";\nimport { PlatformIcon } from \"@intellij-platform/core/Icon\";\nimport { TreeRefValue } from \"@intellij-platform/core/Tree\";\n\n/**\n * Returns action definitions object for common tree actions\n * TODO: add example in docs\n */\nexport function useTreeActions({\n  treeRef,\n}: {\n  treeRef: RefObject<TreeRefValue>;\n}): Array<ActionDefinition> {\n  return [\n    {\n      id: CommonActionId.EXPAND_ALL,\n      title: \"Expand All\",\n      icon: <PlatformIcon icon=\"actions/expandall\" />,\n      actionPerformed: () => {\n        treeRef.current?.expandAll();\n      },\n    },\n    {\n      id: CommonActionId.COLLAPSE_ALL,\n      title: \"Collapse All\",\n      icon: <PlatformIcon icon=\"actions/collapseall\" />,\n      actionPerformed: () => {\n        treeRef.current?.collapseAll();\n      },\n    },\n    {\n      id: CommonActionId.EXPAND_SELECTION,\n      title: \"Expand Selection\",\n      actionPerformed: () => {\n        treeRef.current?.expandSelection();\n      },\n    },\n    {\n      id: CommonActionId.SHRINK_SELECTION,\n      title: \"Shrink Selection\",\n      // TODO: disable if selection is only one item. Would need more data from treeRef. Maybe after treeRef is refactored\n      //  to implement/extend CollectionRef\n      actionPerformed: () => {\n        treeRef.current?.shrinkSelection();\n      },\n    },\n  ];\n}\n","import { Key } from \"react\";\n\ninterface SetState<T> {\n  items: Iterable<T>;\n\n  toggle(key: T): void;\n\n  add(...key: T[]): void;\n\n  delete(...key: T[]): void;\n}\n\nexport type SelectionState = \"NotSelected\" | \"Selected\" | \"PartiallySelected\";\n\nexport interface TreeModel<T, K = Key> {\n  rootNodes: ReadonlyArray<T>;\n  getChildren: (root: T) => ReadonlyArray<T> | /*for convenience*/ T | null;\n  getKey: (item: T) => K;\n}\n\nexport interface NestedSelectionState<T> {\n  getSelectionState: (item: T) => SelectionState;\n  toggle: (item: T) => void;\n}\n\nconst collectSelectableItems = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>\n) => {\n  const collectedItems: T[] = [];\n  collectSelectableItemsRecursive(item, getChildren, collectedItems);\n  return collectedItems;\n};\nconst collectSelectableItemsRecursive = <T>(\n  item: T,\n  getChildren: (item: T) => null | ReadonlyArray<T>,\n  collectedItems: T[] = []\n) => {\n  const children = getChildren(item);\n  if (children == null) {\n    collectedItems.push(item);\n  } else {\n    children.forEach((child) =>\n      collectSelectableItemsRecursive(child, getChildren, collectedItems)\n    );\n  }\n};\n\n// TODO: maybe change the interface to work with keys instead of items?\nexport class NestedSelection<T extends object, K = Key>\n  implements NestedSelectionState<T>\n{\n  cache = new WeakMap<T, SelectionState>();\n  constructor(private state: SetState<K>, private tree: TreeModel<T, K>) {\n    this.tree = tree;\n    this.state = state;\n  }\n\n  toggle(item: T) {\n    const children = this.tree.getChildren(item);\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    if (isSelectableNode) {\n      this.state.toggle(key);\n    } else {\n      const state = this.getSelectionState(item);\n      const itemsInSubtree = collectSelectableItems(item, (item) =>\n        normalizeChildren(this.tree.getChildren(item))\n      ).map(this.tree.getKey);\n      if (state === \"Selected\") {\n        this.state.delete(...itemsInSubtree);\n      } else {\n        this.state.add(...itemsInSubtree);\n      }\n    }\n  }\n\n  getSelectionState(item: T): SelectionState {\n    // caching can be refactored into a nice little decorator like WeakMapCached which would be applicable on a method\n    // with a single object argument.\n    const cachedState = this.cache.get(item);\n    if (cachedState) {\n      return cachedState;\n    }\n    const children = normalizeChildren(this.tree.getChildren(item));\n    const key = this.tree.getKey(item);\n    const isSelectableNode = children == null;\n    let state: SelectionState;\n    if (isSelectableNode) {\n      state = [...this.state.items].includes(key) ? \"Selected\" : \"NotSelected\";\n    } else {\n      const allDescendantsStates = children.map((child) =>\n        this.getSelectionState(child)\n      );\n      if (allDescendantsStates.every((state) => state === \"NotSelected\")) {\n        state = \"NotSelected\";\n      } else {\n        state = allDescendantsStates.every((state) => state === \"Selected\")\n          ? \"Selected\"\n          : \"PartiallySelected\";\n      }\n    }\n    this.cache.set(item, state);\n    return state;\n  }\n}\n\nfunction normalizeChildren<T>(children: T | ReadonlyArray<T> | null) {\n  if (children) {\n    return ([] as ReadonlyArray<T>).concat(children);\n  }\n  return null;\n}\n","import React, { ForwardedRef } from \"react\";\nimport {\n  SpeedSearchTree,\n  SpeedSearchTreeProps,\n  TreeRefValue,\n} from \"@intellij-platform/core/Tree\";\nimport { NestedSelectionState } from \"./NestedSelection\";\n\n/**\n * Experimental wrapper component around SpeedSearchTree, which allows rendering {@link TreeNodeCheckbox} in nodes.\n *\n * See [design-decisions.md](../Tree/design-decisions.md) for more thoughts about how should different features\n * like this be supported.\n *\n * @alpha\n */\nexport const SpeedSearchTreeWithCheckboxes = React.forwardRef(\n  <T extends object>(\n    {\n      nestedSelection,\n      cacheInvalidation,\n      onNodeKeyDown,\n      ...props\n    }: SpeedSearchTreeProps<T> & {\n      nestedSelection: NestedSelectionState<T>;\n    },\n    ref: ForwardedRef<HTMLDivElement>\n  ): React.ReactElement => {\n    const otherInvalidators =\n      typeof cacheInvalidation === \"object\"\n        ? cacheInvalidation.invalidators\n        : [];\n    return (\n      <SpeedSearchTree\n        ref={ref}\n        {...props}\n        // instead of passing cacheInvalidation, a better approach could be to provide nestedSelection as context.\n        cacheInvalidation={{\n          invalidators: [nestedSelection, ...otherInvalidators],\n        }}\n        onNodeKeyDown={(event, item) => {\n          if (event.key === \" \" && item.value) {\n            nestedSelection.toggle(item.value);\n          }\n          onNodeKeyDown?.(event, item);\n        }}\n      />\n    );\n  }\n);\n","import React, { useContext } from \"react\";\nimport { Checkbox } from \"@intellij-platform/core/Checkbox\";\nimport { TreeContext } from \"@intellij-platform/core/Tree/TreeContext\";\nimport { SelectionState } from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\nimport { ItemStateContext } from \"@intellij-platform/core/Collections\";\nimport styled from \"styled-components\";\n\nexport type TreeNodeCheckboxProps<T extends unknown> = {\n  selectionState?: SelectionState;\n  selectItemOnPress?: boolean;\n  onToggle: () => void;\n  // maybe a isDisabled prop to be merged with isDisabled from the item?\n};\n\nconst StyledCheckboxWrapper = styled.span`\n  margin-right: 0.125rem;\n  display: inline-flex;\n`;\n\n/**\n * Checkbox to be used with {@link SpeedSearchTreeWithCheckboxes}. `SpeedSearchTreeWithCheckboxes` doesn't add the\n * checkboxes by default to the nodes, which makes it more flexible in terms of which nodes should have checkbox, or\n * it's exact placement within the tree rows.\n *\n * TreeNodeCheckbox renders a Checkbox with a few extras:\n * - `aria-label` set based on the encompassing item's textValue\n * - `isSelected` and `isIndeterminate` set based on `selectionState`\n * - `isDisabled` is set based in disabled state of the item.\n * - The encompassing item will be selected upon press, if `selectItemOnPress` is `true` (default is `true`).\n * - Small styling adjustment achieved by a wrapper StyledListIconWrapper.\n *\n * @see SpeedSearchTreeWithCheckboxes\n * @see useNestedSelectionState\n *\n * NOTE: this component currently uses TreeContext, to get a hold of selectionManager. If a more abstract component\n * like CollectionCheckbox is needed in the future, we can refactor TreeContext also to something more abstract like\n * CollectionContext which is provided by all such components like List, Tree or Table.\n */\nexport const TreeNodeCheckbox = <T extends unknown>({\n  selectionState,\n  onToggle,\n  selectItemOnPress = true,\n}: TreeNodeCheckboxProps<T>) => {\n  const treeContext = useContext(TreeContext);\n  const itemContext = useContext(ItemStateContext);\n  if (!itemContext) {\n    throw new Error(\"TreeNodeCheckbox is rendered outside tree nodes.\");\n  }\n\n  return (\n    <StyledCheckboxWrapper>\n      <Checkbox\n        preventFocus\n        aria-label={`Select ${itemContext.node.textValue}`}\n        isSelected={selectionState === \"Selected\"}\n        isIndeterminate={selectionState === \"PartiallySelected\"}\n        isDisabled={itemContext.isDisabled}\n        onChange={() => {\n          onToggle();\n          // this if and the whole need for treeContext could be avoided if event.stopPropagation() was not hard coded\n          // in useToggle: https://github.com/adobe/react-spectrum/blob/0d007bca9417c4b7b86fafd5842871bf997bd4c0/packages/@react-aria/toggle/src/useToggle.ts#L46\n          // An improvement could be to replace Checkbox with CheckboxIcon, and simply handle press on it (potential TODO)\n          if (treeContext && itemContext && selectItemOnPress) {\n            treeContext.state.selectionManager.setFocusedKey(\n              itemContext.node.key\n            );\n            treeContext.state.selectionManager.setFocused(true);\n            treeContext.state.selectionManager.setSelectedKeys([\n              itemContext.node.key,\n            ]);\n          }\n        }}\n      />\n    </StyledCheckboxWrapper>\n  );\n};\n","import { Key, useMemo } from \"react\";\nimport { ControlledStateProps } from \"../type-utils\";\nimport { useLatest } from \"@intellij-platform/core/utils/useLatest\";\nimport { useControllableSet } from \"@intellij-platform/core/utils/useSet\";\nimport {\n  NestedSelection,\n  NestedSelectionState,\n  TreeModel,\n} from \"@intellij-platform/core/TreeCheckboxes/NestedSelection\";\n\n/**\n * A state management util for a selectable list of items with an arbitrary nested grouping. In other words,\n * it manages selection of leaves in a tree.\n *\n * tree is represented as a `getChildren` function that returns children for a given root. if null is passed it\n * returns the top level nodes.\n * Important Note: the tree structure that can be generated by calling `getChildren` function is supposed to be\n * **immutable**. in other words, any change in the tree, should result in a new array of top level items.\n */\n\nexport const useNestedSelectionState = <T extends object, K = Key>(\n  tree: TreeModel<T, K>,\n  {\n    selectedKeys: selectedKeysProp,\n    defaultSelectedKeys,\n    onSelectedKeysChange,\n  }: ControlledStateProps<{\n    selectedKeys: Set<K>;\n  }>\n): NestedSelectionState<T> => {\n  const [selectedKeys, selectedKeysSetter] = useControllableSet(\n    selectedKeysProp!, // bad typing in useControlledState\n    defaultSelectedKeys || new Set(),\n    onSelectedKeysChange! // bad typing in useControlledState\n  );\n  const treeRef = useLatest(tree);\n\n  return useMemo(\n    () =>\n      new NestedSelection<T, K>(\n        { items: selectedKeys, ...selectedKeysSetter },\n        treeRef.current\n      ),\n    [selectedKeys, tree.rootNodes]\n  );\n};\n","import {\n  LayoutNode,\n  ListLayout,\n  ListLayoutOptions,\n} from \"@react-stately/layout\";\nimport React, { Key } from \"react\";\nimport {\n  InvalidationContext,\n  LayoutInfo,\n  Rect,\n  Size,\n} from \"@react-stately/virtualizer\";\nimport { Node } from \"@react-types/shared\";\n\n/**\n * Extends `ListLayout` and allows items of the list to have width based on the content. `ListLayout` by default\n * sets width based on the virtualizer's visible rect. This means the overflow of list items will be clipped.\n * In `VariableWidthListLayout`, the width of the list depends on the content of the visible items.\n *\n * NOTE: At the time of writing this class, Virtualization in @react-aria and @react-stately don't have proper\n * documentation, and it wasn't clear if there could be better ways of letting list's width grow based on the content.\n * Also, this implementation currently lacks support for sections. `buildSection()` would most probably need to be\n * overridden like how `buildItem` is.\n */\nexport class VariableWidthListLayout<T> extends ListLayout<T> {\n  /**\n   * content width of items are stored here, if the content width is bigger than the Virtualizer's visible rect's width.\n   */\n  keyToWidth = new Map<Key, number>();\n  private visibleContentWidth: number = 0;\n  private dividerHeight: number = 2;\n\n  constructor(options: ListLayoutOptions<T> & { dividerHeight?: number }) {\n    super(options);\n    if (options.dividerHeight != undefined) {\n      this.dividerHeight = options.dividerHeight;\n    }\n  }\n\n  buildItem(node: Node<T>, x: number, y: number): LayoutNode {\n    const layoutNode = super.buildItem(node, x, y);\n    if (this.visibleContentWidth) {\n      layoutNode.layoutInfo.rect.width = this.visibleContentWidth;\n    }\n    return layoutNode;\n  }\n\n  buildNode(node: Node<T>, x: number, y: number): LayoutNode {\n    if (node.type === \"divider\") {\n      return this.buildDivider(node, x, y);\n    }\n    return super.buildNode(node, x, y);\n  }\n\n  buildDivider(node: Node<T>, x: number, y: number): LayoutNode {\n    let width = this.virtualizer.visibleRect.width;\n    let rectHeight = this.dividerHeight;\n\n    let rect = new Rect(x, y, width - x, rectHeight);\n    let layoutInfo = new LayoutInfo(node.type, node.key, rect);\n    layoutInfo.estimatedSize = false;\n    return {\n      layoutInfo,\n      // validRect: layoutInfo.rect,\n    };\n  }\n\n  /**\n   * Allows for overriding buildCollection in a sub-class\n   */\n  protected doBuildCollection() {\n    return super.buildCollection();\n  }\n\n  buildCollection(): LayoutNode[] {\n    this.visibleContentWidth = this.getVisibleContentWidth();\n    // in buildChild, if invalidateEverything is false and y is not changed, it will reuse the existing layoutInfo.\n    // which can be problematic, if it was created in a time when the visible content width was different.\n    // A more efficient approach (instead of rebuilding the whole collection), might be to set layout width to\n    // visibleContentWidth, in getVisibleLayoutInfos, if mutation is ok.\n    // UPDATE: using getFinalLayoutInfo seems to be a legitimate last minute way to mutate layout infos.\n    this.invalidateEverything =\n      this.contentSize?.width !== this.visibleContentWidth;\n    const layoutNodes = this.doBuildCollection();\n    this.contentSize.width = this.visibleContentWidth;\n    return layoutNodes;\n  }\n\n  shouldInvalidate(newRect: Rect, oldRect: Rect): boolean {\n    return (\n      super.shouldInvalidate(newRect, oldRect) ||\n      this.getVisibleContentWidth() !== this.visibleContentWidth\n    );\n  }\n\n  // Setting lastWidth doesn't seem to be important, but we set it based on the content anyway.\n  validate(invalidationContext: InvalidationContext<Node<T>, unknown>) {\n    super.validate(invalidationContext);\n    this.lastWidth = this.contentSize.width;\n  }\n\n  updateItemSize(key: React.Key, size: Size): boolean {\n    const changed = super.updateItemSize(key, size);\n    const layoutInfo = this.layoutInfos.get(key);\n    if (layoutInfo && size.width > this.contentSize.width) {\n      this.keyToWidth.set(key, size.width);\n      return true;\n    } else {\n      this.keyToWidth.delete(key);\n      return changed;\n    }\n  }\n\n  private getVisibleContentWidth() {\n    return Math.max(\n      this.virtualizer.visibleRect.width,\n      ...this.virtualizer.visibleViews.map((view) => {\n        const layoutInfo = view.layoutInfo;\n        const itemContentWidth =\n          layoutInfo && this.keyToWidth.get(layoutInfo.key);\n        if (\n          itemContentWidth &&\n          layoutInfo.rect.intersects(this.virtualizer.getVisibleRect())\n        ) {\n          return itemContentWidth;\n        }\n        return 0;\n      })\n    );\n  }\n}\n","export function isWordSeparator(c: string) {\n  return (\n    isWhitespace(c) || c == \"_\" || c == \"-\" || c == \":\" || c == \"+\" || c == \".\"\n  );\n}\n\nexport function isWhitespace(char: string): boolean {\n  return /^\\s*$/.test(char);\n}\n\nexport function isUpperCase(str: string) {\n  return str.toUpperCase() === str && str.toLowerCase() !== str;\n}\n","import { createRangesFromIndices, TextRange } from \"./TextRange\";\nimport {\n  isUpperCase,\n  isWhitespace,\n  isWordSeparator,\n} from \"./utils/string-utils\";\n\nfunction isMeaningfulChar(ch: string) {\n  return !isWordSeparator(ch) && !isWhitespace(ch);\n}\n\n// Simplified version of https://github.com/JetBrains/intellij-community/blob/master/platform/util/text-matching/src/com/intellij/psi/codeStyle/MinusculeMatcherImpl.java\nexport const minusculeMatch = (\n  input: string,\n  rawPattern: string\n): Array<TextRange> | null => {\n  const isStarts = input.split(\"\").map(isStart);\n  const pattern = rawPattern.split(\"\").filter(isMeaningfulChar).join(\"\");\n  const matches: Array<{ patternIndex: number; inputIndex: number }> = [];\n  let continuous = false;\n  let inputIndex = 0,\n    patternIndex = 0;\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    if (matches.length === pattern.length) {\n      return createRangesFromIndices(matches.map(({ inputIndex: i }) => i));\n    }\n    if (inputIndex > input.length - 1) {\n      if (matches.length > 0) {\n        // TODO: the same character match can be popped out and in several times, if something\n        //  is popped out, it should never be added back again, since it's already examined without\n        //  a full match.\n        const lastMatch = matches.pop()!;\n        inputIndex = lastMatch.inputIndex + 1;\n        patternIndex = lastMatch.patternIndex;\n        continue;\n      }\n      break;\n    }\n    if (!isMeaningfulChar(input[inputIndex])) {\n      inputIndex++;\n      continue;\n    }\n    if (\n      pattern[patternIndex].toLowerCase() === input[inputIndex].toLowerCase() &&\n      (continuous || isStarts[inputIndex] || matches.length === 0)\n    ) {\n      matches.push({ patternIndex, inputIndex });\n      continuous = true;\n      patternIndex++;\n      inputIndex++;\n    } else {\n      continuous = false;\n      inputIndex++;\n    }\n  }\n  return null;\n};\n\nfunction isStart(char: string, index: number, chars: string[]): boolean {\n  const previousChar = chars[index - 1];\n  return (\n    index === 0 ||\n    (isWordSeparator(previousChar) && !isWordSeparator(char)) ||\n    (isUpperCase(char) && !isUpperCase(previousChar))\n  );\n}\n","import { useEffect } from \"react\";\nimport { useSelectableCollection as useAriaSelectableCollection } from \"@react-aria/selection\";\n\n/**\n * Wrapper around react-aria useSelectableCollection to fix pending issues or\n * add missing functionality.\n */\nexport const useSelectableCollection: typeof useAriaSelectableCollection = (\n  options\n) => {\n  const {\n    collectionProps: { onKeyDown, ...collectionProps },\n  } = useAriaSelectableCollection(options);\n  useEffect(() => {\n    // Fixing https://github.com/adobe/react-spectrum/issues/4391\n    const { selectionManager, autoFocus, selectOnFocus } = options;\n    if (\n      selectOnFocus &&\n      (autoFocus === \"first\" || autoFocus === \"last\") &&\n      selectionManager.focusedKey != null\n    ) {\n      selectionManager.replaceSelection(selectionManager.focusedKey);\n    }\n\n    // Working around https://github.com/adobe/react-spectrum/issues/7512\n    // FIXME: remove the workaround the issue is closed\n    if (\n      selectionManager.firstSelectedKey &&\n      selectionManager.focusedKey == null\n    ) {\n      // initialize the focusedKey so that the buggy code that mutates selection\n      // onFocus doesn't get to run.\n      selectionManager.setFocusedKey(selectionManager.firstSelectedKey);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return {\n    collectionProps: {\n      ...collectionProps,\n      onKeyDown: (e) => {\n        // keydown events used to not be handled when alt key is pressed.\n        // it's changed in https://github.com/adobe/react-spectrum/commit/885b5e6b84253925b2ac9f7f2766417c63b654b5#diff-e356ae602508922357fd9cd1aa7896f74e24f87bcb2ee86a7bb4a486ea87a2f2R120\n        // handling keydown events when alt is down interferes with tree action shortcuts\n        // FIXME: make tree actions use capture phase to handle shortcuts so it takes precedence over\n        //  the default handlers regardless of what the shortcut is. Revert the patch here, after.\n        //  At the time of writing this, `useCapture` is only an option on ActionsProvider, but it\n        //  needs to be an option on each action, to allow for this use case.\n        if (!e.altKey) {\n          onKeyDown?.(e);\n        }\n      },\n    },\n  };\n};\n","import { useSelectableItem as useOriginalSelectableItem } from \"@react-aria/selection\";\nimport { MouseEventHandler } from \"react\";\nimport { mergeProps } from \"@react-aria/utils\";\n\n/**\n * A wrapper around useSelectableItem, which adjusts for intellij platform nuances:\n * - Selects item with right clicks as well, which allows ContextMenuContainer to be used with any collection component\n *   without the need for built-in context-menu support in such components. We won't need this if we move to a built-in\n *   context-menu support for List,Tree, etc.\n * @private\n */\nexport const useSelectableItem: typeof useOriginalSelectableItem = (\n  options\n) => {\n  const onContextMenu: MouseEventHandler<HTMLElement> = (e) => {\n    if (!options.selectionManager.isSelected(options.key)) {\n      options.selectionManager.select(options.key);\n    }\n  };\n  const result = useOriginalSelectableItem(options);\n  return {\n    ...result,\n    itemProps: mergeProps(result.itemProps, { onContextMenu }),\n  };\n};\n","/**\n * Drop shadow of windows and other overlays.\n * The current value is not accurate and needs to be revisited. It should also be os-dependant.\n * FIXME: On windows, there is only a border-like shadow. No drop shadow\n * FIXME: On Mac, there is a border-like shadow and a drop shadow. the border-like shadow is missing in the current value\n */\nexport const WINDOW_SHADOW = \"box-shadow: 0 5px 15px rgb(0 0 0 / 30%)\";\n","import {\n  FocusManager,\n  FocusScope as WrappedFocusScope,\n  FocusScopeProps,\n  useFocusManager,\n} from \"@react-aria/focus\";\nimport React, { ForwardedRef, useImperativeHandle, useRef } from \"react\";\n\nexport type FocusScopeRef = { focus: (forceFocusFirst?: boolean) => void };\n/**\n * A version of FocusScope which also allows for imperatively moving focus to the scope.\n * and has tiny patches/improvements\n * It's useful for\n */\nexport const FocusScope = React.forwardRef(function BetterFocusScope(\n  { children, ...otherProps }: FocusScopeProps,\n  ref: ForwardedRef<FocusScopeRef>\n) {\n  const directChildRef = useRef<HTMLSpanElement>(null);\n  const focusManagerRef = useRef<FocusManager>(null);\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus: (forceFocusFirst?: boolean) => {\n        const focusManager = focusManagerRef.current;\n        const containerElement = directChildRef.current?.parentElement;\n        if (!focusManager) {\n          throw new Error(\"focus manager not found!\");\n        }\n        if (!containerElement) {\n          throw new Error(\"container element not found\");\n        }\n        if (forceFocusFirst) {\n          return focusManager.focusFirst();\n        }\n        const alreadyHasFocused =\n          document.activeElement &&\n          document.activeElement !== containerElement &&\n          containerElement.contains(document.activeElement);\n        if (!alreadyHasFocused) {\n          focusManager.focusNext({ tabbable: true });\n        }\n      },\n    }),\n    []\n  );\n\n  return (\n    <WrappedFocusScope {...otherProps}>\n      <GetFocusManager ref={focusManagerRef} />\n      <span data-focus-root-direct-child=\"\" hidden ref={directChildRef} />\n      {children}\n    </WrappedFocusScope>\n  );\n});\nconst GetFocusManager = React.forwardRef(function FocusScopeHandle(\n  props: {},\n  ref: ForwardedRef<FocusManager>\n) {\n  const focusManager = useFocusManager()!;\n  useImperativeHandle(ref, () => focusManager, [focusManager]);\n  return null;\n});\n","/**\n * Properly typed filter function for filtering out null/undefined items in array.\n */\nexport const notNull = <T>(\n  item: T | undefined | null\n): item is NonNullable<T> => item != null;\n","/**\n * IMPORTANT: this is a copy of a non-exported file from @react-aria/interactions\n */\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { runAfterTransition } from \"@react-aria/utils\";\n\n// Safari on iOS starts selecting text on long press. The only way to avoid this, it seems,\n// is to add user-select: none to the entire page. Adding it to the pressable element prevents\n// that element from being selected, but nearby elements may still receive selection. We add\n// user-select: none on touch start, and remove it again on touch end to prevent this.\n// This must be implemented using global state to avoid race conditions between multiple elements.\n\n// There are three possible states due to the delay before removing user-select: none after\n// pointer up. The 'default' state always transitions to the 'disabled' state, which transitions\n// to 'restoring'. The 'restoring' state can either transition back to 'disabled' or 'default'.\ntype State = \"default\" | \"disabled\" | \"restoring\";\n\nlet state: State = \"default\";\nlet savedUserSelect = \"\";\n\nexport function disableTextSelection() {\n  if (state === \"default\") {\n    savedUserSelect = document.documentElement.style.webkitUserSelect;\n    document.documentElement.style.webkitUserSelect = \"none\";\n  }\n\n  state = \"disabled\";\n}\n\nexport function restoreTextSelection() {\n  // If the state is already default, there's nothing to do.\n  // If it is restoring, then there's no need to queue a second restore.\n  if (state !== \"disabled\") {\n    return;\n  }\n\n  state = \"restoring\";\n\n  // There appears to be a delay on iOS where selection still might occur\n  // after pointer up, so wait a bit before removing user-select.\n  setTimeout(() => {\n    // Wait for any CSS transitions to complete so we don't recompute style\n    // for the whole page in the middle of the animation and cause jank.\n    runAfterTransition(() => {\n      // Avoid race conditions\n      if (state === \"restoring\") {\n        if (document.documentElement.style.webkitUserSelect === \"none\") {\n          document.documentElement.style.webkitUserSelect =\n            savedUserSelect || \"\";\n        }\n\n        savedUserSelect = \"\";\n        state = \"default\";\n      }\n    });\n  }, 300);\n}\n","import React, { MouseEventHandler } from \"react\";\nimport { disableTextSelection, restoreTextSelection } from \"./textSelection\";\nimport { useLatest } from \"../useLatest\";\n\n/**\n * To be used with {@link UseMoveOptions#canMoveStart} to allow\n * the move to start only on whitespaces. Does that by checking if the\n * element is an HTMLElement with all children being Elements.\n * This logic almost always detects the whitespaces properly, because if mouse\n * was pressed on a piece of text, the event target would have been that element.\n */\nexport function isEventOnEmptySpaces({\n  target,\n  currentTarget,\n}: React.MouseEvent) {\n  return (\n    currentTarget === target ||\n    (target instanceof HTMLElement &&\n      [...target.childNodes].every((child) => child instanceof HTMLElement))\n  );\n}\n\nexport type XY = { x: number; y: number };\nexport type UseMoveOptions<S> = {\n  /**\n   * the amount of movement (in pixels) after which the move should start. It prevents interference\n   * with simple click (or more generally, press) events, and provides better UX.\n   * @default 0\n   */\n  dragThreshold?: number;\n  disabled?: boolean;\n  /**\n   * Whether the move should be initiated from a mouse down event.\n   * Note: regardless of the value of this option, the move won't start when interactive elements like buttons\n   * are being pressed.\n   * @see isEventOnEmptySpaces\n   * @example\n   * ```ts\n   * // Don't move when children are being dragged.\n   * useMove({ canMoveStart: e => e.target === e.currentTarget });\n   * ```\n   *\n   * @example\n   * ```ts\n   * // move when empty spaces are being dragged.\n   * useMove({ canMoveStart: isEventOnEmptySpaces });\n   * ```\n   */\n  canMoveStart?: (eventTarget: React.MouseEvent) => boolean;\n  onMoveStart: (args: { from: XY }) => S;\n  onMove: (args: { from: XY; to: XY; movement: XY; startState: S }) => void;\n  onMoveEnd?: (args: { startState: S }) => void;\n};\n\n// TODO: cleanup if unmount happens during drag.\n// TODO: Better even handling for touch devices?\n//  wrapping `useMove` from react-aria to just add support for movement threshold should be the\n//  way to go, but there are a few problems:\n//    - it seemed a little buggy in the example here: https://react-spectrum.adobe.com/react-aria/useMove.html\n//    - the API is not great in a sense that it only gives the diff in last movement.\n//      Also onMoveStart doesn't give the initial position, so it's not possible to even calculate\n//\n// TODO: move should be finished by pressing Escape. onMoveCancel maybe?\n/**\n * Similar to https://react-spectrum.adobe.com/react-aria/useMove.html, with slightly different\n * features and API.\n * NOTE: initially the API was designed in a way that onMove and onMove end callbacks were\n * returned from onMoveStart, instead of being directly passed in the options.\n * This would enable capturing the initial state of each move transaction, by defining whatever\n * variable in onMoveStart and closing over them by onMove and onMoveEnd.\n * The problem with this approach was that although you could capture the initial state of the\n * movement, by closure, any other variable in the outer scopes was also closed over, and you were\n * stuck with the values from the particular render in which the movement was started.\n * Of course, you could work around it by using refs, but it would be unintuitive.\n * So because of that issue, it's redesigned to have onMoveStart, onMove, and onMoveEnd all\n * directly passed as options, but you can return anything from `onMoveStart` which will be passed\n * to onMove and onMoveEnd as `startState`.\n */\nexport function useMove<S>({\n  dragThreshold = 0,\n  disabled,\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  canMoveStart = () => true,\n}: UseMoveOptions<S>): { onMouseDown?: MouseEventHandler } {\n  const handlersRef = useLatest({ onMove, onMoveEnd });\n\n  const onMouseDown = (event: React.MouseEvent) => {\n    if (event.button !== 0 || !canMoveStart(event)) {\n      return;\n    }\n    disableTextSelection();\n    const from = { x: event.pageX, y: event.pageY };\n    let dragStarted = false;\n    let startState: S;\n\n    const onMouseMove = (event: MouseEvent) => {\n      const { pageX: x, pageY: y } = event;\n      const movement = { x: x - from.x, y: y - from.y };\n      const isDraggedEnough =\n        Math.abs(movement.x) >= dragThreshold ||\n        Math.abs(movement.y) >= dragThreshold;\n      if (isDraggedEnough && !dragStarted) {\n        dragStarted = true;\n        startState = onMoveStart({ from });\n      }\n      if (dragStarted) {\n        handlersRef.current.onMove({\n          from,\n          to: { x: from.x + movement.x, y: from.y + movement.y },\n          movement,\n          startState,\n        });\n      }\n    };\n    document.addEventListener(\"mousemove\", onMouseMove);\n\n    document.addEventListener(\n      \"mouseup\",\n      () => {\n        restoreTextSelection();\n        if (dragStarted) {\n          handlersRef.current.onMoveEnd?.({ startState });\n        }\n        document.removeEventListener(\"mousemove\", onMouseMove);\n      },\n      { once: true }\n    );\n  };\n  return disabled ? {} : { onMouseDown };\n}\n","import React from \"react\";\nimport { isMac } from \"@react-aria/utils\";\n\n/**\n * TODO: The current name is not accurate, and can be confusing. Rename to something better.\n */\nexport function isCtrlKeyPressed(\n  e: { metaKey: boolean; ctrlKey: boolean } | undefined\n) {\n  if (isMac()) {\n    return e?.metaKey;\n  }\n\n  return e?.ctrlKey;\n}\n\nexport function hasAnyModifier(e: KeyboardEvent | React.KeyboardEvent) {\n  return e.altKey || e.ctrlKey || e.metaKey || e.shiftKey;\n}\n","import { notNull } from \"@intellij-platform/core/utils/array-utils\";\n\nexport interface OverflowObserverRecord {\n  target: Element;\n  overflowedElements: Element[];\n  previouslyOverflowedElements: Element[];\n}\n\nexport type OverflowObserverCallback = (\n  change: OverflowObserverRecord,\n  observer: OverflowObserver\n) => void;\n\n/**\n * Allows observing the list of overflowing children of a given target element.\n * An `IntersectionObserver` is created for each target to observe the intersection between the target and each child\n * element. The child elements are observed/unobserved by the intersection observer as they are added/removed to the\n * DOM, which is observed using a `MutationObserver`.\n * `IntersectionObserver` options such as `rootMargin` are supported, to fine tune what should be considered as\n * overflowed.\n *\n * TODO: add a takeRecords method to allow processing pending mutations before disconnect\n * TODO: maybe add direction option?\n *\n */\nexport class OverflowObserver {\n  private mutationObserver: MutationObserver;\n  private data: Map<\n    Element,\n    {\n      intersectionObserver: IntersectionObserver;\n      currentOverflowElements: Element[];\n    }\n  > = new Map();\n\n  constructor(private callback: OverflowObserverCallback) {\n    this.mutationObserver = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        const target = mutation.target;\n        if (!(target instanceof Element)) {\n          return;\n        }\n        mutation.removedNodes.forEach((node) => {\n          if (node instanceof Element) {\n            this.data.get(target)?.intersectionObserver.unobserve(node);\n          }\n        });\n        mutation.addedNodes.forEach((node) => {\n          if (node instanceof Element) {\n            this.data.get(target)?.intersectionObserver.observe(node);\n          }\n        });\n      });\n    });\n  }\n\n  observe(target: Element, options: Omit<IntersectionObserverInit, \"root\">) {\n    this.data.get(target)?.intersectionObserver.disconnect();\n\n    const intersectionObserver = new IntersectionObserver(\n      (entries) => {\n        const data = this.data.get(target);\n        const newHiddenElements = entries\n          .map((entry) =>\n            !entry.isIntersecting && entry.target instanceof Element\n              ? entry.target\n              : undefined\n          )\n          .filter(notNull);\n        const newVisibleElements = entries\n          .map((entry) =>\n            entry.isIntersecting && entry.target instanceof Element\n              ? entry.target\n              : null\n          )\n          .filter(notNull);\n\n        //  Also cover this in Toolbar with a test case\n        const previouslyOverflowedElements =\n          data?.currentOverflowElements || [];\n        const overflowedElements = previouslyOverflowedElements\n          .filter((element) => !newVisibleElements.includes(element))\n          .concat(newHiddenElements)\n          .filter((element) => {\n            // In some cases some elements may be hidden by some styles (e.g. the first/last separator in a toolbar).\n            // It doesn't make sense to report them as overflowed.\n            const isHidden =\n              element instanceof HTMLElement &&\n              element.offsetWidth === 0 &&\n              element.offsetHeight === 0;\n            return !isHidden;\n          });\n        this.callback(\n          {\n            previouslyOverflowedElements,\n            overflowedElements: overflowedElements,\n            target,\n          },\n          this\n        );\n        if (data) {\n          data.currentOverflowElements = overflowedElements;\n        }\n      },\n      {\n        ...options,\n        root: target,\n      }\n    );\n    [...(target?.children || [])].forEach((childElement) => {\n      intersectionObserver.observe(childElement);\n    });\n    this.data.set(target, {\n      intersectionObserver,\n      currentOverflowElements: [],\n    });\n    this.mutationObserver.observe(target, {\n      childList: true,\n    });\n  }\n\n  unobserve(target: Element) {\n    this.data.get(target)?.intersectionObserver.disconnect();\n  }\n\n  disconnect() {\n    [...this.data.values()].forEach(({ intersectionObserver }) =>\n      intersectionObserver.disconnect()\n    );\n    this.data = new Map();\n    this.mutationObserver.disconnect();\n  }\n}\n","import { RefObject, useEffect, useState } from \"react\";\nimport { OverflowObserver } from \"@intellij-platform/core/utils/overflow-utils/OverflowObserver\";\n\n/**\n * Given a ref to a scrollable container, returns the child elements that are not completely visible and\n * are off view because of scroll.\n * @param scrollableContainerRef\n * @param threshold\n */\nexport function useOverflowObserver(\n  scrollableContainerRef: RefObject<HTMLElement>,\n  {\n    threshold = 0.9,\n    rootMargin = \"0px\",\n  }: Omit<IntersectionObserverInit, \"root\"> = {}\n) {\n  const [overflowedElements, setOverflowedElements] = useState<Element[]>([]);\n\n  useEffect(() => {\n    const overflowObserver = new OverflowObserver((change) => {\n      setOverflowedElements(change.overflowedElements);\n    });\n    overflowObserver.observe(scrollableContainerRef.current!, {\n      rootMargin,\n      threshold,\n    });\n    return () => {\n      overflowObserver.disconnect();\n    };\n  }, [\n    /**\n     * It's ok and needed to have the ref value as a dependency here. We don't know if ref is attached to different\n     * elements in each render, and it's ok that it's not a state, since we don't change it, and it's not supposed to\n     * change without a rerender\n     **/\n    scrollableContainerRef.current,\n  ]);\n\n  return {\n    overflowedElements,\n  };\n}\n","import { Key } from \"react\";\nimport { Ord } from \"ramda\";\n\ntype TreeNodeFn<T> = (root: T) => null | readonly T[];\ntype MutableTreeNodeFn<T> = (root: T) => null | T[];\n\ntype Tree<T> = {\n  getChildren: TreeNodeFn<T>;\n  roots: ReadonlyArray<T>;\n};\n\ntype MutableTree<T> = {\n  getChildren: MutableTreeNodeFn<T>;\n  roots: Array<T>;\n};\n\nexport const getExpandAllKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeNodeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key,\n  roots: ReadonlyArray<T>\n) => {\n  const keys: Key[] = roots.map(getKey);\n  const processItem = (node: T | null) => {\n    const children = node ? getChildren(node) : null;\n    if (node == null || !children) {\n      return;\n    }\n    keys.push(getKey(node));\n    children.forEach(processItem);\n  };\n  roots.map(getChildren).flat().forEach(processItem);\n  return keys;\n};\n\nexport const getExpandedToNodesKeys = <T>(\n  /**\n   * represents a tree as a function. Given a node, it should return the array of children or null, if the node is a\n   * leaf. Note that even an empty array will make the node to be considered a non-leaf node and the key is included.\n   * if null is passed, the root(s) node(s) should be returned.\n   */\n  getChildren: TreeNodeFn<T>,\n  /**\n   * a function that converts each node into a key\n   */\n  getKey: (t: T) => Key,\n  roots: ReadonlyArray<T>,\n  targetNodeKeys: Iterable<Key>\n) => {\n  const targetNodeKeySet = new Set(targetNodeKeys);\n  const expandedKeys: Key[] = [];\n  dfsVisit<T, boolean>(\n    getChildren,\n    (node, childValues) => {\n      const key = getKey(node);\n      const isExpanded: boolean =\n        childValues?.some((childValue) => childValue) ||\n        targetNodeKeySet.has(key);\n      if (isExpanded) {\n        expandedKeys.push(key);\n      }\n      return isExpanded;\n    },\n    roots\n  );\n  return expandedKeys;\n};\n\nexport const dfsVisit = <T, R>(\n  getChildren: TreeNodeFn<T>,\n  visit: (node: T, childrenValues: null | R[]) => R,\n  roots: ReadonlyArray<T>\n) => {\n  const dfs = (node: T): R => {\n    const children = getChildren(node);\n    const values = children?.map(dfs) ?? null;\n    return visit(node, values);\n  };\n  roots.forEach(dfs);\n};\n\nexport const bfsVisit = <T, R>(\n  getChildren: TreeNodeFn<T>,\n  visit: (node: T, parentValue: R | null) => R,\n  roots: ReadonlyArray<T>\n) => {\n  const bfs: typeof visit = (node, parentValue) => {\n    const result = visit(node, parentValue);\n    const children = getChildren(node);\n    children?.map((childNode) => bfs(childNode, result));\n    return result;\n  };\n  return roots.map((root) => bfs(root, null));\n};\n\nexport const sortTreeNodesInPlace = <T>(\n  by: (t: T) => Ord,\n  tree: MutableTree<T>\n) => {\n  const compareFn = (a: T, b: T) => {\n    const aa = by(a);\n    const bb = by(b);\n    return aa < bb ? -1 : aa > bb ? 1 : 0;\n  };\n  tree.roots.sort(compareFn);\n  bfsVisit(\n    tree.getChildren,\n    (node) => {\n      const children = tree.getChildren(node);\n      if (children) {\n        children.sort(compareFn);\n      }\n    },\n    tree.roots\n  );\n};\n","import React, { useContext } from \"react\";\n\nexport const useContextOrThrow = <ContextType extends unknown>(\n  Context: React.Context<ContextType | null>,\n  nullErrorMessage: string\n) => {\n  const context = useContext<ContextType | null>(Context);\n\n  if (context == null) {\n    throw new Error(nullErrorMessage);\n  }\n\n  return context;\n};\n","import { useCallback, useLayoutEffect, useRef } from \"react\";\n\n/**\n * Interim solution for non-reactive callbacks, until\n * [useEvent](https://github.com/reactjs/rfcs/blob/useevent/text/0000-useevent.md) (or whatever it will end up being\n * called), becomes available.\n */\nexport function useEventCallback<T extends (...args: any[]) => any>(fn: T): T {\n  let ref = useRef<typeof fn>();\n  useLayoutEffect(() => {\n    ref.current = fn;\n  });\n  const callback = ((...args: Parameters<T>) =>\n    ref.current?.apply(null, args)) as T;\n  return useCallback<T>(callback, []);\n}\n","import { FocusEventHandler } from \"react\";\nimport { getFocusableTreeWalker } from \"@react-aria/focus\";\n\n/**\n * Provides a focus management mechanism for a container that doesn't retain focus but forwards it to its focusable\n * descendants. More specifically:\n * - When the container gets focused, it automatically focuses the first focusable child element.\n *   The {@param forwardFocus} parameter can be used to customize which element should receive focus.\n * - By default, focus is prevented from returning to the container itself when focus is being moved from a descendant\n *   to the container. {@param ignoreFocusedDescendant} can be set to `true`, to disable this behaviour.\n *   If {@param ignoreFocusedDescendant} is true, focus will be forcibly moved to the first element (or the element\n *   specified by {@param forwardFocus}) when the container gets focused.\n *\n * NOTE: This hook does not make the container element focusable. It only returns the focus event handler that should be\n * passed to the container.\n */\nexport function useFocusForwarder({\n  forwardFocus,\n  ignoreFocusedDescendant = false,\n}: {\n  /**\n   * Called when the container gets focused, to forward focus to the appropriate focusable child element.\n   * If not passed, focus is forwarded to the first focusable element, by default.\n   */\n  forwardFocus?: () => void;\n  ignoreFocusedDescendant?: boolean;\n} = {}) {\n  const onFocus: FocusEventHandler = (event) => {\n    if (event.target !== event.currentTarget) {\n      // only when this container is focused. not when anything inside is focused.\n      return;\n    }\n    const possiblyBlurredElement = event.relatedTarget;\n    if (\n      possiblyBlurredElement instanceof Element &&\n      event.currentTarget?.contains(possiblyBlurredElement) &&\n      !ignoreFocusedDescendant\n    ) {\n      // If anything inside the content is being blurred while the container is getting focused, we don't let focus\n      // go from that element, to the container.\n      if (possiblyBlurredElement instanceof HTMLElement) {\n        possiblyBlurredElement.focus();\n      }\n      return;\n    }\n    if (forwardFocus) {\n      forwardFocus();\n    } else {\n      (\n        getFocusableTreeWalker(event.currentTarget).firstChild() as HTMLElement\n      )?.focus();\n    }\n  };\n  return { focusForwarderProps: { onFocus } };\n}\n","import React, { useRef } from \"react\";\n\n/**\n * For when a component needs to forward ref, but it too needs to use the same ref. Since forwarded ref can be in form\n * of a callback too, this will normalize it as a RefObject.\n * NOTE: Should we keep the ref in state because of edge cases?\n */\nexport default function useForwardedRef<T>(\n  forwardedRef: React.Ref<T>\n): React.RefObject<T> {\n  const innerRef = useRef<T>(null);\n  React.useEffect(() => {\n    if (!forwardedRef) {\n      return;\n    }\n\n    if (typeof forwardedRef === \"function\") {\n      forwardedRef(innerRef.current);\n    } else {\n      (forwardedRef as React.MutableRefObject<T | null>).current =\n        innerRef.current;\n    }\n  });\n\n  return innerRef;\n}\n","import { useLayoutEffect, useRef } from \"react\";\n\nexport function useLatest<T>(value: T) {\n  const ref = useRef(value);\n  useLayoutEffect(() => {\n    ref.current = value;\n  });\n  return ref;\n}\n","import { useEffect, useRef } from \"react\";\n\nexport function usePrevious<T>(value: T): T {\n  const ref = useRef(value);\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n","export class ImmutableSet<T> implements ReadonlySet<T> {\n  readonly size: number;\n  private readonly set: ReadonlySet<T>;\n\n  constructor(values: Iterable<T>) {\n    this.set = new Set(values);\n    this.size = this.set.size;\n  }\n\n  add(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.add(item);\n      });\n    });\n  }\n\n  delete(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        newValue.delete(item);\n      });\n    });\n  }\n\n  toggle(...items: T[]): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      items.forEach((item) => {\n        if (!newValue.delete(item)) {\n          newValue.add(item);\n        }\n      });\n    });\n  }\n\n  clear(): ImmutableSet<T> {\n    return this.setValueWithMutation((newValue) => {\n      newValue.clear();\n    });\n  }\n\n  private setValueWithMutation(\n    mutate: (newValue: Set<T>) => void\n  ): ImmutableSet<T> {\n    const newValue = new Set(this.set);\n    mutate(newValue);\n    return new ImmutableSet(newValue);\n  }\n\n  ////////////////////////////////////////////////// delegated methods /////////////////////////////////////////////////\n  forEach(...args: Parameters<ReadonlySet<T>[\"forEach\"]>): void {\n    return this.set.forEach(...args);\n  }\n\n  has(value: T): boolean {\n    return this.set.has(value);\n  }\n\n  [Symbol.iterator](): IterableIterator<T> {\n    return this.set[Symbol.iterator]();\n  }\n\n  entries(): IterableIterator<[T, T]> {\n    return this.set.entries();\n  }\n\n  keys(): IterableIterator<T> {\n    return this.set.keys();\n  }\n\n  values(): IterableIterator<T> {\n    return this.set.values();\n  }\n}\n","import { useControlledState } from \"@react-stately/utils\";\nimport { useMemo } from \"react\";\nimport { ImmutableSet } from \"./immutableSet\";\n\n/**\n * Creates map interface out of a setter of form (currentValue: Map) => Map\n * Use {@link useControllableSet} instead if you need a Set state in a React component.\n * This is useful for use outside React components, such as state management libraries.\n */\nexport const createSetInterface = <T>(\n  set: (value: (prevState: Set<T>) => Set<T>) => void\n) => ({\n  add: (...values: T[]) =>\n    set(\n      (currentValue) => new Set(new ImmutableSet(currentValue).add(...values))\n    ),\n  delete: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).delete(...values))\n    ),\n  clear: () =>\n    set((currentValue) => new Set(new ImmutableSet(currentValue).clear())),\n  toggle: (...values: T[]) =>\n    set(\n      (currentValue) =>\n        new Set(new ImmutableSet(currentValue).toggle(...values))\n    ),\n});\n\nfunction useStateSetterForSet<T>(\n  setValue: (value: (prevState: Set<T>) => Set<T>, ...args: any[]) => void\n) {\n  return useMemo(() => createSetInterface(setValue), [setValue]);\n}\n\n/**\n * controllable state management for a Set. returns a tuple containing the value and an object with Set functions on it,\n * which would update the state.\n */\nexport const useControllableSet = <T>(\n  valueProp: Set<T> | undefined,\n  defaultValue: Set<T> = new Set(),\n  onChange: ((newValue: Set<T>) => void) | undefined\n) => {\n  const [value, setValue] = useControlledState(\n    valueProp!, // bad typing in useControlledState\n    defaultValue,\n    onChange! // bad typing in useControlledState\n  );\n\n  // @ts-expect-error FIXME https://github.com/adobe/react-spectrum/issues/2320\n  return [value, useStateSetterForSet(setValue)] as const;\n};\n","var map = {\n\t\"./simpleWorker\": 87223,\n\t\"./simpleWorker.js\": 87223\n};\n\nfunction webpackAsyncContext(req) {\n\treturn Promise.resolve().then(() => {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\n\t\tvar id = map[req];\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 96300;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./editorBaseApi\": [\n\t\t79375\n\t],\n\t\"./editorBaseApi.js\": [\n\t\t79375\n\t],\n\t\"./editorSimpleWorker\": [\n\t\t42789\n\t],\n\t\"./editorSimpleWorker.js\": [\n\t\t42789\n\t],\n\t\"./editorWorker\": [\n\t\t30363\n\t],\n\t\"./editorWorker.js\": [\n\t\t30363\n\t],\n\t\"./editorWorkerHost\": [\n\t\t76679\n\t],\n\t\"./editorWorkerHost.js\": [\n\t\t76679\n\t],\n\t\"./findSectionHeaders\": [\n\t\t43631\n\t],\n\t\"./findSectionHeaders.js\": [\n\t\t43631\n\t],\n\t\"./getIconClasses\": [\n\t\t75154\n\t],\n\t\"./getIconClasses.js\": [\n\t\t75154\n\t],\n\t\"./languageFeatureDebounce\": [\n\t\t69060\n\t],\n\t\"./languageFeatureDebounce.js\": [\n\t\t69060\n\t],\n\t\"./languageFeatures\": [\n\t\t35921\n\t],\n\t\"./languageFeatures.js\": [\n\t\t35921\n\t],\n\t\"./languageFeaturesService\": [\n\t\t33293\n\t],\n\t\"./languageFeaturesService.js\": [\n\t\t33293\n\t],\n\t\"./languageService\": [\n\t\t44718\n\t],\n\t\"./languageService.js\": [\n\t\t44718\n\t],\n\t\"./languagesAssociations\": [\n\t\t41356\n\t],\n\t\"./languagesAssociations.js\": [\n\t\t41356\n\t],\n\t\"./languagesRegistry\": [\n\t\t33550\n\t],\n\t\"./languagesRegistry.js\": [\n\t\t33550\n\t],\n\t\"./markerDecorations\": [\n\t\t52919\n\t],\n\t\"./markerDecorations.js\": [\n\t\t52919\n\t],\n\t\"./markerDecorationsService\": [\n\t\t1022\n\t],\n\t\"./markerDecorationsService.js\": [\n\t\t1022\n\t],\n\t\"./model\": [\n\t\t65041\n\t],\n\t\"./model.js\": [\n\t\t65041\n\t],\n\t\"./modelService\": [\n\t\t94657\n\t],\n\t\"./modelService.js\": [\n\t\t94657\n\t],\n\t\"./resolverService\": [\n\t\t91223\n\t],\n\t\"./resolverService.js\": [\n\t\t91223\n\t],\n\t\"./semanticTokensDto\": [\n\t\t21982\n\t],\n\t\"./semanticTokensDto.js\": [\n\t\t21982\n\t],\n\t\"./semanticTokensProviderStyling\": [\n\t\t76263\n\t],\n\t\"./semanticTokensProviderStyling.js\": [\n\t\t76263\n\t],\n\t\"./semanticTokensStyling\": [\n\t\t76567\n\t],\n\t\"./semanticTokensStyling.js\": [\n\t\t76567\n\t],\n\t\"./semanticTokensStylingService\": [\n\t\t29922\n\t],\n\t\"./semanticTokensStylingService.js\": [\n\t\t29922\n\t],\n\t\"./textModelSync/textModelSync.impl\": [\n\t\t54632\n\t],\n\t\"./textModelSync/textModelSync.impl.js\": [\n\t\t54632\n\t],\n\t\"./textModelSync/textModelSync.protocol\": [\n\t\t66828,\n\t\t6828\n\t],\n\t\"./textModelSync/textModelSync.protocol.js\": [\n\t\t66828,\n\t\t6828\n\t],\n\t\"./textResourceConfiguration\": [\n\t\t16576\n\t],\n\t\"./textResourceConfiguration.js\": [\n\t\t16576\n\t],\n\t\"./treeSitterParserService\": [\n\t\t40143\n\t],\n\t\"./treeSitterParserService.js\": [\n\t\t40143\n\t],\n\t\"./treeViewsDnd\": [\n\t\t55247\n\t],\n\t\"./treeViewsDnd.js\": [\n\t\t55247\n\t],\n\t\"./treeViewsDndService\": [\n\t\t61860\n\t],\n\t\"./treeViewsDndService.js\": [\n\t\t61860\n\t],\n\t\"./unicodeTextModelHighlighter\": [\n\t\t83969\n\t],\n\t\"./unicodeTextModelHighlighter.js\": [\n\t\t83969\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn Promise.all(ids.slice(1).map(__webpack_require__.e)).then(() => {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = 34428;\nmodule.exports = webpackAsyncContext;"],"names":["LoadingGif","props","React","Img","_extends","src","darkSrc","__docgenInfo","Loading","styled","withConfig","displayName","componentId","DefaultSuspense","_ref","fallback","children","FILE_ICON","DIR_ICON","extensionIconMap","editorconfig","js","gitignore","archive","as","config","css","dtd","hpr","htaccess","html","idl","java","jfr","json","jsp","jspx","manifest","properties","txt","wsdl","xhtml","xml","xsd","yaml","getIconForFile","filepath","extension","getExtension","split","pop","getParentPaths","upperLimit","path","getParentPathsRecursive","previousPaths","dirname","concat","darculaColorSchemeTokenRules","vsCodeTheme","flatMap","scope","settings","map","token","values","Object","keys","forEach","key","value","StyledEditor","MonacoEditor","Editor","editorTheme","useEditorTheme","monaco","useMonaco","theme","useTheme","themeName","setThemeName","useState","dark","useLayoutEffect","name","replace","bracketColor","editor","defineTheme","base","inherit","colors","rules","options","minimap","enabled","lineHeight","showFoldingControls","guides","indentation","overviewRulerBorder","fontFamily","fontSize","scrollbar","verticalScrollbarSize","horizontalScrollbarSize","verticalSliderSize","horizontalSliderSize","horizontal","vertical","alwaysConsumeMouseWheel","async","createIndexedDBFS","storeName","idbfs","createFsBackend","cb","BrowserFS","IndexedDB","Create","Promise","resolve","init","store","initializeFS","fsBackend","fsm","promises","pify","exists","filePath","createFs","backend","fs","initialize","fn","reject","err","copyFsRecursively","CAF","cancelSignal","params","source","target","rootDir","onCopy","force","items","readdir","fullPath","stat","isFile","isSymbolicLink","fileExists","content","readFile","ensureDir","writeFile","isDirectory","console","warn","dirPath","catch","e","code","mkdir","Error","pathname","persistentFsPreference","get","localStorage","getItem","set","setItem","switchToPersistentFS","_temp","log","getRootFS","InMemory","time","indexedDbFsBackend","rest","copyFs","timeEnd","fsResource","promise","response","status","suspender","then","res","read","wrapPromise","createInMemoryFS","theFs","window","WaitForFs","dirContentState","selectorFamily","fileNames","stats","all","fileName","type","basename","lastModification","mtimeMs","size","reloadFileFromDiskCallback","reset","refresh","readFileContentSelector","fileContentState","encoding","atomFamily","default","effects","_ref2","onSet","error","useLatestRecoilValue","recoilValue","state","setState","loadable","useRecoilValueLoadable","useEffect","contents","getValue","useExistingLatestRecoilValue","toPromise","useRecoilInitialValue","recoilState","defaultValue","useRecoilCallback","snapshot","getLoadable","filterPath","includes","autoClonedRepo","defaultProject","currentProjectState","atom","projectFilePath","projectRelativePath","currentProjectFilesState","selector","project","projectFilesState","projectPath","_ref3","files","addItem","item","childItems","push","relativePath","useRefreshCurrentProjectFiles","useRecoilRefresher_UNSTABLE","activePathsState","activePathExistsState","_ref4","length","useActivePathsProvider","createFocusBasedSetterHook","nullValue","focusedElement","setValue","useSetRecoilState","elementRef","useRef","current","currentValue","equals","onFocus","currentTarget","onBlur","relatedTarget","Element","closest","projectPopupManagerRefState","createRef","dangerouslyAllowMutability","windowManagerRefState","alertDialogRefState","temporaryTabsDefaultValue","sortWith","descend","file","endsWith","filter","slice","editorState","cursorPos","lineNumber","column","editorTabsState","getPromise","setSelf","trigger","tabs","activeEditorTabIndexState","activeEditorTabState","editorCursorPositionState","Position","editorRefState","openPathCallback","shouldFocus","tabsState","index","findIndex","tab","select","focus","valueOrThrow","newIndex","currentState","setTimeout","closeCallback","_ref5","_","tabIndex","closePathCallback","callbackInterface","transact_UNSTABLE","close","Math","max","closeOtherTabsCallback","_ref6","_ref7","numTabs","_ref8","editorManagerState","_ref9","getCallback","openPath","closeTab","closePath","closeOtherTabs","useEditorStateManager","useRecoilValue","convertGitStatus","Array","isArray","ensureArray","input","StorageFiles","persistentAtomEffect","componentName","refine","update","storageFile","WORKSPACE_FILE","itemKey","join","syncEffect","storeKey","syncDefault","readComponentState","write","DefaultValue","option","optionName","args","find","currentSettings","updates","vcsDirectoryMappingChecker","array","object","dir","string","vcs","union","literal","vcsRootsState","gitSettings","mappings","mapping","TMP_findGitRoots","git","roots","Set","notNull","vcsRootForFile","findRoot","fetchRepoStatusFromFs","repoDir","rows","statusMatrix","result","row","repoStatusState","repoStatusUpdatingState","fileStatusState","repoRoot","repoStatus","filepaths","refreshFileStatusCallback","statusMap","newStatusMap","useRefreshFileStatus","useRefreshRepoStatuses","gitDirs","useStatusColor","FileStatusColor","color","fileStatus","useFileStatusColor","style","StatusColor","currentForegroundAware","_balloonManagerRef","notImplemented","show","icon","title","body","actions","Link","onPress","StyledContainer","div","attrs","StyledLine","StyledShortcut","commonColors","linkForegroundEnabled","EditorZeroState","ActionTip","actionId","CommonActionId","GO_TO_FILE","GO_TO_ACTION","getShortcut","useGetActionShortcut","action","useAction","AppActionIds","editorActionIds","EXPAND_REGION","EXPAND_REGION_RECURSIVELY","EXPAND_ALL_REGIONS","EXPAND_ALL_TO_LEVEL","EXPAND_ALL_TO_LEVEL1","EXPAND_ALL_TO_LEVEL2","EXPAND_ALL_TO_LEVEL3","EXPAND_ALL_TO_LEVEL4","EXPAND_ALL_TO_LEVEL5","COLLAPSE_REGION","COLLAPSE_REGION_RECURSIVELY","COLLAPSE_ALL_REGIONS","COLLAPSE_DOC_COMMENTS","TOGGLE_FOLDING","EDITOR_LANG_POPUP_MENU","CompareClipboardWithSelection","context","event","editorFullState","activeEditorTab","FileEditor","editorTabs","editorStateManager","editorRef","active","setActive","contextMenu","setContextMenu","hideAllAction","HIDE_ALL_WINDOWS_ACTION_ID","setCursorPositionState","loadingState","tabActionsRef","useLatest","closeOthersTabs","setEditorRef","setContent","updateFileStatus","editorActionGroupDefinition","createDefaultActionGroup","useCreateDefaultActionGroup","selection","getSelection","selectedText","getModel","getValueInRange","id","description","isSearchable","menuPresentation","PlatformIcon","actionPerformed","COPY","copyToClipboard","PASTE","COPY_REFERENCE","level","useEditorActionGroup","updateContent","newContent","activePathsProviderProps","ActionsProvider","shortcutHandlerProps","StyledFileEditorContainer","mergeProps","ContextMenuContainer","renderMenu","Menu","onAction","Item","EditorTabs","selectedKey","onSelectionChange","noBorders","filename","TabItem","textValue","inOverflowMenu","MenuItemLayout","TooltipTrigger","tooltip","ActionTooltip","actionName","EditorTabContent","closeButton","TabCloseButton","altKey","indexOf","containerProps","onDoubleClick","perform","height","contextmenu","onMount","monacoEditor","onContextMenu","c","preventDefault","onDidScrollChange","languages","typescript","typescriptDefaults","setCompilerOptions","jsx","JsxEmit","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","enableJsx","onDidChangeCursorPosition","position","onDidChangeModel","onChange","FileEditorLoading","MenuOverlayFromOrigin","origin","browserEvent","onClose","EditorActionGroupMenu","actionGroup","useActionGroup","ActionGroupMenu","menuProps","autoFocus","isUnderDarcula","panelBackground","StyledXterm","XTerm","Terminal","setInput","xtermRef","useMemo","background","letterSpacing","cursorStyle","cursorBlink","cursorWidth","rendererType","terminal","resize","ref","onData","data","charCodeAt","foldersOnTopState","expandedKeysState","selectionState","selectedNodesState","nodesByKey","currentProjectTreeState","byKey","projectViewTreeRefState","rootItems","Map","mapItem","parent","node","dirNode","sortProjectTreeNodes","root","createProjectTree","sort","item1","item2","expandToPathCallback","expandedKeys","keysToExpand","selectKeyAndFocusCallback","treeRef","replaceSelection","useSelectPathInProjectView","expandToOpenedFile","selectKeyAndFocus","projectActionIds","NewElement","NewFile","NewDir","CopyReferencePopupGroup","CopyPaths","CopyFileReference","CopyAbsolutePath","CopySourceRootPath","CopyFileName","ProjectViewContextMenu","getActionContext","ActionsMenu","actionContext","shortcut","undefined","DividerItem","CUT","DELETE","ProjectViewPane","setProjectViewTreeRef","treeState","setExpandedKeys","useRecoilState","selectedKeys","setSelectedKeys","sortItems","sortBy","a","identity","selectedKeysArray","i","containerRef","contextMenuTargetKey","element","querySelector","onOpen","dataset","SpeedSearchTree","fillAvailableSpace","selectionMode","onExpandedChange","ItemLayout","ProjectViewNodeIcon","HighlightedTextValue","Hint","FileTreeNodeText","FileTreeDirNodeText","FileTreeFileNodeText","useContext","ItemStateContext","isSelected","isContainerFocused","nodeTypeIconMap","HelpButton","HelpTooltip","helpText","Button","variant","findRootPaths","objects","getPath","obj","thePath","anObject","startsWith","deleteFileCallback","refreshFileStatus","releaseSnapshot","retain","unlink","deleteFilesCallback","deleteFile","filePaths","deleteDirCallback","recursivelyDeleteDir","pathnames","fullpath","rmdir","createDirectoryCallback","destination","fileCountMsg","IntlMessageFormat","dirCountMsg","deleteActionState","isDisabled","deleteDir","deleteFiles","selectedNodes","windowManager","alertDialog","nodesToDelete","directories","singleDirName","confirm","okText","message","width","count","format","open","DeleteFilesConfirmationDialog","confirmed","requestAnimationFrame","ModalWindow","minWidth","minHeight","WindowLayout","header","onSubmit","padding","marginBottom","display","flexDirection","gap","Checkbox","footer","Footer","left","right","form","copyActionState","cutActionState","pasteActionState","SELECT_IN_PROJECT_VIEW","ProjectToolWindow","useTreeActions","projectViewActions","activeTab","selectPathInProjectView","selectOpenedFile","useProjectViewActions","DefaultToolWindow","headerContent","additionalActions","ActionButton","EXPAND_ALL","COLLAPSE_ALL","DEFAULT_LOADING_DELAY_MS","Delayed","waitedEnough","setWaitedEnough","timer","clearTimeout","Tagged","change","Change","before","after","Unversioned","revision","changeToFileStatus","ADDED","DELETED","MOVED","RENAMED","MODIFIED","UNVERSIONED","revisionEquals","b","isDir","isAddition","isDeletion","isRename","isMove","isModified","isUnversioned","sameBefore","sameAfter","repoChangesState","entries","allChangesState","flat","changeListsState","comment","changes","activeChangeListState","changeList","unversionedChangesState","SyncChangeListsState","setChangeLists","changeLists","trackedChanges","updatedChangeLists","aChange","existingChanges","newChanges","anExistingChange","createGroupByDirectory","mapNode","createDirectoryNode","shouldCollapseDirectories","nodes","pathToNodeCache","rootDirNodes","reduce","prevNode","parentNodePath","isDirectoryNode","directoryNodes","uniq","collapseDirectories","createDirectorNode","child","changesTreeNodeKey","getNodeKeyForChange","changeNode","showPath","isGroupNode","isChangeNode","getChildren","VcsActionIds","ROLLBACK","REFRESH","SHELVE_SILENTLY","SHELVE","UNSHELVE_SILENTLY","NEW_CHANGELIST","ADD_UNVERSIONED","RENAME_CHANGELIST","REMOVE_CHANGELIST","SET_DEFAULT_CHANGELIST","MOVE_TO_ANOTHER_CHANGELIST","SHOW_DIFF","CHECKIN_FILES","CHECKIN_PROJECT","JUMP_TO_SOURCE","EDIT_SOURCE","GROUP_CHANGES_VIEW_POPUP_MENU","GROUP_BY_DIRECTORY","GIT_ADD","GIT_INIT","GIT_CLONE","GIT_CREATE_NEW_BRANCH","GIT_BRANCHES","GIT_LOG_HIDE_BRANCHES","GIT_LOG_NAVIGATE_TO_SELECTED_BRANCH","GIT_UPDATE_SELECTED","FOCUS_TEXT_FILTER","MATCH_CASE","REG_EXP","COPY_REVISION_NUMBER","LOG_REFRESH","SHOW_DETAILS","SHOW_DIFF_PREVIEW","PRESENTATION_SETTINGS","FILE_HISTORY_PRESENTATION_SETTINGS","CopyPathFromRepositoryRootProvider","repositoryGrouping","isAvailable","groupFn","repository","repositoryNode","directoryGrouping","useShortcutOf","keyPrefix","directoryNode","defaultChangeGroupings","defaultChangeGroupingsState","grouping","isRecoilValue","recursiveGrouping","groupingFns","nextGroupingFns","changeNodes","groupNodes","groups","groupNode","group","getPrefixedChangesGroupFn","isActive","groupings","groupFns","arguments","isOpen","windowBounds","initiallyIncludedChanges","rootNodes","selectedChanges","changesTreeNodesState","includedRootNodes","some","rollbackViewState","initiallyExpandedKeys","includedChanges","getExpandedToNodesKeys","getExpandAllKeys","changesTreeNodesResult","fileCountsMap","expandAllKeys","dfsVisit","childrenFileCount","add","fileCount","total","changeListNode","showIgnoredFilesState","showRelatedFilesState","changesGroupingActiveState","selectedKeysState","resolvedSelectedKeysState","bfsVisit","parentValue","changesUnderSelectedKeys","allChanges","processNode","changeListsUnderSelection","allChangeLists","selectedChangeLists","includedChangeKeysState","includedChangesState","includedChangeKeys","has","includedChangesNestedSelection","NestedSelection","createSetInterface","getKey","changesViewGroupingsState","groupChildren","_ref10","changeListNodes","_ref11","prefixedGroupFn","unversionedChanges","unversionedChangesNode","commitMessageSizeState","orientation","amendCommitState","commitMessageState","commitErrorMessageState","commitTaskIdState","changesFromActivePathsState","_ref12","activePaths","activePath","queueCheckInCallback","_ref13","paths","currentExpandedKeys","openRollbackWindowForSelectionCallback","_ref14","contextual","changesUnderSelection","changesBasedOnActivePaths","ChangesViewTreeContextMenu","asyncFilter","predicate","predicateResult","getTrackingBranch","localBranchName","mergeRef","remote","repoLocalBranchesState","branches","branch","trackingBranch","repoRemoteBranchesState","remotes","repoBranchesState","currentBranchName","repoCurrentBranchNameState","localBranches","currentBranch","remoteBranches","fullname","allBranchesState","branchForPathState","PREDEFINED_FAVORITE_BRANCH_NAMES","branchType","branchName","readBranchStorage","branchStorage","entry","list","toBranchStorage","branchesByType","groupBy","branchInfoArrayChecker","favoriteBranchesState","isFavoriteBranchState","branchInfo","isFavorite","excludedFromFavoriteBranchesState","isPredefinedAsFavorite","favoriteBranches","excludedFromFavoriteBranches","useToggleFavoriteBranch","favorite","remove","favoriteBranch","useFavoriteBranches","toggleFavorite","RepoCurrentBranchName","repo","StyledRepoColorSquare","span","useRepoRootColor","rootPath","red","blue","RepoColorIcon","backgroundColor","StyledCurrentBranchTag","currentBackgroundAware","formatFileCount","ChangeNodeHint","defaultNodeRenderers","repoNodeRenderer","rendered","directory","directoryNodeRenderer","createChangesTreeNodeRenderer","renderers","defaultRendererOverrides","nodeRenderers","getItemProps","nodeRenderer","dirCount","hasChildItems","getTextValue","itemRenderer","LoadingText","loading","changesViewTreeNodeRenderer","changelist","changeListNodeRenderer","fontWeight","unversioned","unversionedChangesNodeRenderer","_node","findPathsUnderNode","ChangeViewTree","nestedSelection","openChangeInEditor","SpeedSearchTreeWithCheckboxes","TreeNodeCheckbox","getSelectionState","onToggle","toggle","ChangeListsActionButton","IconButtonWithMenu","actionMenuProps","SpeedSearchMenu","GroupByActionButton","IconButton","isPressed","Section","ChangesGroupByActionButton","toggleGroup","ViewOptionsActionButton","showRelatedFiles","setShowRelatedFiles","showIgnoredFiles","setShowIgnoredFiles","viewOptions","ChangesViewToolbar","Toolbar","border","ToolbarSeparator","tasksState","firstTaskState","taskCountState","progressSeq","useRunTask","setTasksState","useEventCallback","task","isCancelable","abortController","cancelToken","tasks","progress","fraction","text","secondaryText","isIndeterminate","setTaskProgressState","taskDefinition","run","setFraction","setText","setSecondaryText","setIndeterminate","signal","finally","onFinished","useCancelTask","abort","resolvedRefState","depth","dateToString","date","getMonth","getDate","getFullYear","toString","dateRangeToString","dateRange","from","to","vcsTabKeysState","vcsActiveTabKeyState","vcsTabTitleState","searchQuery","vcsLogFilter","user","parts","short","long","part","tabStats","vcsLogTabState","someAtomFamily","vcsLogTabShowBranchesState","vcsLogTabShowCommitDetailsState","vcsLogTabShowCommitDetailsInCurrentTabState","CURRENT_USER_FILTER_VALUE","matchCase","regExp","vcsLogFilterCurrentTab","mapObjIndexed","newValue","useResetFilters","tabKey","closeTabCallback","cache","commitDateComparator","commit","committer","timestamp","match","query","flags","RegExp","test","toLowerCase","allCommitsState","allCommits","commitsMap","commitsToProcess","readCommitResult","oid","_len","sources","_key","initialCommits","refs","repoPath","isBare","getCommonArgs","c1","c2","addCommit","latestCommit","containingRefs","shift","aCommit","splice","commitsTableRowsState","dateFilter","author","getTime","tree","byOid","indexBy","allResolvedRefsState","repoBranches","addRef","isCurrent","commitsSelectionState","selectedCommitOids","selectedCommitsState","selectedCommitState","_ref15","vcsTableShowCommitTimestampState","vcsTableReferencesOnTheLeftState","vcsTableHighlightMyCommitsState","authorColumn","hashColumn","dateColumn","defaultVisibleColumns","vcsTableColumnsVisibilityState","commitSuccessfulMessage","useCommitChanges","balloonManager","useBalloonManager","runTask","commitMessage","taskId","changesGroupedByRepo","soFar","TextEncoder","encode","gitdir","headTreeOid","containsChange","blob","mode","newTreeOid","commitRef","commitFiles","email","StyledCommitMessageContainer","StyledCommitMessageTextArea","textarea","StyledCommitActionsRow","StyledErrorMessage","CommitView","commitMessageTextAreaRef","setCommitMessage","amend","errorMessage","setErrorMessage","commitTaskId","commitSelectedChanges","hasFocus","useDefaultToolWindowContext","useImperativeHandle","placeholder","preventFocusOnPress","mnemonic","ChangesSummary","modifiedCount","addedCount","deletedCount","StyledActionsRow","StyledAmendCheckbox","StyledChangesSummaryContainer","ChangesViewChangesSummary","CommitActionsRow","setAmend","ActionHelpTooltip","focusCommitMessage","preventFocus","deleteChangeListMsg","selectedFilesCountMsg","deletablePathsUnderChangesTreeSelectionState","deletePaths","pathsToDelete","useChangesViewActions","setActiveChangeList","changeListId","targetChangeList","nonActiveSelectedChangeLists","StyledTreeViewWrapper","StyledLoadingWrapper","ChangesViewSplitter","anchor","useToolWindowState","getAnchorOrientation","updating","commitMessageSize","setCommitMessageSize","changesViewActions","treeActions","ThreeViewSplitter","innerView","innerViewMinSize","lastView","lastSize","onLastResize","inactiveTextColor","ChangesViewZeroState","performAction","usePerformAction","textAlign","verticalAlign","ChangesViewPane","vcsRoots","TrackingBranchInfo","borderSpacing","COMMIT_TOOLWINDOW_ID","changesBranchesState","CommitToolWindow","areChangesGroupedByRepo","changesBranches","MultiViewToolWindow","View","tabContent","UNSAFE_FocusRestoringSuspense","document","activeElement","HTMLElement","isConnected","StyledHeader","borderColor","StyledSpacer","StyledPlaceholderContainer","parseCommitMessage","lines","bodyLines","subject","bodyAsString","line","shortenOid","commitDateTimeFormatter","Intl","DateTimeFormat","day","month","year","hour","minute","hour12","commitTimeFormatter","commitDateFormatter","getText","commitChangesTreeNodeRenderer","commitParent","DEFAULT_SIMILARITY_INDEX","detectRenames","deletions","additions","getContent","renameMapping","similarity","file1Content","file2Content","diffLines","unchanged","added","removed","computeSimilarity","deletion","addition","currentCandidate","mergeRenames","detectRenamesBasedOnContent","hash","detectRenamesBasedOnHash","renamedChanges","rename","candidate","commitChangesTreeRefState","COMMIT_PARENT_ID","commitsDiffWithoutRenamesState","fromRef","toRef","trees","afterOid","beforeOid","afterType","beforeType","afterRevision","TextDecoder","decode","Uint8Array","beforeRevision","getCommitChanges","commitsDiffState","getChangedFilesState","commitLogItem","parents","getChangesGroupFn","sortTreeNodesInPlace","changedFilesWithoutRenamesState","changedFilesState","CommitChangedFiles","treeShortcutHandlerProps","selectedCommits","nothingSelected","stateLoadable","states","loadables","useFastestValueLoadable","valueMaybe","setSelection","paddingBottom","PositionedTooltipTrigger","placement","bottom","labelIcon","fill","d","vcsLogStandardColors","light","gitLogColors","head","localBranch","remoteBranch","tag","StyledRef","StyledLabelSvg","svg","viewBox","StyledRefIconGroup","StyledLabelText","RefIcon","RefIconGroup","types","RefLabel","StyledCommitMessage","StyledCommitMessageHeader","StyledCommitterInfo","label","disabled","StyledCommitInfoRow","StyledRepoColorIcon","StyledRefsContainer","CommitDetails","firstSelectedCommit","allResolvedRefs","isMultiRepo","committerInfo","EmailLink","formatDateAndTime","refsByType","Tooltip","Date","RefGroup","StyledRefWithIcon","href","formatCommitDate","formatCommitTime","useRedefineAction","newId","useActions","commonProperties","useShortcutsOf","splitViewSizeState","groupingState","GROUP_BY_ACTION_GROUP_ID","LAYOUT_ACTION_GROUP_ID","VIEW_OPTIONS_ACTION_GROUP_ID","SHOW_DETAILS_ACTION_ID","SHOW_DIFF_PREVIEW_ACTION_ID","groupingActionId","VcsLogDetailsView","splitViewSize","setSplitViewSize","isDetailsVisible","toggleGroupBy","createActionGroup","availableGroupings","VcsLogsDetailsViewOptionsMenu","flexShrink","flex","firstSize","onFirstResize","firstViewMinSize","firstView","toggleActionsState","fromEntries","StyledDropdownButton","button","focusRing","focused","StyledDropdownIcon","StyledValue","FocusableAutoHoverPlatformIcon","AutoHoverPlatformIcon","VcsFilterDropdown","onClear","menuTriggerProps","MenuTrigger","BareButton","hoverIcon","StyledMenuIconButton","role","BranchFavoriteButton","onClick","onPointerUp","stopPropagation","hoverContainerSelector","BranchesFilterDropdown","selectedBranches","setSelectedBranches","resetBranches","useResetRecoilState","BranchesFilterMenu","onBranchesSelected","groupRepoRoots","repoRoots","repoGroupedAllBranchesState","allBranches","allRemoteBranches","allLocalBranches","setFavoriteBranches","repoGroupedAllBranches","remoteBranchesByRemote","createLocalBranchItems","renderBranchItem","submenuBehavior","Divider","_ref16","NAME_PATTERN","getNameInStandardForm","firstAndLastName","matches","getFirstAndLastName","firstName","lastName","PRINTABLE_ASCII_PATTERN","nameToLowerCase","gitRepoUserState","StyledCommitRow","StyledCommitCell","asOverlay","StyledMessageContainer","StyledRefTooltipRow","useCurrentUserHighlightStyle","currentUser","shouldHighlightCurrentUserCommits","userFilter","user2","CommitsTableRow","showCommitTimestamp","referencesOnTheLeft","isAuthorVisible","isDateVisible","isHashVisible","highlightStyles","flexBasis","flexGrow","CommitRefs","onLeft","refKey","filteredRefs","headIsOnABranch","aBranch","delay","withPointer","tooltipTriggerProps","unshift","StyledProgressBar","ProgressBar","StyledListItem","ResolvedRefsContext","CommitsTable","currentTabKey","resetFilters","commitRowsState","setSelectedCommits","Provider","List","estimatedItemHeight","Consumer","showToggleDefs","highlightToggleDefs","columnToggleDefs","useToggleDef","CommitsTableViewOptionsMenuIconButton","showToggles","highlightToggles","columnToggles","allToggles","toggleKey","StyledSearchInput","SearchInput","searchHistoryState","VcsLogCommitsView","textFilterRef","searchInputRefState","setSearchQuery","setUser","resetUser","setDateFilter","resetDate","searchHistory","setSearchHistory","searchInputValue","setSearchInputValue","getActionShortcut","isRegExpOn","isMatchCaseOn","submitSearchQuery","createNewTab","newTabId","uuid","filterState","today","sevenDaysAgo","setDate","yesterday","predefinedDateRanges","inputRef","addonAfter","StyledHoverContainer","excludeFromTabOrder","predefinedDateRange","getLocalBranchNodes","shouldGroupByDirectory","localBranchNodes","repos","groupNodesByDirectory","getRemoteBranchNodes","remoteBranchNodes","branchesTreeNodeState","branchTreeGroupingState","shouldGroupByRepository","isGroupByRepositoryAvailableState","branchesTreeRefState","searchInputState","availableGroupingsState","BranchesGroupByActionButton","branchTreeNodeRenderers","toUpperCase","Group","keyToBranch","_repo","StyledSearchIconContainer","BranchesTree","branchesTreeNodes","searchTerm","setSearchTerm","searchInputRef","isInputFocused","setInputFocused","setBranchFilter","focusProxyRef","showAsFocused","onSearchTermChange","keepSearchActiveOnBlur","hideSpeedSearchPopup","isSearchActive","DELETE_BRANCH_ACTION_ID","SHOW_BRANCH_DIFF_ACTION_ID","SHOW_MY_BRANCHES_ACTION_ID","FETCH_ACTION_ID","TOGGLE_FAVORITE_ACTION_ID","VcsBranchesView","VcsLogBranchesViewToolbar","StyledToolbar","useCommitsTableActions","copyRevisionNumber","refreshLog","VersionControlToolWindowZeroState","firstViewSizeState","lastViewSizeState","StyledToolWindowHeader","VersionControlToolWindow","tabKeys","activeTabKey","setActiveTabKey","activeKey","onActiveKeyChange","VcsToolWindowTabTitle","VcsTab","StyledExpandStripeButton","StyledShowBranchesButton","StyledShowBranchesButtonText","ShowBranchesButton","firstViewSize","setFirstViewSize","lastViewSize","setLastViewSize","hideBranches","toggleMatchCase","useToggleCurrentTabSettings","toggleRegExp","toggleDetails","useVcsLogsToolWindowActions","showBranches","setShowBranches","firstViewProps","lastViewMinSize","toggleState","ToolWindowTabContent","toolWindows","initialState","toolWindowState","isVisible","weight","Suspense","isSplit","showProgressPanelState","tasksPopupBoundsState","StyledPopupTitle","TasksPopup","setShowProgressPanel","cancel","bounds","setBounds","Popup","innerWidth","top","innerHeight","onBoundsChange","nonDismissable","interactions","Layout","Header","hasControls","margin","details","secondaryDetails","maxValue","ProgressBarStopButton","StyledVerticalSeparator","StatusBarProgress","dense","namePosition","Spacer","StyledProgressBarButton","Container","StatusBarTaskProgressBar","firstTask","tasksCount","showProgressPanel","small","activeFileRepoRootState","activeFile","activeFileRepoBranchesState","activeFileRepoRoot","activeFileCurrentBranchState","activeFileRepoHeadState","detached","resolveRef","validateBranchName","newBranchName","ILLEGAL_CHARS_PATTERN","String","fromCharCode","cleanUpBranchName","StyledInputField","InputField","ErrorMessages","EXISTING","CLASHING_WITH_REMOTE","RenameBranchWindow","setNewBranchName","touched","setTouched","renameBranch","toggleFavoriteBranch","oldref","useRenameBranch","validationState","labelPlacement","validationMessage","Boolean","StyledTitle","branchesPopupSizeState","BranchesPopup","branchesPopupPersistedSize","setBranchesPopupPersistedSize","branchesPopupBounds","setBranchesPopupBounds","newBranchAction","deleteBranch","useWindowManager","checkoutBranch","reloadFileFromDisk","checkout","openedFiles","existingOpenedFile","interactionType","PopupLayout","currentBounds","disabledKeys","operation","tryCheckout","Errors","CheckoutConflictError","BalloonActionLink","aRepoRoot","checkoutRemoteBranch","getSectionLabel","compareActions","mergeActions","favoriteBranchArgs","notified","BranchPopupTrigger","gitRepoHead","maybeShowGitCloneTip","useShowGitTipIfNeeded","showSticky","PopupTrigger","onOpenChange","popup","StatusBarWidget","StyledLastMessage","IdeStatusBar","cursorPosition","StatusBar","RollbackTreeContextMenu","StyledFrame","contrastBorder","RollbackWindow","defaultExpandedKeys","initiallyIncludedChangeKeys","setWindowBounds","setIncludedChangeKeys","useNestedSelectionState","onSelectedKeysChange","rollbackChanges","useRollbackChanges","deleteAddedFiles","changesWithRepoRoots","groupedChanges","toReset","toCheckout","allSettled","resetIndex","pathToRefresh","balloons","setOpen","setDeleteAddedFiles","atLeastOneNewFileSelected","toolWindowsState","ToolWindowsState","removedFromSideBarIds","showStripeButton","tips","EXPAND_SELECTION","SHRINK_SELECTION","useTips","keymap","useKeymap","renderedTips","keyboardShortcut","shortcutToString","setIndex","floor","random","next","tmpIndex","Input","forwardedRef","useObjectRef","focusableProps","useFocusable","searchEverywhereState","contextElement","initialSearchQuery","ContentAwarePopup","hasContent","persistedBoundsState","noContentHeight","otherProps","persistBounds","getInitBounds","heightToRestoreRef","StyledIconWrapper","StyledItemLayout","StyledTitleWrapper","ActionItem","highlights","TextWithHighlights","marginRight","field","isInResolvedActionGroup","breadcrumb","getActionBreadcrumb","actionsSearchContributor","use","everyWhereAutoSet","showDisabledActions","setShowDisabledActions","allActions","getAvailableActionsFor","shouldIncludeDisabledActions","SHOW_INTENTION_ACTIONS","search","allResults","minusculeMatch","searchDeps","isEverywhere","toggleEverywhere","searchAdvertiser","ActionShortcut","headerFilters","processSelectedItem","getItemText","renderItem","FileItem","dirMatches","filenameMatches","splitWhen","titleMatches","filesSearchContributor","getProjectFiles","SearchEverywhereActionIds","StyledTab","selected","StyledTabContent","StyledTabs","StyledSearchFieldContainer","StyledSearchResultsContainer","StyledDivider","hr","StyledSearchFieldHint","StyledLoadMore","StyledPlaceholder","contributors","LOAD_MORE_ITEM","LOAD_MORE_ITEM_KEY","SearchEverywherePopup","setTab","setEveryWhereAutoSet","pattern","setPattern","persistInitialSearchQuery","idToContributor","contributor","activeContributors","searchResultLimit","setSearchResultLimit","searchResult","currentTabContributor","visibleSearchResult","notFoundPatternRef","selectionManagerRef","setFocusedKey","localActions","currentContributorIndex","contributorActions","limit","nextItem","itemWrapper","_ref17","Tabs","TabComponent","TabsComponent","FocusScope","contain","newPattern","newPatternContainsPrevious","onPatternChanged","shouldFocusWrap","_ref18","itemText","gitAddCallback","StyledInput","NewItemPopup","inputName","validationType","hideMessage","setHideMessage","onMouseDown","offset","crossOffset","ValidationTooltip","appearance","createFileActionState","popupManager","destinationDir","NewFilePopup","createFile","createFileCallback","editorManager","waitUntil","HTMLTextAreaElement","AddFileToGitWindow","setFilename","setValidationMessage","submit","addToGit","criteria","timeoutInMs","createDirectoryActionState","NewDirectoryPopup","createDirectory","dirName","setDirName","validationResult","setValidationResult","updateValidation","asyncCallback","callbackRef","_len2","_key2","useCancelableAsyncCallback","validate","copyFilenameActionState","copyAbsolutePathActionState","copyPathFromRepositoryRootActionState","useProjectActions","openSearchEverywhere","newFileAction","newDirectoryAction","newElementActionGroup","copyReferencePopupGroup","ToolWindowsRefContext","useToolWindowManager","toolWindowRef","changeState","useChangesViewActionDefinitions","openRollbackWindow","useCheckInActionDefinition","useCheckInProjectAction","useJumpToSourceAction","useChangeListActionDefinitions","commitFileMsg","commitDirMsg","queueCheckIn","toolWindowManager","projectFiles","relative","isPathInside","selectedPathsAreDirectories","every","queueChanges","includedChangesKeys","keyToSelect","allKeys","arr","changePath","StyledCheckboxesContainer","CreateNewBranchWindow","setCheckout","overwrite","setOverwrite","isErrorVisible","setIsErrorVisible","createBranch","setBranchName","isValid","AlreadyExistsError","autoSelect","createAction","pathsToAddState","isIgnored","isUnchangedFile","gitAddDisabledState","gitAddActionSelector","pathsToAdd","gitInitActionSelector","visitedUrlsChecker","url","username","gitVisitedUrlsState","UrlAndUserName","cloneParentDirState","defaultWorkspaceFiles","defaultInitializer","InlinePopup","StyledPopupContainer","ProjectInitializer","autoCloneSampleRepo","cloneProgress","setCloneProgress","ensureSampleRepo","repoUrl","info","isSuccessfullyCloned","cloneRepo","onProgress","initializer","INITIALIZE_APP","projectDir","loaded","phase","round","AlertDialog","heading","buttons","location","reload","clone","http","corsProxy","singleBranch","getInputCursorOffset","caretIndex","selectionStart","inputStyle","getComputedStyle","hiddenSpan","createElement","visibility","whiteSpace","font","paddingLeft","textContent","substring","appendChild","caretOffset","offsetWidth","removeChild","StyledPopover","WINDOW_SHADOW","ListBoxStyledAsMenu","ListBox","MENU_VERTICAL_PADDING","PathInputField","valueProp","onChangeProp","defaultValueProp","useControlledState","isAutocompleteVisible","setAutocompleteVisible","collectionRef","pathSearchQuery","setPathSearchQuery","pathSuggestions","setPathSuggestions","updatePathAutocompletion","setMenuOrigin","clientX","inputClientRect","x","clientY","y","wasAutocompleteVisible","usePrevious","pathParts","searchDirectory","canceled","getChildDirectories","suggestions","matchedSuggestions","setSelectionRange","menuOrigin","getBoundingClientRect","CODE_COMPLETION","mergeRefs","inputProps","onKeyDown","shouldFocusOnHover","shouldUseVirtualFocus","gitCloneActionSelector","GitCloneWindow","cloneAnotherRepoActionSelector","urlProp","setUrl","parentDir","setDirectory","getAutoFillDir","autoFillDirectory","setAutoFillDirectory","showValidationErrors","setShowValidationErrors","setCloneParentDirState","visitedUrls","setVisitedUrls","urlInputRef","dirInputRef","urlError","removePrefix","trim","sanitizeCloneUrl","URL","SSH_URL_PATTERN","validateRepoUrl","dirError","setDirError","refreshProjectFiles","setVcsRoots","useCallback","onSuccess","useClone","repoName","LabeledControlsAlignmentProvider","dirValidationError","validateCloneDirectory","urls","visitedUrl","ComboBox","onValueChange","str","prefix","useVcsActions","usePopupManager","gitAddAction","gitInitAction","gitCloneAction","cloneAnotherRepoAction","WORKSPACE_XML_PARSE_OPTIONS","attributeNamePrefix","ignoreAttributes","tagName","jPath","WORKSPACE_XML_BUILD_OPTIONS","readWorkspace","xmlParser","XMLParser","xmlData","workspace","parse","component","writeWorkspace","workspaceState","xmlString","XMLBuilder","build","storageFileMapping","PersistentStateProvider","containerDirectory","resolveStorageFile","getWorkspace","RecoilSync","diff","changesByFile","components","componentState","useTestActions","abortSignal","each","getProcessName","sleep","durationInMs","num","StyledWindowFrame","Project","isRollbackWindowOpen","isSearchEveryWhereOpen","useAlertDialog","BalloonManager","disablePortal","SetBalloonManagerRef","UsePersistentFsNotification","ProjectActionProvider","DefaultToolWindows","onToolWindowStateChange","newState","windows","useCapture","timeoutId","usePersistenceFsNotification","exampleAppKeymap","ActivateProjectWindow","firstKeyStroke","modifiers","ActivateCommitWindow","ActivateVersionControlWindow","ActivateTerminalWindow","SafeDelete","secondKeyStroke","App","KeymapProvider","RecoilRoot","WindowManager","PopupManager","isActionGroup","isResolvedActionGroup","isActionGroupDefinition","shortcutString","isKeyMatch","keyStroke","loose","supportedModifiers","modifier","getModifierState","ActionsContext","generateId","ACTION_PROVIDER_ID_ATTRIBUTE","ACTION_PROVIDER_ID_DATA_PREFIX","actionProvidersMap","parentContext","recursivelyCreateActions","shortcuts","actionProviderId","firstKeyActivatedShortcutsRef","secondStrokeResetTimerIdRef","nativeEvent","repeat","triggerAction","firstKeyMatches","isKeyboardShortcut","addEventListener","once","capture","useShortcuts","delete","actionDefinitions","actionDefinition","firstShortcut","isMutableActionGroup","closestActionProvider","actionSets","dataKey","actionSet","SHOW_SEARCH_HISTORY","KeymapContext","defaultKeymap","keymapProp","parentKeyMap","assign","create","actionButton","isAction","getAllActions","renderActionAsMenuItem","isGroup","hasDivider","flatten","openActionsInPopup","positioning","targetRef","MENU_POSITION_TARGET_DATA_ATTRIBUTE","groupDefinition","RESIZE_TOOL_WINDOW_RIGHT_ACTION_ID","RESIZE_TOOL_WINDOW_LEFT_ACTION_ID","RESIZE_TOOL_WINDOW_TOP_ACTION_ID","RESIZE_TOOL_WINDOW_BOTTOM_ACTION_ID","MAXIMIZE_TOOL_WINDOW_ACTION_ID","FOCUS_EDITOR_ACTION_ID","HIDE_ACTIVE_WINDOW_ACTION_ID","JUMP_TO_LAST_WINDOW_ACTION_ID","defaultKeyToStr","Control","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Enter","Quote","Minus","Subtract","NumpadAdd","Multiply","NumpadMultiply","Equal","Backspace","fromPairs","KeystrokeToString","isMac","separator","codeToStr","Alt","Shift","Meta","Escape","modifiersOrder","keystrokeToString","keystroke","actionGroupId","StyledModalWindow","StyledWindowContainer","StyledHeading","h2","StyledBody","StyledContent","StyledCheckbox","StyledButtons","ButtonGroup","StyledIcon","StyledHelpIcon","checkbox","helpButton","defaultBounds","observeContentResize","OverlayMoveHandle","dragThreshold","canMoveStart","isEventOnEmptySpaces","moveHandleProps","cancelText","bgColor","StyledHeaderActions","StyledBalloonContainer","StyledIconContainer","StyledBalloonHeader","StyledBalloonBody","lineClamp","StyledBalloonFooter","StyledToggleIconContainer","StyledToggleExpandButtonContainer","StyledToggleExpandButtonFooterContainer","BalloonContext","Balloon","iconProp","expanded","expandedProp","defaultExpanded","headerActions","bodyRef","expandable","setExpandable","setExpanded","maxLinesWhenNotExpanded","bodyElem","clientHeight","parseFloat","getNumLines","scrollHeight","iconType","effectiveExpanded","marginLeft","ToggleWrapper","Component","iconName","toggleIcon","className","NotImplementedFn","BalloonsContext","BalloonsContainer","StyledBalloonsStack","setBalloons","timeoutIdsRef","lastIdRef","api","timeout","aBalloon","balloon","aTimeoutId","notificationsStack","ReactDOM","elementType","elementTypeProp","buttonProps","useButton","domProps","filterDOMProps","StyledButton","StyledDefaultButton","StyledIconButton","variants","MnemonicTrigger","onTriggered","StyledButtonGroup","HorizontalArrowKeyNavigation","arrowKeyNavigationProps","focusManager","useFocusManager","keyboardProps","useKeyboard","hasAnyModifier","focusPrevious","wrap","focusNext","continuePropagation","StyledWrapperLabel","StyledCheckboxLabelText","disableFocusAlwaysVisible","useToggleState","useCheckbox","isFocusVisible","isFocused","focusProps","useFocusRing","focusDisabledProps","onFocusCapture","blur","CheckboxIcon","pointerEvents","LafIcon","Disabled","Selected","Focused","CollectionSpeedSearchContext","CollectionSpeedSearchItemContext","SpeedSearchItemHighlightsProvider","collection","highlightedRanges","speedSearchContext","useCollectionSpeedSearchResult","selectionManager","inputSelectionManager","speedSearch","focusBestMatch","getKeys","matchedRanges","wrappedSelectionManager","selectAll","createSpeedSearchSelectionManager","latestValues","matchedKeys","noneOfTheMatchesAreSelected","matchedKey","keyToFocus","firstRange","rangeA","rangeB","getLongestCommonPrefixMatch","passedFirstSelection","firstSelectedKey","getMatchToSelect","useCollectionSpeedSearch","keyboardDelegate","speedSearchStateProps","useSpeedSearchState","speedSearchSelectionManager","useSpeedSearch","speedSearchKeyboardDelegate","wrappedKeyboardDelegate","findFirstMatch","fromKey","direction","currentKey","getKeyAbove","getKeyBelow","getFirstKey","global","firstKey","getLastKey","lastKey","createSpeedSearchKeyboardDelegate","speedSearchContextValue","searchPopupProps","constructor","seq","this","_Divider","getCollectionNode","hasChildNodes","_Item","StatelyItem","originalShouldInvalidate","shouldInvalidate","invalidated","GAP","StyledHint","StyledGroup","useCollectionAutoScroll","isVirtualized","focusedKey","scrollIntoView","useCollectionFocusProxy","proxy","dispatchEvent","KeyboardEvent","removeEventListener","StyledComboBoxContainer","StyledComboBoxInput","inset","forwardRef","contextHelp","contextHelpPlacement","inputRefProp","buttonRef","dropdownContainerRef","popoverRef","listBoxRef","isInvalid","useComboBoxState","menuTrigger","allowsCustomValue","inputValue","defaultInputValue","onInputChange","descriptionProps","errorMessageProps","labelProps","comboboxInputProps","listBoxProps","useComboBox","WithLabel","WithInlineContextHelp","showOnFocus","triggerRef","StyledDropdownArrowIcon","Popover","containerPadding","StatelessListBox","useListState","selectionBehavior","useListBox","StyledList","ListBoxSection","section","Option","optionProps","useOption","containerFocused","StyledSectionHeading","StyledSection","itemProps","headingProps","groupProps","useListBoxSection","childNodes","borderRadius","StyledContextHelp","contextHelpForeground","StyledContextHelpWrapper","StyledLabelContainer","StyledLabel","labelRef","applyLabelWidth","commonWidth","LabelAlignmentContext","apply","useAlignedLabels","setCommonWidth","currentWidth","StyledIconHoverContainer","amendName","ICONS_DIR_PREFIX","useIconPath","iconDescriptor","themePath","resolvedValue","findIconPath","resolvedIconPath","useForwardedRef","useSvgIcon","iconNameOrPath","amendment","ext","getPlatformIconPath","darkIcon","getDarkPath","darkPath","fallbackPath","DEFAULT_ICON_SIZE","itemState","ariaBusy","getSvgIcon","svgElement","outerHTML","randomPostfix","toFixed","idMatches","matchAll","modifiedSvg","replaceAll","makeIdsUnique","fetchIcon","theOld","theNew","replaced","replacedAgain","DEFAULT_MINIMUM_BUTTON_SIZE","NAVBAR_MINIMUM_BUTTON_SIZE","minSize","isPressedInput","onPressChange","onPressEnd","onPressStart","onPressUp","shouldCancelOnPointerExit","pressProps","usePress","ArrowIcon","noArrow","previouslyFocusedElementRef","StyledInputBox","StyledAddons","StyledRightAddons","StyledLeftAddons","addonBefore","setIsFocused","focusWithinProps","useFocusWithin","onFocusWithinChange","spellCheck","fieldProps","useField","StyledLink","focusBorderColor","labelable","interactionHandlers","FocusRing","focusRingClass","allowEmptySelection","disallowEmptySelection","listProps","listContext","useList","virtualizerProps","renderNode","useListVirtualizer","ListItem","ListContext","Virtualizer","ListDivider","useSeparator","separatorProps","listFocused","useSelectableItem","shouldForwardProp","prop","labelForeground","asCurrentForeground","labelSelectedForeground","asCurrentBackground","selectOnFocus","disallowTypeAhead","allowsTabNavigation","collator","useCollator","usage","sensitivity","delegate","ListKeyboardDelegate","collectionProps","useSelectableCollection","useSelectableList","setFocused","isEmpty","onActionCallback","originalUseListState","useCollectionRef","StyledListSectionHeader","outline","cursor","ListSection","reusableView","headerRef","useVirtualizerItem","layoutInfoToStyle","layoutInfo","renderWrapper","renderChildren","viewType","VirtualizerItem","layout","VariableWidthListLayout","estimatedRowHeight","estimatedHeadingHeight","dividerHeight","sizeToFit","scrollToItem","virtualizer","shouldScrollX","duration","scrollDirection","useMenuTriggerState","positionOrigin","overlayRef","useContextMenu","setPositionOrigin","allProps","defaultAutoFocus","patchCollectionItem","partialNode","result2","partialChildNode","partialChildNodeWithoutType","PatchedItem","bind","PatchedSection","convertChildren","Item2","MenuOverlayContext","MenuContext","useMenu","onActionProp","menuContextValue","useMenuAria","useMenuState","patchCollectionProps","useTreeState","childExpansionBehaviour","expandedKey","onExpandedKeyChange","defaultExpandedKey","StyledMenu","renderMenuNodes","StyledMenuItemText","StyledMenuItemPlatformIcon","StyledMenuItemLafIcon","MenuItemContext","keyboardShortcutProps","useMenuItemLayout","MenuItem","nestedMenuRef","isExpanded","renderSubmenu","Submenu","menuItemProps","hasSubmenu","ariaMenuItemProps","useMenuItemAria","onMouseEnter","onPointerEnter","onPointerDown","hoverProps","useHover","onHoverStart","isAnySubmenuOpen","parentKey","togglePressProps","useMenuItem","overlayProps","positionProps","useOverlayPosition","shouldFlip","MENU_BORDER_WIDTH","arrowProps","StyledMenuItem","StyledMenuItemIcon","StyledNestedArrow","Overlay","OverlayComponent","SimpleOverlay","parentState","rootKey","portalContainer","StyledMenuItemLayout","Content","Shortcut","kbd","useContextOrThrow","allowedIcon","MenuOverlay","restoreFocus","otherOverlayProps","inputOverlayRef","useOverlay","shouldCloseOnBlur","isKeyboardDismissDisabled","isDismissable","shouldCloseOnInteractOutside","areInNestedOverlays","usePreventScroll","onOutsideContextMenu","useOverlayPositionFromOrigin","setPosition","overlayElement","overlayWidth","overlayHeight","totalWidth","documentElement","clientWidth","totalHeight","calculatePosition","offsetHeight","zIndex","DisableScrollStyles","createGlobalStyle","scrollParent","isScrollable","getScrollParent","classList","align","positioningTargetRef","triggerProps","useMenuTrigger","ariaButtonProps","getPlacement","StyledItemsContainer","ul","StyledSearchFieldWrapper","StyledSpeedSearchMenu","useSpeedSearchMenu","speedSearchContainerProps","ListCollection","MenuKeyboardDelegate","contains","focusSafely","setSize","measureSize","useResizeObserver","onResize","sizeStyleProps","maxHeight","emptyText","clear","SpeedSearchSubmenu","SpeedSearchMenuContent","menuRef","SpeedSearchInput","useSubmenuState","rootItem","submenuProps","useSubmenu","highlightedStyle","defaultStyle","disabledStyle","li","useSubmenuAria","submenuBehaviorProps","super","keyBelow","keyAbove","isFocusedRef","focusedKeyRef","defineProperties","SelectionManager","StyledMenuHeading","StyledMenuSectionItemsContainer","MenuSection","useMenuSection","MnemonicContext","createContext","character","onTriggeredProp","keydownListener","parentElement","getClientRects","keyupListener","renderedMnemonicRef","timerId","hidden","MnemonicText","found","UNSAFE_React17SuspenseFix","measureContentSize","NullSuspenseFallback","afterUnsuspended","afterSuspended","afterSuspendedProp","afterUnsuspendedProp","StyledWindowUnderlay","StyledWindowInnerContainer","DEFAULT_WINDOW_MIN_WIDTH","DEFAULT_WINDOW_MIN_HEIGHT","WindowControllerContext","propsContext","modalProps","underlayProps","useModalOverlay","useOverlayTriggerState","dialogProps","titleProps","useDialog","overlayInteractionHandlerProps","UNSAFE_measureContentSize","useResizableMovableOverlay","focusContainmentFixProps","lastFocusedElementRef","probablyFocusedElement","elementToFocus","useFocusContainmentFix","OverlayInteractionHandler","WindowContext","movable","OverlayResizeHandles","StyledFooter","hasBorder","StyledFooterSide","WindowFooter","StyledWindowTitle","h1","WindowHeader","renderTitle","StyledWindowFooter","StyledWindowContentWrapper","WindowsContext","setWindows","newKeyRef","currentWindows","aWindow","ParentOverlayContext","AriaOverlay","element1","element2","overlayRoot1","overlayRoot2","OverlayInteractionHandlerContext","useOverlayInteractionHandler","useOverlayMoveHandle","interactionHandler","finishInteraction","startInteraction","updateBounds","useMove","onMoveStart","onMove","startState","movement","onMoveEnd","overlayResizer","initialBoundsRef","newWidth","initialBounds","newHeight","getResizerProps","side","onResizeStarted","onResizeEnd","useOverlayResizer","RightResizer","LeftResizer","TopResizer","BottomResizer","popoverProps","usePopover","DismissButton","onDismiss","withMinSize","getCenteredBounds","targetElement","targetBounds","ensureInViewport","viewportWidth","viewportHeight","clamp","getContentSize","ceil","cloneNode","returnValue","withTemporaryStyle","useContentSize","observe","measuredSizes","setMeasuredSizes","lastMeasuredSize","at","Size","isEqual","newSize","cancelAnimationFrame","measure","currentSize","aSize","debouncedMeasure","fnRef","currentTimeoutId","useDebouncedCallback","mutationObserver","MutationObserver","subtree","childList","disconnect","width2","height2","inputBounds","onBoundsChanging","contentSize","currentInteraction","setCurrentInteraction","effectiveMinWidth","effectiveMinHeight","applyMinSize","getBounds","updatedBounds","partialBounds","centeredContentBounds","positioned","sized","StyledInnerContainer","DEFAULT_POPUP_MIN_WIDTH","DEFAULT_POPUP_MIN_HEIGHT","_Popup","allowScroll","positioningProp","onCloseProp","PopupControllerContext","useInteractOutside","onInteractOutsideStart","onInteractOutside","positionedBounds","pipe","focusForwarderProps","useFocusForwarder","titleId","useSlotId","useOverlayFocusContain","propsArray","mergeNonNullProps","PopupContext","PopupHeader","StyledPopupHint","StyledPopupHeader","labelDisabledForeground","renderHeader","StyledPopupLayout","StyledPopupLayoutHeader","StyledPopupLayoutContent","StyledPopupLayoutFooter","PopupsContext","popups","setPopups","currentPopups","aPopup","wrappedPopup","useOverlayTrigger","PressResponder","minValue","valueLabel","showValueLabel","progressBarProps","useProgressBar","percentage","forcedDetails","setForcedDetails","setTooltip","contextValue","StyledProgressBarLabel","effectiveDetails","StyledProgressBarContainer","StyledProgressBarLineContainer","hasTopMargin","hasBottomMargin","StyledProgressBarTrack","indeterminate","StyledProgressBarProgress","ProgressBarContext","StyledProgressBarDetails","getIndeterminateStartColor","getIndeterminateEndColor","indeterminateBackgroundAnimation","keyframes","useProgressBarIconButton","hoverTooltip","isHovered","useProgressBarPauseIconButton","paused","Label","LineContainer","Track","Progress","Details","ResizableView","resizerPlacement","resizerProps","useBottomResizer","VerticalResizer","StyledHorizontalResizer","StyledHorizontalResizerArea","handleSize","HorizontalResizer","outerPadding","useLeftResizer","useRightResizer","useTopResizer","StyledVerticalResizer","StyledVerticalResizerArea","useResizer","invert","onHistoryItemSelected","historyButtonTitle","inputContainerRef","isSearchHistoryOpen","setSearchHistoryOpen","showSearchHistoryAction","searchIcon","historyItemText","parseInt","historyItem","StyledSearchIcon","StyledSpeedSearchInput","noMatch","getOutlineColor","StyledSearchText","clearButtonRef","SpeedSearchPopup","StyledSpeedSearchPopup","tooltipForeground","useGhostInput","valueRef","ctrlKey","metaKey","elem","isContentEditable","HTMLInputElement","sliceEnd","defaultIsSearchActive","onIsSearchActiveChange","defaultSearchTerm","ghostInputKeydown","trimmedValue","trimStart","onKeyUp","onBlurWithin","StyledStatusBar","StyledStatusBarLeft","StyledStatusBarRight","StyledStatusBarSection","StyledWrapper","StyledStatusBarWidget","StyledStatusBarIconWidget","DarculaSeparatorUI","defaultSize","StyledSeparator","backgroundClip","boxSizing","StyledHorizontalSeparator","onUnpin","pinned","TabContentLayout","startIcon","endIcon","editorTabTheme","underlineHeight","underlinedTabInactiveBackground","underlinedTabBackground","hoverInactiveBackground","hoverBackground","inactiveUnderlineColor","underlineColor","underlinedTabInactiveForeground","underlinedTabForeground","StyledEditorTab","StyledDefaultTab","getTabThemeStyles","StyledEditorTabs","StyledDefaultTabs","getTabsThemeStyles","focusable","StyledTabItemLayout","iconStyle","StyledStartIconWrapper","StyledEndIconWrapper","horizontalOverflowIndicatorStyles","StyledHorizontalOverflowShadows","hasOverflowAtStart","hasOverflowAtEnd","Tab","shouldSelectOnPressUp","tabProps","useTab","scrollBarDisabledStyle","StyledTabList","multiRow","noOverflowMenu","noScroll","useTabListState","tabListProps","useTabList","scrolledIndicatorProps","hasOverflow","threshold","setHasOverflow","offsetLeft","scrollLeft","offsetRight","scrollWidth","offsetTop","scrollTop","offsetBottom","newHasOverflow","onScroll","useHasOverflow","overflowedElements","useOverflowObserver","overflowedKeys","scrollableContainer","selectedTabElement","TabsOverflowMenu","onSelect","setSelectedKey","menuItem","toolWindowTabTheme","StyledToolWindowTab","StyledToolWindowTabs","ToolWindowTabs","getAllRanges","ranges","gapRange","range","createRangesFromIndices","indices","lastRange","HighlightedMatch","highlighted","numberPattern","parseComponent","componentStr","min","parseHexRgba","parseShorthandHex","parseRgb","parseRgba","Color","rgba","g","r","NaN","Number","isInteger","parseColorString","withTransparency","alpha","brighter","int","FACTOR","darker","blend","colorOrColorString","getBlendedValue","isNaN","padStart","StyledSplitterContainer","StyledView","StyledSplitterInnerView","resizerPropsOverrides","firstViewRef","lastViewRef","firstSizeState","setFirstSizeState","lastSizeState","setLastSizeState","horizontalValue","verticalValue","FirstResizer","SecondResizer","sizeStyleProp","minSizeStyleProp","isFractionSize","normalizeSize","getSize","getNewSize","newFractionSize","getActualSize","viewElem","actualSize","currentLastSize","currentFirstSize","StyledFloatView","FloatView","boundsStyle","FloatToolWindows","floatWindows","renderToolWindow","stackedFloatWindows","sortedKeys","setSortedKeys","sorted","bringToFront","move","useStackedLayersState","layersProps","toolWindow","MovableToolWindowStripeContext","MovableToolWindowStripeProvider","stripes","draggingRect","setDraggingRect","draggingKey","setDraggingKey","dropPosition","setDropPosition","getDropPositionRef","moveStartLocationRef","addStripe","propsRef","startMove","stripe","stripeElRef","stripeElement","getItemRect","toJSON","indexInMain","mainItems","indexInSplit","splitItems","dropPositionGetters","createGetDropPosition","getDropPosition","draggedRect","endMove","TopStripe","BottomStripe","LeftStripe","RightStripe","InnerView","StyledToolWindowOuterLayout","Shell","hideStripes","getSizeInAnchor","containerSize","isHorizontalToolWindow","mapToKey","sortAndMapToKey","compose","order","filterMains","getMains","filterSplits","filterVisible","expectedViewMode","viewMode","getSplits","filterVisibleDocked","filterVisibleUnDocked","getDocked","docks","mains","splits","mainKey","sizeFraction","sideWeight","getUnDocked","getSideState","main","activeKeys","undocked","docked","DEFAULT_HEIGHT","DEFAULT_WIDTH","getFloatWindowsState","floatingBounds","getFloatWindowState","getStripeRect","start","rect","end","getDropPositions","getRef","score","abs","keyToOffsets","boundingRect","getKeyToOffsets","dropPositions","lastDropPosition","stripeRect","getCanDrop","bestMatch","STRIPE_BUTTON_LINE_HEIGHT","StyledToolWindowStripeButton","StyledToolWindowStripe","theOtherSide","preventCollapse","useElementMove","ghost","ghostOption","otherOptions","updateGhostPosition","defaultGhost","computedBackground","resultColor","nextColor","findEffectiveBackgroundColor","createDefaultGhost","append","ToolWindowStripe","render","onItemPress","getProps","latestPropsRef","moveDisabled","useMovableStripeButtons","isNotCurrentItem","anItem","ToolWindowStripeButton","getStripeButtonStyles","styles","marginValue","StyledUndockSide","UndockSide","ToolWindows","hideToolWindowBars","useWidescreenLayout","mainContentMinWidth","windowsById","mainContentFocusScopeRef","layoutState","setLayoutState","windowFocusableRefs","latestRef","container","_setLayoutState","windowIds","getToolWindowsLayoutState","observer","ResizeObserver","contentRect","unobserve","focusLastActiveWindow","lastFocusedKey","focusMainContent","updater","interactionOutsideRef","onFocusLost","handleBodyFocus","focusLosingElement","focusReceivingElement","useOnFocusLost","renderStripe","toolbarButton","lastFocused","ToolWindowStateProvider","mainContentFocusableRef","renderSideDockedView","resizeDockSplitView","onDockResize","containerBounds","resizeDock","getSplitViewProps","firstAnchor","secondAnchor","horizontalSplitterProps","verticalSplitterProps","outerSplitterProps","innerSplitterProps","undockLayers","resizeUndock","setFloatingBound","renderInnerLayout","ToolWindowStateContext","hide","removeFromSidebar","moveToSide","changeViewMode","stretchWidth","stretchHeight","setFloatingBounds","isDocked","areInSameSection","curry","window1","window2","getViewModeType","layoutToRestore","invalidWindows","targetKey","mapWindows","hideAll","restoreWindows","closableViewModes","viewModeType","sideOrIndex","targetSide","targetIndex","targetSideWindows","indexInTargetSide","sortedTargetWindows","insert","newTargetSideWindows","targetViewMode","stretch","mapFn","property","currentFloatingBound","resizeSide","dock","isInResizingView","_temp2","inputs","useToolWindow","contentRef","focusableContentRef","onFocusChange","contentHasFocus","setContentHasFocus","contentFocusWithinProps","toolWindowProps","autoHideProps","hideTimeoutId","windowFocusWithinProps","onFocusWithin","useAutoHide","forwardFocus","ignoreFocusedDescendant","toolWindowContentProps","toolWindowHeaderProps","ToolWindowSettingsIconMenu","viewModeActionGroup","VIEW_MODE_ACTION_GROUP_ID","moveToActionGroup","MOVE_TO_ACTION_GROUP_ID","resizeActions","TOOL_WINDOW_RESIZE_ACTION_GROUP_ID","maximizeAction","removeFromSideBarAction","REMOVE_TOOL_WINDOW_FROM_SIDEBAR_ACTION_ID","gearIconActions","ViewModeToActionId","StyledToolWindowHeaderActions","StyledToolWindowHeaderContent","DefaultToolWindowHeader","DOCK_TOOL_WINDOW_ACTION_ID","StyledToolWindowContainer","StyledToolWindowContent","DefaultToolWindowContext","mainContentTitle","defaultToolWindowContext","useToolWindowActions","getToolWindowNumberFromShortcut","DefaultToolWindowToolbarButton","showNumber","getActivateToolWindowActionId","number","showNumbers","toolWindowsRef","windowById","useToolWindowsActions","getPresentation","groupTabs","isToolWindowFocused","setToolWindowFocused","setActiveKey","defaultActiveKey","toArray","validChild","MultiContentToolWindowContent","renderedViewSwitcher","previousKeys","newActiveKey","activeContent","DOCK_PINNED_MODE_ACTION_ID","DOCK_UNPINNED_MODE_ACTION_ID","UNDOCK_MODE_ACTION_ID","FLOAT_MODE_ACTION_ID","WINDOW_MODE_ACTION_ID","HEIGHT_RESIZE_STEP","WIDTH_RESIZE_STEP","anchors","getAnchorName","docked_pinned","docked_unpinned","undock","float","alert","resizeGroup","isAnySideWindowWindowOpen","getOrdinal","n","ord","borderStyle","borderPropToCssProp","StyledShowMoreButton","StyledHorizontalToolbar","StyledVerticalToolbar","StyledToolbarContent","shouldWrap","firstOverflowedIndex","OrientationContext","overflowBehavior","rootProps","showMoreButtonRef","isOverflowPopupVisible","setOverflowPopupVisible","popupHeight","setPopupHeight","firstOverflowedChildIndex","setFirstOverflowedChildIndex","firstOverflowedChildRef","childElements","firstOverflowedChild","toolbarProps","onMouseMove","firstOverflowedElement","shouldShow","onMouseLeave","toolbarOverflowPopupProps","showOverflowPopup","ToolbarInOverlay","firstVisibleIndex","link","tooltipProps","multiline","Description","inputTriggerRef","useTooltipTriggerState","fallbackRef","positionAria","updatePosition","TooltipTriggerAndOverlay","StyledTooltip","tooltipBackground","hasPointer","tooltipBorderColor","WITH_POINTER_BORDER_RADIUS","fontSizeDelta","StyledDescription","placementToPointerSide","center","isInteractive","pointerPositionStyle","TooltipContext","useTooltip","TooltipPointer","tooltipRef","_Tooltip","POINTER_THICKNESS","TRANSLATE","sideStyles","StyledTooltipPointer","POINTER_WIDTH","POINTER_HEIGHT","normalizeCssValue","withMin","withMax","HEIGHT_OFFSET","WIDTH_OFFSET","limitPointerPositionStyles","applyVerticalMinMax","applyHorizontalMinMax","getOffsetCssProp","pointerPositionToOffsetStyle","offsetValue","lastMouseClientPos","globalMoveHandler","fakeTarget","coordinatesSource","_updatePosition","useMouseEventOverlayPosition","setInteractive","useTooltipTrigger","FocusableProvider","normalizeChildren","useAriaTooltipTrigger","StyledValidationTooltip","StyledWarningValidationTooltip","SpeedSearchTreeNode","TreeNode","treeProps","treeContext","useSpeedSearchTree","useTreeVirtualizer","TreeContext","StyledTree","collectionSpeedSearch","TreeKeyboardDelegate","speedSearchKeyboardProps","selectableTree","useSelectableTree","getKeyLeftOf","getKeyRightOf","TREE_ICON_SIZE","StyledTreeNodeIcon","getIcon","iconPath","TreeNodeIcon","useTreeNodeToggleButton","treeNodeToggleButtonProps","selectedDescendantKeys","toggleSelection","StyledTreeNode","onActionRef","treeNodeProps","useTreeNode","selectionKeyDown","focusedItem","isExpandable","onNodeKeyDown","shouldToggle","shiftKey","useSelectParentOfRemovedSelectedNode","previousCollectionRef","rawSelection","invalid","valid","invalidKey","useCollectionCacheInvalidation","cacheInvalidation","invalidators","lastInvalidators","anInvalidator","Symbol","iterator","TreeCollection","keyMap","iterable","last","visit","nextKey","prevKey","_Symbol$iterator","getKeyBefore","getKeyAfter","idx","getSingleChildrenKeys","getSingleChildrenKeysRecursive","childNodesIterator","firstChild","done","noMoreChildren","isEmptyIterable","TreeSelectionManager","expandSelection","expandKeys","getExpandAndShrinkKeys","shrinkSelection","shrinkKeys","recursivelyGetExpandAndShrinkKeys","previousChild","newKeys","parentDescendants","getAllDescendants","getAllRoots","descendants","stopKeys","_TreeCollection","rootKeys","getAllExpandableKeys","recursivelyAddExpandableKeys","useMultipleSelectionState","useCollection","latestState","expandAll","collapseAll","useTreeRef","newExpandedKeys","toggleTreeNode","expandedSiblings","getRootItemKeys","getChildItems","siblings","getSiblings","aKey","sectionItems","FlattenedTreeLayout","buildChild","layoutNode","doBuildCollection","visibleNodes","maxY","isLoading","Rect","visibleRect","loaderHeight","loader","LayoutInfo","layoutInfos","placeholderHeight","getVisibleLayoutInfos","collectSelectableItemsRecursive","collectedItems","WeakMap","itemsInSubtree","collectSelectableItems","cachedState","allDescendantsStates","otherInvalidators","StyledCheckboxWrapper","selectItemOnPress","itemContext","selectedKeysProp","defaultSelectedKeys","selectedKeysSetter","useControllableSet","ListLayout","keyToWidth","visibleContentWidth","buildItem","buildNode","buildDivider","rectHeight","estimatedSize","buildCollection","getVisibleContentWidth","invalidateEverything","layoutNodes","newRect","oldRect","invalidationContext","lastWidth","updateItemSize","changed","visibleViews","view","itemContentWidth","intersects","getVisibleRect","isWordSeparator","isWhitespace","char","isUpperCase","isMeaningfulChar","ch","rawPattern","isStarts","isStart","continuous","inputIndex","patternIndex","lastMatch","chars","previousChar","useAriaSelectableCollection","useOriginalSelectableItem","directChildRef","focusManagerRef","forceFocusFirst","containerElement","focusFirst","tabbable","WrappedFocusScope","GetFocusManager","savedUserSelect","handlersRef","webkitUserSelect","pageX","pageY","dragStarted","runAfterTransition","OverflowObserver","callback","mutations","mutation","removedNodes","intersectionObserver","addedNodes","IntersectionObserver","newHiddenElements","isIntersecting","newVisibleElements","previouslyOverflowedElements","currentOverflowElements","childElement","scrollableContainerRef","rootMargin","setOverflowedElements","overflowObserver","processItem","targetNodeKeys","targetNodeKeySet","childValues","childValue","dfs","bfs","childNode","by","compareFn","aa","bb","Context","nullErrorMessage","possiblyBlurredElement","getFocusableTreeWalker","innerRef","ImmutableSet","setValueWithMutation","_len3","_key3","mutate","useStateSetterForSet","webpackAsyncContext","req","__webpack_require__","o","module","exports","ids"],"sourceRoot":""}